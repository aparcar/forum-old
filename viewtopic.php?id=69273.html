<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> OpenVPN fails to read username/passwords from file</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 26 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p348711">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">slack---line</div>
					<div class="post-datetime">
						7 Jan 2017, 21:59					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>Trying to establish OpenVPN connection to SlickVPN but having some trouble with permissions on the file I&#039;ve configured that holds username and password.</p><p>Configuration (in /etc/config/openvpn) is below along with certificate and the specified filename which contains its permissions...</p><div class="codebox"><pre><code>config openvpn &#039;SlickVPN&#039;
    option float &#039;1&#039;
    option client &#039;1&#039;
    option reneg_sec &#039;0&#039;
    option persist_key &#039;1&#039;
    option nobind &#039;1&#039;
    option remote_cert_tls &#039;server&#039;
    option remote &#039;gw1.lhr4.slickvpn.com gw1.man2.slickvpn.com gw1.iom1.slickvpn.com gw1.dub1.slickvpn.com gw1.ost1.slickvpn.com gw1.lil1.slickvpn.com gw1.ams3.slickvpn.com gw1.lux1.slickvpn.com&#039;
    option comp_lzo &#039;no&#039;
    option port &#039;443&#039;
    option auth_user_pass &#039;/etc/openvpn/slickvpn&#039;
    option cipher &#039;AES-256-CBC&#039;
    option dev &#039;tun&#039;
    option proto &#039;udp&#039;
    option auth_retry &#039;nointeract&#039;
    option ca &#039;/lib/uci/upload/cbid.openvpn.SlickVPN.ca&#039;
    option verb &#039;9&#039;

# cat /lib/uci/upload/cbid.openvpn.SlickVPN.ca 
-----BEGIN CERTIFICATE-----
MIIDQDCCAqmgAwIBAgIJAM8Brk2pUr0KMA0GCSqGSIb3DQEBBQUAMHQxCzAJBgNV
BAYTAlVTMQswCQYDVQQIEwJDQTEMMAoGA1UEBxMDVlBOMQwwCgYDVQQKEwNWUE4x
DDAKBgNVBAsTA1ZQTjEMMAoGA1UEAxMDVlBOMQwwCgYDVQQpEwNWUE4xEjAQBgkq
hkiG9w0BCQEWA1ZQTjAeFw0xMjAzMDMwMjExNDJaFw0yMjAzMDEwMjExNDJaMHQx
CzAJBgNVBAYTAlVTMQswCQYDVQQIEwJDQTEMMAoGA1UEBxMDVlBOMQwwCgYDVQQK
EwNWUE4xDDAKBgNVBAsTA1ZQTjEMMAoGA1UEAxMDVlBOMQwwCgYDVQQpEwNWUE4x
EjAQBgkqhkiG9w0BCQEWA1ZQTjCBnzANBgkqhkiG9w0BAQEFAAOBjQAwgYkCgYEA
wY2K08N7or1Br/EsD9XBon7gs7dKflWYuymgMLJfeMFWuJloNdsn+3GARIhYBbN6
zhvFGFE214qKPqAydW1WmIIK7KoC0sgndr+Vk/au9gssFzVmmvr6+WN/nfo2L9Kv
vBMoYLrMAiyw/D4cRapZi2pXJLcMDfC+p1VWAX8TYWkCAwEAAaOB2TCB1jAdBgNV
HQ4EFgQUmyvO4rTnu5/ABnp0FngU+SdR8WAwgaYGA1UdIwSBnjCBm4AUmyvO4rTn
u5/ABnp0FngU+SdR8WCheKR2MHQxCzAJBgNVBAYTAlVTMQswCQYDVQQIEwJDQTEM
MAoGA1UEBxMDVlBOMQwwCgYDVQQKEwNWUE4xDDAKBgNVBAsTA1ZQTjEMMAoGA1UE
AxMDVlBOMQwwCgYDVQQpEwNWUE4xEjAQBgkqhkiG9w0BCQEWA1ZQToIJAM8Brk2p
Ur0KMAwGA1UdEwQFMAMBAf8wDQYJKoZIhvcNAQEFBQADgYEAoB0kOuGvrzPBTIRX
IDHCCxBMdny+3sKAOllmH4+51j2aWhAJ4Pyc/yBTYyQGNoriABjmNzp+R05oiaxA
D3vTgR80juKDPtQb8LoGLBF18gL7Vtc3+hJXcJasXZaDSSoyh5f+TtGvytIT+ece
JWIrKnFXzlHOvKlyLkcZn15gwKQ=
-----END CERTIFICATE-----
# ls -l /lib/uci/upload/cbid.openvpn.SlickVPN.ca 
-rw-r--r--    1 root     root          1188 Dec 31 10:51 /lib/uci/upload/cbid.openvpn.SlickVPN.ca</code></pre></div><p>...and the auth_user_pass file exists....</p><div class="codebox"><pre><code># ls -l /etc/openvpn/slickvpn 
-r--r--r--    1 root  root         36 Dec 26 08:47 /etc/openvpn/slickvpn</code></pre></div><p>...but when trying to connect (via LuCi) I get the following error in the logs...</p><div class="codebox"><pre><code>Sat Jan  7 19:25:56 2017 daemon.notice openvpn(SlickVPN)[27200]: OpenVPN 2.3.6 arm-openwrt-linux-gnu [SSL (OpenSSL)] [LZO] [EPOLL] [MH] [IPv6] built on Jan 31 2016
Sat Jan  7 19:25:56 2017 daemon.notice openvpn(SlickVPN)[27200]: library versions: OpenSSL 1.0.2g  1 Mar 2016, LZO 2.08
Sat Jan  7 19:25:56 2017 daemon.err openvpn(SlickVPN)[27200]: ERROR: could not read Auth username from stdin
Sat Jan  7 19:25:56 2017 daemon.notice openvpn(SlickVPN)[27200]: Exiting due to fatal error</code></pre></div><p>Ok this is a permissions issue was my first thought so I changed read/write and owner:group but no joy...</p><div class="codebox"><pre><code># ls -l /etc/openvpn/slickvpn 
-rw-rw-r--    1 network  network         36 Dec 26 08:47 /etc/openvpn/slickvpn</code></pre></div><p>SlickVPN provide a <a href="https://www.slickvpn.com/tutorials/using-openvpn-configuration-files/">simple OpenVPN conf</a> that includes their certificate, so I decided to tweak that to point to the file with my username and password and try starting openvpn from the command line...</p><div class="codebox"><pre><code># cat /etc/openvpn/SlickVPN.conf 

# host/port of vpn server
remote gw1.mia4.slickvpn.com 8888

# file containing username and password
#auth-user-pass openvpn.userpass
# ... or prompt for authentication
auth-user-pass /etc/openvpn/slickvpn

# equivalent to pull, tls-client
client

# redirect all outgoing traffic to the vpn gateway
redirect-gateway

# verify the server certificate for authenticity
remote-cert-tls server

cipher AES-256-CBC

proto udp
dev tun
#keepalive 10 120
nobind

#persist-key
#persist-tun

# ssl certificate / key used for tls
#ca certs/ca.crt
#cert certs/client1.crt
#key certs/client1.key

&lt;ca&gt;
-----BEGIN CERTIFICATE-----
MIIDQDCCAqmgAwIBAgIJAM8Brk2pUr0KMA0GCSqGSIb3DQEBBQUAMHQxCzAJBgNV
BAYTAlVTMQswCQYDVQQIEwJDQTEMMAoGA1UEBxMDVlBOMQwwCgYDVQQKEwNWUE4x
DDAKBgNVBAsTA1ZQTjEMMAoGA1UEAxMDVlBOMQwwCgYDVQQpEwNWUE4xEjAQBgkq
hkiG9w0BCQEWA1ZQTjAeFw0xMjAzMDMwMjExNDJaFw0yMjAzMDEwMjExNDJaMHQx
CzAJBgNVBAYTAlVTMQswCQYDVQQIEwJDQTEMMAoGA1UEBxMDVlBOMQwwCgYDVQQK
EwNWUE4xDDAKBgNVBAsTA1ZQTjEMMAoGA1UEAxMDVlBOMQwwCgYDVQQpEwNWUE4x
EjAQBgkqhkiG9w0BCQEWA1ZQTjCBnzANBgkqhkiG9w0BAQEFAAOBjQAwgYkCgYEA
wY2K08N7or1Br/EsD9XBon7gs7dKflWYuymgMLJfeMFWuJloNdsn+3GARIhYBbN6
zhvFGFE214qKPqAydW1WmIIK7KoC0sgndr+Vk/au9gssFzVmmvr6+WN/nfo2L9Kv
vBMoYLrMAiyw/D4cRapZi2pXJLcMDfC+p1VWAX8TYWkCAwEAAaOB2TCB1jAdBgNV
HQ4EFgQUmyvO4rTnu5/ABnp0FngU+SdR8WAwgaYGA1UdIwSBnjCBm4AUmyvO4rTn
u5/ABnp0FngU+SdR8WCheKR2MHQxCzAJBgNVBAYTAlVTMQswCQYDVQQIEwJDQTEM
MAoGA1UEBxMDVlBOMQwwCgYDVQQKEwNWUE4xDDAKBgNVBAsTA1ZQTjEMMAoGA1UE
AxMDVlBOMQwwCgYDVQQpEwNWUE4xEjAQBgkqhkiG9w0BCQEWA1ZQToIJAM8Brk2p
Ur0KMAwGA1UdEwQFMAMBAf8wDQYJKoZIhvcNAQEFBQADgYEAoB0kOuGvrzPBTIRX
IDHCCxBMdny+3sKAOllmH4+51j2aWhAJ4Pyc/yBTYyQGNoriABjmNzp+R05oiaxA
D3vTgR80juKDPtQb8LoGLBF18gL7Vtc3+hJXcJasXZaDSSoyh5f+TtGvytIT+ece
JWIrKnFXzlHOvKlyLkcZn15gwKQ=
-----END CERTIFICATE-----
&lt;/ca&gt;</code></pre></div><p>Starting from the command line I can connect (although DNS isn&#039;t working, will sort that after I get a stable OpenVPN connection)...</p><div class="codebox"><pre><code># openvpn --config /etc/openvpn/SlickVPN.conf 
Sat Jan  7 19:35:33 2017 OpenVPN 2.3.6 arm-openwrt-linux-gnu [SSL (OpenSSL)] [LZO] [EPOLL] [MH] [IPv6] built on Jan 31 2016
Sat Jan  7 19:35:33 2017 library versions: OpenSSL 1.0.2g  1 Mar 2016, LZO 2.08
Sat Jan  7 19:35:33 2017 WARNING: file &#039;/etc/openvpn/slickvpn&#039; is group or others accessible
Sat Jan  7 19:35:33 2017 UDPv4 link local: [undef]
Sat Jan  7 19:35:33 2017 UDPv4 link remote: [AF_INET]45.58.127.234:8888
Sat Jan  7 19:35:33 2017 WARNING: this configuration may cache passwords in memory -- use the auth-nocache option to prevent this
Sat Jan  7 19:35:34 2017 [VPN] Peer Connection Initiated with [AF_INET]45.58.127.234:8888
Sat Jan  7 19:35:37 2017 TUN/TAP device tun0 opened
Sat Jan  7 19:35:37 2017 do_ifconfig, tt-&gt;ipv6=0, tt-&gt;did_ifconfig_ipv6_setup=0
Sat Jan  7 19:35:37 2017 /sbin/ifconfig tun0 10.10.6.42 pointopoint 10.10.6.41 mtu 1500
Sat Jan  7 19:35:37 2017 Initialization Sequence Completed
^CSat Jan  7 19:35:40 2017 event_wait : Interrupted system call (code=4)
Sat Jan  7 19:35:40 2017 /sbin/ifconfig tun0 0.0.0.0
Sat Jan  7 19:35:40 2017 SIGINT[hard,] received, process exiting</code></pre></div><p>The username and password are read, recognised and I can connect manually, but not through LuCi, so I don&#039;t think its a permission problem on the file but I can&#039;t think what the issue might be and was wondering if anyone has suggestions.&nbsp; Is it possible that its a problem with the ca file I uploaded?&nbsp; When starting manually its included in the conf file but I&#039;d expect the copy I uploaded via LuCi to be in the correct location with the correct permissions.</p><p>Thanks in advance,</p><p>slack</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p348717">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">webtron</div>
					<div class="post-datetime">
						8 Jan 2017, 01:38					</div>
				</div>
				<div class="post-content content">
					<p>I think you&#039;ll find it&#039;s a bug in Openvpn on CC. The trunk has an updated version that should work.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p348729">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">stangri</div>
					<div class="post-datetime">
						8 Jan 2017, 05:18					</div>
				</div>
				<div class="post-content content">
					<p>Remotes are defined as a list, not an option. your login/password file should be chmod 0400. You can just use your conf/ovpn file rather than configuring everything in the uci-compatible format.</p>											<p class="post-edited">(Last edited by <strong>stangri</strong> on 8 Jan 2017, 05:23)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p348738">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">slack---line</div>
					<div class="post-datetime">
						8 Jan 2017, 11:20					</div>
				</div>
				<div class="post-content content">
					<p>Thanks both.</p><p>Before I switch to trunk how stable is it?&nbsp; I&#039;ve now put this router in place and its the work-horse for the house and quite important to be stable.</p><p>I&#039;d like to keep the ability to start/stop OpenVPN available in LuCi as whilst I&#039;m fine sshing in and starting/stopping at the command line my wife (who insists on sticking to M$-Win and refusing to do anything at the CLI) needs to be able to toggle it on (until I suss out how to route certain sites around the VPN such as iPlayer and Netflix) and I&#039;ve just about convinced here she can start/stop it from LuCi.</p><p>Will sort out the remote configuration too, had been using LuCi again to add the URLs (since I&#039;m looking them up on SlickVPNs site anyway).</p>											<p class="post-edited">(Last edited by <strong>slack---line</strong> on 8 Jan 2017, 13:22)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p348816">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">stangri</div>
					<div class="post-datetime">
						9 Jan 2017, 06:04					</div>
				</div>
				<div class="post-content content">
					<p>There are 3 ways to use OpenVPN client in OpenWrt, one of them is to create the uci-configuration pointing to an ovpn file, that might be the best option for you if you&#039;re struggling with the full uci-based config.</p>											<p class="post-edited">(Last edited by <strong>stangri</strong> on 9 Jan 2017, 06:04)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p348943">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">slack---line</div>
					<div class="post-datetime">
						10 Jan 2017, 10:03					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>stangri wrote:</cite><blockquote><p>There are 3 ways to use OpenVPN client in OpenWrt, one of them is to create the uci-configuration pointing to an ovpn file, that might be the best option for you if you&#039;re struggling with the full uci-based config.</p></blockquote></div><br /><p>Ah, that sounds like it could be useful as I can connect manually from the command line (albeit with some strange DNS issues).&nbsp; Will look into this though, thanks for the pointer.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>