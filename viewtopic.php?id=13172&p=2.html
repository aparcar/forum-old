<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> iptables --set-mark not working....</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 12 Apr 2018 and 19 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 2 of 2</div><nav><ul><li><a href="viewtopic.php%3Fid=13172&amp;p=1.html">1</a></li><li class="pagination-current"><span>2</span></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p58266">
				<div class="post-metadata">
					<div class="post-num">Post #26</div>
					<div class="post-author">SirDodger</div>
					<div class="post-datetime">
						30 Oct 2007, 19:52					</div>
				</div>
				<div class="post-content content">
					<p>root@OpenWrt:~# ls -l /lib/modules/`uname -r`<br />-rw-r--r--&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp;327456 Sep 30 18:38 ath_hal.ko<br />-rw-r--r--&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp;131648 Sep 30 18:38 ath_pci.ko<br />-rw-r--r--&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; 15528 Sep 30 18:38 ath_rate_minstrel.ko<br />-rw-r--r--&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2572 Sep 29 07:39 crc-ccitt.ko<br />-rw-r--r--&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; 39608 Sep 29 07:38 diag.ko<br />-rw-r--r--&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3944 Sep 29 07:38 ipt_ECN.ko<br />-rw-r--r--&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; 10412 Sep 29 07:38 ipt_LOG.ko<br />-rw-r--r--&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3068 Sep 29 07:38 ipt_TOS.ko<br />-rw-r--r--&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3164 Sep 29 07:38 ipt_TTL.ko<br />-rw-r--r--&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3240 Sep 29 07:38 ipt_ecn.ko<br />-rw-r--r--&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; 13148 Sep 29 07:38 ipt_ipp2p.ko<br />-rw-r--r--&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; 19112 Sep 29 07:38 ipt_layer7.ko<br />-rw-r--r--&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2888 Sep 29 07:38 ipt_owner.ko<br />-rw-r--r--&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;4152 Sep 29 07:38 ipt_time.ko<br />-rw-r--r--&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2328 Sep 29 07:38 ipt_tos.ko<br />-rw-r--r--&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2816 Sep 29 07:38 ipt_ttl.ko<br />-rw-r--r--&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3872 Sep 29 07:38 iptable_raw.ko<br />-rw-r--r--&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; 16856 Sep 29 07:39 ppp_async.ko<br />-rw-r--r--&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; 34948 Sep 29 07:39 ppp_generic.ko<br />-rw-r--r--&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; 18456 Sep 29 07:39 pppoe.ko<br />-rw-r--r--&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;4448 Sep 29 07:39 pppox.ko<br />-rw-r--r--&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;8504 Sep 29 07:39 slhc.ko<br />-rw-r--r--&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; 15076 Sep 29 07:40 switch-adm.ko<br />-rw-r--r--&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; 10272 Sep 29 07:40 switch-core.ko<br />-rw-r--r--&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;9996 Sep 29 07:40 switch-robo.ko<br />-rw-r--r--&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; 13532 Sep 29 07:39 tun.ko<br />-rw-r--r--&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp;220076 Sep 30 18:38 wlan.ko<br />-rw-r--r--&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5252 Sep 30 18:38 wlan_acl.ko<br />-rw-r--r--&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;9672 Sep 30 18:38 wlan_ccmp.ko<br />-rw-r--r--&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;6388 Sep 30 18:38 wlan_scan_ap.ko<br />-rw-r--r--&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; 15064 Sep 30 18:38 wlan_scan_sta.ko<br />-rw-r--r--&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; 14116 Sep 30 18:38 wlan_tkip.ko<br />-rw-r--r--&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;7476 Sep 30 18:38 wlan_wep.ko<br />-rw-r--r--&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2532 Sep 30 18:38 wlan_xauth.ko<br />-rw-r--r--&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;6388 Sep 29 07:38 xt_CHAOS.ko<br />-rw-r--r--&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2656 Sep 29 07:38 xt_CLASSIFY.ko<br />-rw-r--r--&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5628 Sep 29 07:38 xt_DELUDE.ko<br />-rw-r--r--&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3452 Sep 29 07:38 xt_DSCP.ko<br />-rw-r--r--&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3320 Sep 29 07:38 xt_MARK.ko<br />-rw-r--r--&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3080 Sep 29 07:38 xt_dscp.ko<br />-rw-r--r--&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2764 Sep 29 07:38 xt_length.ko<br />-rw-r--r--&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2724 Sep 29 07:38 xt_mac.ko<br />-rw-r--r--&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2684 Sep 29 07:38 xt_mark.ko<br />-rw-r--r--&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2752 Sep 29 07:38 xt_pkttype.ko<br />-rw-r--r--&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;8084 Sep 29 07:38 xt_portscan.ko<br />-rw-r--r--&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3244 Sep 29 07:38 xt_string.ko</p><br /><br /><p>xt_mark is not responsible ??</p><p>where do i get the missing ipt_mark ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p58322">
				<div class="post-metadata">
					<div class="post-num">Post #27</div>
					<div class="post-author">SirDodger</div>
					<div class="post-datetime">
						31 Oct 2007, 19:55					</div>
				</div>
				<div class="post-content content">
					<p>anyone ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p58333">
				<div class="post-metadata">
					<div class="post-num">Post #28</div>
					<div class="post-author">nicolasb</div>
					<div class="post-datetime">
						31 Oct 2007, 23:33					</div>
				</div>
				<div class="post-content content">
					<p>you need both the userspace and the kernel space module</p><p>userspace: libipt_MARK.so&nbsp; (iptables command line module)<br />kernelspace: xt_MARK.ko&nbsp; &nbsp;(kernel module that play with packets)</p><p>on a normal linux box, you need to recompile iptables and your kernel to add those modules. On Kamakaze I don&#039;t know if there is another way.</p><p>you could join irc.freenode.org #openwrt (irc server) to talk live with people</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p58349">
				<div class="post-metadata">
					<div class="post-num">Post #29</div>
					<div class="post-author">SirDodger</div>
					<div class="post-datetime">
						1 Nov 2007, 10:14					</div>
				</div>
				<div class="post-content content">
					<p>problem is , this is a fresh !! 7.09 installation</p><p>root@OpenWrt:/usr/lib/iptables# ls<br />libipt_CHAOS.so&nbsp; &nbsp; &nbsp; &nbsp;libipt_TCPMSS.so&nbsp; &nbsp; &nbsp; libipt_pkttype.so<br />libipt_DELUDE.so&nbsp; &nbsp; &nbsp; libipt_conntrack.so&nbsp; &nbsp;libipt_portscan.so<br />libipt_DNAT.so&nbsp; &nbsp; &nbsp; &nbsp; libipt_icmp.so&nbsp; &nbsp; &nbsp; &nbsp; libipt_standard.so<br />libipt_LOG.so&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;libipt_ipp2p.so&nbsp; &nbsp; &nbsp; &nbsp;libipt_state.so<br />libipt_MASQUERADE.so&nbsp; libipt_layer7.so&nbsp; &nbsp; &nbsp; libipt_string.so<br />libipt_REDIRECT.so&nbsp; &nbsp; libipt_limit.so&nbsp; &nbsp; &nbsp; &nbsp;libipt_tcp.so<br />libipt_REJECT.so&nbsp; &nbsp; &nbsp; libipt_multiport.so&nbsp; &nbsp;libipt_tcpmss.so<br />libipt_SNAT.so&nbsp; &nbsp; &nbsp; &nbsp; libipt_owner.so&nbsp; &nbsp; &nbsp; &nbsp;libipt_udp.so</p><br /><p>im lacking libipt_MARK</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p58471">
				<div class="post-metadata">
					<div class="post-num">Post #30</div>
					<div class="post-author">whbjr</div>
					<div class="post-datetime">
						4 Nov 2007, 03:35					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>SirDodger wrote:</cite><blockquote><p>problem is , this is a fresh !! 7.09 installation</p></blockquote></div><p>Correct - what you want is the &quot;iptables-mod-ipopt&quot; package.&nbsp; Here&#039;s what I&#039;ve got on my Netgear WGT634U:<br /></p><div class="codebox"><pre><code># uname -a
Linux otros 2.6.22 #2 Sun Sep 30 20:38:47 CEST 2007 mips unknown
# ipkg files iptables-mod-ipopt
Package iptables-mod-ipopt (1.3.7-1) is installed on root and has the following
files:
/usr/lib/iptables/libipt_mark.so
/usr/lib/iptables/libipt_CLASSIFY.so
/usr/lib/iptables/libipt_TOS.so
/usr/lib/iptables/libipt_ECN.so
/usr/lib/iptables/libipt_MARK.so   *****
/usr/lib/iptables/libipt_DSCP.so
/usr/lib/iptables/libipt_dscp.so
/usr/lib/iptables/libipt_ttl.so
/usr/lib/iptables/libipt_mac.so
/usr/lib/iptables/libipt_TTL.so
/usr/lib/iptables/libipt_tos.so
/usr/lib/iptables
/usr/lib/iptables/libipt_length.so
/usr/lib/iptables/libipt_ecn.so

Done.</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p118173">
				<div class="post-metadata">
					<div class="post-num">Post #31</div>
					<div class="post-author">rorus</div>
					<div class="post-datetime">
						30 Sep 2010, 16:25					</div>
				</div>
				<div class="post-content content">
					<p>For anyone else who had this problem - I installed iptables-mod-conntrack-extra and now it works.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p122646">
				<div class="post-metadata">
					<div class="post-num">Post #32</div>
					<div class="post-author">sfinktah</div>
					<div class="post-datetime">
						5 Dec 2010, 11:13					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>rorus wrote:</cite><blockquote><p>For anyone else who had this problem - I installed iptables-mod-conntrack-extra and now it works.</p></blockquote></div><p>Errr, no... what you want is what the poster above said: <strong>iptables-mod-ipopt</strong></p><div class="codebox"><pre><code>iptables -A OUTPUT -p tcp -m multiport --dports 25 -j MARK --set-mark 0x1
iptables v1.4.6: unknown option `--set-mark&#039;
Try `iptables -h&#039; or &#039;iptables --help&#039; for more information.

root@OpenWrt:/etc/iproute2# opkg install iptables-mod-ipopt

Installing iptables-mod-ipopt (1.4.6-2) to root...
Downloading http://downloads.openwrt.org/backfire/10.03/ar71xx/packages/iptables-mod-ipopt_1.4.6-2_ar71xx.ipk.
Installing kmod-ipt-ipopt (2.6.32.10-1) to root...
Downloading http://downloads.openwrt.org/backfire/10.03/ar71xx/packages/kmod-ipt-ipopt_2.6.32.10-1_ar71xx.ipk.
Configuring kmod-ipt-ipopt.
Configuring iptables-mod-ipopt.

root@OpenWrt:/etc/iproute2# !ip
iptables -A OUTPUT -p tcp -m multiport --dports 25 -j MARK --set-mark 0x1
root@OpenWrt:/etc/iproute2#</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p123560">
				<div class="post-metadata">
					<div class="post-num">Post #33</div>
					<div class="post-author">Orca</div>
					<div class="post-datetime">
						20 Dec 2010, 13:04					</div>
				</div>
				<div class="post-content content">
					<p>Thx.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 2 of 2</div><nav><ul><li><a href="viewtopic.php%3Fid=13172&amp;p=1.html">1</a></li><li class="pagination-current"><span>2</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>