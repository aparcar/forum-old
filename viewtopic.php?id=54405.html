<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> How to use usb-chipidea and usb-gadget</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 28 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p256597">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">c96138</div>
					<div class="post-datetime">
						5 Dec 2014, 04:18					</div>
				</div>
				<div class="post-content content">
					<p>Hello,Every one:</p><p>I want to use openwrt[ar9331 tp703n] as a PC device,PC will visit openwrt through USB.<br />I guess that usb-chipidea and usb-gadget should be used.<br />I use usb-chipidea and usb-gadget [ BARRIER BREAKER ],but no success!</p><br /><br /><br /><p>Pls tell me how to use usb-chipidea and usb-gadget ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p256608">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">c96138</div>
					<div class="post-datetime">
						5 Dec 2014, 07:10					</div>
				</div>
				<div class="post-content content">
					<p>When I input &quot;insmod g_ether&quot; ,it echo : &quot;failed to insert /lib/modules/3.10.49/g_ether.ko&quot;</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p256613">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">c96138</div>
					<div class="post-datetime">
						5 Dec 2014, 08:32					</div>
				</div>
				<div class="post-content content">
					<p>As a beginner,I dont know if this is a bug of BB version.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p256681">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">c96138</div>
					<div class="post-datetime">
						5 Dec 2014, 20:55					</div>
				</div>
				<div class="post-content content">
					<p>There is non answer.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p256696">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">st2000</div>
					<div class="post-datetime">
						5 Dec 2014, 22:25					</div>
				</div>
				<div class="post-content content">
					<p>You sure about how you are going about this?&nbsp; When I used g_ether on a Linux computer it was to create a USB Device that supported Ethenet over USB.&nbsp; The USB ports on most routers are setup to be USB Host.&nbsp; That is, setup to host a USB Device like a USB Thumb Drive.&nbsp; I might be wrong, but I&#039;m thinking that is a problem.&nbsp; The physical port on the Linux computer I was running g_ether on was an OTG USB port.&nbsp; That may have been why it worked.&nbsp; OTG USB ports can be configured as either Host or Device. Does anyone know for sure?</p>											<p class="post-edited">(Last edited by <strong>st2000</strong> on 5 Dec 2014, 22:29)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p256885">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">c96138</div>
					<div class="post-datetime">
						7 Dec 2014, 17:25					</div>
				</div>
				<div class="post-content content">
					<p>Thanks st2000 for reply.</p><p>0.<br />The ar9331 datasheet writes its usb&nbsp; mode can be host or device mode.</p><p>1.<br />In BARRIER BREAKER (14.07),we can find the option :kernel-&gt;usb support-&gt;usb chipidea.<br />Maybe The module of usb chipidea is related to setting the ar9331 usb device mode.</p><p>What is usb chipidea? how to use the module? Hope&nbsp; information about usb chipidea.</p><p>2.In BARRIER BREAKER (14.07),the option of usb-gadget is hidden ,can&#039;t be selectable.<br />Searching internet, usb-gadget is driver for usb device mode.<br />but In BARRIER BREAKER,we can&#039;t active it.</p><p>3.I have changed th usb.mk file, the option of usb-gadget appeared and executed &#039;make&#039; successfully.but insmod g_ether ,it show â€˜fail to insert g_ether.ko&#039;.</p><p>but now I execute &#039;make&#039;,it shows errors about usb-gadget ,such as:miss depend udc-core.ko&nbsp; configfs.ko&nbsp; &nbsp;...etc.So strange!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p256897">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">mk24</div>
					<div class="post-datetime">
						7 Dec 2014, 19:28					</div>
				</div>
				<div class="post-content content">
					<p>A full implementation of OTG uses a hardware pin to select host or device mode.&nbsp; The special OTG socket found on smartphones detects which kind of cable the user has plugged in and signals the SoC accordingly.&nbsp; It is likely that in a router the pin is permanently tied to ground to make it always run as host.</p><p>So the first hurdle to overcome is to bypass this mechanism and convince dwg-otg to want to be a device instead of a host.</p><p>Then you need udc-core because it is an essential software layer between the hardware and higher level device functions like ether.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p256901">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">c96138</div>
					<div class="post-datetime">
						7 Dec 2014, 20:44					</div>
				</div>
				<div class="post-content content">
					<p><span class="postimg"><img src="http://localhost/err.png" alt="PunBB bbcode test" /></span></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p256902">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">c96138</div>
					<div class="post-datetime">
						7 Dec 2014, 20:47					</div>
				</div>
				<div class="post-content content">
					<p>1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Thecorresponding pin had been tied to the device mode.<br />2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;The above image is for the probelm: &#039;fail to insert g_ether&#039;.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p256930">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">c96138</div>
					<div class="post-datetime">
						8 Dec 2014, 05:26					</div>
				</div>
				<div class="post-content content">
					<p>Trace the code,I find the &#039;udc_list&#039; is empty.No udc.<br />Why the driver &#039;ci_hdrc&#039; does not execute its &#039;probe&#039; function ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p364722">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">adron</div>
					<div class="post-datetime">
						1 Sep 2017, 07:44					</div>
				</div>
				<div class="post-content content">
					<p>Let&#039;s raise the subject. I made a USB DEVICE mode support for GL.iNet GL-AR300M-Lite.<br />More details is available here: <a href="https://github.com/adron-s/QCA953x-usb-device-mode">https://github.com/adron-s/QCA953x-usb-device-mode</a></p>											<p class="post-edited">(Last edited by <strong>adron</strong> on 1 Sep 2017, 07:45)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>