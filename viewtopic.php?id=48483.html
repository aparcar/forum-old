<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> WZR-300HP [B0A1] revert to factory via U-BOOT</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 28 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p222998">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">sprucie</div>
					<div class="post-datetime">
						17 Jan 2014, 17:29					</div>
				</div>
				<div class="post-content content">
					<p>I am attaching via serial to a WZR-300HP and trying to stick the factory image back on, filename: Professional_v24sp2-19438.enc</p><p>U-BOOT startup:<br /></p><div class="codebox"><pre><code>BUFFALO U-BOOT Ver 1.08
  == CPU:400MHz, DDR:400MHz, AHB:200MHz ==
PB93 (ar7241 - Virian) U-boot
DRAM:  64 MB
WAN port disabling: done
Top of RAM usable for U-Boot at: 84000000
Reserving 266k for U-Boot at: 83fbc000
Reserving 192k for malloc() at: 83f8c000
Reserving 44 Bytes for Board Info at: 83f8bfd4
Reserving 36 Bytes for Global Data at: 83f8bfb0
Reserving 128k for boot params() at: 83f6bfb0
Stack Pointer at: 83f6bf98
Now running in RAM - U-Boot at: 83fbc000
flash bank #0 found 16 MB flash [MX25L128-45E, blk:0x10000, sectors:256]                                                                                                                                                                                                     
flash bank #1 found 16 MB flash [MX25L128-45E, blk:0x10000, sectors:256]                                                                                                                                                                                                     
Flash: 32 MB                                                                                                                                                                                                                                                                 
In:    serial                                                                                                                                                                                                                                                                
Out:   serial                                                                                                                                                                                                                                                                
Err:   serial                                                                                                                                                                                                                                                                
Memory Test                                                                                                                                                                                                                                                                  
uboot use  83F6BFB0 - 84000000                                                                                                                                                                                                                                               
Memory Test start(80000000) end(83F00000) size(03F00000)                                                                                                                                                                                                                     
Pattern 00000000  Writing...  Reading...                                                                                                                                                                                                                                     
Memory Test OK                                                                                                                                                                                                                                                               
### buf_ver=[1.08] U-Boot Ver.=[1.08]                                                                                                                                                                                                                                        
### build_date(env)=[Sep 26 2011 - 00:19:46] build_date(bin)=[Sep 26 2011 - 00:19:46]                                                                                                                                                                                        
ag7240_enet_initialize...                                                                                                                                                                                                                                                    
Reading MAC Address from ENV(0x83f8c2ef)                                                                                                                                                                                                                                     
No valid address in Flash. Using fixed address                                                                                                                                                                                                                               
Virian MDC CFG Value ==&gt; 4                                                                                                                                                                                                                                                   
: cfg1 0x7 cfg2 0x7014                                                                                                                                                                                                                                                       
eth0: 02:aa:bb:cc:dd:1a                                                                                                                                                                                                                                                      
eth0 up                                                                                                                                                                                                                                                                      
Virian MDC CFG Value ==&gt; 4                                                                                                                                                                                                                                                   
: cfg1 0xf cfg2 0x7214                                                                                                                                                                                                                                                       
eth1: 00:03:7f:09:0b:ad                                                                                                                                                                                                                                                      
ATHRS26: resetting s26                                                                                                                                                                                                                                                       
ATHRS26: s26 reset done                                                                                                                                                                                                                                                      
eth1 up                                                                                                                                                                                                                                                                      
eth0  02:AA:BB:CC:DD:1A                                                                                                                                                                                                                                                      
, eth1  00:03:7F:09:0B:AD                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                             
eth0 link down                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                             
tftp server(receive) go, waiting:4[sec]                                                                                                                                                                                                                                      
dup 1 speed 1000                                                                                                                                                                                                                                                             
Load address: 0x81f00000                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                                             
Abort                                                                                                                                                                                                                                                                        
no file was loaded.                                                                                                                                                                                                                                                          
ar7240&gt;</code></pre></div><p>I then try to tftpboot the image:<br /></p><div class="codebox"><pre><code>ar7240&gt; tftpboot 81f00000 Professional_v24sp2-19438.enc
Using eth0 device
TFTP from server 192.168.11.2; our IP address is 192.168.11.1
Filename &#039;Professional_v24sp2-19438.enc&#039;.
Load address: 0x81f00000
Loading: #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         ##########################################
done
Bytes transferred = 13525240 (ce60f8 hex)
ar7240&gt; </code></pre></div><p>When I try to run iminfo I get:<br /></p><div class="codebox"><pre><code>ar7240&gt; iminfo

## Checking Image at 81f00000 ...
   Bad Magic Number
ar7240&gt; </code></pre></div><p>The magic number I think is: 27 05 19 56<br />and I have put that in front via hex editor, but then that complains:<br /></p><div class="codebox"><pre><code>ar7240&gt; iminfo

## Checking Image at 81f00000 ...
   Bad Header Checksum
ar7240&gt;</code></pre></div><p>Not quite sure how to resolve this, any help is appreciated, thanks.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p223773">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">beckolamuffin</div>
					<div class="post-datetime">
						26 Jan 2014, 04:39					</div>
				</div>
				<div class="post-content content">
					<p>I haven&#039;t used the ar7240&gt; prompt yet, but maybe try sending the image via tftp down to the router?&nbsp; See the other thread regarding WZR-300HP for possible ideas.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>