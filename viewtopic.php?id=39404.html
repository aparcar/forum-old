<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> [LuCI] Making GUI for mwan3 multiwan package</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 1 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p178312">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						16 Sep 2012, 00:42					</div>
				</div>
				<div class="post-content content">
					<p>The GUI is now a package which may be downloaded with mwan3. View the main mwan3 topic to download:<br /><a href="https://forum.openwrt.org/viewtopic.php?id=39052&amp;p=1">https://forum.openwrt.org/viewtopic.php … 52&amp;p=1</a></p><p>old post:<br /></p><div class="quotebox"><blockquote><p>My mwan3 LuCI page worklog is here. My issues are now resolved and I am finishing the status page which will have a real-time interface status tab, troubleshooting tab and instructions tab. This should be in version 1.4</p><p>Version 1.3.1:<br />link removed</p><p>Screenshots:<br /><a href="http://imageshack.us/a/img96/7404/rulesconfig.png">http://imageshack.us/a/img96/7404/rulesconfig.png</a><br /><a href="http://imageshack.us/a/img210/8463/rulesxz.png">http://imageshack.us/a/img210/8463/rulesxz.png</a><br /><a href="http://imageshack.us/a/img822/2214/policiesconfig.png">http://imageshack.us/a/img822/2214/policiesconfig.png</a><br /><a href="http://imageshack.us/a/img193/9592/policies.png">http://imageshack.us/a/img193/9592/policies.png</a><br /><a href="http://imageshack.us/a/img13/1345/membersconfig.png">http://imageshack.us/a/img13/1345/membersconfig.png</a><br /><a href="http://imageshack.us/a/img715/49/memberswj.png">http://imageshack.us/a/img715/49/memberswj.png</a><br /><a href="http://imageshack.us/a/img38/905/interfacesconfig.png">http://imageshack.us/a/img38/905/interfacesconfig.png</a><br /><a href="http://imageshack.us/a/img210/4857/interfaces.png">http://imageshack.us/a/img210/4857/interfaces.png</a></p><p>Changelog:<br />1.3.1<br /></p><div class="quotebox"><blockquote><p>1. Fixed bug where adding an interface without a test IP or adding a policy without a member would cause the pages to error</p></blockquote></div><p>1.3.0<br /></p><div class="quotebox"><blockquote><p>1. Fixed duplicate entry name in policy configuration page so values save correctly<br />2. Policies page now shows &quot;Members assigned&quot; rather than &quot;use_member&quot;</p></blockquote></div><p>HELP NEEDED:<br />1. I&#039;m trying to find a way if possible to have a dropdown that displays the names of config sections. For example on the policies edit page I would like to have a dropdown that lets you select from the names of members. Haven&#039;t been having any luck finding a way to do this and I don&#039;t even know if it&#039;s really possible. LMK if you have a solution!</p><p>old issues:</p><p>1. [Fixed] <a href="https://forum.openwrt.org/viewtopic.php?pid=178679#p178679">https://forum.openwrt.org/viewtopic.php … 79#p178679</a><br /></p><div class="quotebox"><blockquote><p>The issue is when I type in a name for any of the 4 sections and click Add to make the entry I get the below error. If you click back you see that it added the entry and you can then edit it but I need it to take you to the edit page when you click Add. If anyone could shed some light on this one piece I can take it from there and finish what I need to do.</p><p>You will find the tab on Network-&gt;Multiwan</p><div class="codebox"><pre><code>/usr/lib/lua/luci/dispatcher.lua:448: Failed to execute function dispatcher target for entry &#039;/admin/network/multiwan&#039;.
The called action terminated with an exception:
/usr/lib/lua/luci/dispatcher.lua:448: Failed to execute arcombine dispatcher target for entry &#039;/admin/network/multiwan/rule&#039;.
The called action terminated with an exception:
/usr/lib/lua/luci/dispatcher.lua:67: attempt to index local &#039;p&#039; (a boolean value)
stack traceback:
    [C]: in function &#039;assert&#039;
    /usr/lib/lua/luci/dispatcher.lua:448: in function &#039;dispatch&#039;
    /usr/lib/lua/luci/dispatcher.lua:195: in function &lt;/usr/lib/lua/luci/dispatcher.lua:194&gt;</code></pre></div></blockquote></div><p>2. [Fixed] <a href="https://forum.openwrt.org/viewtopic.php?pid=178902#p178902">https://forum.openwrt.org/viewtopic.php … 02#p178902</a><br /></p><div class="quotebox"><blockquote><p>mwan3 changed the track_ip option to be a list option so there could be more than one.</p><p>I&#039;ve been messing with the lua code and with the below section on mwan_interface.lua it now displays the multiple test IPs but they are all on one line separated by a space and I can&#039;t figure out how to put in a new line so they are each on their own line. Any help would be appreciated.</p><div class="codebox"><pre><code>track_ip = mwan_interface:option(DummyValue, &quot;track_ip&quot;, translate(&quot;Test IP&quot;))                
function track_ip.cfgvalue(self, s)                                            
        local str = &quot;&quot;                                                         
        local tab = self.map:get(s, &quot;track_ip&quot;)                                
        for k,v in pairs(tab) do                                            
                str = str .. v .. &quot;\n&quot;                                      
        end                                                                 
        return str                                                          
end</code></pre></div></blockquote></div></blockquote></div>											<p class="post-edited">(Last edited by <strong>arfett</strong> on 15 Apr 2013, 09:11)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p178515">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">LaySoft</div>
					<div class="post-datetime">
						17 Sep 2012, 18:06					</div>
				</div>
				<div class="post-content content">
					<p>I mean the problem is in the create function, because i comment out the &#039;luci.http.redirect...&#039; line in the mwan_rule.lua script, and the error disappeared. But not opens the newly created rule...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p178621">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						18 Sep 2012, 15:34					</div>
				</div>
				<div class="post-content content">
					<p>The create() function must return the name of the newly created section. So simply replace the &quot;return&quot; with &quot;return created&quot;.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p178665">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						18 Sep 2012, 21:54					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>jow wrote:</cite><blockquote><p>The create() function must return the name of the newly created section. So simply replace the &quot;return&quot; with &quot;return created&quot;.</p></blockquote></div><div class="codebox"><pre><code>function mwan_interface.create(self, section)
    local created = TypedSection.create(self, section)
    m30.uci:save(&quot;mwan3&quot;)
    luci.http.redirect(ds.build_url(&quot;admin&quot;, &quot;network&quot;, &quot;multiwan&quot;, &quot;interface&quot;, created))
    return created
end</code></pre></div><p>Is this what you mean? It still shows the same error.</p><p>Thanks for the assistance.</p>											<p class="post-edited">(Last edited by <strong>arfett</strong> on 18 Sep 2012, 22:06)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p178679">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						19 Sep 2012, 00:27					</div>
				</div>
				<div class="post-content content">
					<p>Ok so the issue is as follows: if you pass a section name to TypedSection.create() it does not return the name of the new section (which is guaranteed to be the one you passed in) but a boolean which indicates whether the creation was successful (it could for example fail if something with the same name already exists).</p><p>The error quoted above happens when a boolean or numeric value is passed to build_url() instead of a string.<br />To solve the problem you should rewrite your create callback as shown below:</p><div class="codebox"><pre><code>function mwan_interface.create(self, section)
    if TypedSection.create(self, section) then
        m30.uci:save(&quot;mwan3&quot;)
        luci.http.redirect(ds.build_url(&quot;admin&quot;, &quot;network&quot;, &quot;multiwan&quot;, &quot;interface&quot;, section))
        return true
    else
        m30.message = translatef(&quot;There already is a section named %q&quot;, section)
        return false
    end
end</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p178689">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						19 Sep 2012, 02:25					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>jow wrote:</cite><blockquote><p>Ok so the issue is as follows: if you pass a section name to TypedSection.create() it does not return the name of the new section (which is guaranteed to be the one you passed in) but a boolean which indicates whether the creation was successful (it could for example fail if something with the same name already exists).</p><p>The error quoted above happens when a boolean or numeric value is passed to build_url() instead of a string.<br />To solve the problem you should rewrite your create callback as shown below:</p></blockquote></div><p>Thanks jow. That if/else function doesn&#039;t just limit it to that type of config. For example if there was an interface section named wan2 you can not add a member named wan2. Is there any way to have the duplicate checking only apply to that config type?</p>											<p class="post-edited">(Last edited by <strong>arfett</strong> on 19 Sep 2012, 02:25)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p178734">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						19 Sep 2012, 13:28					</div>
				</div>
				<div class="post-content content">
					<p>No, its uci limitation. You cannot have two sections of the same name - even if they&#039;re of different types. Names must be globally unique.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p178781">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						19 Sep 2012, 20:46					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>jow wrote:</cite><blockquote><p>No, its uci limitation. You cannot have two sections of the same name - even if they&#039;re of different types. Names must be globally unique.</p></blockquote></div><p>Got it.</p><p>Only other thing is that when you try to add a section with a duplicate name it doesn&#039;t show &quot;There is already an entry named %q&quot; anywhere on the page. I thought maybe there was a typo with &quot;translatef&quot; but it doesn&#039;t work as &quot;translate&quot; either. I&#039;m not nearly skilled enough to know how to fix that.</p>											<p class="post-edited">(Last edited by <strong>arfett</strong> on 20 Sep 2012, 20:06)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p178902">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						20 Sep 2012, 23:30					</div>
				</div>
				<div class="post-content content">
					<p>Issue 2 fixed with:</p><p>track_ip = mwan_interface:option(DummyValue, &quot;track_ip&quot;, translate(&quot;Test IP&quot;))<br />track_ip.rawhtml = true&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />function track_ip.cfgvalue(self, s)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; local str = &quot;&quot;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; local tab = self.map:get(s, &quot;track_ip&quot;)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; for k,v in pairs(tab) do&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; str = str .. v .. &quot;&lt;br /&gt;&quot;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; end&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; return str&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />end</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p179133">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">Sorbe</div>
					<div class="post-datetime">
						23 Sep 2012, 19:35					</div>
				</div>
				<div class="post-content content">
					<p>Hmm...&nbsp; Can you also make the &quot;Status | Overview | Network&quot; section show &quot;IPv4 WAN Status&quot; for each active MWAN connection?&nbsp; Currently, I only see one connection on this key status page even though multiple MWAN connections are active.</p><p>One other thing: I would recommend making it very easy to setup a router with 1 LAN port(old WAN) and 4 WAN ports.&nbsp; This configuration should be a very common one.&nbsp; &nbsp;Then you can hook up any number (up to 4) WAN modems and the LAN port to your switch.</p>											<p class="post-edited">(Last edited by <strong>Sorbe</strong> on 23 Sep 2012, 19:41)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p179250">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						24 Sep 2012, 21:14					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Sorbe wrote:</cite><blockquote><p>Hmm...&nbsp; Can you also make the &quot;Status | Overview | Network&quot; section show &quot;IPv4 WAN Status&quot; for each active MWAN connection?&nbsp; Currently, I only see one connection on this key status page even though multiple MWAN connections are active.</p><p>One other thing: I would recommend making it very easy to setup a router with 1 LAN port(old WAN) and 4 WAN ports.&nbsp; This configuration should be a very common one.&nbsp; &nbsp;Then you can hook up any number (up to 4) WAN modems and the LAN port to your switch.</p></blockquote></div><p>I will see if we can do that. I currently have our intern who is better at HTML than I assisting with the status page. As far as the configuration goes you should bring this up in the mwan3 thread here: <a href="https://forum.openwrt.org/viewtopic.php?id=39052&amp;p=1">https://forum.openwrt.org/viewtopic.php … 52&amp;p=1</a></p><p>While I am helping Adze work on this project with the GUI and some script files he is the main guy for mwan3.</p>											<p class="post-edited">(Last edited by <strong>arfett</strong> on 24 Sep 2012, 21:14)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p215603">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">rl608742063</div>
					<div class="post-datetime">
						24 Oct 2013, 22:34					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>I tried to install luci-mwan3 and I can not see it on luci web interface it not exists in opkg install packages.<br />How to install your mwan3 in the luci package ?</p><p>Regards,<br />RL</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>