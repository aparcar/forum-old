<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Init my 5GHz band failed,AR9582 eeprom_init error in compat-wireless..</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 17 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p189593">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">banglang.huang</div>
					<div class="post-datetime">
						22 Jan 2013, 06:40					</div>
				</div>
				<div class="post-content content">
					<p>below is the kernel log.<br /><span style="color: #FF0000">My testbed is DB120 reference borad, of cause it is dual-band.But there is only One works.<br />AR9344+AR8035PHY+AR9580...</span></p><br /><br /><p>## Booting image at 81000000 ...<br />&nbsp; &nbsp;Image Name:&nbsp; &nbsp;MIPS OpenWrt Linux-3.3.8<br />&nbsp; &nbsp;Created:&nbsp; &nbsp; &nbsp; 2013-01-15&nbsp; &nbsp;6:40:58 UTC<br />&nbsp; &nbsp;Image Type:&nbsp; &nbsp;MIPS Linux Kernel Image (lzma compressed)<br />&nbsp; &nbsp;Data Size:&nbsp; &nbsp; 3237612 Bytes =&nbsp; 3.1 MB<br />&nbsp; &nbsp;Load Address: 80060000<br />&nbsp; &nbsp;Entry Point:&nbsp; 80060000<br />&nbsp; &nbsp;Verifying Checksum at 0x81000040 ...OK<br />&nbsp; &nbsp;Uncompressing Kernel Image ... OK<br />No initrd<br />## Transferring control to Linux (at address 80060000) ...<br />## Giving linux memsize in bytes, 134217728</p><p>Starting kernel ...</p><p>[&nbsp; &nbsp; 0.000000] Linux version 3.3.8 (banglang@banglang) (gcc version 4.6.4 20121001 (prerelease) (Linaro GCC 4.6-2012.10) ) #74 Tue Jan 15 14:40:43 HKT 2013<br />[&nbsp; &nbsp; 0.000000] bootconsole [early0] enabled<br />[&nbsp; &nbsp; 0.000000] CPU revision is: 0001974c (MIPS 74Kc)<br />[&nbsp; &nbsp; 0.000000] SoC: Atheros AR9344 rev 2<br />[&nbsp; &nbsp; 0.000000] Clocks: CPU:532.500MHz, DDR:400.000MHz, AHB:200.000MHz, Ref:40.000MHz<br />[&nbsp; &nbsp; 0.000000] Determined physical RAM map:<br />[&nbsp; &nbsp; 0.000000]&nbsp; memory: 08000000 @ 00000000 (usable)<br />[&nbsp; &nbsp; 0.000000] Initrd not found or empty - disabling initrd<br />[&nbsp; &nbsp; 0.000000] Zone PFN ranges:<br />[&nbsp; &nbsp; 0.000000]&nbsp; &nbsp;Normal&nbsp; &nbsp;0x00000000 -&gt; 0x00008000<br />[&nbsp; &nbsp; 0.000000] Movable zone start PFN for each node<br />[&nbsp; &nbsp; 0.000000] Early memory PFN ranges<br />[&nbsp; &nbsp; 0.000000]&nbsp; &nbsp; &nbsp;0: 0x00000000 -&gt; 0x00008000<br />[&nbsp; &nbsp; 0.000000] Built 1 zonelists in Zone order, mobility grouping on.&nbsp; Total pages: 32512<br />[&nbsp; &nbsp; 0.000000] Kernel command line:&nbsp; board=DB120 console=ttyS0,115200 mtdparts=spi0.0:256k(u-boot)ro,64k(u-boot-env)ro,6336k(rootfs),1408k(kernel),64k(nvram),64k(art)ro,7744k@0x50000(firmware) rootfstype=squashfs,jffs2 noinitrd<br />[&nbsp; &nbsp; 0.000000] PID hash table entries: 512 (order: -1, 2048 bytes)<br />[&nbsp; &nbsp; 0.000000] Dentry cache hash table entries: 16384 (order: 4, 65536 bytes)<br />[&nbsp; &nbsp; 0.000000] Inode-cache hash table entries: 8192 (order: 3, 32768 bytes)<br />[&nbsp; &nbsp; 0.000000] Primary instruction cache 64kB, VIPT, 4-way, linesize 32 bytes.<br />[&nbsp; &nbsp; 0.000000] Primary data cache 32kB, 4-way, VIPT, cache aliases, linesize 32 bytes<br />[&nbsp; &nbsp; 0.000000] Writing ErrCtl register=00000000<br />[&nbsp; &nbsp; 0.000000] Readback ErrCtl register=00000000<br />[&nbsp; &nbsp; 0.000000] Memory: 124372k/131072k available (2089k kernel code, 6700k reserved, 400k data, 2448k init, 0k highmem)<br />[&nbsp; &nbsp; 0.000000] SLUB: Genslabs=9, HWalign=32, Order=0-3, MinObjects=0, CPUs=1, Nodes=1<br />[&nbsp; &nbsp; 0.000000] NR_IRQS:51<br />[&nbsp; &nbsp; 0.000000] Calibrating delay loop... 265.42 BogoMIPS (lpj=1327104)<br />[&nbsp; &nbsp; 0.080000] pid_max: default: 32768 minimum: 301<br />[&nbsp; &nbsp; 0.080000] Mount-cache hash table entries: 512<br />[&nbsp; &nbsp; 0.090000] NET: Registered protocol family 16<br />[&nbsp; &nbsp; 0.090000] gpiochip_add: registered GPIOs 0 to 22 on device: ath79<br />[&nbsp; &nbsp; 0.100000] MIPS: machine is Atheros DB120 reference board<br />[&nbsp; &nbsp; 0.110000] registering PCI controller with io_map_base unset<br />[&nbsp; &nbsp; 0.520000] bio: create slab &lt;bio-0&gt; at 0<br />[&nbsp; &nbsp; 0.530000] PCI host bridge to bus 0000:00<br />[&nbsp; &nbsp; 0.530000] pci_bus 0000:00: root bus resource [mem 0x10000000-0x13ffffff]<br />[&nbsp; &nbsp; 0.540000] pci_bus 0000:00: root bus resource [io&nbsp; 0x0000]<br />[&nbsp; &nbsp; 0.540000] pci 0000:00:00.0: invalid calibration data<br />[&nbsp; &nbsp; 0.550000] pci 0000:00:00.0: BAR 0: assigned [mem 0x10000000-0x1001ffff 64bit]<br />[&nbsp; &nbsp; 0.550000] pci 0000:00:00.0: BAR 6: assigned [mem 0x10020000-0x1002ffff pref]<br />[&nbsp; &nbsp; 0.560000] pci 0000:00:00.0: using irq 40 for pin 1<br />[&nbsp; &nbsp; 0.560000] Switching to clocksource MIPS<br />[&nbsp; &nbsp; 0.570000] NET: Registered protocol family 2<br />[&nbsp; &nbsp; 0.570000] IP route cache hash table entries: 1024 (order: 0, 4096 bytes)<br />[&nbsp; &nbsp; 0.570000] TCP established hash table entries: 4096 (order: 3, 32768 bytes)<br />[&nbsp; &nbsp; 0.580000] TCP bind hash table entries: 4096 (order: 2, 16384 bytes)<br />[&nbsp; &nbsp; 0.580000] TCP: Hash tables configured (established 4096 bind 4096)<br />[&nbsp; &nbsp; 0.590000] TCP reno registered<br />[&nbsp; &nbsp; 0.590000] UDP hash table entries: 256 (order: 0, 4096 bytes)<br />[&nbsp; &nbsp; 0.600000] UDP-Lite hash table entries: 256 (order: 0, 4096 bytes)<br />[&nbsp; &nbsp; 0.600000] NET: Registered protocol family 1<br />[&nbsp; &nbsp; 3.770000] squashfs: version 4.0 (2009/01/31) Phillip Lougher<br />[&nbsp; &nbsp; 3.780000] JFFS2 version 2.2 (NAND) (SUMMARY) (LZMA) (RTIME) (CMODE_PRIORITY) (c) 2001-2006 Red Hat, Inc.<br />[&nbsp; &nbsp; 3.790000] msgmni has been set to 242<br />[&nbsp; &nbsp; 3.790000] io scheduler noop registered<br />[&nbsp; &nbsp; 3.800000] io scheduler deadline registered (default)<br />[&nbsp; &nbsp; 3.800000] Serial: 8250/16550 driver, 1 ports, IRQ sharing disabled<br />[&nbsp; &nbsp; 3.830000] serial8250.0: ttyS0 at MMIO 0x18020000 (irq = 11) is a 16550A<br />[&nbsp; &nbsp; 3.840000] console [ttyS0] enabled, bootconsole disabled<br />[&nbsp; &nbsp; 3.840000] console [ttyS0] enabled, bootconsole disabled<br />[&nbsp; &nbsp; 3.850000] m25p80 spi0.0: found mx25l12805d, expected m25p80<br />[&nbsp; &nbsp; 3.860000] m25p80 spi0.0: mx25l12805d (16384 Kbytes)<br />[&nbsp; &nbsp; 3.860000] 7 cmdlinepart partitions found on MTD device spi0.0<br />[&nbsp; &nbsp; 3.870000] Creating 7 MTD partitions on &quot;spi0.0&quot;:<br />[&nbsp; &nbsp; 3.870000] 0x000000000000-0x000000040000 : &quot;u-boot&quot;<br />[&nbsp; &nbsp; 3.880000] 0x000000040000-0x000000050000 : &quot;u-boot-env&quot;<br />[&nbsp; &nbsp; 3.890000] 0x000000050000-0x000000680000 : &quot;rootfs&quot;<br />[&nbsp; &nbsp; 3.890000] mtd: partition &quot;rootfs&quot; set to be root filesystem<br />[&nbsp; &nbsp; 3.900000] split_squashfs: no squashfs found in &quot;spi0.0&quot;<br />[&nbsp; &nbsp; 3.900000] 0x000000680000-0x0000007e0000 : &quot;kernel&quot;<br />[&nbsp; &nbsp; 3.910000] 0x0000007e0000-0x0000007f0000 : &quot;nvram&quot;<br />[&nbsp; &nbsp; 3.920000] 0x0000007f0000-0x000000800000 : &quot;art&quot;<br />[&nbsp; &nbsp; 3.920000] 0x000000050000-0x0000007e0000 : &quot;firmware&quot;<br />[&nbsp; &nbsp; 3.950000] ag71xx_mdio: probed<br />[&nbsp; &nbsp; 3.960000] ag71xx_mdio: probed<br />[&nbsp; &nbsp; 3.960000] eth0: Atheros AG71xx at 0xb9000000, irq 4<br />[&nbsp; &nbsp; 4.520000] ag71xx ag71xx.0: eth0: no PHY found with phy_mask=00000001<br />[&nbsp; &nbsp; 4.530000] eth0: Atheros AG71xx at 0xba000000, irq 5<br />[&nbsp; &nbsp; 5.080000] eth0: Found an AR934X built-in switch<br />[&nbsp; &nbsp; 6.120000] TCP cubic registered<br />[&nbsp; &nbsp; 6.120000] NET: Registered protocol family 17<br />[&nbsp; &nbsp; 6.120000] 8021q: 802.1Q VLAN Support v1.8<br />[&nbsp; &nbsp; 6.140000] Freeing unused kernel memory: 2448k freed<br />- preinit -<br />Press the [f] key and hit [enter] to enter failsafe mode<br />- regular preinit -<br />- init -<br />[&nbsp; &nbsp;11.260000] Compat-drivers backport release: compat-drivers-2012-09-04-2-gddac993<br />[&nbsp; &nbsp;11.270000] Backport based on wireless-testing.git master-2012-09-07<br />[&nbsp; &nbsp;11.280000] compat.git: wireless-testing.git<br />[&nbsp; &nbsp;11.300000] cfg80211: Calling CRDA to update world regulatory domain<br />[&nbsp; &nbsp;11.310000] cfg80211: World regulatory domain updated:<br />[&nbsp; &nbsp;11.310000] cfg80211:&nbsp; &nbsp;(start_freq - end_freq @ bandwidth), (max_antenna_gain, max_eirp)<br />[&nbsp; &nbsp;11.320000] cfg80211:&nbsp; &nbsp;(2402000 KHz - 2472000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)<br />[&nbsp; &nbsp;11.330000] cfg80211:&nbsp; &nbsp;(2457000 KHz - 2482000 KHz @ 20000 KHz), (300 mBi, 2000 mBm)<br />[&nbsp; &nbsp;11.330000] cfg80211:&nbsp; &nbsp;(2474000 KHz - 2494000 KHz @ 20000 KHz), (300 mBi, 2000 mBm)<br />[&nbsp; &nbsp;11.340000] cfg80211:&nbsp; &nbsp;(5170000 KHz - 5250000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)<br />[&nbsp; &nbsp;11.350000] cfg80211:&nbsp; &nbsp;(5735000 KHz - 5835000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)<br />[&nbsp; &nbsp;11.390000] NET: Registered protocol family 10<br />[&nbsp; &nbsp;11.460000] usbcore: registered new interface driver usbfs<br />[&nbsp; &nbsp;11.470000] usbcore: registered new interface driver hub<br />[&nbsp; &nbsp;11.470000] usbcore: registered new device driver usb<br />[&nbsp; &nbsp;11.570000] ieee80211 phy0: Atheros AR9340 Rev:0 mem=0xb8100000, irq=47<br /><span style="color: #FF0000"><br />[&nbsp; &nbsp;11.580000] PCI: Enabling device 0000:00:00.0 (0000 -&gt; 0002)<br />[&nbsp; &nbsp;11.590000] ath: phy1: Unable to initialize hardware; initialization status: -5<br />[&nbsp; &nbsp;11.600000] ath9k 0000:00:00.0: Failed to initialize device<br />[&nbsp; &nbsp;11.600000] ath9k: probe of 0000:00:00.0 failed with error -5<br /></span><br />[&nbsp; &nbsp;11.610000] cfg80211: Calling CRDA for country: US<br />[&nbsp; &nbsp;11.620000] cfg80211: Regulatory domain changed to country: US<br />[&nbsp; &nbsp;11.620000] cfg80211:&nbsp; &nbsp;(start_freq - end_freq @ bandwidth), (max_antenna_gain, max_eirp)<br />[&nbsp; &nbsp;11.630000] cfg80211:&nbsp; &nbsp;(2402000 KHz - 2472000 KHz @ 40000 KHz), (300 mBi, 2700 mBm)<br />[&nbsp; &nbsp;11.640000] cfg80211:&nbsp; &nbsp;(5170000 KHz - 5250000 KHz @ 40000 KHz), (300 mBi, 1700 mBm)<br />[&nbsp; &nbsp;11.650000] cfg80211:&nbsp; &nbsp;(5250000 KHz - 5330000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)<br />[&nbsp; &nbsp;11.650000] cfg80211:&nbsp; &nbsp;(5490000 KHz - 5600000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)<br />[&nbsp; &nbsp;11.660000] cfg80211:&nbsp; &nbsp;(5650000 KHz - 5710000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)<br />[&nbsp; &nbsp;11.670000] cfg80211:&nbsp; &nbsp;(5735000 KHz - 5835000 KHz @ 40000 KHz), (300 mBi, 3000 mBm)<br />[&nbsp; &nbsp;11.700000] PPP generic driver version 2.4.2<br />[&nbsp; &nbsp;11.740000] IPv6 over IPv4 tunneling driver<br />[&nbsp; &nbsp;11.790000] ip_tables: (C) 2000-2006 Netfilter Core Team<br />[&nbsp; &nbsp;11.870000] NET: Registered protocol family 24<br />[&nbsp; &nbsp;11.890000] ehci_hcd: USB 2.0 &#039;Enhanced&#039; Host Controller (EHCI) Driver<br />[&nbsp; &nbsp;11.900000] ehci-platform ehci-platform: Generic Platform EHCI Controller<br />[&nbsp; &nbsp;11.900000] ehci-platform ehci-platform: new USB bus registered, assigned bus number 1<br />[&nbsp; &nbsp;11.940000] ehci-platform ehci-platform: irq 3, io mem 0x1b000000<br />[&nbsp; &nbsp;11.960000] ehci-platform ehci-platform: USB 2.0 started, EHCI 1.00<br />[&nbsp; &nbsp;11.960000] hub 1-0:1.0: USB hub found<br />[&nbsp; &nbsp;11.970000] hub 1-0:1.0: 1 port detected<br />[&nbsp; &nbsp;11.980000] nf_conntrack version 0.5.0 (1981 buckets, 7924 max)<br />[&nbsp; &nbsp;12.160000] ohci_hcd: USB 1.1 &#039;Open&#039; Host Controller (OHCI) Driver</p><p>Please press Enter to activate this console.</p>											<p class="post-edited">(Last edited by <strong>banglang.huang</strong> on 4 Feb 2013, 03:22)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p189980">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">banglang.huang</div>
					<div class="post-datetime">
						25 Jan 2013, 17:19					</div>
				</div>
				<div class="post-content content">
					<p>I found the issue is here, but I don&#039;t know how to fix it.<br /><span style="color: #FF0000"><br />@compat-wireless/drivers/net/wireless/ath/ath9k/ar9003_eeprom.c <br /></span><br />/*<br /> * Read the configuration data from the eeprom.<br /> * The data can be put in any specified memory buffer.<br /> *<br /> * Returns -1 on error.<br /> * Returns address of next memory location on success.<br /> */<br />static int ar9300_eeprom_restore_internal(struct ath_hw *ah,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;u8 *mptr, int mdata_size)<br />{<br />#define MDEFAULT 15<br />#define MSTATE 100<br />&nbsp; &nbsp; int cptr;<br />&nbsp; &nbsp; u8 *word;<br />&nbsp; &nbsp; int code;<br />&nbsp; &nbsp; int reference, length, major, minor;<br />&nbsp; &nbsp; int osize;<br />&nbsp; &nbsp; int it;<br />&nbsp; &nbsp; u16 checksum, mchecksum;<br />&nbsp; &nbsp; struct ath_common *common = ath9k_hw_common(ah);<br />&nbsp; &nbsp; struct ar9300_eeprom *eep;<br />&nbsp; &nbsp; eeprom_read_op read;</p><p>&nbsp; &nbsp; if (ath9k_hw_use_flash(ah)) {<br />&nbsp; &nbsp; &nbsp; &nbsp; u8 txrx;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; ar9300_eeprom_restore_flash(ah, mptr, mdata_size);</p><p>&nbsp; &nbsp; &nbsp; &nbsp; /* check if eeprom contains valid data */<br />&nbsp; &nbsp; &nbsp; &nbsp; eep = (struct ar9300_eeprom *) mptr;</p><p>&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #FF0000"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //why txrx = 0xff ????<br />&nbsp; &nbsp; &nbsp; &nbsp; txrx = eep-&gt;baseEepHeader.txrxMask;<br />&nbsp; &nbsp; &nbsp; &nbsp; if (txrx != 0 &amp;&amp; txrx != 0xff)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return 0;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><br />&nbsp; &nbsp; }</p><p>&nbsp; &nbsp; word = kzalloc(2048, GFP_KERNEL);<br />&nbsp; &nbsp; if (!word)<br />&nbsp; &nbsp; &nbsp; &nbsp; return -ENOMEM;</p><p>&nbsp; &nbsp; memcpy(mptr, &amp;ar9300_default, mdata_size);</p><p>&nbsp; &nbsp; read = ar9300_read_eeprom;<br />&nbsp; &nbsp; if (AR_SREV_9485(ah))<br />&nbsp; &nbsp; &nbsp; &nbsp; cptr = AR9300_BASE_ADDR_4K;<br />&nbsp; &nbsp; else if (AR_SREV_9330(ah))<br />&nbsp; &nbsp; &nbsp; &nbsp; cptr = AR9300_BASE_ADDR_512;<br />&nbsp; &nbsp; else<br />&nbsp; &nbsp; &nbsp; &nbsp; cptr = AR9300_BASE_ADDR;<br />&nbsp; &nbsp; ath_dbg(common, EEPROM, &quot;Trying EEPROM access at Address 0x%04x\n&quot;,<br />&nbsp; &nbsp; &nbsp; &nbsp; cptr);<br />&nbsp; &nbsp; if (ar9300_check_eeprom_header(ah, read, cptr))<br />&nbsp; &nbsp; &nbsp; &nbsp; goto found;</p><p>&nbsp; &nbsp; cptr = AR9300_BASE_ADDR_512;<br />&nbsp; &nbsp; ath_dbg(common, EEPROM, &quot;Trying EEPROM access at Address 0x%04x\n&quot;,<br />&nbsp; &nbsp; &nbsp; &nbsp; cptr);<br />&nbsp; &nbsp; if (ar9300_check_eeprom_header(ah, read, cptr))<br />&nbsp; &nbsp; &nbsp; &nbsp; goto found;</p><p>&nbsp; &nbsp; read = ar9300_read_otp;<br />&nbsp; &nbsp; cptr = AR9300_BASE_ADDR;<br />&nbsp; &nbsp; ath_dbg(common, EEPROM, &quot;Trying OTP access at Address 0x%04x\n&quot;, cptr);<br />&nbsp; &nbsp; if (ar9300_check_eeprom_header(ah, read, cptr))<br />&nbsp; &nbsp; &nbsp; &nbsp; goto found;</p><p>&nbsp; &nbsp; cptr = AR9300_BASE_ADDR_512;<br />&nbsp; &nbsp; ath_dbg(common, EEPROM, &quot;Trying OTP access at Address 0x%04x\n&quot;, cptr);<br />&nbsp; &nbsp; if (ar9300_check_eeprom_header(ah, read, cptr))<br />&nbsp; &nbsp; &nbsp; &nbsp; goto found;<br />&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #FF0000"><br />&nbsp; &nbsp; goto fail;&nbsp; //of course go to fail, unfortunately</span></p><br /><br /><p><span style="color: #FF0000">eeprom_init error status :-5&nbsp; error I/O <br /></span></p>											<p class="post-edited">(Last edited by <strong>banglang.huang</strong> on 28 Jan 2013, 03:01)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p190388">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">youngchildren</div>
					<div class="post-datetime">
						30 Jan 2013, 08:41					</div>
				</div>
				<div class="post-content content">
					<p>It seems calibration data issue.</p><p>[&nbsp; &nbsp; 0.530000] PCI host bridge to bus 0000:00<br />[&nbsp; &nbsp; 0.530000] pci_bus 0000:00: root bus resource [mem 0x10000000-0x13ffffff]<br />[&nbsp; &nbsp; 0.540000] pci_bus 0000:00: root bus resource [io&nbsp; 0x0000]<br />[&nbsp; &nbsp; 0.540000] pci 0000:00:00.0: invalid calibration data&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-- error msg<br />[&nbsp; &nbsp; 0.550000] pci 0000:00:00.0: BAR 0: assigned [mem 0x10000000-0x1001ffff 64bit]<br />[&nbsp; &nbsp; 0.550000] pci 0000:00:00.0: BAR 6: assigned [mem 0x10020000-0x1002ffff pref]</p><br /><p>[&nbsp; &nbsp; 3.920000] 0x0000007f0000-0x000000800000 : &quot;art&quot;&nbsp; &nbsp; &nbsp;-- site where calibration data resides</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p190402">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">banglang.huang</div>
					<div class="post-datetime">
						30 Jan 2013, 10:32					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>youngchildren wrote:</cite><blockquote><p>It seems calibration data issue.</p><p>[&nbsp; &nbsp; 0.530000] PCI host bridge to bus 0000:00<br />[&nbsp; &nbsp; 0.530000] pci_bus 0000:00: root bus resource [mem 0x10000000-0x13ffffff]<br />[&nbsp; &nbsp; 0.540000] pci_bus 0000:00: root bus resource [io&nbsp; 0x0000]<br />[&nbsp; &nbsp; 0.540000] pci 0000:00:00.0: invalid calibration data&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-- error msg<br />[&nbsp; &nbsp; 0.550000] pci 0000:00:00.0: BAR 0: assigned [mem 0x10000000-0x1001ffff 64bit]<br />[&nbsp; &nbsp; 0.550000] pci 0000:00:00.0: BAR 6: assigned [mem 0x10020000-0x1002ffff pref]</p><br /><p>[&nbsp; &nbsp; 3.920000] 0x0000007f0000-0x000000800000 : &quot;art&quot;&nbsp; &nbsp; &nbsp;-- site where calibration data resides</p></blockquote></div><br /><p>thank you for your answer, Do you mean I need to modified the address where the program reads in &#039;compat-wireless driver &#039; source code ? <br />Would you please tell me how to make it?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p190406">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">banglang.huang</div>
					<div class="post-datetime">
						30 Jan 2013, 10:53					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>youngchildren wrote:</cite><blockquote><p>It seems calibration data issue.</p><p>[&nbsp; &nbsp; 0.530000] PCI host bridge to bus 0000:00<br />[&nbsp; &nbsp; 0.530000] pci_bus 0000:00: root bus resource [mem 0x10000000-0x13ffffff]<br />[&nbsp; &nbsp; 0.540000] pci_bus 0000:00: root bus resource [io&nbsp; 0x0000]<br />[&nbsp; &nbsp; 0.540000] pci 0000:00:00.0: invalid calibration data&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-- error msg<br />[&nbsp; &nbsp; 0.550000] pci 0000:00:00.0: BAR 0: assigned [mem 0x10000000-0x1001ffff 64bit]<br />[&nbsp; &nbsp; 0.550000] pci 0000:00:00.0: BAR 6: assigned [mem 0x10020000-0x1002ffff pref]</p><br /><p>[&nbsp; &nbsp; 3.920000] 0x0000007f0000-0x000000800000 : &quot;art&quot;&nbsp; &nbsp; &nbsp;-- site where calibration data resides</p></blockquote></div><br /><br /><p>Should here be modified in mach-db120.c ???</p><p>static void __init db120_setup(void)<br />{ <br />&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #FF0000"><br />&nbsp; &nbsp; u8 *art = (u8 *) KSEG1ADDR(0x1fff0000);</span><br />&nbsp; &nbsp; /*&nbsp; -- site where calibration data resides<br />&nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x0000007f0000-0x000000800000 : &quot;art&quot;<br />&nbsp; &nbsp; /*<br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;the macros definition are show as below:<br />&nbsp; &nbsp; #define KUSEG&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x00000000<br />&nbsp; &nbsp; #define KSEG0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x80000000<br />&nbsp; &nbsp; #define KSEG1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0xa0000000<br />&nbsp; &nbsp; #define KSEG2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0xc0000000<br />&nbsp; &nbsp; #define KSEG3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0xe0000000<br />&nbsp; &nbsp; */</p>											<p class="post-edited">(Last edited by <strong>banglang.huang</strong> on 30 Jan 2013, 10:54)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p190471">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">youngchildren</div>
					<div class="post-datetime">
						31 Jan 2013, 04:32					</div>
				</div>
				<div class="post-content content">
					<p>I am not sure the cal data area is destoryed or not.<br />Please help dump that area. I will check it.</p><p>#cat /dev/mtdblock5 &gt; /tmp/cal.data</p><p>Or you may just let me have a quick view of the cal data for PCI module,<br />#md 0xbfff5000 10<br />#md 0xbfff1000 10</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p190472">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">banglang.huang</div>
					<div class="post-datetime">
						31 Jan 2013, 05:56					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>youngchildren wrote:</cite><blockquote><p>I am not sure the cal data area is destoryed or not.<br />Please help dump that area. I will check it.</p><p>#cat /dev/mtdblock5 &gt; /tmp/cal.data</p><p>Or you may just let me have a quick view of the cal data for PCI module,<br />#md 0xbfff5000 10<br />#md 0xbfff1000 10</p></blockquote></div><p>I use <br />&nbsp; &nbsp;cat /dev/mtdblock5 &gt; /tmp/cal.data<br />and open the file cal.data, It seems like messy code.</p><p>below is the md result under U-Boot of my testbed:</p><p># md 0xbfff5000 10<br />bfff5000: ffffffff ffffffff ffffffff ffffffff&nbsp; &nbsp; ................<br />bfff5010: ffffffff ffffffff ffffffff ffffffff&nbsp; &nbsp; ................<br />bfff5020: ffffffff ffffffff ffffffff ffffffff&nbsp; &nbsp; ................<br />bfff5030: ffffffff ffffffff ffffffff ffffffff&nbsp; &nbsp; ................<br /># md 0xbfff1000 10<br />bfff1000: 02027072 cf83aba0 44423132 302d3033&nbsp; &nbsp; ..pr....DB120-03<br />bfff1010: 322d4432 35383900 36000000 00001f00&nbsp; &nbsp; 2-D2589.6.......<br />bfff1020: 33030000 00000400 38004d02 030008ff&nbsp; &nbsp; 3.......8.M.....<br />bfff1030: 20010000 00200200 00111101 00500150&nbsp; &nbsp; &nbsp;.... .......P.P<br /># md 0x1fff0000<br />1fff0000: ffffffff ffffffff ffffffff ffffffff&nbsp; &nbsp; ................<br />1fff0010: ffffffff ffffffff ffffffff ffffffff&nbsp; &nbsp; ................<br />1fff0020: ffffffff ffffffff ffffffff ffffffff&nbsp; &nbsp; ................<br />1fff0030: ffffffff ffffffff ffffffff ffffffff&nbsp; &nbsp; ................</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p190474">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">youngchildren</div>
					<div class="post-datetime">
						31 Jan 2013, 06:44					</div>
				</div>
				<div class="post-content content">
					<p>Could you please send the file cal.data to me and let me check it?</p><p>It seems the cal data for pci module has been destoryed by you.<br />Have you ever erase the art partition?<br />But it&#039;s very strange that the cal data for QCA9344 still there.<br />I am quite confused of that.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p190475">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">banglang.huang</div>
					<div class="post-datetime">
						31 Jan 2013, 06:45					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>youngchildren wrote:</cite><blockquote><p>Could you please send the file cal.data to me and let me check it?</p><p>It seems the cal data for pci module has been destoryed by you.<br />Have you ever erase the art partition?<br />But it&#039;s very strange that the cal data for QCA9344 still there.<br />I am quite confused of that.</p></blockquote></div><br /><p>do you have gmail??? tell me your email address please.</p>											<p class="post-edited">(Last edited by <strong>banglang.huang</strong> on 31 Jan 2013, 07:44)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p190476">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">banglang.huang</div>
					<div class="post-datetime">
						31 Jan 2013, 06:50					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>youngchildren wrote:</cite><blockquote><p>Could you please send the file cal.data to me and let me check it?</p><p>It seems the cal data for pci module has been destoryed by you.<br />Have you ever erase the art partition?<br />But it&#039;s very strange that the cal data for QCA9344 still there.<br />I am quite confused of that.</p></blockquote></div><br /><p>I think I should tell you something.</p><p>My testbed is DB120-Atheros-like board. 9344+PHY8035+9580, 2 pieces of 16M flash(just one for backup).<br />the original image had been written into the flash.And it runs well 2.4GHz and 5GHz are ok,<br />Because our own project is ongoing,and we do not want to destroy the original image already on the flash and this method is convenient for debuging work.Thus,we use OpenWrt initramfs.bin,run the image in ram.Then came with that issue--5GHz can not work.</p>											<p class="post-edited">(Last edited by <strong>banglang.huang</strong> on 31 Jan 2013, 06:59)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p190487">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">youngchildren</div>
					<div class="post-datetime">
						31 Jan 2013, 07:54					</div>
				</div>
				<div class="post-content content">
					<p>I understand your situation.<br />Could you please share the console log for your original runtime?<br />I am doubting about QCA9580 can work correctly.</p><p>If not convenient put log here, send mail to me at youngchildren@gmail.com.<br />I also want the file cal.data.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p190498">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">banglang.huang</div>
					<div class="post-datetime">
						31 Jan 2013, 09:20					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>youngchildren wrote:</cite><blockquote><p>I understand your situation.<br />Could you please share the console log for your original runtime?<br />I am doubting about QCA9580 can work correctly.</p><p>If not convenient put log here, send mail to me at youngchildren@gmail.com.<br />I also want the file cal.data.</p></blockquote></div><p>OK , I have already sent the cal.data file and original kernel log to your gmail. Please check it .thx</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p190516">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">youngchildren</div>
					<div class="post-datetime">
						31 Jan 2013, 13:59					</div>
				</div>
				<div class="post-content content">
					<p>I have checked you console log for original runtime.<br />There are two points be noticed,<br />a. openwrt source code config with 8M flash, while your customized board with 16M flash on board,<br />b. as you mentioned, calibration data for QCA9582 stored on EEPROM, so please check the openwrt code for restoring cal data. As usually, it fall through among flash, eeprom, otp. You may have a cross comparing of the source code between openwrt and QCA SDK.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>