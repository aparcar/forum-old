<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Unsure about PrivateVPN WLAN (and routing)</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 27 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p232028">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">mejo</div>
					<div class="post-datetime">
						2 May 2014, 02:34					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>I&#039;d like my OpenWRT router to provide two seperate WLANs: one normal one with direct internet access, and a second one that routes all traffic through a PrivateVPN service. One important aspect is, that both WLANs need to be part of the same internal LAN. In other words, I don&#039;t want a separated guest LAN that is used for the PrivateVPN WLAN. Background is, that the machines in both WLANs need to see each other.</p><p>Now I&#039;m unsure on how to implement that setup. I&#039;ve already configured two seperate WLANs in /etc/network/wireless, both using the same LAN as backend. I also managed to setup the PrivateVPN client with OpenVPN, and stopped it from setting global default gateway routes.</p><p>But now the part that I&#039;m unsure about: How to teach OpenWRT to route all traffic from second WLAN through PrivateVPN?</p><p>My current idea is, to split the two WLANs by DHCP IP address range, use a seperate routing table for the PrivateVPN and define ip routing rules accordingly (i.e.: ip rule add from 192.168.1.192/26 table 10).<br />I had this idea after reading <a href="http://wiki.openwrt.org/doc/networking/routing.">http://wiki.openwrt.org/doc/networking/routing.</a> But unfortunately it seems like that one doesn&#039;t work. At the moment I see two problems:</p><p>1. I&#039;m unsure on how to define DHCP IP ranges for WLANs at all. The config in /etc/default/dhcp is all about LANs, not about WLANs. Is it possible at all to split the DHCP IP range between two seperate WLANs which use the same LAN/interface as backend?<br />2. I tested it by defining an ip routing rule for the precise IP that my node got in the WLAN. But network connectivity seemed quite unstable afterwards. ICMP Ping e.g. resulted in periods of ~5-10 ping answers received, then a lot unanswered ones and so on. I&#039;m pretty sure that the OpenVPN connection works reliable though, as everything works as expected with the default gw route being set by OpenVPN client.</p><p>So I&#039;m stuck at the moment not being sure whether my approach is a good idea at all. I would appreciate your comments and thoughts.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>