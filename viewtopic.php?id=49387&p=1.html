<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Unable to Flash via WEB TP-Link TL-WR703N</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 5 Apr 2018 and 29 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 3</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=49387&amp;p=2.html">2</a></li><li><a href="viewtopic.php%3Fid=49387&amp;p=3.html">3</a></li></ul></nav></div>
			
		
		
			<article class="post" id="p226994">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">Dr_Deathscythe</div>
					<div class="post-datetime">
						8 Mar 2014, 00:36					</div>
				</div>
				<div class="post-content content">
					<p>I have this message<br /></p><div class="codebox"><pre><code>Error Code: 18005 
Upload file version does not match with the models.</code></pre></div><p>Im tryng to flash this versión of openwrt. <br /><a href="http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/openwrt-ar71xx-generic-tl-wr703n-v1-squashfs-factory.bin">AA(12.09)</a><br />Information<br /></p><div class="codebox"><pre><code>The current software version: 
3.17.1 Build 140120 Rel.56593n 
Current hardware version: 
WR703N v1 00000000</code></pre></div><p>Please Help<br />In Chinese :3<br /></p><div class="codebox"><pre><code>错误代码：18005
上传的文件版本与机型不符。
当前软件版本：    
3.17.1 Build 140120 Rel.56593n
当前硬件版本：    
WR703N v1 00000000
注意：升级时请选择与当前硬件版本一致的软件。升级过程不能关闭路由器电源，否则将导致路由器损坏而无法使用。升级过程约1至2分钟，当升级结束后，路由器将会自动重新启动</code></pre></div>											<p class="post-edited">(Last edited by <strong>Dr_Deathscythe</strong> on 8 Mar 2014, 04:35)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p227035">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">hkfires</div>
					<div class="post-datetime">
						8 Mar 2014, 16:56					</div>
				</div>
				<div class="post-content content">
					<p>The same to you</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p227096">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">nebbia88</div>
					<div class="post-datetime">
						9 Mar 2014, 12:46					</div>
				</div>
				<div class="post-content content">
					<p>hi, good news: you are not alone.</p><p>with newest tp-link firmware (140120) tplink GUI seems to refuse a firmware without uboot.</p><p>the only firmware that works is the same version you can download from here (useless.. DO NOT UPDATE if you have an older tp-link firmware, or you will not be able to flash anything else...)</p><p> <a href="http://service.tp-link.com.cn/detail_Download_1390.html">http://service.tp-link.com.cn/detail_Download_1390.html</a></p><p>this very same firwmare image is not accepted if you trim out uboot the usual way (cut first 0x20200 bytes), so OLDER tplink firmware and openwrt or dd-wrt firmware is NOT accepted.</p><p>imho the only way is build and image that contains uboot, but i do not know how to calculate checksum.<br />it seems that mktplinkfw.c already contains the necessary code, we just need to figure out HOW to use it:</p><p><a href="https://dev.openwrt.org/browser/trunk/tools/firmware-utils/src/mktplinkfw.c">https://dev.openwrt.org/browser/trunk/t … tplinkfw.c</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p227212">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">Dr_Deathscythe</div>
					<div class="post-datetime">
						10 Mar 2014, 18:30					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>nebbia88 wrote:</cite><blockquote><p>imho the only way is build and image that contains uboot, but i do not know how to calculate checksum.<br />it seems that mktplinkfw.c already contains the necessary code, we just need to figure out HOW to use it:<br /><a href="https://dev.openwrt.org/browser/trunk/tools/firmware-utils/src/mktplinkfw.c">https://dev.openwrt.org/browser/trunk/t … tplinkfw.c</a></p></blockquote></div><p>So we don&#039;t have a solution now =S</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p227218">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">Mark_V</div>
					<div class="post-datetime">
						10 Mar 2014, 19:39					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Dr_Deathscythe wrote:</cite><blockquote><p>So we don&#039;t have a solution now =S</p></blockquote></div><p>Or take out the flash chip (a simple 8pins device) and program it externally, you can even<br />buy ready programmed flash chips on Ebay and solder that in, these are most of the time<br />16MB so you have a lot more space to install packages.</p><p>If you want to build your own image i can highly recommend the modified U-boot from<br />pepe2k, i don&#039;t know if you then still have the checksum issue, i always program my flash<br />chips externally.</p><p>Grtzz&nbsp; Mark</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p227219">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">King0fK0ng</div>
					<div class="post-datetime">
						10 Mar 2014, 19:55					</div>
				</div>
				<div class="post-content content">
					<p>Just curious if the OP and other users bought their router preloaded with 140120 firmware or if they manually upgraded it.</p><p>Also, what version is printed on the bottom of the router?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p227264">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">Dr_Deathscythe</div>
					<div class="post-datetime">
						10 Mar 2014, 23:08					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Mark_V wrote:</cite><blockquote><p>Or take out the flash chip (a simple 8pins device) and program it externally, you can even<br />buy ready programmed flash chips on Ebay and solder that in, these are most of the time<br />16MB so you have a lot more space to install packages.</p><p>If you want to build your own image i can highly recommend the modified U-boot from<br />pepe2k, i don&#039;t know if you then still have the checksum issue, i always program my flash<br />chips externally.</p><p>Grtzz&nbsp; Mark</p></blockquote></div><p>Thanks for your answer. The problem is i don&#039;t know to do it. Im just an end user.</p><div class="quotebox"><cite>King0fK0ng wrote:</cite><blockquote><p>Just curious if the OP and other users bought their router preloaded with 140120 firmware or if they manually upgraded it.</p><p>Also, what version is printed on the bottom of the router?</p></blockquote></div><p>Says 1.1</p>											<p class="post-edited">(Last edited by <strong>Dr_Deathscythe</strong> on 10 Mar 2014, 23:10)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p227275">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">King0fK0ng</div>
					<div class="post-datetime">
						11 Mar 2014, 02:09					</div>
				</div>
				<div class="post-content content">
					<p>&quot;1.1&quot;? I was expecting 1.6, 1.7 or 1.8, not 1.1.</p><p>So did you buy it new with the 140120 firmware pre-installed or did you buy it used or upgraded it manually yourself first?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p227279">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">Dr_Deathscythe</div>
					<div class="post-datetime">
						11 Mar 2014, 02:25					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>King0fK0ng wrote:</cite><blockquote><p>&quot;1.1&quot;? I was expecting 1.6, 1.7 or 1.8, not 1.1.</p><p>So did you buy it new with the 140120 firmware pre-installed or did you buy it used or upgraded it manually yourself first?</p></blockquote></div><p>Sorry was 1.6. My error. Upgraded.</p>											<p class="post-edited">(Last edited by <strong>Dr_Deathscythe</strong> on 11 Mar 2014, 02:35)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p227898">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">Dr_Deathscythe</div>
					<div class="post-datetime">
						18 Mar 2014, 21:08					</div>
				</div>
				<div class="post-content content">
					<p>Any idea how to fix it?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p229033">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">szymon_zy</div>
					<div class="post-datetime">
						2 Apr 2014, 12:52					</div>
				</div>
				<div class="post-content content">
					<p>Any progress on that? I have flashed my v. 1.5 with latest original firmware. And now i can&#039;t move to openwrt.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p235872">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">King0fK0ng</div>
					<div class="post-datetime">
						6 Jun 2014, 19:04					</div>
				</div>
				<div class="post-content content">
					<p>Okay, I just picked up a new 703N router and it is a version v1.7 (manufactured in 4/2014) and running into the same issue as the OP, so it looks like TP-LINK is sending out routers with this latest firmware and it&#039;s not OpenWRT friendly.</p><p>3.17.1 Build 140120 Rel.56593n </p><p>Any ideas on what need to change so that the TP-LINK firmware will accept the OpenWRT firmware?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p235901">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">RudeBootie</div>
					<div class="post-datetime">
						7 Jun 2014, 05:17					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>King0fK0ng wrote:</cite><blockquote><p>Okay, I just picked up a new 703N router and it is a version v1.7 (manufactured in 4/2014) and running into the same issue as the OP, so it looks like TP-LINK is sending out routers with this latest firmware and it&#039;s not OpenWRT friendly.</p><p>3.17.1 Build 140120 Rel.56593n </p><p>Any ideas on what need to change so that the TP-LINK firmware will accept the OpenWRT firmware?</p></blockquote></div><br /><p>Having the same exact troubles here. Just picked one up the past week.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p235902">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">King0fK0ng</div>
					<div class="post-datetime">
						7 Jun 2014, 05:18					</div>
				</div>
				<div class="post-content content">
					<p>So from this thread (<a href="https://forum.openwrt.org/viewtopic.php?pid=222183#p222183">https://forum.openwrt.org/viewtopic.php … 83#p222183</a>) I believe the new firmware is doing a product id and product version check.</p><div class="codebox"><pre><code>if ( (original_product_id == recovery_product_id)
             &amp;&amp; (original_product_ver== recovery_product_ver) )</code></pre></div><p>I&#039;m wondering if we can just (hex) edit the openwrt image to get it to load. Any ideas?</p><p><span class="postimg"><img src="http://i.imgur.com/6LT97aA.jpg" alt="http://i.imgur.com/6LT97aA.jpg" /></span></p><br /><p>Here is the official TP-Link Firmware that is now not allowing OpenWRT flashing via the website (note that U-Boot is also included in the file):<br />TL-WR703N V1.0_140120<br /><a href="http://service.tp-link.com.cn/detail_download_1390.html">http://service.tp-link.com.cn/detail_download_1390.html</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p235908">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">nebbia88</div>
					<div class="post-datetime">
						7 Jun 2014, 10:25					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>King0fK0ng wrote:</cite><blockquote><p>So from this thread (<a href="https://forum.openwrt.org/viewtopic.php?pid=222183#p222183">https://forum.openwrt.org/viewtopic.php … 83#p222183</a>) I believe the new firmware is doing a product id and product version check.</p><div class="codebox"><pre><code>if ( (original_product_id == recovery_product_id)
             &amp;&amp; (original_product_ver== recovery_product_ver) )</code></pre></div></blockquote></div><p>that topic is about tftp recovery mode from uboot, and has nothing to do with the check during firmware upgrade from web GUI <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p235928">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">King0fK0ng</div>
					<div class="post-datetime">
						7 Jun 2014, 17:34					</div>
				</div>
				<div class="post-content content">
					<p>Hi @nebbia88, yes I&#039;m aware that topic is on tftp recover mode from uboot. I was just assuming that the uboot firmware check method would be the same used in the web gui.</p><p>After some more research last night, I don&#039;t think the product id and version check is new. It looks like that have been there for a while now and OpenWRT was already handled it.</p><p>I found this TP Link firmware checker/editor tool and checked the new TP-Link 140120 firmware with the OpenWRT version and they are the same.</p><p><span class="postimg"><img src="http://i.imgur.com/svH9iew.jpg" alt="http://i.imgur.com/svH9iew.jpg" /></span></p><div class="quotebox"><cite>nebbia88 wrote:</cite><blockquote><div class="quotebox"><cite>King0fK0ng wrote:</cite><blockquote><p>So from this thread (<a href="https://forum.openwrt.org/viewtopic.php?pid=222183#p222183">https://forum.openwrt.org/viewtopic.php … 83#p222183</a>) I believe the new firmware is doing a product id and product version check.</p><div class="codebox"><pre><code>if ( (original_product_id == recovery_product_id)
             &amp;&amp; (original_product_ver== recovery_product_ver) )</code></pre></div></blockquote></div><p>that topic is about tftp recovery mode from uboot, and has nothing to do with the check during firmware upgrade from web GUI <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p></blockquote></div><p>I also re-read your post above about the web gui not accepting the TP-Link 140120 firmware with the U-Boot trimmed out. </p><p>Interesting...</p><p>I guess it would help if someone with serial console access to upgrade to the 140120 firmware and maybe see if the console would give us an hints. Maybe access to the web gui files to see the check is being performed?</p><p>I have another 703n router with pepe2k recovery firmware. I&#039;m wondering if it&#039;s possible trim out the Uboot from the 140120 firmware and load it on my 703n router with pepe2k recovery firmware? That way I can use the netconsole to see what&#039;s going on. </p><p>Also, not sure if this 140120 firmware include the tftp recover mode in uboot mentioned in the other thread. I tried plugging in the router with the reset button pushed and wiresharked the connection, but didnt see any tftp packets. I&#039;ll be honest though, not sure if I did it right.</p><p>For the record, I don&#039;t have the solder skills to add a serial console to the 703n (those darn tx/rx pads are super tiny and I lifted the contacts attempting). I&#039;ve totally messed up two 703n attempting <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p>											<p class="post-edited">(Last edited by <strong>King0fK0ng</strong> on 7 Jun 2014, 18:44)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p236033">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">King0fK0ng</div>
					<div class="post-datetime">
						8 Jun 2014, 21:38					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>nebbia88 wrote:</cite><blockquote><p>this very same firwmare image is not accepted if you trim out uboot the usual way (cut first 0x20200 bytes), so OLDER tplink firmware and openwrt or dd-wrt firmware is NOT accepted.</p><p>imho the only way is build and image that contains uboot, but i do not know how to calculate checksum.<br />it seems that mktplinkfw.c already contains the necessary code, we just need to figure out HOW to use it:</p><p><a href="https://dev.openwrt.org/browser/trunk/tools/firmware-utils/src/mktplinkfw.c">https://dev.openwrt.org/browser/trunk/t … tplinkfw.c</a></p></blockquote></div><p>Okay I tried trimming out the uBoot on the TP-Link Firmware and confirmed the original TP-Link firmware without Uboot doesn&#039;t load. Also tried patching it using the TP-Link firmware patching app (screenshot above).</p><p>How about if we trim out the uboot from the TP-Link Firmware and merge it with the OpenWRT firmware? Not sure what the correct dd command would be to extract the UBoot from the TP-Link Firmware.</p><p>Here is the command I used to trim out the UBoot. What would be the somewhat opposite command to only output the Uboot part of the file?</p><div class="codebox"><pre><code>Cut the first 0x20200 (that is 131,584 = 257*512) Bytes from original firmware:

dd if=orig.bin of=tplink.bin skip=257 bs=512</code></pre></div><p>Edit: I believe I figured out the command.<br />dd if=wr703nv1.bin of=uboot.bin bs=512 count=257</p><p>Now to merge it.</p><p>Edit: didn&#039;t work. Properly didn&#039;t like the checksum or something</p>											<p class="post-edited">(Last edited by <strong>King0fK0ng</strong> on 8 Jun 2014, 21:54)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p236124">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">King0fK0ng</div>
					<div class="post-datetime">
						9 Jun 2014, 19:52					</div>
				</div>
				<div class="post-content content">
					<p>Does anyone have a link to the previous version of TP-LINK Firmware for the 703N router?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p236216">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">lmm5247</div>
					<div class="post-datetime">
						10 Jun 2014, 16:54					</div>
				</div>
				<div class="post-content content">
					<p>I was going to ask the same thing, maybe we could downgrade? This is all I could find for the 703n. Unfortunately, none of it appears to be older firmware...<br /><a href="http://service.tp-link.com.cn/search_download.html?level1=0&amp;level2=0&amp;product=0&amp;kw=703n">http://service.tp-link.com.cn/search_do … mp;kw=703n</a></p><p>This is the newest firmware...<br /><a href="http://service.tp-link.com.cn/detail_download_1390.html">http://service.tp-link.com.cn/detail_download_1390.html</a></p><p>Isn&#039;t this device the same as the 703n, just with more LEDs?<br /><a href="http://www.tp-link.com/lk/products/details/?model=TL-MR3020">http://www.tp-link.com/lk/products/deta … =TL-MR3020</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p236218">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">lmm5247</div>
					<div class="post-datetime">
						10 Jun 2014, 17:01					</div>
				</div>
				<div class="post-content content">
					<p>I lied, how about this? It&#039;s still v1.7, but it&#039;s an older build...<br /><a href="http://service.tp-link.com.cn/detail_download_935.html">http://service.tp-link.com.cn/detail_download_935.html</a></p><p>This looks to be build 110926. Not sure what version number that corresponds to...<br /><a href="http://service.tp-link.com.cn/detail_download_616.html">http://service.tp-link.com.cn/detail_download_616.html</a></p><p>This was the Google query...<br />703n site:tp-link.com.cn</p><br /><p>UPDATE:<br />I got an error why trying to upload both of these files.</p>											<p class="post-edited">(Last edited by <strong>lmm5247</strong> on 11 Jun 2014, 04:28)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p237045">
				<div class="post-metadata">
					<div class="post-num">Post #21</div>
					<div class="post-author">pjones</div>
					<div class="post-datetime">
						17 Jun 2014, 05:43					</div>
				</div>
				<div class="post-content content">
					<p>I have the pre-1.7 firmware on my laptop if anyone needs it.&nbsp; </p><p>Anyone try using the mr3040 firmware?&nbsp; I had good luck using that in the past since it was in English and the only thing it broke was the led.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p237306">
				<div class="post-metadata">
					<div class="post-num">Post #22</div>
					<div class="post-author">pjones</div>
					<div class="post-datetime">
						19 Jun 2014, 08:14					</div>
				</div>
				<div class="post-content content">
					<p>Okay, I tried both the mr3020 and older versions of firmware and no go, as expected.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p237332">
				<div class="post-metadata">
					<div class="post-num">Post #23</div>
					<div class="post-author">leo8</div>
					<div class="post-datetime">
						19 Jun 2014, 13:28					</div>
				</div>
				<div class="post-content content">
					<p>try flash with prolific usb serial adapter</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p237336">
				<div class="post-metadata">
					<div class="post-num">Post #24</div>
					<div class="post-author">nebbia88</div>
					<div class="post-datetime">
						19 Jun 2014, 13:58					</div>
				</div>
				<div class="post-content content">
					<p>@leo8</p><p>that&#039;s not the point, obviously you can flash with serial, but this topic is about GUI flashing (no hw mod necessary...)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p237434">
				<div class="post-metadata">
					<div class="post-num">Post #25</div>
					<div class="post-author">pjones</div>
					<div class="post-datetime">
						20 Jun 2014, 08:34					</div>
				</div>
				<div class="post-content content">
					<p>Can you post the link that describes how to flash via serial?&nbsp; I assume i can put the old v1.6 factory image on it and be able to whatever else I need from that point?</p>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 1 of 3</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=49387&amp;p=2.html">2</a></li><li><a href="viewtopic.php%3Fid=49387&amp;p=3.html">3</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>