<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> OpenVPN Problem</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 29 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p23417">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">EgonLebt</div>
					<div class="post-datetime">
						22 Mar 2006, 20:19					</div>
				</div>
				<div class="post-content content">
					<p>Hi!</p><p>I have a lot of troubles with OpenVPN on the WGT634U with Kamikaze, Revision 3800.</p><p>I Use OpenVPN for bridging my WLAN to my LAN oven a bridge between vlan0 and tun0. All this worked fine, but after I flashed a new version ( on the change to Kernel 2.6.15.6) no connection can be established. On my first tries ( before it worked the first time) I forgot to set the System time and the certificates did not work. Now this is fixed I also used the example keys to prefent wrong keys.</p><p>I tried a lot, hope I havn&#039;t killed my config with this.</p><br /><p>Hope anyone have ideas, suggestions or any other answers.</p><p>Dennis</p><br /><p>The Output I get on the Server:<br />------------------------------------------------------------------------------------------------------------------------<br />Wed Mar 22 18:58:14 2006 OpenVPN 2.0.5 mipsel-linux [SSL] [LZO] [EPOLL] built on Mar&nbsp; 8 2006<br />Wed Mar 22 18:58:16 2006 Diffie-Hellman initialized with 1024 bit key<br />Wed Mar 22 18:58:16 2006 Control Channel Authentication: using &#039;/config/keys/ta.key&#039; as a OpenVPN static key file<br />Wed Mar 22 18:58:16 2006 Outgoing Control Channel Authentication: Using 160 bit message hash &#039;SHA1&#039; for HMAC authentication<br />Wed Mar 22 18:58:16 2006 Incoming Control Channel Authentication: Using 160 bit message hash &#039;SHA1&#039; for HMAC authentication<br />Wed Mar 22 18:58:16 2006 TLS-Auth MTU parms [ L:1574 D:166 EF:66 EB:0 ET:0 EL:0 ]<br />Wed Mar 22 18:58:16 2006 TUN/TAP device tap0 opened<br />Wed Mar 22 18:58:16 2006 Data Channel MTU parms [ L:1574 D:1450 EF:42 EB:135 ET:32 EL:0 AF:3/1 ]<br />Wed Mar 22 18:58:16 2006 UDPv4 link local (bound): [undef]:1194<br />Wed Mar 22 18:58:16 2006 UDPv4 link remote: [undef]<br />Wed Mar 22 18:58:16 2006 MULTI: multi_init called, r=256 v=256<br />Wed Mar 22 18:58:16 2006 IFCONFIG POOL: base=192.168.1.100 size=51<br />Wed Mar 22 18:58:16 2006 Initialization Sequence Completed<br />Wed Mar 22 19:00:53 2006 MULTI: multi_create_instance called<br />Wed Mar 22 19:00:53 2006 192.168.3.127:1194 Re-using SSL/TLS context<br />Wed Mar 22 19:00:53 2006 192.168.3.127:1194 LZO compression initialized<br />Wed Mar 22 19:00:53 2006 192.168.3.127:1194 Control Channel MTU parms [ L:1574 D:166 EF:66 EB:0 ET:0 EL:0 ]<br />Wed Mar 22 19:00:53 2006 192.168.3.127:1194 Data Channel MTU parms [ L:1574 D:1450 EF:42 EB:135 ET:32 EL:0 AF:3/1 ]<br />Wed Mar 22 19:00:53 2006 192.168.3.127:1194 Local Options hash (VER=V4): &#039;360696c5&#039;<br />Wed Mar 22 19:00:53 2006 192.168.3.127:1194 Expected Remote Options hash (VER=V4): &#039;13a273ba&#039;<br />Wed Mar 22 19:00:53 2006 192.168.3.127:1194 TLS: Initial packet from 192.168.3.127:1194, sid=9a7866da 514825dc<br />Wed Mar 22 19:00:56 2006 192.168.3.127:1194 VERIFY OK: depth=1, /C=DE/ST=CA/L=Hamburg/O=xxxx/CN=xxxVPN/emailAddress=xxx@xxx.xx<br />Wed Mar 22 19:00:56 2006 192.168.3.127:1194 VERIFY OK: depth=0, /C=DE/ST=CA/L=Hamburg/O=xxxx/CN=client1/emailAddress=xxx@xxx.xx<br />Wed Mar 22 19:00:58 2006 192.168.3.127:1194 TLS_ERROR: BIO read tls_read_plaintext error: error:140D108E:lib(20):func(209):reason(142)<br />Wed Mar 22 19:00:58 2006 192.168.3.127:1194 TLS Error: TLS object -&gt; incoming plaintext read error<br />Wed Mar 22 19:00:58 2006 192.168.3.127:1194 TLS Error: TLS handshake failed<br />Illegal instruction<br />----------------------------------------------------------------------------------------------------------</p><p>My Server-Config:</p><p>------------------------------------------------------------------------------------------------------------</p><p>port 1194<br />dev tap0<br />tls-server<br />server-bridge 192.168.1.1 255.255.255.0 192.168.1.100 192.168.1.150</p><p>ca /config/keys/ca.crt<br />cert /config/keys/server.crt<br />key /config/keys/server.key<br />dh /config/keys/dh1024.pem<br />keepalive 10 120<br />persist-key<br />persist-tun<br />comp-lzo<br />verb 3</p><p>-------------------------------------------------------------------------------------------------------------------</p><p>My Client-Config:<br />--------------------------------------------------------------------------------------------------------------------<br />dev tap<br />remote 192.168.3.1 1194<br />tls-client</p><p>ca /etc/openvpn/client1/ca.crt<br />cert /etc/openvpn/client1/client1.crt<br />key /etc/openvpn/client1/client1.key</p><p>port 1194<br />route-gateway 192.168.1.1<br />persist-tun<br />persist-key<br />comp-lzo<br />verb 3<br />------------------------------------------------------------------------------------------------------------</p><br /><p>Changed to new config, biut nothing works....</p>											<p class="post-edited">(Last edited by <strong>EgonLebt</strong> on 24 May 2006, 18:21)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p24278">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">knetknight</div>
					<div class="post-datetime">
						2 Apr 2006, 15:35					</div>
				</div>
				<div class="post-content content">
					<p>I suggest temporarily disabling the &quot;tls-auth&quot; lines in both the server and the client config, then try it again. tls-auth provides additional but optional security.</p><p>If that doesn&#039;t work I suggest trying a config that&#039;s as simple as possible and then build up in complexity if that works.</p><p>Let me know how it goes, glad to help.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>