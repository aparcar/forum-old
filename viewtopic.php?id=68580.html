<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> multicast client application running in the router does not work...</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 9 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p344023">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">grajeshkannan</div>
					<div class="post-datetime">
						17 Nov 2016, 19:32					</div>
				</div>
				<div class="post-content content">
					<p>My current infrastructure is like this</p><p>openwrt router, configured for lan and wifi interface.<br />lan is only used for software download and<br />wifi is used only for the wireless routing between the clients (tablets, mobile phones)<br />custom software running in the router listens to incoming multicast messages in port 225.0.0.38:12345</p><p>My intention is to share the message sent from one wireless client to a group of wireless client (can go upto 64 clients) also router custom software also listens to this and process it. Instead of sending this data to each client, i thought multicast is better option, but it is not working at the moment for my needs.</p><p>Scenario #1 :- one wireless client is the multicast sender, other wireless clients and router are listeners<br />-------------------<br />tab1 (mulitcast server sending messages to 225.0.0.38 12345) - running android multicast app (red color logo)<br />tab2 (multicast client listening on 225.0.0.38 12345) - running android multicast tester app (blue color logo)<br />tab3 (multicast client listening on 225.0.0.38 12345) - custom android app written by me<br />openwrt router (custom multicast client software listening on 225.0.0.38 12345 wlan0 (i tried without hardcore binding - but still the same result)<br />Observation :- tab2 and tab3 can receive the multicast message properly but openwrt router cant receive.</p><p>Scenario#2 :- router is the multicast sender, other wireless clients and linux PC connected on the network (Ethernet)&nbsp; are listener<br />-----------------<br />Observation :- PC application (same custom multicast client software without wireless binding wlan0) works as expected.<br />tab1, tab2, tab3 - nothing received.</p><p>Any idea why this is happening, I&#039;m new to OpenWRT and trying my best to get it working, but i think I&#039;m kind of stuck on this ?</p><p>Supporting Information<br />----------------------------<br />igmpsnooping is running</p><p>OpenWrt:/# cat /sys/devices/virtual/net/br-lan/bridge/multicast_snooping<br />1<br />&lt;= tried &#039;0&#039; too<br />echo &quot;0&quot; &gt; /sys/devices/virtual/net/br-lan/bridge/multicast_snooping</p><p>br-lan&nbsp; &nbsp; Link encap:Ethernet&nbsp; HWaddr FE:ED:F0:0D:A1:10<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:192.168.1.45&nbsp; Bcast:192.168.1.255&nbsp; Mask:255.255.255.0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:18385 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:772 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:1000<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:1886205 (1.7 MiB)&nbsp; TX bytes:54952 (53.6 KiB)</p><p>wlan0&nbsp; &nbsp; &nbsp;Link encap:Ethernet&nbsp; HWaddr 00:11:33:22:44:55<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:11.11.11.1&nbsp; Bcast:11.11.11.255&nbsp; Mask:255.255.255.0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:6139 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:6215 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:1000<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:501496 (489.7 KiB)&nbsp; TX bytes:633292 (618.4 KiB)</p><p>OpenWrt:/# cat /etc/config/network</p><p>config interface &#039;loopback&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname &#039;lo&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;static&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr &#039;127.0.0.1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask &#039;255.0.0.0&#039;</p><p>config globals &#039;globals&#039;</p><p>config interface &#039;lan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option type &#039;bridge&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname &#039;eth0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;static&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask &#039;255.255.255.0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option macaddr &#039;fe:ed:f0:0d:a1:10&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr &#039;192.168.1.45&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option gateway &#039;192.168.1.1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option dns &#039;192.168.1.250&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option broadcast &#039;192.168.1.255&#039;</p><p>config interface &#039;wifi&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;static&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr &#039;11.11.11.1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option macaddr &#039;fe:ed:f0:0d:a1:11&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask &#039;255.255.255.0&#039;</p><p>OpenWrt:/# cat /etc/config/wireless</p><p>config wifi-device &#039;radio0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option type &#039;mac80211&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option channel &#039;11&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option hwmode &#039;11g&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option path &#039;platform/ar933x_wmac&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option htmode &#039;HT20&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option disabled &#039;0&#039;</p><p>config wifi-iface<br />&nbsp; &nbsp; &nbsp; &nbsp; option device &#039;radio0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option mode &#039;ap&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option network &#039;wifi&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ssid &#039;Olimex_Test01_BS&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option encryption &#039;psk2&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option key &#039;ZigZag1968&#039;</p><br /><p>OpenWrt:/# cat /etc/config/ igmpproxy<br />config igmpproxy<br />&nbsp; &nbsp; &nbsp; &nbsp; option quickleave 1<br />#&nbsp; &nbsp; &nbsp; &nbsp;option verbose [0-2]</p><p>config phyint wan<br />&nbsp; &nbsp; &nbsp; &nbsp; option network wan<br />&nbsp; &nbsp; &nbsp; &nbsp; option direction upstream<br />&nbsp; &nbsp; &nbsp; &nbsp; list altnet 192.168.1.0/24</p><p>config phyint lan<br />&nbsp; &nbsp; &nbsp; &nbsp; option network lan<br />&nbsp; &nbsp; &nbsp; &nbsp; option direction downstream</p><p>OpenWrt:/# cat /etc/igmpproxy.conf<br />quickleave</p><p>OpenWrt:/# cat /etc/config/dhcp</p><p>config dnsmasq<br />&nbsp; &nbsp; &nbsp; &nbsp; option domainneeded &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option boguspriv &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option filterwin2k &#039;0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option localise_queries &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option rebind_protection &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option rebind_localhost &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option local &#039;/lan/&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option domain &#039;lan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option expandhosts &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option nonegcache &#039;0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option authoritative &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option readethers &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option leasefile &#039;/tmp/dhcp.leases&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option resolvfile &#039;/tmp/resolv.conf.auto&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option localservice &#039;1&#039;</p><p>config dhcp &#039;wifi&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option interface &#039;wifi&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option start &#039;2&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option limit &#039;64&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option leasetime &#039;12h&#039;</p><p>OpenWrt:/# cat /etc/config/firewall<br />config defaults<br />&nbsp; &nbsp; &nbsp; &nbsp; option syn_flood&nbsp; &nbsp; &nbsp; &nbsp; 1<br />&nbsp; &nbsp; &nbsp; &nbsp; option input&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ACCEPT<br />&nbsp; &nbsp; &nbsp; &nbsp; option output&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ACCEPT<br />&nbsp; &nbsp; &nbsp; &nbsp; option forward&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; REJECT<br /># Uncomment this line to disable ipv6 rules<br />#&nbsp; &nbsp; &nbsp; &nbsp;option disable_ipv6&nbsp; &nbsp; &nbsp;1</p><p>config zone<br />&nbsp; &nbsp; &nbsp; &nbsp; option name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lan<br />&nbsp; &nbsp; &nbsp; &nbsp; list&nbsp; &nbsp;network&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#039;lan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option input&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ACCEPT<br />&nbsp; &nbsp; &nbsp; &nbsp; option output&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ACCEPT<br />&nbsp; &nbsp; &nbsp; &nbsp; option forward&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ACCEPT</p><p>config zone<br />&nbsp; &nbsp; &nbsp; &nbsp; option name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;wan<br />&nbsp; &nbsp; &nbsp; &nbsp; list&nbsp; &nbsp;network&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#039;wan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; list&nbsp; &nbsp;network&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#039;wan6&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option input&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; REJECT<br />&nbsp; &nbsp; &nbsp; &nbsp; option output&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ACCEPT<br />&nbsp; &nbsp; &nbsp; &nbsp; option forward&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; REJECT<br />&nbsp; &nbsp; &nbsp; &nbsp; option masq&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1<br />&nbsp; &nbsp; &nbsp; &nbsp; option mtu_fix&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1</p><p>config forwarding<br />&nbsp; &nbsp; &nbsp; &nbsp; option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lan<br />&nbsp; &nbsp; &nbsp; &nbsp; option dest&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;wan</p><p># We need to accept udp packets on port 68,<br />config rule<br />&nbsp; &nbsp; &nbsp; &nbsp; option name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Allow-DHCP-Renew<br />&nbsp; &nbsp; &nbsp; &nbsp; option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wan<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; udp<br />&nbsp; &nbsp; &nbsp; &nbsp; option dest_port&nbsp; &nbsp; &nbsp; &nbsp; 68<br />&nbsp; &nbsp; &nbsp; &nbsp; option target&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ACCEPT<br />&nbsp; &nbsp; &nbsp; &nbsp; option family&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ipv4</p><p># Allow IPv4 ping<br />config rule<br />&nbsp; &nbsp; &nbsp; &nbsp; option name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Allow-Ping<br />&nbsp; &nbsp; &nbsp; &nbsp; option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wan<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; icmp<br />&nbsp; &nbsp; &nbsp; &nbsp; option icmp_type&nbsp; &nbsp; &nbsp; &nbsp; echo-request<br />&nbsp; &nbsp; &nbsp; &nbsp; option family&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ipv4<br />&nbsp; &nbsp; &nbsp; &nbsp; option target&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ACCEPT</p><p>config rule<br />&nbsp; &nbsp; &nbsp; &nbsp; option name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Allow-IGMP<br />&nbsp; &nbsp; &nbsp; &nbsp; option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wan<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; igmp<br />&nbsp; &nbsp; &nbsp; &nbsp; option family&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ipv4<br />&nbsp; &nbsp; &nbsp; &nbsp; option target&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ACCEPT</p><p># Allow DHCPv6 replies<br />config rule<br />&nbsp; &nbsp; &nbsp; &nbsp; option name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Allow-DHCPv6<br />&nbsp; &nbsp; &nbsp; &nbsp; option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wan<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; udp<br />&nbsp; &nbsp; &nbsp; &nbsp; option src_ip&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;fc00::/6<br />&nbsp; &nbsp; &nbsp; &nbsp; option dest_ip&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fc00::/6<br />&nbsp; &nbsp; &nbsp; &nbsp; option dest_port&nbsp; &nbsp; &nbsp; &nbsp; 546<br />&nbsp; &nbsp; &nbsp; &nbsp; option family&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ipv6<br />&nbsp; &nbsp; &nbsp; &nbsp; option target&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ACCEPT</p><p>config rule<br />&nbsp; &nbsp; &nbsp; &nbsp; option name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Allow-MLD<br />&nbsp; &nbsp; &nbsp; &nbsp; option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wan<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; icmp<br />&nbsp; &nbsp; &nbsp; &nbsp; option src_ip&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;fe80::/10<br />&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#039;130/0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#039;131/0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#039;132/0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#039;143/0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option family&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ipv6<br />&nbsp; &nbsp; &nbsp; &nbsp; option target&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ACCEPT</p><p># Allow essential incoming IPv6 ICMP traffic<br />config rule<br />&nbsp; &nbsp; &nbsp; &nbsp; option name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Allow-ICMPv6-Input<br />&nbsp; &nbsp; &nbsp; &nbsp; option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wan<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; icmp<br />&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo-request<br />&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo-reply<br />&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; destination-unreachable<br />&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; packet-too-big<br />&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; time-exceeded<br />&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bad-header<br />&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; unknown-header-type<br />&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; router-solicitation<br />&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; neighbour-solicitation<br />&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; router-advertisement<br />&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; neighbour-advertisement<br />&nbsp; &nbsp; &nbsp; &nbsp; option limit&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1000/sec<br />&nbsp; &nbsp; &nbsp; &nbsp; option family&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ipv6<br />&nbsp; &nbsp; &nbsp; &nbsp; option target&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ACCEPT</p><p># Allow essential forwarded IPv6 ICMP traffic<br />config rule<br />&nbsp; &nbsp; &nbsp; &nbsp; option name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Allow-ICMPv6-Forward<br />&nbsp; &nbsp; &nbsp; &nbsp; option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wan<br />&nbsp; &nbsp; &nbsp; &nbsp; option dest&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; icmp<br />&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo-request<br />&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo-reply<br />&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; destination-unreachable<br />&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; packet-too-big<br />&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; time-exceeded<br />&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bad-header<br />&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; unknown-header-type<br />&nbsp; &nbsp; &nbsp; &nbsp; option limit&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1000/sec<br />&nbsp; &nbsp; &nbsp; &nbsp; option family&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ipv6<br />&nbsp; &nbsp; &nbsp; &nbsp; option target&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ACCEPT</p><p># include a file with users custom iptables rules<br />config include<br />&nbsp; &nbsp; &nbsp; &nbsp; option path /etc/firewall.user</p><p># allow IPsec/ESP and ISAKMP passthrough<br />config rule<br />&nbsp; &nbsp; &nbsp; &nbsp; option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wan<br />&nbsp; &nbsp; &nbsp; &nbsp; option dest&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lan<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; esp<br />&nbsp; &nbsp; &nbsp; &nbsp; option target&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ACCEPT</p><p>config rule<br />&nbsp; &nbsp; &nbsp; &nbsp; option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wan<br />&nbsp; &nbsp; &nbsp; &nbsp; option dest&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lan<br />&nbsp; &nbsp; &nbsp; &nbsp; option dest_port&nbsp; &nbsp; &nbsp; &nbsp; 500<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; udp<br />&nbsp; &nbsp; &nbsp; &nbsp; option target&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ACCEPT</p><p>custom client software (both with dedicated interface connection - wlan0 and non dedicated it is still the same.</p><p>#define GROUP_PORT&nbsp; &nbsp; &nbsp; 12345<br />#define GROUP_ADDRESS&nbsp; &nbsp;&quot;225.0.0.38&quot;<br />#define NETWORK_IF_NAME &quot;wlan0&quot;</p><p>int main(int argc, char *argv[])<br />{<br />&nbsp; &nbsp; struct sockaddr_in addr;<br />&nbsp; &nbsp; struct ip_mreq mreq;<br />&nbsp; &nbsp; int hndlSocket, nbytes,addrlen;<br />&nbsp; &nbsp; char message[32];<br />&nbsp; &nbsp; u_int allow=1;<br />&nbsp; &nbsp; struct ifreq ifr;</p><p>&nbsp; &nbsp; /* set up destination address */<br />&nbsp; &nbsp; memset(&amp;addr, 0, sizeof(addr));<br />&nbsp; &nbsp; addr.sin_family&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= AF_INET;<br />&nbsp; &nbsp; addr.sin_addr.s_addr&nbsp; &nbsp; = htonl(INADDR_ANY); /* N.B.: differs from sender */<br />&nbsp; &nbsp; addr.sin_port&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= htons(GROUP_PORT);</p><p>&nbsp; &nbsp; /* use setsockopt() to request that the kernel join a multicast group */<br />&nbsp; &nbsp; mreq.imr_multiaddr.s_addr&nbsp; &nbsp;= inet_addr(GROUP_ADDRESS);<br />&nbsp; &nbsp; mreq.imr_interface.s_addr&nbsp; &nbsp;= htonl(INADDR_ANY);</p><p>&nbsp; &nbsp; memset(&amp;ifr, 0, sizeof(struct ifreq));<br />&nbsp; &nbsp; snprintf(ifr.ifr_name, sizeof(ifr.ifr_name), NETWORK_IF_NAME);</p><p>&nbsp; &nbsp; /* create what looks like an ordinary UDP socket */<br />&nbsp; &nbsp; if ((hndlSocket = socket(AF_INET, SOCK_DGRAM, 0)) &lt; 0) <br />&nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; perror(&quot;socket&quot;); exit(1);<br />&nbsp; &nbsp; }<br />&nbsp; &nbsp; /* allow multiple sockets to use the same PORT number */<br />&nbsp; &nbsp; else if (setsockopt(hndlSocket, SOL_SOCKET, SO_REUSEADDR, &amp;allow, sizeof(allow)) &lt; 0) <br />&nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; perror(&quot;Reusing ADDR failed&quot;); exit(1);<br />&nbsp; &nbsp; }<br />&nbsp; &nbsp; /* bind to receive address */<br />&nbsp; &nbsp; else if (bind(hndlSocket, (struct sockaddr *) &amp;addr, sizeof(addr)) &lt; 0) <br />&nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; perror(&quot;bind&quot;);&nbsp; exit(1);<br />&nbsp; &nbsp; }<br />&nbsp; &nbsp; else if (ioctl(hndlSocket, SIOCGIFINDEX, &amp;ifr) &lt; 0) <br />&nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; perror(&quot;ioctl SIOCGIFINDEX&quot;);&nbsp; exit(1);<br />&nbsp; &nbsp; }&nbsp; &nbsp; <br />&nbsp; &nbsp; else if (setsockopt(hndlSocket, SOL_SOCKET, SO_BINDTODEVICE, (void*)&amp;ifr, sizeof(struct ifreq)) &lt; 0)<br />&nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; DEBUG_ERROR(&quot;setsockopt bind to specified interface(%s) failed(%s)&quot;, NETWORK_IF_NAME, strerror(errno)); exit(1);<br />&nbsp; &nbsp; }<br />&nbsp; &nbsp; else if (setsockopt(hndlSocket, IPPROTO_IP, IP_ADD_MEMBERSHIP, &amp;mreq, sizeof(mreq)) &lt; 0) <br />&nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; perror(&quot;setsockopt for multi membership&quot;); exit(1);<br />&nbsp; &nbsp; }</p><p>&nbsp; &nbsp; DEBUG_MIL (&quot;Using multicast address/port %s/%d to listen for incoming message&quot;, GROUP_ADDRESS, GROUP_PORT);</p><p>&nbsp; &nbsp; /* now just enter a read-print loop */<br />&nbsp; &nbsp; while (true)<br />&nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; addrlen = sizeof(addr);<br />&nbsp; &nbsp; &nbsp; &nbsp; if ((nbytes=recvfrom(hndlSocket, message, sizeof(message), 0, (struct sockaddr *) &amp;addr, &amp;addrlen)) &lt; 0) <br />&nbsp; &nbsp; &nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; perror(&quot;recvfrom&quot;); exit(1);<br />&nbsp; &nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp; &nbsp; &nbsp; puts(message);<br />&nbsp; &nbsp; }<br />}</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p344302">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">grajeshkannan</div>
					<div class="post-datetime">
						21 Nov 2016, 13:28					</div>
				</div>
				<div class="post-content content">
					<p>I have now found the solution for this issue. I guess my router was not listening by default on this ip route. When i did ifconfig i saw this, so i got distracted thinking &#039;MULTICAST&#039; below means router too listening to the multicast.<br />wlan0&nbsp; &nbsp; &nbsp;Link encap:Ethernet&nbsp; HWaddr 00:11:33:22:44:55<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:11.11.11.1&nbsp; Bcast:11.11.11.255&nbsp; Mask:255.255.255.0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet6 addr: fe80::211:33ff:fe22:4455/64 Scope:Link<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1</p><p>route add -net 224.0.0.0 netmask 224.0.0.0 wlan0</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>