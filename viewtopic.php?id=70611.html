<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> OpenVPN configuration on two routers (server, client)</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 6 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p356316">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">marceckos</div>
					<div class="post-datetime">
						15 Apr 2017, 11:27					</div>
				</div>
				<div class="post-content content">
					<p>Hello everyone!</p><p>Please help me to solve this issue.</p><p>I&#039;m killing third day to configure routers to establish link between two offices. I&#039;m trying to avoid the installation of an OpenVPN Client in each computer / server. Instead I&#039;m using OpenWRT routers to create the tunnel (or bridge) where all LAN traffics can be exchanged between like they are connected to one big switch. </p><p>The setup should be similar to this: </p><p>[i67.tinypic.com/2v3qw05.jpg] - (I couldn&#039;t insert image here, 0 allowed links?) </p><p>On Windows, It went very easy. But on OpenWrt I&#039;m having difficulties.</p><p>I couldn&#039;t configure with manuals on forum.</p><p>I have already installed both firmware and necessary packages on two routers, generated certificates.</p><p>But stuck in configurations (interface, firewall, OpenVPN configurations)</p><p>I will be thankful for your recommendations or even full guidance.</p><p>Have a nice day!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p356340">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">cptdondo</div>
					<div class="post-datetime">
						15 Apr 2017, 23:03					</div>
				</div>
				<div class="post-content content">
					<p>Routed connections can get very difficult when trying to tie Windows together.</p><p>Use TAP, and assign the devices on the the side of the bridge their own block of DHCP addresses.&nbsp; You can have OpenVPN do this.&nbsp; With TAP, the tunnel becomes &quot;invisible&quot; to the individual machines and broadcasts and such will work.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p356353">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">marceckos</div>
					<div class="post-datetime">
						16 Apr 2017, 12:47					</div>
				</div>
				<div class="post-content content">
					<p>I will be thankful if you will give some guidance to solve this. I&#039;m novice in OpenWrt configuration (I&#039;m using it for adblock and OpenVPN server with multi-client). However, as I understood, for this situation I have to set new Interface (tap) with unmanaged firewall rules. Am I right? Really, You will make some great job if you will help me</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p356358">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">ulmwind</div>
					<div class="post-datetime">
						16 Apr 2017, 14:03					</div>
				</div>
				<div class="post-content content">
					<p><strong>marceckos</strong>, start from official manual <a href="https://wiki.openwrt.org/doc/howto/vpn.openvpn">https://wiki.openwrt.org/doc/howto/vpn.openvpn</a><br />Begin from configuring OpenWRT-router as server, and usual PC as client.<br />After that configure OpenWRT-router as client.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p356377">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">marceckos</div>
					<div class="post-datetime">
						16 Apr 2017, 18:56					</div>
				</div>
				<div class="post-content content">
					<p>ulmwind, I did this several times. There is stable VPN connection between server on router and clients from different locations (lan, wifi, two computers in my office, friends), they see each other in LAN and have full interaction. I think the issue is about interface and firewall. I cannot configure interfaces, firewall and server configuration to make two routers connect into one network where everyone has their own private subnets which can see each other like they are connected to the one big switch......</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p356379">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">ulmwind</div>
					<div class="post-datetime">
						16 Apr 2017, 19:07					</div>
				</div>
				<div class="post-content content">
					<p><strong>marceckos</strong>, you want to connect two subnets of the same network? Normal configuration is to connect two <strong>different</strong> subnets. On your picture there are different subntes - X and Y. So you&#039;ve configured server, and you can connect to it from device running client. Now you want to connect from router running client?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p356382">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">marceckos</div>
					<div class="post-datetime">
						16 Apr 2017, 20:05					</div>
				</div>
				<div class="post-content content">
					<p>Exactly. What is more, I want that machines behind the server side could see and exchange files through LAN with&nbsp; machines behind client side and verso-versa.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p356516">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">nextgo</div>
					<div class="post-datetime">
						18 Apr 2017, 11:49					</div>
				</div>
				<div class="post-content content">
					<p>May be my configs will help you:</p><p>On OpenVPN server<br />/etc/config/openvpn<br />-----------------------------<br />config openvpn &#039;VPNserver&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option dev &#039;tun0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option comp_lzo &#039;yes&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option keepalive &#039;10 120&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option server &#039;10.0.100.0 255.255.255.0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifconfig &#039;10.0.100.1 10.0.100.2&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; list push &#039;route 192.168.100.0 255.255.255.0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; list push &#039;dhcp-option DNS 192.168.100.1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; list route &#039;192.168.104.0 255.255.255.0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifconfig_pool_persist &#039;/etc/openvpn/ipp.txt&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option client_config_dir &#039;/etc/openvpn/ccd&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option client_to_client &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option dh &#039;/etc/openvpn/keys/dh4096.pem&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ca &#039;/etc/openvpn/keys/ca.crt&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option cert &#039;/etc/openvpn/keys/gw1.crt&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option key &#039;/etc/openvpn/keys/gw1.key&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option tls_auth &#039;/etc/openvpn/keys/ta.key 1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option log &#039;/tmp/openvpn.log&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option status &#039;/tmp/openvpn-status.log&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option verb &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;udp&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option port &#039;1194&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option enabled &#039;1&#039;<br />----------------------------------<br />On OpenVPN client<br />/etc/config/openvpn<br />-----------------------------<br />config openvpn &#039;VPNclient&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option nobind &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option float &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option dev &#039;tun0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;udp&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option persist_tun &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option persist_key &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ca &#039;/etc/openvpn/keys/ca.crt&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option cert &#039;/etc/openvpn/keys/gw2.crt&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option key &#039;/etc/openvpn/keys/gw2.key&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option tls_auth &#039;/etc/openvpn/keys/ta.key 0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option client &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option remote_cert_tls &#039;server&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option log &#039;/tmp/openvpn.log&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option status &#039;/tmp/openvpn-status.log&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option comp_lzo &#039;yes&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option reneg_sec &#039;0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; list push &#039;dhcp-option DNS 8.8.8.8&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; list push &#039;dhcp-option DNS 8.8.4.4&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; list push &#039;dhcp-option NTP 88.147.254.235&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option verb &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option remote &#039;111.222.333.444 1194&#039; # ip-address your VPN server &amp; port for access<br />&nbsp; &nbsp; &nbsp; &nbsp; option enabled &#039;1&#039;<br />-------------------------------<br />/etc/openvpn/ipp.txt (on VPN-server)<br />-------------------------------<br />gw2,10.0.100.4<br />--------------------------------<br />/etc/openvpn/ccd/gw2 (on VPN-server)<br />--------------------------------<br />iroute 192.168.104.0 255.255.255.0<br />--------------------------------<br />route (any part on VPN server)<br />--------------------------------<br />192.168.100.0&nbsp; &nbsp;*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.255.255.0&nbsp; &nbsp;U&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 br-lan<br />192.168.104.0&nbsp; &nbsp;10.0.100.2&nbsp; &nbsp; &nbsp; 255.255.255.0&nbsp; &nbsp;UG&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 tun0<br />--------------------------------<br />route (any part on VPN client)<br />--------------------------------<br />192.168.100.0&nbsp; &nbsp;10.0.100.5&nbsp; &nbsp; &nbsp; 255.255.255.0&nbsp; &nbsp;UG&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 tun0<br />192.168.104.0&nbsp; &nbsp;*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.255.255.0&nbsp; &nbsp;U&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 br-lan<br />--------------------------------<br />/etc/config/firewall<br />--------------------------------<br />config zone<br />&nbsp; &nbsp; &nbsp; &nbsp; option input &#039;ACCEPT&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option output &#039;ACCEPT&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option name &#039;vpn&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option forward &#039;ACCEPT&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option network &#039;vpn0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option masq &#039;1&#039;</p><p>config forwarding<br />&nbsp; &nbsp; &nbsp; &nbsp; option dest &#039;lan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option src &#039;vpn&#039;</p><p>config forwarding<br />&nbsp; &nbsp; &nbsp; &nbsp; option dest &#039;vpn&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option src &#039;lan&#039;</p><p>config rule<br />&nbsp; &nbsp; &nbsp; &nbsp; option target &#039;ACCEPT&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;udp&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option dest_port &#039;1194&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option name &#039;Open1194&#039;</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p356545">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">marceckos</div>
					<div class="post-datetime">
						18 Apr 2017, 22:41					</div>
				</div>
				<div class="post-content content">
					<p><strong>nextgo</strong> thank you bro. I will test this configs and let you know results.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p363083">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">carliedu</div>
					<div class="post-datetime">
						2 Aug 2017, 22:01					</div>
				</div>
				<div class="post-content content">
					<p>Hi Nextgo,</p><p>I&#039;m having great difficulties to &quot;deciphrate&quot; the samples I&#039;m finding in the net.<br /> I would like to try your config, but I would like to understand each line in the configs.</p><p>Can you post an schema or explanation of what each IP or range in you config is? What is the LAN IP of the server and what is the LAN IP of the client? </p><p>What are each of the following IPs:<br />&nbsp; &nbsp; &nbsp; &nbsp; option server &#039;10.0.100.0 255.255.255.0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifconfig &#039;10.0.100.1 10.0.100.2&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; list push &#039;route 192.168.100.0 255.255.255.0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; list push &#039;dhcp-option DNS 192.168.100.1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; list route &#039;192.168.104.0 255.255.255.0&#039;</p><p>The only IP that I can understand is 111.222.333.444 = Server WAN IP.</p><br /><p>What you mean with:</p><p>/etc/openvpn/ccd/gw2 (on VPN-server)<br />--------------------------------<br />iroute 192.168.104.0 255.255.255.0<br />--------------------------------<br />route (any part on VPN server) <span class="bbu"><em><strong> ---&gt; is this part of file /etc/openvpn/ccd/gw2?</strong></em></span><br />--------------------------------<br />192.168.100.0&nbsp; &nbsp;*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.255.255.0&nbsp; &nbsp;U&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 br-lan<br />192.168.104.0&nbsp; &nbsp;10.0.100.2&nbsp; &nbsp; &nbsp; 255.255.255.0&nbsp; &nbsp;UG&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 tun0<br />--------------------------------<br />route (any part on VPN client) <span class="bbu"><em><strong> ---&gt; is this part of file /etc/openvpn/ccd/gw2?</strong></em></span><br />--------------------------------<br />192.168.100.0&nbsp; &nbsp;10.0.100.5&nbsp; &nbsp; &nbsp; 255.255.255.0&nbsp; &nbsp;UG&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 tun0<br />192.168.104.0&nbsp; &nbsp;*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.255.255.0&nbsp; &nbsp;U&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 br-lan</p><p>Thank you in advance.</p><p>Best regards,<br />Eduardo</p>											<p class="post-edited">(Last edited by <strong>carliedu</strong> on 2 Aug 2017, 22:08)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>