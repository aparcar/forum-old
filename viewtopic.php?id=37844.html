<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> OpenVPN Server - external clients can&#039;t connect, LAN clients can</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 13 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p171380">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">alexander_doni</div>
					<div class="post-datetime">
						2 Jul 2012, 23:00					</div>
				</div>
				<div class="post-content content">
					<p>Hi everyone! <br />I&#039;m trying to set a OpenVPN server up on my TL-WR842ND router. </p><p>To start server I don&#039;t use init.d script because it doesn&#039;t work so I write in the command line &quot;openvpn --config /etc/config/openvpn&quot;.<br />Server starts succesfully and I can connect from the LAN. Looking at OpenVPN logs everything looks good, no errors, only one warning.<br />Then I&#039;ve tried to log from the internet. I have installed openvpn client and passed certificates and configuration file via scp. When I have tried to connect obviously it doesn&#039;t.</p><p>I&#039;ve checked client log and it says:</p><p>Mon Jul 02 17:28:47 2012 Restart pause, 2 second(s)<br />Mon Jul 02 17:28:49 2012 WARNING: No server certificate verification method has been enabled.&nbsp; See <a href="http://openvpn.net/howto.html#mitm">http://openvpn.net/howto.html#mitm</a> for more info.<br />Mon Jul 02 17:28:49 2012 NOTE: OpenVPNAS 2.1 requires &#039;--script-security 2&#039; or higher to call user-defined scripts or executables<br />Mon Jul 02 17:28:49 2012 Re-using SSL/TLS context<br />Mon Jul 02 17:28:49 2012 LZO compression initialized<br />Mon Jul 02 17:28:49 2012 Control Channel MTU parms [ L:1558 D:138 EF:38 EB:0 ET:0 EL:0 ]<br />Mon Jul 02 17:28:49 2012 Socket Buffers: R=[8192-&gt;8192] S=[8192-&gt;8192]<br />Mon Jul 02 17:28:49 2012 MANAGEMENT: &gt;STATE:1341242929,RESOLVE,,,<br />Mon Jul 02 17:28:49 2012 Data Channel MTU parms [ L:1558 D:1450 EF:58 EB:135 ET:0 EL:0 AF:3/1 ]<br />Mon Jul 02 17:28:49 2012 Local Options hash (VER=V4): &#039;22188c5b&#039;<br />Mon Jul 02 17:28:49 2012 Expected Remote Options hash (VER=V4): &#039;a8f55717&#039;<br />Mon Jul 02 17:28:49 2012 UDPv4 link local: [undef]<br />Mon Jul 02 17:28:49 2012 UDPv4 link remote: 151.33.240.12:1200<br />Mon Jul 02 17:28:49 2012 MANAGEMENT: &gt;STATE:1341242929,WAIT,,,<br />Mon Jul 02 17:28:50 2012 read UDPv4: Connection reset by peer (WSAECONNRESET) (code=10054)<br />Mon Jul 02 17:28:51 2012 read UDPv4: Connection reset by peer (WSAECONNRESET) (code=10054)</p><br /><br /><p>My server configuration file is this:<br /></p><div class="codebox"><pre><code>#################################################
# Sample OpenVPN 2.0 config file for            #
# multi-client server.                          #
#                                               #
# This file is for the server side              #
# of a many-clients  one-server              #
# OpenVPN configuration.                        #
#                                               #
# OpenVPN also supports                         #
# single-machine  single-machine             #
# configurations (See the Examples page         #
# on the web site for more info).               #
#                                               #
# This config should work on Windows            #
# or Linux/BSD systems.  Remember on            #
# Windows to quote pathnames and use            #
# double backslashes, e.g.:                     #
# &quot;C:\\Program Files\\OpenVPN\\config\\foo.key&quot; #
#                                               #
# Comments are preceded with &#039;#&#039; or &#039;;&#039;         #
#################################################

# Which local IP address should OpenVPN
# listen on? (optional)
;

# Which TCP/UDP port should OpenVPN listen on?
# If you want to run multiple OpenVPN instances
# on the same machine, use a different port
# number for each one.  You will need to
# open up this port on your firewall.
port 1200

# TCP or UDP server?
;proto tcp
proto udp

# &quot;dev tun&quot; will create a routed IP tunnel,
# &quot;dev tap&quot; will create an ethernet tunnel.
# Use &quot;dev tap0&quot; if you are ethernet bridging
# and have precreated a tap0 virtual interface
# and bridged it with your ethernet interface.
# If you want to control access policies
# over the VPN, you must create firewall
# rules for the the TUN/TAP interface.
# On non-Windows systems, you can give
# an explicit unit number, such as tun0.
# On Windows, use &quot;dev-node&quot; for this.
# On most systems, the VPN will not function
# unless you partially or fully disable
# the firewall for the TUN/TAP interface.
;dev tap
dev tun

# Windows needs the TAP-Win32 adapter name
# from the Network Connections panel if you
# have more than one.  On XP SP2 or higher,
# you may need to selectively disable the
# Windows firewall for the TAP adapter.
# Non-Windows systems usually don&#039;t need this.
;dev-node vpn0

# SSL/TLS root certificate (ca), certificate
# (cert), and private key (key).  Each client
# and the server must have their own cert and
# key file.  The server and all clients will
# use the same ca file.
#
# See the &quot;easy-rsa&quot; directory for a series
# of scripts for generating RSA certificates
# and private keys.  Remember to use
# a unique Common Name for the server
# and each of the client certificates.
#
# Any X509 key management system can be used.
# OpenVPN can also use a PKCS #12 formatted key file
# (see &quot;pkcs12&quot; directive in man page).
ca /etc/openvpn/easy-rsa/keys/ca.crt
cert /etc/openvpn/easy-rsa/keys/server.crt
key /etc/openvpn/easy-rsa/keys/server.key  # This file should be kept secret

# Diffie hellman parameters.
# Generate your own with:
#   openssl dhparam -out dh1024.pem 1024
# Substitute 2048 for 1024 if you are using
# 2048 bit keys. 
dh /etc/openvpn/easy-rsa/keys/dh1024.pem

# Configure server mode and supply a VPN subnet
# for OpenVPN to draw client addresses from.
# The server will take 10.8.0.1 for itself,
# the rest will be made available to clients.
# Each client will be able to reach the server
# on 10.8.0.1. Comment this line out if you are
# ethernet bridging. See the man page for more info.
server 10.32.0.0 255.255.0.0

# Maintain a record of client  virtual IP address
# associations in this file.  If OpenVPN goes down or
# is restarted, reconnecting clients can be assigned
# the same virtual IP address from the pool that was
# previously assigned.
ifconfig-pool-persist /etc/openvpn/ipp.txt

# Configure server mode for ethernet bridging.
# You must first use your OS&#039;s bridging capability
# to bridge the TAP interface with the ethernet
# NIC interface.  Then you must manually set the
# IP/netmask on the bridge interface, here we
# assume 10.8.0.4/255.255.255.0.  Finally we
# must set aside an IP range in this subnet
# (start=10.8.0.50 end=10.8.0.100) to allocate
# to connecting clients.  Leave this line commented
# out unless you are ethernet bridging.
;server-bridge 10.8.0.4 255.255.255.0 10.8.0.50 10.8.0.100

# Push routes to the client to allow it
# to reach other private subnets behind
# the server.  Remember that these
# private subnets will also need
# to know to route the OpenVPN client
# address pool (10.8.0.0/255.255.255.0)
# back to the OpenVPN server.
;push &quot;route 192.168.1.0 255.255.255.0&quot;
;push &quot;route 192.168.20.0 255.255.255.0&quot;

# To assign specific IP addresses to specific
# clients or if a connecting client has a private
# subnet behind it that should also have VPN access,
# use the subdirectory &quot;ccd&quot; for client-specific
# configuration files (see man page for more info).

# EXAMPLE: Suppose the client
# having the certificate common name &quot;Thelonious&quot;
# also has a small subnet behind his connecting
# machine, such as 192.168.40.128/255.255.255.248.
# First, uncomment out these lines:
client-config-dir /etc/openvpn/client-config-dir
;route 192.168.40.128 255.255.255.248
# Then create a file ccd/Thelonious with this line:
#   iroute 192.168.40.128 255.255.255.248
# This will allow Thelonious&#039; private subnet to
# access the VPN.  This example will only work
# if you are routing, not bridging, i.e. you are
# using &quot;dev tun&quot; and &quot;server&quot; directives.

# EXAMPLE: Suppose you want to give
# Thelonious a fixed VPN IP address of 10.9.0.1.
# First uncomment out these lines:
;client-config-dir ccd
;route 10.9.0.0 255.255.255.252
# Then add this line to ccd/Thelonious:
#   ifconfig-push 10.9.0.1 10.9.0.2

# Suppose that you want to enable different
# firewall access policies for different groups
# of clients.  There are two methods:
# (1) Run multiple OpenVPN daemons, one for each
#     group, and firewall the TUN/TAP interface
#     for each group/daemon appropriately.
# (2) (Advanced) Create a script to dynamically
#     modify the firewall in response to access
#     from different clients.  See man
#     page for more info on learn-address script.
;learn-address ./script

# If enabled, this directive will configure
# all clients to redirect their default
# network gateway through the VPN, causing
# all IP traffic such as web browsing and
# and DNS lookups to go through the VPN
# (The OpenVPN server machine may need to NAT
# the TUN/TAP interface to the internet in
# order for this to work properly).
# CAVEAT: May break client&#039;s network config if
# client&#039;s local DHCP server packets get routed
# through the tunnel.  Solution: make sure
# client&#039;s local DHCP server is reachable via
# a more specific route than the default route
# of 0.0.0.0/0.0.0.0.
;push &quot;redirect-gateway&quot;

# Certain Windows-specific network settings
# can be pushed to clients, such as DNS
# or WINS server addresses.  CAVEAT:
# http://openvpn.net/faq.html#dhcpcaveats
push &quot;dhcp-option DNS ninisserver.dyndns-server.com&quot;
;push &quot;dhcp-option WINS 10.8.0.1&quot;

# Uncomment this directive to allow different
# clients to be able to &quot;see&quot; each other.
# By default, clients will only see the server.
# To force clients to only see the server, you
# will also need to appropriately firewall the
# server&#039;s TUN/TAP interface.
client-to-client

# Uncomment this directive if multiple clients
# might connect with the same certificate/key
# files or common names.  This is recommended
# only for testing purposes.  For production use,
# each client should have its own certificate/key
# pair.
#
# IF YOU HAVE NOT GENERATED INDIVIDUAL
# CERTIFICATE/KEY PAIRS FOR EACH CLIENT,
# EACH HAVING ITS OWN UNIQUE &quot;COMMON NAME&quot;,
# UNCOMMENT THIS LINE OUT.
;duplicate-cn

# The keepalive directive causes ping-like
# messages to be sent back and forth over
# the link so that each side knows when
# the other side has gone down.
# Ping every 10 seconds, assume that remote
# peer is down if no ping received during
# a 120 second time period.
keepalive 60 120

# For extra security beyond that provided
# by SSL/TLS, create an &quot;HMAC firewall&quot;
# to help block DoS attacks and UDP port flooding.
#
# Generate with:
#   openvpn --genkey --secret ta.key
#
# The server and each client must have
# a copy of this key.
# The second parameter should be &#039;0&#039;
# on the server and &#039;1&#039; on the clients.
;tls-auth /etc/openvpn/easy-rsa/keys/ta.key 0 # This file is secret

# Select a cryptographic cipher.
# This config item must be copied to
# the client config file as well.
;cipher BF-CBC        # Blowfish (default)
cipher AES-256-CBC   # AES
;cipher DES-EDE3-CBC  # Triple-DES

# Enable compression on the VPN link.
# If you enable it here, you must also
# enable it in the client config file.
comp-lzo

# The maximum number of concurrently connected
# clients we want to allow.
;max-clients 100

# It&#039;s a good idea to reduce the OpenVPN
# daemon&#039;s privileges after initialization.
#
# You can uncomment this out on
# non-Windows systems.
user nobody
group nogroup

# The persist options will try to avoid
# accessing certain resources on restart
# that may no longer be accessible because
# of the privilege downgrade.
persist-key
persist-tun

# Output a short status file showing
# current connections, truncated
# and rewritten every minute.
status /etc/openvpn/openvpn-status.log

# By default, log messages will go to the syslog (or
# on Windows, if running as a service, they will go to
# the &quot;\Program Files\OpenVPN\log&quot; directory).
# Use log or log-append to override this default.
# &quot;log&quot; will truncate the log file on OpenVPN startup,
# while &quot;log-append&quot; will append to it.  Use one
# or the other (but not both).
log         /etc/openvpn/openvpn.log
;log-append  /etc/openvpn/openvpn.log

# Set the appropriate level of log
# file verbosity.
#
# 0 is silent, except for fatal errors
# 4 is reasonable for general usage
# 5 and 6 can help to debug connection problems
# 9 is extremely verbose
verb 6

# Silence repeating messages.  At most 20
# sequential messages of the same message
# category will be output to the log.
mute 20

;management localhost 8001

local 192.168.1.1</code></pre></div><p>This is a client config of a generic client:<br /></p><div class="codebox"><pre><code>    ##############################################
    # Sample client-side OpenVPN 2.0 config file #
    # for connecting to multi-client server.     #
    #                                            #
    # This configuration can be used by multiple #
    # clients, however each client should have   #
    # its own cert and key files.                #
    #                                            #
    # On Windows, you might want to rename this  #
    # file so it has a .ovpn extension           #
    ##############################################

    # Specify that we are a client and that we
    # will be pulling certain config file directives
    # from the server.
    client

    # Use the same setting as you are using on
    # the server.
    # On most systems, the VPN will not function
    # unless you partially or fully disable
    # the firewall for the TUN/TAP interface.
    ;dev tap
    dev tun

    # Windows needs the TAP-Win32 adapter name
    # from the Network Connections panel
    # if you have more than one.  On XP SP2,
    # you may need to disable the firewall
    # for the TAP adapter.
    ;dev-node MyTap

    # Are we connecting to a TCP or
    # UDP server?  Use the same setting as
    # on the server.
    ;proto tcp
    proto udp

    # The hostname/IP and port of the server.
    # You can have multiple remote entries
    # to load balance between the servers.
    remote ninisserver.dyndns-server.com 1200
    ;remote my-server-2 1194

    # Choose a random host from the remote
    # list for load-balancing.  Otherwise
    # try hosts in the order specified.
    ;remote-random

    # Keep trying indefinitely to resolve the
    # host name of the OpenVPN server.  Very useful
    # on machines which are not permanently connected
    # to the internet such as laptops.
    resolv-retry infinite

    # Most clients don&#039;t need to bind to
    # a specific local port number.
    nobind

    # Downgrade privileges after initialization (non-Windows only)
    ;user nobody
    ;group nobody

    # Try to preserve some state across restarts.
    persist-key
    persist-tun

    # If you are connecting through an
    # HTTP proxy to reach the actual OpenVPN
    # server, put the proxy server/IP and
    # port number here.  See the man page
    # if your proxy server requires
    # authentication.
    ;http-proxy-retry # retry on connection failures
    ;http-proxy [proxy server] [proxy port #]

    # Wireless networks often produce a lot
    # of duplicate packets.  Set this flag
    # to silence duplicate packet warnings.
    ;mute-replay-warnings

    # SSL/TLS parms.
    # See the server config file for more
    # description.  It&#039;s best to use
    # a separate .crt/.key file pair
    # for each client.  A single ca
    # file can be used for all clients.
    ca ca.crt
    cert client.crt
    key client.key

    # Verify server certificate by checking
    # that the certicate has the nsCertType
    # field set to &quot;server&quot;.  This is an
    # important precaution to protect against
    # a potential attack discussed here:
    #  http://openvpn.net/howto.html#mitm
    #
    # To use this feature, you will need to generate
    # your server certificates with the nsCertType
    # field set to &quot;server&quot;.  The build-key-server
    # script in the easy-rsa folder will do this.
    ;ns-cert-type server

    # If a tls-auth key is used on the server
    # then every client must also have the key.
    ;tls-auth ta.key 1

    # Select a cryptographic cipher.
    # If the cipher option is used on the server
    # then you must also specify it here.
    cipher AES-256-CBC

    # Enable compression on the VPN link.
    # Don&#039;t enable this unless it is also
    # enabled in the server config file.
    comp-lzo

    # Set log file verbosity.
    verb 3

    # Silence repeating messages
    ;mute 20</code></pre></div><p>/etc/config/firewall is:<br /></p><div class="codebox"><pre><code>config defaults
    option syn_flood &#039;1&#039;
    option input &#039;ACCEPT&#039;
    option output &#039;ACCEPT&#039;
    option forward &#039;REJECT&#039;

config zone
    option name &#039;lan&#039;
    option input &#039;ACCEPT&#039;
    option output &#039;ACCEPT&#039;
    option forward &#039;REJECT&#039;
    option network &#039;lan&#039;

config zone
    option name &#039;wan&#039;
    option network &#039;wan&#039;
    option input &#039;REJECT&#039;
    option output &#039;ACCEPT&#039;
    option masq &#039;1&#039;
    option mtu_fix &#039;1&#039;
    option forward &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-DHCP-Renew&#039;
    option src &#039;wan&#039;
    option proto &#039;udp&#039;
    option dest_port &#039;68&#039;
    option target &#039;ACCEPT&#039;
    option family &#039;ipv4&#039;

config rule
    option name &#039;Allow-Ping&#039;
    option src &#039;wan&#039;
    option proto &#039;icmp&#039;
    option icmp_type &#039;echo-request&#039;
    option family &#039;ipv4&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-DHCPv6&#039;
    option src &#039;wan&#039;
    option proto &#039;udp&#039;
    option src_ip &#039;fe80::/10&#039;
    option src_port &#039;547&#039;
    option dest_ip &#039;fe80::/10&#039;
    option dest_port &#039;546&#039;
    option family &#039;ipv6&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-ICMPv6-Input&#039;
    option src &#039;wan&#039;
    option proto &#039;icmp&#039;
    list icmp_type &#039;echo-request&#039;
    list icmp_type &#039;echo-reply&#039;
    list icmp_type &#039;destination-unreachable&#039;
    list icmp_type &#039;packet-too-big&#039;
    list icmp_type &#039;time-exceeded&#039;
    list icmp_type &#039;bad-header&#039;
    list icmp_type &#039;unknown-header-type&#039;
    list icmp_type &#039;router-solicitation&#039;
    list icmp_type &#039;neighbour-solicitation&#039;
    option limit &#039;1000/sec&#039;
    option family &#039;ipv6&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-ICMPv6-Forward&#039;
    option src &#039;wan&#039;
    option dest &#039;*&#039;
    option proto &#039;icmp&#039;
    list icmp_type &#039;echo-request&#039;
    list icmp_type &#039;echo-reply&#039;
    list icmp_type &#039;destination-unreachable&#039;
    list icmp_type &#039;packet-too-big&#039;
    list icmp_type &#039;time-exceeded&#039;
    list icmp_type &#039;bad-header&#039;
    list icmp_type &#039;unknown-header-type&#039;
    option limit &#039;1000/sec&#039;
    option family &#039;ipv6&#039;
    option target &#039;ACCEPT&#039;

config include
    option path &#039;/etc/firewall.user&#039;

config rule
    option target &#039;ACCEPT&#039;
    option src &#039;wan&#039;
    option name &#039;SSH from WAN&#039;
    option dest_port &#039;18000&#039;
    option proto &#039;tcp udp&#039;

config rule
    option target &#039;ACCEPT&#039;
    option src &#039;wan&#039;
    option name &#039;HTTPS from WAN&#039;
    option dest_port &#039;443&#039;
    option proto &#039;tcp&#039;

config rule
    option src &#039;lan&#039;
    option proto &#039;udp&#039;
    option dest_port &#039;137-138&#039;
    option target &#039;ACCEPT&#039;
    option name &#039;Samba1&#039;

config rule
    option src &#039;lan&#039;
    option proto &#039;tcp&#039;
    option dest_port &#039;139&#039;
    option target &#039;ACCEPT&#039;
    option name &#039;Samba2&#039;

config rule
    option src &#039;lan&#039;
    option proto &#039;tcp&#039;
    option dest_port &#039;445&#039;
    option target &#039;ACCEPT&#039;
    option name &#039;Samba3&#039;

config rule
    option target &#039;ACCEPT&#039;
    option name &#039;vsftpd-FTP&#039;
    option src &#039;wan&#039;
    option family &#039;ipv4&#039;
    option dest_port &#039;20-21&#039;
    option proto &#039;tcp udp&#039;

config rule
    option name &#039;vsftpd-PASV&#039;
    option target &#039;ACCEPT&#039;
    option src &#039;wan&#039;
    option proto &#039;tcp&#039;
    option dest_port &#039;1026-1040&#039;
    option family &#039;ipv4&#039;

config redirect
    option target &#039;DNAT&#039;
    option src &#039;wan&#039;
    option dest &#039;lan&#039;
    option proto &#039;tcp udp&#039;
    option src_dport &#039;50100&#039;
    option dest_port &#039;50100&#039;
    option name &#039;uTorrent NINISPC&#039;
    option dest_ip &#039;192.168.1.32&#039;

config redirect
    option target &#039;DNAT&#039;
    option src &#039;wan&#039;
    option dest &#039;lan&#039;
    option proto &#039;tcp&#039;
    option src_dport &#039;18429&#039;
    option dest_ip &#039;192.168.1.32&#039;
    option dest_port &#039;18429&#039;
    option name &#039;eMule-NINISPC(TCP)&#039;

config redirect
    option target &#039;DNAT&#039;
    option src &#039;wan&#039;
    option dest &#039;lan&#039;
    option proto &#039;udp&#039;
    option src_dport &#039;52649&#039;
    option dest_ip &#039;192.168.1.32&#039;
    option dest_port &#039;52649&#039;
    option name &#039;eMule-NINISPC(UDP)&#039;

config rule
    option target &#039;ACCEPT&#039;
    option src &#039;wan&#039;
    option name &#039;OpenVPN&#039;
    option proto &#039;udp&#039;
    option dest_port &#039;1200&#039;

config zone
    option input &#039;ACCEPT&#039;
    option forward &#039;REJECT&#039;
    option output &#039;ACCEPT&#039;
    option name &#039;VPN&#039;
    option network &#039;VPN&#039;

config rule
    option target &#039;ACCEPT&#039;
    option src &#039;lan&#039;
    option dest &#039;VPN&#039;
    option name &#039;LAN-&gt;VPN&#039;

config rule
    option target &#039;ACCEPT&#039;
    option src &#039;VPN&#039;
    option dest &#039;lan&#039;
    option name &#039;VPN-&gt;LAN&#039;

config forwarding
    option dest &#039;wan&#039;
    option src &#039;lan&#039;

config forwarding
    option dest &#039;lan&#039;
    option src &#039;wan&#039;</code></pre></div><p>and /etc/config/network is:<br /></p><div class="codebox"><pre><code>config interface &#039;loopback&#039;
    option ifname &#039;lo&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;127.0.0.1&#039;
    option netmask &#039;255.0.0.0&#039;

config interface &#039;lan&#039;
    option ifname &#039;eth0&#039;
    option type &#039;bridge&#039;
    option proto &#039;static&#039;
    option netmask &#039;255.255.255.0&#039;
    option ipaddr &#039;192.168.1.1&#039;

config interface &#039;wan&#039;
    option ifname &#039;eth1&#039;
    option _orig_ifname &#039;eth1&#039;
    option _orig_bridge &#039;false&#039;
    option proto &#039;pppoe&#039;
    option username &#039;benvenuto&#039;
    option password &#039;benvenuto&#039;

config switch
    option name &#039;eth0&#039;
    option reset &#039;1&#039;
    option enable_vlan &#039;1&#039;

config switch_vlan
    option device &#039;eth0&#039;
    option vlan &#039;1&#039;
    option ports &#039;0 1 2 3 4&#039;

config interface &#039;VPN&#039;
    option proto &#039;none&#039;
    option ifname &#039;tun0&#039;</code></pre></div><p>Here are the links of my Zone rules and Traffic rules:<br /><a href="https://dl.dropbox.com/u/64474819/Catturazone.JPG">https://dl.dropbox.com/u/64474819/Catturazone.JPG</a><br /><a href="https://dl.dropbox.com/u/64474819/Catturarules.JPG">https://dl.dropbox.com/u/64474819/Catturarules.JPG</a></p><p>I&#039;ve no rules in /etc/firewall.user</p><p>I do not post log of system or OpenVPN because absolutely nothing appears on them. It&#039;s like these connection attempts never arrived to my router.<br />I&#039;m absolutely sure the ddns is working and i have other services on the wan like ssh, sshfs, scp and ftp which work pretty well.</p><p>I can&#039;t understand the problem at all and you are my only hope,<br />Please help me!!!!!</p><p>Thank you in advance!!!</p><br /><p>EDIT: I&#039;ve found something weird in openvpn server log. It appears that UDPv4 link remote is [undef]. In the meanwhile I&#039;ve just disabled the directive &#039;local&#039; .<br />This is the log:<br />Tue Jul&nbsp; 3 00:41:38 2012 us=640007 OpenVPN 2.2.2 mips-openwrt-linux [SSL] [LZO2] [EPOLL] built on Jun 28 2012<br />Tue Jul&nbsp; 3 00:41:38 2012 us=644131 NOTE: OpenVPN 2.1 requires &#039;--script-security 2&#039; or higher to call user-defined scripts or executables<br />Tue Jul&nbsp; 3 00:41:38 2012 us=788481 Diffie-Hellman initialized with 1024 bit key<br />Tue Jul&nbsp; 3 00:41:38 2012 us=802718 TLS-Auth MTU parms [ L:1558 D:138 EF:38 EB:0 ET:0 EL:0 ]<br />Tue Jul&nbsp; 3 00:41:38 2012 us=803942 Socket Buffers: R=[163840-&gt;131072] S=[163840-&gt;131072]<br />Tue Jul&nbsp; 3 00:41:38 2012 us=811524 TUN/TAP device tun0 opened<br />Tue Jul&nbsp; 3 00:41:38 2012 us=821594 TUN/TAP TX queue length set to 100<br />Tue Jul&nbsp; 3 00:41:38 2012 us=823244 /sbin/ifconfig tun0 10.32.0.1 pointopoint 10.32.0.2 mtu 1500<br />Tue Jul&nbsp; 3 00:41:38 2012 us=864021 /sbin/route add -net 10.32.0.0 netmask 255.255.0.0 gw 10.32.0.2<br />Tue Jul&nbsp; 3 00:41:38 2012 us=873667 Data Channel MTU parms [ L:1558 D:1450 EF:58 EB:135 ET:0 EL:0 AF:3/1 ]<br />Tue Jul&nbsp; 3 00:41:38 2012 us=875107 GID set to nogroup<br />Tue Jul&nbsp; 3 00:41:38 2012 us=876246 UID set to nobody<br />Tue Jul&nbsp; 3 00:41:38 2012 us=877402 UDPv4 link local (bound): [undef]:1200<br />Tue Jul&nbsp; 3 00:41:38 2012 us=878760 UDPv4 link remote: [undef]<br />Tue Jul&nbsp; 3 00:41:38 2012 us=879856 MULTI: multi_init called, r=256 v=256<br />Tue Jul&nbsp; 3 00:41:38 2012 us=894017 IFCONFIG POOL: base=10.32.0.4 size=16382<br />Tue Jul&nbsp; 3 00:41:38 2012 us=895888 IFCONFIG POOL LIST<br />Tue Jul&nbsp; 3 00:41:38 2012 us=896974 Alexander_Doni,10.32.0.4<br />Tue Jul&nbsp; 3 00:41:38 2012 us=898232 Benny,10.32.0.8<br />Tue Jul&nbsp; 3 00:41:38 2012 us=899404 Ninis-Netbook,10.32.0.12<br />Tue Jul&nbsp; 3 00:41:38 2012 us=911007 Initialization Sequence Completed</p>											<p class="post-edited">(Last edited by <strong>alexander_doni</strong> on 3 Jul 2012, 01:48)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p171392">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">luizluca</div>
					<div class="post-datetime">
						3 Jul 2012, 04:21					</div>
				</div>
				<div class="post-content content">
					<p>I always recomends to start with a wireshark/tcpdump capture. It can talk to you much better than a log :-)</p><p>Your firewall seems to be &quot;all open&quot;. However, the best way to &quot;see&quot; it would be with an &quot;iptables -L&quot; output.</p><p>About the &quot;[undef]&quot;, you can check if it is listeting at the correct addresss/port using the netstat command.</p><p>Generally, the &quot;LAN can, WAN can&#039;t&quot; is something related to the listening address, firewall, routing issue (ip route).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p171419">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">alexander_doni</div>
					<div class="post-datetime">
						3 Jul 2012, 13:09					</div>
				</div>
				<div class="post-content content">
					<p>Thank you for the immediate reply!!!<br />I&#039;ve tried a tcpdump capturing from router and for when i connect from the lan it&#039;s ok. He doesn&#039;t capture anything related to log in though but when i ping the server it shows request and reply. I&#039;ll try it from wan as soon as i can.</p><p>This is my iptables -L output:<br /></p><div class="codebox"><pre><code>Chain INPUT (policy ACCEPT)
target     prot opt source               destination
ACCEPT     all  --  anywhere             anywhere            ctstate RELATED,ESTABLISHED
ACCEPT     all  --  anywhere             anywhere
syn_flood  tcp  --  anywhere             anywhere            tcp flags:FIN,SYN,RST,ACK/SYN
input_rule  all  --  anywhere             anywhere
input      all  --  anywhere             anywhere

Chain FORWARD (policy DROP)
target     prot opt source               destination
ACCEPT     all  --  anywhere             anywhere            ctstate RELATED,ESTABLISHED
forwarding_rule  all  --  anywhere             anywhere
forward    all  --  anywhere             anywhere
reject     all  --  anywhere             anywhere

Chain OUTPUT (policy ACCEPT)
target     prot opt source               destination
ACCEPT     all  --  anywhere             anywhere            ctstate RELATED,ESTABLISHED
ACCEPT     all  --  anywhere             anywhere
output_rule  all  --  anywhere             anywhere
output     all  --  anywhere             anywhere

Chain forward (1 references)
target     prot opt source               destination
zone_lan_forward  all  --  anywhere             anywhere
zone_wan_forward  all  --  anywhere             anywhere
zone_VPN_forward  all  --  anywhere             anywhere

Chain forwarding_VPN (1 references)
target     prot opt source               destination

Chain forwarding_lan (1 references)
target     prot opt source               destination

Chain forwarding_rule (1 references)
target     prot opt source               destination
nat_reflection_fwd  all  --  anywhere             anywhere

Chain forwarding_wan (1 references)
target     prot opt source               destination

Chain input (1 references)
target     prot opt source               destination
zone_lan   all  --  anywhere             anywhere
zone_wan   all  --  anywhere             anywhere
zone_VPN   all  --  anywhere             anywhere

Chain input_VPN (1 references)
target     prot opt source               destination

Chain input_lan (1 references)
target     prot opt source               destination

Chain input_rule (1 references)
target     prot opt source               destination

Chain input_wan (1 references)
target     prot opt source               destination

Chain nat_reflection_fwd (1 references)
target     prot opt source               destination
ACCEPT     tcp  --  192.168.1.0/24       NINISPC.lan         tcp dpt:50100
ACCEPT     udp  --  192.168.1.0/24       NINISPC.lan         udp dpt:50100
ACCEPT     tcp  --  192.168.1.0/24       NINISPC.lan         tcp dpt:18429
ACCEPT     udp  --  192.168.1.0/24       NINISPC.lan         udp dpt:52649

Chain output (1 references)
target     prot opt source               destination
zone_lan_ACCEPT  all  --  anywhere             anywhere
zone_wan_ACCEPT  all  --  anywhere             anywhere
zone_VPN_ACCEPT  all  --  anywhere             anywhere

Chain output_rule (1 references)
target     prot opt source               destination

Chain reject (7 references)
target     prot opt source               destination
REJECT     tcp  --  anywhere             anywhere            reject-with tcp-reset
REJECT     all  --  anywhere             anywhere            reject-with icmp-port-unreachable

Chain syn_flood (1 references)
target     prot opt source               destination
RETURN     tcp  --  anywhere             anywhere            tcp flags:FIN,SYN,RST,ACK/SYN limit: avg 25/sec burst 50
DROP       all  --  anywhere             anywhere

Chain zone_VPN (1 references)
target     prot opt source               destination
input_VPN  all  --  anywhere             anywhere
zone_VPN_ACCEPT  all  --  anywhere             anywhere

Chain zone_VPN_ACCEPT (4 references)
target     prot opt source               destination
ACCEPT     all  --  anywhere             anywhere
ACCEPT     all  --  anywhere             anywhere

Chain zone_VPN_DROP (0 references)
target     prot opt source               destination
DROP       all  --  anywhere             anywhere
DROP       all  --  anywhere             anywhere

Chain zone_VPN_REJECT (1 references)
target     prot opt source               destination
reject     all  --  anywhere             anywhere
reject     all  --  anywhere             anywhere

Chain zone_VPN_forward (1 references)
target     prot opt source               destination
zone_lan_ACCEPT  tcp  --  anywhere             anywhere
zone_lan_ACCEPT  udp  --  anywhere             anywhere
forwarding_VPN  all  --  anywhere             anywhere
zone_VPN_REJECT  all  --  anywhere             anywhere

Chain zone_lan (1 references)
target     prot opt source               destination
ACCEPT     udp  --  anywhere             anywhere            udp dpts:netbios-ns:netbios-dgm
ACCEPT     tcp  --  anywhere             anywhere            tcp dpt:netbios-ssn
ACCEPT     tcp  --  anywhere             anywhere            tcp dpt:microsoft-ds
input_lan  all  --  anywhere             anywhere
zone_lan_ACCEPT  all  --  anywhere             anywhere

Chain zone_lan_ACCEPT (5 references)
target     prot opt source               destination
ACCEPT     all  --  anywhere             anywhere
ACCEPT     all  --  anywhere             anywhere

Chain zone_lan_DROP (0 references)
target     prot opt source               destination
DROP       all  --  anywhere             anywhere
DROP       all  --  anywhere             anywhere

Chain zone_lan_REJECT (1 references)
target     prot opt source               destination
reject     all  --  anywhere             anywhere
reject     all  --  anywhere             anywhere

Chain zone_lan_forward (1 references)
target     prot opt source               destination
zone_VPN_ACCEPT  tcp  --  anywhere             anywhere
zone_VPN_ACCEPT  udp  --  anywhere             anywhere
zone_wan_ACCEPT  all  --  anywhere             anywhere
forwarding_lan  all  --  anywhere             anywhere
zone_lan_REJECT  all  --  anywhere             anywhere

Chain zone_wan (1 references)
target     prot opt source               destination
ACCEPT     udp  --  anywhere             anywhere            udp dpt:bootpc
ACCEPT     icmp --  anywhere             anywhere            icmp echo-request
ACCEPT     tcp  --  anywhere             anywhere            tcp dpt:18000
ACCEPT     udp  --  anywhere             anywhere            udp dpt:18000
ACCEPT     tcp  --  anywhere             anywhere            tcp dpt:https
ACCEPT     tcp  --  anywhere             anywhere            tcp dpts:ftp-data:ftp
ACCEPT     udp  --  anywhere             anywhere            udp dpts:20:21
ACCEPT     tcp  --  anywhere             anywhere            tcp dpts:1026:1040
ACCEPT     udp  --  anywhere             anywhere            udp dpt:1200
input_wan  all  --  anywhere             anywhere
zone_wan_REJECT  all  --  anywhere             anywhere

Chain zone_wan_ACCEPT (3 references)
target     prot opt source               destination
ACCEPT     all  --  anywhere             anywhere
ACCEPT     all  --  anywhere             anywhere

Chain zone_wan_DROP (0 references)
target     prot opt source               destination
DROP       all  --  anywhere             anywhere
DROP       all  --  anywhere             anywhere

Chain zone_wan_REJECT (1 references)
target     prot opt source               destination
reject     all  --  anywhere             anywhere
reject     all  --  anywhere             anywhere

Chain zone_wan_forward (1 references)
target     prot opt source               destination
ACCEPT     tcp  --  anywhere             NINISPC.lan         tcp dpt:50100
ACCEPT     udp  --  anywhere             NINISPC.lan         udp dpt:50100
ACCEPT     tcp  --  anywhere             NINISPC.lan         tcp dpt:18429
ACCEPT     udp  --  anywhere             NINISPC.lan         udp dpt:52649
zone_lan_ACCEPT  all  --  anywhere             anywhere
forwarding_wan  all  --  anywhere             anywhere
zone_wan_ACCEPT  all  --  anywhere             anywhere</code></pre></div><p>Netstat gives a strange reply with the command netstat -a -n:<br /></p><div class="codebox"><pre><code>Active Internet connections (servers and established)
Proto Recv-Q Send-Q Local Address           Foreign Address         State
tcp        0      0 0.0.0.0:139             0.0.0.0:*               LISTEN
tcp        0      0 0.0.0.0:18000           0.0.0.0:*               LISTEN
tcp        0      0 0.0.0.0:53              0.0.0.0:*               LISTEN
tcp        0      0 0.0.0.0:21              0.0.0.0:*               LISTEN
tcp        0      0 0.0.0.0:443             0.0.0.0:*               LISTEN
tcp        0      0 0.0.0.0:445             0.0.0.0:*               LISTEN
tcp        0      0 192.168.1.1:445         192.168.1.32:1038       ESTABLISHED
tcp        0      0 192.168.1.1:139         192.168.1.9:52858       ESTABLISHED
tcp        0     52 192.168.1.1:18000       192.168.1.32:2141       ESTABLISHED
tcp        0      0 192.168.1.1:139         192.168.1.9:52857       ESTABLISHED
tcp        0      0 192.168.1.1:445         192.168.1.9:49161       ESTABLISHED
netstat: /proc/net/tcp6: No such file or directory
udp        0      0 0.0.0.0:53              0.0.0.0:*
udp        0      0 0.0.0.0:67              0.0.0.0:*
udp        0      0 192.168.1.255:137       0.0.0.0:*
udp        0      0 192.168.1.1:137         0.0.0.0:*
udp        0      0 0.0.0.0:137             0.0.0.0:*
udp        0      0 192.168.1.255:138       0.0.0.0:*
udp        0      0 192.168.1.1:138         0.0.0.0:*
udp        0      0 0.0.0.0:138             0.0.0.0:*
udp        0      0 0.0.0.0:1200            0.0.0.0:*
netstat: /proc/net/udp6: No such file or directory
netstat: /proc/net/raw6: No such file or directory
Active UNIX domain sockets (servers and established)
Proto RefCnt Flags       Type       State         I-Node Path
unix  2      [ ACC ]     STREAM     LISTENING       3333 /var/nmbd/unexpected
unix  2      [ ACC ]     STREAM     LISTENING       1109 /var/run/ubus.sock
unix  8      [ ]         DGRAM                       912 /dev/log
unix  2      [ ]         DGRAM                      1683 /var/run/hostapd-phy0/wlan0
unix  2      [ ]         DGRAM                      3407
unix  2      [ ]         DGRAM                      3225
unix  2      [ ]         DGRAM                      2967
unix  2      [ ]         DGRAM                      1241
unix  2      [ ]         DGRAM                      1201
unix  2      [ ]         DGRAM                      1187
unix  3      [ ]         STREAM     CONNECTED       1185 /var/run/ubus.sock
unix  3      [ ]         STREAM     CONNECTED       1184
unix  2      [ ]         DGRAM                      1129</code></pre></div><p>there is something listening on 1200 (which maybe i should change to 1194? ) but it&#039;s 0.0.0.0 ?_?</p><p>Here is my routing table with netstat -r:<br /></p><div class="codebox"><pre><code>Kernel IP routing table
Destination     Gateway         Genmask         Flags   MSS Window  irtt Iface
default         151.6.131.72    0.0.0.0         UG        0 0          0 pppoe-wan
10.32.0.0       10.32.0.2       255.255.0.0     UG        0 0          0 tun0
10.32.0.2       *               255.255.255.255 UH        0 0          0 tun0
151.6.131.72    *               255.255.255.255 UH        0 0          0 pppoe-wan
192.168.1.0     *               255.255.255.0   U         0 0          0 br-lan</code></pre></div><p>This is all I was able to found. Thank you again for help!</p><p>P.s. With &quot;all open&quot; you mean that I have serious security issues? <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p171440">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">luizluca</div>
					<div class="post-datetime">
						3 Jul 2012, 17:36					</div>
				</div>
				<div class="post-content content">
					<p>Let&#039;s see if there is something wrong.</p><p>The openvpn server is listeing:</p><p>udp&nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0 0.0.0.0:1200&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0:*</p><p>You can keep the 1200 or change to the default port 1194. I would start using the most default setup and after I got something working, I will start to customize it. 0.0.0.0 means &quot;all interfaces&quot;. So, it is listening at wan and lan.</p><p>Your firewall is open. Yes, it might be a security issue ;-) But it is better to start closing the doors after you got your VPN working.<br />FYI, &quot;iptables -L&quot; does not show the interfaces. I could deduce which interface the rules where related so a new output is not necessary. Keep it as a tip. Also, there is a luci tab that just show this information under stats.</p><p>It is strange that you got nothing from tcpdump. When listening at eth0 and connecting from LAN,<br />you should get a UDP chat at port 1200. Maybe you didn&#039;t selected the correct interface.<br />I use this command for capturing the traffic inside the router from wan:</p><p> tcpdump -i eth1</p><p>Or you can pipe it to your workstation through netcat:</p><p> workstation$ netcat -l 5555 | wireshark -k -i - &amp;<br /> workstation$ ssh router &quot;tcpdump -U -s 1500 -i eth1 -w - | nc workstation 5555&quot;</p><p>(I suppose you use linux as workstation ;-))</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p171452">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">alexander_doni</div>
					<div class="post-datetime">
						3 Jul 2012, 20:06					</div>
				</div>
				<div class="post-content content">
					<p>Thank you, thank you again for your time <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /><br />I haven&#039;t done tcpdump on eth0 but on tun0 and I saw something that was exactly the icmp request and icmp reply but nothing else.</p><p>Anyway I have to inform that today I was able to test again from wan and guess what???? It&#039;s working!!!<br />I think it was the &quot;local 192.168.1.1 255.255.255.0&quot; directive on the server configuration the problem.</p><p>Now i&#039;ll use your teachings to try resolving other problems i&#039;m facing now because clients are now connected from LAN (2 clients) and WAN (1 client).<br />Everyone can ping the server (from LAN and WAN) but no client is able to ping any other client (neither the ones on LAN!!!) and server cannot ping too!!!<br />But when I tried with an Ubuntu workstation both the server and the windows clients were able to ping it. Anyway if I ping with linux to windows clients no replies at all <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><p>Maybe I have to use some of those push and route and list route options...<br />Well I&#039;ll try something and I&#039;ll look for similar issues on the internet but if you will have again time aid me&nbsp; I&#039;ll really appreciate it <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /><br />Have a nice day!!!!!!!!</p><br /><p>EDIT: I&#039;m trying the advice on OpenVPN HowTo ( <a href="http://openvpn.net/index.php/open-source/documentation/howto.html">http://openvpn.net/index.php/open-sourc … howto.html</a> ) where it says to advertise the LAN to VPN server with push &quot;route 192.168.1.0 255.255.255.0&quot; where 192.168.1.0/24 is my network and router is at 192.168.1.1 but when I do it all clients on LAN&nbsp; and the one on WAN too connected to vpn can&#039;t connect to internet anymore (but are still connected to vpn). That&#039;s odd but I&#039;m probably wronging something ridicoulus XD</p>											<p class="post-edited">(Last edited by <strong>alexander_doni</strong> on 3 Jul 2012, 20:30)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p171455">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">luizluca</div>
					<div class="post-datetime">
						3 Jul 2012, 20:29					</div>
				</div>
				<div class="post-content content">
					<p>Good news!</p><p>The vpn negociation occurs at the lan/wan interface. Only after a successful connection is established (and autenticated) that something will apear at tun0.</p><p>The server option &quot;client-to-client&quot;, that you already have, means that clients can talk with each other.</p><p>Generally windows firewall avoid to answer ICMP echo request (ping). Take a look at it. If you are in doubt, install wireshark on the windows machines.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p171461">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">alexander_doni</div>
					<div class="post-datetime">
						3 Jul 2012, 22:05					</div>
				</div>
				<div class="post-content content">
					<p>Once again you were right! Ping problems were originated by the firewall. Obvioulsly I DON&#039;T use windows firewall and it&#039;s completely disabled but I use Comodo Firewall. I added the vpn network as a secure network but, and I don&#039;t know why, network is seen with subnet 255.255.255.252 ?_?<br />In ipconfig /all on the client I have this output:<br /></p><div class="codebox"><pre><code>Scheda Ethernet NINIS Network Adapter:

   Suffisso DNS specifico per connessione:
   Descrizione . . . . . . . . . . . . . : TAP-Win32 Adapter OAS
   Indirizzo fisico. . . . . . . . . . . : 00-FF-84-6B-31-89
   DHCP abilitato. . . . . . . . . . . . : Sì
   Configurazione automatica abilitata   : Sì
   Indirizzo IPv6 locale rispetto al collegamento . : fe80::7849:9dff:8a92:61ff%
21(Preferenziale)
   Indirizzo IPv4. . . . . . . . . . . . : 10.32.0.6(Preferenziale)
   Subnet mask . . . . . . . . . . . . . : 255.255.255.252
   Lease ottenuto. . . . . . . . . . . . : martedì 3 luglio 2012 20:00:46
   Scadenza lease . . . . . . . . . . .  : mercoledì 3 luglio 2013 20:00:46
   Gateway predefinito . . . . . . . . . :
   Server DHCP . . . . . . . . . . . . . : 10.32.0.5
   IAID DHCPv6 . . . . . . . . . . . : 268500868
   DUID Client DHCPv6. . . . . . . . : 00-01-00-01-16-27-AA-10-5C-AC-4C-77-2B-40

   Server DNS . . . . . . . . . . . . .  : fec0:0:0:ffff::1%1
                                           fec0:0:0:ffff::2%1
                                           fec0:0:0:ffff::3%1
   NetBIOS su TCP/IP . . . . . . . . . . : Attivato</code></pre></div><p>It&#039;s a bit weird, don&#039;t you think?? IPv6 DNS, DHCP 10.32.0.5, subnet mash 255.255.255.252. Is it completely crazy???</p><p>Anyway then I modified the subnet in Comodo Firewall to it&#039;s real one (255.255.0.0) and now I can ping with the server all the clients in LAN and WAN. LAN clients can ping each other (Linux and Windows) but I still can&#039;t ping from LAN to WAN and from WAN to LAN. This should be solved with push &quot;route 192.168.1.0 255.255.255.0&quot; but when I add it to server conf all connections drop and I have to restart the router SIGH!!!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p171462">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">luizluca</div>
					<div class="post-datetime">
						3 Jul 2012, 22:26					</div>
				</div>
				<div class="post-content content">
					<p>255.255.255.252 is a /30 netmask. It has 4 address. Just the enough for a ppp connection with 2 machines, 1 netaddress and 1 broadcast.<br />It is normal:</p><p>10.32.0.4 netaddress<br />10.32.0.5 vpn server<br />10.32.0.6 vpn client<br />10.32.0.7 broadcast</p><p>IPv6 DNS that you see is windows default. The DHCP server is the VPN server. I&#039;m just not sure about the &quot;push&quot;. I guess you would only need to change the routing if<br />the vpn client is also a router of another subnet.</p><p>Show the routing table of each device, vpn client and vpn server, after the vpn is connected.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p171466">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">alexander_doni</div>
					<div class="post-datetime">
						3 Jul 2012, 23:16					</div>
				</div>
				<div class="post-content content">
					<p>Ok, nice to hear that those parameters are ok.</p><p>This is routing table of VPN Server:<br /></p><div class="codebox"><pre><code>Kernel IP routing table
Destination     Gateway         Genmask         Flags   MSS Window  irtt Iface
default         151.6.131.72    0.0.0.0         UG        0 0          0 pppoe-wan
10.32.0.0       10.32.0.2       255.255.0.0     UG        0 0          0 tun0
10.32.0.2       *               255.255.255.255 UH        0 0          0 tun0
151.6.131.72    *               255.255.255.255 UH        0 0          0 pppoe-wan
192.168.1.0     *               255.255.255.0   U         0 0          0 br-lan</code></pre></div><p>This is the one of a LAN client:<br /></p><div class="codebox"><pre><code>===========================================================================
Elenco interfacce
 21...00 ff 84 6b 31 89 ......TAP-Win32 Adapter OAS
 11...5c ac 4c 77 2b 40 ......Atheros AR5B97 Wireless Network Adapter
  1...........................Software Loopback Interface 1
 23...00 00 00 00 00 00 00 e0 Microsoft ISATAP Adapter
 24...00 00 00 00 00 00 00 e0 Microsoft ISATAP Adapter #2
 19...00 00 00 00 00 00 00 e0 Teredo Tunneling Pseudo-Interface
===========================================================================

IPv4 Tabella route
===========================================================================
Route attive:
     Indirizzo rete             Mask          Gateway     Interfaccia Metrica
          0.0.0.0          0.0.0.0      192.168.1.1     192.168.1.32     25
        10.32.0.0      255.255.0.0        10.32.0.5        10.32.0.6     30
        10.32.0.4  255.255.255.252         On-link         10.32.0.6    286
        10.32.0.6  255.255.255.255         On-link         10.32.0.6    286
        10.32.0.7  255.255.255.255         On-link         10.32.0.6    286
        127.0.0.0        255.0.0.0         On-link         127.0.0.1    306
        127.0.0.1  255.255.255.255         On-link         127.0.0.1    306
  127.255.255.255  255.255.255.255         On-link         127.0.0.1    306
      169.254.0.0      255.255.0.0         On-link         10.32.0.6     30
  169.254.255.255  255.255.255.255         On-link         10.32.0.6    286
      192.168.1.0    255.255.255.0         On-link      192.168.1.32    281
     192.168.1.32  255.255.255.255         On-link      192.168.1.32    281
    192.168.1.255  255.255.255.255         On-link      192.168.1.32    281
        224.0.0.0        240.0.0.0         On-link         127.0.0.1    306
        224.0.0.0        240.0.0.0         On-link         10.32.0.6    286
        224.0.0.0        240.0.0.0         On-link      192.168.1.32    281
  255.255.255.255  255.255.255.255         On-link         127.0.0.1    306
  255.255.255.255  255.255.255.255         On-link         10.32.0.6    286
  255.255.255.255  255.255.255.255         On-link      192.168.1.32    281
===========================================================================
Route permanenti:
   Indirizzo rete             Mask   Indir. gateway Metrica
          0.0.0.0          0.0.0.0      192.168.1.1  Predefinito
===========================================================================

IPv6 Tabella route
===========================================================================
Route attive:
 Interf Metrica Rete Destinazione      Gateway
 19     58 ::/0                     On-link
  1    306 ::1/128                  On-link
 19     58 2001::/32                On-link
 19    306 2001:0:5ef5:79fb:3461:2663:68de:17aa/128
                                    On-link
 21    286 fe80::/64                On-link
 11    281 fe80::/64                On-link
 19    306 fe80::/64                On-link
 19    306 fe80::3461:2663:68de:17aa/128
                                    On-link
 21    286 fe80::7849:9dff:8a92:61ff/128
                                    On-link
 11    281 fe80::b084:54cc:898b:ace4/128
                                    On-link
  1    306 ff00::/8                 On-link
 19    306 ff00::/8                 On-link
 21    286 ff00::/8                 On-link
 11    281 ff00::/8                 On-link
===========================================================================
Route permanenti:
  Nessuna</code></pre></div><p>And this is the one of the WAN client:<br /></p><div class="codebox"><pre><code>===========================================================================
Elenco interfacce
 32...00 ff ba e5 59 d5 ......TAP-Win32 Adapter OAS
 10...48 5d 60 95 e5 0d ......Atheros AR9285 Wireless Network Adapter
  1...........................Software Loopback Interface 1
 14...00 00 00 00 00 00 00 e0 Teredo Tunneling Pseudo-Interface
 20...00 00 00 00 00 00 00 e0 Microsoft ISATAP Adapter
 36...00 00 00 00 00 00 00 e0 Microsoft ISATAP Adapter #2
===========================================================================

IPv4 Tabella route
===========================================================================
Route attive:
     Indirizzo rete             Mask          Gateway     Interfaccia Metrica
          0.0.0.0          0.0.0.0      192.168.1.1     192.168.1.22    281
        10.32.0.0      255.255.0.0       10.32.0.17       10.32.0.18     30
       10.32.0.16  255.255.255.252         On-link        10.32.0.18    286
       10.32.0.18  255.255.255.255         On-link        10.32.0.18    286
       10.32.0.19  255.255.255.255         On-link        10.32.0.18    286
        127.0.0.0        255.0.0.0         On-link         127.0.0.1    306
        127.0.0.1  255.255.255.255         On-link         127.0.0.1    306
  127.255.255.255  255.255.255.255         On-link         127.0.0.1    306
      192.168.1.0    255.255.255.0         On-link      192.168.1.22    281
     192.168.1.22  255.255.255.255         On-link      192.168.1.22    281
    192.168.1.255  255.255.255.255         On-link      192.168.1.22    281
        224.0.0.0        240.0.0.0         On-link         127.0.0.1    306
        224.0.0.0        240.0.0.0         On-link      192.168.1.22    281
        224.0.0.0        240.0.0.0         On-link        10.32.0.18    286
  255.255.255.255  255.255.255.255         On-link         127.0.0.1    306
  255.255.255.255  255.255.255.255         On-link      192.168.1.22    281
  255.255.255.255  255.255.255.255         On-link        10.32.0.18    286
===========================================================================
Route permanenti:
   Indirizzo rete             Mask   Indir. gateway Metrica
          0.0.0.0          0.0.0.0      192.168.1.1  Predefinito
===========================================================================

IPv6 Tabella route
===========================================================================
Route attive:
 Interf Metrica Rete Destinazione      Gateway
 14     58 ::/0                     On-link
  1    306 ::1/128                  On-link
 14     58 2001::/32                On-link
 14    306 2001:0:5ef5:79fb:181f:241e:3f57:fee9/128
                                    On-link
 10    281 fe80::/64                On-link
 32    286 fe80::/64                On-link
 14    306 fe80::/64                On-link
 32    286 fe80::10bb:64ac:83d1:210d/128
                                    On-link
 14    306 fe80::181f:241e:3f57:fee9/128
                                    On-link
 10    281 fe80::64b5:dfbe:769b:80d2/128
                                    On-link
  1    306 ff00::/8                 On-link
 14    306 ff00::/8                 On-link
 10    281 ff00::/8                 On-link
 32    286 ff00::/8                 On-link
===========================================================================
Route permanenti:
  Nessuna</code></pre></div><p>Here they are!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p171472">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">alexander_doni</div>
					<div class="post-datetime">
						4 Jul 2012, 00:33					</div>
				</div>
				<div class="post-content content">
					<p>Think it&#039;s almost done!!!! Complete capability to ping LAN, WAN and Server from anywhere.</p><p>I added to configuration of LAN clients this line:<br />route 192.168.1.0 255.255.255.0 10.32.0.1 3<br />where 10.32.0.1 is the gateway of the vpn.</p><p>Samba access works, and it seems vpn is ok. But I thinks there&#039;s still something wrong.</p><p>My last goal to accomplish is to make BorgChat ( a chat for a LAN environment) work for all the vpn!</p><p>Now Borgchat uses UDP Broadcast on port 7550. Or IP multicast which I don&#039;t know how to use.<br />I put as broadcast addresses for BorgChat 192.168.1.255 (for possible LAN buddies) and 10.32.255.255 for each other vpn client.</p><p>Of course I can&#039;t see the other one in the chat (but I still can ping him and he can ping me) and a tcpdump on the router (vpn server) on tun0 interface shows this strange messages:<br /></p><div class="codebox"><pre><code>    10.32.0.6.8135 &gt; 10.32.0.1.microsoft-ds: Flags [.], cksum 0xce45 (correct), ack 1, win 4394, length 0
23:28:17.305752 IP (tos 0x0, ttl 128, id 27535, offset 0, flags [none], proto UDP (17), length 108)
    10.32.0.6.7550 &gt; 10.32.255.255.7550: UDP, length 80
23:28:17.305909 IP (tos 0xc0, ttl 64, id 17929, offset 0, flags [none], proto ICMP (1), length 136)
    10.32.0.1 &gt; 10.32.0.6: ICMP 10.32.255.255 udp port 7550 unreachable, length 116
        IP (tos 0x0, ttl 127, id 27535, offset 0, flags [none], proto UDP (17), length 108)
    10.32.0.6.7550 &gt; 10.32.255.255.7550: UDP, length 80
23:28:18.171606 IP (tos 0x0, ttl 128, id 22717, offset 0, flags [none], proto UDP (17), length 104)
    10.32.0.18.7550 &gt; 10.32.255.255.7550: UDP, length 76
23:28:18.171762 IP (tos 0xc0, ttl 64, id 50421, offset 0, flags [none], proto ICMP (1), length 132)
    10.32.0.1 &gt; 10.32.0.18: ICMP 10.32.255.255 udp port 7550 unreachable, length 112
        IP (tos 0x0, ttl 127, id 22717, offset 0, flags [none], proto UDP (17), length 104)
    10.32.0.18.7550 &gt; 10.32.255.255.7550: UDP, length 76
23:29:18.354902 IP (tos 0x0, ttl 128, id 27565, offset 0, flags [none], proto UDP (17), length 108)
    10.32.0.6.7550 &gt; 10.32.255.255.7550: UDP, length 80
23:29:18.355056 IP (tos 0xc0, ttl 64, id 17930, offset 0, flags [none], proto ICMP (1), length 136)
    10.32.0.1 &gt; 10.32.0.6: ICMP 10.32.255.255 udp port 7550 unreachable, length 116
        IP (tos 0x0, ttl 127, id 27565, offset 0, flags [none], proto UDP (17), length 108)
    10.32.0.6.7550 &gt; 10.32.255.255.7550: UDP, length 80
23:30:00.330921 IP (tos 0x0, ttl 128, id 27575, offset 0, flags [none], proto UDP (17), length 112)
    10.32.0.6.7550 &gt; 10.32.255.255.7550: UDP, length 84
23:30:00.331077 IP (tos 0xc0, ttl 64, id 17931, offset 0, flags [none], proto ICMP (1), length 140)
    10.32.0.1 &gt; 10.32.0.6: ICMP 10.32.255.255 udp port 7550 unreachable, length 120
        IP (tos 0x0, ttl 127, id 27575, offset 0, flags [none], proto UDP (17), length 112)
    10.32.0.6.7550 &gt; 10.32.255.255.7550: UDP, length 84
23:30:13.997988 IP (tos 0x10, ttl 64, id 20639, offset 0, flags [DF], proto TCP (6), length 40)
    10.32.0.1.microsoft-ds &gt; 10.32.0.6.8135: Flags [.], cksum 0x1461 (incorrect -&gt; 0xb632), ack 1, win 10558, length 0
23:30:14.001247 IP (tos 0x0, ttl 128, id 27577, offset 0, flags [DF], proto TCP (6), length 40)
    10.32.0.6.8135 &gt; 10.32.0.1.microsoft-ds: Flags [.], cksum 0xce45 (correct), ack 1, win 4394, length 0
23:30:19.397323 IP (tos 0x0, ttl 128, id 27581, offset 0, flags [none], proto UDP (17), length 108)
    10.32.0.6.7550 &gt; 10.32.255.255.7550: UDP, length 80
23:30:19.397480 IP (tos 0xc0, ttl 64, id 17932, offset 0, flags [none], proto ICMP (1), length 136)
    10.32.0.1 &gt; 10.32.0.6: ICMP 10.32.255.255 udp port 7550 unreachable, length 116
        IP (tos 0x0, ttl 127, id 27581, offset 0, flags [none], proto UDP (17), length 108)
    10.32.0.6.7550 &gt; 10.32.255.255.7550: UDP, length 80
23:30:22.288571 IP (tos 0x0, ttl 128, id 22759, offset 0, flags [none], proto UDP (17), length 100)
    10.32.0.18.7550 &gt; 10.32.255.255.7550: UDP, length 72
23:30:22.288727 IP (tos 0xc0, ttl 64, id 50422, offset 0, flags [none], proto ICMP (1), length 128)
    10.32.0.1 &gt; 10.32.0.18: ICMP 10.32.255.255 udp port 7550 unreachable, length 108
        IP (tos 0x0, ttl 127, id 22759, offset 0, flags [none], proto UDP (17), length 100)
    10.32.0.18.7550 &gt; 10.32.255.255.7550: UDP, length 72</code></pre></div><p>and many other similar. The one who is worrying me and I think is the problem is:<br />10.32.0.1 &gt; 10.32.0.6: ICMP 10.32.255.255 udp port 7550 unreachable, length 116<br />&nbsp; &nbsp; &nbsp; &nbsp; IP (tos 0x0, ttl 127, id 27581, offset 0, flags [none], proto UDP (17), length 108)</p><p>It&#039;s like port 7550 is unreacheable or somthing like this, maybe issues with broadcast on vpn.</p><p>If you could help me to work this out it&#039;s over! I&#039;ll not ask anything anymore, I promise! <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p171523">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">luizluca</div>
					<div class="post-datetime">
						4 Jul 2012, 15:48					</div>
				</div>
				<div class="post-content content">
					<p>Right, let&#039;s try to fix this last issue.</p><p>I don&#039;t think that you could use a broadcast-based chat over vpn this way. Reread my last post about the addresses of the VPN. The address 10.32.255.255 is not the broadcast of your VPN. It is 10.32.0.7 and only for the windows client. Also, it is generally not allowed to send a package to a broadcast address outside your network. The foreign router just rejects it as a security measure.</p><p>I guess what you want is a VPN on the layer 2 (link layer), not layer 3 (network layer). Just change the vpn configuration from tun to tap. However, the increased broadcast costs can drops the network performance to something like 50%.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p171528">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">alexander_doni</div>
					<div class="post-datetime">
						4 Jul 2012, 16:58					</div>
				</div>
				<div class="post-content content">
					<p>Then you mean i have to change everything? Using server bridge and not server directive, bridging tap 0 wiht eth0 in my router and in each other clients???<br />Don&#039;t use push directives and so on? restricting my dhcp range and using all on 192.168.0.0 network? <br />Sorry for probably stupid questions! <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p171530">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">alexander_doni</div>
					<div class="post-datetime">
						4 Jul 2012, 17:11					</div>
				</div>
				<div class="post-content content">
					<p>Could IP Multicast be a solution??? Borgchat has the possibility to use UDP Broadcast or IP Multicast. The only thing I know on IP Multicast is that 224.0.0.1 is a multicast to all the subnet. Even if I don&#039;t know which subnet it means...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p171562">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">alexander_doni</div>
					<div class="post-datetime">
						4 Jul 2012, 23:36					</div>
				</div>
				<div class="post-content content">
					<p>Man I&#039;ve followed your wisdom! I&#039;ve put in server config dev tap instead of tun. I modified port number to 1194 too.</p><p>Then I&#039;ve done same thing to client configurations but I had to eliminate the push 192.168.1.0 255.255.255.0 10.32.0.1 3 directive to make it work smooth<br />and now it&#039;s done. I can see each other pc in network window in Windows and UDP Broadcast works ok. No need to bridge interfaces on router!</p><p>I&#039;m a bit worried because of what you said about speed of connection but I&#039;ll try to be ready <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Thanks for everything!!!!!!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p171570">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">luizluca</div>
					<div class="post-datetime">
						5 Jul 2012, 01:29					</div>
				</div>
				<div class="post-content content">
					<p>Great! Another happy Openwrt user :-)</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>