<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> TP-LINK WR702n (how to modify firmware from chinese to english ?)</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 25 Mar 2018 and 29 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 4</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=41040&amp;p=2.html">2</a></li><li><a href="viewtopic.php%3Fid=41040&amp;p=3.html">3</a></li><li><a href="viewtopic.php%3Fid=41040&amp;p=4.html">4</a></li></ul></nav></div>
			
		
		
			<article class="post" id="p185820">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">tahunasky</div>
					<div class="post-datetime">
						12 Dec 2012, 11:36					</div>
				</div>
				<div class="post-content content">
					<p>Hi, I know this isnt related to openwrt, and that the wr702n will not run it due to flash/ram size, but the one i purchased off ebay has chinese menus.<br />Is there a way to modify the flash image file (bin) or connect to the router and modify the html files directly ? </p><p>I have downloaded the english firmware for the model, however it wont flash to the router, i get the error:</p><p>Error code: 18005<br />Upload the file version does not match with the models. </p><p>Any suggestions/help would be much appreciated.</p>											<p class="post-edited">(Last edited by <strong>tahunasky</strong> on 14 Dec 2012, 22:57)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p185824">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">johan666</div>
					<div class="post-datetime">
						12 Dec 2012, 12:09					</div>
				</div>
				<div class="post-content content">
					<p>It is NOT modify menus !!<br />It is change firmware, or change firmware language......!</p><p>Are you sure yours is wr702n ?<br />Are you sure you have downloaded correct file ?</p><p>Official English version firmware of wr702n:<br /><a href="http://www.tp-link.com/Resources/software/TL-WR702N_V1.0_120530.zip">http://www.tp-link.com/Resources/softwa … 120530.zip</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p185864">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">tahunasky</div>
					<div class="post-datetime">
						12 Dec 2012, 20:51					</div>
				</div>
				<div class="post-content content">
					<p>Yes it is the WR702n (Ver 1.0).</p><p>I sent an email to TP-LINK and their support said:<br />&quot;the one that is only sold in China mainland. There is only Chinese firmware version for it.&quot;</p><p>I did try the firmware you listed, however I always get the error:</p><p>Error code: 18005<br />Upload the file version does not match with the models</p><p>The latest chinese version of firmware flashed without problems - which i got from here: </p><p><a href="http://www.tp-link.com.cn/pages/download-detail.asp?d=789">http://www.tp-link.com.cn/pages/downloa … .asp?d=789</a></p><p>So I am guessing there is something in the file header which is telling it not to flash the english version. </p><p>Does anyone know what i can do to either flash the english version of modify the chinese firmware ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p185903">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">johan666</div>
					<div class="post-datetime">
						13 Dec 2012, 09:39					</div>
				</div>
				<div class="post-content content">
					<p>Yes, it will check the firmware file header to ensure user won&#039;t cross flash.</p><p>Could you take a photo of your device label for investigate ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p185984">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">tahunasky</div>
					<div class="post-datetime">
						14 Dec 2012, 04:49					</div>
				</div>
				<div class="post-content content">
					<p>Here is an images of the info on back of wr702n wifi router i have.</p><p><span class="postimg"><img src="http://58.28.154.195/wr702n.jpg" alt="WR702n" /></span></p><p>Do you know if it is possible to change the header info in the file, or modify the firmware BIN file, or how to login to the router to change the html menu code ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p185988">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">nebbia88</div>
					<div class="post-datetime">
						14 Dec 2012, 07:15					</div>
				</div>
				<div class="post-content content">
					<p>Maybe a hi res pic of the board should be useful to compare it to the english version.. Open that case! ;-)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p186068">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">tahunasky</div>
					<div class="post-datetime">
						14 Dec 2012, 22:45					</div>
				</div>
				<div class="post-content content">
					<p>Here is a pic of PCB:</p><p><span class="postimg"><img src="http://58.28.154.195/wr702n_pcb.jpg" alt="WR702n PCB" /></span></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p186072">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">Squonk</div>
					<div class="post-datetime">
						14 Dec 2012, 23:20					</div>
				</div>
				<div class="post-content content">
					<p>Thank you tahunasky!</p><p>I can say that the TL-WR702N PCB is exactly like the TL-WR703N with the following differences:<br /></p><ul><li><p>the 16Mbit x 16bit 400MHz chip Zentel A3S56D40FTP DDR1 SDRAM U2 chip providing 32MB is replaced by a Zentel <a href="http://www.zentel-europe.com/A3S28D3040FTP_v1.0.pdf">A3S28D40FTP</a> 8Mbit x 16bit 400MHz chip Zentel A3S56D40FTP DDR1 SDRAM chip providing only 16MB</p></li><li><p>it is difficult to tell from the picture, but U3, a Spansion S25FL032P 32Mbit 104-MHz SPI Flash memory providing 4MB is probably replaced by an Eon EN25B16 16Mbit 104-MHz SPI Flash memory providing only 2MB</p></li><li><p>the USB2 connector is not mounted, as well as all USB-related components: C113, C115, D1, R10, R101/R102/R103/R104 on top side and D2 and U6 the USB power switch on bottom side</p></li><li><p>otherwise, the PCB is Version 1.1, exactly like the TL-WR703N and is thus not RoHS/CE/FCC compliant</p></li></ul><p>I suspect that the TLWR702N sold for export outside China has a different PCB which is RoHS/CE/FCC compliant, otherwise TP-Link would not be able to sell it.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p186093">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">tahunasky</div>
					<div class="post-datetime">
						15 Dec 2012, 01:00					</div>
				</div>
				<div class="post-content content">
					<p>Here is a slightly better pic of the flash chip.</p><p><span class="postimg"><img src="http://58.28.154.195/sop8.jpg" alt="SP1 Flash" /></span></p><br /><p>So back to the original quection, is it possible to flash the english version of the firmware, and if not, is there a way to change the menus to english in the chinese firmware ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p186118">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">Squonk</div>
					<div class="post-datetime">
						15 Dec 2012, 10:38					</div>
				</div>
				<div class="post-content content">
					<p>Thank you!</p><p>I read:</p><p>cFeon<br />QH16-104HrP<br />&nbsp; &nbsp; &nbsp; &nbsp;123M01A7<br />&nbsp; &nbsp; &nbsp; &nbsp;1226TDA</p><p>It is definitely an Eon SPI Flash, but I can&#039;t get a matching datasheet. From the &quot;16&quot;, I guess this is a 16Mbit, and &quot;104&quot; is for 104MHz parts. The closest match is the <a href="http://www.essi.com.tw/upfile/p201188184923.pdf">EN25Q16A</a>.</p><p>Back to your question, the firmware file contains a header that specifies the particular model of router to which the file is to be used for.</p><p>Here is the header for the Chinese firmware:<br /></p><div class="codebox"><pre><code>00000000: 0014 2fc0 135b 21e4 8ac8 bea9 9eff dd28  ../..[!........(
00000010: 3bf0 9abb 494d 4730 0014 b200 0702 0001  ;...IMG0........
00000020: 0000 0001 5a04 1234 0000 0000 0000 0000  ....Z..4........
00000030: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00000040: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00000050: 0000 0000 0000 0080 000f 607f 000f 6100  ..........`...a.
00000060: 0005 3bf0 0014 9cf0 0000 1510 0000 0000  ..;.............
00000070: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00000080: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00000090: 0000 0000 6e00 0080 0010 df38 0000 0000  ....n......8....
000000a0: 0000 1e01 fe00 0233 c6b8 50f0 8dd9 97a8  .......3..P.....
000000b0: 7e3b 0093 bcba 61de 7c0e 133e e75e aadc  ~;....a.|..&gt;.^..
000000c0: 9af0 84d1 ea6d ef21 2739 46a3 19bb 952c  .....m.!&#039;9F....,
000000d0: 55d5 7d3d 062b ddca 88e6 88ba 058b e990  U.}=.+..........</code></pre></div><p>And here is the one for the English firmware:<br /></p><div class="codebox"><pre><code>00000000: 0014 2fc0 e686 2600 bf87 5396 58ce b6ee  ../...&amp;...S.X...
00000010: df5d 19df 494d 4730 0013 4c10 0702 1101  .]..IMG0..L.....
00000020: 0000 0001 5a04 1253 0000 0000 0000 0000  ....Z..S........
00000030: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00000040: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00000050: 0000 0000 0000 0080 000e bfca 000e c050  ...............P
00000060: 0004 7670 0013 36c0 0000 1548 0000 0000  ..vp..6....H....
00000070: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00000080: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00000090: 0000 0000 6e00 0080 0080 9d36 0000 0000  ....n......6....
000000a0: 0000 1e01 fe00 0233 c6b8 50f0 8dd9 97a8  .......3..P.....
000000b0: 7e3b 0093 bcba 61de 7c0e 133e e75e aadc  ~;....a.|..&gt;.^..
000000c0: 9af0 84d1 ea6d ef21 2739 46a3 19bb 952c  .....m.!&#039;9F....,
000000d0: 55d5 7d3d 062b ddca 88e6 88ba 058b e990  U.}=.+..........</code></pre></div><p>I don&#039;t know the exact header format, but at offset 0x00000014, you get &quot;494d 4730&quot; in both files, which translate to &quot;IMG0&quot; in ASCII for both firmwares.</p><p>Then you have a value &quot;0014 b200&quot; and &quot;0013 4C10&quot; at offset 0x00000018 which match the total file length of the respective firmware file.</p><p>At offset 0x0000001c, you have a value &quot;0702&quot; for both firmware, probably for &quot;TL-WR702N&quot;...</p><p>Then the most interesting field is at offset 0x0000001e: it contains the value &quot;0001&quot; for the Chinese firmware, and &quot;1101&quot; for the English firmware: this is probably the revision number, which is different between the firmwares. This value will have to be changed, but unfortunately, there are some MD5 sum protecting the header against corruption and manual changes <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p><p>I don&#039;t know how these md5sum are computed, so I can&#039;t patch the firmware file to match your hardware.</p><p>There is a similar thread on the TL-MR11U/TL-MR3040 and TL-WR703N Chinese/English containing a Windows utility to patch the file and compute the MD5 accordingly, but unfortunately, it doesn&#039;t work for the TL-WR702N files <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /><br /><a href="https://forum.openwrt.org/viewtopic.php?pid=168045#p168045">https://forum.openwrt.org/viewtopic.php … 45#p168045</a></p><p>Maybe someone can help with this?</p><p>EDIT: the &quot;IMG0&quot; string seems to indicate that it is a VxWorks firmware</p>											<p class="post-edited">(Last edited by <strong>Squonk</strong> on 15 Dec 2012, 12:04)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p186241">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">tahunasky</div>
					<div class="post-datetime">
						17 Dec 2012, 03:23					</div>
				</div>
				<div class="post-content content">
					<p>Squonk: Thanks for all the info.</p><p>Do you know (or anyone else) if there is a way to get to the prompt on the router, and then maybe dump the english firmware on that way ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p186251">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">nebbia88</div>
					<div class="post-datetime">
						17 Dec 2012, 08:14					</div>
				</div>
				<div class="post-content content">
					<p>You can start by connecting a ttl serial adapter and post the full bootlog..</p><p>Pinout should be the same of wr703n..</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p202606">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">jvvh5897</div>
					<div class="post-datetime">
						23 May 2013, 22:27					</div>
				</div>
				<div class="post-content content">
					<p>I know this is an older thread, but I recently bought a WR702n thinking it was a 703 and too small a cost to not play with it. Don&#039;t see the option to browse for an update in the Chinese menu, and don&#039;t know if it is traditional or simplified Chinese--they say you can update the traditional menued 702 with english versions, so I&#039;m guessing simplified box.<br />I took apart the latest english version v3 file, extracted the lzma compressed main code and found the string sent out the serial port when the md5 sum is not correct. Looking at the code around that area I found the 0x10 bytes of md5 copied from the 0x4 position of the file header then that space is overwritten with CC 96 28 EE 8D FB 21 BB 3D EF 6C B5 9F 77 4C 07 (hum, that last number looks wrong, but the first four should find the correct sequence). There is a routine that , skipping the first byte, looks for 0x00 value and adds 2 to the location found and subtracts that from the value in the first word of the header--that seems to be number of bytes the md5 covers--looks to me that would be 0x142fc0-0x23 bytes. Now, it gets harder and I haven&#039;t figured it all out. Looks like md5 is computed and stored, but then a second routine is called and it does some calls to the md5 routine too--two times, with some other stuff done as well. Might need to emulate the code or run it on some other mips based device to see what is really happening. Whatever that extra stuff is, once it is all done there is just a mem compare step and based on that result either error message sent out serial port or header removed and file written to flash.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p203707">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">jvvh5897</div>
					<div class="post-datetime">
						4 Jun 2013, 18:55					</div>
				</div>
				<div class="post-content content">
					<p>Ah. Finally managed to reproduce an md5 for the english update files. You overwrite the existing md5 with that constant string shown above (0x7c for the last byte not 0x07) and then compute the md5 for the entire file. I can find the same string in the main sw part of the &quot;stock&quot; file, so I&#039;m guessing that the stock 2M dump was from a traditional Chinese box (and the main sw in the stock file is the same as the main sw in the last posted english file). Still haven&#039;t tried to TFTP a file to my box. And haven&#039;t been able to find the spot to download chinese updates for the box--the old links don&#039;t seem to get you there.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p203928">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">jvvh5897</div>
					<div class="post-datetime">
						6 Jun 2013, 19:53					</div>
				</div>
				<div class="post-content content">
					<p>Now that the md5 is figured out, seems time to look at how to mod to have box in english. I downloaded the standard chinese ch_up files and found that the sw in my box was the middle of the three from 5/2012. As there was an update and the download included a windows no-install tftp program I gave it a try and upgraded the box to the 11/2012 file--didn&#039;t know what I was doing but it happened OK.</p><p>Looking at the files cn_up vs en_up, I see much the same in the header as pointed out earlier in the thread. It looks like the later files for both en and cn break down into 4 parts--the first 0x6830 bytes or so seems to be pure code for boot; from 0x6830 to 0x40000 is what I&#039;ve been calling the main code (lzma compressed, expands to about 680kbyte and is the same on both cn and en most recent files--byte compare finds no diff), from 0x40000 to roughly 0x130000 (search out the ascii string &quot;owow&quot; for end, &quot;IMG0&quot; for start roughly) is another section of lzma compressed code and data that expands to about 3.5MByte and there is a header to it that differes as pointed out in prev header info, last section is the files section--largely html files all lzma compressed individually with a table to tell you the file name, offset to start and length compressed. I built a little qbasic code to pull the files out and shell to lzma decompress util to get them all out where I could see them. About 180 files total in the english &quot;stock&quot; software flash dump that was posted and about 280 in the latest chinese file--seems to be roughly broken down into help files and screen forms with a few java and gif. The newer files in the cn file seemed to give one the ability to log into 702 with phone--maybe 25 files for that, but lots of others.</p><p>So, I think we could upload an english file to the box with two changes to the header and to the secondary info at 0x40000 and with md5 fixed up. OR, we could go in and change the html files--there really isn&#039;t much to change in each as there is mostly the html code in english with a few lines of stuff for the screen and often the html code tells you what should be in there. I extracted the english file as well as the chinese, so it could be pretty quick to mod most of the files with maybe a few days getting google to translate the others. The latest cn file seems to be about as large as could fit in the flash with what else has to be in the 2M space, so the re-compress and re-fit would have to work out, but you would end up with a box that still upgrades through TFTP and has more features than the latest en file--might be worth it.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p204089">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">jvvh5897</div>
					<div class="post-datetime">
						8 Jun 2013, 21:46					</div>
				</div>
				<div class="post-content content">
					<p>OK! The basic idea worked. I modified three files--str_menu.js str_error.js and the popupSiteSurvey.htm so that they contained info in english where needed, recompressed (lzma utility from the 7-zip SDK using the -lc0 option) and patched into the file structure and fixed the md5, then loaded the modded file to the 702 and now I have one html file in all english and the menu shows in english too. Now, to fix enough of the rest of the files to have english--might not be too much work as the two js files I fixed had the most number of strings of any of the files, still lots to mod and figure out, but that is just a detail at this point.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p204426">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">jvvh5897</div>
					<div class="post-datetime">
						12 Jun 2013, 20:25					</div>
				</div>
				<div class="post-content content">
					<p>Bit the bullet and load a modded english file to the 702, had to use the 703 gateway addr to get into setup again after the reboot, but all looks OK from what I&#039;ve tried so far. The modded cn_up that I had tried seemed to be pushing the limits of both flash and RAM in the 702.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p206463">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">tahunasky</div>
					<div class="post-datetime">
						5 Jul 2013, 03:34					</div>
				</div>
				<div class="post-content content">
					<p>Hi jvvh5897, did you manage to load an en version of the firmware into the router, and if so how has the modded en file been working ?<br />Can you post a link to the file so i can try it on my 702n.<br />thanks</p>											<p class="post-edited">(Last edited by <strong>tahunasky</strong> on 5 Jul 2013, 03:47)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p206514">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">jvvh5897</div>
					<div class="post-datetime">
						5 Jul 2013, 18:17					</div>
				</div>
				<div class="post-content content">
					<p>Yes, as noted above I did get a modded english file loaded by modifying the 702 hardware byte in two places and then fixing the md5 as posted above. The 702 works, has english menu, scans wifi signals, but I have yet to get it to give me internet on local wifi APs in client mode. I suspect that I just haven&#039;t set my PC up correctly rather than problem with the 702 or its current fw. And I haven&#039;t been working on it that hard either--so that might be part of why I haven&#039;t got it giving internet. Playing with the code was fun and the fix is so simple I don&#039;t see why a file need be posted. Many hexedotors have the md5 calculator needed--saw a post on this site about fixing checksums and a few free hexeditors that you can use--it really is easy.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p206539">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">tahunasky</div>
					<div class="post-datetime">
						6 Jul 2013, 02:44					</div>
				</div>
				<div class="post-content content">
					<p>OK, thanks for the info, i will try playing around with it when i get home and hopefully i wont stuff it up.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p206602">
				<div class="post-metadata">
					<div class="post-num">Post #21</div>
					<div class="post-author">jvvh5897</div>
					<div class="post-datetime">
						7 Jul 2013, 01:31					</div>
				</div>
				<div class="post-content content">
					<p>Oh, I think you will do OK. Just practice the md5 on the file before any mods. There is a md5sum program in ubuntu that would do the md5 calc required and wiki has sample md5 source code that can be compiled under lcc-win32 with ease and you could modify the source to use the md5 substitute string required rather than read the file&#039;s string.</p><p>BTW, I even got an IT guy to try to get the 702 to work as a client dongle--no joy. I switched back to chinese to see if it would work that way--haven&#039;t tested that yet, but the switch back was so easy! Just clicked on the web page while connected to 702&#039;s setup and browsed to the file and loaded it right in--no TFTC program, just click. Now, I&#039;m back to looking at chinese and remembering what I need from the english pages. Do like that the chinese survey tells you the security method used rather than just the english, on or off message.</p>											<p class="post-edited">(Last edited by <strong>jvvh5897</strong> on 7 Jul 2013, 01:33)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p206839">
				<div class="post-metadata">
					<div class="post-num">Post #22</div>
					<div class="post-author">tahunasky</div>
					<div class="post-datetime">
						10 Jul 2013, 14:50					</div>
				</div>
				<div class="post-content content">
					<p>I have used the 702 in client mode, both connected to a pc&#039;s rj45 port and also connected to a switch, which a linux server and pc were connected to. Connected to a pc seemed to work fine for windows 7/8. Connected to a switch wasnt reliable - would work for a while then it would stop working. The only way to make it work again was to reboot router.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p207088">
				<div class="post-metadata">
					<div class="post-num">Post #23</div>
					<div class="post-author">lofrank</div>
					<div class="post-datetime">
						14 Jul 2013, 10:58					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>jvvh5897 wrote:</cite><blockquote><p>I took apart the latest english version v3 file, extracted the lzma compressed main code and found the string sent out the serial port when the md5 sum is not correct.</p></blockquote></div><p>Hi, jvvh<br />Thanks for your greate post.<br />But could you give some details about how to find main code?</p><p>I have downloaded firmware from this link:<br /><a href="http://www.tp-link.com/resources/software/TL-WR702N_V1_130528.zip">http://www.tp-link.com/resources/softwa … 130528.zip</a></p><p>Get following result via binwalk:<br />DECIMAL&nbsp; &nbsp;&nbsp; &nbsp; HEX&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; DESCRIPTION<br />-------------------------------------------------------------------------------------------------------------------<br />20&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x14&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; IMG0 (VxWorks) header, size: 1535264<br />26820&nbsp; &nbsp; &nbsp;&nbsp; &nbsp; 0x68C4&nbsp; &nbsp; &nbsp; &nbsp; LZMA compressed data, properties: 0x6E, dictionary size: 8388608 bytes, uncompressed size: 698624 bytes<br />262292&nbsp; &nbsp; &nbsp; &nbsp; 0x40094&nbsp; &nbsp;&nbsp; &nbsp; IMG0 (VxWorks) header, size: 1272992<br />262420&nbsp; &nbsp; &nbsp; &nbsp; 0x40114&nbsp; &nbsp;&nbsp; &nbsp; LZMA compressed data, properties: 0x6E, dictionary size: 8388608 bytes, uncompressed size: 3566768 bytes<br />1235588&nbsp; &nbsp;&nbsp; &nbsp; 0x12DA84&nbsp; &nbsp; &nbsp; Wind River management filesystem, compressed, 182 files<br />1244368&nbsp; &nbsp;&nbsp; &nbsp; 0x12FCD0&nbsp; &nbsp; &nbsp; LZMA compressed data, properties: 0x5A, dictionary size: 8388608 bytes, uncompressed size: 15228 bytes<br />........</p><p>I think the LZMA compressed data from 0x68C4 is main code, it&#039;s about 680kbyte after decompress, as you said before.<br />I can also find some useful strings such as &#039;VxWorks5.5.1&#039;.<br />But I didn&#039;t know how to conitnue analyze with IDA now, I drag decompressed main code into IDA, but IDA can&#039;t find one function.</p><p>There are many MIPS series processor types in IDA, I&#039;m not sure which one should I choose and I don&#039;t know how to fill disassembly memory organization info.<br />Could you help me? What I want to do is analyze the main code and figure out how md5sum is calculated, so I can modify the firmware and then fix checksum.</p><p>Thanks.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p207138">
				<div class="post-metadata">
					<div class="post-num">Post #24</div>
					<div class="post-author">jvvh5897</div>
					<div class="post-datetime">
						14 Jul 2013, 23:18					</div>
				</div>
				<div class="post-content content">
					<p>I use the lzma.exe program from the 7-zip SDK to unpack the code and recompress--it is a command line console program. </p><p>Start of compressed info looks like:<br />6e 00 00 80 00 10</p><p>5A 00 00 80 00 B0 13 00--for the web pages.<br />If your examination finds 0x6e that would be a good place to try a uncompress too.</p><p>So look for the starting byte. You can copy to the end of the file from there, lzma.exe will stop when it gets to the end of the compressed info specified in the header that you point it to even if there are more lzma compressed chunks (I had to write a special routine to call lzma to extract the web pages embedded in the file as I pulled them out of the file into a temporary file).</p><p>You only get the same 0x5a&nbsp; start byte in your files if you run lzma with the command line option -lc0:<br />lzma e wzdwla~1.htm test.bin -lc0</p><p>Use options&nbsp; -lc0 -lp2 to get the 0x6e starting byte.</p><p>Don&#039;t think that the un-pack part of the lzma code cares in the 702 box, but I did not test that.</p><p>The code that starts at 0x68c4 is the compressed part of the boot. You can learn a lot from that code and it is smaller than the main code so less to get in the way--it does seem to have all the code needed to not only boot the box, but do comms on the web and serial port, flash LED and I suspect do a hard reset too with the button.</p><p>The main code starts around 0x40000 in the files and is lzma compressed too.</p><p>Use the mipsb setting in IDA. I can supply an IDC to help you do the disassembly, but it does not name routines for you. I can supply a list of routines that I have labeled.</p><p>BUT, I have already posted how to do the checksum. You overwrite the md5 sum that is at the file start with a specific string and do an md5sum over the whole file with that constant string. Then take the resultant md5 and replace the constant string with your new md5 sum.</p><p>Wiki has a basic source code example for md5 that I compiled under lcc-win32--it works just fine and could be modded to replace the string during the sum and relpace the string with the real md5 sum at the end pretty easy. But if you don&#039;t plan on modding the code often, a hexeditor could do the job quicker.&nbsp; </p><p>The string you put in place of the md5 sum is:</p><p>CC 96 28 EE 8D FB 21 BB 3D EF 6C B5 9F 77 4C 7C</p>											<p class="post-edited">(Last edited by <strong>jvvh5897</strong> on 14 Jul 2013, 23:26)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p207157">
				<div class="post-metadata">
					<div class="post-num">Post #25</div>
					<div class="post-author">lofrank</div>
					<div class="post-datetime">
						15 Jul 2013, 05:00					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>jvvh5897 wrote:</cite><blockquote><p>The code that starts at 0x68c4 is the compressed part of the boot. You can learn a lot from that code and it is smaller than the main code so less to get in the way--it does seem to have all the code needed to not only boot the box, but do comms on the web and serial port, flash LED and I suspect do a hard reset too with the button.</p><p>The main code starts around 0x40000 in the files and is lzma compressed too.</p><p>Use the mipsb setting in IDA. I can supply an IDC to help you do the disassembly, but it does not name routines for you. I can supply a list of routines that I have labeled.</p><p>BUT, I have already posted how to do the checksum. You overwrite the md5 sum that is at the file start with a specific string and do</p></blockquote></div><p>Hi, jvvh</p><p>Thanks for your quick reply.<br />I already success to fix checksum according your instructions.<br />But it&#039;s not enough for me, I want to know how you find this, the process must be more funny than the result.<br />Seems your IDC will be great useful, could you share it to me?</p><p>Thanks very much.</p>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 1 of 4</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=41040&amp;p=2.html">2</a></li><li><a href="viewtopic.php%3Fid=41040&amp;p=3.html">3</a></li><li><a href="viewtopic.php%3Fid=41040&amp;p=4.html">4</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>