<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> WNDR3700 exploration</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 1 Oct 2014 and 7 May 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 20</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=22311&amp;p=2.html">2</a></li><li><a href="viewtopic.php%3Fid=22311&amp;p=3.html">3</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=22311&amp;p=20.html">20</a></li></ul></nav></div>
			
		
		
			<article class="post" id="p96410">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">whiskas</div>
					<div class="post-datetime">
						26 Oct 2009, 17:56					</div>
				</div>
				<div class="post-content content">
					<p>I have a Netgear wndr3700 and am willing to serve as a guinea pig, to get openWrt running on it.</p><p>I&#039;ve already attached a Nokia CA-42 cable for serial access. For those willing to follow, here is a picture: <a href="http://img387.imageshack.us/i/26102009417.jpg/"><span class="postimg"><img src="http://img387.imageshack.us/img387/606/26102009417.th.jpg" alt="http://img387.imageshack.us/img387/606/26102009417.th.jpg" /></span></a>.<br />And here is the boot output:<br /></p><div class="codebox"><pre><code>U-Boot 1.1.4DNI1.6 (May 22 2009 - 16:37:44)

WNDR3700U (ar7100) U-boot 0.0.12
DRAM:  b8050000: 0xc0140180
64 MB
Top of RAM usable for U-Boot at: 84000000
Reserving 315k for U-Boot at: 83fb0000
Reserving 192k for malloc() at: 83f80000
Reserving 44 Bytes for Board Info at: 83f7ffd4
Reserving 36 Bytes for Global Data at: 83f7ffb0
Reserving 128k for boot params() at: 83f5ffb0
Stack Pointer at: 83f5ff98
Now running in RAM - U-Boot at: 83fb0000
id read 0x100000ff
flash size 8MB, sector count = 128
Flash:  8 MB
*** Warning - bad CRC, using default environment

In:    serial
Out:   serial
Err:   serial
Net:   ag7100_enet_initialize...
CHH:mac: 0 if: 2
CHH:mac:verify: 0 if: 00000002
: cfg1 0xf cfg2 0x7014
eth0: 00:24:XX:XX:XX:XX
eth0 up
CHH:mac: 1 if: 1
CHH:mac:verify: 1 if: 00000001
: cfg1 0xf cfg2 0x7014
eth1: 00:24:XX:XX:XX:XX
eth1 up
eth0, eth1
Trying eth0
: unit 0 phy is up...RGMii 1000Mbps full duplex
#259:ag7100_set_mac_from_link
: pll reg 0x18050010: 0x11110000
: cfg_1: 0x1ff0000
: cfg_2: 0x3ff
: cfg_3: 0x8001ff
: cfg_4: 0xffff
: cfg_5: 0xfffef
: done cfg2 0x7215 ifctl 0x40605060 miictrl 0x22

 Client starts...[Listening] for ADVERTISE...TTT
Retry count exceeded; boot the image as usual

 nmrp server is stopped or failed !
Hit any key to stop autoboot:  0
   Verifying Checksum ... OK
### SQUASHFS loading &#039;image/uImage&#039; to 0x80800000
### SQUASHFS load complete: 939504 bytes loaded to 0x80800000
## Booting image at 80800000 ...
   Image Name:   Linux Kernel Image
   Created:      2009-08-26   9:29:14 UTC
   Image Type:   MIPS Linux Kernel Image (lzma compressed)
   Data Size:    939440 Bytes = 917.4 kB
   Load Address: 80002000
   Entry Point:  80297000
   Verifying Checksum ... OK
   Uncompressing Kernel Image ... OK
No initrd
## Transferring control to Linux (at address 80297000) ...
## Giving linux memsize in bytes, 67108864

Starting kernel ...

Linux version 2.6.15 (ronger@ronger-desktop) (gcc version 3.4.4 (OpenWrt-2.0)) #1 Wed Aug 26 17:29:04 CST 2009
flash_size passed from bootloader = 8
CPU revision is: 00019374
Determined physical RAM map:
 memory: 04000000 @ 00000000 (usable)
Built 1 zonelists
Kernel command line: console=ttyS0,115200 root=31:09 rootfstype=squashfs init=/etc/preinit mtdparts=ar7100-nor0:320k(uboot),128k(env),7296k(rootfs),64k(config),64k(config_bak),64k(pot),64k(traffic_meter),128k(language),64k(caldata),7471040@458816(mount_fs)
Primary instruction cache 64kB, physically tagged, 4-way, linesize 32 bytes.
Primary data cache 32kB, 4-way, linesize 32 bytes.
Synthesized TLB refill handler (20 instructions).
Synthesized TLB load handler fastpath (32 instructions).
Synthesized TLB store handler fastpath (32 instructions).
Synthesized TLB modify handler fastpath (31 instructions).
Cache parity protection disabled
PID hash table entries: 512 (order: 9, 8192 bytes)
Using 340.000 MHz high precision timer.
Console: colour dummy device 80x25
Dentry cache hash table entries: 16384 (order: 4, 65536 bytes)
Inode-cache hash table entries: 8192 (order: 3, 32768 bytes)
Memory: 61952k/65536k available (2151k kernel code, 3536k reserved, 488k data, 132k init, 0k highmem)
Mount-cache hash table entries: 512
Checking for &#039;wait&#039; instruction...  available.
NET: Registered protocol family 16
WLAN ON/OFF button is pressed..
SCSI subsystem initialized
usbcore: registered new driver usbfs
usbcore: registered new driver hub
AR7100 GPIOC major 0
Initializing usb led semaphore
squashfs: version 3.0 (2006/03/15) Phillip Lougher
Initializing Cryptographic API
io scheduler noop registered
io scheduler deadline registered
Serial: 8250/16550 driver $Revision: #1 $ 4 ports, IRQ sharing disabled
serial8250.0: ttyS0 at MMIO 0x0 (irq = 19) is a 16550A
RAMDISK driver initialized: 1 RAM disks of 8192K size 1024 blocksize
10 cmdlinepart partitions found on MTD device ar7100-nor0
Creating 10 MTD partitions on &quot;ar7100-nor0&quot;:
0x00000000-0x00050000 : &quot;uboot&quot;
0x00050000-0x00070000 : &quot;env&quot;
0x00070000-0x00790000 : &quot;rootfs&quot;
0x00790000-0x007a0000 : &quot;config&quot;
0x007a0000-0x007b0000 : &quot;config_bak&quot;
0x007b0000-0x007c0000 : &quot;pot&quot;
0x007c0000-0x007d0000 : &quot;traffic_meter&quot;
0x007d0000-0x007f0000 : &quot;language&quot;
0x007f0000-0x00800000 : &quot;caldata&quot;
0x00070040-0x00790000 : &quot;mount_fs&quot;
mtd: partition &quot;mount_fs&quot; doesn&#039;t start on an erase block boundary -- force read-only
10 Dec 2004 USB 2.0 &#039;Enhanced&#039; Host Controller (EHCI) Driver (AR7100_EHCI)
In ar7100_ehci_drv_probe
probing ehci...
hcd-&gt;regs is 0xbb000000
ehci-&gt;caps is 0xbb000000
ehci-&gt;caps-&gt;hc_base is 0x1000010
ar7100-ehci ar7100-ehci.0: AR7100 EHCI
ar7100-ehci ar7100-ehci.0: new USB bus registered, assigned bus number 1
ar7100-ehci ar7100-ehci.0: irq 3, io mem 0x1b000000
hcc_params addr 0xbb000008 val 0xa020 hcs_params addr 0xbb000004 val 0x1212
ar7100-ehci ar7100-ehci.0: USB 0.0 started, EHCI 1.00, driver 10 Dec 2004
hub 1-0:1.0: USB hub found
hub 1-0:1.0: 2 ports detected
...probing done
2005 April 22 USB 1.1 &#039;Open&#039; Host Controller (OHCI) Driver (ar7100_ohci)block sizes: ed 64 td 64
In ohci_hcd_ar7100_drv_probeprobing...
ar7100-ohci ar7100-ohci.0: new USB bus registered, assigned bus number 2
ar7100-ohci ar7100-ohci.0: irq 22, io mem 0x1c000000
hub 2-0:1.0: USB hub found
hub 2-0:1.0: 2 ports detected
probing done
Initializing USB Mass Storage driver...
usbcore: registered new driver usb-storage
USB Mass Storage support registered.
usbcore: registered new driver usbserial
drivers/usb/serial/usb-serial.c: USB Serial support registered for generic
usbcore: registered new driver usbserial_generic
drivers/usb/serial/usb-serial.c: USB Serial Driver core
u32 classifier
    Perfomance counters on
NET: Registered protocol family 2
IP route cache hash table entries: 1024 (order: 0, 4096 bytes)
TCP established hash table entries: 4096 (order: 2, 16384 bytes)
TCP bind hash table entries: 4096 (order: 2, 16384 bytes)
TCP: Hash tables configured (established 4096 bind 4096)
TCP reno registered
ip_conntrack version 2.4 (512 buckets, 4096 max) - 228 bytes per conntrack
ip_conntrack_rtsp v0.6.21 loading
ip_nat_rtsp v0.6.21 loading
ip_tables: (C) 2000-2002 Netfilter core team
IPP2P v0.8.2 loading
DNIFILTER loading
TCP bic registered
NET: Registered protocol family 1
NET: Registered protocol family 10
IPv6 over IPv4 tunneling driver
NET: Registered protocol family 17
Ebtables v2.0 registered
ar7100wdt_init: Registering WDT success
VFS: Mounted root (squashfs filesystem) readonly.
Freeing unused kernel memory: 132k freed
Warning: unable to open an initial console.
Algorithmics/MIPS FPU Emulator v1.5
init started:  BusyBox v1.4.2 (2009-08-26 17:05:42 CST) multi-call binary
Loading data from /dev/mtd/3 ...
The data configuration is Valid
The data center is Running ...
ipt_CONENAT: module license &#039;unspecified&#039; taints kernel.
sed: /etc/modules.d/20-dnirtsp: No such file or directory
ip_conntrack_pptp version 3.1 loaded
ip_nat_pptp version 3.0 loaded
Generating Rules...
Done!
fuse init (API version 7.8)
fuse distribution version: 2.7.4
POT is Running...
POT is Finished!!!
The POT-(Get/Set) Demo is Running ...
sn:22R1985L00A2D
SN: 22R1985L00A2D
dni-qos module init at dev:eth1, real_dev:eth1
/home/ronger/release/wndr3700-35/build_mips/linux-2.6-wndr3700u/rtl8366s/switch-core.c #172:switch_init
/home/ronger/release/wndr3700-35/build_mips/linux-2.6-wndr3700u/rtl8366s/switch-core.c #177:switch_init
/home/ronger/release/wndr3700-35/build_mips/linux-2.6-wndr3700u/rtl8366s/switch-core.c #181:switch_init
/home/ronger/release/wndr3700-35/build_mips/linux-2.6-wndr3700u/rtl8366s/switch-core.c #201:switch_init
/home/ronger/release/wndr3700-35/build_mips/linux-2.6-wndr3700u/rtl8366s/switch-core.c #203:switch_init
/home/ronger/release/wndr3700-35/build_mips/linux-2.6-wndr3700u/rtl8366s/switch-core.c #210:switch_init init succeeds
AG7100: Length per segment 512
AG7100: Max segments per packet 4
AG7100: Max tx descriptor count    400
AG7100: Max rx descriptor count    252
AG7100: fifo cfg 3 018001ff
AG7100CHH: Mac address for unit 0
AG7100CHH: 00:24:XX:XX:XX:XX
AG7100CHH: Mac address for unit 1
AG7100CHH: 00:24:XX:XX:XX:XX
init the qos
NET-LAN: Default WAN MAC is : 00:24:XX:XX:XX:XX
AG7100: unsupported ioctl
device eth0 entered promiscuous mode
number of br ports=1
NET-LAN: Default LAN MAC is : 00:24:XX:XX:XX:XX
ag7100_ring_alloc Allocated 4800 at 0x83de8000
ag7100_ring_alloc Allocated 3024 at 0x83f7a000
CHH:mac:verify: 0 if: 00000002
AG7100: cfg1 0xf cfg2 0x7014
AG7100: unit 0 phy is up...RGMii 1000Mbps full duplex
AG7100#1000:ag7100_set_mac_from_link
AG7100: pll reg 0x18050010: 0x11110000
AG7100: cfg_1: 0x1ff0000
AG7100: cfg_2: 0x3ff
AG7100: cfg_3: 0x18001ff
AG7100: cfg_4: 0xffff
AG7100: cfg_5: 0xfffef
AG7100: done cfg2 0x7215 ifctl 0x0 miictrl 0x22
Writing 4
br0: port 1(eth0) entering learning state
br0: topology change detected, propagating
br0: port 1(eth0) entering forwarding state
/home/ronger/release/wndr3700-35/build_mips/linux-2.6-wndr3700u/kmod-ar7100-watchdog/watchdog.c #25:ar7100_reset_watchdog AR7100 HW watchdog enabled
udhcp server (v0.9.8) started
The attached devices demo is Running ...
killall: miniupnpd: no process killed
killall: utelnetd: no process killed
killall: telnetenable: no process killed
Jan  1 00:00:09 miniupnpd[969]: listening on 192.168.1.1:5555
The telnetenable is running ...
Deleting static route ... Done!
Adding static route ... Done!
ag7100_ring_alloc Allocated 4800 at 0x8394e000
ag7100_ring_alloc Allocated 3024 at 0x8394c000
CHH:mac:verify: 1 if: 00000000
AG7100: cfg1 0xf cfg2 0x7014
AG7100: unit 1: phy not up carrier 1
AG7100: WAN Rx Hang Detected 1 times!
Writing 6
ADDRCONF(NETDEV_UP): eth1: link is not ready
ag7100_ring_free Freeing at 0x8394e000
ag7100_ring_free Freeing at 0x8394c000
ag7100_ring_alloc Allocated 4800 at 0x8394e000
ag7100_ring_alloc Allocated 3024 at 0x8394c000
CHH:mac:verify: 1 if: 00000000
AG7100: cfg1 0xf cfg2 0x7014
Writing 6
ADDRCONF(NETDEV_UP): eth1: link is not ready
udhcp client (v0.9.8) started
traffic_meter config_update : killall: traffic_meter: no process killed
.
killall: ntpclient: no process killed
time zone index is : 0
Run NTP Client with setting: pri:time-g.netgear.com sec:time-h.netgear.com
Jan  1 00:00:15 miniupnpd[969]: received signal 15, good-bye
Jan  1 00:00:18 miniupnpd[1063]: listening on 192.168.1.1:5555
/etc/rc.d/rc.wlan: /etc/rc.d/rc.wlan: 56: uname: not found
Args: 1
ath_hal: 0.9.17.1 (AR5416, REGOPS_FUNC, WRITE_EEPROM, 11D)
wlan: 0.8.4.2 (Atheros/multi-bss)
ath_rate_atheros: Copyright (c) 2001-2005 Atheros Communications, Inc, All Rights Reserved
insmod: ath_dfs.ko: no module by that name found
ath_dev: Copyright (c) 2001-2007 Atheros Communications, Inc, All Rights Reserved
ath_pci: 0.9.4.5 (Atheros/multi-bss)
!!!!! SC Callback Registration for wifi0
wifi0: Atheros 9280: mem=0x10000000, irq=48 hw_base=0xb0000000
!!!!! SC Callback Registration for wifi1
wifi1: Atheros 9280: mem=0x10010000, irq=49 hw_base=0xb0010000
wlan: mac acl policy registered
wlan_me: Version 0.1
Copyright (c) 2008 Atheros Communications, Inc. All Rights Reserved
Creating ap for NETGEAR on
Added ath0 mode master
Interface doesn&#039;t accept private ioctl...
HALDbg (8BE0): Operation not permitted
The command noedgech needs exactly 1 argument(s)...
Invalid command : ampdumin
Created ath0 mode ap for NETGEAR
lo        no wirelAG7100: unsupported ioctl
AG7100: unsupported ioctl


sit0      no wireless extensions.

br0       no wireless extensions.

eth0      no wireless extensions.

eth1      no wireless extensions.

wifi0     no wireless extensions.

wifi1     no wireless extensions.

Modules already loaded
Creating ap for NETGEAR-5G on
Added ath1 mode master
Interface doesn&#039;t accept private ioctl...
HALDbg (8BE0): Operation not permitted
The command noedgech needs exactly 1 argument(s)...
Invalid command : ampdumin
Created ath1 mode ap for NETGEAR-5G
lo        no wirelAG7100: unsupported ioctl
AG7100: unsupported ioctl


sit0      no wireless extensions.

br0       no wireless extensions.

eth0      no wireless extensions.

eth1      no wireless extensions.

wifi0     no wireless extensions.

wifi1     no wireless extensions.

/etc/ath/activateVAP: /etc/ath/activateVAP: 62: uname: not found
lo        no wirelAG7100: unsupported ioctl
AG7100: unsupported ioctl


sit0      no wireless extensions.

br0       no wireless extensions.

eth0      no wireless extensions.

eth1      no wireless extensions.

wifi0     no wireless extensions.

wifi1     no wireless extensions.

device ath0 entered promiscuous mode
br0: port 2(ath0) entering learning state
br0: topology change detected, propagating
br0: port 2(ath0) entering forwarding state
number of br ports=2
/etc/ath/activateVAP: /etc/ath/activateVAP: 1: arping: not found
&gt;&gt;&gt;&gt;&gt; WPS ENABLED, PSK
cat: /etc/wpa2/WSC_ath0.conf: No such file or directory
&gt;&gt;&gt;&gt;&gt; WPS Translate, Index:0
/etc/ath/activateVAP: /etc/ath/activateVAP: 62: uname: not found
lo        no wirelAG7100: unsupported ioctl
AG7100: unsupported ioctl


sit0      no wireless extensions.

br0       no wireless extensions.

eth0      no wireless extensions.

eth1      no wireless extensions.

wifi0     no wireless extensions.

wifi1     no wireless extensions.

Country ie is DE
device ath1 entered promiscuous mode
br0: port 3(ath1) entering learning state
br0: topology change detected, propagating
br0: port 3(ath1) entering forwarding state
number of br ports=3
/etc/ath/activateVAP: /etc/ath/activateVAP: 1: arping: not found
&gt;&gt;&gt;&gt;&gt; WPS ENABLED, PSK
cat: /etc/wpa2/WSC_ath1.conf: No such file or directory
&gt;&gt;&gt;&gt;&gt; WPS Translate, Index:2
Making Topology File . . .
Reading topology file /var/run/topology.conf ...
Reading bss configuration file /etc/wpa2/WSC_ath0.conf ...

Reading bss configuration file /etc/wpa2/WSC_ath1.conf ...

br0: port 2(ath0) entering disabled state
br0: port 3(ath1) entering disabled state
l2_packet_receive - recvfrom: Network is down
Could not connect to kernel driver.
Using interface ath0 with hwaddr 00:24:XX:XX:XX:XX and ssid &#039;NETGEAR&#039;
Country ie is DE
br0: port 2(ath0) entering learning state
br0: topology change detected, propagating
br0: port 2(ath0) entering forwarding state
upnp_wps_device_init called
l2_packet_receive - recvfrom: Network is down
Could not connect to kernel driver.
Using interface ath1 with hwaddr 00:24:XX:XX:XX:XX and ssid &#039;NECountry ie is DE
TGEAR-5G&#039;
br0: port 3(ath1) entering learning state
br0: topology change detected, propagating
br0: port 3(ath1) entering forwarding state
upnp_wps_device_init called
Starting Firewall...
Done!
time zone index is : 0
Run NTP Client with setting: pri:time-g.netgear.com sec:time-h.netgear.com
dnsmasq: started, version 2.39 cachesize 150
dnsmasq: compile time options: IPv6 GNU-getopt ISC-leasefile no-DBus no-I18N no-TFTP
dnsmasq: using local addresses only for domain lan
dnsmasq: failed to access /tmp/dhcp.leases: No such file or directory
dnsmasq: no servers found in /tmp/resolv.conf, will retry
dnsmasq: cleared cache
killall: uhttpd: no process killed
checksum = 0xFF, len = 131072
There is not language table in flash or language table was broken!
gui_region = English
region = English, download_region =
 Update string table successfully, memory usage: 248KB.
The httpd server is running ...
Start utelnetd by telnetenable
killall: lld2d: no process killed
traffic_meter start : .
USB Storage daemon is Running ...
Boot up procedure is Finished!!!

Please press Enter to activate this console.


BusyBox v1.4.2 (2009-08-26 17:05:42 CST) Built-in shell (ash)
Enter &#039;help&#039; for a list of built-in commands.

  _______                     ________        __
 |       |.-----.-----.-----.|  |  |  |.----.|  |_
 |   -   ||  _  |  -__|     ||  |  |  ||   _||   _|
 |_______||   __|_____|__|__||________||__|  |____|
          |__| W I R E L E S S   F R E E D O M
 KAMIKAZE (7.09) -----------------------------------
  * 10 oz Vodka       Shake well with ice and strain
  * 10 oz Triple sec  mixture into 10 shot glasses.
  * 10 oz lime juice  Salute!
 ---------------------------------------------------
root@WNDR3700:/#</code></pre></div><p>Some more outputs:<br /></p><div class="codebox"><pre><code>root@WNDR3700:/# cat /proc/cpuinfo                                                       
system type             : Atheros AR7100 (hydra)                                         
processor               : 0                                                              
cpu model               : MIPS 24K V7.4                                                  
BogoMIPS                : 451.58                                                         
wait instruction        : yes                                                            
microsecond timers      : yes                                                            
tlb_entries             : 16                                                             
extra interrupt vector  : yes                                                            
hardware watchpoint     : yes                                                            
ASEs implemented        : mips16                                                         
VCED exceptions         : not available                                                  
VCEI exceptions         : not available                                                  

root@WNDR3700:/# cat /proc/mtd                                                           
dev:    size   erasesize  name                                                           
mtd0: 00050000 00010000 &quot;uboot&quot;                                                          
mtd1: 00020000 00010000 &quot;env&quot;                                                            
mtd2: 00720000 00010000 &quot;rootfs&quot;                                                         
mtd3: 00010000 00010000 &quot;config&quot;                                                         
mtd4: 00010000 00010000 &quot;config_bak&quot;                                                     
mtd5: 00010000 00010000 &quot;pot&quot;                                                            
mtd6: 00010000 00010000 &quot;traffic_meter&quot;                                                  
mtd7: 00020000 00010000 &quot;language&quot;                                                       
mtd8: 00010000 00010000 &quot;caldata&quot;                                                        
mtd9: 0071ffc0 00010000 &quot;mount_fs&quot;                                                       

root@WNDR3700:/# mount                                                                   
rootfs on / type rootfs (rw)                                                             
/dev/root on / type squashfs (ro)                                                        
none on /proc type proc (rw,nodiratime)                                                  
none on /tmp type tmpfs (rw,nosuid,nodev)                                                
tmpfs on /dev type tmpfs (rw)                                                            
sysfs on /sys type sysfs (rw)</code></pre></div><p>I can access u-boot by pressing a key while booting. Here is the output of printenv:<br /></p><div class="codebox"><pre><code>bootargs=console=ttyS0,115200 root=31:02 rootfstype=jffs2 init=/sbin/init mtdparts=ar7100-nor0:256k(uboot),128k(env),6144k(rootfs),64k(caldata),1024k(uImage)
bootcmd=fsload 80800000 image/uImage;bootm 80800000
bootdelay=1
baudrate=115200
ipaddr=192.168.1.2
serverip=192.168.1.1
stdin=serial
stdout=serial
stderr=serial
ethact=eth0</code></pre></div><p>So as far as i understand, the device loads the file &#039;/image/uImage&#039; to RAM and boots from it.</p>											<p class="post-edited">(Last edited by <strong>whiskas</strong> on 26 Oct 2009, 20:57)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p96413">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">whiskas</div>
					<div class="post-datetime">
						26 Oct 2009, 18:11					</div>
				</div>
				<div class="post-content content">
					<p>So first step should be to get a ramdisk image running.</p><p>I build an image from trunk with settings: ar71xx, no wifi, ramdisk (lzma). I set up an tftp-server and loaded the files by:<br /></p><div class="codebox"><pre><code>ar7100&gt; setenv ipaddr 192.168.1.1                                                        
ar7100&gt; setenv serverip 192.168.1.2  

ar7100&gt; tftpboot 80800000 lzma.bin                                                       
Trying eth0                                                                              
: unit 0 phy is up...RGMii 1000Mbps full duplex                                          
#259:ag7100_set_mac_from_link                                                            
: pll reg 0x18050010: 0x11110000                                                         
: cfg_1: 0x1ff0000                                                                       
: cfg_2: 0x3ff                                                                           
: cfg_3: 0x8001ff                                                                        
: cfg_4: 0xffff                                                                          
: cfg_5: 0x2fffef                                                                        
: done cfg2 0x7215 ifctl 0x40605060 miictrl 0x22                                         
Using eth0 device                                                                        
TFTP from server 192.168.1.2; our IP address is 192.168.1.1                              
Filename &#039;lzma.bin&#039;.                                                                     
Load address: 0x80800000                                                                 
Loading: #################################################################               
         #################################################################               
         #################################################################               
         #################################################################               
         #################################################################               
         #################################################################               
         #################################################################               
         #######                                                                         
done                                                                                     
Bytes transferred = 2362068 (240ad4 hex)                                                 
ar7100&gt; bootm                                                                            
## Booting image at 80800000 ...                                                         
Bad Magic Number                                                                         
Trying eth0                                                                              
: unit 0 phy is up...RGMii 1000Mbps full duplex                                          
#259:ag7100_set_mac_from_link                                                            
: pll reg 0x18050010: 0x11110000                                                         
: cfg_1: 0x1ff0000                                                                       
: cfg_2: 0x3ff                                                                           
: cfg_3: 0x8001ff                                                                        
: cfg_4: 0xffff                                                                          
: cfg_5: 0x2fffef                                                                        
: done cfg2 0x7215 ifctl 0x40605060 miictrl 0x22                                         
                                                                                         
The Router is in TFTP Server Firmware Recovery mode NOW!                                 
Listening on Port : 69, IP Address: 192.168.1.1...</code></pre></div><p>So.. &#039;Bad Magic Number&#039;. Afterwards it tries recovery mode which i can abort. The same result with different images (bzip, from snapshots, different RAM-addresses...).</p><p>The memory-dump of the specified address looks like this:<br /></p><div class="codebox"><pre><code>ar7100&gt; md 80800000                                                                      
80800000: 27051956 51038946 4ae5b6ef 003256ae    &#039;..VQ..FJ....2V.                        
80800010: 80060000 80060000 88b4824c 05050201    ...........L....                        
80800020: 4d495053 204f7065 6e577274 204c696e    MIPS OpenWrt Lin                        
80800030: 75782d32 2e362e33 302e3800 00000000    ux-2.6.30.8.....                        
80800040: 1f8b0808 c6b6e54a 0203766d 6c696e75    .......J..vmlinu                        
80800050: 7800ec5b 0f7454e5 95bfefcd 64e6254c    x..[.tT.....d.%L                        
80800060: 92070e32 4d523363 de9041b2 7ba6dbe4    ...2MR3c..A.{...                        
80800070: 80757a7c c660071a 34baf49c 14393dd9    .uz|.`..4....9=.                        
80800080: 8a7bd25d dc43cf72 da28b0fb 84c04e60    .{.].C.r.(....N`                        
80800090: c20b2eab 3934ea48 094ee0e1 448b1a04    ....94.H.N..D...                        
808000a0: 7454c4d1 726ab453 1bb6fec9 ae80b1a2    tT..rj.S........                        
808000b0: 663d538d 1a7d7bbf efbe8199 14d0627b    f=S..}{.......b{                        
808000c0: dc25cc39 5f6ebeef bbf77edf bdf777ef    .%.9_n....~...w.                        
808000d0: f7fecc48 c2e64570 e173e173 e133e93f    ...H..Ep.s.s.3.?                        
808000e0: 572f6c68 9c7fedbc 6f5df0c4 85cf85cf    W/lh....o]......                        
808000f0: 850ffb5c d5d20232 8088ff26 135da0ea    ...\...2...&amp;.]..


ar7100&gt; iminfo
## Checking Image at 80800000 ...
Bad Magic Number</code></pre></div><p>After loading the original uImage file from /image/uImage, i can take a look at it:<br /></p><div class="codebox"><pre><code>ar7100&gt; fsload 80800000 image/uImage
### SQUASHFS loading &#039;image/uImage&#039; to 0x80800000
### SQUASHFS load complete: 936796 bytes loaded to 0x80800000


ar7100&gt; md 80800000
80800000: 33373030 9d721b84 4a66f234 000e4b1c    3700.r..Jf.4..K.
80800010: 80002000 80295000 14e13558 05050203    .. ..)P...5X....
80800020: 4c696e75 78204b65 726e656c 20496d61    Linux Kernel Ima
80800030: 67650000 00000000 00000000 00000000    ge..............
80800040: 5d000080 0086302b 00000000 00000068    ].....0+.......h
80800050: 2e824f33 bf0ff5c6 4be9d243 96a1ac7a    ..O3....K..C...z
80800060: 0cb0fefb 8d7b2233 0927b080 0f2d3919    .....{&quot;3.&#039;...-9.
80800070: 9d03325e bb546da1 3e76fe99 d3da8205    ..2^.Tm.&gt;v......
80800080: 6c7bbf92 72e0330d 885ffcb0 b47f3db9    l{..r.3.._....=.
80800090: 7bb0102b 22c2e8b0 d590904a df901386    {..+&quot;......J....
808000a0: 9853df72 3855b163 d1682b56 0005807c    .S.r8U.c.h+V...|
808000b0: 65c98211 05aaea79 f372d01e 3c1723d0    e......y.r..&lt;.#.
808000c0: c64b4818 05e89092 845a6ffc b38c7a01    .KH......Zo...z.
808000d0: 62915dfb 42398609 7173e87d dd31954e    b.].B9..qs.}.1.N
808000e0: d9ad16bb 1d7cc375 6bad2a65 2e46cff8    .....|.uk.*e.F..
808000f0: 5e461588 988e9433 3ca18203 99d4f093    ^F.....3&lt;.......


ar7100&gt; iminfo                                                                                                                 
## Checking Image at 80800000 ...                                                        
   Image Name:   Linux Kernel Image                                                      
   Created:      2009-07-22  11:04:20 UTC                                                
   Image Type:   MIPS Linux Kernel Image (lzma compressed)                               
   Data Size:    936732 Bytes = 914.8 kB                                                 
   Load Address: 80002000                                                                
   Entry Point:  80295000                                                                
   Verifying Checksum ... OK</code></pre></div><p>So.. what now?</p>											<p class="post-edited">(Last edited by <strong>whiskas</strong> on 26 Oct 2009, 18:34)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p96421">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">Nilfred</div>
					<div class="post-datetime">
						26 Oct 2009, 20:36					</div>
				</div>
				<div class="post-content content">
					<p>Look if 3700 repeats on every n offset or is only found at the start. This should be the magic number as seen on Linksys routers (First time on Netgear)<br />Edit: <a href="https://forum.openwrt.org/viewtopic.php?id=21170">DUPE</a></p>											<p class="post-edited">(Last edited by <strong>Nilfred</strong> on 27 Oct 2009, 02:49)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p96435">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">ratbug</div>
					<div class="post-datetime">
						27 Oct 2009, 05:55					</div>
				</div>
				<div class="post-content content">
					<p>I got the same error Bad Magic Number no matter what I tried. And&nbsp; then the router dumped to TFTP Server Firmware Recovery mode .I even tried loading the same uImage copied from image directory.<br />I think the u-boot booloader used does a checksum and header check on the image. I may be wrong here, but a good way forward is to modify or change&nbsp; the u-boot</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p96438">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">rigolo</div>
					<div class="post-datetime">
						27 Oct 2009, 08:01					</div>
				</div>
				<div class="post-content content">
					<p>Netgear has published their source of uBoot for the wndr3700. So that should help I think?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p96439">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">ratbug</div>
					<div class="post-datetime">
						27 Oct 2009, 08:22					</div>
				</div>
				<div class="post-content content">
					<p>yes they published it, you could even upgrade (the instructions are there)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p96441">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">ratbug</div>
					<div class="post-datetime">
						27 Oct 2009, 08:33					</div>
				</div>
				<div class="post-content content">
					<p>I also tried encapsulating the image with header information using mkimage tools, it did not work</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p96442">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">whiskas</div>
					<div class="post-datetime">
						27 Oct 2009, 10:40					</div>
				</div>
				<div class="post-content content">
					<p>The string &#039;3700&#039; caught my eye too. But it does not repeat throughout the image.</p><p>If requested, i can upload/send the uImage file.</p><p>As posted by Borromi in the other thread, this is the link to the sourcecode for the firmware and the used bootloader: <a href="http://kb.netgear.com/app/answers/detail/a_id/2649">link</a></p><p>So i&#039;ll try to get a look at the bootloader source for a special file header. Starting point is the function &#039;int do_bootm(...)&#039; in file &#039;cmd_bootm.c&#039;.</p><div class="quotebox"><cite>ratbug wrote:</cite><blockquote><p>[...] you could even upgrade (the instructions are there)</p></blockquote></div><p>What do you mean by that?</p>											<p class="post-edited">(Last edited by <strong>whiskas</strong> on 27 Oct 2009, 11:24)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p96446">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">whiskas</div>
					<div class="post-datetime">
						27 Oct 2009, 11:42					</div>
				</div>
				<div class="post-content content">
					<p>I found this: in header.h:<br /></p><div class="codebox"><pre><code>#define IH_MAGIC    0x33373030    /* Image Magic Number       */</code></pre></div><p>which is hex for &#039;3700&#039;. <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>The struct for the image header is (image.h):<br /></p><div class="codebox"><pre><code>typedef struct image_header {
    uint32_t    ih_magic;    /* Image Header Magic Number    */
    uint32_t    ih_hcrc;    /* Image Header CRC Checksum    */
    uint32_t    ih_time;    /* Image Creation Timestamp    */
    uint32_t    ih_size;    /* Image Data Size        */
    uint32_t    ih_load;    /* Data     Load  Address        */
    uint32_t    ih_ep;        /* Entry Point Address        */
    uint32_t    ih_dcrc;    /* Image Data CRC Checksum    */
    uint8_t        ih_os;        /* Operating System        */
    uint8_t        ih_arch;    /* CPU architecture        */
    uint8_t        ih_type;    /* Image Type            */
    uint8_t        ih_comp;    /* Compression Type        */
    uint8_t        ih_name[IH_NMLEN];    /* Image Name        */
} image_header_t;</code></pre></div><p>So.. placing &#039;3700&#039; at the start and recalculation header checksum should do the magic, huh?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p96451">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">ratbug</div>
					<div class="post-datetime">
						27 Oct 2009, 14:11					</div>
				</div>
				<div class="post-content content">
					<p>@whiska,</p><p>Try to set : setenv bootargs &#039;board=WNDR3700&#039;; I have not tried that.</p><p>As far the instructions, I get back to you on this. I&#039;m not at home now but it is there in one the README files</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p96454">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">whiskas</div>
					<div class="post-datetime">
						27 Oct 2009, 14:55					</div>
				</div>
				<div class="post-content content">
					<p>SUCCESS!</p><p>Complete HowTo so far:<br />1. build openwrt (ar71xx...)<br />2. copy &#039;openwrt-ar71xx-uImage-lzma.bin&#039; to your tftpboot-Folder<br />3. change image header:<br />3.1. dd if=openwrt-ar71xx-uImage-lzma.bin of=header count=1 bs=64<br />3.2. open &#039;header&#039; with a hex-editor and write the first bytes: 3700 (as characters) and the next 4 bytes &#039;00000000&#039; (as hexcode!)<br />3.3. calculate the crc32 of the file &#039;header&#039; (i am using the program from here <a href="http://kremlor.net/projects/crc32/">link</a>)<br />3.4. open the &#039;openwrt-ar71xx-uImage-lzma.bin&#039; and edit the first bytes: &#039;3700&#039; as characters and the next 4 bytes the generated crc32-checksum<br />4. (optional) in bootloader: setenv ipaddr 192.168.1.1; setenv serverip 192.168.1.2; setenv bootargs &#039;board=WNDR3700&#039;<br />5. tftpboot 80800000 openwrt-ar71xx-uImage-lzma.bin<br />6. (optional) &#039;iminfo 80800000&#039; should produce something like </p><div class="codebox"><pre><code>ar7100&gt; iminfo

## Checking Image at 80800000 ...
   Image Name:   MIPS OpenWrt Linux-2.6.30.8
   Created:      2009-10-26  16:41:19 UTC
   Image Type:   MIPS Linux Kernel Image (lzma compressed)
   Data Size:    2289739 Bytes =  2.2 MB
   Load Address: 80060000
   Entry Point:  80060000
   Verifying Checksum ... OK</code></pre></div><p>7. &#039;bootm 80800000&#039;</p><p>bootlog from openWrt as ramdisk: </p><div class="codebox"><pre><code>ar7100&gt; bootm
## Booting image at 80800000 ...
   Image Name:   MIPS OpenWrt Linux-2.6.30.8
   Created:      2009-10-26  16:41:19 UTC
   Image Type:   MIPS Linux Kernel Image (lzma compressed)
   Data Size:    2289739 Bytes =  2.2 MB
   Load Address: 80060000
   Entry Point:  80060000
   Verifying Checksum ... OK
   Uncompressing Kernel Image ... OK
No initrd
## Transferring control to Linux (at address 80060000) ...
## Giving linux memsize in bytes, 67108864

Starting kernel ...

Linux version 2.6.30.8 (marco@marco-laptop) (gcc version 4.1.2) #2 Mon Oct 26 17:40:31 CET 2009
console [early0] enabled
CPU revision is: 00019374 (MIPS 24Kc)
Atheros AR7161 rev 2, CPU:680.000 MHz, AHB:170.000 MHz, DDR:340.000 MHz
Determined physical RAM map:
 memory: 04000000 @ 00000000 (usable)
Initrd not found or empty - disabling initrd
Zone PFN ranges:
  Normal   0x00000000 -&gt; 0x00004000
Movable zone start PFN for each node
early_node_map[1] active PFN ranges
    0: 0x00000000 -&gt; 0x00004000
Built 1 zonelists in Zone order, mobility grouping on.  Total pages: 16256
Kernel command line: rootfstype=squashfs,yaffs,jffs2 noinitrd console=ttyS0,115200 board=WNDR3700
Primary instruction cache 64kB, VIPT, 4-way, linesize 32 bytes.
Primary data cache 32kB, 4-way, VIPT, cache aliases, linesize 32 bytes
Writing ErrCtl register=00000000
Readback ErrCtl register=00000000
NR_IRQS:56
PID hash table entries: 256 (order: 8, 1024 bytes)
Dentry cache hash table entries: 8192 (order: 3, 32768 bytes)
Inode-cache hash table entries: 4096 (order: 2, 16384 bytes)
Memory: 56476k/65536k available (1914k kernel code, 8984k reserved, 428k data, 5600k init, 0k highmem)
SLUB: Genslabs=7, HWalign=32, Order=0-3, MinObjects=0, CPUs=1, Nodes=1
Calibrating delay loop... 452.19 BogoMIPS (lpj=2260992)
Mount-cache hash table entries: 512
net_namespace: 528 bytes
NET: Registered protocol family 16
MIPS: machine is Generic AR71xx board
bio: create slab &lt;bio-0&gt; at 0
NET: Registered protocol family 2
IP route cache hash table entries: 1024 (order: 0, 4096 bytes)
TCP established hash table entries: 2048 (order: 2, 16384 bytes)
TCP bind hash table entries: 2048 (order: 1, 8192 bytes)
TCP: Hash tables configured (established 2048 bind 2048)
TCP reno registered
NET: Registered protocol family 1
squashfs: version 4.0 (2009/01/31) Phillip Lougher
Registering mini_fo version $Id$
JFFS2 version 2.2. (NAND) (SUMMARY)  © 2001-2006 Red Hat, Inc.
yaffs Oct 26 2009 17:00:36 Installing. 
msgmni has been set to 110
alg: No test for lzma (lzma-generic)
alg: No test for stdrng (krng)
io scheduler noop registered
io scheduler deadline registered (default)
Serial: 8250/16550 driver, 1 ports, IRQ sharing disabled
serial8250.0: ttyS0 at MMIO 0x18020000 (irq = 11) is a 16550A
console handover: boot [early0] -&gt; real [ttyS0]
Atheros AR71xx SPI Controller driver version 0.2.4
Atheros AR71xx hardware watchdog driver version 0.1.0
TCP westwood registered
NET: Registered protocol family 17
802.1Q VLAN Support v1.8 Ben Greear &lt;greearb@candelatech.com&gt;
All bugs added by David S. Miller &lt;davem@redhat.com&gt;
Freeing unused kernel memory: 5600k freed
- preinit -
Press CTRL-C for failsafe
gpio-buttons driver version 0.1.1
Button Hotplug driver version 0.3.1

Please press Enter to activate this console. cfg80211: Using static regulatory domain info
cfg80211: Regulatory domain: US
    (start_freq - end_freq @ bandwidth), (max_antenna_gain, max_eirp)
    (2402000 KHz - 2472000 KHz @ 40000 KHz), (600 mBi, 2700 mBm)
    (5170000 KHz - 5190000 KHz @ 40000 KHz), (600 mBi, 2300 mBm)
    (5190000 KHz - 5210000 KHz @ 40000 KHz), (600 mBi, 2300 mBm)
    (5210000 KHz - 5230000 KHz @ 40000 KHz), (600 mBi, 2300 mBm)
    (5230000 KHz - 5330000 KHz @ 40000 KHz), (600 mBi, 2300 mBm)
    (5735000 KHz - 5835000 KHz @ 40000 KHz), (600 mBi, 3000 mBm)
cfg80211: Calling CRDA for country: US
PPP generic driver version 2.4.2
ip_tables: (C) 2000-2006 Netfilter Core Team
NET: Registered protocol family 24
nf_conntrack version 0.5.0 (1024 buckets, 4096 max)
ath_hal: module license &#039;Proprietary&#039; taints kernel.
Disabling lock debugging due to kernel taint
ath_hal: 2009-05-08 (AR5210, AR5211, AR5212, AR5416, RF5111, RF5112, RF2413, RF5413, RF2133, RF2425, REGOPS_FUNC, XR)
ath_pci: trunk
wlan: trunk
wlan: mac acl policy registered
ath_rate_minstrel: Minstrel automatic rate control algorithm 1.2 (trunk)
ath_rate_minstrel: look around rate set to 10%
ath_rate_minstrel: EWMA rolloff level set to 75%
ath_rate_minstrel: max segment size in the mrr set to 6000 us



BusyBox v1.14.4 (2009-10-26 16:42:34 CET) built-in shell (ash)
Enter &#039;help&#039; for a list of built-in commands.

  _______                     ________        __
 |       |.-----.-----.-----.|  |  |  |.----.|  |_
 |   -   ||  _  |  -__|     ||  |  |  ||   _||   _|
 |_______||   __|_____|__|__||________||__|  |____|
          |__| W I R E L E S S   F R E E D O M
 KAMIKAZE (bleeding edge, r17993) ------------------
  * 10 oz Vodka       Shake well with ice and strain
  * 10 oz Triple sec  mixture into 10 shot glasses.
  * 10 oz lime juice  Salute!
 ---------------------------------------------------
root@OpenWrt:/#</code></pre></div><p>explanation:<br />The image header is 64 bytes long. the last 32 bytes is the image name as byte-array.<br />dd ... copies these 64 bytes to a separate file &#039;header&#039;<br />We change the header-file to the correct magic number: &#039;3700&#039;.<br />Now to calculating the checksum: prior to this we have to delete the old checksum! -&gt; overwrite it with zeros in the header file<br />By writing the new magic number and the new checksum to our image-file the image is ready for installing.</p>											<p class="post-edited">(Last edited by <strong>whiskas</strong> on 27 Oct 2009, 15:11)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p96457">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">whiskas</div>
					<div class="post-datetime">
						27 Oct 2009, 15:50					</div>
				</div>
				<div class="post-content content">
					<p>I think this is the point, where we have to wait for the openWrt-developers.</p><p>The image doesn&#039;t bring an interface up.</p><p>Here are some outputs:</p><div class="codebox"><pre><code>ar7100&gt; bootm
## Booting image at 80800000 ...
   Image Name:   MIPS OpenWrt Linux-2.6.30.8
   Created:      2009-10-27  13:28:09 UTC
   Image Type:   MIPS Linux Kernel Image (lzma compressed)
   Data Size:    2289824 Bytes =  2.2 MB
   Load Address: 80060000
   Entry Point:  80060000
   Verifying Checksum ... OK
   Uncompressing Kernel Image ... OK
No initrd
## Transferring control to Linux (at address 80060000) ...
## Giving linux memsize in bytes, 67108864

Starting kernel ...

Linux version 2.6.30.8 (marco@marco-laptop) (gcc version 4.1.2) #3 Tue Oct 27 14:27:20 CET 2009
console [early0] enabled
CPU revision is: 00019374 (MIPS 24Kc)
Atheros AR7161 rev 2, CPU:680.000 MHz, AHB:170.000 MHz, DDR:340.000 MHz
Determined physical RAM map:
 memory: 04000000 @ 00000000 (usable)
Initrd not found or empty - disabling initrd
Zone PFN ranges:
  Normal   0x00000000 -&gt; 0x00004000
Movable zone start PFN for each node
early_node_map[1] active PFN ranges
    0: 0x00000000 -&gt; 0x00004000
Built 1 zonelists in Zone order, mobility grouping on.  Total pages: 16256
Kernel command line: rootfstype=squashfs,yaffs,jffs2 noinitrd console=ttyS0,115200 board=WNDR3700
Primary instruction cache 64kB, VIPT, 4-way, linesize 32 bytes.
Primary data cache 32kB, 4-way, VIPT, cache aliases, linesize 32 bytes
Writing ErrCtl register=00000000
Readback ErrCtl register=00000000
NR_IRQS:56
PID hash table entries: 256 (order: 8, 1024 bytes)
Dentry cache hash table entries: 8192 (order: 3, 32768 bytes)
Inode-cache hash table entries: 4096 (order: 2, 16384 bytes)
Memory: 56476k/65536k available (1914k kernel code, 8984k reserved, 428k data, 5600k init, 0k highmem)
SLUB: Genslabs=7, HWalign=32, Order=0-3, MinObjects=0, CPUs=1, Nodes=1
Calibrating delay loop... 452.19 BogoMIPS (lpj=2260992)
Mount-cache hash table entries: 512
net_namespace: 528 bytes
NET: Registered protocol family 16
MIPS: machine is Generic AR71xx board
bio: create slab &lt;bio-0&gt; at 0
NET: Registered protocol family 2
IP route cache hash table entries: 1024 (order: 0, 4096 bytes)
TCP established hash table entries: 2048 (order: 2, 16384 bytes)
TCP bind hash table entries: 2048 (order: 1, 8192 bytes)
TCP: Hash tables configured (established 2048 bind 2048)
TCP reno registered
NET: Registered protocol family 1
squashfs: version 4.0 (2009/01/31) Phillip Lougher
Registering mini_fo version $Id$
JFFS2 version 2.2. (NAND) (SUMMARY)  © 2001-2006 Red Hat, Inc.
yaffs Oct 26 2009 17:00:36 Installing. 
msgmni has been set to 110
alg: No test for lzma (lzma-generic)
alg: No test for stdrng (krng)
io scheduler noop registered
io scheduler deadline registered (default)
Serial: 8250/16550 driver, 1 ports, IRQ sharing disabled
serial8250.0: ttyS0 at MMIO 0x18020000 (irq = 11) is a 16550A
console handover: boot [early0] -&gt; real [ttyS0]
Atheros AR71xx SPI Controller driver version 0.2.4
Atheros AR71xx hardware watchdog driver version 0.1.0
TCP westwood registered
NET: Registered protocol family 17
802.1Q VLAN Support v1.8 Ben Greear &lt;greearb@candelatech.com&gt;
All bugs added by David S. Miller &lt;davem@redhat.com&gt;
Freeing unused kernel memory: 5600k freed
- preinit -
Press CTRL-C for failsafe
gpio-buttons driver version 0.1.1
Button Hotplug driver version 0.3.1

Please press Enter to activate this console. cfg80211: Using static regulatory domain info
cfg80211: Regulatory domain: US
    (start_freq - end_freq @ bandwidth), (max_antenna_gain, max_eirp)
    (2402000 KHz - 2472000 KHz @ 40000 KHz), (600 mBi, 2700 mBm)
    (5170000 KHz - 5190000 KHz @ 40000 KHz), (600 mBi, 2300 mBm)
    (5190000 KHz - 5210000 KHz @ 40000 KHz), (600 mBi, 2300 mBm)
    (5210000 KHz - 5230000 KHz @ 40000 KHz), (600 mBi, 2300 mBm)
    (5230000 KHz - 5330000 KHz @ 40000 KHz), (600 mBi, 2300 mBm)
    (5735000 KHz - 5835000 KHz @ 40000 KHz), (600 mBi, 3000 mBm)
cfg80211: Calling CRDA for country: US
PPP generic driver version 2.4.2
ip_tables: (C) 2000-2006 Netfilter Core Team
NET: Registered protocol family 24
nf_conntrack version 0.5.0 (1024 buckets, 4096 max)
ath_hal: module license &#039;Proprietary&#039; taints kernel.
Disabling lock debugging due to kernel taint
ath_hal: 2009-05-08 (AR5210, AR5211, AR5212, AR5416, RF5111, RF5112, RF2413, RF5413, RF2133, RF2425, REGOPS_FUNC, XR)
ath_pci: trunk
wlan: trunk
wlan: mac acl policy registered
ath_rate_minstrel: Minstrel automatic rate control algorithm 1.2 (trunk)
ath_rate_minstrel: look around rate set to 10%
ath_rate_minstrel: EWMA rolloff level set to 75%
ath_rate_minstrel: max segment size in the mrr set to 6000 us



root@OpenWrt:/# ifconfig 
lo        Link encap:Local Loopback  
          inet addr:127.0.0.1  Mask:255.0.0.0
          UP LOOPBACK RUNNING  MTU:16436  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)



root@OpenWrt:/# lsmodroot@OpenWrt:/# lsmod 
Module                  Size  Used by    Tainted: P  
ath_pci               280096  0 
ath_hal               293968  1 ath_pci
nf_nat_tftp              432  0 
nf_conntrack_tftp       2384  1 nf_nat_tftp
nf_nat_irc               816  0 
nf_conntrack_irc        2576  1 nf_nat_irc
nf_nat_ftp              1328  0 
nf_conntrack_ftp        4624  1 nf_nat_ftp
ipt_MASQUERADE          1040  0 
iptable_nat             2288  1 
nf_nat                 10032  5 nf_nat_tftp,nf_nat_irc,nf_nat_ftp,ipt_MASQUERADE,iptable_nat
xt_NOTRACK               544  0 
iptable_raw              640  1 
xt_state                 784  3 
nf_conntrack_ipv4       7440  6 iptable_nat,nf_nat
nf_defrag_ipv4           624  1 nf_conntrack_ipv4
nf_conntrack           36960 12 nf_nat_tftp,nf_conntrack_tftp,nf_nat_irc,nf_conntrack_irc,nf_nat_ftp,nf_conntrack_ftp,ipt_MASQUERADE,iptable_nat,nf_nat,xt_NOTRACK,xt_state,nf_conntrack_ipv4
pppoe                   7408  0 
pppox                   1168  1 pppoe
ipt_REJECT              1712  2 
xt_TCPMSS               1872  0 
ipt_LOG                 4176  0 
xt_multiport            1824  0 
xt_mac                   576  0 
xt_limit                1056  1 
iptable_mangle          1008  0 
iptable_filter           784  1 
ip_tables               8080  4 iptable_nat,iptable_raw,iptable_mangle,iptable_filter
xt_tcpudp               1776  3 
x_tables                8688 12 ipt_MASQUERADE,iptable_nat,xt_NOTRACK,xt_state,ipt_REJECT,xt_TCPMSS,ipt_LOG,xt_multiport,xt_mac,xt_limit,ip_tables,xt_tcpudp
ppp_async               6304  0 
ppp_generic            18496  3 pppoe,pppox,ppp_async
slhc                    4224  1 ppp_generic
ath9k                 248688  0 
ath                     6576  1 ath9k
mac80211              137808  1 ath9k
cfg80211              101104  3 ath9k,ath,mac80211
crc_ccitt                992  1 ppp_async
arc4                     816  0 
aes_generic            28704  0 
deflate                 1376  0 
ecb                     1312  0 
cbc                     2000  0 
button_hotplug          2592  0 
gpio_buttons            1856  0 
input_polldev           1376  1 gpio_buttons
input_core             17424  3 button_hotplug,gpio_buttons,input_polldev
leds_gpio               1360  0 



root@OpenWrt:/# dmesg
Linux version 2.6.30.8 (marco@marco-laptop) (gcc version 4.1.2) #3 Tue Oct 27 14:27:20 CET 2009
prom: fw_arg0=00000002, fw_arg1=a3f5ffb0, fw_arg2=a3f603c0, fw_arg3=00000008
MyLoader: sysp=aaaa5554, boardp=aaaa5554, parts=aaaa5554
console [early0] enabled
CPU revision is: 00019374 (MIPS 24Kc)
Atheros AR7161 rev 2, CPU:680.000 MHz, AHB:170.000 MHz, DDR:340.000 MHz
Determined physical RAM map:
 memory: 04000000 @ 00000000 (usable)
Initrd not found or empty - disabling initrd
Zone PFN ranges:
  Normal   0x00000000 -&gt; 0x00004000
Movable zone start PFN for each node
early_node_map[1] active PFN ranges
    0: 0x00000000 -&gt; 0x00004000
On node 0 totalpages: 16384
free_area_init_node: node 0, pgdat 802a76a0, node_mem_map 81000000
  Normal zone: 128 pages used for memmap
  Normal zone: 0 pages reserved
  Normal zone: 16256 pages, LIFO batch:3
Built 1 zonelists in Zone order, mobility grouping on.  Total pages: 16256
Kernel command line: rootfstype=squashfs,yaffs,jffs2 noinitrd console=ttyS0,115200 board=WNDR3700
Primary instruction cache 64kB, VIPT, 4-way, linesize 32 bytes.
Primary data cache 32kB, 4-way, VIPT, cache aliases, linesize 32 bytes
Writing ErrCtl register=00000000
Readback ErrCtl register=00000000
NR_IRQS:56
PID hash table entries: 256 (order: 8, 1024 bytes)
Dentry cache hash table entries: 8192 (order: 3, 32768 bytes)
Inode-cache hash table entries: 4096 (order: 2, 16384 bytes)
Memory: 56476k/65536k available (1914k kernel code, 8984k reserved, 428k data, 5600k init, 0k highmem)
SLUB: Genslabs=7, HWalign=32, Order=0-3, MinObjects=0, CPUs=1, Nodes=1
Calibrating delay loop... 452.19 BogoMIPS (lpj=2260992)
Mount-cache hash table entries: 512
net_namespace: 528 bytes
NET: Registered protocol family 16
MIPS: machine is Generic AR71xx board
bio: create slab &lt;bio-0&gt; at 0
NET: Registered protocol family 2
IP route cache hash table entries: 1024 (order: 0, 4096 bytes)
Switched to high resolution mode on CPU 0
TCP established hash table entries: 2048 (order: 2, 16384 bytes)
TCP bind hash table entries: 2048 (order: 1, 8192 bytes)
TCP: Hash tables configured (established 2048 bind 2048)
TCP reno registered
NET: Registered protocol family 1
squashfs: version 4.0 (2009/01/31) Phillip Lougher
Registering mini_fo version $Id$
JFFS2 version 2.2. (NAND) (SUMMARY)  © 2001-2006 Red Hat, Inc.
yaffs Oct 26 2009 17:00:36 Installing. 
msgmni has been set to 110
alg: No test for lzma (lzma-generic)
alg: No test for stdrng (krng)
io scheduler noop registered
io scheduler deadline registered (default)
Serial: 8250/16550 driver, 1 ports, IRQ sharing disabled
serial8250.0: ttyS0 at MMIO 0x18020000 (irq = 11) is a 16550A
console handover: boot [early0] -&gt; real [ttyS0]
Atheros AR71xx SPI Controller driver version 0.2.4
Atheros AR71xx hardware watchdog driver version 0.1.0
ar71xx-wdt: timeout=15 secs (max=25)
TCP westwood registered
NET: Registered protocol family 17
802.1Q VLAN Support v1.8 Ben Greear &lt;greearb@candelatech.com&gt;
All bugs added by David S. Miller &lt;davem@redhat.com&gt;
Freeing unused kernel memory: 5600k freed
gpio-buttons driver version 0.1.1
Button Hotplug driver version 0.3.1
cfg80211: Using static regulatory domain info
cfg80211: Regulatory domain: US
    (start_freq - end_freq @ bandwidth), (max_antenna_gain, max_eirp)
    (2402000 KHz - 2472000 KHz @ 40000 KHz), (600 mBi, 2700 mBm)
    (5170000 KHz - 5190000 KHz @ 40000 KHz), (600 mBi, 2300 mBm)
    (5190000 KHz - 5210000 KHz @ 40000 KHz), (600 mBi, 2300 mBm)
    (5210000 KHz - 5230000 KHz @ 40000 KHz), (600 mBi, 2300 mBm)
    (5230000 KHz - 5330000 KHz @ 40000 KHz), (600 mBi, 2300 mBm)
    (5735000 KHz - 5835000 KHz @ 40000 KHz), (600 mBi, 3000 mBm)
cfg80211: Calling CRDA for country: US
PPP generic driver version 2.4.2
ip_tables: (C) 2000-2006 Netfilter Core Team
NET: Registered protocol family 24
nf_conntrack version 0.5.0 (1024 buckets, 4096 max)
ath_hal: module license &#039;Proprietary&#039; taints kernel.
Disabling lock debugging due to kernel taint
ath_hal: 2009-05-08 (AR5210, AR5211, AR5212, AR5416, RF5111, RF5112, RF2413, RF5413, RF2133, RF2425, REGOPS_FUNC, XR)
ath_pci: trunk
wlan: trunk
wlan: mac acl policy registered
ath_rate_minstrel: Minstrel automatic rate control algorithm 1.2 (trunk)
ath_rate_minstrel: look around rate set to 10%
ath_rate_minstrel: EWMA rolloff level set to 75%
ath_rate_minstrel: max segment size in the mrr set to 6000 us
ar71xx-wdt: enabling watchdog timer</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p96462">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">ratbug</div>
					<div class="post-datetime">
						27 Oct 2009, 16:48					</div>
				</div>
				<div class="post-content content">
					<p>Congrats, whiskas</p><p>he we go</p><p>How to build:<br />=============</p><p>make wndr3700u_config<br />make</p><p>Steps to upgrade u-boot:<br />========================</p><p>In the meantime, u-boot takes 5 erase blocks (5*0x10000)</p><p>ar7100&gt; loady 0x80800000<br />ar7100&gt; crc32 0x80800000 ${filesize}<br />ar7100&gt; erase 0xbf000000 +50000<br />ar7100&gt; cp.b 0x80800000 0xbf000000 0x50000</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p96515">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">whiskas</div>
					<div class="post-datetime">
						28 Oct 2009, 13:12					</div>
				</div>
				<div class="post-content content">
					<p>Regarding the wireless cards: problem #1 seems to me, that the pci-bus does not seem to be working.</p><div class="codebox"><pre><code>root@OpenWrt:/# cat proc/bus/pci/devices</code></pre></div><p>gives out nothing. In my previous threads you can see, that the ath_pci-module is loaded.</p><p>While the stock-firmware gives: </p><div class="codebox"><pre><code>root@WNDR3700:/# cat proc/bus/pci/devices 
0000    168c0029    30    10000000    00000000    00000000    00000000    00000000    00000000    00000000    00010000    00000000    00000000    00000000    00000000    00000000    00000000    ath_pci
0008    168c0029    31    10010000    00000000    00000000    00000000    00000000    00000000    00000000    00010000    00000000    00000000    00000000    00000000    00000000    00000000    ath_pci



root@WNDR3700:/# cat proc/pci 
PCI devices found:
  Bus  0, device   0, function  0:
    Class 0280: PCI device 168c:0029 (rev 1).
      IRQ 48.
      Master Capable.  Latency=168.  
      Non-prefetchable 32 bit memory at 0x10000000 [0x1000ffff].
  Bus  0, device   1, function  0:
    Class 0280: PCI device 168c:0029 (rev 1).
      IRQ 49.
      Master Capable.  Latency=168.  
      Non-prefetchable 32 bit memory at 0x10010000 [0x1001ffff].



root@WNDR3700:/# lsmod
Module                  Size  Used by    Tainted: P  
wlan_scan_ap            9152  1 
ath_pktlog             14336  0 
wlan_me                 9152  0 
wlan_acl                5152  0 
wlan_wep                5536  0 
wlan_tkip              12608  0 
wlan_ccmp               7968  0 
wlan_xauth              1024  0 
ath_pci                59488  0 
ath_dev               131728  2 ath_pktlog,ath_pci
ath_rate_atheros       46928  2 ath_pktlog,ath_dev
wlan                  253440  12 wlan_scan_ap,ath_pktlog,wlan_me,wlan_acl,wlan_wep,wlan_tkip,wlan_ccv
wlan_ext                3328  1 wlan                                                                 
ath_hal               277312  6 ath_pktlog,ath_pci,ath_dev,wlan                                      
ag7100_mod             23600  0                                                                      
rtl8366sr_mod          84896  1 ag7100_mod                                                           
dni_qos                 5984  1 ag7100_mod                                                           
watchdog                1488  0                                                                      
dni_dmapool            15552  2 ath_dev,ath_hal                                                      
ar7100gpiointr          4096  1                                                                      
ar7100gpio              2656  0                                                                      
fuse                   46640  0                                                                      
ext2                   54960  0                                                                      
ext3                  124112  0                                                                      
vfat                   11296  0                                                                      
fat                    52208  1 vfat                                                                 
nls_iso8859_1           3296  0                                                                      
nls_cp437               4832  0                                                                      
jbd                    54240  1 ext3                                                                 
ip_nat_dnisip           6560  0                                                                      
ip_conntrack_dnisip     6064  1 ip_nat_dnisip                                                        
ipt_TRIGGER             3296  1                                                                      
ipt_spiadvDoS          13392  1                                                                      
ipt_NETGEAR_REJECT     12640  0                                                                      
ipt_urlBlock            5424  0                                                                      
ipt_dnshijack           1408  1                                                                      
ipt_spiDoS              3200  2                                                                      
wndr3700_usbled         2672  0                                                                      
ip_nat_pptp             4816  0                                                                      
ip_conntrack_pptp       7600  1 ip_nat_pptp                                                          
ip_nat_dnih323          6240  0                                                                      
ip_conntrack_dnih323    38720  1 ip_nat_dnih323                                                      
ip_nat_STARCRAFT        1504  0                                                                      
ipt_CONENAT             1824  2                                                                      
ip_nat_ftp              2496  0                                                                      
ip_conntrack_ftp        5712  1 ip_nat_ftp</code></pre></div><p>Another problem is the ethernet-switch. Chip is Realtek RTL8366SR Gigabit switch (<a href="http://www.smallnetbuilder.com/content/view/30913/96/">src</a>)</p><br /><p>Any ideas on either?</p>											<p class="post-edited">(Last edited by <strong>whiskas</strong> on 28 Oct 2009, 15:00)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p96533">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">vexingviking</div>
					<div class="post-datetime">
						28 Oct 2009, 19:09					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>whiskas wrote:</cite><blockquote><p>Another problem is the ethernet-switch. Chip is Realtek RTL8366SR Gigabit switch (<a href="http://www.smallnetbuilder.com/content/view/30913/96/">src</a>)</p></blockquote></div><p>There&#039;s a binary module (rtl8366sr_mod.ko) included in Netgear&#039;s WNDR3700 firmware <a href="ftp://downloads.netgear.com/files/GPL/WNDR3700-V1.0.4.35_src.tar.bz2.zip">archive</a>. Can it be injected into the custom firmware image? </p><p>I just ordered one of these and I&#039;m pretty anxious for it to get here. Excited to finally have a platform for OpenWRT. <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p96550">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">ratbug</div>
					<div class="post-datetime">
						28 Oct 2009, 23:50					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>whiskas wrote:</cite><blockquote><p>Another problem is the ethernet-switch. Chip is Realtek RTL8366SR Gigabit switch (<a href="http://www.smallnetbuilder.com/content/view/30913/96/">src</a>)<br />Any ideas on either?</p></blockquote></div><p>whiskas,</p><p>look here board/ar7100/wndr3700u/rtl8366s_phy.c</p><p>and here that might give you an idea how they build the driver</p><br /><br /><p><span style="color: blue"># Copyright (C) 2006 OpenWrt.org<br />#<br /># This is free software, licensed under the GNU General Public License v2.<br /># See /LICENSE for more information.<br />#<br /># $Id: Makefile,v 1.1.2.2 2006/11/14 08:57:31 ronger Exp $</span></p><p><span style="color: blue">include $(TOPDIR)/rules.mk<br />include $(INCLUDE_DIR)/kernel.mk</span></p><p><span style="color: blue">PKG_NAME:=rtl8366s<br />PKG_VERSION:=<br />PKG_RELEASE:=</span></p><p><span style="color: blue">PKG_SOURCE:=<br />PKG_SOURCE_URL:=<br />PKG_MD5SUM:=<br />PKG_CAT:=zcat</span></p><p><span style="color: blue">PKG_GIT_TREEISH=f6c9ef8a843d680cbc8864c595959107821d6d49<br />PKG_BUILD_DIR:=$(KERNEL_BUILD_DIR)/rtl8366s</span></p><p><span style="color: blue">include $(INCLUDE_DIR)/package.mk</span></p><p><span style="color: blue">ENET_AUTOLOAD:= rtl8366sr_mod.$(LINUX_KMOD_SUFFIX)</span></p><p><span style="color: blue">AR531X_KERNEL_CROSS:=mips-linux-</span></p><p><span style="color: blue">define KernelPackage/rtl8366s<br />&nbsp; SUBMENU:=Ethernet Drivers<br />&nbsp; DEPENDS:=@LINUX_2_6_WNDR3700U<br />&nbsp; TITLE:=Driver for Realtek ethernet<br />&nbsp; DESCRIPTION:=\<br />&nbsp; &nbsp; &nbsp; &nbsp; This package contains a driver for Realtek ethernet<br />&nbsp; URL:=http://www.atheros.com/<br />&nbsp; VERSION:=$(LINUX_VERSION)+$(PKG_VERSION)-$(BOARD)-$(PKG_RELEASE)<br />&nbsp; FILES:= $(PKG_BUILD_DIR)/rtl8366sr_mod.$(LINUX_KMOD_SUFFIX)<br />&nbsp; AUTOLOAD:=$(call AutoLoad,50,$(ENET_AUTOLOAD))<br />endef</span></p><p><span style="color: blue">ENET_MAKEOPTS=&nbsp; PATH=&quot;$(KERNEL_STAGING_DIR)/bin:$(TARGET_PATH)&quot; \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ARCH=&quot;$(LINUX_KARCH)&quot; \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CROSS_COMPILE=&quot;$(TARGET_CROSS)&quot; \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TOOLPREFIX=&quot;$(AR531X_KERNEL_CROSS)&quot; \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TOOLPATH=&quot;$(AR531X_KERNEL_CROSS)&quot;</span></p><p><span style="color: blue">define Build/Prepare<br />&nbsp; &nbsp; &nbsp; &nbsp; -mkdir -p $(PKG_BUILD_DIR)<br />&nbsp; &nbsp; &nbsp; &nbsp; $(CP) $(GIT_HOME)/rtl8366sr.git/* $(KERNEL_BUILD_DIR)/$(PKG_NAME)<br />endef</span></p><p><span style="color: blue">define Build/Compile<br />endef</span></p><p><span style="color: blue">define Build/InstallDev<br />endef</span></p><p><span style="color: blue">define Build/UninstallDev<br />endef</span></p><p><span style="color: blue">define KernelPackage/rtl8366s/install<br />&nbsp; &nbsp; &nbsp; &nbsp; mkdir -p $(1)/etc/init.d<br />&nbsp; &nbsp; &nbsp; &nbsp; install -m0755 ./files/net-lan $(1)/etc/init.d/<br />&nbsp; &nbsp; &nbsp; &nbsp; install -m0755 ./files/net-wan $(1)/etc/init.d/<br />endef</span></p><p><span style="color: blue">$(eval $(call KernelPackage,rtl8366s))</span></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p96567">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">whiskas</div>
					<div class="post-datetime">
						29 Oct 2009, 10:51					</div>
				</div>
				<div class="post-content content">
					<p>@ vexingviking:<br />as expected, loading a module, which is compiled for a different kernel, does not work</p><div class="codebox"><pre><code>root@OpenWrt:/# insmod rtl8366sr_mod                                            
rtl8366sr_mod: version magic &#039;2.6.15 MIPS32_R2 32BIT gcc-3.4&#039; should be &#039;2.6.30&#039;
insmod: can&#039;t insert &#039;rtl8366sr_mod&#039;: invalid module format</code></pre></div><p>@ratbug:<br />Rewriting and including my own linux driver is quiet new to me.. Any helps are appreciated.<br />Did you find the Makefile somewhere, or did you write it yourself?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p96586">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">Borromini</div>
					<div class="post-datetime">
						29 Oct 2009, 15:52					</div>
				</div>
				<div class="post-content content">
					<p>Guys this is terrific <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" />. I can&#039;t be much of a help at this stage unfortunately :-/.</p><p>I <a href="http://www.myopenrouter.com/forum/thread/14129/Why-not-WNDR3700L-instead/#2712">pointed out the possible problem</a> with kernel version magic out in the Netgear forums (MyOpenrouter.com), but got no conclusive answer (the 2.4 Broadcom drivers e.g. were stripped of kernel version magic I think so they could run against whatever 2.4 kernel you would throw at it). There are some drivers that are marked as GPL/BSD in the licensing overview but are made available as binary only in the source tarball, and the licensing overview has no link for their source code. I tried googling for the package/module names but nothing turned up (I usually do a thorough google but that doesn&#039;t mean I couldn&#039;t have missed a spot).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p96591">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">vexingviking</div>
					<div class="post-datetime">
						29 Oct 2009, 16:08					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>whiskas wrote:</cite><blockquote><p>@ vexingviking:<br />as expected, loading a module, which is compiled for a different kernel, does not work</p><div class="codebox"><pre><code>root@OpenWrt:/# insmod rtl8366sr_mod                                            
rtl8366sr_mod: version magic &#039;2.6.15 MIPS32_R2 32BIT gcc-3.4&#039; should be &#039;2.6.30&#039;
insmod: can&#039;t insert &#039;rtl8366sr_mod&#039;: invalid module format</code></pre></div></blockquote></div><p>Assuming the gcc version is the same, maybe &quot;modprobe --force-vermagic rtl8366sr_mod&quot; would work? I&#039;m just not sure what kind of side effects, if any, that might produce...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p96595">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">ratbug</div>
					<div class="post-datetime">
						29 Oct 2009, 17:06					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>whiskas wrote:</cite><blockquote><p>@ vexingviking:<br />as expected, loading a module, which is compiled for a different kernel, does not work</p><div class="codebox"><pre><code>root@OpenWrt:/# insmod rtl8366sr_mod                                            
rtl8366sr_mod: version magic &#039;2.6.15 MIPS32_R2 32BIT gcc-3.4&#039; should be &#039;2.6.30&#039;
insmod: can&#039;t insert &#039;rtl8366sr_mod&#039;: invalid module format</code></pre></div><p>@ratbug:<br />Rewriting and including my own linux driver is quiet new to me.. Any helps are appreciated.<br />Did you find the Makefile somewhere, or did you write it yourself?</p></blockquote></div><p>Modules must be from the same kernel.</p><p>@whiskas,</p><p>the Makefile is in the netgear SDK but unfortunately Netgear did not include the source code for the RTL8366SR, You might look in Belkin F5D8235 <a href="http://www.belkin.com/support/opensource/files/F5D8235v2-2.01.06-GPL.tar.gz">here</a> under linux-x.xx/drivers/net/phys/</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p96596">
				<div class="post-metadata">
					<div class="post-num">Post #21</div>
					<div class="post-author">ratbug</div>
					<div class="post-datetime">
						29 Oct 2009, 17:14					</div>
				</div>
				<div class="post-content content">
					<p>@whiskas, write Makefile for openwrt is fairly easy, you can take a look at how it&nbsp; is done&nbsp; ( the above one is for kernel modules, the one for apps is slightly different)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p96600">
				<div class="post-metadata">
					<div class="post-num">Post #22</div>
					<div class="post-author">whiskas</div>
					<div class="post-datetime">
						29 Oct 2009, 18:09					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m giving up on loading the binary modules, since both changing the module kernel version with a hex-editor and removing the version-checking in kernel_menuconfig do not work. Also &#039;modprobe&#039; is not included in the busybox-system; had problems finding a package including it.</p><p>@ratbug:<br />I&#039;ll take a look into the belkin sources.</p><p>Apart from this, i&#039;d rather find out, what&#039;s about with the PCI. Since there are other routers around with the realtek-switch, this problem is likely to solve by itself. Any ideas where to start, if there are no pci-devices listed under /proc?</p><p>@all:<br />Does nobody else have this router? There is absolutely NO BRICKING RISK since we&#039;re only running ramdisk-images (if i not specifically interrupt the bootup, the router loads the netgear firmware). Also if you do not solder or rampage inside your router, you STILL HAVE WARRANTY. The serial-cable is easily built with a connector for the serial header, the screws are right under the rubber feet. Even the environment-args in uboot are not saved until one specifically calls &#039;saveenv&#039;.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p96606">
				<div class="post-metadata">
					<div class="post-num">Post #23</div>
					<div class="post-author">ratbug</div>
					<div class="post-datetime">
						29 Oct 2009, 20:35					</div>
				</div>
				<div class="post-content content">
					<p>this is an expensive router, so not everyone is inclined to serve as guinea pigs for this experiment. I agree with you that this router is very safe to play besides it is running on top of openwrt but it is an expensive toy</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p96607">
				<div class="post-metadata">
					<div class="post-num">Post #24</div>
					<div class="post-author">entee</div>
					<div class="post-datetime">
						29 Oct 2009, 20:36					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>whiskas wrote:</cite><blockquote><p>@all:<br />Does nobody else have this router? There is absolutely NO BRICKING RISK since we&#039;re only running ramdisk-images (if i not specifically interrupt the bootup, the router loads the netgear firmware). Also if you do not solder or rampage inside your router, you STILL HAVE WARRANTY. The serial-cable is easily built with a connector for the serial header, the screws are right under the rubber feet. Even the environment-args in uboot are not saved until one specifically calls &#039;saveenv&#039;.</p></blockquote></div><p>So what exactly is involved and how would we be able to help you?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p96634">
				<div class="post-metadata">
					<div class="post-num">Post #25</div>
					<div class="post-author">whiskas</div>
					<div class="post-datetime">
						30 Oct 2009, 02:03					</div>
				</div>
				<div class="post-content content">
					<p>@entee<br />various possibilities:<br />a) install serial cable, play around with openWrt on this router and post your findings if you get the hardware running<br />b) if you have experience in dealing with linux and unsupported hardware, advice is always welcome<br />c) write to the developers or perhaps better: start another thread, where you state that you are anxious for openWrt-support for this router<br />d) donate a wndr3700 (or money) to the openWrt-team.&nbsp; &nbsp;damn, this sounds like i&#039;m paid for advertisement...</p><p>@ratbug<br />the Belkin GPL-firmware you pointed out seems really ressourceful. There are the rtl8366 sourcefiles for the bootloader, which have by coexistence the same filenames as the ones for the kernel-modules <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>											<p class="post-edited">(Last edited by <strong>whiskas</strong> on 30 Oct 2009, 02:04)</p>
									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 1 of 20</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=22311&amp;p=2.html">2</a></li><li><a href="viewtopic.php%3Fid=22311&amp;p=3.html">3</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=22311&amp;p=20.html">20</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>