<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> TL-WR841N Atheros AR9431 WAN port swap</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 30 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p369313">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">dtodorovtu</div>
					<div class="post-datetime">
						7 Dec 2017, 11:02					</div>
				</div>
				<div class="post-content content">
					<p>Hi all,</p><p>recently I received a WR841N (v8.4), which has no link activity when WAN port is connected.<br />I flashed it with OpenWrt image, but problem persists, which makes me believe it&#039;s more of a HW problem, as all other Eth ports (LANs) and Wireless adapter are functioning as expected. </p><p>( As a side note: I did only basic electrical measurements on the input RJ jack and magnetics and they seemed to be ok, so I&#039;d narrow down the problem towards the SoC itself).</p><p>So just before giving up on this router, I found the SoC&#039;s (Atheros AR9431) datasheet, which states that WAN input twards the GMAC0 eth controller can be swapped between P0 and P4 of the underlying eth switch. This could be achieved by writing to <strong>SW_PHY_ADDR_SWAP</strong> and <strong>SW_PHY_SWAP</strong> of the <strong>ETH_CFG</strong> register</p><p>imgur.com/ BMJwz39</p><p>My question is if my assumption that swapping this port would mean that this router can still be used as a router and if yes, then how can I (if even possible) set this configuration? <br />I&#039;m not really deep into linux environments, but would it be possible to have calls with *ioctl*-type procedures to access such device registers? </p><p>Cheers,<br />Dimitar</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p369343">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">mk24</div>
					<div class="post-datetime">
						8 Dec 2017, 00:09					</div>
				</div>
				<div class="post-content content">
					<p>I think a change like that would require recompiling the chip init code in the kernel.&nbsp; It is also unlikely to be successful as there is probably hardware damage to the phy on the chip.&nbsp; This is quite common when lightning strikes near the cable or DSL line.&nbsp; </p><p>You can use the regular configuration system to set up the switch to run VLANs to eth1 and make one of the 4 regular switched ports usable for WAN.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p371298">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">dtodorovtu</div>
					<div class="post-datetime">
						27 Jan 2018, 10:58					</div>
				</div>
				<div class="post-content content">
					<p>Indeed, mk24, from what I saw on debug screen, port configuration happens during chip init phase that is within the ethernet driver. <br />Unfortunately, my experiences with ux based compiling tools and OpenWrt platform are quite limited so any hint on how to start-off customizing the driver code and rebuildin the full image would be really appreciated <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>P.S. As of the likelihood of success of all this - I don&#039;t really care, let&#039;s just have fun <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>