<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Support for (Easylink) elink el-ml150 (AR9331)</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 7 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p221688">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">sina</div>
					<div class="post-datetime">
						5 Jan 2014, 03:03					</div>
				</div>
				<div class="post-content content">
					<p>I bought elink el-ml150<br />in ali-express<br />(more details on the original Chinese retailer is available in<br /><a href="http://item.taobao.com/item.htm?spm=a1z10.1.w5003-5055696907.5.8Eui71&amp;id=16635049261&amp;scene=taobao_shop)">http://item.taobao.com/item.htm?spm=a1z … obao_shop)</a> </p><p>I am looking for that device source and configuration to customize its firmware.</p><p>It seems that they (the module producers) have not released build configuration and the OpenWrt source codes that are used in that module and maybe the build patches for that specific hardware configuration.</p><p>Can anyone in OpenWrt community ask or want them to hand out the sources and the firmware, which is required to exploit the daughter board hardware configuration?</p><p>To my understanding it seems that the OpenWrt source licensing requires manufacturers to release and make available to public all the GPL source codes that are used in their OpenWrt implementation?</p><p>Thanks</p>											<p class="post-edited">(Last edited by <strong>sina</strong> on 5 Jan 2014, 03:07)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p224776">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">poor man</div>
					<div class="post-datetime">
						7 Feb 2014, 18:36					</div>
				</div>
				<div class="post-content content">
					<p>Hi,sina:</p><p>I am huangfc, EL-m150 has been designed by me.</p><p>about the sources code,you can use this patch for openwrt. i do not know how to submit to original.</p><br /><p>Index: target/linux/ar71xx/image/Makefile<br />===================================================================<br />--- target/linux/ar71xx/image/Makefile&nbsp; &nbsp; (版本 39036)<br />+++ target/linux/ar71xx/image/Makefile&nbsp; &nbsp; (工作副本)<br />@@ -981,6 +981,8 @@<br /> $(eval $(call SingleProfile,TPLINK,64kraw,TLWR941NV4,tl-wr941nd-v4,TL-WR741ND,ttyS0,115200,0x09410004,1,4M))<br /> $(eval $(call SingleProfile,TPLINK,64kraw,TLWR1043V1,tl-wr1043nd-v1,TL-WR1043ND,ttyS0,115200,0x10430001,1,8M))</p><p>+$(eval $(call SingleProfile,TPLINK-LZMA,64kraw,ELM150,el-m150,EL-M150,ttyATH0,115200,0x01500101,1,8Mlzma))<br />+$(eval $(call SingleProfile,TPLINK-LZMA,64kraw,MINI,M-mini,M-mini,ttyATH0,115200,0x01530001,1,8Mlzma))<br /> $(eval $(call SingleProfile,TPLINK-LZMA,64kraw,ARCHERC7,archer-c7-v1,ARCHER-C7,ttyS0,115200,0x75000001,1,8Mlzma))<br /> $(eval $(call SingleProfile,TPLINK-LZMA,64kraw,TLMR10U,tl-mr10u-v1,TL-MR10U,ttyATH0,115200,0x00100101,1,4Mlzma))<br /> $(eval $(call SingleProfile,TPLINK-LZMA,64kraw,TLMR11UV1,tl-mr11u-v1,TL-MR11U,ttyATH0,115200,0x00110101,1,4Mlzma))<br />Index: target/linux/ar71xx/base-files/lib/ar71xx.sh<br />===================================================================<br />--- target/linux/ar71xx/base-files/lib/ar71xx.sh&nbsp; &nbsp; (版本 39036)<br />+++ target/linux/ar71xx/base-files/lib/ar71xx.sh&nbsp; &nbsp; (工作副本)<br />@@ -91,6 +91,12 @@<br /> &nbsp; &nbsp; hwver=&quot;v${hwver#0}&quot;</p><p> &nbsp; &nbsp; case &quot;$hwid&quot; in<br />+&nbsp; &nbsp; &quot;015000&quot;*)<br />+&nbsp; &nbsp; &nbsp; &nbsp; model=&quot;ELink EL-M150&quot;<br />+&nbsp; &nbsp; &nbsp; &nbsp; ;;<br />+&nbsp; &nbsp; &quot;015300&quot;*)<br />+&nbsp; &nbsp; &nbsp; &nbsp; model=&quot;ELink M-mini&quot;<br />+&nbsp; &nbsp; &nbsp; &nbsp; ;;<br /> &nbsp; &nbsp; &quot;070300&quot;*)<br /> &nbsp; &nbsp; &nbsp; &nbsp; model=&quot;TP-Link TL-WR703N&quot;<br /> &nbsp; &nbsp; &nbsp; &nbsp; ;;<br />@@ -201,6 +207,12 @@<br /> &nbsp; &nbsp; machine=$(awk &#039;BEGIN{FS=&quot;[ \t]+:[ \t]&quot;} /machine/ {print $2}&#039; /proc/cpuinfo)</p><p> &nbsp; &nbsp; case &quot;$machine&quot; in<br />+&nbsp; &nbsp; *EL-M150)<br />+&nbsp; &nbsp; &nbsp; &nbsp; name=&quot;EL-M150&quot;<br />+&nbsp; &nbsp; &nbsp; &nbsp; ;;<br />+&nbsp; &nbsp; *M-mini)<br />+&nbsp; &nbsp; &nbsp; &nbsp; name=&quot;M-mini&quot;<br />+&nbsp; &nbsp; &nbsp; &nbsp; ;;<br /> &nbsp; &nbsp; *&quot;AirRouter&quot;)<br /> &nbsp; &nbsp; &nbsp; &nbsp; name=&quot;airrouter&quot;<br /> &nbsp; &nbsp; &nbsp; &nbsp; ;;<br />Index: target/linux/ar71xx/base-files/lib/upgrade/platform.sh<br />===================================================================<br />--- target/linux/ar71xx/base-files/lib/upgrade/platform.sh&nbsp; &nbsp; (版本 39036)<br />+++ target/linux/ar71xx/base-files/lib/upgrade/platform.sh&nbsp; &nbsp; (工作副本)<br />@@ -200,6 +200,8 @@<br /> &nbsp; &nbsp; &nbsp; &nbsp; return 1<br /> &nbsp; &nbsp; &nbsp; &nbsp; ;;</p><p>+&nbsp; &nbsp; EL-M150 | \<br />+&nbsp; &nbsp; M-mini | \<br /> &nbsp; &nbsp; archer-c7 | \<br /> &nbsp; &nbsp; tl-mr10u | \<br /> &nbsp; &nbsp; tl-mr11u | \<br />Index: target/linux/ar71xx/base-files/etc/uci-defaults/03_network-switchX-migration<br />===================================================================<br />--- target/linux/ar71xx/base-files/etc/uci-defaults/03_network-switchX-migration&nbsp; &nbsp; (版本 39036)<br />+++ target/linux/ar71xx/base-files/etc/uci-defaults/03_network-switchX-migration&nbsp; &nbsp; (工作副本)<br />@@ -80,6 +80,7 @@<br /> &nbsp; &nbsp; migrate_switch_name &quot;eth0&quot; &quot;switch0&quot;<br /> &nbsp; &nbsp; ;;</p><p>+EL-M150|\<br /> rb-450)<br /> &nbsp; &nbsp; migrate_switch_name &quot;eth1&quot; &quot;switch0&quot;<br /> &nbsp; &nbsp; ;;<br />Index: target/linux/ar71xx/base-files/etc/uci-defaults/02_network<br />===================================================================<br />--- target/linux/ar71xx/base-files/etc/uci-defaults/02_network&nbsp; &nbsp; (版本 39036)<br />+++ target/linux/ar71xx/base-files/etc/uci-defaults/02_network&nbsp; &nbsp; (工作副本)<br />@@ -22,6 +22,16 @@<br /> &nbsp; &nbsp; ucidef_set_interface_lan &quot;eth0 eth1&quot;<br /> &nbsp; &nbsp; ;;</p><p>+M-mini)<br />+&nbsp; &nbsp; ucidef_set_interfaces_lan_wan &quot;eth1&quot; &quot;eth0&quot;<br />+&nbsp; &nbsp; ;;<br />+<br />+EL-M150)<br />+&nbsp; &nbsp; ucidef_set_interfaces_lan_wan &quot;eth1&quot; &quot;eth0&quot;<br />+&nbsp; &nbsp; ucidef_add_switch &quot;switch0&quot; &quot;1&quot; &quot;1&quot;<br />+&nbsp; &nbsp; ucidef_add_switch_vlan &quot;switch0&quot; &quot;1&quot; &quot;0 1 3&quot;<br />+&nbsp; &nbsp; ;;<br />+<br /> ap132 |\<br /> wlr8100)<br /> &nbsp; &nbsp; ucidef_set_interfaces_lan_wan &quot;eth0.1&quot; &quot;eth0.2&quot;<br />Index: target/linux/ar71xx/base-files/etc/diag.sh<br />===================================================================<br />--- target/linux/ar71xx/base-files/etc/diag.sh&nbsp; &nbsp; (版本 39036)<br />+++ target/linux/ar71xx/base-files/etc/diag.sh&nbsp; &nbsp; (工作副本)<br />@@ -6,6 +6,10 @@</p><p> get_status_led() {<br /> &nbsp; &nbsp; case $(ar71xx_board_name) in<br />+&nbsp; &nbsp; M-mini | \<br />+&nbsp; &nbsp; EL-M150)<br />+&nbsp; &nbsp; &nbsp; &nbsp; status_led=&quot;elink:green:system&quot;<br />+&nbsp; &nbsp; &nbsp; &nbsp; ;;<br /> &nbsp; &nbsp; alfa-nx)<br /> &nbsp; &nbsp; &nbsp; &nbsp; status_led=&quot;alfa:green:led_8&quot;<br /> &nbsp; &nbsp; &nbsp; &nbsp; ;;<br />Index: tools/firmware-utils/src/mktplinkfw.c<br />===================================================================<br />--- tools/firmware-utils/src/mktplinkfw.c&nbsp; &nbsp; (版本 39036)<br />+++ tools/firmware-utils/src/mktplinkfw.c&nbsp; &nbsp; (工作副本)<br />@@ -190,6 +190,12 @@<br /> &nbsp; &nbsp; &nbsp; &nbsp; .kernel_ep&nbsp; &nbsp; = 0xc0000000,<br /> &nbsp; &nbsp; &nbsp; &nbsp; .rootfs_ofs&nbsp; &nbsp; = 0x2a0000,<br /> &nbsp; &nbsp; }, {<br />+&nbsp; &nbsp; &nbsp; &nbsp; .id&nbsp; &nbsp; &nbsp; &nbsp; = &quot;16Mlzma&quot;,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .fw_max_len&nbsp; &nbsp; = 0xfc0000,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .kernel_la&nbsp; &nbsp; = 0x80060000,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .kernel_ep&nbsp; &nbsp; = 0x80060000,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .rootfs_ofs&nbsp; &nbsp; = 0x100000,<br />+&nbsp; &nbsp; }, {<br /> &nbsp; &nbsp; &nbsp; &nbsp; /* terminating entry */<br /> &nbsp; &nbsp; }<br /> };<br />Index: target/linux/ar71xx/config-3.10<br />===================================================================<br />--- target/linux/ar71xx/config-3.10&nbsp; &nbsp; (版本 39036)<br />+++ target/linux/ar71xx/config-3.10&nbsp; &nbsp; (工作副本)<br />@@ -46,6 +46,7 @@<br /> CONFIG_ATH79_MACH_DIR_825_C1=y<br /> CONFIG_ATH79_MACH_DRAGINO2=y<br /> CONFIG_ATH79_MACH_EAP7660D=y<br />+CONFIG_ATH79_MACH_EL_M150=y<br /> CONFIG_ATH79_MACH_EW_DORIN=y<br /> CONFIG_ATH79_MACH_HORNET_UB=y<br /> CONFIG_ATH79_MACH_JA76PF=y<br />@@ -55,6 +56,7 @@<br /> CONFIG_ATH79_MACH_MYNET_REXT=y<br /> CONFIG_ATH79_MACH_MZK_W04NU=y<br /> CONFIG_ATH79_MACH_MZK_W300NH=y<br />+CONFIG_ATH79_MACH_M_mini=y<br /> CONFIG_ATH79_MACH_NBG460N=y<br /> CONFIG_ATH79_MACH_OM2P=y<br /> CONFIG_ATH79_MACH_PB42=y<br />Index: target/linux/ar71xx/generic/profiles/el-link.mk<br />===================================================================<br />--- /dev/null<br />+++ target/linux/ar71xx/generic/profiles/el-link.mk<br />@@ -0,0 +1,29 @@<br />+#<br />+# Copyright (C) 2009 OpenWrt.org<br />+#<br />+# This is free software, licensed under the GNU General Public License v2.<br />+# See /LICENSE for more information.<br />+#<br />+<br />+define Profile/ELM150<br />+&nbsp; &nbsp; NAME:=ELINK EL-M150<br />+&nbsp; &nbsp; PACKAGES:=kmod-usb-core kmod-usb2<br />+endef<br />+<br />+<br />+define Profile/ELM150/Description<br />+&nbsp; &nbsp; Package set optimized for the ELINK EL-M150.<br />+endef<br />+$(eval $(call Profile,ELM150))<br />+<br />+<br />+define Profile/MINI<br />+&nbsp; &nbsp; NAME:=ELINK M-mini<br />+&nbsp; &nbsp; PACKAGES:=kmod-usb-core kmod-usb2<br />+endef<br />+<br />+<br />+define Profile/MINI/Description<br />+&nbsp; &nbsp; Package set optimized for the ELINK M-mini.<br />+endef<br />+$(eval $(call Profile,MINI))<br />Index: target/linux/ar71xx/files/arch/mips/ath79/mach-el-m150.c<br />===================================================================<br />--- /dev/null<br />+++ target/linux/ar71xx/files/arch/mips/ath79/mach-el-m150.c<br />@@ -0,0 +1,138 @@<br />+/*<br />+ *&nbsp; ELINK EL-M150 board support<br />+ *<br />+ *&nbsp; Copyright (C) 2012 HYS &lt;550663898@qq.com&gt;<br />+ *&nbsp; Copyright (C) 2012 huangfc &lt;huangfangcheng@163.com&gt;<br />+ *<br />+ *&nbsp; This program is free software; you can redistribute it and/or modify it<br />+ *&nbsp; under the terms of the GNU General Public License version 2 as published<br />+ *&nbsp; by the Free Software Foundation.<br />+ */<br />+<br />+#include &lt;linux/gpio.h&gt;<br />+<br />+#include &lt;asm/mach-ath79/ath79.h&gt;<br />+#include &lt;asm/mach-ath79/ar71xx_regs.h&gt;<br />+<br />+#include &quot;common.h&quot;<br />+#include &quot;dev-eth.h&quot;<br />+#include &quot;dev-gpio-buttons.h&quot;<br />+#include &quot;dev-leds-gpio.h&quot;<br />+#include &quot;dev-m25p80.h&quot;<br />+#include &quot;dev-wmac.h&quot;<br />+#include &quot;machtypes.h&quot;<br />+#include &quot;dev-usb.h&quot;<br />+<br />+#define EL_M150_GPIO_BTN6&nbsp; &nbsp; &nbsp; &nbsp; 6<br />+#define EL_M150_GPIO_BTN7&nbsp; &nbsp; &nbsp; &nbsp; 7<br />+#define EL_M150_GPIO_BTN_RESET&nbsp; &nbsp; &nbsp; &nbsp; 11<br />+<br />+#define EL_M150_GPIO_LED_SYSTEM&nbsp; &nbsp; &nbsp; &nbsp; 27<br />+#define EL_M150_GPIO_USB_POWER&nbsp; &nbsp; &nbsp; &nbsp; 8<br />+<br />+#define EL_M150_KEYS_POLL_INTERVAL&nbsp; &nbsp; 20&nbsp; &nbsp; /* msecs */<br />+#define EL_M150_KEYS_DEBOUNCE_INTERVAL (3 * EL_M150_KEYS_POLL_INTERVAL)<br />+<br />+static const char *EL_M150_part_probes[] = {<br />+&nbsp; &nbsp; &quot;tp-link&quot;,<br />+&nbsp; &nbsp; NULL,<br />+};<br />+<br />+static struct flash_platform_data EL_M150_flash_data = {<br />+&nbsp; &nbsp; .part_probes&nbsp; &nbsp; = EL_M150_part_probes,<br />+};<br />+<br />+static struct gpio_led EL_M150_leds_gpio[] __initdata = {<br />+&nbsp; &nbsp; {<br />+&nbsp; &nbsp; &nbsp; &nbsp; .name&nbsp; &nbsp; &nbsp; &nbsp; = &quot;elink:green:system&quot;,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .gpio&nbsp; &nbsp; &nbsp; &nbsp; = EL_M150_GPIO_LED_SYSTEM,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .active_low&nbsp; &nbsp; = 1,<br />+&nbsp; &nbsp; },<br />+};<br />+<br />+static struct gpio_keys_button EL_M150_gpio_keys[] __initdata = {<br />+&nbsp; &nbsp; {<br />+&nbsp; &nbsp; &nbsp; &nbsp; .desc&nbsp; &nbsp; &nbsp; &nbsp; = &quot;reset&quot;,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .type&nbsp; &nbsp; &nbsp; &nbsp; = EV_KEY,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .code&nbsp; &nbsp; &nbsp; &nbsp; = KEY_RESTART,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .debounce_interval = EL_M150_KEYS_DEBOUNCE_INTERVAL,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .gpio&nbsp; &nbsp; &nbsp; &nbsp; = EL_M150_GPIO_BTN_RESET,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .active_low&nbsp; &nbsp; = 0,<br />+&nbsp; &nbsp; },<br />+&nbsp; &nbsp; {<br />+&nbsp; &nbsp; &nbsp; &nbsp; .desc&nbsp; &nbsp; &nbsp; &nbsp; = &quot;BTN_6&quot;,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .type&nbsp; &nbsp; &nbsp; &nbsp; = EV_KEY,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .code&nbsp; &nbsp; &nbsp; &nbsp; = BTN_6,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .debounce_interval = EL_M150_KEYS_DEBOUNCE_INTERVAL,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .gpio&nbsp; &nbsp; &nbsp; &nbsp; = EL_M150_GPIO_BTN6,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .active_low&nbsp; &nbsp; = 1,<br />+&nbsp; &nbsp; },<br />+&nbsp; &nbsp; {<br />+&nbsp; &nbsp; &nbsp; &nbsp; .desc&nbsp; &nbsp; &nbsp; &nbsp; = &quot;BTN_7&quot;,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .type&nbsp; &nbsp; &nbsp; &nbsp; = EV_KEY,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .code&nbsp; &nbsp; &nbsp; &nbsp; = BTN_7,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .debounce_interval = EL_M150_KEYS_DEBOUNCE_INTERVAL,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .gpio&nbsp; &nbsp; &nbsp; &nbsp; = EL_M150_GPIO_BTN7,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .active_low&nbsp; &nbsp; = 1,<br />+&nbsp; &nbsp; },<br />+};<br />+<br />+static void ath79_gpio_set_value(unsigned gpio, int value)<br />+{<br />+&nbsp; &nbsp; void __iomem *base = ath79_gpio_base;<br />+<br />+&nbsp; &nbsp; if (value)<br />+&nbsp; &nbsp; &nbsp; &nbsp; __raw_writel(1 &lt;&lt; gpio, base + AR71XX_GPIO_REG_SET);<br />+&nbsp; &nbsp; else<br />+&nbsp; &nbsp; &nbsp; &nbsp; __raw_writel(1 &lt;&lt; gpio, base + AR71XX_GPIO_REG_CLEAR);<br />+}<br />+<br />+static void __init EL_M150_GPIO_setup(void)<br />+{<br />+&nbsp; &nbsp; ath79_gpio_set_value(0,1);<br />+&nbsp; &nbsp; ath79_gpio_set_value(1,1);<br />+&nbsp; &nbsp; ath79_gpio_set_value(14,1);<br />+&nbsp; &nbsp; ath79_gpio_set_value(16,1);<br />+&nbsp; &nbsp; ath79_gpio_set_value(18,1);<br />+&nbsp; &nbsp; ath79_gpio_set_value(19,1);<br />+&nbsp; &nbsp; ath79_gpio_set_value(20,1);<br />+&nbsp; &nbsp; ath79_gpio_set_value(21,1);<br />+&nbsp; &nbsp; ath79_gpio_set_value(22,1);<br />+&nbsp; &nbsp; ath79_gpio_set_value(26,1);<br />+}<br />+<br />+static void __init EL_M150_setup(void)<br />+{<br />+&nbsp; &nbsp; u8 *mac = (u8 *) KSEG1ADDR(0x1f01fc00);<br />+&nbsp; &nbsp; u8 *ee = (u8 *) KSEG1ADDR(0x1fff1000);<br />+<br />+&nbsp; &nbsp; EL_M150_GPIO_setup();<br />+<br />+&nbsp; &nbsp; /* disable PHY_SWAP and PHY_ADDR_SWAP bits */<br />+&nbsp; &nbsp; ath79_setup_ar933x_phy4_switch(false, false);<br />+<br />+&nbsp; &nbsp; ath79_register_leds_gpio(-1, ARRAY_SIZE(EL_M150_leds_gpio),<br />+&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; EL_M150_leds_gpio);<br />+<br />+&nbsp; &nbsp; ath79_register_gpio_keys_polled(-1, EL_M150_KEYS_POLL_INTERVAL,<br />+&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ARRAY_SIZE(EL_M150_gpio_keys),<br />+&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; EL_M150_gpio_keys);<br />+<br />+&nbsp; &nbsp; gpio_request_one(EL_M150_GPIO_USB_POWER,<br />+&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; GPIOF_OUT_INIT_HIGH | GPIOF_EXPORT_DIR_FIXED,<br />+&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &quot;USB power&quot;);<br />+&nbsp; &nbsp; ath79_register_usb();<br />+<br />+&nbsp; &nbsp; ath79_register_m25p80(&amp;EL_M150_flash_data);<br />+&nbsp; &nbsp; ath79_init_mac(ath79_eth0_data.mac_addr, mac, 0);<br />+&nbsp; &nbsp; ath79_init_mac(ath79_eth1_data.mac_addr, mac, -1);<br />+<br />+&nbsp; &nbsp; ath79_register_mdio(0, 0x0);<br />+&nbsp; &nbsp; ath79_register_eth(0);<br />+&nbsp; &nbsp; ath79_register_eth(1);<br />+<br />+&nbsp; &nbsp; ath79_register_wmac(ee, mac);<br />+}<br />+<br />+MIPS_MACHINE(ATH79_MACH_EL_M150, &quot;EL-M150&quot;,<br />+&nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &quot;ELINK EL-M150&quot;, EL_M150_setup);<br />Index: target/linux/ar71xx/files/arch/mips/ath79/mach-el-mini.c<br />===================================================================<br />--- /dev/null<br />+++ target/linux/ar71xx/files/arch/mips/ath79/mach-el-mini.c<br />@@ -0,0 +1,86 @@<br />+/*<br />+ *&nbsp; ELINK M-mini board support<br />+ *<br />+ *&nbsp; Copyright (C) 2012 HYS &lt;550663898@qq.com&gt;<br />+ *&nbsp; Copyright (C) 2012 huangfc &lt;huangfangcheng@163.com&gt;<br />+ *<br />+ *&nbsp; This program is free software; you can redistribute it and/or modify it<br />+ *&nbsp; under the terms of the GNU General Public License version 2 as published<br />+ *&nbsp; by the Free Software Foundation.<br />+ */<br />+<br />+#include &lt;linux/gpio.h&gt;<br />+<br />+#include &lt;asm/mach-ath79/ath79.h&gt;<br />+<br />+#include &quot;dev-eth.h&quot;<br />+#include &quot;dev-gpio-buttons.h&quot;<br />+#include &quot;dev-leds-gpio.h&quot;<br />+#include &quot;dev-m25p80.h&quot;<br />+#include &quot;dev-usb.h&quot;<br />+#include &quot;dev-wmac.h&quot;<br />+#include &quot;machtypes.h&quot;<br />+<br />+#define MINI_GPIO_LED_SYSTEM&nbsp; &nbsp; 27<br />+#define MINI_GPIO_BTN_RESET&nbsp; &nbsp; 11<br />+<br />+#define MINI_GPIO_USB_POWER&nbsp; &nbsp; 8<br />+<br />+#define MINI_KEYS_POLL_INTERVAL&nbsp; &nbsp; 20&nbsp; &nbsp; /* msecs */<br />+#define MINI_KEYS_DEBOUNCE_INTERVAL&nbsp; &nbsp; (3 * MINI_KEYS_POLL_INTERVAL)<br />+<br />+static const char *mini_part_probes[] = {<br />+&nbsp; &nbsp; &quot;tp-link&quot;,<br />+&nbsp; &nbsp; NULL,<br />+};<br />+<br />+static struct flash_platform_data mini_flash_data = {<br />+&nbsp; &nbsp; .part_probes&nbsp; &nbsp; = mini_part_probes,<br />+};<br />+<br />+static struct gpio_led mini_leds_gpio[] __initdata = {<br />+&nbsp; &nbsp; {<br />+&nbsp; &nbsp; &nbsp; &nbsp; .name&nbsp; &nbsp; &nbsp; &nbsp; = &quot;elink:green:system&quot;,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .gpio&nbsp; &nbsp; &nbsp; &nbsp; = MINI_GPIO_LED_SYSTEM,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .active_low&nbsp; &nbsp; = 1,<br />+&nbsp; &nbsp; },<br />+};<br />+<br />+static struct gpio_keys_button mini_gpio_keys[] __initdata = {<br />+&nbsp; &nbsp; {<br />+&nbsp; &nbsp; &nbsp; &nbsp; .desc&nbsp; &nbsp; &nbsp; &nbsp; = &quot;reset&quot;,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .type&nbsp; &nbsp; &nbsp; &nbsp; = EV_KEY,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .code&nbsp; &nbsp; &nbsp; &nbsp; = KEY_RESTART,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .debounce_interval = MINI_KEYS_DEBOUNCE_INTERVAL,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .gpio&nbsp; &nbsp; &nbsp; &nbsp; = MINI_GPIO_BTN_RESET,<br />+&nbsp; &nbsp; &nbsp; &nbsp; .active_low&nbsp; &nbsp; = 0,<br />+&nbsp; &nbsp; }<br />+};<br />+<br />+static void __init mini_setup(void)<br />+{<br />+&nbsp; &nbsp; u8 *mac = (u8 *) KSEG1ADDR(0x1f01fc00);<br />+&nbsp; &nbsp; u8 *ee = (u8 *) KSEG1ADDR(0x1fff1000);<br />+<br />+&nbsp; &nbsp; ath79_register_m25p80(&amp;mini_flash_data);<br />+&nbsp; &nbsp; ath79_register_leds_gpio(-1, ARRAY_SIZE(mini_leds_gpio),<br />+&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; mini_leds_gpio);<br />+&nbsp; &nbsp; ath79_register_gpio_keys_polled(-1, MINI_KEYS_POLL_INTERVAL,<br />+&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ARRAY_SIZE(mini_gpio_keys),<br />+&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mini_gpio_keys);<br />+<br />+&nbsp; &nbsp; gpio_request_one(MINI_GPIO_USB_POWER,<br />+&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; GPIOF_OUT_INIT_HIGH | GPIOF_EXPORT_DIR_FIXED,<br />+&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &quot;USB power&quot;);<br />+&nbsp; &nbsp; ath79_register_usb();<br />+<br />+&nbsp; &nbsp; ath79_init_mac(ath79_eth0_data.mac_addr, mac, 0);<br />+<br />+&nbsp; &nbsp; ath79_register_mdio(0, 0x0);<br />+&nbsp; &nbsp; ath79_register_eth(0);<br />+<br />+&nbsp; &nbsp; ath79_register_wmac(ee, mac);<br />+}<br />+<br />+MIPS_MACHINE(ATH79_MACH_M_mini, &quot;M-mini&quot;, &quot;ELINK M-mini&quot;,<br />+&nbsp; &nbsp;&nbsp; &nbsp; &nbsp; mini_setup);<br />Index: target/linux/ar71xx/patches-3.10/635-MIPS-ath79-add-EL-LINK-support.patch<br />===================================================================<br />--- /dev/null<br />+++ target/linux/ar71xx/patches-3.10/635-MIPS-ath79-add-EL-LINK-support.patch<br />@@ -0,0 +1,51 @@<br />+--- a/arch/mips/ath79/Kconfig<br />++++ b/arch/mips/ath79/Kconfig<br />+@@ -597,6 +597,26 @@<br />+ &nbsp; &nbsp; select ATH79_DEV_M25P80<br />+ &nbsp; &nbsp; select ATH79_DEV_WMAC<br />+ <br />++config ATH79_MACH_EL_M150<br />++&nbsp; &nbsp; bool &quot;ELINK EL-M150 support&quot;<br />++&nbsp; &nbsp; select SOC_AR933X<br />++&nbsp; &nbsp; select ATH79_DEV_ETH<br />++&nbsp; &nbsp; select ATH79_DEV_GPIO_BUTTONS<br />++&nbsp; &nbsp; select ATH79_DEV_LEDS_GPIO<br />++&nbsp; &nbsp; select ATH79_DEV_M25P80<br />++&nbsp; &nbsp; select ATH79_DEV_USB<br />++&nbsp; &nbsp; select ATH79_DEV_WMAC<br />++<br />++config ATH79_MACH_M_mini<br />++&nbsp; &nbsp; bool &quot;ELINK M-mini support&quot;<br />++&nbsp; &nbsp; select SOC_AR933X<br />++&nbsp; &nbsp; select ATH79_DEV_ETH<br />++&nbsp; &nbsp; select ATH79_DEV_GPIO_BUTTONS<br />++&nbsp; &nbsp; select ATH79_DEV_LEDS_GPIO<br />++&nbsp; &nbsp; select ATH79_DEV_M25P80<br />++&nbsp; &nbsp; select ATH79_DEV_USB<br />++&nbsp; &nbsp; select ATH79_DEV_WMAC<br />++<br />+ config ATH79_MACH_TL_WA901ND<br />+ &nbsp; &nbsp; bool &quot;TP-LINK TL-WA901ND/TL-WA7510N support&quot;<br />+ &nbsp; &nbsp; select SOC_AR724X<br />+--- a/arch/mips/ath79/Makefile<br />++++ b/arch/mips/ath79/Makefile<br />+@@ -89,6 +89,8 @@<br />+ obj-$(CONFIG_ATH79_MACH_TL_MR3020)&nbsp; &nbsp; += mach-tl-mr3020.o<br />+ obj-$(CONFIG_ATH79_MACH_TL_MR3X20)&nbsp; &nbsp; += mach-tl-mr3x20.o<br />+ obj-$(CONFIG_ATH79_MACH_TL_WAX50RE)&nbsp; &nbsp; &nbsp;+= mach-tl-wax50re.o<br />++obj-$(CONFIG_ATH79_MACH_EL_M150)&nbsp; &nbsp; += mach-el-m150.o<br />++obj-$(CONFIG_ATH79_MACH_M_mini)&nbsp; &nbsp; += mach-el-mini.o<br />+ obj-$(CONFIG_ATH79_MACH_TL_WA901ND)&nbsp; &nbsp; += mach-tl-wa901nd.o<br />+ obj-$(CONFIG_ATH79_MACH_TL_WA901ND_V2)&nbsp; &nbsp; += mach-tl-wa901nd-v2.o<br />+ obj-$(CONFIG_ATH79_MACH_TL_WDR3500)&nbsp; &nbsp; &nbsp;+= mach-tl-wdr3500.o<br />+--- a/arch/mips/ath79/machtypes.h<br />++++ b/arch/mips/ath79/machtypes.h<br />+@@ -116,6 +116,8 @@<br />+ &nbsp; &nbsp; ATH79_MACH_TL_WR841N_V7,&nbsp; &nbsp; /* TP-LINK TL-WR841N/ND v7 */<br />+ &nbsp; &nbsp; ATH79_MACH_TL_WR841N_V8,&nbsp; &nbsp; /* TP-LINK TL-WR841N/ND v8 */<br />+ &nbsp; &nbsp; ATH79_MACH_TL_WR842N_V2,&nbsp; &nbsp; /* TP-LINK TL-WR842N/ND v2 */<br />++&nbsp; &nbsp; ATH79_MACH_EL_M150,&nbsp; &nbsp; &nbsp; &nbsp; /* ELINK EL-M150 */<br />++&nbsp; &nbsp; ATH79_MACH_M_mini,&nbsp; &nbsp; &nbsp; &nbsp; /* ELINK M-mini */<br />+ &nbsp; &nbsp; ATH79_MACH_TL_WR941ND,&nbsp; &nbsp; &nbsp; &nbsp; /* TP-LINK TL-WR941ND */<br />+ &nbsp; &nbsp; ATH79_MACH_UBNT_AIRROUTER,&nbsp; &nbsp; /* Ubiquiti AirRouter */<br />+ &nbsp; &nbsp; ATH79_MACH_UBNT_BULLET_M,&nbsp; &nbsp; /* Ubiquiti Bullet M */</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p224777">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">poor man</div>
					<div class="post-datetime">
						7 Feb 2014, 18:42					</div>
				</div>
				<div class="post-content content">
					<p>and you also can download this code by file here:</p><p><a href="http://pan.baidu.com/s/1mgBJoHa">http://pan.baidu.com/s/1mgBJoHa</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p237464">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">bertc3p0</div>
					<div class="post-datetime">
						20 Jun 2014, 13:49					</div>
				</div>
				<div class="post-content content">
					<p>Hi huangfc,<br /></p><div class="quotebox"><cite>poor man wrote:</cite><blockquote><p>Hi,sina:</p><p>I am huangfc, EL-m150 has been designed by me.</p></blockquote></div><p>Did you also designed the ELINK mini ? Awesome piece of hardware … Are these modules RF calibrated ? <br />If I could breathe a wish I would like to see a AR9341 mini module.<br />The benefit would be the GPIO multiplexing - the functions (e.g. I2S, 2nd Uart …) could be mapped to any port.</p><p>Regards</p><p>bertc3p0</p>											<p class="post-edited">(Last edited by <strong>bertc3p0</strong> on 20 Jun 2014, 18:06)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>