<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> WR1043ND: routing btw. VLANs?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 31 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p237544">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">schlamassl</div>
					<div class="post-datetime">
						21 Jun 2014, 01:30					</div>
				</div>
				<div class="post-content content">
					<p>Hi all,</p><p>I run two wr1043nd cascaded. 1st connected to WAN with a simple 192.x.x.x LAN config, 2nd router as a switch extending the 192.x.x.x LAN of 1st router with the exception of the 3rd port configured with add. VLAN with 10.x.x.x network. firewall permits forwarding of packets through direct connected LAN, route to 10.x.x.x network added.<br />I never came from 2nd router port 3 10.x.x.x network to rest of LAN or WAN (no ping/traceroute), so I assume a routing entry or firewall rule is missing.</p><p>WAN router (192.168.1.2):</p><p>Firewall<br />config zone<br />option name &#039;lan&#039;<br />option input &#039;ACCEPT&#039;<br />option output &#039;ACCEPT&#039;<br />option network &#039;lan&#039;<br />option forward &#039;ACCEPT&#039;</p><p>Routes<br />Kernel IP routing table<br />Destination&nbsp; &nbsp; &nbsp;Gateway&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Genmask&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Flags Metric Ref&nbsp; &nbsp; Use Iface<br />default&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ip-9x-xxx-xxx-xxx 0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;UG&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 eth0<br />10.0.1.0&nbsp; &nbsp; &nbsp; &nbsp; 192.168.1.3&nbsp; &nbsp; &nbsp;255.255.255.0&nbsp; &nbsp;UG&nbsp; &nbsp; 1&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 br-lan<br />9x.xxx.xxx.xxx&nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.255.252.0&nbsp; &nbsp;U&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 eth0<br />192.168.1.0&nbsp; &nbsp; &nbsp;*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.255.255.0&nbsp; &nbsp;U&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 br-lan</p><p>Second (LAN) Router 192.168.1.3:</p><p>Firewall<br />config defaults<br />option syn_flood &#039;1&#039;<br />option input &#039;ACCEPT&#039;<br />option output &#039;ACCEPT&#039;<br />option forward &#039;REJECT&#039;</p><p>config zone<br />option name &#039;lan&#039;<br />option network &#039;lan&#039;<br />option input &#039;ACCEPT&#039;<br />option output &#039;ACCEPT&#039;<br />option forward &#039;ACCEPT&#039;</p><p>config include<br />option path &#039;/etc/firewall.user&#039;</p><p>config zone<br />option input &#039;ACCEPT&#039;<br />option output &#039;ACCEPT&#039;<br />option network &#039;VLAN_test_vlan4untagged&#039;<br />option forward &#039;REJECT&#039;<br />option name &#039;vlan4test&#039;</p><p>config forwarding<br />option dest &#039;lan&#039;<br />option src &#039;vlan4test&#039;</p><p>config forwarding<br />option dest &#039;vlan4test&#039;<br />option src &#039;lan&#039;</p><p>network:<br />config interface &#039;loopback&#039;<br />option ifname &#039;lo&#039;<br />option proto &#039;static&#039;<br />option ipaddr &#039;127.0.0.1&#039;<br />option netmask &#039;255.0.0.0&#039;</p><p>config interface &#039;lan&#039;<br />option type &#039;bridge&#039;<br />option proto &#039;static&#039;<br />option netmask &#039;255.255.255.0&#039;<br />option ipaddr &#039;192.168.1.3&#039;<br />option gateway &#039;192.168.1.2&#039;<br />option broadcast &#039;192.168.1.255&#039;<br />option dns &#039;192.168.1.2&#039;<br />option _orig_ifname &#039;eth0.1&#039;<br />option _orig_bridge &#039;true&#039;<br />option ifname &#039;eth0.1&#039;</p><p>config switch<br />option name &#039;rtl8366rb&#039;<br />option reset &#039;1&#039;<br />option enable_vlan &#039;1&#039;<br />option enable_vlan4k &#039;1&#039;</p><p>config switch_vlan<br />option device &#039;rtl8366rb&#039;<br />option vlan &#039;1&#039;<br />option ports &#039;0 1 2 4 5t&#039;</p><p>config switch_vlan<br />option device &#039;rtl8366rb&#039;<br />option vlan &#039;4&#039;<br />option ports &#039;3 5t&#039;</p><p>config interface &#039;VLAN_test_vlan4untagged&#039;<br />option proto &#039;static&#039;<br />option ifname &#039;eth0.4&#039;<br />option ipaddr &#039;10.0.1.1&#039;<br />option netmask &#039;255.255.255.0&#039;<br />option broadcast &#039;10.0.1.255&#039;<br />option dns &#039;192.168.1.2&#039;<br />option gateway &#039;192.168.1.2&#039;</p><p>Routes<br />Kernel IP routing table<br />Destination&nbsp; &nbsp; &nbsp;Gateway&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Genmask&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Flags Metric Ref&nbsp; &nbsp; Use Iface<br />default&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;192.168.1.2&nbsp; &nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;UG&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 br-lan<br />10.0.1.0&nbsp; &nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.255.255.0&nbsp; &nbsp;U&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 eth0.4<br />192.168.1.0&nbsp; &nbsp; &nbsp;*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.255.255.0&nbsp; &nbsp;U&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 br-lan</p><p>ifconfig<br />br-lan&nbsp; &nbsp; Link encap:Ethernet&nbsp; HWaddr 64:70:02:4F:96:70&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:192.168.1.3&nbsp; Bcast:192.168.1.255&nbsp; Mask:255.255.255.0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:12506 errors:0 dropped:325 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:3136 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:813348 (794.2 KiB)&nbsp; TX bytes:1262360 (1.2 MiB)</p><p>eth0&nbsp; &nbsp; &nbsp; Link encap:Ethernet&nbsp; HWaddr 64:70:02:4F:96:70&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:3203314 errors:0 dropped:65 overruns:59702 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:3192899 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:1000 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:250071056 (238.4 MiB)&nbsp; TX bytes:186285786 (177.6 MiB)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Interrupt:4 </p><p>eth0.1&nbsp; &nbsp; Link encap:Ethernet&nbsp; HWaddr 64:70:02:4F:96:70&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:13336 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:3137 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:995447 (972.1 KiB)&nbsp; TX bytes:1262406 (1.2 MiB)</p><p>eth0.4&nbsp; &nbsp; Link encap:Ethernet&nbsp; HWaddr 64:70:02:4F:96:70&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:10.0.1.1&nbsp; Bcast:10.0.1.255&nbsp; Mask:255.255.255.0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:3189857 errors:0 dropped:80 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:3189722 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:191404662 (182.5 MiB)&nbsp; TX bytes:172248239 (164.2 MiB)</p><p>lo&nbsp; &nbsp; &nbsp; &nbsp; Link encap:Local Loopback&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:127.0.0.1&nbsp; Mask:255.0.0.0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP LOOPBACK RUNNING&nbsp; MTU:16436&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:59 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:59 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:5624 (5.4 KiB)&nbsp; TX bytes:5624 (5.4 KiB)</p><p>Any ideas? I did not find a similar post. If I missed one, a hint or link to it is very welcome.</p><p>Regards</p><p>Schlamassl</p>											<p class="post-edited">(Last edited by <strong>schlamassl</strong> on 21 Jun 2014, 01:34)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p237553">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">qasdfdsaq</div>
					<div class="post-datetime">
						21 Jun 2014, 02:36					</div>
				</div>
				<div class="post-content content">
					<p>Which version of the wr1043nd do you have and which port is the cable physically connected to?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p237565">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">alphasparc</div>
					<div class="post-datetime">
						21 Jun 2014, 07:22					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>schlamassl wrote:</cite><blockquote><p>config switch<br />option name &#039;rtl8366rb&#039;<br />option reset &#039;1&#039;<br />option enable_vlan &#039;1&#039;<br />option enable_vlan4k &#039;1&#039;</p><p>config switch_vlan<br />option device &#039;rtl8366rb&#039;<br />option vlan &#039;1&#039;<br />option ports &#039;0 1 2 4 5t&#039;</p><p>config switch_vlan<br />option device &#039;rtl8366rb&#039;<br />option vlan &#039;4&#039;<br />option ports &#039;3 5t&#039;</p></blockquote></div><p>This should already tell you which HW Version it is.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p237574">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">schlamassl</div>
					<div class="post-datetime">
						21 Jun 2014, 11:34					</div>
				</div>
				<div class="post-content content">
					<p>Completing information:</p><p>I can not reach 192.x.x.x network or WAN from the 10.x.x.x network (vlan4). All other clients and computers associated with the 192.x.x.x LAN (cable and Wifi) on both routers work flawless.</p><p>LAN cable of gateway connected to port 1 (numbering from chassis) of LAN switch, LAN cable from 2nd router (to gateway) on WAN port of 2nd router.</p><p>hardware gateway (vers. 2):<br />[&nbsp; &nbsp; 0.000000] Linux version 3.10.28 (fnord@tschunk) (gcc version 4.6.4 (OpenWrt/Linaro GCC 4.6-2013.05 r39535) ) #1 Sun Feb 9 19:30:00 UTC 2014<br />[&nbsp; &nbsp; 0.000000] MyLoader: sysp=e7e1b46d, boardp=97a575a1, parts=e535b7bb<br />[&nbsp; &nbsp; 0.000000] bootconsole [early0] enabled<br />[&nbsp; &nbsp; 0.000000] CPU revision is: 00019750 (MIPS 74Kc)<br />[&nbsp; &nbsp; 0.000000] SoC: Qualcomm Atheros QCA9558 rev 0<br />[&nbsp; &nbsp; 0.000000] Clocks: CPU:720.000MHz, DDR:600.000MHz, AHB:200.000MHz, Ref:40.000MHz</p><p>hardware LAN router (vers. 1.2)<br />[&nbsp; &nbsp; 0.000000] Linux version 3.3.8 (blogic@Debian-60-squeeze-64-minimal) (gcc version 4.6.3 20120201 (prerelease) (Linaro GCC 4.6-2012.02) ) #1 Sat Mar 23 16:49:30 UTC 2013<br />[&nbsp; &nbsp; 0.000000] MyLoader: sysp=a2a2aaaa, boardp=ab2a2aa2, parts=822a2c22<br />[&nbsp; &nbsp; 0.000000] bootconsole [early0] enabled<br />[&nbsp; &nbsp; 0.000000] CPU revision is: 00019374 (MIPS 24Kc)<br />[&nbsp; &nbsp; 0.000000] SoC: Atheros AR9132 rev 2<br />[&nbsp; &nbsp; 0.000000] Clocks: CPU:400.000MHz, DDR:400.000MHz, AHB:200.000MHz, Ref:5.000MHz<br />[&nbsp; &nbsp; 0.000000] Determined physical RAM map:</p><p>Thanks for your help.</p><p>Regards</p><p>Schlamassl</p>											<p class="post-edited">(Last edited by <strong>schlamassl</strong> on 21 Jun 2014, 11:49)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p237635">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">qasdfdsaq</div>
					<div class="post-datetime">
						22 Jun 2014, 01:38					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>alphasparc wrote:</cite><blockquote><p>This should already tell you which HW Version it is.</p></blockquote></div><p>It doesn&#039;t and it shouldn&#039;t.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p237636">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">qasdfdsaq</div>
					<div class="post-datetime">
						22 Jun 2014, 01:41					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>schlamassl wrote:</cite><blockquote><p>Completing information:</p><p>I can not reach 192.x.x.x network or WAN from the 10.x.x.x network (vlan4). All other clients and computers associated with the 192.x.x.x LAN (cable and Wifi) on both routers work flawless.</p><p>LAN cable of gateway connected to port 1 (numbering from chassis) of LAN switch, LAN cable from 2nd router (to gateway) on WAN port of 2nd router.</p></blockquote></div><p>No I need to know what port the <em>client</em> device on the 10.x.x.x network that cannot access the others is connected to.</p>											<p class="post-edited">(Last edited by <strong>qasdfdsaq</strong> on 22 Jun 2014, 01:41)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p237670">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">schlamassl</div>
					<div class="post-datetime">
						22 Jun 2014, 14:02					</div>
				</div>
				<div class="post-content content">
					<p>ehm...I think I found the reason (sometimes a good idea to look into the system logs):</p><p>Jun 20 11:17:21 OpenWrt user.info sysinit: iptables v1.4.10: chain name `zone_vlan4test_to_rest_notrack&#039; too long (must be under 29 chars)</p><p>Shortened Interface name and now I can ping the router interface from 192.x.x.x LAN (192.168.1.154). Still need to test access to WAN (using this machine for test connection as well, so need to move it and reconnect it).</p><p>PING 10.0.1.1 (10.0.1.1) 56(84) bytes of data.<br />64 bytes from 10.0.1.1: icmp_seq=1 ttl=64 time=60.3 ms<br />From 10.0.1.1: icmp_seq=2 Redirect Host(New nexthop: 10.0.1.1)<br />64 bytes from 10.0.1.1: icmp_seq=2 ttl=64 time=4.78 ms<br />From 10.0.1.1: icmp_seq=3 Redirect Host(New nexthop: 10.0.1.1)<br />64 bytes from 10.0.1.1: icmp_seq=3 ttl=64 time=5.44 ms<br />From 10.0.1.1: icmp_seq=4 Redirect Host(New nexthop: 10.0.1.1)<br />64 bytes from 10.0.1.1: icmp_seq=4 ttl=64 time=9.97 ms<br />From 10.0.1.1: icmp_seq=5 Redirect Host(New nexthop: 10.0.1.1)<br />64 bytes from 10.0.1.1: icmp_seq=5 ttl=64 time=4.92 ms</p><br /><p>@qasdfdsaq: client test-connection via cable to Ethernet port #3</p><p>Thanks for your help</p><p>schlamassl</p><p>edit: tested connection to www via cable. everything fine now. So it is just a simple reason: interface name was too long</p>											<p class="post-edited">(Last edited by <strong>schlamassl</strong> on 22 Jun 2014, 15:08)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p237680">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">qasdfdsaq</div>
					<div class="post-datetime">
						22 Jun 2014, 16:56					</div>
				</div>
				<div class="post-content content">
					<p>Well you learn something new every day <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p238135">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">schlamassl</div>
					<div class="post-datetime">
						26 Jun 2014, 16:49					</div>
				</div>
				<div class="post-content content">
					<p>...need to come back...</p><p>in the first instance I want to be able to set up a VLAN with seprate network addressing to be integrated into the routing btw. the WR1043ND devices. Next step is to deny (!) direct routing between the two networks located on the same router and to route via a separate proxy. Therefore I set all permissions of the add. VLAN to &#039;reject&#039; (input, output, forward) in the firewall and disabled forwarding between firewall zones. But it seems this produce such a high system load that I can not reach the router any longer (timeouts for Luci and SSH) - so obviously no config available.</p><p>Disabling only the inter-zonal forwarding in the firewall did not show any effect. Pakets still go the direct way over the router, not over the proxy (says traceroute).</p><p>Any ideas? Hints? Links?</p><p>Regards</p><p>Schlamassl</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p238148">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">qasdfdsaq</div>
					<div class="post-datetime">
						26 Jun 2014, 20:25					</div>
				</div>
				<div class="post-content content">
					<p>What kind of proxy is it? Proxy and routing have nothing to do with each other, and are on completely different layers. Settings for one won&#039;t have any effect on the other.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p238234">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">schlamassl</div>
					<div class="post-datetime">
						27 Jun 2014, 11:09					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>qasdfdsaq wrote:</cite><blockquote><p>What kind of proxy is it? Proxy and routing have nothing to do with each other, and are on completely different layers. Settings for one won&#039;t have any effect on the other.</p></blockquote></div><p>HI qasdfdsaq,</p><p>the proxy is a FreeBSD system with routing enabled and Squid as an Internet proxy.<br />I know that routing on Layer 3 is different from all proxy behaviour on Layer 5 to 7, but anyhow: if i disable the inter-zonal forwarding, I am expecting that no packets flow from one network (or interface or firewall zone) to the other. Any misbelieve in that?</p><p>Meanwhile I reset the router and here is the config (where I let the zones on &#039;input&#039; and &#039;output&#039;). The &#039;proxy_wifi&#039; interface and &#039;wifi_proxy&#039; firewall zone are related to VLAN3, which is the connection to wifi and one of the connections to the proxy.</p><p>192.168.1.98 and 10.0.0.97 are the proxy interfaces.<br />The route output in my eyes look a bit strange, as it misses the default route/gateway for the LAN to 192.168.1.2?</p><p>root@OpenWrt:/etc/config# cat network</p><p>config interface &#039;loopback&#039;<br />option ifname &#039;lo&#039;<br />option proto &#039;static&#039;<br />option ipaddr &#039;127.0.0.1&#039;<br />option netmask &#039;255.0.0.0&#039;</p><p>config interface &#039;lan&#039;<br />option ifname &#039;eth0.1&#039;<br />option type &#039;bridge&#039;<br />option proto &#039;static&#039;<br />option netmask &#039;255.255.255.0&#039;<br />option ipaddr &#039;192.168.1.3&#039;<br />option gateway &#039;192.168.1.2&#039;<br />option broadcast &#039;192.168.1.255&#039;<br />option dns &#039;192.168.1.2&#039;</p><p>config switch<br />option name &#039;rtl8366rb&#039;<br />option reset &#039;1&#039;<br />option enable_vlan &#039;1&#039;<br />option enable_vlan4k &#039;1&#039;</p><p>config switch_vlan<br />option device &#039;rtl8366rb&#039;<br />option vlan &#039;1&#039;<br />option ports &#039;0 1 2 3 4 5t&#039;</p><p>config switch_vlan<br />option device &#039;rtl8366rb&#039;<br />option vlan &#039;3&#039;<br />option ports &#039;4t 5t&#039;</p><p>config interface &#039;proxy_wifi&#039;<br />option proto &#039;static&#039;<br />option ifname &#039;eth0.3&#039;<br />option ipaddr &#039;10.0.0.1&#039;<br />option netmask &#039;255.255.255.0&#039;<br />option gateway &#039;10.0.0.97&#039;<br />option broadcast &#039;10.0.0.255&#039;<br />option type &#039;bridge&#039;</p><p>config route<br />option interface &#039;lan&#039;<br />option target &#039;10.0.0.0&#039;<br />option netmask &#039;255.255.255.0&#039;<br />option gateway &#039;192.168.1.98&#039;</p><p>config route<br />option interface &#039;proxy_wifi&#039;<br />option target &#039;192.168.1.0&#039;<br />option netmask &#039;255.255.255.0&#039;<br />option gateway &#039;10.0.0.97&#039;</p><p>root@OpenWrt:/etc/config# cat firewall</p><p>config defaults<br />option syn_flood &#039;1&#039;<br />option input &#039;ACCEPT&#039;<br />option output &#039;ACCEPT&#039;<br />option forward &#039;REJECT&#039;</p><p>config zone<br />option name &#039;lan&#039;<br />option network &#039;lan&#039;<br />option input &#039;ACCEPT&#039;<br />option output &#039;ACCEPT&#039;<br />option forward &#039;ACCEPT&#039;</p><p>config include<br />option path &#039;/etc/firewall.user&#039;</p><p>config zone<br />option input &#039;ACCEPT&#039;<br />option forward &#039;REJECT&#039;<br />option output &#039;ACCEPT&#039;<br />option name &#039;wifi_proxy&#039;<br />option network &#039;proxy_wifi&#039;</p><p>root@OpenWrt:/etc/config# route<br />Kernel IP routing table<br />Destination&nbsp; &nbsp; &nbsp;Gateway&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Genmask&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Flags Metric Ref&nbsp; &nbsp; Use Iface<br />default&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;10.0.0.97&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;UG&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 br-proxy_wifi<br />10.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; 192.168.1.98&nbsp; &nbsp; 255.255.255.0&nbsp; &nbsp;UG&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 br-lan<br />192.168.1.0&nbsp; &nbsp; &nbsp;*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.255.255.0&nbsp; &nbsp;U&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 br-lan</p><p>Regards</p><p>Schlamassl</p>											<p class="post-edited">(Last edited by <strong>schlamassl</strong> on 27 Jun 2014, 11:15)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p238257">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">qasdfdsaq</div>
					<div class="post-datetime">
						27 Jun 2014, 14:41					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>schlamassl wrote:</cite><blockquote><p>but anyhow: if i disable the inter-zonal forwarding, I am expecting that no packets flow from one network (or interface or firewall zone) to the other. Any misbelieve in that?</p></blockquote></div><p>Well sorta. In theory it should work like that but in practice you need additional firewall rules to explicitly block that output range.</p><div class="quotebox"><blockquote><p>192.168.1.98 and 10.0.0.97 are the proxy interfaces.<br />The route output in my eyes look a bit strange, as it misses the default route/gateway for the LAN to 192.168.1.2?</p></blockquote></div><p>Why would it need a route for a network it&#039;s already on?</p><p>Your routing and interface configuration is all wrong. I think your understanding of this is also wrong. You can&#039;t have multiple default gateways. A default gateway is for the device, not the interface. See:<br /><a href="http://windows.microsoft.com/en-gb/windows/configuring-multiple-network-gateways#1TC=windows-7">http://windows.microsoft.com/en-gb/wind … =windows-7</a><br />and<br /><a href="http://support.microsoft.com/kb/159168">http://support.microsoft.com/kb/159168</a></p><br /><p>As far as I can tell your network is set up a bit like this:</p><p>Main router&nbsp; &nbsp; &nbsp; &nbsp;This Router<br />192.168.1.2&nbsp; ---- 192.168.1.3<br />&nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;10.0.0.1&nbsp; &nbsp; --- Wireless clients<br />&nbsp; &nbsp; |&nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |<br />&nbsp; &nbsp; |&nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |<br />&nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 10.0.0.97<br />&nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;FreeBSD Proxy<br />&nbsp; &nbsp; ---------&nbsp; &nbsp;some.other.ip<br />&nbsp; &nbsp; &nbsp; &nbsp; <br />If that&#039;s the case you shouldn&#039;t be using routing at all. This router isn&#039;t the proxy, so it doesn&#039;t need to get involved in any way. The VLAN configuration already handles &quot;routing&quot; the traffic to the proxy.</p>											<p class="post-edited">(Last edited by <strong>qasdfdsaq</strong> on 27 Jun 2014, 14:42)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p238352">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">schlamassl</div>
					<div class="post-datetime">
						28 Jun 2014, 12:15					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>qasdfdsaq wrote:</cite><blockquote><div class="quotebox"><cite>schlamassl wrote:</cite><blockquote><p>but anyhow: if i disable the inter-zonal forwarding, I am expecting that no packets flow from one network (or interface or firewall zone) to the other. Any misbelieve in that?</p></blockquote></div><p>Well sorta. In theory it should work like that but in practice you need additional firewall rules to explicitly block that output range.</p></blockquote></div><p>you mean disabling output from this fw zones? Will give a try.</p><div class="quotebox"><blockquote><div class="quotebox"><blockquote><p>192.168.1.98 and 10.0.0.97 are the proxy interfaces.<br />The route output in my eyes look a bit strange, as it misses the default route/gateway for the LAN to 192.168.1.2?</p></blockquote></div><p>Why would it need a route for a network it&#039;s already on?</p><p>Your routing and interface configuration is all wrong. I think your understanding of this is also wrong. You can&#039;t have multiple default gateways. A default gateway is for the device, not the interface. See:<br /><a href="http://windows.microsoft.com/en-gb/windows/configuring-multiple-network-gateways#1TC=windows-7">http://windows.microsoft.com/en-gb/wind … =windows-7</a><br />and<br /><a href="http://support.microsoft.com/kb/159168">http://support.microsoft.com/kb/159168</a></p></blockquote></div><p>...well...seems to end up in a philosophical discussion :-)<br />1) I do not see the config all wrong, as it works with the exception of a distinctive separation of the networks (or interfaces in Openwrt terminology)<br />2) Microsoft? Nice try...but...the doc is written for a PC, not for a router. And as the name says: it is a &#039;route&#039; which means it is assigend to a network, not to a device. Sometimes even multiple default routes within the same (!) network/ subnet are usefull, e.g. for large companies with a single huge subnet and Internet access in different countries (backing up Internet connectivity). And believe me: I know people who configured that!</p><p>You are correct with regard to the routing table: as I connected the two wr1043nd together as a single 192.168.x.x subnet (second one as a switch for that network), there is no need to show the default route for that subnet.</p><div class="quotebox"><blockquote><p>As far as I can tell your network is set up a bit like this:</p><p>Main router&nbsp; &nbsp; &nbsp; &nbsp;This Router<br />192.168.1.2&nbsp; ---- 192.168.1.3<br />&nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;10.0.0.1&nbsp; &nbsp; --- Wireless clients<br />&nbsp; &nbsp; |&nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |<br />&nbsp; &nbsp; |&nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |<br />&nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 10.0.0.97<br />&nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;FreeBSD Proxy<br />&nbsp; &nbsp; ---------&nbsp; &nbsp;some.other.ip<br />&nbsp; &nbsp; &nbsp; &nbsp; <br />If that&#039;s the case you shouldn&#039;t be using routing at all. This router isn&#039;t the proxy, so it doesn&#039;t need to get involved in any way. The VLAN configuration already handles &quot;routing&quot; the traffic to the proxy.</p></blockquote></div><p>...not quite correct: 10.0.0.97 and 192.168.1.98 are on the same interface. First one tagged VLAN, second one untagged default (0) VLAN.<br />Static route to the 10.x.x.x network are definitely needed (at a minium at the gateway router), if the proxy is doing the filtering and routing between networks. Otherwise packets from the Internet to 10.x.x.x. network would not reach it.<br />But I am wondering why the router is ignoring the route?</p><p>Regards</p><p>schlamassl</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p238421">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">qasdfdsaq</div>
					<div class="post-datetime">
						29 Jun 2014, 03:30					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>schlamassl wrote:</cite><blockquote><div class="quotebox"><blockquote><div class="quotebox"><blockquote><p>192.168.1.98 and 10.0.0.97 are the proxy interfaces.<br />The route output in my eyes look a bit strange, as it misses the default route/gateway for the LAN to 192.168.1.2?</p></blockquote></div><p>Why would it need a route for a network it&#039;s already on?</p><p>Your routing and interface configuration is all wrong. I think your understanding of this is also wrong. You can&#039;t have multiple default gateways. A default gateway is for the device, not the interface. See:<br /><a href="http://windows.microsoft.com/en-gb/windows/configuring-multiple-network-gateways#1TC=windows-7">http://windows.microsoft.com/en-gb/wind … =windows-7</a><br />and<br /><a href="http://support.microsoft.com/kb/159168">http://support.microsoft.com/kb/159168</a></p></blockquote></div><p>...well...seems to end up in a philosophical discussion :-)<br />1) I do not see the config all wrong, as it works with the exception of a distinctive separation of the networks (or interfaces in Openwrt terminology)</p></blockquote></div><p>Well if you won&#039;t listen to advice, your loss..</p><div class="quotebox"><blockquote><p>2) Microsoft? Nice try...but...the doc is written for a PC, not for a router. And as the name says: it is a &#039;route&#039; which means it is assigend to a network, not to a device. Sometimes even multiple default routes within the same (!) network/ subnet are usefull, e.g. for large companies with a single huge subnet and Internet access in different countries (backing up Internet connectivity). And believe me: I know people who configured that!</p></blockquote></div><p>PC or router makes no difference. PCs ARE routers and vice versa. IP works the same in either case, I simply posted a MS document because I thought it might be easier for you to understand. </p><p>Like the document indicates above, it&#039;s not going to work unless you understand very well what you&#039;re doing. Perhaps you could ask those people you know who set up corporate networks to help you, since you&#039;re clearly not listening to me!</p><div class="quotebox"><blockquote><div class="quotebox"><blockquote><p>As far as I can tell your network is set up a bit like this:</p><p>Main router&nbsp; &nbsp; &nbsp; &nbsp;This Router<br />192.168.1.2&nbsp; ---- 192.168.1.3<br />&nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;10.0.0.1&nbsp; &nbsp; --- Wireless clients<br />&nbsp; &nbsp; |&nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |<br />&nbsp; &nbsp; |&nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |<br />&nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 10.0.0.97<br />&nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;FreeBSD Proxy<br />&nbsp; &nbsp; ---------&nbsp; &nbsp;some.other.ip<br />&nbsp; &nbsp; &nbsp; &nbsp; <br />If that&#039;s the case you shouldn&#039;t be using routing at all. This router isn&#039;t the proxy, so it doesn&#039;t need to get involved in any way. The VLAN configuration already handles &quot;routing&quot; the traffic to the proxy.</p></blockquote></div><p>...not quite correct: 10.0.0.97 and 192.168.1.98 are on the same interface. First one tagged VLAN, second one untagged default (0) VLAN.</p></blockquote></div><p>That&#039;s not how interfaces work. It is not the same interface. Linux (and Windows, and everything else) treats different VLANs as different interfaces.</p><div class="quotebox"><blockquote><p>Static route to the 10.x.x.x network are definitely needed (at a minium at the gateway router), if the proxy is doing the filtering and routing between networks. Otherwise packets from the Internet to 10.x.x.x. network would not reach it.<br />But I am wondering why the router is ignoring the route?</p></blockquote></div><p>That&#039;s not how routing or proxying works.</p><p>With a proxy, the gateway router sees the source/destination of the traffic as the proxy itself. It knows nothing and can know nothing about any device, network, route, or subnet behind the proxy. If the gateway router can communicate directly with devices behind the proxy, it defeats the point of having a proxy in the first place. The same applies for NAT, by the way, since proxying is practically just layer 7 NAT.</p><p>Also there is no route to &quot;ignore&quot;. &quot;Routing&quot; (well, more technically, forwarding) is what happens when a device needs to communicate with another device it cannot reach directly. Your router and proxy are both on the same subnet and can reach all target devices directly. There is nothing to route and no route to ignore.</p>											<p class="post-edited">(Last edited by <strong>qasdfdsaq</strong> on 29 Jun 2014, 03:38)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p238471">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">schlamassl</div>
					<div class="post-datetime">
						29 Jun 2014, 13:57					</div>
				</div>
				<div class="post-content content">
					<p>Ok...I see a bit of add. explanation maybe helpful:</p><p>squid should just serve as an Internet &#039;authentication&#039; proxy. it should not do any NAT or IP hiding. WAN traffic will be NATed at the gateway router only. </p><p>The network should look like this:</p><p>www ---- openwrt gateway ----- openwrt &#039;switch&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; --------------------------------------&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp;&#039;LAN&#039; 192.168.1.0/24&nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; --------------------------------------&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;WLAN clients&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;192.168.1.98&nbsp; &nbsp;----------------------------------<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| &#039;proxy+wifi&#039; 10.0.0.0/24 |<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;---------------------------------<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;10.0.0.97&nbsp; &nbsp; &nbsp; &nbsp; WLAN clients<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-------------------<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp; &nbsp; &nbsp;squid&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-------------------</p><p>So WLAN clients out of the &#039;proxy+wifi&#039; zone and squid are in the same subnet but (!) need to be strictly separated from routing on the &#039;switch&#039; to 192.168.1.0. All traffic of&nbsp; 10.0.0.0 needs to be solely routed via the squid server.</p><p>When I said squid is on the same &#039;interface&#039; I mean physically the same GbE if. So maybe I know what I am doing.</p><p>@qasdfdsaq<br />PCs and routers are not the same: PCs are for handling applications, routers are for handling &#039;routes&#039;. Physically a PC maybe used as a router, but its design is supposed for other use.</p><p>There is no need to be unfriendly if someone has another oppinion than you.</p><p>Regards</p><p>Schlamassl</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p238535">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">qasdfdsaq</div>
					<div class="post-datetime">
						29 Jun 2014, 23:43					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>schlamassl wrote:</cite><blockquote><p>Ok...I see a bit of add. explanation maybe helpful:</p><p>squid should just serve as an Internet &#039;authentication&#039; proxy. it should not do any NAT or IP hiding. WAN traffic will be NATed at the gateway router only.</p></blockquote></div><p>Again that&#039;s not how proxying works. Either it&#039;s a proxy, and it hides IPs, or it&#039;s not a proxy at which point you need to explain in more detail what it&#039;s doing... What exactly is an authentication proxy? Why is it there at all if you don&#039;t want it to do any proxying?</p><div class="quotebox"><blockquote><p>So WLAN clients out of the &#039;proxy+wifi&#039; zone and squid are in the same subnet but (!) need to be strictly separated from routing on the &#039;switch&#039; to 192.168.1.0. All traffic of&nbsp; 10.0.0.0 needs to be solely routed via the squid server.</p></blockquote></div><p>That&#039;s what VLANs do, no need for anything else or &quot;routing&quot;.</p><div class="quotebox"><blockquote><p>@qasdfdsaq<br />PCs and routers are not the same: PCs are for handling applications, routers are for handling &#039;routes&#039;. Physically a PC maybe used as a router, but its design is supposed for other use.</p></blockquote></div><p>No. Apart from arguing semantics about what the definition of a &quot;PC&quot; is it makes no difference that <em>the network stack on both is identical</em> regardless of what applications you&#039;re using. especially when you&#039;re running the same operating system on both. </p><p>I&#039;m not being unfriendly, I&#039;m giving you advice which you seem to be ignoring because you think you know better... That&#039;s fine, but don&#039;t expect any help if you keep trying to tell me I&#039;m wrong.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>