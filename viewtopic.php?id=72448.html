<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> openwrt vlan and pfsense single nic</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 30 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p367549">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">norman25</div>
					<div class="post-datetime">
						30 Oct 2017, 08:20					</div>
				</div>
				<div class="post-content content">
					<p>Is it possible to configure vlan&#039;s in openwrt 15.05.1 for use in the pfsense firewall with a single network interface?<br />for example :<br />vlan 99 = wan<br />vlan 10 = lan (bridged for 3 ports)<br />vlan 20 = private wifi<br />vlan 30 = guest wifi<br />trunk port = pfsense firewall</p><p>I have managed to create the wifi&#039;s vlan 20 and vlan 30 but I need some example for the other interfaces.</p>											<p class="post-edited">(Last edited by <strong>norman25</strong> on 31 Oct 2017, 17:22)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p367560">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">mk24</div>
					<div class="post-datetime">
						30 Oct 2017, 14:57					</div>
				</div>
				<div class="post-content content">
					<p>Are you talking about running OpenWrt on hardware that has no switch, just a single Ethernet port connected directly to the CPU?&nbsp; In that case, you use &#039;eth0.x&#039; in your configs, where x is the VLAN number that network will tag the packets on the Ethernet cable.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p367575">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">norman25</div>
					<div class="post-datetime">
						30 Oct 2017, 19:42					</div>
				</div>
				<div class="post-content content">
					<p>yes i&#039;m try to setup something like this:</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;10T&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;20T&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;30T&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | ANT<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;99T&nbsp; &nbsp; 99&nbsp; &nbsp; &nbsp;10&nbsp; &nbsp; &nbsp; &nbsp;10&nbsp; &nbsp; 10&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;+=========================+&nbsp; &nbsp;|<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp; +---+&nbsp; +---+&nbsp; +---+&nbsp; +---+&nbsp; +---+&nbsp; &nbsp; &nbsp; &nbsp;|&nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; +------------+<br />&nbsp; openwrt&nbsp; &nbsp;|&nbsp; | 1 |&nbsp; &nbsp; &nbsp;| 2 |&nbsp; &nbsp; | 3 |&nbsp; &nbsp; | 4 |&nbsp; &nbsp; &nbsp;| 5 |&nbsp; &nbsp; &nbsp; +-+ &lt;====&gt;|wifi devices|<br />&nbsp; vlan&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp; +-^-+&nbsp; +-^-+&nbsp; +-^-+&nbsp; +-^-+&nbsp; +-^-+&nbsp; &nbsp; |&nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 20&nbsp; &nbsp; &nbsp;30&nbsp; |<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|ppal&nbsp; guest|<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;+==|=====|=====|====|=====|===+&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; +------------+<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; +------+-------+<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|<br />+--------------+&nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; +----------------+<br />|&nbsp; &nbsp; pfSense&nbsp; &nbsp;|-+&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp; computers/&nbsp; |<br />|&nbsp; &nbsp;firewall&nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| wired devices|<br />+--------------+&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; +----------------+<br />+--------------+&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />|&nbsp; &nbsp; cable&nbsp; &nbsp; &nbsp; &nbsp; |---------+&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />|&nbsp; &nbsp; modem&nbsp; &nbsp; &nbsp;|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />+--------------+</p><p>Excuse my ASCII I do not know why it does not look good.</p>											<p class="post-edited">(Last edited by <strong>norman25</strong> on 31 Oct 2017, 17:23)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p367581">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">mk24</div>
					<div class="post-datetime">
						30 Oct 2017, 22:58					</div>
				</div>
				<div class="post-content content">
					<p>So you do have a switch.&nbsp; First you should check the openwrt wiki page for your device to see if it explains the mapping of switch ports.&nbsp; Because in most cases the logical numbers don&#039;t match the physical numbers on the box and LEDs.&nbsp; Also you need to know if your model has two CPU ports, with one connected directly to the modem plug, or if there is one with all 5 ports on the back going through the switch.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p367591">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">norman25</div>
					<div class="post-datetime">
						31 Oct 2017, 02:30					</div>
				</div>
				<div class="post-content content">
					<p>well the switch in router:<br />rt305x-ews<br />config switch_vlan<br />&nbsp; &nbsp; &nbsp; &nbsp; option device &#039;rt305x&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option vlan &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ports &#039;1 2 3 5 6t&#039;</p><p>for now i get working the two wifi&#039;s and wan (port 3 4), but not the lan&#039;s, wen i changed any settings in the switch (port 0 1 2) i&#039;m loose the access to web gui and ssh</p><p>thx for your help</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p367614">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">mk24</div>
					<div class="post-datetime">
						31 Oct 2017, 15:58					</div>
				</div>
				<div class="post-content content">
					<p>First, temporarily set up an &quot;administration&quot; wifi AP, attached to LAN, so you can log in that way even if Ethernet is not working.</p><p>Create all 4 vlans in the switch.</p><p>All four are tagged to the CPU port, and the trunk cable port.&nbsp; (actually if you&#039;re just passing the modem through to the pfSense box, you don&#039;t need 99 switched to the router CPU)</p><p>VLAN 99 is untagged for one port for the modem.&nbsp; VLAN 10 is untagged for 3 ports for the LAN.&nbsp; VLANs 20 and 30 have no Ethernet outputs.</p><p>Then in the network config, make eth0.10 the LAN physical port.&nbsp; Create two other bridge networks for the WLANs.&nbsp; These can have protocol &quot;unmanaged&quot; since they are just bridging through.&nbsp; Attach them to eth0.20 and eth0.30.&nbsp; Attach the APs to those networks.&nbsp; You can&#039;t attach an AP directly to an ethernet interface, you have to create a bridge in the kernel.</p>											<p class="post-edited">(Last edited by <strong>mk24</strong> on 31 Oct 2017, 15:59)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p367618">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">norman25</div>
					<div class="post-datetime">
						31 Oct 2017, 17:19					</div>
				</div>
				<div class="post-content content">
					<p>thanks a lot man.<br />configuration achieved, although in a different way since I had a working part of this.<br />in order to not lose access to the ssh and the web gui, the ip and port of LUCI admin needed to be changed and also the port ssh, to not have conflicts with the pFsense. then create a bridge between the LAN and the VLAN_10 and ready is running.<br />again thank you very much for your help.<br />NOTE:<br />vlans config changed to<br />vlan 99 = wan<br />vlan 10 = lan <br />vlan 20 = private wifi<br />vlan 30 = guest wifi</p>											<p class="post-edited">(Last edited by <strong>norman25</strong> on 31 Oct 2017, 17:21)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>