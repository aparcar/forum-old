<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> [solved] ZyXEL EMG2926-Q10A flash/upgrade</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 26 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p344586">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">va2thc</div>
					<div class="post-datetime">
						23 Nov 2016, 14:35					</div>
				</div>
				<div class="post-content content">
					<p>This router is acctually a ZyXEL NBG6716, it comes with a custom OpenWRT from my ISP</p><p>I want to get rid of the ISP&#039;s firmware and install the &#039;normal&#039; OpenWRT in it but I am having issues</p><p>Not the bootloader i&#039;m used to seeing, no boot from tftp firmware or flash from tftp file...</p><p>EMG2926 - Scorpion 1.0<br />DRAM:&nbsp; 32bit ddr2 256 MB<br />Flash: 16 MB<br />*** Warning *** : PCIe WLAN Module not found !!!<br />Net:&nbsp; &nbsp;Max resets limit reached exiting...<br />eth0, eth1<br />NAND:&nbsp; Hynix NAND 128MiB 3,3V 8-bit [128MB]</p><p>ZyXEL zloader v1.31 (Feb 27 2014 - 03:42:13)<br />Multiboot clinent version: 1.2<br />dup 1 speed 1000</p><p>Hit any key to stop autoboot:&nbsp; 3<br />EMG2926&gt; <br />ATEN&nbsp; &nbsp; x,(y)&nbsp; &nbsp; &nbsp;set BootExtension Debug Flag (y=password)<br />ATSE&nbsp; &nbsp; x&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;show the seed of password generator<br />ATSH&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dump manufacturer related data in ROM<br />ATRT&nbsp; &nbsp; (x,y,z,u) ATRT RAM read/write test (x=level, y=start addr, z=end addr, u=iterations<br />ATGO&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; boot up whole system<br />ATUR&nbsp; &nbsp; x&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;upgrade RAS image (filename)</p><br /><br /><p>root@EMG2926:/# cat /etc/openwrt_release<br />DISTRIB_ID=&quot;OpenWrt&quot;<br />DISTRIB_RELEASE=&quot;Bleeding Edge&quot;<br />DISTRIB_REVISION=&quot;r6687&quot;<br />DISTRIB_CODENAME=&quot;barrier_breaker&quot;<br />DISTRIB_TARGET=&quot;ar71xx/generic&quot;<br />DISTRIB_DESCRIPTION=&quot;OpenWrt Barrier Breaker r6687&quot;</p><p>root@EMG2926:/# cat /tmp/sysinfo/board_name<br />emg2926</p><p>root@EMG2926:/# cat /tmp/sysinfo/model<br />ZyXEL EMG2926</p><p>root@EMG2926:/tmp# mtd -r write openwrt-15.05.1-ar71xx-nand-nbg6716-squashfs-factory.bin firmware<br />Could not open mtd device: firmware<br />Can&#039;t open device for writing!</p><p>root@EMG2926:/tmp# mtd -r write openwrt-15.05.1-ar71xx-nand-nbg6716-squashfs-factory.bin linux<br />Could not open mtd device: linux<br />Can&#039;t open device for writing!</p><p>root@EMG2926:/tmp# sysupgrade -n -v openwrt-15.05.1-ar71xx-nand-nbg6716-squashfs-sysupgrade.tar<br />Still not supoort OpenWRT firmware upgrate mechainsm<br />Image check &#039;platform_check_image&#039; failed.</p><p>root@EMG2926:/tmp# sysupgrade -n -v -F openwrt-15.05.1-ar71xx-nand-nbg6716-squashfs-sysupgrade.tar<br />Still not supoort OpenWRT firmware upgrate mechainsm<br />Image check &#039;platform_check_image&#039; failed but --force given - will update anyway!<br />Sending TERM to remaining processes ... rcS logger zcmd watch syslogd klogd hotplug2 cpu_count.sh sleep procd ubusd netifd atd netprobe p910nd one_connect_mon bw_monitor uhttpd dnsmasq dnsmasq zy1905 EmappS bwm crond watch wifi_assoc_moni watch<br />Sending KILL to remaining processes ... uhttpd<br />Switching to ramdisk...<br />Performing system upgrade...<br />Could not open mtd device: firmware<br />Can&#039;t open device for writing!<br />Upgrade completed<br />Rebooting system...</p><p>it doesn&#039;t seem to have a &#039;firmware&#039; mtd, any ideas?</p>											<p class="post-edited">(Last edited by <strong>va2thc</strong> on 27 Nov 2016, 09:54)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p344651">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">va2thc</div>
					<div class="post-datetime">
						24 Nov 2016, 06:04					</div>
				</div>
				<div class="post-content content">
					<p>Ok according to <a href="https://wiki.openwrt.org/toh/zyxel/zyxel_nbg6716">https://wiki.openwrt.org/toh/zyxel/zyxel_nbg6716</a> I should of done</p><p>root@EMG2926:/tmp# mtd -r write openwrt-15.05.1-ar71xx-nand-nbg6716-squashfs-factory.bin /dev/mtd7</p><p>It rebooted and nothing changed, so I ran the command without the reboot flag and saw no error outputs... I&#039;m so sure this is a modded NBG6716...</p><p>reading further down the NBG6716 page i saw the tftp key press method so i tried it...</p><br /><p>here with the openwrt-15.05.1-ar71xx-nand-nbg6716-squashfs-factory.bin image:</p><p>Hit any key to stop autoboot:&nbsp; 3download ras.bin to memory address 0x80000000<br />Using eth0 device<br />TFTP from server 192.168.1.33; our IP address is 192.168.1.1<br />Filename &#039;ras.bin&#039;.<br />Load address: 0x80000000<br />Loading: #################################################################<br />...cut...<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;###<br />done<br />Bytes transferred = 5767168 (580000 hex)<br />Wrong header checksum, stop to upgrade RAS image!</p><p>&nbsp; 0<br />### JFFS2 loading &#039;/boot/vmlinux.lzma.uImage&#039; to 0x80400000<br />and it booted...</p><br /><p>here with the orignal NBG6716 firmware:</p><p>Hit any key to stop autoboot:&nbsp; 3download ras.bin to memory address 0x80000000<br />Using eth0 device<br />TFTP from server 192.168.1.33; our IP address is 192.168.1.1<br />Filename &#039;ras.bin&#039;.<br />Load address: 0x80000000<br />Loading: #################################################################<br />...cut...<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;#########################################################<br />done<br />Bytes transferred = 23724032 (16a0000 hex)<br />Wrong product name(NBG6716,EMG2926), stop to upgrade RAS image!<br />&nbsp; 0<br />### JFFS2 loading &#039;/boot/vmlinux.lzma.uImage&#039; to 0x80400000<br />and it booted....</p><p>Then I hex edit the orig firmware and change the NBG6716 to EMG2926 and retry, then i got the same header CRC error as with the openwrt binary</p><p>So I ran binwalk on my modded bin and the orignial:<br />root@rooted:~# binwalk V1.00\(AAKG.9\)C0.bin ras.bin </p><p>Scan Time:&nbsp; &nbsp; &nbsp;2016-11-23 22:54:28<br />Target File:&nbsp; &nbsp;/root/V1.00(AAKG.9)C0.bin<br />MD5 Checksum:&nbsp; cbd4adae11edb52e5d05d0304b037d61<br />Signatures:&nbsp; &nbsp; 344</p><p>DECIMAL&nbsp; &nbsp; &nbsp; &nbsp;HEXADECIMAL&nbsp; &nbsp; &nbsp;DESCRIPTION<br />--------------------------------------------------------------------------------<br />131072&nbsp; &nbsp; &nbsp; &nbsp; 0x20000&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;JFFS2 filesystem, big endian<br />22675456&nbsp; &nbsp; &nbsp; 0x15A0000&nbsp; &nbsp; &nbsp; &nbsp;uImage header, header size: 64 bytes, header CRC: 0x9B5A644E, created: 2016-09-09 07:59:28, image size: 1021834 bytes, Data Address: 0x80060000, Entry Point: 0x80060000, data CRC: 0xAFF3D85C, OS: Linux, CPU: MIPS, image type: OS Kernel Image, compression type: lzma, image name: &quot;MIPS OpenWrt Linux-3.3.8&quot;<br />22675520&nbsp; &nbsp; &nbsp; 0x15A0040&nbsp; &nbsp; &nbsp; &nbsp;LZMA compressed data, properties: 0x6D, dictionary size: 8388608 bytes, uncompressed size: 3025528 bytes</p><br /><p>Scan Time:&nbsp; &nbsp; &nbsp;2016-11-23 22:54:40<br />Target File:&nbsp; &nbsp;/root/ras.bin<br />MD5 Checksum:&nbsp; 872eb69ec7c18638cc7c3d351a3ae9dc<br />Signatures:&nbsp; &nbsp; 344</p><p>DECIMAL&nbsp; &nbsp; &nbsp; &nbsp;HEXADECIMAL&nbsp; &nbsp; &nbsp;DESCRIPTION<br />--------------------------------------------------------------------------------<br />131072&nbsp; &nbsp; &nbsp; &nbsp; 0x20000&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;JFFS2 filesystem, big endian<br />22675456&nbsp; &nbsp; &nbsp; 0x15A0000&nbsp; &nbsp; &nbsp; &nbsp;uImage header, header size: 64 bytes, header CRC: 0x9B5A644E, created: 2016-09-09 07:59:28, image size: 1021834 bytes, Data Address: 0x80060000, Entry Point: 0x80060000, data CRC: 0xAFF3D85C, OS: Linux, CPU: MIPS, image type: OS Kernel Image, compression type: lzma, image name: &quot;MIPS OpenWrt Linux-3.3.8&quot;<br />22675520&nbsp; &nbsp; &nbsp; 0x15A0040&nbsp; &nbsp; &nbsp; &nbsp;LZMA compressed data, properties: 0x6D, dictionary size: 8388608 bytes, uncompressed size: 3025528 bytes</p><p>they both report &quot;0x9B5A644E&quot; as header CRC. I can find the &quot;9B5A644E&quot; hex value @ 0x015A0004 in the binaries...</p><p>lets test...<br />root@rooted:~# dd if=V1.00\(AAKG.9\)C0.bin of=header.bin bs=1 count=64 skip=22675456<br />64+0 records in<br />64+0 records out<br />64 bytes copied, 0.000269411 s, 238 kB/s</p><p>hexedit the checksum to zero&#039;s to calculate it again<br />root@rooted:~# hexeditor header.bin </p><p>check the checksum<br />root@rooted:~# crc32 header.bin <br />9b5a644e</p><p>still stuck... the NBG6716 -&gt; EMG2926 i changed in the firmware to bypass the product name error arn&#039;t in the &#039;header&#039; section... so i don&#039;t need to recalculate</p>											<p class="post-edited">(Last edited by <strong>va2thc</strong> on 24 Nov 2016, 06:31)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p344983">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">va2thc</div>
					<div class="post-datetime">
						27 Nov 2016, 09:54					</div>
				</div>
				<div class="post-content content">
					<p>Long road behind me, I can say its solved...</p><p>My ISP&#039;s custom firmware had 2 firmwares installed in mtd7 and mtd9, it was booting off mtd9.&nbsp; I tried mtd -r openwrt-15.05.1-ar71xx-nand-nbg6716-squashfs-factory.bin /dev/mtd9.&nbsp; It rebooted into openwrt but luci wasn&#039;t running, rebooted it and it never reloaded the kernel.&nbsp; After alot of looking around the solution I found was editing the original NBG6716 firmware from ZyXEL and changing model name to EMG2926 + correcting the checksum (did that by changing the version number of the firmware lol), once that was done i was able to tftp upload the modded firmware to the deivce.&nbsp; Once in the original ZyXEL firmware, logged into console and did the normal mtd -r openwrt-15.05.1-ar71xx-nand-nbg6716-squashfs-factory.bin /dev/mtd7 and we&#039;re back online 100%</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p347898">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">joceluss</div>
					<div class="post-datetime">
						28 Dec 2016, 17:30					</div>
				</div>
				<div class="post-content content">
					<p>Hi! I&#039;m trying to get rid of the ISP firmware for the EMG2926-Q10A but there is a password for root?&nbsp; Tried 1234... but it doesn&#039;t work...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p348653">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">goldyfruit</div>
					<div class="post-datetime">
						7 Jan 2017, 06:51					</div>
				</div>
				<div class="post-content content">
					<p>@va2thc, thanks for all the information !</p><p>I changed the model from NBG6716 to EMG2926 and the version from V1.00(AAKG.9)C0 to V1.01(AAKG.9)C0 but I still having the checksum error.<br /></p><div class="codebox"><pre><code>Wrong header checksum, stop to upgrade RAS image!</code></pre></div><p>What else did you change to make it works ?</p><p>Thanks !</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p350341">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">bedou974</div>
					<div class="post-datetime">
						27 Jan 2017, 03:57					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>va2thc wrote:</cite><blockquote><p>Long road behind me, I can say its solved...</p><p>My ISP&#039;s custom firmware had 2 firmwares installed in mtd7 and mtd9, it was booting off mtd9.&nbsp; I tried mtd -r openwrt-15.05.1-ar71xx-nand-nbg6716-squashfs-factory.bin /dev/mtd9.&nbsp; It rebooted into openwrt but luci wasn&#039;t running, rebooted it and it never reloaded the kernel.&nbsp; After alot of looking around the solution I found was editing the original NBG6716 firmware from ZyXEL and changing model name to EMG2926 + correcting the checksum (did that by changing the version number of the firmware lol), once that was done i was able to tftp upload the modded firmware to the deivce.&nbsp; Once in the original ZyXEL firmware, logged into console and did the normal mtd -r openwrt-15.05.1-ar71xx-nand-nbg6716-squashfs-factory.bin /dev/mtd7 and we&#039;re back online 100%</p></blockquote></div><p>hello can you detail the procedure to do so ? im not sure I have understand everything </p><p>thank you</p><p>If I understand well you change the model name in the original firmware bin file ? but where do you change the checksum ?</p>											<p class="post-edited">(Last edited by <strong>bedou974</strong> on 27 Jan 2017, 04:02)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>