<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> How do I throttle Netflix to &lt;1 Mbps (dont recommend QoS)</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 24 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p288884">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">HansomPeerClown</div>
					<div class="post-datetime">
						23 Aug 2015, 14:57					</div>
				</div>
				<div class="post-content content">
					<p>First off, I&#039;ve tried QoS... It does not help.&nbsp; <br />My brother is an internet hog who doesn&#039;t realise he utlises way more than his fair share of bandwidth.&nbsp; <br />So, in clear terms can someone tell me how to throttle Netflix traffic. Preferably to 1 Megabits, thanks.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p288892">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						23 Aug 2015, 16:23					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>HansomPeerClown wrote:</cite><blockquote><p>First off, I&#039;ve tried QoS... It does not help.&nbsp; <br />My brother is an internet hog who doesn&#039;t realise he utlises way more than his fair share of bandwidth.&nbsp; <br />So, in clear terms can someone tell me how to throttle Netflix traffic. Preferably to 1 Megabits, thanks.</p></blockquote></div><p>Hi HansomPeerClown,</p><p>from cursory looking the keyword is &quot;brother&quot;. This is not a technological issue and hence requires a non-technical solution. Talk to your brother make him change his behavior <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /> ; this is way more sustainable than going into an technological arms-race.<br />&nbsp; &nbsp; &nbsp; &nbsp;But since netflix is only going to use one flow as far as I know, why does flow-fair queueing as performed by qos-scripts or sqm-scripts not solve or severely ameliorate the problem? What is the total bandwidth you have available on your link for downstream an upstream, and how much of that bandwidth does netflix traffic consume?</p><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p288894">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">HansomPeerClown</div>
					<div class="post-datetime">
						23 Aug 2015, 16:43					</div>
				</div>
				<div class="post-content content">
					<p>Hey moeller0, I&#039;ve talked to the stubborn bastard but he does not comprehend the fact that him constantly streaming HD Netflix severely deteriorates other&#039;s trying to use the connection (4.5mbit) <br />I don&#039;t know why QoS does not work for streaming, Netflix just seems to bulldoze over it. Regardless I&#039;m not really interested in a conversation about QoS, if you have a solution to throttle Netflix then please share.<br />Cheers.</p>											<p class="post-edited">(Last edited by <strong>HansomPeerClown</strong> on 23 Aug 2015, 16:44)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p288898">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						23 Aug 2015, 17:17					</div>
				</div>
				<div class="post-content content">
					<p>Hi HansomPeerClown,</p><div class="quotebox"><cite>HansomPeerClown wrote:</cite><blockquote><p>Hey moeller0, I&#039;ve talked to the stubborn bastard but he does not comprehend the fact that him constantly streaming HD Netflix severely deteriorates other&#039;s trying to use the connection (4.5mbit) <br />I don&#039;t know why QoS does not work for streaming, Netflix just seems to bulldoze over it. Regardless I&#039;m not really interested in a conversation about QoS, if you have a solution to throttle Netflix then please share.<br />Cheers.</p></blockquote></div><p>I guess than our conversation ends here; all I am interested in is getting sqm-scripts to work &quot;as advertised&quot; under the widest range of circumstances. So figuring out why netflix does not behave is potential interesting, your preferred alternative not so much... <br />&nbsp; &nbsp; &nbsp; But as an guideline for your plan, you need to find some invariance in the traffic coming in from netflix to your brother and the use this invariance to mark those packets, then you can sort them into a specifically set up band in your traffic shaper that only allows 1 Mbps at maximum. Finding those invariances is going to be tricky and error-prone as your brother most likely is going to adapt (say you throttle his IP, he simple changes it, same foe MAC or simply uses some one else&#039;s computer). But hey, if that is how you roll, more luck to you...</p><p>Over &amp; Out<br />&nbsp; &nbsp; &nbsp; &nbsp;M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p288912">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">arokh</div>
					<div class="post-datetime">
						23 Aug 2015, 19:36					</div>
				</div>
				<div class="post-content content">
					<p>@HansomPeerClown</p><p>You ask for help, yet you exclude the only solution and reject the number one resource on QoS around here. Good luck, it seems you would rather keep your problem <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p288915">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">makarel</div>
					<div class="post-datetime">
						23 Aug 2015, 20:14					</div>
				</div>
				<div class="post-content content">
					<p>hey you could try:<br />-tell your mother/father/parents about it<br />-smash your brother pc<br />-smash your brother face<br />-cut the link to your brother pc<br />-put your brother link on a antique network device<br />-learn howto use qos<br />-go watch the shet your brothes wtching.. hess lonely.. keep him company.. (ps no company on porn)<br />-go outside.. play ball.. walk your dog..<br />-upgrade your internet link</p><p>hf <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p288925">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">audiocore</div>
					<div class="post-datetime">
						23 Aug 2015, 22:43					</div>
				</div>
				<div class="post-content content">
					<p>Yeah upgrading your internet link would be the best solution...<br />Netflix is awesome and shouldn&#039;t be throttled. Because if you do, it gets less awesome.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p288929">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						23 Aug 2015, 22:57					</div>
				</div>
				<div class="post-content content">
					<p>Hi HansomPeerClown,</p><p>I guess I should be less grumpy, so sorry. I remember that we had a two topics in which we discussed facets of your set up, but in both cases you seemed to drop out of the discussion before it reached a conclusion/solution. Obviously, it is your right to do so, but on the other hand it makes me question the validity of your initial premise: &quot;First off, I&#039;ve tried QoS... It does not help.&quot; (ironically quality-of-service or QoS is the shorthand name for the kind solution of traffic engineering you are looking for.)<br />&nbsp; &nbsp; &nbsp; &nbsp; Again, you might be right in your assessment that neither qos-scripts nor sqm-scripts actually can solve your issue, but there is just not enough data to figure out whether this could be fixed.</p><p>Best Regards<br />&nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p288969">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">HansomPeerClown</div>
					<div class="post-datetime">
						24 Aug 2015, 07:07					</div>
				</div>
				<div class="post-content content">
					<p>Don&#039;t get me wrong, SQM-QOS works at keeping latency low for gaming etc... but in my experience doesn&#039;t help share bandwidth for streaming. That&#039;s just my experience, so I&#039;d just like to know how to set a hard limit on his bandwidth because I know that should 100% fix it.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p288970">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">HansomPeerClown</div>
					<div class="post-datetime">
						24 Aug 2015, 07:09					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>arokh wrote:</cite><blockquote><p>@HansomPeerClown</p><p>You ask for help, yet you exclude the only solution and reject the number one resource on QoS around here. Good luck, it seems you would rather keep your problem <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p></blockquote></div><p>I&#039;m not lying when I say QoS isn&#039;t helping, why would I do that?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p288977">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">burphur</div>
					<div class="post-datetime">
						24 Aug 2015, 08:34					</div>
				</div>
				<div class="post-content content">
					<p>my roommate does this too, when he downloads torrents and i wanna stream, so i just ban his mac on the router until im done lol<br />hell get the message one day and actually listen to me</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p288986">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">trismo</div>
					<div class="post-datetime">
						24 Aug 2015, 10:48					</div>
				</div>
				<div class="post-content content">
					<p>Try out <a href="http://www.gargoyle-router.com">Gargoyle</a>&nbsp; with this you can more easy limit you enemy ^^</p><p>Support all devices that run under BarrierBreaker 14.07</p>											<p class="post-edited">(Last edited by <strong>trismo</strong> on 24 Aug 2015, 10:49)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p288990">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						24 Aug 2015, 11:15					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>HansomPeerClown wrote:</cite><blockquote><p>Don&#039;t get me wrong, SQM-QOS works at keeping latency low for gaming etc... but in my experience doesn&#039;t help share bandwidth for streaming. That&#039;s just my experience, so I&#039;d just like to know how to set a hard limit on his bandwidth because I know that should 100% fix it.</p></blockquote></div><p>Hi there,</p><p>luckily there is some overlap between our interest: namely figuring out how the netflix traffic actually looks. You need to know this to design the filters you ultimately need to isolate that traffic, and I am curious to learn that to figure out why netflix seems to evade/side-step fq_codel&#039;s flow isolation. I already assume that netflix traffic will be quite bursty (so dash instead of smooth streaming), but are they using tcp or udp, are the port numbers constant will packets always be served from the same IP all of this will be interesting to know. So, in case you take some packet traces and look at them, please post at least a summary to this thread. With lots of luck this might indicate why qos- and sqm-scripts fail to solve your problem. (I just want to add that your link is quite interesting as due its low bandwidth it will show problems more prominent than faster links where people might not notice).</p><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p288991">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						24 Aug 2015, 11:18					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>trismo wrote:</cite><blockquote><p>Try out <a href="http://www.gargoyle-router.com">Gargoyle</a>&nbsp; with this you can more easy limit you enemy ^^</p><p>Support all devices that run under BarrierBreaker 14.07</p></blockquote></div><p>But I take it gargoyle will only allow to throttle traffic to a specific IP? Then all his brother needs to do is change his IP, and potentially his MAC to work around persistent DHCP or host entries. Also the quest was throttling netflix traffic, not all traffic, the OP&nbsp; &nbsp;really wants a targeted approach... if I understood correctly, that is.</p><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp;M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p288995">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">trismo</div>
					<div class="post-datetime">
						24 Aug 2015, 12:44					</div>
				</div>
				<div class="post-content content">
					<p>Block all mac address and only allow ip + mac combo is possible with it.<br />Or just 2 rules example on iP get 50% others get the remaining.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p288997">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">HansomPeerClown</div>
					<div class="post-datetime">
						24 Aug 2015, 12:51					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p>luckily there is some overlap between our interest: namely figuring out how the netflix traffic actually looks. You need to know this to design the filters you ultimately need to isolate that traffic</p></blockquote></div><p>Problem is, I don&#039;t even know how to throttle any traffic in openwrt. So how would I go about that when I do figure out the traffic &#039;signature&#039;?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p288998">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						24 Aug 2015, 12:52					</div>
				</div>
				<div class="post-content content">
					<p>Hi trismo,</p><div class="quotebox"><cite>trismo wrote:</cite><blockquote><p>Block all mac address and only allow ip + mac combo is possible with it.<br />Or just 2 rules example on iP get 50% others get the remaining.</p></blockquote></div><p>Outch, true, whitelisting the IPs ans MACs will work a bit further (until his brother just clones an existing IP/MAC pair to disguise as another computer), but this is really heavy handed and will adding other machines to the network quite burdensome.<br />&nbsp; &nbsp; &nbsp; &nbsp; If I understand the OP correctly, and I well might not, what he wants is an universal netflix throttle, so no matter which computer is used netflixing will not affect other traffic.<br />&nbsp; &nbsp; &nbsp; &nbsp;If, however, you see the issue as &quot;OP wants to make a point&quot; than the block everything unknown approach will work, assuming the offensive party comes to its senses...</p><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp;M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p288999">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">trismo</div>
					<div class="post-datetime">
						24 Aug 2015, 13:01					</div>
				</div>
				<div class="post-content content">
					<p>ok thats difficult i don&#039;t know any opensource &quot;dpi&quot; filter that work with ssl netflix 100% with ip4/6 and that is needed for this right.</p><p>only way i see is to limit all Netflix streaming server ip but hard part is to get a list of it.</p>											<p class="post-edited">(Last edited by <strong>trismo</strong> on 24 Aug 2015, 13:07)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p289006">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">metai</div>
					<div class="post-datetime">
						24 Aug 2015, 14:20					</div>
				</div>
				<div class="post-content content">
					<p>IMHO, the first step would be to install iftop and, while the line is hammered, check with machine(s) and which port(s) are being used. And then formulate QoS rules based on that observation. Or am I thinking too straightforward for the problem?</p><p>BTW, it&#039;s universally quoted that Netflix uses ports 80 and 443. Which makes a lot of sense since they want to ensure their service can be used on a variety of clamped-down networks, they even must consider hotel rooms and such. Of course, rules targeting Netflix would also target regular web surfing.</p><p>Also, maybe explain to the OP that QoS -- at least in the OpenWrt incarnations -- is not about <em>throttling</em> but <em>prioritizing</em> traffic. In this case, probably prioritizing the Netflix traffic lower than the other traffic on the network.</p>											<p class="post-edited">(Last edited by <strong>metai</strong> on 24 Aug 2015, 14:27)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p289019">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">HansomPeerClown</div>
					<div class="post-datetime">
						24 Aug 2015, 15:29					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p>&nbsp; &nbsp; &nbsp; &nbsp; If I understand the OP correctly, and I well might not, what he wants is an universal netflix throttle, so no matter which computer is used netflixing will not affect other traffic.</p></blockquote></div><p>It doesn&#039;t have to be universal, I know which mac address/ip he uses for netflix. He&#039;s also not savvy enough to change mac addresses.</p><div class="quotebox"><cite>metai wrote:</cite><blockquote><p>IMHO, the first step would be to install iftop and, while the line is hammered, check with machine(s) and which port(s) are being used. And then formulate QoS rules based on that observation. Or am I thinking too straightforward for the problem?</p></blockquote></div><p>I&#039;ll try taking a peak with iftop, how would you make the QoS rule afterwards? Because that is where I&#039;m stuck.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p289021">
				<div class="post-metadata">
					<div class="post-num">Post #21</div>
					<div class="post-author">makarel</div>
					<div class="post-datetime">
						24 Aug 2015, 16:13					</div>
				</div>
				<div class="post-content content">
					<p>try tc<br /><a href="http://wiki.openwrt.org/doc/howto/packet.scheduler/packet.scheduler">http://wiki.openwrt.org/doc/howto/packe … .scheduler</a><br />strange qos dosnt work.. it should.. you can ban all traffic with it..<br />use static leases</p><br /><div class="quotebox"><cite>burphur wrote:</cite><blockquote><p>my roommate does this too, when he downloads torrents and i wanna stream, so i just ban his mac on the router until im done lol<br />hell get the message one day and actually listen to me</p></blockquote></div><p>your just the one with the triggerfinger.. you also make lots of traffic by streamming; so you deny him so you can do same shet ^^<br />the brake beying that torrent dont have to be on all time</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p289025">
				<div class="post-metadata">
					<div class="post-num">Post #22</div>
					<div class="post-author">HansomPeerClown</div>
					<div class="post-datetime">
						24 Aug 2015, 16:57					</div>
				</div>
				<div class="post-content content">
					<p>I think I may just go with a static throttle for all his traffic for now until I figure out the netflix traffic.&nbsp; <br />Would this guide work the same on OpenWrt? <a href="https://help.atmail.com/hc/en-us/articles/201566464-Throttling-Bandwidth-using-Traffic-Controller-for-Linux">https://help.atmail.com/hc/en-us/articl … -for-Linux</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p289031">
				<div class="post-metadata">
					<div class="post-num">Post #23</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						24 Aug 2015, 18:13					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>HansomPeerClown wrote:</cite><blockquote><p>I think I may just go with a static throttle for all his traffic for now until I figure out the netflix traffic.&nbsp; <br />Would this guide work the same on OpenWrt? <a href="https://help.atmail.com/hc/en-us/articles/201566464-Throttling-Bandwidth-using-Traffic-Controller-for-Linux">https://help.atmail.com/hc/en-us/articl … -for-Linux</a></p></blockquote></div><p>Well, more or less yes; I do think that only the upload would be controlled with this configuration though, ingress needs an IFB to work, BUT if you set up a shaper on ANOTHER interface than the actual wan interface effective ingress and egress revert, and you again have control over what is ingress or download from the internets to the controlled IP.<br />&nbsp; &nbsp; &nbsp; &nbsp; Then again, if have the liberty to establish the shaper on a non-WAN interface sqm and qos-scripts will easily allow you to hale his ingress and egress, if you are willing to dedicate a whole port of wifi band to your brother.<br />&nbsp; &nbsp; &nbsp; &nbsp; But I only cursory glanced over the code, and do not claim to be really proficient in tc, so the linked script might actually work as advertised and I need to learn more.</p><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p289503">
				<div class="post-metadata">
					<div class="post-num">Post #24</div>
					<div class="post-author">nmos</div>
					<div class="post-datetime">
						28 Aug 2015, 05:43					</div>
				</div>
				<div class="post-content content">
					<p>I think throttling rather than prioritizing Netflix actually makes sense.&nbsp; If I understand Netflix correctly when you first start a video it attempts to measure your connection speed and scales the video to match.&nbsp; As a result, if you use prioritization you&#039;ll sometimes get pausing/buffering as competing traffic comes and goes but if you set a fixed cap it&#039;ll just pick a resolution that works well within that limit.&nbsp; I think Youtube (at least on Android) does something similar.</p><p>Capping it also makes sense for those who are trying to keep total monthly bandwidth usage down due to a metered connection.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p289510">
				<div class="post-metadata">
					<div class="post-num">Post #25</div>
					<div class="post-author">nmos</div>
					<div class="post-datetime">
						28 Aug 2015, 08:24					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p>&nbsp; &nbsp; &nbsp; But as an guideline for your plan, you need to find some invariance in the traffic coming in from netflix to your brother and the use this invariance to mark those packets, then you can sort them into a specifically set up band in your traffic shaper that only allows 1 Mbps at maximum.</p></blockquote></div><p>I ran into something called ipset the other day.&nbsp; I haven&#039;t looked into it but acording to the dnsmasq man page it &quot;Places the resolved IP addresses of queries for the specified domains in the specified netfilter ip sets.&quot;</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>