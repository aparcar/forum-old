<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Drops during handshake: ZTE 3G with TMobile</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 31 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p356683">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">Peter67</div>
					<div class="post-datetime">
						20 Apr 2017, 18:49					</div>
				</div>
				<div class="post-content content">
					<p>Here&#039;s what I have:</p><p>OpenWRT 15.05.1 Chaos Calmer r48532 ar71xx/generic</p><p>/etc/config/network snippet for 3g:</p><p>config interface &#039;wan&#039;<br />&nbsp; &nbsp;option proto &#039;3g&#039;<br />&nbsp; &nbsp;option service &#039;umts&#039;<br />&nbsp; &nbsp;option apn &#039;fast.tmobile.com&#039;<br />&nbsp; &nbsp;option device &#039;/dev/ttyUSB1&#039;<br />&nbsp; &nbsp;option pppd_options &#039;debug noipv6 user &quot;&quot; password &quot;&quot; &#039;</p><p>Here&#039;s the logread of wan trying to come up:</p><p>Thu Apr 20 15:35:37 2017 daemon.notice netifd: Interface &#039;wan&#039; is setting up now<br />Thu Apr 20 15:35:39 2017 daemon.notice pppd[3369]: pppd 2.4.7 started by root, uid 0<br />Thu Apr 20 15:35:40 2017 local2.info chat[3371]: abort on (BUSY)<br />Thu Apr 20 15:35:40 2017 local2.info chat[3371]: abort on (NO CARRIER)<br />Thu Apr 20 15:35:40 2017 local2.info chat[3371]: abort on (ERROR)<br />Thu Apr 20 15:35:40 2017 local2.info chat[3371]: report (CONNECT)<br />Thu Apr 20 15:35:40 2017 local2.info chat[3371]: timeout set to 10 seconds<br />Thu Apr 20 15:35:40 2017 local2.info chat[3371]: send (AT&amp;F^M)<br />Thu Apr 20 15:35:40 2017 local2.info chat[3371]: expect (OK)<br />Thu Apr 20 15:35:40 2017 local2.info chat[3371]: AT&amp;F^M^M<br />Thu Apr 20 15:35:40 2017 local2.info chat[3371]: OK<br />Thu Apr 20 15:35:40 2017 local2.info chat[3371]:&nbsp; -- got it<br />Thu Apr 20 15:35:40 2017 local2.info chat[3371]: send (ATE1^M)<br />Thu Apr 20 15:35:40 2017 local2.info chat[3371]: expect (OK)<br />Thu Apr 20 15:35:40 2017 local2.info chat[3371]: ^M<br />Thu Apr 20 15:35:40 2017 local2.info chat[3371]: ATE1^M^M<br />Thu Apr 20 15:35:40 2017 local2.info chat[3371]: OK<br />Thu Apr 20 15:35:40 2017 local2.info chat[3371]:&nbsp; -- got it<br />Thu Apr 20 15:35:40 2017 local2.info chat[3371]: send (AT+CGDCONT=1,&quot;IP&quot;,&quot;fast.tmobile.com&quot;^M)<br />Thu Apr 20 15:35:40 2017 local2.info chat[3371]: timeout set to 30 seconds<br />Thu Apr 20 15:35:40 2017 local2.info chat[3371]: expect (OK)<br />Thu Apr 20 15:35:40 2017 local2.info chat[3371]: ^M<br />Thu Apr 20 15:35:40 2017 local2.info chat[3371]: AT+CGDCONT=1,&quot;IP&quot;,&quot;fast.tmobile.com&quot;^M^M<br />Thu Apr 20 15:35:40 2017 local2.info chat[3371]: OK<br />Thu Apr 20 15:35:40 2017 local2.info chat[3371]:&nbsp; -- got it<br />Thu Apr 20 15:35:40 2017 local2.info chat[3371]: send (ATD*99***1#^M)<br />Thu Apr 20 15:35:40 2017 local2.info chat[3371]: expect (CONNECT)<br />Thu Apr 20 15:35:40 2017 local2.info chat[3371]: ^M<br />Thu Apr 20 15:35:40 2017 local2.info chat[3371]: ATD*99***1#^M^M<br />Thu Apr 20 15:35:40 2017 local2.info chat[3371]: CONNECT<br />Thu Apr 20 15:35:40 2017 local2.info chat[3371]:&nbsp; -- got it<br />Thu Apr 20 15:35:40 2017 local2.info chat[3371]: send ( ^M)<br />Thu Apr 20 15:35:40 2017 daemon.debug pppd[3369]: Script USE_APN=fast.tmobile.com DIALNUMBER=*99***1# /usr/sbin/chat -t5 -v -E -f /etc/chatscripts/3g.chat finished (pid 3370), status = 0x0<br />Thu Apr 20 15:35:40 2017 daemon.info pppd[3369]: Serial connection established.<br />Thu Apr 20 15:35:40 2017 daemon.debug pppd[3369]: using channel 32<br />Thu Apr 20 15:35:40 2017 daemon.info pppd[3369]: Using interface 3g-wan<br />Thu Apr 20 15:35:40 2017 daemon.notice pppd[3369]: Connect: 3g-wan &lt;--&gt; /dev/ttyUSB1<br />Thu Apr 20 15:35:40 2017 kern.info kernel: [&nbsp; 695.020000] 3g-wan: renamed from ppp0<br />Thu Apr 20 15:35:41 2017 daemon.debug pppd[3369]: sent [LCP ConfReq id=0x1 &lt;asyncmap 0x0&gt; &lt;magic 0xe3eb9571&gt;]<br />Thu Apr 20 15:35:41 2017 daemon.debug pppd[3369]: rcvd [LCP ConfReq id=0x5d &lt;asyncmap 0x0&gt; &lt;auth chap MD5&gt; &lt;magic 0x4560ec42&gt; &lt;pcomp&gt; &lt;accomp&gt;]<br />Thu Apr 20 15:35:41 2017 daemon.debug pppd[3369]: sent [LCP ConfRej id=0x5d &lt;pcomp&gt; &lt;accomp&gt;]<br />Thu Apr 20 15:35:41 2017 daemon.debug pppd[3369]: rcvd [LCP ConfAck id=0x1 &lt;asyncmap 0x0&gt; &lt;magic 0xe3eb9571&gt;]<br />Thu Apr 20 15:35:41 2017 daemon.debug pppd[3369]: rcvd [LCP ConfReq id=0x5e &lt;asyncmap 0x0&gt; &lt;auth chap MD5&gt; &lt;magic 0x4560ec42&gt;]<br />Thu Apr 20 15:35:41 2017 daemon.debug pppd[3369]: sent [LCP ConfAck id=0x5e &lt;asyncmap 0x0&gt; &lt;auth chap MD5&gt; &lt;magic 0x4560ec42&gt;]<br />Thu Apr 20 15:35:41 2017 daemon.debug pppd[3369]: sent [LCP EchoReq id=0x0 magic=0xe3eb9571]<br />Thu Apr 20 15:35:41 2017 daemon.debug pppd[3369]: rcvd [LCP DiscReq id=0x5f magic=0x4560ec42]<br />Thu Apr 20 15:35:41 2017 daemon.debug pppd[3369]: rcvd [CHAP Challenge id=0x1 &lt;12a423641acde85f2697f1ac7e98fa28&gt;, name = &quot;UMTS_CHAP_SRVR&quot;]<br />Thu Apr 20 15:35:41 2017 daemon.debug pppd[3369]: sent [CHAP Response id=0x1 &lt;b27d86d4c00b21bb09571f7f464abea6&gt;, name = &quot;\&quot;\&quot;&quot;]<br />Thu Apr 20 15:35:41 2017 daemon.debug pppd[3369]: rcvd [LCP EchoRep id=0x0 magic=0x4560ec42 e3 eb 95 71]<br />Thu Apr 20 15:35:41 2017 daemon.debug pppd[3369]: rcvd [CHAP Success id=0x1 &quot;&quot;]<br />Thu Apr 20 15:35:41 2017 daemon.info pppd[3369]: CHAP authentication succeeded<br />Thu Apr 20 15:35:41 2017 daemon.notice pppd[3369]: CHAP authentication succeeded<br />Thu Apr 20 15:35:41 2017 daemon.debug pppd[3369]: sent [IPCP ConfReq id=0x1 &lt;addr 0.0.0.0&gt; &lt;ms-dns1 0.0.0.0&gt; &lt;ms-dns2 0.0.0.0&gt;]<br />Thu Apr 20 15:35:42 2017 daemon.debug pppd[3369]: sent [LCP EchoReq id=0x1 magic=0xe3eb9571]<br />Thu Apr 20 15:35:43 2017 daemon.debug pppd[3369]: sent [LCP EchoReq id=0x2 magic=0xe3eb9571]<br />Thu Apr 20 15:35:44 2017 daemon.debug pppd[3369]: sent [LCP EchoReq id=0x3 magic=0xe3eb9571]<br />Thu Apr 20 15:35:44 2017 daemon.debug pppd[3369]: sent [IPCP ConfReq id=0x1 &lt;addr 0.0.0.0&gt; &lt;ms-dns1 0.0.0.0&gt; &lt;ms-dns2 0.0.0.0&gt;]<br />Thu Apr 20 15:35:45 2017 daemon.debug pppd[3369]: sent [LCP EchoReq id=0x4 magic=0xe3eb9571]<br />Thu Apr 20 15:35:46 2017 daemon.info pppd[3313]: No response to 5 echo-requests<br />Thu Apr 20 15:35:46 2017 daemon.notice pppd[3313]: Serial link appears to be disconnected.<br />Thu Apr 20 15:35:46 2017 daemon.debug pppd[3313]: sent [LCP TermReq id=0x2 &quot;Peer not responding&quot;]<br />Thu Apr 20 15:35:49 2017 daemon.debug pppd[3313]: sent [LCP TermReq id=0x3 &quot;Peer not responding&quot;]<br />Thu Apr 20 15:35:49 2017 daemon.notice pppd[3313]: Connection terminated.<br />Thu Apr 20 15:35:50 2017 daemon.notice pppd[3313]: Modem hangup<br />Thu Apr 20 15:35:50 2017 daemon.info pppd[3313]: Exit.<br />Thu Apr 20 15:35:50 2017 daemon.notice netifd: Interface &#039;wan&#039; is now down</p><br /><p>----------</p><p>----<br />EDIT: <br />(if it helps):&nbsp; gcom returns:<br />ZTE WELINK<br />Model ZM8620<br />IMEI looks correct, and when I printf the port with AT+ZGETICCID I do see the correct SIM number.<br />----</p><br /><p>I get Auth, I get back and forth Sent/Rcvd right up to the point of trying to get an IP, then I never get any packets back again.</p><p>I&#039;ve tried changing pppd_options to not do user/password (then I get &quot;Unable to Auth&quot;), and I&#039;ve tried &quot;noipdefault&quot; and removing the &quot;noipv6&quot; and it always dies in the same place.&nbsp; The SIM works in my tablet with data, so I don&#039;t think it&#039;s a bad SIM with TMobile.&nbsp; </p><p>Any ideas of what to try?&nbsp; TIA</p>											<p class="post-edited">(Last edited by <strong>Peter67</strong> on 20 Apr 2017, 18:56)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>