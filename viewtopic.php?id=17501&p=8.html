<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> RB450 - using Five Ethernet Ports</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 6 Feb 2018 and 6 May 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 8 of 9</div><nav><ul><li><a href="viewtopic.php%3Fid=17501&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=17501&amp;p=6.html">6</a></li><li><a href="viewtopic.php%3Fid=17501&amp;p=7.html">7</a></li><li class="pagination-current"><span>8</span></li><li><a href="viewtopic.php%3Fid=17501&amp;p=9.html">9</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p108035">
				<div class="post-metadata">
					<div class="post-num">Post #176</div>
					<div class="post-author">ceraldi</div>
					<div class="post-datetime">
						27 Apr 2010, 22:55					</div>
				</div>
				<div class="post-content content">
					<p>I didn&#039;t test the multi port config too thoroughly because our setup did not require separated Ethernet ports on the &quot;lan&quot; side but here is one config that I was playing with.</p><div class="codebox"><pre><code>config interface loopback
        option ifname   lo
        option proto    static
        option ipaddr   127.0.0.1
        option netmask  255.0.0.0

config interface lan 
        option ifname   &quot;eth1&quot;
        option proto    dhcp

config switch_vlan
        option device   eth1
        option vlan 1
        option ports &quot;0 1 2 3 4 5t&quot;

config interface wan
        option ifname &quot;eth0&quot;
        option proto static
        option ipaddr 192.168.1.1
        option netmask 255.255.255.0</code></pre></div><div class="quotebox"><cite>lorenzo.allegrucci wrote:</cite><blockquote><div class="quotebox"><cite>ceraldi wrote:</cite><blockquote><div class="quotebox"><cite>UrsusArctos wrote:</cite><blockquote><p>I have already extended the ip175c driver by Patrick Horn to handle the IP175D as well. I hope it will get merged to OpenWRT soon, as soon as it gets some testing other than on my RB450. If you are interested, feel free to ask me for a patch by e-mail to mj@ucw.cz.</p></blockquote></div><p>Got this patch and just wanted to say THANKS! it works perfectly with the ip175d chip and also seams to work great on a ip178c please include this patch in the trunk or backfire releases.</p><p>-A</p></blockquote></div><p>Hi, I can&#039;t find a way to configure my RB450 with separate ports</p><div class="codebox"><pre><code>dmesg:
IP17xx: Found IP175D at ag71xx-mdio:00
ag71xx_mdio: probed
eth0: Atheros AG71xx at 0xba000000, irq 5
eth0: connected to PHY at ag71xx-mdio:04 [uid=02430d80, driver=Generic PHY]
eth1: Atheros AG71xx at 0xb9000000, irq 4
eth1: connected to PHY at ag71xx-mdio:00 [uid=02430d80, driver=IC+ IP17xx]

root@OpenWrt:~# swconfig dev eth1 show
Global attributes:
        enable_vlan: 1
        name: IP175D
        phy: 0
        reg: 0
        val: 12544
Port 0:
        status: up, 100 Mbps, full duplex, auto-negotiate
        link: 100
        tagged: 0
        pvid: 5
Port 1:
        status: down, auto-negotiate (in progress)
        link: 0
        tagged: 0
        pvid: 4
Port 2:
        status: down, auto-negotiate (in progress)
        link: 0
        tagged: 0
        pvid: 3
Port 3:
        status: down, auto-negotiate (in progress)
        link: 0
        tagged: 0
        pvid: 2
Port 4:
        status: down, auto-negotiate (in progress)
        link: 0
        tagged: 0
        pvid: 0
Port 5:
        status: up, 100 Mbps, cpu port
        link: 100
        tagged: 0
        pvid: 5
VLAN 0:
        tag: 1
        ports:
VLAN 1:
        tag: 2
        ports:
VLAN 2:
        tag: 3
        ports: 3 5
VLAN 3:
        tag: 4
        ports: 2 5
VLAN 4:
        tag: 5
        ports: 1 5
VLAN 5:
        tag: 6
        ports: 0 5
VLAN 6:
        tag: 7
        ports:
VLAN 7:
        tag: 8
        ports:
VLAN 8:
        tag: 9
        ports:
VLAN 9:
        tag: 10
        ports:
VLAN 10:
        tag: 11
        ports:
VLAN 11:
        tag: 12
        ports:
VLAN 12:
        tag: 13
        ports:
VLAN 13:
        tag: 14
        ports:
VLAN 14:
        tag: 15
        ports:
VLAN 15:
        tag: 16
        ports:

root@OpenWrt:~# ifconfig
eth0      Link encap:Ethernet  HWaddr 00:0C:42:5B:87:DD
          inet addr:192.168.250.250  Bcast:192.168.250.255  Mask:255.255.255.0
          inet6 addr: fe80::20c:42ff:fe5b:87dd/64 Scope:Link
          UP BROADCAST MULTICAST  MTU:1500  Metric:1
          RX packets:15 errors:0 dropped:0 overruns:0 frame:0
          TX packets:6 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:3156 (3.0 KiB)  TX bytes:468 (468.0 B)
          Interrupt:5

eth1      Link encap:Ethernet  HWaddr 00:0C:42:5B:87:DE
          inet addr:192.168.1.254  Bcast:192.168.1.255  Mask:255.255.255.0
          inet6 addr: fe80::20c:42ff:fe5b:87de/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:30 errors:0 dropped:0 overruns:0 frame:0
          TX packets:42 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:4264 (4.1 KiB)  TX bytes:3036 (2.9 KiB)
          Interrupt:4

eth1.2    Link encap:Ethernet  HWaddr 00:0C:42:5B:87:DE
          inet addr:192.168.2.254  Bcast:192.168.2.255  Mask:255.255.255.0
          inet6 addr: fe80::20c:42ff:fe5b:87de/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:5 errors:0 dropped:1 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:0 (0.0 B)  TX bytes:398 (398.0 B)

eth1.3    Link encap:Ethernet  HWaddr 00:0C:42:5B:87:DE
          inet addr:192.168.3.254  Bcast:192.168.3.255  Mask:255.255.255.0
          inet6 addr: fe80::20c:42ff:fe5b:87de/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:6 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:0 (0.0 B)  TX bytes:492 (492.0 B)

eth1.4    Link encap:Ethernet  HWaddr 00:0C:42:5B:87:DE
          inet addr:192.168.4.254  Bcast:192.168.4.255  Mask:255.255.255.0
          inet6 addr: fe80::20c:42ff:fe5b:87de/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:6 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:0 (0.0 B)  TX bytes:492 (492.0 B)

eth1.5    Link encap:Ethernet  HWaddr 00:0C:42:5B:87:DE
          inet addr:192.168.5.254  Bcast:192.168.5.255  Mask:255.255.255.0
          inet6 addr: fe80::20c:42ff:fe5b:87de/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:15 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:0 (0.0 B)  TX bytes:906 (906.0 B)

lo        Link encap:Local Loopback
          inet addr:127.0.0.1  Mask:255.0.0.0
          inet6 addr: ::1/128 Scope:Host
          UP LOOPBACK RUNNING  MTU:16436  Metric:1
          RX packets:9 errors:0 dropped:0 overruns:0 frame:0
          TX packets:9 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:1008 (1008.0 B)  TX bytes:1008 (1008.0 B)


root@OpenWrt:~# cat /etc/config/network
config interface loopback
        option ifname   lo
        option proto    static
        option ipaddr   127.0.0.1
        option netmask  255.0.0.0

config interface wan
        option ifname   eth0
        option proto    static
        option ipaddr   192.168.250.250
        option netmask  255.255.255.0

config interface port3
        option ifname   &quot;eth1.2&quot;
        option proto    static
        option ipaddr   192.168.2.254
        option netmask  255.255.255.0

config interface port2
        option ifname   &quot;eth1.3&quot;
        option proto    static
        option ipaddr   192.168.3.254
        option netmask  255.255.255.0

config interface port1
        option ifname   &quot;eth1.4&quot;
        option proto    static
        option ipaddr   192.168.4.254
        option netmask  255.255.255.0

config interface port0
        option ifname   &quot;eth1.5&quot;
        option proto    static
        option ipaddr   192.168.5.254
        option netmask  255.255.255.0

config switch eth1
        option name     eth1
        option reset    1
        option enable_vlan 1

config switch_vlan
        option device   eth1
        option vlan     2
        option ports    &quot;5 3&quot;

config switch_vlan
        option device   eth1
        option vlan     3
        option ports    &quot;5 2&quot;

config switch_vlan
        option device   eth1
        option vlan     4
        option ports    &quot;5 1&quot;

config switch_vlan
        option device   eth1
        option vlan     5
        option ports    &quot;5 0&quot;</code></pre></div><p>I can&#039;t ping any eth1.X, just eth1 and eth0 </p><p>Am I missing something?</p><p>ceraldi, can you please port your configuration?<br />Thank you.</p></blockquote></div>											<p class="post-edited">(Last edited by <strong>ceraldi</strong> on 27 Apr 2010, 22:56)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p108598">
				<div class="post-metadata">
					<div class="post-num">Post #177</div>
					<div class="post-author">MPG</div>
					<div class="post-datetime">
						5 May 2010, 19:04					</div>
				</div>
				<div class="post-content content">
					<p>Where is the patches to IP175D ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p108621">
				<div class="post-metadata">
					<div class="post-num">Post #178</div>
					<div class="post-author">natiku</div>
					<div class="post-datetime">
						5 May 2010, 22:07					</div>
				</div>
				<div class="post-content content">
					<p>There is too much information for now, so I create a RB450G page to hold all information on one place (There was an empty link on ) so RB450G users can more easily help us:</p><p><a href="http://wiki.openwrt.org/toh/mikrotik/rb450g">http://wiki.openwrt.org/toh/mikrotik/rb450g</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p108718">
				<div class="post-metadata">
					<div class="post-num">Post #179</div>
					<div class="post-author">phorn</div>
					<div class="post-datetime">
						7 May 2010, 11:19					</div>
				</div>
				<div class="post-content content">
					<p>Hi,<br />I&#039;ve updated UrsusArctos&#039;s patches to the latest trunk revision and posted them here: <a href="http://inst.eecs.berkeley.edu/~pathorn/ip175c/">http://inst.eecs.berkeley.edu/~pathorn/ip175c/</a></p><p>Please test it out if you have any IC+ switch (to make sure it didn&#039;t break old ones) or if you have a 175D to check test out the new code.</p><p>Beware: These changes are completely untested! There&#039;s a chance that they may disable the switch, requiring you reflash to an older revision, so be prepared with a backup firmware in case that happens and let me know. I did kind of a rush job on rebasing them to the latest revision, so they possibly may not even compile. I&#039;ll try to get around to compiling it this weekend, but I can&#039;t test it myself for another week or so.</p><p>Also, the &quot;Avoid auto negotiation&quot; change should hopefully fix the link autonegotiation bug some people had.</p>											<p class="post-edited">(Last edited by <strong>phorn</strong> on 7 May 2010, 11:22)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p108756">
				<div class="post-metadata">
					<div class="post-num">Post #180</div>
					<div class="post-author">pulsetang</div>
					<div class="post-datetime">
						8 May 2010, 11:01					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>phorn wrote:</cite><blockquote><p>Hi,<br />I&#039;ve updated UrsusArctos&#039;s patches to the latest trunk revision and posted them here: <a href="http://inst.eecs.berkeley.edu/~pathorn/ip175c/">http://inst.eecs.berkeley.edu/~pathorn/ip175c/</a></p><p>Please test it out if you have any IC+ switch (to make sure it didn&#039;t break old ones) or if you have a 175D to check test out the new code.</p><p>Beware: These changes are completely untested! There&#039;s a chance that they may disable the switch, requiring you reflash to an older revision, so be prepared with a backup firmware in case that happens and let me know. I did kind of a rush job on rebasing them to the latest revision, so they possibly may not even compile. I&#039;ll try to get around to compiling it this weekend, but I can&#039;t test it myself for another week or so.</p><p>Also, the &quot;Avoid auto negotiation&quot; change should hopefully fix the link autonegotiation bug some people had.</p></blockquote></div><p>Thank you very much!<br />I read this mail(RB450 - using Five Ethernet Ports) all most one weeks for find the way to drive ic+ switch,but yesterday i found i am in the wrong way,because my rb450 use a 175D chip.<br />Fortunately,you update new patch for ip175d.<br />hope i can drive it these days.<br />I will post my result the fist time.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p108776">
				<div class="post-metadata">
					<div class="post-num">Post #181</div>
					<div class="post-author">pulsetang</div>
					<div class="post-datetime">
						8 May 2010, 22:49					</div>
				</div>
				<div class="post-content content">
					<p>Hi phorn,<br />Maybe i found a little wrong in your patch<br />[670-phy_ip175c.patch]<br />++obj-$(CONFIG_IP175C_PHY)&nbsp; &nbsp; += ip17xx.o&nbsp; &nbsp;i think it need instead of this(++obj-$(CONFIG_IP17XX_PHY)&nbsp; &nbsp; += ip17xx.o)<br />[ip17xx.c]<br />int __init ip175c_init(void)------------&gt;ip17xx<br />void __exit ip175c_exit(void)-------------&gt;ip17xx</p>											<p class="post-edited">(Last edited by <strong>pulsetang</strong> on 8 May 2010, 23:27)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p108791">
				<div class="post-metadata">
					<div class="post-num">Post #182</div>
					<div class="post-author">pulsetang</div>
					<div class="post-datetime">
						9 May 2010, 07:57					</div>
				</div>
				<div class="post-content content">
					<p>do i need to patch #5193?<br />now i just patch ip175d patch in 10.03,but i can&#039;t drive any eth</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p108796">
				<div class="post-metadata">
					<div class="post-num">Post #183</div>
					<div class="post-author">pulsetang</div>
					<div class="post-datetime">
						9 May 2010, 08:49					</div>
				</div>
				<div class="post-content content">
					<div class="codebox"><pre><code>IP17xx: Found IP175D at ag71xx-mdio:00
ag71xx_mdio: probed
eth0: Atheros AG71xx at 0xba000000, irq 5
eth0: connected to PHY at ag71xx-mdio:04 [uid=02430d80, driver=Generic PHY]
eth1: Atheros AG71xx at 0xb9000000, irq 4
eth1: using fixed link parameters</code></pre></div><p>i think i can patch ip175d successful,but i can&#039;t use eth1 as before.<br />i am only use up175d patch and backfire 10.03 only,haven&#039;t use any patch as switch.<br />i only want to use it like lan+wan?who can help me.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p108889">
				<div class="post-metadata">
					<div class="post-num">Post #184</div>
					<div class="post-author">pulsetang</div>
					<div class="post-datetime">
						11 May 2010, 07:01					</div>
				</div>
				<div class="post-content content">
					<p>thanks ceraldi,he give me the 175d path old than <a href="http://inst.eecs.berkeley.edu/~pathorn/ip175c/ip175d-2010-05-06.zip">http://inst.eecs.berkeley.edu/~pathorn/ … -05-06.zip</a><br />ip175d-2010-05-06.zip,this patch have something bug,when i intead of ip175xx that ceraldi give me,it&#039;s ok!!<br />i can ping anying five port,no vlan,no switch config.just wlan and lan,it&#039;s my wanted.<br />everyone who want to drive 175d,can ask me or ceraldi.<br />pulsetang@gmail.com</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p109785">
				<div class="post-metadata">
					<div class="post-num">Post #185</div>
					<div class="post-author">duvi</div>
					<div class="post-datetime">
						24 May 2010, 22:32					</div>
				</div>
				<div class="post-content content">
					<p>I have no luck on a RB433UAH.<br />I applied the patches one by one, taken care of the things written in #181, and added CONFIG_IP17XX_PHY=y to target/linux/ar71xx/config-2.6.32<br />Everything is compiled, but what I see in dmesg is:<br /></p><div class="codebox"><pre><code>ag71xx_mdio: probed
eth0: Atheros AG71xx at 0xba000000, irq 5
eth0: connected to PHY at ag71xx-mdio:04 [uid=02430d80, driver=ICPlus IP175C]
eth1: Atheros AG71xx at 0xb9000000, irq 4
eth1: using fixed link parameters</code></pre></div><p>And of course:<br /></p><div class="codebox"><pre><code>root@OpenWrt:/# swconfig dev eth0 show
Failed to connect to the switch
root@OpenWrt:/# swconfig dev eth1 show
Failed to connect to the switch</code></pre></div><p>What am I doing wrong?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p109994">
				<div class="post-metadata">
					<div class="post-num">Post #186</div>
					<div class="post-author">BitBrusher</div>
					<div class="post-datetime">
						27 May 2010, 22:33					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>duvi wrote:</cite><blockquote><p>I have no luck on a RB433UAH.<br />I applied the patches one by one, taken care of the things written in #181, and added CONFIG_IP17XX_PHY=y to target/linux/ar71xx/config-2.6.32<br />Everything is compiled, but what I see in dmesg is:<br /></p><div class="codebox"><pre><code>ag71xx_mdio: probed
eth0: Atheros AG71xx at 0xba000000, irq 5
eth0: connected to PHY at ag71xx-mdio:04 [uid=02430d80, driver=ICPlus IP175C]
eth1: Atheros AG71xx at 0xb9000000, irq 4
eth1: using fixed link parameters</code></pre></div><p>And of course:<br /></p><div class="codebox"><pre><code>root@OpenWrt:/# swconfig dev eth0 show
Failed to connect to the switch
root@OpenWrt:/# swconfig dev eth1 show
Failed to connect to the switch</code></pre></div><p>What am I doing wrong?</p></blockquote></div><p>I tampered with swlib.c to activate DEBUG and got this:<br />root@OpenWrt:/# swconfig dev eth1 show<br />swlib_priv_init(537): swlib_priv_init called.<br />swlib_connect(630): swlib_connect - after priv_init.<br />swlib_call(89): 1.<br />swlib_call(96): 2. data=(nil)&nbsp; &nbsp;arg.head=(nil)<br />swlib_call(106): 3.<br />swlib_call(113): 4.<br />swlib_call(119): 5. call=0x40242c&nbsp; data=(nil)&nbsp; arg.head=(nil) <br />swlib_call(131): 5.5. data=(nil)&nbsp; arg.head=(nil)&nbsp; &nbsp;finished=0<br />swlib_call(136): 6. data=(nil)&nbsp; arg.head=(nil), finished=1<br />swlib_call(140): 7. err=0<br />Failed to connect to the switch</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p110258">
				<div class="post-metadata">
					<div class="post-num">Post #187</div>
					<div class="post-author">phorn</div>
					<div class="post-datetime">
						31 May 2010, 13:33					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>If you&#039;re seeing &quot;ICPlus IP175C&quot;, that means you&#039;re on the old ip175c.c kernel module, which doesn&#039;t support IP175D. So I would make sure your patches actually got applied. You&#039;re supposed to see [IC+ IP17xx] In the phy name</p><p>I realized that there was a bug with the makefile that caused the ip17xx.c never to get built. I uploaded a fixed zip file here:<br /><a href="http://www-inst.eecs.berkeley.edu/~pathorn/ip175c/ip175d-latest.zip">http://www-inst.eecs.berkeley.edu/~path … latest.zip</a></p><p>If you want to test from scratch, using<br /></p><div class="codebox"><pre><code>git checkout 4267c24c</code></pre></div><p>Then, I applied them with:<br /></p><div class="codebox"><pre><code>for x in 00*.patch; do git am $x; done</code></pre></div><p>If you&#039;re using svn, make sure you&#039;re on revision 21390 or later (the patches apply cleanly to trunk at 21642). These patches may work on a later revision, but just to make sure, try this revision. Also, make sure the ip17xx.c file exists in target/linux/generic-2.6/files/drivers/net/phy</p><p>And finally, I don&#039;t think the patch adds CONFIG_IP17XX=y to the ar71xx architecture, so you might need to add that for the kernel version you&#039;re using (I believe the default in this revision is 2.6.32)</p><p>Let me know if you still have problems, and please paste the relevant parts of dmesg--maybe look for mentions of IP17xx or IP175D.</p><p>Unfortunately, while it builds for me, I still don&#039;t have any hardware to test with, so you&#039;re on your own.</p><p>Also, note that the final packages now build in bin/atheros or bin/ar71xx, *NOT* directly inside bin. There were some stale files I had in bin from several months ago, and they threw me off. Make sure to check the modification date of the files you just built, and you can run:</p><p>It also compiles an uncompressed version of the kernel, so you can do:<br /></p><div class="codebox"><pre><code>strings &quot;openwrt-atheros-vmlinux.elf&quot; | grep IP175D</code></pre></div><p>to make sure it supports it and has the module compiled in.</p>											<p class="post-edited">(Last edited by <strong>phorn</strong> on 31 May 2010, 13:44)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p110270">
				<div class="post-metadata">
					<div class="post-num">Post #188</div>
					<div class="post-author">BitBrusher</div>
					<div class="post-datetime">
						31 May 2010, 16:33					</div>
				</div>
				<div class="post-content content">
					<p>Here we go:</p><p>trunk$ strings &quot;bin/ar71xx/openwrt-ar71xx-nand-vmlinux.elf&quot; | grep IP175D<br />VLAN tag (0-4095) [IP175D only]<br />IP175D</p><p>also got:</p><p>trunk$ strings &quot;bin/ar71xx/openwrt-ar71xx-nand-vmlinux.elf&quot; | grep 17xx<br />&lt;4&gt;IP17xx: Unable to get MII register %d,%d: error %d<br />&lt;4&gt;IP17xx: Unable to write MII register %d,%d: error %d<br />&lt;6&gt;IP17xx: Identified oui=%06x model=%02x rev=%X<br />&lt;6&gt;IP17xx: Chip ID register reads %04x<br />&lt;4&gt;IP17xx: Found an unknown IC+ switch with model number %02x, revision %X.<br />&lt;6&gt;IP17xx: Found %s at %s<br />IC+ IP17xx</p><p>(note the I use ar71xx-nand kernel)</p><p>from dmesg:<br />...<br />Atheros AR71xx SPI Controller driver version 0.2.4<br />IP17xx: Identified oui=0090c3 model=18 rev=0<br />IP17xx: Chip ID register reads 175d<br />IP17xx: Found IP175D at ag71xx-mdio:00<br />ag71xx_mdio: probed<br />eth0: Atheros AG71xx at 0xba000000, irq 5<br />eth0: connected to PHY at ag71xx-mdio:04 [uid=02430d80, driver=ICPlus IP175C]<br />eth1: Atheros AG71xx at 0xb9000000, irq 4<br />eth1: using fixed link parameters<br />...</p><p>As you can see &quot;ICPlus IP175C&quot; is still there. How can this be possible if driver says it found a 175D&nbsp; just above?<br />What should I read if the things were right??</p><p>I just don´t know were it came from. I forced &quot;state-&gt;regs = &amp;IP175D&quot; instead IP175C in ip17xx.c just to see what happen. And nothing new happened :-(</p><p>eth1 has no message connecting it to a PHY. Instead it say it is &quot;using fixed link parameters&quot;</p><p>BTW, hardware is RB450 (not RB450G).</p><p>Anything else I can send you?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p110274">
				<div class="post-metadata">
					<div class="post-num">Post #189</div>
					<div class="post-author">leonardogyn</div>
					<div class="post-datetime">
						31 May 2010, 16:58					</div>
				</div>
				<div class="post-content content">
					<p>there are 2 versions of RB450 .... one shipped with IP175C and other with IP175D.</p><p>what is your version ??? Easy way .... just check how much RAM does the unit have. If you have 32Mb, its a IP175C one. If you have 64Mb, you have a IP175D one.</p><div class="codebox"><pre><code>root@anapolis:~# free
             total       used       free     shared    buffers     cached
Mem:         29880      27792       2088          0          0       8660</code></pre></div><div class="codebox"><pre><code>root@saneago-obra718:~# free
             total       used       free     shared    buffers     cached
Mem:         62124      26208      35916          0          0      11888</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p110280">
				<div class="post-metadata">
					<div class="post-num">Post #190</div>
					<div class="post-author">BitBrusher</div>
					<div class="post-datetime">
						31 May 2010, 18:48					</div>
				</div>
				<div class="post-content content">
					<p>Ok this may make sense to the experts. <br />I undefined CONFIG_ICPLUS_PHY <br />(I read somewhere it conflicts with IP175C_PHY. IS THAT CORRECT?))&nbsp; </p><p>Now I get:</p><p>IP17xx: Identified oui=0090c3 model=18 rev=0<br />IP17xx: Chip ID register reads 175d<br />IP17xx: Found an IC+ switch model 18, revision 0, driver IP175D.<br />IP17xx: Found IP175D at ag71xx-mdio:00<br />ag71xx_mdio: probed<br />eth0: Atheros AG71xx at 0xba000000, irq 5<br />eth0: connected to PHY at ag71xx-mdio:04 [uid=02430d80, driver=Generic PHY]<br />eth1: Atheros AG71xx at 0xb9000000, irq 4<br />eth1: using fixed link parameters</p><p>Generic PHY??? Why not &quot;IC+ IP17xx&quot;??</p><p>I remember some problem about linking order. <br />ip17xx.o must be linked before what object??</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p110295">
				<div class="post-metadata">
					<div class="post-num">Post #191</div>
					<div class="post-author">phorn</div>
					<div class="post-datetime">
						31 May 2010, 22:55					</div>
				</div>
				<div class="post-content content">
					<p>Yes, that&#039;s correct. CONFIG_ICPLUS_PHY should be disabled. All of the switches actually have the same oui id, so it&#039;s kind of random which one the kernel will pick if it has both.</p><p>The reason you see Generic PHY is you have two ethernet ports: eth0 is just a single port (&quot;mdio:04&quot;), and eth1 is the rest of the ports, and the driver specifically only talks to eth1, which by accident doesn&#039;t print out which driver it&#039;s using.</p><p>So given your output it actually looks like everything is working properly (the IP17xx driver recognized a IP175D), and due to a missing debug statement in the code, eth1 doesn&#039;t print the name of the switch it&#039;s using.</p><p>If you want to add in this debugging information, it could help. Basically, open up target/linux/ar71xx/files/drivers/net/ag71xx/ag71xx_phy.c<br />and you will want to add a print statement like the following to all cases, even if it connects to multiple switches.<br /></p><div class="codebox"><pre><code>printk(KERN_DEBUG &quot;%s: connected to PHY at %s &quot;
                            &quot;[uid=%08x, driver=%s]\n&quot;,
                            dev-&gt;name, phydev-&gt;dev.bus_id,
                            phydev-&gt;phy_id, phydev-&gt;drv-&gt;name);</code></pre></div><p>You might need to put this into a for loop so it prints once for each of the 5 ethernet ports--and one of them should say IC+.<br />It&#039;s up to you if you want to do this, but it might help diagnose the problem.</p><p>Also, does swconfig work at all?</p><p>-Patrick</p>											<p class="post-edited">(Last edited by <strong>phorn</strong> on 31 May 2010, 23:04)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p110298">
				<div class="post-metadata">
					<div class="post-num">Post #192</div>
					<div class="post-author">BitBrusher</div>
					<div class="post-datetime">
						31 May 2010, 23:40					</div>
				</div>
				<div class="post-content content">
					<p>Patrick</p><p>You mean like this:</p><p>for (phy_addr = 0; phy_addr &lt; PHY_MAX_ADDR; phy_addr++)<br />{<br />&nbsp; &nbsp; &nbsp; &nbsp; if((phydev = ag-&gt;mii_bus-&gt;phy_map[phy_addr])!=NULL)<br />&nbsp; &nbsp; &nbsp; &nbsp; printk(KERN_DEBUG &quot;%s: connected to PHY at %s [uid=%08x, driver=%s]\n&quot;,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dev-&gt;name, dev_name(&amp;phydev-&gt;dev),<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; phydev-&gt;phy_id, phydev-&gt;drv-&gt;name);<br />}<br />I added this to the very end of ag71xx_phy_connect_multi. <br />Despite the fact it only prints &quot;eth0&quot; as the interface I got:</p><p>eth0: PHY found at ag71xx-mdio:04, uid=02430d80 and mask=00000010<br />eth0: connected to PHY at ag71xx-mdio:00 [uid=02430d80, driver=IC+ IP17xx]<br />eth0: connected to PHY at ag71xx-mdio:01 [uid=02430d80, driver=IC+ IP17xx]<br />eth0: connected to PHY at ag71xx-mdio:02 [uid=02430d80, driver=IC+ IP17xx]<br />eth0: connected to PHY at ag71xx-mdio:03 [uid=02430d80, driver=IC+ IP17xx]<br />eth0: connected to PHY at ag71xx-mdio:04 [uid=02430d80, driver=Generic PHY]<br />eth1: Atheros AG71xx at 0xb9000000, irq 4<br />eth1: using fixed link parameters</p><p>But even thus swconfig does not connect to the switch:<br /># swconfig dev eth1 show<br />swlib_priv_init(537): swlib_priv_init called.<br />swlib_connect(630): swlib_connect - after priv_init.<br />swlib_call(89): 1.<br />swlib_call(96): 2. data=(nil)&nbsp; &nbsp;arg.head=(nil)<br />swlib_call(106): 3.<br />swlib_call(113): 4.<br />swlib_call(119): 5. call=0x40242c&nbsp; data=(nil)&nbsp; arg.head=(nil) <br />swlib_call(131): 5.5. data=(nil)&nbsp; arg.head=(nil)&nbsp; &nbsp;finished=0<br />swlib_call(136): 6. data=(nil)&nbsp; arg.head=(nil), finished=1<br />swlib_call(140): 7. err=0<br />Failed to connect to the switch</p><p>same output for eth0.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p110303">
				<div class="post-metadata">
					<div class="post-num">Post #193</div>
					<div class="post-author">duvi</div>
					<div class="post-datetime">
						1 Jun 2010, 00:59					</div>
				</div>
				<div class="post-content content">
					<p>The same thing on RB433UAH as before.<br />CONFIG_ICPLUS_PHY undefined, CONFIG_IP17XX=y added, all patches correctly applied, and still no sign of IP17XX or IP175D messages in dmesg.</p><p>...<br />Atheros AR71xx SPI Controller driver version 0.2.4<br />ag71xx_mdio: probed<br />eth0: Atheros AG71xx at 0xba000000, irq 5<br />eth0: connected to PHY at ag71xx-mdio:04 [uid=02430d80, driver=Generic PHY]<br />eth1: Atheros AG71xx at 0xb9000000, irq 4<br />eth1: using fixed link parameters<br />Atheros AR71xx hardware watchdog driver version 0.1.0<br />...</p><br /><p>Maybe some things are different on RB433UAH than RB450? How do I check?</p><p>I use initramfs.elf image, should that be a problem? I don&#039;t think so.</p>											<p class="post-edited">(Last edited by <strong>duvi</strong> on 1 Jun 2010, 01:49)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p110320">
				<div class="post-metadata">
					<div class="post-num">Post #194</div>
					<div class="post-author">phorn</div>
					<div class="post-datetime">
						1 Jun 2010, 10:02					</div>
				</div>
				<div class="post-content content">
					<p>All your output is saying that things are working. I&#039;ve been tracing through the code, and I can&#039;t come up with many reasons, aside from out of memory errors, that you would be getting those prints but the switch is never connecting.</p><p>I think the problem is how you are invoking the swconfig command.</p><p>From what I remember, the switch IDs are actually numbers: 0, 1, 2, ...<br />I would try &quot;swconfig dev 0 show&quot; or &quot;swconfig dev 1 show&quot;.<br />It&#039;s strange that it doesn&#039;t give you an error for typing a name instead of a number.</p><p>(I&#039;m really not sure about this--I see a lot of conflicting examples on google. I don&#039;t really have any routers with IC+ switches to test with at the moment, so I&#039;m just guessing.)</p><p>If it still doesn&#039;t work, it might be time to add print statements to every other line :-p The fact that it recognized your switch as IP175D means all the hard parts should be working, and it&#039;s probably a silly error.</p>											<p class="post-edited">(Last edited by <strong>phorn</strong> on 1 Jun 2010, 10:12)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p110321">
				<div class="post-metadata">
					<div class="post-num">Post #195</div>
					<div class="post-author">duvi</div>
					<div class="post-datetime">
						1 Jun 2010, 10:15					</div>
				</div>
				<div class="post-content content">
					<p>And what about RB433UAH?</p><p>My output says things are _not_ working. There is nothing about &#039;IP17xx&#039; or &#039;IP175D&#039;.<br />root@OpenWrt:/# dmesg |grep IP17<br />root@OpenWrt:/# dmesg |grep ip17<br />root@OpenWrt:/#</p><p>And also:<br />root@OpenWrt:/# swconfig dev 0 show<br />Failed to connect to the switch<br />root@OpenWrt:/# swconfig dev 1 show<br />Failed to connect to the switch</p>											<p class="post-edited">(Last edited by <strong>duvi</strong> on 1 Jun 2010, 10:17)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p110323">
				<div class="post-metadata">
					<div class="post-num">Post #196</div>
					<div class="post-author">phorn</div>
					<div class="post-datetime">
						1 Jun 2010, 10:26					</div>
				</div>
				<div class="post-content content">
					<p>Hmm, I think I was wrong about the numbering, since the code seems to use devname, which I think is something like &quot;eth0&quot; or &quot;eth1&quot;, etc.</p><p>It sounds like in both of your cases, you should be using eth0, so &quot;swconfig dev eth0 show&quot;</p><p>One possibility is that multiple switches are added, all named &quot;eth0&quot;. And so the last one happens to be &quot;Generic phy&quot;.</p><p>BitBrusher, since you already added some debug statements to swconfig, would it be possible to add another debug statement after line 572, where it has &quot;name&quot; for each switch, and print it out?</p><p>If it turns out that there are no switches in swconfig, I&#039;m worried that there&#039;s some peculiarity with how the ag71xx network driver talks to the switch drivers (which had a major change about 2 months ago). Like maybe it&#039;s calling ip17xx_probe(), but not ip17xx_config_init(), which means it prints out everything but never calls &quot;register_switch&quot;</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p110324">
				<div class="post-metadata">
					<div class="post-num">Post #197</div>
					<div class="post-author">phorn</div>
					<div class="post-datetime">
						1 Jun 2010, 10:30					</div>
				</div>
				<div class="post-content content">
					<p>@duvi, it sounds like the ip17xx driver may have not been properly compiled into the kernel. Did you make sure to make clean after applying my fixed patch? If not, openwrt won&#039;t automatically rebuild the kernel, so it&#039;s an easy mistake to make:<br />TOPDIR=$PWD make -C target/linux clean</p><p>You can tell whether you properly compiled your kernel by doing:<br />strings &quot;openwrt-ar71xx-vmlinux.elf&quot; | grep IP175D</p><p>Also, make sure you looked in bin/ar71xx, *NOT* directly inside bin. I found I had some stale kernel files directly inside bin which were a few months old!</p><p>I&#039;m pretty sure RB433UAH has IP175D, same as the other RB450s. I just did a google image search and I saw that chip on the board: <a href="http://www.katalita.lt/products/RB433UAH.jpg">http://www.katalita.lt/products/RB433UAH.jpg</a></p>											<p class="post-edited">(Last edited by <strong>phorn</strong> on 1 Jun 2010, 10:34)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p110333">
				<div class="post-metadata">
					<div class="post-num">Post #198</div>
					<div class="post-author">BitBrusher</div>
					<div class="post-datetime">
						1 Jun 2010, 13:56					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>phorn wrote:</cite><blockquote><p>Hmm, I think I was wrong about the numbering, since the code seems to use devname, which I think is something like &quot;eth0&quot; or &quot;eth1&quot;, etc.</p><p>It sounds like in both of your cases, you should be using eth0, so &quot;swconfig dev eth0 show&quot;</p><p>One possibility is that multiple switches are added, all named &quot;eth0&quot;. And so the last one happens to be &quot;Generic phy&quot;.</p><p>BitBrusher, since you already added some debug statements to swconfig, would it be possible to add another debug statement after line 572, where it has &quot;name&quot; for each switch, and print it out?</p><p>If it turns out that there are no switches in swconfig, I&#039;m worried that there&#039;s some peculiarity with how the ag71xx network driver talks to the switch drivers (which had a major change about 2 months ago). Like maybe it&#039;s calling ip17xx_probe(), but not ip17xx_config_init(), which means it prints out everything but never calls &quot;register_switch&quot;</p></blockquote></div><p>Patrick</p><p>These debug lines from swconfig are inside swlib.c (package/swconfig/src/swlib.c). <br />The line you refer (572) is in what file??</p><p>About register_switch, I added these lines inside ip17xx_config_init:</p><div class="codebox"><pre><code>        err = register_switch(&amp;state-&gt;dev, dev);
        pr_info(&quot;IP17xx: Trying to register switch %s: &quot;, dev-&gt;name);
        if (err &lt; 0)
        {
                pr_info(&quot;ERROR=%x\n&quot;, err);
                return err;
        }
        pr_info(&quot;SUCCCESS\n&quot;);</code></pre></div><p>and got NOTHING. Seems like your suspects are real.</p><p>BitBrusher</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p110334">
				<div class="post-metadata">
					<div class="post-num">Post #199</div>
					<div class="post-author">BitBrusher</div>
					<div class="post-datetime">
						1 Jun 2010, 14:18					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>duvi wrote:</cite><blockquote><p>And what about RB433UAH?</p><p>My output says things are _not_ working. There is nothing about &#039;IP17xx&#039; or &#039;IP175D&#039;.<br />root@OpenWrt:/# dmesg |grep IP17<br />root@OpenWrt:/# dmesg |grep ip17<br />root@OpenWrt:/#</p><p>And also:<br />root@OpenWrt:/# swconfig dev 0 show<br />Failed to connect to the switch<br />root@OpenWrt:/# swconfig dev 1 show<br />Failed to connect to the switch</p></blockquote></div><p>duvi</p><p>try this on you RB433:</p><p># strings /proc/kcore |grep IP17</p><p>You should see something like (among lots of garbage):<br /></p><div class="codebox"><pre><code>root@OpenWrt:/# strings /proc/kcore |grep IP17
&lt;4&gt;IP17xx: Unable to get MII register %d,%d: error %d
&lt;4&gt;IP17xx: Unable to write MII register %d,%d: error %d
&lt;4&gt;IP17xx: Found an unknown IC+ switch with model number %02x, revision %X.
IC+ IP17xx
IC+ IP175A
VLAN tag (0-4095) [IP175D only]
IP178C
IP175D
...</code></pre></div><p>NOTE: your &quot;garbage&quot; will be a little bit different from mine. <br />what is important here is the IP17* strings look like mine.</p><p>If you do not see these IP17* strings you do not have the correct driver compiled in.<br />Back to the drawing board!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p110335">
				<div class="post-metadata">
					<div class="post-num">Post #200</div>
					<div class="post-author">duvi</div>
					<div class="post-datetime">
						1 Jun 2010, 14:34					</div>
				</div>
				<div class="post-content content">
					<p>phorn: I grabbed a clean trunk with git, applied the patches, added CONFIG_IP17XX=y, removed CONFIG_ICPLUS_PHY from the kernel config, made menuconfig, than compiled.</p><div class="codebox"><pre><code> $ strings openwrt-ar71xx-generic-vmlinux-initramfs.elf | grep IP17
&lt;4&gt;IP17xx: Unable to get MII register %d,%d: error %d
&lt;4&gt;IP17xx: Unable to write MII register %d,%d: error %d
&lt;4&gt;IP17xx: Found an unknown IC+ switch with model number %02x, revision %X.
&lt;6&gt;IP17xx: Found %s at %s
IC+ IP17xx
IC+ IP175A
VLAN tag (0-4095) [IP175D only]
IP175C
IP178C
IP175D</code></pre></div><p>BirBrusher: of course the same thing within openwrt</p><div class="codebox"><pre><code>root@OpenWrt:/# strings /proc/kcore | grep IP17
&lt;4&gt;IP17xx: Unable to get MII register %d,%d: error %d
&lt;4&gt;IP17xx: Unable to write MII register %d,%d: error %d
&lt;4&gt;IP17xx: Found an unknown IC+ switch with model number %02x, revision %X.
&lt;6&gt;IP17xx: Found %s at %s
IC+ IP17xx
IC+ IP175A
VLAN tag (0-4095) [IP175D only]
IP175C
IP178C
IP175D</code></pre></div><p>Yet, nothing about IP17XX in dmesg, and no success with swconfig.</p>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 8 of 9</div><nav><ul><li><a href="viewtopic.php%3Fid=17501&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=17501&amp;p=6.html">6</a></li><li><a href="viewtopic.php%3Fid=17501&amp;p=7.html">7</a></li><li class="pagination-current"><span>8</span></li><li><a href="viewtopic.php%3Fid=17501&amp;p=9.html">9</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0.001 -->

</body>
</html>