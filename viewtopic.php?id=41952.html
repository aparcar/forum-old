<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> how do I reduce image size? can I remove opkg?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 8 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p190215">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">izhar.eyal</div>
					<div class="post-datetime">
						28 Jan 2013, 15:56					</div>
				</div>
				<div class="post-content content">
					<p>I would like to reduce the image size as much as possible, I&#039;m working with WDR3400 with only 8MB flash, even the smallest things I add cannot be compiled due to size limitation.</p><p>Is it possible to install all the packages required and configure them on my development station, so that after compilation I will get an image that does not contain opkg, doest not allow installation of packages, maybe even remove uci and make all the configuration static.</p><p>Is that possible an how?<br />what else can be removed to reduce space?</p><p>thanks:)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p190219">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">mazilo</div>
					<div class="post-datetime">
						28 Jan 2013, 16:55					</div>
				</div>
				<div class="post-content content">
					<p>There are several things one can do to reduce the built firmware image by disabling and/or enabling some options in <strong>Global build settings</strong> sub-menu of <em>make menuconfig</em>. Mine is shown below and yours will probably be different.<br /></p><div class="codebox"><pre><code> OpenWrt Barrier Breaker (r35342) Configuration                                                     
 ────────────────────────────────────────────────────────────────────────────────────────────────── 
  ┌─────────────────────────────────── Global build settings ───────────────────────────────────┐   
  │  Arrow keys navigate the menu.  &lt;Enter&gt; selects submenus ---&gt;.  Highlighted letters are     │   
  │  hotkeys.  Pressing &lt;Y&gt; includes, &lt;N&gt; excludes, &lt;M&gt; builds as package.  Press &lt;Esc&gt;&lt;Esc&gt; to │   
  │  exit, &lt;?&gt; for Help, &lt;/&gt; for Search.  Legend: [*] built-in  [ ] excluded  &lt;M&gt; package  &lt; &gt;  │   
  │  package capable                                                                            │   
  │ ┌─^(-)────────────────────────────────────────────────────────────────────────────────────┐ │   
  │ │ [ ] Show packages that require graphics support (local or remote)                       │ │   
  │ │ [*] Compile with support for patented functionality                                     │ │   
  │ │ [ ] Compile with full language support                                                  │ │   
  │ │ [*] Attempt to link host utilities statically                                           │ │   
  │ │ [*] Enable shadow password support                                                      │ │   
  │ │ [*] Remove ipkg/opkg status data files in final images                                  │ │   
  │ │ [ ] Collect kernel debug information                                                    │ │   
  │ │ --- Kernel build options                                                                │ │   
  │ │ [ ] Compile the kernel with Debug FileSystem enabled                                    │ │   
  │ │ [ ] Compile the kernel with profiling enabled                                           │ │   
  │ │ [ ] Compile the kernel with symbol table information                                    │ │   
  │ │ [ ] Compile the kernel with tracing support                                             │ │   
  │ │ [ ] Compile the kernel with debug information                                           │ │   
  │ │ [ ] Compile the kernel with early printk                                                │ │   
  │ │ [ ] Compile the kernel with asynchronous IO support                                     │ │   
  │ │ [ ] Compile the kernel with direct IO support                                           │ │   
  │ │ [ ] Compile the kernel with SysRq support                                               │ │   
  │ │ [ ] Enable process core dump support                                                    │ │   
  │ │ [*] Enable kernel lock checking                                                         │ │   
  │ │ [ ] Enable printk timestamps                                                            │ │     │   │ │ [ ] Enable kernel cgroups                                                               │ │   
  │ │ [ ] Enable kernel namespaces                                                            │ │   
  │ │ --- Package build options                                                               │ │   
  │ │ [ ] Compile packages with debugging info                                                │ │   
  │ │ [*] Enable IPv6 support in packages                                                     │ │   
  │ │ [*] Compile certain packages parallelized                                               │ │   
  │ │ [*]   Use top-level make jobserver for packages                                         │ │   
  │ │ --- Stripping options                                                                   │ │   
  │ │     Binary stripping method (sstrip)  ---&gt;                                              │ │   
  │ │ [ ] Strip unnecessary functions from libraries                                          │ │   └─v(+)────────────────────────────────────────────────────────────────────────────────────┘ │   
  ├─────────────────────────────────────────────────────────────────────────────────────────────┤   
  │                              &lt;Select&gt;    &lt; Exit &gt;    &lt; Help &gt;                               │   
  └─────────────────────────────────────────────────────────────────────────────────────────────┘   
                                                                                                    
                                                                                                    </code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p190244">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">lizby</div>
					<div class="post-datetime">
						28 Jan 2013, 21:57					</div>
				</div>
				<div class="post-content content">
					<p>What are you trying to include?&nbsp; A lot can be squeezed into even an 4mb flash device like the tp-WR703N.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p190267">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">izhar.eyal</div>
					<div class="post-datetime">
						29 Jan 2013, 01:43					</div>
				</div>
				<div class="post-content content">
					<p>I would like to insert my own code into the router + maybe Luci which does not fit if you start adding some Luci utils.<br />I know basic Linux distributions can be reduced to bellow 4MB,this is why I don&#039;t understand why OpenWRT contains opkg on the target and allows you to add/remove packages directly from the target.</p><p>What do you suggest to remove? I want to remove as much as possible. thanks.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p190268">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">lizby</div>
					<div class="post-datetime">
						29 Jan 2013, 02:25					</div>
				</div>
				<div class="post-content content">
					<p>What code of your own do you want to include?&nbsp; You can easily enough include Luci in 8MB.&nbsp; If your code is in PHP, then that has a very large footprint.&nbsp; For lightweight coding, lua is already present, and you can fit hundreds if not thousands of lines of code in 4MB.&nbsp; </p><p>If you want to code in C and cross compile on another platform, you can fit a lot of code in a small space.&nbsp; If you want to compile natively in C, then again you have a large footprint.&nbsp; If you really need a lot of space, you may want a device with USB so you can pivotroot to USB flash.</p><p>It would be hard to suggest what to remove if we don&#039;t know what you need to include.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p190274">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">izhar.eyal</div>
					<div class="post-datetime">
						29 Jan 2013, 07:27					</div>
				</div>
				<div class="post-content content">
					<p>Regarding Luci, I was able to include it, but once I started to include more Luci utils such as ntp client and other diagnostics utils the image would not compile because of too large image size.</p><p>Regarding code, I have some C code, not really big.<br />The main issue is I need to customize some web pages on Luci or any other web UI. I don&#039;t know at the moment if lua will be enough, maybe some PHP will be needed.</p><p>Please tell me the obvious things that can be removed from the target,<br />I know for sure I want to remove the utility opkg since I have no intension of installing packages on the fly, is that ok? Is this app used by the system update?</p><p>what else can be removed?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p190286">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">nozombian</div>
					<div class="post-datetime">
						29 Jan 2013, 10:33					</div>
				</div>
				<div class="post-content content">
					<p>You can save some space compiling the packages you need into the image [ *] (not as module [M]), because it is compressed then. Btw. 8MB flash is quite a lot! Maybe you have checked something by accident? I&#039;d do make distclean, make manuconfig and try to select packages again more carefully.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p190308">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">lizby</div>
					<div class="post-datetime">
						29 Jan 2013, 13:33					</div>
				</div>
				<div class="post-content content">
					<p>We still have no idea what it is you are including which makes your image too large to fit in 8MB.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p267860">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">Lieta</div>
					<div class="post-datetime">
						6 Mar 2015, 10:13					</div>
				</div>
				<div class="post-content content">
					<p>Mazilo, what is kernel lock checking? Why did you left it enabled?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p267961">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">mazilo</div>
					<div class="post-datetime">
						7 Mar 2015, 05:50					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Lieta wrote:</cite><blockquote><p>Mazilo, what is kernel lock checking? Why did you left it enabled?</p></blockquote></div><p>I wasn&#039;t aware of setting this option.</p><p>Anyway, I took a look at what is the kernel lock checking and here is the help menu from the <em>Lock debugging: prove locking correctness</em> entry in the <em>make kernel_menuconfig</em>:<br /></p><div class="codebox"><pre><code>  ┌─────────────── Lock debugging: prove locking correctness ───────────────┐
  │ CONFIG_PROVE_LOCKING:                                                   │  
  │                                                                         │  
  │ This feature enables the kernel to prove that all locking               │  
  │ that occurs in the kernel runtime is mathematically                     │  
  │ correct: that under no circumstance could an arbitrary (and             │  
  │ not yet triggered) combination of observed locking                      │  
  │ sequences (on an arbitrary number of CPUs, running an                   │  
  │ arbitrary number of tasks and interrupt contexts) cause a               │  
  │ deadlock.                                                               │  
  │                                                                         │  
  │ In short, this feature enables the kernel to report locking             │  
  │ related deadlocks before they actually occur.                           │  
  │                                                                         │  
  │ The proof does not depend on how hard and complex a                     │  
  │ deadlock scenario would be to trigger: how many                         │  
  │ participant CPUs, tasks and irq-contexts would be needed                │  
  │ participant CPUs, tasks and irq-contexts would be needed                │  
  │ for it to trigger. The proof also does not depend on                    │  
  │ timing: if a race and a resulting deadlock is possible                  │  
  │ theoretically (no matter how unlikely the race scenario                 │  
  │ is), it will be proven so and will immediately be                       │  
  │ reported by the kernel (once the event is observed that                 │  
  │ makes the deadlock theoretically possible).                             │  
  │                                                                         │  
  │ If a deadlock is impossible (i.e. the locking rules, as                 │  
  │ observed by the kernel, are mathematically correct), the                │  
  │ kernel reports nothing.                                                 │  
  │                                                                         │  
  │ NOTE: this feature can also be enabled for rwlocks, mutexes             │  
  │ and rwsems - in which case all dependencies between these               │  
  │ different locking variants are observed and mapped too, and             │  
  │ the proof of observed correctness is also maintained for an             │  
  │ arbitrary combination of these separate locking variants.               │  
  │                                                                         │  
  │ For more details, see Documentation/locking/lockdep-design.txt.         │  
  │                                                                         │  
  │ Symbol: PROVE_LOCKING [=n]                                              │  
  │ Type  : boolean                                                         │  
  │ Prompt: Lock debugging: prove locking correctness                       │  
  │   Location:                                                             │  
  │     -&gt; Kernel hacking                                                   │  
  │       -&gt; Lock Debugging (spinlocks, mutexes, etc...)                    │  
  │   Defined at lib/Kconfig.debug:926                                      │  
  │   Depends on: DEBUG_KERNEL [=y] &amp;&amp; TRACE_IRQFLAGS_SUPPORT [=y] &amp;&amp; \     │  
  │ STACKTRACE_SUPPORT [=y] &amp;&amp; LOCKDEP_SUPPORT [=y]                         │  
  │   Selects: LOCKDEP [=n] &amp;&amp; DEBUG_SPINLOCK [=n] &amp;&amp; DEBUG_MUTEXES [=n] &amp;&amp; \│  
  │ DEBUG_LOCK_ALLOC [=n] &amp;&amp; TRACE_IRQFLAGS [=n]                            │  
  │                                                                         │  
  │                                                                         │  
  │                                                                         │  
  ├─────────────────────────────────────────────────────────────────(100%)──┤  
  │                                &lt; Exit &gt;                                 │  
  └─────────────────────────────────────────────────────────────────────────┘</code></pre></div>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>