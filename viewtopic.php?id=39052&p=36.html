<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> mwan3; multi-wan policy routing (general topic)</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 22 May 2013 and 6 May 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 36 of 65</div><nav><ul><li><a href="viewtopic.php%3Fid=39052&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=34.html">34</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=35.html">35</a></li><li class="pagination-current"><span>36</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=37.html">37</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=38.html">38</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=65.html">65</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p243957">
				<div class="post-metadata">
					<div class="post-num">Post #876</div>
					<div class="post-author">shenyz</div>
					<div class="post-datetime">
						15 Aug 2014, 16:46					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><div class="quotebox"><cite>shenyz wrote:</cite><blockquote><p>Hi,Adze<br />how long time the new mwan3 ipk for cc can be used?thanks。</p></blockquote></div><p>It is available: <a href="http://213.136.13.52/mwan3_1.5-3_all.ipk">http://213.136.13.52/mwan3_1.5-3_all.ipk</a></p></blockquote></div><br /><p>thank you very much,Adze.<br />and other two ipks ,i can not find it <br />you said:<br />Latest release</p><br /><p>The mwan3 packages current as of 2014-08-14 are: </p><p>• mwan3_1.4-24_all.ipk</p><br /><p>• mwan3_1.5-3_all.ipk (OpenWrt CC only)</p><br /><p>• luci-app-mwan3_1.3-1_all.ipk</p><p>ps:your openwt mwan3 wiki should make change </p><p>Download packages</p><br /><p>The mwan3 packages aren&#039;t in the OpenWrt standard package repository. The two packages need to be separately downloaded and installed. </p><p>• <a href="http://213.136.13.52/mwan3_latest_all.ipk">http://213.136.13.52/mwan3_latest_all.ipk</a></p><br /><p>• <a href="http://213.136.13.52/luci-app-mwan3_latest_all.ipk">http://213.136.13.52/luci-app-mwan3_latest_all.ipk</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p243960">
				<div class="post-metadata">
					<div class="post-num">Post #877</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						15 Aug 2014, 16:53					</div>
				</div>
				<div class="post-content content">
					<p><a href="http://213.136.13.52/luci-app-mwan3_latest_all.ipk">http://213.136.13.52/luci-app-mwan3_latest_all.ipk</a> is there and is correct</p><p>The latest 1.4 version is indeed still missing as ipk download. You can however build it yourself. Have not done this yet. Will do soon.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p243963">
				<div class="post-metadata">
					<div class="post-num">Post #878</div>
					<div class="post-author">shenyz</div>
					<div class="post-datetime">
						15 Aug 2014, 17:16					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><p><a href="http://213.136.13.52/luci-app-mwan3_latest_all.ipk">http://213.136.13.52/luci-app-mwan3_latest_all.ipk</a> is there and is correct</p><p>The latest 1.4 version is indeed still missing as ipk download. You can however build it yourself. Have not done this yet. Will do soon.</p></blockquote></div><br /><br /><p>I am wait,thank you again</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p244671">
				<div class="post-metadata">
					<div class="post-num">Post #879</div>
					<div class="post-author">headless.cross</div>
					<div class="post-datetime">
						23 Aug 2014, 18:43					</div>
				</div>
				<div class="post-content content">
					<p>Hello to everyone. I just have updated mwan to 1.4-24 and the transparent proxy (previously working) is broken. Configuration and firewall rules are the same. What info can I provide to investigate further this issue?</p><p>privoxy ver.: 3.0.21-2<br />mwan3 ver.: 1.4-24</p><p>Thanks in advance.</p><p><strong>Edit</strong>: Everything works as expected. Privoxy service accidentally could not start (misconfiguration) which I did not realized, so forget this post.</p>											<p class="post-edited">(Last edited by <strong>headless.cross</strong> on 28 Aug 2014, 16:00)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p246058">
				<div class="post-metadata">
					<div class="post-num">Post #880</div>
					<div class="post-author">JohnV</div>
					<div class="post-datetime">
						5 Sep 2014, 03:54					</div>
				</div>
				<div class="post-content content">
					<p>HI,</p><p>I am just starting to use mwan3, and have an issue I am hoping someone can help with.</p><p>I have a simple setup, 2 WAN interfaces.</p><p>WAN is set with metric 20<br />WAN2 is set with metric 10</p><p>Both work OK when used individually.</p><p>In MWAN config, I have a simple policy that states WAN2 is higher priority then WAN, and all traffic should go out WAN2, unless WAN2 is not available, then traffic should go out WAN.&nbsp; WAN is always connected, however it may not always have internet access, but MWAN3 does not have to worry about this, just that WAN us &quot;up&quot;.</p><p>The issue I have is with DNS.</p><p>If I try to ping 8.8.8.8, the traffic is correct, however, when I try to ping google.com, it cannot reoslve the name.&nbsp; This happens when WAN2 is offline, and WAN does not have internet access, and then WAN2 comes back online.&nbsp; When tis happens, the 8.8.8.8 goes to WAN2, but the DNS seems to be going to WAN, which does not have internet access, and in turn, the DNS fails.....</p><p>Any thoughts on why this is happending?</p><p>A bit more information:<br />I run Windows 8, with a linux VM.</p><p>From windows, DNS is not working, from Linux, it is.....&nbsp; Why would windows not behave correctly with the DNS chnage on the router?&nbsp; Strange.....</p><br /><p>And some more info:</p><p>When both WAN and WAN2 are &quot;online&quot;, /etc/resolv.conf.auto looks like:</p><p># Interface wan<br />nameserver 10.10.20.1<br />search lan<br /># Interface wan2<br />nameserver 202.3.225.115<br />nameserver 202.3.225.125</p><p>Why are are the DNS lookups not going through the wan2 servers?</p><p>Once again, more info:</p><p>The nameserver 10.10.20.1 that is listed, is another router, that may, or may not, be connected to the internet.&nbsp; Right now, I am testing with it not connected to the internet.</p><p>It seems that the DNS requests try to go to 10.10.20.1, but I am unsure why the other servers are also not checked, as the 10.10.20.1 DNS lookup will fail.&nbsp; Why are the other servers not searched also?</p><p>If I change the order, and put the 202.X.X.X first in the resolv.conf.auto file, they are searched first, and in turn DNS works OK.</p>											<p class="post-edited">(Last edited by <strong>JohnV</strong> on 5 Sep 2014, 05:27)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p246169">
				<div class="post-metadata">
					<div class="post-num">Post #881</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						6 Sep 2014, 01:14					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>JohnV wrote:</cite><blockquote><p>It seems that the DNS requests try to go to 10.10.20.1, but I am unsure why the other servers are also not checked, as the 10.10.20.1 DNS lookup will fail.&nbsp; Why are the other servers not searched also?</p></blockquote></div><p>Nameservers in /etc/resolv.conf.auto are queried from top to bottom. Only if a nameserver does not return a response the next nameserver is queried. I think that the nameserver at 10.10.20.1 does respond to a request, even though itself doesn&#039;t have internet and thus the answer.</p><p>And because 10.10.20.1 is (probably) directly connected to the mwan3 test router it will always be routed there, regardless of wan interface status.</p><p>If possible change the DNS settings to Google DNS or OpenDNS.</p>											<p class="post-edited">(Last edited by <strong>Adze</strong> on 6 Sep 2014, 01:16)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p246183">
				<div class="post-metadata">
					<div class="post-num">Post #882</div>
					<div class="post-author">JohnV</div>
					<div class="post-datetime">
						6 Sep 2014, 05:48					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><p>Nameservers in /etc/resolv.conf.auto are queried from top to bottom. Only if a nameserver does not return a response the next nameserver is queried. I think that the nameserver at 10.10.20.1 does respond to a request, even though itself doesn&#039;t have internet and thus the answer.</p><p>And because 10.10.20.1 is (probably) directly connected to the mwan3 test router it will always be routed there, regardless of wan interface status.</p><p>If possible change the DNS settings to Google DNS or OpenDNS.</p></blockquote></div><br /><p>Thanks for the response.</p><p>I think you are correct, and came up with a solution.&nbsp; When WAN2 goes down I change the &quot;peerdns&quot; option on the WAN network to &quot;1&quot;.&nbsp; When WAN2 comes up, I change the &quot;peerdns&quot; option on WAN to &quot;0&quot;, eliminating any lookups via WAN.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p246484">
				<div class="post-metadata">
					<div class="post-num">Post #883</div>
					<div class="post-author">r2k</div>
					<div class="post-datetime">
						8 Sep 2014, 22:18					</div>
				</div>
				<div class="post-content content">
					<p>Hi,<br />I&#039;m happy mwan3 user on few openwrt routers. <br />I would have such thing for Debian too.<br />Did you heard about such thing, maybe? <br />Is porting possible or rather openwrt specific?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p246492">
				<div class="post-metadata">
					<div class="post-num">Post #884</div>
					<div class="post-author">ValdikSS</div>
					<div class="post-datetime">
						8 Sep 2014, 23:51					</div>
				</div>
				<div class="post-content content">
					<p>Adze, I&#039;ve found a typo which made a bug.<br />If you add some static routes, mwan3 would fail to add them correctly to iptables mangle table.</p><p>/etc/hotplug.d/iface/15-mwan3<br /></p><div class="codebox"><pre><code>+ local_net=31.220.43.152
92.42.31.0/24
93.95.98.176
95.215.45.33
+ iptables -S mwan3_iface_wan -t mangle
+ iptables -N mwan3_iface_wan -t mangle
+ iptables -F mwan3_iface_wan -t mangle
+ iptables -D mwan3_ifaces -t mangle -i eth0.2 -m mark --mark 0x0/0xff00 -j mwan3_iface_wan
+ [ ifup == ifup ]
+ [ -n 31.220.43.152
92.42.31.0/24
93.95.98.176
95.215.45.33 ]
+ [ ifup == ifup ]
+ iptables -I mwan3_iface_wan -t mangle -s 31.220.43.152 92.42.31.0/24 93.95.98.176 95.215.45.33 -m mark --mark 0x0/0xff00 -m comment --comment wan -j MARK --set-xmark 0xff00/0xff00
Bad argument `92.42.31.0/24&#039;
Try `iptables -h&#039; or &#039;iptables --help&#039; for more information.
+ [ ifup == ifup ]
+ iptables -I mwan3_iface_wan -t mangle -s 31.220.43.152 92.42.31.0/24 93.95.98.176 95.215.45.33 -m mark --mark 0x0/0xff00 -m comment --comment wan -j MARK --set-xmark 0xff00/0xff00
Bad argument `92.42.31.0/24&#039;
Try `iptables -h&#039; or &#039;iptables --help&#039; for more information.
+ [ ifup == ifup ]
+ iptables -I mwan3_iface_wan -t mangle -s 31.220.43.152 92.42.31.0/24 93.95.98.176 95.215.45.33 -m mark --mark 0x0/0xff00 -m comment --comment wan -j MARK --set-xmark 0xff00/0xff00
Bad argument `92.42.31.0/24&#039;
Try `iptables -h&#039; or &#039;iptables --help&#039; for more information.
+ [ ifup == ifup ]
+ iptables -I mwan3_iface_wan -t mangle -s 31.220.43.152 92.42.31.0/24 93.95.98.176 95.215.45.33 -m mark --mark 0x0/0xff00 -m comment --comment wan -j MARK --set-xmark 0xff00/0xff00
Bad argument `92.42.31.0/24&#039;
Try `iptables -h&#039; or &#039;iptables --help&#039; for more information</code></pre></div><p>There should be … -t mangle -s $local_net<strong>s</strong> -m mark … on line 91. Actually, everywhere local_nets should be called local_net and vice versa.</p><p>Full log — <a href="https://gist.github.com/ValdikSS/78b96927457720fb3802">https://gist.github.com/ValdikSS/78b96927457720fb3802</a><br />Troubleshooting data — <a href="https://gist.github.com/ValdikSS/1850d8fcbb6a97e1532a">https://gist.github.com/ValdikSS/1850d8fcbb6a97e1532a</a></p>											<p class="post-edited">(Last edited by <strong>ValdikSS</strong> on 9 Sep 2014, 00:02)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p246493">
				<div class="post-metadata">
					<div class="post-num">Post #885</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						9 Sep 2014, 00:07					</div>
				</div>
				<div class="post-content content">
					<p>Hi ValdikSS,</p><p>Thanks for reporting. Will look into this. But why do you want to set these static routes? You could just create a policy for the three statics...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p246495">
				<div class="post-metadata">
					<div class="post-num">Post #886</div>
					<div class="post-author">ValdikSS</div>
					<div class="post-datetime">
						9 Sep 2014, 00:37					</div>
				</div>
				<div class="post-content content">
					<p>Adze, I don&#039;t know actually. Maybe to make static routes work even with mwan3 disabled. Anyway, all static routes seemed working even without fix. I&#039;ve discovered this error accidentally today.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p246525">
				<div class="post-metadata">
					<div class="post-num">Post #887</div>
					<div class="post-author">vlad2005</div>
					<div class="post-datetime">
						9 Sep 2014, 09:27					</div>
				</div>
				<div class="post-content content">
					<p>Hi!<br />I try to install mwan3 to an TL-WR1043N/ND v1 wich run CC r42139 but i got error when install packages dependencies<br />Here is my log:</p><p>opkg install libc ip iptables iptables-mod-conntrack-extra iptables-mod-ipopt kmod-ipt-conntrack-extra kmod-ipt-ipopt<br />Package libc (0.9.33.2-1) installed in root is up to date.<br />Installing ip (3.15.0-1) to root...<br />Downloading <a href="http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/base/ip_3.15.0-1_ar71xx.ipk.">http://downloads.openwrt.org/snapshots/ … r71xx.ipk.</a><br />Package iptables (1.4.21-1) installed in root is up to date.<br />Installing iptables-mod-conntrack-extra (1.4.21-1) to root...<br />Downloading <a href="http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/base/iptables-mod-conntrack-extra_1.4.21-1_ar71xx.ipk.">http://downloads.openwrt.org/snapshots/ … r71xx.ipk.</a><br />Installing iptables-mod-ipopt (1.4.21-1) to root...<br />Downloading <a href="http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/base/iptables-mod-ipopt_1.4.21-1_ar71xx.ipk.">http://downloads.openwrt.org/snapshots/ … r71xx.ipk.</a><br />Installing kmod-ipt-conntrack-extra (3.10.49-1) to root...<br />Downloading <a href="http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/base/kmod-ipt-conntrack-extra_3.10.49-1_ar71xx.ipk.">http://downloads.openwrt.org/snapshots/ … r71xx.ipk.</a><br />Installing kmod-ipt-ipopt (3.10.49-1) to root...<br />Downloading <a href="http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/base/kmod-ipt-ipopt_3.10.49-1_ar71xx.ipk.">http://downloads.openwrt.org/snapshots/ … r71xx.ipk.</a><br />Configuring ip.<br />Configuring kmod-ipt-conntrack-extra.<br />Configuring kmod-ipt-ipopt.<br />Collected errors:<br /> * satisfy_dependencies_for: Cannot satisfy the following dependencies for iptables-mod-conntrack-extra:<br /> * &nbsp; &nbsp; kernel (= 3.10.49-1-0add8abb8b82fcc886b98fe841166abc) * <br /> * opkg_install_cmd: Cannot install package iptables-mod-conntrack-extra.<br /> * satisfy_dependencies_for: Cannot satisfy the following dependencies for iptables-mod-ipopt:<br /> * &nbsp; &nbsp; kernel (= 3.10.49-1-0add8abb8b82fcc886b98fe841166abc) * <br /> * opkg_install_cmd: Cannot install package iptables-mod-ipopt.</p><p>When i try to install mwan3 everything seem to be ok:</p><p>Installing mwan3 (1.5-4) to root...<br />Downloading <a href="http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/packages/mwan3_1.5-4_all.ipk.">http://downloads.openwrt.org/snapshots/ … 4_all.ipk.</a><br />Installing iptables-mod-conntrack-extra (1.4.21-1) to root...<br />Downloading <a href="http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/base/iptables-mod-conntrack-extra_1.4.21-1_ar71xx.ipk.">http://downloads.openwrt.org/snapshots/ … r71xx.ipk.</a><br />Installing iptables-mod-ipopt (1.4.21-1) to root...<br />Downloading <a href="http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/base/iptables-mod-ipopt_1.4.21-1_ar71xx.ipk.">http://downloads.openwrt.org/snapshots/ … r71xx.ipk.</a><br />Configuring iptables-mod-ipopt.<br />Configuring iptables-mod-conntrack-extra.<br />Configuring mwan3.</p><p>Is this normal?</p>											<p class="post-edited">(Last edited by <strong>vlad2005</strong> on 9 Sep 2014, 09:28)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p246596">
				<div class="post-metadata">
					<div class="post-num">Post #888</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						10 Sep 2014, 00:52					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>vlad2005 wrote:</cite><blockquote><p>* satisfy_dependencies_for: Cannot satisfy the following dependencies for iptables-mod-conntrack-extra:<br />*&nbsp; &nbsp; &nbsp;kernel (= 3.10.49-1-0add8abb8b82fcc886b98fe841166abc) * <br />* satisfy_dependencies_for: Cannot satisfy the following dependencies for iptables-mod-ipopt:<br />*&nbsp; &nbsp; &nbsp;kernel (= 3.10.49-1-0add8abb8b82fcc886b98fe841166abc) * </p><p>Is this normal?</p></blockquote></div><p>This usually means you are running trunk and now the package feeds have versions of iptables-mod-conntrack-extra and iptables-mod-ipopt that require a newer Linux kernel than what you have. You normally need to build a new firmware using the latest trunk code that has a newer kernel. It&#039;s strange that it installed the dependencies when you installed mwan3 but I would assume it should work if it installed successfully.</p>											<p class="post-edited">(Last edited by <strong>arfett</strong> on 10 Sep 2014, 00:57)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p246628">
				<div class="post-metadata">
					<div class="post-num">Post #889</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						10 Sep 2014, 13:04					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>ValdikSS wrote:</cite><blockquote><p>If you add some static routes, mwan3 would fail to add them correctly to iptables mangle table.</p><p>Everywhere local_nets should be called local_net and vice versa.</p></blockquote></div><p>Fixed in version 1.5-5</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p246631">
				<div class="post-metadata">
					<div class="post-num">Post #890</div>
					<div class="post-author">ValdikSS</div>
					<div class="post-datetime">
						10 Sep 2014, 13:17					</div>
				</div>
				<div class="post-content content">
					<p>Adze, thanks!<br />Would it be packported to v1.4 and is it safe to use 1.5 from trunk with bb rc3?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p246657">
				<div class="post-metadata">
					<div class="post-num">Post #891</div>
					<div class="post-author">uBoTo</div>
					<div class="post-datetime">
						10 Sep 2014, 17:05					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>I am using mwan3 since one week and have two problmes, one is similar like JohnV&#039;s. I have small network with 3-4 users on wifi and other 5-6 with computers (LAN). LAN and WiFi are bridged (default configuration).&nbsp; There are two providers wan and wan2 (static and dhcp client).</p><p>1. The main problem - when wan is down, mwan3 uses wan2 and traffic is redirected. I have ping from PCs and notebooks to domains and IPs. When try to open some website on PC (WIndows XP) nothing happens, but on laptop (Windows 7) - everything works perfect. I don&#039;t thing that the problem is that laptop is connected via WiFi, but will test with LAN cable. I tried with mobile phones through the WiFi when only wan2 was working - everything is OK. In my opinion the problem is with the DNS settings, but I have no idea which. The problem is only with Windows XP for now.</p><p>2. The second &#039;problem&#039; which maybe is a bug - I am using mwan3 only for faulty wan, not load balancing. My priority for wan is &#039;1000&#039; and for wan2 is &#039;1&#039; (the biggest and smallest possible numbers). When wan and wan2 are connected and working, the status is showing &#039;balanced: wan (99%)&nbsp; &nbsp;wan2 (0%)&#039;. Is this a bug and is all traffic going through wan? Is there a fix or other settings only for failover without traffic balancing?</p><p>Thanks!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p246663">
				<div class="post-metadata">
					<div class="post-num">Post #892</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						10 Sep 2014, 18:16					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>uBoTo wrote:</cite><blockquote><p>1. The main problem - when wan is down, mwan3 uses wan2 and traffic is redirected. I have ping from PCs and notebooks to domains and IPs. When try to open some website on PC (WIndows XP) nothing happens, but on laptop (Windows 7) - everything works perfect. I don&#039;t thing that the problem is that laptop is connected via WiFi, but will test with LAN cable. I tried with mobile phones through the WiFi when only wan2 was working - everything is OK. In my opinion the problem is with the DNS settings, but I have no idea which. The problem is only with Windows XP for now.</p></blockquote></div><p>Please try it with 8.8.8.8 as dns server on all clients and try again. More info on this in the wiki.</p><div class="quotebox"><cite>uBoTo wrote:</cite><blockquote><p>2. The second &#039;problem&#039; which maybe is a bug - I am using mwan3 only for faulty wan, not load balancing. My priority for wan is &#039;1000&#039; and for wan2 is &#039;1&#039; (the biggest and smallest possible numbers). When wan and wan2 are connected and working, the status is showing &#039;balanced: wan (99%)&nbsp; &nbsp;wan2 (0%)&#039;. Is this a bug and is all traffic going through wan? Is there a fix or other settings only for failover without traffic balancing?</p></blockquote></div><p>There is no such thing as priority option... You are probably tuning the weight option. With equal metrics, the weight option is used to determine the load each wan gets. This is only valid if the metric is equal. Interfaces with lower metric have precedence over interfaces with higher metric. Please change metric settings, not weight settings. More info on this in the wiki.</p>											<p class="post-edited">(Last edited by <strong>Adze</strong> on 10 Sep 2014, 18:17)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p246679">
				<div class="post-metadata">
					<div class="post-num">Post #893</div>
					<div class="post-author">uBoTo</div>
					<div class="post-datetime">
						10 Sep 2014, 20:41					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>Thanks for the replay. You are right about my second problem (I didn&#039;t have access today to the router to see/paste what I&#039;ve done). I tink that I&#039;ve really changed the weight option, not the metric. Tomorrow I will make corrections about that and see what will happend.</p><p>About my main problem - I tried to enter on one PC manually IP, GW, MASK and DNS (router&#039;s IP and 8.8.8.8 for DNS servers), but the problem was not solved. In my /etc/config/interfaces I don&#039;t have this option:<br /></p><div class="quotebox"><cite>JohnV wrote:</cite><blockquote><p>I think you are correct, and came up with a solution.&nbsp; When WAN2 goes down I change the &quot;peerdns&quot; option on the WAN network to &quot;1&quot;.&nbsp; When WAN2 comes up, I change the &quot;peerdns&quot; option on WAN to &quot;0&quot;, eliminating any lookups via WAN.</p></blockquote></div><p>Could it be the problem? The problem is only with PCs in the LAN, which are using WIndowsXP (and maybe one 2003 server, I&#039;m not sure).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p246682">
				<div class="post-metadata">
					<div class="post-num">Post #894</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						10 Sep 2014, 20:53					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>uBoTo wrote:</cite><blockquote><p>About my main problem - I tried to enter on one PC manually IP, GW, MASK and DNS (router&#039;s IP and 8.8.8.8 for DNS servers), but the problem was not solved. In my /etc/config/interfaces I don&#039;t have this option:<br /></p><div class="quotebox"><cite>JohnV wrote:</cite><blockquote><p>I think you are correct, and came up with a solution.&nbsp; When WAN2 goes down I change the &quot;peerdns&quot; option on the WAN network to &quot;1&quot;.&nbsp; When WAN2 comes up, I change the &quot;peerdns&quot; option on WAN to &quot;0&quot;, eliminating any lookups via WAN.</p></blockquote></div><p>Could it be the problem? The problem is only with PCs in the LAN, which are using WIndowsXP (and maybe one 2003 server, I&#039;m not sure).</p></blockquote></div><p>It should not be a problem, but it&#039;s hard to tell from here. Try some more troubleshooting. Maybe paste your troubleshooting output and do a tcpdump? I can take a look at that if you like.</p>											<p class="post-edited">(Last edited by <strong>Adze</strong> on 10 Sep 2014, 20:54)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p246690">
				<div class="post-metadata">
					<div class="post-num">Post #895</div>
					<div class="post-author">ValdikSS</div>
					<div class="post-datetime">
						10 Sep 2014, 21:56					</div>
				</div>
				<div class="post-content content">
					<p>Adze, sorry for asking again, but is it safe to install v1.5 on bb rc3?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p246691">
				<div class="post-metadata">
					<div class="post-num">Post #896</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						10 Sep 2014, 21:58					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>ValdikSS wrote:</cite><blockquote><p>Adze, sorry for asking again, but is it safe to install v1.5 on bb rc3?</p></blockquote></div><p>Yes, i believe so. You need iptables 1.4-20 or higher for it to work and i believe BB has version 1.4-21.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p246773">
				<div class="post-metadata">
					<div class="post-num">Post #897</div>
					<div class="post-author">uBoTo</div>
					<div class="post-datetime">
						11 Sep 2014, 19:15					</div>
				</div>
				<div class="post-content content">
					<p>Hi again! I made some checks (without tcpdump, because I could not install it - no space). The main problem is with opening HTTPS - google, youtube, facebook and websites that use secure http (I tried other sites that don&#039;t use https and everything was fine). The second thing - this problem is only with couple PCs. They have ping to google for example, but could not open <a href="https://google.com/">https://google.com/</a> ... I am trying to solve this problem whole day and - nothing. I tried different methods to clean dns cache and so on, but with no luck. This happens when I remove the cable from my &#039;wan&#039; and all the traffic goes through my &#039;wan2&#039;. When put back the cable and the router redirects the traffic to &#039;wan&#039; - everything works. Any ideas?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p246775">
				<div class="post-metadata">
					<div class="post-num">Post #898</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						11 Sep 2014, 19:38					</div>
				</div>
				<div class="post-content content">
					<p>Can you paste the troubleshooting output results please?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p246791">
				<div class="post-metadata">
					<div class="post-num">Post #899</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						11 Sep 2014, 23:51					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>uBoTo wrote:</cite><blockquote><p>The main problem is with opening HTTPS - google, youtube, facebook and websites that use secure http (I tried other sites that don&#039;t use https and everything was fine). The second thing - this problem is only with couple PCs. They have ping to google for example, but could not open <a href="https://google.com/">https://google.com/</a> ... I am trying to solve this problem whole day and - nothing. I tried different methods to clean dns cache and so on, but with no luck. This happens when I remove the cable from my &#039;wan&#039; and all the traffic goes through my &#039;wan2&#039;. When put back the cable and the router redirects the traffic to &#039;wan&#039; - everything works. Any ideas?</p></blockquote></div><p>I think i know what is going on..</p><p>The default mwan3 configuration comes with three preconfigured traffic rules. Two of them are for https traffic. The rules are preconfigured in a way that all LAN clients with last octet of it&#039;s ip address being even leaving interface wan1 and LAN clients with an ip address with an odd last octet leaving interface wan2. There is probably an error in one of those rules in your setup. That is why some clients do have working https and some clients don&#039;t.</p>											<p class="post-edited">(Last edited by <strong>Adze</strong> on 11 Sep 2014, 23:53)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p246863">
				<div class="post-metadata">
					<div class="post-num">Post #900</div>
					<div class="post-author">uBoTo</div>
					<div class="post-datetime">
						12 Sep 2014, 17:18					</div>
				</div>
				<div class="post-content content">
					<p>The problem was really with these rules:<br /></p><div class="quotebox"><blockquote><p>config rule &#039;sticky_even&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option src_ip &#039;0.0.0.0/0.0.0.1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option dest_port &#039;443&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;tcp&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option use_policy &#039;wan_wan2&#039;</p><p>config rule &#039;sticky_odd&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option src_ip &#039;0.0.0.1/0.0.0.1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option dest_port &#039;443&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;tcp&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option use_policy &#039;wan2_wan&#039;</p></blockquote></div><p>I removed them and everything is now OK. Maybe you should write down in the wiki about &quot;Configuration for failover only&quot;.</p>									</div>
			</article>

			
		
						<div class="notice">
				<p>Sorry, posts 901 to 900 are missing from our archive.</p>
			</div>
		
		
	
	<div class="pagination"><div class="pagination-number">Page 36 of 65</div><nav><ul><li><a href="viewtopic.php%3Fid=39052&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=34.html">34</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=35.html">35</a></li><li class="pagination-current"><span>36</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=37.html">37</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=38.html">38</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=65.html">65</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0.001 -->

</body>
</html>