<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> OpenWRT IPSec / StrongsWan tunnel to IPCop/IPFire giving up after 5try</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 21 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p350372">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">Paedy</div>
					<div class="post-datetime">
						27 Jan 2017, 18:00					</div>
				</div>
				<div class="post-content content">
					<p>Hey guys,</p><p>I followed all the IPSec tutorials.<br />The basics: wiki.openwrt[dot]org/doc/howto/vpn.ipsec.basics<br />The firewall: wiki.openwrt[dot]org/doc/howto/vpn.ipsec.firewall<br />The site to site: wiki.openwrt[dot]org/doc/howto/vpn.ipsec.site2site</p><p>And the result is if I&#039;m using:<br /><strong>/etc/init.d/ipsec start</strong></p><div class="codebox"><pre><code>Starting strongSwan 5.3.3 IPsec [starter]...
!! Your strongswan.conf contains manual plugin load options for charon.
!! This is recommended for experts only, see
!! wiki.strongswan.org/projects/strongswan/wiki/PluginLoad
initiating Main Mode IKE_SA acme-acme_lan[1] to 144.73.19.219
generating ID_PROT request 0 [ SA V V V V ]
sending packet: from 10.32.52.89[500] to 144.73.19.219[500] (156 bytes)
sending retransmit 1 of request message ID 0, seq 1
sending packet: from 10.32.52.89[500] to 144.73.19.219[500] (156 bytes)
sending retransmit 2 of request message ID 0, seq 1
sending packet: from 10.32.52.89[500] to 144.73.19.219[500] (156 bytes)
sending retransmit 3 of request message ID 0, seq 1
sending packet: from 10.32.52.89[500] to 144.73.19.219[500] (156 bytes)
sending retransmit 4 of request message ID 0, seq 1
sending packet: from 10.32.52.89[500] to 144.73.19.219[500] (156 bytes)
sending retransmit 5 of request message ID 0, seq 1
sending packet: from 10.32.52.89[500] to 144.73.19.219[500] (156 bytes)
giving up after 5 retransmits
peer not responding, trying again (2/3)
initiating Main Mode IKE_SA acme-acme_lan[1] to 144.73.19.219
generating ID_PROT request 0 [ SA V V V V ]
sending packet: from 10.32.52.89[500] to 144.73.19.219[500] (156 bytes)
sending retransmit 1 of request message ID 0, seq 1
sending packet: from 10.32.52.89[500] to 144.73.19.219[500] (156 bytes)
sending retransmit 2 of request message ID 0, seq 1
sending packet: from 10.32.52.89[500] to 144.73.19.219[500] (156 bytes)
sending retransmit 3 of request message ID 0, seq 1
sending packet: from 10.32.52.89[500] to 144.73.19.219[500] (156 bytes)
sending retransmit 4 of request message ID 0, seq 1
sending packet: from 10.32.52.89[500] to 144.73.19.219[500] (156 bytes)
sending retransmit 5 of request message ID 0, seq 1
sending packet: from 10.32.52.89[500] to 144.73.19.219[500] (156 bytes)</code></pre></div><p><strong>My local ip address of OpenWRT:</strong> 192.168.168.1 / 24<br /><strong>OpenWRT&#039;s WAN IP Adress:</strong> 89.204.139.89<br /><strong>IP Address of external site:</strong> 172.16.1.0 / 24<br /><strong>IP Address of external site WAN:</strong> 144.73.19.219</p><p><strong>Logs of LuCi System logs:</strong><br /></p><div class="codebox"><pre><code>Fri Jan 27 16:38:48 2017 authpriv.info ipsec_starter[8392]: charon (8393) started after 60 ms
Fri Jan 27 16:39:04 2017 authpriv.info ipsec_starter[8392]: charon stopped after 200 ms
Fri Jan 27 16:39:04 2017 authpriv.info ipsec_starter[8392]: ipsec starter stopped
Fri Jan 27 16:39:14 2017 authpriv.info ipsec_starter[8495]: Starting strongSwan 5.3.3 IPsec [starter]...
Fri Jan 27 16:39:14 2017 authpriv.info ipsec_starter[8495]: !! Your strongswan.conf contains manual plugin load options for charon.
Fri Jan 27 16:39:14 2017 authpriv.info ipsec_starter[8495]: !! This is recommended for experts only, see
Fri Jan 27 16:39:14 2017 authpriv.info ipsec_starter[8495]: !! wiki.strongswan.org/projects/strongswan/wiki/PluginLoad
Fri Jan 27 16:39:14 2017 daemon.err modprobe: ah4 is already loaded
Fri Jan 27 16:39:14 2017 daemon.err modprobe: esp4 is already loaded
Fri Jan 27 16:39:14 2017 daemon.err modprobe: ipcomp is already loaded
Fri Jan 27 16:39:14 2017 daemon.err modprobe: xfrm4_tunnel is already loaded
Fri Jan 27 16:39:14 2017 daemon.err modprobe: xfrm_user is already loaded
Fri Jan 27 16:39:14 2017 authpriv.info ipsec_starter[8508]: charon (8510) started after 60 ms
Fri Jan 27 16:39:14 2017 authpriv.info ipsec_starter[8508]: &#039;acme-acme_lan&#039; routed
Fri Jan 27 16:39:14 2017 authpriv.info ipsec_starter[8508]: 
Fri Jan 27 16:39:38 2017 authpriv.info ipsec_starter[8508]: charon stopped after 200 ms
Fri Jan 27 16:39:38 2017 authpriv.info ipsec_starter[8508]: ipsec starter stopped
Fri Jan 27 16:39:48 2017 authpriv.info ipsec_starter[8616]: Starting strongSwan 5.3.3 IPsec [starter]...
Fri Jan 27 16:39:48 2017 authpriv.info ipsec_starter[8616]: !! Your strongswan.conf contains manual plugin load options for charon.
Fri Jan 27 16:39:48 2017 authpriv.info ipsec_starter[8616]: !! This is recommended for experts only, see
Fri Jan 27 16:39:48 2017 authpriv.info ipsec_starter[8616]: !! wiki.strongswan.org/projects/strongswan/wiki/PluginLoad
Fri Jan 27 16:39:48 2017 daemon.err modprobe: ah4 is already loaded
Fri Jan 27 16:39:48 2017 daemon.err modprobe: esp4 is already loaded
Fri Jan 27 16:39:48 2017 daemon.err modprobe: ipcomp is already loaded
Fri Jan 27 16:39:48 2017 daemon.err modprobe: xfrm4_tunnel is already loaded
Fri Jan 27 16:39:48 2017 daemon.err modprobe: xfrm_user is already loaded
Fri Jan 27 16:39:48 2017 authpriv.info ipsec_starter[8629]: charon (8630) started after 60 ms
Fri Jan 27 16:39:48 2017 authpriv.info ipsec_starter[8629]: &#039;acme-acme_lan&#039; routed
Fri Jan 27 16:39:48 2017 authpriv.info ipsec_starter[8629]: </code></pre></div><p><strong>Logs of IPSec of IPCop/IPFire (its an IPCop!):</strong><br /></p><div class="codebox"><pre><code>16:36:51    pluto[29164]    &quot;ACME&quot; #10: transform (7,4,2,128) ignored.
16:36:51    pluto[29164]    &quot;ACME&quot; #10: transform (7,2,16,128) ignored.
16:36:51    pluto[29164]    &quot;ACME&quot; #10: transform (7,2,15,128) ignored.
16:36:51    pluto[29164]    &quot;ACME&quot; #10: transform (7,2,14,128) ignored.
16:36:51    pluto[29164]    &quot;ACME&quot; #10: transform (7,2,5,128) ignored.
16:36:51    pluto[29164]    &quot;ACME&quot; #10: transform (7,2,2,128) ignored.
16:42:51    pluto[29164]    pending Quick Mode with 89.204.139.89 &quot;ACME&quot; took too long -- replacing phase 1
16:42:51    pluto[29164]    &quot;ACME&quot;: terminating SAs using this connection
16:42:51    pluto[29164]    &quot;ACME&quot; #10: deleting state (STATE_AGGR_I1)
16:42:51    pluto[29164]    &quot;ACME&quot; #11: multiple DH groups were set in aggressive mode. Only first one used.
16:42:51    pluto[29164]    &quot;ACME&quot; #11: transform (7,6,15,256) ignored.
16:42:51    pluto[29164]    &quot;ACME&quot; #11: transform (7,6,14,256) ignored.
16:42:51    pluto[29164]    &quot;ACME&quot; #11: transform (7,6,5,256) ignored.
16:42:51    pluto[29164]    &quot;ACME&quot; #11: transform (7,6,2,256) ignored.
16:42:51    pluto[29164]    &quot;ACME&quot; #11: transform (7,4,16,256) ignored.
16:42:51    pluto[29164]    &quot;ACME&quot; #11: transform (7,4,15,256) ignored.
16:42:51    pluto[29164]    &quot;ACME&quot; #11: transform (7,4,14,256) ignored.
16:42:51    pluto[29164]    &quot;ACME&quot; #11: transform (7,4,5,256) ignored.
16:42:51    pluto[29164]    &quot;ACME&quot; #11: transform (7,4,2,256) ignored.
16:42:51    pluto[29164]    &quot;ACME&quot; #11: transform (7,2,16,256) ignored.
16:42:51    pluto[29164]    &quot;ACME&quot; #11: transform (7,2,15,256) ignored.
16:42:51    pluto[29164]    &quot;ACME&quot; #11: transform (7,2,14,256) ignored.
16:42:51    pluto[29164]    &quot;ACME&quot; #11: transform (7,2,5,256) ignored.
16:42:51    pluto[29164]    &quot;ACME&quot; #11: transform (7,2,2,256) ignored.
16:42:51    pluto[29164]    &quot;ACME&quot; #11: transform (7,6,16,128) ignored.
16:42:51    pluto[29164]    &quot;ACME&quot; #11: transform (7,6,15,128) ignored.
16:42:51    pluto[29164]    &quot;ACME&quot; #11: transform (7,6,14,128) ignored.
16:42:51    pluto[29164]    &quot;ACME&quot; #11: transform (7,6,5,128) ignored.
16:42:51    pluto[29164]    &quot;ACME&quot; #11: transform (7,6,2,128) ignored.
16:42:51    pluto[29164]    &quot;ACME&quot; #11: transform (7,4,16,128) ignored.
16:42:51    pluto[29164]    &quot;ACME&quot; #11: transform (7,4,15,128) ignored.
16:42:51    pluto[29164]    &quot;ACME&quot; #11: transform (7,4,14,128) ignored.
16:42:51    pluto[29164]    &quot;ACME&quot; #11: transform (7,4,5,128) ignored.
16:42:51    pluto[29164]    &quot;ACME&quot; #11: transform (7,4,2,128) ignored.
16:42:51    pluto[29164]    &quot;ACME&quot; #11: transform (7,2,16,128) ignored.
16:42:51    pluto[29164]    &quot;ACME&quot; #11: transform (7,2,15,128) ignored.
16:42:51    pluto[29164]    &quot;ACME&quot; #11: transform (7,2,14,128) ignored.
16:42:51    pluto[29164]    &quot;ACME&quot; #11: transform (7,2,5,128) ignored.
16:42:51    pluto[29164]    &quot;ACME&quot; #11: transform (7,2,2,128) ignored.
16:42:51    pluto[29164]    &quot;ACME&quot; #11: initiating Aggressive Mode #11, connection &quot;ACME&quot;
16:42:51    pluto[29164]    &quot;ACME&quot; #11: multiple DH groups were set in aggressive mode. Only first one used.
16:42:51    pluto[29164]    &quot;ACME&quot; #11: transform (7,6,15,256) ignored.
16:42:51    pluto[29164]    &quot;ACME&quot; #11: transform (7,6,14,256) ignored.
16:42:51    pluto[29164]    &quot;ACME&quot; #11: transform (7,6,5,256) ignored.
16:42:51    pluto[29164]    &quot;ACME&quot; #11: transform (7,6,2,256) ignored.
16:42:51    pluto[29164]    &quot;ACME&quot; #11: transform (7,4,16,256) ignored.
16:42:51    pluto[29164]    &quot;ACME&quot; #11: transform (7,4,15,256) ignored.
16:42:51    pluto[29164]    &quot;ACME&quot; #11: transform (7,4,14,256) ignored.
16:42:51    pluto[29164]    &quot;ACME&quot; #11: transform (7,4,5,256) ignored.
16:42:51    pluto[29164]    &quot;ACME&quot; #11: transform (7,4,2,256) ignored.
16:42:51    pluto[29164]    &quot;ACME&quot; #11: transform (7,2,16,256) ignored.
16:42:51    pluto[29164]    &quot;ACME&quot; #11: transform (7,2,15,256) ignored.
16:42:51    pluto[29164]    &quot;ACME&quot; #11: transform (7,2,14,256) ignored.
16:42:51    pluto[29164]    &quot;ACME&quot; #11: transform (7,2,5,256) ignored.
16:42:51    pluto[29164]    &quot;ACME&quot; #11: transform (7,2,2,256) ignored.
16:42:51    pluto[29164]    &quot;ACME&quot; #11: transform (7,6,16,128) ignored.
16:42:51    pluto[29164]    &quot;ACME&quot; #11: transform (7,6,15,128) ignored.
16:42:51    pluto[29164]    &quot;ACME&quot; #11: transform (7,6,14,128) ignored.
16:42:51    pluto[29164]    &quot;ACME&quot; #11: transform (7,6,5,128) ignored.
16:42:51    pluto[29164]    &quot;ACME&quot; #11: transform (7,6,2,128) ignored.
16:42:51    pluto[29164]    &quot;ACME&quot; #11: transform (7,4,16,128) ignored.
16:42:51    pluto[29164]    &quot;ACME&quot; #11: transform (7,4,15,128) ignored.
16:42:51    pluto[29164]    &quot;ACME&quot; #11: transform (7,4,14,128) ignored.
16:42:51    pluto[29164]    &quot;ACME&quot; #11: transform (7,4,5,128) ignored.
16:42:51    pluto[29164]    &quot;ACME&quot; #11: transform (7,4,2,128) ignored.
16:42:51    pluto[29164]    &quot;ACME&quot; #11: transform (7,2,16,128) ignored.
16:42:51    pluto[29164]    &quot;ACME&quot; #11: transform (7,2,15,128) ignored.
16:42:51    pluto[29164]    &quot;ACME&quot; #11: transform (7,2,14,128) ignored.
16:42:51    pluto[29164]    &quot;ACME&quot; #11: transform (7,2,5,128) ignored.
16:42:51    pluto[29164]    &quot;ACME&quot; #11: transform (7,2,2,128) ignored.</code></pre></div><p><strong>/etc/config/ipsec</strong><br /></p><div class="codebox"><pre><code>#/etc/config/ipsec
config &#039;ipsec&#039;
  list listen &#039;&#039;

config &#039;remote&#039; &#039;acme&#039;
  option &#039;enabled&#039; &#039;1&#039;
  option &#039;gateway&#039; &#039;144.73.19.219&#039;
  option &#039;authentication_method&#039; &#039;psk&#039;
  option &#039;pre_shared_key&#039; &#039;yourpasswordhere&#039;
  option &#039;exchange_mode&#039; &#039;aggressive&#039;
  list   &#039;p1_proposal&#039; &#039;pre_g2_aes_sha1&#039;
  list   &#039;tunnel&#039; &#039;acme_lan&#039;

config &#039;p1_proposal&#039; &#039;pre_g2_aes_sha1&#039;
  option &#039;encryption_algorithm&#039; &#039;aes128&#039;
  option &#039;hash_algorithm&#039; &#039;sha1&#039;
  option &#039;dh_group&#039; &#039;2&#039;

config &#039;tunnel&#039; &#039;acme_lan&#039;
  option &#039;local_subnet&#039; &#039;192.168.168.0/24&#039;
  option &#039;remote_subnet&#039; &#039;172.16.1.0/24&#039;
  option &#039;p2_proposal&#039; &#039;g2_aes_sha1&#039;

config &#039;p2_proposal&#039; &#039;g2_aes_sha1&#039;
  option &#039;pfs_group&#039; &#039;2&#039;
  option &#039;encryption_algorithm&#039; &#039;aes128&#039;
  option &#039;authentication_algorithm&#039; &#039;sha1&#039;</code></pre></div><p>Configuration of IPCop:<br />imgur.com/a/jiqjy (Screenshots!)</p><br /><p>Can anyone show me whats wrong?<br />Don&#039;t know where to check... I tried to change the IPSec Configuration very often.<br />I played around with some settings on IPCop. I tried the steps of the tutorials/guides/wiki twice.</p><p>Don&#039;t know :-(</p><p>Thanks in Advance for any ideas!</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>