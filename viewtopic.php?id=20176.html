<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Netgear WGT634U bricked</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 10 Mar 2018 and 30 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 2</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=20176&amp;p=2.html">2</a></li></ul></nav></div>
			
		
		
			<article class="post" id="p87219">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">mazilo</div>
					<div class="post-datetime">
						4 May 2009, 08:01					</div>
				</div>
				<div class="post-content content">
					<p>I have connected a serial-console cable to my WGT634U and the following was printed out on the console when I powered up my WGT634U.</p><div class="codebox"><pre><code>CFE version 1.0.34 for BCM95365R (32bit,SP,LE)
Build Date: Tue Feb 24 03:21:41 CST 2004 (root@jackylinux)
Copyright (C) 2000,2001,2002 Broadcom Corporation.

Add MAC client version(DNI).
Initializing Arena.
Initializing Devices.
et0: chipattach: NVRAM_GET(et0phyaddr) not found
et0: chipattach error
et0: etc_attach failed
Could not attach bcm4710 ethernet: -2
CPU type 0x29007: 200MHz
Total memory: 0x2000000 bytes (32MB)

Total memory used by CFE:  0x81BB1280 - 0x82000000 (4517248)
Initialized Data:          0x81BB1280 - 0x81BB3E90 (11280)
BSS Area:                  0x81BB3E90 - 0x81BB45D0 (1856)
Local Heap:                0x81BB45D0 - 0x81FB45D0 (4194304)
Stack Area:                0x81FB45D0 - 0x81FB65D0 (8192)
Text (code) segment:       0x81FB65E0 - 0x81FFFFB0 (301520)
Boot area (physical):      0x01B70000 - 0x01BB0000
Relocation Factor:         I:E23B65E0 - D:01BB0280

CFE&gt;</code></pre></div><p>I tried this <a href="http://oldwiki.openwrt.org/OpenWrtDocs(2f)Hardware(2f)Netgear(2f)WGT634U.html?highlight=(OpenWrtDocs/Hardware)">OpenWRT Doc for WGT634U</a>, but couldn&#039;t figure out how to proceed. At this point, I am clueless on how to debrick this WGT634U and am hoping anyone here can help. Thanks.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p87237">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">jochen</div>
					<div class="post-datetime">
						4 May 2009, 11:56					</div>
				</div>
				<div class="post-content content">
					<p>The next steps are explained <a href="http://oldwiki.openwrt.org/OpenWrtDocs(2f)Hardware(2f)Netgear(2f)WGT634U.html#head-13b1b97872eca588bb023b1260630188c3f71427">here</a></p>											<p class="post-edited">(Last edited by <strong>jochen</strong> on 4 May 2009, 11:58)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p87281">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">mazilo</div>
					<div class="post-datetime">
						4 May 2009, 19:49					</div>
				</div>
				<div class="post-content content">
					<p>I tried your suggestion and it gave me an error message like this:<br /></p><div class="codebox"><pre><code>Device et0 is not found</code></pre></div><p>So, I proceeded with <em>setenv -p</em> as shown <a href="http://people.zoy.org/~walken/wgt634u/HOWTO.html">here</a>. After this, the booting process stopped as shown below:</p><div class="codebox"><pre><code>CFE version 1.0.34 for BCM95365R (32bit,SP,LE)       
Build Date: Tue Feb 24 03:21:41 CST 2004 (root@jackylinux)
Copyright (C) 2000,2001,2002 Broadcom Corporation.        

Add MAC client version(DNI).
Initializing Arena.         
Initializing Devices.       
et0: Broadcom BCM47xx 10/100 Mbps Ethernet Controller
CPU type 0x29007: 200MHz                             
Total memory: 0x2000000 bytes (32MB)                 

Total memory used by CFE:  0x81BB1280 - 0x82000000 (4517248)
Initialized Data:          0x81BB1280 - 0x81BB3E90 (11280)  
BSS Area:                  0x81BB3E90 - 0x81BB45D0 (1856)                       
Local Heap:                0x81BB45D0 - 0x81FB45D0 (4194304)                    
Stack Area:                0x81FB45D0 - 0x81FB65D0 (8192)
Text (code) segment:       0x81FB65E0 - 0x81FFFFB0 (301520)
Boot area (physical):      0x01B70000 - 0x01BB0000
Relocation Factor:         I:E23B65E0 - D:01BB0280

configure vlans
*****************************************************************
*********************** VLAN Driver initial  ********************
*****************************************************************
Process LAN port(2-5) vlan Architecture...
SUCCESS: trying to create VLAN 0 for switch
SUCCESS: trying to add LAN port

Process WAN port(2-5) vlan Architecture...
SUCCESS: trying to create VLAN 0 for switch
SUCCESS: trying to add WAN port
SUCCESS: enable ports  success
Device eth0:  hwo device name specified.
CFE&gt; /ash: addr: not found
Invalid command: &quot;/ash: addr: not found&quot;
Available commands: , boot, load, save, ping, arp, ifconfig, show, unsetenv, prp

*** command status = -1
CFE&gt;</code></pre></div><p>At this point, CFE seems to be frozen and I can&#039;t do anything. I tried 30/30/30 reset and that won&#039;t work.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p87314">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">mazilo</div>
					<div class="post-datetime">
						5 May 2009, 06:42					</div>
				</div>
				<div class="post-content content">
					<p>Now, I am getting the following error messages on a serial-console when I powered up my WGT634U.<br /></p><div class="codebox"><pre><code>**********************************************
Process LAN port(2-5) vlan Architecture...
SUCCESS: trying to create VLAN 0 for switch
t, reboot, fprobe, envdev, test, set, loop, flash, memtest, f, e, d, u, autoboot, batch, go, boot, load, save, ping, arp, ifconfig, show, unsetenv, printenv, setenv, help

*** command status = -1
CFE&gt;  found
Invalid command: &quot;found&quot;s: copydisk, setup, reset, reboot, fprobe, envdev, test, set, loop, flash, memtest, f, e, d, u, autoboot, batch, go, boot, load, save, ping, arp, ifconfig, show, unsetenv, printenv, setenv, help

*** command status = -1
CFE&gt;  /bin/ash: CFE: not found
Invalid command: &quot;/bin/ash: CFE: not</code></pre></div><p>Typing anything doesn&#039;t seem to echo the characters typed. I certainly would appreciate if anyone can help.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p87720">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">sam0815</div>
					<div class="post-datetime">
						11 May 2009, 09:14					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>you could take a look at this post - seems to be a similar problem - maybe it helps</p><p><a href="http://forum.openwrt.org/viewtopic.php?id=4803">http://forum.openwrt.org/viewtopic.php?id=4803</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p87954">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">mazilo</div>
					<div class="post-datetime">
						14 May 2009, 06:38					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>sam0815 wrote:</cite><blockquote><p>Hi,</p><p>you could take a look at this post - seems to be a similar problem - maybe it helps</p><p><a href="http://forum.openwrt.org/viewtopic.php?id=4803">http://forum.openwrt.org/viewtopic.php?id=4803</a></p></blockquote></div><p>Many thanks and I will check that out.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p89087">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">KillaB</div>
					<div class="post-datetime">
						2 Jun 2009, 00:00					</div>
				</div>
				<div class="post-content content">
					<p>Here are the defaults from a working WGT:<br /></p><div class="codebox"><pre><code>BOOT_CONSOLE    uart1
boardtype       bcm95365r
et0mdcport      0
et0phyaddr      254
STARTUP         ifconfig eth0 -addr=192.168.1.1 -mask=255.255.255.0;boot -elf flash0.os:
kernel_args     console=ttyS1,115200 root=/dev/ram0 init=/linuxrc rw syst_size=8M
configvlan      0x1
et0macaddr      00-0f-b5-0b-98-16
et1macaddr      00-0f-b5-0b-98-17
CFE_VERSION     1.0.34
CFE_BOARDNAME   BCM95365R
CFE_MEMORYSIZE  32</code></pre></div><p>Example syntax:<br /></p><div class="codebox"><pre><code>CFE&gt; setenv -p STARTUP &quot;ifconfig eth0 -addr=192.168.1.1 -mask=255.255.255.0;boot -elf flash0.os:&quot;
CFE&gt; setenv -p configvlan 0x1</code></pre></div><p>After verifying everything with &quot;printenv&quot; use TFTP to download a new image (less than 4MB). <br /></p><div class="codebox"><pre><code>CFE&gt; flash -noheader 192.168.1.3:openwrt-wgt634u-2.6-squashfs.bin flash0.os</code></pre></div>											<p class="post-edited">(Last edited by <strong>KillaB</strong> on 2 Jun 2009, 00:04)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p89099">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">lizby</div>
					<div class="post-datetime">
						2 Jun 2009, 05:33					</div>
				</div>
				<div class="post-content content">
					<p>Having since my last flash (of more than 4 megabytes in two passes) not been able to get past the CFE&gt; prompt, I tried the settings in post 7, planning to flash the stock K809 image from Feb 15.&nbsp; I checked the settings with printenv, and rebooted.&nbsp; Since then the router continually reboots, every second or so, giving the following output.&nbsp; Power cycling has no effect. Ctrl-C has no effect and the reset button has no effect (it keeps rebooting every second or so).&nbsp; Am I left with nothing to do but fit a jtag connection?</p><div class="codebox"><pre><code>CFE version 1.0.34 for BCM95365R (32bit,SP,LE)
Build Date: Tue Feb 24 03:21:41 CST 2004 (root@jackylinux)
Copyright (C) 2000,2001,2002 Broadcom Corporation.

Add MAC client version(DNI).
Initializing Arena.
Initializing Devices.
et0: chipattach: NVRAM_GET(et0phyaddr) not found
et0: chipattach error
et0: etc_attach failed
Could not attach bcm4710 ethernet: -2
CPU type 0x29007: 200MHz
Total memory: 0x2000000 bytes (32MB)

Total memory used by CFE:  0x81BB1280 - 0x82000000 (4517248)
Initialized Data:          0x81BB1280 - 0x81BB3E90 (11280)
BSS Area:                  0x81BB3E90 - 0x81BB45D0 (1856)
Local Heap:                0x81BB45D0 - 0x81FB45D0 (4194304)
Stack Area:                0x81FB45D0 - 0x81FB65D0 (8192)
Text (code) segment:       0x81FB65E0 - 0x81FFFFB0 (301520)
Boot area (physical):      0x01B70000 - 0x01BB0000
Relocation Factor:         I:E23B65E0 - D:01BB0280

configure vlans
*****************************************************************
*********************** VLAN Driver initial  ********************
*****************************************************************
Process LAN port(2-5) vlan Architecture...
**Exception 8: EPC=00000028, Cause=00000008, VAddr=00000028
                RA=81FE0B80, PRID=00029007

        0  ($00) = 00000000     AT ($01) = A0000000
        v0 ($02) = 00000028     v1 ($03) = 00000000
        a0 ($04) = 81BB1EC0     a1 ($05) = 0000001E
        a2 ($06) = 00000010     a3 ($07) = 00003401
        t0 ($08) = 00000034     t1 ($09) = 81FE0AB0
        t2 ($10) = 0000000C     t3 ($11) = 00000001
        t4 ($12) = 81FC66D4     t5 ($13) = 00000000
        t6 ($14) = 00000000     t7 ($15) = 00000000
        s0 ($16) = 81BB5FF8     s1 ($17) = 00000034
        s2 ($18) = 00000002     s3 ($19) = 0000000A
        s4 ($20) = 81FE0AB0     s5 ($21) = 81FC21A8
        s6 ($22) = FFFE0428     s7 ($23) = 81FB65E0
        t8 ($24) = 02000000     t9 ($25) = E23B65E0
        k0 ($26) = 00000000     k1 ($27) = 81FB63A3
        gp ($28) = 81BB9280     sp ($29) = 81FB6450
        fp ($30) = 01BB0280     ra ($31) = 81FE0B80</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p89140">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">Conan</div>
					<div class="post-datetime">
						2 Jun 2009, 17:41					</div>
				</div>
				<div class="post-content content">
					<p>I have exactly the same problem -- my WGT634U keeps rebooting all the time...</p><p>What can we do to recover from this problem?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p89144">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">KillaB</div>
					<div class="post-datetime">
						2 Jun 2009, 18:09					</div>
				</div>
				<div class="post-content content">
					<p>Keep hitting CTRL-C continuously, immediately after applying power.&nbsp; You&#039;ll get in.</p>											<p class="post-edited">(Last edited by <strong>KillaB</strong> on 2 Jun 2009, 18:10)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p89152">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">Conan</div>
					<div class="post-datetime">
						2 Jun 2009, 19:36					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>KillaB wrote:</cite><blockquote><p>Keep hitting CTRL-C continuously, immediately after applying power.&nbsp; You&#039;ll get in.</p></blockquote></div><p>That does not work -- I don&#039;t get in...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p89157">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">mazilo</div>
					<div class="post-datetime">
						2 Jun 2009, 20:58					</div>
				</div>
				<div class="post-content content">
					<p>I lurked around and did not find any information about JTAG on a WGT634U that can be used to recover the unit. However, from the <a href="http://oldwiki.openwrt.org/OpenWrtDocs(2f)Hardware(2f)Netgear(2f)WGT634U.html">snapshot</a> on the OldWiki of OpenWRTDocs repository, there seems to be some sets of un-populated pinholes (on lower left-hand corner and beneath the miniPCI WiFi port) resemble a JTAG port. Can anyone confirm if this is a JTAG port and what is its PINs layout?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p89187">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">sam0815</div>
					<div class="post-datetime">
						3 Jun 2009, 10:31					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>lizby wrote:</cite><blockquote><div class="codebox"><pre><code>configure vlans
*****************************************************************
*********************** VLAN Driver initial  ********************
*****************************************************************
Process LAN port(2-5) vlan Architecture...
**Exception 8: EPC=00000028, Cause=00000008, VAddr=00000028
                RA=81FE0B80, PRID=00029007

        0  ($00) = 00000000     AT ($01) = A0000000
        v0 ($02) = 00000028     v1 ($03) = 00000000
        a0 ($04) = 81BB1EC0     a1 ($05) = 0000001E
        a2 ($06) = 00000010     a3 ($07) = 00003401
        t0 ($08) = 00000034     t1 ($09) = 81FE0AB0
        t2 ($10) = 0000000C     t3 ($11) = 00000001
        t4 ($12) = 81FC66D4     t5 ($13) = 00000000
        t6 ($14) = 00000000     t7 ($15) = 00000000
        s0 ($16) = 81BB5FF8     s1 ($17) = 00000034
        s2 ($18) = 00000002     s3 ($19) = 0000000A
        s4 ($20) = 81FE0AB0     s5 ($21) = 81FC21A8
        s6 ($22) = FFFE0428     s7 ($23) = 81FB65E0
        t8 ($24) = 02000000     t9 ($25) = E23B65E0
        k0 ($26) = 00000000     k1 ($27) = 81FB63A3
        gp ($28) = 81BB9280     sp ($29) = 81FB6450
        fp ($30) = 01BB0280     ra ($31) = 81FE0B80</code></pre></div></blockquote></div><p>I remember having a similar error - since I wasn&#039;t able to fix it with any openwrt-image I tried (7.09,8.09,etc.), I stumbled across this site<br /><a href="http://people.zoy.org/~walken/wgt634u/HOWTO.html">http://people.zoy.org/~walken/wgt634u/HOWTO.html</a></p><p>I followed the instructions, reinstalled Openwrt afterwards and the exception errors were gone...</p>											<p class="post-edited">(Last edited by <strong>sam0815</strong> on 2 Jun 2010, 12:10)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p89209">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">Conan</div>
					<div class="post-datetime">
						3 Jun 2009, 15:43					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ve tried getting a CFE prompt for hours now (Hitting CTRL-C like insane, plugin in power, ...) -- but it seems to be impossible.</p><p>The router keeps rebooting continously...</p><p>Is there some trick? What kind of terminal program do you use? I use minicom.</p><p>If I could get an CFE-prompt I could reflash the unit. BTW I really don&#039;t know what&nbsp; caused that error!?!?!?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p89213">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">KillaB</div>
					<div class="post-datetime">
						3 Jun 2009, 16:13					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Conan wrote:</cite><blockquote><p>Is there some trick? What kind of terminal program do you use? I use minicom.</p></blockquote></div><p>Have you verified your serial cable on another device?&nbsp; As long as your Tx pin is connected properly, I don&#039;t know what the problem could be.<br />I use HyperTerminal in XP.&nbsp; One hand hitting CTRL-C while the other hand inserts power.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p89223">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">Conan</div>
					<div class="post-datetime">
						3 Jun 2009, 19:23					</div>
				</div>
				<div class="post-content content">
					<p>That was the way it used to work before the router started rebooting itself all the time.</p><p>Since it is rebooting all the time, I can&#039;t get a CFE prompt anymore.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p89236">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">mazilo</div>
					<div class="post-datetime">
						3 Jun 2009, 21:10					</div>
				</div>
				<div class="post-content content">
					<p>As with my WGT634U, if I connected it through a USB/serial-console cable (used to work), I get all garbage characters using either screen or minicom (both configure to 115200 8N1). If I connect my WGT634U serial-port to the serial port of my FON2100, I would get the following if I keep ressing the ENTER key:<br /></p><div class="codebox"><pre><code>/bin/ash: Available: not found
Invalid command: &quot;/bin/ash: Available: not f
CFE&gt; /bin/ash: Available: not found
Invalid command: &quot;/bin/ash: Available: not found&quot;
AvailableE&gt; # /bin/ash: CFE: not found
Invalid command: &quot;# /bin/ash: CFE: not found&quot;
Available commands: copydisk, s/bin/ash: Available: not found
Invalid command: &quot;/bin/ash: Available: not fou/bin/ash: Available: not found
Invalid command: &quot;/bin/ash: Available: not found&quot;
Available commands: copydisk, setup, reset, reboot, fprobe, envdev, test, set, loop, flash, memtest, f, e, d, u, autoboot, batcgo, boot, load, save, ping, arp, ifconfig, show, unsetenv, printenv, setenv, help</code></pre></div><p>Trying to type anything is impossible, i.e. no response.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p89241">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">mazilo</div>
					<div class="post-datetime">
						3 Jun 2009, 22:05					</div>
				</div>
				<div class="post-content content">
					<p>More update on my WGT634U. After playing a&nbsp; bit, I am getting the following messages on the serial console of my FON2100 device:<br /></p><div class="codebox"><pre><code>lan Architecture...
SUCCESS: trying to create VLAN 0 for switch
y to get new two.....
MAC_Client enter
gpio output successLED ctl start</code></pre></div><p>Any clue on how to fix this?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p89276">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">RussellSenior</div>
					<div class="post-datetime">
						4 Jun 2009, 10:38					</div>
				</div>
				<div class="post-content content">
					<p>I had this same problem after flashing r15577, making some package additions using opkg, and rebooting.&nbsp; I used the values provided by KillaB above, except for the macaddrs which I reset using the values on my device&#039;s case.&nbsp; Also, remember to quote the long lines with embedded spaces (STARTUP and kernel_args).&nbsp; After setenv -p&#039;ing them, and then checking twice, a CFE reboot seemed to work.&nbsp; Whatever is causing that needs fixing though! ;-)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p89376">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">Conan</div>
					<div class="post-datetime">
						5 Jun 2009, 16:51					</div>
				</div>
				<div class="post-content content">
					<p>By just pressing CTRL+C I could not get a CFE-Prompt anymore.</p><p>I had to shorten Pins 26 and 27 of the flash-chip (That&#039;s some adress-lines) and press CTRL+C at the same time in minicom. This will cause the CFE-prompt to appear again. </p><p>Now I can try to flash a new image...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p89384">
				<div class="post-metadata">
					<div class="post-num">Post #21</div>
					<div class="post-author">zilla1000</div>
					<div class="post-datetime">
						5 Jun 2009, 17:53					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Conan wrote:</cite><blockquote><p>By just pressing CTRL+C I could not get a CFE-Prompt anymore.</p><p>I had to shorten Pins 26 and 27 of the flash-chip (That&#039;s some adress-lines) and press CTRL+C at the same time in minicom. This will cause the CFE-prompt to appear again. </p><p>Now I can try to flash a new image...</p></blockquote></div><p>I have the same issue after flashing 8.09.1; after following this procedure I was able to get the CFE&gt; prompt. However, from the printenv, my NVRAM seems to be corrupted with some &quot;non-printable&quot; character; how can I clear it ? </p><p>my printenv looks like this <br />CFE&gt; printenv<br />Variable Name&nbsp; &nbsp; &nbsp; &nbsp; Value<br />-------------------- --------------------------------------------------<br />BOOT_CONSOLE&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;uart1<br />41541&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ifconfionfionfiauto; bo; bo; boflash0.oh<br />boardtype&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bcm95365r<br />et0macaddr&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;00-00-00-53-65-10<br />et1macaddr&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;00-00-00-53-65-11<br />CFE_VERSION&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1.0.34<br />CFE_BOARDNAME&nbsp; &nbsp; &nbsp; &nbsp; BCM95365R<br />CFE_MEMORYSIZE&nbsp; &nbsp; &nbsp; &nbsp;32<br />*** command status = 0<br />CFE&gt;</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p89407">
				<div class="post-metadata">
					<div class="post-num">Post #22</div>
					<div class="post-author">mazilo</div>
					<div class="post-datetime">
						6 Jun 2009, 02:49					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Conan wrote:</cite><blockquote><p>I had to shorten Pins 26 and 27 of the flash-chip (That&#039;s some adress-lines) and press CTRL+C at the same time in minicom.</p></blockquote></div><p>Is this the intel TE28F640 flash chip? If so, that definiely some address lines!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p89472">
				<div class="post-metadata">
					<div class="post-num">Post #23</div>
					<div class="post-author">mrmr</div>
					<div class="post-datetime">
						7 Jun 2009, 12:33					</div>
				</div>
				<div class="post-content content">
					<p>@lizby<br />your problem seems to be some &quot;CFE NVRAM&quot; missing settings<br />look:<br /></p><div class="quotebox"><blockquote><p>et0: chipattach: NVRAM_GET(et0phyaddr) not found<br />et0: chipattach error<br />et0: etc_attach failed<br />Could not attach bcm4710 ethernet: -2</p></blockquote></div><p>so, as suggested by KillaB, access the CFE prompt and type:</p><p>&gt; setenv -p et0phyaddr 254</p><p>this will add the et0phyaddr to the CFE NVRAM (-p is the option to write the var into the flash)<br />After this, reboot and check what happens.<br />the hint is to have a &quot;printenv&quot; output similar to the one suggested&nbsp; by KillaB<br />clearly you can change both of the mac addresses (et0macaddr and et1macaddr)</p><br /><br /><br /><br /><br /><p>@zilla1000<br />if you refer to the following line:</p><div class="quotebox"><blockquote><p>41541&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ifconfionfionfiauto; bo; bo; boflash0.oh</p></blockquote></div><p>using:</p><p>&gt; unsetenv 41541&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </p><p>will not works.&nbsp; Just tested it, coping&amp;pasting the same &quot;string&quot; in your post and it&#039;s not working. Anyway, it shouldn&#039;t be a problem, having such variable in CFE NVRAM.</p><p>Look, if you&#039;re brave enought, in CFE help, there&#039;s a &quot;setup&quot; command.</p><div class="quotebox"><blockquote><p>CFE&gt; setup</p><p>Setup system configuration<br />WARNING: Invalid data could render system inoperable.<br />Press Enter for Platform name to Exit.<br />Enter Platform name:</p><p>&nbsp; &nbsp; &nbsp; &nbsp; bcm95365r - Broadcom BCM95365R Sentry5 VR/WAP/VPN GW Platform<br />&nbsp; &nbsp; &nbsp; &nbsp; bcm95365p - Broadcom BCM95365P Sentry5 PCI NIC Platform<br />&nbsp; &nbsp; &nbsp; &nbsp; bcm95365k - Broadcom BCM95365K Sentry5 PCI Platform<br />&nbsp; &nbsp; &nbsp; &nbsp; bu5365fpga - Broadcom BCM95365 53XXX Sentry5 FPGA Platform<br />&nbsp; &nbsp; &nbsp; &nbsp; bcm95380_rr - Broadcom BCM95380 RoboRouter/Sentry5 Dev Platform<br />&nbsp; &nbsp; &nbsp; &nbsp; bcm94702cpci - Broadcom BCM94702 CPCI Host Controller<br />&nbsp; &nbsp; &nbsp; &nbsp; bcm94710ap - Broadcom BCM94710AP WAP/Router<br />&nbsp; &nbsp; &nbsp; &nbsp; bcm94710 - Broadcom BCM94710D Dev Platform</p><p>Press Enter to exit<br />Enter platform string:<br />Configuration unchanged.<br />*** command status = 1</p></blockquote></div><p>I&#039;ve not tested it (my device is fine), but you could try it, choosing:</p><div class="quotebox"><blockquote><p>bcm95365r - Broadcom BCM95365R Sentry5 VR/WAP/VPN GW Platform</p></blockquote></div><p>I might be wrong, but that command should fill in the CFE NVRAM with platform &quot;default&quot; values</p><p>After this, remember to change &quot;default&quot; mac address (both of them) and add all the missing env VARs, as posted by KillaB.</p><br /><br /><br /><br /><p>@all<br />You hardly need a JTAG if you have bootloader prompt access.<br />You usually need the JTAG when you screw up your bootloader partition.</p><p>Also, for the CTRL-C problem. I think it can be tricky sometimes, but if you see CFE output you should be able to access the CFE prompt with CTRL-C.<br />I&#039;m using a pl2303 USB/Serial cable under XP using puttytray.</p><br /><p>On a side note...i don&#039;t like short-circuit those flash chips <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> it&#039;s VERY dungerous in my opinion.</p>											<p class="post-edited">(Last edited by <strong>mrmr</strong> on 7 Jun 2009, 12:56)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p89481">
				<div class="post-metadata">
					<div class="post-num">Post #24</div>
					<div class="post-author">zilla1000</div>
					<div class="post-datetime">
						7 Jun 2009, 18:30					</div>
				</div>
				<div class="post-content content">
					<p>Thank mrmr,</p><p>I tried the unsetenv with all the possible way of sending non-printable character, it did not work either. </p><p>I also tried the setenv, it did not make any difference it stay in the continuous reset as in lizby post.</p><br /><div class="codebox"><pre><code>CFE&gt; setup

Setup system configuration
WARNING: Invalid data could render system inoperable.
Press Enter for Platform name to Exit.
Enter Platform name: 

        bcm95365r - Broadcom BCM95365R Sentry5 VR/WAP/VPN GW Platform
        bcm95365p - Broadcom BCM95365P Sentry5 PCI NIC Platform
        bcm95365k - Broadcom BCM95365K Sentry5 PCI Platform
        bu5365fpga - Broadcom BCM95365 53XXX Sentry5 FPGA Platform
        bcm95380_rr - Broadcom BCM95380 RoboRouter/Sentry5 Dev Platform
        bcm94702cpci - Broadcom BCM94702 CPCI Host Controller
        bcm94710ap - Broadcom BCM94710AP WAP/Router
        bcm94710 - Broadcom BCM94710D Dev Platform

Press Enter to exit
Enter platform string:bcm95365r
Using platform[bcm95365r]
IP Interface Configuration type [DHCP/Static/None]:DHCP 
OS Boot type[FLASH/TFTP]:FLASH
Enter CFE Binary Partition name [BIPO]:
Configuring STARTUP for DHCP IP Configuration, FLASH OS Boot
Filesystem Type[RAMDISK/NFS/FLASH/Other]:FLASH
Enter Linux FLASH Device name [/dev/fl/0]:
Configuring Kernel for FLASH Root Filesystem Configuration
*** command status = 0
CFE&gt; printenv
Variable Name        Value
-------------------- --------------------------------------------------
BOOT_CONSOLE         uart1
41541              ifconfionfionfiauto; bo; bo; boflash0.oh
boardtype            bcm95365r
et0macaddr           00-00-00-53-65-10
et1macaddr           00-00-00-53-65-11
CFE_VERSION          1.0.34
CFE_BOARDNAME        BCM95365R
CFE_MEMORYSIZE       32
STARTUP              ifconfig eth0 -auto;boot -elf -fs=raw doc0:
kernel_args          console=ttyS1,115200 root= rw noinitrd
*** command status = 0
CFE&gt; reboot


CFE version 1.0.34 for BCM95365R (32bit,SP,LE)
Build Date: Tue Feb 24 03:21:41 CST 2004 (root@jackylinux)
Copyright (C) 2000,2001,2002 Broadcom Corporation.

Add MAC client version(DNI).
Initializing Arena.
Initializing Devices.
et0: chipattach: NVRAM_GET(et0mdcport) not found
et0: chipattach error
et0: etc_attach failed
Could not attach bcm4710 ethernet: -2
CPU type 0x29007: 200MHz
Total memory: 0x2000000 bytes (32MB)

Total memory used by CFE:  0x81BB1280 - 0x82000000 (4517248)
Initialized Data:          0x81BB1280 - 0x81BB3E90 (11280)
BSS Area:                  0x81BB3E90 - 0x81BB45D0 (1856)
Local Heap:                0x81BB45D0 - 0x81FB45D0 (4194304)
Stack Area:                0x81FB45D0 - 0x81FB65D0 (8192)
Text (code) segment:       0x81FB65E0 - 0x81FFFFB0 (301520)
Boot area (physical):      0x01B70000 - 0x01BB0000
Relocation Factor:         I:E23B65E0 - D:01BB0280

configure vlans
*****************************************************************
*********************** VLAN Driver initial  ********************
*****************************************************************
Process LAN port(2-5) vlan Architecture...
**Exception 8: EPC=00000028, Cause=00000008, VAddr=00000028
                RA=81FE0B80, PRID=00029007

        0  ($00) = 00000000     AT ($01) = A0000000
        v0 ($02) = 00000028     v1 ($03) = 00000000
        a0 ($04) = 81BB1EC0     a1 ($05) = 0000001E
        a2 ($06) = 00000010     a3 ($07) = 00003401
        t0 ($08) = 00000034     t1 ($09) = 81FE0AB0
        t2 ($10) = 0000000C     t3 ($11) = 00000001
        t4 ($12) = 81FC66D4     t5 ($13) = 00000000
        t6 ($14) = 00000000     t7 ($15) = 00000000
        s0 ($16) = 81BB5FF8     s1 ($17) = 00000034
        s2 ($18) = 00000002     s3 ($19) = 0000000A
        s4 ($20) = 81FE0AB0     s5 ($21) = 81FC21A8
        s6 ($22) = 00000001     s7 ($23) = 81FB65E0
        t8 ($24) = 02000000     t9 ($25) = E23B65E0
        k0 ($26) = 00000000     k1 ($27) = 81FB63A3
        gp ($28) = 81BB9280     sp ($29) = 81FB6450
        fp ($30) = 01BB0280     ra ($31) = 81FE0B80</code></pre></div><p>The only way that I can get the CFE&gt; prompt is via CTRL-C with short flash 26-27 pin. That seems to reset the NVRAM, the NVRAM is the same as before I ran the setenv.</p><div class="codebox"><pre><code>CFE&gt; ^C
CFE&gt; ^C
CFE&gt; ^C
CFE&gt; ^C
CFE&gt; 
CFE&gt; printenv
Variable Name        Value
-------------------- --------------------------------------------------
BOOT_CONSOLE         uart1
41541              ifconfionfionfiauto; bo; bo; boflash0.oh
boardtype            bcm95365r
et0macaddr           00-00-00-53-65-10
et1macaddr           00-00-00-53-65-11
CFE_VERSION          1.0.34
CFE_BOARDNAME        BCM95365R
CFE_MEMORYSIZE       32
*** command status = 0
CFE&gt;</code></pre></div><p>From DD-wrt forum (<a href="http://www.dd-wrt.com/phpBB2/viewtopic.php?t=28947&amp;postdays=0&amp;postorder=asc&amp;start=0">http://www.dd-wrt.com/phpBB2/viewtopic. … mp;start=0</a>), it does not seems to have a jtag support for WGT634U.<br />The ethernet is not working, due to lack of the setup in the NVRAM, and I juat can not update the NVRAM.<br />If this is not cause by bad NVRAM value, which means the CFE code itself is corrupted ? Any suggestions ?</p>											<p class="post-edited">(Last edited by <strong>zilla1000</strong> on 7 Jun 2009, 18:34)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p89527">
				<div class="post-metadata">
					<div class="post-num">Post #25</div>
					<div class="post-author">mrmr</div>
					<div class="post-datetime">
						8 Jun 2009, 21:30					</div>
				</div>
				<div class="post-content content">
					<p>@zilla1000<br />When your CFE NVRAM &quot;reset&quot; it still has &quot;default&quot; macaddress</p><div class="quotebox"><blockquote><p>et0macaddr&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;00-00-00-53-65-10<br />et1macaddr&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;00-00-00-53-65-11</p></blockquote></div><p>start changing those with:</p><p>&gt; setenv -p et0macaddr 00-00-de-ad-ca-fe<br />&gt; setenv -p et1macaddr 00-00-de-ad-ca-ff</p><p>after this, you need to add missing CFE NVRAM values.<br />The post from KillaB should help you...most likely you&#039;ll need:</p><p>&gt; setenv -p et0mdcport 0<br />&gt; setenv -p et0phyaddr 254<br />&gt; setenv -p configvlan 0x1<br />&gt; setenv -p STARTUP &quot;ifconfig eth0 -addr=192.168.1.1 -mask=255.255.255.0;boot -elf flash0.os:&quot;<br />&gt; setenv -p kernel_args &quot;console=ttyS1,115200 root=/dev/ram0 init=/linuxrc rw syst_size=8M&quot;</p><p>this should do...and as already said, don&#039;t mind your &quot;strange&quot; var there.<br />You said:</p><div class="quotebox"><blockquote><p>I also tried the setenv, it did not make any difference it stay in the continuous reset as in lizby post.</p></blockquote></div><p>Are you sure you added the &quot;-p&quot; option to setenv? the -p option write changes to the flash, while using setenv just set up the value temporarily.<br />Try those for a start...if they&#039;re not working, probably your flash is borked (too many writes?) or your CFE is screwed. Now, as stated onto the wiki, there&#039;s no JTAG port on the wgt (or so it seems), so we should find another way to reflash the CFE partition, but sadly i&#039;ve no idea how.</p>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 1 of 2</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=20176&amp;p=2.html">2</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>