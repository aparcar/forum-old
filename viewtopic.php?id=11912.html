<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> [Howto] Remote logging</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 7 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p53279">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">forum2006</div>
					<div class="post-datetime">
						2 Aug 2007, 18:15					</div>
				</div>
				<div class="post-content content">
					<p><strong><span class="bbu">Remote logging</span></strong></p><p><strong>1.</strong> Configure the Ubuntu syslog server to accept remote logging. Edit /etc/default/syslog and restart sysklogd.<br />/etc/default/syslog:<br /></p><div class="codebox"><pre><code>SYSLOGD=&quot;-u syslog -r&quot;</code></pre></div><div class="codebox"><pre><code>sudo /etc/init.d/ksyslogd restart</code></pre></div><p><strong>2.</strong> On the router set log_ip. log_ip is the IP address of your remote syslog server<br /></p><div class="codebox"><pre><code>uci set system.cfg1.log_ip=192.168.1.1
uci commit &amp;&amp; reboot</code></pre></div><p><strong>3.</strong> On the syslog server check if it&#039;s working. 192.168.178.3 is the IP address of the router. For Ubuntu run:</p><p>tail -f /var/log/syslog<br /></p><div class="codebox"><pre><code>ubuntu@ubuntu-laptop:~/openwrt/kamikaze_7.07_atheros$ tail -f /var/log/syslog
Aug  2 17:02:21 localhost syslogd 1.4.1#20ubuntu4: restart (remote reception).
Aug  2 17:02:21 localhost kernel: [13346.400000] process `syslogd&#039; is using obsolete setsockopt SO_BSDCOMPAT
Aug  2 17:02:24 localhost gconfd (root-9685): Der GConf-Server wird nicht verwendet und daher beendet.
Aug  2 17:02:24 localhost gconfd (root-9685): Beenden
Aug  2 17:07:17 192.168.178.3 kernel: wifi0: 11g rates: 1Mbps 2Mbps 5.5Mbps 11Mbps 6Mbps 9Mbps 12Mbps 18Mbps 24Mbps 36Mbps 48Mbps 54Mbps
Aug  2 17:07:22 192.168.178.3 kernel: wifi0: H/W encryption support: WEP AES AES_CCM TKIP
Aug  2 17:07:27 192.168.178.3 kernel: wifi0: mac 11.0 phy 4.8 radio 7.0
Aug  2 17:07:32 192.168.178.3 kernel: wifi0: Use hw queue 1 for WME_AC_BE traffic
Aug  2 17:07:37 192.168.178.3 kernel: wifi0: Use hw queue 0 for WME_AC_BK traffic
Aug  2 17:07:42 192.168.178.3 kernel: wifi0: Use hw queue 2 for WME_AC_VI traffic
Aug  2 17:07:47 192.168.178.3 kernel: wifi0: Use hw queue 3 for WME_AC_VO traffic
Aug  2 17:07:52 192.168.178.3 kernel: wifi0: Use hw queue 8 for CAB traffic
Aug  2 17:07:57 192.168.178.3 kernel: wifi0: Use hw queue 9 for beacons
Aug  2 17:08:02 192.168.178.3 kernel: wifi0: Atheros 2315 WiSoC: mem=0xb0000000, irq=3
Aug  2 17:08:07 192.168.178.3 kernel: device ath0 entered promiscuous mode
Aug  2 17:08:12 192.168.178.3 kernel: br-lan: port 2(ath0) entering learning state
Aug  2 17:08:17 192.168.178.3 kernel: br-lan: topology change detected, propagating
Aug  2 17:08:22 192.168.178.3 kernel: br-lan: port 2(ath0) entering forwarding state
Aug  2 17:08:27 192.168.178.3 kernel: device ath1 entered promiscuous mode
Aug  2 17:08:32 192.168.178.3 kernel: br-lan: port 3(ath1) entering learning state
Aug  2 17:08:37 192.168.178.3 kernel: br-lan: topology change detected, propagating
Aug  2 17:08:42 192.168.178.3 kernel: br-lan: port 3(ath1) entering forwarding state
Aug  2 17:08:47 192.168.178.3 crond[622]: crond 2.3.2 dillon, started, log level 8 
Aug  2 17:09:01 localhost /USR/SBIN/CRON[9866]: (root) CMD (  [ -d /var/lib/php5 ] &amp;&amp; find /var/lib/php5/ -type f -cmin +$(/usr/lib/php5/maxlifetime) -print0 | xargs -r -0 rm)</code></pre></div>											<p class="post-edited">(Last edited by <strong>forum2006</strong> on 2 Aug 2007, 18:19)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p95077">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">opotonil</div>
					<div class="post-datetime">
						29 Sep 2009, 19:29					</div>
				</div>
				<div class="post-content content">
					<p>Example configuration for OpenWrt 8.09.1 using config files:<br /></p><div class="codebox"><pre><code>root@openwrt:~# cat /etc/config/system
config &#039;system&#039;
        ...
        option &#039;log_ip&#039; &#039;192.168.1.2&#039;
        ...</code></pre></div><p>Bye.</p>											<p class="post-edited">(Last edited by <strong>opotonil</strong> on 29 Sep 2009, 19:29)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p95081">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">Dogge</div>
					<div class="post-datetime">
						29 Sep 2009, 20:46					</div>
				</div>
				<div class="post-content content">
					<p>For recent UCI versions run:</p><div class="codebox"><pre><code>uci set system.@system[0].log_ip=192.168.1.1
uci commit
reboot</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p95128">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">opotonil</div>
					<div class="post-datetime">
						30 Sep 2009, 19:52					</div>
				</div>
				<div class="post-content content">
					<p>the use config files is best or more standard that direct use of uci?</p><p>For me work ok, using config that I posted before.</p><p>Sorry for my english. Bye.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p96734">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">diego.misc</div>
					<div class="post-datetime">
						2 Nov 2009, 02:31					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><blockquote><p>the use config files is best or more standard that direct use of uci?</p></blockquote></div><p>From my understanding, while the final effect is the same (ie /etc/config/system gets modified), the use of UCI is preferred since it provides some sort of unified API for setting the different parameters for the router. I hope a more experienced user (I have openwrt installed since a few months, but only started playing seriously with it recently) or developer can confirm this statement.</p><p>Regarding the setting of the logging in Ubuntu, the initial post instructions are valid for the <em>syslogd</em> daemon, that has now been replaced with the <em>rsyslogd</em> daemon as the default log daemon for the distribution. In recent Ubuntu (or Debian) systems, the first step would be:</p><p><strong>1.1</strong> Edit the <em>/etc/rsyslogd.conf</em>file for allowing the rsyslog server to accept logs from UDP (port 514), by uncommenting the following lines:<br /></p><div class="codebox"><pre><code># provides UDP syslog reception
$ModLoad imudp
$UDPServerRun 514</code></pre></div><p>By default, rsyslogd will treat the remote logs as if they were local ones (meaning, among other things, the entries will end up in the same logfiles where the local logs are stored). In my setup, I found convenient to override that behaviour and instead place all the logs from my router in a different file:</p><p><strong>1.2</strong> (Optional) Create the file <em>/etc/rsyslogd.d/openwrt.conf</em> with the following contents:<br /></p><div class="codebox"><pre><code>:source, isequal, &quot;myrouter.mydomain&quot; /var/log/mylogfile.log
:source, isequal, &quot;myrouter.mydomain&quot; ~</code></pre></div><p>The first line logs the entries coming from &quot;myrouter.mydomain&quot; (can be expressed as an IP as well) into /varlog/mylogfile.log, while the second one prevents any further processing of the entry by discarding it (note the final tilde ~). A more complete description of the different configuration options [1] and example configurations [2] can be found on the rsyslogd man pages and wiki.</p><p>Hope it helps someone.</p><p>[1] <a href="http://www.rsyslog.com/doc-rsyslog_conf.html">http://www.rsyslog.com/doc-rsyslog_conf.html</a><br />[2] <a href="http://wiki.rsyslog.com/index.php/Configuration_Samples">http://wiki.rsyslog.com/index.php/Configuration_Samples</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p96771">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">aport</div>
					<div class="post-datetime">
						3 Nov 2009, 00:03					</div>
				</div>
				<div class="post-content content">
					<p>Editing the config directly or using UCI to set it is pretty much identical. The only real difference is that editing the config file directly is more like doing an immediate uci commit.</p><br /><p>For some things I prefer to edit the file directly, especially when it involves the awkward array syntax or does that cfg23422 crap.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p96857">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">aport</div>
					<div class="post-datetime">
						4 Nov 2009, 02:42					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>nicolezhu85 wrote:</cite><blockquote><p><a href="http://www.tradeshoes9.com">http://www.tradeshoes9.com</a>/</p></blockquote></div><p>Hey, cool spam broseph.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p149439">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">ymhee_bcex</div>
					<div class="post-datetime">
						24 Nov 2011, 01:24					</div>
				</div>
				<div class="post-content content">
					<p>To enable remote logging from Backfire (10.03.1-RC6) to Fedora (15):</p><p>0. Backfire comes with syslog preinstalled, and Fedora comes with rsyslog. There are probably situations when you need other packages (eg, syslog-ng), but these are good for me.</p><p>1. On <strong>Fedora</strong> enable UDP syslog reception. In /etc/rsyslog.conf uncomment the following lines:<br /></p><div class="codebox"><pre><code>$ModLoad imudp
$UDPServerRun 514</code></pre></div><p>Make sure that TCP syslog is either disabled or running on a different port. <br />Restart rsyslog: </p><div class="codebox"><pre><code>systemctl restart rsyslog.service</code></pre></div><p>2. In <strong>OpenWRT UI</strong> go to System tab, System subtab, Logging sub-subtab. Put the IP of the Fedora server there. Web-based UI in Backfire is powerful and easy to use, but you can confirm that the changes are saved in /etc/config/system as <span style="color: blue">option &#039;log_ip&#039; &#039;192.168.m.n&#039;</span></p><p>3. Here you need to restart syslogd on the <strong>router</strong>. I admit, I couldn&#039;t figure out how to do that <img src="https://forum.openwrt.org/img/smilies/mad.png" width="15" height="15" alt="mad" /> so I ended up just rebooting the router. Whatever you do, your ps output should show syslogd -R 192.168.m.n:514 (maybe some other switches like -C or -L).</p><p>3. Now look in /var/log/messages on <strong>Fedora</strong> server. You should see messages from the router. If your router is not busy, try to log in or log out - it should get recorded. You will also see the name that the router reports to syslog</p><p>4. if you want to combine router-based messages into single file, follow the advice from diego.misc above: Create the file /etc/rsyslogd.d/openwrt.conf with the following contents:<br /></p><div class="codebox"><pre><code>:source, isequal, &quot;myrouter.mydomain&quot; /var/log/mylogfile.log
:source, isequal, &quot;myrouter.mydomain&quot; ~</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p249842">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">vrdvaibhav</div>
					<div class="post-datetime">
						9 Oct 2014, 13:14					</div>
				</div>
				<div class="post-content content">
					<p>Is there any Guide for syslog-ng and Openwrt 12.09 .. ?</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>