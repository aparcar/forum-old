<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> OpenVPN Reconnect</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 22 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p152533">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">gusz</div>
					<div class="post-datetime">
						31 Dec 2011, 17:06					</div>
				</div>
				<div class="post-content content">
					<p>My setup is LAN --&gt; Ubiquity/OpenWRT Router --&gt; 2Wire DSL modem --&gt; ISP/Internet. My router runs Backfire (10.03.1-RC5, r27608) and connects to the<br />ISP (TelMex) using PPPoE. Above the ISP/PPPoE connection, I connect to a VPN server using OpenVPN. </p><p>My problem is that the ISP/PPPoE connection goes down frequently, and specifically every night in the early morning hours. My method to restart everything has been to disconnect the router and connect the modem directly to a PC, log in using Windows PPPoE client, reconnect through the OpenWRT router to the now-established PPPoE session, and thereafter re-establish the VPN connection on the router. What a PITA!</p><p>Is there a way to automate any/all of this? So far, I can&#039;t even get the OpenWRT router to connect to the ISP using PPPoE, without disconnecting it and using a Windows PC to do so, and thereafter reconnecting the router to the now-established PPPoE connection. Let alone .... getting OpenVPN to re-connect to the VPN server automatically.</p><p>I&#039;ve copied below my ifconfig after everything is working, and my OpenVPN config file. Recommendations to automate PPPoE and/or OpenVPN reconnect appreciated - Gus</p><br /><p># ifconfig<br />br-lan&nbsp; &nbsp; Link encap:Ethernet&nbsp; HWaddr 00:15:6D:C4:27:0A&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:192.168.1.1&nbsp; Bcast:192.168.1.255&nbsp; Mask:255.255.255.0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:108428 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:212552 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:8393516 (8.0 MiB)&nbsp; TX bytes:300867420 (286.9 MiB)</p><p>eth0&nbsp; &nbsp; &nbsp; Link encap:Ethernet&nbsp; HWaddr 00:15:6D:C4:27:09&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:219237 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:113550 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:1000 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:302768105 (288.7 MiB)&nbsp; TX bytes:10664274 (10.1 MiB)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Interrupt:4 </p><p>eth1&nbsp; &nbsp; &nbsp; Link encap:Ethernet&nbsp; HWaddr 00:15:6D:C4:27:0A&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:108428 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:212552 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:1000 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:9911508 (9.4 MiB)&nbsp; TX bytes:300867420 (286.9 MiB)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Interrupt:5 </p><p>lo&nbsp; &nbsp; &nbsp; &nbsp; Link encap:Local Loopback&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:127.0.0.1&nbsp; Mask:255.0.0.0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP LOOPBACK RUNNING&nbsp; MTU:16436&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:18 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:18 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:1218 (1.1 KiB)&nbsp; TX bytes:1218 (1.1 KiB)</p><p>mon.wlan0 Link encap:UNSPEC&nbsp; HWaddr 00-15-6D-84-CB-38-00-00-00-00-00-00-00-00-00-00&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:29303 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:0 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:1000 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:1876718 (1.7 MiB)&nbsp; TX bytes:0 (0.0 B)</p><p>pppoe-wan Link encap:Point-to-Point Protocol&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:189.177.191.157&nbsp; P-t-P:200.38.193.226&nbsp; Mask:255.255.255.255<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP POINTOPOINT RUNNING NOARP MULTICAST&nbsp; MTU:1492&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:210531 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:104853 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:3 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:297613939 (283.8 MiB)&nbsp; TX bytes:8095423 (7.7 MiB)</p><p>tun0&nbsp; &nbsp; &nbsp; Link encap:UNSPEC&nbsp; HWaddr 00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:10.8.6.134&nbsp; P-t-P:10.8.6.133&nbsp; Mask:255.255.255.255<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP POINTOPOINT RUNNING NOARP MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:234 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:469 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:100 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:125431 (122.4 KiB)&nbsp; TX bytes:66414 (64.8 KiB)</p><p>wlan0&nbsp; &nbsp; &nbsp;Link encap:Ethernet&nbsp; HWaddr 00:15:6D:84:CB:38&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:0 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:1495 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:1000 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:0 (0.0 B)&nbsp; TX bytes:228459 (223.1 KiB)</p><br /><p># cat ovpn.conf<br />remote 207.204.243.82 53<br />proto udp<br />ca /etc/openvpn/ca.crt<br />cert /etc/openvpn/ovpn208.crt<br />key /etc/openvpn/ovpn208.key<br />tls-auth /etc/openvpn/ta.key 1<br />cipher none<br />auth none<br />client<br />dev tun<br />resolv-retry infinite<br />nobind<br />persist-key<br />persist-tun<br />;http-proxy-retry # retry on connection failures<br />;http-proxy [proxy server] [proxy port #]<br />verb 4<br />mute 5<br />tun-mtu 1500<br />route-method exe<br />route-delay 2<br />redirect-gateway def1<br />comp-lzo yes<br /># explicit-exit-notify 2</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p152535">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">gusz</div>
					<div class="post-datetime">
						31 Dec 2011, 17:13					</div>
				</div>
				<div class="post-content content">
					<p>I should have included this file in my post ...... Gus</p><p># cat /etc/config/network</p><p>config &#039;interface&#039; &#039;loopback&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ifname&#039; &#039;lo&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;proto&#039; &#039;static&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ipaddr&#039; &#039;127.0.0.1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;netmask&#039; &#039;255.0.0.0&#039;</p><p>config &#039;interface&#039; &#039;lan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;type&#039; &#039;bridge&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;proto&#039; &#039;static&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ipaddr&#039; &#039;192.168.1.1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;netmask&#039; &#039;255.255.255.0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ifname&#039; &#039;eth1&#039;</p><p>config &#039;interface&#039; &#039;wan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ifname&#039; &#039;eth0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;proto&#039; &#039;pppoe&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;username&#039; &#039;xxxxxxxxxx&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;password&#039; &#039;xxxxxxxxxx&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;defaultroute&#039; &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;gateway&#039; &#039;200.38.193.226&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;dns&#039; &#039;216.131.95.20 216.131.94.5 208.67.222.222&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ppp_redial&#039; &#039;persist&#039;</p><p>config &#039;switch&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;name&#039; &#039;eth1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;reset&#039; &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;enable_vlan&#039; &#039;1&#039;</p><p>config &#039;switch_vlan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;device&#039; &#039;eth1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;vlan&#039; &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ports&#039; &#039;0 1 2 3 4&#039;</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>