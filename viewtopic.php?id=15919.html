<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> mounting a USB CDROM, simulated by a Novatel MC950D HSUPA G3 modem</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 22 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p69268">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">doddel</div>
					<div class="post-datetime">
						6 Jun 2008, 23:26					</div>
				</div>
				<div class="post-content content">
					<p>am struggling to get following issue resolved on a Asus WL500gp v1 with recent Kamikaze, home compiled on 2.4 basis (bleeding edge, r11377):<br />the USB G3.5 modem Novatel MC950D presents itself the first few minutes as a CDROM (usb 1410:5010) from the flash also built into that USB stick. It can be forced to become modem by an eject command and then becomes the modem with usb 1410:4400.<br />The problem:<br />the CDROM shows as a scsi device in /proc/scsi/scsi but does not show up in /dev as a cdrom device like /dev/scd0 or the like.<br />The eject command expects a device so how can I make the CDROM visble as a device that then can be ejected ?</p><p>If somebody knows the answer to the above question then comes the next: where to put the eject command so that whenever the CDROM pops up it gets ejected so I can get on with the modem functions ?</p><p>Any help appreciated !</p><p>--- /proc/scsi/scsi-----<br />Attached devices: <br />Host: scsi0 Channel: 00 Id: 00 Lun: 00<br />&nbsp; Vendor: Novatel&nbsp; Model: Mass Storage&nbsp; &nbsp; &nbsp;Rev: 1.00<br />&nbsp; Type:&nbsp; &nbsp;CD-ROM&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ANSI SCSI revision: 02<br />--------------------------<br />----- dmesg ----------------<br />uhci.c: USB Universal Host Controller Interface driver v1.1<br />PCI: Enabling device 01:03.0 (0000 -&gt; 0001)<br />uhci.c: USB UHCI at I/O 0x100, IRQ 2<br />usb.c: new USB bus registered, assigned bus number 1<br />hub.c: USB hub found<br />hub.c: 2 ports detected<br />PCI: Enabling device 01:03.1 (0000 -&gt; 0001)<br />uhci.c: USB UHCI at I/O 0x120, IRQ 2<br />usb.c: new USB bus registered, assigned bus number 2<br />hub.c: USB hub found<br />hub.c: 2 ports detected<br />usb-uhci.c: $Revision: 1.275 $ time 16:14:39 Jun&nbsp; 6 2008<br />usb-uhci.c: High bandwidth mode enabled<br />usb-uhci.c: v1.275:USB Universal Host Controller Interface driver<br />PCI: Enabling device 01:03.2 (0000 -&gt; 0002)<br />ehci_hcd 01:03.2: PCI device 1106:3104<br />ehci_hcd 01:03.2: irq 2, pci mem c022c000<br />usb.c: new USB bus registered, assigned bus number 3<br />EHCI: Enabling VIA 6212 workarounds<br />ehci_hcd 01:03.2: USB 2.0 enabled, EHCI 1.00, driver 2003-Dec-29/2.4<br />hub.c: USB hub found<br />hub.c: 4 ports detected<br />usb.c: registered new driver serial<br />usbserial.c: USB Serial support registered for Generic<br />usbserial.c: USB Serial Driver core v1.4<br />Initializing USB Mass Storage driver...<br />usb.c: registered new driver usb-storage<br />USB Mass Storage support registered.<br />hub.c: new USB device 01:03.0-1, assigned address 2<br />scsi0 : SCSI emulation for USB Mass Storage devices<br />&nbsp; Vendor: Novatel&nbsp; &nbsp;Model: Mass Storage&nbsp; &nbsp; &nbsp; Rev: 1.00<br />&nbsp; Type:&nbsp; &nbsp;CD-ROM&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ANSI SCSI revision: 02<br />WARNING: USB Mass Storage data integrity not assured<br />USB Mass Storage device found at 2<br />-------------------------------------------------------------<br />----cd //dev ; ls --------------<br />console&nbsp; &nbsp;full&nbsp; &nbsp; &nbsp; kmem&nbsp; &nbsp; &nbsp; mem&nbsp; &nbsp; &nbsp; &nbsp;mtdblock&nbsp; nvram&nbsp; &nbsp; &nbsp;ppp&nbsp; &nbsp; &nbsp; &nbsp;pts&nbsp; &nbsp; &nbsp; &nbsp;random&nbsp; &nbsp; scsi&nbsp; &nbsp; &nbsp; tts&nbsp; &nbsp; &nbsp; &nbsp;urandom&nbsp; &nbsp;zero<br />cua&nbsp; &nbsp; &nbsp; &nbsp;gpio&nbsp; &nbsp; &nbsp; log&nbsp; &nbsp; &nbsp; &nbsp;mtd&nbsp; &nbsp; &nbsp; &nbsp;null&nbsp; &nbsp; &nbsp; port&nbsp; &nbsp; &nbsp; ptmx&nbsp; &nbsp; &nbsp; pty&nbsp; &nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; shm&nbsp; &nbsp; &nbsp; &nbsp;tty&nbsp; &nbsp; &nbsp; &nbsp;usb<br />---------------------------------<br />---- lsmod --------------------<br />Module&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Size&nbsp; Used by&nbsp; &nbsp; Tainted: P<br />sg&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;29252&nbsp; &nbsp;0 (unused)<br />usb-storage&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 69632&nbsp; &nbsp;0<br />usbserial&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 23516&nbsp; &nbsp;0 (unused)<br />wlcompat&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 9504&nbsp; &nbsp;0 (unused)<br />ehci-hcd&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;20556&nbsp; &nbsp;0 (unused)<br />uhci&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;29060&nbsp; &nbsp;0 (unused)<br />sd_mod&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;12500&nbsp; &nbsp;0 (unused)<br />ip_conntrack_tftp&nbsp; &nbsp; &nbsp; &nbsp;1712&nbsp; &nbsp;0 (unused)<br />ip_nat_irc&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2336&nbsp; &nbsp;0 (unused)<br />ip_conntrack_irc&nbsp; &nbsp; &nbsp; &nbsp; 3128&nbsp; &nbsp;1<br />ip_nat_ftp&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2960&nbsp; &nbsp;0 (unused)<br />ip_conntrack_ftp&nbsp; &nbsp; &nbsp; &nbsp; 4272&nbsp; &nbsp;1<br />ipt_REDIRECT&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;640&nbsp; &nbsp;0 (unused)<br />ipt_NETMAP&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;624&nbsp; &nbsp;0 (unused)<br />ipt_MIRROR&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1296&nbsp; &nbsp;0 (unused)<br />ipt_TOS&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 976&nbsp; &nbsp;0 (unused)<br />ipt_TTL&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 944&nbsp; &nbsp;0 (unused)<br />ipt_MARK&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;592&nbsp; &nbsp;0 (unused)<br />ipt_ECN&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1616&nbsp; &nbsp;0 (unused)<br />ipt_DSCP&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;960&nbsp; &nbsp;0 (unused)<br />ipt_CLASSIFY&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;704&nbsp; &nbsp;0 (unused)<br />ipt_unclean&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;6832&nbsp; &nbsp;0 (unused)<br />ipt_ttl&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 496&nbsp; &nbsp;0 (unused)<br />ipt_tos&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 304&nbsp; &nbsp;0 (unused)<br />ipt_time&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1544&nbsp; &nbsp;0 (unused)<br />ipt_tcpmss&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;656&nbsp; &nbsp;0 (unused)<br />ipt_mark&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;304&nbsp; &nbsp;0 (unused)<br />ipt_mac&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 544&nbsp; &nbsp;0 (unused)<br />ipt_length&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;336&nbsp; &nbsp;0 (unused)<br />ipt_ecn&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 656&nbsp; &nbsp;0 (unused)<br />ipt_dscp&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;304&nbsp; &nbsp;0 (unused)<br />ipt_string&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 3240&nbsp; &nbsp;0 (unused)<br />ipt_layer7&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;10704&nbsp; &nbsp;0 (unused)<br />ipt_ipp2p&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;7320&nbsp; &nbsp;0 (unused)<br />ipt_LOG&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3792&nbsp; &nbsp;0 (unused)<br />ipt_pkttype&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 288&nbsp; &nbsp;0 (unused)<br />ipt_owner&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1280&nbsp; &nbsp;0 (unused)<br />ipt_condition&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1360&nbsp; &nbsp;0 (unused)<br />ipt_CONNMARK&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;816&nbsp; &nbsp;0 (unused)<br />ipt_recent&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 8208&nbsp; &nbsp;0 (unused)<br />ipt_helper&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;560&nbsp; &nbsp;0 (unused)<br />ipt_conntrack&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1104&nbsp; &nbsp;0 (unused)<br />ipt_connmark&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;352&nbsp; &nbsp;0 (unused)<br />ipt_connbytes&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1168&nbsp; &nbsp;0 (unused)<br />ppp_async&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;8044&nbsp; &nbsp;0 (unused)<br />ppp_generic&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 22380&nbsp; &nbsp;0 [ppp_async]<br />slhc&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 6064&nbsp; &nbsp;0 [ppp_generic]<br />vfat&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;11340&nbsp; &nbsp;0 (unused)<br />fat&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 34448&nbsp; &nbsp;0 [vfat]<br />isofs&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 19872&nbsp; &nbsp;0 (unused)<br />wl&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 666224&nbsp; &nbsp;0 (unused)<br />nls_iso8859-1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2672&nbsp; &nbsp;0 (unused)<br />usbcore&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 71296&nbsp; &nbsp;1 [usb-storage usbserial ehci-hcd uhci]<br />scsi_mod&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;66048&nbsp; &nbsp;3 [sg usb-storage sd_mod]<br />switch-robo&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5052&nbsp; &nbsp;0 (unused)<br />switch-core&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;4928&nbsp; &nbsp;0 [switch-robo]<br />diag&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;28736&nbsp; &nbsp;0 (unused)<br />-----------------------------------------------------------------------<br />--- cat /proc/scsi/usb-storage-0/0 -------------<br />&nbsp; &nbsp;Host scsi0: usb-storage<br />&nbsp; &nbsp; &nbsp; &nbsp;Vendor: Novatel Wireless<br />&nbsp; &nbsp; &nbsp; Product: Novatel Wireless HSUPA Modem<br />Serial Number: 356846010747010<br />&nbsp; &nbsp; &nbsp;Protocol: Transparent SCSI<br />&nbsp; &nbsp; Transport: Bulk<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;GUID: 141050100356846010747010<br />&nbsp; &nbsp; &nbsp;Attached: Yes<br />-----------------------------------------------------</p>											<p class="post-edited">(Last edited by <strong>doddel</strong> on 6 Jun 2008, 23:26)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p69315">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">dlbogdan</div>
					<div class="post-datetime">
						8 Jun 2008, 15:00					</div>
				</div>
				<div class="post-content content">
					<p>i&#039;m struggling with EXACTLY THE SAME PROBLEM. </p><br /><p>anyone?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p69318">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">doddel</div>
					<div class="post-datetime">
						8 Jun 2008, 15:50					</div>
				</div>
				<div class="post-content content">
					<p>in the mean time have also made a 2.6 compile, just for the experiment as it won&#039;t work with the broadcom radio as an AP, and adapted the airprime.c module to recognize the HSUPA modem device 1410:4400. Latter works fine once the module has switched its identity from cdrom to modem after the wait and then /dev/ttyUSB0 etc. show up.<br />But the initial cdrom issue is not resolved. The 1410:5010 device gives following effect:<br />------------ dmesg ------------------<br />usb 1-1: new full speed USB device using uhci_hcd and address 6<br />usb 1-1: configuration #1 chosen from 1 choice<br />scsi2 : SCSI emulation for USB Mass Storage devices<br />usb-storage: device found at 6<br />usb-storage: waiting for device to settle before scanning<br />scsi 2:0:0:0: CD-ROM&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Novatel&nbsp; Mass Storage&nbsp; &nbsp; &nbsp;1.00 PQ: 0 ANSI: 2<br />scsi 2:0:0:0: Attached scsi generic sg0 type 5<br />usb-storage: device scan complete<br />-----------------------------------------<br />the /dev/sg0 shows but cannot be mounted (mount: mounting /dev/sg0 on /mnt/cdrom failed: Block device required) or ejected<br /> (eject: //dev/sg0: Operation not permitted).<br />Perhaps cdrom drivers are required but where are they in OpenWrt ? I did compile and load the isofs file system module.<br />Anybody with ideas how to tackle this further in OpenWrt 2.4 or 2.6 so an eject command can be given to this usb device that mimicks a cdrom for an annoyingly long time before becoming a modem.</p><p>Have given the Novatel stick a try on a laptop with Debian and there the CDROM is mounted (but the modem later not recognised).<br />In Debian Etch it is not /dev/sg0 that gets made but /dev/sr0 and there are modules present &#039;cdrom&#039; and &#039;sr_mod&#039;. As file system UDF-fs gets used.<br />So the solution is probably either to compile those into OpenWrt, or to figure out a way to give out a command per scsi/sg0 that amounts to &#039;eject&#039;. After all we don&#039;t want access to the storage but want to switch the stick to its modem function.</p>											<p class="post-edited">(Last edited by <strong>doddel</strong> on 8 Jun 2008, 16:29)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p69319">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">doddel</div>
					<div class="post-datetime">
						8 Jun 2008, 17:39					</div>
				</div>
				<div class="post-content content">
					<p>in 2.6 compile found this solution to the problem:</p><p>in &#039;make menuconfig&#039; include the utility &#039;sdparm&#039;. (utilities/disc/sdparm)</p><p>Upon connection of the usb stick issue from &#039;sdparm&#039; the command eject. And gone is the CDROM and there comes the modem ....</p><p>root@OpenWrt:/# sdparm --command=eject //dev/sg0<br />&nbsp; &nbsp; //dev/sg0: Novatel&nbsp; Mass Storage&nbsp; 1.00&nbsp; [cd/dvd]</p><p>This utility just issues commands on the scsi bus and that&#039;s enough for our purpose.</p><p>In 2.4 following command works along the same lines but we need to point at the precise scsi node:<br />root@OpenWrt:/# sdparm --command=eject /dev/scsi/host0/bus0/target0/lun0/generic</p><p>and after that dmesg shows:<br />usbserial.c: Generic converter detected<br />usbserial.c: Generic converter now attached to ttyUSB0 (or usb/tts/0 for devfs)<br />usbserial.c: Generic converter detected<br />usbserial.c: Generic converter now attached to ttyUSB1 (or usb/tts/1 for devfs)</p><p>Latest update:<br />Of course the problem has been encountered before.<br />Just found this link that provides 2.6 code for a series of G3 adapters.<br /><a href="http://www.draisberghof.de/usb_modeswitch/">http://www.draisberghof.de/usb_modeswitch/</a></p><p>Assuming Kamikaze linux 2.4 on the Asus WL400gp v1 (broadcom mini-pci radio) and the presence of sdparm, the following hotplug script will switch the MC950D device to being modem when booting or connecting it:</p><p>---------- //etc/hotplug.d/usb/20-novatel_switch ----------<br />#!/bin/sh</p><p>case &quot;$ACTION&quot; in<br />&nbsp; &nbsp; add)<br />&nbsp; &nbsp; &nbsp; &nbsp; ( //usr/sbin/lsusb | grep -q &#039;1410:5010&#039; ) &amp;&amp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /usr/bin/sdparm --command=eject /dev/scsi/host0/bus0/target0/lun0/generic<br />&nbsp; &nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp; &nbsp; &nbsp; ;;<br />esac<br />------------------------------------------------------------------</p>											<p class="post-edited">(Last edited by <strong>doddel</strong> on 8 Jun 2008, 23:13)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>