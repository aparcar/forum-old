<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Pogoplug Mobile hardware support and device tree effort</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 22 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p247393">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">beata</div>
					<div class="post-datetime">
						18 Sep 2014, 14:30					</div>
				</div>
				<div class="post-content content">
					<p>I propose using this topic to gather the information necessary for full kernel/driver support, and then to document any available board-level hacking.</p><p>I shall begin:<br />I use an open case unit with wires soldered on to the UART pads.<br />I have a logic probe comprised of a test clip, a long cable, an LED and a 100ohm resistor terminated to ground.<br />I used the following script to pulse the IO pins through the gpio sys interface:</p><p>foo=28 ; echo $foo &gt; /sys/class/gpio/export ; echo out &gt; <br />/sys/class/gpio/gpio$foo/direction; while true ; do echo 1 &gt; <br />/sys/class/gpio/gpio$foo/value ; sleep 1 ; echo 0 &gt; <br />/sys/class/gpio/gpio$foo/value ; sleep 1 ; done</p><p>I verified that MPP10 and MPP11 are the uart data lines (The GPIO export detached the uart from those lines)<br />I verified that MPP12-MPP17 are connected to the SD card socket pins.<br />I verified that MPP27 is connected to the socket&#039;s card detect switch (at bottom right)<br />I learned that MPP28 is connected to the socket&#039;s write protect switch, and I was amazed, for the mighty Debian did not know it exists.<br />MPP29 is the button.</p><p>What I DO NOT yet know:<br />Pin mapping to the bare sATA header.<br />Pin mapping for the second, unpopulated button.<br />What this USB power thing is. Our e02 boardfile wants it to be on MPP29. The Debian wants it to be on MPP10.<br />Do we even NEED it?<br />Pin mapping to the SPI/JTAG/whatever. Just slipped my mind.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p247403">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">yoyellow</div>
					<div class="post-datetime">
						18 Sep 2014, 16:50					</div>
				</div>
				<div class="post-content content">
					<p>i have an Pogoplug V4 (the one with usb3 and sata) and would love to get support for this as well.</p><p>as the pogo mobile and the v4 are the same except for the usb3 and sata, could we add this as well.</p><p>any information you need i can give, thou i need some guidance in how to get it.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p247406">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">beata</div>
					<div class="post-datetime">
						18 Sep 2014, 18:00					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m quite learning this stuff as I go along.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p247813">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">beata</div>
					<div class="post-datetime">
						23 Sep 2014, 06:19					</div>
				</div>
				<div class="post-content content">
					<p>I managed to throw something together, SD socket and the LEDs working. Will shortly be making it presentable. Shiny new boot logs, SD card and USB flash, with the *same* system (copied) on both.</p><p>USB:<br /></p><div class="codebox"><pre><code>U-Boot 2014.07-tld-1 (Jul 18 2014 - 00:59:45)
Pogoplug V4

SoC:   Kirkwood 88F6192_A1
DRAM:  128 MiB
WARNING: Caches not enabled
NAND:  128 MiB
MMC:   kwsdio: 0
In:    serial
Out:   serial
Err:   serial
Net:   egiga0
Hit any key to stop autoboot: 10  9  8  7  6  5  4  3  2  1  0 
(Re)start USB...
USB0:   USB EHCI 1.00
scanning bus 0 for devices... 2 USB Device(s) found
       scanning usb for storage devices... 1 Storage Device(s) found
1783809 bytes read in 378 ms (4.5 MiB/s)
** File not found /boot/uInitrd **
## Booting kernel from Legacy Image at 00800000 ...
   Image Name:   ARM OpenWrt Linux-3.14.18
   Created:      2014-09-23   1:56:33 UTC
   Image Type:   ARM Linux Kernel Image (uncompressed)
   Data Size:    1783745 Bytes = 1.7 MiB
   Load Address: 00008000
   Entry Point:  00008000
   Verifying Checksum ... OK
   Loading Kernel Image ... OK
Using machid 0xf78 from environment

Starting kernel ...

Uncompressing Linux... done, booting the kernel.
[    0.000000] Booting Linux on physical CPU 0x0
[    0.000000] Linux version 3.14.18 (beata@nutria) (gcc version 4.8.3 (OpenWrt/Linaro GCC 4.8-2014.04 r42162) ) #9 Mon Sep 22 18:55:46 PDT 2014
[    0.000000] CPU: Feroceon 88FR131 [56251311] revision 1 (ARMv5TE), cr=00053977
[    0.000000] CPU: VIVT data cache, VIVT instruction cache
[    0.000000] Machine model: Cloud Engines Pogoplug Mobile
[    0.000000] Memory policy: Data cache writeback
[    0.000000] Built 1 zonelists in Zone order, mobility grouping on.  Total pages: 32512
[    0.000000] Kernel command line: console=ttyS0,115200 root=/dev/sda1 rootdelay=10 rootfstype=ext3 mtdparts=orion_nand:2M(u-boot),3M(uImage),3M(uImage2),8M(failsafe),112M(root)
[    0.000000] PID hash table entries: 512 (order: -1, 2048 bytes)
[    0.000000] Dentry cache hash table entries: 16384 (order: 4, 65536 bytes)
[    0.000000] Inode-cache hash table entries: 8192 (order: 3, 32768 bytes)
[    0.000000] Memory: 124696K/131072K available (3614K kernel code, 168K rwdata, 1024K rodata, 144K init, 189K bss, 6376K reserved)
[    0.000000] Virtual kernel memory layout:
[    0.000000]     vector  : 0xffff0000 - 0xffff1000   (   4 kB)
[    0.000000]     fixmap  : 0xfff00000 - 0xfffe0000   ( 896 kB)
[    0.000000]     vmalloc : 0xc8800000 - 0xff000000   ( 872 MB)
[    0.000000]     lowmem  : 0xc0000000 - 0xc8000000   ( 128 MB)
[    0.000000]     modules : 0xbf000000 - 0xc0000000   (  16 MB)
[    0.000000]       .text : 0xc0008000 - 0xc048fd6c   (4640 kB)
[    0.000000]       .init : 0xc0490000 - 0xc04b4384   ( 145 kB)
[    0.000000]       .data : 0xc04b6000 - 0xc04e009c   ( 169 kB)
[    0.000000]        .bss : 0xc04e009c - 0xc050f5bc   ( 190 kB)
[    0.000000] NR_IRQS:114
[    0.000024] sched_clock: 32 bits at 166MHz, resolution 6ns, wraps every 25769803770ns
[    0.000214] Calibrating delay loop... 795.44 BogoMIPS (lpj=3977216)
[    0.040128] pid_max: default: 32768 minimum: 301
[    0.040313] Mount-cache hash table entries: 1024 (order: 0, 4096 bytes)
[    0.040341] Mountpoint-cache hash table entries: 1024 (order: 0, 4096 bytes)
[    0.043339] CPU: Testing write buffer coherency: ok
[    0.043817] Setting up static identity map for 0x12788 - 0x127c4
[    0.046738] pinctrl core: initialized pinctrl subsystem
[    0.048396] regulator-dummy: no parameters
[    0.049189] NET: Registered protocol family 16
[    0.049802] DMA: preallocated 256 KiB pool for atomic coherent allocations
[    0.054163] cpuidle: using governor ladder
[    0.054192] cpuidle: using governor menu
[    0.054300] Kirkwood: MV88F6281-A1.
[    0.054507] Feroceon L2: Enabling L2
[    0.054560] Feroceon L2: Cache support initialised.
[    0.055341] [Firmware Info]: /ocp@f1000000/ethernet-controller@72000/ethernet0-port@0: local-mac-address is not set
[    0.079744] bio: create slab &lt;bio-0&gt; at 0
[    0.081610] SCSI subsystem initialized
[    0.083371] usbcore: registered new interface driver usbfs
[    0.083613] usbcore: registered new interface driver hub
[    0.083859] usbcore: registered new device driver usb
[    0.086450] Switched to clocksource orion_clocksource
[    0.089837] NET: Registered protocol family 2
[    0.091058] TCP established hash table entries: 1024 (order: 0, 4096 bytes)
[    0.091092] TCP bind hash table entries: 1024 (order: 0, 4096 bytes)
[    0.091120] TCP: Hash tables configured (established 1024 bind 1024)
[    0.091200] TCP: reno registered
[    0.091221] UDP hash table entries: 256 (order: 0, 4096 bytes)
[    0.091251] UDP-Lite hash table entries: 256 (order: 0, 4096 bytes)
[    0.091491] NET: Registered protocol family 1
[    0.093688] futex hash table entries: 256 (order: -1, 3072 bytes)
[    0.094433] squashfs: version 4.0 (2009/01/31) Phillip Lougher
[    0.094450] jffs2: version 2.2 (NAND) (SUMMARY) (LZMA) (RTIME) (CMODE_PRIORITY) (c) 2001-2006 Red Hat, Inc.
[    0.094761] msgmni has been set to 243
[    0.095260] io scheduler noop registered
[    0.095274] io scheduler deadline registered (default)
[    0.096891] kirkwood-pinctrl f1010000.pinctrl: unknown pinctrl group 36
[    0.096913] kirkwood-pinctrl f1010000.pinctrl: unknown pinctrl group 37
[    0.096928] kirkwood-pinctrl f1010000.pinctrl: unknown pinctrl group 38
[    0.096943] kirkwood-pinctrl f1010000.pinctrl: unknown pinctrl group 39
[    0.096957] kirkwood-pinctrl f1010000.pinctrl: unknown pinctrl group 40
[    0.096972] kirkwood-pinctrl f1010000.pinctrl: unknown pinctrl group 41
[    0.096987] kirkwood-pinctrl f1010000.pinctrl: unknown pinctrl group 42
[    0.097001] kirkwood-pinctrl f1010000.pinctrl: unknown pinctrl group 43
[    0.097016] kirkwood-pinctrl f1010000.pinctrl: unknown pinctrl group 44
[    0.097030] kirkwood-pinctrl f1010000.pinctrl: unknown pinctrl group 45
[    0.097045] kirkwood-pinctrl f1010000.p[    2.136481] rtc-mv f1010300.rtc: internal RTC not ticking
[    2.143747] orion_wdt: Initial timeout 25 sec
[    2.149934] mvsdio f1090000.mvsdio: Got CD GPIO #27.
[    2.154931] mvsdio f1090000.mvsdio: Got WP GPIO #28.
[    2.196484] mvsdio f1090000.mvsdio: using GPIO for card detection
[    2.207526] ledtrig-cpu: registered to indicate activity on CPUs
[    2.213874] TCP: cubic registered
[    2.217227] mvsdio f1090000.mvsdio: unhandled interrupt status=0x8810 en=0x0000 pio=0
[    2.225046] NET: Registered protocol family 17
[    2.229500] mvsdio f1090000.mvsdio: unhandled interrupt status=0x0810 en=0x0000 pio=0
[    2.237427] Bridge firewalling registered
[    2.244723] 8021q: 802.1Q VLAN Support v1.8
[    2.248934] mvsdio f1090000.mvsdio: unhandled interrupt status=0x8810 en=0x0000 pio=0
[    2.258554] regulator-dummy: disabling
[    2.263813] input: gpio-keys.2 as /devices/gpio-keys.2/input/input0
[    2.270672] drivers/rtc/hctosys.c: unable to open rtc device (rtc0)
[    2.278304] Waiting 10 sec before mounting root device...
[    2.321062] mmc0: new SD card at address e624
[    2.326051] mmcblk0: mmc0:e624 SD512 483 MiB 
[    2.332038]  mmcblk0: p1
[    2.597942] scsi 0:0:0:0: Direct-Access     SanDisk  Cruzer Facet     1.26 PQ: 0 ANSI: 5
[    2.608481] sd 0:0:0:0: [sda] 15633408 512-byte logical blocks: (8.00 GB/7.45 GiB)
[    2.617460] sd 0:0:0:0: [sda] Write Protect is off
[    2.622963] sd 0:0:0:0: [sda] Write cache: disabled, read cache: enabled, doesn&#039;t support DPO or FUA
[    2.637526]  sda: sda1
[    2.643088] sd 0:0:0:0: [sda] Attached SCSI removable disk
[   12.286615] UBIFS error (pid 1): ubifs_mount: cannot open &quot;ubi0:rootfs&quot;, error -19
[   12.295476] EXT4-fs (sda1): mounting ext3 file system using the ext4 subsystem
[   12.304320] EXT4-fs (sda1): INFO: recovery required on readonly filesystem
[   12.311203] EXT4-fs (sda1): write access will be enabled during recovery
[   12.345598] EXT4-fs (sda1): recovery complete
[   12.353086] EXT4-fs (sda1): mounted filesystem with ordered data mode. Opts: (null)
[   12.360782] VFS: Mounted root (ext3 filesystem) readonly on device 8:1.
[   12.368056] Freeing unused kernel memory: 144K (c0490000 - c04b4000)
procd: Console is alive
procd: - watchdog -
[   12.627049] sdhci: Secure Digital Host Controller Interface driver
[   12.633207] sdhci: Copyright(c) Pierre Ossman
[   12.638561] sdhci-pltfm: SDHCI platform and OF driver helper
procd: - preinit -
[   12.703322] random: mktemp urandom read with 40 bits of entropy available
Press the [f] key and hit [enter] to enter failsafe mode
Press the [1], [2], [3] or [4] key and hit [enter] to select the debug level
mounting /dev/root
[   15.797252] EXT4-fs (sda1): re-mounted. Opts: (null)
procd: - early -
procd: - watchdog -
procd: - ubus -
procd: - init -
Please press Enter to activate this console.
[   17.064890] NET: Registered protocol family 10
[   17.075475] Key type dns_resolver registered
[   17.097069] RPC: Registered named UNIX socket transport module.
[   17.103008] RPC: Registered udp transport module.
[   17.107716] RPC: Registered tcp transport module.
[   17.112401] RPC: Registered tcp NFSv4.1 backchannel transport module.
[   17.138494] Installing knfsd (copyright (C) 1996 okir@monad.swb.de).
[   17.149112] cryptodev: driver 1.6 loaded.
[   17.160494] usbcore: registered new interface driver i2c-tiny-usb
[   17.172929] hidraw: raw HID events driver (C) Jiri Kosina
[   17.184680] fuse init (API version 7.22)
[   19.158639] random: nonblocking pool is initialized
[   19.509156] IPv6: ADDRCONF(NETDEV_UP): eth0: link is not ready
[   21.267702] mv643xx_eth_port mv643xx_eth_port.0 eth0: link up, 100 Mb/s, full duplex, flow control disabled
[   21.277479] IPv6: ADDRCONF(NETDEV_CHANGE): eth0: link becomes ready



BusyBox v1.22.1 (2014-09-22 02:34:23 PDT) built-in shell (ash)
Enter &#039;help&#039; for a list of built-in commands.

  _______                     ________        __
 |       |.-----.-----.-----.|  |  |  |.----.|  |_
 |   -   ||  _  |  -__|     ||  |  |  ||   _||   _|
 |_______||   __|_____|__|__||________||__|  |____|
          |__| W I R E L E S S   F R E E D O M
 -----------------------------------------------------
 CHAOS CALMER (14.07-rc2, r42642)
 -----------------------------------------------------
  * 1 1/2 oz Gin            Shake with a glassful
  * 1/4 oz Triple Sec       of broken ice and pour
  * 3/4 oz Lime Juice       unstrained into a goblet.
  * 1 1/2 oz Orange Juice
  * 1 tsp. Grenadine Syrup
 -----------------------------------------------------
root@OpenWrt:/# </code></pre></div><p>SD:<br /></p><div class="codebox"><pre><code>U-Boot 2014.07-tld-1 (Jul 18 2014 - 00:59:45)
Pogoplug V4

SoC:   Kirkwood 88F6192_A1
DRAM:  128 MiB
WARNING: Caches not enabled
NAND:  128 MiB
MMC:   kwsdio: 0
In:    serial
Out:   serial
Err:   serial
Net:   egiga0
Hit any key to stop autoboot: 10  9  8  7  6  5  4  3  2  1  0 
(Re)start USB...
USB0:   USB EHCI 1.00
scanning bus 0 for devices... 1 USB Device(s) found
       scanning usb for storage devices... 0 Storage Device(s) found
** Bad device usb 0 **
** Bad device usb 0 **
Wrong Image Format for bootm command
ERROR: can&#039;t get kernel image!

MMC rescan: current device # 0 initialized OK
1783809 bytes read in 1290 ms (1.3 MiB/s)
** File not found /boot/uInitrd **
## Booting kernel from Legacy Image at 00800000 ...
   Image Name:   ARM OpenWrt Linux-3.14.18
   Created:      2014-09-23   1:56:33 UTC
   Image Type:   ARM Linux Kernel Image (uncompressed)
   Data Size:    1783745 Bytes = 1.7 MiB
   Load Address: 00008000
   Entry Point:  00008000
   Verifying Checksum ... OK
   Loading Kernel Image ... OK
Using machid 0xf78 from environment

Starting kernel ...

Uncompressing Linux... done, booting the kernel.
[    0.000000] Booting Linux on physical CPU 0x0
[    0.000000] Linux version 3.14.18 (beata@nutria) (gcc version 4.8.3 (OpenWrt/Linaro GCC 4.8-2014.04 r42162) ) #9 Mon Sep 22 18:55:46 PDT 2014
[    0.000000] CPU: Feroceon 88FR131 [56251311] revision 1 (ARMv5TE), cr=00053977
[    0.000000] CPU: VIVT data cache, VIVT instruction cache
[    0.000000] Machine model: Cloud Engines Pogoplug Mobile
[    0.000000] Memory policy: Data cache writeback
[    0.000000] Built 1 zonelists in Zone order, mobility grouping on.  Total pages: 32512
[    0.000000] Kernel command line: console=ttyS0,115200 root=/dev/mmcblk0p1 rootdelay=10 rootfstype=ext3 mtdparts=orion_nand:2M(u-boot),3M(uImage),3M(uImage2),8M(failsafe),112M(root)
[    0.000000] PID hash table entries: 512 (order: -1, 2048 bytes)
[    0.000000] Dentry cache hash table entries: 16384 (order: 4, 65536 bytes)
[    0.000000] Inode-cache hash table entries: 8192 (order: 3, 32768 bytes)
[    0.000000] Memory: 124696K/131072K available (3614K kernel code, 168K rwdata, 1024K rodata, 144K init, 189K bss, 6376K reserved)
[    0.000000] Virtual kernel memory layout:
[    0.000000]     vector  : 0xffff0000 - 0xffff1000   (   4 kB)
[    0.000000]     fixmap  : 0xfff00000 - 0xfffe0000   ( 896 kB)
[    0.000000]     vmalloc : 0xc8800000 - 0xff000000   ( 872 MB)
[    0.000000]     lowmem  : 0xc0000000 - 0xc8000000   ( 128 MB)
[    0.000000]     modules : 0xbf000000 - 0xc0000000   (  16 MB)
[    0.000000]       .text : 0xc0008000 - 0xc048fd6c   (4640 kB)
[    0.000000]       .init : 0xc0490000 - 0xc04b4384   ( 145 kB)
[    0.000000]       .data : 0xc04b6000 - 0xc04e009c   ( 169 kB)
[    0.000000]        .bss : 0xc04e009c - 0xc050f5bc   ( 190 kB)
[    0.000000] NR_IRQS:114
[    0.000025] sched_clock: 32 bits at 166MHz, resolution 6ns, wraps every 25769803770ns
[    0.000212] Calibrating delay loop... 795.44 BogoMIPS (lpj=3977216)
[    0.040132] pid_max: default: 32768 minimum: 301
[    0.040321] Mount-cache hash table entries: 1024 (order: 0, 4096 bytes)
[    0.040349] Mountpoint-cache hash table entries: 1024 (order: 0, 4096 bytes)
[    0.043328] CPU: Testing write buffer coherency: ok
[    0.043808] Setting up static identity map for 0x12788 - 0x127c4
[    0.046724] pinctrl core: initialized pinctrl subsystem
[    0.048382] regulator-dummy: no parameters
[    0.049182] NET: Registered protocol family 16
[    0.049797] DMA: preallocated 256 KiB pool for atomic coherent allocations
[    0.054160] cpuidle: using governor ladder
[    0.054187] cpuidle: using governor menu
[    0.054295] Kirkwood: MV88F6281-A1.
[    0.054503] Feroceon L2: Enabling L2
[    0.054556] Feroceon L2: Cache support initialised.
[    0.055338] [Firmware Info]: /ocp@f1000000/ethernet-controller@72000/ethernet0-port@0: local-mac-address is not set
[    0.079728] bio: create slab &lt;bio-0&gt; at 0
[    0.081601] SCSI subsystem initialized
[    0.083356] usbcore: registered new interface driver usbfs
[    0.083597] usbcore: registered new interface driver hub
[    0.083842] usbcore: registered new device driver usb
[    0.086427] Switched to clocksource orion_clocksource
[    0.089810] NET: Registered protocol family 2
[    0.091031] TCP established hash table entries: 1024 (order: 0, 4096 bytes)
[    0.091065] TCP bind hash table entries: 1024 (order: 0, 4096 bytes)
[    0.091094] TCP: Hash tables configured (established 1024 bind 1024)
[    0.091174] TCP: reno registered
[    0.091194] UDP hash table entries: 256 (order: 0, 4096 bytes)
[    0.091225] UDP-Lite hash table entries: 256 (order: 0, 4096 bytes)
[    0.091461] NET: Registered protocol family 1
[    0.093655] futex hash table entries: 256 (order: -1, 3072 bytes)
[    0.094400] squashfs: version 4.0 (2009/01/31) Phillip Lougher
[    0.094417] jffs2: version 2.2 (NAND) (SUMMARY) (LZMA) (RTIME) (CMODE_PRIORITY) (c) 2001-2006 Red Hat, Inc.
[    0.094726] msgmni has been set to 243
[    0.095225] io scheduler noop registered
[    0.095240] io scheduler deadline registered (default)
[    0.096866] kirkwood-pinctrl f1010000.pinctrl: unknown pinctrl group 36
[    0.096888] kirkwood-pinctrl f1010000.pinctrl: unknown pinctrl group 37
[    0.096904] kirkwood-pinctrl f1010000.pinctrl: unknown pinctrl group 38
[    0.096918] kirkwood-pinctrl f1010000.pinctrl: unknown pinctrl group 39
[    0.096933] kirkwood-pinctrl f1010000.pinctrl: unknown pinctrl group 40
[    0.096948] kirkwood-pinctrl f1010000.pinctrl: unknown pinctrl group 41
[    0.096962] kirkwood-pinctrl f1010000.pinctrl: unknown pinctrl group 42
[    0.096976] kirkwood-pinctrl f1010000.pinctrl: unknown pinctrl group 43
[    0.096991] kirkwood-pinctrl f1010000.pinctrl: unknown pinc[    2.136456] rtc-mv f1010300.rtc: internal RTC not ticking
[    2.143717] orion_wdt: Initial timeout 25 sec
[    2.149918] mvsdio f1090000.mvsdio: Got CD GPIO #27.
[    2.154911] mvsdio f1090000.mvsdio: Got WP GPIO #28.
[    2.196461] mvsdio f1090000.mvsdio: using GPIO for card detection
[    2.207498] ledtrig-cpu: registered to indicate activity on CPUs
[    2.213846] TCP: cubic registered
[    2.217199] mvsdio f1090000.mvsdio: unhandled interrupt status=0x8810 en=0x0000 pio=0
[    2.225018] NET: Registered protocol family 17
[    2.229472] mvsdio f1090000.mvsdio: unhandled interrupt status=0x0810 en=0x0000 pio=0
[    2.237403] Bridge firewalling registered
[    2.244689] 8021q: 802.1Q VLAN Support v1.8
[    2.248898] mvsdio f1090000.mvsdio: unhandled interrupt status=0x8810 en=0x0000 pio=0
[    2.258507] regulator-dummy: disabling
[    2.263775] input: gpio-keys.2 as /devices/gpio-keys.2/input/input0
[    2.270628] drivers/rtc/hctosys.c: unable to open rtc device (rtc0)
[    2.278340] Waiting 10 sec before mounting root device...
[    2.286726] mmc0: new SD card at address e624
[    2.291705] mmcblk0: mmc0:e624 SD512 483 MiB 
[    2.297717]  mmcblk0: p1
[    2.598424] scsi 0:0:0:0: Direct-Access     SanDisk  Cruzer Facet     1.26 PQ: 0 ANSI: 5
[    2.609334] sd 0:0:0:0: [sda] 15633408 512-byte logical blocks: (8.00 GB/7.45 GiB)
[    2.618318] sd 0:0:0:0: [sda] Write Protect is off
[    2.623818] sd 0:0:0:0: [sda] Write cache: disabled, read cache: enabled, doesn&#039;t support DPO or FUA
[    2.643508]  sda: sda1
[    2.649320] sd 0:0:0:0: [sda] Attached SCSI removable disk
[   12.286599] UBIFS error (pid 1): ubifs_mount: cannot open &quot;ubi0:rootfs&quot;, error -19
[   12.294970] EXT4-fs (mmcblk0p1): mounting ext3 file system using the ext4 subsystem
[   12.325147] EXT4-fs (mmcblk0p1): mounted filesystem with ordered data mode. Opts: (null)
[   12.333300] VFS: Mounted root (ext3 filesystem) readonly on device 179:1.
[   12.340714] Freeing unused kernel memory: 144K (c0490000 - c04b4000)
procd: Console is alive
procd: - watchdog -
[   12.923389] sdhci: Secure Digital Host Controller Interface driver
[   12.929598] sdhci: Copyright(c) Pierre Ossman
[   12.934908] sdhci-pltfm: SDHCI platform and OF driver helper
procd: - preinit -
[   13.032879] random: mktemp urandom read with 42 bits of entropy available
Press the [f] key and hit [enter] to enter failsafe mode
Press the [1], [2], [3] or [4] key and hit [enter] to select the debug level
mounting /dev/root
[   15.168816] EXT4-fs (mmcblk0p1): re-mounted. Opts: (null)
procd: - early -
procd: - watchdog -
procd: - ubus -
procd: - init -
Please press Enter to activate this console.
[   16.465781] NET: Registered protocol family 10
[   16.475519] Key type dns_resolver registered
[   16.499327] RPC: Registered named UNIX socket transport module.
[   16.505233] RPC: Registered udp transport module.
[   16.509955] RPC: Registered tcp transport module.
[   16.514641] RPC: Registered tcp NFSv4.1 backchannel transport module.
[   16.539572] Installing knfsd (copyright (C) 1996 okir@monad.swb.de).
[   16.549744] cryptodev: driver 1.6 loaded.
[   16.560192] usbcore: registered new interface driver i2c-tiny-usb
[   16.572193] hidraw: raw HID events driver (C) Jiri Kosina
[   16.583190] fuse init (API version 7.22)
[   18.679268] random: nonblocking pool is initialized
[   18.999099] IPv6: ADDRCONF(NETDEV_UP): eth0: link is not ready
[   20.738055] mv643xx_eth_port mv643xx_eth_port.0 eth0: link up, 100 Mb/s, full duplex, flow control disabled
[   20.747966] IPv6: ADDRCONF(NETDEV_CHANGE): eth0: link becomes ready
[   21.657962] EXT4-fs (sda1): mounting ext3 file system using the ext4 subsystem
[   21.684903] EXT4-fs (sda1): mounted filesystem with ordered data mode. Opts: (null)



BusyBox v1.22.1 (2014-09-22 02:34:23 PDT) built-in shell (ash)
Enter &#039;help&#039; for a list of built-in commands.

  _______                     ________        __
 |       |.-----.-----.-----.|  |  |  |.----.|  |_
 |   -   ||  _  |  -__|     ||  |  |  ||   _||   _|
 |_______||   __|_____|__|__||________||__|  |____|
          |__| W I R E L E S S   F R E E D O M
 -----------------------------------------------------
 CHAOS CALMER (14.07-rc2, r42642)
 -----------------------------------------------------
  * 1 1/2 oz Gin            Shake with a glassful
  * 1/4 oz Triple Sec       of broken ice and pour
  * 3/4 oz Lime Juice       unstrained into a goblet.
  * 1 1/2 oz Orange Juice
  * 1 tsp. Grenadine Syrup
 -----------------------------------------------------
root@OpenWrt:/# </code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p248313">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">bsdfox</div>
					<div class="post-datetime">
						27 Sep 2014, 22:35					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m unable to get a serial console once the kernel has loaded (tried using pre-built trunk snapshot and a home-built trunk build). I&#039;ve tried changing the console from ttyS0 to ttyS1 thinking it could be getting renamed but thus far I&#039;ve had no success. Networking doesn&#039;t seem to be alive on the device booting these kernels so I really need to get the serial console running to figure out what&#039;s going on. This is a serial (not netconsole) console--<br /></p><div class="codebox"><pre><code>Environment size: 2461/131068 bytes
Pogov4&gt; boot
** Bad device mmc 0 **
** Bad device mmc 0 **
Wrong Image Format for bootm command
ERROR: can&#039;t get kernel image!
(Re)start USB...
USB0:   USB EHCI 1.00
scanning bus 0 for devices... 2 USB Device(s) found
       scanning usb for storage devices... 1 Storage Device(s) found
1650364 bytes read in 350 ms (4.5 MiB/s)
** File not found /boot/uInitrd **
## Booting kernel from Legacy Image at 00800000 ...
   Image Name:   ARM OpenWrt Linux-3.14.18
   Created:      2014-09-27  17:02:36 UTC
   Image Type:   ARM Linux Kernel Image (uncompressed)
   Data Size:    1650300 Bytes = 1.6 MiB
   Load Address: 00008000
   Entry Point:  00008000
   Verifying Checksum ... OK
   Loading Kernel Image ... OK
Using machid 0xf78 from environment

Starting kernel ...

Uncompressing Linux... done, booting the kernel.</code></pre></div>											<p class="post-edited">(Last edited by <strong>bsdfox</strong> on 27 Sep 2014, 22:37)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p248330">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">bsdfox</div>
					<div class="post-datetime">
						28 Sep 2014, 01:21					</div>
				</div>
				<div class="post-content content">
					<p>I was able to solve this by including the initramfs option in the kernel then copying the openwrt-kirkwood-pogoe02-uImage-initramfs binary to /boot/uImage on my boot device. I&#039;m not sure why this solves it but it does. The next problem people seem to be facing is automatically mounting extroot devices. I&#039;ve got block-mount built into my image and my /etc/config/fstab contains this:<br /></p><div class="codebox"><pre><code>config &#039;global&#039;
        option  anon_swap       &#039;0&#039;
        option  anon_mount      &#039;0&#039;
        option  auto_swap       &#039;1&#039;
        option  auto_mount      &#039;1&#039;
        option  delay_root      &#039;5&#039;
        option  check_fs        &#039;0&#039;

config &#039;mount&#039;
        option  target  &#039;/&#039;
        option  uuid    &#039;22095557-1a0b-4310-b9bd-1b606b3fed04&#039;
        option  enabled &#039;1&#039;

config &#039;swap&#039;
        option  uuid    &#039;4c38b24f-47b2-4770-bcaf-e5b52f8d3cce&#039;
        option  enabled &#039;1&#039;

config &#039;mount&#039;
        option  target  &#039;/overlay&#039;
        option  uuid    &#039;193f6f95-2280-464c-95e2-e52fb8f109e8&#039;
        option  enabled &#039;1&#039;</code></pre></div><p>but no devices are mounted on boot. There seems to be a current issue with similar problems as described here: <a href="https://forum.openwrt.org/viewtopic.php?id=44939&amp;p=9">https://forum.openwrt.org/viewtopic.php … 39&amp;p=9</a></p><p>If anyone has any information on resolving this issue I think I&#039;ll have a functional machine I can start doing some hardware hacking on. BTW it does appear some GPIOs are usable and I will try to identify them once my system reboots properly.</p><p><strong>edit: I added a section on GPIOs to the wiki page at <a href="http://wiki.openwrt.org/toh/cloudengines/pogo-v4">http://wiki.openwrt.org/toh/cloudengines/pogo-v4</a></strong></p>											<p class="post-edited">(Last edited by <strong>bsdfox</strong> on 28 Sep 2014, 05:17)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p248416">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">beata</div>
					<div class="post-datetime">
						29 Sep 2014, 08:10					</div>
				</div>
				<div class="post-content content">
					<p>Current working device tree. I have yet to suss out the correct way of making a patch. <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /><br />Currently I overwrite&nbsp; kirkwood-pogo_e02.dts with this and rebuild.</p><div class="codebox"><pre><code>/dts-v1/;

#include &quot;kirkwood.dtsi&quot;
#include &quot;kirkwood-6192.dtsi&quot;
/* kirkwood 6192 */
/ {
        model = &quot;Cloud Engines Pogoplug Mobile&quot;;
        compatible = &quot;cloudengines,pogov4a1&quot;, &quot;marvell,kirkwood-88f6192&quot;, &quot;marvell,kirkwood&quot;;

        memory {
                device_type = &quot;memory&quot;;
                reg = &lt;0x00000000 0x10000000&gt;;
        };

        chosen {
                bootargs = &quot;console=ttyS0,115200n8 earlyprintk&quot;;
        };

        ocp@f1000000 {
                pinctrl: pinctrl@10000 {
/*                      pmx_usb_power_enable: pmx-usb-power-enable {
                                marvell,pins = &quot;mpp9&quot;;
                                marvell,function = &quot;gpio&quot;;
                        }; */
                        pmx_led_green: pmx-led_green {
                                marvell,pins = &quot;mpp22&quot;;
                                marvell,function = &quot;gpio&quot;;
                        };
                        pmx_led_red: pmx-led_red {
                                marvell,pins = &quot;mpp24&quot;;
                                marvell,function = &quot;gpio&quot;;
                        };
                        pmx_sdio_cd: pmx_sdio_cd {
                                marvell,pins = &quot;mpp27&quot;;
                                marvell,function = &quot;gpio&quot;;
                        };
                        pmx_sdio_wp: pmx_sdio_wp {
                                marvell,pins = &quot;mpp28&quot;;
                                marvell,function = &quot;gpio&quot;;
                        };
                        pmx_eject_button: pmx_eject_button {
                                marvell,pins = &quot;mpp29&quot;;
                                marvell,function = &quot;gpio&quot;;
                        };
                };
                serial@12000 {
                        status = &quot;ok&quot;;
                };
                mvsdio@90000 {
                        pinctrl-0 = &lt;&amp;pmx_sdio &amp;pmx_sdio_cd &amp;pmx_sdio_wp&gt;;
                        pinctrl-names = &quot;default&quot;;
                        cd-gpios = &lt;&amp;gpio0 27 1&gt;;
                        wp-gpios = &lt;&amp;gpio0 28 0&gt;;
                        status = &quot;okay&quot;;
                };

        };
        gpio-keys {
                compatible = &quot;gpio-keys&quot;;
                #address-cells = &lt;1&gt;;
                #size-cells = &lt;0&gt;;
                pinctrl-0 = &lt;&amp;pmx_eject_button&gt;;
                pinctrl-names = &quot;default&quot;;

                button@1 {
                        label = &quot;Eject button&quot;;
                        linux,code = &lt;KEY_EJECTCD&gt;;
                        gpios = &lt;&amp;gpio0 29 GPIO_ACTIVE_LOW&gt;;
                };
        };
        gpio-leds {
                compatible = &quot;gpio-leds&quot;;
                pinctrl-0 = &lt; &amp;pmx_led_red &amp;pmx_led_green &gt;;
/*              pinctrl-0 = &lt; &amp;pmx_usb_power_enable &amp;pmx_led_red
                              &amp;pmx_led_green &gt;; */
                pinctrl-names = &quot;default&quot;;

                health {
                        label = &quot;status:green:health&quot;;
                        gpios = &lt;&amp;gpio0 22 GPIO_ACTIVE_LOW&gt;;
                        default-state = &quot;keep&quot;;
                };
                fault {
                        label = &quot;status:red:fault&quot;;
                        gpios = &lt;&amp;gpio0 24 GPIO_ACTIVE_LOW&gt;;
                };
        };
/*      regulators {
                compatible = &quot;simple-bus&quot;;
                #address-cells = &lt;1&gt;;
                #size-cells = &lt;0&gt;;
                pinctrl-0 = &lt;&amp;pmx_usb_power_enable&gt;;
                pinctrl-names = &quot;default&quot;;

                usb_power: regulator@1 {
                        compatible = &quot;regulator-fixed&quot;;
                        reg = &lt;1&gt;;
                        regulator-name = &quot;USB Power&quot;;
                        regulator-min-microvolt = &lt;5000000&gt;;
                        regulator-max-microvolt = &lt;5000000&gt;;
                        enable-active-high;
                        regulator-always-on;
                        regulator-boot-on;
                        gpio = &lt;&amp;gpio0 9 GPIO_ACTIVE_HIGH&gt;;
                };
        }; */
};

&amp;nand {
        chip-delay = &lt;40&gt;;
        status = &quot;okay&quot;;

/*      partition@0 {
                label = &quot;u-boot&quot;;
                reg = &lt;0x0000000 0x100000&gt;;
                read-only;
        };

        partition@100000 {
                label = &quot;uImage&quot;;
                reg = &lt;0x0100000 0x400000&gt;;
        };

        partition@500000 {
                label = &quot;pogoplug&quot;;
                reg = &lt;0x0500000 0x2000000&gt;;
        };

        partition@2500000 {
                label = &quot;root&quot;;
                reg = &lt;0x02500000 0x5b00000&gt;;
        }; */
};

&amp;mdio {
        status = &quot;okay&quot;;

        ethphy0: ethernet-phy@0 {
                reg = &lt;0&gt;;
        };
};

&amp;eth0 {
        status = &quot;okay&quot;;
        ethernet0-port@0 {
                phy-handle = &lt;&amp;ethphy0&gt;;
        };
};</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p248621">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">andrew.c12</div>
					<div class="post-datetime">
						1 Oct 2014, 08:15					</div>
				</div>
				<div class="post-content content">
					<p>I believe MPP10 might be used for a 5v regulator for USB 3 on the pogoplugv4 A3-01</p><p>Here is someone else asking the same question<br /><a href="http://archlinuxarm.org/forum/viewtopic.php?f=53&amp;t=6974">http://archlinuxarm.org/forum/viewtopic … amp;t=6974</a><br />I had also tried to clean up that DTB but I abandoned it after a while, it did boot but i didn&#039;t test how much worked<br /></p><div class="codebox"><pre><code>/*
 * kirkwood-pogoplugv4.dts - Device tree file for Pogoplug v4
 *
 * Copyright (C) 2014 Andrew Innes &lt;andrew.c12@gmail.com&gt;
 *
 * Licensed under GPLv2
 */
 
/dts-v1/;

#include &quot;kirkwood.dtsi&quot;
#include &quot;kirkwood-6192.dtsi&quot;

/ {
    model = &quot;Pogoplug v4&quot;;
    compatible = &quot;cloudengines,pogoplug-v4&quot;, &quot;cloudengines,pogoplug-mobile&quot;, &quot;marvell,kirkwood-88f6192&quot;, &quot;marvell,kirkwood&quot;;

    memory {
        device_type = &quot;memory&quot;;
        reg = &lt;0x00000000 0x8000000&gt;;
    };


    chosen {
        bootargs = &quot;console=ttyS0,115200 earlyprintk root=/dev/mmcblk0p1 rootdelay=10&quot;;
    };

    mbus {
        pcie-controller {
            status = &quot;okay&quot;;

            pcie@1,0 {
                status = &quot;okay&quot;;
            };
        };
    };

    ocp@f1000000 {
        pinctrl: pin-controller@10000 {
                        pmx_usb_power: pmx-usb-power {
                /* mpp10 is uart0 TXD. Regulator therefore doesn&#039;t seem to work correctly */
                                marvell,pins = &quot;mpp10&quot;;
                                marvell,function = &quot;gpo&quot;;
                        };
            pmx_led_green: pmx-led-green {
                marvell,pins = &quot;mpp22&quot;;
                marvell,function = &quot;gpio&quot;;
            };
            pmx_led_red: pmx-led-red {
                marvell,pins = &quot;mpp24&quot;;
                marvell,function = &quot;gpio&quot;;
            };
            pmx_button_eject: pmx-button-eject {
                marvell,pins = &quot;mpp29&quot;;
                marvell,function = &quot;gpio&quot;;
            };
        };
                
        spi@10600 {
            status = &quot;okay&quot;;

            m25p05@0 {
                #address-cells = &lt;1&gt;;
                #size-cells = &lt;1&gt;;
                compatible = &quot;m25p05-nonjedec&quot;;
                reg = &lt;0&gt;;
                spi-max-frequency = &lt;20000000&gt;;
                mode = &lt;0&gt;;
            };
        };



        sata@80000 {
            status = &quot;okay&quot;;
            nr-ports = &lt;1&gt;;
        };

        mvsdio@90000 {
            pinctrl-0 = &lt;&amp;pmx_sdio&gt;;
            pinctrl-names = &quot;default&quot;;
            status = &quot;okay&quot;;
            cd-gpios = &lt;&amp;gpio0 27 0&gt;;
            /* No WP GPIO */
        };
    };

    gpio-leds {
        compatible = &quot;gpio-leds&quot;;
        pinctrl-names = &quot;default&quot;;
        pinctrl-0 = &lt;&amp;pmx_led_red &amp;pmx_led_green&gt;;
        
        health {
            label = &quot;status:green:health&quot;;
            gpios = &lt;&amp;gpio0 22 1&gt;;
            linux,default-trigger = &quot;default-on&quot;;
        };
        fault {
            label = &quot;status:red:fault&quot;;
            gpios = &lt;&amp;gpio0 24 1&gt;;
            linux,default-trigger = &quot;none&quot;;
        };
    };

    gpio_keys {
        compatible = &quot;gpio-keys&quot;;
        #address-cells = &lt;1&gt;;
        #size-cells = &lt;0&gt;;
        pinctrl-0 = &lt;&amp;pmx_button_eject&gt;;
        pinctrl-names = &quot;default&quot;;
        
        button@1 {
            label = &quot;Eject Button&quot;;
            linux,code = &lt;161&gt;; /* EJECTCD */
            gpios = &lt;&amp;gpio0 29 1&gt;;
        };
    };

    regulators {
                compatible = &quot;simple-bus&quot;;
                #address-cells = &lt;1&gt;;
                #size-cells = &lt;0&gt;;
                pinctrl-0 = &lt;&amp;pmx_usb_power&gt;;
                pinctrl-names = &quot;default&quot;;

                usb_power: regulator@1 {
                        /* This renders UART0 unusable */
                        compatible = &quot;regulator-fixed&quot;;
                        reg = &lt;1&gt;;
                        regulator-name = &quot;USB Power&quot;;
                        regulator-min-microvolt = &lt;5000000&gt;;
                        regulator-max-microvolt = &lt;5000000&gt;;
                        enable-active-high;
                        regulator-always-on;
                        regulator-boot-on;
                        gpio = &lt;&amp;gpio0 10 0&gt;;
                };
    };
};

&amp;nand {
    status = &quot;okay&quot;;

    partition@0 {
        label = &quot;u-boot&quot;;
        reg = &lt;0x0000000 0x200000&gt;;
        read-only;
    };

    partition@200000 {
        label = &quot;uImage&quot;;
        reg = &lt;0x200000 0x300000&gt;;
    };

    partition@500000 {
        label = &quot;uImage2&quot;;
        reg = &lt;0x500000 0x300000&gt;;
    };

    partition@800000 {
        label = &quot;failsafe&quot;;
        reg = &lt;0x800000 0x800000&gt;;
    };
    
    partition@1000000 {
        label = &quot;root&quot;;
        reg = &lt;0x1000000 0x7000000&gt;;
    };
};

&amp;mdio {
        status = &quot;okay&quot;;

     ethphy0: ethernet-phy@0 {
         device_type = &quot;ethernet-phy&quot;;
         reg = &lt;0&gt;;
        };
};

&amp;eth0 {
        status = &quot;okay&quot;;
        ethernet0-port@0 {
                phy-handle = &lt;&amp;ethphy0&gt;;
        };
};</code></pre></div>											<p class="post-edited">(Last edited by <strong>andrew.c12</strong> on 1 Oct 2014, 08:16)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p250096">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">beata</div>
					<div class="post-datetime">
						11 Oct 2014, 05:54					</div>
				</div>
				<div class="post-content content">
					<p>I have just discovered that BB doesn&#039;t build with the dts I wrote for trunk, and that I don&#039;t understand it quite well enough to determine why. Am currently attempting to port it, again using the e02&#039;s dts as a template.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p250166">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">bsdfox</div>
					<div class="post-datetime">
						12 Oct 2014, 00:35					</div>
				</div>
				<div class="post-content content">
					<p>beata,</p><p>I&#039;ve been doing some work on this as well. I&#039;ve copied over the dts folder from mainline 3.16 and modified the kirkwood-pogo_e02.dts for our uses. I&#039;ve disabled the nand (I&#039;m booting from usb, so nand is only used for uboot) and sdio and enabled spi0 and uart1. I haven&#039;t elaborated on the setup yet but I&#039;ve got the pins documented on the wiki so anyone motivated should be able to replicate my work.&nbsp; I&#039;ve also located MPP8 and MPP9 and enabled i2c-0 on these two pins. They&#039;re located on the back side of the device and have unpopulated pads and populated pullup resistors so it&#039;s a very easy access point, I&#039;ll take some pictures when I get time.</p><p>Anyway, here are my current device trees. I also had to delete the other kirkwood*.dts files because they were referencing the old kirkwood.dtsi.</p><p>kirkwood.dtsi<br /></p><div class="codebox"><pre><code>/include/ &quot;skeleton.dtsi&quot;
#include &lt;dt-bindings/input/input.h&gt;
#include &lt;dt-bindings/gpio/gpio.h&gt;

#define MBUS_ID(target,attributes) (((target) &lt;&lt; 24) | ((attributes) &lt;&lt; 16))

/ {
    compatible = &quot;marvell,kirkwood&quot;;
    interrupt-parent = &lt;&amp;intc&gt;;

    cpus {
        #address-cells = &lt;1&gt;;
        #size-cells = &lt;0&gt;;

        cpu@0 {
            device_type = &quot;cpu&quot;;
            compatible = &quot;marvell,feroceon&quot;;
            reg = &lt;0&gt;;
            clocks = &lt;&amp;core_clk 1&gt;, &lt;&amp;core_clk 3&gt;, &lt;&amp;gate_clk 11&gt;;
            clock-names = &quot;cpu_clk&quot;, &quot;ddrclk&quot;, &quot;powersave&quot;;
        };
    };

    aliases {
           gpio0 = &amp;gpio0;
           gpio1 = &amp;gpio1;
           i2c0 = &amp;i2c0;
    };

    mbus {
        compatible = &quot;marvell,kirkwood-mbus&quot;, &quot;simple-bus&quot;;
        #address-cells = &lt;2&gt;;
        #size-cells = &lt;1&gt;;
        /* If a board file needs to change this ranges it must replace it completely */
        ranges = &lt;MBUS_ID(0xf0, 0x01) 0 0xf1000000 0x100000    /* internal-regs */
              MBUS_ID(0x01, 0x2f) 0 0xf4000000 0x10000    /* nand flash */
              MBUS_ID(0x03, 0x01) 0 0xf5000000 0x10000    /* crypto sram */
              &gt;;
        controller = &lt;&amp;mbusc&gt;;
        pcie-mem-aperture = &lt;0xe0000000 0x10000000&gt;; /* 256 MiB memory space */
        pcie-io-aperture  = &lt;0xf2000000 0x100000&gt;;   /*   1 MiB    I/O space */

        cesa: crypto@0301 {
            compatible = &quot;marvell,orion-crypto&quot;;
            reg = &lt;MBUS_ID(0xf0, 0x01) 0x30000 0x10000&gt;,
                  &lt;MBUS_ID(0x03, 0x01) 0 0x800&gt;;
            reg-names = &quot;regs&quot;, &quot;sram&quot;;
            interrupts = &lt;22&gt;;
            clocks = &lt;&amp;gate_clk 17&gt;;
            status = &quot;okay&quot;;
        };

        nand: nand@012f {
            #address-cells = &lt;1&gt;;
            #size-cells = &lt;1&gt;;
            cle = &lt;0&gt;;
            ale = &lt;1&gt;;
            bank-width = &lt;1&gt;;
            compatible = &quot;marvell,orion-nand&quot;;
            reg = &lt;MBUS_ID(0x01, 0x2f) 0 0x400&gt;;
            chip-delay = &lt;25&gt;;
            /* set partition map and/or chip-delay in board dts */
            clocks = &lt;&amp;gate_clk 7&gt;;
            pinctrl-0 = &lt;&amp;pmx_nand&gt;;
            pinctrl-names = &quot;default&quot;;
            status = &quot;disabled&quot;;
        };
    };

    ocp@f1000000 {
        compatible = &quot;simple-bus&quot;;
        ranges = &lt;0x00000000 0xf1000000 0x0100000&gt;;
        #address-cells = &lt;1&gt;;
        #size-cells = &lt;1&gt;;

        pinctrl: pin-controller@10000 {
            /* set compatible property in SoC file */
            reg = &lt;0x10000 0x20&gt;;

            pmx_ge1: pmx-ge1 {
                marvell,pins = &quot;mpp20&quot;, &quot;mpp21&quot;, &quot;mpp22&quot;, &quot;mpp23&quot;,
                           &quot;mpp24&quot;, &quot;mpp25&quot;, &quot;mpp26&quot;, &quot;mpp27&quot;,
                           &quot;mpp30&quot;, &quot;mpp31&quot;, &quot;mpp32&quot;, &quot;mpp33&quot;;
                marvell,function = &quot;ge1&quot;;
            };

            pmx_nand: pmx-nand {
                marvell,pins = &quot;mpp0&quot;, &quot;mpp1&quot;, &quot;mpp2&quot;, &quot;mpp3&quot;,
                           &quot;mpp4&quot;, &quot;mpp5&quot;, &quot;mpp18&quot;, &quot;mpp19&quot;;
                marvell,function = &quot;nand&quot;;
            };

            /*
             * Default SPI0 pinctrl setting with CSn on mpp0,
             * overwrite marvell,pins on board level if required.
             */
            pmx_spi: pmx-spi {
                marvell,pins = &quot;mpp0&quot;, &quot;mpp1&quot;, &quot;mpp2&quot;, &quot;mpp3&quot;;
                marvell,function = &quot;spi&quot;;
            };

            pmx_twsi0: pmx-twsi0 {
                marvell,pins = &quot;mpp8&quot;, &quot;mpp9&quot;;
                marvell,function = &quot;twsi0&quot;;
            };

            /*
             * Default UART pinctrl setting without RTS/CTS,
             * overwrite marvell,pins on board level if required.
             */
            pmx_uart0: pmx-uart0 {
                marvell,pins = &quot;mpp10&quot;, &quot;mpp11&quot;;
                marvell,function = &quot;uart0&quot;;
            };

            pmx_uart1: pmx-uart1 {
                marvell,pins = &quot;mpp13&quot;, &quot;mpp14&quot;;
                marvell,function = &quot;uart1&quot;;
            };
        };

        core_clk: core-clocks@10030 {
            compatible = &quot;marvell,kirkwood-core-clock&quot;;
            reg = &lt;0x10030 0x4&gt;;
            #clock-cells = &lt;1&gt;;
        };

        spi0: spi@10600 {
            compatible = &quot;marvell,orion-spi&quot;;
            #address-cells = &lt;1&gt;;
            #size-cells = &lt;0&gt;;
            cell-index = &lt;0&gt;;
            interrupts = &lt;23&gt;;
            reg = &lt;0x10600 0x28&gt;;
            clocks = &lt;&amp;gate_clk 7&gt;;
            pinctrl-0 = &lt;&amp;pmx_spi&gt;;
            pinctrl-names = &quot;default&quot;;
            status = &quot;disabled&quot;;
        };

        gpio0: gpio@10100 {
            compatible = &quot;marvell,orion-gpio&quot;;
            #gpio-cells = &lt;2&gt;;
            gpio-controller;
            reg = &lt;0x10100 0x40&gt;;
            ngpios = &lt;32&gt;;
            interrupt-controller;
            #interrupt-cells = &lt;2&gt;;
            interrupts = &lt;35&gt;, &lt;36&gt;, &lt;37&gt;, &lt;38&gt;;
            clocks = &lt;&amp;gate_clk 7&gt;;
        };

        gpio1: gpio@10140 {
            compatible = &quot;marvell,orion-gpio&quot;;
            #gpio-cells = &lt;2&gt;;
            gpio-controller;
            reg = &lt;0x10140 0x40&gt;;
            ngpios = &lt;18&gt;;
            interrupt-controller;
            #interrupt-cells = &lt;2&gt;;
            interrupts = &lt;39&gt;, &lt;40&gt;, &lt;41&gt;;
            clocks = &lt;&amp;gate_clk 7&gt;;
        };

        i2c0: i2c@11000 {
            compatible = &quot;marvell,mv64xxx-i2c&quot;;
            reg = &lt;0x11000 0x20&gt;;
            #address-cells = &lt;1&gt;;
            #size-cells = &lt;0&gt;;
            interrupts = &lt;29&gt;;
            clock-frequency = &lt;100000&gt;;
            clocks = &lt;&amp;gate_clk 7&gt;;
            pinctrl-0 = &lt;&amp;pmx_twsi0&gt;;
            pinctrl-names = &quot;default&quot;;
            status = &quot;disabled&quot;;
        };

        uart0: serial@12000 {
            compatible = &quot;ns16550a&quot;;
            reg = &lt;0x12000 0x100&gt;;
            reg-shift = &lt;2&gt;;
            interrupts = &lt;33&gt;;
            clocks = &lt;&amp;gate_clk 7&gt;;
            pinctrl-0 = &lt;&amp;pmx_uart0&gt;;
            pinctrl-names = &quot;default&quot;;
            status = &quot;disabled&quot;;
        };

        uart1: serial@12100 {
            compatible = &quot;ns16550a&quot;;
            reg = &lt;0x12100 0x100&gt;;
            reg-shift = &lt;2&gt;;
            interrupts = &lt;34&gt;;
            clocks = &lt;&amp;gate_clk 7&gt;;
            pinctrl-0 = &lt;&amp;pmx_uart1&gt;;
            pinctrl-names = &quot;default&quot;;
            status = &quot;disabled&quot;;
        };

        mbusc: mbus-controller@20000 {
            compatible = &quot;marvell,mbus-controller&quot;;
            reg = &lt;0x20000 0x80&gt;, &lt;0x1500 0x20&gt;;
        };

        sysc: system-controller@20000 {
            compatible = &quot;marvell,orion-system-controller&quot;;
            reg = &lt;0x20000 0x120&gt;;
        };

        bridge_intc: bridge-interrupt-ctrl@20110 {
            compatible = &quot;marvell,orion-bridge-intc&quot;;
            interrupt-controller;
            #interrupt-cells = &lt;1&gt;;
            reg = &lt;0x20110 0x8&gt;;
            interrupts = &lt;1&gt;;
            marvell,#interrupts = &lt;6&gt;;
        };

        gate_clk: clock-gating-control@2011c {
            compatible = &quot;marvell,kirkwood-gating-clock&quot;;
            reg = &lt;0x2011c 0x4&gt;;
            clocks = &lt;&amp;core_clk 0&gt;;
            #clock-cells = &lt;1&gt;;
        };

        l2: l2-cache@20128 {
            compatible = &quot;marvell,kirkwood-cache&quot;;
            reg = &lt;0x20128 0x4&gt;;
        };

        intc: main-interrupt-ctrl@20200 {
            compatible = &quot;marvell,orion-intc&quot;;
            interrupt-controller;
            #interrupt-cells = &lt;1&gt;;
            reg = &lt;0x20200 0x10&gt;, &lt;0x20210 0x10&gt;;
        };

        timer: timer@20300 {
            compatible = &quot;marvell,orion-timer&quot;;
            reg = &lt;0x20300 0x20&gt;;
            interrupt-parent = &lt;&amp;bridge_intc&gt;;
            interrupts = &lt;1&gt;, &lt;2&gt;;
            clocks = &lt;&amp;core_clk 0&gt;;
        };

        wdt: watchdog-timer@20300 {
            compatible = &quot;marvell,orion-wdt&quot;;
            reg = &lt;0x20300 0x28&gt;, &lt;0x20108 0x4&gt;;
            interrupt-parent = &lt;&amp;bridge_intc&gt;;
            interrupts = &lt;3&gt;;
            clocks = &lt;&amp;gate_clk 7&gt;;
            status = &quot;okay&quot;;
        };

        usb0: ehci@50000 {
            compatible = &quot;marvell,orion-ehci&quot;;
            reg = &lt;0x50000 0x1000&gt;;
            interrupts = &lt;19&gt;;
            clocks = &lt;&amp;gate_clk 3&gt;;
            status = &quot;okay&quot;;
        };

        dma0: xor@60800 {
            compatible = &quot;marvell,orion-xor&quot;;
            reg = &lt;0x60800 0x100
                   0x60A00 0x100&gt;;
            status = &quot;okay&quot;;
            clocks = &lt;&amp;gate_clk 8&gt;;

            xor00 {
                  interrupts = &lt;5&gt;;
                  dmacap,memcpy;
                  dmacap,xor;
            };
            xor01 {
                  interrupts = &lt;6&gt;;
                  dmacap,memcpy;
                  dmacap,xor;
                  dmacap,memset;
            };
        };

        dma1: xor@60900 {
            compatible = &quot;marvell,orion-xor&quot;;
            reg = &lt;0x60900 0x100
                   0x60B00 0x100&gt;;
            status = &quot;okay&quot;;
            clocks = &lt;&amp;gate_clk 16&gt;;

            xor00 {
                  interrupts = &lt;7&gt;;
                  dmacap,memcpy;
                  dmacap,xor;
            };
            xor01 {
                  interrupts = &lt;8&gt;;
                  dmacap,memcpy;
                  dmacap,xor;
                  dmacap,memset;
            };
        };

        eth0: ethernet-controller@72000 {
            compatible = &quot;marvell,kirkwood-eth&quot;;
            #address-cells = &lt;1&gt;;
            #size-cells = &lt;0&gt;;
            reg = &lt;0x72000 0x4000&gt;;
            clocks = &lt;&amp;gate_clk 0&gt;;
            marvell,tx-checksum-limit = &lt;1600&gt;;
            status = &quot;disabled&quot;;

            ethernet0-port@0 {
                compatible = &quot;marvell,kirkwood-eth-port&quot;;
                reg = &lt;0&gt;;
                interrupts = &lt;11&gt;;
                /* overwrite MAC address in bootloader */
                local-mac-address = [00 00 00 00 00 00];
                /* set phy-handle property in board file */
            };
        };

        mdio: mdio-bus@72004 {
            compatible = &quot;marvell,orion-mdio&quot;;
            #address-cells = &lt;1&gt;;
            #size-cells = &lt;0&gt;;
            reg = &lt;0x72004 0x84&gt;;
            interrupts = &lt;46&gt;;
            clocks = &lt;&amp;gate_clk 0&gt;;
            status = &quot;disabled&quot;;

            /* add phy nodes in board file */
        };

        eth1: ethernet-controller@76000 {
            compatible = &quot;marvell,kirkwood-eth&quot;;
            #address-cells = &lt;1&gt;;
            #size-cells = &lt;0&gt;;
            reg = &lt;0x76000 0x4000&gt;;
            clocks = &lt;&amp;gate_clk 19&gt;;
            marvell,tx-checksum-limit = &lt;1600&gt;;
            pinctrl-0 = &lt;&amp;pmx_ge1&gt;;
            pinctrl-names = &quot;default&quot;;
            status = &quot;disabled&quot;;

            ethernet1-port@0 {
                compatible = &quot;marvell,kirkwood-eth-port&quot;;
                reg = &lt;0&gt;;
                interrupts = &lt;15&gt;;
                /* overwrite MAC address in bootloader */
                local-mac-address = [00 00 00 00 00 00];
                /* set phy-handle property in board file */
            };
        };

        sata_phy0: sata-phy@82000 {
            compatible = &quot;marvell,mvebu-sata-phy&quot;;
            reg = &lt;0x82000 0x0334&gt;;
            clocks = &lt;&amp;gate_clk 14&gt;;
            clock-names = &quot;sata&quot;;
            #phy-cells = &lt;0&gt;;
            status = &quot;ok&quot;;
        };

        sata_phy1: sata-phy@84000 {
            compatible = &quot;marvell,mvebu-sata-phy&quot;;
            reg = &lt;0x84000 0x0334&gt;;
            clocks = &lt;&amp;gate_clk 15&gt;;
            clock-names = &quot;sata&quot;;
            #phy-cells = &lt;0&gt;;
            status = &quot;ok&quot;;
        };

        audio0: audio-controller@a0000 {
            compatible = &quot;marvell,kirkwood-audio&quot;;
            #sound-dai-cells = &lt;0&gt;;
            reg = &lt;0xa0000 0x2210&gt;;
            interrupts = &lt;24&gt;;
            clocks = &lt;&amp;gate_clk 9&gt;;
            clock-names = &quot;internal&quot;;
            status = &quot;disabled&quot;;
        };
    };
};</code></pre></div><p>kirkwood-6192.dtsi<br /></p><div class="codebox"><pre><code>/ {
    mbus {
        pciec: pcie-controller {
            compatible = &quot;marvell,kirkwood-pcie&quot;;
            status = &quot;disabled&quot;;
            device_type = &quot;pci&quot;;

            #address-cells = &lt;3&gt;;
            #size-cells = &lt;2&gt;;

            bus-range = &lt;0x00 0xff&gt;;

            ranges =
                   &lt;0x82000000 0 0x40000 MBUS_ID(0xf0, 0x01) 0x40000 0 0x00002000
                0x82000000 0x1 0     MBUS_ID(0x04, 0xe8) 0       1 0 /* Port 0.0 MEM */
                0x81000000 0x1 0     MBUS_ID(0x04, 0xe0) 0       1 0 /* Port 0.0 IO  */&gt;;

            pcie0: pcie@1,0 {
                device_type = &quot;pci&quot;;
                assigned-addresses = &lt;0x82000800 0 0x00040000 0 0x2000&gt;;
                reg = &lt;0x0800 0 0 0 0&gt;;
                #address-cells = &lt;3&gt;;
                #size-cells = &lt;2&gt;;
                #interrupt-cells = &lt;1&gt;;
                ranges = &lt;0x82000000 0 0 0x82000000 0x1 0 1 0
                      0x81000000 0 0 0x81000000 0x1 0 1 0&gt;;
                interrupt-map-mask = &lt;0 0 0 0&gt;;
                interrupt-map = &lt;0 0 0 0 &amp;intc 9&gt;;
                marvell,pcie-port = &lt;0&gt;;
                marvell,pcie-lane = &lt;0&gt;;
                clocks = &lt;&amp;gate_clk 2&gt;;
                status = &quot;disabled&quot;;
            };
        };
    };

    ocp@f1000000 {
        pinctrl: pin-controller@10000 {
            compatible = &quot;marvell,88f6192-pinctrl&quot;;

            pmx_sata0: pmx-sata0 {
                marvell,pins = &quot;mpp5&quot;, &quot;mpp21&quot;, &quot;mpp23&quot;;
                marvell,function = &quot;sata0&quot;;
            };
            pmx_sata1: pmx-sata1 {
                marvell,pins = &quot;mpp4&quot;, &quot;mpp20&quot;, &quot;mpp22&quot;;
                marvell,function = &quot;sata1&quot;;
            };
        };

        rtc: rtc@10300 {
            compatible = &quot;marvell,kirkwood-rtc&quot;, &quot;marvell,orion-rtc&quot;;
            reg = &lt;0x10300 0x20&gt;;
            interrupts = &lt;53&gt;;
            clocks = &lt;&amp;gate_clk 7&gt;;
        };

        sata: sata@80000 {
            compatible = &quot;marvell,orion-sata&quot;;
            reg = &lt;0x80000 0x5000&gt;;
            interrupts = &lt;21&gt;;
            clocks = &lt;&amp;gate_clk 14&gt;, &lt;&amp;gate_clk 15&gt;;
            clock-names = &quot;0&quot;, &quot;1&quot;;
            status = &quot;disabled&quot;;
        };

    };
};</code></pre></div><p>kirkwood-pogo_e02.dts<br /></p><div class="codebox"><pre><code>/dts-v1/;

#include &quot;kirkwood.dtsi&quot;
#include &quot;kirkwood-6192.dtsi&quot;
/* kirkwood 6192 */
/ {
        model = &quot;Cloud Engines Pogoplug Mobile&quot;;
        compatible = &quot;cloudengines,pogov4a1&quot;, &quot;marvell,kirkwood-88f6192&quot;, &quot;marvell,kirkwood&quot;;

        memory {
                device_type = &quot;memory&quot;;
                reg = &lt;0x00000000 0x10000000&gt;;
        };

        chosen {
                bootargs = &quot;console=ttyS0,115200n8 earlyprintk&quot;;
        };

        ocp@f1000000 {
                pinctrl: pin-controller@10000 {
/*                      pmx_usb_power_enable: pmx-usb-power-enable {
                                marvell,pins = &quot;mpp9&quot;;
                                marvell,function = &quot;gpio&quot;;
                        }; */
                        pmx_led_green: pmx-led_green {
                                marvell,pins = &quot;mpp22&quot;;
                                marvell,function = &quot;gpio&quot;;
                        };
                        pmx_led_red: pmx-led_red {
                                marvell,pins = &quot;mpp24&quot;;
                                marvell,function = &quot;gpio&quot;;
                        };
                        pmx_sdio_cd: pmx_sdio_cd {
                                marvell,pins = &quot;mpp27&quot;;
                                marvell,function = &quot;gpio&quot;;
                        };
                        pmx_sdio_wp: pmx_sdio_wp {
                                marvell,pins = &quot;mpp28&quot;;
                                marvell,function = &quot;gpio&quot;;
                        };
                        pmx_eject_button: pmx_eject_button {
                                marvell,pins = &quot;mpp29&quot;;
                                marvell,function = &quot;gpio&quot;;
                        };
            pmx_nand: pmx-nand {
                marvell,pins = &quot;&quot;;
                marvell,function = &quot;nand&quot;;
            };
            pmx_spi: pmx-spi {
                marvell,pins = &quot;mpp7&quot;, &quot;mpp1&quot;, &quot;mpp2&quot;, &quot;mpp3&quot;;
                marvell,function = &quot;spi&quot;;
            };
                };
                uart0: serial@12000 {
                        status = &quot;ok&quot;;
                };
        uart1: serial@12100 {
            status = &quot;ok&quot;;
        };
        i2c0: i2c@11000 {
            status = &quot;ok&quot;;
        };
        spi0: spi@10600 {
            status = &quot;ok&quot;;

            spidev@0 {
                compatible = &quot;spidev&quot;;
                spi-max-frequency = &lt;10000000&gt;;
                reg = &lt;0&gt;;
                mode = &lt;0&gt;;
            };
        };

        };
        gpio-keys {
                compatible = &quot;gpio-keys&quot;;
                #address-cells = &lt;1&gt;;
                #size-cells = &lt;0&gt;;
                pinctrl-0 = &lt;&amp;pmx_eject_button&gt;;
                pinctrl-names = &quot;default&quot;;

                button@1 {
                        label = &quot;Eject button&quot;;
                        linux,code = &lt;KEY_EJECTCD&gt;;
                        gpios = &lt;&amp;gpio0 29 GPIO_ACTIVE_LOW&gt;;
                };
        };
        gpio-leds {
                compatible = &quot;gpio-leds&quot;;
                pinctrl-0 = &lt; &amp;pmx_led_red &amp;pmx_led_green &gt;;
/*              pinctrl-0 = &lt; &amp;pmx_usb_power_enable &amp;pmx_led_red
                              &amp;pmx_led_green &gt;; */
                pinctrl-names = &quot;default&quot;;

                health {
                        label = &quot;status:green:health&quot;;
                        gpios = &lt;&amp;gpio0 22 GPIO_ACTIVE_LOW&gt;;
                        default-state = &quot;keep&quot;;
                };
                fault {
                        label = &quot;status:red:fault&quot;;
                        gpios = &lt;&amp;gpio0 24 GPIO_ACTIVE_LOW&gt;;
                };
        };
/*      regulators {
                compatible = &quot;simple-bus&quot;;
                #address-cells = &lt;1&gt;;
                #size-cells = &lt;0&gt;;
                pinctrl-0 = &lt;&amp;pmx_usb_power_enable&gt;;
                pinctrl-names = &quot;default&quot;;

                usb_power: regulator@1 {
                        compatible = &quot;regulator-fixed&quot;;
                        reg = &lt;1&gt;;
                        regulator-name = &quot;USB Power&quot;;
                        regulator-min-microvolt = &lt;5000000&gt;;
                        regulator-max-microvolt = &lt;5000000&gt;;
                        enable-active-high;
                        regulator-always-on;
                        regulator-boot-on;
                        gpio = &lt;&amp;gpio0 9 GPIO_ACTIVE_HIGH&gt;;
                };
        }; */
};

&amp;nand {
        chip-delay = &lt;40&gt;;
/*        status = &quot;okay&quot;; */

/*      partition@0 {
                label = &quot;u-boot&quot;;
                reg = &lt;0x0000000 0x100000&gt;;
                read-only;
        };

        partition@100000 {
                label = &quot;uImage&quot;;
                reg = &lt;0x0100000 0x400000&gt;;
        };

        partition@500000 {
                label = &quot;pogoplug&quot;;
                reg = &lt;0x0500000 0x2000000&gt;;
        };

        partition@2500000 {
                label = &quot;root&quot;;
                reg = &lt;0x02500000 0x5b00000&gt;;
        }; */
};

&amp;mdio {
        status = &quot;okay&quot;;

        ethphy0: ethernet-phy@0 {
                reg = &lt;0&gt;;
        };
};

&amp;eth0 {
        status = &quot;okay&quot;;
        ethernet0-port@0 {
                phy-handle = &lt;&amp;ethphy0&gt;;
        };
};</code></pre></div><p>The &quot;right&quot; way to merge this is probably to update the rest of the kirkwood*.dts files to use the new mainline dts style but that requires a motivated person with quite a bit of free time on their hands <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Hope this is helpful<br />&nbsp; &nbsp;-Bob</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p250378">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">nwf</div>
					<div class="post-datetime">
						13 Oct 2014, 19:03					</div>
				</div>
				<div class="post-content content">
					<p>For whatever it&#039;s worth; I merged ALARM&#039;s pre-DTS approach into the OpenWRT tree and have it booting on several pogoplugs, though I recognize that it is probably not the preferred way forward.&nbsp; Feel free to stare over my shoulder at <a href="https://github.com/nwf/openwrt/tree/pogov4">https://github.com/nwf/openwrt/tree/pogov4</a> ; I am using a slightly customized boot loader, available at <a href="https://github.com/nwf/u-boot-kirkwood/tree/master">https://github.com/nwf/u-boot-kirkwood/tree/master</a> .&nbsp; Like bsdfox&#039;s work above, I have also enabled I2C.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p250591">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">bsdfox</div>
					<div class="post-datetime">
						15 Oct 2014, 02:41					</div>
				</div>
				<div class="post-content content">
					<p>nwf,</p><p>The patch looks good. I&#039;ve actually just built a 3.16.0 kernel for alarm using the device tree files above and for the most part things are working well. I&#039;m having a problem with both uarts that I&#039;ve been unable to remedy but my i2c and spidev ports are working well and sometimes it&#039;s nice to have a full distro for doing embedded projects.</p><p>In case you have any ideas--<br />echo &quot;f1012000.serial&quot; &gt; /sys/devices/platform/serial8250/driver/bind <br />bash: echo: write error: No such device</p><p><strong> UPDATE: </strong> I found that I needed the of_serial driver and no other changes. There&#039;s an interesting thread that can be read regarding this at <a href="http://www.plugcomputer.org/plugforum/index.php?topic=6255.20;wap2">http://www.plugcomputer.org/plugforum/i … 55.20;wap2</a> which eventually gets you to the solution here <a href="http://www.mail-archive.com/devicetree-discuss@lists.ozlabs.org/msg12134.html">http://www.mail-archive.com/devicetree- … 12134.html</a></p>											<p class="post-edited">(Last edited by <strong>bsdfox</strong> on 15 Oct 2014, 03:22)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p250688">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">nguyen</div>
					<div class="post-datetime">
						15 Oct 2014, 18:55					</div>
				</div>
				<div class="post-content content">
					<p>When I enable MPP28, Pogoplug Mobile detects SD card read only if the switch in normal position and read write if the switch in &quot;lock&quot; position. It should be other way. Have anyone encountered the same problem?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p250721">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">bsdfox</div>
					<div class="post-datetime">
						16 Oct 2014, 00:10					</div>
				</div>
				<div class="post-content content">
					<p>These things are great. I&#039;ve got a little 2.2&quot; lcd driven with fbtft working on it. I&#039;ll paste the device tree entries if anyone has interest</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p250725">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">beata</div>
					<div class="post-datetime">
						16 Oct 2014, 02:04					</div>
				</div>
				<div class="post-content content">
					<p>bsdfox,</p><p>Could you post the location/photo for the i2c pads?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p250729">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">bsdfox</div>
					<div class="post-datetime">
						16 Oct 2014, 02:37					</div>
				</div>
				<div class="post-content content">
					<p><span class="postimg"><img src="http://ibin.co/1drrFozAtyzP" alt="PogoPlug v4 i2c pins" /></span><br />that&#039;s SDA on the bottom left and SCL on the top right</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p250745">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">nwf</div>
					<div class="post-datetime">
						16 Oct 2014, 09:12					</div>
				</div>
				<div class="post-content content">
					<p>nguyen, check the setting of active_low for that pin.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p250827">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">nguyen</div>
					<div class="post-datetime">
						16 Oct 2014, 19:41					</div>
				</div>
				<div class="post-content content">
					<p>Hello mwf,</p><p>This is what I set in the dts file.<br /></p><div class="codebox"><pre><code>                mvsdio@90000 {
                        pinctrl-0 = &lt;&amp;pmx_sdio &amp;pmx_sdio_cd &amp;pmx_sdio_wp&gt;;
                        pinctrl-names = &quot;default&quot;;
                        cd-gpios = &lt;&amp;gpio0 27 1&gt;;
                        wp-gpios = &lt;&amp;gpio0 28 0&gt;;
                        status = &quot;okay&quot;;
                };</code></pre></div><p>I am using BB and the kernel is 3.10. Can anyone upload the kernel and rootfs zip file for testing the Pogoplug Mobile device?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p250829">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">bsdfox</div>
					<div class="post-datetime">
						16 Oct 2014, 19:45					</div>
				</div>
				<div class="post-content content">
					<p>nguyen,</p><p>try&nbsp; wp-gpios = &lt;&amp;gpio0 28 GPIO_ACTIVE_LOW&gt;;</p><div class="quotebox"><cite>nguyen wrote:</cite><blockquote><p>Hello mwf,</p><p>This is what I set in the dts file.<br /></p><div class="codebox"><pre><code>                mvsdio@90000 {
                        pinctrl-0 = &lt;&amp;pmx_sdio &amp;pmx_sdio_cd &amp;pmx_sdio_wp&gt;;
                        pinctrl-names = &quot;default&quot;;
                        cd-gpios = &lt;&amp;gpio0 27 1&gt;;
                        wp-gpios = &lt;&amp;gpio0 28 0&gt;;
                        status = &quot;okay&quot;;
                };</code></pre></div><p>I am using BB and the kernel is 3.10. Can anyone upload the kernel and rootfs zip file for testing the Pogoplug Mobile device?</p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p250919">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">nguyen</div>
					<div class="post-datetime">
						17 Oct 2014, 08:30					</div>
				</div>
				<div class="post-content content">
					<p>Thank you mwf and bsdfox. The source cannot be compiled if I define GPIO_ACTIVE_LOW constant. I am using official BB release which kernel version is 3.10. Here are the sources:</p><p>pogoplugv4-setup.c<br /></p><div class="codebox"><pre><code>/*
 * arch/arm/mach-kirkwood/pogoplugv4-setup.c
 *
 * Pogoplug Series 4 Setup
 *
 * This file is licensed under the terms of the GNU General Public
 * License version 2.  This program is licensed &quot;as is&quot; without any
 * warranty of any kind, whether express or implied.
 */

#include &lt;linux/kernel.h&gt;
#include &lt;linux/init.h&gt;
#include &lt;linux/platform_device.h&gt;
#include &lt;linux/mtd/partitions.h&gt;
#include &lt;linux/ata_platform.h&gt;
#include &lt;linux/mv643xx_eth.h&gt;
#include &lt;linux/gpio.h&gt;
#include &lt;linux/gpio_keys.h&gt;
#include &lt;linux/leds.h&gt;
#include &lt;linux/pci.h&gt;
#include &lt;linux/irq.h&gt;
#include &lt;linux/spi/flash.h&gt;
#include &lt;linux/spi/spi.h&gt;
#include &lt;linux/input.h&gt;
#include &lt;asm/mach-types.h&gt;
#include &lt;asm/mach/arch.h&gt;
#include &lt;mach/kirkwood.h&gt;
#include &lt;linux/platform_data/mmc-mvsdio.h&gt;
#include &lt;plat/orion-gpio.h&gt;
#include &quot;common.h&quot;
#include &quot;mpp.h&quot;

static struct mtd_partition ppv4_nand_parts[] = {
    {
        .name    = &quot;u-boot&quot;,
        .offset    = 0,
        .size    = 2 * SZ_1M
    }, {
        .name    = &quot;uImage&quot;,
        .offset    = MTDPART_OFS_NXTBLK,
        .size    = 3 * SZ_1M
    }, {
        .name    = &quot;uImage2&quot;,
        .offset    = MTDPART_OFS_NXTBLK,
        .size    = 3 * SZ_1M
    }, {
        .name    = &quot;failsafe&quot;,
        .offset    = MTDPART_OFS_NXTBLK,
        .size    = SZ_8M
    }, {
        .name    = &quot;root&quot;,
        .offset    = MTDPART_OFS_NXTBLK,
        .size    = MTDPART_SIZ_FULL
    },
};

static struct mv643xx_eth_platform_data pogoplugv4_ge00_data = {
    .phy_addr    = MV643XX_ETH_PHY_ADDR(0),
};

static struct mv_sata_platform_data pogoplugv4_sata_data = {
    .n_ports    = 1,
};

static struct gpio_keys_button pogoplugv4_button_pins[] = {
    {
        .code        = KEY_EJECTCD,
        .gpio        = 29,
        .desc        = &quot;Eject Button&quot;,
        .active_low    = 1,
    },
};

static struct gpio_keys_platform_data pogoplugv4_button_data = {
    .buttons    = pogoplugv4_button_pins,
    .nbuttons    = ARRAY_SIZE(pogoplugv4_button_pins),
};

static struct platform_device pogoplugv4_buttons = {
    .name        = &quot;gpio-keys&quot;,
    .id        = -1,   
    .num_resources  = 0,
    .dev        = {
        .platform_data  = &amp;pogoplugv4_button_data,
    },
};

static struct gpio_led pogoplugv4_led_pins[] = {
    {
        .name            = &quot;status:green:health&quot;,
        .default_trigger    = &quot;default-on&quot;,
        .gpio            = 22,
        .active_low        = 1,
    },
    {
        .name            = &quot;status:red:fault&quot;,
        .default_trigger    = &quot;none&quot;,
        .gpio            = 24,
        .active_low        = 1,
    },
};

static struct gpio_led_platform_data pogoplugv4_led_data = {
    .leds        = pogoplugv4_led_pins,
    .num_leds    = ARRAY_SIZE(pogoplugv4_led_pins),
};

static struct platform_device pogoplugv4_leds = {
    .name    = &quot;leds-gpio&quot;,
    .id    = -1,
    .dev    = {
        .platform_data    = &amp;pogoplugv4_led_data,
    }
};

static struct mvsdio_platform_data ppv4_mvsdio_data = {
    .gpio_card_detect = 27,
    .gpio_write_protect = 28,
};

static unsigned int ppv4_mpp_config[] __initdata = {
    MPP27_GPIO,    /* SD card detect */
    MPP28_GPIO, /* SD card write protect */
    MPP29_GPIO,    /* Eject button */
    MPP22_GPIO,    /* Green LED */
    MPP24_GPIO,    /* Red LED */
    MPP12_SD_CLK,
    MPP13_SD_CMD,
    MPP14_SD_D0,
    MPP15_SD_D1,
    MPP16_SD_D2,
    MPP17_SD_D3,
    0
};

static const struct flash_platform_data pogoplugv4_spi_slave_data = {
    .type        = &quot;m25p05-nonjedec&quot;,
};

static struct spi_board_info __initdata pogoplugv4_spi_slave_info[] = {
    {
        .modalias    = &quot;m25p05-nonjedec&quot;,
        .platform_data    = &amp;pogoplugv4_spi_slave_data,
        .irq        = -1,
        .max_speed_hz    = 20000000,
        .bus_num    = 0,
        .chip_select    = 0,
    },
};

static void __init pogoplugv4_init(void)
{
    /*
     * Basic setup. Needs to be called early.
     */
    kirkwood_init();
    kirkwood_mpp_conf(ppv4_mpp_config);

    kirkwood_ehci_init();
    kirkwood_ge00_init(&amp;pogoplugv4_ge00_data);
    kirkwood_sata_init(&amp;pogoplugv4_sata_data);
    spi_register_board_info(pogoplugv4_spi_slave_info,
                ARRAY_SIZE(pogoplugv4_spi_slave_info));
    kirkwood_spi_init();
    kirkwood_uart0_init();
    kirkwood_nand_init(ARRAY_AND_SIZE(ppv4_nand_parts), 25);
    kirkwood_sdio_init(&amp;ppv4_mvsdio_data);
    platform_device_register(&amp;pogoplugv4_leds);
    platform_device_register(&amp;pogoplugv4_buttons);
}

static int __init pogoplugv4_pci_init(void)
{
    if (machine_is_pogoplugv4())
        kirkwood_pcie_init(KW_PCIE0);

    return 0;
}
subsys_initcall(pogoplugv4_pci_init);

MACHINE_START(POGOPLUGV4, &quot;Pogoplug V4&quot;)
    /* Maintainer: Kevin Mihelich &lt;kevin@archlinuxarm.org&gt; */
    .atag_offset    = 0x100,
    .init_machine    = pogoplugv4_init,
    .map_io        = kirkwood_map_io,
    .init_early    = kirkwood_init_early,
    .init_irq    = kirkwood_init_irq,
    .init_time    = kirkwood_timer_init,
    .restart    = kirkwood_restart,
MACHINE_END</code></pre></div><p>kirkwood-pogoplugv4.dts<br /></p><div class="codebox"><pre><code>/dts-v1/;

/include/ &quot;kirkwood.dtsi&quot;
/include/ &quot;kirkwood-6281.dtsi&quot;

/ {
    model = &quot;Pogoplug V4&quot;;
    compatible = &quot;cloudengines,pogoplugv4&quot;, &quot;marvell,kirkwood-88f6192&quot;, &quot;marvell,kirkwood&quot;;

    memory {
        device_type = &quot;memory&quot;;
        reg = &lt;0x00000000 0x8000000&gt;;
    };

    chosen {
        bootargs = &quot;console=ttyS0,115200 earlyprintk root=/dev/mmcblk0p1 rootdelay=10&quot;;
    };

    mbus {
        pcie-controller {
            status = &quot;okay&quot;;

            pcie@1,0 {
                status = &quot;okay&quot;;
            };
        };
    };

    ocp@f1000000 {
        pinctrl: pinctrl@10000 {
            pmx_led_green: pmx-led-green {
                marvell,pins = &quot;mpp22&quot;;
                marvell,function = &quot;gpio&quot;;
            };
            pmx_led_red: pmx-led-red {
                marvell,pins = &quot;mpp24&quot;;
                marvell,function = &quot;gpio&quot;;
            };
            pmx_sdio_cd: pmx-sdio-cd {
                marvell,pins = &quot;mpp27&quot;;
                marvell,function = &quot;gpio&quot;;
            };
            pmx_sdio_wp: pmx-sdio-wp {
                marvell,pins = &quot;mpp28&quot;;
                marvell,function = &quot;gpio&quot;;
            };
            pmx_button_eject: pmx-button-eject {
                marvell,pins = &quot;mpp29&quot;;
                marvell,function = &quot;gpio&quot;;
            };
        };

        spi@10600 {
            status = &quot;okay&quot;;

            m25p05@0 {
                compatible = &quot;m25p05-nonjedec&quot;;
                reg = &lt;0&gt;;
                spi-max-frequency = &lt;20000000&gt;;
                mode = &lt;0&gt;;
            };
        };

        serial@12000 {
            status = &quot;ok&quot;;
        };

        nand@3000000 {
            status = &quot;okay&quot;;

            partition@0 {
                label = &quot;u-boot&quot;;
                reg = &lt;0x0000000 0x200000&gt;;
                read-only;
            };

            partition@200000 {
                label = &quot;uImage&quot;;
                reg = &lt;0x200000 0x300000&gt;;
            };

            partition@500000 {
                label = &quot;uImage2&quot;;
                reg = &lt;0x500000 0x300000&gt;;
            };

            partition@800000 {
                label = &quot;failsafe&quot;;
                reg = &lt;0x800000 0x800000&gt;;
            };

            partition@2500000 {
                label = &quot;root&quot;;
                reg = &lt;0x1000000 0x7000000&gt;;
            };
        };

        sata@80000 {
            status = &quot;okay&quot;;
            nr-ports = &lt;1&gt;;
        };

        mvsdio@90000 {
            pinctrl-0 = &lt;&amp;pmx_sdio &amp;pmx_sdio_cd &amp;pmx_sdio_wp&gt;;
            pinctrl-names = &quot;default&quot;;
            status = &quot;okay&quot;;
            cd-gpios = &lt;&amp;gpio0 27 1&gt;;
            wp-gpios = &lt;&amp;gpio0 28 0&gt;;
        };
    };

    gpio-leds {
        compatible = &quot;gpio-leds&quot;;
        pinctrl-0 = &lt;&amp;pmx_led_green &amp;pmx_led_red&gt;;
        pinctrl-names = &quot;default&quot;;
        health {
            label = &quot;status:green:health&quot;;
            gpios = &lt;&amp;gpio0 22 1&gt;;
            linux,default-trigger = &quot;default-on&quot;;
        };
        fault {
            label = &quot;status:red:fault&quot;;
            gpios = &lt;&amp;gpio0 24 1&gt;;
            linux,default-trigger = &quot;none&quot;;
        };
    };

    gpio_keys {
        compatible = &quot;gpio-keys&quot;;
        #address-cells = &lt;1&gt;;
        #size-cells = &lt;0&gt;;
        pinctrl-0 = &lt;&amp;pmx_button_eject&gt;;
        pinctrl-names = &quot;default&quot;;

        button@1 {
            label = &quot;Eject Button&quot;;
            linux,code = &lt;161&gt;;
            gpios = &lt;&amp;gpio0 29 1&gt;;
        };
    };
};

&amp;mdio {
    status = &quot;okay&quot;;

    ethphy0: ethernet-phy@0 {
        device_type = &quot;ethernet-phy&quot;;
        reg = &lt;0&gt;;
    };
};

&amp;eth0 {
    status = &quot;okay&quot;;
    ethernet0-port@0 {
        phy-handle = &lt;&amp;ethphy0&gt;;
    };
};</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p251100">
				<div class="post-metadata">
					<div class="post-num">Post #21</div>
					<div class="post-author">bsdfox</div>
					<div class="post-datetime">
						18 Oct 2014, 20:34					</div>
				</div>
				<div class="post-content content">
					<p>nguyen,</p><p>That first file looks like a standard board file.. a devicetree kernel shouldn&#039;t need that. I&#039;d recommend you move to trunk if your current kernel is using the board files.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p251149">
				<div class="post-metadata">
					<div class="post-num">Post #22</div>
					<div class="post-author">beata</div>
					<div class="post-datetime">
						19 Oct 2014, 08:11					</div>
				</div>
				<div class="post-content content">
					<p>Merged BSD&#039;s device tree into mine own, and a couple dozen silly errors later I&#039;m booted. From this point, I&#039;m going to work on getting going on an unopened box.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p251249">
				<div class="post-metadata">
					<div class="post-num">Post #23</div>
					<div class="post-author">nguyen</div>
					<div class="post-datetime">
						20 Oct 2014, 07:48					</div>
				</div>
				<div class="post-content content">
					<p>bsdfox,</p><p>Actually dts is the only file was used in BB. Changing .c file doesn&#039;t effect at all. I want to stick with official release. Just ignore mpp28 for awhile, hopefully someone finds a solution.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p251401">
				<div class="post-metadata">
					<div class="post-num">Post #24</div>
					<div class="post-author">nguyen</div>
					<div class="post-datetime">
						21 Oct 2014, 08:57					</div>
				</div>
				<div class="post-content content">
					<p>Kernel 3.10 drivers\mmc\host\mvsdio.c has a bug which detects write protection wrongly. The problem has been fixed in Kernel 3.12 and 3.14. Instead of using <br /></p><div class="codebox"><pre><code>gpio_card_detect = of_get_named_gpio(np, &quot;cd-gpios&quot;, 0);
gpio_write_protect = of_get_named_gpio(np, &quot;wp-gpios&quot;, 0);</code></pre></div><p>,<br /></p><div class="codebox"><pre><code>mmc_of_parse(mmc);</code></pre></div><p>should be used.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p251716">
				<div class="post-metadata">
					<div class="post-num">Post #25</div>
					<div class="post-author">nwf</div>
					<div class="post-datetime">
						23 Oct 2014, 08:35					</div>
				</div>
				<div class="post-content content">
					<p>I updated my patch to use FDT (thanks to everyone here for their help <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> ) ; have a look at <a href="https://github.com/nwf/openwrt/tree/pogov4">https://github.com/nwf/openwrt/tree/pogov4</a> again.&nbsp; (Commit 615229b6 as of right now though I might push --force over it later).</p><p>The default uboot environment in the tree is still not useful, but I&#039;m thinking about making it contain something like the below.&nbsp; In my limited testing, it works pretty well, but thoughts are of course welcome.&nbsp; It&#039;s a big wad of uboot shell, but it tries to boot from mmc and then usb, first looking in / and then looking in /boot, before booting ubi rootfs:/boot/uImage.&nbsp; In all cases, it looks for a uImage, an optional uInitrd, and an optional pogov4.dtb file.&nbsp; Ordering and even whether to try something is easily done by tweaking the bootcmd variable to just not call as many runs, or call them in a different order.</p><div class="codebox"><pre><code>setenv mtdids nand0=orion_nand

setenv bootargs_console console=ttyS0,115200n8

setenv bootcmd_do_bootm &#039;setenv bootargs $bootargs_console $mtdids $mtdparts $loaderbootargs; bootm ${bootmargs}&#039;

setenv boot_condload &#039;if ${loadercmd} 0x00800000 ${loaderprefix}/uImage; then if ${loadercmd} 0x01100000 ${loaderprefix}/uInitrd; then setenv bootmargs 0x00800000 0x01100000; else setenv bootmargs 0x00800000 -; fi; if ${loadercmd} 0x00700000 ${loaderprefix}/pogov4.dtb; then fdt addr 0x00700000; fdt resize; fdt chosen; setenv bootmargs ${bootmargs} 0x00700000; fi; run bootcmd_do_bootm; fi&#039;

setenv boot_try_mmc &#039;if mmc info; then setenv loadercmd &quot;ext4load mmc 0:1&quot;; setenv loaderbootargs &quot;root=/dev/mmcblk0p1 rootfstype=ext4 rootwait&quot;; run boot_condload; fi&#039;

setenv boot_try_usb &#039;if usb storage; then setenv loadercmd &quot;ext4load usb 0:1&quot;; setenv loaderbootargs &quot;root=/dev/sda1 rootfstype=ext4 rootwait&quot;; run boot_condload; fi&#039;

setenv boot_try_ubi &#039;if ubi part root ; ubifsmount ubi:rootfs ; then setenv loadercmd &quot;ubifsload&quot;; setenv loaderbootargs &quot;ubi.mtd=1 root=ubi0:rootfs rootfstype=ubifs&quot;; run boot_condload; fi&#039;

setenv bootcmd &#039;mmc rescan; usb start; loaderprefix= ; run boot_try_mmc; run boot_try_usb; loaderprefix=/boot; run boot_try_mmc; run boot_try_usb; run boot_try_ubi&#039;</code></pre></div>											<p class="post-edited">(Last edited by <strong>nwf</strong> on 23 Oct 2014, 08:35)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>