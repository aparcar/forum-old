<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Support for Marvell 88F5xx81 based routers</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 18 Jan 2014 and 6 May 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 14 of 46</div><nav><ul><li><a href="viewtopic.php%3Fid=12358&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=12358&amp;p=12.html">12</a></li><li><a href="viewtopic.php%3Fid=12358&amp;p=13.html">13</a></li><li class="pagination-current"><span>14</span></li><li><a href="viewtopic.php%3Fid=12358&amp;p=15.html">15</a></li><li><a href="viewtopic.php%3Fid=12358&amp;p=16.html">16</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=12358&amp;p=46.html">46</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p88206">
				<div class="post-metadata">
					<div class="post-num">Post #326</div>
					<div class="post-author">mrk</div>
					<div class="post-datetime">
						18 May 2009, 22:08					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>heji wrote:</cite><blockquote><p>root@OpenWrt:/tmp# dd if=wrt350nv2-uImage of=/dev/mtdblock0<br />dd: writing &#039;/dev/mtdblock0&#039;: No space left on device<br />2049+0 records in<br />2048+0 records out</p><p>copy kernel from 0xff800000 to 0x400000 with size 0x200000<br />## Booting image at 00400000 ...<br />&nbsp; &nbsp;Image Name:&nbsp; &nbsp;Linux-2.6.28.10<br />&nbsp; &nbsp;Image Type:&nbsp; &nbsp;ARM Linux Kernel Image (uncompressed)<br />&nbsp; &nbsp;Data Size:&nbsp; &nbsp; 1061680 Bytes =&nbsp; 1 MB<br />&nbsp; &nbsp;Load Address: 00008000<br />&nbsp; &nbsp;Entry Point:&nbsp; 00008000<br />&nbsp; &nbsp;Verifying Checksum ... Bad Data CRC<br />Marvell&gt;&gt;</p><p>How to change the size of mtd0?</p></blockquote></div><p>Hello heji,<br />why did You need such a huge kernel file?</p><p>As recommended some pages before, You should compile a minimal configuration and than add the packages via opkg.<br />The kernel must be under 0x100000 bytes.</p><p>In <em>wrt350nv2-setup.c</em> the mtd-blocks are defined and the openwrt patch (100- ...) for the mtd_partitions can be found at <em>......openwrt/target/linux/orion/patches</em>.<br />In my mind the parameters in the patch are quite useful and should be left as they are.</p><p>I added some lines of code to Dirk&#039;s imagebuilder checking the sizes of the kernel (&lt;0x100000) and the sqashfs (&lt;0x650000) file and doing the &quot;-v&quot; - parameter.</p><p>Maddes would You please publish the code? I don&#039;t have an accurate webspace for that.</p><p><span class="bbu">Other tinks to do:</span><br />I am just analysing the original firmware and found out, that the mac-address is configures via a little helper programm.<br />When I am ready with my new computer, I will reproduce this for openwrt.</p><p>The leds for the wlan-activities are still aweful.<br />Has someone a hint for me to connect the led-triggers from ath9k to the leds of the wrt350n?<br />I am afraid, we need another helper-program for that.</p>											<p class="post-edited">(Last edited by <strong>mrk</strong> on 18 May 2009, 22:08)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p88250">
				<div class="post-metadata">
					<div class="post-num">Post #327</div>
					<div class="post-author">MM</div>
					<div class="post-datetime">
						19 May 2009, 14:22					</div>
				</div>
				<div class="post-content content">
					<p>I have got the same problem, compiling trunk just produces an kernel image, that is too big:</p><p>ls -l bin/<br />-rw-r--r-- 1 mm mm 1068940 2009-05-19 13:15 openwrt-wrt350nv2-uImage</p><p>echo $((1024*1024))<br />1048576</p><p>So it can&#039;t fit into the kernel mtd.</p><p>Or am I missing soemthing? </p><p>The image on <br /><a href="http://downloads.openwrt.org/snapshots/trunk/orion/packages/">http://downloads.openwrt.org/snapshots/ … /packages/</a><br />is also too big.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p88262">
				<div class="post-metadata">
					<div class="post-num">Post #328</div>
					<div class="post-author">mrk</div>
					<div class="post-datetime">
						19 May 2009, 19:26					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>MM wrote:</cite><blockquote><p>I have got the same problem, compiling trunk just produces an kernel image, that is too big:</p><p>ls -l bin/<br />-rw-r--r-- 1 mm mm 1068940 2009-05-19 13:15 openwrt-wrt350nv2-uImage</p><p>echo $((1024*1024))<br />1048576</p><p>So it can&#039;t fit into the kernel mtd.</p><p>Or am I missing soemthing? </p><p>The image on <br /><a href="http://downloads.openwrt.org/snapshots/trunk/orion/packages/">http://downloads.openwrt.org/snapshots/ … /packages/</a><br />is also too big.</p></blockquote></div><p>Well, try to delete the patch <strong>100-openwrt_partition_map.patch</strong> at <em>openwrt/target/linux/orion/patches</em> and build the kernel again.<br />Then You have 0x1A0000 bytes for kernel an 0x5c0000 bytes for squashfs inclusive jffs2. That are the original sizes from linksys.<br />But with that sizes the jffs2-partition for the additional packages is rather reduced.</p><p>I think, we have to inspect the underlying config-file from the present kernel, maybe it could be cleaned.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p88558">
				<div class="post-metadata">
					<div class="post-num">Post #329</div>
					<div class="post-author">maddes.b</div>
					<div class="post-datetime">
						24 May 2009, 01:20					</div>
				</div>
				<div class="post-content content">
					<p>Started another thread about setting up a router with USB stick (ext3) as jffs addition/replacement: <a href="http://forum.openwrt.org/viewtopic.php?id=20436">http://forum.openwrt.org/viewtopic.php?id=20436</a><br />Please have a look at it, as this is something a lot of people will be interested in. Thanks.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p88562">
				<div class="post-metadata">
					<div class="post-num">Post #330</div>
					<div class="post-author">maddes.b</div>
					<div class="post-datetime">
						24 May 2009, 02:17					</div>
				</div>
				<div class="post-content content">
					<p>I have some questions and suggestions regarding the mtd mapping.</p><p>#1 The original mtd mapping:<br />&quot;kernel&quot; = size 0x00760000, &quot;truncated&quot; by &quot;rootfs&quot; at 0x001A0000 (= 1,625 MB)<br />&quot;rootfs&quot; = size 0x005c0000 (=5,75 MB)<br />&quot;lang&quot; = size 0x00040000 (=256KB)<br />&quot;nvram&quot; = size 0x00020000 (=128KB)<br />&quot;u-boot&quot; = size 0x00040000 (=256KB)</p><p>Is the huge overlapping size of &quot;kernel&quot; a trick to allow for any kernel size?<br />Isn&#039;t there a marker after the kernel image that tells the system &quot;here begins rootfs&quot;?</p><p>If so then it would be good to keep this technique for any kernel size, &quot;truncation&quot; could be moved down to 0x100000 to allow for a bigger &quot;rootfs&quot;.<br />Only issue is that a new kernel image with a different size (even only 1 byte more or less) and over 1MB will make the old &quot;rootfs&quot; unusable.</p><p>#2 The patched mtd mapping:<br />&quot;u-boot&quot; should never be touched. &quot;lang&quot; can definitely be added to &quot;rootfs&quot;.<br />&quot;nvram&quot; could be kept to preserve the config for the stock firmware (it&#039;s just 128KB)</p><br /><p>If all would apply then I would define the following mtd:<br />&quot;kernel&quot; = size 0x007a0000, offset 0x00000000<br />&quot;rootfs&quot; = size 0x006A0000, offset 0x00100000 (max. 6,625 MB, truncated at the beginning through kernel image size, &quot;save&quot; kernel update up to 1MB)<br />&quot;nvram&quot; = size 0x00020000, offset 0x007a0000<br />&quot;u-boot&quot; = size 0x00040000, offset 0x007c0000</p><p>Or to allow updating [mini] kernel with a higher chance to continue with the old rootfs. Writing into &quot;rootfs&quot; area with a mini kernel would be quite unlikely.<br /> &quot;rootfs&quot; = size 0x00600000, offset 0x001A0000 (= 1,625 MB for &quot;save&quot; kernel update) <br />- or -<br /> &quot;rootfs&quot; = size 0x00660000, offset 0x00140000 (= 1,25 MB for &quot;save&quot; kernel update) </p><p>Can somebody confirm or deny?</p><p>Can the mtd mapping be changed after flashing?</p><p>Maddes</p>											<p class="post-edited">(Last edited by <strong>maddes.b</strong> on 24 May 2009, 02:42)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p88564">
				<div class="post-metadata">
					<div class="post-num">Post #331</div>
					<div class="post-author">dirkNL</div>
					<div class="post-datetime">
						24 May 2009, 02:58					</div>
				</div>
				<div class="post-content content">
					<p>I can be very short in answering that, no you can&#039;t change MTD after flashing.</p><p>It&#039;s because the kernel you flash with contains the offset address for the rootfs (hardcoded in the wrt&#039;s setup.c file). So if you would change the mtd map your kernel would still try to jump to the old address space. Ofcourse that will fail and you&#039;ll get a kernel panic about not able to find a valid root filesystem.</p><p>The default mtd Linksys provided has got overlapping kernel/rootfs space for simple firmware upgrades. e.g. if you flash a complete image containing both kernel and rootfs with the correct address mappings, you&#039;ll only have to overwrite 1 mtd space.</p><p>Though that&#039;s very convenient for flashing purposes, OpenWRT chose not maintain these overlapping spaces. It&#039;s a bit safer that way, e.g. when you flash a kernel which is too large to fit in the kernel space it&#039;ll just fail. Whereas it would with the original firmware overwrite the first bit of your rootfs.</p><p>It doesn&#039;t mean ofcourse that you&#039;re stuck using the OpenWRT layout. If you really need more space for your kernel you could just patch your kernel with a larger kernel mtd and a smaller rootfs partition. If you would want to create a webupgrade image from those sources DON&#039;T forget to change the .par file you provide the builderprogram with!</p><p>nvram is deprecated so indeed only for original &quot;backup&quot; you could leave it alone, but don&#039;t forget we&#039;re already losing some space for the &quot;ErCoMm&quot; safety patch.</p><p>So to sum up, you can change the mtd to your likings, just make sure you stay clear from the ercomm bytes and the u-boot partition and you&#039;ll be fine. And MTD changes inevitably mean you need to reflash your kernel and rootfs. Hope this clears everything up for you.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p88583">
				<div class="post-metadata">
					<div class="post-num">Post #332</div>
					<div class="post-author">maddes.b</div>
					<div class="post-datetime">
						24 May 2009, 13:00					</div>
				</div>
				<div class="post-content content">
					<p>Sorry, didn&#039;t remember your <a href="http://forum.openwrt.org/viewtopic.php?pid=74374#p74374">posting about ErCoMm hell</a>, where the problem with the ErCoMm signature and erasesize was mentioned&nbsp; (near the end of that post).</p><p>So there should be still some buffer for newer, and maybe bigger, kernel images:<br />&quot;kernel&quot; = offset 0x00000000, size 0x00140000 (= 1280 KB) <br />&quot;rootfs&quot; = offset 0x00140000, size 0x00610000 (= 6208 KB)<br />&quot;ErCoMm&quot; = offset 0x00750000, size 0x00010000 (= preserve ErCoMm signature for LinkSys U-Boot)<br />&quot;lang&quot; = offset 0x00760000, size 0x00040000 <br />&quot;nvram&quot;&nbsp; = offset 0x007a0000, size 0x00020000 (= preserve config of stock firmware)<br />&quot;u-boot&quot; = offset 0x007c0000, size 0x00040000</p><p>Only an self-made U-Boot would make the area 0x00750000 to 0x007a0000/0x007c0000 accessible for &quot;rootfs&quot; or something else.<br />relghuar has created a <a href="http://forum.openwrt.org/viewtopic.php?pid=81962#p81962">custom U-Boot</a> for his WRT350Nv2.<br />As far as I know OpenWrt doesn&#039;t include U-Boot, so this would be a side project.<br />Would re-flashing the stock firmware result in a booting router with this U-Boot version?</p><p>Thanks<br />Maddes</p><p>Edit:<br />Uploaded <a href="ftp://ftp.maddes.net/openwrt/trunk/orion/patches/">adopted 100-openwrt_partition_map.patch</a> to my ftp space. (best choice is 0x00120000 for now)<br />Please check and tell if I followed all the rules.<br />Now working.</p><p>And changed rootfs.squash in tools/wrt350nv2-builder/src/wrt350nv2-par like this (for 0x00120000 kernel mtd size):<br /></p><div class="codebox"><pre><code>:uImage      &amp;000000
:rootfs.squash   &amp;11fff0
:u-boot.bin  &amp;7bfff0
%wrt350n.pid &amp;7fffff &amp;75ffe0
$SIZE        &amp;2000</code></pre></div><p>Edit II:<br />The new MTD configuration was submitted to the developer mailing list.</p>											<p class="post-edited">(Last edited by <strong>maddes.b</strong> on 7 Apr 2010, 21:28)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p88611">
				<div class="post-metadata">
					<div class="post-num">Post #333</div>
					<div class="post-author">maddes.b</div>
					<div class="post-datetime">
						24 May 2009, 22:24					</div>
				</div>
				<div class="post-content content">
					<p>How do I flash from inside U-Boot with the following files:<br />openwrt-wrt350nv2-uImage<br />openwrt-orion-squashfs.img</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p88785">
				<div class="post-metadata">
					<div class="post-num">Post #334</div>
					<div class="post-author">mrk</div>
					<div class="post-datetime">
						26 May 2009, 21:40					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>maddes.b wrote:</cite><blockquote><p>How do I flash from inside U-Boot with the following files:<br />openwrt-wrt350nv2-uImage<br />openwrt-orion-squashfs.img</p></blockquote></div><p>Maddes take care. Don&#039;t use the *.img file. <br />Search for the original <strong>root.squashfs</strong> at <em>openwrt/build_dir/linux-orion-generic</em><br />I admit, that uImage size is 0x140000 and squashfs 0x1fffff. <br />It is shown after tftboot. <br />I installed a tftp-server with IP according to the uBoot variables, I think it is <strong>serverip</strong>.</p><p>#### Firmware flash via U-BOOT ####<br />tftpboot 0x400000 openwrt-wrt350nv2-uImage</p><p>erase 0xff800000 0xfff4ffff<br />protect off 0xff800000 0xfff4ffff</p><p>cp.b 0x400000 0xff800000 0x140000</p><p>### Don&#039;t use the *.img file, take the root.squashfs<br />tftpboot 0x400000 squashfs.image<br />cp.b 0x400000 0xff940000 0x1fffff</p><p>If there are some errors with the second cp.b - command, try to <em>erase</em> and <em>protect off</em> als well.</p><p><span class="bbu">Update:</span><br />The file <strong>openwrt-orion-squashfs.img</strong> should be the combined kernel and rootfs.<br />So You can use:<br /></p><div class="codebox"><pre><code>tftpboot 0x400000 openwrt-orion-squashfs.img
erase 0xff800000 0xfff4ffff
protect off 0xff800000 0xfff4ffff
cp.b 0x400000 0xff800000 0x30ffff</code></pre></div><p>If You have a freeze after reboot.<br />Try to reflash only the <strong>openwrt-wrt350nv2-uImage</strong> file.<br /></p><div class="codebox"><pre><code>tftpboot 0x400000 openwrt-wrt350nv2-uImage
protect off 0xff800000 0xff94ffff
cp.b 0x400000 0xff800000 0x140000</code></pre></div><p>If there is still something wrong, please recalc the values.</p>											<p class="post-edited">(Last edited by <strong>mrk</strong> on 27 May 2009, 00:10)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p88808">
				<div class="post-metadata">
					<div class="post-num">Post #335</div>
					<div class="post-author">maddes.b</div>
					<div class="post-datetime">
						27 May 2009, 04:32					</div>
				</div>
				<div class="post-content content">
					<p>Thanks mrk for the hints.</p><p>Just successfully tested the first way by mrk. It can be summed up as following:<br /></p><div class="codebox"><pre><code># temporary change network settings to fit your network
setenv ipaddr 10.0.0.99
setenv serverip 10.0.0.1

# clear flash and unprotect for writing
erase 0xff800000 0xfff4ffff
protect off 0xff800000 0xfff4ffff

# flash kernel
tftpboot 0x400000 &quot;openwrt-wrt350nv2-uImage&quot;
cp.b 0x400000 0xff800000 &lt;transferred bytes&gt;

# flash rootfs
tftpboot 0x400000 &quot;root.squashfs&quot;
cp.b 0x400000 &lt;0xff800000 + used rootfs MTD offset&gt; &lt;transferred bytes&gt;</code></pre></div><p><span class="bbu">Update:</span><br />The second way didn&#039;t work for me, also flashing takes longer (big img + kernel) and needs some more calculation.<br />I assume the .img is not just kernel + mtd padding + rootfs</p>											<p class="post-edited">(Last edited by <strong>maddes.b</strong> on 27 May 2009, 04:51)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p88946">
				<div class="post-metadata">
					<div class="post-num">Post #336</div>
					<div class="post-author">maddes.b</div>
					<div class="post-datetime">
						29 May 2009, 13:49					</div>
				</div>
				<div class="post-content content">
					<p>I know that a larger kernel with new MTD mapping can be flashed from inside Linux if there&#039;s access to serial console.<br />Compile it once as a ramdisk build and once as a squashfs build.<br />TFTBOOT the ramdisk image of the kernel with new MTD mapping.<br />Telnet to the router, use passwd to set password and enable SSH.<br />When inside Linux use wget or SFTP/SSH to retrieve the squashfs kernel, then flash it with dd writing to /dev/mtdblock0.<br />Remove the squashfs kernel to re-gain space, then fetch the root.squashfs from the other machine and flash it with dd writing to /dev/mtdblock1.<br />(root.squashfs can be found under ./build_dir/linux-orion_generic in the trunk directory, or use: find . -name &quot;root.squashfs&quot; inside the trunk directory)<br />Remove the power from the router, then reestablish it.<br />Now you can telnet to the router again.</p><p>Question:<br />Is it possible to flash a bigger kernel with a new MTD mapping without TFTPBOOT/serial console?<br />If not, should there be an extra overlapping MTD entry, e.g. &quot;org_mtd0&quot; (0x0-0x760000)?<br />Or better keep the original MTD settings?</p><p>How does Luci, X-Wrt or OpenWrt normally flash updates?<br />Does the same issue apply to this way of flashing?</p><p>I think this flashing &quot;issue&quot; is the last hurdle to let it loose onto the normal user.</p><p>Kind regards<br />Maddes</p><p>P.S.: Will add all information to the wiki, when the new wiki is available.</p>											<p class="post-edited">(Last edited by <strong>maddes.b</strong> on 31 May 2009, 23:03)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p88954">
				<div class="post-metadata">
					<div class="post-num">Post #337</div>
					<div class="post-author">dirkNL</div>
					<div class="post-datetime">
						29 May 2009, 17:20					</div>
				</div>
				<div class="post-content content">
					<p>You can always flash from inside a running device, just use ssh or telnet...</p><p>The problem with this method is that you need to divide your new kernel/rootfs to the correct lengths so that they will connect once you reboot with the new layout. </p><p>I&#039;ll try to explain with some `graphics`:</p><p>00 -&gt; Space left for the partition<br />11 -&gt; Kernel<br />22 -&gt; Rootfs</p><div class="codebox"><pre><code>Default layout:
1111 1111 1111 0000 2222 2222 2222 2222 2222 2222 2222 2222 2222 2222 2222 0000 0000 0000 0000 0000

Extended layout:
1111 1111 1111 1111 1111 1111 0000 2222 2222 2222 2222 2222 2222 2222 2222 2222 2222 0000 0000 0000
                    ^
                    Here is where you should cut off the kernel
                              ^    ^ 
                              Here you need to add zero padding to the leftover from the kernel, after that you can just paste the rootfs</code></pre></div><p>If you cut up and paste your kernel and rootfs like this you can use the result to flash from inside a running openwrt with the default layout.</p><p>I&#039;ve flashed like this dozens of times and if you be carefull enough it will succeed. Just double check your mtd sizes multiple times!!!</p><p>afaik there is no &quot;default&quot; way of flashing/upgrading for OpenWRT, maybe someone like Kaloz could answer that one a bit more truthfully.</p>											<p class="post-edited">(Last edited by <strong>dirkNL</strong> on 29 May 2009, 17:23)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p89034">
				<div class="post-metadata">
					<div class="post-num">Post #338</div>
					<div class="post-author">mrk</div>
					<div class="post-datetime">
						31 May 2009, 17:44					</div>
				</div>
				<div class="post-content content">
					<p>OK, I have extended Dirk&#039;s wrt350nv2-webbuilder app a little bit.<br />You can find the new wrt350nv2-builder.c - source <a href="ftp://ftp.maddes.net/openwrt/kamikaze/orion/patches/wrt350n-builder-V1.3.zip">here</a>.<br />Many thanks to maddes, who gives his webspace for that.</p><p>Just extract the zip into the source folder of the webbuilder and recompile.</p><p>The current release now has some new commands which are:<br /></p><div class="codebox"><pre><code>buildimg [-v] [-img] [-cut &lt;hex-value&gt;] parfile
  -v      set verbose mode
  -img  produce uBoot flash image
  -cut &lt;hex-adress&gt;  produce flash image for mtdblock0 and mtdblock1, cut at given position</code></pre></div><p>Explain:<br /><strong>-v</strong> is for verbosing. There are quit interesting information.<br /><strong>-img</strong> produces a via uBoot flashable image-file. It has a fixed filename called <em>wrt350n-uBoot.img</em>.<br /><strong>-cut &lt;hex-adress&gt;</strong> Is for flahing via the mtdblocks in openwrt.<br />This command follows Dirk&#039;s last posting concerning flashing new imagefiles though current mtd-borders in openwrt.<br />The <strong>&lt;hex-adress&gt;</strong> represents the current size of <em>mtdblock0</em> in Your current openwrt and this would be the cutting-point for the webbuilder-app.</p><p>The resulting files can be flashed in openwrt-console with:<br /></p><div class="codebox"><pre><code>dd if=wrt350n.img.mtd0 of=/dev/mtdblock0
dd if=wrt350n.img.mtd1 of=/dev/mtdblock1</code></pre></div><p>Take care about the topics in the <strong>parfile</strong>!<br />The webbuilder uses filenames (i.e. uImage) given there.<br />So if You are in trouble, check the par-file first and look after the filenames and sizes of uImage and rootfs.</p><p>Using the commands <em>-img</em> or <em>-cut</em> will not create a additional webbuilder-flash-file.</p><p>Please let me know, if You are in trouble.</p><p>PS: The full webbuilder files with makefile are <a href="ftp://ftp.maddes.net/openwrt/kamikaze/orion/patches/wrt350n-builder-full.zip">here</a></p>											<p class="post-edited">(Last edited by <strong>mrk</strong> on 31 May 2009, 19:14)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p89325">
				<div class="post-metadata">
					<div class="post-num">Post #339</div>
					<div class="post-author">motopompa</div>
					<div class="post-datetime">
						4 Jun 2009, 23:39					</div>
				</div>
				<div class="post-content content">
					<p>Hello</p><p>Today I have bricked my WRT-350n v2 <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" />. Since I haven&#039;t googled out way to unbrick it, I&#039;m writing this post.</p><p>Bricking it was very simple - I have uploaded root.squashfs insted of uImage. Now power led blinks amber and green and on console i have:</p><div class="codebox"><pre><code>        |  \/  | __ _ _ ____   _____| | |
        | |\/| |/ _` | &#039;__\ \ / / _ \ | |
        | |  | | (_| | |   \ V /  __/ | |
        |_|  |_|\__,_|_|    \_/ \___|_|_|
 _   _     ____              _
| | | |   | __ )  ___   ___ | |_
| | | |___|  _ \ / _ \ / _ \| __|
| |_| |___| |_) | (_) | (_) | |_
 \___/    |____/ \___/ \___/ \__|  ** LOADER **
 ** MARVELL BOARD: RD-88F5181L-VOIP-GE LE

U-Boot 1.1.1 (Dec 12 2006 - 16:12:22) Marvell version: 1.7.3

DRAM CS[0] base 0x00000000   size  32MB
DRAM Total size  32MB
Flash: mvFlashInit base 0xff800000 devW 1 busW 1
Flash: flashStructGet manu 0xec id 0xe0
Flash: flashStructGet flash is supported.
FLASH: initFlashSecs TOP Sector Type
Flash: flashSecsInit main sector loop 0 - 127
[8192kB@ff800000] Flash:  8 MB
Addresses 20M - 0M are saved for the U-Boot usage.
Mem malloc Initialization (20M - 16M): Done
*** Warning - bad CRC, using default environment


Soc: MV88F5181 Rev 9
CPU: ARM926 (Rev 0) running @ 500Mhz
SysClock = 166Mhz , TClock = 166Mhz


USB 0: host mode
PCI 0: PCI Express Root Complex Interface
PCI 1: Conventional PCI, speed = 33000000
Net:   mvEgigaLoad: egiga0 load ok
egiga0 [PRIME]

***************DRIVER INFO*****************

DRIVER BUILD DATA: Jan  9 2007 at 18:25:44
DRIVER VERSION 1.06

*******************************************
dbSign is:65:52:63:4f:6d:4d
mac address in flash is:00:1a:70:9c:51:18
have eRcOmM
Firmware is damaged,enter download mode
mvEgigaLoad: egiga0 load ok
egiga0 [PRIME]

mvEgigaInit: egiga0 init - mvBoardPhyAddrGet()=0x0 , priv-&gt;port =0x0
ring full
mvEgigaInit: egiga0 complete ok
In download function
 mac address:00:1a:70:9c:51:18
Pin:33.32.38.32.39.34.30.32</code></pre></div><p>I have no access to U-Boot command line (normally after pressing enter) so I cannot reflash my router. <br />Does message &quot; Firmware is damaged,enter download mode&quot; means that my router automatically tries to download firmware from tftp ? I have tried to set up tftp server with address 172.21.5.30 with uImage file but router doesn&#039;t even send one ip packet to me (tried with all router interfaces) I have also tried uploading file to router using tftp client on my pc to different default ip&#039;s found on the net, but without success.&nbsp; (no working address found by ARP)</p><p>I have never flashed anything below 0x400000 so my u-boot should be ok ?</p><p>Please help <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Regards</p>											<p class="post-edited">(Last edited by <strong>motopompa</strong> on 4 Jun 2009, 23:53)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p89744">
				<div class="post-metadata">
					<div class="post-num">Post #340</div>
					<div class="post-author">maddes.b</div>
					<div class="post-datetime">
						11 Jun 2009, 23:34					</div>
				</div>
				<div class="post-content content">
					<p>There&#039;s another way to create images for flashing a kernel to a different kernel mtd definition by just using standard linux commands.<br />So, from my point of view I would not &quot;complicate&quot; the usage of the wrt350nv2-webbuilder for this.</p><p>Note that all sizes for dd have to be stated in decimal values, this is automatically done by the builtin bash command &#039;declare&#039; and its option -i.<br />The latest version of the my script &quot;create_images_orion.sh&quot; is always available at <a href="http://ftp.maddes.net/openwrt/">http://ftp.maddes.net/openwrt/</a>.</p><p>Either create a build yourself or download it from the OpenWrt snapshots as mentioned here:<br /></p><div class="codebox"><pre><code>BOARD=&#039;orion&#039;
BUILDTYPE=&#039;snapshot&#039;
FSTYPE=&#039;squashfs&#039;

mkdir bin || rm bin/*
cd bin

# get latest uImage for router and pad it
wget http://downloads.openwrt.org/snapshots/trunk/orion/openwrt-wrt350nv2-uImage
dd if=openwrt-wrt350nv2-uImage of=openwrt-wrt350nv2-uImage.${BUILDTYPE}.${FSTYPE}.padded bs=1024k conv=sync

# get latest openwrt-orion-squashfs.img
wget http://downloads.openwrt.org/snapshots/trunk/orion/openwrt-orion-${FSTYPE}.img

# extract general uImage (padded to 1024k) from openwrt-orion-squashfs.img
#dd if=openwrt-orion-${FSTYPE}.img of=uImage.padded bs=1024k count=1

# extract root.squashfs (padded to 128k) from openwrt-orion-squashfs.img
dd if=openwrt-orion-${FSTYPE}.img of=root.${FSTYPE}.${BOARD}.${BUILDTYPE} bs=128k skip=8

# create combined flash image (uImage + padding + rootfs)
cat openwrt-wrt350nv2-uImage.${BUILDTYPE}.${FSTYPE}.padded root.${FSTYPE}.${BOARD}.${BUILDTYPE} &gt;openwrt-wrt350nv2-${FSTYPE}.${BUILDTYPE}.img

cd ..

# create further images if wanted
~/create_images_orion.sh &quot;${BUILDTYPE}&quot; &quot;${FSTYPE}&quot;</code></pre></div><p>~/create_images_orion.sh (to copy configs and create images directly after a build, also works with above mentioned downloads)<br /></p><div class="codebox"><pre><code>#!/bin/bash

#
# Intended Usage:
#
# BOARD=&#039;orion&#039;
#
# BUILDTYPE=&#039;tun&#039;
# - or -
# BUILDTYPE=&#039;all&#039;
#
# FSTYPE=&#039;squashfs&#039;
# - or -
# FSTYPE=&#039;ramdisk&#039;
#
# mkdir bin || rm bin/*
# LOGFILE=&quot;bin/compilelog.${BOARD}.${BUILDTYPE}.${FSTYPE}.`svnversion`.`date +%Y%m%d_%H%M%S`.log&quot;
# script -f -c &#039;make V=99 IGNORE_ERRORS=m&#039; &quot;${LOGFILE}&quot; ; bzip2 &quot;${LOGFILE}&quot; ; ~/create_images_orion.sh &quot;${BUILDTYPE}&quot; &quot;${FSTYPE}&quot; ; echo -e &#039;\a&#039;
#
# ToDo:
# - check sizes of existing files, if mismatch then error message so user can react on it
# - check md5sum of existing files, if mismatch then error message so user can react on it
#

# check parameters
rc=0
#
if [ -z &quot;$1&quot; ]
 then
  echo &#039;build type not stated (e.g. tun or all)&#039;
  rc=1
fi
#
if [ -z &quot;$2&quot; ]
 then
  echo &#039;filesystem type not stated (squashfs or ramdisk)&#039;
  rc=1
fi
#
[ &quot;${rc}&quot; -ne 0 ] &amp;&amp; exit &quot;${rc}&quot;

# define mtd and erase sizes
KERNELMTDSIZE=&#039;0x00100000&#039;
declare -i ROOTFSMTDSIZE=0x00750000-&quot;${KERNELMTDSIZE}&quot;

# define kernel file names
KERNELORG=&#039;openwrt-wrt350nv2-uImage&#039;
KERNEL=&quot;${KERNELORG}.$1.$2&quot;
KERNELPAD=&quot;${KERNEL}.padded&quot;

# define rootfs file names
FSIMGORG=&#039;openwrt-orion-squashfs.img&#039;
FSIMG=&quot;openwrt-orion-squashfs.$1.img&quot;
#
ROOTFSORG=&#039;root.squashfs&#039;
ROOTFS=&quot;${ROOTFSORG}.orion.$1&quot;
ROOTFSPAD=&quot;${ROOTFS}.padded&quot;

# define kernel+rootfs merge file names
MERGE=&quot;${KERNELPAD}+${ROOTFSORG}&quot;
MERGEPAD=&quot;${MERGE}.padded&quot;

# define misc file names
MD5SUMS=&quot;md5sums.orion.$1.$2&quot;
SPLITFILE=&quot;${MERGEPAD}&quot;

# define integer variables for dd
declare -i SIZE1
declare -i SIZE2

# switch to bin folder
cd bin ; rc=$?
[ &quot;${rc}&quot; -ne 0 ] &amp;&amp; exit &quot;${rc}&quot;

# create md5sums file
[ ! -f &quot;${MD5SUMS}&quot; ] &amp;&amp; touch &quot;${MD5SUMS}&quot;

# copy general config
CONFIG=&quot;config.orion.$1.$2&quot;
[ ! -f &quot;${CONFIG}&quot; ] &amp;&amp; cp ../.config &quot;${CONFIG}&quot;
grep -e &quot;${CONFIG}&quot; &quot;${MD5SUMS}&quot; &gt;/dev/null || md5sum --text &quot;${CONFIG}&quot; &gt;&gt;&quot;${MD5SUMS}&quot;

# copy kernel config
CONFIG=&quot;kconfig-orion.$1.$2&quot;
[ ! -f &quot;${CONFIG}&quot; ] &amp;&amp; cp ../tmp/.kconfig-orion &quot;${CONFIG}&quot;
grep -e &quot;${CONFIG}&quot; &quot;${MD5SUMS}&quot; &gt;/dev/null || md5sum --text &quot;${CONFIG}&quot; &gt;&gt;&quot;${MD5SUMS}&quot;

# checksum compilelog
grep -e &quot;compilelog.orion.$1.$2.*.*.log.bz2&quot; &quot;${MD5SUMS}&quot; &gt;/dev/null || md5sum --binary compilelog.orion.$1.$2.*.*.log.bz2 &gt;&gt;&quot;${MD5SUMS}&quot;

# rename kernel image
[ ! -f &quot;${KERNEL}&quot; ] &amp;&amp; mv &quot;${KERNELORG}&quot; &quot;${KERNEL}&quot;
grep -e &quot;${KERNEL}&quot; &quot;${MD5SUMS}&quot; &gt;/dev/null || md5sum --binary &quot;${KERNEL}&quot; &gt;&gt;&quot;${MD5SUMS}&quot;

## --- squashfs build only  begin ---
if [ &quot;$2&quot; == &quot;squashfs&quot; ]
 then
  # rename squashfs image
  [ ! -f &quot;${FSIMG}&quot; ] &amp;&amp; mv &quot;${FSIMGORG}&quot; &quot;${FSIMG}&quot;
  grep -e &quot;${FSIMG}&quot; &quot;${MD5SUMS}&quot; &gt;/dev/null || md5sum --binary &quot;${FSIMG}&quot; &gt;&gt;&quot;${MD5SUMS}&quot;

  # get latest rootfs
  [ ! -f &quot;${ROOTFS}&quot; ] &amp;&amp; dd if=&quot;../build_dir/linux-orion_generic/${ROOTFSORG}&quot; of=&quot;${ROOTFS}&quot; bs=128k conv=sync
  grep -e &quot;${ROOTFS}&quot; &quot;${MD5SUMS}&quot; &gt;/dev/null || md5sum --binary &quot;${ROOTFS}&quot; &gt;&gt;&quot;${MD5SUMS}&quot;

  # create a padded kernel image
  SIZE1=&quot;${KERNELMTDSIZE}&quot;
  [ ! -f &quot;${KERNELPAD}&quot; ] &amp;&amp; {
    echo &quot;Creating ${KERNELPAD}...&quot;
    dd if=&quot;${KERNEL}&quot; of=&quot;${KERNELPAD}&quot; bs=&quot;${SIZE1}&quot; conv=sync
  }
  SIZE2=`stat -c %s &quot;${KERNELPAD}&quot;`
  [ &quot;${SIZE2}&quot; -ne &quot;${SIZE1}&quot; ] &amp;&amp; { echo &quot;STOP!!! Kernel too big!!!&quot;; exit 1 ; }
  grep -e &quot;${KERNELPAD}&quot; &quot;${MD5SUMS}&quot; &gt;/dev/null || md5sum --binary &quot;${KERNELPAD}&quot; &gt;&gt;&quot;${MD5SUMS}&quot;

  # create a concatenated image (for split and flashing in U-Boot)
  [ ! -f &quot;${MERGE}&quot; ] &amp;&amp; cat &quot;${KERNELPAD}&quot; &quot;${ROOTFS}&quot; &gt;&quot;${MERGE}&quot;
  grep -e &quot;${MERGE}&quot; &quot;${MD5SUMS}&quot; &gt;/dev/null || md5sum --binary &quot;${MERGE}&quot; &gt;&gt;&quot;${MD5SUMS}&quot;

  # create a padded rootfs image
  SIZE1=&quot;${ROOTFSMTDSIZE}&quot;
  [ ! -f &quot;${ROOTFSPAD}&quot; ] &amp;&amp; {
    echo &quot;Creating ${ROOTFSPAD}...&quot;
    dd if=&quot;${ROOTFS}&quot; of=&quot;${ROOTFSPAD}&quot; bs=&quot;${SIZE1}&quot; conv=sync
  }
  SIZE2=`stat -c %s &quot;${ROOTFSPAD}&quot;`
  [ &quot;${SIZE2}&quot; -ne &quot;${SIZE1}&quot; ] &amp;&amp; { echo &quot;STOP!!! rootfs too big!!!&quot;; exit 1 ; }
  grep -e &quot;${ROOTFSPAD}&quot; &quot;${MD5SUMS}&quot; &gt;/dev/null || md5sum --binary &quot;${ROOTFSPAD}&quot; &gt;&gt;&quot;${MD5SUMS}&quot;

  # create a concatenated padded image
  [ ! -f &quot;${MERGEPAD}&quot; ] &amp;&amp; cat &quot;${KERNELPAD}&quot; &quot;${ROOTFSPAD}&quot; &gt;&quot;${MERGEPAD}&quot;
  grep -e &quot;${MERGEPAD}&quot; &quot;${MD5SUMS}&quot; &gt;/dev/null || md5sum --binary &quot;${MERGEPAD}&quot; &gt;&gt;&quot;${MD5SUMS}&quot;

  ### split for flashing in Linux with different mtd sizes
  echo &quot;Splitting &#039;${SPLITFILE}&#039; with kernel mtd size of ${KERNELMTDSIZE} in...&quot;
  for OTHERSIZE in &#039;0x00100000&#039; &#039;0x00120000&#039; &#039;0x001A0000&#039;
   do
    [ &quot;${OTHERSIZE}&quot; == &quot;${KERNELMTDSIZE}&quot; ] &amp;&amp; continue
    #
    SIZE1=&quot;${OTHERSIZE}&quot;
    #
    IMGFILE=&quot;img.wrt350nv2.$1.$2.${OTHERSIZE}.mtd0&quot;
    [ ! -f &quot;${IMGFILE}&quot; ] &amp;&amp; {
      echo &quot;...mtd0 for kernel mtd size ${OTHERSIZE}&quot;
      dd if=&quot;${SPLITFILE}&quot; of=&quot;${IMGFILE}&quot; bs=&quot;${SIZE1}&quot; count=1
    }
    grep -e &quot;${IMGFILE}&quot; &quot;${MD5SUMS}&quot; &gt;/dev/null || md5sum --binary &quot;${IMGFILE}&quot; &gt;&gt;&quot;${MD5SUMS}&quot;
    #
    IMGFILE=&quot;img.wrt350nv2.$1.$2.${OTHERSIZE}.mtd1&quot;
    [ ! -f &quot;${IMGFILE}&quot; ] &amp;&amp; {
      echo &quot;...mtd1 for kernel mtd size ${OTHERSIZE}&quot;
      dd if=&quot;${SPLITFILE}&quot; of=&quot;${IMGFILE}&quot; bs=&quot;${SIZE1}&quot; skip=1
    }
    grep -e &quot;${IMGFILE}&quot; &quot;${MD5SUMS}&quot; &gt;/dev/null || md5sum --binary &quot;${IMGFILE}&quot; &gt;&gt;&quot;${MD5SUMS}&quot;
  done
fi
# --- squashfs build only  end ---

# go back up
cd ..</code></pre></div><p>Flashing in U-Boot:<br /></p><div class="codebox"><pre><code># temporary change network settings to fit your network
setenv ipaddr 10.0.0.99
setenv serverip 10.0.0.1

# erase and unprotect flash for writing
erase 0xff800000 0xfff4ffff
protect off 0xff800000 0xfff4ffff

# flash kernel + rootfs
tftpboot 0x400000 &quot;openwrt-wrt350nv2-uImage.snapshot.squashfs.padded+root.squashfs&quot;
# recognize the download size in its output, it will be used in the next command
cp.b 0x400000 0xff800000 &lt;transferred bytes in hex/0x&gt;

reset</code></pre></div><p>Flashing in Linux:<br />Copy files via SFTP to /tmp or get them with wget over http or ftp.<br />To copy a new kernel and rootfs to the router via SCP/SFTP checkout this <a href="http://oldwiki.openwrt.org/SFTPWithDropbearHowTo.html">wiki page</a></p><p>Flashing with same kernel mtd size:<br /></p><div class="codebox"><pre><code># check mtd sizes
cat /proc/mtd
ls -la /dev/mtdblock*

dd if=/tmp/openwrt-wrt350nv2-uImage.snapshot.squashfs.padded of=/dev/mtdblock0 ; echo -e &#039;\a&#039;   #ring the bell when done
sync ; dd if=/tmp/root.squashfs of=/dev/mtdblock1 ; rc=$? ; \
 [ ${rc} -eq 0 ] &amp;&amp; reboot ; echo -e &#039;\a&#039;   # reboot immediately so the new rootfs is not destroyed by any action (and force you to use U-Boot to reflash)</code></pre></div><p>Flashing with different kernel mtd sizes (here 0x00120000):<br /></p><div class="codebox"><pre><code># check mtd sizes
cat /proc/mtd
ls -la /dev/mtdblock*

sync ; dd if=/tmp/img.wrt350nv2.snapshot.squashfs.0x00120000.mtd0 of=/dev/mtdblock0 ; rc=$? ; \
 [ ${rc} -eq 0 ] &amp;&amp; { dd if=/tmp/img.wrt350nv2.snapshot.squashfs.0x00120000.mtd1 of=/dev/mtdblock1 ; rc=$? ; } ; \
 [ ${rc} -eq 0 ] &amp;&amp; reboot ; echo -e &#039;\a&#039;   # reboot immediately so the new rootfs is not destroyed by any action (and force you to use U-Boot to reflash)</code></pre></div><p>Flashing on stock firmware:<br /></p><div class="codebox"><pre><code># check mtd sizes
cat /proc/mtd
ls -la /dev/mtdblock*

sync ; dd if=/tmp/openwrt-wrt350nv2-uImage.padded+root.squashfs.padded of=/dev/mtdblock0 ; rc=$? ; \
 [ ${rc} -eq 0 ] &amp;&amp; reboot ; echo -e &#039;\a&#039;   # reboot immediately so the new rootfs is not destroyed by any action (and force you to use U-Boot to reflash)</code></pre></div><p><span class="bbu">Update:</span><br />Even faster (less dd action) and simpler way by calculating the correct pad size via bash&#039;s &#039;declare&#039; and standard stat command.</p><p><span class="bbu">Update 2:</span><br />Flashing information</p><p><span class="bbu">Update 3:</span><br />Updated to padded images to reduce risk of destroyed rootfs.<br />Splitting for different mtd sizes is now done in a second.</p><p><span class="bbu">Update 4:</span><br />Added sync command to reduce risk of destroyed rootfs mtd partition.</p><p><span class="bbu">Update 5:</span><br />With sync and immediate reboot I never had any flashing issues again.<br />Outcommented all lines with padded rootfs.<br />Updated flashing commands to check for errors and not rebooting if anything failed.</p><p><span class="bbu">Update 6:</span><br />Had another flashing despite using sync and immediate reboot.<br />Difference was that the kernel mtd size was downsized from 0x00120000 to 0x00100000.<br />Further tests showed that upsizing works with unpadded images, but downsizing needs padded images.<br />Hence reverted back to padded images for different mtd sizes.</p><p><span class="bbu">Update 7:</span><br />New script, works with own compiled builds and snapshot downloads.</p>											<p class="post-edited">(Last edited by <strong>maddes.b</strong> on 3 Apr 2010, 18:59)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p89765">
				<div class="post-metadata">
					<div class="post-num">Post #341</div>
					<div class="post-author">maddes.b</div>
					<div class="post-datetime">
						12 Jun 2009, 06:07					</div>
				</div>
				<div class="post-content content">
					<p>I updated my package repository to trunk revision <a href="https://dev.openwrt.org/changeset/16424">16424</a> (12h compile time), as the OpenWrt snapshot package repository still lacks some packages (e.g. <a href="https://dev.openwrt.org/ticket/5253">ticket #5253</a>).</p><p>To use edit /etc/opkg.conf to add a new line which points to my package repository:<br /></p><div class="codebox"><pre><code>src/gz Maddes ftp://ftp.maddes.net/openwrt/kamikaze/orion/packages</code></pre></div><p>Kernel builds, root.squashfs and info can be found at <a href="ftp://ftp.maddes.net/openwrt/trunk/orion">ftp://ftp.maddes.net/openwrt/trunk/orion</a> and <a href="http://ftp.maddes.net/openwrt/">http://ftp.maddes.net/openwrt/</a></p>											<p class="post-edited">(Last edited by <strong>maddes.b</strong> on 7 Apr 2010, 21:29)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p89989">
				<div class="post-metadata">
					<div class="post-num">Post #342</div>
					<div class="post-author">Pawellos</div>
					<div class="post-datetime">
						16 Jun 2009, 19:15					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>motopompa wrote:</cite><blockquote><p>Hello</p><p>Today I have bricked my WRT-350n v2 <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" />. Since I haven&#039;t googled out way to unbrick it, I&#039;m writing this post.</p><p>Bricking it was very simple - I have uploaded root.squashfs insted of uImage. Now power led blinks amber and green and on console i have:</p><div class="codebox"><pre><code>        |  \/  | __ _ _ ____   _____| | |
        | |\/| |/ _` | &#039;__\ \ / / _ \ | |
        | |  | | (_| | |   \ V /  __/ | |
        |_|  |_|\__,_|_|    \_/ \___|_|_|
 _   _     ____              _
| | | |   | __ )  ___   ___ | |_
| | | |___|  _ \ / _ \ / _ \| __|
| |_| |___| |_) | (_) | (_) | |_
 \___/    |____/ \___/ \___/ \__|  ** LOADER **
 ** MARVELL BOARD: RD-88F5181L-VOIP-GE LE

U-Boot 1.1.1 (Dec 12 2006 - 16:12:22) Marvell version: 1.7.3

DRAM CS[0] base 0x00000000   size  32MB
DRAM Total size  32MB
Flash: mvFlashInit base 0xff800000 devW 1 busW 1
Flash: flashStructGet manu 0xec id 0xe0
Flash: flashStructGet flash is supported.
FLASH: initFlashSecs TOP Sector Type
Flash: flashSecsInit main sector loop 0 - 127
[8192kB@ff800000] Flash:  8 MB
Addresses 20M - 0M are saved for the U-Boot usage.
Mem malloc Initialization (20M - 16M): Done
*** Warning - bad CRC, using default environment


Soc: MV88F5181 Rev 9
CPU: ARM926 (Rev 0) running @ 500Mhz
SysClock = 166Mhz , TClock = 166Mhz


USB 0: host mode
PCI 0: PCI Express Root Complex Interface
PCI 1: Conventional PCI, speed = 33000000
Net:   mvEgigaLoad: egiga0 load ok
egiga0 [PRIME]

***************DRIVER INFO*****************

DRIVER BUILD DATA: Jan  9 2007 at 18:25:44
DRIVER VERSION 1.06

*******************************************
dbSign is:65:52:63:4f:6d:4d
mac address in flash is:00:1a:70:9c:51:18
have eRcOmM
Firmware is damaged,enter download mode
mvEgigaLoad: egiga0 load ok
egiga0 [PRIME]

mvEgigaInit: egiga0 init - mvBoardPhyAddrGet()=0x0 , priv-&gt;port =0x0
ring full
mvEgigaInit: egiga0 complete ok
In download function
 mac address:00:1a:70:9c:51:18
Pin:33.32.38.32.39.34.30.32</code></pre></div><p>I have no access to U-Boot command line (normally after pressing enter) so I cannot reflash my router. <br />Does message &quot; Firmware is damaged,enter download mode&quot; means that my router automatically tries to download firmware from tftp ? I have tried to set up tftp server with address 172.21.5.30 with uImage file but router doesn&#039;t even send one ip packet to me (tried with all router interfaces) I have also tried uploading file to router using tftp client on my pc to different default ip&#039;s found on the net, but without success.&nbsp; (no working address found by ARP)</p><p>I have never flashed anything below 0x400000 so my u-boot should be ok ?</p><p>Please help <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Regards</p></blockquote></div><p>Me too.<br />I use sercomm-utility and firmware from this post <a href="http://forum.openwrt.org/viewtopic.php?pid=74729#p74729">http://forum.openwrt.org/viewtopic.php?pid=74729#p74729</a> and my linksys back to life <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p89990">
				<div class="post-metadata">
					<div class="post-num">Post #343</div>
					<div class="post-author">maddes.b</div>
					<div class="post-datetime">
						16 Jun 2009, 19:17					</div>
				</div>
				<div class="post-content content">
					<p>OpenVPN crashes on my WRT350Nv2.<br />Opened a <a href="http://forum.openwrt.org/viewtopic.php?id=20713">separate thread about it</a>.<br />Please have a look maybe you can confirm or report or your working configuration.</p><p><span class="bbu">Update:</span><br />Workaround found, read the above mentioned thread.</p>											<p class="post-edited">(Last edited by <strong>maddes.b</strong> on 3 Jul 2009, 00:45)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p89993">
				<div class="post-metadata">
					<div class="post-num">Post #344</div>
					<div class="post-author">Pawellos</div>
					<div class="post-datetime">
						16 Jun 2009, 19:21					</div>
				</div>
				<div class="post-content content">
					<p>I try your version yesterday, and i can make USB and wifi N work...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p89995">
				<div class="post-metadata">
					<div class="post-num">Post #345</div>
					<div class="post-author">StrikerNL</div>
					<div class="post-datetime">
						16 Jun 2009, 19:30					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>maddes.b wrote:</cite><blockquote><p>OpenVPN crashes on my WRT350Nv2.<br />Opened a <a href="http://forum.openwrt.org/viewtopic.php?id=20713">separate thread about it</a>.<br />Please have a look maybe you can confirm or report or your working configuration.</p></blockquote></div><p>My OpenVPN crashes as well, but I&#039;ve not gotten any stacktraces. Where do I get these?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p90001">
				<div class="post-metadata">
					<div class="post-num">Post #346</div>
					<div class="post-author">maddes.b</div>
					<div class="post-datetime">
						16 Jun 2009, 21:10					</div>
				</div>
				<div class="post-content content">
					<p>You get the stack traces on the serial console.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p90009">
				<div class="post-metadata">
					<div class="post-num">Post #347</div>
					<div class="post-author">StrikerNL</div>
					<div class="post-datetime">
						16 Jun 2009, 21:45					</div>
				</div>
				<div class="post-content content">
					<p>Figures, I&#039;ve not got one here. Only DirkNL has one.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p90150">
				<div class="post-metadata">
					<div class="post-num">Post #348</div>
					<div class="post-author">LuHe</div>
					<div class="post-datetime">
						20 Jun 2009, 17:57					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>this sounds really great.<br />Is openwrt trunk usable on my WRT350N v2 for daily usage?<br />All 4 LAN ports are working, aren&#039;t they?<br />What about the speed of WLAN? Are there any performance issues compared to the original Linksys firmware?<br />Is the USB port working?<br />Are there any (supported) binary packages released / will this router be officially supported by openwrt / dd-wrt soon?<br />Is it possible to install a webinterface (x-wrt)?</p>											<p class="post-edited">(Last edited by <strong>LuHe</strong> on 20 Jun 2009, 19:10)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p90186">
				<div class="post-metadata">
					<div class="post-num">Post #349</div>
					<div class="post-author">maddes.b</div>
					<div class="post-datetime">
						21 Jun 2009, 14:40					</div>
				</div>
				<div class="post-content content">
					<p>@LuHe:<br />Depends on what you need for daily usage. For me OpenVPN is important and that currently crashes with the current trunk.</p><p>All 4 LAN ports are working fine. Haven&#039;t done any speed tests yet.<br />But if you read all pages of this thread you&#039;ll find some information about it.</p><p>WLAN not really used yet, it worked and I could access the internet.<br />Can not comment on long-time stability and speed.</p><p>USB not tested yet (USB support is excellenty according to mrk&#039;s following post).</p><p>Packages are available from my site, see page #13 and #14, which also include X-Wrt and Luci.</p><p>Last but not least, the WRT350Nv2 is not officially supported and it is recommend to have serial access to the WRT350N v2 before testing (already explained in this thread).</p>											<p class="post-edited">(Last edited by <strong>maddes.b</strong> on 22 Jun 2009, 20:03)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p90229">
				<div class="post-metadata">
					<div class="post-num">Post #350</div>
					<div class="post-author">mrk</div>
					<div class="post-datetime">
						22 Jun 2009, 18:33					</div>
				</div>
				<div class="post-content content">
					<p>USB support is excellent.</p><p>You only have to install the various packages (kmod-usb-ohci, -uhci, -usb2, -printer, -storage)<br />USB-hub is working.<br />USB-storage works with menory-sticks and harddisks.<br />USB-printer is funny as well</p>											<p class="post-edited">(Last edited by <strong>mrk</strong> on 6 Jul 2009, 17:57)</p>
									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 14 of 46</div><nav><ul><li><a href="viewtopic.php%3Fid=12358&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=12358&amp;p=12.html">12</a></li><li><a href="viewtopic.php%3Fid=12358&amp;p=13.html">13</a></li><li class="pagination-current"><span>14</span></li><li><a href="viewtopic.php%3Fid=12358&amp;p=15.html">15</a></li><li><a href="viewtopic.php%3Fid=12358&amp;p=16.html">16</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=12358&amp;p=46.html">46</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0.001 -->

</body>
</html>