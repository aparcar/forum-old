<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Router reboots every time intensively used the swap file</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 18 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p343946">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">Mune</div>
					<div class="post-datetime">
						17 Nov 2016, 05:17					</div>
				</div>
				<div class="post-content content">
					<p>OpenWRT Chaos calmer 15.05.1, router tl-wr842n-v3.<br />Flash drive is OK, repeatedly tested without errors.<br />System log was forwarded to serial console. When is rebooted to the system log is not written anything.<br />Please tell me what could be the reason for such behavior.</p>											<p class="post-edited">(Last edited by <strong>Mune</strong> on 17 Nov 2016, 07:56)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p343962">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">dl12345</div>
					<div class="post-datetime">
						17 Nov 2016, 11:29					</div>
				</div>
				<div class="post-content content">
					<p>The system log is a circular ring buffer in RAM. It is not written to disk by default, so when you reboot the log messages are lost. If you want persistent logs, then put in a USB flash drive and log to the USB or send your logs to a remote syslog server using UDP</p><p><a href="https://wiki.openwrt.org/doc/howto/log.essentials">https://wiki.openwrt.org/doc/howto/log.essentials</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p343967">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">Mune</div>
					<div class="post-datetime">
						17 Nov 2016, 11:52					</div>
				</div>
				<div class="post-content content">
					<p>I forward log to serial console (com port)...<br />When i simulate kernel panic i can see all info there.<br />But in this case is not written anything...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p343971">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">bolvan</div>
					<div class="post-datetime">
						17 Nov 2016, 12:06					</div>
				</div>
				<div class="post-content content">
					<p>Does that happen when you constantly read flash drive ? For example with dd.<br />Or it occurs only when swap is involved.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p343985">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">Mune</div>
					<div class="post-datetime">
						17 Nov 2016, 14:06					</div>
				</div>
				<div class="post-content content">
					<p>for example use stress-1.0.4.tar.gz with [-m] test and swap enabled.<br />another test, for CPU, io or file writing not affect this reboots.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p344002">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">bolvan</div>
					<div class="post-datetime">
						17 Nov 2016, 16:53					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m trying to make clear what causes reboots. Heavy flash disk IO or only virtual memory swap operations</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p344013">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">Mune</div>
					<div class="post-datetime">
						17 Nov 2016, 17:49					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>bolvan wrote:</cite><blockquote><p>I&#039;m trying to make clear what causes reboots. Heavy flash disk IO or only virtual memory swap operations</p></blockquote></div><p>Heavy virtual memory swap operations only.<br />Tested on flashdrive, usb-HDD and usb-SSD now. All rebooted.</p>											<p class="post-edited">(Last edited by <strong>Mune</strong> on 17 Nov 2016, 17:52)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p344083">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">tunk</div>
					<div class="post-datetime">
						18 Nov 2016, 15:25					</div>
				</div>
				<div class="post-content content">
					<p>Overheating?<br />Swap means heavy use of cpu and ram?<br />Could you open it and see if the SoC and ram is hot when crashing?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p344088">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">Mune</div>
					<div class="post-datetime">
						18 Nov 2016, 16:07					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>tunk wrote:</cite><blockquote><p>Overheating?<br />Swap means heavy use of cpu and ram?<br />Could you open it and see if the SoC and ram is hot when crashing?</p></blockquote></div><p>no.<br />tested with two cases:<br />closed paper to overheat the SOC ~ 70C<br />with fan on SOC into server room ~ 10C<br />In both cases, i see spontaneous reboot under intensive swapfile using.<br />CPU used on 20-60% in tests.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p344092">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">dl12345</div>
					<div class="post-datetime">
						18 Nov 2016, 17:33					</div>
				</div>
				<div class="post-content content">
					<p>Can you do a &quot;dmesg -w&quot; and pipe the output to a file on a persistent file system and then post the log after a spontaneous reboot? I realize that you don&#039;t get any kernel panic info in the log output, but maybe there is something else that could give a hint about the problem.</p>											<p class="post-edited">(Last edited by <strong>dl12345</strong> on 18 Nov 2016, 17:34)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p344103">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">Mune</div>
					<div class="post-datetime">
						18 Nov 2016, 19:35					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>dl12345 wrote:</cite><blockquote><p>Can you do a &quot;dmesg -w&quot; and pipe the output to a file on a persistent file system and then post the log after a spontaneous reboot? I realize that you don&#039;t get any kernel panic info in the log output, but maybe there is something else that could give a hint about the problem.</p></blockquote></div><p>good idea, but no.<br /></p><div class="codebox"><pre><code>Nov 19 00:15:31 192.168.1.2 sshd[1483]: Accepted publickey for root from 192.168.1.197 port 61749 ssh2: RSA SHA256:pTltcubKIo9hIgO4ZtSznOR596TGW1WAF5jZZbTRolg</code></pre></div><p>&gt;at this time I logon and start stresstest, AND system rebooted after starting stress.<br /></p><div class="codebox"><pre><code>Nov 19 00:17:25 192.168.1.2 kernel: [  158.090000] wlan0: deauthenticated from f0:79:59:d3:ba:a8 (Reason: 16=GROUP_KEY_HANDSHAKE_TIMEOUT)
Nov 19 00:17:47 192.168.1.2 netifd: Network device &#039;wlan0&#039; link is down
Nov 19 00:17:47 192.168.1.2 netifd: Interface &#039;wwan&#039; has link connectivity loss
Nov 19 00:09:02 192.168.1.2 logread[999]: Logread connected to 192.168.1.21:514
Nov 19 00:09:02 192.168.1.2 netifd: Bridge &#039;br-lan&#039; link is down
Nov 19 00:09:02 192.168.1.2 netifd: Interface &#039;lan&#039; has link connectivity loss
Nov 19 00:09:02 192.168.1.2 kernel: [   21.400000] br-lan: port 1(eth0) entered disabled state
Nov 19 00:09:03 192.168.1.2 kernel: [   22.090000] eth0: link up (1000Mbps/Full duplex)
Nov 19 00:09:03 192.168.1.2 kernel: [   22.090000] br-lan: port 1(eth0) entered forwarding state
Nov 19 00:09:03 192.168.1.2 kernel: [   22.100000] br-lan: port 1(eth0) entered forwarding state
Nov 19 00:09:03 192.168.1.2 netifd: Network device &#039;eth0&#039; link is up
Nov 19 00:09:03 192.168.1.2 netifd: Bridge &#039;br-lan&#039; link is up</code></pre></div><p>log after reboot on my remote syslog server not complete, but dmesg info is:<br /></p><div class="codebox"><pre><code>[    0.000000] Linux version 3.18.36 (boss@compiler) (gcc version 4.8.3 (OpenWrt/Linaro GCC 4.8-2014.04 r49389) ) #1 Tue Nov 15 13:47:06 +07 2016
[    0.000000] MyLoader: sysp=1d077ffa, boardp=e14ac615, parts=09838996
[    0.000000] bootconsole [early0] enabled
[    0.000000] CPU0 revision is: 00019374 (MIPS 24Kc)
[    0.000000] SoC: Qualcomm Atheros QCA9533 ver 2 rev 0
[    0.000000] Determined physical RAM map:
[    0.000000]  memory: 04000000 @ 00000000 (usable)
[    0.000000] Initrd not found or empty - disabling initrd
[    0.000000] Zone ranges:
[    0.000000]   Normal   [mem 0x00000000-0x03ffffff]
[    0.000000] Movable zone start for each node
[    0.000000] Early memory node ranges
[    0.000000]   node   0: [mem 0x00000000-0x03ffffff]
[    0.000000] Initmem setup node 0 [mem 0x00000000-0x03ffffff]
[    0.000000] On node 0 totalpages: 16384
[    0.000000] free_area_init_node: node 0, pgdat 803620f0, node_mem_map 81000000
[    0.000000]   Normal zone: 128 pages used for memmap
[    0.000000]   Normal zone: 0 pages reserved
[    0.000000]   Normal zone: 16384 pages, LIFO batch:3
[    0.000000] Primary instruction cache 64kB, VIPT, 4-way, linesize 32 bytes.
[    0.000000] Primary data cache 32kB, 4-way, VIPT, cache aliases, linesize 32 bytes
[    0.000000] pcpu-alloc: s0 r0 d32768 u32768 alloc=1*32768
[    0.000000] pcpu-alloc: [0] 0
[    0.000000] Built 1 zonelists in Zone order, mobility grouping on.  Total pages: 16256
[    0.000000] Kernel command line:  board=TL-WR842N-v3  console=ttyS0,115200 rootfstype=squashfs,jffs2 noinitrd
[    0.000000] PID hash table entries: 256 (order: -2, 1024 bytes)
[    0.000000] Dentry cache hash table entries: 8192 (order: 3, 32768 bytes)
[    0.000000] Inode-cache hash table entries: 4096 (order: 2, 16384 bytes)
[    0.000000] Writing ErrCtl register=00000000
[    0.000000] Readback ErrCtl register=00000000
[    0.000000] Memory: 60944K/65536K available (2510K kernel code, 130K rwdata, 532K rodata, 212K init, 188K bss, 4592K reserved)
[    0.000000] SLUB: HWalign=32, Order=0-3, MinObjects=0, CPUs=1, Nodes=1
[    0.000000] NR_IRQS:51
[    0.000000] Clocks: CPU:650.000MHz, DDR:393.139MHz, AHB:216.666MHz, Ref:25.000MHz
[    0.000000] Calibrating delay loop... 432.53 BogoMIPS (lpj=2162688)
[    0.060000] pid_max: default: 32768 minimum: 301
[    0.060000] Mount-cache hash table entries: 1024 (order: 0, 4096 bytes)
[    0.070000] Mountpoint-cache hash table entries: 1024 (order: 0, 4096 bytes)
[    0.080000] NET: Registered protocol family 16
[    0.080000] MIPS: machine is TP-LINK TL-WR842N/ND v3
[    0.540000] Switched to clocksource MIPS
[    0.540000] NET: Registered protocol family 2
[    0.550000] TCP established hash table entries: 1024 (order: 0, 4096 bytes)
[    0.550000] TCP bind hash table entries: 1024 (order: 0, 4096 bytes)
[    0.560000] TCP: Hash tables configured (established 1024 bind 1024)
[    0.570000] TCP: reno registered
[    0.570000] UDP hash table entries: 256 (order: 0, 4096 bytes)
[    0.580000] UDP-Lite hash table entries: 256 (order: 0, 4096 bytes)
[    0.580000] NET: Registered protocol family 1
[    0.590000] PCI: CLS 0 bytes, default 32
[    0.590000] futex hash table entries: 256 (order: -1, 3072 bytes)
[    0.620000] squashfs: version 4.0 (2009/01/31) Phillip Lougher
[    0.620000] jffs2: version 2.2 (NAND) (SUMMARY) (LZMA) (RTIME) (CMODE_PRIORITY) (c) 2001-2006 Red Hat, Inc.
[    0.640000] msgmni has been set to 119
[    0.640000] Block layer SCSI generic (bsg) driver version 0.4 loaded (major 254)
[    0.650000] io scheduler noop registered
[    0.650000] io scheduler deadline registered (default)
[    0.660000] Serial: 8250/16550 driver, 1 ports, IRQ sharing disabled
[    0.670000] console [ttyS0] disabled
[    0.690000] serial8250.0: ttyS0 at MMIO 0x18020000 (irq = 11, base_baud = 1562500) is a 16550A
[    0.700000] console [ttyS0] enabled
[    0.710000] bootconsole [early0] disabled
[    0.720000] m25p80 spi0.0: found gd25q128, expected m25p80
[    0.720000] m25p80 spi0.0: gd25q128 (16384 Kbytes)
[    0.730000] 5 tp-link partitions found on MTD device spi0.0
[    0.730000] Creating 5 MTD partitions on &quot;spi0.0&quot;:
[    0.740000] 0x000000000000-0x000000020000 : &quot;u-boot&quot;
[    0.750000] 0x000000020000-0x00000013845c : &quot;kernel&quot;
[    0.750000] 0x00000013845c-0x000000ff0000 : &quot;rootfs&quot;
[    0.760000] mtd: device 2 (rootfs) set to be root filesystem
[    0.760000] 1 squashfs-split partitions found on MTD device rootfs
[    0.770000] 0x000000ef0000-0x000000ff0000 : &quot;rootfs_data&quot;
[    0.780000] 0x000000ff0000-0x000001000000 : &quot;art&quot;
[    0.780000] 0x000000020000-0x000000ff0000 : &quot;firmware&quot;
[    0.820000] libphy: ag71xx_mdio: probed
[    1.410000] ag71xx-mdio.1: Found an AR934X built-in switch
[    1.450000] eth0: Atheros AG71xx at 0xba000000, irq 5, mode:GMII
[    2.050000] ag71xx ag71xx.0: connected to PHY at ag71xx-mdio.1:04 [uid=004dd042, driver=Generic PHY]
[    2.060000] eth1: Atheros AG71xx at 0xb9000000, irq 4, mode:MII
[    2.070000] TCP: cubic registered
[    2.070000] NET: Registered protocol family 17
[    2.070000] bridge: automatic filtering via arp/ip/ip6tables has been deprecated. Update your scripts to load br_netfilter if you need this.
[    2.090000] 8021q: 802.1Q VLAN Support v1.8
[    2.100000] VFS: Mounted root (squashfs filesystem) readonly on device 31:2.
[    2.110000] Freeing unused kernel memory: 212K (8037b000 - 803b0000)
[    2.900000] init: Console is alive
[    2.900000] init: - watchdog -
[    2.930000] random: kmodloader urandom read with 4 bits of entropy available
[    4.190000] usbcore: registered new interface driver usbfs
[    4.200000] usbcore: registered new interface driver hub
[    4.200000] usbcore: registered new device driver usb
[    4.310000] SCSI subsystem initialized
[    4.320000] ehci_hcd: USB 2.0 &#039;Enhanced&#039; Host Controller (EHCI) Driver
[    4.330000] ehci-platform: EHCI generic platform driver
[    4.330000] ehci-platform ehci-platform: EHCI Host Controller
[    4.340000] ehci-platform ehci-platform: new USB bus registered, assigned bus number 1
[    4.350000] ehci-platform ehci-platform: irq 3, io mem 0x1b000000
[    4.380000] ehci-platform ehci-platform: USB 2.0 started, EHCI 1.00
[    4.380000] hub 1-0:1.0: USB hub found
[    4.390000] hub 1-0:1.0: 1 port detected
[    4.390000] ohci_hcd: USB 1.1 &#039;Open&#039; Host Controller (OHCI) Driver
[    4.400000] ohci-platform: OHCI generic platform driver
[    4.410000] usbcore: registered new interface driver usb-storage
[    4.710000] usb 1-1: new high-speed USB device number 2 using ehci-platform
[    4.860000] usb-storage 1-1:1.0: USB Mass Storage device detected
[    4.870000] scsi host0: usb-storage 1-1:1.0
[    4.910000] init: - preinit -
[    5.870000] scsi 0:0:0:0: Direct-Access     Generic  USB Flash Disk   7.76 PQ: 0 ANSI: 2
[    5.880000] sd 0:0:0:0: [sda] 7843840 512-byte logical blocks: (4.01 GB/3.74 GiB)
[    5.890000] sd 0:0:0:0: [sda] Write Protect is off
[    5.890000] sd 0:0:0:0: [sda] Mode Sense: 03 00 00 00
[    5.890000] sd 0:0:0:0: [sda] No Caching mode page found
[    5.900000] sd 0:0:0:0: [sda] Assuming drive cache: write through
[    6.090000]  sda: sda1 sda2
[    6.100000] sd 0:0:0:0: [sda] Attached SCSI removable disk
[    8.690000] mount_root: loading kmods from internal overlay
[    9.320000] jffs2: notice: (391) jffs2_build_xattr_subsystem: complete building xattr subsystem, 0 of xdatum (0 unchecked, 0 orphan) and 0 of xref (0 dead, 0 orphan) found.
[    9.330000] block: attempting to load /tmp/jffs_cfg/upper/etc/config/fstab
[    9.460000] EXT4-fs (sda1): recovery complete
[    9.470000] EXT4-fs (sda1): mounted filesystem with ordered data mode. Opts:
[    9.490000] mount_root: switched to extroot
[    9.740000] procd: - early -
[    9.740000] procd: - watchdog -
[   10.070000] Adding 775164k swap on /dev/sda2.  Priority:-1 extents:1 across:775164k
[   10.420000] procd: - ubus -
[   11.440000] procd: - init -
[   13.580000] NET: Registered protocol family 10
[   13.600000] ip6_tables: (C) 2000-2006 Netfilter Core Team
[   13.620000] Loading modules backported from Linux version v4.4-rc5-1913-gc8fdf68
[   13.630000] Backport generated by backports.git backports-20151218-0-g2f58d9d
[   13.640000] ip_tables: (C) 2000-2006 Netfilter Core Team
[   13.660000] nf_conntrack version 0.5.0 (955 buckets, 3820 max)
[   13.700000] xt_time: kernel timezone is -0000
[   13.980000] ath: EEPROM regdomain: 0x0
[   13.980000] ath: EEPROM indicates default country code should be used
[   13.980000] ath: doing EEPROM country-&gt;regdmn map search
[   13.980000] ath: country maps to regdmn code: 0x3a
[   13.980000] ath: Country alpha2 being used: US
[   13.980000] ath: Regpair used: 0x3a
[   13.990000] ieee80211 phy0: Selected rate control algorithm &#039;minstrel_ht&#039;
[   14.000000] ieee80211 phy0: Atheros AR9531 Rev:2 mem=0xb8100000, irq=47
[   18.120000] random: nonblocking pool is initialized
[   20.240000] device eth0 entered promiscuous mode
[   20.240000] br-lan: port 1(eth0) entered forwarding state
[   20.250000] br-lan: port 1(eth0) entered forwarding state
[   20.360000] IPv6: ADDRCONF(NETDEV_UP): eth1: link is not ready
[   21.170000] br-lan: port 1(eth0) entered disabled state
[   22.060000] IPv6: ADDRCONF(NETDEV_UP): wlan0: link is not ready
[   22.310000] eth0: link up (1000Mbps/Full duplex)
[   22.320000] br-lan: port 1(eth0) entered forwarding state
[   22.330000] br-lan: port 1(eth0) entered forwarding state
[   23.580000] wlan0: authenticate with f0:79:59:d3:ba:a8
[   23.600000] wlan0: send auth to f0:79:59:d3:ba:a8 (try 1/3)
[   23.620000] wlan0: authenticated
[   23.630000] wlan0: associate with f0:79:59:d3:ba:a8 (try 1/3)
[   23.630000] br-lan: received packet on eth0 with own address as source address
[   23.640000] wlan0: RX AssocResp from f0:79:59:d3:ba:a8 (capab=0x1431 status=0 aid=1)
[   23.650000] wlan0: associated
[   23.650000] IPv6: ADDRCONF(NETDEV_CHANGE): wlan0: link becomes ready
[   23.830000] br-lan: received packet on eth0 with own address as source address
[   23.840000] br-lan: received packet on eth0 with own address as source address
[   24.330000] br-lan: port 1(eth0) entered forwarding state
[   24.400000] br-lan: received packet on eth0 with own address as source address
[   24.570000] br-lan: received packet on eth0 with own address as source address
[   25.320000] br-lan: received packet on eth0 with own address as source address
[   25.570000] br-lan: received packet on eth0 with own address as source address
[   26.210000] br-lan: received packet on eth0 with own address as source address</code></pre></div><p>so, i see info at only systemstart point, not earlier...</p><p>now try to recompile kernel with extended logging option...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p344107">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">Villeneuve</div>
					<div class="post-datetime">
						18 Nov 2016, 20:18					</div>
				</div>
				<div class="post-content content">
					<p>Power supply?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p344135">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">bolvan</div>
					<div class="post-datetime">
						19 Nov 2016, 12:05					</div>
				</div>
				<div class="post-content content">
					<p>Not likely in this case but I had spontaneous reboots on slow routers when they were fully loaded in kernel mode. Watchdog timer reset them.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p344149">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">Mune</div>
					<div class="post-datetime">
						19 Nov 2016, 17:58					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>bolvan wrote:</cite><blockquote><p>Not likely in this case but I had spontaneous reboots on slow routers when they were fully loaded in kernel mode. Watchdog timer reset them.</p></blockquote></div><p>this is kernelmode driver watchdog?<br />how to increase watchdog timeout?</p>											<p class="post-edited">(Last edited by <strong>Mune</strong> on 19 Nov 2016, 18:22)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p344153">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">bolvan</div>
					<div class="post-datetime">
						19 Nov 2016, 18:28					</div>
				</div>
				<div class="post-content content">
					<p>In past (AA) watchdog was serviced by user mode process.<br />If kernel is loaded 100% and kernel is nonpreemptive all user processes freeze and watchdog fires after timeout.<br />But it was in past. Modern implementations use kernel mode thread for calming the dog. May be it also do not receive any cpu time - I dont know.<br />Watchdog can be disabled during kernel compilation. Sometimes some module args can be passed or watchdog can be controlled by /dev/watchdog. Must study particular implementation</p>											<p class="post-edited">(Last edited by <strong>bolvan</strong> on 19 Nov 2016, 18:28)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p344166">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">Mune</div>
					<div class="post-datetime">
						19 Nov 2016, 20:50					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>bolvan wrote:</cite><blockquote><p>In past (AA) watchdog was serviced by user mode process.<br />If kernel is loaded 100% and kernel is nonpreemptive all user processes freeze and watchdog fires after timeout.<br />But it was in past. Modern implementations use kernel mode thread for calming the dog. May be it also do not receive any cpu time - I dont know.<br />Watchdog can be disabled during kernel compilation. Sometimes some module args can be passed or watchdog can be controlled by /dev/watchdog. Must study particular implementation</p></blockquote></div><p><strong>bolvan</strong> thank you very much for the correct clue.<br />edit /etc/rc.local:<br />ubus call system watchdog &#039;{ &quot;timeout&quot;: 170 }&#039;&nbsp; &nbsp;# change to 170s timeout - this is maximum</p><p>then no more reboots if freezes continues no more 3 min...<br />question closed.</p>											<p class="post-edited">(Last edited by <strong>Mune</strong> on 19 Nov 2016, 21:03)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p344173">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">bolvan</div>
					<div class="post-datetime">
						19 Nov 2016, 21:38					</div>
				</div>
				<div class="post-content content">
					<p>Thanks also for info about ubus.<br />I studied procd code and found that it has builtin code that server watchdog.<br />Strace revealed it sends &quot;X&quot; to /dev/watchdog every &quot;frequency&quot; seconds - 5 by default.<br />If I &quot;gdb -p 1&quot; then after &quot;timeout&quot; (default 25) seconds router reboots.<br />It also means that the same illness is applicable to modern openwrt versions.<br />When kernel gets overloaded by heavy traffic then router will likely reboot.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p344185">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">dl12345</div>
					<div class="post-datetime">
						20 Nov 2016, 00:08					</div>
				</div>
				<div class="post-content content">
					<p>Nice detective work Bolvan.....</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>