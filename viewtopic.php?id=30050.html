<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> UMTS or GSM/GPRS module</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 30 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p135391">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">gilby985</div>
					<div class="post-datetime">
						16 May 2011, 18:16					</div>
				</div>
				<div class="post-content content">
					<p>Hello you all... I&#039;m new with OpenWRT and I have to use it to program an embedded system... I have to use a GSM/GPRS or UMTS module to send and receive data through the phone net, do you know if there are some modules supported by OpenWRT or with binary drivers? Have you ever done something like this?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p135395">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">mazilo</div>
					<div class="post-datetime">
						16 May 2011, 19:20					</div>
				</div>
				<div class="post-content content">
					<p>You may want to read this <a href="http://wiki.openwrt.org/doc/recipes/3gdongle">Use 3g/UMTS USB Dongle for WAN connection</a>.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p140707">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">danielchagas</div>
					<div class="post-datetime">
						6 Aug 2011, 19:16					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m trying to make my unlocked Huawei UMG 1691 to work as a wan for testing, but I can&#039;t find the solution...<br />The hardware I&#039;m using is: <br />Router TP-Link MR3420 (AR7xxx), <br />USB powered hub<br />USB flash drive 4gb, for extroot<br />USB&nbsp; wireless adapter Tplink wn722n (Atheros AR9271) running as wan2 interface / wireless client<br />USB 3G Dongle&nbsp; Huawi UMG 1691, that I&#039;m trying to put as another wan (wan3).</p><p>Openwrt version =I have no idea. How to know???<br />This is what I found: <br />Via Luci: OpenWrt Attitude Adjustment (r27832)<br />Via SSH: ATTITUDE ADJUSTMENT (bleeding edge, r27797) <br />LuCI Trunk (v0.10+svn7335)</p><p>This is the kernel log:</p><p>option 1-1.4.2:1.0: GSM modem (1-port) converter detected<br />usb 1-1.4.2: GSM modem (1-port) converter now attached to ttyUSB0<br />option 1-1.4.2:1.3: GSM modem (1-port) converter detected<br />usb 1-1.4.2: GSM modem (1-port) converter now attached to ttyUSB1<br />option 1-1.4.2:1.4: GSM modem (1-port) converter detected<br />usb 1-1.4.2: GSM modem (1-port) converter now attached to ttyUSB2<br />scsi26 : usb-storage 1-1.4.2:1.5<br />scsi27 : usb-storage 1-1.4.2:1.6<br />scsi 26:0:0:0: CD-ROM&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; HUAWEI&nbsp; &nbsp;Mass Storage&nbsp; &nbsp; &nbsp;2.31 PQ: 0 ANSI: 2<br />scsi 27:0:0:0: Direct-Access&nbsp; &nbsp; &nbsp;HUAWEI&nbsp; &nbsp;SD Storage&nbsp; &nbsp; &nbsp; &nbsp;2.31 PQ: 0 ANSI: 2<br />sd 27:0:0:0: [sdb] Attached SCSI removable disk<br />option: option_instat_callback: error -71<br />option: option_instat_callback: error -71</p><p>The device is detected, but it doesnt switch to gsm-modem mode. I believe the USB_ModeSwitch isn&#039;t working or isn&#039;t running, but it&#039;s installed...<br />The command huaweiAktBbo returns an error:<br />&quot;Searching modem...No supported modem found&quot;</p><p>What do I need to do to make it work?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p140985">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">LinkZ</div>
					<div class="post-datetime">
						10 Aug 2011, 19:42					</div>
				</div>
				<div class="post-content content">
					<div class="codebox"><pre><code>option 1-1.4.2:1.0: GSM modem (1-port) converter detected
usb 1-1.4.2: GSM modem (1-port) converter now attached to ttyUSB0
option 1-1.4.2:1.3: GSM modem (1-port) converter detected
usb 1-1.4.2: GSM modem (1-port) converter now attached to ttyUSB1
option 1-1.4.2:1.4: GSM modem (1-port) converter detected
usb 1-1.4.2: GSM modem (1-port) converter now attached to ttyUSB2</code></pre></div><p>This means it did switch to GSM mode and the option driver detected the modem.&nbsp; You don&#039;t need to use huaweiAktBbo with USB Modeswitch.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p141021">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">danielchagas</div>
					<div class="post-datetime">
						11 Aug 2011, 04:08					</div>
				</div>
				<div class="post-content content">
					<p>Well... almost getting it... the device is in ttyUSB0</p><p>Command gcom results:<br />----------------<br />root@OpenWrt:~# gcom -d /dev/ttyUSB0<br />Trying list of devices<br />SIM ready<br />Waiting for Registration..(120 sec max)<br />Registered on Home network: &quot;72404&quot;,0<br />Signal Quality: 18,99</p><p>It means that the modem is recognized and it got attached to mobile telecom network...<br />but when I try to connect the interface, I got this results in system log:</p><p>Aug 10 21:59:19 OpenWrt local2.info chat[5633]: send (ATD*99#^M)<br />Aug 10 21:59:19 OpenWrt local2.info chat[5633]: expect (CONNECT)<br />Aug 10 21:59:19 OpenWrt local2.info chat[5633]: ^M<br />Aug 10 21:59:19 OpenWrt local2.info chat[5633]: ATD*99#^M^M<br />Aug 10 21:59:19 OpenWrt local2.info chat[5633]: NO CARRIER<br />Aug 10 21:59:19 OpenWrt local2.info chat[5633]:&nbsp; -- failed<br />Aug 10 21:59:19 OpenWrt local2.info chat[5633]: Failed (NO CARRIER)<br />Aug 10 21:59:19 OpenWrt daemon.err pppd[5611]: Connect script failed<br />--------------------------------------<br />*99# is the dial number used in Brazil, but anyway I even tried to change the number to *99***1#, but got the same result.</p><p>This is the chat script, I just changed the dial number:</p><p>ABORT&nbsp; &nbsp;BUSY<br />ABORT&nbsp; &nbsp;&#039;NO CARRIER&#039;<br />ABORT&nbsp; &nbsp;ERROR<br />REPORT&nbsp; CONNECT<br />TIMEOUT 10<br />&quot;&quot;&nbsp; &nbsp; &nbsp; &quot;AT&amp;F&quot;<br />OK&nbsp; &nbsp; &nbsp; &quot;ATE1&quot;<br />OK&nbsp; &nbsp; &nbsp; &#039;AT+CGDCONT=1,&quot;IP&quot;,&quot;$USE_APN&quot;&#039;<br />SAY&nbsp; &nbsp; &nbsp;&quot;Calling UMTS/GPRS&quot;<br />TIMEOUT 30<br />OK&nbsp; &nbsp; &nbsp; &quot;ATD*99#&quot;<br />CONNECT &#039; &#039;</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p141022">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">LinkZ</div>
					<div class="post-datetime">
						11 Aug 2011, 05:20					</div>
				</div>
				<div class="post-content content">
					<p>What&#039;s your /etc/config/network look like?&nbsp; Did you set an APN?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p141070">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">danielchagas</div>
					<div class="post-datetime">
						11 Aug 2011, 17:14					</div>
				</div>
				<div class="post-content content">
					<p>config &#039;interface&#039; &#039;3G0&#039;<br />&nbsp; &nbsp; option &#039;ifname&#039; &#039;3G0&#039;<br />&nbsp; &nbsp; option &#039;proto&#039; &#039;3g&#039;<br />&nbsp; &nbsp; option &#039;service&#039; &#039;umts&#039;<br />&nbsp; &nbsp; option &#039;apn&#039; &#039;tim.br&#039;<br />&nbsp; &nbsp; option &#039;username&#039; &#039;tim&#039;<br />&nbsp; &nbsp; option &#039;password&#039; &#039;tim&#039;<br />&nbsp; &nbsp; option &#039;maxwait&#039; &#039;0&#039;<br />&nbsp; &nbsp; option &#039;device&#039; &#039;/dev/ttyUSB0&#039;</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p141071">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">LinkZ</div>
					<div class="post-datetime">
						11 Aug 2011, 17:37					</div>
				</div>
				<div class="post-content content">
					<p>I think the &quot;NO CARRIER&quot; you are receiving indicates a failure to connect to the APN.&nbsp; I would try a different APN.&nbsp; Also, make sure you are using the network your SIM is registered for... unless you have an unlocked SIM.</p><p>Other things to try:<br />- Try a different tty (e.g. ttyUSB1 or ttyUSB2).<br />- Remove the &#039;max wait&#039; option.&nbsp; I don&#039;t think you want this set to 0.<br />- Remove the username/password.&nbsp; I don&#039;t know about your carrier, but I have never had to use these.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p141305">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">janptak</div>
					<div class="post-datetime">
						14 Aug 2011, 17:12					</div>
				</div>
				<div class="post-content content">
					<p>Ill post a short how to from eko.one.pl - I found it the most straightforward method to use 3G (IMHO that is...).<br />Basically, at first you need to check if You have required packages installed. Than You configure new lan interface and start it. <br />If Youll only use 3G modem to connect to internet issue following command in terminal window:</p><div class="codebox"><pre><code># opkg update
    # opkg install kmod-usb-core kmod-usb2 kmod-usb-serial kmod-usb-serial-option usb-modeswitch usb-modeswitch-data libusb
    # opkg install chat comgt
    # uci del network.wan
    # uci set network.wan=interface
    # uci set network.wan.proto=3g
    # uci set network.wan.service=umts
    # uci set network.wan.device=/dev/ttyUSB0
    # uci set network.wan.pincode=1234
    # uci set network.wan.apn=internet
    # uci set network.wan.username=&#039;&#039;
    # uci set network.wan.password=&#039;&#039;
    # uci commit network
    # ifup wan</code></pre></div><p>Your /etc/config/network should have :<br /></p><div class="codebox"><pre><code>config &#039;interface&#039; &#039;wan&#039;
        option &#039;device&#039; &#039;/dev/ttyUSB0&#039;
        option &#039;apn&#039; &#039;internet&#039;
        option &#039;service&#039; &#039;umts&#039;
        option &#039;proto&#039; &#039;3g&#039;
        option &#039;pincode&#039; &#039;1234&#039;
        option &#039;username&#039; &#039;&#039;
        option &#039;password&#039; &#039;&#039;</code></pre></div><p>Thats it. You should have working internet connection.</p><p>IF You already use WAN as internet connection and want to add additional interface&nbsp; Wan interface should be replaced with new interface name, like ie: HDSPA. </p><p>Remember: You need to use different interface name (change WAN to HDSPA) prior to put abovementioned commands or Youll remove existing WAN settings. </p><p>Now You need to put following command to firewall /etc/config/firewall:<br /></p><div class="codebox"><pre><code>config zone
        option name HSDPA
        option input REJECT
        option output ACCEPT 
        option forward REJECT
        option masq 1 

    config forwarding 
        option src lan
        option dest HSDPA</code></pre></div><p>Than run in terminal: </p><div class="codebox"><pre><code>ifup HDSPA</code></pre></div><p>After few seconds you should have message:</p><div class="codebox"><pre><code>SIM ready
    PIN set successfully</code></pre></div><p>This will work if Your modem has been recognized by openwrt and modemswitch change its mode from cd/memoty to modem. </p><p>If your router isnt connected anywhere Youll need to download all packages locally through another computer and put all required pacjages into the router through SSH and install them locally.<br />Cezary from eko.one.pl maintain newest images with preconfigured support for newest 3g modems. </p><p>Images are at: <a href="http://ecco.selfip.net/backfire/ar71xx">http://ecco.selfip.net/backfire/ar71xx</a><br />PAckets for those images are : <a href="http://ecco.selfip.net/backfire/ar71xx/packages/">http://ecco.selfip.net/backfire/ar71xx/packages/</a></p>											<p class="post-edited">(Last edited by <strong>janptak</strong> on 15 Aug 2011, 08:14)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p141375">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">janptak</div>
					<div class="post-datetime">
						15 Aug 2011, 08:19					</div>
				</div>
				<div class="post-content content">
					<p>One more thing : try switch modem with following command </p><div class="codebox"><pre><code>usb_modeswitch -I -c /etc/usb_modeswitch.d/12d1:1446</code></pre></div><p>Its taken from <a href="http://www.draisberghof.de/usb_modeswitch/bb/viewtopic.php?t=641">http://www.draisberghof.de/usb_modeswit … .php?t=641</a> and its tailored to your specific modem</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>