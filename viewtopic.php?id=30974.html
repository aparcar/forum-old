<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> jffs partition only 5MB.  Flash is 8MB</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 19 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p139605">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">4EST</div>
					<div class="post-datetime">
						21 Jul 2011, 21:43					</div>
				</div>
				<div class="post-content content">
					<p>I just installed backfire jffs RC5 on Dlink DIR-825</p><p>root@OpenWrt:~# df -h<br />Filesystem&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Size&nbsp; &nbsp; &nbsp; Used Available Use% Mounted on<br />/dev/root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5.1M&nbsp; &nbsp; &nbsp; 5.0M&nbsp; &nbsp; 104.0K&nbsp; 98% /<br />tmpfs&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 30.2M&nbsp; &nbsp; &nbsp; 1.5M&nbsp; &nbsp; &nbsp;28.7M&nbsp; &nbsp;5% /tmp<br />tmpfs&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;512.0K&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; 512.0K&nbsp; &nbsp;0% /dev</p><br /><p>where is the 8MB flash? root size is only 5.1MB......</p><p>later edit:</p><p>Now I installed squashfs:<br />root@OpenWrt:~# df -h<br />Filesystem&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Size&nbsp; &nbsp; &nbsp; Used Available Use% Mounted on<br />/dev/root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2.1M&nbsp; &nbsp; &nbsp; 2.1M&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 100% /rom<br />tmpfs&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 30.2M&nbsp; &nbsp; 132.0K&nbsp; &nbsp; &nbsp;30.1M&nbsp; &nbsp;0% /tmp<br />tmpfs&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;512.0K&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; 512.0K&nbsp; &nbsp;0% /dev<br />/dev/mtdblock4&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2.9M&nbsp; &nbsp; 280.0K&nbsp; &nbsp; &nbsp; 2.7M&nbsp; &nbsp;9% /overlay<br />mini_fo:/overlay&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2.1M&nbsp; &nbsp; &nbsp; 2.1M&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 100% /</p><br /><p>better, but stil only 2.1+2.1MB available? where is the rest up to 8MB????</p>											<p class="post-edited">(Last edited by <strong>4EST</strong> on 21 Jul 2011, 21:45)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p139619">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">LinkZ</div>
					<div class="post-datetime">
						22 Jul 2011, 00:32					</div>
				</div>
				<div class="post-content content">
					<p>You&#039;ll have a better understanding of how big everything is if you look at /proc/mtd.&nbsp; Don&#039;t forget the kernel, bootloader, etc.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p139622">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">scruffy</div>
					<div class="post-datetime">
						22 Jul 2011, 00:54					</div>
				</div>
				<div class="post-content content">
					<p>A good value! <a href="http://wiki.openwrt.org/doc/techref/flash.layout">http://wiki.openwrt.org/doc/techref/flash.layout</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p139655">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">4EST</div>
					<div class="post-datetime">
						22 Jul 2011, 09:13					</div>
				</div>
				<div class="post-content content">
					<p>good link, in my case /overlay has only 2.9 MB.&nbsp; /rom has 2.1MB. So that means the kernel+boot = 3MB...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p139656">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">LinkZ</div>
					<div class="post-datetime">
						22 Jul 2011, 09:16					</div>
				</div>
				<div class="post-content content">
					<p>The kernel is usually just under 1MB, and the bootoader is 192k + 64k for the config data and 64k for the factory data.</p><p>Please post your /proc/mtd.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p139657">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">4EST</div>
					<div class="post-datetime">
						22 Jul 2011, 09:17					</div>
				</div>
				<div class="post-content content">
					<p>ok, will post later</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p139704">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">4EST</div>
					<div class="post-datetime">
						22 Jul 2011, 20:19					</div>
				</div>
				<div class="post-content content">
					<p>root@OpenWrt:~# cat /proc/mtd<br />dev:&nbsp; &nbsp; size&nbsp; &nbsp;erasesize&nbsp; name<br />mtd0: 00040000 00010000 &quot;uboot&quot;<br />mtd1: 00010000 00010000 &quot;config&quot;<br />mtd2: 00100000 00010000 &quot;kernel&quot;<br />mtd3: 00510000 00010000 &quot;rootfs&quot;<br />mtd4: 002f0000 00010000 &quot;rootfs_data&quot;<br />mtd5: 00010000 00010000 &quot;caldata&quot;<br />mtd6: 00190000 00010000 &quot;unknown&quot;<br />mtd7: 00610000 00010000 &quot;firmware&quot;<br />root@OpenWrt:~#</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p139707">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">scruffy</div>
					<div class="post-datetime">
						22 Jul 2011, 20:46					</div>
				</div>
				<div class="post-content content">
					<p>Obviously &quot;Unknown&quot; steals you 1.638.400 Bytes! Make a dump of it and see if it contains any information or just FF / 00.</p><p>More precise than cat /proc/mtd is dmesg. It shows you start and end offset of each partition.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p139708">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">4EST</div>
					<div class="post-datetime">
						22 Jul 2011, 20:49					</div>
				</div>
				<div class="post-content content">
					<p>indeed, the informatio is present in dmesg:</p><p>Creating 7 MTD partitions on &quot;spi0.0&quot;:<br />0x000000000000-0x000000040000 : &quot;uboot&quot;<br />0x000000040000-0x000000050000 : &quot;config&quot;<br />0x000000050000-0x000000150000 : &quot;kernel&quot;<br />0x000000150000-0x000000660000 : &quot;rootfs&quot;<br />mtd: partition &quot;rootfs&quot; set to be root filesystem<br />mtd: partition &quot;rootfs_data&quot; created automatically, ofs=370000, len=2F0000<br />0x000000370000-0x000000660000 : &quot;rootfs_data&quot;<br />0x000000660000-0x000000670000 : &quot;caldata&quot;<br />0x000000670000-0x000000800000 : &quot;unknown&quot;<br />0x000000050000-0x000000660000 : &quot;firmware&quot;</p><br /><p>how do I dump it?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p139709">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">LinkZ</div>
					<div class="post-datetime">
						22 Jul 2011, 21:05					</div>
				</div>
				<div class="post-content content">
					<p>bootloader = 256 kb<br />bootloader config = 64 kb<br />kernel = 1024 kb (1 mb)<br />rootfs = 5184 kb ( ~5 mb)<br />caldata = 64 kb<br />unknown = 1600 kb (~1.5 mb)</p><p>total = 8192 kb (8 mb)</p><p>It looks like your missing space is in the &quot;unknown&quot; partition, which is not being utilized by the rootfs (or jffs2).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p139710">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">4EST</div>
					<div class="post-datetime">
						22 Jul 2011, 21:06					</div>
				</div>
				<div class="post-content content">
					<p>it does seem so, indeed.&nbsp; I wonder if anyone knows what&#039;s in there and why can&#039;t we use it...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p139711">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">LinkZ</div>
					<div class="post-datetime">
						22 Jul 2011, 21:08					</div>
				</div>
				<div class="post-content content">
					<p>Oops sorry, didn&#039;t see the previous post.&nbsp; You can dump the &quot;unknown&quot; partition with dd:</p><p>dd if=/dev/mtd6 of=/tmp/mtd6 bs=1kb</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p139712">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">LinkZ</div>
					<div class="post-datetime">
						22 Jul 2011, 21:11					</div>
				</div>
				<div class="post-content content">
					<p>Well, the problem may be that the caldata partition is fixed at 0x000000660000, so the rootfs can&#039;t be extended to the end of flash without overwriting it.&nbsp; The caldata partition probably contains &quot;factory&quot; data, such as MAC addresses, etc... just guessing here.</p><p>You could repartition everything, but the risk is the drivers won&#039;t be able to find caldata if you move it.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p139715">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">4EST</div>
					<div class="post-datetime">
						22 Jul 2011, 21:46					</div>
				</div>
				<div class="post-content content">
					<p>I dumped it<br />There is some FF, then some unknown data (~70% of total), then some more FF, then some readable text:<br />RedBoot<br />RedBoot config<br />FIS<br />directory<br />vmlinux<br />­filesystem</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p139717">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">scruffy</div>
					<div class="post-datetime">
						22 Jul 2011, 21:55					</div>
				</div>
				<div class="post-content content">
					<p>Oh, RedBoot....&nbsp; Here is another RedBoot-Router:&nbsp; <a href="http://wiki.openwrt.org/toh/d-link/dir-300">http://wiki.openwrt.org/toh/d-link/dir-300</a></p><p>Anyway, the fact that there is data on it, proofs that the space was used once.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p140559">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">vargalex</div>
					<div class="post-datetime">
						3 Aug 2011, 23:25					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>4EST wrote:</cite><blockquote><p>I dumped it<br />There is some FF, then some unknown data (~70% of total), then some more FF, then some readable text:<br />RedBoot<br />RedBoot config<br />FIS<br />directory<br />vmlinux<br />­filesystem</p></blockquote></div><p>Hi!</p><p>I think, &quot;unknown&quot; partition is the recovery mode kernel+http server.</p><p>vargalex</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p172684">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">jmorris</div>
					<div class="post-datetime">
						19 Jul 2012, 02:46					</div>
				</div>
				<div class="post-content content">
					<p>Been researching this one a bit and am now more confused than when I started.</p><p>The &#039;unknown&#039; partition only has a few readable strings.&nbsp; They are all reproduced below for reference.&nbsp; The theory that it is a rescue partition is weakened by the fact that there are a lot of strings in mtd0(u-boot) that imply it is capable of serving up a webpage with an option to accept a new image.</p><p>Even stranger, at no point in the u-boot partition on my device does the boot arguments that OpenWrt reports were passed to it appear.</p><p>Here is the only thing I can locate in u-boot:<br />bootargs=console=ttyS0,115200 root=31:03 mem=64M rootfstype=squashfs,jffs2 init=/sbin/init mtdparts=ar7100-nor0:256k(uboot),64k(Config),1024k(vmlinux),5184k(rootfs),64k(caldata)</p><p>Yet here is what dmesg shows with 10.03.1:<br />Kernel command line: rootfstype=squashfs,yaffs,jffs2 noinitrd console=ttyS0,115,200 board=DIR-825-B1 mtdparts=spi0.0:256k(uboot)ro,64k(config)ro,1024k(kernel),5184k(rootfs),64k(caldata)ro,1600k(unknown)ro,6208k@0x50000(firmware)</p><p>So where is the kernel getting that line from?</p><p>What exactly is happening from power on to kernel init?</p><p>Where does the caldata partition get read and does it use the name or that exact fixed location?</p><p>With openwrt installed, does anything still access mtd1-config?</p><p>Guess the next stop is the source for openwrt.&nbsp; It should have some of those answers, at least the caldata one.&nbsp; Assuming u-boot doesn&#039;t also read from there?</p><p>If I could figure out where the boot arguments come from, the location of caldata is movable and there really isn&#039;t anything useful in config or unknown at this point, I&#039;d like to try getting the serial console and repartitioning it to add 0x1a0000 extra space to the rootfs partition.</p><p>Strings in mtd6-unknown:<br />ath_pktlog.ko<br />ath_rate_atheros.ko<br />wlan.ko<br />RedBoot<br />RedBoot config<br />FIS directory<br />vmlinux<br />filesystem<br />boot_script<br />boot_script_data<br />boot_script<br />fis load -d vmlinux<br />exec<br />boot_script_timeout<br />boot_script<br />bootp<br />bootp_my_gateway_ip<br />bootp<br />bootp_my_ip<br />bootp<br />bootp_my_ip_mask<br />bootp<br />bootp_server_ip<br />console_baud_rate<br />gdb_port<br />info_console_force<br />info_console_number<br />info_console_force<br />net_debug</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>