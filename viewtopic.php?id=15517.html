<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> openvpn tcp-server - TLS handshake failed</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 16 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p67652">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">martinbalint</div>
					<div class="post-datetime">
						1 May 2008, 01:04					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>I am trying to get openvpn working on kamikaze 7.09 (rb532a). I need to connect as a roadwarrior to openvpn daemon listening on 443/tcp.<br />There seems to be a problem with key negotiation, but I am sure my config is OK, because it works on debian (on rb532a), or if I switch to UDP.</p><p>I googled out, that it may be openvpns EPOLL problem, but I wasn&#039;t able to compile openvpn with epoll disabled, to test it.</p><p>Did anybody resolved this already?</p><p>My server config:<br /></p><div class="codebox"><pre><code>port 443
proto tcp-server
dev tap0

verb 256

ca /etc/openvpn/keys/roadwarrior/ca.crt
cert /etc/openvpn/keys/roadwarrior/server.crt
key /etc/openvpn/keys/roadwarrior/server.key
dh /etc/openvpn/keys/roadwarrior/dh1024.pem

tls-server
mode server
ifconfig 192.168.139.1 255.255.255.0
ifconfig-pool 192.168.139.10 192.168.139.50

push &quot;route 192.168.10.0 255.255.255.0&quot;
push &quot;route-gateway 192.168.139.1&quot;

#log /var/log/openvpn/roadwarrior.log

client-config-dir /etc/openvpn/ccd

keepalive 10 120
persist-key
persist-tun
#status openvpn-roadwarrior-status.log</code></pre></div><p>Client log:<br /></p><div class="codebox"><pre><code>Wed Apr 30 23:02:24 2008 us=170489 Current Parameter Settings:
Wed Apr 30 23:02:24 2008 us=170526   config = &#039;cz-br-axmanova.ovpn&#039;
Wed Apr 30 23:02:24 2008 us=170536   mode = 0
Wed Apr 30 23:02:24 2008 us=170545   show_ciphers = DISABLED
Wed Apr 30 23:02:24 2008 us=170555   show_digests = DISABLED
Wed Apr 30 23:02:24 2008 us=170564   show_engines = DISABLED
Wed Apr 30 23:02:24 2008 us=170573   genkey = DISABLED
Wed Apr 30 23:02:24 2008 us=170582   key_pass_file = &#039;[UNDEF]&#039;
Wed Apr 30 23:02:24 2008 us=170591   show_tls_ciphers = DISABLED
Wed Apr 30 23:02:24 2008 us=170600   proto = 2
Wed Apr 30 23:02:24 2008 us=170608   local = &#039;[UNDEF]&#039;
Wed Apr 30 23:02:24 2008 us=170618   remote_list[0] = {&#039;cz-br-axmanova.domain.tld&#039;, 443}
Wed Apr 30 23:02:24 2008 us=170628   remote_random = DISABLED
Wed Apr 30 23:02:24 2008 us=170637   local_port = 1194
Wed Apr 30 23:02:24 2008 us=170646   remote_port = 1194
Wed Apr 30 23:02:24 2008 us=170655   remote_float = DISABLED
Wed Apr 30 23:02:24 2008 us=170664   ipchange = &#039;[UNDEF]&#039;
Wed Apr 30 23:02:24 2008 us=170673   bind_local = DISABLED
Wed Apr 30 23:02:24 2008 us=170682   dev = &#039;tap&#039;
Wed Apr 30 23:02:24 2008 us=170691   dev_type = &#039;[UNDEF]&#039;
Wed Apr 30 23:02:24 2008 us=170700   dev_node = &#039;[UNDEF]&#039;
Wed Apr 30 23:02:24 2008 us=170709   tun_ipv6 = DISABLED
Wed Apr 30 23:02:24 2008 us=170718   ifconfig_local = &#039;[UNDEF]&#039;
Wed Apr 30 23:02:24 2008 us=170728   ifconfig_remote_netmask = &#039;[UNDEF]&#039;
Wed Apr 30 23:02:24 2008 us=170737   ifconfig_noexec = DISABLED
Wed Apr 30 23:02:24 2008 us=170747   ifconfig_nowarn = DISABLED
Wed Apr 30 23:02:24 2008 us=170756   shaper = 0
Wed Apr 30 23:02:24 2008 us=170765   tun_mtu = 1500
Wed Apr 30 23:02:24 2008 us=170774   tun_mtu_defined = ENABLED
Wed Apr 30 23:02:24 2008 us=170783   link_mtu = 1500
Wed Apr 30 23:02:24 2008 us=170792   link_mtu_defined = DISABLED
Wed Apr 30 23:02:24 2008 us=170801   tun_mtu_extra = 32
Wed Apr 30 23:02:24 2008 us=170811   tun_mtu_extra_defined = ENABLED
Wed Apr 30 23:02:24 2008 us=170820   fragment = 0
Wed Apr 30 23:02:24 2008 us=170828   mtu_discover_type = -1
Wed Apr 30 23:02:24 2008 us=170837   mtu_test = 0
Wed Apr 30 23:02:24 2008 us=170846   mlock = DISABLED
Wed Apr 30 23:02:24 2008 us=170854   keepalive_ping = 0
Wed Apr 30 23:02:24 2008 us=170863   keepalive_timeout = 0
Wed Apr 30 23:02:24 2008 us=170872   inactivity_timeout = 0
Wed Apr 30 23:02:24 2008 us=170881   ping_send_timeout = 0
Wed Apr 30 23:02:24 2008 us=170890   ping_rec_timeout = 0
Wed Apr 30 23:02:24 2008 us=170899   ping_rec_timeout_action = 0
Wed Apr 30 23:02:24 2008 us=170908   ping_timer_remote = DISABLED
Wed Apr 30 23:02:24 2008 us=170918   remap_sigusr1 = 0
Wed Apr 30 23:02:24 2008 us=170927   explicit_exit_notification = 0
Wed Apr 30 23:02:24 2008 us=170936   persist_tun = ENABLED
Wed Apr 30 23:02:24 2008 us=170945   persist_local_ip = DISABLED
Wed Apr 30 23:02:24 2008 us=170954   persist_remote_ip = DISABLED
Wed Apr 30 23:02:24 2008 us=170963   persist_key = ENABLED
Wed Apr 30 23:02:24 2008 us=170972   mssfix = 1450
Wed Apr 30 23:02:24 2008 us=170981   resolve_retry_seconds = 1000000000
Wed Apr 30 23:02:24 2008 us=170991   connect_retry_seconds = 5
Wed Apr 30 23:02:24 2008 us=171000   username = &#039;[UNDEF]&#039;
Wed Apr 30 23:02:24 2008 us=171009   groupname = &#039;[UNDEF]&#039;
Wed Apr 30 23:02:24 2008 us=171018   chroot_dir = &#039;[UNDEF]&#039;
Wed Apr 30 23:02:24 2008 us=171027   cd_dir = &#039;[UNDEF]&#039;
Wed Apr 30 23:02:24 2008 us=171036   writepid = &#039;[UNDEF]&#039;
Wed Apr 30 23:02:24 2008 us=171045   up_script = &#039;[UNDEF]&#039;
Wed Apr 30 23:02:24 2008 us=171054   down_script = &#039;[UNDEF]&#039;
Wed Apr 30 23:02:24 2008 us=171063   down_pre = DISABLED
Wed Apr 30 23:02:24 2008 us=171072   up_restart = DISABLED
Wed Apr 30 23:02:24 2008 us=171090   up_delay = DISABLED
Wed Apr 30 23:02:24 2008 us=171100   daemon = DISABLED
Wed Apr 30 23:02:24 2008 us=171109   inetd = 0
Wed Apr 30 23:02:24 2008 us=171118   log = DISABLED
Wed Apr 30 23:02:24 2008 us=171127   suppress_timestamps = DISABLED
Wed Apr 30 23:02:24 2008 us=171137   nice = 0
Wed Apr 30 23:02:24 2008 us=171146   verbosity = 4
Wed Apr 30 23:02:24 2008 us=224332   mute = 0
Wed Apr 30 23:02:24 2008 us=224410   gremlin = 0
Wed Apr 30 23:02:24 2008 us=224459   status_file = &#039;[UNDEF]&#039;
Wed Apr 30 23:02:24 2008 us=224483   status_file_version = 1
Wed Apr 30 23:02:24 2008 us=224493   status_file_update_freq = 60
Wed Apr 30 23:02:24 2008 us=224506   occ = ENABLED
Wed Apr 30 23:02:24 2008 us=224518   rcvbuf = 0
Wed Apr 30 23:02:24 2008 us=224529   sndbuf = 0
Wed Apr 30 23:02:24 2008 us=224541   socks_proxy_server = &#039;[UNDEF]&#039;
Wed Apr 30 23:02:24 2008 us=224559   socks_proxy_port = 0
Wed Apr 30 23:02:24 2008 us=224571   socks_proxy_retry = DISABLED
Wed Apr 30 23:02:24 2008 us=224583   fast_io = DISABLED
Wed Apr 30 23:02:24 2008 us=224595   comp_lzo = DISABLED
Wed Apr 30 23:02:24 2008 us=224607   comp_lzo_adaptive = ENABLED
Wed Apr 30 23:02:24 2008 us=224619   route_script = &#039;[UNDEF]&#039;
Wed Apr 30 23:02:24 2008 us=224629   route_default_gateway = &#039;[UNDEF]&#039;
Wed Apr 30 23:02:24 2008 us=224638   route_noexec = DISABLED
Wed Apr 30 23:02:24 2008 us=236632   route_delay = 0
Wed Apr 30 23:02:24 2008 us=236646   route_delay_window = 30
Wed Apr 30 23:02:24 2008 us=236656   route_delay_defined = ENABLED
Wed Apr 30 23:02:24 2008 us=236665   management_addr = &#039;[UNDEF]&#039;
Wed Apr 30 23:02:24 2008 us=236674   management_port = 0
Wed Apr 30 23:02:24 2008 us=236683   management_user_pass = &#039;[UNDEF]&#039;
Wed Apr 30 23:02:24 2008 us=236692   management_log_history_cache = 250
Wed Apr 30 23:02:24 2008 us=236744   management_echo_buffer_size = 100
Wed Apr 30 23:02:24 2008 us=236755   management_query_passwords = DISABLED
Wed Apr 30 23:02:24 2008 us=236780   management_hold = DISABLED
Wed Apr 30 23:02:24 2008 us=236790   shared_secret_file = &#039;[UNDEF]&#039;
Wed Apr 30 23:02:24 2008 us=236799   key_direction = 0
Wed Apr 30 23:02:24 2008 us=236848   ciphername_defined = ENABLED
Wed Apr 30 23:02:24 2008 us=236859   ciphername = &#039;BF-CBC&#039;
Wed Apr 30 23:02:24 2008 us=236868   authname_defined = ENABLED
Wed Apr 30 23:02:24 2008 us=246126   authname = &#039;SHA1&#039;
Wed Apr 30 23:02:24 2008 us=246143   keysize = 0
Wed Apr 30 23:02:24 2008 us=246166   engine = DISABLED
Wed Apr 30 23:02:24 2008 us=246188   replay = ENABLED
Wed Apr 30 23:02:24 2008 us=246198   mute_replay_warnings = DISABLED
Wed Apr 30 23:02:24 2008 us=246206   replay_window = 0
Wed Apr 30 23:02:24 2008 us=246215   replay_time = 0
Wed Apr 30 23:02:24 2008 us=246224   packet_id_file = &#039;[UNDEF]&#039;
Wed Apr 30 23:02:24 2008 us=246233   use_iv = ENABLED
Wed Apr 30 23:02:24 2008 us=246241   test_crypto = DISABLED
Wed Apr 30 23:02:24 2008 us=246250   tls_server = DISABLED
Wed Apr 30 23:02:24 2008 us=246259   tls_client = ENABLED
Wed Apr 30 23:02:24 2008 us=246267   key_method = 2
Wed Apr 30 23:02:24 2008 us=246276   ca_file = &#039;cz-br-axmanova/ca.crt&#039;
Wed Apr 30 23:02:24 2008 us=246285   dh_file = &#039;[UNDEF]&#039;
Wed Apr 30 23:02:24 2008 us=246294   cert_file = &#039;cz-br-axmanova/mb.crt&#039;
Wed Apr 30 23:02:24 2008 us=253360   priv_key_file = &#039;cz-br-axmanova/mb.key&#039;
Wed Apr 30 23:02:24 2008 us=253389   pkcs12_file = &#039;[UNDEF]&#039;
Wed Apr 30 23:02:24 2008 us=253415   cryptoapi_cert = &#039;[UNDEF]&#039;
Wed Apr 30 23:02:24 2008 us=253425   cipher_list = &#039;[UNDEF]&#039;
Wed Apr 30 23:02:24 2008 us=253434   tls_verify = &#039;[UNDEF]&#039;
Wed Apr 30 23:02:24 2008 us=253443   tls_remote = &#039;[UNDEF]&#039;
Wed Apr 30 23:02:24 2008 us=253451   crl_file = &#039;[UNDEF]&#039;
Wed Apr 30 23:02:24 2008 us=253460   ns_cert_type = 0
Wed Apr 30 23:02:24 2008 us=253468   tls_timeout = 2
Wed Apr 30 23:02:24 2008 us=253476   renegotiate_bytes = 0
Wed Apr 30 23:02:24 2008 us=253485   renegotiate_packets = 0
Wed Apr 30 23:02:24 2008 us=253493   renegotiate_seconds = 3600
Wed Apr 30 23:02:24 2008 us=253502   handshake_window = 60
Wed Apr 30 23:02:24 2008 us=253511   transition_window = 3600
Wed Apr 30 23:02:24 2008 us=253523   single_session = DISABLED
Wed Apr 30 23:02:24 2008 us=261070   tls_exit = DISABLED
Wed Apr 30 23:02:24 2008 us=261091   tls_auth_file = &#039;[UNDEF]&#039;
Wed Apr 30 23:02:24 2008 us=261133   server_network = 0.0.0.0
Wed Apr 30 23:02:24 2008 us=261156   server_netmask = 0.0.0.0
Wed Apr 30 23:02:24 2008 us=261166   server_bridge_ip = 0.0.0.0
Wed Apr 30 23:02:24 2008 us=261175   server_bridge_netmask = 0.0.0.0
Wed Apr 30 23:02:24 2008 us=261185   server_bridge_pool_start = 0.0.0.0
Wed Apr 30 23:02:24 2008 us=261195   server_bridge_pool_end = 0.0.0.0
Wed Apr 30 23:02:24 2008 us=261204   ifconfig_pool_defined = DISABLED
Wed Apr 30 23:02:24 2008 us=261215   ifconfig_pool_start = 0.0.0.0
Wed Apr 30 23:02:24 2008 us=261225   ifconfig_pool_end = 0.0.0.0
Wed Apr 30 23:02:24 2008 us=261235   ifconfig_pool_netmask = 0.0.0.0
Wed Apr 30 23:02:24 2008 us=261246   ifconfig_pool_persist_filename = &#039;[UNDEF]&#039;
Wed Apr 30 23:02:24 2008 us=261255   ifconfig_pool_persist_refresh_freq = 600
Wed Apr 30 23:02:24 2008 us=261265   ifconfig_pool_linear = DISABLED
Wed Apr 30 23:02:24 2008 us=268756   n_bcast_buf = 256
Wed Apr 30 23:02:24 2008 us=268786   tcp_queue_limit = 64
Wed Apr 30 23:02:24 2008 us=268810   real_hash_size = 256
Wed Apr 30 23:02:24 2008 us=268833   virtual_hash_size = 256
Wed Apr 30 23:02:24 2008 us=268843   client_connect_script = &#039;[UNDEF]&#039;
Wed Apr 30 23:02:24 2008 us=268852   learn_address_script = &#039;[UNDEF]&#039;
Wed Apr 30 23:02:24 2008 us=268861   client_disconnect_script = &#039;[UNDEF]&#039;
Wed Apr 30 23:02:24 2008 us=268870   client_config_dir = &#039;[UNDEF]&#039;
Wed Apr 30 23:02:24 2008 us=268879   ccd_exclusive = DISABLED
Wed Apr 30 23:02:24 2008 us=268888   tmp_dir = &#039;[UNDEF]&#039;
Wed Apr 30 23:02:24 2008 us=268897   push_ifconfig_defined = DISABLED
Wed Apr 30 23:02:24 2008 us=268908   push_ifconfig_local = 0.0.0.0
Wed Apr 30 23:02:24 2008 us=268918   push_ifconfig_remote_netmask = 0.0.0.0
Wed Apr 30 23:02:24 2008 us=268928   enable_c2c = DISABLED
Wed Apr 30 23:02:24 2008 us=268936   duplicate_cn = DISABLED
Wed Apr 30 23:02:24 2008 us=275590   cf_max = 0
Wed Apr 30 23:02:24 2008 us=275611   cf_per = 0
Wed Apr 30 23:02:24 2008 us=275625   max_clients = 1024
Wed Apr 30 23:02:24 2008 us=275642   max_routes_per_client = 256
Wed Apr 30 23:02:24 2008 us=275663   client_cert_not_required = DISABLED
Wed Apr 30 23:02:24 2008 us=275674   username_as_common_name = DISABLED
Wed Apr 30 23:02:24 2008 us=275684   auth_user_pass_verify_script = &#039;[UNDEF]&#039;
Wed Apr 30 23:02:24 2008 us=275694   auth_user_pass_verify_script_via_file = DISABLED
Wed Apr 30 23:02:24 2008 us=275704   client = ENABLED
Wed Apr 30 23:02:24 2008 us=275712   pull = ENABLED
Wed Apr 30 23:02:24 2008 us=275722   auth_user_pass_file = &#039;[UNDEF]&#039;
Wed Apr 30 23:02:24 2008 us=275733   show_net_up = DISABLED
Wed Apr 30 23:02:24 2008 us=275742   route_method = 1
Wed Apr 30 23:02:24 2008 us=275750   ip_win32_defined = DISABLED
Wed Apr 30 23:02:24 2008 us=275759   ip_win32_type = 3
Wed Apr 30 23:02:24 2008 us=275768   dhcp_masq_offset = 0
Wed Apr 30 23:02:24 2008 us=283263   dhcp_lease_time = 31536000
Wed Apr 30 23:02:24 2008 us=283306   tap_sleep = 0
Wed Apr 30 23:02:24 2008 us=283321   dhcp_options = DISABLED
Wed Apr 30 23:02:24 2008 us=283331   dhcp_renew = DISABLED
Wed Apr 30 23:02:24 2008 us=283340   dhcp_pre_release = DISABLED
Wed Apr 30 23:02:24 2008 us=283349   dhcp_release = DISABLED
Wed Apr 30 23:02:24 2008 us=283358   domain = &#039;[UNDEF]&#039;
Wed Apr 30 23:02:24 2008 us=283367   netbios_scope = &#039;[UNDEF]&#039;
Wed Apr 30 23:02:24 2008 us=283376   netbios_node_type = 0
Wed Apr 30 23:02:24 2008 us=283386   disable_nbt = DISABLED
Wed Apr 30 23:02:24 2008 us=283403 OpenVPN 2.0.9 Win32-MinGW [SSL] [LZO] built on Oct  1 2006
Wed Apr 30 23:02:24 2008 us=283504 IMPORTANT: OpenVPN&#039;s default port number is now 1194, based on an official port number assignment by IANA.  OpenVPN 2.0-beta16 and earlier used 5000 as the default port.
Wed Apr 30 23:02:24 2008 us=283517 WARNING: No server certificate verification method has been enabled.  See http://openvpn.net/howto.html#mitm for more info.
Wed Apr 30 23:02:26 2008 us=649873 Control Channel MTU parms [ L:1575 D:140 EF:40 EB:0 ET:0 EL:0 ]
Wed Apr 30 23:02:27 2008 us=860435 Data Channel MTU parms [ L:1575 D:1450 EF:43 EB:4 ET:32 EL:0 ]
Wed Apr 30 23:02:27 2008 us=860519 Local Options String: &#039;V4,dev-type tap,link-mtu 1575,tun-mtu 1532,proto TCPv4_CLIENT,cipher BF-CBC,auth SHA1,keysize 128,key-method 2,tls-client&#039;
Wed Apr 30 23:02:27 2008 us=860542 Expected Remote Options String: &#039;V4,dev-type tap,link-mtu 1575,tun-mtu 1532,proto TCPv4_SERVER,cipher BF-CBC,auth SHA1,keysize 128,key-method 2,tls-server&#039;
Wed Apr 30 23:02:27 2008 us=860590 Local Options hash (VER=V4): &#039;10f35004&#039;
Wed Apr 30 23:02:27 2008 us=860620 Expected Remote Options hash (VER=V4): &#039;a917298a&#039;
Wed Apr 30 23:02:27 2008 us=860721 Attempting to establish TCP connection with 11.22.16.121:443
Wed Apr 30 23:02:27 2008 us=987990 TCP connection established with 11.22.16.121:443
Wed Apr 30 23:02:27 2008 us=988039 Socket Buffers: R=[8192-&gt;8192] S=[8192-&gt;8192]
Wed Apr 30 23:02:27 2008 us=988072 TCPv4_CLIENT link local: [undef]
Wed Apr 30 23:02:27 2008 us=988111 TCPv4_CLIENT link remote: 11.22.16.121:443
Wed Apr 30 23:03:28 2008 us=445747 TLS Error: TLS key negotiation failed to occur within 60 seconds (check your network connectivity)
Wed Apr 30 23:03:28 2008 us=445786 TLS Error: TLS handshake failed
Wed Apr 30 23:03:28 2008 us=446072 Fatal TLS error (check_tls_errors_co), restarting
Wed Apr 30 23:03:28 2008 us=446152 TCP/UDP: Closing socket
Wed Apr 30 23:03:28 2008 us=446549 SIGUSR1[soft,tls-error] received, process restarting
Wed Apr 30 23:03:28 2008 us=446574 Restart pause, 5 second(s)</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p67666">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">kebul</div>
					<div class="post-datetime">
						1 May 2008, 13:00					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>martinbalint wrote:</cite><blockquote><div class="codebox"><pre><code>Wed Apr 30 23:03:28 2008 us=445747 TLS Error: TLS key negotiation failed to occur within 60 seconds (check your network connectivity)</code></pre></div></blockquote></div><p>It cannot establish the connection: .</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p67667">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">martinbalint</div>
					<div class="post-datetime">
						1 May 2008, 13:22					</div>
				</div>
				<div class="post-content content">
					<p>But this is not the case.<br />When I run tcpdump on wan inferface, I can see communication in both directions, and if I set client to verbose logging, I can see a lot of debug messages about TLS negotiation.<br />So it must be something else, not a networking problem.<br />And all this worked, when I had debian on my router rb532a.<br />Now, I have the same openvpn and shorewall configuration in openwrt.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p67674">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">placebo</div>
					<div class="post-datetime">
						1 May 2008, 15:46					</div>
				</div>
				<div class="post-content content">
					<p>Make sure the time and date are set correctly on the router, otherwise OpenVPN won&#039;t think the certificate is valid.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p67684">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">martinbalint</div>
					<div class="post-datetime">
						1 May 2008, 19:19					</div>
				</div>
				<div class="post-content content">
					<p>Dates are OK on both parties.<br />And, it works on 443/UDP, so it must be some uncommon problem.<br />But I am not able to connect from some networks using 443/udp, so I must use 443/tcp instead.</p><p>On the same router, I have 2 more instances of openvpn in configuration LAN-to-LAN working, on UDP.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p67822">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">martinbalint</div>
					<div class="post-datetime">
						4 May 2008, 22:08					</div>
				</div>
				<div class="post-content content">
					<p>OK, no more ideas. I will ask: Is there someone, who is running openvpn server on kamikaze and TCP listener? Are there any practical experiences with this configuration? Thanks.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p67828">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">booBot</div>
					<div class="post-datetime">
						4 May 2008, 23:05					</div>
				</div>
				<div class="post-content content">
					<p>Not particularly the Kamikaze experience, but I run my OpenVPN on tcp/443 successfully on winXP.<br />Like you - I have 3 instances of the server process: one for LAN-local, another to reach my network from the outside via udp/1194, and the last is tcp/443 to penetrate corporate proxyes.</p><p>The &quot;TLS-handshake failed&quot; happens on me if I&#039;m on a slower GPRS connection - the 60-seconds handshake window is actually ~48 seconds wide. Try to use the <strong>hand-window</strong> option.</p><p>Hope that helps!</p>											<p class="post-edited">(Last edited by <strong>booBot</strong> on 4 May 2008, 23:09)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p67829">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">martinbalint</div>
					<div class="post-datetime">
						5 May 2008, 00:10					</div>
				</div>
				<div class="post-content content">
					<p>Thanks, I tried, but it didn&#039;t help.<br />It seems to be openwrt related, because the same configuration works on debian on the same hardware.</p><p>btw, I captured this with tcpdump, if it has some diagnostic value:<br /></p><div class="codebox"><pre><code>21:06:07.653569 IP client.1153 &gt; server.443: S 382081031:382081031(0) win 65535 &lt;mss 1380,nop,wscale 1,nop,nop,sackOK&gt;
21:06:07.653951 IP server.443 &gt; client.1153: S 1927034756:1927034756(0) ack 382081032 win 5840 &lt;mss 1460,nop,nop,sackOK,nop,wscale 1&gt;
21:06:07.779266 IP client.1153 &gt; server.443: . ack 1 win 64000
21:06:07.791182 IP client.1153 &gt; server.443: P 1:17(16) ack 1 win 64000
21:06:10.777131 IP client.1153 &gt; server.443: P 1:33(32) ack 1 win 64000
21:06:12.044748 IP server.443 &gt; client.1153: S 1927034756:1927034756(0) ack 382081032 win 5840 &lt;mss 1460,nop,nop,sackOK,nop,wscale 1&gt;
21:06:12.166505 IP client.1153 &gt; server.443: . ack 1 win 64000
21:06:18.014140 IP client.1153 &gt; server.443: P 1:81(80) ack 1 win 64000
21:06:18.444787 IP server.443 &gt; client.1153: S 1927034756:1927034756(0) ack 382081032 win 5840 &lt;mss 1460,nop,nop,sackOK,nop,wscale 1&gt;
21:06:18.569575 IP client.1153 &gt; server.443: . ack 1 win 64000
21:06:30.090804 IP client.1153 &gt; server.443: P 1:177(176) ack 1 win 64000
21:06:31.244876 IP server.443 &gt; client.1153: S 1927034756:1927034756(0) ack 382081032 win 5840 &lt;mss 1460,nop,nop,sackOK,nop,wscale 1&gt;
21:06:31.394387 IP client.1153 &gt; server.443: . ack 1 win 64000</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p67846">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">dlbogdan</div>
					<div class="post-datetime">
						5 May 2008, 11:23					</div>
				</div>
				<div class="post-content content">
					<p>i am running openvpn server on tcp/110&nbsp; in kamikaze with multiple clients (certificate based) very stable and speedy now (x86 server platform)</p><p>here is my server.ovpn</p><p>mode server&nbsp; &nbsp; # very important if you want multiple clients on the same port with the same daemon because i think openvpn defaults to p2p mode</p><p>proto tcp-server<br />port 110<br />dev tap0</p><p>push &quot;dhcp-option DNS 192.168.1.1&quot;<br />keepalive 10 180<br />push &quot;keepalive 10 180&quot;</p><p>max-clients 80<br />tls-server<br />ca /etc/easy-rsa/keys/ca.crt<br />cert /etc/easy-rsa/keys/server.crt<br />key /etc/easy-rsa/keys/server.key<br />dh /etc/easy-rsa/keys/dh1024.pem<br />persist-key<br />persist-tun</p><p>one of my clients has (windows xp) :</p><p>dev tap</p><p>proto tcp-client</p><p>route-gateway 192.168.1.1<br />remote &lt;servername&gt; 110</p><p>ifconfig 192.168.1.10 255.255.255.0</p><p>route 192.168.20.0 255.255.255.0 192.168.20.141 <br />redirect-gateway<br />resolv-retry infinite</p><p>nobind<br />mute-replay-warnings</p><p>ca ca.crt<br />cert client1.crt<br />key client1.key</p><p>tls-client<br />verb 3</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p67889">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">aorlinsk</div>
					<div class="post-datetime">
						6 May 2008, 15:17					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>martinbalint wrote:</cite><blockquote><p>Hello,</p><p>I am trying to get openvpn working on kamikaze 7.09 (rb532a). I need to connect as a roadwarrior to openvpn daemon listening on 443/tcp.<br />There seems to be a problem with key negotiation, but I am sure my config is OK, because it works on debian (on rb532a), or if I switch to UDP.</p><p>I googled out, that it may be openvpns EPOLL problem, but I wasn&#039;t able to compile openvpn with epoll disabled, to test it.</p><p>Did anybody resolved this already?</p></blockquote></div><p>I had exactly same kind of problems. If I remember correctly I found a way to disable epoll and got it to work. I had to tweak the openvpn ./configure file to make it think that epoll is not available on the platform.</p><br /><br /><p>Anael</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p67974">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">martinbalint</div>
					<div class="post-datetime">
						8 May 2008, 11:36					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>aorlinsk wrote:</cite><blockquote><p>I had exactly same kind of problems. If I remember correctly I found a way to disable epoll and got it to work. I had to tweak the openvpn ./configure file to make it think that epoll is not available on the platform.<br />Anael</p></blockquote></div><p>Hi,<br />and could you please recall how did you tweak it? I tried almost everything in ./configure, but with no luck, EPOLL was always enabled.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p67995">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">aorlinsk</div>
					<div class="post-datetime">
						8 May 2008, 21:59					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>martinbalint wrote:</cite><blockquote><div class="quotebox"><cite>aorlinsk wrote:</cite><blockquote><p>I had exactly same kind of problems. If I remember correctly I found a way to disable epoll and got it to work. I had to tweak the openvpn ./configure file to make it think that epoll is not available on the platform.<br />Anael</p></blockquote></div><p>Hi,<br />and could you please recall how did you tweak it? I tried almost everything in ./configure, but with no luck, EPOLL was always enabled.</p></blockquote></div><p>Here is the solution : in the open package Makefile, force the epoll detection to none by adding this line at the end of configure block : ac_cv_func_epoll_create=no \ </p><p>You should get this :<br /></p><div class="codebox"><pre><code>define Build/Configure
    $(call Build/Configure/Default, \
        --disable-pthread \
        --disable-debug \
        --disable-plugins \
        --enable-management \
        --disable-socks \
        --enable-password-save \
        ac_cv_func_epoll_create=no \
    )
endef</code></pre></div><p>Just note that this works for me with openvpn 2.1_rc4 (I updated makefile to use this one). However this trick should work with 2.0.9</p><p>Anael</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p68135">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">martinbalint</div>
					<div class="post-datetime">
						12 May 2008, 21:27					</div>
				</div>
				<div class="post-content content">
					<p>OK, with inspiration in dlbogdans config, I managed to get it running with this server config and &quot;ifconfig&quot; and &quot;route&quot; in client config.</p><div class="codebox"><pre><code>proto tcp-server
port 443
dev tap0

keepalive 10 180
push &quot;keepalive 10 180&quot;

ifconfig 192.168.139.1 255.255.255.0

tls-server
ca /etc/openvpn/keys/roadwarrior/ca.crt
cert /etc/openvpn/keys/roadwarrior/server.crt
key /etc/openvpn/keys/roadwarrior/server.key
dh /etc/openvpn/keys/roadwarrior/dh1024.pem
persist-key
persist-tun</code></pre></div><p>but as soon as I add &quot;mode server&quot;, it fails.</p><p>I will try Anaels suggestion on disabling EPOLL.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p68141">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">martinbalint</div>
					<div class="post-datetime">
						13 May 2008, 00:26					</div>
				</div>
				<div class="post-content content">
					<p>Thanks Anael,<br />EPOLL disabling works. Now I am able to run tcp server with configuration from 1st post.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p172919">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">tcr92</div>
					<div class="post-datetime">
						22 Jul 2012, 03:26					</div>
				</div>
				<div class="post-content content">
					<p>Hi all, can someone help me compile OpenVPN with EPOLL disabled? I have OpenWrt Backfire 10.03.1-RC6. I am new to this <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /> ... if I can get a link to a tutorial of how to compile a package for OpenWRT, I think I can mange. Thanks in advance <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>