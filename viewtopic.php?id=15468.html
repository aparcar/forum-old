<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Kamikaze trunk 7.09 and HSDPA connection</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 22 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p67480">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">againmoon</div>
					<div class="post-datetime">
						26 Apr 2008, 18:01					</div>
				</div>
				<div class="post-content content">
					<p>UPDATE <br />The more effective way to connect is by using the comgt package as underlined in this thread by aoz.syn, that I thank very much. More information in this thread is given in the following posts by aoz.syn. So please consider comgt package in order to activate your HSDPA connection (but also the others).<br />Here some aoz.syn useful informations<br /><strong>&quot;Mostly the comgt package provides is a sane and tested set of PPP and OpenWRT scripts designed to make configuring cellular data connections as painless as possible.&nbsp; Hopefully the next release will come soon and include it, but here are the additional configuration options it currently provides:</strong></p><br /><br /><div class="codebox"><pre><code>config interface &quot;foo&quot;
    option device       &quot;/dev/ttyUSB0&quot;
    option proto        &quot;3g&quot;
    option apn          &quot;my.provider.apn&quot;
    option service      &quot;hsdpa&quot; # or cdma, evdo, umts_only, or gprs_only
    option pincode      &quot;12345&quot;
    option mtu          &quot;1492&quot;</code></pre></div><p><strong>So, here are my two condensed lists, truths and needs:</p><p>Truths:<br />- Most cellular modems, whether they plug in via PCMCIA, Cardbus, ExpressCard, or direct USB are USB at heart<br />- Serial speed doesn&#039;t matter<br />- As long as you have a directly supported device and a kernel less than two years old, you don&#039;t need to mess with buffer sizes<br />- Actual throughput almost never matches marketed throughput</p><p>Needs:<br />- For a PCMCIA or Cardbus device, you will need your hardware&#039;s PCMCIA or Cardbus drivers in addition to your USB driver<br />- For an ExpressCard, the base PCI drivers<br />- A base USB driver (usually ohci_hcd for Cardbus/PCMCIA/ExpressCard)<br />- usb-serial (2.6) or usbserial (2.4)<br />- device-specific driver, if available<br />At this point, if you plug in your device you should see /dev/ttyUSB0 or higher.&nbsp; If you don&#039;t, you are missing a driver or driver option<br />- pppd<br />- A chat script (there are dozens of examples out there, comgt does provide one that should work for most people)&quot;</strong></p><br /><p>The Following is DEPRECATED (better use of comgt)</p><br /><p><span style="color: #FF0000"><strong>UPDATE!!! Dear all, I am terribly sorry, but there was a mistake in my router. In the tag on the bottom part the putted asus wl500GP v2 and<br />they sell to me as V2, but in reality is a V1!!!! You can see the picture here<br /><a href="http://wl500g.info/showthread.php?p=96239#post96239">http://wl500g.info/showthread.php?p=96239#post96239</a><br />You should be able to read in the bottom picture wl500GP v2 but in reality is<br />a wl500G Premium (v1!!!!) as it is shown on the picture (antenna on the left). In the following everything refers to V1</strong></span></p><p>I would like to share with you my last two week experience in connecting a router with a HSDPA usb modem.I am newby but I hope my results could help someone in connecting and maybe improve my solution. I am newby so I am sorry for my naif methods, but it worked. Of course, I will decline any responsibility. <strong>Update: It is noteworthy that &quot;HSDPA usb modems&quot; can be used with any router with usb port and they do not need router with special features, like PCMCIA and datacard!!!</strong></p><p>You need:</p><p>1) Any kamikaze trunk 7.09 router with usb. I used a brand new ASUS wl500GP v2<br />2) Any HSDPA modem with its initialization commands. I used a modem Onda MH600HS (HSDPA 7.2 Mega). I will support some information about<br />Huawei E220, since I have the documentation. <br />3) Internet connection, used for installation</p><br /><p>History <br />Before using a kamikaze trunk based solution I tried, on my Asus wl500GP v2, a product specific firmware, koppel firmware, that I found in <a href="http://koppel.cz/cdmawifi/">http://koppel.cz/cdmawifi/</a>. Koppel is derivated from oleg firmware, <a href="http://oleg.wl500g.info">http://oleg.wl500g.info</a>/ and oleg comes from the asus original firmware.<br />I used Koppel firmware within a good Italian Howto (<a href="http://forum.telefonino.net/showthread.php?p=4976685&amp;posted=1#post4976685">http://forum.telefonino.net/showthread. … ost4976685</a>)<br />The problem was that the version used of Koppel did not work, because the new v2 was quite different from old v1.<br />Anyway Koppel and Oleg forums were important to me to learn a little bit about usb HSDPA connection.<br />Then I decided to use Kamikaze. </p><p>How to<br />1) Look for a suitable Kamikaze trunk software. I used this I found in this post <a href="http://forum.openwrt.org/viewtopic.php?id=14856&amp;p=2">http://forum.openwrt.org/viewtopic.php?id=14856&amp;p=2</a> a suitable v2 Kamikaze trunk 7.09 (broadcom 2.4)&nbsp; firmware version here <a href="http://web03.tzmo.com.pl/~bartek/asuswl500gpv2/">http://web03.tzmo.com.pl/~bartek/asuswl500gpv2/</a>.</p><p>2) Install Kamikaze. I putted in the recovery mode and used window recovery program to upload the firmware.</p><p>3) I followed the howto in <a href="http://wiki.openwrt.org/MobileAPHowTo2#head-ece6773e5331d3d2950af0426714281fb39fd5cf">http://wiki.openwrt.org/MobileAPHowTo2# … 1fb39fd5cf</a>.<br />I did the following packages:<br />[s]ipkg install kmod-usb-ohci[/s] <strong>UPDATE: ipkg install kmod-usb-uhci, kmod-usb-uhci-iv</strong>, kmod-usb-ohci is not necessary <br />ipkg install kmod-usb-serial<br />ipkg install microcom<br />ipkg install kmod-ppp<br /> ipkg install ppp <br />ipkg install chat </p><p>reboot<br />in the dsmeg, if you connect your modem your should recognize your modem:</p><div class="codebox"><pre><code> USB Mass Storage support registered.
hub.c: new USB device 01:03.0-2, assigned address 2
usb.c: USB device 2 (vend/prod 0x19d2/0x1) is not claimed by any active driver.
device wl0 entered promiscuous mode
wl0: attempt to add interface with same source address.
br-lan: port 2(wl0) entering learning state
br-lan: port 2(wl0) entering forwarding state
br-lan: topology change detected, propagating</code></pre></div><p>Here you see Vendor&nbsp; and Product ID of my modem (for E220 0x12d1 0x1003)</p><br /><p>4) you should set vid and pid and maxSize in usbserial</p><p>usbserial vendor=0x19d2 product=0X0001 maxSize=4096<br />E220 usbserial vendor=0x12d1 product=0x1003 maxSize=4096<br /><strong> IMPORTANT!!! maxSize=4096 buffer size it is necessary for HSDPA. Otherwise default it will go as gprs...</strong><br />reboot<br />in dmesg you should have the three devices ttyUSB0 ttyUSB1 ttyUSB2 now:</p><br /><div class="codebox"><pre><code>.............
USB Mass Storage support registered.
hub.c: new USB device 01:03.0-2, assigned address 2
usbserial.c: Generic converter detected
usbserial.c: Generic converter now attached to ttyUSB0 (or usb/tts/0 for devfs)
usbserial.c: Generic converter detected
usbserial.c: Generic converter now attached to ttyUSB1 (or usb/tts/1 for devfs)
usbserial.c: Generic converter detected
usbserial.c: Generic converter now attached to ttyUSB2 (or usb/tts/2 for devfs)
device wl0 entered promiscuous mode
wl0: attempt to add interface with same source address.
...........</code></pre></div><p>5) now you can test if&nbsp; modem works by sending command via microcom.<br /> microcom -D/dev/usb/tts/0 <br />AT <br />OK <br />6) Config files. This part depend on specific modem, type of connection. In <br /><a href="http://www.advantedgecomputing.com/opensource/gc83linux.html">http://www.advantedgecomputing.com/open … linux.html</a> you can find useful information, otherwise google it!<br /><strong>IMPORTANT: In order to have HSDPA you have to specify the negotiation speed<br />my modem negotiation speed: 921600<br />E220 negotiation speed:460800</strong><br />mkdir /etc/ppp/peers <br />vi /etc/ppp/peers/hsdpa <br />my modem hsdpa file (comments in Italian)<br /></p><div class="codebox"><pre><code> root@OpenWrt:/etc/ppp/peers# cat hsdpa
#informazioni sul dispositivo
/dev/usb/tts/0 #dispositivo assegnato al modem ONDA
921600 #velocitï¿½ 
#echo &#039;settata velocitï¿½ &#039;
hide-password
noauth
debug
defaultroute
noipdefault
noccp
nobsdcomp
usepeerdns
connect-delay 10000
nodetach
user &quot;&quot;
password &quot;&quot;
#echo &#039;chiamo lachat&#039;

connect &quot;/usr/sbin/chat -t 60 -f /etc/ppp/peers/hsdpa.chat</code></pre></div><p>E220 HSDPA should look like:<br />hide-password<br />noauth<br />debug<br />/dev/usb/tts/0<br />460800<br />defaultroute<br />noipdefault<br />noccp<br />nobsdcomp<br />usepeerdns<br />connect-delay 10000<br />nodetach<br />user &quot;$username$&quot;<br />connect &quot;/usr/sbin/chat -t 60 -f /tmp/ppp/peers/hsdpa.chat</p><p>My modem chat file:<br />vi /etc/ppp/peers/hsdpa.chat</p><div class="codebox"><pre><code> root@OpenWrt:/etc/ppp/peers# cat hsdpa.chat
SAY &#039;Inizio connessione...&#039;
&#039;&#039; &#039;ATZ&#039;
&#039;&#039; &#039;AT+ZOPRT=5&#039;
TIMEOUT 5
&#039;&#039; &#039;AT&#039;
&#039;&#039; &#039;ATV1&#039;
&#039;&#039; &#039;AT&amp;F&amp;D2&amp;C1S0=0&#039;
&#039;&#039; &#039;ATS7=60S30=0&#039;
&#039;&#039; &#039;AT+CGDCONT=1,&quot;IP&quot;,&quot;datacard.tre.it&quot;&#039;
&#039;&#039; &#039;AT+COPS=1,0,&quot;3 ITA&quot;&#039;
&#039;&#039; &#039;ATDT*99***1#&#039;
SAY &#039;connesso infine&#039;</code></pre></div><p>In particular:<br />&#039;AT+CGDCONT=1,&quot;IP&quot;,&quot;datacard.tre.it &lt;-connection type, my APN<br />&#039;AT+COPS=1,0,&quot;3 ITA&quot;&#039;&lt;---- no Roaming, only my operator[/color]<br />&#039;ATDT*99***1#&#039;&lt;---dial number</p><br /><p>E220 chat file should be like:</p><p>&#039;&#039; &#039;&#039;<br />&#039;&#039; &#039;ATZ&#039;<br />TIMEOUT 5<br />&#039;OK&#039; &#039;AT+CGDCONT=1,&quot;IP&quot;,&quot;$apn$&quot;&#039;<br />&#039;OK&#039; &#039;ATDT$dialno$&#039;<br />&#039;CONNECT&#039; &#039;&#039;</p><br /><p>7) Device setup and Lock file directory creation<br />You can try:<br />root@OpenWrt:~# pppd call hsdpa<br />You may have:<br />pppd: pppd is unable to open the /dev/ppp device.</p><p>In this case, as suggested in <a href="http://wiki.openwrt.org/MobileAPHowTo2#head-ece6773e5331d3d2950af0426714281fb39fd5cf">http://wiki.openwrt.org/MobileAPHowTo2# … 1fb39fd5cf</a><br />you may need (I did not) to do the following:</p><p>mknod /dev/ppp c 108 0<br />root@OpenWrt:~# mkdir /var/lock<br />root@OpenWrt:~# vi /etc/modules.d/70-ppp<br />slhc<br />ppp_generic<br />ppp_async</p><p>also if you have lock option you may add the following</p><p>root@OpenWrt:~# vi /etc/init.d/S80ppp<br />#!/bin/sh<br />mkdir -p /var/lock<br />root@OpenWrt:~# chmod +x /etc/init.d/S80ppp</p><br /><p>8) Setting the WAN</p><br /><div class="codebox"><pre><code> root@OpenWrt:/# cat /etc/config/network
#### VLAN configuration
config switch eth0
        option vlan0    &quot;1 2 3 4 5*&quot;
        option vlan1    &quot;0 5&quot;


#### Loopback configuration
config interface loopback
        option ifname   &quot;lo&quot;
        option proto    static
        option ipaddr   127.0.0.1
        option netmask  255.0.0.0


#### LAN configuration
config interface lan
        option type     bridge
        option ifname   &quot;eth0.0&quot;
        option proto    static
        option ipaddr   192.168.1.1
        option netmask  255.255.255.0


#### WAN configuration
config interface        wan
        option ifname   &quot;ppp0&quot;
        option device   &quot;ppp0&quot;</code></pre></div><div class="codebox"><pre><code>root@OpenWrt:/# cat /etc/config/wireless
config wifi-device  wl0
        option type     broadcom
        option channel  5

        # REMOVE THIS LINE TO ENABLE WIFI:
        #option disabled 1



option wifi-iface
        option device wl0
        option network lan
        option mode ap
        option ssid KamikazeHSDPA
        option encryption psk
        option key &#039;HSDPAconnect!&#039;
root@OpenWrt:/#</code></pre></div><p>9) test drive :<br />pppd call hsdpa</p><br /><div class="codebox"><pre><code> root@OpenWrt:/# ifconfig ppp0
ppp0      Link encap:Point-to-Point Protocol
          inet addr:10.112.4.3  P-t-P:10.64.64.64  Mask:255.255.255.255
          UP POINTOPOINT RUNNING NOARP MULTICAST  MTU:1500  Metric:1
          RX packets:43354 errors:583 dropped:0 overruns:0 frame:0
          TX packets:31102 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:3
          RX bytes:50288275 (47.9 MiB)  TX bytes:3923668 (3.7 MiB)

root@OpenWrt:/etc/ppp/peers# netstat -nr
Kernel IP routing table
Destination     Gateway         Genmask         Flags   MSS Window  irtt Iface
10.64.64.64     0.0.0.0         255.255.255.255 UH        0 0          0 ppp0
192.168.1.0     0.0.0.0         255.255.255.0   U         0 0          0 br-lan
0.0.0.0         10.64.64.64     0.0.0.0         UG        0 0          0 ppp0</code></pre></div><p>10) For the moment I reach the end. I discharghe at [s]500 kb from Itunes[/s] <span style="color: blue"> 1300 kb/s </span> (same result I had with computer direct connection)</p>											<p class="post-edited">(Last edited by <strong>againmoon</strong> on 12 May 2008, 08:15)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p67759">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">againmoon</div>
					<div class="post-datetime">
						3 May 2008, 09:01					</div>
				</div>
				<div class="post-content content">
					<p>Just for sake of completeness I attach the ipkg list_installed output.<br />Here there are all the package I used for connection (i.e there is not kmod-usb-ohci)</p><br /><div class="codebox"><pre><code> root@OpenWrt:~# ipkg list_installed
bridge - 1.0.6-1 -
bzip2 - 1.0.5-1 -
chat - 2.4.3-9 -
dnsmasq - 2.41-1 -
dropbear - 0.50-3 -
e2fsprogs - 1.39-1 -
fdisk - 2.13.0.1-1 -
gsm-utils - 1.0.10-1 -
gzip - 1.3.3-1 -
hdparm - 8.5-1 -
hotplug2 - 0.9+r102-2 -
iptables - 1.3.8-2 -
kernel - 2.4.35.4-brcm-2.4-1 -
kmod-brcm-wl - 2.4.35.4+4.150.10.5.1-brcm-2.4-1 -
kmod-diag - 2.4.35.4-brcm-2.4-2 -
kmod-fs-cifs - 2.4.35.4-brcm-2.4-1 -
kmod-fs-ext2 - 2.4.35.4-brcm-2.4-1 -
kmod-fs-ext3 - 2.4.35.4-brcm-2.4-1 -
kmod-fs-ntfs - 2.4.35.4-brcm-2.4-1 -
kmod-fs-vfat - 2.4.35.4-brcm-2.4-1 -
kmod-ipt-nathelper - 2.4.35.4-brcm-2.4-1 -
kmod-nls-cp1250 - 2.4.35.4-brcm-2.4-1 -
kmod-nls-iso8859-1 - 2.4.35.4-brcm-2.4-1 -
kmod-nls-iso8859-2 - 2.4.35.4-brcm-2.4-1 -
kmod-nls-utf8 - 2.4.35.4-brcm-2.4-1 -
kmod-ppp - 2.4.35.4-brcm-2.4-1 -
kmod-pppoe - 2.4.35.4-brcm-2.4-1 -
kmod-scsi-core - 2.4.35.4-brcm-2.4-1 -
kmod-switch - 2.4.35.4-brcm-2.4-1 -
kmod-usb-core - 2.4.35.4-brcm-2.4-1 -
kmod-usb-serial - 2.4.35.4-brcm-2.4-1 -
kmod-usb-storage - 2.4.35.4-brcm-2.4-1 -
kmod-usb-uhci - 2.4.35.4-brcm-2.4-1 -
kmod-usb-uhci-iv - 2.4.35.4-brcm-2.4-1 -
kmod-wlcompat - 2.4.35.4+4.150.10.5.1-brcm-2.4-1 -
libblkid - 1.39-1 -
libgcc - 3.4.6-12 -
libgsm - 1.0.10-1 -
libncurses - 5.6-1 -
libuci - 0.3.0-1 -
libusb - 0.1.12-1 -
libuuid - 1.39-1 -
lsof - 4.77-1 -
microcom - 1.02-1 -
minicom - 2.3-1 -
mtd - 6 -
nas - 4.150.10.5.1-1 -
nvram - 1 -
pciutils - 2.2.9-1 -
ppp - 2.4.3-9 -
ppp-mod-pppoe - 2.4.3-9 -
qc-usb-utils - 0.6.5-1 -
screen - 4.0.3-1 -
tar - 1.18-1 -
uci - 0.3.0-1 -
uclibc - 0.9.29-12 -
usbutils - 0.73-1 -
wireless-tools - 29-2 -
wlc - 4.150.10.5.1-1 -
zlib - 1.2.3-5 -
Done.
root@OpenWrt:~#</code></pre></div>											<p class="post-edited">(Last edited by <strong>againmoon</strong> on 3 May 2008, 09:47)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p67821">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">againmoon</div>
					<div class="post-datetime">
						4 May 2008, 21:12					</div>
				</div>
				<div class="post-content content">
					<p>I would like to integrate the howto<br />In order to connect automatically i made the following files<br /></p><div class="codebox"><pre><code> cat /usr/local/hsdpastarter
#!/bin/sh


while true; do
        killall -9 pppd
        sleep 5

        pppd call hsdpa

        sleep 25
done</code></pre></div><p>make an exe chmod +x hsdpastarter</p><p>and put this&nbsp; /usr/local/hsdpastarter in initialization files.</p><p>I putted in my last file of initialization&nbsp; </p><p>root@OpenWrt:/etc/init.d# cat /etc/init.d/sysctl</p><div class="codebox"><pre><code>#!/bin/sh /etc/rc.common
# Copyright (C) 2006 OpenWrt.org

START=99
start() {
        [ -f /etc/sysctl.conf ] &amp;&amp; sysctl -p &gt;&amp;-
       [b] /usr/local/hsdpastarter[/b]
}</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p67826">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">aoz.syn</div>
					<div class="post-datetime">
						4 May 2008, 22:58					</div>
				</div>
				<div class="post-content content">
					<p>I know you&#039;re talking specifically about 7.09, but trunk has a much-improved &#039;comgt&#039; package that covers just about everything you&#039;ll need for EvDO/HSDPA modems, be they on pcmcia or USB.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p67836">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">againmoon</div>
					<div class="post-datetime">
						5 May 2008, 07:28					</div>
				</div>
				<div class="post-content content">
					<p>Thanks,<br />In effect I considered comgt but here <a href="http://josefsson.org/grisslan/internet.html">http://josefsson.org/grisslan/internet.html</a> it is written<br />&quot;The next step is to get dial-up PPP working. The â€œcomgtï¿½ï¿½&nbsp; package contains several 3G/UMTS scripts that appear to be intended for the WRT54G3G or similar devices. &quot;<br />So I was unsure about the possibility to use it in asus500gp v2 , no documentation.<br />Anyway I will consider comgt, even if I am happy with my solution....<br />thanks</p><p>P.S <span style="color: #FF0000"> comgt</span> refers explicitelly to <span style="color: #FF0000">PCMCIA and datacard&nbsp; HSDPA connection</span> (see for instance <a href="http://www.pharscape.org/content/view/46/70/)">http://www.pharscape.org/content/view/46/70/)</a>. This post concerns <strong>usb modem that are connected to usb router like any other device</strong>. They can be used in a general router such as ASUS wl500GP and they do not need a specific router with PCMCIA for instance.&nbsp; &nbsp; <br />Please tell me if I am wrong....</p>											<p class="post-edited">(Last edited by <strong>againmoon</strong> on 6 May 2008, 07:35)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p67899">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">kultex</div>
					<div class="post-datetime">
						6 May 2008, 22:29					</div>
				</div>
				<div class="post-content content">
					<p>I try to setup a E220 on a Netgear WGT634 - it works only with Kamikaze Kernel 2.6</p><p>1) the E220 needs the kmod-usb-ohci package</p><p>But still it does not recognice the modem correctly:</p><p>my dmesg part concerning usb: </p><p>ohci_hcd: 2006 August 04 USB 1.1 &#039;Open&#039; Host Controller (OHCI) Driver<br />PCI: Enabling device 0000:00:02.0 (0000 -&gt; 0002)<br />PCI: Fixing up device 0000:00:02.0<br />PCI: Setting latency timer of device 0000:00:02.0 to 64<br />ohci_hcd 0000:00:02.0: OHCI Host Controller<br />ohci_hcd 0000:00:02.0: new USB bus registered, assigned bus number 1<br />ohci_hcd 0000:00:02.0: irq 5, io mem 0x40010000<br />eth0.1: add 01:00:5e:00:00:01 mcast address to master interface<br />usb usb1: configuration #1 chosen from 1 choice<br />hub 1-0:1.0: USB hub found<br />hub 1-0:1.0: 1 port detected<br />PCI: Enabling device 0000:00:02.1 (0000 -&gt; 0002)<br />PCI: Fixing up device 0000:00:02.1<br />PCI: Setting latency timer of device 0000:00:02.1 to 64<br />ohci_hcd 0000:00:02.1: OHCI Host Controller<br />ohci_hcd 0000:00:02.1: new USB bus registered, assigned bus number 2<br />ohci_hcd 0000:00:02.1: irq 5, io mem 0x40011000<br />usb usb2: configuration #1 chosen from 1 choice<br />hub 2-0:1.0: USB hub found<br />hub 2-0:1.0: 1 port detected<br />USB Universal Host Controller Interface driver v3.0<br />usbcore: registered new interface driver usbserial<br />drivers/usb/serial/usb-serial.c: USB Serial support registered for generic<br />usbcore: registered new interface driver usbserial_generic<br />drivers/usb/serial/usb-serial.c: USB Serial Driver core<br />usb 1-1: new full speed USB device using ohci_hcd and address 2<br />usb 1-1: configuration #1 chosen from 1 choice</p><p>how do I set vid and pid and maxSize in usbserial - when I do</p><p>root@OpenWrt:~# usbserial vendor=0x12d1 product=0x1003 maxSize=4096<br />-ash: usbserial: not found</p><p>I tried it like described here: <a href="http://josefsson.org/grisslan/internet.html">http://josefsson.org/grisslan/internet.html</a></p><p>I modifyed â€œ/etc/modules.d/60-usb-serialâ€&nbsp; into:<br />usbserial vendor=0x12d1 product=0x1003 maxSize=4096</p><p>nothing changed - do you have any idea</p><p>generally I thought the E220 is recogniced in Kernels bigger than 2.6.19 and also in Kamikaze bigger than 7.06</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p67919">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">againmoon</div>
					<div class="post-datetime">
						7 May 2008, 09:02					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>kultex wrote:</cite><blockquote><p>I try to setup a E220 on a Netgear WGT634 - it works only with Kamikaze Kernel 2.6</p></blockquote></div><p>I do not know wgt634 netgear and I dont&#039;have e220. I know in asus 2.6 can have some problems...<br />i had a quick search but no document, i am sorry</p><div class="quotebox"><blockquote><p>1) the E220 needs the kmod-usb-ohci package</p></blockquote></div><p>This depend on the&nbsp; netgear, generally they use uhci, some ohci, and not depend on E220. see <a href="http://wiki.openwrt.org/UsbStorageHowto?highlight=%28usbstorage%29">http://wiki.openwrt.org/UsbStorageHowto … storage%29</a></p><div class="quotebox"><blockquote><p>But still it does not recognice the modem correctly:</p><p>my dmesg part concerning usb: </p><p>ohci_hcd: 2006 August 04 USB 1.1 &#039;Open&#039; Host Controller (OHCI) Driver<br />PCI: Enabling device 0000:00:02.0 (0000 -&gt; 0002)<br />PCI: Fixing up device 0000:00:02.0<br />PCI: Setting latency timer of device 0000:00:02.0 to 64<br />ohci_hcd 0000:00:02.0: OHCI Host Controller<br />ohci_hcd 0000:00:02.0: new USB bus registered, assigned bus number 1<br />ohci_hcd 0000:00:02.0: irq 5, io mem 0x40010000<br />eth0.1: add 01:00:5e:00:00:01 mcast address to master interface<br />usb usb1: configuration #1 chosen from 1 choice<br />hub 1-0:1.0: USB hub found<br />hub 1-0:1.0: 1 port detected<br />PCI: Enabling device 0000:00:02.1 (0000 -&gt; 0002)<br />PCI: Fixing up device 0000:00:02.1<br />PCI: Setting latency timer of device 0000:00:02.1 to 64<br />ohci_hcd 0000:00:02.1: OHCI Host Controller<br />ohci_hcd 0000:00:02.1: new USB bus registered, assigned bus number 2<br />ohci_hcd 0000:00:02.1: irq 5, io mem 0x40011000<br />usb usb2: configuration #1 chosen from 1 choice<br />hub 2-0:1.0: USB hub found<br />hub 2-0:1.0: 1 port detected<br />USB Universal Host Controller Interface driver v3.0<br />usbcore: registered new interface driver usbserial<br />drivers/usb/serial/usb-serial.c: USB Serial support registered for generic<br />usbcore: registered new interface driver usbserial_generic<br />drivers/usb/serial/usb-serial.c: USB Serial Driver core<br />usb 1-1: new full speed USB device using ohci_hcd and address 2<br />usb 1-1: configuration #1 chosen from 1 choice</p></blockquote></div><p>you cannot do anything if you do not recognize your modemfirst!!!!</p><div class="quotebox"><blockquote><p>how do I set vid and pid and maxSize in usbserial - when I do</p><p>root@OpenWrt:~# usbserial vendor=0x12d1 product=0x1003 maxSize=4096<br />-ash: usbserial: not found</p><p>I tried it like described here: <a href="http://josefsson.org/grisslan/internet.html">http://josefsson.org/grisslan/internet.html</a></p><p>I modifyed â€œ/etc/modules.d/60-usb-serialï¿½ï¿½&nbsp; into:<br />usbserial vendor=0x12d1 product=0x1003 maxSize=4096</p><p>nothing changed - do you have any idea</p></blockquote></div><p>try this<br /><a href="http://wiki.openwrt.org/MobileAPHowTo2#head-ece6773e5331d3d2950af0426714281fb39fd5cf">http://wiki.openwrt.org/MobileAPHowTo2# … 1fb39fd5cf</a></p><div class="quotebox"><blockquote><p>generally I thought the E220 is recogniced in Kernels bigger than 2.6.19 and also in Kamikaze bigger than 7.06</p></blockquote></div><p>I also think so</p>											<p class="post-edited">(Last edited by <strong>againmoon</strong> on 7 May 2008, 09:05)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p67934">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">Rodney</div>
					<div class="post-datetime">
						7 May 2008, 21:35					</div>
				</div>
				<div class="post-content content">
					<p>Hi M8ts <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /><br />I would like to know what software or how do u guys change the code from the wl-500gP v2??<br />Im a learner and i would like to know how u guys flashed the router also...</p><p>Thanks...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p67938">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">aoz.syn</div>
					<div class="post-datetime">
						7 May 2008, 22:05					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>againmoon wrote:</cite><blockquote><p>P.S <span style="color: #FF0000"> comgt</span> refers explicitelly to <span style="color: #FF0000">PCMCIA and datacard&nbsp; HSDPA connection</span> (see for instance <a href="http://www.pharscape.org/content/view/46/70/)">http://www.pharscape.org/content/view/46/70/)</a>. This post concerns <strong>usb modem that are connected to usb router like any other device</strong>. They can be used in a general router such as ASUS wl500GP and they do not need a specific router with PCMCIA for instance.&nbsp; &nbsp; <br />Please tell me if I am wrong....</p></blockquote></div><p>Does it help you to understand that I&#039;m an active contributor to the comgt package in OpenWRT and do this very thing professionally?</p><p>Most 3G modems communicate over USB, whether they plug in via PCMCIA, USB, or ExpressCard.&nbsp; There are very few exceptions.&nbsp; The PCMCIA and ExpressCard devices have an internal USB hub that ends up presenting the radio as a USB-serial device.&nbsp; Everything&#039;s the same, the only thing that changes is the physical connection bus.&nbsp; The comgt package may well specifically reference PCMCIA/Cardbus, but that&#039;s just a documentation shortcoming, as it applies generally.&nbsp; It&#039;s not even just for HSDPA - I submitted the patches (which were applied months back) to make it gracefully handle EvDO connections as well.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p67964">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">againmoon</div>
					<div class="post-datetime">
						8 May 2008, 06:59					</div>
				</div>
				<div class="post-content content">
					<p>Aoz I thank you for your very useful information. I apologize but I dont think, as I underlined, there was enough information, to consider such a solution. Now I know a little be more but, please, I really invite you to post an how to, maybe here, to support people like me. I am not professional but with little more right information May be I could have saved time.</p><p>In effect I think there are more information I would like to have...<br />here <a href="http://josefsson.org/grisslan/internet.html">http://josefsson.org/grisslan/internet.html</a> comgt is used but no HSDPA references are made (packet size in usbserial, max speed settings). This is important if you want to get HSDPA fast connection (I get more than 1300 kb/s on the average and I could max 7200 kb/s, normal UMTS will be at max 400 kb/s).<br />Also pppd options are not shown and neither modem specific AT commands. You need this informations to make your changes. I know you can find on your own and kamikaze is for expert, but my time is for me.....</p><p>This is the motivation I started this how to, where I integrated this <a href="http://wiki.openwrt.org/MobileAPHowTo2#head-ece6773e5331d3d2950af0426714281fb39fd5cf">http://wiki.openwrt.org/MobileAPHowTo2# … 1fb39fd5cf</a> (very good but no comgt information) with my personal experience. </p><p>By the way for me is ok and I got the point. I really will be glad if you could put a&nbsp; howto (great in this thread!) more comgt based. <br />Comgt will be more visible also for usb external modem users.</p><p>Thanks</p>											<p class="post-edited">(Last edited by <strong>againmoon</strong> on 8 May 2008, 07:08)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p67965">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">againmoon</div>
					<div class="post-datetime">
						8 May 2008, 07:31					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Rodney wrote:</cite><blockquote><p>Hi M8ts <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /><br />I would like to know what software or how do u guys change the code from the wl-500gP v2??<br />Im a learner and i would like to know how u guys flashed the router also...</p><p>Thanks...</p></blockquote></div><p>Rodney I am almost a learner. Up to now v2 it is not yet officially supported in openwrt. <br />So there are development versions, trunks. <br />As stated in the howto I used one version that was made by others (here <a href="http://forum.openwrt.org/viewtopic.php?id=14856">http://forum.openwrt.org/viewtopic.php?id=14856</a> you find<br />all information). I flashed it in recovery mode, by using winxp recovery asus utility. Surely there are better methodsbut for me this was fastest.<br />To enter recovery unplug, press recovery button and keep pressed. Plug and keep pressing few secs until power light blinks.</p>											<p class="post-edited">(Last edited by <strong>againmoon</strong> on 8 May 2008, 07:32)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p68004">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">aoz.syn</div>
					<div class="post-datetime">
						9 May 2008, 02:22					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><blockquote><p>I really invite you to post an how to, maybe here, to support people like me. I am not professional but with little more right information May be I could have saved time.</p></blockquote></div><p>I&#039;m not a big HOWTO fan, they become stale all too quickly and are too often sufficiently incorrect so as to draw unsuspecting readers down a long road, only to make them retrace the steps to find the errors.&nbsp; However, I am more than willing to share concepts and some specific experience.</p><div class="quotebox"><blockquote><p>(packet size in usbserial, max speed settings). This is important if you want to get HSDPA fast connection</p></blockquote></div><p>This is precisely the kind of misinformation spread by stale and incorrect documentation.&nbsp; I am looking for the precise code reference that supports this, but here&#039;s the most important point:</p><p><em><strong>- Serial speed settings don&#039;t matter</strong></em></p><p>I have experimentally proven this, <a href="http://mobilesociety.typepad.com/mobile_life/2007/04/are_virtual_com.html">This Guy</a> has proven it, you can prove it too.&nbsp; Simply change your &#039;speed 921600&#039; line to &#039;speed 9600&#039;, dial up, and do a speed test.&nbsp; Unless you are running over a physical UART (not a USB-based device), whatever speed you tell PPP to negotiate is pretty much ignored.</p><p>The second misinformation being spread is that you <span class="bbu">have</span> to increase your buffer (not packet) size in usb-serial.c (or usbserial.c for 2.4 series).&nbsp; While you can, <a href="http://lkml.org/lkml/2006/5/31/237">it&#039;s the wrong place to do it</a>, even though there&#039;s an option to do so.&nbsp; For quite some time now, the drivers have been increasing their buffers from 64 bytes (the problematic size) to 2048 and even 4096 bytes.&nbsp; Here&#039;s the second most important point:</p><p><em><strong>- If your modem is supported directly by the kernel (Sierra, Airprime, IPW, and most Option, Huawei, Audiovox, Novatel, Anydata, and Dell supported by option.c in the 2.6 kernel), you don&#039;t need to mess with buffer sizes - they&#039;re already 4096 bytes.</strong></em></p><p>However, if you have the USB (and PCMCIA if necessary) drivers installed and your modem isn&#039;t recognized by default, you will then probably have to mess with the vendor, product, and buffer parameters to usbserial.&nbsp; At that point, you are using the usbserial driver as a &#039;catch-all&#039; one, and although it is suboptimal it will work.&nbsp; The best way, of course (but not easiest) until the next version is released is to build from scratch.</p><div class="quotebox"><blockquote><p>(I get more than 1300 kb/s on the average and I could max 7200 kb/s, normal UMTS will be at max 400 kb/s)</p></blockquote></div><p>7.2Mbps is the physical specification; expecting to get that is like expecting to get a full 24Mbps out of an ADSL2+ line.&nbsp; Your ISP is the limiting factor, and as long as you get over 1Mbps on an HSDPA or EvDO connection, your configuration is the least of your worries.&nbsp; The only realistic test of the raw speed of your connection is against a server within your own cellular provider&#039;s network, and often not really even then.</p><br /><p>Mostly the comgt package provides is a sane and tested set of PPP and OpenWRT scripts designed to make configuring cellular data connections as painless as possible.&nbsp; Hopefully the next release will come soon and include it, but here are the additional configuration options it currently provides:</p><div class="codebox"><pre><code>config interface &quot;foo&quot;
    option device       &quot;/dev/ttyUSB0&quot;
    option proto        &quot;3g&quot;
    option apn          &quot;my.provider.apn&quot;
    option service      &quot;hsdpa&quot; # or cdma, evdo, umts_only, or gprs_only
    option pincode      &quot;12345&quot;
    option mtu          &quot;1492&quot;</code></pre></div><p>So, here are my two condensed lists, truths and needs:</p><p>Truths:<br /> - Most cellular modems, whether they plug in via PCMCIA, Cardbus, ExpressCard, or direct USB are USB at heart<br /> - Serial speed doesn&#039;t matter<br /> - As long as you have a directly supported device and a kernel less than two years old, you don&#039;t need to mess with buffer sizes<br /> - Actual throughput almost never matches marketed throughput</p><p>Needs:<br /> - For a PCMCIA or Cardbus device, you will need your hardware&#039;s PCMCIA or Cardbus drivers <em>in addition to</em> your USB driver<br /> - For an ExpressCard, the base PCI drivers<br /> - A base USB driver (usually ohci_hcd for Cardbus/PCMCIA/ExpressCard)<br /> - usb-serial (2.6) or usbserial (2.4)<br /> - device-specific driver, if available<br /><em>At this point, if you plug in your device you should see /dev/ttyUSB0 or higher.&nbsp; If you don&#039;t, you are missing a driver or driver option</em><br /> - pppd<br /> - A chat script (there are dozens of examples out there, comgt does provide one that should work for most people)</p>											<p class="post-edited">(Last edited by <strong>aoz.syn</strong> on 9 May 2008, 05:53)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p68111">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">againmoon</div>
					<div class="post-datetime">
						12 May 2008, 07:56					</div>
				</div>
				<div class="post-content content">
					<p>I would like to thank you for the interesting information. Now my idea about connection in general and comgt in particular are much more clear.<br />I will change the howto taking into account your information. Please tell me if anything is wrong.</p><p>thanks</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p68465">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">AndyWhite</div>
					<div class="post-datetime">
						21 May 2008, 00:23					</div>
				</div>
				<div class="post-content content">
					<p>kultex</p><div class="quotebox"><blockquote><p>how do I set vid and pid and maxSize in usbserial - when I do</p><p>root@OpenWrt:~# usbserial vendor=0x12d1 product=0x1003 maxSize=4096<br />-ash: usbserial: not found</p></blockquote></div><p>you need to unload usbserial, try </p><p>rmmod usbserial</p><p>then load it again with the vendor options , try</p><p> insmod usbserial vendor=0x12d1 product=0x1003 maxSize=4096</p><p>double check your vendor and product id&#039;s by;</p><p>lsusb</p><p>FWIW, i have the wgt634u with 7.09 and it using those product id&#039;s, and loading usbserial as above makes it appear as ttyUSB0, without the maxSize=4096 option, you will be limited to ~400kbps , with it I get 2mbps+ , sometimes to 3.2mbps network allowing :-)</p><p>however It disconnects periodically for me , see <a href="http://forum.openwrt.org/viewtopic.php?id=15731">http://forum.openwrt.org/viewtopic.php?id=15731</a></p>											<p class="post-edited">(Last edited by <strong>AndyWhite</strong> on 21 May 2008, 00:26)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p69255">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">doddel</div>
					<div class="post-datetime">
						6 Jun 2008, 17:44					</div>
				</div>
				<div class="post-content content">
					<p>Using the Novatel MC950D USB stick for 3.5G, as provided by Vodafone in Germany, there are some additional peculiarities to consider.<br />This stick upon power-up identifies itself by USB vendor:product 1410:5010 and as such provides a CDROM storage device.<br />After several minutes (with mine after 7 minutes), when left alone, it switches itself to 1410:4400 which is the HSDPA/HSUPA modem.</p><p>Under windows the idea is that some software gets installed from the CDROM and probably that software changes this behaviour.<br />For use in OpenWrt this behaviour is not desirable. (pity of the flash space that remains unused while operating as a modem) </p><p>The switch from CDROM to modem can be forced by issuing an &#039;eject&#039; command to the CDROM. <br />Depending on 2.6 or 2.4 linux compile these are solutions to the problem:</p><p>in &#039;make menuconfig&#039; include the utility &#039;sdparm&#039;. (utilities/disc/sdparm)</p><p>Upon connection of the usb stick issue from &#039;sdparm&#039; the command eject. And gone is the CDROM and there comes the modem ....</p><p>2.6:<br />root@OpenWrt:/# sdparm --command=eject //dev/sg0<br />&nbsp; &nbsp; //dev/sg0: Novatel&nbsp; Mass Storage&nbsp; 1.00&nbsp; [cd/dvd]</p><p>2.4: <br />root@OpenWrt:/# sdparm --command=eject /dev/scsi/host0/bus0/target0/lun0/generic</p><p>Assuming Kamikaze linux 2.4 on the Asus WL400gp v1 (broadcom mini-pci radio) and the presence of sdparm, the following hotplug script will switch the MC950D device to being modem when booting or connecting it:</p><p>---------- //etc/hotplug.d/usb/20-novatel_switch ----------<br />#!/bin/sh</p><p>case &quot;$ACTION&quot; in<br />&nbsp; &nbsp; add)<br />&nbsp; &nbsp; &nbsp; &nbsp; ( //usr/sbin/lsusb | grep -q &#039;1410:5010&#039; ) &amp;&amp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /usr/bin/sdparm --command=eject /dev/scsi/host0/bus0/target0/lun0/generic<br />&nbsp; &nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp; &nbsp; &nbsp; ;;<br />esac</p><p>Of course the problem has been encountered before. This link provides code for a series of G3 adapters.<br /><a href="http://www.draisberghof.de/usb_modeswitch/">http://www.draisberghof.de/usb_modeswitch/</a></p>											<p class="post-edited">(Last edited by <strong>doddel</strong> on 9 Jun 2008, 00:18)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>