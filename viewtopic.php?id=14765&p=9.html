<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Atheros AR7100</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 30 Mar 2018 and 1 May 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 9 of 15</div><nav><ul><li><a href="viewtopic.php%3Fid=14765&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=14765&amp;p=7.html">7</a></li><li><a href="viewtopic.php%3Fid=14765&amp;p=8.html">8</a></li><li class="pagination-current"><span>9</span></li><li><a href="viewtopic.php%3Fid=14765&amp;p=10.html">10</a></li><li><a href="viewtopic.php%3Fid=14765&amp;p=11.html">11</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=14765&amp;p=15.html">15</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p71203">
				<div class="post-metadata">
					<div class="post-num">Post #201</div>
					<div class="post-author">flam</div>
					<div class="post-datetime">
						21 Jul 2008, 15:18					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>acoul wrote:</cite><blockquote><p>what openwrt version are you using?&nbsp; I don&#039;t have this issue on my rb411 and the latest snapshot I posted earlier. I soft rebooted the rb411 10+ times without any problems.</p></blockquote></div><p>I&#039;ve tried it with number6&#039;s patch downloaded from <a href="ftp://ftp.ipeaknetworks.com/ar7100/">ftp://ftp.ipeaknetworks.com/ar7100/</a>. I know it works with RB411 perfectly and also worked with &quot;old&quot; RB433s but now I have new series of RB433s which shows the sympthoms described above. I&#039;m sure Mikrotik uses different SPI NAND driver in their RouterOS than they put into their public patch. Here comes what RouterOS prints about SPI driver:</p><p>FLASH SPI clock 25000 kHz (AHB 150000 kHz / 6)<br />CPLD SPI clock 25000 kHz (AHB 150000 kHz / 6)<br />RB400 spi misc<br />RB400 spi nand</p><p>and here what our driver does:</p><p>RB400 nand<br />NAND SPI clock 25000 kHz (AHB 150000 kHz / 6)<br />FLASH SPI clock 25000 kHz (AHB 150000 kHz / 6)</p><p>I have the following information about RB433&#039;s SPI NAND:<br />- A Xilinx CPLD is connected to the AR7130&#039;s SPI port<br />- The CPLD is connected to a normal (not serial) NAND flash (27US08121A).<br />- The CPLD does the convesion between SPI and NAND flash.<br />- Mikrotik uses &quot;fast&quot; SPI which means 2 DO (data output) lines are used for serial transfer output</p><p>I built a kernel based not on Mikrotik&#039;s patch but original Atheros files and did the same. Currently I have no idea how to get on.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p71205">
				<div class="post-metadata">
					<div class="post-num">Post #202</div>
					<div class="post-author">acoul</div>
					<div class="post-datetime">
						21 Jul 2008, 15:43					</div>
				</div>
				<div class="post-content content">
					<p>thanks for the useful input bitbucket.&nbsp; I will try to put them all together. is there a place to download those patches instead of cut &amp; paste from the mailing list?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p71207">
				<div class="post-metadata">
					<div class="post-num">Post #203</div>
					<div class="post-author">bitbucket</div>
					<div class="post-datetime">
						21 Jul 2008, 15:58					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>acoul wrote:</cite><blockquote><p>thanks for the useful input bitbucket.&nbsp; I will try to put them all together. is there a place to download those patches instead of cut &amp; paste from the mailing list?</p></blockquote></div><p>You may wait for new compat-wireless snapshot...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p71211">
				<div class="post-metadata">
					<div class="post-num">Post #204</div>
					<div class="post-author">acoul</div>
					<div class="post-datetime">
						21 Jul 2008, 18:28					</div>
				</div>
				<div class="post-content content">
					<p>I updated the <a href="http://wifi.ozo.com/airo/openwrt/firmware/kamikaze/2.6/ar7100/">bin images</a> and the <a href="http://wifi.ozo.com/airo/mirror/ar7100/alex/">patches &amp; sources</a>.&nbsp; ath5k works quite stable thanks to bitbucket.&nbsp; I am still unable to use ad-hoc.&nbsp; no locks and crashes.</p>											<p class="post-edited">(Last edited by <strong>acoul</strong> on 21 Jul 2008, 21:07)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p71214">
				<div class="post-metadata">
					<div class="post-num">Post #205</div>
					<div class="post-author">acoul</div>
					<div class="post-datetime">
						21 Jul 2008, 18:38					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>flam wrote:</cite><blockquote><p>I know it works with RB411 perfectly and also worked with &quot;old&quot; RB433s but now I have new series of RB433s which shows the sympthoms described above.</p></blockquote></div><p>any idea what are the differences&nbsp; of the NAND? what bios version the new rb433s have?&nbsp; how about perhaps formating the nand with an older bios firmware? do provide any input about this issue, such as interrupts, dmesg, modules loaded and perhaps even enabling extra debug info on the kernel?</p><p>can you also try my bin images to see if the ethernet works fine?&nbsp; I&#039;ve merged number6 work along with some extra checks for rb411 boards.</p>											<p class="post-edited">(Last edited by <strong>acoul</strong> on 21 Jul 2008, 18:39)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p71239">
				<div class="post-metadata">
					<div class="post-num">Post #206</div>
					<div class="post-author">mtvlv</div>
					<div class="post-datetime">
						22 Jul 2008, 02:48					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>acoul wrote:</cite><blockquote><p>I updated the <a href="http://wifi.ozo.com/airo/openwrt/firmware/kamikaze/2.6/ar7100/">bin images</a> and the <a href="http://wifi.ozo.com/airo/mirror/ar7100/alex/">patches &amp; sources</a>.&nbsp; ath5k works quite stable thanks to bitbucket.&nbsp; I am still unable to use ad-hoc.&nbsp; no locks and crashes.</p></blockquote></div><p>The ethernet do not work in RB450, with elf image. I try to compile: same result.<br />The phy detect is wrong:<br /></p><div class="codebox"><pre><code>ksz_phy: autonegotiation does not completed
AG7100: unit 0 phy is up...Mii 10Mbps full duplex</code></pre></div><p>The MAC is OK (see below)<br />Then, I try compile the trunk ar71xx. This work, but I have only eth0 in port 4 (RB450 eth5) and eth1 in port 0<br />Another bad: that the MAC is wrong<br /></p><div class="codebox"><pre><code>eth0      Link encap:Ethernet  HWaddr 00:BA:DB:AD:BA:D0</code></pre></div><p>The real MAC is 00:0C:42:2E:86:45</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p71244">
				<div class="post-metadata">
					<div class="post-num">Post #207</div>
					<div class="post-author">Kaloz</div>
					<div class="post-datetime">
						22 Jul 2008, 04:39					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>mtvlv wrote:</cite><blockquote><p>Then, I try compile the trunk ar71xx. This work, but I have only eth0 in port 4 (RB450 eth5) and eth1 in port 0<br />Another bad: that the MAC is wrong<br /></p><div class="codebox"><pre><code>eth0      Link encap:Ethernet  HWaddr 00:BA:DB:AD:BA:D0</code></pre></div><p>The real MAC is 00:0C:42:2E:86:45</p></blockquote></div><p>There are only two ethernet interfaces in the CPU, so that&#039;s completely right. If you look at that MAC, you can see it says &quot;bad&quot; all over it -- mac address setting still needs to be added.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p71259">
				<div class="post-metadata">
					<div class="post-num">Post #208</div>
					<div class="post-author">acoul</div>
					<div class="post-datetime">
						22 Jul 2008, 07:16					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>mtvlv wrote:</cite><blockquote><p>The ethernet do not work in RB450, with elf image. I try to compile: same result.<br />The phy detect is wrong:<br /></p><div class="codebox"><pre><code>ksz_phy: autonegotiation does not completed
AG7100: unit 0 phy is up...Mii 10Mbps full duplex</code></pre></div><p>The MAC is OK (see below)</p></blockquote></div><p>can you post the output of the:<br /></p><div class="codebox"><pre><code>cat /proc/cpuinfo</code></pre></div><p>it is great that the ar71xx is finally in the trunk. we should all focus in that tree now. binary images are <a href="http://wifi.ozo.com/airo/openwrt/firmware/kamikaze/2.6/ar71xx/">here</a>.</p><p>had to use the following patch in order to get a proper boot from nand on an rb411:<br /></p><div class="codebox"><pre><code>--- target/linux/ar71xx/config-default  2008-07-22 07:50:51.000000000 +0300
+++ target/linux/ar71xx/config-default-new      2008-07-22 09:05:24.000000000 +0300
@@ -23,7 +23,7 @@
 # CONFIG_BT is not set
 CONFIG_CEVT_R4K=y
 CONFIG_CLASSIC_RCU=y
-CONFIG_CMDLINE=&quot;root=/dev/mtdblock2 rootfstype=squashfs,yaffs,jffs2 noinitrd console=ttyS0,115200 init=/etc/preinit&quot;
+CONFIG_CMDLINE=&quot;root=/dev/mtdblock1 rootfstype=squashfs,yaffs,jffs2 noinitrd console=ttyS0,115200 init=/etc/preinit&quot;
 CONFIG_CPU_BIG_ENDIAN=y
 CONFIG_CPU_HAS_LLSC=y
 CONFIG_CPU_HAS_PREFETCH=y</code></pre></div>											<p class="post-edited">(Last edited by <strong>acoul</strong> on 22 Jul 2008, 09:23)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p71279">
				<div class="post-metadata">
					<div class="post-num">Post #209</div>
					<div class="post-author">mtvlv</div>
					<div class="post-datetime">
						22 Jul 2008, 15:57					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>acoul wrote:</cite><blockquote><p>can you post the output of the: cat /proc/cpuinfo</p></blockquote></div><p>Output from your elf image and from trunk<br /></p><div class="codebox"><pre><code>Linux version 2.6.23.17 (alex@extreme)
system type             : Mikrotik RB450
processor               : 0
cpu model               : MIPS 24K V7.4
BogoMIPS                : 199.47
wait instruction        : yes
microsecond timers      : yes
tlb_entries             : 16
extra interrupt vector  : yes
hardware watchpoint     : yes
ASEs implemented        : mips16
VCED exceptions         : not available
VCEI exceptions         : not available

Linux version 2.6.25.10 (marcos@nwmt) (gcc version 4.1.2) #1 (trunk)
system type             : Atheros AR7130 rev 2 (id:0xa8)
processor               : 0
cpu model               : MIPS 24K V7.4
BogoMIPS                : 199.88
wait instruction        : yes
microsecond timers      : yes
tlb_entries             : 16
extra interrupt vector  : yes
hardware watchpoint     : yes
ASEs implemented        : mips16
shadow register sets    : 1
core                    : 0
VCED exceptions         : not available
VCEI exceptions         : not available</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p71303">
				<div class="post-metadata">
					<div class="post-num">Post #210</div>
					<div class="post-author">acoul</div>
					<div class="post-datetime">
						22 Jul 2008, 21:49					</div>
				</div>
				<div class="post-content content">
					<p>@mtvlv: I think it is best to focus on the ar71xx openwrt trunk now that is officially released.&nbsp; Here is my feedback for the ar71xx 11910 trunk.<br /></p><div class="codebox"><pre><code>ath5k wlan0 down
3 x ping -f -s 65507 192.168.1.1 --&gt; ok</code></pre></div><div class="codebox"><pre><code>ath5k wlan0 up
2 x ping -f -s 65507 192.168.1.1 --&gt; not ok</code></pre></div><p>on second scenario, after a few seconds eth0 stops responding while softirq goes to 100%.&nbsp; bringing the eth0 down brings softirq to 0%. bringing up eth0 takes softirq to 100% while eth0 does respond to pings. removing ath5k does not change this behavior. the following messages are after the problem appears:<br /></p><div class="codebox"><pre><code>cat /proc/interrupts
           CPU0
  2:          0            MIPS  cascade [AR71XX PCI]
  4:   19942958            MIPS  eth0
  6:          0            MIPS  cascade [AR71XX MISC]
  7:      12337            MIPS  timer
 10:          0     AR71XX MISC  cascade [AR71XX GPIO]
 11:       2419     AR71XX MISC  serial
 32:         79     AR71XX PCI   ath

ERR:          0</code></pre></div><div class="codebox"><pre><code>eth0      Link encap:Ethernet  HWaddr 00:0C:42:19:CE:F9
          inet addr:192.168.10.1  Bcast:192.168.10.255  Mask:255.255.255.0
          BROADCAST MULTICAST  MTU:1500  Metric:1
          RX packets:421951 errors:0 dropped:0 overruns:0 frame:0
          TX packets:421707 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:628701585 (599.5 MiB)  TX bytes:628337491 (599.2 MiB)
          Interrupt:4</code></pre></div><div class="codebox"><pre><code>wlan0     Link encap:Ethernet  HWaddr 00:0B:FF:FF:28:1F
          UP BROADCAST MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)</code></pre></div>											<p class="post-edited">(Last edited by <strong>acoul</strong> on 23 Jul 2008, 23:17)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p71381">
				<div class="post-metadata">
					<div class="post-num">Post #211</div>
					<div class="post-author">tiv</div>
					<div class="post-datetime">
						24 Jul 2008, 12:19					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>Tested on a RouterBoard 450 this morning. </p><p>One small problem: for TFTP boot only the leftmost eth connector (next to the serial port) works, but after the linux boot, the righmost connector becomes eth0. I guess I&#039;ll be able to figure this up, seems like a minor issue.</p><p>Otherwise it works absolutely fine. Didn&#039;t stress-test it yet. <br />We plan to use the box on a network with 20-30Mpbs of &quot;background&quot; (not for this box) broad/multicast traffic (very high softirq demand) I&#039;ll report on the results.</p><p>Thanks a lot guys for the good work!</p><p>Tiv</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p71403">
				<div class="post-metadata">
					<div class="post-num">Post #212</div>
					<div class="post-author">acoul</div>
					<div class="post-datetime">
						24 Jul 2008, 21:26					</div>
				</div>
				<div class="post-content content">
					<p>you may find some additional binary packages for this platform <a href="http://wifi.ozo.com/airo/openwrt/packages/mips/">here</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p71503">
				<div class="post-metadata">
					<div class="post-num">Post #213</div>
					<div class="post-author">flam</div>
					<div class="post-datetime">
						28 Jul 2008, 15:50					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>acoul wrote:</cite><blockquote><p>any idea what are the differences&nbsp; of the NAND? what bios version the new rb433s have?&nbsp; how about perhaps formating the nand with an older bios firmware? do provide any input about this issue, such as interrupts, dmesg, modules loaded and perhaps even enabling extra debug info on the kernel?</p><p>can you also try my bin images to see if the ethernet works fine?&nbsp; I&#039;ve merged number6 work along with some extra checks for rb411 boards.</p></blockquote></div><p>No difference between RB411&#039;s and RB433&#039;s NAND chip. They both have BIOS version 2.16. I tried to format NAND but didn&#039;t help. I think only rb400_nand.c, GPIO and SPI registers are involved in this issue. Every other piece of the system (LAN, PCI, etc.) works perfectly while NAND is not accessible. The only side effect is that AR7100 FULL_RESET (see rb400_restart) doesn&#039;t work (it hangs the system) so I was able to reboot RB433 by writing NMI_RESET bit of AR7130. When NAND is not accessible and kernel can&#039;t start init process the system restarts after 5 secs (panic=5). After 1-2 panic reboot RouterBoard&#039;s BIOS gets also not to access NAND and prints the following: </p><p>NAND ERROR: waitStatusReady() timeout (1170 ms), status 00</p><p>That&#039;s all. I gave up investigating this issue and built custom modules for RouterOS&#039;s original 2.6.24.3 kernel (I didn&#039;t recompile the kernel itself) and it works perfectly.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p71681">
				<div class="post-metadata">
					<div class="post-num">Post #214</div>
					<div class="post-author">acoul</div>
					<div class="post-datetime">
						2 Aug 2008, 10:43					</div>
				</div>
				<div class="post-content content">
					<p>@flam: have you tried the openwrt ar71xx trunk?&nbsp; you can find binary images <a href="http://wifi.ozo.com/airo/openwrt/firmware/kamikaze/2.6/ar71xx/">here</a>. latest version is at kernel 2.6.26. can you test and report back here?</p><p>I am having some difficulties getting ath9k compiled for the mips platform. I created a relative ticket <a href="https://dev.openwrt.org/cgi-bin/trac.fcgi/ticket/3816">here</a>.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p71813">
				<div class="post-metadata">
					<div class="post-num">Post #215</div>
					<div class="post-author">qyx</div>
					<div class="post-datetime">
						6 Aug 2008, 03:54					</div>
				</div>
				<div class="post-content content">
					<p>acoul: there is possible error in your latest build (12076) on rb411, kernel is attempting to mount /dev/mtdblock2 as root filesystem</p><div class="codebox"><pre><code>Creating 3 MTD partitions on &quot;NAND 64MiB 3,3V 8-bit&quot;:
0x00040000-0x00400000 : &quot;kernel&quot;
0x00400000-0x04000000 : &quot;rootfs&quot;
mtd: partition &quot;rootfs&quot; set to be root filesystem
split_squashfs: error occured while reading from &quot;NAND 64MiB 3,3V 8-bit&quot;
0x00000000-0x00040000 : &quot;booter&quot;
Atheros AR71xx SPI Controller driver version 0.2.2
Registered led device: rb4xx:yellow:user
TCP vegas registered
NET: Registered protocol family 17
end_request: I/O error, dev mtdblock2, sector 0
SQUASHFS error: sb_bread failed reading block 0x0
yaffs: dev is 32505858 name is &quot;mtdblock2&quot;
yaffs: passed flags &quot;&quot;
yaffs: Attempting MTD mount on 31.2, &quot;mtdblock2&quot;
VFS: Mounted root (yaffs filesystem) readonly.
Freeing unused kernel memory: 124k freed
Please be patient, while OpenWrt loads ...
Failed to execute /etc/preinit.  Attempting defaults...
Kernel panic - not syncing: No init found.  Try passing init= option to kernel.</code></pre></div><p>last working build is 11932 (with kernel 2.6.25.11), but there is another problem with madwifi while the card is running in master mode</p><p>after doing &quot;wlanconfig ath0 create wlandev wifi0 wlanmode ap &amp;&amp; ifconfig ath0 up&quot; the whole thing starts to respond very slow<br />output from serial console:</p><div class="codebox"><pre><code>wifi0: ath_fatal_tasklet: Hardware error; resetting.
wifi0: ath_fatal_tasklet: Hardware error; resetting.</code></pre></div><p>about two such lines per second</p>											<p class="post-edited">(Last edited by <strong>qyx</strong> on 6 Aug 2008, 04:33)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p71819">
				<div class="post-metadata">
					<div class="post-num">Post #216</div>
					<div class="post-author">acoul</div>
					<div class="post-datetime">
						6 Aug 2008, 08:47					</div>
				</div>
				<div class="post-content content">
					<p>I created a ticket about this <a href="https://dev.openwrt.org/cgi-bin/trac.fcgi/ticket/3852">here</a>.&nbsp; I will prepare a new patched binary image with latest ath5k today.&nbsp; note that adhoc has some issues on ath5k. I wonder if this issue is also present on rb433/450.</p><p>@qyx: what wifi card are you using? there is a chip hardware bug for the ar71xx platform and 802.11a/b/g wifi cards. until a new closed-hal madwifi-ng comes out you can only use ath5k.</p>											<p class="post-edited">(Last edited by <strong>acoul</strong> on 6 Aug 2008, 09:03)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p71861">
				<div class="post-metadata">
					<div class="post-num">Post #217</div>
					<div class="post-author">qyx</div>
					<div class="post-datetime">
						6 Aug 2008, 23:41					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>acoul wrote:</cite><blockquote><p>@qyx: what wifi card are you using?</p></blockquote></div><p>it is wistron cm10 (dcma-81) a/b/g with AR5006XS chipset</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p71873">
				<div class="post-metadata">
					<div class="post-num">Post #218</div>
					<div class="post-author">acoul</div>
					<div class="post-datetime">
						7 Aug 2008, 06:38					</div>
				</div>
				<div class="post-content content">
					<p>@qyx: you may give a try to <a href="http://wifi.ozo.com/airo/openwrt/firmware/kamikaze/2.6/ar71xx/12204/">this</a> one. you can test ath5k and madwifi-ng as this is a gcc-3.4.6 image.&nbsp; you can even test the new ath9k if you have an atheros 802.11n wifi card.</p>											<p class="post-edited">(Last edited by <strong>acoul</strong> on 7 Aug 2008, 06:49)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p71982">
				<div class="post-metadata">
					<div class="post-num">Post #219</div>
					<div class="post-author">paulCutler</div>
					<div class="post-datetime">
						8 Aug 2008, 20:27					</div>
				</div>
				<div class="post-content content">
					<p>I am a bit new to this area of openwrt.&nbsp; I am trying to build openwrt from trunk for use on the RB433. When I run &quot;make menuconfig&quot; I do not get the AR71xx option available under the &quot;Target Systems&quot; menu to select this platform. </p><p>I have gone in a removed the &quot;broken&quot; tag from the FEATURE statement in the makefile and now the the target is available as an option:<br />trunk/target/linux/ar71xx/Makefile<br />FEATURES:=squashfs tgz broken&nbsp; &lt;- remove the &quot;broken&quot; tag</p><p>Now it is available. Is this the right approach?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p71995">
				<div class="post-metadata">
					<div class="post-num">Post #220</div>
					<div class="post-author">acoul</div>
					<div class="post-datetime">
						8 Aug 2008, 23:19					</div>
				</div>
				<div class="post-content content">
					<p>on &quot;make menuconfig&quot; select the advanced options and within that menu select the &quot;show broken platforms&quot;. the reason it is under &quot;broken platforms&quot; is that it has not been tested thoroughly yet, not that it is actually broken.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p72007">
				<div class="post-metadata">
					<div class="post-num">Post #221</div>
					<div class="post-author">paulCutler</div>
					<div class="post-datetime">
						9 Aug 2008, 05:05					</div>
				</div>
				<div class="post-content content">
					<p>I was able to get openwrt (trunk) running on my RB433 boards (thanks acoul). I would like to see if someone can confirm the steps that I used to ensure that this is the correct approach. I would be happy to put together a wiki page that could be used to help others get started. Please let me know if this is the approach that you are all using. In addition I have an issue with the Ethernet ports that I post below:</p><p>1. Download trunk, make menuconfig, on advanced settings select &quot;show broken platforms&quot; <br />2. Target System select &quot;Atheros AR71xx[2.6]&quot;<br />3. Target Images select &quot;ramdisk&quot;<br />3. Run make -&gt; produces the image &quot;openwrt-ar71xx-vmlinux.elf&quot;<br />4. Setup bootp network boot environment (I would be happy to post my dnsmasq setup)<br />5. Power up the device and enter the bios <br />&nbsp; &nbsp;a. formand NAND flash<br />&nbsp; &nbsp;b. select boot from ethernet (this will download and run the ramdisk defined above)<br />6. Run make menuconfig and set the Target Image to tgz and run make<br />7. scp the new images [kernel (openwrt-ar71xx-vmlinux.elf) and rootfs (openwrt-ar71xx-rootfs.tgz)] into /tmp on the device<br />8. Install the kernel<br />&nbsp; &nbsp;a. mount /dev/mtdblock1 /mnt<br />&nbsp; &nbsp;b. mv /tmp/openwrt-ar71xx-vmlinux.elf /mnt<br />&nbsp; &nbsp;c. umount /mnt<br />9. Install the root file system<br />&nbsp; &nbsp;a. mount /dev/mtdblock2 /mnt<br />&nbsp; &nbsp;b. cd /mnt<br />&nbsp; &nbsp;c. tar xzvf /tmp/openwrt-ar71xx-rootfs.tgz<br />&nbsp; &nbsp;d. umount /mnt<br />10. reboot -&gt; enter bios and select boot from NAND</p><p>Much of this was taken from how I loaded the RC133c using the wiki page. Although the wget2nand is much more complicated, which is why (although this seems to work) I feel like I am doing something wrong.</p><p>In addition it seems that there are only 2 Ethernet ports, although the device has 3 Ethernet ports. I also loaded the images from (<a href="http://wifi.ozo.com/airo/openwrt/firmware/kamikaze/2.6/ar71xx/12204/">http://wifi.ozo.com/airo/openwrt/firmwa … 1xx/12204/</a>) and got the same result (2 Ethernet ports)</p><p>Looking at the platform.c file from /arch/mips/ar71xx/ it looks like only eth0 and eth1 are being setup. Not sure if I am missing something. I would be happy to look at updating those files if someone could provide some guidance. </p><p>Thanks for the great work everyone!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p72010">
				<div class="post-metadata">
					<div class="post-num">Post #222</div>
					<div class="post-author">acoul</div>
					<div class="post-datetime">
						9 Aug 2008, 07:32					</div>
				</div>
				<div class="post-content content">
					<p>@paulCutler: can you post the output of the &quot;dmesg&quot; &amp; &quot;cat /proc/interrupts&quot;?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p72118">
				<div class="post-metadata">
					<div class="post-num">Post #223</div>
					<div class="post-author">paulCutler</div>
					<div class="post-datetime">
						11 Aug 2008, 15:43					</div>
				</div>
				<div class="post-content content">
					<p>****************************************************************<br />**********&nbsp; &nbsp; Output of dmesg:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *************<br />****************************************************************<br /> |&nbsp; &nbsp; &nbsp; &nbsp;|.-----.-----.-----.|&nbsp; |&nbsp; |&nbsp; |.----.|&nbsp; |_<br /> |&nbsp; &nbsp;-&nbsp; &nbsp;||&nbsp; _&nbsp; |&nbsp; -__|&nbsp; &nbsp; &nbsp;||&nbsp; |&nbsp; |&nbsp; ||&nbsp; &nbsp;_||&nbsp; &nbsp;_|<br /> |_______||&nbsp; &nbsp;__|_____|__|__||________||__|&nbsp; |____|<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |__| W I R E L E S S&nbsp; &nbsp;F R E E D O M<br /> KAMIKAZE (bleeding edge, r12245) -------------------<br />&nbsp; * 10 oz Vodka&nbsp; &nbsp; &nbsp; &nbsp;Shake well with ice and strain<br />&nbsp; * 10 oz Triple sec&nbsp; mixture into 10 shot glasses.<br />&nbsp; * 10 oz lime juice&nbsp; Salute!<br /> ---------------------------------------------------<br />root@model75:/# dmesg<br />Linux version 2.6.26.2 (gm2311@luke) (gcc version 4.1.2) #1 Fri Aug 8 21:21:33 EDT 2008<br />prom: fw_arg0=00000007, fw_arg1=a0861c00, fw_arg2=00000000, fw_arg3=00000000<br />prom: routerboot envp[0]: console=ttyS0,115200<br />prom: routerboot envp[1]: gpio=4031<br />prom: routerboot envp[2]: HZ=150000000<br />prom: routerboot envp[3]: mem=64M<br />prom: routerboot envp[4]: kmac=00:0C:42:21:F7:41<br />prom: routerboot envp[5]: board=433<br />prom: routerboot envp[6]: boot=0<br />prom_init:124 arcs_cmdline:&#039;root=/dev/mtdblock2 rootfstype=squashfs,yaffs,jffs2 noinitrd console=ttyS0,115200 init=/et&#039;<br />prom_init:124 boot_command_line:&#039;&#039;<br />console [early0] enabled<br />CPU revision is: 00019374 (MIPS 24K)<br />plat_mem_setup:218 arcs_cmdline:&#039;root=/dev/mtdblock2 rootfstype=squashfs,yaffs,jffs2 noinitrd console=ttyS0,115200 ini&#039;<br />plat_mem_setup:218 boot_command_line:&#039;&#039;<br />Determined physical RAM map:<br /> memory: 04000000 @ 00000000 (usable)<br />Entering add_active_range(0, 0, 16384) 0 entries of 256 used<br />Initrd not found or empty - disabling initrd<br />Zone PFN ranges:<br />&nbsp; Normal&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 -&gt;&nbsp; &nbsp; 16384<br />Movable zone start PFN for each node<br />early_node_map[1] active PFN ranges<br />&nbsp; &nbsp; 0:&nbsp; &nbsp; &nbsp; &nbsp; 0 -&gt;&nbsp; &nbsp; 16384<br />On node 0 totalpages: 16384<br />&nbsp; Normal zone: 128 pages used for memmap<br />&nbsp; Normal zone: 0 pages reserved<br />&nbsp; Normal zone: 16256 pages, LIFO batch:3<br />&nbsp; Movable zone: 0 pages used for memmap<br />Built 1 zonelists in Zone order, mobility grouping on.&nbsp; Total pages: 16256<br />Kernel command line: root=/dev/mtdblock2 rootfstype=squashfs,yaffs,jffs2 noinitrd console=ttyS0,115200 init=/etc/preint<br />Primary instruction cache 64kB, VIPT, 4-way, linesize 32 bytes.<br />Primary data cache 32kB, 4-way, VIPT, cache aliases, linesize 32 bytes<br />Writing ErrCtl register=00000800<br />Readback ErrCtl register=00000800<br />PID hash table entries: 256 (order: 8, 1024 bytes)<br />Dentry cache hash table entries: 8192 (order: 3, 32768 bytes)<br />Inode-cache hash table entries: 4096 (order: 2, 16384 bytes)<br />Memory: 62140k/65536k available (1820k kernel code, 3328k reserved, 326k data, 128k init, 0k highmem)<br />SLUB: Genslabs=6, HWalign=32, Order=0-3, MinObjects=0, CPUs=1, Nodes=1<br />Calibrating delay loop... 199.88 BogoMIPS (lpj=999424)<br />Mount-cache hash table entries: 512<br />net_namespace: 484 bytes<br />NET: Registered protocol family 16<br />ar71xx_machine_setup:354 arcs_cmdline:&#039;root=/dev/mtdblock2 rootfstype=squashfs,yaffs,jffs2 noinitrd console=ttyS0,1152&#039;<br />ar71xx_machine_setup:354 boot_command_line:&#039;root=/dev/mtdblock2 rootfstype=squashfs,yaffs,jffs2 noinitrd console=ttyS0&#039;<br />MIPS: machine is MikroTik RouterBOARD 433/AH<br />registering PCI controller with io_map_base unset<br />NET: Registered protocol family 2<br />Switched to high resolution mode on CPU 0<br />IP route cache hash table entries: 1024 (order: 0, 4096 bytes)<br />TCP established hash table entries: 2048 (order: 2, 16384 bytes)<br />TCP bind hash table entries: 2048 (order: 1, 8192 bytes)<br />TCP: Hash tables configured (established 2048 bind 2048)<br />TCP reno registered<br />NET: Registered protocol family 1<br />squashfs: version 3.0 (2006/03/15) Phillip Lougher<br />Registering mini_fo version $Id$<br />JFFS2 version 2.2. (NAND) (SUMMARY)&nbsp; Â© 2001-2006 Red Hat, Inc.<br />yaffs Aug&nbsp; 8 2008 21:19:07 Installing.<br />msgmni has been set to 121<br />io scheduler noop registered<br />io scheduler deadline registered (default)<br />Serial: 8250/16550 driver $Revision: 1.90 $ 1 ports, IRQ sharing disabled<br />serial8250.0: ttyS0 at MMIO 0x18020000 (irq = 11) is a 16550A<br />console handover: boot [early0] -&gt; real [ttyS0]<br />ag71xx_mdio: probed<br />eth0: Atheros AG71xx at 0xba000000, irq 5<br />eth0: connected to PHY at 0:04 [uid=02430d80, driver=Generic PHY]<br />eth1: Atheros AG71xx at 0xb9000000, irq 4<br />eth1: connected to multiple PHYs (2)<br />NAND flash driver for RouterBoard 4xx series version 0.1.10<br />NAND SPI clock 25000 kHz (AHB 150000 kHz / 6)<br />FLASH SPI clock 25000 kHz (AHB 150000 kHz / 6)<br />NAND device: Manufacturer ID: 0xad, Chip ID: 0x76 (Hynix NAND 64MiB 3,3V 8-bit)<br />Scanning device for bad blocks<br />Bad eraseblock 2164 at 0x021d0000<br />Creating 3 MTD partitions on &quot;NAND 64MiB 3,3V 8-bit&quot;:<br />0x00000000-0x00040000 : &quot;booter&quot;<br />0x00040000-0x00400000 : &quot;kernel&quot;<br />0x00400000-0x04000000 : &quot;rootfs&quot;<br />mtd: partition &quot;rootfs&quot; set to be root filesystem<br />split_squashfs: no squashfs found in &quot;NAND 64MiB 3,3V 8-bit&quot;<br />Atheros AR71xx SPI Controller driver version 0.2.2<br />Registered led device: rb4xx:yellow:user<br />nf_conntrack version 0.5.0 (1024 buckets, 4096 max)<br />ip_tables: (C) 2000-2006 Netfilter Core Team<br />TCP vegas registered<br />NET: Registered protocol family 17<br />Bridge firewalling registered<br />802.1Q VLAN Support v1.8 Ben Greear &lt;greearb@candelatech.com&gt;<br />All bugs added by David S. Miller &lt;davem@redhat.com&gt;<br />yaffs: dev is 32505858 name is &quot;mtdblock2&quot;<br />yaffs: passed flags &quot;&quot;<br />yaffs: Attempting MTD mount on 31.2, &quot;mtdblock2&quot;<br />nand_erase: attempt to erase a bad block at page 0x00010e80<br />**&gt;&gt; Erasure failed 1909<br />yaffs: marking block 1908 bad&lt;4&gt;**&gt;&gt; Block 1909 retired<br />VFS: Mounted root (yaffs filesystem) readonly.<br />Freeing unused kernel memory: 128k freed<br />Please be patient, while OpenWrt loads ...<br />Algorithmics/MIPS FPU Emulator v1.5<br />br-lan: Dropping NETIF_F_UFO since no NETIF_F_HW_CSUM feature.<br />device eth0 entered promiscuous mode<br />PPP generic driver version 2.4.2<br />tun: Universal TUN/TAP device driver, 1.6<br />tun: (C) 1999-2004 Max Krasnyansky &lt;maxk@qualcomm.com&gt;<br />arp_tables: (C) 2002 David S. Miller<br />Ebtables v2.0 registered<br />wlan: trunk<br />ath_hal: module license &#039;Proprietary&#039; taints kernel.<br />ath_hal: 0.10.5.6 (AR5210, AR5211, AR5212, AR5416, RF5111, RF5112, RF2413, RF5413, RF2133, RF2425, RF2417, REGOPS_FUNC)<br />ath_rate_minstrel: Minstrel automatic rate control algorithm 1.2 (trunk)<br />ath_rate_minstrel: look around rate set to 10%<br />ath_rate_minstrel: EWMA rolloff level set to 75%<br />ath_rate_minstrel: max segment size in the mrr set to 6000 us<br />wlan: mac acl policy registered<br />ath_pci: trunk<br />gpio-buttons driver version 0.1.1<br />eth0: link up (100Mbps/Full duplex)<br />br-lan: port 1(eth0) entering learning state<br />br-lan: topology change detected, propagating<br />br-lan: port 1(eth0) entering forwarding state<br />device tap0 entered promiscuous mode<br />br-lan: port 2(tap0) entering learning state<br />br-lan: topology change detected, propagating<br />br-lan: port 2(tap0) entering forwarding state<br />eth1: link up (100Mbps/Full duplex)<br />device eth1 entered promiscuous mode<br />****************************************************************<br />**********&nbsp; &nbsp; Output of &gt;cat /proc/interrupts&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*************<br />****************************************************************</p><p>cat /proc/interrupts<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;CPU0<br />&nbsp; 2:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; MIPS&nbsp; cascade [AR71XX PCI]<br />&nbsp; 4:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; MIPS&nbsp; eth1<br />&nbsp; 5:&nbsp; &nbsp; &nbsp; &nbsp; 324&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; MIPS&nbsp; eth0<br />&nbsp; 6:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; MIPS&nbsp; cascade [AR71XX MISC]<br />&nbsp; 7:&nbsp; &nbsp; &nbsp; 36143&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; MIPS&nbsp; timer<br /> 10:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;AR71XX MISC&nbsp; cascade [AR71XX GPIO]<br /> 11:&nbsp; &nbsp; &nbsp; &nbsp; 532&nbsp; &nbsp; &nbsp;AR71XX MISC&nbsp; serial</p><p>ERR:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0<br />************************************************************</p><p>Let me know if there is anything else I can provide, and thanks for the help.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p72129">
				<div class="post-metadata">
					<div class="post-num">Post #224</div>
					<div class="post-author">acoul</div>
					<div class="post-datetime">
						11 Aug 2008, 17:36					</div>
				</div>
				<div class="post-content content">
					<div class="codebox"><pre><code>eth1: connected to multiple PHYs (2)</code></pre></div><p>it looks like there are only two ethernet chips.&nbsp; eth1 is connected to multiple PHYs, something like a hub? you should be able to set an IP for eth1 and ping it from both the other two ethernet ports. I don&#039;t have such a hardware so I can&#039;t help you any further.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p72142">
				<div class="post-metadata">
					<div class="post-num">Post #225</div>
					<div class="post-author">paulCutler</div>
					<div class="post-datetime">
						11 Aug 2008, 20:19					</div>
				</div>
				<div class="post-content content">
					<p>I did notice that in the dmesg information. I will look into this in a little more detail and post anything that I find. </p><p>Some interesting things to consider:<br /> * The board has 3 NIC Addresses on the label <br /> * All of the documentation defines this as a 3 x Ethernet port device</p><p>I would be happy to send you (acoul) a unit to play with (or donate one to the openWRT team). You can email me your address directly if you are interested, let me know. </p><p>Thanks again and I will let you know what I find.</p>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 9 of 15</div><nav><ul><li><a href="viewtopic.php%3Fid=14765&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=14765&amp;p=7.html">7</a></li><li><a href="viewtopic.php%3Fid=14765&amp;p=8.html">8</a></li><li class="pagination-current"><span>9</span></li><li><a href="viewtopic.php%3Fid=14765&amp;p=10.html">10</a></li><li><a href="viewtopic.php%3Fid=14765&amp;p=11.html">11</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=14765&amp;p=15.html">15</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0.001 -->

</body>
</html>