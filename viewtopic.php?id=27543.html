<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Netgear WNDR3700 - WLAN with WAN access only</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 6 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p122324">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">boser</div>
					<div class="post-datetime">
						1 Dec 2010, 04:47					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ve installed OpenWrt Backfire 10.03 on a WNDR3700. I&#039;ve created two SSIDs on both radios; they are working fine.</p><p>Now I would like to restrict access for one of the SSIDs (unencrypted) to the WAN only (i.e. no LAN access). Although I have found information on the forum on how to do this for a WRT54, I have not been able to port this solution to the WNDR3700 and would appreciate suggestions.</p><p>My configuration files are appended.</p><p>Many thanks,<br />Bernhard</p><div class="quotebox"><cite>/etc/conf/wireless wrote:</cite><blockquote><p>config &#039;wifi-device&#039; &#039;radio0&#039;<br />&nbsp; &nbsp; option &#039;type&#039; &#039;mac80211&#039;<br />&nbsp; &nbsp; option &#039;macaddr&#039; &#039;30:46:9a:f9:a6:a2&#039;<br />&nbsp; &nbsp; option &#039;hwmode&#039; &#039;11ng&#039;<br />&nbsp; &nbsp; option &#039;htmode&#039; &#039;HT20&#039;<br />&nbsp; &nbsp; list &#039;ht_capab&#039; &#039;SHORT-GI-40&#039;<br />&nbsp; &nbsp; list &#039;ht_capab&#039; &#039;DSSS_CCK-40&#039;<br />&nbsp; &nbsp; option &#039;disabled&#039; &#039;0&#039;<br />&nbsp; &nbsp; option &#039;channel&#039; &#039;11&#039;<br />&nbsp; &nbsp; option &#039;country&#039; &#039;US&#039;</p><p>config &#039;wifi-iface&#039;<br />&nbsp; &nbsp; option &#039;device&#039; &#039;radio0&#039;<br />&nbsp; &nbsp; option &#039;mode&#039; &#039;ap&#039;<br />&nbsp; &nbsp; option &#039;ssid&#039; &#039;TPA-Secure&#039;<br />&nbsp; &nbsp; option &#039;encryption&#039; &#039;psk2&#039;<br />&nbsp; &nbsp; option &#039;key&#039; &#039;supersecret&#039;<br />&nbsp; &nbsp; option &#039;network&#039; &#039;wifisecure&#039;</p><p>config &#039;wifi-device&#039; &#039;radio1&#039;<br />&nbsp; &nbsp; option &#039;type&#039; &#039;mac80211&#039;<br />&nbsp; &nbsp; option &#039;channel&#039; &#039;36&#039;<br />&nbsp; &nbsp; option &#039;macaddr&#039; &#039;30:46:9a:f9:a6:a4&#039;<br />&nbsp; &nbsp; option &#039;hwmode&#039; &#039;11na&#039;<br />&nbsp; &nbsp; option &#039;country&#039; &#039;US&#039;<br />&nbsp; &nbsp; option &#039;htmode&#039; &#039;HT20&#039;<br />&nbsp; &nbsp; list &#039;ht_capab&#039; &#039;SHORT-GI-40&#039;<br />&nbsp; &nbsp; list &#039;ht_capab&#039; &#039;DSSS_CCK-40&#039;<br />&nbsp; &nbsp; list &#039;ht_capab&#039; &#039;HT40+&#039;<br />&nbsp; &nbsp; list &#039;ht_capab&#039; &#039;HT40-&#039;<br />&nbsp; &nbsp; option &#039;disabled&#039; &#039;0&#039;</p><p>config &#039;wifi-iface&#039;<br />&nbsp; &nbsp; option &#039;device&#039; &#039;radio1&#039;<br />&nbsp; &nbsp; option &#039;mode&#039; &#039;ap&#039;<br />&nbsp; &nbsp; option &#039;ssid&#039; &#039;TPA-5G-Secure&#039;<br />&nbsp; &nbsp; option &#039;encryption&#039; &#039;psk2&#039;<br />&nbsp; &nbsp; option &#039;key&#039; &#039;supersecret&#039;<br />&nbsp; &nbsp; option &#039;network&#039; &#039;wifisecure&#039;</p><p>config &#039;wifi-iface&#039;<br />&nbsp; &nbsp; option &#039;device&#039; &#039;radio0&#039;<br />&nbsp; &nbsp; option &#039;ssid&#039; &#039;TPA&#039;<br />&nbsp; &nbsp; option &#039;mode&#039; &#039;ap&#039;<br />&nbsp; &nbsp; option &#039;encryption&#039; &#039;none&#039;<br />&nbsp; &nbsp; option &#039;network&#039; &#039;wifi&#039;</p><p>config &#039;wifi-iface&#039;<br />&nbsp; &nbsp; option &#039;device&#039; &#039;radio1&#039;<br />&nbsp; &nbsp; option &#039;ssid&#039; &#039;TPA-5G&#039;<br />&nbsp; &nbsp; option &#039;network&#039; &#039;wifi&#039;<br />&nbsp; &nbsp; option &#039;mode&#039; &#039;ap&#039;<br />&nbsp; &nbsp; option &#039;encryption&#039; &#039;none&#039;</p></blockquote></div><div class="quotebox"><cite>/etc/conf/network wrote:</cite><blockquote><p>config &#039;interface&#039; &#039;loopback&#039;<br />&nbsp; &nbsp; option &#039;ifname&#039; &#039;lo&#039;<br />&nbsp; &nbsp; option &#039;proto&#039; &#039;static&#039;<br />&nbsp; &nbsp; option &#039;ipaddr&#039; &#039;127.0.0.1&#039;<br />&nbsp; &nbsp; option &#039;netmask&#039; &#039;255.0.0.0&#039;</p><p>config &#039;interface&#039; &#039;lan&#039;<br />&nbsp; &nbsp; option &#039;ifname&#039; &#039;eth0.1&#039;<br />&nbsp; &nbsp; option &#039;type&#039; &#039;bridge&#039;<br />&nbsp; &nbsp; option &#039;proto&#039; &#039;static&#039;<br />&nbsp; &nbsp; option &#039;ipaddr&#039; &#039;10.0.1.1&#039;<br />&nbsp; &nbsp; option &#039;netmask&#039; &#039;255.255.255.0&#039;</p><p>config &#039;interface&#039; &#039;dmz&#039;<br />&nbsp; &nbsp; option &#039;ifname&#039; &#039;eth0.2&#039;<br />&nbsp; &nbsp; option &#039;type&#039; &#039;bridge&#039;<br />&nbsp; &nbsp; option &#039;proto&#039; &#039;static&#039;<br />&nbsp; &nbsp; option &#039;ipaddr&#039; &#039;10.0.2.1&#039;<br />&nbsp; &nbsp; option &#039;netmask&#039; &#039;255.255.255.0&#039;</p><p>config &#039;interface&#039; &#039;wifi&#039;<br />&nbsp; &nbsp; option &#039;proto&#039; &#039;static&#039;<br />&nbsp; &nbsp; option &#039;ipaddr&#039; &#039;10.0.3.1&#039;<br />&nbsp; &nbsp; option &#039;netmask&#039; &#039;255.255.255.0&#039;<br />&nbsp; &nbsp; option &#039;ifname&#039; &#039;br-wifi&#039;<br />&nbsp; &nbsp; option &#039;defaultroute&#039; &#039;0&#039;<br />&nbsp; &nbsp; option &#039;peerdns&#039; &#039;0&#039;</p><p>config &#039;interface&#039; &#039;wifisecure&#039;<br />&nbsp; &nbsp; option &#039;ifname&#039; &#039;eth0.4&#039;<br />&nbsp; &nbsp; option &#039;type&#039; &#039;bridge&#039;<br />&nbsp; &nbsp; option &#039;proto&#039; &#039;static&#039;<br />&nbsp; &nbsp; option &#039;ipaddr&#039; &#039;10.0.4.1&#039;<br />&nbsp; &nbsp; option &#039;netmask&#039; &#039;255.255.255.0&#039;</p><p>config &#039;interface&#039; &#039;wan&#039;<br />&nbsp; &nbsp; option &#039;ifname&#039; &#039;eth1&#039;<br />&nbsp; &nbsp; option &#039;proto&#039; &#039;dhcp&#039;</p><p>config &#039;switch&#039;<br />&nbsp; &nbsp; option &#039;name&#039; &#039;rtl8366s&#039;<br />&nbsp; &nbsp; option &#039;reset&#039; &#039;1&#039;<br />&nbsp; &nbsp; option &#039;enable_vlan&#039; &#039;1&#039;<br />&nbsp; &nbsp; option &#039;blinkrate&#039; &#039;2&#039;</p><p>config &#039;switch_vlan&#039;<br />&nbsp; &nbsp; option &#039;device&#039; &#039;rtl8366s&#039;<br />&nbsp; &nbsp; option &#039;vlan&#039; &#039;0&#039;<br />&nbsp; &nbsp; option &#039;ports&#039; &#039;5*&#039;</p><p>config &#039;switch_vlan&#039;<br />&nbsp; &nbsp; option &#039;device&#039; &#039;rtl8366s&#039;<br />&nbsp; &nbsp; option &#039;vlan&#039; &#039;1&#039;<br />&nbsp; &nbsp; option &#039;ports&#039; &#039;1 2 3 5t&#039;</p><p>config &#039;switch_vlan&#039;<br />&nbsp; &nbsp; option &#039;device&#039; &#039;rtl8366s&#039;<br />&nbsp; &nbsp; option &#039;vlan&#039; &#039;2&#039;<br />&nbsp; &nbsp; option &#039;ports&#039; &#039;0 5t&#039;</p><p>config &#039;switch_port&#039;<br />&nbsp; &nbsp; option &#039;device&#039; &#039;rtl8366s&#039;<br />&nbsp; &nbsp; option &#039;port&#039; &#039;1&#039;<br />&nbsp; &nbsp; option &#039;led&#039; &#039;9&#039;</p><p>config &#039;switch_port&#039;<br />&nbsp; &nbsp; option &#039;device&#039; &#039;rtl8366s&#039;<br />&nbsp; &nbsp; option &#039;port&#039; &#039;2&#039;<br />&nbsp; &nbsp; option &#039;led&#039; &#039;6&#039;</p><p>config &#039;switch_port&#039;<br />&nbsp; &nbsp; option &#039;device&#039; &#039;rtl8366s&#039;<br />&nbsp; &nbsp; option &#039;port&#039; &#039;5&#039;<br />&nbsp; &nbsp; option &#039;led&#039; &#039;6&#039;</p></blockquote></div><div class="quotebox"><cite>/etc/conf/firewall wrote:</cite><blockquote><p>config &#039;defaults&#039;<br />&nbsp; &nbsp; option &#039;syn_flood&#039; &#039;1&#039;<br />&nbsp; &nbsp; option &#039;input&#039; &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option &#039;output&#039; &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option &#039;forward&#039; &#039;REJECT&#039;</p><p>config &#039;zone&#039;<br />&nbsp; &nbsp; option &#039;name&#039; &#039;wan&#039;<br />&nbsp; &nbsp; option &#039;input&#039; &#039;REJECT&#039;<br />&nbsp; &nbsp; option &#039;output&#039; &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option &#039;forward&#039; &#039;REJECT&#039;<br />&nbsp; &nbsp; option &#039;masq&#039; &#039;1&#039;<br />&nbsp; &nbsp; option &#039;mtu_fix&#039; &#039;1&#039;</p><p>config &#039;zone&#039;<br />&nbsp; &nbsp; option &#039;name&#039; &#039;lan&#039;<br />&nbsp; &nbsp; option &#039;input&#039; &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option &#039;output&#039; &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option &#039;forward&#039; &#039;REJECT&#039;</p><p>config &#039;forwarding&#039;<br />&nbsp; &nbsp; option &#039;src&#039; &#039;lan&#039;<br />&nbsp; &nbsp; option &#039;dest&#039; &#039;wan&#039;</p><p>config &#039;rule&#039;<br />&nbsp; &nbsp; option &#039;src&#039; &#039;wan&#039;<br />&nbsp; &nbsp; option &#039;proto&#039; &#039;udp&#039;<br />&nbsp; &nbsp; option &#039;dest_port&#039; &#039;68&#039;<br />&nbsp; &nbsp; option &#039;target&#039; &#039;ACCEPT&#039;</p><p>config &#039;rule&#039;<br />&nbsp; &nbsp; option &#039;src&#039; &#039;wan&#039;<br />&nbsp; &nbsp; option &#039;proto&#039; &#039;icmp&#039;<br />&nbsp; &nbsp; option &#039;icmp_type&#039; &#039;echo-request&#039;<br />&nbsp; &nbsp; option &#039;target&#039; &#039;ACCEPT&#039;</p><p>config &#039;redirect&#039;<br />&nbsp; &nbsp; option &#039;src&#039; &#039;wan&#039;<br />&nbsp; &nbsp; option &#039;_name&#039; &#039;http&#039;<br />&nbsp; &nbsp; option &#039;proto&#039; &#039;tcp&#039;<br />&nbsp; &nbsp; option &#039;src_dport&#039; &#039;80&#039;<br />&nbsp; &nbsp; option &#039;dest_ip&#039; &#039;10.0.2.2&#039;</p><p>config &#039;zone&#039;<br />&nbsp; &nbsp; option &#039;name&#039; &#039;dmz&#039;<br />&nbsp; &nbsp; option &#039;input&#039; &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option &#039;output&#039; &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option &#039;forward&#039; &#039;REJECT&#039;</p><p>config &#039;zone&#039;<br />&nbsp; &nbsp; option &#039;name&#039; &#039;wifisecure&#039;<br />&nbsp; &nbsp; option &#039;input&#039; &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option &#039;output&#039; &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option &#039;forward&#039; &#039;REJECT&#039;</p><p>config &#039;include&#039;<br />&nbsp; &nbsp; option &#039;path&#039; &#039;/etc/firewall.user&#039;&nbsp; #empty right now</p></blockquote></div><div class="quotebox"><cite>/etc/conf/dhcp wrote:</cite><blockquote><p>config &#039;dnsmasq&#039;<br />&nbsp; &nbsp; option &#039;domainneeded&#039; &#039;1&#039;<br />&nbsp; &nbsp; option &#039;boguspriv&#039; &#039;1&#039;<br />&nbsp; &nbsp; option &#039;filterwin2k&#039; &#039;0&#039;<br />&nbsp; &nbsp; option &#039;localise_queries&#039; &#039;1&#039;<br />&nbsp; &nbsp; option &#039;local&#039; &#039;/lan/&#039;<br />&nbsp; &nbsp; option &#039;domain&#039; &#039;lan&#039;<br />&nbsp; &nbsp; option &#039;expandhosts&#039; &#039;1&#039;<br />&nbsp; &nbsp; option &#039;nonegcache&#039; &#039;0&#039;<br />&nbsp; &nbsp; option &#039;authoritative&#039; &#039;1&#039;<br />&nbsp; &nbsp; option &#039;readethers&#039; &#039;1&#039;<br />&nbsp; &nbsp; option &#039;leasefile&#039; &#039;/tmp/dhcp.leases&#039;<br />&nbsp; &nbsp; option &#039;resolvfile&#039; &#039;/tmp/resolv.conf.auto&#039;</p><p>config &#039;dhcp&#039; &#039;lan&#039;<br />&nbsp; &nbsp; option &#039;interface&#039; &#039;lan&#039;<br />&nbsp; &nbsp; option &#039;start&#039; &#039;100&#039;<br />&nbsp; &nbsp; option &#039;leasetime&#039; &#039;12h&#039;<br />&nbsp; &nbsp; option &#039;limit&#039; &#039;50&#039;</p><p>config &#039;dhcp&#039; &#039;wan&#039;<br />&nbsp; &nbsp; option &#039;interface&#039; &#039;wan&#039;<br />&nbsp; &nbsp; option &#039;ignore&#039; &#039;1&#039;<br />&nbsp; &nbsp; option &#039;dynamicdhcp&#039; &#039;0&#039;</p><p>config &#039;dhcp&#039; &#039;dmz&#039;<br />&nbsp; &nbsp; option &#039;interface&#039; &#039;dmz&#039;<br />&nbsp; &nbsp; option &#039;start&#039; &#039;100&#039;<br />&nbsp; &nbsp; option &#039;limit&#039; &#039;5&#039;<br />&nbsp; &nbsp; option &#039;leasetime&#039; &#039;12h&#039;</p><p>config &#039;dhcp&#039;<br />&nbsp; &nbsp; option &#039;interface&#039; &#039;wifi&#039;<br />&nbsp; &nbsp; option &#039;start&#039; &#039;100&#039;<br />&nbsp; &nbsp; option &#039;limit&#039; &#039;50&#039;<br />&nbsp; &nbsp; option &#039;leasetime&#039; &#039;12h&#039;</p><p>config &#039;dhcp&#039;<br />&nbsp; &nbsp; option &#039;interface&#039; &#039;wifisecure&#039;<br />&nbsp; &nbsp; option &#039;start&#039; &#039;100&#039;<br />&nbsp; &nbsp; option &#039;limit&#039; &#039;50&#039;<br />&nbsp; &nbsp; option &#039;leasetime&#039; &#039;12h&#039;</p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p122754">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">Goofball</div>
					<div class="post-datetime">
						7 Dec 2010, 03:10					</div>
				</div>
				<div class="post-content content">
					<p>First: Make a backup of your current working config and know how to get into failsafe mode if the VLAN setup flips out. I spent several days playing around to get everything on my WNDR3700 tweaked the way I wanted it and ran into network failures due to VLAN config issues several times.</p><p>Failsafe mode info: <a href="http://wiki.openwrt.org/oldwiki/OpenWrtDocs/Troubleshooting">http://wiki.openwrt.org/oldwiki/OpenWrt … leshooting</a> and <a href="https://forum.openwrt.org/viewtopic.php?id=8705">https://forum.openwrt.org/viewtopic.php?id=8705</a> - I used the &#039;recvupd&#039; method so I can&#039;t vouch for the forum post working on the WNDR3700.</p><p>To make what you have now work you will need to add the following vlans to /etc/config/network and fix the &#039;wifi&#039; network entry like so:<br /></p><div class="codebox"><pre><code>config &#039;interface&#039; &#039;wifi&#039;
    option &#039;ifname&#039; &#039;eth0.3&#039;
    option &#039;proto&#039; &#039;static&#039;
    option &#039;ipaddr&#039; &#039;10.0.3.1&#039;
    option &#039;netmask&#039; &#039;255.255.255.0&#039;
    option &#039;defaultroute&#039; &#039;0&#039;
    option &#039;peerdns&#039; &#039;0&#039;

...

config &#039;switch_vlan&#039;
    option &#039;device&#039; &#039;rtl8366s&#039;
    option &#039;vlan&#039; &#039;3&#039;
    option &#039;ports&#039; &#039;5t&#039;

config &#039;switch_vlan&#039;
    option &#039;device&#039; &#039;rtl8366s&#039;
    option &#039;vlan&#039; &#039;4&#039;
    option &#039;ports&#039; &#039;5t&#039;</code></pre></div><p>Your /etc/config/firewall setup should have a zone for the &#039;wifi&#039; vlan and you need to set up explicit forwarding rules between &#039;wifi&#039;&lt;-&gt;&#039;wan&#039; and &#039;wifisecure&#039;&lt;-&gt;&#039;wan&#039;:<br /></p><div class="codebox"><pre><code>config &#039;zone&#039;
    option &#039;name&#039; &#039;wifi&#039;
    option &#039;input&#039; &#039;ACCEPT&#039;
    option &#039;output&#039; &#039;ACCEPT&#039;
    option &#039;forward&#039; &#039;REJECT&#039;

config &#039;forwarding&#039;
    option &#039;src&#039; &#039;wifi&#039;
    option &#039;dest&#039; &#039;wan&#039;

config &#039;forwarding&#039;
    option &#039;src&#039; &#039;wifisecure&#039;
    option &#039;dest&#039; &#039;wan&#039;</code></pre></div><p><strong>NOTE:</strong> With the setup as it is at this point your &#039;wifi&#039; and &#039;wifisecure&#039; networks/vlans will have access only to the internet. If your intent was to set up &#039;wifisecure&#039; to have access to your local LAN as well you would need to remove the &#039;wifisecure&#039; network, firewall and dhcp entries and change /etc/config/wireless to:</p><div class="codebox"><pre><code>config &#039;wifi-iface&#039;
    option &#039;device&#039; &#039;radio0&#039;
    option &#039;mode&#039; &#039;ap&#039;
    option &#039;ssid&#039; &#039;TPA-Secure&#039;
    option &#039;encryption&#039; &#039;psk2&#039;
    option &#039;key&#039; &#039;supersecret&#039;
    option &#039;network&#039; &#039;lan&#039;

...

config &#039;wifi-iface&#039;
    option &#039;device&#039; &#039;radio1&#039;
    option &#039;mode&#039; &#039;ap&#039;
    option &#039;ssid&#039; &#039;TPA-5G-Secure&#039;
    option &#039;encryption&#039; &#039;psk2&#039;
    option &#039;key&#039; &#039;supersecret&#039;
    option &#039;network&#039; &#039;lan&#039;</code></pre></div><p>otherwise you will need to set up firewall forwarding between the VLANs along the lines of <a href="http://wiki.openwrt.org/doc/howto/dmz">http://wiki.openwrt.org/doc/howto/dmz</a>.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p122764">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">boser</div>
					<div class="post-datetime">
						7 Dec 2010, 08:59					</div>
				</div>
				<div class="post-content content">
					<p>Tried and ran into problems: radios bound to interface &#039;wifi&#039; do not get assigned an ip address by the dhcp server.</p><p>Adding the rules below to the firewall does not fix the problem:</p><div class="codebox"><pre><code># Allow wifi to use the router as a DNS server
config &#039;rule&#039;
        option &#039;src&#039; &#039;wifi&#039;
        option &#039;proto&#039; &#039;tcpudp&#039;
        option &#039;dest_port&#039; &#039;53&#039;
        option &#039;target&#039; &#039;ACCEPT&#039;

# Allow wifi to use the router as DHCP server
config &#039;rule&#039;
        option &#039;src&#039; &#039;wifi&#039;
        option &#039;proto&#039; &#039;udp&#039;
        option &#039;dest_port&#039; &#039;67&#039;
        option &#039;target&#039; &#039;ACCEPT&#039;</code></pre></div><p>Any ideas what could be wrong?</p><p>Many thanks,<br />Bernhard</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p122786">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">Goofball</div>
					<div class="post-datetime">
						7 Dec 2010, 17:24					</div>
				</div>
				<div class="post-content content">
					<p>Wifi interface in /etc/config/network needs to be set as a &#039;bridge&#039; interface:</p><div class="codebox"><pre><code>config &#039;interface&#039; &#039;wifi&#039;
    option &#039;ifname&#039; &#039;eth0.3&#039;
    option &#039;proto&#039; &#039;static&#039;
    option &#039;ipaddr&#039; &#039;10.0.3.1&#039;
    option &#039;netmask&#039; &#039;255.255.255.0&#039;
    option &#039;defaultroute&#039; &#039;0&#039;
    option &#039;peerdns&#039; &#039;0&#039;
    option &#039;type&#039; &#039;bridge&#039;</code></pre></div><p>I didn&#039;t realize that &quot;option &#039;type&#039; &#039;bridge&#039;&quot; was missing until I re-read it. Without bridging the traffic will never make it from the wifi interface to the cpu interface for processing/dhcp/forwarding/etc. Those firewall rules should be unneccesary with the wifi zone set up as default accept for input and output.</p>											<p class="post-edited">(Last edited by <strong>Goofball</strong> on 7 Dec 2010, 17:37)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p122828">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">boser</div>
					<div class="post-datetime">
						8 Dec 2010, 07:42					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Goofball wrote:</cite><blockquote><p>Wifi interface in /etc/config/network needs to be set as a &#039;bridge&#039; interface:</p><div class="codebox"><pre><code>config &#039;interface&#039; &#039;wifi&#039;
    option &#039;ifname&#039; &#039;eth0.3&#039;
    option &#039;proto&#039; &#039;static&#039;
    option &#039;ipaddr&#039; &#039;10.0.3.1&#039;
    option &#039;netmask&#039; &#039;255.255.255.0&#039;
    option &#039;defaultroute&#039; &#039;0&#039;
    option &#039;peerdns&#039; &#039;0&#039;
    option &#039;type&#039; &#039;bridge&#039;</code></pre></div><p>I didn&#039;t realize that &quot;option &#039;type&#039; &#039;bridge&#039;&quot; was missing until I re-read it. Without bridging the traffic will never make it from the wifi interface to the cpu interface for processing/dhcp/forwarding/etc. Those firewall rules should be unneccesary with the wifi zone set up as default accept for input and output.</p></blockquote></div><p>Now wifi has access to both the LAN and the WAN.</p><p>My DMZ works fine, i.e. port 4 of the switch (part of the router) connects only to the WAN. I did this by defining the dmz as an un-bridged network eth0.2 and then defining a switch_vlan for vlan2 with ports &#039;0 5t&#039;. I wonder if the same would be possible for interface &#039;wifi&#039;, but am not sure how to define the ports. &#039;radio0&#039; does not appear to be a valid port.</p><p>Bernhard</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p122831">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">Goofball</div>
					<div class="post-datetime">
						8 Dec 2010, 08:26					</div>
				</div>
				<div class="post-content content">
					<p>Can you post current copies of your /etc/config/network, /etc/config/wireless and /etc/config/firewall?</p><p>Also, when you are testing make sure that you ping something other than the router IPs when you are checking for access between the VLANs. I&#039;ve noticed that no matter what the policies/vlans/etc. are configured as in the router that you can ping any of the IPs assigned to eth0.X interfaces from any network and get a response. IE: my main network is 192.168.1.X and the router interface is 192.168.1.1, DMZ is 192.168.2.X and router is 192.168.2.1. I can ping and open the webif at 192.168.1.1 from a client or server on 192.168.2.X and get a response no matter what the firewall policies are. Same for pinging/webif from clients on 192.168.1.X to 192.168.2.1. </p><p>I can&#039;t get from a client/server on 192.168.1.X to a client/server on 192.168.2.X and vice versa without explicit firewall rules. It&#039;s only the router interface addresses that behave this way. I haven&#039;t taken the time to really dig into it to figure out why it behaves this way. This may be due to some configuration setting(s) I&#039;m missing that need to be changed or added to stop this, maybe someone else can chime in here... I was running DD-WRT before this and it behaved the same way.</p>											<p class="post-edited">(Last edited by <strong>Goofball</strong> on 8 Dec 2010, 18:38)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p122888">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">boser</div>
					<div class="post-datetime">
						9 Dec 2010, 00:59					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Goofball wrote:</cite><blockquote><p>Can you post current copies of your /etc/config/network, /etc/config/wireless and /etc/config/firewall?</p><p>Also, when you are testing make sure that you ping something other than the router IPs when you are checking for access between the VLANs. I&#039;ve noticed that no matter what the policies/vlans/etc. are configured as in the router that you can ping any of the IPs assigned to eth0.X interfaces from any network and get a response. IE: my main network is 192.168.1.X and the router interface is 192.168.1.1, DMZ is 192.168.2.X and router is 192.168.2.1. I can ping and open the webif at 192.168.1.1 from a client or server on 192.168.2.X and get a response no matter what the firewall policies are. Same for pinging/webif from clients on 192.168.1.X to 192.168.2.1. </p><p>I can&#039;t get from a client/server on 192.168.1.X to a client/server on 192.168.2.X and vice versa without explicit firewall rules. It&#039;s only the router interface addresses that behave this way. I haven&#039;t taken the time to really dig into it to figure out why it behaves this way. This may be due to some configuration setting(s) I&#039;m missing that need to be changed or added to stop this, maybe someone else can chime in here... I was running DD-WRT before this and it behaved the same way.</p></blockquote></div><p>Here they are ...</p><p>Thanks,<br />Bernhard</p><p>/etc/config/network<br /></p><div class="codebox"><pre><code>config &#039;interface&#039; &#039;loopback&#039;
    option &#039;ifname&#039; &#039;lo&#039;
    option &#039;proto&#039; &#039;static&#039;
    option &#039;ipaddr&#039; &#039;127.0.0.1&#039;
    option &#039;netmask&#039; &#039;255.0.0.0&#039;

# lan (vlan1)
config &#039;interface&#039; &#039;lan&#039;
    option &#039;ifname&#039; &#039;eth0.1&#039;
    option &#039;type&#039; &#039;bridge&#039;
    option &#039;proto&#039; &#039;static&#039;
    option &#039;ipaddr&#039; &#039;10.0.1.1&#039;
    option &#039;netmask&#039; &#039;255.255.255.0&#039;

# dmz (vlan2)
config &#039;interface&#039; &#039;dmz&#039;
    option &#039;ifname&#039; &#039;eth0.2&#039;
    option &#039;proto&#039; &#039;static&#039;
    option &#039;ipaddr&#039; &#039;10.0.2.1&#039;
    option &#039;netmask&#039; &#039;255.255.255.0&#039;

# wifi (vlan3)
config &#039;interface&#039; &#039;wifi&#039;
    option &#039;ifname&#039; &#039;eth0.3&#039;
    option &#039;type&#039; &#039;bridge&#039;
    option &#039;proto&#039; &#039;static&#039;
    option &#039;ipaddr&#039; &#039;10.0.3.1&#039;
    option &#039;netmask&#039; &#039;255.255.255.0&#039;
    option &#039;defaultroute&#039; &#039;0&#039;
    option &#039;peerdns&#039; &#039;0&#039;

config &#039;interface&#039; &#039;wan&#039;
    option &#039;ifname&#039; &#039;eth1&#039;
    option &#039;proto&#039; &#039;dhcp&#039;

config &#039;switch&#039;
    option &#039;name&#039; &#039;rtl8366s&#039;
    option &#039;reset&#039; &#039;1&#039;
    option &#039;enable_vlan&#039; &#039;1&#039;
    option &#039;blinkrate&#039; &#039;2&#039;

config &#039;switch_vlan&#039;
    option &#039;device&#039; &#039;rtl8366s&#039;
    option &#039;vlan&#039; &#039;0&#039;
    option &#039;ports&#039; &#039;5*&#039;

# switch ports 1-3 --&gt; vlan1 (lan)
config &#039;switch_vlan&#039;
    option &#039;device&#039; &#039;rtl8366s&#039;
    option &#039;vlan&#039; &#039;1&#039;
    option &#039;ports&#039; &#039;1 2 3 5t&#039;

# switch port  0 (4 on box) --&gt; vlan2 (wan only)
config &#039;switch_vlan&#039;
    option &#039;device&#039; &#039;rtl8366s&#039;
    option &#039;vlan&#039; &#039;2&#039;
    option &#039;ports&#039; &#039;0 5t&#039;

# vlan3 (only connected to cpu)
config &#039;switch_vlan&#039;
    option &#039;device&#039; &#039;rtl8366s&#039;
    option &#039;vlan&#039; &#039;3&#039;
    option &#039;ports&#039; &#039;5t&#039;

config &#039;switch_port&#039;
    option &#039;device&#039; &#039;rtl8366s&#039;
    option &#039;port&#039; &#039;1&#039;
    option &#039;led&#039; &#039;9&#039;

config &#039;switch_port&#039;
    option &#039;device&#039; &#039;rtl8366s&#039;
    option &#039;port&#039; &#039;2&#039;
    option &#039;led&#039; &#039;6&#039;

config &#039;switch_port&#039;
    option &#039;device&#039; &#039;rtl8366s&#039;
    option &#039;port&#039; &#039;5&#039;
    option &#039;led&#039; &#039;6&#039;</code></pre></div><p>/etc/config/wireless<br /></p><div class="codebox"><pre><code>config &#039;wifi-device&#039; &#039;radio0&#039;
    option &#039;type&#039; &#039;mac80211&#039;
    option &#039;macaddr&#039; &#039;30:46:9a:f9:a6:a2&#039;
    option &#039;hwmode&#039; &#039;11ng&#039;
    option &#039;htmode&#039; &#039;HT20&#039;
    list &#039;ht_capab&#039; &#039;SHORT-GI-40&#039;
    list &#039;ht_capab&#039; &#039;DSSS_CCK-40&#039;
    option &#039;disabled&#039; &#039;0&#039;
    option &#039;channel&#039; &#039;11&#039;
    option &#039;country&#039; &#039;US&#039;

config &#039;wifi-iface&#039;
    option &#039;device&#039; &#039;radio0&#039;
    option &#039;mode&#039; &#039;ap&#039;
    option &#039;ssid&#039; &#039;TPA-Secure&#039;
    option &#039;encryption&#039; &#039;psk2&#039;
    option &#039;key&#039; &#039;what&#039;
    option &#039;network&#039; &#039;lan&#039;

config &#039;wifi-iface&#039;
    option &#039;device&#039; &#039;radio0&#039;
    option &#039;mode&#039; &#039;ap&#039;
    option &#039;ssid&#039; &#039;TPA&#039;
    option &#039;encryption&#039; &#039;psk2&#039;
    option &#039;key&#039; &#039;very_secret&#039;
    option &#039;network&#039; &#039;wifi&#039;

config &#039;wifi-device&#039; &#039;radio1&#039;
    option &#039;type&#039; &#039;mac80211&#039;
    option &#039;channel&#039; &#039;36&#039;
    option &#039;macaddr&#039; &#039;30:46:9a:f9:a6:a4&#039;
    option &#039;hwmode&#039; &#039;11na&#039;
    option &#039;country&#039; &#039;US&#039;
    list &#039;ht_capab&#039; &#039;SHORT-GI-40&#039;
    list &#039;ht_capab&#039; &#039;DSSS_CCK-40&#039;
    list &#039;ht_capab&#039; &#039;HT40+&#039;
    list &#039;ht_capab&#039; &#039;HT40-&#039;
    option &#039;disabled&#039; &#039;0&#039;
    option &#039;htmode&#039; &#039;HT40+&#039;

config &#039;wifi-iface&#039;
    option &#039;device&#039; &#039;radio1&#039;
    option &#039;mode&#039; &#039;ap&#039;
    option &#039;encryption&#039; &#039;psk2&#039;
    option &#039;key&#039; &#039;secret&#039;
    option &#039;network&#039; &#039;lan&#039;
    option &#039;ssid&#039; &#039;TPA-5G-Secure&#039;</code></pre></div><p>/etc/config/firewall<br /></p><div class="codebox"><pre><code>config &#039;defaults&#039;
    option &#039;syn_flood&#039; &#039;1&#039;
    option &#039;input&#039; &#039;ACCEPT&#039;
    option &#039;output&#039; &#039;ACCEPT&#039;
    option &#039;forward&#039; &#039;REJECT&#039;

config &#039;zone&#039;
    option &#039;name&#039; &#039;wan&#039;
    option &#039;input&#039; &#039;REJECT&#039;
    option &#039;output&#039; &#039;ACCEPT&#039;
    option &#039;forward&#039; &#039;REJECT&#039;
    option &#039;masq&#039; &#039;1&#039;
    option &#039;mtu_fix&#039; &#039;1&#039;

config &#039;zone&#039;
    option &#039;name&#039; &#039;lan&#039;
    option &#039;input&#039; &#039;ACCEPT&#039;
    option &#039;output&#039; &#039;ACCEPT&#039;
    option &#039;forward&#039; &#039;REJECT&#039;

config &#039;forwarding&#039;
    option &#039;src&#039; &#039;lan&#039;
    option &#039;dest&#039; &#039;wan&#039;

config &#039;rule&#039;
    option &#039;src&#039; &#039;wan&#039;
    option &#039;proto&#039; &#039;udp&#039;
    option &#039;dest_port&#039; &#039;68&#039;
    option &#039;target&#039; &#039;ACCEPT&#039;

config &#039;rule&#039;
    option &#039;src&#039; &#039;wan&#039;
    option &#039;proto&#039; &#039;icmp&#039;
    option &#039;icmp_type&#039; &#039;echo-request&#039;
    option &#039;target&#039; &#039;ACCEPT&#039;

config &#039;redirect&#039;
    option &#039;src&#039; &#039;wan&#039;
    option &#039;_name&#039; &#039;http&#039;
    option &#039;proto&#039; &#039;tcp&#039;
    option &#039;src_dport&#039; &#039;80&#039;
    option &#039;dest_ip&#039; &#039;10.0.2.2&#039;

# Reject traffic from DMZ
config &#039;zone&#039;
    option &#039;name&#039; &#039;dmz&#039;
    option &#039;input&#039; &#039;REJECT&#039;
    option &#039;output&#039; &#039;ACCEPT&#039;
    option &#039;forward&#039; &#039;REJECT&#039;

# Allow DMZ to use the router as a DNS server
config &#039;rule&#039;
    option &#039;src&#039; &#039;dmz&#039;
    option &#039;proto&#039; &#039;tcpudp&#039;
    option &#039;dest_port&#039; &#039;53&#039;
    option &#039;target&#039; &#039;ACCEPT&#039;

# Allow the DMZ to use the router as DHCP server
config &#039;rule&#039;
    option &#039;src&#039; &#039;dmz&#039;
    option &#039;proto&#039; &#039;udp&#039;
    option &#039;dest_port&#039; &#039;67&#039;
    option &#039;target&#039; &#039;ACCEPT&#039;

# Allow the DMZ to access the internet
config &#039;forwarding&#039;
    option &#039;src&#039; &#039;dmz&#039;
    option &#039;dest&#039; &#039;wan&#039;

# Allow the LAN to access the DMZ
config &#039;forwarding&#039;
    option &#039;src&#039; &#039;lan&#039;
    option &#039;dest&#039; &#039;dmz&#039;

# Zone wifi has WAN access only
config &#039;zone&#039;
    option &#039;name&#039; &#039;wifi&#039;
    option &#039;input&#039; &#039;ACCEPT&#039;
    option &#039;output&#039; &#039;ACCEPT&#039;
    option &#039;forward&#039; &#039;REJECT&#039;

# Allow wifi to use the router as a DNS server
config &#039;rule&#039;
    option &#039;src&#039; &#039;wifi&#039;
    option &#039;proto&#039; &#039;tcpudp&#039;
    option &#039;dest_port&#039; &#039;53&#039;
    option &#039;target&#039; &#039;ACCEPT&#039;

# Allow wifi to use the router as DHCP server
config &#039;rule&#039;
    option &#039;src&#039; &#039;wifi&#039;
    option &#039;proto&#039; &#039;udp&#039;
    option &#039;dest_port&#039; &#039;67&#039;
    option &#039;target&#039; &#039;ACCEPT&#039;

# Allow &#039;wifi&#039; to access the WAN
config &#039;forwarding&#039;
    option &#039;src&#039; &#039;wifi&#039;
    option &#039;dest&#039; &#039;wan&#039;

config &#039;include&#039;
    option &#039;path&#039; &#039;/etc/firewall.user&#039;</code></pre></div><p>/etc/config/dhcp<br /></p><div class="codebox"><pre><code>config &#039;dnsmasq&#039;
    option &#039;domainneeded&#039; &#039;1&#039;
    option &#039;boguspriv&#039; &#039;1&#039;
    option &#039;filterwin2k&#039; &#039;0&#039;
    option &#039;localise_queries&#039; &#039;1&#039;
    option &#039;local&#039; &#039;/lan/&#039;
    option &#039;domain&#039; &#039;lan&#039;
    option &#039;expandhosts&#039; &#039;1&#039;
    option &#039;nonegcache&#039; &#039;0&#039;
    option &#039;authoritative&#039; &#039;1&#039;
    option &#039;readethers&#039; &#039;1&#039;
    option &#039;leasefile&#039; &#039;/tmp/dhcp.leases&#039;
    option &#039;resolvfile&#039; &#039;/tmp/resolv.conf.auto&#039;

config &#039;dhcp&#039; &#039;lan&#039;
    option &#039;interface&#039; &#039;lan&#039;
    option &#039;start&#039; &#039;100&#039;
    option &#039;leasetime&#039; &#039;12h&#039;
    option &#039;limit&#039; &#039;50&#039;

config &#039;dhcp&#039; &#039;dmz&#039;
    option &#039;interface&#039; &#039;dmz&#039;
    option &#039;start&#039; &#039;100&#039;
    option &#039;limit&#039; &#039;50&#039;
    option &#039;leasetime&#039; &#039;12h&#039;

config &#039;dhcp&#039; &#039;wifi&#039;
    option &#039;interface&#039; &#039;wifi&#039;
    option &#039;start&#039; &#039;100&#039;
    option &#039;limit&#039; &#039;50&#039;
    option &#039;leasetime&#039; &#039;12h&#039;

config &#039;dhcp&#039; &#039;wan&#039;
    option &#039;interface&#039; &#039;wan&#039;
    option &#039;ignore&#039; &#039;1&#039;
    option &#039;dynamicdhcp&#039; &#039;0&#039;

config &#039;host&#039;
    option &#039;name&#039; &#039;router&#039;
    option &#039;mac&#039; &#039;30:46:9A:F9:A6:A2&#039;
    option &#039;ip&#039; &#039;10.0.1.1&#039;

config &#039;host&#039;
    option &#039;name&#039; &#039;router-wan&#039;
    option &#039;mac&#039; &#039;30:46:9A:F9:A6:A3&#039;

config &#039;host&#039;
    option &#039;ip&#039; &#039;10.0.1.5&#039;
    option &#039;mac&#039; &#039;00:20:4A:12:3F:C8&#039;
    option &#039;name&#039; &#039;lantronix&#039;</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p123073">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">Goofball</div>
					<div class="post-datetime">
						12 Dec 2010, 01:42					</div>
				</div>
				<div class="post-content content">
					<p>I would bet if you plug a DHCP enabled device into your DMZ ethernet port it won&#039;t pick up an address. I tested this in several different configurations during the week and without the eth0.X VLAN interfaces set to &#039;bridge&#039; in /etc/config/network DHCP wouldn&#039;t work on the individual networks for me.</p><p>Like I said in my earlier post I am still able to ping/http/etc. from any device on the LAN, DMZ and GUEST networks to any of the other router interface IPs but traffic doesn&#039;t travel from VLAN to VLAN past that without explicit rules/forwards. IE: IP 192.168.3.103 on GUEST can ping/access 192.168.1.1, 192.168.2.1 and 192.168.3.1 but can not ping/access DMZ server 192.168.2.2 or LAN client 192.168.1.92.</p><p>I&#039;ve attached my current configs to give you an idea of what is working for me now. DHCP for my LAN VLAN network runs on a different server. I&#039;ve also removed some port forwards and other rules I&#039;d rather not post for the world to see. Also note that I am running a recent trunk build (r24373) that includes the firewall-2 package, thus the &#039;family&#039; &#039;ipv4/ipv6&#039; statements in /etc/config/firewall to control where they end up. One other spot you should check is that you don&#039;t have anything strange flushing iptables rules or making major changes in /etc/firewall.user</p><p>/etc/config/network:<br /></p><div class="codebox"><pre><code>config &#039;interface&#039; &#039;loopback&#039;
        option &#039;ifname&#039; &#039;lo&#039;
        option &#039;proto&#039; &#039;static&#039;
        option &#039;ipaddr&#039; &#039;127.0.0.1&#039;
        option &#039;netmask&#039; &#039;255.0.0.0&#039;

config &#039;interface&#039; &#039;lan&#039;
        option &#039;ifname&#039; &#039;eth0.1&#039;
        option &#039;type&#039; &#039;bridge&#039;
        option &#039;proto&#039; &#039;static&#039;
        option &#039;netmask&#039; &#039;255.255.255.0&#039;
        option &#039;stp&#039; &#039;1&#039;
        option &#039;defaultroute&#039; &#039;0&#039;
        option &#039;peerdns&#039; &#039;0&#039;
        option &#039;ipaddr&#039; &#039;192.168.1.1&#039;
        option &#039;ip6addr&#039; &#039;XXXX:1::1/64&#039;

config &#039;interface&#039; &#039;dmz&#039;
        option &#039;ifname&#039; &#039;eth0.2&#039;
        option &#039;type&#039; &#039;bridge&#039;
        option &#039;proto&#039; &#039;static&#039;
        option &#039;netmask&#039; &#039;255.255.255.0&#039;
        option &#039;stp&#039; &#039;1&#039;
        option &#039;defaultroute&#039; &#039;0&#039;
        option &#039;peerdns&#039; &#039;0&#039;
        option &#039;ipaddr&#039; &#039;192.168.2.1&#039;
        option &#039;ip6addr&#039; &#039;XXXX:2::1/64&#039;

config &#039;interface&#039; &#039;guest&#039;
        option &#039;ifname&#039; &#039;eth0.3&#039;
        option &#039;type&#039; &#039;bridge&#039;
        option &#039;proto&#039; &#039;static&#039;
        option &#039;netmask&#039; &#039;255.255.255.0&#039;
        option &#039;stp&#039; &#039;1&#039;
        option &#039;defaultroute&#039; &#039;0&#039;
        option &#039;peerdns&#039; &#039;0&#039;
        option &#039;ipaddr&#039; &#039;192.168.3.1&#039;
        option &#039;ip6addr&#039; &#039;XXXX:3::1/64&#039;

config &#039;interface&#039; &#039;wan&#039;
        option &#039;ifname&#039; &#039;eth1&#039;
        option &#039;proto&#039; &#039;dhcp&#039;

config &#039;interface&#039; &#039;wan6&#039;
        option &#039;proto&#039; &#039;none&#039;
        option &#039;ifname&#039; &#039;sixxs&#039;

config &#039;switch&#039;
        option &#039;name&#039; &#039;rtl8366s&#039;
        option &#039;reset&#039; &#039;1&#039;
        option &#039;enable_vlan&#039; &#039;1&#039;
        option &#039;blinkrate&#039; &#039;2&#039;

config &#039;switch_vlan&#039;
        option &#039;device&#039; &#039;rtl8366s&#039;
        option &#039;vlan&#039; &#039;1&#039;
        option &#039;ports&#039; &#039;1 2 3 5t&#039;

config &#039;switch_vlan&#039;
        option &#039;device&#039; &#039;rtl8366s&#039;
        option &#039;vlan&#039; &#039;2&#039;
        option &#039;ports&#039; &#039;0 5t&#039;

config &#039;switch_vlan&#039;
        option &#039;device&#039; &#039;rtl8366s&#039;
        option &#039;vlan&#039; &#039;3&#039;
        option &#039;ports&#039; &#039;5t&#039;

config &#039;switch_port&#039;
        option &#039;device&#039; &#039;rtl8366s&#039;
        option &#039;port&#039; &#039;1&#039;
        option &#039;led&#039; &#039;9&#039;

config &#039;switch_port&#039;
        option &#039;device&#039; &#039;rtl8366s&#039;
        option &#039;port&#039; &#039;2&#039;
        option &#039;led&#039; &#039;6&#039;

config &#039;switch_port&#039;
        option &#039;device&#039; &#039;rtl8366s&#039;
        option &#039;port&#039; &#039;5&#039;
        option &#039;led&#039; &#039;6&#039;</code></pre></div><p>/etc/config/wireless:<br /></p><div class="codebox"><pre><code>config &#039;wifi-device&#039; &#039;radio0&#039;
        option &#039;type&#039; &#039;mac80211&#039;
        option &#039;macaddr&#039; &#039;30:46:9a:XX:XX:XX&#039;
        list &#039;ht_capab&#039; &#039;SHORT-GI-40&#039;
        list &#039;ht_capab&#039; &#039;TX-STBC&#039;
        list &#039;ht_capab&#039; &#039;RX-STBC1&#039;
        list &#039;ht_capab&#039; &#039;DSSS_CCK-40&#039;
        option &#039;channel&#039; &#039;1&#039;
        option &#039;country&#039; &#039;US&#039;
        option &#039;disabled&#039; &#039;0&#039;
        option &#039;hwmode&#039; &#039;11ng&#039;
        option &#039;htmode&#039; &#039;HT40+&#039;

config &#039;wifi-device&#039; &#039;radio1&#039;
        option &#039;type&#039; &#039;mac80211&#039;
        option &#039;macaddr&#039; &#039;30:46:9a:XX:XX:XX&#039;
        option &#039;hwmode&#039; &#039;11na&#039;
        list &#039;ht_capab&#039; &#039;SHORT-GI-40&#039;
        list &#039;ht_capab&#039; &#039;TX-STBC&#039;
        list &#039;ht_capab&#039; &#039;RX-STBC1&#039;
        list &#039;ht_capab&#039; &#039;DSSS_CCK-40&#039;
        option &#039;htmode&#039; &#039;HT40+&#039;
        option &#039;country&#039; &#039;US&#039;
        option &#039;channel&#039; &#039;149&#039;

config &#039;wifi-iface&#039;
        option &#039;device&#039; &#039;radio0&#039;
        option &#039;network&#039; &#039;lan&#039;
        option &#039;ssid&#039; &#039;OpenWRT&#039;
        option &#039;mode&#039; &#039;ap&#039;
        option &#039;encryption&#039; &#039;psk2&#039;
        option &#039;key&#039; &#039;superdupersecret&#039;

config &#039;wifi-iface&#039;
        option &#039;device&#039; &#039;radio1&#039;
        option &#039;network&#039; &#039;lan&#039;
        option &#039;ssid&#039; &#039;OpenWRT&#039;
        option &#039;mode&#039; &#039;ap&#039;
        option &#039;encryption&#039; &#039;psk2&#039;
        option &#039;key&#039; &#039;superdupersecret&#039;

config &#039;wifi-iface&#039;
        option &#039;device&#039; &#039;radio0&#039;
        option &#039;network&#039; &#039;guest&#039;
        option &#039;ssid&#039; &#039;OpenWRT-Guest&#039;
        option &#039;mode&#039; &#039;ap&#039;
        option &#039;encryption&#039; &#039;psk2&#039;
        option &#039;key&#039; &#039;supersecret&#039;

config &#039;wifi-iface&#039;
        option &#039;device&#039; &#039;radio1&#039;
        option &#039;network&#039; &#039;guest&#039;
        option &#039;ssid&#039; &#039;OpenWRT-Guest&#039;
        option &#039;mode&#039; &#039;ap&#039;
        option &#039;encryption&#039; &#039;psk2&#039;
        option &#039;key&#039; &#039;supersecret&#039;</code></pre></div><p>/etc/config/firewall:<br /></p><div class="codebox"><pre><code>config &#039;defaults&#039;
        option &#039;syn_flood&#039; &#039;1&#039;
        option &#039;input&#039; &#039;ACCEPT&#039;
        option &#039;output&#039; &#039;ACCEPT&#039;
        option &#039;forward&#039; &#039;REJECT&#039;

config &#039;zone&#039;
        option &#039;name&#039; &#039;lan&#039;
        option &#039;input&#039; &#039;ACCEPT&#039;
        option &#039;output&#039; &#039;ACCEPT&#039;
        option &#039;forward&#039; &#039;REJECT&#039;
        option &#039;network&#039; &#039;lan&#039;

config &#039;zone&#039;
        option &#039;name&#039; &#039;dmz&#039;
        option &#039;input&#039; &#039;REJECT&#039;
        option &#039;output&#039; &#039;ACCEPT&#039;
        option &#039;forward&#039; &#039;REJECT&#039;
        option &#039;network&#039; &#039;dmz&#039;

config &#039;zone&#039;
        option &#039;name&#039; &#039;guest&#039;
        option &#039;input&#039; &#039;REJECT&#039;
        option &#039;output&#039; &#039;ACCEPT&#039;
        option &#039;forward&#039; &#039;REJECT&#039;
        option &#039;network&#039; &#039;guest&#039;

config &#039;zone&#039;
        option &#039;name&#039; &#039;wan&#039;
        option &#039;input&#039; &#039;REJECT&#039;
        option &#039;output&#039; &#039;ACCEPT&#039;
        option &#039;forward&#039; &#039;REJECT&#039;
        option &#039;masq&#039; &#039;1&#039;
        option &#039;mtu_fix&#039; &#039;1&#039;
        option &#039;network&#039; &#039;wan&#039;

config &#039;zone&#039;
        option &#039;name&#039; &#039;wan6&#039;
        option &#039;input&#039; &#039;REJECT&#039;
        option &#039;output&#039; &#039;ACCEPT&#039;
        option &#039;forward&#039; &#039;REJECT&#039;
        option &#039;network&#039; &#039;wan6&#039;

config &#039;forwarding&#039;
        option &#039;family&#039; &#039;ipv4&#039;
        option &#039;src&#039; &#039;lan&#039;
        option &#039;dest&#039; &#039;wan&#039;

config &#039;forwarding&#039;
        option &#039;family&#039; &#039;ipv6&#039;
        option &#039;src&#039; &#039;lan&#039;
        option &#039;dest&#039; &#039;wan6&#039;

config &#039;forwarding&#039;
        option &#039;family&#039; &#039;ipv4&#039;
        option &#039;src&#039; &#039;dmz&#039;
        option &#039;dest&#039; &#039;wan&#039;

config &#039;forwarding&#039;
        option &#039;family&#039; &#039;ipv4&#039;
        option &#039;src&#039; &#039;guest&#039;
        option &#039;dest&#039; &#039;wan&#039;

config &#039;forwarding&#039;
        option &#039;family&#039; &#039;ipv6&#039;
        option &#039;src&#039; &#039;dmz&#039;
        option &#039;dest&#039; &#039;wan6&#039;

config &#039;forwarding&#039;
        option &#039;family&#039; &#039;ipv6&#039;
        option &#039;src&#039; &#039;guest&#039;
        option &#039;dest&#039; &#039;wan6&#039;

config &#039;rule&#039;
        option &#039;family&#039; &#039;ipv4&#039;
        option &#039;src&#039; &#039;wan&#039;
        option &#039;proto&#039; &#039;udp&#039;
        option &#039;dest_port&#039; &#039;68&#039;
        option &#039;target&#039; &#039;ACCEPT&#039;

config &#039;rule&#039;
        option &#039;family&#039; &#039;ipv4&#039;
        option &#039;src&#039; &#039;wan&#039;
        option &#039;proto&#039; &#039;icmp&#039;
        option &#039;icmp_type&#039; &#039;echo-request&#039;
        option &#039;target&#039; &#039;ACCEPT&#039;

config &#039;rule&#039;
        option &#039;family&#039; &#039;ipv6&#039;
        option &#039;src&#039; &#039;wan6&#039;
        option &#039;proto&#039; &#039;icmpv6&#039;
        option &#039;target&#039; &#039;ACCEPT&#039;

config &#039;rule&#039;
        option &#039;family&#039; &#039;ipv6&#039;
        option &#039;src&#039; &#039;wan6&#039;
        option &#039;dest&#039; &#039;lan&#039;
        option &#039;proto&#039; &#039;icmp&#039;
        option &#039;icmp_type&#039; &#039;echo-request&#039;
        option &#039;target&#039; &#039;ACCEPT&#039;

config &#039;rule&#039;
        option &#039;src&#039; &#039;dmz&#039;
        option &#039;proto&#039; &#039;tcpudp&#039;
        option &#039;dest_port&#039; &#039;53&#039;
        option &#039;target&#039; &#039;ACCEPT&#039;

config &#039;rule&#039;
        option &#039;src&#039; &#039;dmz&#039;
        option &#039;proto&#039; &#039;icmp&#039;
        option &#039;icmp_type&#039; &#039;echo-request&#039;
        option &#039;target&#039; &#039;ACCEPT&#039;

config &#039;rule&#039;
        option &#039;family&#039; &#039;ipv4&#039;
        option &#039;src&#039; &#039;dmz&#039;
        option &#039;proto&#039; &#039;udp&#039;
        option &#039;dest_port&#039; &#039;67&#039;
        option &#039;target&#039; &#039;ACCEPT&#039;

config &#039;rule&#039;
        option &#039;src&#039; &#039;guest&#039;
        option &#039;proto&#039; &#039;tcpudp&#039;
        option &#039;dest_port&#039; &#039;53&#039;
        option &#039;target&#039; &#039;ACCEPT&#039;

config &#039;rule&#039;
        option &#039;src&#039; &#039;guest&#039;
        option &#039;proto&#039; &#039;icmp&#039;
        option &#039;icmp_type&#039; &#039;echo-request&#039;
        option &#039;target&#039; &#039;ACCEPT&#039;

config &#039;rule&#039;
        option &#039;family&#039; &#039;ipv4&#039;
        option &#039;src&#039; &#039;guest&#039;
        option &#039;proto&#039; &#039;udp&#039;
        option &#039;dest_port&#039; &#039;67&#039;
        option &#039;target&#039; &#039;ACCEPT&#039;

config &#039;include&#039;
        option &#039;path&#039; &#039;/etc/firewall.user&#039;</code></pre></div><p>/etc/config/dhcp:<br /></p><div class="codebox"><pre><code>config &#039;dnsmasq&#039;
        option &#039;domainneeded&#039; &#039;1&#039;
        option &#039;boguspriv&#039; &#039;1&#039;
        option &#039;localise_queries&#039; &#039;1&#039;
        option &#039;rebind_protection&#039; &#039;1&#039;
        option &#039;rebind_localhost&#039; &#039;1&#039;
        option &#039;local&#039; &#039;/lan/&#039;
        option &#039;expandhosts&#039; &#039;1&#039;
        option &#039;authoritative&#039; &#039;1&#039;
        option &#039;readethers&#039; &#039;1&#039;
        option &#039;leasefile&#039; &#039;/tmp/dhcp.leases&#039;
        option &#039;resolvfile&#039; &#039;/tmp/resolv.conf.auto&#039;
        option &#039;domain&#039; &#039;lan&#039;

config &#039;domain&#039;

config &#039;dhcp&#039; &#039;wan&#039;
        option &#039;interface&#039; &#039;wan&#039;
        option &#039;ignore&#039; &#039;1&#039;

option &#039;dhcp&#039; &#039;wan6&#039;
        option &#039;interface&#039; &#039;wan6&#039;
        option &#039;ignore&#039; &#039;1&#039;

config &#039;dhcp&#039; &#039;lan&#039;
        option &#039;interface&#039; &#039;lan&#039;
        option &#039;ignore&#039; &#039;1&#039;

config &#039;dhcp&#039; &#039;dmz&#039;
        option &#039;interface&#039; &#039;dmz&#039;
        option &#039;ignore&#039; &#039;0&#039;
        option &#039;start&#039; &#039;100&#039;
        option &#039;limit&#039; &#039;100&#039;
        option &#039;leasetime&#039; &#039;24h&#039;

config &#039;dhcp&#039; &#039;guest&#039;
        option &#039;interface&#039; &#039;guest&#039;
        option &#039;ignore&#039; &#039;0&#039;
        option &#039;start&#039; &#039;100&#039;
        option &#039;limit&#039; &#039;100&#039;
        option &#039;leasetime&#039; &#039;24h&#039;</code></pre></div><p>/etc/firewall.user<br /></p><div class="codebox"><pre><code># This file is interpreted as shell script.
# Put your custom iptables rules here, they will
# be executed with each firewall (re-)start.

# Allow incoming SixXS IPv6 tunnel traffic from PoP if conn. tracking drops state
iptables -A input_wan -s XXX.XXX.XXX.XXX -p 41 -j ACCEPT

# Drop all ipv6 packets that have RH0 headers
ip6tables -A INPUT -m rt --rt-type 0 -j DROP
ip6tables -A FORWARD -m rt --rt-type 0 -j DROP
ip6tables -A OUTPUT -m rt --rt-type 0 -j DROP</code></pre></div>											<p class="post-edited">(Last edited by <strong>Goofball</strong> on 12 Dec 2010, 01:43)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>