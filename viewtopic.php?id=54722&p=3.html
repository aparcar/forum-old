<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> [How To] Home Automation - Relay Board controlled from Web page or SMS</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 17 Apr 2018 and 5 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 3 of 4</div><nav><ul><li><a href="viewtopic.php%3Fid=54722&amp;p=1.html">1</a></li><li><a href="viewtopic.php%3Fid=54722&amp;p=2.html">2</a></li><li class="pagination-current"><span>3</span></li><li><a href="viewtopic.php%3Fid=54722&amp;p=4.html">4</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p260062">
				<div class="post-metadata">
					<div class="post-num">Post #51</div>
					<div class="post-author">pilovis</div>
					<div class="post-datetime">
						5 Jan 2015, 15:42					</div>
				</div>
				<div class="post-content content">
					<p><span class="bbu">Instructions how to transform a cheap 110/220Vac Home PIR Motion Sensor in a &quot;<strong>USB PIR motion sensor</strong>&quot; for OpenWRT/Raspberry/Arduino</span></p><br /><p><span class="postimg"><img src="http://image.dhgate.com/albu_242448039_00-1.0x0/wireless-pir-sensor-for-home-security-motion.jpg" alt="http://image.dhgate.com/albu_242448039_00-1.0x0/wireless-pir-sensor-for-home-security-motion.jpg" /></span></p><p>Open the device, inside you&#039;ll find two printed circuit boards: a PIR module operating from + 5V to 24V (see picture) and a relay module with transformer less capacitor power supply, to reduce the 110 or 220 Vac main line voltage to 24 Vcc non stabilized for the relay and 5-12 Vcc stabilized for the sensor board.</p><p><span style="color: #FF0000"><strong>Some examples of internal PCBs:</strong></span></p><p><strong>model 1:</strong><br /><span class="postimg"><img src="http://www.thebackshed.com/Windmill/articles/MotionLightImages/Dscf1274.jpg" alt="http://www.thebackshed.com/Windmill/articles/MotionLightImages/Dscf1274.jpg" /></span></p><p><strong>model 2:</strong><br /><span class="postimg"><img src="http://www.engineerathome.com/upload/automation_pir.jpg" alt="http://www.engineerathome.com/upload/automation_pir.jpg" /></span></p><p><strong>model 3:</strong><br /><span class="postimg"><img src="http://www.reuk.co.uk/OtherImages/internal-electronics-of-mains-powered-PIR-sensor.jpg" alt="http://www.reuk.co.uk/OtherImages/internal-electronics-of-mains-powered-PIR-sensor.jpg" /></span></p><br /><br /><p>Cut the &quot;three wires&quot; ribbon cable that connects the two boards togheter, save the relay module for future use and keep the PIR sensor board.</p><p>The pin-out of my sensor board is Vcc , GND and output signal, from left to right as seen in the picture of the model 2, but it can be different for other boards even if similar, always check the labels on PCB.</p><p>Connect the +5V and GND of the PIR sensor board in parallel to the +5V and GND of the mouse board (+5V and GND from USB connector)</p><p><strong><span class="bbu">Optocoupler connection</span></strong>:</p><p>we need an optocoupler to interconnect sensor board output signal to the mouse board, the optocoupler I used is the 817b I found in an old USB modem.</p><p><span class="postimg"><img src="http://www.dzsc.com/news/uploadfile/2012724155955543.jpg" alt="http://www.dzsc.com/news/uploadfile/2012724155955543.jpg" /></span></p><p><strong>Pin1</strong> (anode): + 5Vcc<br /><strong>Pin2</strong> (cathode):&nbsp; output signal from sensor board<br /><strong>Pin3</strong> (Emitter): GND<br /><strong>Pin4</strong> (Collector): Mouse Button Switch (terminal connected to Integrated Circuit) </p><p>Note: the Opto-coupler can be easily found in many old devices like modems, UPS, serial interfaces.</p><p>Use <span class="bbu">triggerhappy</span> to detect status of PIR motion sensor.</p><p>Enjoy <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>--------------------------------------------------------------------------------</p><p><span class="bbu">Example of USB mouse circuit board to be used in conjuction of the PIR sensor (without leds):</span></p><p><span class="postimg"><img src="http://www.lovisolo.com/asterisk/software/openwrt/Vodafone-Station-Home-Automation-Server/mouse.jpg" alt="http://www.lovisolo.com/asterisk/software/openwrt/Vodafone-Station-Home-Automation-Server/mouse.jpg" /></span></p><p><span class="postimg"><img src="http://www.eehomepage.com/reports/20080214_teardown_pics/blockdiagram.jpg" alt="http://www.eehomepage.com/reports/20080214_teardown_pics/blockdiagram.jpg" /></span></p>											<p class="post-edited">(Last edited by <strong>pilovis</strong> on 5 Jan 2015, 19:17)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p260070">
				<div class="post-metadata">
					<div class="post-num">Post #52</div>
					<div class="post-author">probono</div>
					<div class="post-datetime">
						5 Jan 2015, 16:03					</div>
				</div>
				<div class="post-content content">
					<p>Isn&#039;t it this waste of a mouse PCB when the same could probably be done with just an ATTiny45 microcontroller and a few cheap parts as shown on <a href="http://blog.flipwork.nl/?x=entry:entry081009-142605">http://blog.flipwork.nl/?x=entry:entry081009-142605</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p260078">
				<div class="post-metadata">
					<div class="post-num">Post #53</div>
					<div class="post-author">pilovis</div>
					<div class="post-datetime">
						5 Jan 2015, 16:26					</div>
				</div>
				<div class="post-content content">
					<p>the finished job:</p><p>Note: the phone is connected to Asterisk (VOIP)</p><p><span class="postimg"><img src="http://www.lovisolo.com/asterisk/software/openwrt/Vodafone-Station-Home-Automation-Server/server1.jpg" alt="http://www.lovisolo.com/asterisk/software/openwrt/Vodafone-Station-Home-Automation-Server/server1.jpg" /></span></p><p><span class="postimg"><img src="http://www.lovisolo.com/asterisk/software/openwrt/Vodafone-Station-Home-Automation-Server/server2.jpg" alt="http://www.lovisolo.com/asterisk/software/openwrt/Vodafone-Station-Home-Automation-Server/server2.jpg" /></span></p><p><span class="postimg"><img src="http://www.lovisolo.com/asterisk/software/openwrt/Vodafone-Station-Home-Automation-Server/server3.jpg" alt="http://www.lovisolo.com/asterisk/software/openwrt/Vodafone-Station-Home-Automation-Server/server3.jpg" /></span></p>											<p class="post-edited">(Last edited by <strong>pilovis</strong> on 5 Jan 2015, 17:26)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p260095">
				<div class="post-metadata">
					<div class="post-num">Post #54</div>
					<div class="post-author">pilovis</div>
					<div class="post-datetime">
						5 Jan 2015, 16:55					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>probono wrote:</cite><blockquote><p>Isn&#039;t it this waste of a mouse PCB when the same could probably be done with just an ATTiny45 microcontroller and a few cheap parts as shown on <a href="http://blog.flipwork.nl/?x=entry:entry081009-142605">http://blog.flipwork.nl/?x=entry:entry081009-142605</a></p></blockquote></div><p>Anyone has got an old, unused or damaged, USB mouse.<br />I don&#039;t think many people have a microcontroller ATT available <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p>											<p class="post-edited">(Last edited by <strong>pilovis</strong> on 5 Jan 2015, 16:56)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p260104">
				<div class="post-metadata">
					<div class="post-num">Post #55</div>
					<div class="post-author">hoatienii</div>
					<div class="post-datetime">
						5 Jan 2015, 17:20					</div>
				</div>
				<div class="post-content content">
					<p>Great!!</p>											<p class="post-edited">(Last edited by <strong>hoatienii</strong> on 6 Jan 2015, 09:45)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p260137">
				<div class="post-metadata">
					<div class="post-num">Post #56</div>
					<div class="post-author">tmo26</div>
					<div class="post-datetime">
						5 Jan 2015, 19:41					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>hoatienii wrote:</cite><blockquote><p>Great!!</p></blockquote></div><p>Please, learn how to quote correctly.<br />There&#039;s no need to quote the complete message, just to add one word by yourself.<br />Restricting the quotation to the necessary parts makes threads shorter and easier to read.</p><p>Thanks!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p260177">
				<div class="post-metadata">
					<div class="post-num">Post #57</div>
					<div class="post-author">pilovis</div>
					<div class="post-datetime">
						5 Jan 2015, 22:59					</div>
				</div>
				<div class="post-content content">
					<p>If you don&#039;t want or can&#039;t use a PIR sensor for motion detection, you can also use a USB webcam and &quot;Motion&quot; package.</p><p><strong>opkg update<br />opkg install kmod-video-core kmod-video-uvc<br />opkg install motion</strong></p><p>Those are the lines to be modified in &quot;/etc/motion.conf&quot; configuration file:</p><p><em><span style="color: #0000FF">width 640<br />height 480<br />framerate 2<br />threshold 3000<br />output_pictures off&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />ffmpeg_output_movies off <br />stream_maxrate 1<br />stream_localhost off<br />#<br /># command to be executed on motion detection, ex. /root/motion_detected.sh<br />#<br />on_motion_detected</span> <span style="color: #FF0000">/root/motion_detected.sh</span></em></p><p>Note: if you want motion to save captured images on motion detection (Warning: a lot of disk space is needed!), change the line: <span style="color: #0000FF">output_pictures off </span><br />to: <br /><span style="color: #0000FF">output_pictures on </span></p><p>To run motion simply use <strong>motion</strong> command</p><p>With Motion you can have both, motion detection and realtime image streaming (http://IP_ADDRESS:8081),&nbsp; but it will increase&nbsp; cpu and ram usage quite a lot.</p>											<p class="post-edited">(Last edited by <strong>pilovis</strong> on 5 Jan 2015, 23:56)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p260182">
				<div class="post-metadata">
					<div class="post-num">Post #58</div>
					<div class="post-author">pilovis</div>
					<div class="post-datetime">
						6 Jan 2015, 00:14					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>pilovis wrote:</cite><blockquote><p><span class="bbu">Instructions how to transform a cheap 110/220Vac Home PIR Motion Sensor in a &quot;<strong>USB PIR motion sensor</strong>&quot; for OpenWRT/Raspberry/Arduino</span></p><p><span class="postimg"><img src="http://www.dzsc.com/news/uploadfile/2012724155955543.jpg" alt="http://www.dzsc.com/news/uploadfile/2012724155955543.jpg" /></span></p></blockquote></div><p>... if you have a router that supports GPIO inputs (Vodafone Station does NOT) you can connect the PIR sensor directly to GPIO without using USB, simply connect the collector of the Optocoupler output transistor to a GPIO input pin (button active low image). </p><p><span class="postimg"><img src="http://wiki.openwrt.org/_media/media/gpios-high_low.png" alt="http://wiki.openwrt.org/_media/media/gpios-high_low.png" /></span></p>											<p class="post-edited">(Last edited by <strong>pilovis</strong> on 6 Jan 2015, 00:18)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p260841">
				<div class="post-metadata">
					<div class="post-num">Post #59</div>
					<div class="post-author">pilovis</div>
					<div class="post-datetime">
						10 Jan 2015, 16:54					</div>
				</div>
				<div class="post-content content">
					<p>Note:<br />changes from Attitude Adjustment to Barrier Breaker for Vodafone Station A.K.A Huawei EchoLife HG553 : </p><p>If you have installed Barrier Breaker, you should change the following lines (anywhere they appear):</p><p>/sys/devices/platform/leds-gpio.0/leds/HW553:blue:internetkey/brightness<br />/sys/devices/platform/leds-gpio.0/leds/HW553:red:internetkey/brightness</p><p>to</p><p>/sys/devices/platform/leds-gpio.0/leds/HW553:blue:<strong>hspa</strong>/brightness<br />/sys/devices/platform/leds-gpio.0/leds/HW553:red:<strong>hspa</strong>/brightnes</p>											<p class="post-edited">(Last edited by <strong>pilovis</strong> on 10 Jan 2015, 16:56)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p260931">
				<div class="post-metadata">
					<div class="post-num">Post #60</div>
					<div class="post-author">pilovis</div>
					<div class="post-datetime">
						11 Jan 2015, 11:17					</div>
				</div>
				<div class="post-content content">
					<p><strong><span class="bbu">IMPORTANT NOTE:</span></strong></p><p>Since i discovered (it&#039;s my fault <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> ) that during bootup all three channels are ON (cause the blue leds are off), I used the &quot;red power led&quot; as a consensus switch to Power (+5 Vcc) the &quot;three cannels relay board&quot; only after the full bootup sequence is finished.</p><p>To do so I used another relay channel (transistor+relay) and connected it to the red Power led cathode, than I put the following two lines in &quot;/etc/rc.local&quot; at the end of the file, just before &quot;exit 0&quot; command:</p><p><em>/bin/sleep 10<br />/bin/echo 1 &gt; /sys/devices/platform/leds-gpio.0/leds/HW553:red:power/brightness</em></p>											<p class="post-edited">(Last edited by <strong>pilovis</strong> on 12 Jan 2015, 00:10)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p261170">
				<div class="post-metadata">
					<div class="post-num">Post #61</div>
					<div class="post-author">pilovis</div>
					<div class="post-datetime">
						13 Jan 2015, 00:20					</div>
				</div>
				<div class="post-content content">
					<p>Since <span class="bbu">mjpg-streamer</span> documentation sucks, I&#039;m putting here some useful information about it:</p><br /><p>- to remotely capture a snapshot image from mjpg-streamer and save it to a jpg format:</p><p><strong>wget http://user:password@<em>mjpg-streamer-address:port</em>/?action=snapshot -O output.jpg</strong></p><p>- to remotely capture a streaming video from mjpg-streamer and save it to a file (mjpg format) format (open it with VLC):</p><p><strong>wget http://user:password@<em>mjpg-streamer-address:port</em>/?action=stream -O output.mjpg</strong></p><p>- to remotely capture a streaming video from mjpg-streamer and save it to a file (mjpg format) with a timestamp into the filename (open it with VLC):</p><p><strong>now=$(date +&quot;%Y-%m-%d----%H-%M-%S&quot;) ; wget http://user:password@<em>mjpg-streamer-address:port</em>/?action=stream -O output$now.mjpg</strong></p><p>filename example: &quot;output2015-01-13----01-10-13.mjpg&quot;</p><br /><p>- to put an overlay &quot;time&quot; on streaming video this is the mjpg-streamer &quot;/www/webcam/index.html&quot; modified file:</p><p><em> <span style="color: #0000FF">&nbsp; &nbsp;&lt;html&gt;<br />&nbsp; &nbsp; &nbsp; &lt;head&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &lt;title&gt;MJPG-Streamer&lt;/title&gt;<br />&lt;style&gt;<br />&nbsp; &nbsp; .container { position:relative; }<br />&nbsp; &nbsp; .container video {<br />&nbsp; &nbsp; &nbsp; &nbsp; position:relative;<br />&nbsp; &nbsp; &nbsp; &nbsp; z-index:0;<br />&nbsp; &nbsp; }</span></em></p><p><span style="color: #0000FF"><em>&nbsp; &nbsp; .overlay {<br />&nbsp; &nbsp; &nbsp; &nbsp; position:absolute;<br />&nbsp; &nbsp; &nbsp; &nbsp; top:0;<br />&nbsp; &nbsp; &nbsp; &nbsp; left:0;<br />&nbsp; &nbsp; &nbsp; &nbsp; z-index:1;<br />&nbsp; &nbsp; }<br />&nbsp; &nbsp; &lt;/style&gt;<br />&nbsp; &nbsp; &nbsp; &lt;/head&gt;<br />&nbsp; &nbsp; &nbsp; &lt;body&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;container&quot;&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;img src=&quot;/?action=stream&quot;/&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &lt;div class=&quot;overlay&quot;&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;div style=&quot;position:absolute;width:290px;font-size:200%;font-weight:bold; background-color:lightgray; filter:alpha(opacity=60); opacity:.6;&quot; id=&quot;time_span&quot;&gt;&nbsp; &lt;/div&gt;</em></span></p><p><span style="color: #0000FF"><em>&nbsp; &nbsp; &nbsp; &nbsp; &lt;/div&gt;<br />&nbsp; &nbsp; &lt;/div&gt;</em></span><br /><span style="color: #0000FF"><em>&nbsp; &nbsp; &nbsp;&lt;script type=&#039;text/javascript&#039;&gt;<br />timer();</em></span></p><p><span style="color: #0000FF"><em>&nbsp; &nbsp; function timer(){<br />&nbsp; &nbsp; &nbsp;var now = new Date,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;hours = now.getHours(),<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ampm&nbsp; = hours&lt;=11 ? &#039; AM&#039; : &#039; PM&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;minutes = now.getMinutes(),<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;seconds = now.getSeconds(),<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;t_str = &quot;&amp;nbsp;&quot; + [hours,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (minutes &lt; 10 ? &quot;0&quot; + minutes : minutes),<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (seconds &lt; 10 ? &quot;0&quot; + seconds : seconds)]<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.join(&#039;:&#039;) + ampm + &quot;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&quot;;<br />&nbsp; &nbsp; &nbsp;document.getElementById(&#039;time_span&#039;).innerHTML = t_str;<br />&nbsp; &nbsp; &nbsp;setTimeout(timer,1000);<br />&nbsp; &nbsp; }</em></span></p><p><span style="color: #0000FF"><em>&nbsp; &nbsp; &lt;/script&gt;</em></span></p><p><span style="color: #0000FF"><em>&nbsp; &nbsp; &nbsp; &lt;/body&gt;<br />&nbsp; &nbsp; &lt;/html&gt;</em></span></p><br /><p>- to launch mjpg-streamer from commandline:</p><p><strong>mjpg_streamer -i &quot;./input_uvc.so -f 5 -r 640x480&quot; -o &quot;./output_http.so -w ./www&quot;</strong></p><p>note: this command <span class="bbu">does not</span> use the /etc/config/mjpg-streamer configuration file</p><p>or:</p><p><strong>/etc/init.d/mjpg-streamer start</strong></p><p>note: this command <span class="bbu">uses</span> the /etc/config/mjpg-streamer configuration file</p><br /><p>&quot;/etc/config/mjpg-streamer&quot; configuration file:</p><p><em><span style="color: #0000FF">config mjpg-streamer &#039;core&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option enabled &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option input &#039;uvc&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option output &#039;http&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option device &#039;/dev/video0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option resolution &#039;640x480&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option fps &#039;5&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option www &#039;/www/webcam&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option port &#039;8080&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option username &#039;user&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option password &#039;password&#039;</span></em></p><br /><p>- to enable mjpg-streamer autostart at bootup:</p><p><strong>/etc/init.d/mjpg-streamer enable</strong></p><br /><p>- script to remotely capture a streaming video <strong>for one hour</strong> from mjpg-streamer and save it to a file (mjpg format) with a timestamp into the filename, than stops and starts another recording, and so on (infinite loop)<br /><em><span style="color: #0000FF"><br />#!/bin/bash<br />while :<br />do<br />now=$(date +&quot;%Y-%m-%d----%H-%M-%S&quot;)<br />wget http://user:password@mjpg-streamer-address:port/?action=stream -O output$now.mjpg &amp;<br />sleep 3600<br />ps -ef | grep wget | awk &#039;{print $2}&#039; | xargs kill<br />done</span></em></p><br /><br /><p>... more to come</p>											<p class="post-edited">(Last edited by <strong>pilovis</strong> on 13 Jan 2015, 08:13)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p263230">
				<div class="post-metadata">
					<div class="post-num">Post #62</div>
					<div class="post-author">pilovis</div>
					<div class="post-datetime">
						28 Jan 2015, 12:24					</div>
				</div>
				<div class="post-content content">
					<p><span class="bbu">Baresip Openwrt SIP client</span></p><p>Baresip it&#039;s a good program but official documentation is hardly inexistent and sucks, like many small linux programs, as usual I had to figure out how to configure and use it.<br />How the hell do they create programs without writing a decent documentation?&nbsp; <img src="https://forum.openwrt.org/img/smilies/mad.png" width="15" height="15" alt="mad" />&nbsp; <img src="https://forum.openwrt.org/img/smilies/mad.png" width="15" height="15" alt="mad" /></p><p>- Prerequisites:</p><p>1) install Alsa and USB audio support<br />2) connect an USB audio adapter with a speaker and a microphone or a USB phone / headset (with microphone)<br />note: you might also use a USB webcam with internal microphone or just a USB microphone, in both cases you don&#039;t need an USB audio adapter but you won&#039;t have any speaker (one way audio)<br />3) adjust audio levels of speaker and microphone with command: <strong>alsamixer</strong></p><p>note: see my other &quot;How To&quot; for detailed instructions how to configure USB audio: <a href="https://forum.openwrt.org/viewtopic.php?pid=225463#p225463">https://forum.openwrt.org/viewtopic.php … 63#p225463</a></p><br /><p>- Installation and configuration of Baresip on Barrier Breaker (Baresip doesn&#039;t work on Attitue Adjustment: broken audio!):</p><p><strong>opkg update<br />opkg install kmod-usb-hid<br />opkg install kmod-hid kmod-hid-generic<br />opkg install baresip baresip-mod-alsa baresip-mod-cons baresip-mod-evdev baresip-mod-g711<br />opkg install baresip-mod-stdio baresip-mod-uuid</strong></p><p>Launch baresip once to generate the default configuration files on /root/.baresip:</p><p><strong>baresip</strong></p><p>after a few seconds stop it with ctrl+c<br />then you need to edit the configuration files</p><p><strong>cd /root/.baresip</strong></p><p>first edit &quot;accounts&quot; file</p><p>delete everything and insert the following line (use the values of your SIP accont):<br /><em><span style="color: #0000FF"><br />&lt;sip:<strong>user</strong>:<strong>password</strong>@<strong>sip-provider.com</strong>:<strong>port</strong>&gt;;stunserver=stun:stun.ekiga.net<br /></span></em></p><p>Note: you can add optional parameters to this line just by adding one or more of them with the following format:<br />&lt;sip:user:password@domain;uri-params&gt;;addr-params</p><p>example:<br />&lt;sip:user:password@sip-provider.com:5060;transport=udp&gt;;answermode=auto;stunserver=stun:stun.ekiga.net</p><p>list of optional URI params:</p><p>#&nbsp; &nbsp; ;transport={udp,tcp,tls}</p><p>list of optional addr-params:</p><p>#&nbsp; &nbsp; ;answermode={manual,early,auto}<br />#&nbsp; &nbsp; ;audio_codecs=speex/16000,pcma,...<br />#&nbsp; &nbsp; ;auth_user=username<br />#&nbsp; &nbsp; ;mediaenc={srtp,srtp-mand,srtp-mandf,dtls_srtp,zrtp}<br />#&nbsp; &nbsp; ;medianat={stun,turn,ice}<br />#&nbsp; &nbsp; ;outbound=&quot;sip:primary.example.com;transport=tcp&quot;<br />#&nbsp; &nbsp; ;outbound2=sip:secondary.example.com<br />#&nbsp; &nbsp; ;ptime={10,20,30,40,...}<br />#&nbsp; &nbsp; ;regint=3600<br />#&nbsp; &nbsp; ;regq=0.5<br />#&nbsp; &nbsp; ;rtpkeep={zero,stun,dyna,rtcp}<br />#&nbsp; &nbsp; ;sipnat={outbound}<br />#&nbsp; &nbsp; ;stunserver=stun:[user:pass]@host[:port]</p><br /><p>then edit&nbsp; &quot;config&quot; file</p><p>delete everything and insert the following lines:<br /><em><span style="color: #0000FF"><br />#comments added by pilovis<br />#<br />poll_method&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;epoll<br />input_device&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /dev/input/event0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #eventually adapt input device for your system<br />input_port&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 5555<br />sip_trans_bsize&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;128<br />audio_player&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; alsa,default&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # audio speaker device<br />audio_source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; alsa,default&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# audio microphone device<br />audio_alert&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;alsa,default&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# audio ring device<br />#<br /># if you want to use more than one audio device you need to use: alsa,default:CARD=devicename<br /># to discover device name use command: aplay -L<br /># -----------------------------------------------------------<br />audio_srate&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;8000-48000<br />audio_channels&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1-2<br />rtp_tos&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;184<br />rtcp_enable&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;yes<br />rtcp_mux&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; no<br />#jitter_buffer_delay&nbsp; &nbsp; &nbsp;15-35&nbsp; # uncomment this line only in case you use an external voip provider and you experience high ping latence<br />rtp_stats&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;no<br />dns_server&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 8.8.8.8:53&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# use your preferred DNS server<br />module_path&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/usr/lib/baresip/modules<br />module&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; stdio.so<br />module&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; evdev.so<br />module&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; g711.so<br />module&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; alsa.so<br />module&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; stun.so<br />module&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; turn.so<br />module_tmp&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; account.so<br />module_app&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; contact.so<br />module_app&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; menu.so<br />natbd_server&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; creytiv.com&nbsp; # I&#039;m not sure this line is necessary when you set &quot;stunserver&quot; option on user account <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# and/or for local accounts: &lt;user:password@localhost&gt;<br />natbd_interval&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 600&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# same as above, you might try to comment &quot;#&quot; both lines and test if baresip works<br /># eof<br /></span></em></p><p>Launch Baresip:</p><p><strong>baresip</strong></p><p>then press &quot;?&quot; for all available commands</p><p>-------------------------------------------------------------------------------------</p><p>- <span class="bbu">Baresip remote audio monitoring</span></p><p>Make an automatic SIP phone call with the following command:</p><p><strong>(/bin/echo sip:other-user@voip-provider.com; /bin/sleep 60; /bin/echo q) | /usr/bin/baresip -f /root/.baresip -e d</strong></p><p>Note: &quot;sleep 60; echo q&quot; set the total call duration time at 60 seconds including ring time, after that &quot;quit&quot; command is sent to baresip, even if the remote party has not answered the call yet.</p><p>When the remote party answers the phone, he/she hears the ambient audio captured from the local microphone, also if he/she talks, his/her voice is sent to the local speaker (if connected and active).</p><p>-------------------------------------------------------------------------------------------------</p><p>- <span class="bbu">Launch Baresip as a daemon and configure it to auto answer all incoming calls</span></p><p>first configure baresip for auto answer all incoming calls by editing the &quot;/root/.baresip/accounts&quot; file as the following:</p><p><em><span style="color: #0000FF">&lt;sip:user:password@sip-provider.com:5060;transport=udp&gt;;answermode=<strong>auto</strong>;stunserver=stun:stun.ekiga.net<br /></span></em><br />then launch it as a daemon with the following command:</p><p><strong>/usr/bin/baresip -f /root/.baresip -d </strong></p><p>then try to call your local sip account, baresip won&#039;t ring but will answer the call and will start streaming the local audio to you (remote caller), same as above, if you talk,&nbsp; people near to the openwrt router will hear your voice through the speaker (speakerphone mode)</p><p>NOTE: if you use baresip as a daemon and you also want to issue an automatic call from local (openwrt) to remote (eg.: your mobile), you should change the previous auto call command to the following:</p><p><strong>(/bin/echo sip:other-user@voip-provider.com; /bin/sleep 60; /bin/echo b) | /usr/bin/baresip -f /root/.baresip -e d</strong></p><p>basically here we are sending &quot;b&quot; command (HANGUP CALL) to baresip instead of &quot;q&quot; (QUIT BARESIP) because we want to keep baresip running in background.</p><p>If you want to use a USB Voip phone or a USB headset but you want to have a separate speaker that rings for the incoming calls, you need an extra USB audio adapter for the speaker, alsa will recognize it with a different device name, then you just need to modifiy &quot;config&quot; file as the following:</p><p><em><span style="color: #0000FF">audio_player&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; alsa,<strong>default:CARD=headset_devicename</strong><br />audio_source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; alsa,<strong>default:CARD=headset_devicename</strong><br />audio_alert&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;alsa,<strong>default:CARD=other_devicename</strong></span></em></p><p>note: to find the two device names launch command: <strong>aplay -L</strong>&nbsp; <br />----------------------------------------------------------------------------------------</p><p>- <span class="bbu">USB Keypad</span></p><p>if you connect an USB numeric keypad to your router, you can use it to answer the incoming calls (Enter Key) and/or to dial phone numbers followed by &quot;Enter&quot; key to start the call.<br />To hangup/cancel the call press &quot;Del&quot; key.</p><p>Note: if you want to use the keypad to accept incoming calls by pressing &quot;Enter&quot;, you need to modify the account configuration file as the following:</p><p><em><span style="color: #0000FF">&lt;sip:user:password@sip-provider.com:5060;transport=udp&gt;;<strong>answermode=manual</strong></span></em></p><p><span class="postimg"><img src="http://www.lindy.co.uk/images/usb-numeric-keypad-p763-1172_zoom.jpg" alt="http://www.lindy.co.uk/images/usb-numeric-keypad-p763-1172_zoom.jpg" /></span></p><p>If you use a USB Phone you don&#039;t need the USB audio adapter.</p><p><span class="postimg"><img src="http://blog.ashfame.com/wp-content/uploads/2008/02/usb_phone.jpg" alt="http://blog.ashfame.com/wp-content/uploads/2008/02/usb_phone.jpg" /></span></p><p>if you install &quot;kmod-usb-cm109&quot; you can use some (old) USB Voip phones with support of their integrated keys, like<br />KIP 1000, G-talk , Atcom au100, Allied-Telesis Corega USBPH01, same for &quot;kmod-usb-yealink&quot; that support Yealing Voip phones.</p><p><span class="postimg"><img src="http://www.komunikate.eu.com/images/kip1000.jpg" alt="http://www.komunikate.eu.com/images/kip1000.jpg" /></span> <span class="postimg"><img src="http://www.voicesource.co.za/images/au-100.jpeg" alt="http://www.voicesource.co.za/images/au-100.jpeg" /></span><span class="postimg"><img src="http://i00.i.aliimg.com/photo/v0/493348222/Original_yealink_wireless_voip_usb_skype_phone.jpg_220x220.jpg" alt="http://i00.i.aliimg.com/photo/v0/493348222/Original_yealink_wireless_voip_usb_skype_phone.jpg_220x220.jpg" /></span></p><p><span class="bbu">NOTE:</span></p><p>if you have installed Asterisk11 on the same router and you want to connect Baresip to local Asterisk, this is the account configuration example:<br /><em><span style="color: #0000FF"><br />&lt;sip:user:password@localhost&gt;;answermode=manual</span></em></p><br /><p>- To <span class="bbu">start Baresip at bootup</span> but only after Asterisk has fully started, add the following line to /etc/rc.local:</p><p><em><span style="color: #0000FF">/bin/sleep 10<br />/etc/init.d/asterisk start<br /><strong>/usr/bin/baresip -f /root/.baresip -d &amp;&amp;</strong><br />exit 0<br /></span></em></p><p>Don&#039;t use /etc/init.d/baresip enable or start, cause is broken (config path missing) and will not start at bootup nor will launch baresip daemon <img src="https://forum.openwrt.org/img/smilies/mad.png" width="15" height="15" alt="mad" /> <img src="https://forum.openwrt.org/img/smilies/mad.png" width="15" height="15" alt="mad" /></p>											<p class="post-edited">(Last edited by <strong>pilovis</strong> on 31 Jan 2015, 17:11)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p266587">
				<div class="post-metadata">
					<div class="post-num">Post #63</div>
					<div class="post-author">pilovis</div>
					<div class="post-datetime">
						23 Feb 2015, 07:48					</div>
				</div>
				<div class="post-content content">
					<p><span class="bbu">Basic Authentication on uhttpd</span></p><p>To add a password to uhttpd (web page access) do the following:</p><p><strong>uci set uhttpd.main.config=/etc/httpd.conf<br />uci commit uhttpd<br />echo &quot;/:root:<em><span style="color: #FF0000">password</span></em>&quot; &gt; $(uci get uhttpd.main.config)<br />/etc/init.d/uhttpd restart</strong></p>											<p class="post-edited">(Last edited by <strong>pilovis</strong> on 23 Feb 2015, 07:59)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p266678">
				<div class="post-metadata">
					<div class="post-num">Post #64</div>
					<div class="post-author">pilovis</div>
					<div class="post-datetime">
						23 Feb 2015, 23:20					</div>
				</div>
				<div class="post-content content">
					<p><span class="bbu">Version 2.0</span></p><p>- Wan/Lan/WiFi connectivity<br />- 1 Channel relay output (1600W:2000VA MAX)<br />- 1 Channel Hi Pot Led spot light <br />- SMS (GSM dongle) and Internet (Web page) channels control (ON/OFF, Status, Router reboot)<br />- Motion detection (webcam)<br />- Remote streaming video control (wan/lan/internet)<br />- Remote streaming audio control&nbsp; (wan/lan/internet)<br />- Programmable Phone alert (automatic phone call on event / status change)<br />- Programmable&nbsp; SMS alert (SMS on event / status change)<br />- Programmable email alert (mail on event / status change)<br />- Restore previous channels state on reboot (restart/crash)</p><p>Notes:<br />1 Old Vodafone Station (no need of external Overlay/Extroot - internal 16 MB flash + 64 MB ram + 2 USB2 ports)<br />1 USB Webcam with built in microphone + 1 button (programmable)<br />1 USB 3G /Hsupa/UMTS/GSM dongle (included with Vodafone Station)<br />3 x 3V Arduino Relay boards&nbsp; (2 external &quot;NAND configuration&quot; for output channel + 1 internal for spot light)<br />1 automotive Led spot light 12V - 24 leds - 12W<br />1 power supply 12Vdc 2A&nbsp; (included with Vodafone Station)<br />1 power supply 4.5Vdc 0.5A (for relay boards)<br />Optional: external GSM/UMTS antenna 2db</p><p>Installed software:<br />OpenWRT Barrier Breaker (USB, Video, Audio, Led, 3G support)<br />Triggerhappy<br />Gnokii<br />Alsa<br />Baresip<br />Motion<br />Mini-sendmail<br />Luci <br />Optional: nano, mc, htop, vsftpd, ddns suppport</p><p>Total power consumption:<br />12W/h idle state, all channels OFF<br />25W/h all channels ON (led spot light ON)</p><p><strong>Total cost: 65 Euro</strong></p><br /><p><span class="postimg"><img src="http://www.lovisolo.com/asterisk/software/openwrt/Vodafone-Station-Home-Automation-Server/relay2a.jpg" alt="http://www.lovisolo.com/asterisk/software/openwrt/Vodafone-Station-Home-Automation-Server/relay2a.jpg" /></span></p><p><span class="postimg"><img src="http://www.lovisolo.com/asterisk/software/openwrt/Vodafone-Station-Home-Automation-Server/relay2b.jpg" alt="http://www.lovisolo.com/asterisk/software/openwrt/Vodafone-Station-Home-Automation-Server/relay2b.jpg" /></span></p><p><span class="postimg"><img src="http://www.lovisolo.com/asterisk/software/openwrt/Vodafone-Station-Home-Automation-Server/relay2c.jpg" alt="http://www.lovisolo.com/asterisk/software/openwrt/Vodafone-Station-Home-Automation-Server/relay2c.jpg" /></span></p>											<p class="post-edited">(Last edited by <strong>pilovis</strong> on 24 Feb 2015, 00:42)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p266716">
				<div class="post-metadata">
					<div class="post-num">Post #65</div>
					<div class="post-author">KHAN85</div>
					<div class="post-datetime">
						24 Feb 2015, 09:24					</div>
				</div>
				<div class="post-content content">
					<p>Great job. Thanks for share it.</p><p>Another idea for reuse old hardware is... use Bluetooth dongle in OpenWrt to connect to a old smartphones (like nokia), using bluetooth &quot;handsfree profile&quot; you can receive and make calls, identify caller id, etc..</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p266724">
				<div class="post-metadata">
					<div class="post-num">Post #66</div>
					<div class="post-author">pilovis</div>
					<div class="post-datetime">
						24 Feb 2015, 11:01					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>KHAN85 wrote:</cite><blockquote><p>Great job. Thanks for share it.</p><p>Another idea for reuse old hardware is... use Bluetooth dongle in OpenWrt to connect to a old smartphones (like nokia), using bluetooth &quot;handsfree profile&quot; you can receive and make calls, identify caller id, etc..</p></blockquote></div><p>Bluetooth is broken on Attitue Adjustment and Barrier Breaker, it doesn&#039;t work.</p>											<p class="post-edited">(Last edited by <strong>pilovis</strong> on 24 Feb 2015, 11:01)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p267378">
				<div class="post-metadata">
					<div class="post-num">Post #67</div>
					<div class="post-author">pilovis</div>
					<div class="post-datetime">
						2 Mar 2015, 16:38					</div>
				</div>
				<div class="post-content content">
					<p>Burglar alarm with motion detection<br />SMS + eMail + phone call on triggered allarm<br />SMS &amp; Web remote control<br />Remote Audio &amp; Video monitoring<br />1 channel output 1500 W max</p><p>Total cost = 70 Euro<br />Details &amp; instructions @ </p><p><strong>Youtube video:</strong><br /><a href="https://www.youtube.com/watch?v=nSt9eXwbLkk">https://www.youtube.com/watch?v=nSt9eXwbLkk</a></p><br /><p><span class="postimg"><img src="http://www.lovisolo.com/asterisk/software/openwrt/Vodafone-Station-Home-Automation-Server/antifurto.jpg" alt="http://www.lovisolo.com/asterisk/software/openwrt/Vodafone-Station-Home-Automation-Server/antifurto.jpg" /></span></p>											<p class="post-edited">(Last edited by <strong>pilovis</strong> on 2 Mar 2015, 16:39)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p271682">
				<div class="post-metadata">
					<div class="post-num">Post #68</div>
					<div class="post-author">bopnrgi</div>
					<div class="post-datetime">
						8 Apr 2015, 12:43					</div>
				</div>
				<div class="post-content content">
					<p>Hi, I started to build Home Automation Based on WR841ND TPLINK.<br />My aim is to control Garage Doors.</p><p>I use GPIO to control Relays, they are Active Low.<br />At the boot time, all leds are ON (and so GPIO to GND) during 1 second. the problem is that they open my garage door =&gt; Not really secure in power on / reboot !</p><p>I need to delay, or constrain, relays powering.<br />Is it possible to disable this fonctionnality by software (or too deep in bootloader sequence ?) ?</p><p>Simple hardware solution ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p271695">
				<div class="post-metadata">
					<div class="post-num">Post #69</div>
					<div class="post-author">pilovis</div>
					<div class="post-datetime">
						8 Apr 2015, 15:48					</div>
				</div>
				<div class="post-content content">
					<p>I used two relays (one N.C. and the other N.O.) connected to two leds, to obtain the following logic:<br />the output goes &#039;on&#039; only when one led is &#039;on&#039; and the other is &#039;off&#039;, when both leds are &#039;on&#039; or &#039;off&#039;, the output stays off.</p>											<p class="post-edited">(Last edited by <strong>pilovis</strong> on 8 Apr 2015, 15:56)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p271705">
				<div class="post-metadata">
					<div class="post-num">Post #70</div>
					<div class="post-author">bopnrgi</div>
					<div class="post-datetime">
						8 Apr 2015, 17:16					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for your fast reply,</p><p>On power on, all leds are &quot;on&quot; =&gt; both relays will commute at the same time. It&#039;s possible that the door open, and that&#039;s not suitable... for me.</p><p>Have you got a simple solution, like RC filter or something like that ?</p><p>Do you confirm that &quot;all leds on&quot; are part of deep bootloader sequence ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p271706">
				<div class="post-metadata">
					<div class="post-num">Post #71</div>
					<div class="post-author">pilovis</div>
					<div class="post-datetime">
						8 Apr 2015, 17:27					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>bopnrgi wrote:</cite><blockquote><p>Thanks for your fast reply,</p><p>On power on, all leds are &quot;on&quot; =&gt; both relays will commute at the same time.</p></blockquote></div><p>Just connect in series the N.C. of the first relay to the N.O of the second one.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p271719">
				<div class="post-metadata">
					<div class="post-num">Post #72</div>
					<div class="post-author">hoatienii</div>
					<div class="post-datetime">
						8 Apr 2015, 19:12					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>bopnrgi wrote:</cite><blockquote><p>Hi, I started to build Home Automation Based on WR841ND TPLINK.<br />My aim is to control Garage Doors.</p><p>I use GPIO to control Relays, they are Active Low.<br />At the boot time, all leds are ON (and so GPIO to GND) during 1 second. the problem is that they open my garage door =&gt; Not really secure in power on / reboot !</p><p>I need to delay, or constrain, relays powering.<br />Is it possible to disable this fonctionnality by software (or too deep in bootloader sequence ?) ?</p><p>Simple hardware solution ?</p></blockquote></div><p>What version wr841nd you have? If you have v8.x you have 4 free gpio on jtag.</p><p><a href="http://www.tech-blog.pl/2013/07/14/tp-link-tl-wr841n-v8x-wolne-gpio-w-zlaczu-jtag/">http://www.tech-blog.pl/2013/07/14/tp-l … aczu-jtag/</a></p><p><span class="postimg"><img src="https://lh5.googleusercontent.com/-DsMmdCW3SB4/VRp5jhId1QI/AAAAAAAAKJ4/VsciWawpYJs/w979-h590-no/IMG_20150331_143231.jpg" alt="https://lh5.googleusercontent.com/-DsMmdCW3SB4/VRp5jhId1QI/AAAAAAAAKJ4/VsciWawpYJs/w979-h590-no/IMG_20150331_143231.jpg" /></span></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p271941">
				<div class="post-metadata">
					<div class="post-num">Post #73</div>
					<div class="post-author">bopnrgi</div>
					<div class="post-datetime">
						10 Apr 2015, 15:52					</div>
				</div>
				<div class="post-content content">
					<p>Thanks but i have a v9 version... <img src="https://forum.openwrt.org/img/smilies/hmm.png" width="15" height="15" alt="hmm" /><br />these JTAG GPIO have a different behavior ? (no blink at startup ?)</p><p>So if ture, in this case i will be able to modify behavior of mine ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p271942">
				<div class="post-metadata">
					<div class="post-num">Post #74</div>
					<div class="post-author">bopnrgi</div>
					<div class="post-datetime">
						10 Apr 2015, 15:56					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>pilovis wrote:</cite><blockquote><p>Just connect in series the N.C. of the first relay to the N.O of the second one.</p></blockquote></div><p>thanks but i have to use 2 relays for 1 output, not very ecologic / econmic.<br />I&#039;m searching for a software solution</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p272755">
				<div class="post-metadata">
					<div class="post-num">Post #75</div>
					<div class="post-author">pilovis</div>
					<div class="post-datetime">
						16 Apr 2015, 18:20					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>bopnrgi wrote:</cite><blockquote><div class="quotebox"><cite>pilovis wrote:</cite><blockquote><p>Just connect in series the N.C. of the first relay to the N.O of the second one.</p></blockquote></div><p>thanks but i have to use 2 relays for 1 output, not very ecologic / econmic.<br />I&#039;m searching for a software solution</p></blockquote></div><p>There is no software solution, to avoid the leds blink at startup you need to modify the firmware.<br />Instead of using two relays you may use two transistors/mosfets and one relay to create the same logic,<br />or you&#039;d better use gpio on jtag of WR841ND to drive the relay.</p><p>Eventually you might use a Triac instead of the relay, it&#039;s more reliable, needs less drive current and its lifespan is higher than the relay, but you shoud pay attention to drive the triac at zero voltage crossing to avoid electrical noise.</p><p><span class="postimg"><img src="http://www.tech-blog.pl/wordpress/wp-content/uploads/2013/07/tp-link_tl-wr841nv8_jtag.jpg" alt="http://www.tech-blog.pl/wordpress/wp-content/uploads/2013/07/tp-link_tl-wr841nv8_jtag.jpg" /></span></p><p><span class="postimg"><img src="http://i.stack.imgur.com/C9u6F.png" alt="http://i.stack.imgur.com/C9u6F.png" /></span></p>											<p class="post-edited">(Last edited by <strong>pilovis</strong> on 16 Apr 2015, 18:55)</p>
									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 3 of 4</div><nav><ul><li><a href="viewtopic.php%3Fid=54722&amp;p=1.html">1</a></li><li><a href="viewtopic.php%3Fid=54722&amp;p=2.html">2</a></li><li class="pagination-current"><span>3</span></li><li><a href="viewtopic.php%3Fid=54722&amp;p=4.html">4</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0.001 -->

</body>
</html>