<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Reflashing CFE using JTAG + HairyDairyMaid util</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 25 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p26795">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">midblue</div>
					<div class="post-datetime">
						8 May 2006, 20:14					</div>
				</div>
				<div class="post-content content">
					<p>I recently bricked my router, a WRT54g v1.0, and was unable to recover using the shorting pins + tftp method, so I constructed a JTAG cable and I am trying to reflash the CFE using the utility written by HairyDairyMaid.&nbsp; I got a new CFE.bin from this site: <a href="http://lonewolf.hacker-nin.com/wrt/cfe/">http://lonewolf.hacker-nin.com/wrt/cfe/</a></p><p>I am running the utility on Windows.&nbsp; I loaded the giveio driver, and I was able to get my PC to talk to the router, and I get the following output, using v4.5 of the utility:</p><p>******************************************************</p><p>C:\openwrt\flash&gt;wrt54g -flash:cfe /noreset /nobreak /silent</p><p>====================================<br />WRT54G/GS EJTAG Debrick Utility v4.5<br />====================================</p><p>Probing bus ... Done</p><p>Instruction Length set to 5</p><p>CPU Chip ID: 00000100011100010000000101111111 (0471017F)<br />*** Found a Broadcom BCM4702 Rev 1 CPU chip ***</p><p>&nbsp; &nbsp; - EJTAG IMPCODE ....... : 00000000100000000000100100001000 (00800908)<br />&nbsp; &nbsp; - EJTAG Version ....... : 1 or 2.0<br />&nbsp; &nbsp; - EJTAG DMA Support ... : Yes</p><p>Issuing Processor / Peripheral Reset ... Skipped<br />Enabling Memory Writes ... Done<br />Halting Processor ... Skipped<br />Clearing Watchdog ... Done</p><p>Probing Flash at (Flash Window: 0x1fc00000) ... Done</p><p>Flash Vendor ID: 00000000000000000000000000000001 (00000001)<br />Flash Device ID: 00000000000000000010001011111001 (000022F9)<br />*** Found a AMD 29lv320DB 2Mx16 BotB&nbsp; &nbsp;(4MB) Flash Chip ***</p><p>&nbsp; &nbsp; - Flash Chip Window Start .... : 1fc00000<br />&nbsp; &nbsp; - Flash Chip Window Length ... : 00400000<br />&nbsp; &nbsp; - Selected Area Start ........ : 1fc00000<br />&nbsp; &nbsp; - Selected Area Length ....... : 00040000</p><p>*** You Selected to Flash the CFE.BIN ***</p><p>=========================<br />Flashing Routine Started<br />=========================<br />Total Blocks to Erase: 11</p><p>Erasing block: 1 (addr = 1fc00000)...Done</p><p>Erasing block: 2 (addr = 1fc02000)...Done</p><p>Erasing block: 3 (addr = 1fc04000)...Done</p><p>Erasing block: 4 (addr = 1fc06000)...Done</p><p>Erasing block: 5 (addr = 1fc08000)...Done</p><p>Erasing block: 6 (addr = 1fc0a000)...Done</p><p>Erasing block: 7 (addr = 1fc0c000)...Done</p><p>Erasing block: 8 (addr = 1fc0e000)...Done</p><p>Erasing block: 9 (addr = 1fc10000)...Done</p><p>Erasing block: 10 (addr = 1fc20000)...Done</p><p>Erasing block: 11 (addr = 1fc30000)...Done</p><br /><p>Loading CFE.BIN to Flash Memory...<br />&nbsp; &nbsp;4%&nbsp; &nbsp;bytes = 12216</p><p>********************************************</p><p>It always halts at this point during the flash.&nbsp; I have tried starting the flash within 1 second of the router being powered on, or powering it on and waiting an hour or two, but to no avail.&nbsp; I have to use the /noreset /nobreak switches or it halts during the &quot;Clearing watchdog&quot; step.&nbsp; Before I tried this, I was able to successfully run -backup:cfe, -erase:nvram, and -erase:kernel, but unfortunately that still did not produce a ping response, so I am trying to reflash the CFE.&nbsp; Does anyone have any idea why this might be failing?&nbsp; Could it be a problem with the CFEs from that site?&nbsp; I don&#039;t think that&#039;s it since it fails even while trying to reflash the backup.&nbsp; Could it be a problem with the cable, or with my PC?&nbsp; Should I try running the utility from Linux?&nbsp; Any ideas or thoughts would be greatly apprecated, as non v5 routers are currently a bit expensive on ebay.&nbsp; Thank you very much.</p><p>-Anthony</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p26832">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">dadaniel</div>
					<div class="post-datetime">
						9 May 2006, 13:46					</div>
				</div>
				<div class="post-content content">
					<p>The CFE MUST fit the right MAC-adresses of the router.</p><p>Use these tools: <a href="http://www.wlan-skynet.de/download/skynet_repairkit_1.2_setup.exe">http://www.wlan-skynet.de/download/skyn … _setup.exe</a></p><br /><p>With the included CFE generator you can build custom images for your router</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p26837">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">midblue</div>
					<div class="post-datetime">
						9 May 2006, 16:29					</div>
				</div>
				<div class="post-content content">
					<p>I constructed a CFE.BIN using the utility you posted and I tried it again, but I still get the same result.&nbsp; It hangs at &quot;4%&nbsp; &nbsp;bytes = 12216&quot;.&nbsp; Actually, the link that I posted in my original post did allow me to specifiy the MAC address of the router so I doubt that&#039;s the problem.&nbsp; That is a pretty useful tool to have around though.&nbsp; Any other ideas?&nbsp; This is really annoying.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p26840">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">midblue</div>
					<div class="post-datetime">
						9 May 2006, 17:06					</div>
				</div>
				<div class="post-content content">
					<p>Wow, okay, so I got it to work.&nbsp; This is weird though.&nbsp; The only way I was able to get the CFE to work was to create a CFE for a WRT54G v1.1 - however, my WRT is -definitely- a 1.0.&nbsp; The serial number starts with CDF1 and the wireless NIC is a mini-pci card, not soldered to the board.&nbsp; But as soon as I tried the CFE.bin for a 1.1, it loaded flawlessly and sat there and waited patiently for me to tftp it some OpenWRT goodness, and in a few minutes I was staring open-mouthed at a telnet prompt.&nbsp; Well, I guess I don&#039;t care much why it&#039;s working, as long as it&#039;s working, but has anyone ever ran into this issue before?&nbsp; Maybe the v1.0 CFEs that are out there on the net are not correct.&nbsp; Oh well, thanks for your help.</p><p>-Anthony</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p40811">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">ds18s20</div>
					<div class="post-datetime">
						15 Jan 2007, 05:45					</div>
				</div>
				<div class="post-content content">
					<p>hmmm this is soo strange. The jtag should be loading ANY file into flash no matter the substance of the file itself. Why would it lock up with different CFE?</p><p>Anyone has any good ideas about that? I shoud be able to load most any CFE, of course doesnt mean the router will work but the LOAD SHOULD WORK all the time?</p><p>Thanks<br />~Boyan</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p43347">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">theunf</div>
					<div class="post-datetime">
						27 Feb 2007, 14:32					</div>
				</div>
				<div class="post-content content">
					<p>What´s the diferences to use HeiryDairyMaid util with WRT54G version 6 ? Where can i get an updated CFE for this hw ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p43714">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">ds18s20</div>
					<div class="post-datetime">
						5 Mar 2007, 07:34					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>theunf wrote:</cite><blockquote><p>What´s the diferences to use HeiryDairyMaid util with WRT54G version 6 ? Where can i get an updated CFE for this hw ?</p></blockquote></div><p>I saw v5 CFE at the site that the original poster worte:</p><p><a href="http://lonewolf.hacker-nin.com/wrt/cfe/">http://lonewolf.hacker-nin.com/wrt/cfe/</a></p><p>Oops my bad, you need v6 and that is NOT published on the German site.</p>											<p class="post-edited">(Last edited by <strong>ds18s20</strong> on 5 Mar 2007, 07:37)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p59379">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">Ray_A</div>
					<div class="post-datetime">
						22 Nov 2007, 20:41					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>midblue wrote:</cite><blockquote><p>It always halts at this point during the flash.&nbsp; I have tried starting the flash within 1 second of the router being powered on, or powering it on and waiting an hour or two, but to no avail.&nbsp; I have to use the /noreset /nobreak switches or it halts during the &quot;Clearing watchdog&quot; step.&nbsp; Before I tried this, I was able to successfully run -backup:cfe, -erase:nvram, and -erase:kernel, but unfortunately that still did not produce a ping response, so I am trying to reflash the CFE.&nbsp; Does anyone have any idea why this might be failing?&nbsp; Could it be a problem with the CFEs from that site?&nbsp; I don&#039;t think that&#039;s it since it fails even while trying to reflash the backup.&nbsp; Could it be a problem with the cable, or with my PC?&nbsp; Should I try running the utility from Linux?&nbsp; Any ideas or thoughts would be greatly apprecated, as non v5 routers are currently a bit expensive on ebay.&nbsp; Thank you very much.</p><p>-Anthony</p></blockquote></div><p>I just recently had the EXACT same problem with my WRT54G v1.0. Flashing with CFE.BIN would stop/freeze at 4% no matter what I do. I will try your solution and see what happens. I will post the results as soon as I try that....</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p59385">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">Ray_A</div>
					<div class="post-datetime">
						22 Nov 2007, 21:14					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Ray_A wrote:</cite><blockquote><p>I just recently had the EXACT same problem with my WRT54G v1.0. Flashing with CFE.BIN would stop/freeze at 4% no matter what I do. I will try your solution and see what happens. I will post the results as soon as I try that....</p></blockquote></div><p>Wow...The same solution (loading a CFE.BIN for version 1.1 of the router) worked for me as well.&nbsp; The CFE.BIN is being flashed as we speak and it already past %4 mark where it used to freeze before. Let&#039;s see how the rest of the recovery will go. Will post results...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p59388">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">Ray_A</div>
					<div class="post-datetime">
						22 Nov 2007, 21:59					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Ray_A wrote:</cite><blockquote><p>Wow...The same solution (loading a CFE.BIN for version 1.1 of the router) worked for me as well.&nbsp; The CFE.BIN is being flashed as we speak and it already past %4 mark where it used to freeze before. Let&#039;s see how the rest of the recovery will go. Will post results...</p></blockquote></div><p>SUCCESS!! with flashing the CFE.BIN. Now the red diag led is off and other LEDs started to flash too. Looks like the router will be back in business. Further updates will follow....</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p59390">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">Ray_A</div>
					<div class="post-datetime">
						22 Nov 2007, 22:17					</div>
				</div>
				<div class="post-content content">
					<p>YUP!, back in business with the version 4.30 of the stock firmware flashed and the config data recovered from disk.&nbsp; Awesome!!!.... I almost tossed this router to garbage. Now it&#039;s time to de-commission the D-Link DI-624 (which keeps dropping network connections) I was using as a replacement. My old trusty Linksys never had that kind of problem and it was rock solid.... Many thanks go to each and every person who shared/made available their experiences/knowledge in debricking.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p77039">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">ninjamaster</div>
					<div class="post-datetime">
						25 Nov 2008, 10:30					</div>
				</div>
				<div class="post-content content">
					<p>im out of business, is there a linux version of skynet?&nbsp; i really do NOT want to wine skynet repair kit to generate cfe images as i do not want to install wine to support a singular prog and have wine cluttering things up.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>