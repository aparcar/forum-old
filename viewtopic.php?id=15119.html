<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Problems with SD-card/MMC-driver on Fonera.</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 11 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p66100">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">NMI</div>
					<div class="post-datetime">
						1 Apr 2008, 00:22					</div>
				</div>
				<div class="post-content content">
					<p>I just added a SD-card to my fonera and patched openwrt with the patches in <a href="https://dev.openwrt.org/ticket/1861">https://dev.openwrt.org/ticket/1861</a></p><p>And I&#039;ve been somewhat successful, the card is detected and I could read data from it, so the hardware appears to work.<br />BUT when I try to run fdisk to repartition the card I only get errors (see below).</p><p>Does anyone recognize what might be wrong?</p><p>And a more general question: where can I find information about what &quot;error -51&quot; and &quot;error -22&quot; stands for?</p><div class="codebox"><pre><code>mmc_spi spi32766.0: ASSUMING 3.2-3.4 V slot power
mmc_spi spi32766.0: SD/MMC host mmc0, no DMA, no WP, no poweroff
spi-gpio-mmc: MMC-Card &quot;fonera&quot; attached to GPIO pins 1,3,4,7
mmc_spi spi32766.0: can&#039;t change chip-select polarity
mmc0: new SD card on SPI
mmcblk0: mmc0:0000 SD01G 992000KiB</code></pre></div><div class="codebox"><pre><code>root@OpenWrt:/tmp# fdisk /dev/mmcblk0 
mmcblk0: error -22 sending read/write command
end_request: I/O error, dev mmcblk0, sector 0
Buffer I/O error on device mmcblk0, logical block 0
mmcblk0: error -22 sending read/write command
end_request: I/O error, dev mmcblk0, sector 8
Buffer I/O error on device mmcblk0, logical block 1
mmcblk0: error -22 sending read/write command
end_request: I/O error, dev mmcblk0, sector 16
Buffer I/O error on device mmcblk0, logical block 2
mmcblk0: error -22 sending read/write command
end_request: I/O error, dev mmcblk0, sector 24
Buffer I/O error on device mmcblk0, logical block 3
mmcblk0: error -22 sending read/write command
end_request: I/O error, dev mmcblk0, sector 0
Buffer I/O error on device mmcblk0, logical block 0
mmcblk0: error -22 sending read/write command
end_request: I/O error, dev mmcblk0, sector 1983992
Buffer I/O error on device mmcblk0, logical block 247999
mmcblk0: error -22 sending read/write command
end_request: I/O error, dev mmcblk0, sector 1983992
Buffer I/O error on device mmcblk0, logical block 247999
mmcblk0: error -22 sending read/write command
end_request: I/O error, dev mmcblk0, sector 0
Buffer I/O error on device mmcblk0, logical block 0
mmcblk0: error -22 sending read/write command
end_request: I/O error, dev mmcblk0, sector 8
Buffer I/O error on device mmcblk0, logical block 1
mmcblk0: error -22 sending read/write command
end_request: I/O error, dev mmcblk0, sector 16
Buffer I/O error on device mmcblk0, logical block 2
mmcblk0: error -22 sending read/write command
end_request: I/O error, dev mmcblk0, sector 24
mmcblk0: error -22 sending read/write command
end_request: I/O error, dev mmcblk0, sector 0

Unable to read /dev/mmcblk0
root@OpenWrt:/tmp#</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p66389">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">NMI</div>
					<div class="post-datetime">
						5 Apr 2008, 23:20					</div>
				</div>
				<div class="post-content content">
					<p>I put the SD-card in my other linux computer and partitioned the card the way I wanted, then I put it back in the Fonera and was able to format, mount and use the card without any problem at all, so the hardware is correct. But as soon as I try to use fdisk on it, things go wrong and I can&#039;t use the card at all anymore until I reboot the Fonera.</p><p>My conclution is that it&#039;s the mmc_over_gpio driver that does not work 100% with my Sandisk 1GB card. <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /><br />And it is the following error message that is the important one, all errors after this one is just symptoms of the original error:<br /></p><div class="codebox"><pre><code>mmcblk0: error -51 sending stop command
end_request: I/O error, dev mmcblk0, sector 1983992
Buffer I/O error on device mmcblk0, logical block 247999</code></pre></div>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>