<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Unifi AP - not saving changes after sysupgrade</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 31 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p314022">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">borsss</div>
					<div class="post-datetime">
						8 Mar 2016, 17:06					</div>
				</div>
				<div class="post-content content">
					<p>I am relatively new to openwrt, using custom built image. Factory install goes just fine, however sysupgrade results in changes not being saved after subsequent reboots. Additional clue - sysupgrade.tgz is left in / after reboot.</p><p>Bootlog (first after upgrade) is below, any advice is very much appreciated:</p><div class="codebox"><pre><code>root@router:/# sysupgrade /tmp/as_2016030807_d-sysupgrade.bin 
Saving config files...
killall: watchdog: no process killed
Sending TERM to remaining processes ... monit udhcpc dnsmasq chilli chilli ntpd sh sh sleep ubusd logd logread netifd odhcpd crond lighttpd netserver 
Sending KILL to remaining processes ... 
Switching to ramdisk...
Performing system upgrade...
Unlocking firmware ...

Writing from &lt;stdin&gt; to firmware ...     
Appending jffs2 data from /tmp/sysupgrade.tgz to firmware...TRX header not found
Error fixing up TRX header
    
Upgrade completed
Rebooting system...
[  448.730000] reboot: Restarting system


U-Boot unifi-v1.5.2.206-g44e4c8bc (Aug 29 2014 - 18:01:57)

DRAM:  64 MB
Flash:  8 MB
PCIe WLAN Module found (tries: 1). 
Net:   eth0, eth1
Board: Copyright Ubiquiti Networks Inc. 2014
Hit any key to stop autoboot:  0 
Board: Ubiquiti Networks AR7241 board (e502-18.0101.002e)
UBNT application initialized 
## Booting image at 9f050000 ...
   Image Name:   MIPS OpenWrt Linux-3.18.20
   Created:      2016-03-08  14:33:50 UTC
   Image Type:   MIPS Linux Kernel Image (lzma compressed)
   Data Size:    1098502 Bytes =  1 MB
   Load Address: 80060000
   Entry Point:  80060000
   Verifying Checksum at 0x9f050040 ...OK
   Uncompressing Kernel Image ... OK

Starting kernel ...

[    0.000000] Linux version 3.18.20 (buildbot@builder1) (gcc version 4.8.3 (OpenWrt/Linaro GCC 4.8-2014.04 r46450) ) #1 Fri Sep 4 21:55:57 CEST 2015
[    0.000000] bootconsole [early0] enabled
[    0.000000] CPU0 revision is: 00019374 (MIPS 24Kc)
[    0.000000] SoC: Atheros AR7241 rev 1
[    0.000000] Determined physical RAM map:
[    0.000000]  memory: 04000000 @ 00000000 (usable)
[    0.000000] Initrd not found or empty - disabling initrd
[    0.000000] Zone ranges:
[    0.000000]   Normal   [mem 0x00000000-0x03ffffff]
[    0.000000] Movable zone start for each node
[    0.000000] Early memory node ranges
[    0.000000]   node   0: [mem 0x00000000-0x03ffffff]
[    0.000000] Initmem setup node 0 [mem 0x00000000-0x03ffffff]
[    0.000000] Primary instruction cache 64kB, VIPT, 4-way, linesize 32 bytes.
[    0.000000] Primary data cache 32kB, 4-way, VIPT, cache aliases, linesize 32 bytes
[    0.000000] Built 1 zonelists in Zone order, mobility grouping on.  Total pages: 16256
[    0.000000] Kernel command line:  board=UBNT-UF console=ttyS0,115200 mtdparts=spi0.0:256k(u-boot)ro,64k(u-boot-env)ro,7552k(firmware),256k(cfg)ro,64k(EEPROM)ro rootfstype=squashfs,jffs2 noinitrd
[    0.000000] PID hash table entries: 256 (order: -2, 1024 bytes)
[    0.000000] Dentry cache hash table entries: 8192 (order: 3, 32768 bytes)
[    0.000000] Inode-cache hash table entries: 4096 (order: 2, 16384 bytes)
[    0.000000] Writing ErrCtl register=00000000
[    0.000000] Readback ErrCtl register=00000000
[    0.000000] Memory: 61004K/65536K available (2621K kernel code, 129K rwdata, 344K rodata, 224K init, 194K bss, 4532K reserved)
[    0.000000] SLUB: HWalign=32, Order=0-3, MinObjects=0, CPUs=1, Nodes=1
[    0.000000] NR_IRQS:51
[    0.000000] Clocks: CPU:390.000MHz, DDR:390.000MHz, AHB:195.000MHz, Ref:5.000MHz
[    0.000000] Calibrating delay loop... 259.27 BogoMIPS (lpj=1296384)
[    0.070000] pid_max: default: 32768 minimum: 301
[    0.070000] Mount-cache hash table entries: 1024 (order: 0, 4096 bytes)
[    0.080000] Mountpoint-cache hash table entries: 1024 (order: 0, 4096 bytes)
[    0.090000] NET: Registered protocol family 16
[    0.090000] MIPS: machine is Ubiquiti UniFi
[    0.320000] registering PCI controller with io_map_base unset
[    0.330000] PCI host bridge to bus 0000:00
[    0.340000] pci_bus 0000:00: root bus resource [mem 0x10000000-0x13ffffff]
[    0.340000] pci_bus 0000:00: root bus resource [io  0x0000]
[    0.350000] pci_bus 0000:00: No busn resource found for root bus, will use [bus 00-ff]
[    0.350000] pci 0000:00:00.0: fixup device configuration
[    0.360000] pci 0000:00:00.0: BAR 0: assigned [mem 0x10000000-0x1000ffff 64bit]
[    0.360000] pci 0000:00:00.0: using irq 40 for pin 1
[    0.370000] Switched to clocksource MIPS
[    0.370000] NET: Registered protocol family 2
[    0.380000] TCP established hash table entries: 1024 (order: 0, 4096 bytes)
[    0.380000] TCP bind hash table entries: 1024 (order: 0, 4096 bytes)
[    0.390000] TCP: Hash tables configured (established 1024 bind 1024)
[    0.400000] TCP: reno registered
[    0.400000] UDP hash table entries: 256 (order: 0, 4096 bytes)
[    0.400000] UDP-Lite hash table entries: 256 (order: 0, 4096 bytes)
[    0.410000] NET: Registered protocol family 1
[    0.420000] futex hash table entries: 256 (order: -1, 3072 bytes)
[    0.430000] squashfs: version 4.0 (2009/01/31) Phillip Lougher
[    0.440000] jffs2: version 2.2 (NAND) (SUMMARY) (LZMA) (RTIME) (CMODE_PRIORITY) (c) 2001-2006 Red Hat, Inc.
[    0.450000] msgmni has been set to 119
[    0.450000] io scheduler noop registered
[    0.460000] io scheduler deadline registered (default)
[    0.460000] Serial: 8250/16550 driver, 16 ports, IRQ sharing enabled
[    0.470000] console [ttyS0] disabled
[    0.500000] serial8250.0: ttyS0 at MMIO 0x18020000 (irq = 11, base_baud = 12187500) is a 16550A
[    0.510000] console [ttyS0] enabled
[    0.510000] console [ttyS0] enabled
[    0.510000] bootconsole [early0] disabled
[    0.510000] bootconsole [early0] disabled
[    0.520000] m25p80 spi0.0: found mx25l6405d, expected m25p80
[    0.530000] m25p80 spi0.0: mx25l6405d (8192 Kbytes)
[    0.530000] 5 cmdlinepart partitions found on MTD device spi0.0
[    0.540000] Creating 5 MTD partitions on &quot;spi0.0&quot;:
[    0.540000] 0x000000000000-0x000000040000 : &quot;u-boot&quot;
[    0.550000] 0x000000040000-0x000000050000 : &quot;u-boot-env&quot;
[    0.560000] 0x000000050000-0x0000007b0000 : &quot;firmware&quot;
[    0.580000] 2 uimage-fw partitions found on MTD device firmware
[    0.590000] 0x000000050000-0x00000015c346 : &quot;kernel&quot;
[    0.590000] 0x00000015c346-0x0000007b0000 : &quot;rootfs&quot;
[    0.600000] mtd: device 4 (rootfs) set to be root filesystem
[    0.600000] 1 squashfs-split partitions found on MTD device rootfs
[    0.610000] 0x000000670000-0x0000007b0000 : &quot;rootfs_data&quot;
[    0.620000] 0x0000007b0000-0x0000007f0000 : &quot;cfg&quot;
[    0.620000] 0x0000007f0000-0x000000800000 : &quot;EEPROM&quot;
[    0.660000] libphy: ag71xx_mdio: probed
[    1.250000] ag71xx ag71xx.0: connected to PHY at ag71xx-mdio.1:04 [uid=004dd041, driver=Generic PHY]
[    1.260000] eth0: Atheros AG71xx at 0xb9000000, irq 4, mode:MII
[    1.260000] TCP: cubic registered
[    1.270000] NET: Registered protocol family 17
[    1.270000] bridge: automatic filtering via arp/ip/ip6tables has been deprecated. Update your scripts to load br_netfilter if you need this.
[    1.280000] Bridge firewalling registered
[    1.290000] 8021q: 802.1Q VLAN Support v1.8
[    1.300000] VFS: Mounted root (squashfs filesystem) readonly on device 31:4.
[    1.310000] Freeing unused kernel memory: 224K (80368000 - 803a0000)
[    2.700000] init: Console is alive
[    2.710000] init: - watchdog -
[    4.470000] usbcore: registered new interface driver usbfs
[    4.480000] usbcore: registered new interface driver hub
[    4.480000] usbcore: registered new device driver usb
[    4.490000] ehci_hcd: USB 2.0 &#039;Enhanced&#039; Host Controller (EHCI) Driver
[    4.500000] ehci-platform: EHCI generic platform driver
[    4.510000] ohci_hcd: USB 1.1 &#039;Open&#039; Host Controller (OHCI) Driver
[    4.520000] ohci-platform: OHCI generic platform driver
[    4.760000] init: - preinit -
[    5.440000] random: procd urandom read with 8 bits of entropy available
Press the [f] key and hit [enter] to enter failsafe mode
Press the [1], [2], [3] or [4] key and hit [enter] to select the debug level
[    8.400000] eth0: link up (100Mbps/Full duplex)
[    8.630000] jffs2_scan_eraseblock(): End of filesystem marker found at 0x10000
[    8.640000] jffs2_build_filesystem(): unlocking the mtd device... done.
[    8.650000] jffs2_build_filesystem(): erasing all blocks after the end marker... done.
[   17.020000] jffs2: notice: (337) jffs2_build_xattr_subsystem: complete building xattr subsystem, 0 of xdatum (0 unchecked, 0 orphan) and 0 of xref (0 dead, 0 orphan) found.
[   17.040000] mount_root: overlay filesystem has not been fully initialized yet
[   17.070000] mount_root: switching to jffs2 overlay
- config restore -
[   18.560000] eth0: link down
[   18.580000] procd: - early -
[   18.580000] procd: - watchdog -
[   19.270000] procd: - ubus -
[   20.290000] procd: - init -
Please press Enter to activate this console.
[   21.890000] NET: Registered protocol family 10
[   21.900000] tun: Universal TUN/TAP device driver, 1.6
[   21.910000] tun: (C) 1999-2004 Max Krasnyansky &lt;maxk@qualcomm.com&gt;
[   21.920000] gre: GRE over IPv4 demultiplexor driver
[   21.920000] ip_gre: GRE over IPv4 tunneling driver
[   21.940000] Netfilter messages via NETLINK v0.30.
[   21.940000] ip_set: protocol 6
[   22.040000] i2c /dev entries driver
[   22.050000] Loading modules backported from Linux version master-2015-03-09-0-g141f155
[   22.060000] Backport generated by backports.git backports-20150129-0-gdd4a670
[   22.070000] ip_tables: (C) 2000-2006 Netfilter Core Team
[   22.100000] nf_conntrack version 0.5.0 (956 buckets, 3824 max)
[   22.170000] xt_time: kernel timezone is -0000
[   22.230000] cfg80211: Calling CRDA to update world regulatory domain
[   22.250000] Error: Driver &#039;gpio-keys&#039; is already registered, aborting...
[   22.260000] cfg80211: World regulatory domain updated:
[   22.260000] cfg80211:  DFS Master region: unset
[   22.260000] cfg80211:   (start_freq - end_freq @ bandwidth), (max_antenna_gain, max_eirp), (dfs_cac_time)
[   22.270000] cfg80211:   (2402000 KHz - 2472000 KHz @ 40000 KHz), (N/A, 2000 mBm), (N/A)
[   22.280000] cfg80211:   (2457000 KHz - 2482000 KHz @ 40000 KHz), (N/A, 2000 mBm), (N/A)
[   22.290000] cfg80211:   (2474000 KHz - 2494000 KHz @ 20000 KHz), (N/A, 2000 mBm), (N/A)
[   22.300000] cfg80211:   (5170000 KHz - 5250000 KHz @ 80000 KHz), (N/A, 2000 mBm), (N/A)
[   22.310000] cfg80211:   (5250000 KHz - 5330000 KHz @ 80000 KHz, 160000 KHz AUTO), (N/A, 2000 mBm), (0 s)
[   22.320000] cfg80211:   (5490000 KHz - 5730000 KHz @ 160000 KHz), (N/A, 2000 mBm), (0 s)
[   22.320000] cfg80211:   (5735000 KHz - 5835000 KHz @ 80000 KHz), (N/A, 2000 mBm), (N/A)
[   22.330000] cfg80211:   (57240000 KHz - 63720000 KHz @ 2160000 KHz), (N/A, 0 mBm), (N/A)
[   22.450000] PPP generic driver version 2.4.2
[   22.460000] PPP MPPE Compression module registered
[   22.470000] NET: Registered protocol family 24
[   22.470000] PPTP driver version 0.8.5
[   22.550000] Error: Driver &#039;gpio-keys&#039; is already registered, aborting...
[   22.580000] Error: Driver &#039;gpio-keys&#039; is already registered, aborting...
[   22.590000] PCI: Enabling device 0000:00:00.0 (0000 -&gt; 0002)
[   22.630000] ieee80211 phy0: Atheros AR9287 Rev:2 mem=0xb0000000, irq=40
[   22.640000] cfg80211: Calling CRDA for country: US
[   22.640000] cfg80211: Regulatory domain changed to country: US
[   22.650000] cfg80211:  DFS Master region: FCC
[   22.650000] cfg80211:   (start_freq - end_freq @ bandwidth), (max_antenna_gain, max_eirp), (dfs_cac_time)
[   22.660000] cfg80211:   (2402000 KHz - 2472000 KHz @ 40000 KHz), (N/A, 3000 mBm), (N/A)
[   22.670000] cfg80211:   (5170000 KHz - 5250000 KHz @ 80000 KHz, 160000 KHz AUTO), (N/A, 1700 mBm), (N/A)
[   22.680000] cfg80211:   (5250000 KHz - 5330000 KHz @ 80000 KHz, 160000 KHz AUTO), (N/A, 2300 mBm), (0 s)
[   22.690000] cfg80211:   (5735000 KHz - 5835000 KHz @ 80000 KHz), (N/A, 3000 mBm), (N/A)
[   22.700000] cfg80211:   (57240000 KHz - 63720000 KHz @ 2160000 KHz), (N/A, 4000 mBm), (N/A)
[   22.710000] Error: Driver &#039;gpio-keys&#039; is already registered, aborting...
[   22.720000] Error: Driver &#039;gpio-keys&#039; is already registered, aborting...</code></pre></div>											<p class="post-edited">(Last edited by <strong>borsss</strong> on 8 Mar 2016, 20:25)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>