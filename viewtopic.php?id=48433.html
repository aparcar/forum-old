<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> OpenWRT ssh port won&#039;t respond from wan.?SOLVED?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 30 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p222782">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">jokies</div>
					<div class="post-datetime">
						15 Jan 2014, 06:46					</div>
				</div>
				<div class="post-content content">
					<p>Is there anything wrong with my firewall? I also tried to forward it to other ports, but it won&#039;t work.<br />Dropbear is also set to listen on all interface.<br />firewall config:</p><p>config redirect<br />&nbsp; &nbsp; option target &#039;DNAT&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option dest &#039;lan&#039;<br />&nbsp; &nbsp; option src_dport &#039;2220-2229&#039;<br />&nbsp; &nbsp; option name &#039;SSH&#039;<br />&nbsp; &nbsp; option dest_ip &#039;192.168.2.1&#039;<br />&nbsp; &nbsp; option dest_port &#039;22&#039;<br />&nbsp; &nbsp; option proto &#039;tcp udp&#039;</p><p>config redirect<br />&nbsp; &nbsp; option target &#039;DNAT&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option dest &#039;lan&#039;<br />&nbsp; &nbsp; option proto &#039;tcp udp&#039;<br />&nbsp; &nbsp; option dest_ip &#039;192.168.2.4&#039;<br />&nbsp; &nbsp; option dest_port &#039;22&#039;<br />&nbsp; &nbsp; option name &#039;SSHMAGI&#039;<br />&nbsp; &nbsp; option src_dport &#039;1110-1119&#039;</p><p>config redirect<br />&nbsp; &nbsp; option target &#039;DNAT&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option dest &#039;lan&#039;<br />&nbsp; &nbsp; option proto &#039;tcp udp&#039;<br />&nbsp; &nbsp; option src_dport &#039;22220-22229&#039;<br />&nbsp; &nbsp; option dest_ip &#039;192.168.2.222&#039;<br />&nbsp; &nbsp; option dest_port &#039;22&#039;<br />&nbsp; &nbsp; option name &#039;SSHNAS&#039;</p><p>config redirect<br />&nbsp; &nbsp; option target &#039;DNAT&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option dest &#039;lan&#039;<br />&nbsp; &nbsp; option proto &#039;tcp udp&#039;<br />&nbsp; &nbsp; option dest_ip &#039;192.168.2.220&#039;<br />&nbsp; &nbsp; option dest_port &#039;22&#039;<br />&nbsp; &nbsp; option name &#039;SSHSERVER&#039;<br />&nbsp; &nbsp; option src_dport &#039;11110-11119&#039;</p><p>config redirect<br />&nbsp; &nbsp; option target &#039;DNAT&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option dest &#039;lan&#039;<br />&nbsp; &nbsp; option proto &#039;tcp udp&#039;<br />&nbsp; &nbsp; option src_dport &#039;12340-12349&#039;<br />&nbsp; &nbsp; option dest_ip &#039;192.168.2.222&#039;<br />&nbsp; &nbsp; option dest_port &#039;12345&#039;<br />&nbsp; &nbsp; option name &#039;NASMainPort&#039;</p><p>config redirect<br />&nbsp; &nbsp; option target &#039;DNAT&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option dest &#039;lan&#039;<br />&nbsp; &nbsp; option proto &#039;tcp udp&#039;<br />&nbsp; &nbsp; option dest_ip &#039;192.168.2.110&#039;<br />&nbsp; &nbsp; option dest_port &#039;1234&#039;<br />&nbsp; &nbsp; option name &#039;WebCam&#039;<br />&nbsp; &nbsp; option src_dport &#039;1230-1239&#039;</p><p>config redirect<br />&nbsp; &nbsp; option target &#039;DNAT&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option dest &#039;lan&#039;<br />&nbsp; &nbsp; option proto &#039;tcp udp&#039;<br />&nbsp; &nbsp; option src_dport &#039;54320-54329&#039;<br />&nbsp; &nbsp; option dest_ip &#039;192.168.2.222&#039;<br />&nbsp; &nbsp; option dest_port &#039;54321&#039;<br />&nbsp; &nbsp; option name &#039;NASTransmission&#039;</p><p>config redirect<br />&nbsp; &nbsp; option target &#039;DNAT&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option dest &#039;lan&#039;<br />&nbsp; &nbsp; option proto &#039;tcp udp&#039;<br />&nbsp; &nbsp; option src_dport &#039;54444&#039;<br />&nbsp; &nbsp; option dest_ip &#039;192.168.2.222&#039;<br />&nbsp; &nbsp; option dest_port &#039;54444&#039;<br />&nbsp; &nbsp; option name &#039;NASTransmissionListening&#039;</p><p>config redirect<br />&nbsp; &nbsp; option target &#039;DNAT&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option dest &#039;lan&#039;<br />&nbsp; &nbsp; option proto &#039;tcp udp&#039;<br />&nbsp; &nbsp; option src_dport &#039;54400&#039;<br />&nbsp; &nbsp; option dest_ip &#039;192.168.2.222&#039;<br />&nbsp; &nbsp; option dest_port &#039;54400&#039;<br />&nbsp; &nbsp; option name &#039;NASDownloader&#039;</p><p>config redirect<br />&nbsp; &nbsp; option target &#039;DNAT&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option dest &#039;lan&#039;<br />&nbsp; &nbsp; option proto &#039;tcp udp&#039;<br />&nbsp; &nbsp; option src_dport &#039;64440-64449&#039;<br />&nbsp; &nbsp; option dest_ip &#039;192.168.2.222&#039;<br />&nbsp; &nbsp; option dest_port &#039;64444&#039;<br />&nbsp; &nbsp; option name &#039;NASAria2Backend&#039;</p><p>config redirect<br />&nbsp; &nbsp; option target &#039;DNAT&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option dest &#039;lan&#039;<br />&nbsp; &nbsp; option proto &#039;tcp udp&#039;<br />&nbsp; &nbsp; option dest_ip &#039;192.168.2.222&#039;<br />&nbsp; &nbsp; option name &#039;NASYAAW&#039;<br />&nbsp; &nbsp; option src_dport &#039;9990-9999&#039;<br />&nbsp; &nbsp; option dest_port &#039;9999&#039;</p><p>config redirect<br />&nbsp; &nbsp; option target &#039;DNAT&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option dest &#039;lan&#039;<br />&nbsp; &nbsp; option proto &#039;tcp&#039;<br />&nbsp; &nbsp; option src_dport &#039;80&#039;<br />&nbsp; &nbsp; option name &#039;HoneypotWebsite&#039;<br />&nbsp; &nbsp; option dest_ip &#039;192.168.2.6&#039;<br />&nbsp; &nbsp; option dest_port &#039;4444&#039;</p><p>config redirect<br />&nbsp; &nbsp; option target &#039;DNAT&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option dest &#039;lan&#039;<br />&nbsp; &nbsp; option proto &#039;tcp&#039;<br />&nbsp; &nbsp; option src_dport &#039;22&#039;<br />&nbsp; &nbsp; option name &#039;HoneypotSSH&#039;<br />&nbsp; &nbsp; option dest_ip &#039;192.168.2.6&#039;<br />&nbsp; &nbsp; option dest_port &#039;4444&#039;<br />&nbsp; &nbsp; option enabled &#039;0&#039;</p><p>config redirect<br />&nbsp; &nbsp; option target &#039;DNAT&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option dest &#039;lan&#039;<br />&nbsp; &nbsp; option proto &#039;tcp udp&#039;<br />&nbsp; &nbsp; option src_dport &#039;1723&#039;<br />&nbsp; &nbsp; option dest_ip &#039;192.168.2.4&#039;<br />&nbsp; &nbsp; option dest_port &#039;1723&#039;<br />&nbsp; &nbsp; option name &#039;PPTP&#039;<br />&nbsp; &nbsp; option enabled &#039;0&#039;</p><p>config redirect<br />&nbsp; &nbsp; option target &#039;DNAT&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option dest &#039;lan&#039;<br />&nbsp; &nbsp; option proto &#039;tcp udp&#039;<br />&nbsp; &nbsp; option src_dport &#039;47&#039;<br />&nbsp; &nbsp; option dest_ip &#039;192.168.2.4&#039;<br />&nbsp; &nbsp; option dest_port &#039;47&#039;<br />&nbsp; &nbsp; option name &#039;GRE&#039;<br />&nbsp; &nbsp; option enabled &#039;0&#039;</p><p>config redirect<br />&nbsp; &nbsp; option target &#039;DNAT&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option dest &#039;lan&#039;<br />&nbsp; &nbsp; option proto &#039;tcp udp&#039;<br />&nbsp; &nbsp; option src_dport &#039;2012&#039;<br />&nbsp; &nbsp; option dest_ip &#039;192.168.2.198&#039;<br />&nbsp; &nbsp; option dest_port &#039;2012&#039;<br />&nbsp; &nbsp; option name &#039;NC&#039;<br />&nbsp; &nbsp; option enabled &#039;0&#039;</p><p>config redirect<br />&nbsp; &nbsp; option target &#039;DNAT&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option dest &#039;lan&#039;<br />&nbsp; &nbsp; option proto &#039;tcp udp&#039;<br />&nbsp; &nbsp; option dest_ip &#039;192.168.2.220&#039;<br />&nbsp; &nbsp; option dest_port &#039;50000&#039;<br />&nbsp; &nbsp; option name &#039;SERVERMainPort&#039;<br />&nbsp; &nbsp; option src_dport &#039;50000-50009&#039;</p><p>config redirect<br />&nbsp; &nbsp; option target &#039;DNAT&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option dest &#039;lan&#039;<br />&nbsp; &nbsp; option proto &#039;tcp udp&#039;<br />&nbsp; &nbsp; option dest_ip &#039;192.168.2.220&#039;<br />&nbsp; &nbsp; option dest_port &#039;55555&#039;<br />&nbsp; &nbsp; option name &#039;SERVERTransmission&#039;<br />&nbsp; &nbsp; option src_dport &#039;55550-55559&#039;</p><p>config redirect<br />&nbsp; &nbsp; option target &#039;DNAT&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option dest &#039;lan&#039;<br />&nbsp; &nbsp; option proto &#039;tcp udp&#039;<br />&nbsp; &nbsp; option src_dport &#039;50044&#039;<br />&nbsp; &nbsp; option dest_ip &#039;192.168.2.220&#039;<br />&nbsp; &nbsp; option dest_port &#039;50044&#039;<br />&nbsp; &nbsp; option name &#039;SERVERTransmissionListening&#039;</p><p>config redirect<br />&nbsp; &nbsp; option target &#039;DNAT&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option dest &#039;lan&#039;<br />&nbsp; &nbsp; option proto &#039;tcp udp&#039;<br />&nbsp; &nbsp; option src_dport &#039;50444&#039;<br />&nbsp; &nbsp; option dest_ip &#039;192.168.2.220&#039;<br />&nbsp; &nbsp; option dest_port &#039;50444&#039;<br />&nbsp; &nbsp; option name &#039;SERVERDownloaderListening&#039;</p><p>config redirect<br />&nbsp; &nbsp; option target &#039;DNAT&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option dest &#039;lan&#039;<br />&nbsp; &nbsp; option proto &#039;tcp udp&#039;<br />&nbsp; &nbsp; option src_dport &#039;4644-4646&#039;<br />&nbsp; &nbsp; option dest_ip &#039;192.168.2.220&#039;<br />&nbsp; &nbsp; option dest_port &#039;4644-4646&#039;<br />&nbsp; &nbsp; option name &#039;SERVERMule&#039;</p><p>config redirect<br />&nbsp; &nbsp; option target &#039;DNAT&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option dest &#039;lan&#039;<br />&nbsp; &nbsp; option proto &#039;tcp udp&#039;<br />&nbsp; &nbsp; option dest_ip &#039;192.168.2.220&#039;<br />&nbsp; &nbsp; option name &#039;SERVERWebDAV&#039;<br />&nbsp; &nbsp; option src_dport &#039;64000-64009&#039;<br />&nbsp; &nbsp; option dest_port &#039;64000&#039;</p><p>config redirect<br />&nbsp; &nbsp; option target &#039;DNAT&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option dest &#039;lan&#039;<br />&nbsp; &nbsp; option proto &#039;tcp udp&#039;<br />&nbsp; &nbsp; option src_dport &#039;61230-61239&#039;<br />&nbsp; &nbsp; option dest_ip &#039;192.168.2.220&#039;<br />&nbsp; &nbsp; option dest_port &#039;61234&#039;<br />&nbsp; &nbsp; option name &#039;SERVERAria2Backend&#039;</p><p>config redirect<br />&nbsp; &nbsp; option target &#039;DNAT&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option dest &#039;lan&#039;<br />&nbsp; &nbsp; option proto &#039;tcp udp&#039;<br />&nbsp; &nbsp; option src_dport &#039;7770-7779&#039;<br />&nbsp; &nbsp; option dest_ip &#039;192.168.2.220&#039;<br />&nbsp; &nbsp; option dest_port &#039;7777&#039;<br />&nbsp; &nbsp; option name &#039;SERVERYAAW&#039;</p><p>config rule<br />&nbsp; &nbsp; option name &#039;Allow-DHCP-Renew&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option proto &#039;udp&#039;<br />&nbsp; &nbsp; option dest_port &#039;68&#039;<br />&nbsp; &nbsp; option target &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option family &#039;ipv4&#039;</p><p>config rule<br />&nbsp; &nbsp; option name &#039;Allow-Ping&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option proto &#039;icmp&#039;<br />&nbsp; &nbsp; option icmp_type &#039;echo-request&#039;<br />&nbsp; &nbsp; option family &#039;ipv4&#039;<br />&nbsp; &nbsp; option target &#039;ACCEPT&#039;</p><p>config rule<br />&nbsp; &nbsp; option name &#039;Allow-DHCPv6&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option proto &#039;udp&#039;<br />&nbsp; &nbsp; option src_ip &#039;fe80::/10&#039;<br />&nbsp; &nbsp; option src_port &#039;547&#039;<br />&nbsp; &nbsp; option dest_ip &#039;fe80::/10&#039;<br />&nbsp; &nbsp; option dest_port &#039;546&#039;<br />&nbsp; &nbsp; option family &#039;ipv6&#039;<br />&nbsp; &nbsp; option target &#039;ACCEPT&#039;</p><p>config rule<br />&nbsp; &nbsp; option name &#039;Allow-ICMPv6-Input&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option proto &#039;icmp&#039;<br />&nbsp; &nbsp; list icmp_type &#039;echo-request&#039;<br />&nbsp; &nbsp; list icmp_type &#039;echo-reply&#039;<br />&nbsp; &nbsp; list icmp_type &#039;destination-unreachable&#039;<br />&nbsp; &nbsp; list icmp_type &#039;packet-too-big&#039;<br />&nbsp; &nbsp; list icmp_type &#039;time-exceeded&#039;<br />&nbsp; &nbsp; list icmp_type &#039;bad-header&#039;<br />&nbsp; &nbsp; list icmp_type &#039;unknown-header-type&#039;<br />&nbsp; &nbsp; list icmp_type &#039;router-solicitation&#039;<br />&nbsp; &nbsp; list icmp_type &#039;neighbour-solicitation&#039;<br />&nbsp; &nbsp; list icmp_type &#039;router-advertisement&#039;<br />&nbsp; &nbsp; list icmp_type &#039;neighbour-advertisement&#039;<br />&nbsp; &nbsp; option limit &#039;1000/sec&#039;<br />&nbsp; &nbsp; option family &#039;ipv6&#039;<br />&nbsp; &nbsp; option target &#039;ACCEPT&#039;</p><p>config rule<br />&nbsp; &nbsp; option name &#039;Allow-ICMPv6-Forward&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option dest &#039;*&#039;<br />&nbsp; &nbsp; option proto &#039;icmp&#039;<br />&nbsp; &nbsp; list icmp_type &#039;echo-request&#039;<br />&nbsp; &nbsp; list icmp_type &#039;echo-reply&#039;<br />&nbsp; &nbsp; list icmp_type &#039;destination-unreachable&#039;<br />&nbsp; &nbsp; list icmp_type &#039;packet-too-big&#039;<br />&nbsp; &nbsp; list icmp_type &#039;time-exceeded&#039;<br />&nbsp; &nbsp; list icmp_type &#039;bad-header&#039;<br />&nbsp; &nbsp; list icmp_type &#039;unknown-header-type&#039;<br />&nbsp; &nbsp; option limit &#039;1000/sec&#039;<br />&nbsp; &nbsp; option family &#039;ipv6&#039;<br />&nbsp; &nbsp; option target &#039;ACCEPT&#039;</p><p>config rule<br />&nbsp; &nbsp; option src &#039;lan&#039;<br />&nbsp; &nbsp; option dest &#039;wan&#039;<br />&nbsp; &nbsp; option name &#039;XBOXLAN&#039;<br />&nbsp; &nbsp; option target &#039;DROP&#039;<br />&nbsp; &nbsp; option src_mac &#039;7C:1E:52:86:E0:6D&#039;<br />&nbsp; &nbsp; option proto &#039;tcp udp&#039;<br />&nbsp; &nbsp; option enabled &#039;0&#039;</p><p>config rule<br />&nbsp; &nbsp; option src &#039;lan&#039;<br />&nbsp; &nbsp; option dest &#039;wan&#039;<br />&nbsp; &nbsp; option name &#039;Baiduless&#039;<br />&nbsp; &nbsp; option dest_port &#039;80&#039;<br />&nbsp; &nbsp; option target &#039;REJECT&#039;<br />&nbsp; &nbsp; option dest_ip &#039;220.181.111.147/24&#039;<br />&nbsp; &nbsp; option src_mac &#039;54:26:96:CD:72:23&#039;<br />&nbsp; &nbsp; option enabled &#039;0&#039;</p><p>config rule<br />&nbsp; &nbsp; option src &#039;lan&#039;<br />&nbsp; &nbsp; option dest &#039;wan&#039;<br />&nbsp; &nbsp; option name &#039;GayNoMore&#039;<br />&nbsp; &nbsp; option proto &#039;tcp&#039;<br />&nbsp; &nbsp; option dest_ip &#039;58.53.128.178/24&#039;<br />&nbsp; &nbsp; option target &#039;DROP&#039;<br />&nbsp; &nbsp; option enabled &#039;0&#039;</p><p>config rule<br />&nbsp; &nbsp; option src &#039;lan&#039;<br />&nbsp; &nbsp; option dest &#039;wan&#039;<br />&nbsp; &nbsp; option name &#039;NoDanmei&#039;<br />&nbsp; &nbsp; option dest_ip &#039;98.126.217.4/24&#039;<br />&nbsp; &nbsp; option target &#039;DROP&#039;<br />&nbsp; &nbsp; option enabled &#039;0&#039;</p><p>config rule<br />&nbsp; &nbsp; option target &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option proto &#039;udp&#039;<br />&nbsp; &nbsp; option dest_port &#039;500&#039;<br />&nbsp; &nbsp; option name &#039;GRE&#039;<br />&nbsp; &nbsp; option enabled &#039;0&#039;</p><p>config rule<br />&nbsp; &nbsp; option target &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option proto &#039;udp&#039;<br />&nbsp; &nbsp; option dest_port &#039;1701&#039;<br />&nbsp; &nbsp; option name &#039;L2TP&#039;<br />&nbsp; &nbsp; option enabled &#039;0&#039;</p><p>config rule<br />&nbsp; &nbsp; option _name &#039;pptpvpn&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option proto &#039;tcpudp&#039;<br />&nbsp; &nbsp; option dest_port &#039;1723&#039;<br />&nbsp; &nbsp; option target &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option enabled &#039;0&#039;</p><p>config rule<br />&nbsp; &nbsp; option src &#039;lan&#039;<br />&nbsp; &nbsp; option dest &#039;wan&#039;<br />&nbsp; &nbsp; option name &#039;NoQQ&#039;<br />&nbsp; &nbsp; option src_mac &#039;54:26:96:CD:72:23&#039;<br />&nbsp; &nbsp; option dest_port &#039;8000-8009&#039;<br />&nbsp; &nbsp; option target &#039;DROP&#039;<br />&nbsp; &nbsp; option enabled &#039;0&#039;</p><p>config rule<br />&nbsp; &nbsp; option src &#039;lan&#039;<br />&nbsp; &nbsp; option dest &#039;wan&#039;<br />&nbsp; &nbsp; option name &#039;NoGitForLong&#039;<br />&nbsp; &nbsp; option src_ip &#039;192.168.2.224&#039;<br />&nbsp; &nbsp; option dest_ip &#039;192.30.252.130&#039;<br />&nbsp; &nbsp; option target &#039;REJECT&#039;<br />&nbsp; &nbsp; option enabled &#039;0&#039;</p><p>config rule<br />&nbsp; &nbsp; option src &#039;lan&#039;<br />&nbsp; &nbsp; option dest &#039;wan&#039;<br />&nbsp; &nbsp; option name &#039;NoGitRawForLong&#039;<br />&nbsp; &nbsp; option src_ip &#039;192.168.2.224&#039;<br />&nbsp; &nbsp; option dest_ip &#039;103.245.222.133&#039;<br />&nbsp; &nbsp; option target &#039;REJECT&#039;<br />&nbsp; &nbsp; option enabled &#039;0&#039;</p><p>config rule<br />&nbsp; &nbsp; option target &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option proto &#039;udp&#039;<br />&nbsp; &nbsp; option dest_port &#039;161&#039;<br />&nbsp; &nbsp; option name &#039;SNMP&#039;<br />&nbsp; &nbsp; option src_ip &#039;188.124.160.10&#039;</p><p>config rule<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option proto &#039;tcp udp&#039;<br />&nbsp; &nbsp; option dest_port &#039;161&#039;<br />&nbsp; &nbsp; option name &#039;NoSNMP&#039;<br />&nbsp; &nbsp; option target &#039;DROP&#039;</p><p>config rule<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option dest_port &#039;80&#039;<br />&nbsp; &nbsp; option name &#039;NoWeb&#039;<br />&nbsp; &nbsp; option proto &#039;all&#039;<br />&nbsp; &nbsp; option target &#039;DROP&#039;</p><p>config rule<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option dest_port &#039;443&#039;<br />&nbsp; &nbsp; option name &#039;NoHttpsWeb&#039;<br />&nbsp; &nbsp; option proto &#039;all&#039;<br />&nbsp; &nbsp; option target &#039;DROP&#039;</p><p>config defaults<br />&nbsp; &nbsp; option syn_flood &#039;1&#039;<br />&nbsp; &nbsp; option drop_invalid &#039;1&#039;<br />&nbsp; &nbsp; option output &#039;DROP&#039;<br />&nbsp; &nbsp; option forward &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option input &#039;DROP&#039;</p><p>config zone<br />&nbsp; &nbsp; option name &#039;lan&#039;<br />&nbsp; &nbsp; option network &#039;lan&#039;<br />&nbsp; &nbsp; option input &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option output &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option forward &#039;ACCEPT&#039;</p><p>config zone<br />&nbsp; &nbsp; option name &#039;wan&#039;<br />&nbsp; &nbsp; option output &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option network &#039;wan&#039;<br />&nbsp; &nbsp; option forward &#039;REJECT&#039;<br />&nbsp; &nbsp; option masq &#039;1&#039;<br />&nbsp; &nbsp; option mtu_fix &#039;1&#039;<br />&nbsp; &nbsp; option input &#039;REJECT&#039;</p><p>config forwarding<br />&nbsp; &nbsp; option src &#039;lan&#039;<br />&nbsp; &nbsp; option dest &#039;wan&#039;</p><p>config include<br />&nbsp; &nbsp; option path &#039;/etc/firewall.user&#039;</p><p>config include &#039;miniupnpd&#039;<br />&nbsp; &nbsp; option type &#039;script&#039;<br />&nbsp; &nbsp; option path &#039;/usr/share/miniupnpd/firewall.include&#039;<br />&nbsp; &nbsp; option family &#039;IPv4&#039;<br />&nbsp; &nbsp; option reload &#039;1&#039;</p><p>config rule<br />&nbsp; &nbsp; option proto &#039;tcp udp&#039;<br />&nbsp; &nbsp; option name &#039;NoFishing&#039;<br />&nbsp; &nbsp; option target &#039;DROP&#039;<br />&nbsp; &nbsp; option src &#039;*&#039;<br />&nbsp; &nbsp; option dest &#039;wan&#039;<br />&nbsp; &nbsp; option dest_ip &#039;119.147.148.21&#039;</p>											<p class="post-edited">(Last edited by <strong>jokies</strong> on 23 Jan 2014, 13:31)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p222849">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">nozombian</div>
					<div class="post-datetime">
						15 Jan 2014, 22:24					</div>
				</div>
				<div class="post-content content">
					<p>You should really clean up your firewall settings <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /> The only thing you need is this rule:<br /></p><div class="codebox"><pre><code>config rule
        option name &#039;Allow-ssh&#039;
        option src &#039;wan&#039;
        option src_dport &#039;22&#039;
        option target &#039;ACCEPT&#039;</code></pre></div><p>This is my sample firewall. I have dropbear listening on 2222, because it will prevent most of the port scans.</p><div class="codebox"><pre><code>root@wr841n:~# cat /etc/config/firewall

config defaults
        option syn_flood &#039;1&#039;
        option input &#039;ACCEPT&#039;
        option output &#039;ACCEPT&#039;
        option forward &#039;REJECT&#039;
        option disable_ipv6 &#039;1&#039;

config zone
        option name &#039;lan&#039;
        list network &#039;lan&#039;
        option input &#039;ACCEPT&#039;
        option output &#039;ACCEPT&#039;
        option forward &#039;ACCEPT&#039;

config zone
        option name &#039;wan&#039;
        list network &#039;wan&#039;
        list network &#039;wan6&#039;
        option input &#039;REJECT&#039;
        option output &#039;ACCEPT&#039;
        option forward &#039;REJECT&#039;
        option masq &#039;1&#039;
        option mtu_fix &#039;1&#039;

config forwarding
        option src &#039;lan&#039;
        option dest &#039;wan&#039;

config rule
        option name &#039;Allow-DHCP-Renew&#039;
        option src &#039;wan&#039;
        option proto &#039;udp&#039;
        option dest_port &#039;68&#039;
        option target &#039;ACCEPT&#039;
        option family &#039;ipv4&#039;

config rule
        option name &#039;Allow-Ping&#039;
        option src &#039;wan&#039;
        option proto &#039;icmp&#039;
        option icmp_type &#039;echo-request&#039;
        option family &#039;ipv4&#039;
        option target &#039;ACCEPT&#039;

#config rule
#       option name &#039;Allow-ssh&#039;
#       option src &#039;wan&#039;
#       option src_dport &#039;22&#039;
#       option target &#039;ACCEPT&#039;

config rule
        option name &#039;Allow-ssh2&#039;
        option src &#039;wan&#039;
        option src_dport &#039;2222&#039;
        option target &#039;ACCEPT&#039;

config rule
        option name &#039;Allow-DHCPv6&#039;
        option src &#039;wan&#039;
        option proto &#039;udp&#039;
        option src_ip &#039;fe80::/10&#039;
        option src_port &#039;547&#039;
        option dest_ip &#039;fe80::/10&#039;
        option dest_port &#039;546&#039;
        option family &#039;ipv6&#039;
        option target &#039;ACCEPT&#039;

config rule
        option name &#039;Allow-ICMPv6-Input&#039;
        option src &#039;wan&#039;
        option proto &#039;icmp&#039;
        list icmp_type &#039;echo-request&#039;
        list icmp_type &#039;echo-reply&#039;
        list icmp_type &#039;destination-unreachable&#039;
        list icmp_type &#039;packet-too-big&#039;
        list icmp_type &#039;time-exceeded&#039;
        list icmp_type &#039;bad-header&#039;
        list icmp_type &#039;unknown-header-type&#039;
        list icmp_type &#039;router-solicitation&#039;
        list icmp_type &#039;neighbour-solicitation&#039;
        list icmp_type &#039;router-advertisement&#039;
        list icmp_type &#039;neighbour-advertisement&#039;
        option limit &#039;1000/sec&#039;
        option family &#039;ipv6&#039;
        option target &#039;ACCEPT&#039;

config rule
        option name &#039;Allow-ICMPv6-Forward&#039;
        option src &#039;wan&#039;
        option dest &#039;*&#039;
        option proto &#039;icmp&#039;
        list icmp_type &#039;echo-request&#039;
        list icmp_type &#039;echo-reply&#039;
        list icmp_type &#039;destination-unreachable&#039;
        list icmp_type &#039;packet-too-big&#039;
        list icmp_type &#039;time-exceeded&#039;
        list icmp_type &#039;bad-header&#039;
        list icmp_type &#039;unknown-header-type&#039;
        option limit &#039;1000/sec&#039;
        option family &#039;ipv6&#039;
        option target &#039;ACCEPT&#039;

config include
        option path &#039;/etc/firewall.user&#039;</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p223482">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">jokies</div>
					<div class="post-datetime">
						22 Jan 2014, 19:00					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>nozombian wrote:</cite><blockquote><p>You should really clean up your firewall settings <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /> The only thing you need is this rule:<br /></p><div class="codebox"><pre><code>config rule
        option name &#039;Allow-ssh&#039;
        option src &#039;wan&#039;
        option src_dport &#039;22&#039;
        option target &#039;ACCEPT&#039;</code></pre></div><p>This is my sample firewall. I have dropbear listening on 2222, because it will prevent most of the port scans.</p><div class="codebox"><pre><code>root@wr841n:~# cat /etc/config/firewall

config defaults
        option syn_flood &#039;1&#039;
        option input &#039;ACCEPT&#039;
        option output &#039;ACCEPT&#039;
        option forward &#039;REJECT&#039;
        option disable_ipv6 &#039;1&#039;

config zone
        option name &#039;lan&#039;
        list network &#039;lan&#039;
        option input &#039;ACCEPT&#039;
        option output &#039;ACCEPT&#039;
        option forward &#039;ACCEPT&#039;

config zone
        option name &#039;wan&#039;
        list network &#039;wan&#039;
        list network &#039;wan6&#039;
        option input &#039;REJECT&#039;
        option output &#039;ACCEPT&#039;
        option forward &#039;REJECT&#039;
        option masq &#039;1&#039;
        option mtu_fix &#039;1&#039;

config forwarding
        option src &#039;lan&#039;
        option dest &#039;wan&#039;

config rule
        option name &#039;Allow-DHCP-Renew&#039;
        option src &#039;wan&#039;
        option proto &#039;udp&#039;
        option dest_port &#039;68&#039;
        option target &#039;ACCEPT&#039;
        option family &#039;ipv4&#039;

config rule
        option name &#039;Allow-Ping&#039;
        option src &#039;wan&#039;
        option proto &#039;icmp&#039;
        option icmp_type &#039;echo-request&#039;
        option family &#039;ipv4&#039;
        option target &#039;ACCEPT&#039;

#config rule
#       option name &#039;Allow-ssh&#039;
#       option src &#039;wan&#039;
#       option src_dport &#039;22&#039;
#       option target &#039;ACCEPT&#039;

config rule
        option name &#039;Allow-ssh2&#039;
        option src &#039;wan&#039;
        option src_dport &#039;2222&#039;
        option target &#039;ACCEPT&#039;

config rule
        option name &#039;Allow-DHCPv6&#039;
        option src &#039;wan&#039;
        option proto &#039;udp&#039;
        option src_ip &#039;fe80::/10&#039;
        option src_port &#039;547&#039;
        option dest_ip &#039;fe80::/10&#039;
        option dest_port &#039;546&#039;
        option family &#039;ipv6&#039;
        option target &#039;ACCEPT&#039;

config rule
        option name &#039;Allow-ICMPv6-Input&#039;
        option src &#039;wan&#039;
        option proto &#039;icmp&#039;
        list icmp_type &#039;echo-request&#039;
        list icmp_type &#039;echo-reply&#039;
        list icmp_type &#039;destination-unreachable&#039;
        list icmp_type &#039;packet-too-big&#039;
        list icmp_type &#039;time-exceeded&#039;
        list icmp_type &#039;bad-header&#039;
        list icmp_type &#039;unknown-header-type&#039;
        list icmp_type &#039;router-solicitation&#039;
        list icmp_type &#039;neighbour-solicitation&#039;
        list icmp_type &#039;router-advertisement&#039;
        list icmp_type &#039;neighbour-advertisement&#039;
        option limit &#039;1000/sec&#039;
        option family &#039;ipv6&#039;
        option target &#039;ACCEPT&#039;

config rule
        option name &#039;Allow-ICMPv6-Forward&#039;
        option src &#039;wan&#039;
        option dest &#039;*&#039;
        option proto &#039;icmp&#039;
        list icmp_type &#039;echo-request&#039;
        list icmp_type &#039;echo-reply&#039;
        list icmp_type &#039;destination-unreachable&#039;
        list icmp_type &#039;packet-too-big&#039;
        list icmp_type &#039;time-exceeded&#039;
        list icmp_type &#039;bad-header&#039;
        list icmp_type &#039;unknown-header-type&#039;
        option limit &#039;1000/sec&#039;
        option family &#039;ipv6&#039;
        option target &#039;ACCEPT&#039;

config include
        option path &#039;/etc/firewall.user&#039;</code></pre></div></blockquote></div><p>Thank you for your help.<br />I somehow managed to track down the problem by adding log to the rules, I got these:</p><p>InDrop IN=pppoe-wan OUT= MAC= SRC=119.123.195.166 DST=219.134.73.247 LEN=48 TOS=0x00 PREC=0x00 TTL=58 ID=25748 DF PROTO=TCP SPT=55935 DPT=2222 WINDOW=65535 RES=0x00 SYN URGP=0 <br />IN=pppoe-wan OUT= MAC= SRC=119.123.195.166 DST=219.134.73.247 LEN=48 TOS=0x00 PREC=0x00 TTL=58 ID=50449 DF PROTO=TCP SPT=56285 DPT=2222 WINDOW=65535 RES=0x00 SYN URGP=0 </p><p>Is there a way to make iptables tell me which rule dropped the packets?<br />I found TRACE is not working in OpenWRT&#039;s iptables and iptables-debug no more provided inside the repository.<br />Thank you all the same.</p><p>Update: I accidently solved the problem by deleting two rules in my iptables, which drops packets to my wan interface port 80 and 443, I have no idea why would it have anything to do with my SSH and I have no services listening these ports, so the reason still remained a mystery to me.</p>											<p class="post-edited">(Last edited by <strong>jokies</strong> on 22 Jan 2014, 19:42)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p223514">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">nozombian</div>
					<div class="post-datetime">
						23 Jan 2014, 00:14					</div>
				</div>
				<div class="post-content content">
					<p>Firewall handling is not my strong side, but if you try to run /etc/init.d/firewall reload, maybe you will see some errors/warnings. Also dmesg and logread might show something up.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p223534">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">Nilfred</div>
					<div class="post-datetime">
						23 Jan 2014, 08:14					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>jokies wrote:</cite><blockquote><p>I somehow managed to track down the problem by adding log to the rules, I got these:</p><p>InDrop IN=pppoe-wan SRC=119.123.195.166 DST=219.134.73.247 PROTO=TCP SPT=55935 DPT=2222<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;IN=pppoe-wan SRC=119.123.195.166 DST=219.134.73.247 PROTO=TCP SPT=56285 DPT=2222</p><p>Is there a way to make iptables tell me which rule dropped the packets?</p></blockquote></div><p>Log is ok.<br />DPT=2222 in your log means Destination Port 2222, that is your ssh client is trying to connect to port 2222, not the standard port 22 dropbear usually listen to.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p223536">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">nozombian</div>
					<div class="post-datetime">
						23 Jan 2014, 09:13					</div>
				</div>
				<div class="post-content content">
					<p>There should actually be option dest_port &#039;2222&#039; and yet I forgot to specify option proto tcp, but this somehow works too <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> This is what happens when you copy (yank) and paste from different rules in vi editor...</p><p>Yes, I have port 2222 specified in /etc/config/dropbear, so ssh dropbear is listening on port 2222. When I had it on port 22, I got log full of hacking attemtps, now nothing.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p223537">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">written_direcon</div>
					<div class="post-datetime">
						23 Jan 2014, 10:42					</div>
				</div>
				<div class="post-content content">
					<p>@jokies: you should really clean up your firewall configuration. Start over from scratch with:<br /></p><div class="codebox"><pre><code>cp -fpR /rom/etc/config/firewall /etc/config/firewall
/etc/init.d/firewall restart</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p223543">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">narian</div>
					<div class="post-datetime">
						23 Jan 2014, 13:45					</div>
				</div>
				<div class="post-content content">
					<p>Somewhy this does not work - it does not opens port 28222 from internet.</p><div class="codebox"><pre><code>config zone
    option name         inet
    list   network        &#039;atk&#039;
    option mtu_fix         1
    option forward        ACCEPT
    option output        ACCEPT
    option input        REJECT

config zone
    option name        lan
    list   network        &#039;lan&#039;
    option input        ACCEPT
    option output        ACCEPT
    option forward        ACCEPT

config zone
    option name        wan
    list   network        &#039;wan&#039;
#    list   network        &#039;wan6&#039;
    option input        REJECT
    option output        ACCEPT
    option forward        REJECT
    option masq        1
    option mtu_fix        1

config zone
    option     name        parents
    list    network        &#039;vvn2&#039;
    option    input         ACCEPT
    option    output         ACCEPT
    option     forward     ACCEPT
    option     mtu_fix     1
    option     masq         1

config redirect
    option target &#039;SNAT&#039;
    option src &#039;lan&#039;
    option dest &#039;wan&#039;
    option proto &#039;all&#039;
    option src_dip &#039;172.16.35.95&#039;
    option name &#039;Lan2ATK&#039;

config redirect
    option target &#039;SNAT&#039;
    option src &#039;lan&#039;
    option dest &#039;inet&#039;
    option proto &#039;all&#039;
    option src_dip &#039;95.154.XX.XX&#039;
    option name &#039;Lan2Inet_snat&#039;

config defaults
    option syn_flood    1
    option input        ACCEPT
    option output        ACCEPT
    option forward        REJECT
#    option custom_chains    1
# Uncomment this line to disable ipv6 rules
    option disable_ipv6    1

config forwarding
    option dest lan
    option src wan

config forwarding
    option dest wan
    option src lan

config forwarding
    option dest parents
    option src lan

config forwarding
    option dest lan
    option src parents
        
config forwarding
    option dest parents
    option src wan

config forwarding
    option dest wan
    option src parents

config forwarding
    option dest parents
    option src inet

config forwarding
    option dest inet
    option src parents

config forwarding
    option dest inet
    option src lan

config forwarding
    option dest lan
    option src inet

config rule
    option name         &#039;Allow-SSH_From_INET&#039;
    option src        inet
    option proto        tcp
    option dest_port    28222
    option target        ACCEPT</code></pre></div><p>It should be ok, but somewhy it refuses connection on port 28222 (dropbear listens this port).<br />And when I change default policy for zone inet (my pptp connection for internet) to ACCEPT it refuses connection all the same.<br />Why can it be so?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p263021">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">alirz</div>
					<div class="post-datetime">
						27 Jan 2015, 02:20					</div>
				</div>
				<div class="post-content content">
					<p>I had to allow ssh from wan in the firewall config&nbsp; manually, even though i had enabled it and added the rule via the web interface.</p><p>in /etc/config/firewall<br />I added:</p><br /><p>config rule<br />&nbsp; &nbsp; option target &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option proto &#039;tcp udp&#039;<br />&nbsp; &nbsp; option dest_port &#039;22&#039;<br />&nbsp; &nbsp; option name &#039;ssh&#039;</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>