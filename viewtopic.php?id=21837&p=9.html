<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> AR8316 Switch Support</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 7 Oct 2014 and 7 May 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 9 of 9</div><nav><ul><li><a href="viewtopic.php%3Fid=21837&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=21837&amp;p=7.html">7</a></li><li><a href="viewtopic.php%3Fid=21837&amp;p=8.html">8</a></li><li class="pagination-current"><span>9</span></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p133805">
				<div class="post-metadata">
					<div class="post-num">Post #201</div>
					<div class="post-author">arteqw</div>
					<div class="post-datetime">
						22 Apr 2011, 23:31					</div>
				</div>
				<div class="post-content content">
					<p>Ok, but when i try increase MTU got error <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p133808">
				<div class="post-metadata">
					<div class="post-num">Post #202</div>
					<div class="post-author">oreggin</div>
					<div class="post-datetime">
						22 Apr 2011, 23:40					</div>
				</div>
				<div class="post-content content">
					<p>What type of error?<br />I tested the switch part of my RB450G. It is wirerate gigabitethernet switch and it can switch L2 frames over 9000 byte (9028byte) with ~220microseconds latency but the CPU connection to the switch can&#039;t handle jumbo frames...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p133809">
				<div class="post-metadata">
					<div class="post-num">Post #203</div>
					<div class="post-author">arteqw</div>
					<div class="post-datetime">
						22 Apr 2011, 23:43					</div>
				</div>
				<div class="post-content content">
					<div class="codebox"><pre><code>root@OpenWrt:/# ifconfig eth1 mtu 9000
ifconfig: SIOCSIFMTU: Invalid argument
root@OpenWrt:/# ifconfig eth0 mtu 9000
ifconfig: SIOCSIFMTU: Invalid argument</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p133811">
				<div class="post-metadata">
					<div class="post-num">Post #204</div>
					<div class="post-author">oreggin</div>
					<div class="post-datetime">
						22 Apr 2011, 23:46					</div>
				</div>
				<div class="post-content content">
					<p>Yes, it is the cpu&#039;s interface. It haven&#039;t jumbo frame support. Only the switch can handle jumbo frames between them ports.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p135003">
				<div class="post-metadata">
					<div class="post-num">Post #205</div>
					<div class="post-author">pmootrey</div>
					<div class="post-datetime">
						10 May 2011, 13:24					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m currently working with a RB-493G. The driver loads and attaches to eth0, however there are two switch chips on this board and only half the ports are working. Anyone have any ideas?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p136744">
				<div class="post-metadata">
					<div class="post-num">Post #206</div>
					<div class="post-author">zhouhaigang</div>
					<div class="post-datetime">
						9 Jun 2011, 04:53					</div>
				</div>
				<div class="post-content content">
					<p>i want to AR8236 Switch Support ,but i don&#039;t how to do .someone help?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p146214">
				<div class="post-metadata">
					<div class="post-num">Post #207</div>
					<div class="post-author">levi</div>
					<div class="post-datetime">
						19 Oct 2011, 22:34					</div>
				</div>
				<div class="post-content content">
					<p>Hi guys,<br />I&#039;ve tried to configure switch on my RSPro and after some playing around lost connection to router.<br />From console i can see that the port facing to the switch is down, swconfig shows:</p><div class="codebox"><pre><code>swconfig dev eth1 show                                                                                                
Failed to connect to the switch</code></pre></div><p>and dmesg shows:</p><div class="codebox"><pre><code>dmesg | grep -i PHY                                                                                                   
Determined physical RAM map:                                                                                                               
eth0: connected to PHY at ag71xx-mdio:04 [uid=004dd041, driver=Atheros AR8216/AR8316]                                                      
eth1: connected to PHY at ag71xx-mdio:00 [uid=004dd041, driver=Generic PHY]                                                                
ath5k 0000:00:13.0: registered as &#039;phy0&#039;                                                                                                   
ieee80211 phy0: Selected rate control algorithm &#039;minstrel_ht&#039;                                                                              
ath5k phy0: Atheros AR2413 chip found (MAC: 0x78, PHY: 0x45)                                                                               
ieee80211 phy1: Selected rate control algorithm &#039;minstrel_ht&#039;                                                                              
Registered led device: ath9k-phy1                                                                                                          
ieee80211 phy1: Atheros AR9160 MAC/BB Rev:1 AR5133 RF Rev:b0 mem=0xb0000000, irq=49</code></pre></div><p>I guess somehow router stopped initializing the switch. Is there any way to force initialization?<br />Thank You.</p><p>P.S.<br />How to know version of swconfig?<br /></p><div class="codebox"><pre><code>opkg list-installed | grep swconfig                                                                                   
swconfig - 7</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p166381">
				<div class="post-metadata">
					<div class="post-num">Post #208</div>
					<div class="post-author">pigsign</div>
					<div class="post-datetime">
						3 May 2012, 05:30					</div>
				</div>
				<div class="post-content content">
					<p>Is it possible changed the maximum VLANs from 128 to 256 ???<br />someone can help this???</p><p>Thanks.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p166418">
				<div class="post-metadata">
					<div class="post-num">Post #209</div>
					<div class="post-author">KanjiMonster</div>
					<div class="post-datetime">
						3 May 2012, 13:33					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>pigsign wrote:</cite><blockquote><p>Is it possible changed the maximum VLANs from 128 to 256 ???<br />someone can help this???<br />Thanks.</p></blockquote></div><p>If you really need to have more than 128 VLANs (and not just use VIDs &gt; 127, for these you can just set the property &quot;vid&quot; of the vlans), <br />edit this line <a href="https://dev.openwrt.org/browser/trunk/target/linux/generic/files/drivers/net/phy/ar8216.c#L38">https://dev.openwrt.org/browser/trunk/t … 8216.c#L38</a>.</p><p>IIRC the maximum is around ~500, after that you will get a stack overflow on registration (this is a software limitation, not a hardware limitation).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p166485">
				<div class="post-metadata">
					<div class="post-num">Post #210</div>
					<div class="post-author">pigsign</div>
					<div class="post-datetime">
						4 May 2012, 09:54					</div>
				</div>
				<div class="post-content content">
					<p>KM, thank you!!!<br />It&#039;s working. :-)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p169516">
				<div class="post-metadata">
					<div class="post-num">Post #211</div>
					<div class="post-author">BizarroSephiroth</div>
					<div class="post-datetime">
						9 Jun 2012, 15:06					</div>
				</div>
				<div class="post-content content">
					<p>Hi!</p><p>I have a problem with setting default vlan for port (for untagged frames) on ar8316 switch in jjPlus ja76pf2 device on backfire trunk version r32050<br />It seams that packets are not directed to defined vlan. All work fine when packets are sent form vlan tagged interface. <br /></p><div class="codebox"><pre><code>/etc/config/network
config interface &#039;lan&#039;
        option proto &#039;static&#039;
        option ipaddr &#039;192.168.123.20&#039;
        option netmask &#039;255.255.255.0&#039;
        option defaultroute &#039;0&#039;
        option peerdns &#039;0&#039;
        option type &#039;bridge&#039;
        option ifname &#039;eth0.1&#039;

config switch &#039;eth0&#039;
        option reset &#039;1&#039;
        option enable &#039;1&#039;
        option enable_vlan &#039;1&#039;

config switch_vlan
        option device &#039;eth0&#039;
        option ports &#039;0t 1t&#039;
        option vid &#039;1&#039;
        option vlan &#039;0&#039;

config switch_port
        option port &#039;1&#039;
        option pvid &#039;1&#039;</code></pre></div><p>pvid set to both 0 and 1 failed. Also mangling with network.lan.ifname by setting it to eth0, eth0.0 and eth0.1 failed.</p><div class="codebox"><pre><code>root@OpenWrt:/# swconfig dev eth0 show
Global attributes:
        enable_vlan: 1
Port 0:
        pvid: 1
        link: port:0 link:up speed:1000baseT full-duplex txflow rxflow 
Port 1:
        pvid: 1
        link: port:1 link:up speed:1000baseT full-duplex auto
Port 2:
        pvid: 0
        link: port:2 link:down
Port 3:
        pvid: 0
        link: port:3 link:down
Port 4:
        pvid: 0
        link: port:4 link:down
VLAN 0:
        vid: 1
        ports: 0t 1t</code></pre></div>											<p class="post-edited">(Last edited by <strong>BizarroSephiroth</strong> on 9 Jun 2012, 15:44)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p211755">
				<div class="post-metadata">
					<div class="post-num">Post #212</div>
					<div class="post-author">rmax</div>
					<div class="post-datetime">
						6 Sep 2013, 16:28					</div>
				</div>
				<div class="post-content content">
					<p>KanjiMonster, if you&#039;re still reading here:</p><p>Is it a hardware limitation or a driver problem, that a port can&#039;t be tagged on one VLAN and untagged on another at the same time?</p><p>When I try to do this:<br /></p><div class="codebox"><pre><code>swconfig dev switch0 vlan 3 set ports &quot;0 3 4 5&quot;
swconfig dev switch0 vlan 2 set ports &quot;0t 2&quot;</code></pre></div><p>I end up with port 0 being tagged not only on vlan 2, but also on vlan 3. When I reverse the order of the two lines, port 0 gets removed from vlan 2 and is untagged on vlan 3.</p><p>This is on a Buffalo WBMR-HP-G300H with OpenWRT trunk as of today.</p>											<p class="post-edited">(Last edited by <strong>rmax</strong> on 6 Sep 2013, 17:11)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 9 of 9</div><nav><ul><li><a href="viewtopic.php%3Fid=21837&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=21837&amp;p=7.html">7</a></li><li><a href="viewtopic.php%3Fid=21837&amp;p=8.html">8</a></li><li class="pagination-current"><span>9</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>