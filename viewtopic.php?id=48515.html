<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> kernel development</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 1 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p223111">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">triskelian</div>
					<div class="post-datetime">
						18 Jan 2014, 23:53					</div>
				</div>
				<div class="post-content content">
					<p>i want to make some changes to the kernel, especially the net/ipv4 directory. currently i work with the attitude adjustment release (having a modified 3.3 kernel as far as i know).</p><p>as i am new to that i have several questions, that hopefully arent too odd and someone of you can answer to me ;D!</p><p>1.) can i download the 3.3 kernel from the link given (<a href="http://lxr.free-electrons.com/source/net/ipv4/?v=3.3">http://lxr.free-electrons.com/source/net/ipv4/?v=3.3</a>), change it and then compile and somehow add it to my next openwrt build? if yes, whats the easiest way?<br />2.) how about the sources that have been ported from kernel 3.5 into the 3.3 being used with the attitude adjustment release? if i download the kernel from&nbsp; the above link those changes wont be included i guess?<br />3.) is it possible to from somewhere download the kernel source used in the official attitude adjustment release and if yes, where can i get it, because for me that of course would be the preferable way... =P<br />4.) any tutorials to recommend, because i was unable to find more than a few articles or blog posts <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" />?</p><p>thank you folks!</p>											<p class="post-edited">(Last edited by <strong>triskelian</strong> on 19 Jan 2014, 00:09)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p223131">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">mazilo</div>
					<div class="post-datetime">
						19 Jan 2014, 06:16					</div>
				</div>
				<div class="post-content content">
					<p>Assuming you already have the OpenWRT source code root directory. At your local OpenWRT source root directory, execute <em>make kernel_menuconfig</em> and you will be prompted with the Linux kernel menu configuration.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p223139">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">zloop</div>
					<div class="post-datetime">
						19 Jan 2014, 09:48					</div>
				</div>
				<div class="post-content content">
					<p>1.) I think that site uses the official sources. Downloadable via FTP from: <a href="ftp://ftp.kernel.org/pub/linux/kernel/v3.x/">ftp://ftp.kernel.org/pub/linux/kernel/v3.x/</a></p><p>2.) No. Every Patch of OpenWrt to official software sources is included if you download the Buildroot environment for Attitude Adjustment.<br />see source download: <a href="https://dev.openwrt.org/wiki/GetSource">https://dev.openwrt.org/wiki/GetSource</a><br />example of patches: <a href="https://dev.openwrt.org/browser/branches/attitude_adjustment/target/linux/generic/patches-3.3">https://dev.openwrt.org/browser/branche … atches-3.3</a></p><p>3.) look in the wiki / link posted above ... It was 2 clicks away from <a href="http://www.openwrt.org">www.openwrt.org</a> and you did not find it? <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /><br />(its <a href="https://dev.openwrt.org/wiki/GetSource">https://dev.openwrt.org/wiki/GetSource</a> )<br />All software sources are downloaded when you build OpenWrt.</p><p>4.) Look at some wiki pages like: <br />- wiki.openwrt.org/doc/howto/buildroot.exigence<br />- <a href="http://wiki.openwrt.org/doc/howto/build">http://wiki.openwrt.org/doc/howto/build</a><br />- <a href="http://wiki.openwrt.org/doc/devel/patches">http://wiki.openwrt.org/doc/devel/patches</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p223142">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						19 Jan 2014, 10:16					</div>
				</div>
				<div class="post-content content">
					<p>To add to the advice given be previous posters, a few comments:</p><p>Openwrt uses the official kernel. The build system downloads and extracts the sources.<br />Then &quot;generic&quot; openwrt config &amp; patches common to all architectures are applied to it.<br />Finally platform-specific config &amp; patches are applied it.<br />Then the kernel is compiled.</p><p>In the buildhost, the extracted &amp; patched kernel source can be found in &quot;build_dir&quot;, e.g. /Openwrt/attitude/build_dir/linux-ar71xx_generic/linux-3.3.8</p><p>These links show the items used for ar71xx architecture:<br />Version: <a href="https://dev.openwrt.org/browser/branches/attitude_adjustment/include/kernel-version.mk">https://dev.openwrt.org/browser/branche … version.mk</a></p><p>Generic config &amp; patches: <a href="https://dev.openwrt.org/browser/branches/attitude_adjustment/target/linux/generic">https://dev.openwrt.org/browser/branche … ux/generic</a><br /><a href="https://dev.openwrt.org/browser/branches/attitude_adjustment/target/linux/generic/config-3.3">https://dev.openwrt.org/browser/branche … config-3.3</a><br /><a href="https://dev.openwrt.org/browser/branches/attitude_adjustment/target/linux/generic/patches-3.3">https://dev.openwrt.org/browser/branche … atches-3.3</a></p><p>ar71xx config &amp; patches: <a href="https://dev.openwrt.org/browser/branches/attitude_adjustment/target/linux/ar71xx">https://dev.openwrt.org/browser/branche … nux/ar71xx</a><br /><a href="https://dev.openwrt.org/browser/branches/attitude_adjustment/target/linux/ar71xx/config-3.3">https://dev.openwrt.org/browser/branche … config-3.3</a><br /><a href="https://dev.openwrt.org/browser/branches/attitude_adjustment/target/linux/ar71xx/patches-3.3">https://dev.openwrt.org/browser/branche … atches-3.3</a></p><p>I am not quite sure if you are looking kernel config changes (see kernel_menuconfig like already said), or actually modifying kernel sources. If modifying sources, read the already mentioned wiki article on Openwrt patches, as the right way is to make your changes as new patches added to the end of the platform patches directory.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p223179">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">triskelian</div>
					<div class="post-datetime">
						19 Jan 2014, 16:50					</div>
				</div>
				<div class="post-content content">
					<p>first of all, thank you all for the constructive information given within only a few hours.</p><p>@mazilo: thank you for telling me the kernel_menuconfig command, that actually was a new one for me, i only came across the standard menuconfig one as i created my own build a few weeks ago</p><p>@zloop: actually i was &quot;not only two clicks away&quot;, because i already downloaded attitude_adjustment via svn and modified the image to properly work on my alix2 boards (x86) with the additional packages i need. of course i also understand that this means that the kernel has to be included in my buildroot, otherwise a hardware specific building process wouldnt be possible at all. the problem is, i was unable to locate the kernels sourcecode within my buildroot environment to 1) be sure to have the appropriate .c files that are used by the openwrt release, and 2) be able to modify the .c sources.</p><p>This leads me to hnyman&#039;s reply:<br />@hnyman: like you wrote in your messages last paragraph i actually want to make changes to the kernel sourcecode itself. i want to change some functionality and add a few new things for a custom development. therefore need to have an option to get the .c files and not some precompiled ones.</p><p>two days ago i came across those, from you mentioned &quot;patches&quot; that can be used to add new elements to the kernel. even tough currently i didnt get the whole concept of how they work i will find a way as it seems to me that this would be the optimum and cleanest way of doing the changes im planning to.</p><p>still the question arises: how to retrieve the kernel source from the openwrt buildroot (or cant i find it within the buildroot and it is stored online and downloaded during build process!?) to work with, do some changes and compile them as a kernel patch?</p><p>concerning the patches: do these patches overwrite the existing .c libraries if i inclue a new library with the same name than an existing one? how will the kernel react, because its not only about adding new things, but also make changes to some already existing methods within the kernel.</p><p>hope that all of you got the point what i am looking for,<br />thx</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p223183">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						19 Jan 2014, 17:50					</div>
				</div>
				<div class="post-content content">
					<p>Kernel sources are not included initially. They are downloaded in the make process.<br />The kernel sources get expanded to &lt;buildroot&gt;/build_dir/.... when you do the first make.<br />For AA that would be &lt;buildroot&gt;/build_dir/linux-&lt;your_architecture&gt;/linux-3.3.8</p><p>read that patches wiki article already mentioned:<br /><a href="http://wiki.openwrt.org/doc/devel/patches#adding.or.editing.kernel.patches">http://wiki.openwrt.org/doc/devel/patch … el.patches</a></p><p>If you add new patches at the end of other architecture patches, they will be applied along the old patches modifying the source before compilation.</p><p>And please note that the &quot;imagebuilder&quot; is not enough. You need to check out the whole sources.</p>											<p class="post-edited">(Last edited by <strong>hnyman</strong> on 19 Jan 2014, 17:53)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p223255">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">triskelian</div>
					<div class="post-datetime">
						20 Jan 2014, 14:48					</div>
				</div>
				<div class="post-content content">
					<p>alright hnyman!</p><p>thank you for your last reply, you helped me a lot as i finally was able to locate the kernel sourcecodes and combind with the other information given, i guess am now ready to start right off <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p223259">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						20 Jan 2014, 16:12					</div>
				</div>
				<div class="post-content content">
					<p>Please also understand that the sources will get deleted away from build_dir with every &quot;make clean&quot;, so all your changes there will get blown away. So, no changes there are not permanent. </p><p>The correct way is to make sure that the changes get defined as patches in the patch queues.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p223261">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">Zajec</div>
					<div class="post-datetime">
						20 Jan 2014, 16:34					</div>
				</div>
				<div class="post-content content">
					<p>You can also try &quot;Use external kernel tree&quot; (EXTERNAL_KERNEL_TREE). Remember to apply all OpenWrt patches to your external kernel tree, so you make sure OpenWrt will boot.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p223267">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">triskelian</div>
					<div class="post-datetime">
						20 Jan 2014, 17:56					</div>
				</div>
				<div class="post-content content">
					<p>@hnyman: that makes sense, thank you for that explaination<br />@ zajec: for the beginning i guess this will be the easiest way for me as i also want to work using svn repositories while developing the kernel</p><p>guys you really helped me a lot!</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>