<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Getting Tinyproxy working</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 5 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p29511">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">combro2k</div>
					<div class="post-datetime">
						26 Jun 2006, 16:38					</div>
				</div>
				<div class="post-content content">
					<p>Hey I&#039;ve got a problem<br />I want to run tinyproxy but I got an error msg in my log file<br /></p><div class="quotebox"><blockquote><p>INFO&nbsp; &nbsp; &nbsp; Jun 26 15:28:35 [5752]: Initializing tinyproxy ...<br />INFO&nbsp; &nbsp; &nbsp; Jun 26 15:28:35 [5752]: Setting &quot;Via&quot; proxy name to: tinyproxy<br />INFO&nbsp; &nbsp; &nbsp; Jun 26 15:28:35 [5752]: Adding Port [443] to the list allowed by CONNECT<br />INFO&nbsp; &nbsp; &nbsp; Jun 26 15:28:35 [5752]: Adding Port [563] to the list allowed by CONNECT<br />INFO&nbsp; &nbsp; &nbsp; Jun 26 15:28:35 [5752]: Setting stathost to &quot;tinyproxy.stats&quot;.<br />INFO&nbsp; &nbsp; &nbsp; Jun 26 15:28:35 [5755]: Now running as group &quot;nogroup&quot;.<br />INFO&nbsp; &nbsp; &nbsp; Jun 26 15:28:35 [5755]: Now running as user &quot;nobody&quot;.<br />ERROR&nbsp; &nbsp; &nbsp;Jun 26 15:28:35 [5755]: Could not allocate memory for child counting.</p><p>INFO&nbsp; &nbsp; &nbsp; Jun 26 15:30:43 [5772]: Initializing tinyproxy ...<br />INFO&nbsp; &nbsp; &nbsp; Jun 26 15:30:43 [5772]: Establishing listening socket on IP 192.168.1.1<br />INFO&nbsp; &nbsp; &nbsp; Jun 26 15:30:43 [5772]: Setting &quot;Via&quot; proxy name to: tinyproxy<br />INFO&nbsp; &nbsp; &nbsp; Jun 26 15:30:43 [5772]: Adding Port [443] to the list allowed by CONNECT<br />INFO&nbsp; &nbsp; &nbsp; Jun 26 15:30:43 [5772]: Adding Port [563] to the list allowed by CONNECT<br />INFO&nbsp; &nbsp; &nbsp; Jun 26 15:30:43 [5772]: Setting stathost to &quot;tinyproxy.stats&quot;.<br />INFO&nbsp; &nbsp; &nbsp; Jun 26 15:30:43 [5775]: Now running as group &quot;nogroup&quot;.<br />INFO&nbsp; &nbsp; &nbsp; Jun 26 15:30:43 [5775]: Now running as user &quot;nobody&quot;.<br />ERROR&nbsp; &nbsp; &nbsp;Jun 26 15:30:43 [5775]: Could not allocate memory for child counting.</p></blockquote></div><p>my config file is like:<br /></p><div class="quotebox"><blockquote><p>##<br />## tinyproxy.conf -- tinyproxy daemon configuration file<br />##</p><p>#<br /># Name of the user the tinyproxy daemon should switch to after the port<br /># has been bound.<br />#<br />User nobody<br />Group nogroup</p><p>#<br /># Port to listen on.<br />#<br />Port 8888</p><p>#<br /># If you have multiple interfaces this allows you to bind to only one. If<br /># this is commented out, tinyproxy will bind to all interfaces present.<br />#<br />Listen 192.168.1.1</p><p>#<br /># The Bind directive allows you to bind the outgoing connections to a<br /># particular IP address.<br />#<br />#Bind 192.168.0.1</p><p>#<br /># Timeout: The number of seconds of inactivity a connection is allowed to<br /># have before it closed by tinyproxy.<br />#<br />Timeout 600</p><p>#<br /># ErrorFile: Defines the HTML file to send when a given HTTP error<br /># occurs.&nbsp; You will probably need to customize the location to your<br /># particular install.&nbsp; The usual locations to check are:<br />#&nbsp; &nbsp;/usr/local/share/tinyproxy<br />#&nbsp; &nbsp;/usr/share/tinyproxy<br />#&nbsp; &nbsp;/etc/tinyproxy<br />#<br /># ErrorFile 404 &quot;/usr/share/tinyproxy/404.html&quot;<br /># ErrorFile 400 &quot;/usr/share/tinyproxy/400.html&quot;<br /># ErrorFile 503 &quot;/usr/share/tinyproxy/503.html&quot;<br /># ErrorFile 403 &quot;/usr/share/tinyproxy/403.html&quot;<br /># ErrorFile 408 &quot;/usr/share/tinyproxy/408.html&quot;</p><p># <br /># DefaultErrorFile: The HTML file that gets sent if there is no<br /># HTML file defined with an ErrorFile keyword for the HTTP error<br /># that has occured.<br />#<br />DefaultErrorFile &quot;/usr/share/tinyproxy/default.html&quot;</p><p>#<br /># StatFile: The HTML file that gets sent when a request is made<br /># for the stathost.&nbsp; If this file doesn&#039;t exist a basic page is<br /># hardcoded in tinyproxy.<br />#<br />StatFile &quot;/usr/share/tinyproxy/stats.html&quot;</p><p>#<br /># Where to log the information. Either LogFile or Syslog should be set,<br /># but not both.<br />#<br />Logfile &quot;/var/log/tinyproxy.log&quot;<br /># Syslog On</p><p>#<br /># Set the logging level. Allowed settings are:<br />#Critical(least verbose)<br />#Error<br />#Warning<br />#Notice<br />#Connect(to log connections without Info&#039;s noise)<br />#Info(most verbose)<br /># The LogLevel logs from the set level and above. For example, if the LogLevel<br /># was set to Warning, than all log messages from Warning to Critical would be<br /># output, but Notice and below would be suppressed.<br />#<br />LogLevel Info</p><p>#<br /># PidFile: Write the PID of the main tinyproxy thread to this file so it<br /># can be used for signalling purposes.<br />#<br />PidFile &quot;/var/run/tinyproxy.pid&quot;</p><p>#<br /># Include the X-Tinyproxy header, which has the client&#039;s IP address when<br /># connecting to the sites listed.<br />#<br />#XTinyproxy mydomain.com</p><p>#<br /># Turns on upstream proxy support.<br />#<br /># The upstream rules allow you to selectively route upstream connections<br /># based on the host/domain of the site being accessed.<br />#<br /># For example:<br />#&nbsp; # connection to test domain goes through testproxy<br />#&nbsp; upstream testproxy:8008 &quot;.test.domain.invalid&quot;<br />#&nbsp; upstream testproxy:8008 &quot;.our_testbed.example.com&quot;<br />#&nbsp; upstream testproxy:8008 &quot;192.168.128.0/255.255.254.0&quot;<br />#<br />#&nbsp; # no upstream proxy for internal websites and unqualified hosts<br />#&nbsp; no upstream &quot;.internal.example.com&quot;<br />#&nbsp; no upstream &quot;<a href="http://www.example.com">www.example.com</a>&quot;<br />#&nbsp; no upstream &quot;10.0.0.0/8&quot;<br />#&nbsp; no upstream &quot;192.168.0.0/255.255.254.0&quot;<br />#&nbsp; no upstream &quot;.&quot;<br />#<br />#&nbsp; # connection to these boxes go through their DMZ firewalls<br />#&nbsp; upstream cust1_firewall:8008 &quot;testbed_for_cust1&quot;<br />#&nbsp; upstream cust2_firewall:8008 &quot;testbed_for_cust2&quot;<br />#<br />#&nbsp; # default upstream is internet firewall<br />#&nbsp; upstream firewall.internal.example.com:80<br />#<br /># The LAST matching rule wins the route decision.&nbsp; As you can see, you<br /># can use a host, or a domain:<br />#&nbsp; name&nbsp; &nbsp; &nbsp;matches host exactly<br />#&nbsp; .name&nbsp; &nbsp; matches any host in domain &quot;name&quot;<br />#&nbsp; .&nbsp; &nbsp; &nbsp; &nbsp; matches any host with no domain (in &#039;empty&#039; domain)<br />#&nbsp; IP/bits&nbsp; matches network/mask<br />#&nbsp; IP/mask&nbsp; matches network/mask<br />#<br />#Upstream some.remote.proxy:port</p><p>#<br /># This is the absolute highest number of threads which will be created. In<br /># other words, only MaxClients number of clients can be connected at the<br /># same time.<br />#<br />MaxClients 10</p><p>#<br /># These settings set the upper and lower limit for the number of<br /># spare servers which should be available. If the number of spare servers<br /># falls below MinSpareServers then new ones will be created. If the number<br /># of servers exceeds MaxSpareServers then the extras will be killed off.<br />#<br />MinSpareServers 5<br />MaxSpareServers 10</p><p>#<br /># Number of servers to start initially.<br />#<br />StartServers 3</p><p>#<br /># MaxRequestsPerChild is the number of connections a thread will handle<br /># before it is killed. In practise this should be set to 0, which disables<br /># thread reaping. If you do notice problems with memory leakage, then set<br /># this to something like 10000<br />#<br />MaxRequestsPerChild 10000</p><p>#<br /># The following is the authorization controls. If there are any access<br /># control keywords then the default action is to DENY. Otherwise, the<br /># default action is ALLOW.<br />#<br /># Also the order of the controls are important. The incoming connections<br /># are tested against the controls based on order.<br />#<br />Allow 127.0.0.1<br />Allow 192.168.1.0/25</p><p>#<br /># The &quot;Via&quot; header is required by the HTTP RFC, but using the real host name<br /># is a security concern.&nbsp; If the following directive is enabled, the string<br /># supplied will be used as the host name in the Via header; otherwise, the<br /># server&#039;s host name will be used.<br />#<br />ViaProxyName &quot;tinyproxy&quot;</p><p>#<br /># The location of the filter file.<br />#<br />#Filter &quot;/etc/tinyproxy/filter&quot;</p><p>#<br /># Filter based on URLs rather than domains.<br />#<br />#FilterURLs On</p><p>#<br /># Use POSIX Extended regular expressions rather than basic.<br />#<br />#FilterExtended On</p><p>#<br /># Use case sensitive regular expressions.<br />#&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />#FilterCaseSensitive On&nbsp; &nbsp; &nbsp;</p><p>#<br /># Change the default policy of the filtering system.&nbsp; If this directive is<br /># commented out, or is set to &quot;No&quot; then the default policy is to allow<br /># everything which is not specifically denied by the filter file.<br />#<br /># However, by setting this directive to &quot;Yes&quot; the default policy becomes to<br /># deny everything which is _not_ specifically allowed by the filter file.<br />#<br />#FilterDefaultDeny Yes</p><p>#<br /># If an Anonymous keyword is present, then anonymous proxying is enabled.<br /># The headers listed are allowed through, while all others are denied. If<br /># no Anonymous keyword is present, then all header are allowed through.<br /># You must include quotes around the headers.<br />#<br />#Anonymous &quot;Host&quot;<br />#Anonymous &quot;Authorization&quot;</p><p>#<br /># This is a list of ports allowed by tinyproxy when the CONNECT method<br /># is used.&nbsp; To disable the CONNECT method altogether, set the value to 0.<br /># If no ConnectPort line is found, all ports are allowed (which is not<br /># very secure.)<br />#<br /># The following two ports are used by SSL.<br />#<br />ConnectPort 443<br />ConnectPort 563</p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p29542">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">docanime</div>
					<div class="post-datetime">
						27 Jun 2006, 07:32					</div>
				</div>
				<div class="post-content content">
					<p>How much free space/memory do you have? One option may be to change the &quot;StartServers 3&quot; to &quot;StartServers 1&quot;.</p><p>DA</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p29564">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">combro2k</div>
					<div class="post-datetime">
						27 Jun 2006, 18:32					</div>
				</div>
				<div class="post-content content">
					<p>same problem :S</p><p>my memory atm:</p><div class="quotebox"><blockquote><p>total:&nbsp; &nbsp; used:&nbsp; &nbsp; free:&nbsp; shared: buffers:&nbsp; cached:<br />Mem:&nbsp; 31289344 19845120 11444224&nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp;712704&nbsp; 8634368<br />Swap:&nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0<br />MemTotal:&nbsp; &nbsp; &nbsp; &nbsp; 30556 kB<br />MemFree:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;11176 kB<br />MemShared:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 kB<br />Buffers:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;696 kB<br />Cached:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;8432 kB<br />SwapCached:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 kB<br />Active:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;6652 kB<br />Inactive:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2504 kB<br />HighTotal:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 kB<br />HighFree:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 kB<br />LowTotal:&nbsp; &nbsp; &nbsp; &nbsp; 30556 kB<br />LowFree:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;11176 kB<br />SwapTotal:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 kB<br />SwapFree:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 kB</p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p29585">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">docanime</div>
					<div class="post-datetime">
						28 Jun 2006, 08:03					</div>
				</div>
				<div class="post-content content">
					<p>what kind of router are you using?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p29595">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">combro2k</div>
					<div class="post-datetime">
						28 Jun 2006, 13:24					</div>
				</div>
				<div class="post-content content">
					<p>Linksys WRT54GS V2</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p29655">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">hawson</div>
					<div class="post-datetime">
						29 Jun 2006, 09:05					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m seeing the same problem on my WRT45G (runing RC5).&nbsp; I did a bunch of digging, and I&#039;m not completely sure of the cause.&nbsp; This post is similar, and makes me wonder if there are some oddities with running system calls like ftruncate() and mkstemp() on ramdisks.<br />&nbsp; &nbsp; <a href="http://archives.neohapsis.com/archives/openbsd/2005-08/1333.html">http://archives.neohapsis.com/archives/ … /1333.html</a></p><p>Are there any other lightweight http proxy daemons already packaged?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p34968">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">alastair</div>
					<div class="post-datetime">
						6 Oct 2006, 06:03					</div>
				</div>
				<div class="post-content content">
					<p>Check permissions of your /tmp directory.</p><p>I had the same problem until I did a chmod a+w /tmp</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p35711">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">paralias</div>
					<div class="post-datetime">
						19 Oct 2006, 23:07					</div>
				</div>
				<div class="post-content content">
					<p>same problem here. Any news?</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>