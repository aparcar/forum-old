<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> iTunes server (forked-daapd)</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 28 Feb 2018 and 28 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 2 of 3</div><nav><ul><li><a href="viewtopic.php%3Fid=30302&amp;p=1.html">1</a></li><li class="pagination-current"><span>2</span></li><li><a href="viewtopic.php%3Fid=30302&amp;p=3.html">3</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p153233">
				<div class="post-metadata">
					<div class="post-num">Post #26</div>
					<div class="post-author">maartenst</div>
					<div class="post-datetime">
						5 Jan 2012, 20:56					</div>
				</div>
				<div class="post-content content">
					<p>ok, found a way to upgrade to trunk, going to try it : <a href="http://wiki.openwrt.org/doc/howto/generic.sysupgrade">http://wiki.openwrt.org/doc/howto/generic.sysupgrade</a></p>											<p class="post-edited">(Last edited by <strong>maartenst</strong> on 5 Jan 2012, 21:24)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p161675">
				<div class="post-metadata">
					<div class="post-num">Post #27</div>
					<div class="post-author">ssi</div>
					<div class="post-datetime">
						21 Mar 2012, 23:27					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>ejurgensen wrote:</cite><blockquote><p>The forked-daapd server no longer requires a modified version of sqlite3. Forked-daapd depends on a certain compile option in sqlite3 being enabled, and the good people of OpenWrt have now enabled it in trunk (since version 3070701-2 of sqlite3).</p><p>As forked-daapd no longer requires custom versions of any packages it&#039;ll be easier to install. Being compatible with trunk also means I can look into submitting it for inclusion.</p></blockquote></div><p>Does your version contain the the patch for iTunes 10.5-&gt; timeouts? </p><br /><p>The patch is for libevent version, not the GCD-version. If I&#039;ve understood correctly the openwrt version uses libevent atm. See: <a href="https://github.com/jasonmc/forked-daapd/issues/19#issuecomment-3328436">https://github.com/jasonmc/forked-daapd … nt-3328436</a></p><p>More detailed description of the problem and the patch itself can be found from here: <a href="https://github.com/CBGoodBuddy/forked-daapd/commit/bd10978d5240bc22c03a6f3bd0492a6318b7d67d">https://github.com/CBGoodBuddy/forked-d … 6318b7d67d</a></p><p>Hopefully an easy way for applying the patch can be found from: <a href="https://github.com/jasonmc/forked-daapd/issues/19#issuecomment-3331508">https://github.com/jasonmc/forked-daapd … nt-3331508</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p161714">
				<div class="post-metadata">
					<div class="post-num">Post #28</div>
					<div class="post-author">ejurgensen</div>
					<div class="post-datetime">
						22 Mar 2012, 10:33					</div>
				</div>
				<div class="post-content content">
					<p>My version is plain 0.19, so it&#039;s without the patch. And you&#039;re right, it&#039;s the libevent-version.</p><p>Thanks for bringing it to my attention, I&#039;ll look into applying it. Seems like an annoying bug, I wonder why upstream hasn&#039;t fixed it yet.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p163822">
				<div class="post-metadata">
					<div class="post-num">Post #29</div>
					<div class="post-author">ssi</div>
					<div class="post-datetime">
						9 Apr 2012, 12:53					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>ejurgensen wrote:</cite><blockquote><p>My version is plain 0.19, so it&#039;s without the patch. And you&#039;re right, it&#039;s the libevent-version.</p><p>Thanks for bringing it to my attention, I&#039;ll look into applying it. Seems like an annoying bug, I wonder why upstream hasn&#039;t fixed it yet.</p></blockquote></div><p>Hi,</p><p>any news on applying the patch? <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> I&#039;m just wondering if I should start setting up a build environment myself or not...</p><br /><p>I probably should as the current version of forked-daapd segfaults on with the current snapshot (March 14.) of the trunk. At least on my wndr3800...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p163909">
				<div class="post-metadata">
					<div class="post-num">Post #30</div>
					<div class="post-author">ejurgensen</div>
					<div class="post-datetime">
						10 Apr 2012, 00:45					</div>
				</div>
				<div class="post-content content">
					<p>No news - I&#039;ve been busy with some other stuff. I wasn&#039;t aware that it is broken with the current snapshot, thanks for reporting it.</p><p>It might take a while before I can look at the patch and fixing it, so it would be great if you would help. I&#039;ll send you a PM. Maybe we can also look at submitting it to OpenWrt, so it will be easier to maintain.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p164290">
				<div class="post-metadata">
					<div class="post-num">Post #31</div>
					<div class="post-author">ssi</div>
					<div class="post-datetime">
						12 Apr 2012, 20:04					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ll try to take a look at applying the patch myself. Uni is also keeping me quite busy for the rest of springtime, so it might take a while also if I don&#039;t manage to do it during next weekend...</p><p>Oh, and about the segfault. It also might be that I didn&#039;t have all the proper libraries installed and services running last time I tried. I&#039;ll report back on weekend when I have time to try messing with the box again.</p>											<p class="post-edited">(Last edited by <strong>ssi</strong> on 12 Apr 2012, 20:06)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p170818">
				<div class="post-metadata">
					<div class="post-num">Post #32</div>
					<div class="post-author">ejurgensen</div>
					<div class="post-datetime">
						24 Jun 2012, 17:34					</div>
				</div>
				<div class="post-content content">
					<p>I finally got around to fixing this. Apparently my forked-daapd package has been broken since trunk moved away from kernel 2.6, which is very regrettable. This should all be fixed now, and I&#039;ve also applied the patch suggested by ssi regarding iTunes 10.5 time-outs.</p><p>These changes are available in release 4 (see how to get here: <a href="http://wiki.openwrt.org/inbox/howto/forked-daapd)">http://wiki.openwrt.org/inbox/howto/forked-daapd)</a>. Release 3 is vanilla forked-daapd 0.19 fixed to work in current snapshot of trunk, but without the time-out patch.</p><p>I haven&#039;t gotten around to actually upgrading my router to current trunk, so these releases are untested. If anyone knows of a way to run trunk in a vm please let me know. It would make testing a lot easier.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p172224">
				<div class="post-metadata">
					<div class="post-num">Post #33</div>
					<div class="post-author">luisfmoreira</div>
					<div class="post-datetime">
						14 Jul 2012, 01:11					</div>
				</div>
				<div class="post-content content">
					<p>Hi, I&#039;ve installed forked-daapd but I can&#039;t get it to work. I get a database error on the log, but I don&#039;t think it even created the db. <br />Can someone please give me a tip?</p><p>Thanks</p><p>Log:<br />[2012-07-13 22:05:30]&nbsp; &nbsp; &nbsp;main: Forked Media Server Version 0.19 taking off<br />[2012-07-13 22:05:30]&nbsp; &nbsp; &nbsp;main: Initialized with gcrypt 1.5.0<br />[2012-07-13 22:05:30]&nbsp; &nbsp; &nbsp;main: PID: 2502<br />[2012-07-13 22:05:30]&nbsp; &nbsp; &nbsp;main: mDNS init<br />[2012-07-13 22:05:30]&nbsp; &nbsp; &nbsp;mdns: Initializing Avahi mDNS<br />[2012-07-13 22:05:30]&nbsp; &nbsp; &nbsp;mdns: Avahi state change: Client running<br />[2012-07-13 22:05:30]&nbsp; &nbsp; &nbsp;mdns: Creating service group<br />[2012-07-13 22:05:30]&nbsp; &nbsp; &nbsp;mdns: No entries yet... skipping service create<br />[2012-07-13 22:05:30]&nbsp; &nbsp; &nbsp;main: Initializing database<br />[2012-07-13 22:05:30]&nbsp; &nbsp; &nbsp; &nbsp;db: Could not open database: unable to open database file<br />[2012-07-13 22:05:30]&nbsp; &nbsp; &nbsp;main: Database init failed<br />[2012-07-13 22:05:30]&nbsp; &nbsp; &nbsp;main: mDNS deinit<br />[2012-07-13 22:05:30]&nbsp; &nbsp; &nbsp;main: Exiting.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p172280">
				<div class="post-metadata">
					<div class="post-num">Post #34</div>
					<div class="post-author">ejurgensen</div>
					<div class="post-datetime">
						14 Jul 2012, 18:30					</div>
				</div>
				<div class="post-content content">
					<p>First thing to check is that the location of the database file is a valid path, and that forked-daapd has write access. You can also check if it creates the database file. Next you can try increasing the log-level - maybe it will say more specifically what is going wrong.</p><p>Do you know what revision of trunk you are running?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p172359">
				<div class="post-metadata">
					<div class="post-num">Post #35</div>
					<div class="post-author">luisfmoreira</div>
					<div class="post-datetime">
						15 Jul 2012, 19:42					</div>
				</div>
				<div class="post-content content">
					<p>Hi, thanks for answering! </p><p>The log level is already spam and the trunk version is Bleeding Edge, r32603, I think the location is a valid path (at least I can create directories, I even tried on /etc/) but it doesn&#039;t seem to create anything.&nbsp; How can I check if forked daapd has write access?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p172381">
				<div class="post-metadata">
					<div class="post-num">Post #36</div>
					<div class="post-author">ejurgensen</div>
					<div class="post-datetime">
						15 Jul 2012, 23:28					</div>
				</div>
				<div class="post-content content">
					<p>Well it&#039;s probably running as root (that&#039;s default), so if the path is valid then write access shouldn&#039;t be a problem. Your trunk version is newer than mine, but I don&#039;t see anything changed that could have broken forked-daapd. The error message is from sqlite3, but I&#039;m out of ideas why it can&#039;t open the file.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p182449">
				<div class="post-metadata">
					<div class="post-num">Post #37</div>
					<div class="post-author">ejurgensen</div>
					<div class="post-datetime">
						5 Nov 2012, 15:16					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ve updated the forked-daapd package with a small fix against libevent, which prevented it from building in trunk. I&#039;ve also submitted it for inclusion in OpenWrt. It is now version 0.19, release 5.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p193694">
				<div class="post-metadata">
					<div class="post-num">Post #38</div>
					<div class="post-author">hanrahan</div>
					<div class="post-datetime">
						3 Mar 2013, 18:47					</div>
				</div>
				<div class="post-content content">
					<p>I tried to install forked-daapd on my wr703n using extroot running on a usb flash stick.</p><p>Everything installed properly. When I try to start forked-daapd, I have a problem with shared libraries.</p><p># /etc/init.d/forked-daapd start<br />/usr/sbin/forked-daapd: can&#039;t load library &#039;libavcodec.so.53&#039;</p><p>The ones I have are libavcodec.so.54</p><p>What is the best way to fix this problem?</p><p>Thanks!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p204120">
				<div class="post-metadata">
					<div class="post-num">Post #39</div>
					<div class="post-author">RuyBlas</div>
					<div class="post-datetime">
						9 Jun 2013, 12:55					</div>
				</div>
				<div class="post-content content">
					<p>Hello !</p><p>I am an happy user of a Asus RT-N66U.<br />I already have installed a custom Shibby firmware and enwtware package system.<br />Now I would like to use forked-daapd on it.</p><p>So I installed toolchain like described here <a href="http://wiki.openwrt.org/doc/howto/buildroot.exigence">http://wiki.openwrt.org/doc/howto/buildroot.exigence</a> , here : <a href="http://wiki.openwrt.org/doc/howto/build">http://wiki.openwrt.org/doc/howto/build</a> and here <a href="http://wiki.openwrt.org/doc/devel/crosscompile">http://wiki.openwrt.org/doc/devel/crosscompile</a><br />I think I have now a toolchain ready for architecture &quot;mipsel&quot; (my router has BCM4706 CPU)</p><p>Now I try to use this <a href="http://wiki.openwrt.org/inbox/howto/forked-daapd">http://wiki.openwrt.org/inbox/howto/forked-daapd</a>&nbsp; to build forked-daapd<br />As requested I have downloaded this package <a href="http://www.gyfgafguf.dk/openwrt/src/source.tar.gz">http://www.gyfgafguf.dk/openwrt/src/source.tar.gz</a></p><p>And I have this when i make :<br /></p><div class="codebox"><pre><code>make[3]: Entering directory `/home/.../openwrt/trunk/package/libantlr3c&#039;
mkdir -p /home/.../openwrt/trunk/dl
/home/.../openwrt/trunk/scripts/download.pl &quot;/home/.../openwrt/trunk/dl&quot; &quot;libantlr3c-3.2.tar.gz&quot; &quot;674646e1d1bf5c6015435480cead725a&quot; &quot;http://www.antlr.org/download/C&quot;
--2013-06-09 13:05:04--  http://www.antlr.org/download/C/libantlr3c-3.2.tar.gz
Resolving www.antlr.org (www.antlr.org)... 138.202.170.10
Connecting to www.antlr.org (www.antlr.org)|138.202.170.10|:80... connected.
HTTP request sent, awaiting response... 404 Not Found
2013-06-09 13:05:06 ERROR 404: Not Found.

Download failed.
--2013-06-09 13:05:06--  http://mirror2.openwrt.org/sources/libantlr3c-3.2.tar.gz
Resolving mirror2.openwrt.org (mirror2.openwrt.org)... 46.4.11.11
Connecting to mirror2.openwrt.org (mirror2.openwrt.org)|46.4.11.11|:80... connected.
HTTP request sent, awaiting response... 404 Not Found
2013-06-09 13:05:06 ERROR 404: Not Found.

Download failed.
--2013-06-09 13:05:06--  http://downloads.openwrt.org/sources/libantlr3c-3.2.tar.gz
Resolving downloads.openwrt.org (downloads.openwrt.org)... 78.24.191.177
Connecting to downloads.openwrt.org (downloads.openwrt.org)|78.24.191.177|:80... connected.
HTTP request sent, awaiting response... 404 Not Found
2013-06-09 13:05:07 ERROR 404: Not Found.

Download failed.</code></pre></div><p>Answer to myself (could be useful for others) :<br />put <a href="http://pkgs.fedoraproject.org/repo/pkgs/antlr3/libantlr3c-3.2.tar.gz/674646e1d1bf5c6015435480cead725a">http://pkgs.fedoraproject.org/repo/pkgs … 80cead725a</a><br />in PKG_SOURCE_URL of openwrt/trunk/package/libantlr3c/Makefile</p><p>Now another problem :<br /></p><div class="codebox"><pre><code>checking for ld used by GCC... mipsel-openwrt-linux-uclibc-ld
checking if the linker (mipsel-openwrt-linux-uclibc-ld) is GNU ld... yes
checking for shared library run path origin... done
checking for iconv... no, consider installing GNU libiconv
checking for libunistring... yes
checking how to link with libunistring... -lunistring
checking pkg-config is at least version 0.9.0... yes
checking for ZLIB... yes
checking for CONFUSE... yes
checking for AVAHI... no
configure: error: Package requirements ( avahi-client &gt;= 0.6.24 ) were not met:

No package &#039;avahi-client&#039; found

Consider adjusting the PKG_CONFIG_PATH environment variable if you
installed software in a non-standard prefix.

Alternatively, you may set the environment variables AVAHI_CFLAGS
and AVAHI_LIBS to avoid the need to call pkg-config.
See the pkg-config man page for more details.</code></pre></div><p>I have installed libavahi :<br />./scripts/feeds install&nbsp; libavahi avahi-utils avahi-daemon avahi-dnsconfd</p><p>=&gt; Found my mistake ! After installing with &quot;feeds&quot;, you have to &quot;make menuconfig&quot; and put an &quot;M&quot; for new packages... before the compilation.</p>											<p class="post-edited">(Last edited by <strong>RuyBlas</strong> on 9 Jun 2013, 15:57)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p206290">
				<div class="post-metadata">
					<div class="post-num">Post #40</div>
					<div class="post-author">ejurgensen</div>
					<div class="post-datetime">
						2 Jul 2013, 23:10					</div>
				</div>
				<div class="post-content content">
					<p>@RuyBlas: I&#039;m not familiar with the Asus + Shibby firmware, but I&#039;m guessing that since you made your post you&#039;ve encountered more trouble compiling forked-daapd. </p><p>I had a look at source.tar.gz, and I can see it needed some improvements. So I&#039;ve made some changes and uploaded a new version. The new version links to a version of forked-daapd which has been patched for Remote 3 and ffmpeg 0.11.</p><p>When I compile, I just download the OpenWrt trunk source (instructions: <a href="https://dev.openwrt.org/wiki/GetSource),">https://dev.openwrt.org/wiki/GetSource),</a> install required packages + forked-daapd, libavl, libantlr3c and libunistring. Then make menuconfig and select forked-daapd (everything else should select automatically). And then compile. Here&#039;s the complete list of the commands (some stuff commented out - note first packages should be installed in your native Linux, if you don&#039;t have them already): <a href="http://www.gyfgafguf.dk/openwrt/src/mk_build_env">http://www.gyfgafguf.dk/openwrt/src/mk_build_env</a> (assumes you unpack source.tar.gz in ~/OpenWrt/local)</p><p>Compiling works for me, but forked-daapd has a few bugs preventing me from really using it. The bugs are mentioned here: <a href="http://wiki.openwrt.org/inbox/howto/forked-daapd">http://wiki.openwrt.org/inbox/howto/forked-daapd</a> (1 &amp; 2)</p>											<p class="post-edited">(Last edited by <strong>ejurgensen</strong> on 2 Jul 2013, 23:15)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p207115">
				<div class="post-metadata">
					<div class="post-num">Post #41</div>
					<div class="post-author">jkiddo</div>
					<div class="post-datetime">
						14 Jul 2013, 16:31					</div>
				</div>
				<div class="post-content content">
					<p>Has anywone had a look @ <a href="https://www.flyn.org/projects/dmapd/">https://www.flyn.org/projects/dmapd/</a> recently for OpenWrt? It might not be up-to-date, but it contains a lot of sweet funtionality. </p><p>And anyway, if there should be anyone out there that would like to have a look at an up-to-date implementation in Java, have a look at <a href="https://github.com/jkiddo/jolivia">https://github.com/jkiddo/jolivia</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p210838">
				<div class="post-metadata">
					<div class="post-num">Post #42</div>
					<div class="post-author">ejurgensen</div>
					<div class="post-datetime">
						26 Aug 2013, 12:00					</div>
				</div>
				<div class="post-content content">
					<p>dmapd looks quite promising, and it even appears to be actively maintained. There is even a Makefile. I could compile it without trouble, so that was good too. However, when I ran it, it just spewed lots of error messages, so I guess something needs some tweeking after all. Googling it, I couldn&#039;t find much about others running it.</p><p>forked-daapd is working better on OpenWrt now, with the exception of my m4a files. They push the CPU to 100% on my WNDR3700, and I can&#039;t figure out why.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p215001">
				<div class="post-metadata">
					<div class="post-num">Post #43</div>
					<div class="post-author">ErikOnBike</div>
					<div class="post-datetime">
						17 Oct 2013, 09:36					</div>
				</div>
				<div class="post-content content">
					<p>Hi ejurgensen,</p><p>I was browsing your work (both on OpenWrt and for the Raspberry Pi) to catch up on this topic. I noticed you recently added support for non-encrypted streaming. It is my believe that all Airport and Apple TV devices support this non-encrypted streaming. This could help lower the (CPU) resource usage of forked-daapd. I have an old Airport express and it happily accepts non-encrypted streams. Because of this, I can stream ALAC files (old Airport does not support much else except PCM streams) almost directly from the file system. This keeps resource usage very low. The downside is, it will only work with TCP and not UDP (partly because of the large packets in standard ALAC files with 4096 frames per packet). The TCP support is not present on Apple TV devices. I do not own an Apple TV, so I have not been able to play around with it enough to be conclusive about the same kind of streaming on it. Again, I think Apple TV devices will allow streaming unencrypted data. With its direct support for AAC I assume you can stream AAC files also &#039;almost&#039; directly from the file system to the Apple TV, keeping resource usage to a minimum. You mentioned somewhere that ALAC in forked-daapd take up a huge amount of CPU-cycles. My solution works with a low resource consumption because it does not perform any encryption and because it does not perform any audio decoding and encoding (that is all done by the Airport device itself). And a nice side effect is, that it does not require many external libraries.</p><p>I&#039;m currently working on a small piece of software to do the streaming of my ALAC library for my WNDR3700. The software should be portable to other devices as well. I&#039;ll make the sources public once it is stable enough. Actually I have started this quite some time ago. Other things, like a great summer with lots of biking, stopped me from working on it. Now I&#039;m getting back to it with the weather changing and a bit more time on my hands (I hope). If there is enough interest I might try to get my hands on an Apple TV and see if I can get it to work on it as well. Do not expect this to happen within the first few weeks. The old Airport express version should be finished for the end of the year though.</p><p>See also: <a href="http://erikonbike.blogspot.nl/">http://erikonbike.blogspot.nl/</a></p><p>Hope this is useful info.</p><p>Cheers,<br />Erik</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p215012">
				<div class="post-metadata">
					<div class="post-num">Post #44</div>
					<div class="post-author">ejurgensen</div>
					<div class="post-datetime">
						17 Oct 2013, 11:20					</div>
				</div>
				<div class="post-content content">
					<p>Hi mr. Bike! Wow, very interesting read. Seems we share the same interest. I always wanted to use just serve from my router, but I was never able to solve the CPU problem, so in the end I bought the Raspberry.</p><p>The idea that removing the encryption could solve the problem never occured to me, but when I get home I&#039;ll try straight away. forked-daapd does not encrypt when streaming to Apple TV, so it should be simple to test. My previous tests were always with Airport Express, so I never tried the other combination.</p><p>Disabling encryption towards Airport Express in forked-daapd would be very simple. I could make it a configurable option, just to be safe.</p><p>Making your own server sounds pretty ambitious! Are you on github, so I can follow your work?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p215049">
				<div class="post-metadata">
					<div class="post-num">Post #45</div>
					<div class="post-author">ErikOnBike</div>
					<div class="post-datetime">
						17 Oct 2013, 21:39					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m not on Github yet. Still a bit uncomfortable with the current code quality (rest assured I don&#039;t want to keep &#039;improving&#039; it indefinitely).</p><p>Interested to hear/read what your experience is when disabling/removing the encryption.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p215050">
				<div class="post-metadata">
					<div class="post-num">Post #46</div>
					<div class="post-author">ejurgensen</div>
					<div class="post-datetime">
						17 Oct 2013, 22:57					</div>
				</div>
				<div class="post-content content">
					<p>Well, I just tested, and unfortunately removing encryption did not solve my CPU problems. I noticed that I only have problems with AAC-files, not with ALAC and MP3. So it seems like it would be a transcoding issue, but I&#039;m pretty sure I disabled transcoding in my previous tests.</p><p>Encryption doesn&#039;t seem to consume much CPU. I measured with &#039;top&#039; on my WNDR3700 streaming an ALAC: 12% when streaming to ATV, and 15% when streaming to Airport Express.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p215052">
				<div class="post-metadata">
					<div class="post-num">Post #47</div>
					<div class="post-author">ErikOnBike</div>
					<div class="post-datetime">
						17 Oct 2013, 23:27					</div>
				</div>
				<div class="post-content content">
					<p>Hmmm... not sure what is happening then. My application actually only copies packets right out of the m4a file into a buffer it then sends out over a (TCP for now) network connection. So there is absolutely no handling of the data. Packet sizes (compressed, so different sizes per packet) are right in the m4a-file, so the application knows how much data to fetch. On my laptop right now (so not really fair comparison) it does not reach 1% CPU usage. I do not create large buffers or anything (it will run with very little memory available). The application scans the m4a file first to determine some necessary information like duration and position of packets within the file. It also keeps track of the largest packet size and a single buffer to hold this largest packet is then created and used repeatedly (so no more memory allocation after first scan). This largest packet is only a few kilobytes big (for ALAC, for AAC it will even be less). Streaming the audio to the Airport express is done in a second pass of the file.</p><p>I&#039;m going to try and get my hands on an Apple TV device and see if I can do some tests. Will have to change and add some code to support UDP streaming though.</p><p>Will try to get back soon.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216561">
				<div class="post-metadata">
					<div class="post-num">Post #48</div>
					<div class="post-author">onlinespending</div>
					<div class="post-datetime">
						2 Nov 2013, 19:32					</div>
				</div>
				<div class="post-content content">
					<p>First of all, thanks for this effort to get forked-daapd on Openwrt. Awesome work! I have it up and running on my WDR4300 using a Barrier Breaker trunk build from a few days ago.</p><p>Everything seems to be working well. I am testing it out on a small 3 song database (just simple MP3s), and viewing the log file (with it set to &#039;spam&#039; level) I can see that it appears to be going well. I&#039;ve paired it with my iPad without issue.</p><p><strong>The only thing is, I can&#039;t see any of my songs in the Remote app (any of the 3).</strong> What&#039;s odd however, is if I select &quot;Movies&quot; under the shared library it does in fact show those 3 songs with the duration of those songs accurately reported. They don&#039;t play of course, but I&#039;m curious as to why 3 MP3s (one of which was an untouched Amazon purchase) would be scanned and showing up as a Movie by forked-daapd. If anyone is willing to look at my log file I&#039;d love to get to the bottom of this. Thank you!</p><p><strong>UPDATE:</strong> Here&#039;s the output of the log file that shows it failing to identify a simple MP3 as such.</p><p>[2013-11-02 09:35:18]&nbsp; &nbsp;ffmpeg: mjpeg decode frame unused 0 bytes<br />[2013-11-02 09:35:18]&nbsp; &nbsp; &nbsp;mdns: Successfully added mDNS services<br />[2013-11-02 10:48:48]&nbsp; &nbsp;ffmpeg: max_analyze_duration 5000000 reached at 5015510<br />[2013-11-02 10:48:48]&nbsp; &nbsp;ffmpeg: File position after avformat_find_stream_info() is 323884<br />[2013-11-02 10:48:48]&nbsp; &nbsp; &nbsp;scan: File has 2 streams<br />[2013-11-02 10:48:48]&nbsp; &nbsp; &nbsp;scan: File has video (stream 1)<br />[2013-11-02 10:48:48]&nbsp; &nbsp; &nbsp;scan: Duration 216946 ms, bitrate 261 kbps<br />[2013-11-02 10:48:48]&nbsp; &nbsp; &nbsp;scan: samplerate 44100, bps 16<br />[2013-11-02 10:48:48]&nbsp; &nbsp; &nbsp;scan: Unknown codec 0x8 (video: yes), format mp3 ((null))<br />[2013-11-02 10:48:48]&nbsp; &nbsp; &nbsp;scan: Picked up 0 tags from file metadata<br />[2013-11-02 10:48:48]&nbsp; &nbsp; &nbsp;scan: Picked up 0 tags from video stream metadata<br />[2013-11-02 10:48:48]&nbsp; &nbsp; &nbsp;scan: Picked up 0 tags with extra md_map<br />[2013-11-02 10:48:48]&nbsp; &nbsp; &nbsp;scan: Picked up 10 tags from file metadata<br />[2013-11-02 10:48:48]&nbsp; &nbsp; &nbsp;scan: Picked up 1 tags from video stream metadata<br />[2013-11-02 10:48:48]&nbsp; &nbsp; &nbsp;scan: Picked up 11 tags with generic md_map, 11 tags total</p><p>And the portion of the db write that shows it saving it as an Unknown video file format.</p><p>&#039;m4v&#039;, TRIM(NULL), TRIM(NULL), TRIM(NULL), TRIM(NULL), NULL, 261, 44100, 216946, 7102474, 2010, 1, 1, 1, 1, 0, 0, 0, 0, 0, 2, &#039;Unknown video file format&#039;, 1383414528, 1367344851, 0, 1383414528, 0, 0, &#039;mp4v&#039;,</p><p><strong>UPDATE2:</strong><br />I tried an .m4a AAC file and that works just fine. So that&#039;s encouraging. Looks like my issue is isolated to MP3 files. Maybe it&#039;s due to the ID3 tag version?</p>											<p class="post-edited">(Last edited by <strong>onlinespending</strong> on 2 Nov 2013, 23:19)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216577">
				<div class="post-metadata">
					<div class="post-num">Post #49</div>
					<div class="post-author">onlinespending</div>
					<div class="post-datetime">
						3 Nov 2013, 00:06					</div>
				</div>
				<div class="post-content content">
					<p>Well, .m4a files sort of play from my WDR4300. Looks like I&#039;m falling victim to the high CPU usage issue. A song can play just fine for 5 seconds, before the CPU maxes out and it no longer is heard on the Airport Express. It still shows as playing in the Remote app, just no sound. I can even pause the song, and resume playing for just 5 seconds before the issue creeps up again.</p><p>Interestingly, if I play the same song from Itunes on my Macbook (under Shared Libraries), CPU usage on OpenWRT is 0%. I suppose this merely sends the file to Itunes where the decode is happening, as opposed to using an Airport Express which requires decoding on the router?</p><p><strong>UPDATE:</strong> Well this sucks. Same issue with Ogg Vorbis files. Plays for 5 seconds before no sound. Also hitting 99% CPU usage.</p><p><strong>UPDATE2:</strong> Ahh! Figured out why my MP3s were be detected as Video files by FFMPEG. It&#039;s the stupid embedded artwork. I removed the embedded artwork and surely enough it plays just fine and no more high CPU usage either. So that&#039;s good. But a lot of my music library already has embedded artwork. Anyway around this with forked-daapd? I&#039;d rather keep the embedded artwork in there for other music players.</p><p>Looks like this embedded art issue with FFMPEG was also a problem with XMBC (<a href="https://github.com/xbmc/xbmc/pull/2905">https://github.com/xbmc/xbmc/pull/2905</a>)</p><div class="quotebox"><blockquote><p>[rbp/omxplayer] Ignore video stream in audio filetypes …</p><p>Since the ffmpeg 1.2 merge, we fail to play audio file with artwork.<br />These show up as having a mjpeg video stream, with just one frame in.<br />We get stuck in buffering and don&#039;t play the audio.</p><p>As people expect the paplayer behaviour, we ignore the video stream for<br />audio filetypes, so the audio can play with visualision.</p></blockquote></div>											<p class="post-edited">(Last edited by <strong>onlinespending</strong> on 3 Nov 2013, 01:20)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p217295">
				<div class="post-metadata">
					<div class="post-num">Post #50</div>
					<div class="post-author">onlinespending</div>
					<div class="post-datetime">
						11 Nov 2013, 18:43					</div>
				</div>
				<div class="post-content content">
					<p>FYI, Apple updated their Remote app for iOS 7 a couple of days ago and fortunately everything still works.</p>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 2 of 3</div><nav><ul><li><a href="viewtopic.php%3Fid=30302&amp;p=1.html">1</a></li><li class="pagination-current"><span>2</span></li><li><a href="viewtopic.php%3Fid=30302&amp;p=3.html">3</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>