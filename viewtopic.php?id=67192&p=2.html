<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Edimax BR-6478AC V2 - MT7620A</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 10 Apr 2018 and 21 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 2 of 2</div><nav><ul><li><a href="viewtopic.php%3Fid=67192&amp;p=1.html">1</a></li><li class="pagination-current"><span>2</span></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p339118">
				<div class="post-metadata">
					<div class="post-num">Post #26</div>
					<div class="post-author">rmurch</div>
					<div class="post-datetime">
						25 Sep 2016, 06:17					</div>
				</div>
				<div class="post-content content">
					<p>Just to close off on this target, the two remaining (major) issues were the non-powered usb port and non-working mt76 driver for the mt7612e chip.</p><p>To fix the mt76 error I had to manually add it&#039;s MAC address, as the driver was failing to read from the EEPROM. So this command adds the MAC (from the sticker on bottom of case) and allows wlan0 to come up.</p><p>Shows wlan0 has no MAC addy:<br /></p><div class="codebox"><pre><code>root@OpenWrt:/# iw wlan0 info
Interface wlan0
        ifindex 5
        wdev 0x1
        addr fd:ff:ff:ff:ff:ff
        type managed
        wiphy 0
        txpower 0.00 dBm
root@OpenWrt:/# iw wlan1 info
Interface wlan1
        ifindex 7
        wdev 0x100000001
        addr xx:xx:xx:xx:xx:c6
        type managed
        wiphy 1
        txpower 20.00 dBm</code></pre></div><p>Adds a valid MAC address:<br /></p><div class="codebox"><pre><code>root@OpenWrt:/# ip link set dev interface address XX:XX:XX:XX:XX:C7</code></pre></div><p>This allows wlan0 (mt76/mt7612en) to scan and detect networks but once hostapd attempts to use as a master/ap the interface completely disappears. Trying to use the latest mt76 driver almost compiles but the openwrt kernel is missing some new headers and needs an upgraded mac80211 library. So for this reason I am switching over to the LEDE git source and starting from scratch to try and make use of the latest mt76 driver and hopefully 80211ac with the mt7612e chipset.</p><p>The final issue was the usb port, but simply using an externally powered device, or a powered usb hub with usb-powered devices fixes the problem (for now). But I think the custom gpio (pin19) has something to do with enabling power on the usb port. Otherwise I have tested the usb port with both 1.1 and 2.0 devices using an externally powered usb hub and it works fine.</p><p>The only other issue I noticed with the 2.4GHz radio (mt7620/rt2880) was it seemed to be only using one antenna for tx and both antenna for rx, and I could not find any configuration options for the dual antennas via luci or any mention of antenna configuration in the source or dmesg output etc. Also still produces kernel dump with &quot;invalid EEPROM word 208&quot; error so I hope LEDE can improve on that too. Apart from that error it works fine in both master/ap or client modes.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p339248">
				<div class="post-metadata">
					<div class="post-num">Post #27</div>
					<div class="post-author">elektroman</div>
					<div class="post-datetime">
						26 Sep 2016, 19:47					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>rmurch wrote:</cite><blockquote><p>Currently working with elektroman&#039;s do-work/Edimax branch. I think anonymous commits are disabled so I cant push this commit up, but here is the current patch.</p></blockquote></div><p>As I said you can&#039;t push to other repositories unless you have rights.<br />You have to setup your own, or send me the<br />&quot;git format-patch&quot;<br />output.<br />I don&#039;t know if github uses gitolite for accessing the repositories, with this it&#039;s possible to &quot;open&quot; only a branch.</p><p>Now for the patches :<br />I pick all of your patches and the end of this week (maybe prior end) and test this with my on hardware which is hopefully arrived at this time.<br />I don&#039;t want act &quot;as a proxy&quot; without testing myself ...<br />And I need a (cheep) 802.11ac router with Gigabit NIC for testing<br />Maybe I find the missing MAC addresses.</p><p>For the missing tx radio/antenna on mt7620/rt2880.<br />This is normally read out via eeprom from the wireless NIC. There is no value inside UCI/LuCI. I know this from my work on 802.11ac USB drivers.</p><p>If you switch from OpenWRT to LEDE, this is (hopefully) simple<br />git format-patch <br />on OpenWRT<br />and import these patches with<br />git am</p><p>Is the wireless LED working with with the mt7612e driver ??</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p339292">
				<div class="post-metadata">
					<div class="post-num">Post #28</div>
					<div class="post-author">rmurch</div>
					<div class="post-datetime">
						27 Sep 2016, 02:19					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>elektroman wrote:</cite><blockquote><p>As I said you can&#039;t push to other repositories unless you have rights.<br />You have to setup your own, or send me the &quot;git format-patch&quot; output.</p></blockquote></div><p>The last two up-to-date patches on the openwrt source are included in this thread. Since moving to LEDE I have made a few more changes and will get that patch to you tonight or tomorrow morning (not on desktop atm sorry).</p><br /><div class="quotebox"><cite>elektroman wrote:</cite><blockquote><p>I don&#039;t want act &quot;as a proxy&quot; without testing myself ...<br />And I need a (cheep) 802.11ac router with Gigabit NIC for testing</p></blockquote></div><p>I think these br-6478ac v2&#039;s are great &quot;bang for buck&quot;, probably the cheapest ac1200+gigabit router on the market and the hardware specs are excellent. Wait until you see how useless the stock firmware is!</p><br /><div class="quotebox"><cite>elektroman wrote:</cite><blockquote><p>Maybe I find the missing MAC addresses.</p></blockquote></div><p>Done. Included in the LEDE patch I will post later. Basically took the pcie-bridge settings for wmac from the br6475n DTS and modified into the br6478acv2 DTS. I did not get to complete testing last night but it fixed the wlan0 mac address and also showed proper power output in db when previously it was always 0db. Both radio&#039;s still show 0 tx and 0 rx antennas available in &quot;iw list&quot;.</p><br /><div class="quotebox"><cite>elektroman wrote:</cite><blockquote><p>For the missing tx radio/antenna on mt7620/rt2880.<br />This is normally read out via eeprom from the wireless NIC. There is no value inside UCI/LuCI. I know this from my work on 802.11ac USB drivers.</p></blockquote></div><p>I think both radios need some love as far as eeprom reading, but they are kinda half way there.</p><div class="quotebox"><cite>elektroman wrote:</cite><blockquote><p>Is the wireless LED working with with the mt7612e driver ??</p></blockquote></div><p>The four LEDs on the board are all working via gpio toggles (/sys/class/gpio). I can also see 3 other nodes in /sys/class/gpio from the rt2800 for LEDs for the wlan1 (not mt7612e) but I dont think they are connected physically to any LEDs on the pcb. Unless they are used as gpio inputs and software was used to toggle the gpio outputs? Just a guess. The Edimax firmware did have some bash script in init to control the LEDs, I could dig through that some more.<br />I need to look into enabling debug output on the mt76, might give some more clues.</p><p>Just a quick update for now, and within 24 hours I will get the up-to-date LEDE patch posted here too.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p339383">
				<div class="post-metadata">
					<div class="post-num">Post #29</div>
					<div class="post-author">elektroman</div>
					<div class="post-datetime">
						27 Sep 2016, 20:48					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>rmurch wrote:</cite><blockquote><p>I think these br-6478ac v2&#039;s are great &quot;bang for buck&quot;, probably the cheapest ac1200+gigabit router on the market and the hardware specs are excellent. Wait until you see how useless the stock firmware is!</p></blockquote></div><p>I have the precursor, with RTL8812AE chipset and broken SoC CPU, because of saving some $$$ they do some commands in software. I don&#039;t know which money costs this IP, but this is a bad idea.<br /></p><div class="quotebox"><cite>rmurch wrote:</cite><blockquote><p>Done. Included in the LEDE patch I will post later. Basically took the pcie-bridge settings for wmac from the br6475n DTS and modified into the br6478acv2 DTS. I did not get to complete testing last night but it fixed the wlan0 mac address and also showed proper power output in db when previously it was always 0db. Both radio&#039;s still show 0 tx and 0 rx antennas available in &quot;iw list&quot;.</p><p>I think both radios need some love as far as eeprom reading, but they are kinda half way there.</p></blockquote></div><p>for 802.11ac to my knowledge not possible. The Xioami mini (which I own for testing) uses the same WIFI NIC. And with this I can see *two* streams on my mt7612u device.<br /></p><div class="quotebox"><cite>rmurch wrote:</cite><blockquote><p>The four LEDs on the board are all working via gpio toggles (/sys/class/gpio). I can also see 3 other nodes in /sys/class/gpio from the rt2800 for LEDs for the wlan1 (not mt7612e) but I dont think they are connected physically to any LEDs on the pcb.</p></blockquote></div><p>For the mt7612e (whatever) WIFI NIC I saw on this board here with some board a regression regarding the missing LED. On mt7610u/mt7612u this is controlled via the MCU. But the code is only in the mt7610u driver.And the mt76 doesn&#039;t have this code last time I check this some months ago</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p339473">
				<div class="post-metadata">
					<div class="post-num">Post #30</div>
					<div class="post-author">rmurch</div>
					<div class="post-datetime">
						28 Sep 2016, 10:56					</div>
				</div>
				<div class="post-content content">
					<p>Excuse the delay, please find below the 2x patches to bring the LEDE git source up to date. I stuffed up committing only the DTS file first (first patch) then commited all the other files (2nd patch).</p><p>0001-add-new-target-for-Edimax-BR-6478AC-V2.patch<br /></p><div class="codebox"><pre><code>From f09df373db93030fddfdc7ae8ec437adc3310ea2 Mon Sep 17 00:00:00 2001
From: &quot;R.Murch&quot; &lt;rohan.murch@gmail.com&gt;
Date: Wed, 28 Sep 2016 09:46:34 +1000
Subject: [PATCH] add new target for Edimax BR-6478AC V2

---
 target/linux/ramips/dts/BR-6478AC-V2.dts | 322 +++++++++++++++++++++++++++++++
 1 file changed, 322 insertions(+)
 create mode 100644 target/linux/ramips/dts/BR-6478AC-V2.dts

diff --git a/target/linux/ramips/dts/BR-6478AC-V2.dts b/target/linux/ramips/dts/BR-6478AC-V2.dts
new file mode 100644
index 0000000..db5cc42
--- /dev/null
+++ b/target/linux/ramips/dts/BR-6478AC-V2.dts
@@ -0,0 +1,322 @@
+/*
+ * Device Tree file for the Edimax BR-6478AC V2
+ * based on Linksys E1700
+ *
+ * Copyright (C) 2016 Hasn Ulli Kroll &lt;ulli.kroll@googlemail.com&gt;
+ *
+ * This file is licensed under the terms of the GNU General Public
+ * License version 2.  This program is licensed &quot;as is&quot; without any
+ * warranty of any kind, whether express or implied.
+ */
+
+/dts-v1/;
+
+/include/ &quot;mt7620a.dtsi&quot;
+
+/ {
+    compatible = &quot;edimax,br-6478ac-v2&quot;, &quot;ralink,mt7620a-soc&quot;;
+    model = &quot;Edimax BR-6478ACV2&quot;;
+
+    chosen {
+        bootargs = &quot;console=ttyS0,57600&quot;;
+    };
+
+    palmbus@10000000 {
+        gpio1: gpio@638 {
+            status = &quot;okay&quot;;
+        };
+        gpio2: gpio@660 {
+            status = &quot;okay&quot;;
+        };
+    //    enable-gpios = &lt;&amp;gpio0 19&gt;;
+
+    //    i2c: i2c@900 {
+    //        status = &quot;okay&quot;;
+    //    };
+
+        spi@b00 {
+            status = &quot;okay&quot;;
+            m25p80@0 {
+                #address-cells = &lt;1&gt;;
+                #size-cells = &lt;1&gt;;
+                compatible = &quot;jedec,spi-nor&quot;;
+                reg = &lt;0 0&gt;;
+                linux,modalias = &quot;m25p80&quot;, &quot;mx25l6405d&quot;;
+                spi-max-frequency = &lt;10000000&gt;;
+                partition@0 {
+                    label = &quot;u-boot&quot;;
+                    reg = &lt;0x0 0x30000&gt;;
+                    read-only;
+                };
+    
+                partition@30000 {
+                    label = &quot;u-boot-env&quot;;
+                    reg = &lt;0x30000 0x10000&gt;;
+                    read-only;
+                };
+    
+                factory: partition@40000 {
+                    label = &quot;factory&quot;;
+                    reg = &lt;0x40000 0x10000&gt;;
+                    read-only;
+                };
+    
+                partition@50000 {
+                    label = &quot;cimage&quot;;
+                    reg = &lt;0x50000 0x20000&gt;;
+                    read-only;
+                };
+
+                partition@70000 {
+                    label = &quot;kernel&quot;;
+                    reg = &lt;0x70000 0x140000&gt;;
+                };
+                partition@1B0000 {
+                    label = &quot;rootfs&quot;;
+                    reg = &lt;0x1B0000 0x650000&gt;;
+                };
+                partition2@70000 {
+                                    label = &quot;firmware&quot;;
+                                    reg = &lt;0x70000 0x790000&gt;;
+                };
+
+            };
+        };
+
+        uartlite@c00 {
+            status = &quot;okay&quot;;
+            compatible = &quot;ralink,mt7620a-uart&quot;, &quot;ralink,rt2880-uart&quot;, &quot;ns16550a&quot;; // palmchip bk-3103
+            reg = &lt;0xc00 0x100&gt;;
+            resets = &lt;&amp;rstctrl 19&gt;;
+            reset-names = &quot;uartl&quot;;
+            interrupt-parent = &lt;&amp;intc&gt;;
+            interrupts = &lt;12&gt;;
+            reg-shift = &lt;2&gt;;
+            pinctrl-names = &quot;default&quot;;
+            pinctrl-0 = &lt;&amp;uartlite_pins&gt;;
+        };
+
+    };
+
+
+    pinctrl {
+        state_default: pinctrl0 {
+        //    enable-gpios = &lt;&amp;gpio0 19&gt;;
+            gpio {
+                ralink,group = &quot;i2c&quot;, &quot;uartf&quot;;
+            //    ralink,group = &quot;i2c&quot;, &quot;uartf&quot;, &quot;gpio&quot;;
+            ///    ralink,group = &quot;i2c&quot;, &quot;uartf&quot;, &quot;pa&quot;;
+            //    ralink,group = &quot;uartf&quot;, &quot;pa&quot;;
+                ralink,function = &quot;gpio&quot;;
+            };
+        ///    i2c {
+        ///        ralink,group = &quot;i2c&quot;;
+        ///        ralink,function = &quot;i2c&quot;;
+        ///    };
+        //    pa {
+        //        ralink,group = &quot;pa&quot;;
+        //        ralink,function = &quot;pa&quot;;
+        //    };
+        };
+    };
+
+
+    usbphy: usbphy {
+        compatible = &quot;mediatek,mt7620-usbphy&quot;;
+    //    compatible = &quot;ralink,mt7620a-usbphy&quot;;
+        #phy-cells = &lt;1&gt;;
+        resets = &lt;&amp;rstctrl 22 &amp;rstctrl 25&gt;;
+    //    resets = &lt;&amp;rstctrl 22 &amp;rstctrl 19&gt;;
+        reset-names = &quot;host&quot;, &quot;device&quot;;
+    };
+
+
+    ethernet@10100000 {
+        status = &quot;okay&quot;;
+        mtd-mac-address = &lt;&amp;factory 0x28&gt;;
+        pinctrl-names = &quot;default&quot;;
+        pinctrl-0 = &lt;&amp;rgmii1_pins &amp;rgmii2_pins &amp;mdio_pins&gt;;
+        mediatek,portmap = &quot;wllll&quot;;
+
+        port@5 {
+            status = &quot;okay&quot;;
+            mediatek,fixed-link = &lt;1000 1 1 1&gt;;
+            phy-mode = &quot;rgmii&quot;;
+        };
+
+        mdio-bus {
+            status = &quot;okay&quot;;
+            phy0: ethernet-phy@0 {
+                reg = &lt;0&gt;;
+                phy-mode = &quot;rgmii&quot;;
+            };
+            phy1: ethernet-phy@1 {
+                reg = &lt;1&gt;;
+                phy-mode = &quot;rgmii&quot;;
+            };
+            phy2: ethernet-phy@2 {
+                reg = &lt;2&gt;;
+                phy-mode = &quot;rgmii&quot;;
+            };
+            phy3: ethernet-phy@3 {
+                reg = &lt;3&gt;;
+                phy-mode = &quot;rgmii&quot;;
+            };
+            phy4: ethernet-phy@4 {
+                reg = &lt;4&gt;;
+                phy-mode = &quot;rgmii&quot;;
+            };
+            phy1f: ethernet-phy@1f {
+                reg = &lt;0x1f&gt;;
+                phy-mode = &quot;rgmii&quot;;
+            };
+        };
+    };
+
+    gsw@10110000 {
+        mediatek,port4 = &quot;gmac&quot;;
+        mediatek,mt7530 = &lt;1&gt;;
+    };
+
+    wmac@10180000 {
+        ralink,mtd-eeprom = &lt;&amp;factory 0&gt;;
+    ////    ralink,eeprom = &quot;soc_wmac.eeprom&quot;;
+    //    ralink,eeprom = &quot;rt2x00pci_1_0.eeprom&quot;;
+    };
+
+
+    gpio-keys-polled {
+        compatible = &quot;gpio-keys-polled&quot;;
+        #address-cells = &lt;1&gt;;
+        #size-cells = &lt;0&gt;;
+        poll-interval = &lt;20&gt;;
+
+        reset {
+            label = &quot;reset&quot;;
+            gpios = &lt;&amp;gpio0 12 1&gt;;
+        //    linux,code = &lt;0x198&gt;;
+            linux,code = &lt;0x101&gt;;
+        };
+    //    wps {
+    //        label = &quot;wps&quot;;
+    //        gpios = &lt;&amp;gpio0 1 1&gt;;
+    //    //    linux,code = &lt;0x211&gt;;
+    //        linux,code = &lt;0x100&gt;;
+    //    };
+
+    };
+
+
+    gpio-leds {
+        compatible = &quot;gpio-leds&quot;;
+        power {
+            label = &quot;br-6478ac-v2:white:power&quot;;
+            gpios = &lt;&amp;gpio0 11 1&gt;; // edimax wps
+        };
+        wan {
+            label = &quot;br-6478ac-v2:blue:wan&quot;;
+            gpios = &lt;&amp;gpio0 7 1&gt;; // edimax power
+        };
+        wlan {
+            label = &quot;br-6478ac-v2:blue:wlan&quot;;
+            gpios = &lt;&amp;gpio0 10 1&gt;; // edimax wireless_aband
+        };
+        usb {
+            label = &quot;br-6478ac-v2:blue:usb&quot;;
+            gpios = &lt;&amp;gpio0 14 1&gt;; // edimax wireless_gband
+        };
+        //wifi { // unused smd led pad on pcb
+        //    label = &quot;br-6478ac-v2:blue:wifi&quot;;
+        //    gpios = &lt;&amp;gpio1 1 1&gt;; // edimax wireless, gpio25
+        //};
+
+    };
+
+
+    pcie@10140000 {
+        status = &quot;okay&quot;;
+        pcie-bridge {
+        //    reg = &lt;0x0000 0 0 0 0&gt;;
+        //    #address-cells = &lt;3&gt;;
+        //    #size-cells = &lt;2&gt;;
+        //    device_type = &quot;pci&quot;;
+            status = &quot;okay&quot;;
+        //    wmac@0,0 { // strange mac: 9c:99:35:9b:b1:be not 74:da:38:68:45:c7
+        //        ralink,5ghz = &lt;0&gt;;
+        //        compatible = &quot;ralink,rt2880-pci&quot;, &quot;pciclass060400&quot;, &quot;pciclass0604&quot;;
+        //        reg = &lt; 0x10000 0 0 0 0 &gt;;
+        //        ralink,eeprom = &quot;rt2x00pci_1_0.eeprom&quot;;
+        //    };
+            mt76@0,0 {
+                reg = &lt;0x0000 0 0 0 0&gt;;
+                device_type = &quot;pci&quot;;
+                mediatek,mtd-eeprom = &lt;&amp;factory 0x8000&gt;;
+                mediatek,2ghz = &lt;0&gt;;
+            };
+        };
+    };
+
+    ehci@101c0000 {
+        status = &quot;okay&quot;;
+        interrupt-parent = &lt;&amp;intc&gt;;
+        interrupts = &lt;18&gt;;
+    };
+
+    ohci@101c1000 {
+        status = &quot;okay&quot;;
+        interrupt-parent = &lt;&amp;intc&gt;;
+        interrupts = &lt;18&gt;;
+    };
+
+    /* Unclear if this is the correct gpio setup; the USB ports are
+      unpopulated on a stock BR-6475nD, even though the hardware exists
+      and the headers are there. */
+    gpio_export {
+        compatible = &quot;gpio-export&quot;;
+        #size-cells = &lt;0&gt;;
+        enable-gpios = &lt;&amp;gpio0 19&gt;;
+/*
+        // pa_pe/pa pins 18,19,20,21
+        gpio18 {
+            gpio-export,name=&quot;gpio18&quot;;
+            gpio-export,output=&lt;0&gt;;
+            gpios = &lt;&amp;gpio0 18 0&gt;;
+        };
+        usb {
+            gpio-export,name=&quot;usb&quot;;
+            gpio-export,output=&lt;0&gt;;
+            gpios = &lt;&amp;gpio0 19 0&gt;;
+        };
+        gpio20 {
+            gpio-export,name=&quot;gpio20&quot;;
+            gpio-export,output=&lt;0&gt;;
+            gpios = &lt;&amp;gpio0 20 0&gt;;
+        };
+        gpio21 {
+            gpio-export,name=&quot;gpio21&quot;;
+            gpio-export,output=&lt;0&gt;;
+            gpios = &lt;&amp;gpio0 21 0&gt;;
+        };
+*/
+/*
+        gpio0 {
+            gpio-export,name=&quot;gpio0&quot;;
+            gpio-export,output=&lt;0&gt;;
+            gpios = &lt;&amp;gpio0 0 0&gt;;
+        };
+        gpio1 {
+            gpio-export,name=&quot;gpio1&quot;;
+            gpio-export,output=&lt;0&gt;;
+            gpios = &lt;&amp;gpio0 1 0&gt;;
+        };
+        gpio2 {
+            gpio-export,name=&quot;gpio2&quot;;
+            gpio-export,output=&lt;0&gt;;
+            gpios = &lt;&amp;gpio0 2 0&gt;;
+        };
+*/
+
+    };
+
+};
+
-- 
1.8.3.1</code></pre></div><p>0001-add-new-target-for-Edimax-Br-6478ac_v2-2-2.patch<br /></p><div class="codebox"><pre><code>From 0bbb7e59f245e6d88cf7c5a06758374ed82a7e4a Mon Sep 17 00:00:00 2001
From: &quot;R.Murch&quot; &lt;rohan.murch@gmail.com&gt;
Date: Wed, 28 Sep 2016 09:50:01 +1000
Subject: [PATCH] add new target for Edimax Br-6478ac_v2 2/2

---
 target/linux/ramips/base-files/etc/board.d/01_leds    |  6 ++++++
 target/linux/ramips/base-files/etc/board.d/02_network | 15 +++++++++++++++
 target/linux/ramips/base-files/etc/diag.sh            |  3 +++
 target/linux/ramips/base-files/lib/ramips.sh          |  3 +++
 target/linux/ramips/image/mt7620.mk                   |  8 ++++++++
 5 files changed, 35 insertions(+)

diff --git a/target/linux/ramips/base-files/etc/board.d/01_leds b/target/linux/ramips/base-files/etc/board.d/01_leds
index 97c405d..0e693a1 100755
--- a/target/linux/ramips/base-files/etc/board.d/01_leds
+++ b/target/linux/ramips/base-files/etc/board.d/01_leds
@@ -74,6 +74,12 @@ bc2)
 br-6425)
     set_wifi_led &quot;$board:orange:wlan&quot;
     ;;
+br-6478ac-v2)
+    ucidef_set_led_default &quot;power&quot; &quot;POWER&quot; &quot;$board:white:power&quot; &quot;1&quot;
+    ucidef_set_led_default &quot;wan&quot; &quot;WAN LED&quot; &quot;$board:blue:wan&quot; &quot;1&quot;
+    set_wifi_led &quot;$board:blue:wlan&quot;
+    set_usb_led &quot;$board:blue:usb&quot;
+    ;;
 broadway)
     set_usb_led &quot;$board:red:diskmounted&quot;
     set_wifi_led &quot;$board:red:wps_active&quot;
diff --git a/target/linux/ramips/base-files/etc/board.d/02_network b/target/linux/ramips/base-files/etc/board.d/02_network
index 675dcc9..137644d 100755
--- a/target/linux/ramips/base-files/etc/board.d/02_network
+++ b/target/linux/ramips/base-files/etc/board.d/02_network
@@ -157,10 +157,18 @@ ramips_setup_interfaces()
     wr6202)
         ucidef_set_interfaces_lan_wan &quot;eth0.1&quot; &quot;eth0.2&quot;
         ;;
+    br-6478ac-v2|\
     br-6475nd)
         ucidef_add_switch &quot;switch0&quot; \
             &quot;1:lan&quot; &quot;2:lan&quot; &quot;3:lan&quot; &quot;4:lan&quot; &quot;0:wan&quot; &quot;9@eth0&quot;
         ;;
+//    br-6478ac-v2)
+//    //    ucidef_set_interfaces_lan_wan &quot;eth0.1&quot; &quot;eth0.2&quot;
+//    //    ucidef_set_interface_lan &quot;eth0.1&quot;
+//        ucidef_add_switch &quot;switch1&quot; \
+//            &quot;1:lan&quot; &quot;2:lan&quot; &quot;3:lan&quot; &quot;4:lan&quot; &quot;0:wan&quot; &quot;6@eth0&quot;
+//        ;;
+
     cf-wr800n|\
     ex2700)
         ucidef_add_switch &quot;switch0&quot; \
@@ -284,6 +292,13 @@ ramips_setup_macs()
         lan_mac=$(cat /sys/class/net/eth0/address)
         wan_mac=$(mtd_get_mac_binary devdata 7)
         ;;
+
+    br-6478ac-v2)
+        lan_mac=$(cat /sys/class/net/eth0/address)
+        wan_mac=$(cat /sys/class/net/eth0.2/address)
+        //wan_mac=$(mtd_get_mac_binary devdata 7)
+        ;;
+
     cy-swr1100|\
     dch-m225)
         lan_mac=$(mtd_get_mac_ascii factory lanmac)
diff --git a/target/linux/ramips/base-files/etc/diag.sh b/target/linux/ramips/base-files/etc/diag.sh
index 969594d..419775a 100644
--- a/target/linux/ramips/base-files/etc/diag.sh
+++ b/target/linux/ramips/base-files/etc/diag.sh
@@ -35,6 +35,9 @@ get_status_led() {
     xdxrn502j)
         status_led=&quot;$board:green:power&quot;
         ;;
+    br-6478ac-v2)
+        status_led=&quot;$board:white:power&quot;
+        ;;
     a5-v11|\
     cs-qr10|\
     d105|\
diff --git a/target/linux/ramips/base-files/lib/ramips.sh b/target/linux/ramips/base-files/lib/ramips.sh
index 98bc68c..b2ab445 100755
--- a/target/linux/ramips/base-files/lib/ramips.sh
+++ b/target/linux/ramips/base-files/lib/ramips.sh
@@ -76,6 +76,9 @@ ramips_board_detect() {
     *&quot;BR-6475nD&quot;)
         name=&quot;br-6475nd&quot;
         ;;
+    *&quot;BR-6478AC-v2&quot;)
+        name=&quot;br-6478ac-v2&quot;
+        ;;
     *&quot;Broadway&quot;)
         name=&quot;broadway&quot;
         ;;
diff --git a/target/linux/ramips/image/mt7620.mk b/target/linux/ramips/image/mt7620.mk
index 003fc70..6cab316 100644
--- a/target/linux/ramips/image/mt7620.mk
+++ b/target/linux/ramips/image/mt7620.mk
@@ -404,3 +404,11 @@ define Device/dch-m225
   DEVICE_PACKAGES := kmod-mt76
 endef
 TARGET_DEVICES += dch-m225
+
+define Device/br-6478ac-v2
+  DTS := BR-6478AC-V2
+  IMAGE_SIZE := $(ralink_default_fw_size_8M)
+  DEVICE_TITLE := Edimax BR-6478-AC V2
+  DEVICE_PACKAGES := kmod-usb2 kmod-usb-ohci kmod-mt76
+endef
+TARGET_DEVICES += br-6478ac-v2
-- 
1.8.3.1</code></pre></div><br /><p>Please excuse some commented out sections in the DTS, I have recently discovered the &quot;PA&quot; group of gpio (18,19,20,21) which seem to control the antenna selection and rf power amplifiers. Still testing that and GPIO&#039;s to find something to power up the usb port. i2c port does not seem to be used, so am also testing gpio1 and gpio2 to see if connnected to anything on the pcb.</p><p>Can confirm the mt7612e is now working in AP/Master mode ok, although at 40mhz bandwidth not 80mhz.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p339506">
				<div class="post-metadata">
					<div class="post-num">Post #31</div>
					<div class="post-author">elektroman</div>
					<div class="post-datetime">
						28 Sep 2016, 15:31					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>rmurch wrote:</cite><blockquote><p>Can confirm the mt7612e is now working in AP/Master mode ok, although at 40mhz bandwidth not 80mhz.</p></blockquote></div><p>First for the &quot;excuses&quot; I don&#039;t care.</p><p>The normal round trip on linux kernel is two/three days, if you are lucky you get an answer in one day, sometimes this is more. The rule of thumb is one week.<br />The most important thing is quality/accurate of code.<br />So why bother </p><p>I will take these patches and test this on my hardware, which is currently on the way.<br />But you have to wait until weekend.<br />Work you know ;-)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p339811">
				<div class="post-metadata">
					<div class="post-num">Post #32</div>
					<div class="post-author">elektroman</div>
					<div class="post-datetime">
						30 Sep 2016, 18:38					</div>
				</div>
				<div class="post-content content">
					<p>So serial cable on hardware is soldered, no modifications needed. Opening the router is bad.<br />Repositories updated.<br />Now I can start develop.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p339854">
				<div class="post-metadata">
					<div class="post-num">Post #33</div>
					<div class="post-author">rmurch</div>
					<div class="post-datetime">
						1 Oct 2016, 01:37					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>elektroman wrote:</cite><blockquote><p>So serial cable on hardware is soldered, no modifications needed.</p></blockquote></div><p>Did your router come with the 4x serial jumper pins already soldered? Mine had empty solder pads, and the capacitor to bottom right of pins makes it a bit tricky, I had to solder the jumpers on a 45&#039; angle to pcb.</p><div class="quotebox"><cite>elektroman wrote:</cite><blockquote><p>Opening the router is bad.</p></blockquote></div><p>Yes I agree. Removing the front LED panel is even worse, I snapped some plastic locking tabs. Also trying to remove the antennas by squeezing the circlip-style lock on the inside of the case is hard without damaging the antennas. On the second one I just cut them off and added RP-SMA sockets instead.</p><p>Testing the 5g radio with a intel7620 on my laptop, I am getting (reported) speeds between 195.1mbps and 866mbps. The bandwidth dynamically jumps between 20mhz and 80mhz for each up/down stream. Can confirm the 2.4g is also operating in 2T2R mode. So even though the eeprom(s) reports 0 antennas they both are using 2.</p><p>This weekend I am going to attempt to cut the 2x solder tracks carrying the antennas from the mt7620 over to the mt7612e where they merge (diplexer) into one antenna each (4 into 2). So will have 2x RP-SMA sockets for the 2.4g, and 2x RP-SMA sockets for the 5g. **fingers crossed**</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p339926">
				<div class="post-metadata">
					<div class="post-num">Post #34</div>
					<div class="post-author">elektroman</div>
					<div class="post-datetime">
						1 Oct 2016, 18:55					</div>
				</div>
				<div class="post-content content">
					<p>No serial jumper.<br />It did my soldering after work (at work) so I don&#039;t need to buy any soldering station.<br />Some people at work arguing about a broken device ...<br />And I do the soldering direct on PCB,<br />I have enough &quot;empty&quot; jumpers and USB to serial cables ready.<br />I usually buy them in 10 pieces a pack</p><p>/me thinking about a t-shirt &quot;I void warranties&quot;</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p340428">
				<div class="post-metadata">
					<div class="post-num">Post #35</div>
					<div class="post-author">elektroman</div>
					<div class="post-datetime">
						6 Oct 2016, 17:52					</div>
				</div>
				<div class="post-content content">
					<p>So today my first boot via initramfs build. (*). </p><p>I want to remain the old firmware until LEDE is ready can flashed via webinterface to prove the build is right and a rando user can flash the device.</p><p>Currently wifi in not running, some drivers are not loading correctly, but this is a build issue. <br />BUT I can test without flashing, boot via TFTP only works with menu option not with cmdline (don&#039;t ask we why)<br />Stay tuned.</p><p>(*) <br />The last couple of days I was working on mt7610u driver ...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p340648">
				<div class="post-metadata">
					<div class="post-num">Post #36</div>
					<div class="post-author">rmurch</div>
					<div class="post-datetime">
						9 Oct 2016, 03:42					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>elektroman wrote:</cite><blockquote><p>/me thinking about a t-shirt &quot;I void warranties&quot;</p></blockquote></div><p>haha Thinkgeek have you covered my friend: <a href="http://www.thinkgeek.com/product/8f52/">http://www.thinkgeek.com/product/8f52/</a></p><br /><p>Ive been playing with the two br6478ac&#039;s here, one as a normal AP, the other in client mode routing a second subnet, all seems well and stable so far.</p><p>I have been discovering GPIO&#039;s, and found that there is only 9x led gpio&#039;s along the front, they are just double and triple tracked for different locations, so we have only 5x free gpios along the front leds.</p><p>Looking at rear left of pcb, there is space for a second push button, that is GPIO1. The two jumper pads alone in the front left corner behind the leds are gpio9 (left) and gpio13 (right).</p><p>Finally to power up the USB port, its GPIO45, and i presume the rest of that gpio bus (46,47,etc) are the 5x leds (i think, unconfirmed).</p><p>These are the free/unused gpios:<br /></p><div class="codebox"><pre><code>        pinctrl {
                state_default: pinctrl0 {
                        gpio {
                                ralink,group = &quot;i2c&quot;, &quot;uartf&quot;, &quot;wdt&quot;, &quot;pa&quot;, &quot;ephy&quot;, &quot;nd_sd&quot;, &quot;wled&quot;;
                                ralink,function = &quot;gpio&quot;;
                        };
                ///     i2c {
                ///             ralink,group = &quot;i2c&quot;;
                ///             ralink,function = &quot;i2c&quot;;
                ///     };
                //    pa {
                //              ralink,group = &quot;pa&quot;;
                //              ralink,function = &quot;pa&quot;;
                //    };
                };
        };</code></pre></div><p>and exported the usb power gpio like this:<br /></p><div class="codebox"><pre><code>        gpio_export {
                compatible = &quot;gpio-export&quot;;
                #size-cells = &lt;0&gt;;
                usb-power {
                        gpio-export,name=&quot;usb-power&quot;;
                        gpio-export,output=&lt;0&gt;;
                        gpios = &lt;&amp;gpio2 5 0&gt;;  // pin45
                };</code></pre></div><p>and can now power up the usb port with &quot;echo 1 &gt; /sys/class/gpio/usb-power/value&quot;, very handy to put an arduino into &#039;power off&#039; mode, or shut down a 2.5&quot; usb hard drive.</p><p>Also noticed with the LEDE build i do not have to run the mkimage command over the whole image, I can just pad the kernel, cat it with the rootfs and flash it that way.</p><p>Otherwise I have not made much more development progress, just happily using them <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> but next step is definitely sorting out antenna arrays in eeprom so we can control antennas, as I am 99% sure the 5ghz radio is only rx&#039;ing on one antennas (testing with panel antennas), and I think the 2.4ghz also, or they are dynamically changing their array automatically.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p340750">
				<div class="post-metadata">
					<div class="post-num">Post #37</div>
					<div class="post-author">elektroman</div>
					<div class="post-datetime">
						10 Oct 2016, 07:42					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>rmurch wrote:</cite><blockquote><div class="codebox"><pre><code>        gpio_export {
                compatible = &quot;gpio-export&quot;;
                #size-cells = &lt;0&gt;;
                usb-power {
                        gpio-export,name=&quot;usb-power&quot;;
                        gpio-export,output=&lt;0&gt;;
                        gpios = &lt;&amp;gpio2 5 0&gt;;  // pin45
                };</code></pre></div></blockquote></div><p>There in a better solution for this ...<br />I must check this with my NAS code.</p><p>For LEDE check here<br /><a href="http://github.com:ulli-kroll/lede.git">github.com:ulli-kroll/lede.git</a><br />branch <br /></p><div class="codebox"><pre><code>do-work/Edimax-v2</code></pre></div><p>Currently wifi will not load with initramfs<br />fixed now.</p><p>missed MAC address. boots like a charm.</p>											<p class="post-edited">(Last edited by <strong>elektroman</strong> on 10 Oct 2016, 21:09)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p340968">
				<div class="post-metadata">
					<div class="post-num">Post #38</div>
					<div class="post-author">elektroman</div>
					<div class="post-datetime">
						12 Oct 2016, 22:34					</div>
				</div>
				<div class="post-content content">
					<p>So gigabit switch is wrong</p><p>read<br /><a href="https://forum.openwrt.org/viewtopic.php?id=68026">https://forum.openwrt.org/viewtopic.php?id=68026</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p341832">
				<div class="post-metadata">
					<div class="post-num">Post #39</div>
					<div class="post-author">elektroman</div>
					<div class="post-datetime">
						22 Oct 2016, 21:40					</div>
				</div>
				<div class="post-content content">
					<p>@rmurch<br />is your local LAN running a GBit/s&nbsp; with some device connected at the switch ports ??</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p342311">
				<div class="post-metadata">
					<div class="post-num">Post #40</div>
					<div class="post-author">rmurch</div>
					<div class="post-datetime">
						28 Oct 2016, 03:49					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>elektroman wrote:</cite><blockquote><p>@rmurch<br />is your local LAN running a GBit/s&nbsp; with some device connected at the switch ports ??</p></blockquote></div><p>Sincere apologises for the late reply.</p><p>I can confirm this issue effects my routers too. I have not applied the new code to test, but using gigabit NICs I am only able to connect at 10/100 speeds, not gigabit speeds. I never noticed that before, opps.</p><p>Both br-6478ac-v2 routers I have are up and running in production, so I have not been able to pull them down to reflash (been too busy using them haha).</p><p>This weekend I plan to re-compile firmware with gigabit switch fix, and will attempt to flash via web gui interface not via tftp, so hopefully all goes well.</p><p>Will report back and let you know how it goes.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p342317">
				<div class="post-metadata">
					<div class="post-num">Post #41</div>
					<div class="post-author">anarchy99</div>
					<div class="post-datetime">
						28 Oct 2016, 06:38					</div>
				</div>
				<div class="post-content content">
					<p>this is also one of the most idiotic things i&#039;ve seen lately - devices apparently support 1 or 2 Gbit ports inside chip but the manufacturers wire it up so they end up 100Mbit to the switch while driver indicates fake 1000Mbps in kernel log. even more stupid it looks on numerous devices that actually have only one or two LAN ports, those could have been fully utilised.</p><p>better check before buying if it&#039;s real Gbit device.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p342366">
				<div class="post-metadata">
					<div class="post-num">Post #42</div>
					<div class="post-author">elektroman</div>
					<div class="post-datetime">
						28 Oct 2016, 18:42					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>anarchy99 wrote:</cite><blockquote><p>this is also one of the most idiotic things i&#039;ve seen lately - devices apparently support 1 or 2 Gbit ports inside chip but the manufacturers wire it up so they end up 100Mbit to the switch while driver indicates fake 1000Mbps in kernel log. even more stupid it looks on numerous devices that actually have only one or two LAN ports, those could have been fully utilised.</p><p>better check before buying if it&#039;s real Gbit device.</p></blockquote></div><p>You are WRONG</p><p>The switch chip can support Gbit Lan, with original firmware all ports are working with Gbit.</p><p>In the Edimax SDK are the sources for the&nbsp; RTL8367 chip.</p><p>While booting LEDE, I can check the port with swconfig tool.<br />The port to the NIC works with Gbit<br />But the other ports don&#039;t</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p342382">
				<div class="post-metadata">
					<div class="post-num">Post #43</div>
					<div class="post-author">anarchy99</div>
					<div class="post-datetime">
						28 Oct 2016, 21:35					</div>
				</div>
				<div class="post-content content">
					<p>oh, your device works with stock fw at Gbit speed? then your compiled code is WRONG!&quot;</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p348925">
				<div class="post-metadata">
					<div class="post-num">Post #44</div>
					<div class="post-author">totalnewbie</div>
					<div class="post-datetime">
						10 Jan 2017, 02:58					</div>
				</div>
				<div class="post-content content">
					<p>As the name implies, Total Newbie here.&nbsp; Don&#039;t know anything about coding--just a little bit about networking.&nbsp; I&#039;m wanting to flash a BR-6478 V2 with an open source firmware in the hopes that it will help me to fix an issue I&#039;m having with an HDHomeRun tuner (it has to do with the Gbit ports that don&#039;t appear to actually be Gbit as far as I can tell).&nbsp; Anyway, I&#039;ve flashed DD-WRT onto some different routers before, but I can&#039;t find a working build to port any open source firmware onto the BR-6478 V2.&nbsp; So, my question is, @rmurch, did you get a working build?&nbsp; I understand the bricking risks, etc., I&#039;m just trying to get my hands on a file if there&#039;s one out there.&nbsp; Thanks for putting up with a bit of ignorance!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p349725">
				<div class="post-metadata">
					<div class="post-num">Post #45</div>
					<div class="post-author">fishsoupisgood</div>
					<div class="post-datetime">
						19 Jan 2017, 18:20					</div>
				</div>
				<div class="post-content content">
					<p>I accidentally bought one of these and was annoyed that even though it lists as supported in the ToH it isn&#039;t. I took Hans Ulli Kroll&#039;s patches and fixed the remaining issues. I found the mt72 driver in openwrt was fine, so rebased everything on openwrt rather than Lede. The things I fixed relative to his last commit at github.com/ulli-kroll/lede.git are:</p><p>leds now configure correctly<br />sysupgrade works<br />binary image can be installed using the original firmware&#039;s update page (so no need to open the case)<br />correct antenna configuration and mac address for the 802.11a radio<br />correct mtdsplit (support for csys images appeared broken)<br />switch correctly working at gbe</p><p>I also added support for a jffs2 only configuration which may be of interest.</p><p>(patches against openwrt trunk 187ad058 from 27/12/2016)</p><p>Hans Ulli Kroll&#039;s patches rolled up and ported to openwrt: <br />git.panaceas.org/cgit.cgi/openwrt/em-br6478acv2/master-187ad058-pq/tree/master/Hans_Ulli_Kroll.patch</p><p>My patches:<br />git.panaceas.org/cgit.cgi/openwrt/em-br6478acv2/master-187ad058-pq/tree/master/jmm.patch</p><p>My patches to enable jffs2 only: (disables the 4M targets)<br />git.panaceas.org/cgit.cgi/openwrt/em-br6478acv2/master-187ad058-pq/tree/master/jmm-jffs2.patch</p><p>--<br />James.</p>											<p class="post-edited">(Last edited by <strong>fishsoupisgood</strong> on 19 Jan 2017, 18:24)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p349737">
				<div class="post-metadata">
					<div class="post-num">Post #46</div>
					<div class="post-author">elektroman</div>
					<div class="post-datetime">
						19 Jan 2017, 20:33					</div>
				</div>
				<div class="post-content content">
					<p>HI </p><p>how about the gigabit switch issues ??<br />I have some idea solving this, maybe some bitbang mdio will do this trick. But first the phy/mdio pins must be change to normal gpio.</p><p>Currently can&#039;t test by my self, device is at work.<br />... this is hack device during lunch breaks ...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p349739">
				<div class="post-metadata">
					<div class="post-num">Post #47</div>
					<div class="post-author">fishsoupisgood</div>
					<div class="post-datetime">
						19 Jan 2017, 20:38					</div>
				</div>
				<div class="post-content content">
					<p>with my fix to the DTS (it had the wrong switch type) I&#039;m getting gigabit on all the ports, I think some of the port numbers are still wrong.</p><p>James.</p>											<p class="post-edited">(Last edited by <strong>fishsoupisgood</strong> on 20 Jan 2017, 00:33)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p349740">
				<div class="post-metadata">
					<div class="post-num">Post #48</div>
					<div class="post-author">elektroman</div>
					<div class="post-datetime">
						19 Jan 2017, 20:59					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>fishsoupisgood wrote:</cite><blockquote><p>with my fix to the DTS (it had the wrong switch type) I&#039;m getting gigabit on all the ports, I think some of the number is still wrong.</p><p>James.</p></blockquote></div><p>The git ID is not in my repository ...<br />Did you apply these patches by &quot;hand&quot; aka git am ??<br />In this case -&gt; wrong workflow.</p><p>The normal usecase is to a <br /></p><div class="codebox"><pre><code>git remote add</code></pre></div><p>checkout the desired branch locally a work on.<br />After this you can &quot;drop&quot; the remote git repository.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p349746">
				<div class="post-metadata">
					<div class="post-num">Post #49</div>
					<div class="post-author">fishsoupisgood</div>
					<div class="post-datetime">
						19 Jan 2017, 23:04					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>elektroman wrote:</cite><blockquote><div class="quotebox"><cite>fishsoupisgood wrote:</cite><blockquote><p>with my fix to the DTS (it had the wrong switch type) I&#039;m getting gigabit on all the ports, I think some of the number is still wrong.</p><p>James.</p></blockquote></div><p>The git ID is not in my repository ...<br />Did you apply these patches by &quot;hand&quot; aka git am ??<br />In this case -&gt; wrong workflow.</p></blockquote></div><p>I have no idea what you mean. Why would my patch be in your repository? If you are asking how to apply the patches use guilt. guilt, if you&#039;ve not encountered it, is good for maintaining a set of patches against an upstream repository in a way that git alone can&#039;t. (it allows you to version control a patch containing a feature against some other repository)</p><p>but there&#039;s no need to do that, you can just apply the patch I linked with git apply or whatever you like.</p><p>If you care about the guilt workflow it looks something like this:</p><p>git clone git://github.com/openwrt/openwrt master-187ad058<br />(cd master-187ad058 &amp;&amp; git reset --hard 187ad058)<br />git clone git://git.panaceas.org/openwrt/em-br6478acv2/master-187ad058-pq<br />ln -s ../../master-187ad058-pq master-187ad058/.git/patches<br />cd master-187ad058<br />guilt push -a</p><br /><p>J.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p349758">
				<div class="post-metadata">
					<div class="post-num">Post #50</div>
					<div class="post-author">fishsoupisgood</div>
					<div class="post-datetime">
						20 Jan 2017, 03:17					</div>
				</div>
				<div class="post-content content">
					<p>specificially the switch was unhappy because the code in soc_mt7620 only probes for an external mt7530 switch on the mdio bus (rather than one integrated on the chip accessible via mmio) if it doesn&#039;t find the mediatek,mt7530 property in the DTS. The particular unit I have here seems to be unhappy using port 1 (marked 4 on the outside) at gigabit speeds - I&#039;ll check on different hardware tomorrow.</p><p>J.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 2 of 2</div><nav><ul><li><a href="viewtopic.php%3Fid=67192&amp;p=1.html">1</a></li><li class="pagination-current"><span>2</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>