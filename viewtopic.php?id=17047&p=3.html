<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> VLAN support on ar430w</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 30 Mar 2018 and 27 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 3 of 3</div><nav><ul><li><a href="viewtopic.php%3Fid=17047&amp;p=1.html">1</a></li><li><a href="viewtopic.php%3Fid=17047&amp;p=2.html">2</a></li><li class="pagination-current"><span>3</span></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p89253">
				<div class="post-metadata">
					<div class="post-num">Post #51</div>
					<div class="post-author">chillifire</div>
					<div class="post-datetime">
						4 Jun 2009, 01:12					</div>
				</div>
				<div class="post-content content">
					<p><a href="http://forum.openwrt.org/viewtopic.php?pid=89252#p89252">http://forum.openwrt.org/viewtopic.php?pid=89252#p89252</a></p><p>My experience with DIR300 on trunk 16301 (my first atheros chipset attempt):</p><p>Followed <a href="http://oldwiki.openwrt.org/OpenWrtDocs(2f)Hardware(2f)D(2d)Link(2f)DIR(2d)300.html">http://oldwiki.openwrt.org/OpenWrtDocs( … d)300.html</a> with success using my own selfcompiled images.<br />Images included swconfig, some kernel modules (tun, ulog), some packages, ntpclient, openvpn, coovachilli, xwrt, network configuration set in make menuconfig to ip address 192.168.12.1 and </p><p>Worked OK, and I had a &#039;sort of&#039; working router with the following issues:<br />- telnet or ssh not running, http server (haserl) running - therefore no telnet nor ssh access but access to xwrt webif.<br />- lan and wifi access on 192.168.12.1 (the router&#039;s webif), but no access to internet<br />- some verystrange behaviour when booting - the router seems to bott three times. The firts and seconf time it creates an internet connection for the PC but in the 192.168.2.1 ip range, which is my adsl/modem/router&#039;s network. The third time it assigns a 192.168.12.1 number range, but then I cannot get from lan to wan anymore (no internet connection)<br />- Looking as dmesg I see the same segfault as reported by mtadeu on <a href="http://forum.openwrt.org/viewtopic.php?pid=89252#p89252">http://forum.openwrt.org/viewtopic.php?pid=89252#p89252</a><br />- very strange switch configuration of the /etc/config/network file with &#039;switch_vlan&#039; &#039;eth0_1&#039;, &#039;switch_vlan2&#039; &#039;eth0_2&#039; config entries. Never seen anyhting like this on broadcom chipsets. Is this atheros or is this swconfig driving these files or is it just plain wrong? </p><p>I assumed the latter and rewrote the /etc/config file to match <a href="http://oldwiki.openwrt.org/OpenWrtDocs(2f)Hardware(2f)D(2d)Link(2f)DIR(2d)300.html">http://oldwiki.openwrt.org/OpenWrtDocs( … d)300.html</a>. Now, after reboot, no connection works anymore, as no ip address is assigned by the router to my PC (it gets a 169.245.236.1). The PC does not repond to pings on 192.168.12.1. Crap.</p><p>The time has come to reload an image onto the router, maybe one of the new 8.09.01 images published today, to see whether the issue also exists with that build. <a href="http://oldwiki.openwrt.org/OpenWrtDocs(2f)Hardware(2f)D(2d)Link(2f)DIR(2d)300.html">http://oldwiki.openwrt.org/OpenWrtDocs( … d)300.html</a> mentions reflashing from redboot. </p><p>I will keep you posted.</p>											<p class="post-edited">(Last edited by <strong>chillifire</strong> on 4 Jun 2009, 04:42)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p89256">
				<div class="post-metadata">
					<div class="post-num">Post #52</div>
					<div class="post-author">chillifire</div>
					<div class="post-datetime">
						4 Jun 2009, 02:21					</div>
				</div>
				<div class="post-content content">
					<p>OK, got back into redboot and flashed with standard 8.09.01 packages. </p><p>Dhcp does not work when the router is conencted to the adsl/modem/router with 192.168.2.x network. The DIR300 will not lease an IP address from that adsl/modem/router either, however my PC leases an ip address directly from that adsl/modem/router in the 192.168.2.x range. Looks like it passes straight throught the router.</p><p>Rebooted with WAN cable detached. Now ssh and tlenet work on 192.168.1.1. PC leases an address on 192.168.1.x as it should. Had a look at installed packages. swconfig is not installed. Connected WAN port to adsl/modem/router but no internet connection is being estbalished. </p><p>Had a look at /etc/config/network, which has only a loopback and a lan section, NO wan section. How is that supposed to work?</p><p>I am getting a bit dishearted as not even a standard image seems to render a basic working router, never mind switching.</p><p>Am I looking a t a known issue here or is this to be expected on a DIR300 without swconfig?</p><p>Anyhow. next step is to compile a close-to-standard-as-possible plu swconfig image and report back.</p><p>Cheers</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p89258">
				<div class="post-metadata">
					<div class="post-num">Post #53</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						4 Jun 2009, 04:01					</div>
				</div>
				<div class="post-content content">
					<p>Hi chillifire.</p><p>Some clarification on the support status for the DIR-300:<br />8.09, 8.09.1 and the 8.09 branch do *not* support the switch in this device.<br />Since the wan interface does not exist but the dhcp config references it, dnsmasq won&#039;t start up due to a bad configuration.<br />Removing the wan section from the dhcp config should solve this issue: uci delete dhcp.wan; uci commit dhcp; /etc/init.d/dnsmasq restart.</p><p>Recent trunk versions have support for the DIR-300 switch but had a uclibc bug up to r16304 that prevented dropbear, telnet and others from working.<br />The new switch config format is indeed belonging to the swconfig framework, it&#039;s not compatible with the 8.09 syntax anymore.</p><p>A third option is this switch support patch for 8.09.1: <a href="http://downloads.berlin.freifunk.net/kamikaze/_patches/atheros-buildroot.patch">http://downloads.berlin.freifunk.net/ka … root.patch</a><br />This will add a working switch driver to the buildroot. You need to enable kmod-switch in menuconfig after applying this patch.</p><p>HTH, JoW</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p89264">
				<div class="post-metadata">
					<div class="post-num">Post #54</div>
					<div class="post-author">chillifire</div>
					<div class="post-datetime">
						4 Jun 2009, 05:16					</div>
				</div>
				<div class="post-content content">
					<p>Thanks very much for the clarification jow.</p><p>Compiled my own image in 16301 with swconfig and LUCI ful but nothing else. Works although /lib/network/switch.sh has no executable permission as all the other *.sh files in that directory, only 644. No idea why it works therefore - but it works. Maybe because it is used as an include only in /etc/init.d/network? Whatever the case this is not &#039;nice&#039; and should be changed. I would volunteer to do os but have no idea (and permission, I suppose) to promote such a change to trunk.</p><p>For my better understanding: The file I found in /etc/config/network has all the tell-tale signs of having been updated by uci. Does that mean the configuration is somehow automatically derived and the file written automatically (i.e. based on existing hardware)? On broadcom chips 2.4 kernel there is a file /etc/init.d/netconfig that does something to that effect to cate for subtle differences in network configuration requirements for different routers. Is there a similar configuration mechnism at work as part of the boot process? If so, where does it live?</p><p>Now the big question is what caused my first image to fail? The pre 16304 revision? The router IP address set at 192.168.12.1? Another package? I will trace my steps and report back.</p><br /><br /><p>Off topic LUCI observation: The above is my second try. The first try included modules luci-app-firewall and luci-app-ddns. Amazingly the router did not work and did not distribute an IP address - probably the dnsmasq issue you tlaked about, jow. Still, I am surprised that the inclusion of two LUCI modules would cause the image to &#039;fail&#039; in such a way. Was not the whole premise of LUCI over other approaches such as XWRT the separation of display and underlying functions? If so, how can the addition of some more display modules stop a fundamental function of the router to malfunction? Maybe the separation of the two layers is not as robust as intended or maybe somethin I misunderstood about the purpose and approach of LUCI. Anyway, not the end of the world, more a piece of feedback and enouragement - just thought that your friends developing LUCI (I trust you know them given your location) might be interested in the observation. </p><p>Beste Gruesse</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p93743">
				<div class="post-metadata">
					<div class="post-num">Post #55</div>
					<div class="post-author">katapaltes</div>
					<div class="post-datetime">
						5 Sep 2009, 07:20					</div>
				</div>
				<div class="post-content content">
					<p>Looks like the swconfig / ip175c stuff has been back-ported into 8.09 as of 8/24/09 (<a href="https://dev.openwrt.org/log/branches/8.09/?mode=follow_copy">https://dev.openwrt.org/log/branches/8. … ollow_copy</a>).&nbsp; I know that 8.09.2 is right around the corner and it should support the AR430W/DIR-300, but the weekend&#039;s here, so I downloaded 8.09 and compiled it with LuCI and it seems to work well.&nbsp; I&#039;m downloading a podcast through it now with no problems.&nbsp; I&#039;m trying to find a screen that shows network errors in LuCI, but I&#039;m not familiar with this interface and I may even need to download an additional package to see errors in the GUI for all I know.</p>											<p class="post-edited">(Last edited by <strong>katapaltes</strong> on 5 Sep 2009, 07:23)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 3 of 3</div><nav><ul><li><a href="viewtopic.php%3Fid=17047&amp;p=1.html">1</a></li><li><a href="viewtopic.php%3Fid=17047&amp;p=2.html">2</a></li><li class="pagination-current"><span>3</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>