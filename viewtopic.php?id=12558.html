<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Motorola WR850G v1 - jtag flashing hangs</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 25 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p55820">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">LenniZeppelin</div>
					<div class="post-datetime">
						16 Sep 2007, 23:33					</div>
				</div>
				<div class="post-content content">
					<p>Hi</p><p>First of all: sorry for my English. I&#039;m from Germany.</p><p>I tried to put openwrt on my Wr850g via the Web-Inteface of the original Motorola Firmware. Unfortunately I accidental unplugged the Ethernet Cable during the flashing process. After this mistake i couldn&#039;t ping it and tftp, telnet, etc. doesn&#039;t work as well. So i built a Jtag cable. The simple one with 4 resistors. The plan says that you have to use 100 Î© resistors but i only got 470 Î© ones, so I tried with them. The cable works fine (already erased nvram and cfe successfully) but&nbsp; the mentioned problem appears:&nbsp; The flashing process always hangs at the same point: [&nbsp; 3% Flashed]&nbsp; &nbsp;1fc01ff0</p><p>Has anyone an idea, how to solve this?</p><p>thx in advance</p><div class="codebox"><pre><code>$ ./wrt54g -flash:cfe /noreset /nobreak /fc:27

====================================
WRT54G/GS EJTAG Debrick Utility v4.8
====================================

Probing bus ... Done

Instruction Length set to 5

CPU Chip ID: 00000100011100010000000101111111 (0471017F)
*** Found a Broadcom BCM4702 Rev 1 CPU chip ***

    - EJTAG IMPCODE ....... : 00000000100000000000100100001000 (00800908)
    - EJTAG Version ....... : 1 or 2.0
    - EJTAG DMA Support ... : Yes

Issuing Processor / Peripheral Reset ... Skipped
Enabling Memory Writes ... Done
Halting Processor ... Skipped
Clearing Watchdog ... Done

Manual Flash Selection ... Done

Flash Vendor ID: 00000000000000000000000000000100 (00000004)
Flash Device ID: 00000000000000000010001011111001 (000022F9)
*** Manually Selected a MBM29LV320BE 2Mx16 BotB    (4MB) Flash Chip ***

    - Flash Chip Window Start .... : 1fc00000
    - Flash Chip Window Length ... : 00400000
    - Selected Area Start ........ : 1fc00000
    - Selected Area Length ....... : 00040000

*** You Selected to Flash the CFE.BIN ***

=========================
Flashing Routine Started
=========================
Total Blocks to Erase: 7

Erasing block: 1 (addr = 1fc00000)...Done
Erasing block: 2 (addr = 1fc04000)...Done
Erasing block: 3 (addr = 1fc06000)...Done
Erasing block: 4 (addr = 1fc08000)...Done
Erasing block: 5 (addr = 1fc10000)...Done
Erasing block: 6 (addr = 1fc20000)...Done
Erasing block: 7 (addr = 1fc30000)...Done

Loading CFE.BIN to Flash Memory...
[  0% Flashed]   1fc00000: 10000817 00000000 00000000 00000000
[  0% Flashed]   1fc00010: 00000000 00000000 00000000 00000000
[  0% Flashed]   1fc00020: 00000000 00000000 00000000 00000000
[...]
[  3% Flashed]   1fc01fc0: 00000000 00000000 00000000 00000000
[  3% Flashed]   1fc01fd0: 00000000 00000000 00000000 00000000
[  3% Flashed]   1fc01fe0: 00000000 00000000 00000000 00000000
[  3% Flashed]   1fc01ff0: 00000000 00000000 00000000 00000000</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p55850">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">yans</div>
					<div class="post-datetime">
						17 Sep 2007, 12:43					</div>
				</div>
				<div class="post-content content">
					<p>I am not an expert of JTAG. - I can not help You judging if the resistors that You used are ok.&nbsp; I would just try different combinations of switches, plunging unplugging the power cable - I had similar problem and I tried the same procedures for cuple of days - with no result and one day - managed to flash CFE and the I could flash the router without and extra switches (/fc /noreset /nobreak etc.).<br />For future generations - before playing with JTAG after bad flashing use serial port (which I see does not look too simple in case of wr850 version 1).</p><p>Cheers <br />Michal </p><p>PS. Where did You get the CFE.BIN ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p55884">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">LenniZeppelin</div>
					<div class="post-datetime">
						17 Sep 2007, 19:12					</div>
				</div>
				<div class="post-content content">
					<p>thanks for your reply.</p><p>ok,then i keep trying:P</p><p>i got the CFE.BIN from this thread at DD-WRT Forum: <a href="http://www.dd-wrt.com/phpBB2/viewtopic.php?p=33598&amp;sid=65ad4f0608a67f988c7336ff5bad24f9#33598">klick</a><br />I dont know if theres a difference between the CFE.BIN for v1 and v2 of the wr850g. does anybody know? and if yes, could someone please upload CFE.BIN for v1 me?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p55887">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">yans</div>
					<div class="post-datetime">
						17 Sep 2007, 19:36					</div>
				</div>
				<div class="post-content content">
					<p>I know that there is difference between v2 and v3. At this point (flash process stopping) You won&#039;t feel it, but there is a grate chance that after You finally manage to flash it Your router won&#039;t boot. I would try looking for somebody on forum with v1 and kindly ask for help. <br />HINT. You don&#039;t need JTAG to get CFE.BIN from a _working_ router. Look at <a href="http://wiki.openwrt.org/BackupAndRestore">http://wiki.openwrt.org/BackupAndRestore</a><br />It can be done by executing from router shell:<br /></p><div class="codebox"><pre><code>mount -o remount,ro /dev/mtdblock/0 /jffs
dd if=/dev/mtdblock/0 &gt; /tmp/CFE.BIN
mount -o remount,rw /dev/mtdblock/0 /jffs</code></pre></div><p>I don&#039;t have my wr850g (unfortunately v3) anywhere around so I am not 100% sure if CFE is in &quot;/dev/mtdblock/0&quot; but let&#039;s say 80% - if it is 64k than it is ok. </p><p>Good luck:)<br />Michal </p><p>PS. Can somebody more experienced with JTAG tell us what does the situation look like with these resistors - 4~5 times stronger resistors make the flash process stuck ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p55889">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">LenniZeppelin</div>
					<div class="post-datetime">
						17 Sep 2007, 20:08					</div>
				</div>
				<div class="post-content content">
					<p>i have a working wr850g. it runs with the original motorola firmware. is there a way to backup the cfe.bin with this kind of firmware or do i have install openwrt on it? tftp maybe?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p55890">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">yans</div>
					<div class="post-datetime">
						17 Sep 2007, 20:14					</div>
				</div>
				<div class="post-content content">
					<p>Honestly - I guess You would have to install openwrt to obtain CFE with the method I mentioned. But in Your case - You can also do it by JTAG (just reading the content of flash). The choice is up to You...</p><p>Michal</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p55893">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">LenniZeppelin</div>
					<div class="post-datetime">
						17 Sep 2007, 20:50					</div>
				</div>
				<div class="post-content content">
					<p>for enabling jtag on a WR850g v1 you have to do that:<br /><span class="postimg"><img src="http://www.dd-wrt.com/phpBB2/files/wr850gv1_jtag_155.jpg" alt="http://www.dd-wrt.com/phpBB2/files/wr850gv1_jtag_155.jpg" /></span></p><p>i&#039;m glad that i made it the first time, but i dont want to try this as second time:P <br />I also dont want to install openwrt on it. (I dont want to have two destroyed routers:P) </p><p>Is there any other way to get the CFE.BIN from a working router?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p55895">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">yans</div>
					<div class="post-datetime">
						17 Sep 2007, 21:04					</div>
				</div>
				<div class="post-content content">
					<p>I get Your point:)<br />Ask at the forum - search for wr850g owners already using openwrt. I.e. try asking ropf (<a href="http://forum.openwrt.org/viewtopic.php?id=9029">http://forum.openwrt.org/viewtopic.php?id=9029</a>)</p><p>Good luck:)<br />Michal</p><p>Ps. Don&#039;t forget to ask for NVRAM too...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p55907">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">LenniZeppelin</div>
					<div class="post-datetime">
						17 Sep 2007, 22:54					</div>
				</div>
				<div class="post-content content">
					<p>I decided to put openwrt on my second router, to get a working nvram.bin and cfe.bin. I dont trust the Web-Interface flashing method, so i tried to get a tftp connection, but it didn&#039;t work. I put the Motorola 4.03 Firmware on it and did nvram set boot_wait=on and nvram commit on /frame_debug.asp. But i can&#039;t establish a tftp connection to 192.168.10.1. I followed the instructions on the <a href="http://wiki.openwrt.org/OpenWrtDocs/Installing/TFTP">wiki</a>page, but it didn&#039;t work. I read in an other forum that i have to use the WAN port for tftp, but this didn&#039;t work as well. Any Ideas?</p><p>ed: url-tag</p>											<p class="post-edited">(Last edited by <strong>LenniZeppelin</strong> on 18 Sep 2007, 17:22)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p55908">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">yans</div>
					<div class="post-datetime">
						17 Sep 2007, 23:18					</div>
				</div>
				<div class="post-content content">
					<p>Of curse You have 192.168.10.xxx address on the network interface that You are trying to launch the tftp?&nbsp; Make sure that You can ping the router.<br />I was hooked up to LAN ports - not the WAN port.<br />You also know that You need to do the procedure on the router boot - trying to send the firmware just seconds before You plug it in to the power? </p><p>Tftp method was recommended long time ago (when I bricked my router:) ) and I guess that now the &quot;easiest&quot; way is the www method. </p><p>If You don&#039;t like the www method and TFTP is not working for You - ask wr850g v1 owners for the necessary files - You won&#039;t brick Your second router this way....</p><p>Michal</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p55940">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">LenniZeppelin</div>
					<div class="post-datetime">
						18 Sep 2007, 16:24					</div>
				</div>
				<div class="post-content content">
					<p>i don&#039;t know why tftp doesn&#039;t work. i did everything like in the insturctions.<br />I asked some users via email for the files, but i didn&#039;t get a response by now. Also i couldn&#039;t find a lot of users who use v1. So if anyone here has CFE.BIN for wr850g v1: could you please send it to me? thx...</p><p>ed:<br />i&#039;ve got a cfe.bin now. tftp suddenly worked and i was able to install openwrt on my second router and backup cfe.bin. Of course i instantly tried to flash the new cfe.bin on my router, but it didnÂ´t work again. <br />The flashing process always stops at [&nbsp; 3% Flashed]&nbsp; &nbsp;1fc023f0<br />i have no idea, what i should do...<br />but i keep trying. maybe it works suddenly, like the tftp connection;)<br />if i get some 100 Î© resistors i&#039;m going to replace the 470 Î© ones in my jtag Adapter, maybe that helps.</p><p>P.S.: Im going to upload cfe.bin and nvram.bin and post the link here. Maybe anyone needs them sometime;)</p><p>edÂ²: <br /><a href="http://lennex.kilu.de/misc/CFE.BIN">CFE.BIN</a> and <a href="http://lennex.kilu.de/misc/NVRAM.BIN">NVRAM.BIN</a> for Motorola Wr850g v1 (probably doesen&#039;t work for other flash chips than AMD AM29LV320DB)</p>											<p class="post-edited">(Last edited by <strong>LenniZeppelin</strong> on 19 Sep 2007, 21:26)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p56003">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">LenniZeppelin</div>
					<div class="post-datetime">
						19 Sep 2007, 18:48					</div>
				</div>
				<div class="post-content content">
					<p>i just noticed that my working router has a AMD AM29LV320DB flash chip and the bricked router has a MBM29LV320BE chip. Is there a difference between the cfe.bin for these two chips?</p><p>Ed: i made it:D I got another CFE.BIN (thanks to eko from dd-wrt board) maybe the CFE.BIN of a wr850g v1 with a AM29LV320DB chip doesn&#039;t work for a wr850g v1 with a MBM29LV320BE chip. </p><p>i uploaded the CFE.BIN and NVRAM.BIN that worked for my router with a MBM29LV320BE flashchip:<br /><a href="http://lennex.kilu.de/misc/wr850g/CFE.BIN">CFE.BIN</a><br /><a href="http://lennex.kilu.de/misc/wr850g/NVRAM.BIN">NVRAM.BIN</a> </p><p>Thanks for your Help yans!</p>											<p class="post-edited">(Last edited by <strong>LenniZeppelin</strong> on 19 Sep 2007, 21:27)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>