<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> ATNGW100 &amp; Avr32</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 2 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p51435">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">boomer</div>
					<div class="post-datetime">
						28 Jun 2007, 18:23					</div>
				</div>
				<div class="post-content content">
					<p>Hi Guys,</p><p>I saw Atmel’s ATNGW100 kit is just recently added and already is tagged as working in Kamikaze, amazing!<br />Has anyone started playing with it? <br />It is a good afforrdable piece of h/w – one lack no WiFi.<br />I guess an option of addingWiFi is MMC/SDIO interface, Any ideas?</p><p>Thanks in Advance!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p54372">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">wildan</div>
					<div class="post-datetime">
						22 Aug 2007, 08:03					</div>
				</div>
				<div class="post-content content">
					<p>I already try to build OpenWRT for avr32 for 2 days ..., with no success ... <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p54467">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">boomer</div>
					<div class="post-datetime">
						23 Aug 2007, 15:21					</div>
				</div>
				<div class="post-content content">
					<p>I have never tried to build it,<br />but installed Kami 7.07 avr32 image form here:<br /><a href="http://downloads.openwrt.org/kamikaze/7.07/avr32-2.6/">http://downloads.openwrt.org/kamikaze/7.07/avr32-2.6/</a><br />there were no problems at all</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p59211">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">gscheve</div>
					<div class="post-datetime">
						19 Nov 2007, 05:03					</div>
				</div>
				<div class="post-content content">
					<p>Hi Boomer,<br />I m installing the openWRT image 7.09 on the SD card, but I don&#039;t know how to configure u-boot to use a squash filesystem booted from SDcard, Do you have any idea ???</p><p>Thanks</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p59789">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">altrez</div>
					<div class="post-datetime">
						30 Nov 2007, 18:06					</div>
				</div>
				<div class="post-content content">
					<p>Has anyone got this to work? Has it been tested on the NGW100? There are no doc&#039;s on how to install. The two image&#039;s I have 2 NGW100&#039;s an tried it on both. Here is what I did: </p><p>1. Downloaded openwrt-avr32-2.6-uImage from <a href="http://downloads.openwrt.org/kamikaze/7.09/avr32-2.6/">http://downloads.openwrt.org/kamikaze/7.09/avr32-2.6/</a> </p><p>2. I copied the uImage from the ngw100 to my SD card: <br />cp uImage /mnt/media/uImage.old </p><p>3. I renamed openwrt-avr32-2.6-uImage to uImage an copied it to my ngw100 in the / directory. </p><p>4. Reset the NGW. </p><p>Now it boots up and I get a kernel panic&nbsp; </p><p>The last 2 lines read: </p><p>Warning: Unable To Open an initial console. <br />Kernel panic - not syncing: No init found. Try passing init= option to kernel. </p><p>Any help would be great. I would love to boot into openwrt.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p59803">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">kebul</div>
					<div class="post-datetime">
						1 Dec 2007, 01:50					</div>
				</div>
				<div class="post-content content">
					<p>It works as expected.</p><p>The 7.09 does not have the support for the MMC/SD device. You cannot boot from MMC/SD unless you backport the drivers to 2.6.22.1 and provide them to the kernel in the initrd (or build the current trunk with your options).<br />You will have to use the squashfs image. The OpenWrt expects to be executed from the flash memory.</p><p>There is no warranty of any kind that the following guide will not blow up your computer, the device or your head. <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>The NGW100&#039;s memory map is as follows:<br /></p><div class="codebox"><pre><code>0x00000000-0x0001ffff: U-Boot
0x00020000-0x007effff: usable flash space
0x007f0000-0x007fffff: U-Boot&#039;s environment
nothing
0x10000000-0x20000000: SDRAM
nothing
0x24000000-0x24003fff: internal SRAM</code></pre></div><p>Connect to your NGW100 using the serial terminal (115200 8N1), reset it, press space to get into U-Boot. The <a href="http://www.denx.de/wiki/DULG/Manual">U-Boot&#039;s manual</a> is your mandatory reading.</p><p><strong>WARNING: Using wrong addresses or commands may result in the broken u-boot!</strong> Remember that the JTAG solution for the AVR32 family is very expensive!</p><p>You need to load the squashfs image. You can use any U-Boot&#039;s method including the MMC/SD ext2 access which is built-in into the Atmel&#039;s u-boot. Train it until you are able to load the image into U-Boot.</p><p>You need to setup the IP information for U-Boot (you can use dhcp as well) and load the image to the specified SDRAM address (notice the address 0x10000000 is the start of the SDRAM space):<br /></p><div class="codebox"><pre><code>UBoot&gt; setenv ipaddr &lt;the NGW100&#039;s IP address&gt;
UBoot&gt; setenv serverip &lt;the tftp server&#039;s IP address&gt;
UBoot&gt; tftp 0x10000000 openwrt-avr32-2.6-squashfs.img</code></pre></div><p>You can copy the image to the ext2 partition of a MMC/SD card (ex.: to the root of the partition) and load it from there:<br /></p><div class="codebox"><pre><code>UBoot&gt; mmcinit
UBoot&gt; ext2load mmc 0:1 0x10000000 /openwrt-avr32-2.6-squashfs.img</code></pre></div><p>0:1 means the card 0, the partition 1 (modify it as needed, you can have more partitions).</p><p>If you managed to get the image to the U-Boot&#039;s memory, you can write it to the flash. You have not changed anything so far, the original or previous setup is still working. You will not be able to use the original setup after this step unless you write the original / image back to the flash (using the same steps).</p><p>You should backup the mtd2 partition if you want to save your changes to the original jffs partition. Otherwise you can restore it using images provided by Atmel (or built by you).</p><p><strong>WARNING: Using wrong addresses or commands may result in the broken u-boot!</strong></p><p>The U-Boot is preventing you to damage the unwanted part of memory. You need to unprotect the unused part of the flash memory, erase it, load the image to the SDRAM and write it to the flash (see the memory map above for the meaning of 0x20000 and 0x7EFFFF addresses).<br /></p><div class="codebox"><pre><code>UBoot&gt; protect off 0x20000 0x7EFFFF
UBoot&gt; erase 0x20000 0x7EFFFF
....
UBoot&gt; tftp 0x10000000 openwrt-avr32-2.6-squashfs.img
Bytes transferred = 1900544 (1D0000 hex)</code></pre></div><p>Notice the size of the image (1D0000 hex), you will need this number for the following command.<br /></p><div class="codebox"><pre><code>UBoot&gt; cp.b 0x10000000 0x20000 0x1D0000
Copy to Flash... done
UBoot&gt; protect on all</code></pre></div><p>You are writing the contents of the SDRAM at the address 0x10000000 to the flash address 0x20000 with the length of 0x1D0000.</p><p>Now you need to modify the U-Boot&#039;s parameters to load the image and provide the kernel with necessary parameters. The U-Boot will expand the kernel from the specified address to the start of the SDRAM and execute it.<br /></p><div class="codebox"><pre><code>UBoot&gt; setenv bootcmd &#039;bootm 0x20000&#039;</code></pre></div><p>The squashfs image has the kernel image prepended, so it starts at the 0x20000 address (see the memory map above). The flash memory is mapped directly into the memory space, so you do not need to load it to the SDRAM. The U-Boot will get the start (+ the length), and the execute address from the kernel image.</p><div class="codebox"><pre><code>UBoot&gt; setenv bootargs &#039;console=/dev/ttyS0,115200 root=/dev/mtdblock2 rootfstype=squashfs,jffs2 init=/etc/preinit&#039;</code></pre></div><p>This is the default kernel&#039;s command line for OpenWrt, the mtd2 is the squashfs/jffs2 partition.</p><p>And finally write all changes to the U-Boot&#039;s environment:<br /></p><div class="codebox"><pre><code>UBoot&gt; savenv
Saving Environment to Flash...
...</code></pre></div><p>Now you just press the reset button or issue:<br /></p><div class="codebox"><pre><code>UBoot&gt; reset</code></pre></div><p>to load the kernel and start your OpenWrt AVR32 experience. <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /></p><br /><p>If you are tired looking at the sys led heartbeat, issue:<br /></p><div class="codebox"><pre><code>[ -f /sys/class/leds/sys/trigger ] &amp;&amp; echo none &gt; /sys/class/leds/sys/trigger</code></pre></div><p>If you want to switch the sys led on, issue:<br /></p><div class="codebox"><pre><code>[ -f /sys/class/leds/sys/brightness ] &amp;&amp; echo 255 &gt; /sys/class/leds/sys/brightness</code></pre></div><p>If you want to switch the sys led off, issue:<br /></p><div class="codebox"><pre><code>[ -f /sys/class/leds/sys/brightness ] &amp;&amp; echo 0 &gt; /sys/class/leds/sys/brightness</code></pre></div><p>if you want to load the kernel image directly, you need to use a different SDRAM address so that the U-Boot would not overwrite the image while decompressing it.<br /></p><div class="codebox"><pre><code>UBoot&gt; tftp 0x10300000 openwrt-avr32-2.6-uImage
UBoot&gt; bootm 0x10300000</code></pre></div><p>You can use any SDRAM address higher than the size of the decompressed kernel. Using the address 0x10300000 will reserve 3 MiB of memory at the start (the kernel image size in the trunk is about 2 MiB).</p><br /><p>P.S. What is driving people to repeat the error thinking that it will eventually end up with success?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p59960">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">altrez</div>
					<div class="post-datetime">
						4 Dec 2007, 17:27					</div>
				</div>
				<div class="post-content content">
					<p>Thank you that worked great! I had loaded the img but had no idea to add the args to uboot! </p><p>THANK YOU!!!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p60020">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">dl9pf</div>
					<div class="post-datetime">
						5 Dec 2007, 23:41					</div>
				</div>
				<div class="post-content content">
					<p>Hi!</p><p>What about the SD/MMC-Card patches - it would be great to boot the system from mmc !<br />This works great for testing and the internal flash is only needed for recovery. </p><p>What is needed to get this working ?&nbsp; AFAIK it already works in buildroot, but what needs to be done to support that in openwrt ?</p><p>Just another kernelconfig ? Newer kernel ?</p><p>Best regards<br />Jan</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p60057">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">kebul</div>
					<div class="post-datetime">
						6 Dec 2007, 15:25					</div>
				</div>
				<div class="post-content content">
					<p>You will have to build it yourself.</p><p>The current OpenWrt trunk holds patches for the kernel 2.6.23.1 including the MMC/SD code.<br /></p><div class="codebox"><pre><code>Linux version 2.6.23.1 (gcc version 4.1.2) #11...
...
mmc0: new SD card at address b368                                               
mmcblk0: mmc0:b368 SMI   993792KiB                                              
 mmcblk0: p1 p2 p3                                                              
...</code></pre></div><p>You would need the initrd to use the MMC/SD partition as the rootfs because filesystem modules are standalone. You can of course modify the kernel&#039;s configuration for the kernel to include the required fs modules.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p60058">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">dl9pf</div>
					<div class="post-datetime">
						6 Dec 2007, 17:02					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><blockquote><p>You would need the initrd to use the MMC/SD partition as the rootfs because filesystem modules are standalone. You can of course modify the kernel&#039;s configuration for the kernel to include the required fs modules.</p></blockquote></div><p>How do i enable initrd in openwrt trunk ??<br />Also if i enable mmc built-in, it is not detected - maybe because of missing rootwait cmdline-option (available since atmel.3)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p60083">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">kebul</div>
					<div class="post-datetime">
						6 Dec 2007, 22:52					</div>
				</div>
				<div class="post-content content">
					<p>Sorry, I have not tried it yet. Try it yourself and write a howto. <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>I am currently running the OpenWrt trunk from the flash and the Atmel&#039;s build from the SD card.</p><p>The OpenWrt AVR32 port is still problematic. The 7.09 repository contains only packages that compiled successfully at that time, the packages were not updated for the AVR32 target in the trunk.</p><p>I am just fighting with the buildroot (although nbd claims that it builds without issues for him):<br />- the uClibc-0.9.28(.2) does not work for all packages (OpenWrt uses only one version for all targets)<br />- there are several packages marked dependant on the dynamic libgcc, which is not built for this target<br />- many packages need the updated config.guess and config.sub - not all packages use the Build/Configure/Default, some of them use the aux dir which is not updated by the Build/Configure/Default<br />- some packages need the update to compile for the AVR32 target, for example strace</p><p>I think that the AVR32 port needs a full update to the gcc, uClibc versions and kernel patches used in the Atmel&#039;s buildroot.</p><p>BTW: The rootwait parameter is the standard kernel&#039;s command line parameter (see Documentation/kernel-parameters.txt).</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>