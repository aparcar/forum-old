<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> OpenWRT on Trendnet TEW-411BRP</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 5 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p2000">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">steve</div>
					<div class="post-datetime">
						9 Sep 2004, 14:03					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>I have a Trendnet TEW-411BRP router (also known as a Sparklan WX-6615) which is based upon very similar - though not identical - hardware to the Linksys WRT54G.</p><p>Is anyone successfully using OpenWRT on the Trendnet?&nbsp; I would like to use it but am concerned about the subtle differences in hardware.&nbsp; I recently tried loading Satori from Sveasoft and found that the router&#039;s switch was not working afterwards.&nbsp; Thankfully, the wireless interface was working, so I was able to enable the boot_wait flag over the wireless link (which wasn&#039;t possible with the Trendnet firmware as it lacks ping.asp) and reload the Trendnet firmware.</p><p>The non-functioning ethernet switch with Satori can be accounted for by the Trendnet using what I believe to be a Broadcom BCM5325 switch chip unlike the Linksys (which I think has an admtek 6996).&nbsp; Is there a driver supporting the BCM5325 included in OpenWRT?</p><p>I would be grateful for any advice, since OpenWRT sounds like exactly what I am looking for in a firmware.</p><p>Regards,</p><p>Steve</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p3090">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">doger</div>
					<div class="post-datetime">
						25 Nov 2004, 14:00					</div>
				</div>
				<div class="post-content content">
					<p>Hi.<br />I&#039;ve a Trendnet TEW-411BRP+ (note the &#039;+&#039;) and I&#039;ve succesfully flashed it with OpenWRT. I&#039;ve used&nbsp; snapshot-20041014.tar.bz2 from the web page, and I uploaded to the router the file openwrt-linux.trx from router configuration web page.</p><p>After flashing and booting OpenWRT, I&#039;ve noted that boot_wait was set to off, so it could be problematic in case of bad flashing, but with luck, anything bad happens.</p><p>I&#039;ve used a while withouth problems, and the problem came when I have to bring back the router to his owner, so I wanted to put in the original firmware of TEW-411BRP+. </p><p>I wrote to flash TEW-411BRP firmware (withouth +, because the + firmware isn&#039;t published in Trendnet&#039;s site) using &#039;mtd&#039; command from inside OpenWRT. The result is an <strong>unusable</strong> router <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> (the router never boots, the power led is flashing continuosly). </p><p>I&#039;m trying now to recover it uploading a new firmware via TFTP (boot_wait=on), but I don&#039;t know the format of the file (I&#039;m trying to get back to OpenWRT, because it worked fine in my router).<br />I don&#039;t know if PMON&#039;s accept a .trx or .bin file; in case of a .bin I don&#039;t know how I make the header to this with addpattern. PMON was changed when I installed OpenWrt first time?</p><p>Please help! or comment experiences with Trendnet 411BRP(+)</p><p>Bye<br />Daniel</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p5525">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">bray</div>
					<div class="post-datetime">
						23 Mar 2005, 09:31					</div>
				</div>
				<div class="post-content content">
					<p>How did you solve your problem?</p><p>regards, B</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p5534">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">doger</div>
					<div class="post-datetime">
						23 Mar 2005, 14:58					</div>
				</div>
				<div class="post-content content">
					<p>I didn&#039;t solve it yet <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" />. I&#039;m waiting god&#039;s signal.<br />The only way I think I can solve this is soldering a serial console inside the AP (if this can be done, of course). There&#039;s a connector inside the access point in WRT54G, I don&#039;t know already if the same applies to TEW-411BRP.<br />With the serial console I can see what&#039;s really happen with PMON at boot time.</p><p>Any suggestions will be appreciated<br />Bye<br />Daniel</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p5535">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">bray</div>
					<div class="post-datetime">
						23 Mar 2005, 15:04					</div>
				</div>
				<div class="post-content content">
					<p>Ok...good luck then <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>I&#039;ll post my experiences here...</p><p><a href="http://openwrt.org/forum/viewtopic.php?t=1174">http://openwrt.org/forum/viewtopic.php?t=1174</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p8057">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">NathanA</div>
					<div class="post-datetime">
						6 Jun 2005, 19:38					</div>
				</div>
				<div class="post-content content">
					<p>Hey doger,</p><p>I, too, have a Trendnet TEW-411BRP+.&nbsp; When I wrote to their technical support people about the lack of a firmware download available for this model on their web site, a very helpful support representative wrote me back and told me that the reason they didn&#039;t have any downloads (other than the EU version) is because the version that shipped with the router is the latest version.&nbsp; When I explained to him that the reason I wanted to have a copy of the firmware on hand was because I was planning on installing a third-party firmware on it (I even mentioned OpenWRT <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /> ), he wrote the following note back to me:</p><div class="quotebox"><cite>Trendnet wrote:</cite><blockquote><p>Dear Nathan,</p><p>In that case you can use the firmware that&#039;s on the website that&#039;s designated as a &quot;European&quot; version.&nbsp; The thing is the domain will be set to European channels.&nbsp; There is a hidden page in the configuration that will allow you to change the domain on it.&nbsp; Just type in the the address line of your browser <a href="http://192.168.1.1/country.asp">http://192.168.1.1/country.asp</a> and it will have a menu that you can switch it to the US domain.</p></blockquote></div><p>Needless to say, the fact that they would divulge this information to me even though I just informed them of the fact that I plan on voiding my warranty impressed me.&nbsp; We&#039;ve been using/reselling Trendnets at work here recently, and I&#039;m beginning to like this company more and more (although some of my recent setbacks re: my OWN 411BRP+ unit have been frustrating).</p><p>If you ever manage to get your 411BRP+ working again, the next time that you need to go back to the official Trendnet firmware, you might want to keep the above in mind and avoid putting the 411BRP firmware on your unit in lieu of the + version. <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>As far as resurrecting your TEW-411BRP+, you don&#039;t have many options, though it definitely is possible if you&#039;re willing to put some elbow-grease into it.&nbsp; On my unit, I tried using boot_wait and the pin-shorting trick to load different firmware on the unit, and neither worked because <a href="http://openwrt.org/forum/viewtopic.php?id=1418">the stupid version of CFE that Trendnet used accepts TFTP uploads but won&#039;t flash them to the EEPROM</a>.&nbsp; In the end, I had no choice but to use a homemade JTAG cable and HairyDairyMaid&#039;s JTAG software to fix my mess-up, and I imagine that if you want to save your router, you&#039;ll probably have to do the same.&nbsp; Based on my own experiences, I would *not* recommend any longer to anybody that they use the pin-shorting trick; it&#039;s dangerous (at least to your pocketbook <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /> ).</p><p>Now, I have a question for you. <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" />&nbsp; You say that you managed to get OpenWRT working smoothly for you on your 411BRP+.&nbsp; I have been banging my head against a wall trying to get mine to work, however!&nbsp; If I load a current experimental snapshot on it (23 Apr 05, 24 May 05, or even checking out the latest version of HEAD from CVS), everything works EXCEPT for the ethernet ports.&nbsp; They get initialized during CFE, but as soon as the kernel boots (not when the et.o module gets loaded, but when the kernel boots!), all of the ethernet ports shut off and will not physically link up anymore.&nbsp; No errors occur during the loading of et.o, either.</p><p>So when I ran across your post, I was hoping to find the answer in earlier builds of OpenWRT (which you claim worked for you).&nbsp; Maybe if we can determine what changed between then and now, we can figure out how to make the latest builds work with the Trendnet hardware again.&nbsp; Yours worked under 20041014, but the earliest one I could still find on openwrt.org for download was 20041023.&nbsp; The changelog didn&#039;t indicate anything had changed between those dates, so I decided to give 20041023 a try.&nbsp; Well, this version doesn&#039;t &quot;turn off&quot; the ethernet ports like &#039;experimental&#039; does, but unfortunately the router refused to communicate with me anymore either via ethernet OR wireless (even though I could tell that it was booting up by the LED activity).&nbsp; So now I&#039;m back to 24 May 05 experimental and non-functioning ethernet ports.</p><p>I&#039;m surprised to learn that yours worked.&nbsp; I&#039;m wondering if I have a newer &quot;revision&quot; of this router and something is physically different inside.&nbsp; Does your 411BRP+ have an ADMtek switch and on-board wireless (no MiniPCI)?</p><p>Some more observations I&#039;ve made about this issue:</p><p>1. I extracted the et.o module from Trendnet&#039;s 2.07-EU firmware (stripped the TRX header and kernel from the firmware file and mounted the CramFS filesystem on my system&#039;s loopback block device) and then uploaded that to my router to see if whatever they changed in hardware was compensated for in their version of et.o (Trendnet has not released their build tree, so I can&#039;t just look in there for the answer).&nbsp; Their module loaded just fine on OpenWRT-experimental, but it didn&#039;t change the fact that all of the ethernet ports were still dead/off.</p><p>2. I installed admcfg on my 411BRP+, and discovered that it doesn&#039;t work...if I change the settings on any given port, it will &quot;confirm&quot; those settings, but then if I check the port again immediately afterwards, I see that the port in question &quot;reverted&quot; back to the settings that it started out with.&nbsp; In other words, the changes I make don&#039;t &quot;stick.&quot;&nbsp; And yes, I had adm.o loaded.&nbsp; It outputs &quot;ADM: 00000000&quot; (dmesg); what do the &#039;0&#039;s mean?&nbsp; That it didn&#039;t find the switch?&nbsp; (Maybe I should look at the code? <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> )</p><p>3. I think the fact that the switch ports die with the kernel boot and not with the loading of et.o (which also configures the switch...look through the code; it determines which switch chip you have [ADMtek or Broadcom] through boardflags and then initializes them through select GPIOs) is telling.&nbsp; The &#039;experimental&#039; kernel is doing something that the old snapshot kernels did not do, and it&#039;s killing the switch.</p><p>4. The GPIOs on the Trendnet are not connected to all the same things that they are on its Linksys brothers.&nbsp; For example, I discovered that GPIO 0 is connected to the reset button on the 411BRP+, not GPIO 6 (so, incidentally, I cannot get into failsafe mode on a stock OpenWRT build).&nbsp; GPIOs 1, 6, and 7 appear to be connected to select LEDs (the power LED, which starts out blinking, will go solid if you toggle #7, for example).&nbsp; This leaves GPIOs 2, 3, 4, and 5 connected to the ADMtek chip, which DOES appear to be standard.&nbsp; And the default NVRAM values for variables gpio2, gpio3, gpio4, and gpio5 in the Trendnet CFE match the values that Linksys uses on its ADMtek-equipped versions of the WRT54G/GS (et.o consults these NVRAM variables in the switch initialization code).&nbsp; However, I am beginning to wonder if perhaps GPIOs 2, 3, 4, and 5 are actually connected in a non-standard order to the ADMtek switch and that this is somehow accounted for in the official Trendnet firmware (which I don&#039;t have the sources for).&nbsp; If they were wired differently than was indicated in NVRAM and the OpenWRT kernel didn&#039;t know this, is it possible that its doing something funky when it hits the GPIO code in the kernel during boot-up that would cause the switch to shut down?&nbsp; (I don&#039;t know how this all works; I&#039;m just thinking out-loud here.)</p><p>If anybody has any ideas, I&#039;m all-ears!&nbsp; Everything else on the Trendnet works...OpenWRT is soooo close to having this be a supported router.&nbsp; Just this one little niggling issue remains.</p><p>-- Nathan</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p8211">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">NathanA</div>
					<div class="post-datetime">
						10 Jun 2005, 02:11					</div>
				</div>
				<div class="post-content content">
					<p>Okay, I got everything working. :-)</p><p>The problem with the ethernet switch shutting off was a result of diag.o.&nbsp; Whenever preinit caused it to load, the switch died.&nbsp; Looking at the code, it appears that what was happening is that as a result of the similarity between the Motorola&#039;s board* NVRAM variables and the Trendnet&#039;s, it decided that the GPIO pin that controlled the reset button was number 5.&nbsp; On the Trendnet, this happens to be wired to adm_rc on the ADMtek switch chip; toggling that GPIO causes the switch to turn off and on (and if you look at the ADMtek control code in the et.o module, located in etc_adm.c, inside the adm_enable_device function, you will see that a time-sensitive sequence needs to be followed to initialize the switch correctly...high(20ms)-&gt;low(100ms)-&gt;high(30ms)).&nbsp; The reset button is actually on GPIO 0.</p><p>So, I managed to kill two birds (the ethernet switch problem and the reset button problem) with one stone by building myself a custom diag.o module for my Trendnet.&nbsp; And now all is right with the world. <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>After this, I discovered that the wireless interface was reeeeeeeaaaallly slow...moving from LAN -&gt; WLAN, I was barely hitting 1Mbps on average, and I peaked at 2 when I was lucky (laptop claimed it was associated to the AP @ 54Mbit/s).&nbsp; So I downgraded to the latest experimental release on a whim (I had been running a recent version of HEAD which included a 3.90.xx version of the wireless driver), and that fixed the problem...11Mbps sustained.&nbsp; I&#039;m guessing that this is some problem with the 3.90 wireless driver running on the Trendnet...the 25 May 05 experimental comes with 3.60.xx.</p><p>I&#039;m not sure what can be done to modify diag_led.c in order to include support for the Trendnet because my board* NVRAM variables are pretty generic.&nbsp; Here is a record of them for posterity:</p><div class="codebox"><pre><code>boardrev=0x10
boardtype=0x0101
boardflags2=0
boardflags=0x0388
boardnum=44</code></pre></div><p>If the boardtype was bcm94710ap, then with the boardnum at 44 the way it is, it would have ended up matching the Dell TrueMobile router, which ALSO has the reset pin on GPIO 0 (Hmmm...I bet I look at the Dell&#039;s pictures on the FCC site and it looks really similar to the Trendnet <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /> ).</p><p>Hopefully the above information is of some use to the developers.&nbsp; In the meantime, if anyone else out there has a TEW-411BRP+ that they want to use OpenWRT on, give me a hollar and I&#039;ll send you a pre-built TRX image for you to use on yours complete with a working diag.o and a slightly tweaked preinit script.&nbsp; If you want my diag_led.c code as well, you are welcome to have it (and under GPL terms, I guess that if I hand out the TRX, I&#039;m required to give it to you anyway <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /> ), but basically all I did was rip out support for every other device and customized it to work on the Trendnet only.</p><p>Happy hacking,</p><p>-- Nathan</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>