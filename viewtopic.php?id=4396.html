<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Routing problem</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 28 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p20553">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">xiutecutli</div>
					<div class="post-datetime">
						9 Feb 2006, 20:22					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>I want to route the 8000 port to an ip on the wrt&#039;s sublan, so i wrote that in firewall.user and executed it :</p><div class="codebox"><pre><code>iptables -t nat -A prerouting_rule -i $WAN -p tcp --dport 8000 -j DNAT --to 192.168.2.148:8000
iptables -A forwarding_rule -i $WAN -p tcp --dport 8000 -d 192.168.2.148</code></pre></div><p>But it won&#039;t work :x</p><p>Can someone help ?</p><p>Thanks,<br />xiutecutli</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p20560">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">xiutecutli</div>
					<div class="post-datetime">
						9 Feb 2006, 23:53					</div>
				</div>
				<div class="post-content content">
					<p>My nvram show (my wrt is in Client mode (Bridge) )</p><div class="codebox"><pre><code>root@OpenWrt:~# nvram show | less
wl_radius_port=1812
wl_mac_deny=
filter_dport_grp3=
filter_dport_grp4=
wl_ap_ssid=
filter_dport_grp5=
filter=on
wan_unit=0
wl0_net_mode=mixed
filter_dport_grp6=
os_ram_addr=80001000
filter_dport_grp7=
wl0_frameburst=off
filter_dport_grp8=
filter_dport_grp9=
ddns_username_2=
log_ipaddr=0
boardrev=0x10
il0macaddr=00:13:10:e6:14:4f
ppp_idletime=5
ppp_passwd=
ddns_enable=0
bootnv_ver=2
et0macaddr=00:13:10:E6:14:4D
qos_appport1=0
skip_intel_check=0
wl0_wep_buf=
qos_appport2=0
ddns_hostname_buf=
d11g_mode=1
wan_get_dns=
wl0_akm=none
wl_maxassoc=128
qos_appport3=0
boot_wait=on
watchdog=5000
wl0_macmode1=disabled
wl_phytypes=
filter_web_host1=
qos_appport4=0
action_service_arg1=
wl0_infra=1
filter_web_host2=
qos_appport5=0
wl0_country_code=ALL
wl0_key2=
pppoe_static_ip=
filter_mac_grp5=
wl_lazywds=1
sel_qossmtp=0
wl0_key3=
filter_mac_grp6=
sel_qospop3=0
wl0_key4=
filter_mac_grp7=
filter_mac_grp8=
filter_client0=
filter_mac_grp9=
filter_maclist=
pptp_pass=1
pptp_get_ip=
wl_auth_mode=none
ppp_demand=1
mtu_enable=0
ppp_keepalive=0
block_activex=0
d11g_rts=2347
remote_mgt_https=0
wl_wpa_psk=
http_passwd=admin
ag0=255
block_wan=1
lan_stp=0
wl0_wme_ap_vi=7 15 1 6016 3008 off
skip_amd_check=0
wl_mode=ap
wl0_plcphdr=long
wl0_rate=0
wl0_closed=0
wl_wpa_gtk_rekey=3600
d11g_rateset=default
wl0_macmode=disabled
wl0_radioids=BCM2050
lan_dhcp=0
wl0_wme_ap_vo=3 7 1 3264 1504 off
sel_qoshttp=0
wl0_phytype=g
wl0gpio2=0
dr_wan_rx=0
filter_tod_buf1=
wl0_lazywds=1
filter_port_grp6=
router_disable=0
ddns_username=
filter_port_grp7=
ddns_passwd=
pppoe_passwd=
filter_port_grp8=
filter_port_grp9=
ses_led_assertlvl=0
ppp_ac=
log_enable=1
sdram_config=0x0062
sel_qosftp=0
filter_web_url10=
wl0_country=Worldwide
wl_atten_bb=3
dmz_ipaddr=102
vlan1ports=0 5
security_mode_last=
wl_wds=
ddns_hostname_2=
scratch=a0180000
eou_private_key=a81be557d5543630af3be065dbf5d401060d9e6eaa9651b9b6ac2deb56c56fa5631418e10a8f7801db5c7978a53461826ab1c321ceefe16812a6cd25cbb313bf412b3137dcdb0fc8a56a576a1522e73e3dcde91c85b9e7b46010ea2800285b664f1e5c69c199878685cf4edc82ded5557455bdb396024310d612bff56e3863f1
filter_summary=0
ccode=0
wl0_rateset=default
wl0_wep_bit=64
port_flow_control_1=1
pppoe_idletime=5
wl_wme=off
port_flow_control_2=1
ping_times=5
eou_device_id=ZWP9JETZ
get_mac=00:13:10:E6:14:4D
port_flow_control_3=1
wan_primary=1
lan_ifname=br0
wl_wme_ap_vi=7 15 1 6016 3008 off
port_flow_control_4=1
filter_services=$NAME:003:DNS$PROT:003:udp$PORT:005:53:53&lt; &gt;$NAME:004:Ping$PROT:004:icmp$PORT:003:0:0&lt; &gt;$NAME:004:HTTP$PROT:003:tcp$PORT:005:80:80&lt; &gt;$NAME:005:HTTPS$PROT:003:tcp$PORT:007:443:443&lt; &gt;$NAME:003:FTP$PROT:003:tcp$PORT:005:21:21&lt; &gt;$NAME:004:POP3$PROT:003:tcp$PORT:007:110:110&lt; &gt;$NAME:004:IMAP$PROT:003:tcp$PORT:007:143:143&lt; &gt;$NAME:004:SMTP$PROT:003:tcp$PORT:005:25:25&lt; &gt;$NAME:004:NNTP$PROT:003:tcp$PORT:007:119:119&lt; &gt;$NAME:006:Telnet$PROT:003:tcp$PORT:005:23:23&lt; &gt;$NAME:004:SNMP$PROT:003:udp$PORT:007:161:161&lt; &gt;$NAME:004:TFTP$PROT:003:udp$PORT:005:69:69&lt; &gt;$NAME:003:IKE$PROT:003:udp$PORT:007:500:500&lt; &gt;
sdram_init=0x010b
filter_tod9=
aol_block_traffic=0
wl_ap_isolate=0
lan_wins=
vlan0hwname=et0
wl_tssi_result= 16
wl_mac_list=
lan_hwnames=
dl_ram_addr=a0001000
pppoe_demand=1
wl_wme_no_ack=off
wl0_radius_key=
filter_dport_grp10=
ddns_username_buf=
wl0_wme_ap_be=15 63 3 0 0 off
wl0_corerev=7
wl_key=1
wl0_channel=10
wl0_wds_timeout=1
dr_setting=0
upnp_enable=1
wl0_wme_ap_bk=15 1023 7 0 0 off
ddns_status=
filter_rule10=
wl_atten_ctl=48
ses_sw_btn_status=DEFAULTS
wl0_auth_mode=none
wl_closed=0
boot_ver=v3.4
autofw_port0=
wl0_crypto=tkip
boardnum=42
language=FR
wl0_ap_ip=
def_hwaddr=00:00:00:00:00:00
wl_delay=1
wl_bcn=100
wl_wep_buf=
eou_public_key=be8603ec13e7f9261bee86d9d727ac0128fe5e3927bb6db0578fefc673684b5509e393a9b6a299132bcf345588082a3e78eb98e20ca976ed6a78c65e08fe277414ab93bda53f2247e05fca7a7f800e0553acefd1ffde8496151684be5ad5a25f791244ae6e84ff71b89168391506c6b26c0c50d38ca314ddf10ebfa6ca9ff6d711
get_sn_index=0
wl_ap_ip=
filter_dport_grp1=
wl_antdiv=-1
filter_dport_grp2=</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p20561">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">mmm7</div>
					<div class="post-datetime">
						9 Feb 2006, 23:57					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>xiutecutli wrote:</cite><blockquote><p>Hi,</p><p>I want to route the 8000 port to an ip on the wrt&#039;s sublan, so i wrote that in firewall.user and executed it :</p><div class="codebox"><pre><code>iptables -t nat -A prerouting_rule -i $WAN -p tcp --dport 8000 -j DNAT --to 192.168.2.148:8000
iptables -A forwarding_rule -i $WAN -p tcp --dport 8000 -d 192.168.2.148</code></pre></div><p>But it won&#039;t work :x</p><p>Can someone help ?</p><p>Thanks,<br />xiutecutli</p></blockquote></div><p>Hi,</p><p>I think in the second rule you should tell iptables what to do:<br /></p><div class="codebox"><pre><code>iptables -t nat -A prerouting_rule -i $WAN -p tcp --dport 8000 -j DNAT --to 192.168.2.148:8000
iptables -A forwarding_rule -i $WAN -p tcp --dport 8000 -d 192.168.2.148 -j ACCEPT</code></pre></div><p><em>This is just a guess, I have not tested it...</em><img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>--<br />Mate</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p20563">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">xiutecutli</div>
					<div class="post-datetime">
						10 Feb 2006, 00:01					</div>
				</div>
				<div class="post-content content">
					<p>Won&#039;t work.</p><p>Thank you anyway</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p20567">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">mmm7</div>
					<div class="post-datetime">
						10 Feb 2006, 00:25					</div>
				</div>
				<div class="post-content content">
					<p>Could you post your whole /etc/firewall.user script?</p><p>--<br />Mate</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p20568">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">xiutecutli</div>
					<div class="post-datetime">
						10 Feb 2006, 00:32					</div>
				</div>
				<div class="post-content content">
					<p>#!/bin/sh<br />. /etc/functions.sh</p><p>WAN=$(nvram get wan_ifname)<br />LAN=$(nvram get lan_ifname)</p><p>iptables -F input_rule<br />iptables -F output_rule<br />iptables -F forwarding_rule<br />iptables -t nat -F prerouting_rule<br />iptables -t nat -F postrouting_rule</p><p>### BIG FAT DISCLAIMER<br />### The &quot;-i $WAN&quot; literally means packets that came in over the $WAN interface;<br />### this WILL NOT MATCH packets sent from the LAN to the WAN address.</p><p>### Allow SSH on the WAN interface<br /># iptables -t nat -A prerouting_rule -i $WAN -p tcp --dport 22 -j ACCEPT<br /># iptables&nbsp; &nbsp; &nbsp; &nbsp; -A input_rule&nbsp; &nbsp; &nbsp; -i $WAN -p tcp --dport 22 -j ACCEPT</p><p>### Port forwarding<br /># iptables -t nat -A prerouting_rule -i $WAN -p tcp --dport 30000 -j DNAT --to 192.168.2.133<br />iptables -t nat -A prerouting_rule -i $WAN -p tcp --dport 8000 -j DNAT --to 192.168.2.148:8000<br />iptables -A forwarding_rule -i $WAN -p tcp --dport 8000 -d 192.168.2.148 -j ACCEPT</p><br /><br /><br /><br /><br /><br /><br /><br /><p>### DMZ (should be placed after port forwarding / accept rules)<br /># iptables -t nat -A prerouting_rule -i $WAN -j DNAT --to 192.168.1.2<br /># iptables&nbsp; &nbsp; &nbsp; &nbsp; -A forwarding_rule -i $WAN -d 192.168.1.2 -j ACCEPT</p><p># VPN<br />iptables -I INPUT -i tap0 -j ACCEPT<br />iptables -I OUTPUT -o tap0 -j ACCEPT<br />iptables -I FORWARD -i tap0 -j ACCEPT<br />iptables -I FORWARD -o tap0 -j ACCEPT<br />iptables -t nat -I POSTROUTING -o tap0 -j MASQUERADE</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p20637">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">xiutecutli</div>
					<div class="post-datetime">
						11 Feb 2006, 01:45					</div>
				</div>
				<div class="post-content content">
					<p>reup :x</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p20638">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">mbm</div>
					<div class="post-datetime">
						11 Feb 2006, 01:53					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>xiutecutli wrote:</cite><blockquote><p>### BIG FAT DISCLAIMER<br />### The &quot;-i $WAN&quot; literally means packets that came in over the $WAN interface;<br />### this WILL NOT MATCH packets sent from the LAN to the WAN address.</p></blockquote></div><p>Read it carefully.</p><p>The changes will work, but they won&#039;t be visible from your side of the router; you will need to test it from another internet connection.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p20653">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">xiutecutli</div>
					<div class="post-datetime">
						11 Feb 2006, 12:43					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ve a client upstream my router in another sublan (the sublan of my modem which is a router too, it has a DMZ on my wrt) and when I try to reach it from the modem&#039;s sublan it won&#039;t too.</p><p>Modem --------------------- wifi ---------------- OpenWRT<br />192.168.1.0 255.255.255.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;192.168.2.0 255.255.255.0<br />Two Clients.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 4 Clients.</p><br /><p>EDIT : I tried to ping my wrt from the modem&#039;s sublan and it timeout <img src="https://forum.openwrt.org/img/smilies/hmm.png" width="15" height="15" alt="hmm" /></p>											<p class="post-edited">(Last edited by <strong>xiutecutli</strong> on 11 Feb 2006, 12:53)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>