<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Any way to test the compiled firmware before flashing to the router?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 21 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p305059">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">wyf88</div>
					<div class="post-datetime">
						26 Dec 2015, 12:58					</div>
				</div>
				<div class="post-content content">
					<p>I just bricked my router with my self-compiled OpenWrt firmware. Actually I compile my customized firmware and use &quot;sysupgrade -n&quot; quite often, and in 99% of time it works great. I&#039;m not sure what&#039;s wrong this time. I can&#039;t even get into the failsafe mode, so I guess the firmware I compiled is corrupted.</p><p>I&#039;m wondering if there is any way to test whether the firmware is OK after the compilation, before flashing it to the router. Thanks a lot in advance!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p305080">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">mazilo</div>
					<div class="post-datetime">
						26 Dec 2015, 15:05					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>wyf88 wrote:</cite><blockquote><p>I&#039;m wondering if there is any way to test whether the firmware is OK after the compilation, before flashing it to the router.</p></blockquote></div><p>AFAICT, the answer depends on your hardware. If your hardware runs on a u-boot, then this is possible. I know and have been doing this for 10+ years with my Seagate DockStar. My Seagate DockStar, Seagate GoFLEX Home/Net, and a PogoPlug Pro still have their respective original stock firmware intact on their internal NAND storage while they are now running a self-built OpenWRT firmware off an external USB storage. All I did was to replace their respective original u-boot with a 3rd party (<a href="http://forum.doozan.com/list.php?3">bodhi</a>) u-boot that supports booting from an external storage and/or over the net. As of this writing, I have never done the later (booting over the net) which makes firmware testing even simpler.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p305086">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">kelhgvrb</div>
					<div class="post-datetime">
						26 Dec 2015, 15:24					</div>
				</div>
				<div class="post-content content">
					<p>Some uboot have the support to load firmware from tftp and boot it but not write it to ROM. It keeps it in RAM.<br />In normal cases you need a serial connection to the device to enable this function. And then you can also just write it into the ROM and when its not working you can still use uboot to write something else into the ROM.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p305108">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">wyf88</div>
					<div class="post-datetime">
						26 Dec 2015, 19:10					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>mazilo wrote:</cite><blockquote><p>AFAICT, the answer depends on your hardware. If your hardware runs on a u-boot, then this is possible. I know and have been doing this for 10+ years with my Seagate DockStar. My Seagate DockStar, Seagate GoFLEX Home/Net, and a PogoPlug Pro still have their respective original stock firmware intact on their internal NAND storage while they are now running a self-built OpenWRT firmware off an external USB storage. All I did was to replace their respective original u-boot with a 3rd party (<a href="http://forum.doozan.com/list.php?3">bodhi</a>) u-boot that supports booting from an external storage and/or over the net. As of this writing, I have never done the later (booting over the net) which makes firmware testing even simpler.</p></blockquote></div><div class="quotebox"><cite>kelhgvrb wrote:</cite><blockquote><p>Some uboot have the support to load firmware from tftp and boot it but not write it to ROM. It keeps it in RAM.<br />In normal cases you need a serial connection to the device to enable this function. And then you can also just write it into the ROM and when its not working you can still use uboot to write something else into the ROM.</p></blockquote></div><p>Thanks a lot for sharing your experience! I will look into that, but it seems that not many devices are able to boot from an external storage, like my usual TP-link router. It&#039;s a pity that there&#039;s not something like a &quot;virtual machine&quot; that can install a OpenWrt firmware for a specific type of router.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p305134">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">slh</div>
					<div class="post-datetime">
						27 Dec 2015, 03:09					</div>
				</div>
				<div class="post-content content">
					<p>You&#039;d have a better chance for a reliable recovery method beyond failsafe (some routers provide this from the stock bootloader (afaik newer TP-Link firmwares do support this), for some there are <a href="https://forum.openwrt.org/viewtopic.php?id=43237">3rd party options</a>), than to emulate (more than one-) embedded devices, because usually each of them is its own special snowflake (needing its very own, non-generic and highly special emulation). With such a bootloader-level recovery method, broken flash images usually lose their scare factor, but even without it, you might have a chance to debug and eventually recover the situation with a serial console.</p>											<p class="post-edited">(Last edited by <strong>slh</strong> on 27 Dec 2015, 03:10)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p305159">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">wyf88</div>
					<div class="post-datetime">
						27 Dec 2015, 13:01					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>slh wrote:</cite><blockquote><p>You&#039;d have a better chance for a reliable recovery method beyond failsafe (some routers provide this from the stock bootloader (afaik newer TP-Link firmwares do support this), for some there are <a href="https://forum.openwrt.org/viewtopic.php?id=43237">3rd party options</a>), than to emulate (more than one-) embedded devices, because usually each of them is its own special snowflake (needing its very own, non-generic and highly special emulation). With such a bootloader-level recovery method, broken flash images usually lose their scare factor, but even without it, you might have a chance to debug and eventually recover the situation with a serial console.</p></blockquote></div><p>Yes, that&#039;s a good solution, thanks! Unfortunately my router is a little bit old, so such function is not added to the stock bootloader. I&#039;m not sure whether I can have the latest stock bootloader by flashing the latest stock firmware, and then go back to OpenWrt. And the 3rd party &quot;u-boot&quot; you mentioned is absolutely worth a try. Perhaps the only concern is that if I mess it up, the router will be almost totally dead.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p305171">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">mazilo</div>
					<div class="post-datetime">
						27 Dec 2015, 15:02					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>wyf88 wrote:</cite><blockquote><p>I&#039;m not sure whether I can have the latest stock bootloader by flashing the latest stock firmware, ...</p></blockquote></div><p>Make sure you have a JTAG cable and/or tools around to recover in case the process to flash bootloader fails. Some u-boot&nbsp; has a support for booting via UART/serial connection. This is a very nice option to have so one can test any new u-boot will work before gets flashed to the device. Perhaps, you may want to read this <a href="http://forum.doozan.com/read.php?3,7852,7852">UART Booting HowTo for Selected Kirkwood Devices</a> and then see if that will help you for your device.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p305173">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">wyf88</div>
					<div class="post-datetime">
						27 Dec 2015, 15:44					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>mazilo wrote:</cite><blockquote><p>Make sure you have a JTAG cable and/or tools around to recover in case the process to flash bootloader fails. Some u-boot&nbsp; has a support for booting via UART/serial connection. This is a very nice option to have so one can test any new u-boot will work before gets flashed to the device. Perhaps, you may want to read this <a href="http://forum.doozan.com/read.php?3,7852,7852">UART Booting HowTo for Selected Kirkwood Devices</a> and then see if that will help you for your device.</p></blockquote></div><p>Thanks a lot for your advice! I&#039;m not good at things like soldering, so I guess I should visit my friend working for TP-Link for helping me debrick my router first <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p>											<p class="post-edited">(Last edited by <strong>wyf88</strong> on 27 Dec 2015, 15:44)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p305176">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">lizby</div>
					<div class="post-datetime">
						27 Dec 2015, 16:26					</div>
				</div>
				<div class="post-content content">
					<p>More specific answers might be provided if you share the make and model of your device.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p305181">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">wyf88</div>
					<div class="post-datetime">
						27 Dec 2015, 17:06					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>lizby wrote:</cite><blockquote><p>More specific answers might be provided if you share the make and model of your device.</p></blockquote></div><p>Thank you for being willing to help! My router is a TP-Link WR1043ND V1.8 (or 1.9?). I did found some modified u-boot with failsafe function for this model, but I have to debrick the router before trying that.</p><p>This is actually the second time I bricked this model of router. The first one was bricked two years ago when I was reverting it back to an older version of stock firmware to downgrade the bootloader. I must have messed up the bootloader, since after boot all the lights are on and then off in a loop. After trying everything I found from Google, I sent it to a friend in TP-Link but he messed up with the soldering, so I end up buying a second one. </p><p>This time the router is bricked after a &quot;sysupgrade -n&quot;. It never happens after I learn to compile my own firmware. I&#039;m not sure whether the compiled firmware is corrupted, or the uploading / flashing was not successful. Whatever. After boot, the SYS light is on and then off forever. (The LAN light does work if I connect a PC to one of the LAN ports, does that mean the router is not totally dead?) The failsafe mode does not work, I could not get into it no matter what I tried. I also tried the &quot;built-in auto tftp recovery process&quot; mentioned <a href="https://wiki.openwrt.org/toh/tp-link/tl-wr1043nd#flashingrecovery_using_tftp_only_without_serial_console">here</a>, but it does not work as well. If flashing via the serial console is the only option, I would better send it to my friend in TP-Link, because I&#039;m not confident to mess with the hardware.</p>											<p class="post-edited">(Last edited by <strong>wyf88</strong> on 27 Dec 2015, 17:08)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p305206">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">lizby</div>
					<div class="post-datetime">
						27 Dec 2015, 20:51					</div>
				</div>
				<div class="post-content content">
					<p>With the &quot;built-in auto tftp recovery process&quot; have you tried turning off the firewall on your PC? I have found that for Win7 using tftp64, I have to disable the firewall to get tftp to work (but haven&#039;t been trying the &quot;auto&quot; version).</p><p>Otherwise, it would seem that you need to have a serial connection. According to the photos, at least some versions of the WR1043ND have in-line .1&quot; through-holes for GND, RX, TX. It should be relatively easy to solder a three-pin header to that, and then connect to a 3.3V usb/serial adaptor for debugging. But if you&#039;re not comfortable with opening the case and soldering, it might be best to have someone else do that.</p><p>When the through-holes are pre-filled with solder, it can be hard for a hobbyist to solder on a header or wires, since the lead-free solder used on these boards often melts at a higher temperature than is available with many hobby soldering irons (I use a 15W iron for 60/40 solder).</p>											<p class="post-edited">(Last edited by <strong>lizby</strong> on 27 Dec 2015, 20:52)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>