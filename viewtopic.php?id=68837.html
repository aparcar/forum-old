<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> IPv6 Routing Problems</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 14 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p345941">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">shaggystyle</div>
					<div class="post-datetime">
						7 Dec 2016, 01:57					</div>
				</div>
				<div class="post-content content">
					<p>I recently update to 15.05.1 and decided to enable ipv6 support. My current sticking point is that while I can ping external addresses like ipv6.google.com from the router itself, I cannot ping from any of my lan based devices.</p><p><span class="bbu">Configuration details:</span><br />ifstatus lan<br /></p><div class="codebox"><pre><code>{
    &quot;up&quot;: true,
    &quot;pending&quot;: false,
    &quot;available&quot;: true,
    &quot;autostart&quot;: true,
    &quot;dynamic&quot;: false,
    &quot;uptime&quot;: 6117,
    &quot;l3_device&quot;: &quot;br-lan&quot;,
    &quot;proto&quot;: &quot;static&quot;,
    &quot;device&quot;: &quot;br-lan&quot;,
    &quot;updated&quot;: [
        &quot;addresses&quot;,
        &quot;routes&quot;
    ],
    &quot;metric&quot;: 0,
    &quot;delegation&quot;: true,
    &quot;ipv4-address&quot;: [
        {
            &quot;address&quot;: &quot;192.168.1.1&quot;,
            &quot;mask&quot;: 24
        }
    ],
    &quot;ipv6-address&quot;: [
        
    ],
    &quot;ipv6-prefix&quot;: [
        
    ],
    &quot;ipv6-prefix-assignment&quot;: [
        {
            &quot;address&quot;: &quot;2607:fcc8:ae4c:1800::&quot;,
            &quot;mask&quot;: 60,
            &quot;preferred&quot;: 598689,
            &quot;valid&quot;: 598689
        },
        {
            &quot;address&quot;: &quot;fd2d:e64b:3e3f::&quot;,
            &quot;mask&quot;: 60
        }
    ],
    &quot;route&quot;: [
        
    ],
    &quot;dns-server&quot;: [
        
    ],
    &quot;dns-search&quot;: [
        
    ],
    &quot;inactive&quot;: {
        &quot;ipv4-address&quot;: [
            
        ],
        &quot;ipv6-address&quot;: [
            
        ],
        &quot;route&quot;: [
            
        ],
        &quot;dns-server&quot;: [
            
        ],
        &quot;dns-search&quot;: [
            
        ]
    },
    &quot;data&quot;: {
        
    }
}</code></pre></div><p>ifstatus wan6<br /></p><div class="codebox"><pre><code>{
    &quot;up&quot;: true,
    &quot;pending&quot;: false,
    &quot;available&quot;: true,
    &quot;autostart&quot;: true,
    &quot;dynamic&quot;: false,
    &quot;uptime&quot;: 5014,
    &quot;l3_device&quot;: &quot;eth1&quot;,
    &quot;proto&quot;: &quot;dhcpv6&quot;,
    &quot;device&quot;: &quot;eth1&quot;,
    &quot;metric&quot;: 0,
    &quot;delegation&quot;: true,
    &quot;ipv4-address&quot;: [
        
    ],
    &quot;ipv6-address&quot;: [
        {
            &quot;address&quot;: &quot;2607:fcc8:bfc0:75:450c:7116:fb30:d5a5&quot;,
            &quot;mask&quot;: 128,
            &quot;preferred&quot;: 599786,
            &quot;valid&quot;: 599786
        }
    ],
    &quot;ipv6-prefix&quot;: [
        {
            &quot;address&quot;: &quot;2607:fcc8:ae4c:1800::&quot;,
            &quot;mask&quot;: 56,
            &quot;preferred&quot;: 599786,
            &quot;valid&quot;: 599786,
            &quot;class&quot;: &quot;wan6&quot;,
            &quot;assigned&quot;: {
                &quot;lan&quot;: {
                    &quot;address&quot;: &quot;2607:fcc8:ae4c:1800::&quot;,
                    &quot;mask&quot;: 60
                }
            }
        }
    ],
    &quot;ipv6-prefix-assignment&quot;: [
        
    ],
    &quot;route&quot;: [
        {
            &quot;target&quot;: &quot;::&quot;,
            &quot;mask&quot;: 0,
            &quot;nexthop&quot;: &quot;fe80::201:5cff:fe81:3446&quot;,
            &quot;metric&quot;: 512,
            &quot;valid&quot;: 1784,
            &quot;source&quot;: &quot;2607:fcc8:ae4c:1800::\/56&quot;
        },
        {
            &quot;target&quot;: &quot;::&quot;,
            &quot;mask&quot;: 0,
            &quot;nexthop&quot;: &quot;fe80::201:5cff:fe81:3446&quot;,
            &quot;metric&quot;: 512,
            &quot;valid&quot;: 1784,
            &quot;source&quot;: &quot;2607:fcc8:bfc0:75:450c:7116:fb30:d5a5\/128&quot;
        }
    ],
    &quot;dns-server&quot;: [
        
    ],
    &quot;dns-search&quot;: [
        
    ],
    &quot;inactive&quot;: {
        &quot;ipv4-address&quot;: [
            
        ],
        &quot;ipv6-address&quot;: [
            
        ],
        &quot;route&quot;: [
            
        ],
        &quot;dns-server&quot;: [
            
        ],
        &quot;dns-search&quot;: [
            
        ]
    },
    &quot;data&quot;: {
        
    }
}</code></pre></div><p><span class="bbu">Testing from the router:</span><br />ping6 ipv6.google.com<br /></p><div class="codebox"><pre><code>PING ipv6.google.com (2607:f8b0:4004:809::200e): 56 data bytes
64 bytes from 2607:f8b0:4004:809::200e: seq=0 ttl=53 time=40.013 ms
64 bytes from 2607:f8b0:4004:809::200e: seq=1 ttl=53 time=42.501 ms
64 bytes from 2607:f8b0:4004:809::200e: seq=2 ttl=53 time=39.930 ms
64 bytes from 2607:f8b0:4004:809::200e: seq=3 ttl=53 time=41.234 ms
--- ipv6.google.com ping statistics ---
4 packets transmitted, 4 packets received, 0% packet loss
round-trip min/avg/max = 39.930/40.919/42.501 ms</code></pre></div><p>traceroute6 ipv6.google.com<br /></p><div class="codebox"><pre><code>traceroute to ipv6.l.google.com (2607:f8b0:4004:80d::200e) from 2607:fcc8:bfc0:75:450c:7116:fb30:d5a5, 30 hops max, 16 byte packets
 1  2607:fcc8:bfc0:75::1 (2607:fcc8:bfc0:75::1)  26.252 ms  10.162 ms  12.213 ms
 2  2605:a000:0:4::6:50f7 (2605:a000:0:4::6:50f7)  11.319 ms  11.332 ms  11.272 ms
 3  2605:a000:0:4::6:176 (2605:a000:0:4::6:176)  18.77 ms  20.533 ms  15.254 ms
 4  2605:a000:0:4::8 (2605:a000:0:4::8)  20.457 ms  25.13 ms  23.652 ms
 5  2001:1998:0:8::1a (2001:1998:0:8::1a)  36.524 ms  37.277 ms  32.166 ms
 6  2001:1998:0:4::9c (2001:1998:0:4::9c)  34.375 ms  35.825 ms  47.926 ms
 7  2001:1998:0:4::ec (2001:1998:0:4::ec)  28.839 ms  30.955 ms  28.21 ms
 8  ix-ae-27-0.tcore2.CT8-Chicago.ipv6.as6453.net (2001:5a0:40:300::5d)  42.473 ms  50.709 ms  43.08 ms
 9  2001:4860:1:1:0:1935:0:c1 (2001:4860:1:1:0:1935:0:c1)  60.23 ms  65.581 ms  62.321 ms
10  2001:4860::1:0:cb45 (2001:4860::1:0:cb45)  44.138 ms  51.362 ms  42.064 ms
11  2001:4860::c:4000:d5ff (2001:4860::c:4000:d5ff)  55.325 ms  45.73 ms  43.751 ms
12  2001:4860::c:4000:da1a (2001:4860::c:4000:da1a)  40.068 ms  41.621 ms  38.433 ms
13  2001:4860::1:4000:c8a3 (2001:4860::1:4000:c8a3)  37.876 ms  38.792 ms  49.112 ms
14  2001:4860:0:1::127b (2001:4860:0:1::127b)  48.366 ms  37.609 ms  37.931 ms
15  iad23s43-in-x0e.1e100.net (2607:f8b0:4004:80d::200e)  38.789 ms  36.038 ms  38.281 ms</code></pre></div><p><span class="bbu">Testing from the lan:</span><br />ping6 ipv6.google.com<br /></p><div class="codebox"><pre><code>PING ipv6.google.com(iad23s43-in-x0e.1e100.net (2607:f8b0:4004:80d::200e)) 56 data bytes
--- ipv6.google.com ping statistics ---
4 packets transmitted, 0 received, 100% packet loss, time 3033ms</code></pre></div><p>traceroute6 ipv6.google.com<br /></p><div class="codebox"><pre><code>traceroute ipv6.google.com
traceroute to ipv6.google.com (2607:f8b0:4004:806::200e), 30 hops max, 80 byte packets
 1  2607:fcc8:ae4c:1800::1 (2607:fcc8:ae4c:1800::1)  0.589 ms  0.578 ms  0.563 ms
 2  * * *
 3  * * *
 4  * * *
 5  * * *
 6  * * *
 7  * * *
 8  * * *
 9  * * *
10  * * *
11  * * *
12  * * *
13  * * *
14  * * *
15  * * *
16  * * *
17  * * *
18  * * *
19  * * *
20  * * *
21  * * *
22  * * *
23  * * *
24  * * *
25  * * *
26  * * *
27  * * *
28  * * *
29  * * *
30  * * *</code></pre></div><p>It looks like I need to update the route, but I&#039;m not sure how to do that.&nbsp; Any help?</p>											<p class="post-edited">(Last edited by <strong>shaggystyle</strong> on 7 Dec 2016, 01:58)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p345956">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">bolvan</div>
					<div class="post-datetime">
						7 Dec 2016, 10:01					</div>
				</div>
				<div class="post-content content">
					<p>Can be firewall issue.</p><p>Try temporary : /etc/init.d/firewall stop<br />Then ping previously unpingable host.<br />Then /etc/init.d/firewall start</p><p>If pings pass then you need ipv6 forward rule</p>											<p class="post-edited">(Last edited by <strong>bolvan</strong> on 7 Dec 2016, 10:02)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p345997">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">shaggystyle</div>
					<div class="post-datetime">
						7 Dec 2016, 16:18					</div>
				</div>
				<div class="post-content content">
					<p>Forgot to mention that part... Flushing the firewall rules didn&#039;t resolve the problem.</p><p>It looks to me like the lan devices don&#039;t have a route to external. The traceroute terminates at the router and the routes on the wan device look like they are directing all traffic from the internal subnet to the link local address of the router. Maybe I&#039;m reading it wrong (I&#039;m not so good with routing). </p><p>I tried adding a static route to send all traffic from the internal subnet to the upstream gateway but that didn&#039;t fix it.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p345998">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">AndreL</div>
					<div class="post-datetime">
						7 Dec 2016, 17:09					</div>
				</div>
				<div class="post-content content">
					<p>Run tcpdump on WAN interface and check if ping requests from LAN are really being forwared to the modem or main router. If happens that these packets are going out but replies don&#039;t come back then the routing problem is in the modem configuration or in ISP network.</p><p>I guess when you ping google from OpenWrt it uses a source address that is within the WAN prefix. But packets that use a source and/or destination address within the delegated (LAN) prefix are being droped somewhere between internet and the WAN port of your OpenWrt router.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p346004">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">bolvan</div>
					<div class="post-datetime">
						7 Dec 2016, 18:17					</div>
				</div>
				<div class="post-content content">
					<p>May be ISP actually does not delegate prefix although claiming to do that.<br />Good advice to use tcpdump.<br />If no replies come back to wan port this is the reason to call ISP.</p><p>Also check that lan devices have ipv6 routable address only in one /64 subnet. Openwrt does not support well delegation of dynamic prefixes from ISP. Devices will accumulate prefixes that not more working and use source addresses which no more routed by ISP.</p>											<p class="post-edited">(Last edited by <strong>bolvan</strong> on 7 Dec 2016, 18:20)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>