<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> [Unresolved] Poor speeds with RT2800 drv and external wifi USB antenna</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 25 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p360987">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">rmacielalves</div>
					<div class="post-datetime">
						26 Jun 2017, 02:03					</div>
				</div>
				<div class="post-content content">
					<p>Hi all!</p><p>I get the internet from a wireless ISP with an external antenna. The signal keeps between -65dB and -69dB.</p><p>USB External Antenna --&gt; TL-WR842NDV1 --&gt; devices</p><p>I&#039;ve been trying to improve my signal, but the RX always stays at 1Mbps-2Mbps (40kB/s ~ 100kB/s download rate) sometimes jumps to 11Mbps (300kb/s ~ 400kB/s download rate) for a few seconds then drop again.<br />Reconnecting gives me a nice boost for a minute, then the speed drops again.</p><p><span class="postimg"><img src="https://r4to0img.azurewebsites.net/image-40D4_5950406B.jpg" alt="https://r4to0img.azurewebsites.net/image-40D4_5950406B.jpg" /></span></p><p>Plugging the USB antenna directly into PC (Windows 10) I get better speeds and stability (stays at 48Mbps all the time, 500kB/s ~ 700kB/s download rate) than plugging into router USB.</p><p>My guesses are the drivers, since Windows drivers are different from *nix, or the router can&#039;t supply enough power to keep a stable signal.<br />I have to use a passive HUB to get the antenna working on the router since the router itself refuses to recognizes the antenna directly.</p><p>Any clue?</p><p>OpenWRT version:<br /></p><div class="codebox"><pre><code>Model            TP-Link TL-WR842N/ND v1
Firmware Version    OpenWrt Chaos Calmer 15.05.1 / LuCI 15.05-149-g0d8bbd2 Release (git-15.363.78009-956be55)
Kernel Version        3.18.23</code></pre></div><p>USB Drivers:<br /></p><div class="codebox"><pre><code>kmod-lib-crc-itu-t
kmod-rt2x00-lib
kmod-rt2x00-usb
kmod-rt2800-lib
kmod-rt2800-usb</code></pre></div><p>USB lsusb<br /></p><div class="codebox"><pre><code>root@OpenWrt:~# lsusb
Bus 001 Device 003: ID 148f:2070 Ralink Technology, Corp. RT2070 Wireless Adapter
Bus 001 Device 002: ID 05e3:0608 Genesys Logic, Inc. USB-2.0 4-Port HUB
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub</code></pre></div><p>USB dmesg<br /></p><div class="codebox"><pre><code>Thu Jun 25 18:41:17 2017 kern.info kernel: [  684.960000] usb 1-1: new high-speed USB device number 23 using ehci-platform
Thu Jun 25 18:41:18 2017 kern.info kernel: [  685.110000] hub 1-1:1.0: USB hub found
Thu Jun 25 18:41:18 2017 kern.info kernel: [  685.110000] hub 1-1:1.0: 4 ports detected
Thu Jun 25 18:41:22 2017 kern.info kernel: [  689.390000] usb 1-1.1: new high-speed USB device number 24 using ehci-platform
Thu Jun 25 18:41:22 2017 kern.info kernel: [  689.630000] usb 1-1.1: reset high-speed USB device number 24 using ehci-platform
Thu Jun 25 18:41:22 2017 kern.info kernel: [  689.760000] ieee80211 phy1: rt2x00_set_rt: Info - RT chipset 3070, rev 0201 detected
Thu Jun 25 18:41:22 2017 kern.info kernel: [  689.790000] ieee80211 phy1: rt2x00_set_rf: Info - RF chipset 0006 detected
Thu Jun 25 18:41:22 2017 kern.debug kernel: [  689.800000] ieee80211 phy1: Selected rate control algorithm &#039;minstrel_ht&#039;</code></pre></div><p>PHY Info<br /></p><div class="codebox"><pre><code>root@OpenWrt:~# iw phy phy2 info
Wiphy phy2
        max # scan SSIDs: 4
        max scan IEs length: 2285 bytes
        Retry short limit: 7
        Retry long limit: 4
        Coverage class: 0 (up to 0m)
        Available Antennas: TX 0 RX 0
        Supported interface modes:
                 * IBSS
                 * managed
                 * AP
                 * AP/VLAN
                 * WDS
                 * monitor
                 * mesh point
        Band 1:
                Frequencies:
                        * 2412 MHz [1] (30.0 dBm)
                        * 2417 MHz [2] (30.0 dBm)
                        * 2422 MHz [3] (30.0 dBm)
                        * 2427 MHz [4] (30.0 dBm)
                        * 2432 MHz [5] (30.0 dBm)
                        * 2437 MHz [6] (30.0 dBm)
                        * 2442 MHz [7] (30.0 dBm)
                        * 2447 MHz [8] (30.0 dBm)
                        * 2452 MHz [9] (30.0 dBm)
                        * 2457 MHz [10] (30.0 dBm)
                        * 2462 MHz [11] (30.0 dBm)
                        * 2467 MHz [12] (30.0 dBm)
                        * 2472 MHz [13] (30.0 dBm)
                        * 2484 MHz [14] (disabled)
        valid interface combinations:
                 * #{ managed, AP, mesh point } &lt;= 8,
                   total &lt;= 8, #channels &lt;= 1
        HT Capability overrides:
                 * MCS: ff ff ff ff ff ff ff ff ff ff
                 * maximum A-MSDU length
                 * supported channel width
                 * short GI for 40 MHz
                 * max A-MPDU length exponent
                 * min MPDU start spacing
root@OpenWrt:~#</code></pre></div><p>Link info<br /></p><div class="codebox"><pre><code>Connected to xx:xx:xx:xx:xx:xx (on wlan2)
        SSID: [REDACTED]
        freq: 2412
        RX: 844269296 bytes (745511 packets)
        TX: 58334751 bytes (590279 packets)
        signal: -69 dBm
        tx bitrate: 24.0 MBit/s

        bss flags:      short-slot-time
        dtim period:    1
        beacon int:     100</code></pre></div><p>Thanks in advance!</p><div class="codebox"><pre><code>Edit Aug 15 2017: Added OpenWRT version and lsusb output.</code></pre></div>											<p class="post-edited">(Last edited by <strong>rmacielalves</strong> on 26 Sep 2017, 10:57)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p363125">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">rmacielalves</div>
					<div class="post-datetime">
						3 Aug 2017, 23:28					</div>
				</div>
				<div class="post-content content">
					<p>Update: Adding nohwcrypt=y in /etc/modules.d/rt2800 seems to improve a lot the connectivity.</p><p><span class="postimg"><img src="https://i.imgur.com/ndCNmIP.png" alt="https://i.imgur.com/ndCNmIP.png" /></span></p><p>Speeds are good now like in Windows with official drivers. <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>											<p class="post-edited">(Last edited by <strong>rmacielalves</strong> on 18 Aug 2017, 02:15)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p363720">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">rmacielalves</div>
					<div class="post-datetime">
						15 Aug 2017, 09:00					</div>
				</div>
				<div class="post-content content">
					<p>Unfortunately I&#039;m still getting low RX rate even with nohwcrypt. Just plugged the antenna on a computer and&nbsp; I get 4-5Mbps on speedtest.net, while with the antenna plugged in into router USB I get 800kbps, odd...</p><p><span class="postimg"><img src="https://r4to0img.azurewebsites.net/images/2017/08/15/f8466935b0e8c908edff47544b236a94.png" alt="https://r4to0img.azurewebsites.net/images/2017/08/15/f8466935b0e8c908edff47544b236a94.png" /></span></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p363721">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">tapper</div>
					<div class="post-datetime">
						15 Aug 2017, 10:21					</div>
				</div>
				<div class="post-content content">
					<p>What about upgrading to LEDE 17.1.2 to see if any changes have bin made to the drivers?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p363724">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">anarchy99</div>
					<div class="post-datetime">
						15 Aug 2017, 11:20					</div>
				</div>
				<div class="post-content content">
					<p>you are having multiple problems with such a setup. you did not post your openwrt version/revision.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p363741">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">mk24</div>
					<div class="post-datetime">
						15 Aug 2017, 15:52					</div>
				</div>
				<div class="post-content content">
					<p>It appears that the AP you are connecting to does not support 802.11n, it may be g only hardware.&nbsp; That is a situation that may not be well tested.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p363773">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">rmacielalves</div>
					<div class="post-datetime">
						15 Aug 2017, 22:23					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>tapper wrote:</cite><blockquote><p>What about upgrading to LEDE 17.1.2 to see if any changes have bin made to the drivers?</p></blockquote></div><p>Will check about LEDE builds, thanks!</p><div class="quotebox"><cite>anarchy99 wrote:</cite><blockquote><p>you are having multiple problems with such a setup. you did not post your openwrt version/revision.</p></blockquote></div><p>Sorry, I missed that: Chaos Calmer 15.05.1, added to the first post.</p><div class="quotebox"><cite>mk24 wrote:</cite><blockquote><p>It appears that the AP you are connecting to does not support 802.11n, it may be g only hardware.&nbsp; That is a situation that may not be well tested.</p></blockquote></div><p>The AP is routerboard device, set to work with G rates. It&#039;s a not-so-long range link, approx. 70mts from main AP with visibility (only a tree in front). It&#039;s a public wifi offered by my city, which offers nice speeds (6Mbps/6Mbps, measured by speedtest.net) all the time when antenna is plugged on my computer.</p><p>Thank you all for the help!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p365934">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">rmacielalves</div>
					<div class="post-datetime">
						26 Sep 2017, 10:55					</div>
				</div>
				<div class="post-content content">
					<p>Just to let anyone know:</p><p>I got bored and tried to test with latest trunk, unfortunately I couldn&#039;t get to install necessary packages (xsystem: wget: vfork: Out of memory), so I installed LEDE 17.01.2 instead as suggested by @tapper.</p><p>Minor difference, but not what I was expecting.</p><p>With the antenna plugged in into a computer (running Windows Server 2016) I get the maximum speed allowed from this access point:</p><p><span class="postimg"><img src="https://r4to0img.azurewebsites.net/images/2017/09/26/872ca2895ba37844519ad38d9502b2d8.png" alt="https://r4to0img.azurewebsites.net/images/2017/09/26/872ca2895ba37844519ad38d9502b2d8.png" /></span></p><p>Here is the translated information from netsh:</p><div class="codebox"><pre><code>    Name                   : Externo
    Description            : 802.11 USB Wireless LAN Card
    GUID                   : *snip*
    MAC Address       : *snip*
    Status                  : Connected
    SSID                   : *snip
    BSSID                  : *snip*
    Network type           : Infrastructure
    Radio type             : 802.11g
    Encryption         : Open
    Encoding                 : None
    Connection method        : Automatic
    Channel                : 11
    RX Rate (Mbps)    : 54
    TX Rate (Mbps)   : 54
    Signal                 : 90%
    Profile                : *snip*</code></pre></div><p>However if plugged into router instead, and with LEDE now, I get:<br /><span class="postimg"><img src="https://r4to0img.azurewebsites.net/images/2017/09/26/f27ef302293359ba83487f427a787913.png" alt="https://r4to0img.azurewebsites.net/images/2017/09/26/f27ef302293359ba83487f427a787913.png" /></span></p><p>Speed starts at ~4Mbps and slowing down to 1Mbps.</p><p>Now you may ask: <em>Why you don&#039;t keep your computer to route internet with your antenna?</em> Well, power costs and the computer is a bit damaged (chipset needs reballing, keeps corrupting data/downloads and many other issues with its motherboard)</p><p>That&#039;s it! If the latest drivers can&#039;t solve this mystery, I don&#039;t know what can, since it works superb on Windows.</p><br /><p>Thank you all who helped.</p>											<p class="post-edited">(Last edited by <strong>rmacielalves</strong> on 27 Sep 2017, 00:29)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>