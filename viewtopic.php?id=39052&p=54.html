<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> mwan3; multi-wan policy routing (general topic)</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 22 May 2013 and 6 May 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 54 of 65</div><nav><ul><li><a href="viewtopic.php%3Fid=39052&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=52.html">52</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=53.html">53</a></li><li class="pagination-current"><span>54</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=55.html">55</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=56.html">56</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=65.html">65</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p282325">
				<div class="post-metadata">
					<div class="post-num">Post #1326</div>
					<div class="post-author">Vahe91</div>
					<div class="post-datetime">
						3 Jul 2015, 20:21					</div>
				</div>
				<div class="post-content content">
					<p>This is my mwan3 configuration</p><div class="codebox"><pre><code>config rule &#039;default_rule&#039;
    option dest_ip &#039;0.0.0.0/0&#039;
    option use_policy &#039;balanced&#039;

config interface &#039;wan&#039;
    option enabled &#039;1&#039;
    list track_ip &#039;8.8.4.4&#039;
    list track_ip &#039;8.8.8.8&#039;
    list track_ip &#039;208.67.222.222&#039;
    list track_ip &#039;208.67.220.220&#039;
    option reliability &#039;2&#039;
    option count &#039;1&#039;
    option timeout &#039;2&#039;
    option interval &#039;5&#039;
    option down &#039;3&#039;
    option up &#039;8&#039;

config interface &#039;wan2&#039;
    list track_ip &#039;8.8.8.8&#039;
    list track_ip &#039;208.67.220.220&#039;
    option reliability &#039;1&#039;
    option count &#039;1&#039;
    option timeout &#039;2&#039;
    option interval &#039;5&#039;
    option down &#039;3&#039;
    option up &#039;8&#039;
    option enabled &#039;1&#039;

config member &#039;wan_m1_w3&#039;
    option interface &#039;wan&#039;
    option metric &#039;1&#039;
    option weight &#039;3&#039;

config member &#039;wan_m2_w3&#039;
    option interface &#039;wan&#039;
    option metric &#039;2&#039;
    option weight &#039;3&#039;

config member &#039;wan2_m1_w2&#039;
    option interface &#039;wan2&#039;
    option metric &#039;1&#039;
    option weight &#039;2&#039;

config member &#039;wan2_m2_w2&#039;
    option interface &#039;wan2&#039;
    option metric &#039;2&#039;
    option weight &#039;2&#039;

config policy &#039;wan_only&#039;
    list use_member &#039;wan_m1_w3&#039;
    option last_resort &#039;default&#039;

config policy &#039;wan2_only&#039;
    list use_member &#039;wan2_m1_w2&#039;
    option last_resort &#039;default&#039;

config policy &#039;balanced&#039;
    list use_member &#039;wan_m1_w3&#039;
    list use_member &#039;wan2_m1_w2&#039;
    list use_member &#039;wan3g_m2_w4&#039;
    option last_resort &#039;unreachable&#039;

config interface &#039;wan3g&#039;
    option enabled &#039;1&#039;
    list track_ip &#039;8.8.8.8&#039;
    option reliability &#039;1&#039;
    option count &#039;1&#039;
    option timeout &#039;2&#039;
    option interval &#039;5&#039;
    option down &#039;5&#039;
    option up &#039;5&#039;

config member &#039;wan3g_m2_w4&#039;
    option interface &#039;wan3g&#039;
    option metric &#039;3&#039;
    option weight &#039;4&#039;</code></pre></div><p>If wan3g up, then about one in ten of the site does not open. I think when the site does not open, dns don&#039;t resolve the name. If wan3g is down, everything works fine. Wan and wan2 is from same provider, wan3g from other provider. I want to use wan3g as a backup when the wan and wan2 will not be available. Please help solve this problem. </p><p>P.S.<br />Sorry for my english, i will use google translate.</p>											<p class="post-edited">(Last edited by <strong>Vahe91</strong> on 7 Jul 2015, 10:03)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p282332">
				<div class="post-metadata">
					<div class="post-num">Post #1327</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						3 Jul 2015, 20:34					</div>
				</div>
				<div class="post-content content">
					<p>Vahe91 based on that configuration mwan3 isn&#039;t doing anything at all since you have no rules configured.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p282334">
				<div class="post-metadata">
					<div class="post-num">Post #1328</div>
					<div class="post-author">Vahe91</div>
					<div class="post-datetime">
						3 Jul 2015, 20:38					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>arfett wrote:</cite><blockquote><p>Vahe91 based on that configuration mwan3 isn&#039;t doing anything at all since you have no rules configured.</p></blockquote></div><p>I&#039;m sorry, i forgot to add these lines:</p><p>config rule &#039;default_rule&#039;<br />&nbsp; &nbsp; option dest_ip &#039;0.0.0.0/0&#039;<br />&nbsp; &nbsp; option use_policy &#039;balanced&#039;</p>											<p class="post-edited">(Last edited by <strong>Vahe91</strong> on 3 Jul 2015, 20:41)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p282390">
				<div class="post-metadata">
					<div class="post-num">Post #1329</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						4 Jul 2015, 20:16					</div>
				</div>
				<div class="post-content content">
					<p>Vahe91 can you post more troubleshooting information like page 1 of this thread suggests?</p><p>Network config, iptables, etc.</p><p>If you use the LuCI app you can just paste what&#039;s on the troubleshooting page into a code block.</p>											<p class="post-edited">(Last edited by <strong>arfett</strong> on 4 Jul 2015, 20:18)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p282457">
				<div class="post-metadata">
					<div class="post-num">Post #1330</div>
					<div class="post-author">Vahe91</div>
					<div class="post-datetime">
						5 Jul 2015, 20:33					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>arfett wrote:</cite><blockquote><p>Vahe91 can you post more troubleshooting information like page 1 of this thread suggests?</p><p>Network config, iptables, etc.</p><p>If you use the LuCI app you can just paste what&#039;s on the troubleshooting page into a code block.</p></blockquote></div><p>nothing is displayed, only error in log</p><br /><p>Sun Jul&nbsp; 5 21:32:20 2015 daemon.err uhttpd[1161]: /usr/lib/lua/luci/controller/mwan3.lua:229: attempt to index field &#039;version&#039; (a nil value)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p282466">
				<div class="post-metadata">
					<div class="post-num">Post #1331</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						5 Jul 2015, 21:39					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Vahe91 wrote:</cite><blockquote><div class="quotebox"><cite>arfett wrote:</cite><blockquote><p>Vahe91 can you post more troubleshooting information like page 1 of this thread suggests?</p><p>Network config, iptables, etc.</p><p>If you use the LuCI app you can just paste what&#039;s on the troubleshooting page into a code block.</p></blockquote></div><p>nothing is displayed, only error in log</p><br /><p>Sun Jul&nbsp; 5 21:32:20 2015 daemon.err uhttpd[1161]: /usr/lib/lua/luci/controller/mwan3.lua:229: attempt to index field &#039;version&#039; (a nil value)</p></blockquote></div><p>I would like to upload a new version of the LuCI app that fixes another issue in the latest trunk release and also allows the page to still load if OpenWrt doesn&#039;t feel like returning the version properly.</p><p>Can you please try editing your /usr/lib/lua/luci/controller/mwan3.lua lines 229-240 with the below and see if this fixes the error?</p><div class="codebox"><pre><code>    local wrtRelease = luci.version.distversion
        if wrtRelease ~= nil and wrtRelease ~= &quot;&quot; then
            wrtRelease = &quot;OpenWrt - &quot; .. ut.trim(wrtRelease)
        else
            wrtRelease = &quot;OpenWrt - unknown&quot;
        end
    local luciRelease = luci.version.luciversion
        if luciRelease ~= nil and luciRelease ~= &quot;&quot; then
            luciRelease = &quot;\nLuCI - &quot; .. ut.trim(luciRelease)
        else
            luciRelease = &quot;\nLuCI - unknown&quot;
        end</code></pre></div>											<p class="post-edited">(Last edited by <strong>arfett</strong> on 5 Jul 2015, 22:01)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p282527">
				<div class="post-metadata">
					<div class="post-num">Post #1332</div>
					<div class="post-author">Vahe91</div>
					<div class="post-datetime">
						6 Jul 2015, 09:46					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>arfett wrote:</cite><blockquote><p>I would like to upload a new version of the LuCI app that fixes another issue in the latest trunk release and also allows the page to still load if OpenWrt doesn&#039;t feel like returning the version properly.</p><p>Can you please try editing your /usr/lib/lua/luci/controller/mwan3.lua lines 229-240 with the below and see if this fixes the error?</p><div class="codebox"><pre><code>    local wrtRelease = luci.version.distversion
        if wrtRelease ~= nil and wrtRelease ~= &quot;&quot; then
            wrtRelease = &quot;OpenWrt - &quot; .. ut.trim(wrtRelease)
        else
            wrtRelease = &quot;OpenWrt - unknown&quot;
        end
    local luciRelease = luci.version.luciversion
        if luciRelease ~= nil and luciRelease ~= &quot;&quot; then
            luciRelease = &quot;\nLuCI - &quot; .. ut.trim(luciRelease)
        else
            luciRelease = &quot;\nLuCI - unknown&quot;
        end</code></pre></div></blockquote></div><p>Mon Jul&nbsp; 6 10:26:17 2015 daemon.err uhttpd[1161]: /usr/lib/lua/luci/dispatcher.lua:433: Failed to execute call dispatcher target for entry &#039;/admin/network/mwan/advanced/troubleshooting_display&#039;.<br />Mon Jul&nbsp; 6 10:26:17 2015 daemon.err uhttpd[1161]: The called action terminated with an exception:<br />Mon Jul&nbsp; 6 10:26:17 2015 daemon.err uhttpd[1161]: /usr/lib/lua/luci/controller/mwan3.lua:229: attempt to index field &#039;version&#039; (a nil value)<br />Mon Jul&nbsp; 6 10:26:17 2015 daemon.err uhttpd[1161]: stack traceback:<br />Mon Jul&nbsp; 6 10:26:17 2015 daemon.err uhttpd[1161]: &nbsp; &nbsp; [C]: in function &#039;assert&#039;<br />Mon Jul&nbsp; 6 10:26:17 2015 daemon.err uhttpd[1161]: &nbsp; &nbsp; /usr/lib/lua/luci/dispatcher.lua:433: in function &#039;dispatch&#039;<br />Mon Jul&nbsp; 6 10:26:17 2015 daemon.err uhttpd[1161]: &nbsp; &nbsp; /usr/lib/lua/luci/dispatcher.lua:168: in function &lt;/usr/lib/lua/luci/dispatcher.lua:167&gt;</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p282543">
				<div class="post-metadata">
					<div class="post-num">Post #1333</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						6 Jul 2015, 13:54					</div>
				</div>
				<div class="post-content content">
					<p>mwan3-luci (luci-app-mwan3) updated to 1.4-3 with fixes for Chaos Calmer and trunk:</p><p><a href="https://github.com/openwrt/packages/pull/1546">https://github.com/openwrt/packages/pull/1546</a></p><br /><br /><p>Vahe91 if you upgrade your LuCI application to 1.4-3 when the pull request is accepted or manually apply the changes from the pull request on your files then you should be able to view the troubleshooting page and paste all the information to us. Please use a code block on the forum so it doesn&#039;t eat up a whole page with the information.</p>											<p class="post-edited">(Last edited by <strong>arfett</strong> on 6 Jul 2015, 21:38)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p282591">
				<div class="post-metadata">
					<div class="post-num">Post #1334</div>
					<div class="post-author">Vahe91</div>
					<div class="post-datetime">
						6 Jul 2015, 22:38					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>arfett wrote:</cite><blockquote><p>mwan3-luci (luci-app-mwan3) updated to 1.4-3 with fixes for Chaos Calmer and trunk:</p><p><a href="https://github.com/openwrt/packages/pull/1546">https://github.com/openwrt/packages/pull/1546</a></p><br /><br /><p>Vahe91 if you upgrade your LuCI application to 1.4-3 when the pull request is accepted or manually apply the changes from the pull request on your files then you should be able to view the troubleshooting page and paste all the information to us. Please use a code block on the forum so it doesn&#039;t eat up a whole page with the information.</p></blockquote></div><p>How to upgrade ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p282626">
				<div class="post-metadata">
					<div class="post-num">Post #1335</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						7 Jul 2015, 03:24					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Vahe91 wrote:</cite><blockquote><div class="quotebox"><cite>arfett wrote:</cite><blockquote><p>mwan3-luci (luci-app-mwan3) updated to 1.4-3 with fixes for Chaos Calmer and trunk:</p><p><a href="https://github.com/openwrt/packages/pull/1546">https://github.com/openwrt/packages/pull/1546</a></p><br /><br /><p>Vahe91 if you upgrade your LuCI application to 1.4-3 when the pull request is accepted or manually apply the changes from the pull request on your files then you should be able to view the troubleshooting page and paste all the information to us. Please use a code block on the forum so it doesn&#039;t eat up a whole page with the information.</p></blockquote></div><p>How to upgrade ?</p></blockquote></div><p>1. Manually edit the files in the same places as in the pull request<br />2. Reinstall after the pull request has been accepted</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p282647">
				<div class="post-metadata">
					<div class="post-num">Post #1336</div>
					<div class="post-author">Vahe91</div>
					<div class="post-datetime">
						7 Jul 2015, 08:39					</div>
				</div>
				<div class="post-content content">
					<div class="codebox"><pre><code>Software versions : 

OpenWrt - OpenWrt Chaos Calmer 15.05-rc2
LuCI - git-15.146.54948-a497fba

mwan3 - 1.6-1
mwan3-luci - 1.4-2

Output of &quot;cat /etc/config/mwan3&quot; : 

config rule &#039;seasonvar&#039;
    option dest_ip &#039;178.236.136.0/23&#039;
    option proto &#039;all&#039;
    option use_policy &#039;wan_only&#039;

config rule &#039;seasonvar2&#039;
    option dest_ip &#039;146.255.192.0/22&#039;
    option proto &#039;all&#039;
    option use_policy &#039;wan_only&#039;

config rule &#039;seasonvar1&#039;
    option dest_ip &#039;176.58.32.0/24&#039;
    option proto &#039;all&#039;
    option use_policy &#039;wan_only&#039;

config rule &#039;akumb&#039;
    option dest_ip &#039;37.139.24.0/21&#039;
    option proto &#039;all&#039;
    option use_policy &#039;wan_only&#039;

config rule &#039;watchis&#039;
    option dest_ip &#039;5.61.34.63&#039;
    option proto &#039;all&#039;
    option use_policy &#039;wan_only&#039;

config rule &#039;watchis1&#039;
    option dest_ip &#039;178.218.208.0/20&#039;
    option proto &#039;all&#039;
    option use_policy &#039;wan_only&#039;

config rule &#039;filmix&#039;
    option dest_ip &#039;37.48.64.0/18&#039;
    option proto &#039;all&#039;
    option use_policy &#039;wan_only&#039;

config rule &#039;filmix1&#039;
    option dest_ip &#039;109.200.11.224/29&#039;
    option proto &#039;all&#039;
    option use_policy &#039;wan_only&#039;

config rule &#039;filmix2&#039;
    option dest_ip &#039;213.186.127.0/24&#039;
    option proto &#039;all&#039;
    option use_policy &#039;wan_only&#039;

config rule &#039;filmix3&#039;
    option dest_ip &#039; 213.186.126.240/28&#039;
    option proto &#039;all&#039;
    option use_policy &#039;wan_only&#039;

config rule &#039;filmix4&#039;
    option dest_ip &#039;212.113.32.0/21&#039;
    option proto &#039;all&#039;
    option use_policy &#039;wan_only&#039;

config rule &#039;filmix5&#039;
    option dest_ip &#039;213.186.122.0/24&#039;
    option proto &#039;all&#039;
    option use_policy &#039;wan_only&#039;

config rule &#039;onlinefilm&#039;
    option dest_ip &#039;50.7.0.0/16&#039;
    option proto &#039;all&#039;
    option use_policy &#039;wan_only&#039;

config rule &#039;kinobanda2&#039;
    option dest_ip &#039; 173.193.242.254&#039;
    option proto &#039;all&#039;
    option use_policy &#039;wan_only&#039;

config rule &#039;kinobanda6&#039;
    option dest_ip &#039;109.73.68.248/29&#039;
    option proto &#039;all&#039;
    option use_policy &#039;wan_only&#039;

config rule &#039;kinobanda8&#039;
    option dest_ip &#039; 88.150.129.0/29&#039;
    option proto &#039;all&#039;
    option use_policy &#039;wan_only&#039;

config rule &#039;kinobanda9&#039;
    option dest_ip &#039;149.3.131.88/29&#039;
    option proto &#039;all&#039;
    option use_policy &#039;wan_only&#039;

config rule &#039;kinobanda10&#039;
    option dest_ip &#039;173.192.225.175&#039;
    option proto &#039;all&#039;
    option use_policy &#039;wan_only&#039;

config rule &#039;kinobanda11&#039;
    option dest_ip &#039;109.200.21.160/29&#039;
    option proto &#039;all&#039;
    option use_policy &#039;wan_only&#039;

config rule &#039;kinobanda14&#039;
    option dest_ip &#039;173.193.197.52&#039;
    option proto &#039;all&#039;
    option use_policy &#039;wan_only&#039;

config rule &#039;kinobanda15&#039;
    option dest_ip &#039;50.22.223.21&#039;
    option proto &#039;all&#039;
    option use_policy &#039;wan_only&#039;

config rule &#039;kinobanda16&#039;
    option dest_ip &#039;109.200.25.192/29&#039;
    option proto &#039;all&#039;
    option use_policy &#039;wan_only&#039;

config rule &#039;kinobanda17&#039;
    option dest_ip &#039;149.3.134.80/29&#039;
    option proto &#039;all&#039;
    option use_policy &#039;wan_only&#039;

config rule &#039;kinobanda18&#039;
    option dest_ip &#039;109.200.11.208/29&#039;
    option proto &#039;all&#039;
    option use_policy &#039;wan_only&#039;

config rule &#039;kinobanda19&#039;
    option proto &#039;all&#039;
    option use_policy &#039;wan_only&#039;
    option dest_ip &#039; 217.199.213.64/26&#039;

config rule &#039;kinobanda21&#039;
    option dest_ip &#039; 184.173.146.25&#039;
    option proto &#039;all&#039;
    option use_policy &#039;wan_only&#039;

config rule &#039;kinobanda22&#039;
    option dest_ip &#039; 173.192.217.6&#039;
    option proto &#039;all&#039;
    option use_policy &#039;wan_only&#039;

config rule &#039;kinobanda23&#039;
    option dest_ip &#039;5.152.198.0/29&#039;
    option proto &#039;all&#039;
    option use_policy &#039;wan_only&#039;

config rule &#039;kinobanda24&#039;
    option dest_ip &#039;37.220.30.144/29&#039;
    option proto &#039;all&#039;
    option use_policy &#039;wan_only&#039;

config rule &#039;kinobanda25&#039;
    option dest_ip &#039;173.193.202.103&#039;
    option proto &#039;all&#039;
    option use_policy &#039;wan_only&#039;

config rule &#039;kinobanda26&#039;
    option dest_ip &#039; 173.193.214.232&#039;
    option proto &#039;all&#039;
    option use_policy &#039;wan_only&#039;

config rule &#039;kinobanda27&#039;
    option dest_ip &#039;50.22.217.195&#039;
    option proto &#039;all&#039;
    option use_policy &#039;wan_only&#039;

config rule &#039;kinobanda28&#039;
    option dest_ip &#039;208.43.81.144&#039;
    option proto &#039;all&#039;
    option use_policy &#039;wan_only&#039;

config rule &#039;kinobanda29&#039;
    option dest_ip &#039;173.192.224.116&#039;
    option proto &#039;all&#039;
    option use_policy &#039;wan_only&#039;

config rule &#039;kinobanda30&#039;
    option dest_ip &#039;173.193.202.111&#039;
    option proto &#039;all&#039;
    option use_policy &#039;wan_only&#039;

config rule &#039;list&#039;
    option dest_ip &#039;190.93.241.127&#039;
    option proto &#039;all&#039;
    option use_policy &#039;wan_only&#039;

config rule &#039;list1&#039;
    option dest_ip &#039;190.93.242.127&#039;
    option proto &#039;all&#039;
    option use_policy &#039;wan_only&#039;

config rule &#039;list2&#039;
    option dest_ip &#039;190.93.243.127&#039;
    option proto &#039;all&#039;
    option use_policy &#039;wan_only&#039;

config rule &#039;list3&#039;
    option dest_ip &#039;141.101.112.128&#039;
    option proto &#039;all&#039;
    option use_policy &#039;wan_only&#039;

config rule &#039;list4&#039;
    option dest_ip &#039;141.101.113.128&#039;
    option proto &#039;all&#039;
    option use_policy &#039;wan_only&#039;

config rule &#039;2shared&#039;
    option dest_ip &#039;83.222.124.0/22&#039;
    option proto &#039;all&#039;
    option use_policy &#039;wan_only&#039;

config rule &#039;2shared1&#039;
    option dest_ip &#039;204.155.149.58&#039;
    option proto &#039;all&#039;
    option use_policy &#039;wan_only&#039;

config rule &#039;rt&#039;
    option proto &#039;all&#039;
    option use_policy &#039;wan2_only&#039;
    option dest_ip &#039;46.19.98.224/27&#039;

config rule &#039;arca&#039;
    option dest_ip &#039;91.199.226.0/24&#039;
    option proto &#039;all&#039;
    option use_policy &#039;wan_only&#039;

config rule &#039;ucom&#039;
    option proto &#039;all&#039;
    option use_policy &#039;wan_only&#039;
    option dest_ip &#039;46.162.192.84&#039;

config rule &#039;ucom1&#039;
    option dest_ip &#039;46.162.192.85&#039;
    option proto &#039;all&#039;
    option use_policy &#039;wan_only&#039;

config rule &#039;ineco&#039;
    option dest_ip &#039;93.94.222.160/28&#039;
    option proto &#039;all&#039;
    option use_policy &#039;wan_only&#039;

config rule &#039;wot&#039;
    option dest_ip &#039;92.223.18.0/23&#039;
    option proto &#039;all&#039;
    option sticky &#039;0&#039;
    option use_policy &#039;wan_only&#039;

config rule &#039;wot2&#039;
    option dest_ip &#039;92.223.4.0/20&#039;
    option proto &#039;all&#039;
    option sticky &#039;0&#039;
    option use_policy &#039;wan_only&#039;

config rule &#039;wot3&#039;
    option dest_ip &#039;92.223.24.0/22&#039;
    option proto &#039;all&#039;
    option sticky &#039;0&#039;
    option use_policy &#039;wan_only&#039;

config rule &#039;kinogo&#039;
    option dest_ip &#039;193.109.240.0/23&#039;
    option proto &#039;all&#039;
    option sticky &#039;0&#039;
    option use_policy &#039;wan_only&#039;

config rule &#039;kinogo8&#039;
    option dest_ip &#039;104.20.7.84&#039;
    option proto &#039;all&#039;
    option sticky &#039;0&#039;
    option use_policy &#039;wan_only&#039;

config rule &#039;kinogo9&#039;
    option dest_ip &#039;104.20.8.84&#039;
    option proto &#039;all&#039;
    option sticky &#039;0&#039;
    option use_policy &#039;wan_only&#039;

config rule &#039;kinogo10&#039;
    option dest_ip &#039;104.20.9.84&#039;
    option proto &#039;all&#039;
    option sticky &#039;0&#039;
    option use_policy &#039;wan_only&#039;

config rule &#039;kinogo11&#039;
    option dest_ip &#039;104.20.10.84&#039;
    option proto &#039;all&#039;
    option sticky &#039;0&#039;
    option use_policy &#039;wan_only&#039;

config rule &#039;kinogo12&#039;
    option dest_ip &#039;104.20.11.84&#039;
    option proto &#039;all&#039;
    option sticky &#039;0&#039;
    option use_policy &#039;wan_only&#039;

config rule &#039;kinogo13&#039;
    option dest_ip &#039;104.24.121.89&#039;
    option proto &#039;all&#039;
    option sticky &#039;0&#039;
    option use_policy &#039;wan_only&#039;

config rule &#039;kinogo14&#039;
    option dest_ip &#039;104.24.120.89&#039;
    option proto &#039;all&#039;
    option sticky &#039;0&#039;
    option use_policy &#039;wan_only&#039;

config rule &#039;idram&#039;
    option dest_ip &#039;77.72.131.0/24&#039;
    option proto &#039;all&#039;
    option sticky &#039;0&#039;
    option use_policy &#039;wan_only&#039;

config rule &#039;videochart&#039;
    option proto &#039;all&#039;
    option sticky &#039;0&#039;
    option use_policy &#039;wan_only&#039;
    option dest_ip &#039;78.140.183.0/24&#039;

config rule &#039;videochart1&#039;
    option dest_ip &#039;78.140.184.0/24&#039;
    option proto &#039;all&#039;
    option sticky &#039;0&#039;
    option use_policy &#039;wan_only&#039;

config rule &#039;air1&#039;
    option dest_ip &#039; 74.208.63.239&#039;
    option proto &#039;all&#039;
    option sticky &#039;0&#039;
    option use_policy &#039;wan_only&#039;

config rule &#039;air&#039;
    option dest_ip &#039; 193.104.87.0/24&#039;
    option proto &#039;all&#039;
    option sticky &#039;0&#039;
    option use_policy &#039;wan_only&#039;

config rule &#039;autoam&#039;
    option dest_ip &#039; 95.140.196.157&#039;
    option proto &#039;all&#039;
    option sticky &#039;0&#039;
    option use_policy &#039;wan_only&#039;

config rule &#039;default_rule&#039;
    option dest_ip &#039;0.0.0.0/0&#039;
    option use_policy &#039;balanced&#039;

config interface &#039;wan&#039;
    option enabled &#039;1&#039;
    list track_ip &#039;8.8.4.4&#039;
    list track_ip &#039;8.8.8.8&#039;
    list track_ip &#039;208.67.222.222&#039;
    list track_ip &#039;208.67.220.220&#039;
    option reliability &#039;2&#039;
    option count &#039;1&#039;
    option timeout &#039;2&#039;
    option interval &#039;5&#039;
    option down &#039;3&#039;
    option up &#039;8&#039;

config interface &#039;wan2&#039;
    list track_ip &#039;8.8.8.8&#039;
    list track_ip &#039;208.67.220.220&#039;
    option reliability &#039;1&#039;
    option count &#039;1&#039;
    option timeout &#039;2&#039;
    option interval &#039;5&#039;
    option down &#039;3&#039;
    option up &#039;8&#039;
    option enabled &#039;1&#039;

config member &#039;wan_m1_w3&#039;
    option interface &#039;wan&#039;
    option metric &#039;1&#039;
    option weight &#039;3&#039;

config member &#039;wan_m2_w3&#039;
    option interface &#039;wan&#039;
    option metric &#039;2&#039;
    option weight &#039;3&#039;

config member &#039;wan2_m1_w2&#039;
    option interface &#039;wan2&#039;
    option metric &#039;1&#039;
    option weight &#039;2&#039;

config member &#039;wan2_m2_w2&#039;
    option interface &#039;wan2&#039;
    option metric &#039;2&#039;
    option weight &#039;2&#039;

config policy &#039;wan_only&#039;
    list use_member &#039;wan_m1_w3&#039;
    option last_resort &#039;default&#039;

config policy &#039;wan2_only&#039;
    list use_member &#039;wan2_m1_w2&#039;
    option last_resort &#039;default&#039;

config policy &#039;balanced&#039;
    list use_member &#039;wan_m1_w3&#039;
    list use_member &#039;wan2_m1_w2&#039;
    list use_member &#039;wan3g_m2_w4&#039;
    option last_resort &#039;unreachable&#039;

config interface &#039;wan3g&#039;
    option enabled &#039;1&#039;
    list track_ip &#039;8.8.8.8&#039;
    option reliability &#039;1&#039;
    option count &#039;1&#039;
    option timeout &#039;2&#039;
    option interval &#039;5&#039;
    option down &#039;5&#039;
    option up &#039;5&#039;

config member &#039;wan3g_m2_w4&#039;
    option interface &#039;wan3g&#039;
    option metric &#039;3&#039;
    option weight &#039;4&#039;

Output of &quot;cat /etc/config/network&quot; : 

config interface &#039;loopback&#039;
    option ifname &#039;lo&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;127.0.0.1&#039;
    option netmask &#039;255.0.0.0&#039;

config globals &#039;globals&#039;

config interface &#039;lan&#039;
    option ifname &#039;eth1&#039;
    option force_link &#039;1&#039;
    option type &#039;bridge&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;192.168.1.1&#039;
    option netmask &#039;255.255.255.0&#039;
    option delegate &#039;0&#039;
    option igmp_snooping &#039;0&#039;

config interface &#039;wan&#039;
    option proto &#039;dhcp&#039;
    option _orig_ifname &#039;eth0&#039;
    option _orig_bridge &#039;false&#039;
    option ifname &#039;eth0.2&#039;
    option metric &#039;10&#039;
    option macaddr &#039;5E:DF:40:6C:59:C2&#039;

config switch
    option name &#039;switch0&#039;
    option reset &#039;1&#039;
    option enable_vlan &#039;1&#039;
    option mirror_source_port &#039;0&#039;
    option mirror_monitor_port &#039;0&#039;

config switch_vlan
    option device &#039;switch0&#039;
    option vlan &#039;1&#039;
    option vid &#039;1&#039;
    option ports &#039;0 2 3 4&#039;

config switch_vlan
    option device &#039;switch0&#039;
    option vlan &#039;2&#039;
    option vid &#039;2&#039;
    option ports &#039;5 6t&#039;

config switch_vlan
    option device &#039;switch0&#039;
    option vlan &#039;3&#039;
    option vid &#039;3&#039;
    option ports &#039;1 6t&#039;

config interface &#039;wan2&#039;
    option proto &#039;dhcp&#039;
    option ifname &#039;eth0.3&#039;
    option metric &#039;20&#039;
    option macaddr &#039;4A:E3:07:02:42:0A&#039;

config interface &#039;wan3g&#039;
    option proto &#039;3g&#039;
    option delegate &#039;0&#039;
    option service &#039;umts_only&#039;
    option apn &#039;internet&#039;
    option pincode &#039;1111&#039;
    option dialnumber &#039;*99***1#&#039;
    option device &#039;/dev/ttyUSB2&#039;
    option metric &#039;30&#039;

Output of &quot;ifconfig&quot; : 

3g-wan3g  Link encap:Point-to-Point Protocol  
          inet addr:5.77.232.28  P-t-P:10.64.64.64  Mask:255.255.255.255
          UP POINTOPOINT RUNNING NOARP MULTICAST  MTU:1500  Metric:1
          RX packets:66 errors:0 dropped:0 overruns:0 frame:0
          TX packets:76 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:3 
          RX bytes:2012 (1.9 KiB)  TX bytes:2176 (2.1 KiB)

br-lan    Link encap:Ethernet  HWaddr E8:94:F6:69:07:CA  
          inet addr:192.168.1.1  Bcast:192.168.1.255  Mask:255.255.255.0
          inet6 addr: fe80::ea94:f6ff:fe69:7ca/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:3683 errors:0 dropped:0 overruns:0 frame:0
          TX packets:4788 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:479598 (468.3 KiB)  TX bytes:2791448 (2.6 MiB)

eth0      Link encap:Ethernet  HWaddr E8:94:F6:69:07:CB  
          inet6 addr: fe80::ea94:f6ff:fe69:7cb/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:2620 errors:0 dropped:0 overruns:0 frame:0
          TX packets:2730 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:936013 (914.0 KiB)  TX bytes:396002 (386.7 KiB)
          Interrupt:4 

eth0.2    Link encap:Ethernet  HWaddr 5E:DF:40:6C:59:C2  
          inet addr:46.162.216.55  Bcast:46.162.219.255  Mask:255.255.252.0
          inet6 addr: fe80::5cdf:40ff:fe6c:59c2/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:2093 errors:0 dropped:0 overruns:0 frame:0
          TX packets:2154 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:788481 (770.0 KiB)  TX bytes:293947 (287.0 KiB)

eth0.3    Link encap:Ethernet  HWaddr 4A:E3:07:02:42:0A  
          inet addr:46.162.216.53  Bcast:46.162.219.255  Mask:255.255.252.0
          inet6 addr: fe80::48e3:7ff:fe02:420a/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:527 errors:0 dropped:0 overruns:0 frame:0
          TX packets:568 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:100372 (98.0 KiB)  TX bytes:90279 (88.1 KiB)

eth1      Link encap:Ethernet  HWaddr E8:94:F6:69:07:CA  
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:3719 errors:0 dropped:3 overruns:0 frame:0
          TX packets:4797 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:536211 (523.6 KiB)  TX bytes:2793235 (2.6 MiB)
          Interrupt:5 

lo        Link encap:Local Loopback  
          inet addr:127.0.0.1  Mask:255.0.0.0
          inet6 addr: ::1/128 Scope:Host
          UP LOOPBACK RUNNING  MTU:65536  Metric:1
          RX packets:106 errors:0 dropped:0 overruns:0 frame:0
          TX packets:106 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:8235 (8.0 KiB)  TX bytes:8235 (8.0 KiB)

Output of &quot;route -n&quot; : 

Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
0.0.0.0         46.162.216.1    0.0.0.0         UG    10     0        0 eth0.2
0.0.0.0         46.162.216.1    0.0.0.0         UG    20     0        0 eth0.3
0.0.0.0         10.64.64.64     0.0.0.0         UG    30     0        0 3g-wan3g
10.64.64.64     0.0.0.0         255.255.255.255 UH    0      0        0 3g-wan3g
46.162.216.0    0.0.0.0         255.255.252.0   U     10     0        0 eth0.2
46.162.216.0    0.0.0.0         255.255.252.0   U     20     0        0 eth0.3
46.162.216.1    0.0.0.0         255.255.255.255 UH    10     0        0 eth0.2
46.162.216.1    0.0.0.0         255.255.255.255 UH    20     0        0 eth0.3
192.168.1.0     0.0.0.0         255.255.255.0   U     0      0        0 br-lan

Output of &quot;ip rule show&quot; : 

0:    from all lookup 128 
1:    from all lookup local 
1001:    from all iif eth0.2 lookup main 
1002:    from all iif eth0.3 lookup main 
1003:    from all iif 3g-wan3g lookup main 
2001:    from all fwmark 0x100/0xff00 lookup 1 
2002:    from all fwmark 0x200/0xff00 lookup 2 
2003:    from all fwmark 0x300/0xff00 lookup 3 
2253:    from all fwmark 0xfd00/0xff00 blackhole
2254:    from all fwmark 0xfe00/0xff00 unreachable
32766:    from all lookup main 
32767:    from all lookup default

Output of &quot;ip route list table 1-250&quot; : 

1
default via 46.162.216.1 dev eth0.2 
2
default via 46.162.216.1 dev eth0.3 
3
default via 10.64.64.64 dev 3g-wan3g

Firewall default output policy (must be ACCEPT) : 

ACCEPT

Output of &quot;iptables -L -t mangle -v -n&quot; : 

Chain PREROUTING (policy ACCEPT 318 packets, 21429 bytes)
 pkts bytes target     prot opt in     out     source               destination         
  448 32965 mwan3_hook  all  --  *      *       0.0.0.0/0            0.0.0.0/0           
  318 21429 fwmark     all  --  *      *       0.0.0.0/0            0.0.0.0/0           

Chain INPUT (policy ACCEPT 277 packets, 15451 bytes)
 pkts bytes target     prot opt in     out     source               destination         

Chain FORWARD (policy ACCEPT 41 packets, 5978 bytes)
 pkts bytes target     prot opt in     out     source               destination         
   41  5978 mssfix     all  --  *      *       0.0.0.0/0            0.0.0.0/0           

Chain OUTPUT (policy ACCEPT 419 packets, 182K bytes)
 pkts bytes target     prot opt in     out     source               destination         
  591  292K mwan3_hook  all  --  *      *       0.0.0.0/0            0.0.0.0/0           

Chain POSTROUTING (policy ACCEPT 460 packets, 188K bytes)
 pkts bytes target     prot opt in     out     source               destination         

Chain fwmark (1 references)
 pkts bytes target     prot opt in     out     source               destination         

Chain mssfix (1 references)
 pkts bytes target     prot opt in     out     source               destination         
    0     0 TCPMSS     tcp  --  *      eth0.2  0.0.0.0/0            0.0.0.0/0            tcp flags:0x06/0x02 /* wan (mtu_fix) */ TCPMSS clamp to PMTU
    0     0 TCPMSS     tcp  --  *      eth0.3  0.0.0.0/0            0.0.0.0/0            tcp flags:0x06/0x02 /* wan2 (mtu_fix) */ TCPMSS clamp to PMTU
    0     0 TCPMSS     tcp  --  *      3g-wan3g  0.0.0.0/0            0.0.0.0/0            tcp flags:0x06/0x02 /* wan3g (mtu_fix) */ TCPMSS clamp to PMTU

Chain mwan3_connected (2 references)
 pkts bytes target     prot opt in     out     source               destination         
   39  6169 MARK       all  --  *      *       0.0.0.0/0            0.0.0.0/0            match-set mwan3_connected dst MARK or 0xff00

Chain mwan3_hook (2 references)
 pkts bytes target     prot opt in     out     source               destination         
 1039  325K CONNMARK   all  --  *      *       0.0.0.0/0            0.0.0.0/0            CONNMARK restore mask 0xff00
  171  7175 mwan3_ifaces  all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00
  157  6165 mwan3_connected  all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00
  152  5679 mwan3_track  all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00
   24  1583 mwan3_rules  all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00
 1039  325K CONNMARK   all  --  *      *       0.0.0.0/0            0.0.0.0/0            CONNMARK save mask 0xff00
   90  9433 mwan3_connected  all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match ! 0xff00/0xff00

Chain mwan3_iface_wan (1 references)
 pkts bytes target     prot opt in     out     source               destination         
    0     0 MARK       all  --  eth0.2 *       0.0.0.0/0            0.0.0.0/0            match-set mwan3_connected src mark match 0x0/0xff00 /* default */ MARK or 0xff00
   11   833 MARK       all  --  eth0.2 *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00 /* wan */ MARK xset 0x100/0xff00

Chain mwan3_iface_wan2 (1 references)
 pkts bytes target     prot opt in     out     source               destination         
    0     0 MARK       all  --  eth0.3 *       0.0.0.0/0            0.0.0.0/0            match-set mwan3_connected src mark match 0x0/0xff00 /* default */ MARK or 0xff00
    3   177 MARK       all  --  eth0.3 *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00 /* wan2 */ MARK xset 0x200/0xff00

Chain mwan3_iface_wan3g (1 references)
 pkts bytes target     prot opt in     out     source               destination         
    0     0 MARK       all  --  3g-wan3g *       0.0.0.0/0            0.0.0.0/0            match-set mwan3_connected src mark match 0x0/0xff00 /* default */ MARK or 0xff00
    0     0 MARK       all  --  3g-wan3g *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00 /* wan3g */ MARK xset 0x300/0xff00

Chain mwan3_ifaces (1 references)
 pkts bytes target     prot opt in     out     source               destination         
  170  7135 mwan3_iface_wan  all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00
  138  5269 mwan3_iface_wan2  all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00
  123  4535 mwan3_iface_wan3g  all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00

Chain mwan3_policy_balanced (1 references)
 pkts bytes target     prot opt in     out     source               destination         
    3   295 MARK       all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00 statistic mode random probability 0.39999999991 /* wan2 2 5 */ MARK xset 0x200/0xff00
    4   304 MARK       all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00 /* wan 3 3 */ MARK xset 0x100/0xff00

Chain mwan3_policy_wan2_only (1 references)
 pkts bytes target     prot opt in     out     source               destination         
    0     0 MARK       all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00 /* wan2 2 2 */ MARK xset 0x200/0xff00

Chain mwan3_policy_wan_only (63 references)
 pkts bytes target     prot opt in     out     source               destination         
    0     0 MARK       all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00 /* wan 3 3 */ MARK xset 0x100/0xff00

Chain mwan3_rules (1 references)
 pkts bytes target     prot opt in     out     source               destination         
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            178.236.136.0/23     mark match 0x0/0xff00 /* seasonvar */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            146.255.192.0/22     mark match 0x0/0xff00 /* seasonvar2 */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            176.58.32.0/24       mark match 0x0/0xff00 /* seasonvar1 */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            37.139.24.0/21       mark match 0x0/0xff00 /* akumb */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            5.61.34.63           mark match 0x0/0xff00 /* watchis */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            178.218.208.0/20     mark match 0x0/0xff00 /* watchis1 */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            37.48.64.0/18        mark match 0x0/0xff00 /* filmix */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            109.200.11.224/29    mark match 0x0/0xff00 /* filmix1 */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            213.186.127.0/24     mark match 0x0/0xff00 /* filmix2 */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            213.186.126.240/28   mark match 0x0/0xff00 /* filmix3 */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            212.113.32.0/21      mark match 0x0/0xff00 /* filmix4 */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            213.186.122.0/24     mark match 0x0/0xff00 /* filmix5 */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            50.7.0.0/16          mark match 0x0/0xff00 /* onlinefilm */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            173.193.242.254      mark match 0x0/0xff00 /* kinobanda2 */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            109.73.68.248/29     mark match 0x0/0xff00 /* kinobanda6 */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            88.150.129.0/29      mark match 0x0/0xff00 /* kinobanda8 */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            149.3.131.88/29      mark match 0x0/0xff00 /* kinobanda9 */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            173.192.225.175      mark match 0x0/0xff00 /* kinobanda10 */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            109.200.21.160/29    mark match 0x0/0xff00 /* kinobanda11 */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            173.193.197.52       mark match 0x0/0xff00 /* kinobanda14 */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            50.22.223.21         mark match 0x0/0xff00 /* kinobanda15 */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            109.200.25.192/29    mark match 0x0/0xff00 /* kinobanda16 */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            149.3.134.80/29      mark match 0x0/0xff00 /* kinobanda17 */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            109.200.11.208/29    mark match 0x0/0xff00 /* kinobanda18 */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            217.199.213.64/26    mark match 0x0/0xff00 /* kinobanda19 */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            184.173.146.25       mark match 0x0/0xff00 /* kinobanda21 */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            173.192.217.6        mark match 0x0/0xff00 /* kinobanda22 */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            5.152.198.0/29       mark match 0x0/0xff00 /* kinobanda23 */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            37.220.30.144/29     mark match 0x0/0xff00 /* kinobanda24 */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            173.193.202.103      mark match 0x0/0xff00 /* kinobanda25 */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            173.193.214.232      mark match 0x0/0xff00 /* kinobanda26 */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            50.22.217.195        mark match 0x0/0xff00 /* kinobanda27 */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            208.43.81.144        mark match 0x0/0xff00 /* kinobanda28 */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            173.192.224.116      mark match 0x0/0xff00 /* kinobanda29 */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            173.193.202.111      mark match 0x0/0xff00 /* kinobanda30 */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            190.93.241.127       mark match 0x0/0xff00 /* list */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            190.93.242.127       mark match 0x0/0xff00 /* list1 */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            190.93.243.127       mark match 0x0/0xff00 /* list2 */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            141.101.112.128      mark match 0x0/0xff00 /* list3 */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            141.101.113.128      mark match 0x0/0xff00 /* list4 */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            83.222.124.0/22      mark match 0x0/0xff00 /* 2shared */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            204.155.149.58       mark match 0x0/0xff00 /* 2shared1 */
    0     0 mwan3_policy_wan2_only  all  --  *      *       0.0.0.0/0            46.19.98.224/27      mark match 0x0/0xff00 /* rt */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            91.199.226.0/24      mark match 0x0/0xff00 /* arca */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            46.162.192.84        mark match 0x0/0xff00 /* ucom */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            46.162.192.85        mark match 0x0/0xff00 /* ucom1 */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            93.94.222.160/28     mark match 0x0/0xff00 /* ineco */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            92.223.18.0/23       mark match 0x0/0xff00 /* wot */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            92.223.0.0/20        mark match 0x0/0xff00 /* wot2 */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            92.223.24.0/22       mark match 0x0/0xff00 /* wot3 */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            193.109.240.0/23     mark match 0x0/0xff00 /* kinogo */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            104.20.7.84          mark match 0x0/0xff00 /* kinogo8 */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            104.20.8.84          mark match 0x0/0xff00 /* kinogo9 */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            104.20.9.84          mark match 0x0/0xff00 /* kinogo10 */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            104.20.10.84         mark match 0x0/0xff00 /* kinogo11 */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            104.20.11.84         mark match 0x0/0xff00 /* kinogo12 */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            104.24.121.89        mark match 0x0/0xff00 /* kinogo13 */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            104.24.120.89        mark match 0x0/0xff00 /* kinogo14 */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            77.72.131.0/24       mark match 0x0/0xff00 /* idram */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            78.140.183.0/24      mark match 0x0/0xff00 /* videochart */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            78.140.184.0/24      mark match 0x0/0xff00 /* videochart1 */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            74.208.63.239        mark match 0x0/0xff00 /* air1 */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            193.104.87.0/24      mark match 0x0/0xff00 /* air */
    0     0 mwan3_policy_wan_only  all  --  *      *       0.0.0.0/0            95.140.196.157       mark match 0x0/0xff00 /* autoam */
    7   599 mwan3_policy_balanced  all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00 /* default_rule */

Chain mwan3_track (1 references)
 pkts bytes target     prot opt in     out     source               destination         
  128  4096 MARK       icmp --  *      *       0.0.0.0/0            0.0.0.0/0            match-set mwan3_track_wan dst icmptype 8 length 32 MARK or 0xff00
   86  2752 MARK       icmp --  *      *       0.0.0.0/0            0.0.0.0/0            match-set mwan3_track_wan2 dst icmptype 8 length 32 MARK or 0xff00
   49  1568 MARK       icmp --  *      *       0.0.0.0/0            0.0.0.0/0            match-set mwan3_track_wan3g dst icmptype 8 length 32 MARK or 0xff00</code></pre></div>											<p class="post-edited">(Last edited by <strong>Vahe91</strong> on 7 Jul 2015, 10:02)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p282685">
				<div class="post-metadata">
					<div class="post-num">Post #1337</div>
					<div class="post-author">Jusic</div>
					<div class="post-datetime">
						7 Jul 2015, 20:14					</div>
				</div>
				<div class="post-content content">
					<p>What are the differences, benefits or disadvantages between the multiwan package and the mwan3 package? I can&#039;t find a single word about that...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p283195">
				<div class="post-metadata">
					<div class="post-num">Post #1338</div>
					<div class="post-author">axishero</div>
					<div class="post-datetime">
						12 Jul 2015, 11:08					</div>
				</div>
				<div class="post-content content">
					<p><strong>I have two interface,wan and wwan.I don&#039;t want wan have access to 80 and 443 port.How to set?</strong></p>											<p class="post-edited">(Last edited by <strong>axishero</strong> on 12 Jul 2015, 11:08)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p283461">
				<div class="post-metadata">
					<div class="post-num">Post #1339</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						14 Jul 2015, 03:12					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>axishero wrote:</cite><blockquote><p><strong>I have two interface,wan and wwan.I don&#039;t want wan have access to 80 and 443 port.How to set?</strong></p></blockquote></div><p>I would imagine the standard OpenWrt firewall traffic rules is what you need.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p283524">
				<div class="post-metadata">
					<div class="post-num">Post #1340</div>
					<div class="post-author">axishero</div>
					<div class="post-datetime">
						14 Jul 2015, 19:47					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>arfett wrote:</cite><blockquote><div class="quotebox"><cite>axishero wrote:</cite><blockquote><p><strong>I have two interface,wan and wwan.I don&#039;t want wan have access to 80 and 443 port.How to set?</strong></p></blockquote></div><p>I would imagine the standard OpenWrt firewall traffic rules is what you need.</p></blockquote></div><p>Please give example</p>											<p class="post-edited">(Last edited by <strong>axishero</strong> on 14 Jul 2015, 19:47)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p285041">
				<div class="post-metadata">
					<div class="post-num">Post #1341</div>
					<div class="post-author">dir2cas</div>
					<div class="post-datetime">
						26 Jul 2015, 19:27					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>dir2cas wrote:</cite><blockquote><div class="quotebox"><cite>Adze wrote:</cite><blockquote><div class="quotebox"><cite>dir2cas wrote:</cite><blockquote><p>In fact after this correction, I do not see drops on the operational wan2, but the wan1 tracking (that is interrupted) works correctly only for the wan1&#039;s gateway. The other target hosts do not get detected.</p></blockquote></div><p>Can you confirm with tcpdump that the ping requests do leave the correct interface?</p></blockquote></div><p>All the tests done so far are pointing to the same problem.</p><p>Here is the latest one, that proves it. If you want tcpdump tests, I will have to check it doing some port mirroring on the switch, because this is e test router that has no tcpdump installed and has no free space because of the custom image that is full with different stiff. I hope that iftop is enough.</p><p>1) Switch port facing ISP1 (wan1) disabled<br /></p><div class="codebox"><pre><code>sw1#conf t
Enter configuration commands, one per line.  End with CNTL/Z.
sw1(config)#int fa 0/1
sw1(config-if)#shu
sw1(config-if)#shutdown
sw1(config-if)#
sw1(config-if)#^Z
sw1#sh int desc | i WAN
Fa0/1                          admin down     down     WAN1_/24Mbps/
Fa0/2                          up             up       WAN2_/45Mbps/</code></pre></div><p>2) Ping test using the same parameters like mwan3track (I restored the initial code). Here I used one of the host targets that is tracked only via wan1.<br />The purpose is that we would like the ping to be treated by mwan3 the same way as it is done by the real tracking tool (mwan3track). You can see that ping is successful, despite the wan1 link is interrupted.</p><div class="codebox"><pre><code>[root@RTR-TEST:~]# $(which ping) -c 5 -W 1 -s 4 -I eth0.2 212.73.140.119
PING 212.73.140.119 (212.73.140.119) from 46.40.125.XX eth0.2: 4(32) bytes of data.
12 bytes from 212.73.140.119: icmp_req=1 ttl=59
12 bytes from 212.73.140.119: icmp_req=2 ttl=59
12 bytes from 212.73.140.119: icmp_req=3 ttl=59
12 bytes from 212.73.140.119: icmp_req=4 ttl=59
12 bytes from 212.73.140.119: icmp_req=5 ttl=59

--- 212.73.140.119 ping statistics ---
5 packets transmitted, 5 received, 0% packet loss, time 4005ms

[root@RTR-TEST:~]# $(which ping) -c 5 -W 1 -s 4 -I eth0.2 212.73.140.119
PING 212.73.140.119 (212.73.140.119) from 46.40.125.XX eth0.2: 4(32) bytes of data.
12 bytes from 212.73.140.119: icmp_req=1 ttl=59
12 bytes from 212.73.140.119: icmp_req=2 ttl=59
12 bytes from 212.73.140.119: icmp_req=3 ttl=59
12 bytes from 212.73.140.119: icmp_req=4 ttl=59
12 bytes from 212.73.140.119: icmp_req=5 ttl=59

--- 212.73.140.119 ping statistics ---
5 packets transmitted, 5 received, 0% packet loss, time 4006ms</code></pre></div><div class="codebox"><pre><code>[root@RTR-TEST:~]# cat /etc/config/mwan3 | head -n 29

config interface &#039;wan1&#039;
        option enabled &#039;1&#039;
        list track_ip &#039;46.40.125.1&#039;
        list track_ip &#039;212.73.140.119&#039;
        list track_ip &#039;8.8.8.8&#039;
        list track_ip &#039;208.67.222.222&#039;
        list track_ip &#039;208.67.220.220&#039;
        option reliability &#039;3&#039;
        option count &#039;5&#039;
        option timeout &#039;2&#039;
        option interval &#039;20&#039;
        option down &#039;1&#039;
        option up &#039;3&#039;

config interface &#039;wan2&#039;
        option enabled &#039;1&#039;
        list track_ip &#039;46.249.80.1&#039;
        list track_ip &#039;87.120.130.66&#039;
        list track_ip &#039;8.8.8.8&#039;
        list track_ip &#039;208.67.222.222&#039;
        list track_ip &#039;208.67.220.220&#039;
        option reliability &#039;3&#039;
        option count &#039;5&#039;
        option timeout &#039;2&#039;
        option interval &#039;20&#039;
        option down &#039;1&#039;
        option up &#039;3&#039;</code></pre></div><p>3) Iftop verifies that no traffic is passing via wan1(eth0.2) / ISP1 link, which should be correct<br /></p><div class="codebox"><pre><code>[root@RTR-TEST:~]# iftop -n -P -f &quot;icmp&quot; -i eth0.2

                           12.5kb                      25.0kb                     37.5kb                      50.0kb                62.5kb
└──────────────────────────┴───────────────────────────┴──────────────────────────┴───────────────────────────┴───────────────────────────</code></pre></div><p>4) However the ping towards 212.73.140.119 is seen on wan2 (eth0.3). As seen above 212.73.140.119 is not part of the wan2 target hosts eligible for tracking.<br /></p><div class="codebox"><pre><code>[root@RTR-TEST:~]# iftop -n -P -f &quot;icmp&quot; -i eth0.3

                           12.5kb                      25.0kb                     37.5kb                      50.0kb                62.5kb
└──────────────────────────┴───────────────────────────┴──────────────────────────┴───────────────────────────┴───────────────────────────
46.249.80.XX                                            =&gt; 212.73.140.119                                           384b    256b    185b
                                                        &lt;=                                                          384b    256b    185b
46.249.80.XX                                            =&gt; 8.8.8.8                                                    0b    128b     71b
                                                        &lt;=                                                            0b    128b     71b
46.249.80.XX                                            =&gt; 192.58.128.30                                              0b    115b     64b
                                                        &lt;=                                                            0b    115b     64b
46.249.80.XX                                            =&gt; 208.67.222.222                                             0b    102b     71b
                                                        &lt;=                                                            0b    102b     57b</code></pre></div><p>5) The log - mwan3 detects the fault only towards wan1&#039;s gateway, but not to the other trackable targets.<br /></p><div class="codebox"><pre><code>May 13 11:37:46 sw1 2066: May 13 11:37:45 EEST: %LINK-5-CHANGED: Interface FastEthernet0/1, changed state to administratively down
May 13 11:37:46 sw1 2067: May 13 11:37:46 EEST: %LINEPROTO-5-UPDOWN: Line protocol on Interface FastEthernet0/1, changed state to down
May 13 11:37:46 RTR-TEST mwan3track: Tracked host issue detected on Interface wan1 (eth0.2): 46.40.125.1 -&gt; 60% packet loss
May 13 11:38:31 RTR-TEST mwan3track: Tracked host issue detected on Interface wan1 (eth0.2): 46.40.125.1 -&gt; 100% packet loss
May 13 11:39:14 RTR-TEST mwan3track: Tracked host issue detected on Interface wan1 (eth0.2): 46.40.125.1 -&gt; 100% packet loss
May 13 11:39:56 RTR-TEST mwan3track: Tracked host issue detected on Interface wan1 (eth0.2): 46.40.125.1 -&gt; 100% packet loss
May 13 11:40:42 RTR-TEST mwan3track: Tracked host issue detected on Interface wan1 (eth0.2): 46.40.125.1 -&gt; 100% packet loss
May 13 11:41:25 RTR-TEST mwan3track: Tracked host issue detected on Interface wan1 (eth0.2): 46.40.125.1 -&gt; 100% packet loss
May 13 11:41:31 sw1 2068: May 13 11:41:30 EEST: %SYS-5-CONFIG_I: Configured from console by dir2cas on vty0 (10.0.20.200)
May 13 11:42:05 RTR-TEST mwan3track: Tracked host issue detected on Interface wan1 (eth0.2): 46.40.125.1 -&gt; 100% packet loss
May 13 11:42:48 RTR-TEST mwan3track: Tracked host issue detected on Interface wan1 (eth0.2): 46.40.125.1 -&gt; 100% packet loss
May 13 11:43:33 RTR-TEST mwan3track: Tracked host issue detected on Interface wan1 (eth0.2): 46.40.125.1 -&gt; 100% packet loss
May 13 11:44:18 RTR-TEST mwan3track: Tracked host issue detected on Interface wan1 (eth0.2): 46.40.125.1 -&gt; 100% packet loss
May 13 11:44:59 RTR-TEST mwan3track: Tracked host issue detected on Interface wan1 (eth0.2): 46.40.125.1 -&gt; 100% packet loss
May 13 11:45:42 RTR-TEST mwan3track: Tracked host issue detected on Interface wan1 (eth0.2): 46.40.125.1 -&gt; 100% packet loss
May 13 11:45:44 sw1 2069: May 13 11:45:43 EEST: %SYS-5-CONFIG_I: Configured from console by dir2cas on vty0 (10.0.20.200)
May 13 11:45:46 sw1 2070: May 13 11:45:45 EEST: %LINK-3-UPDOWN: Interface FastEthernet0/1, changed state to up
May 13 11:45:46 sw1 2071: May 13 11:45:46 EEST: %LINEPROTO-5-UPDOWN: Line protocol on Interface FastEthernet0/1, changed state to up</code></pre></div></blockquote></div><p>Hi Adze, arfett,</p><p>This weekend I finally got some spare time to occupy with the problem again and carry out several experiments. I built another image in which I left the busybox ping applet untouched. Just in case I added mwan3 separately (not include it in the image) and installed the git version directly (currently 1.4...), but seems that my problem has nothing common with the package version.</p><p>Tested my configuration and works ok.<br />Once I remove the symlink to the ping command pointing to busybox (because I want to have available the iputils-ping), the issue observed previously started to be observed again. </p><p>So, I altered /usr/sbin/mwan3track, changing the line:</p><p>ping -I $2 -c $4 -W $5 -s 4 -q $track_ip &amp;&gt; /dev/null</p><p>to </p><p>/bin/busybox ping -I $2 -c $4 -W $5 -s 4 -q $track_ip &amp;&gt; /dev/null</p><p>and mwan3 works again as expected.</p><p>I am still confused, why the iputils-ping does not work correctly with mwan3, probably it is related with an issue with the socket allocation, but probably needs some more thorough testing. I would like to ask you to try to add its support since it will make mwan3 more than an openwrt compatible instrument and add the possibility for more ping options. I would be happy to help if I can and have the time.</p><p>If no, probably it is better to commit the same change as mine in the source for now.</p>											<p class="post-edited">(Last edited by <strong>dir2cas</strong> on 26 Jul 2015, 19:33)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p285411">
				<div class="post-metadata">
					<div class="post-num">Post #1342</div>
					<div class="post-author">suriefkasev</div>
					<div class="post-datetime">
						29 Jul 2015, 07:29					</div>
				</div>
				<div class="post-content content">
					<p>Hi Adze, affret<br />may I ask you again <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /><br />I have 3 wan connection<br />1. cis --&gt; pppoe<br />2. speedy --&gt; pppoe<br />3. gsm --&gt; umts 3g<br />they have failover for internet connection through &quot;speedy&quot; to &quot;gsm&quot; thanks for your incredible works<br />and also I have 1 tunnel openvpn, the tunnel openvpn use 1 of my 3 wan, it connect through &quot;cis&quot; and with script that affret wrote it can restarted automatically when interface down and it reconnected through &quot;speedy&quot; or &quot;gsm&quot;<br />for now I want to add one or more tunnel openvpn trough each interface, because I prefer don&#039;t want &quot;restart&quot; or &quot;reconnect&quot; openvpn, if one of my interface and tunnel openvpn down, I have other tunnel openvpn connection up.<br />is possible for mwan3 to failover traffic openvpn tunnel to other tunnel?<br />Thanks before</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p285538">
				<div class="post-metadata">
					<div class="post-num">Post #1343</div>
					<div class="post-author">Vahe91</div>
					<div class="post-datetime">
						29 Jul 2015, 23:06					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Vahe91 wrote:</cite><blockquote><p>This is my mwan3 configuration</p><div class="codebox"><pre><code>config rule &#039;default_rule&#039;
    option dest_ip &#039;0.0.0.0/0&#039;
    option use_policy &#039;balanced&#039;

config interface &#039;wan&#039;
    option enabled &#039;1&#039;
    list track_ip &#039;8.8.4.4&#039;
    list track_ip &#039;8.8.8.8&#039;
    list track_ip &#039;208.67.222.222&#039;
    list track_ip &#039;208.67.220.220&#039;
    option reliability &#039;2&#039;
    option count &#039;1&#039;
    option timeout &#039;2&#039;
    option interval &#039;5&#039;
    option down &#039;3&#039;
    option up &#039;8&#039;

config interface &#039;wan2&#039;
    list track_ip &#039;8.8.8.8&#039;
    list track_ip &#039;208.67.220.220&#039;
    option reliability &#039;1&#039;
    option count &#039;1&#039;
    option timeout &#039;2&#039;
    option interval &#039;5&#039;
    option down &#039;3&#039;
    option up &#039;8&#039;
    option enabled &#039;1&#039;

config member &#039;wan_m1_w3&#039;
    option interface &#039;wan&#039;
    option metric &#039;1&#039;
    option weight &#039;3&#039;

config member &#039;wan_m2_w3&#039;
    option interface &#039;wan&#039;
    option metric &#039;2&#039;
    option weight &#039;3&#039;

config member &#039;wan2_m1_w2&#039;
    option interface &#039;wan2&#039;
    option metric &#039;1&#039;
    option weight &#039;2&#039;

config member &#039;wan2_m2_w2&#039;
    option interface &#039;wan2&#039;
    option metric &#039;2&#039;
    option weight &#039;2&#039;

config policy &#039;wan_only&#039;
    list use_member &#039;wan_m1_w3&#039;
    option last_resort &#039;default&#039;

config policy &#039;wan2_only&#039;
    list use_member &#039;wan2_m1_w2&#039;
    option last_resort &#039;default&#039;

config policy &#039;balanced&#039;
    list use_member &#039;wan_m1_w3&#039;
    list use_member &#039;wan2_m1_w2&#039;
    list use_member &#039;wan3g_m2_w4&#039;
    option last_resort &#039;unreachable&#039;

config interface &#039;wan3g&#039;
    option enabled &#039;1&#039;
    list track_ip &#039;8.8.8.8&#039;
    option reliability &#039;1&#039;
    option count &#039;1&#039;
    option timeout &#039;2&#039;
    option interval &#039;5&#039;
    option down &#039;5&#039;
    option up &#039;5&#039;

config member &#039;wan3g_m2_w4&#039;
    option interface &#039;wan3g&#039;
    option metric &#039;3&#039;
    option weight &#039;4&#039;</code></pre></div><p>If wan3g up, then about one in ten of the site does not open. I think when the site does not open, dns don&#039;t resolve the name. If wan3g is down, everything works fine. Wan and wan2 is from same provider, wan3g from other provider. I want to use wan3g as a backup when the wan and wan2 will not be available. Please help solve this problem. </p><p>P.S.<br />Sorry for my english, i will use google translate.</p></blockquote></div><p>please help to solve this problem</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p285630">
				<div class="post-metadata">
					<div class="post-num">Post #1344</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						30 Jul 2015, 17:25					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>suriefkasev wrote:</cite><blockquote><p>is possible for mwan3 to failover traffic openvpn tunnel to other tunnel?</p></blockquote></div><p>Yes. Create mwan3 interfaces for your tunnels as well.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p285631">
				<div class="post-metadata">
					<div class="post-num">Post #1345</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						30 Jul 2015, 17:26					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Vahe91 wrote:</cite><blockquote><div class="quotebox"><cite>Vahe91 wrote:</cite><blockquote><p>This is my mwan3 configuration</p><div class="codebox"><pre><code>config rule &#039;default_rule&#039;
    option dest_ip &#039;0.0.0.0/0&#039;
    option use_policy &#039;balanced&#039;

config interface &#039;wan&#039;
    option enabled &#039;1&#039;
    list track_ip &#039;8.8.4.4&#039;
    list track_ip &#039;8.8.8.8&#039;
    list track_ip &#039;208.67.222.222&#039;
    list track_ip &#039;208.67.220.220&#039;
    option reliability &#039;2&#039;
    option count &#039;1&#039;
    option timeout &#039;2&#039;
    option interval &#039;5&#039;
    option down &#039;3&#039;
    option up &#039;8&#039;

config interface &#039;wan2&#039;
    list track_ip &#039;8.8.8.8&#039;
    list track_ip &#039;208.67.220.220&#039;
    option reliability &#039;1&#039;
    option count &#039;1&#039;
    option timeout &#039;2&#039;
    option interval &#039;5&#039;
    option down &#039;3&#039;
    option up &#039;8&#039;
    option enabled &#039;1&#039;

config member &#039;wan_m1_w3&#039;
    option interface &#039;wan&#039;
    option metric &#039;1&#039;
    option weight &#039;3&#039;

config member &#039;wan_m2_w3&#039;
    option interface &#039;wan&#039;
    option metric &#039;2&#039;
    option weight &#039;3&#039;

config member &#039;wan2_m1_w2&#039;
    option interface &#039;wan2&#039;
    option metric &#039;1&#039;
    option weight &#039;2&#039;

config member &#039;wan2_m2_w2&#039;
    option interface &#039;wan2&#039;
    option metric &#039;2&#039;
    option weight &#039;2&#039;

config policy &#039;wan_only&#039;
    list use_member &#039;wan_m1_w3&#039;
    option last_resort &#039;default&#039;

config policy &#039;wan2_only&#039;
    list use_member &#039;wan2_m1_w2&#039;
    option last_resort &#039;default&#039;

config policy &#039;balanced&#039;
    list use_member &#039;wan_m1_w3&#039;
    list use_member &#039;wan2_m1_w2&#039;
    list use_member &#039;wan3g_m2_w4&#039;
    option last_resort &#039;unreachable&#039;

config interface &#039;wan3g&#039;
    option enabled &#039;1&#039;
    list track_ip &#039;8.8.8.8&#039;
    option reliability &#039;1&#039;
    option count &#039;1&#039;
    option timeout &#039;2&#039;
    option interval &#039;5&#039;
    option down &#039;5&#039;
    option up &#039;5&#039;

config member &#039;wan3g_m2_w4&#039;
    option interface &#039;wan3g&#039;
    option metric &#039;3&#039;
    option weight &#039;4&#039;</code></pre></div><p>If wan3g up, then about one in ten of the site does not open. I think when the site does not open, dns don&#039;t resolve the name. If wan3g is down, everything works fine. Wan and wan2 is from same provider, wan3g from other provider. I want to use wan3g as a backup when the wan and wan2 will not be available. Please help solve this problem. </p><p>P.S.<br />Sorry for my english, i will use google translate.</p></blockquote></div><p>please help to solve this problem</p></blockquote></div><p>Probably DNS issue. Please use OpenDNS or Google DNS. See wiki for more info.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p285891">
				<div class="post-metadata">
					<div class="post-num">Post #1346</div>
					<div class="post-author">Vahe91</div>
					<div class="post-datetime">
						1 Aug 2015, 17:34					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><p>Probably DNS issue. Please use OpenDNS or Google DNS. See wiki for more info.</p></blockquote></div><p>I added the rules for each dns server, and the problem was resolved. For example </p><div class="codebox"><pre><code>config rule &#039;dns1&#039;
    option dest_ip &#039;wan1_dns_ip&#039;
    option proto &#039;all&#039;
    option sticky &#039;0&#039;
    option use_policy &#039;wan1_only&#039;

config rule &#039;dns2&#039;
    option dest_ip &#039;wan2_dns_ip&#039;
    option proto &#039;all&#039;
    option sticky &#039;0&#039;
    option use_policy &#039;wan2_only&#039;

config rule &#039;dns3&#039;
    option dest_ip &#039;wan3g_dns_ip&#039;
    option proto &#039;all&#039;
    option sticky &#039;0&#039;
    option use_policy &#039;wan3g_only&#039;</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p286014">
				<div class="post-metadata">
					<div class="post-num">Post #1347</div>
					<div class="post-author">nui24711</div>
					<div class="post-datetime">
						2 Aug 2015, 18:46					</div>
				</div>
				<div class="post-content content">
					<p>Hi, Sir</p><p>I have problem and try to use luci-app-mwan3 1.3-5 in TP-Link MR3020. </p><p>My Device: TPLINK-MR3020 + WAN = Wifi Built in<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; + WAN2 = Wifi USB Alfa 036h</p><p>Openwrt Firmware Download : <a href="https://downloads.openwrt.org/barrier_breaker/14.07/ar71xx/generic/openwrt-ar71xx-generic-tl-mr3020-v1-squashfs-factory.bin">https://downloads.openwrt.org/barrier_b … actory.bin</a></p><p><strong>opkg update<br />opkg install kmod-rtl8187<br />opkg install luci-app-mwan3</strong></p><br /><p><strong>/etc/config/interface</strong><br /></p><div class="codebox"><pre><code>config interface &#039;loopback&#039;
    option ifname &#039;lo&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;127.0.0.1&#039;
    option netmask &#039;255.0.0.0&#039;

config globals &#039;globals&#039;
    option ula_prefix &#039;fdfa:c769:8668::/48&#039;

config interface &#039;lan&#039;
    option ifname &#039;eth0&#039;
    option force_link &#039;1&#039;
    option type &#039;bridge&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;192.168.1.1&#039;
    option netmask &#039;255.255.255.0&#039;
    option ip6assign &#039;60&#039;

config interface &#039;wan&#039;
    option proto &#039;dhcp&#039;

config interface &#039;wan2&#039;
    option proto &#039;dhcp&#039;</code></pre></div><p><strong>/etc/config/multiwan</strong><br /></p><div class="codebox"><pre><code>config interface &#039;wan&#039;
    option enabled &#039;1&#039;
    list track_ip &#039;8.8.4.4&#039;
    list track_ip &#039;8.8.8.8&#039;
    list track_ip &#039;208.67.222.222&#039;
    list track_ip &#039;208.67.220.220&#039;
    option reliability &#039;2&#039;
    option count &#039;1&#039;
    option timeout &#039;2&#039;
    option interval &#039;5&#039;
    option down &#039;3&#039;
    option up &#039;8&#039;

config interface &#039;wan2&#039;
    option enabled &#039;1&#039;
    list track_ip &#039;8.8.8.8&#039;
    list track_ip &#039;208.67.220.220&#039;
    option reliability &#039;1&#039;
    option count &#039;1&#039;
    option timeout &#039;2&#039;
    option interval &#039;5&#039;
    option down &#039;3&#039;
    option up &#039;8&#039;

config member &#039;wan_m1_w3&#039;
    option interface &#039;wan&#039;
    option metric &#039;1&#039;
    option weight &#039;3&#039;

config member &#039;wan_m2_w3&#039;
    option interface &#039;wan&#039;
    option metric &#039;2&#039;
    option weight &#039;3&#039;

config member &#039;wan2_m1_w2&#039;
    option interface &#039;wan2&#039;
    option metric &#039;1&#039;
    option weight &#039;2&#039;

config member &#039;wan2_m2_w2&#039;
    option interface &#039;wan2&#039;
    option metric &#039;2&#039;
    option weight &#039;2&#039;

config policy &#039;wan_only&#039;
    list use_member &#039;wan_m1_w3&#039;

config policy &#039;wan2_only&#039;
    list use_member &#039;wan2_m1_w2&#039;

config policy &#039;balanced&#039;
    list use_member &#039;wan_m1_w3&#039;
    list use_member &#039;wan2_m1_w2&#039;

config policy &#039;wan_wan2&#039;
    list use_member &#039;wan_m1_w3&#039;
    list use_member &#039;wan2_m2_w2&#039;

config policy &#039;wan2_wan&#039;
    list use_member &#039;wan_m2_w3&#039;
    list use_member &#039;wan2_m1_w2&#039;

config rule &#039;sticky_even&#039;
    option src_ip &#039;0.0.0.0/0.0.0.1&#039;
    option dest_port &#039;443&#039;
    option proto &#039;tcp&#039;
    option use_policy &#039;wan_wan2&#039;

config rule &#039;sticky_odd&#039;
    option src_ip &#039;0.0.0.1/0.0.0.1&#039;
    option dest_port &#039;443&#039;
    option proto &#039;tcp&#039;
    option use_policy &#039;wan2_wan&#039;

config rule &#039;default_rule&#039;
    option dest_ip &#039;0.0.0.0/0&#039;
    option use_policy &#039;balanced&#039;</code></pre></div><p><strong>/etc/config/firewall</strong><br /></p><div class="codebox"><pre><code>config defaults
    option syn_flood &#039;1&#039;
    option input &#039;ACCEPT&#039;
    option output &#039;ACCEPT&#039;
    option forward &#039;REJECT&#039;

config zone
    option name &#039;lan&#039;
    option input &#039;ACCEPT&#039;
    option output &#039;ACCEPT&#039;
    option forward &#039;ACCEPT&#039;
    option network &#039;lan&#039;

config zone
    option name &#039;wan&#039;
    option output &#039;ACCEPT&#039;
    option forward &#039;REJECT&#039;
    option masq &#039;1&#039;
    option mtu_fix &#039;1&#039;
    option input &#039;ACCEPT&#039;
    option network &#039;wan&#039;

config rule
    option name &#039;Allow-DHCP-Renew&#039;
    option src &#039;wan&#039;
    option proto &#039;udp&#039;
    option dest_port &#039;68&#039;
    option target &#039;ACCEPT&#039;
    option family &#039;ipv4&#039;

config rule
    option name &#039;Allow-Ping&#039;
    option src &#039;wan&#039;
    option proto &#039;icmp&#039;
    option icmp_type &#039;echo-request&#039;
    option family &#039;ipv4&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-DHCPv6&#039;
    option src &#039;wan&#039;
    option proto &#039;udp&#039;
    option src_ip &#039;fe80::/10&#039;
    option src_port &#039;547&#039;
    option dest_ip &#039;fe80::/10&#039;
    option dest_port &#039;546&#039;
    option family &#039;ipv6&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-ICMPv6-Input&#039;
    option src &#039;wan&#039;
    option proto &#039;icmp&#039;
    list icmp_type &#039;echo-request&#039;
    list icmp_type &#039;echo-reply&#039;
    list icmp_type &#039;destination-unreachable&#039;
    list icmp_type &#039;packet-too-big&#039;
    list icmp_type &#039;time-exceeded&#039;
    list icmp_type &#039;bad-header&#039;
    list icmp_type &#039;unknown-header-type&#039;
    list icmp_type &#039;router-solicitation&#039;
    list icmp_type &#039;neighbour-solicitation&#039;
    list icmp_type &#039;router-advertisement&#039;
    list icmp_type &#039;neighbour-advertisement&#039;
    option limit &#039;1000/sec&#039;
    option family &#039;ipv6&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-ICMPv6-Forward&#039;
    option src &#039;wan&#039;
    option dest &#039;*&#039;
    option proto &#039;icmp&#039;
    list icmp_type &#039;echo-request&#039;
    list icmp_type &#039;echo-reply&#039;
    list icmp_type &#039;destination-unreachable&#039;
    list icmp_type &#039;packet-too-big&#039;
    list icmp_type &#039;time-exceeded&#039;
    list icmp_type &#039;bad-header&#039;
    list icmp_type &#039;unknown-header-type&#039;
    option limit &#039;1000/sec&#039;
    option family &#039;ipv6&#039;
    option target &#039;ACCEPT&#039;

config include
    option path &#039;/etc/firewall.user&#039;

config zone
    option name &#039;wan2&#039;
    option input &#039;ACCEPT&#039;
    option forward &#039;REJECT&#039;
    option output &#039;ACCEPT&#039;
    option network &#039;wan2&#039;
    option masq &#039;1&#039;
    option mtu_fix &#039;1&#039;

config forwarding
    option dest &#039;wan&#039;
    option src &#039;lan&#039;

config forwarding
    option dest &#039;wan2&#039;
    option src &#039;lan&#039;</code></pre></div><p><strong>MWAN Detailed Status</strong></p><p>Interface status:<br />Interface wan is online (tracking active)<br />Interface wan2 is unknown</p><p>Policy balanced:<br /> wan (100%)</p><p>Policy wan2_only:<br /> unreachable</p><p>Policy wan2_wan:<br /> wan (100%)</p><p>Policy wan_only:<br /> wan (100%)</p><p>Policy wan_wan2:<br /> wan (100%)</p><p>Known networks:<br />destination&nbsp; &nbsp; &nbsp; &nbsp; policy&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;hits&nbsp; &nbsp; &nbsp;<br />-----------------------------------------------<br />127.0.0.0/8&nbsp; &nbsp; &nbsp; &nbsp; default&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; <br />224.0.0.0/3&nbsp; &nbsp; &nbsp; &nbsp; default&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; <br />192.168.1.0/24&nbsp; &nbsp; &nbsp;default&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 26&nbsp; &nbsp; &nbsp; &nbsp;<br />192.168.43.0/24&nbsp; &nbsp; default&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1600&nbsp; &nbsp; &nbsp;<br />127.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; default&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; <br />127.0.0.0/8&nbsp; &nbsp; &nbsp; &nbsp; default&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; <br />127.0.0.1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; default&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; <br />127.255.255.255&nbsp; &nbsp; default&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; <br />192.168.1.0&nbsp; &nbsp; &nbsp; &nbsp; default&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; <br />192.168.1.1&nbsp; &nbsp; &nbsp; &nbsp; default&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 25&nbsp; &nbsp; &nbsp; &nbsp;<br />192.168.1.255&nbsp; &nbsp; &nbsp; default&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1&nbsp; &nbsp; &nbsp; &nbsp; <br />192.168.43.0&nbsp; &nbsp; &nbsp; &nbsp;default&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; <br />192.168.43.149&nbsp; &nbsp; &nbsp;default&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1576&nbsp; &nbsp; &nbsp;<br />192.168.43.255&nbsp; &nbsp; &nbsp;default&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; </p><p>Active rules:<br />source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; proto&nbsp; src-port&nbsp; &nbsp; &nbsp; dest-port&nbsp; &nbsp; &nbsp;policy&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; hits&nbsp; &nbsp; &nbsp;<br />--------------------------------------------------------------------------------------------------<br />0.0.0.0/0.0.0.1&nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tcp&nbsp; &nbsp; 0:65535&nbsp; &nbsp; &nbsp; &nbsp;443&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;wan_wan2&nbsp; &nbsp; &nbsp; &nbsp; 23&nbsp; &nbsp; &nbsp; &nbsp;<br />0.0.0.1/0.0.0.1&nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tcp&nbsp; &nbsp; 0:65535&nbsp; &nbsp; &nbsp; &nbsp;443&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;wan2_wan&nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; <br />0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; all&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; balanced&nbsp; &nbsp; &nbsp; &nbsp; 414</p><p> <img src="https://forum.openwrt.org/img/smilies/hmm.png" width="15" height="15" alt="hmm" /><br />Sorry, I&#039;m basic to use.<br />I don&#039;t know how to edit config to begin.</p><p>Best, Regards</p>											<p class="post-edited">(Last edited by <strong>nui24711</strong> on 2 Aug 2015, 19:07)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p286480">
				<div class="post-metadata">
					<div class="post-num">Post #1348</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						6 Aug 2015, 03:18					</div>
				</div>
				<div class="post-content content">
					<p>nui24711,</p><p>For starters put metrics on both interfaces in /etc/config/network. You can do this on LuCI. It doesn&#039;t matter what numbers you use but they must be different.</p><p>Try metric 10 on wan and metric 20 on wan2.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p287871">
				<div class="post-metadata">
					<div class="post-num">Post #1349</div>
					<div class="post-author">dir2cas</div>
					<div class="post-datetime">
						17 Aug 2015, 03:15					</div>
				</div>
				<div class="post-content content">
					<h5><span style="color: blue"><strong>mwan3 with email notification and tracking verbosity enabled </strong></span><br />/modifications applied/</h5><p>Hello again,</p><p>In the process of testing the issue described in my previous posts, I did several modifications of mwan3 in order to increase the verbosity of the instrument. So, I decided to go a little further and add some hefty (according to me) features, using the great customize optional hotplug script of mwan3 together with some simple change in the mwan3 tracking engine - mwan3track. Tested and works OK on <strong>OpenWrt BB with mwan3 v1.5-10</strong>.</p><p>Probably this needs a separate topic, but here it is.</p><p>Brief description of the features added:<br /> <strong>1) Email notification:</strong><br /> </p><ul><li><p>this feature is accomplished, modifying /etc/hotplug.d/iface/16-mwancustom</p></li><li><p>very thin email agent (mua) is used - ssmtp</p></li><li><p>the email agent is automatically configured for mwan3 usage by mwan3 itself</p></li><li><p>the only configuration needed is setting the relevant variables (in the relevant section) in /etc/hotplug.d/iface/16-mwancustom</p></li><li><p>the email content can be customized of course, either by changing the email variables for a basic change in the email structure, or by editing the code and alter the content that mwan3 pushes</p></li><li><p>the email notification is processes only on mwan3 enabled interfaces and only on interface status change</p></li><li><p>the email notification can be disabled by setting a preset variable (disables by default)</p></li><li><p>discovery and notification when the system has just been powered on / booted (up to 5 minutes after system boot) - in this case the message sent is simplified and mwan3 status reports and logs are not sent (can be disabled as well)</p></li><li><p>compatible with non-default logging targets (for example, if logging to /var/log/messages is configured), logread option is still available if no specific log file is configured</p></li></ul><p> <strong>2) NAT table flushing on WAN switchover:</strong><br /> </p><ul><li><p>optional feature of&nbsp; mwan3 also added in /etc/hotplug.d/iface/16-mwancustom - now it flushes the NAT table, which is highly recommended for normal and optimal NAT table operation upon WAN links switchover. This is important for services that are exposed to Internet via DNAT by the router doing the multiwan. This feature will work only if you have conntrack-tools installed, conntrack-tools depends on libnetfilter-conntrack, which are relatively small packages.</p></li><li><p>ex.)<br />I am running a PBX behind the router with mwan3 and without NAT table flush, the sip connectivity does not work right, since the socket allocated from the primary wan somehow remains running on the other working one, after the primary wan failure and restoration as well. It is the same with openvpn instances that are terminated on an internal server (not the router itself, the router is doing simply DNAT). The main downside is that each connection from an internal host in the network (especially valid for TCP) has to be initiated again. Most services have daemons that are taking care of that, but if you are watching a video stream from your PC for example, you will have to reload it.</p></li></ul><p>Here is the content of /etc/hotplug.d/iface/<strong>16-mwancustom</strong><br /></p><div class="codebox"><pre><code>#!/bin/sh
. /lib/functions.sh

# to enable this script uncomment the case loop at the bottom
# to report mwan status on interface hotplug ifup/ifdown events modify the lines in the send_alert function

###################################
####### General variables: ########
###################################
# Define needed variables:
SCRIPTNAME=&quot;mwan3&quot;
SYSTEM_LOG_FILE=&quot;/var/log/messages&quot;             # Leave it empty if using the default syslogd configuration with logread macro
LOG=&quot;$(which logger) -t ${SCRIPTNAME} -p&quot;
###################################
#
###################################
## Email Notification variables: ##
###################################
#
# Email client settings (needed only if EMAIL_NOTIFY=&quot;1&quot;):
EMAIL_NOTIFY=&quot;0&quot;                     # Enable (1) / Disable (0) email notification on failover actions
EMAIL_CLIENT=&quot;$(which ssmtp)&quot;                 # The MUA (Mail user agent)
EMAIL_CLIENT_CONF=&quot;/etc/ssmtp/ssmtp_${SCRIPTNAME}.conf&quot; # Where the configuration of the MUA is located
EMAIL_USER=&quot;my.example@gmail.com&quot;             # The actual email account that is sending the email
EMAIL_PASSWD=&quot;MyEmailPassword&quot;                 # Your email account password
SMTP_SERVER=&quot;smtp.gmail.com&quot;                 # Outgoing mail server
DST_PORT=&quot;465&quot;                         # Destiantion port used by the mail client (smtp port is 25 by default, without encryption)
EMAIL_DOMAIN=&quot;gmail.com&quot;                 # Domain of the mail server
EMAIL_CLIENT_TLS=&quot;YES&quot;                     # &quot;YES&quot; or &quot;NO&quot; are valid options
EMAIL_SUBJECT=&quot;Example, WAN status change detected&quot;     # Subject of the email message
# List of Email notification recipients
EMAIL_TO=&quot;example1@domain1 example2@domain2 example3@domain3&quot;
EMAIL_SIGNATURE=&quot;powered by mwan3 &amp; OpenWrt&quot;
###################################

send_alert()
{
        # variable &quot;$1&quot; stores the MWAN status information
        # insert your code here to send the contents of &quot;$1&quot;
     #echo &quot;$1&quot;

    ###################################
    local HOST=&quot;$(uci get -p /var/state system.@system[0].hostname)&quot;
    # Check whether the email agent is installed
    if [ &quot;${EMAIL_NOTIFY}&quot; -ne &quot;1&quot; ]; then ${LOG} notice &quot;Email alert notification is not enabled&quot;; return 2; fi
    if [ ! -x &quot;${EMAIL_CLIENT}&quot; ]; then ${LOG} warning &quot;Warning: Email client ${EMAIL_CLIENT} is not installed or configured on the system&quot;; return 3; fi

    LOG_MESSAGE=&quot;${@}&quot;
    sleep 1

    # Checking whether the Email client has already been configured for our account and if not, write its configuration
    grep -e &quot;generated by ${SCRIPTNAME}&quot; ${EMAIL_CLIENT_CONF} &amp;&gt; /dev/null || {
        # Backing up if there is some old configuration first
        cp ${EMAIL_CLIENT_CONF} ${EMAIL_CLIENT_CONF}.backup &gt; /dev/null 2&gt;&amp;1
        # Writing the Email Client configuration (SSMTP)
        echo -e &quot;# ${EMAIL_CLIENT_CONF} -- a configuration file for sSMTP sendmail.\n### generated by ${SCRIPTNAME}\nroot=${EMAIL_USER}\nmailhub=${SMTP_SERVER}:${DST_PORT}\nrewriteDomain=${EMAIL_DOMAIN}\nhostname=${HOST}\nFromLineOverride=YES\nUseTLS=${EMAIL_CLIENT_TLS}\nAuthUser=${EMAIL_USER}\nAuthPass=${EMAIL_PASSWD}&quot; &gt; ${EMAIL_CLIENT_CONF}
        }

    # Composing the Email message and pipe it to the smtp client in order to be sent
    sleep 1
    echo -e &quot;From: &lt;${EMAIL_USER}&gt;\nSubject: ${EMAIL_SUBJECT}\n\n${HOST} alert notification message.\n\n$(echo -e &quot;${LOG_MESSAGE}&quot;)\n\n\n${EMAIL_SIGNATURE}&quot; | ${EMAIL_CLIENT} -C ${EMAIL_CLIENT_CONF} ${EMAIL_TO}
    sleep 1
    ${LOG} notice &quot;Sending email alert notification to $(echo &quot;${EMAIL_TO}&quot;|sed &quot;s/ /,/g&quot;)&quot;
    unset EMAIL_PASSWD
    unset LOG_MESSAGE
    ###################################

}

gather_event_info()
{
    local device enabled
    config_load mwan3
    config_get enabled &quot;${INTERFACE}&quot; enabled 0
    device=$(uci get -p /var/state network.${INTERFACE}.ifname) &amp;&gt; /dev/null
    #echo -e &quot;Interface is: ${INTERFACE}; Device is: ${device}|($DEVICE); enabled = ${enabled};&quot;
    if [ -n &quot;$device&quot; ] ; then
        #ACTION=ifup INTERFACE=$1 DEVICE=$device /sbin/hotplug-call iface
        # The interface is not enabled in mwan3 configuration, so no message alerting should be initiated
        [ &quot;${enabled}&quot; -eq &quot;1&quot; ] || { echo &quot;Warning: Interface ${INTERFACE} not enabled for message alerting&quot;; exit 1; }
    else
        echo &quot;Warning: Invalid interface call&quot;; exit 1;
    fi

    # create event information message
    local EVENT_INFO=&quot;Interface [ &quot;$INTERFACE&quot; ($DEVICE) ] on router [ &quot;$(uci get -p /var/state system.@system[0].hostname)&quot; ] has triggered a hotplug [ &quot;$ACTION&quot; ] event on &quot;$(date +&quot;%a %b %d %Y %T %Z&quot;)&quot;&quot;

    # get current interface, policy and rule status
    local CURRENT_STATUS=&quot;$(/usr/sbin/mwan3 status)&quot;

    # get last 50 MWAN systemlog messages
    if [ -e ${SYSTEM_LOG_FILE} ] ; then
        local MWAN_LOG=&quot;$(echo -e &quot;Last 50 MWAN systemlog entries. Newest entries sorted at the top:\n$($(which cat) ${SYSTEM_LOG_FILE} | grep mwan3 | tail -n 50 | sed &#039;x;1!H;$!d;x&#039;)&quot;)&quot;
    else
        local MWAN_LOG=&quot;$(echo -e &quot;Last 50 MWAN systemlog entries. Newest entries sorted at the top:\n$(logread | grep mwan3 | tail -n 50 | sed &#039;x;1!H;$!d;x&#039;)&quot;)&quot;
    fi

    # get the uptime in minutes and send different notification if the system uptime is less than 5 mins
    local UPTIME_MINUTES=$($(which uptime) | sed s/^.*up// | awk -F, &#039;{ if ( $3 ~ /user/ ) { print $1 $2 } else { print $1 }}&#039; | sed &#039;s/^ *//&#039; | awk &#039;{ if ( $2==&quot;min&quot; ) { print $1 } }&#039; | cut -d &quot;:&quot; -f1)

    # pass event info to send_alert function
    [ ! -z &quot;${UPTIME_MINUTES}&quot; -a &quot;${UPTIME_MINUTES}&quot; -le &quot;5&quot; ] &amp;&amp; { send_alert &quot;$(echo -e &quot;The system has just been powered on and started ${UPTIME_MINUTES} min ago!\n\n$EVENT_INFO&quot;)&quot;; exit 0; }
    send_alert &quot;$(echo -e &quot;$EVENT_INFO\n\n$CURRENT_STATUS\n\n$MWAN_LOG&quot;)&quot;

    # Flushing the NAT table
    [ -e $(which conntrack) ] &amp;&amp; { ${LOG} notice &quot;Flushing NAT Table&quot;; sleep 1; $(which conntrack) -F &amp;&gt; /dev/null; sleep 1; };
}


case &quot;$ACTION&quot; in
       ifup)
               gather_event_info
       ;;

       ifdown)
               gather_event_info
       ;;
esac

exit 0</code></pre></div><p> <strong>3) Tracking verbosity:</strong><br /> </p><ul><li><p>this feature is accomplished with small modification of /usr/sbin/mwan3track, which is not recommended at all, so a backup of the original file is obligatory</p></li><li><p>mwan3track now detects the failure/recovery based on packet loss values, comparing each result with a predefined packet loss threshold that we can set and consider crucial for the connectivity</p></li><li><p>if packet loss above the defined threshold is observed to any of the tracked hosts, a log message is produced in the system log</p></li><li><p>the above rule is valid while the interface is NOT marked as inactive/offline, in order to avoid the system log to be flooded with similar messages in the periods during which the connectivity via the particular interface is down</p></li><li><p>this feature helps to keep an eye on the link quality as well, because we can detect packet loss (even if it is not 100%) to the destinations tracked by mwan3. If we choose the monitored hosts in the right way, we can detect problems not only via a specific interface, but related to a global network issues, end destinations outages, etc</p></li><li><p>busybox ping applet is now hardcoded in order to avoid the issue described in my <a href="https://forum.openwrt.org/viewtopic.php?pid=285041#p285041">previous posts</a></p></li></ul><p>Here is the content of the modified /usr/sbin/<strong>mwan3track</strong><br /></p><div class="codebox"><pre><code>#!/bin/sh

[ -z &quot;$9&quot; ] &amp;&amp; echo &quot;Error: should not be started manually&quot; &amp;&amp; exit 0

if [ -e /var/run/mwan3track-$1.pid ] ; then
    kill $(cat /var/run/mwan3track-$1.pid) &amp;&gt; /dev/null
    rm /var/run/mwan3track-$1.pid &amp;&gt; /dev/null
fi

echo &quot;$$&quot; &gt; /var/run/mwan3track-$1.pid

score=$(($7+$8))
track_ips=$(echo $* | cut -d &#039; &#039; -f 9-99)
host_up_count=0
lost=0

######
# Custom variables:
MUTE_WHILE_DOWN=&quot;0&quot;     #Do not edit - prevents logging of packet loss results while the connection vie the interface is down
PLOSS_DEFAULT=&quot;100&quot;     #Default Packet loss rate in %
PLOSS_THRESHOLD=&quot;5&quot;     #Packet loss rate in %, that triggers host condition change (up|down)
######

while true; do

    for track_ip in $track_ips; do
        ######
        #/bin/busybox ping -I $2 -c $4 -W $5 -s 4 -q $track_ip &amp;&gt; /dev/null
        #/usr/bin/ping -I $2 -c $4 -W $5 -s 4 -q $track_ip &amp;&gt; /dev/null
        PING_RESULT=$(/bin/busybox ping -I $2 -c $4 -W $5 -s 4 -q $track_ip | grep &quot;packet loss&quot;) &amp;&gt; /dev/null
        PLOSS=$(echo &quot;${PING_RESULT}&quot; | sed -e &#039;s/^.*received, //&#039; -e &#039;s/^.*errors, //&#039; -e &#039;s/% packet loss.*//&#039;)
        if [ -z &quot;${PLOSS}&quot; ]; then PLOSS=${PLOSS_DEFAULT}; fi
        
        #if [ $? -eq 0 ]; then
        if [ &quot;${PLOSS}&quot; -le &quot;${PLOSS_THRESHOLD}&quot; ]; then
        ######
            let host_up_count++
        else
            let lost++
            ######
            [ &quot;${MUTE_WHILE_DOWN}&quot; -eq &quot;0&quot; ] &amp;&amp; logger -t mwan3track -p notice &quot;Network issue detected on Interface $1 ($2): $track_ip -&gt; ${PLOSS}% packet loss&quot;;
            ######
        fi
    done
        
    if [ $host_up_count -lt $3 ]; then
        let score--

        if [ $score -lt $8 ]; then score=0 ; fi
        if [ $score -eq $8 ]; then

            logger -t mwan3track -p notice &quot;Interface $1 ($2) is offline&quot;
            env -i ACTION=ifdown INTERFACE=$1 DEVICE=$2 /sbin/hotplug-call iface
            score=0
            ######
            MUTE_WHILE_DOWN=&quot;1&quot;
            ######
        fi

    else

        if [ $score -lt $(($7+$8)) ] &amp;&amp; [ $lost -gt 0 ]; then

            logger -t mwan3track -p info &quot;Lost $(($lost*$4)) ping(s) on interface $1 ($2)&quot;

        fi

        let score++
        lost=0

        if [ $score -gt $8 ]; then score=$(($7+$8)); fi
        if [ $score -eq $8 ]; then

            logger -t mwan3track -p notice &quot;Interface $1 ($2) is online&quot;
            env -i ACTION=ifup INTERFACE=$1 DEVICE=$2 /sbin/hotplug-call iface
            ######
            MUTE_WHILE_DOWN=&quot;0&quot;
            ######
            rm /var/run/mwan3track-$1.pid
            exit 0
        fi
    fi

    host_up_count=0
    sleep $6
done

exit 1</code></pre></div><p>And diff against the original file<br /></p><div class="codebox"><pre><code>[root@Core-Sf:~]# diff /usr/sbin/mwan3track /usr/sbin/mwan3track.original 
--- /usr/sbin/mwan3track
+++ /usr/sbin/mwan3track.original
@@ -14,32 +14,14 @@
 host_up_count=0
 lost=0
 
-######
-# Custom variables:
-MUTE_WHILE_DOWN=&quot;0&quot;     #Do not edit - prevents logging of packet loss results while the connection vie the interface is down
-PLOSS_DEFAULT=&quot;100&quot;     #Default Packet loss rate in %
-PLOSS_THRESHOLD=&quot;5&quot;     #Packet loss rate in %, that triggers host condition change (up|down)
-######
-
 while true; do
 
     for track_ip in $track_ips; do
-        ######
-        #/bin/busybox ping -I $2 -c $4 -W $5 -s 4 -q $track_ip &amp;&gt; /dev/null
-        #/usr/bin/ping -I $2 -c $4 -W $5 -s 4 -q $track_ip &amp;&gt; /dev/null
-        PING_RESULT=$(/bin/busybox ping -I $2 -c $4 -W $5 -s 4 -q $track_ip | grep &quot;packet loss&quot;) &amp;&gt; /dev/null
-        PLOSS=$(echo &quot;${PING_RESULT}&quot; | sed -e &#039;s/^.*received, //&#039; -e &#039;s/^.*errors, //&#039; -e &#039;s/% packet loss.*//&#039;)
-        if [ -z &quot;${PLOSS}&quot; ]; then PLOSS=${PLOSS_DEFAULT}; fi
-        
-        #if [ $? -eq 0 ]; then
-        if [ &quot;${PLOSS}&quot; -le &quot;${PLOSS_THRESHOLD}&quot; ]; then
-        ######
+        ping -I $2 -c $4 -W $5 -s 4 -q $track_ip &amp;&gt; /dev/null
+        if [ $? -eq 0 ]; then
             let host_up_count++
         else
             let lost++
-            ######
-            [ &quot;${MUTE_WHILE_DOWN}&quot; -eq &quot;0&quot; ] &amp;&amp; logger -t mwan3track -p notice &quot;Network issue detected on Interface $1 ($2): $track_ip -&gt; ${PLOSS}% packet loss&quot;;
-            ######
         fi
     done
         
@@ -52,9 +34,7 @@
             logger -t mwan3track -p notice &quot;Interface $1 ($2) is offline&quot;
             env -i ACTION=ifdown INTERFACE=$1 DEVICE=$2 /sbin/hotplug-call iface
             score=0
-            ######
-            MUTE_WHILE_DOWN=&quot;1&quot;
-            ######
+
         fi
 
     else
@@ -73,9 +53,6 @@
 
             logger -t mwan3track -p notice &quot;Interface $1 ($2) is online&quot;
             env -i ACTION=ifup INTERFACE=$1 DEVICE=$2 /sbin/hotplug-call iface
-            ######
-            MUTE_WHILE_DOWN=&quot;0&quot;
-            ######
             rm /var/run/mwan3track-$1.pid
             exit 0
         fi</code></pre></div><p>The options and the variables are self-explanatory, but several comments were added as well.</p><p>Here is a snippet of the mwan3 logging, showing how it reacts on a network issue affecting one of the wan links. This is replicated, by disabling a phy link (connected to a manageable l2 switch) throughout the path to the ISP, but not physically connected to the mwan3 router itself, in order to avoid the generic netifd mechanisms to kick in, thus emulating a connectivity problem.</p><div class="codebox"><pre><code>Aug 17 00:31:30 switch 786: Aug 17 00:31:27 EEST: %LINK-5-CHANGED: Interface FastEthernet0/2, changed state to administratively down
Aug 17 00:31:30 switch 787: Aug 17 00:31:28 EEST: %LINEPROTO-5-UPDOWN: Line protocol on Interface FastEthernet0/2, changed state to down
Aug 17 00:31:34 Core-Sf mwan3track: Network issue detected on Interface wan2 (eth0.3): 208.67.220.220 -&gt; 100% packet loss
Aug 17 00:31:41 Core-Sf mwan3track: Network issue detected on Interface wan2 (eth0.3): 208.67.222.222 -&gt; 100% packet loss
Aug 17 00:31:47 Core-Sf mwan3track: Network issue detected on Interface wan2 (eth0.3): 8.8.8.8 -&gt; 100% packet loss
Aug 17 00:31:53 Core-Sf mwan3track: Network issue detected on Interface wan2 (eth0.3): 87.120.130.66 -&gt; 100% packet loss
Aug 17 00:31:59 Core-Sf mwan3track: Network issue detected on Interface wan2 (eth0.3): 46.249.80.1 -&gt; 100% packet loss
Aug 17 00:31:59 Core-Sf mwan3track: Interface wan2 (eth0.3) is offline
Aug 17 00:31:59 Core-Sf mwan3: ifdown interface wan2 (eth0.3)
Aug 17 00:32:06 Core-Sf sSMTP[5675]: Creating SSL connection to host
Aug 17 00:32:07 Core-Sf sSMTP[5675]: SSL connection using ECDHE-RSA-AES128-GCM-SHA256
Aug 17 00:32:10 Core-Sf sSMTP[5675]: Sent mail for my.email@gmail.com (221 2.0.0 closing connection lk16sm13747142wic.6 - gsmtp) uid=0 username=root outbytes=8273
Aug 17 00:32:11 Core-Sf mwan3: Sending email alert notification to email1@domain1,email2@domain2,email3@domain3
Aug 17 00:32:11 Core-Sf mwan3: Flushing NAT Table
Aug 17 00:32:13 Core-Sf root: stopping ntpclient


########## bringing the switch port up after 3-4 minutes ########## 


Aug 17 00:34:08 switch 788: Aug 17 00:34:07 EEST: %LINK-3-UPDOWN: Interface FastEthernet0/2, changed state to up
Aug 17 00:34:08 switch 789: Aug 17 00:34:08 EEST: %LINEPROTO-5-UPDOWN: Line protocol on Interface FastEthernet0/2, changed state to up
Aug 17 00:35:22 Core-Sf mwan3track: Lost 95 ping(s) on interface wan2 (eth0.3)
Aug 17 00:36:42 Core-Sf mwan3track: Interface wan2 (eth0.3) is online
Aug 17 00:36:43 Core-Sf mwan3: ifup interface wan2 (eth0.3)
Aug 17 00:36:50 Core-Sf sSMTP[6647]: Creating SSL connection to host
Aug 17 00:36:50 Core-Sf sSMTP[6647]: SSL connection using ECDHE-RSA-AES128-GCM-SHA256
Aug 17 00:36:53 Core-Sf sSMTP[6647]: Sent mail for my.email@gmail.com (221 2.0.0 closing connection ir5sm14765639wjb.23 - gsmtp) uid=0 username=root outbytes=8678
Aug 17 00:36:54 Core-Sf mwan3: Sending email alert notification to email1@domain1,email2@domain2,email3@domain3
Aug 17 00:36:54 Core-Sf mwan3: Flushing NAT Table
Aug 17 00:36:57 Core-Sf firewall: Reloading firewall due to ifup of wan2 (eth0.3)
Aug 17 00:36:57 Core-Sf mwan3track: Network issue detected on Interface wan1 (eth0.2): 212.73.140.119 -&gt; 100% packet loss
Aug 17 00:36:58 Core-Sf root: starting ntpclient</code></pre></div><p>I believe that most of these modifications can be added to mwan3 project, especially the notification feature which can be imported in the mwan3 uci configuration file. </p><p>Download <a href="https://drive.google.com/open?id=0B4MFuXwiC1LhZFUyaE5lOG9yNFU">link</a> for the the mwan3 files that were modified.</p><p>Hope, someone will find this useful.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p288090">
				<div class="post-metadata">
					<div class="post-num">Post #1350</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						18 Aug 2015, 18:00					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for your work. I never really put any time into making the email stuff easier on the custom hotplug script. I&#039;ll look over your suggestions this upcoming weekend and see about adding them to the source.</p>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 54 of 65</div><nav><ul><li><a href="viewtopic.php%3Fid=39052&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=52.html">52</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=53.html">53</a></li><li class="pagination-current"><span>54</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=55.html">55</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=56.html">56</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=65.html">65</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0.001 -->

</body>
</html>