<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> SD Card Hack (gpio)</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 21 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p314626">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">iqsvh28iyv0dw5n9iogs</div>
					<div class="post-datetime">
						13 Mar 2016, 13:01					</div>
				</div>
				<div class="post-content content">
					<p>Hi there!</p><p>I&#039;m trying to get my sd-card via gpio working in openwrt 15.05&nbsp; </p><p>Hardware Hack:<br /><span class="postimg"><img src="http://s9.postimg.org/fhxolpbjv/dir_615_sd_card_h4ck.jpg" alt="http://s9.postimg.org/fhxolpbjv/dir_615_sd_card_h4ck.jpg" /></span></p><p>Luci Settings:<br /><span class="postimg"><img src="http://imgur.com/fcNS3i6l.png" alt="http://imgur.com/fcNS3i6l.png" /></span></p><br /><p><em>root@OpenWrt:/# lsmod | grep gpio</em> (rmmod&#039;ed gpio_button_hotplug &amp;&amp; rmmod leds_gpio, just in case!)<br /></p><div class="codebox"><pre><code>configfs               16496  2 gpiommc
gpiommc                 3616  2 
spi_bitbang             2448  1 spi_gpio_old
spi_gpio_old            2400  1 gpiommc</code></pre></div><br /><p><em>root@OpenWrt:~# /etc/init.d/mmc_over_gpio enable</em><br /><em>root@OpenWrt:~# /etc/init.d/mmc_over_gpio start</em><br /></p><div class="codebox"><pre><code>configfs on /config type configfs (rw,relatime)
root@OpenWrt:~# sh: write error: Device or resource busy</code></pre></div><br /><p>dmesg:<br /></p><div class="codebox"><pre><code>[   22.910000] gpiommc gpiommc.0: no of_node; not parsing pinctrl DT
[   22.920000] gpio-mmc: Failed to request mmc_spi module.
[   22.930000] spi-gpio spi-gpio.0: no of_node; not parsing pinctrl DT
[   22.940000] spi-gpio: probe of spi-gpio.0 failed with error -16
[   22.960000] gpio-mmc: MMC-Card &quot;openwrt_sd&quot; attached to GPIO pins di=7, do=0, clk=9, cs=14</code></pre></div><p>I didn&#039;t tried to mount or create a filesystem bcause I can&#039;t access the device (sd card over gpio / spi) at all!<br />I can&#039;t find any entries under /dev ether.</p><p>Thank&#039;s for your attention! Any help appreciated!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p314628">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">anarchy99</div>
					<div class="post-datetime">
						13 Mar 2016, 13:29					</div>
				</div>
				<div class="post-content content">
					<p>Hi</p><p>I&#039;ve tried the same (or similar) without success. Probably those GPIOs are not usable, without anyone&#039;s confirmation or at least some hints there&#039;s no point in doing this. Read the topic I&#039;ve started here -&gt;https://forum.openwrt.org/viewtopic.php?id=63182</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p314629">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">iqsvh28iyv0dw5n9iogs</div>
					<div class="post-datetime">
						13 Mar 2016, 13:40					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>anarchy99 wrote:</cite><blockquote><p>Hi</p><p>I&#039;ve tried the same (or similar) without success. Probably those GPIOs are not usable, without anyone&#039;s confirmation or at least some hints there&#039;s no point in doing this. Read the topic I&#039;ve started here -&gt;https://forum.openwrt.org/viewtopic.php?id=63182</p></blockquote></div><p>Hi!</p><p>Thank&#039;s for your reply. The weird thing is that other people did this with success! There is even a (half) tutorial mention this on the device I use: <a href="https://wiki.openwrt.org/toh/d-link/dir-615#sd-card_in_dir-615_h1">https://wiki.openwrt.org/toh/d-link/dir … dir-615_h1</a></p><p>I just get realy confused about the software/modules... these are changing names almost every version. And the tutorials I find are starting from v.8.... over 12.. 14.....</p><p>Ohh... that&#039;s not easy...<br />Probably you need to be a programmer of open-wrt to be able doing this <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p314638">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">mazilo</div>
					<div class="post-datetime">
						13 Mar 2016, 14:40					</div>
				</div>
				<div class="post-content content">
					<p>Sorry for asking this stupid question. R U doing this so that your device will have an external storage on an SD card?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p314640">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">anarchy99</div>
					<div class="post-datetime">
						13 Mar 2016, 14:44					</div>
				</div>
				<div class="post-content content">
					<p>So you&#039;re using already tested configuration, I&#039;d assume you need to unload other modules or recompile without them (such as leds, buttons etc.) since you got&nbsp; write error: Device or resource busy</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p314641">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">iqsvh28iyv0dw5n9iogs</div>
					<div class="post-datetime">
						13 Mar 2016, 14:45					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>mazilo wrote:</cite><blockquote><p>Sorry for asking this stupid question. R U doing this so that your device will have an external storage on an SD card?</p></blockquote></div><p>Whatever... I wanted to do extroot to have more (or better to have some) storage for system, apps etc.</p><p>But for now I just need to be able to &quot;see&quot; the devices.<br />Next ist do be able to mount filesystem... then later there is work to do for extroot/overlay and all these things.</p><p>One by one for now <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p314645">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">mazilo</div>
					<div class="post-datetime">
						13 Mar 2016, 15:21					</div>
				</div>
				<div class="post-content content">
					<p>OK and thank you.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p314646">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">iqsvh28iyv0dw5n9iogs</div>
					<div class="post-datetime">
						13 Mar 2016, 15:24					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>anarchy99 wrote:</cite><blockquote><p>So you&#039;re using already tested configuration, I&#039;d assume you need to unload other modules or recompile without them (such as leds, buttons etc.) since you got&nbsp; write error: Device or resource busy</p></blockquote></div><p>Can this really be? I heard that gpio can even co-exist...</p><p>Eventhough I think I unloaded all gpio related modules (see up).</p><p>Do have a tip for me which modules I should -NOT- include? I have no glue... and chaos calmer changed a lot again ... I think °-°</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p314650">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">iqsvh28iyv0dw5n9iogs</div>
					<div class="post-datetime">
						13 Mar 2016, 15:42					</div>
				</div>
				<div class="post-content content">
					<p><span class="bbu">Just did a clean install of Chaos Calmer to be sure there is no &quot;bad&quot; config:</span></p><ul><li><p>Clean Install Chaos Calmer 15.05</p></li><li><p>Installed luci-app-mmc-over-gpio (comes with: kmod-mmc, kmod-mmc-over-gpio, kmod-mmc-spi, kmod-mmc-spi, kmod-spi-bitbang, kmod-spi-gpio-old)</p></li><li><p>Open the luci-app-mmc-over-gpio frontend and configured the gpio ports &amp; activated the card</p></li><li><p>Checked gpio-requesting modules via &quot;lsmod | grep gpio&quot;</p></li><li><p>Kicked the one I don&#039;t want: &quot;rmmod gpio_button_hotplug &amp;&amp; rmmod leds_gpio&quot;</p></li><li><p>Checked again with &quot;lsmod | grep gpio&quot; whats left:<br /><span style="color: blue">#############OUTPUT#############<br /><em>configfs&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;16496&nbsp; 2 gpiommc<br />gpiommc&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3616&nbsp; 2 <br />spi_bitbang&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2448&nbsp; 1 spi_gpio_old<br />spi_gpio_old&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2400&nbsp; 1 gpiommc</em><br />#################################</span></p></li><li><p>Tried to initiate the thing via &quot;/etc/init.d/mmc_over_gpio start&quot;<br /><span style="color: blue">#############OUTPUT#############<br /><em>configfs on /config type configfs (rw,relatime)<br />sh: write error: Device or resource busy</em><br />#################################</span></p></li><li><p>Went for a reboot and tried again: &quot;/etc/init.d/mmc_over_gpio start&quot;<br /><span style="color: blue">#############OUTPUT#############<br /><em>configfs on /config type configfs (rw,relatime)<br />sh: write error: Device or resource busy</em><br />#################################</span></p></li></ul><p>No luck.</p><p>An here the part from dmesg:</p><p><span style="color: blue">###################################OUTPUT###################################<br />[&nbsp; &nbsp;22.990000] gpiommc gpiommc.0: no of_node; not parsing pinctrl DT<br />[&nbsp; &nbsp;23.000000] gpio-mmc: Failed to request mmc_spi module.<br />[&nbsp; &nbsp;23.010000] spi-gpio spi-gpio.0: no of_node; not parsing pinctrl DT<br />[&nbsp; &nbsp;23.020000] spi-gpio: probe of spi-gpio.0 failed with error -16<br />[&nbsp; &nbsp;23.040000] gpio-mmc: MMC-Card &quot;default&quot; attached to GPIO pins di=7, do=0, clk=9, cs=14<br />############################################################################</span></p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>