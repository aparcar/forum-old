<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Need HELP to set up our network</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 7 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p274556">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">wahkow</div>
					<div class="post-datetime">
						30 Apr 2015, 07:06					</div>
				</div>
				<div class="post-content content">
					<p>Hi guys, we are a small company and spanned to 2 different floors, level 2 and 9, which makes 2 different router/modem is necessary.</p><p>We use corporate copper and our main router(Tomato 1.28 firmware) is located on level 2, it also serves as the DHCP server. We have another router(Netgear WNDR3800 with OpenWRT backfire 10.03.1) on level 9 and we use it to provide wifi access to guests/visitors. At the moment, the guest network and main network is altogether, i.e. we all use 192.168.2.xxx IPs. Now we wish to separate the guest network from our main network and wish to give them IP address 192.168.3.xxx or even .4.xxx in the future. How should we do it? vlan? I am a networking noob and would be greatly appreciate if you could provide me a complete guide to set this up.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p274604">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">ninno</div>
					<div class="post-datetime">
						30 Apr 2015, 19:01					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>wahkow wrote:</cite><blockquote><p>We use corporate copper and our main router(Tomato 1.28 firmware) is located on level 2, it also serves as the DHCP server. We have another router(Netgear WNDR3800 with OpenWRT backfire 10.03.1) on level 9<br />...<br />we wish to separate the guest network from our main network</p></blockquote></div><p>This is fully described in the wiki:<br /><a href="http://wiki.openwrt.org/doc/recipes/guest-wlan">http://wiki.openwrt.org/doc/recipes/guest-wlan</a><br /><a href="http://wiki.openwrt.org/doc/recipes/guest-wlan-webinterface">http://wiki.openwrt.org/doc/recipes/gue … binterface</a></p><p>However you might have to consolidate your firmware (for sure), or even your hardware (you didnt write which model is your main router, so does it support tagged vlans, multiple SSIDs, ect.?).</p><p>For you WNDR3800: it does support multiple SSIDs, i dont own one so i dont know if it supports tagged vlans (802.11q) on switch ports; If not you might have to run two cables between Level2/Level9 (which is not needed if you can use tagged VLANs).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p274679">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">wahkow</div>
					<div class="post-datetime">
						1 May 2015, 04:35					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>ninno wrote:</cite><blockquote><div class="quotebox"><cite>wahkow wrote:</cite><blockquote><p>We use corporate copper and our main router(Tomato 1.28 firmware) is located on level 2, it also serves as the DHCP server. We have another router(Netgear WNDR3800 with OpenWRT backfire 10.03.1) on level 9<br />...<br />we wish to separate the guest network from our main network</p></blockquote></div><p>This is fully described in the wiki:<br /><a href="http://wiki.openwrt.org/doc/recipes/guest-wlan">http://wiki.openwrt.org/doc/recipes/guest-wlan</a><br /><a href="http://wiki.openwrt.org/doc/recipes/guest-wlan-webinterface">http://wiki.openwrt.org/doc/recipes/gue … binterface</a></p><p>However you might have to consolidate your firmware (for sure), or even your hardware (you didnt write which model is your main router, so does it support tagged vlans, multiple SSIDs, ect.?).</p><p>For you WNDR3800: it does support multiple SSIDs, i dont own one so i dont know if it supports tagged vlans (802.11q) on switch ports; If not you might have to run two cables between Level2/Level9 (which is not needed if you can use tagged VLANs).</p></blockquote></div><p>Thanks for your reply. I have found those article right after I have opened the post too <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /></p><p>However, after setup of the guest network, it is pretty unstable, on and off. Have found this </p><p><a href="https://dev.openwrt.org/ticket/7552#no2">https://dev.openwrt.org/ticket/7552#no2</a></p><p>but I dont think it&#039;s relevant to my problem.</p><p>Any advices?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p274683">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">drawz</div>
					<div class="post-datetime">
						1 May 2015, 04:59					</div>
				</div>
				<div class="post-content content">
					<p>Consider upgrading to the latest stable version of OpenWrt (14.07 Barrier Breaker right now), which works very well on the WNDR3800 and might fix this problem. Don&#039;t save your settings when upgrading, which unfortunately means you&#039;ll need to reconfigure things, including the guest-wlan.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p274741">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">Borromini</div>
					<div class="post-datetime">
						1 May 2015, 12:51					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>wahkow wrote:</cite><blockquote><p>Thanks for your reply. I have found those article right after I have opened the post too <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /></p><p>However, after setup of the guest network, it is pretty unstable, on and off. Have found this </p><p><a href="https://dev.openwrt.org/ticket/7552#no2">https://dev.openwrt.org/ticket/7552#no2</a></p><p>but I dont think it&#039;s relevant to my problem.</p><p>Any advices?</p></blockquote></div><p>Your Netgear has Atheros wireless, so this bug has nothing to do with it.</p><p>Like drawz said, upgrade to 14.07, back up your configs, so you can use them as a reference for your new setup, but do not keep them while upgrading.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p275207">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">wahkow</div>
					<div class="post-datetime">
						5 May 2015, 04:24					</div>
				</div>
				<div class="post-content content">
					<p>Thx for drawz&#039;s and Borromini&#039;s replies. I have found the problem and fixed it without upgrading to the newer version. The guest wireless network is pretty stable now. But it&#039;s not perfect since I am not able to prevent the wireless users accessing the LuCI admin page. As shown below, I have created a firewall rule to prevent accessing to the device and make it as the highest priority(i.e. on top of the list). But clients can still access the admin page by entering 192.168.9.1. Any advice?</p><p>config zone&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; option name &#039;guest&#039;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; option network &#039;guest&#039;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; option forward &#039;REJECT&#039;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; option output &#039;ACCEPT&#039;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; option input &#039;REJECT&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; config forwarding&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; option src &#039;guest&#039;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; option dest &#039;wan&#039;<br />&nbsp; <br />&nbsp; config rule&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; option src &#039;guest&#039;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; option src_port &#039;67-68&#039;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; option dest_port &#039;67-68&#039;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; option proto &#039;udp&#039;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; option target &#039;ACCEPT&#039;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; option name &#039;Allow DHCP request&#039;&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; <br />&nbsp; config rule&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; option src &#039;guest&#039;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; option dest_port &#039;53&#039;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; option proto &#039;tcpudp&#039;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; option target &#039;ACCEPT&#039;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; option name &#039;Allow DNS Queries&#039;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp; <br />&nbsp; config rule&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; option src &#039;guest&#039;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; option dest &#039;lan&#039;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; option name &#039;Deny Guest -&gt; LAN&#039;&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; option proto &#039;all&#039;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; option target &#039;DROP&#039;</p><p>&nbsp; config rule&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; option src &#039;guest&#039;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; option dest &#039;device&#039;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; option name &#039;Deny Guest -&gt; router&#039;&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; option proto &#039;all&#039;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; option target &#039;DROP&#039;</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p275366">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">wahkow</div>
					<div class="post-datetime">
						6 May 2015, 02:26					</div>
				</div>
				<div class="post-content content">
					<p>Anyone?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p275367">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						6 May 2015, 02:34					</div>
				</div>
				<div class="post-content content">
					<p>Remove &quot;option dest device&quot;.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p275640">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">wahkow</div>
					<div class="post-datetime">
						8 May 2015, 08:45					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>jow wrote:</cite><blockquote><p>Remove &quot;option dest device&quot;.</p></blockquote></div><p>I managed to open the config file directly and saw there was actually no &quot;option dest device&quot;, as shown following. Any other advice?</p><p>config &#039;rule&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;_name&#039; &#039;Deny Access to Router&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;src&#039; &#039;guest&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;proto&#039; &#039;all&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;target&#039; &#039;DROP&#039;</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p275643">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">tapper</div>
					<div class="post-datetime">
						8 May 2015, 09:00					</div>
				</div>
				<div class="post-content content">
					<p>Tomato 1.28&nbsp; is old you should really update to 14.07 IMO!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p276020">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">wahkow</div>
					<div class="post-datetime">
						12 May 2015, 04:18					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>tapper wrote:</cite><blockquote><p>Tomato 1.28&nbsp; is old you should really update to 14.07 IMO!</p></blockquote></div><p>Thx, maybe I will, but for now I want to fix the problem mentioned earlier.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>