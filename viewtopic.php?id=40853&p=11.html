<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> 6rd and ipv6-support</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 13 Jul 2015 and 30 Apr 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 11 of 12</div><nav><ul><li><a href="viewtopic.php%3Fid=40853&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=40853&amp;p=9.html">9</a></li><li><a href="viewtopic.php%3Fid=40853&amp;p=10.html">10</a></li><li class="pagination-current"><span>11</span></li><li><a href="viewtopic.php%3Fid=40853&amp;p=12.html">12</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p212266">
				<div class="post-metadata">
					<div class="post-num">Post #251</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						13 Sep 2013, 16:45					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>CyrusFF wrote:</cite><blockquote><p>Ummn, do you mean a second router on the same link with &quot;secondary router&quot;?</p></blockquote></div><p>I have a &quot;primary router&quot; handling the connectivity to ISP. That router has 6in4 tunnel etc. and runs dnsmasq and 6relayd etc. </p><p>And then I have a second Openwrt router, which I called a &quot;secondary router&quot;. That router is connected via wired LAN to the primary router in the same LAN subnet, and mostly acts as a second wifi access point, but it has no role in dhcp and should also have no need for 6relayd, right?</p>											<p class="post-edited">(Last edited by <strong>hnyman</strong> on 13 Sep 2013, 16:46)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p212637">
				<div class="post-metadata">
					<div class="post-num">Post #252</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						17 Sep 2013, 21:26					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>CyrusFF wrote:</cite><blockquote><p>Yes, but what should be the result? Assume the server is bad and restart the whole exchange? Try to deduce some value from the IAs already there?</p></blockquote></div><p>I figured out at least one way to cause the timeout error:<br/>If I re-flash my &quot;primary router&quot; acting as the 6relayd server and reboot it after the flash operation, then odhcp6c in the secondary router gets stuck into &quot;poll again in 300 seconds&quot; mode (which after your fix probably corresponds to the former UINT32_MAX timeout). I rebooted the first router at 20:07, so after the next RENEW round odhcp6c seems to acknowledge a valid response, but timeout remains 300 seconds as the odhcp6c is somehow stuck with the invalid timeout. </p><p>Could it be that if the server instance changes, odhcp6c somehow doesn&#039;t fully accept the response from the new server? I am thinking your comment about &quot;restart the whole exchange&quot;. May be that should be done?<br/></p><div class="codebox"><pre><code>Tue Sep 17 18:50:56 2013 daemon.notice odhcp6c[887]: Sending &lt;POLL&gt; (timeout 1800s)
Tue Sep 17 19:20:56 2013 daemon.notice odhcp6c[887]: Sending RENEW (timeout 1080s)
Tue Sep 17 19:20:56 2013 daemon.notice odhcp6c[887]: Got a valid reply after 1ms
Tue Sep 17 19:20:56 2013 daemon.notice odhcp6c[887]: Sending &lt;POLL&gt; (timeout 1800s)
Tue Sep 17 19:50:56 2013 daemon.notice odhcp6c[887]: Sending RENEW (timeout 1080s)
Tue Sep 17 19:50:56 2013 daemon.notice odhcp6c[887]: Got a valid reply after 1ms
Tue Sep 17 19:50:56 2013 daemon.notice odhcp6c[887]: Sending &lt;POLL&gt; (timeout 1800s)
&lt;&lt; first router rebooted at this point &gt;&gt;
Tue Sep 17 20:20:56 2013 daemon.notice odhcp6c[887]: Sending RENEW (timeout 1080s)
Tue Sep 17 20:20:56 2013 daemon.notice odhcp6c[887]: Got a valid reply after 2ms
Tue Sep 17 20:20:56 2013 daemon.notice odhcp6c[887]: Sending &lt;POLL&gt; (timeout 300s)
Tue Sep 17 20:25:56 2013 daemon.notice odhcp6c[887]: Sending RENEW (timeout 300s)
Tue Sep 17 20:25:56 2013 daemon.notice odhcp6c[887]: Got a valid reply after 2ms
Tue Sep 17 20:25:56 2013 daemon.notice odhcp6c[887]: Sending &lt;POLL&gt; (timeout 300s)
Tue Sep 17 20:30:56 2013 daemon.notice odhcp6c[887]: Sending RENEW (timeout 300s)
Tue Sep 17 20:30:56 2013 daemon.notice odhcp6c[887]: Got a valid reply after 1ms
Tue Sep 17 20:30:56 2013 daemon.notice odhcp6c[887]: Sending &lt;POLL&gt; (timeout 300s)</code></pre></div><p>EDIT:<br/>I tested: a normal reboot of the router running 6relayd is enough to make the other router&#039;s odhcp6c to get stuck in &quot;renew in 300s&quot; mode.</p>											<p class="post-edited">(Last edited by <strong>hnyman</strong> on 17 Sep 2013, 23:58)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p212681">
				<div class="post-metadata">
					<div class="post-num">Post #253</div>
					<div class="post-author">CyrusFF</div>
					<div class="post-datetime">
						18 Sep 2013, 13:31					</div>
				</div>
				<div class="post-content content">
					<p>Thank you very much for your help.<br/>I found the issue: When the server forgets about your lease (e.g. through a restart) it includes an error code in the lease. The old behaviour was to ignore that error and simply not parse it, which lead to this strange behaviour. I just commited a fix that restarts the transaction if the client receives such an error status (e.g. NoBinding).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p212683">
				<div class="post-metadata">
					<div class="post-num">Post #254</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						18 Sep 2013, 14:01					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>CyrusFF wrote:</cite><blockquote><p>Thank you very much for your help.</p></blockquote></div><p>Thanks. I have a stable environment with two identical routers that I regularly flash to the newest version, so I guess I will spot issues like that more clearly than most users ;-)</p><p>But could you please consider adding that uci config option in 6relayd config to be able to prevent its launch? Having that kind of uci option would survive the flash and would help suppressing 6relayd in routers not needing it.</p>											<p class="post-edited">(Last edited by <strong>hnyman</strong> on 18 Sep 2013, 14:22)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p212684">
				<div class="post-metadata">
					<div class="post-num">Post #255</div>
					<div class="post-author">CyrusFF</div>
					<div class="post-datetime">
						18 Sep 2013, 14:07					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m currently in the middle of refactoring 6relayd and will rewrite the startup behaviour. Though this can still take a few weeks until its commited.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p213366">
				<div class="post-metadata">
					<div class="post-num">Post #256</div>
					<div class="post-author">alphasparc</div>
					<div class="post-datetime">
						28 Sep 2013, 13:12					</div>
				</div>
				<div class="post-content content">
					<p>Hi CyrusFF, why is it that in Interface section in LuCI the ipv6 prefix section appears for trunk but not attitude adjustment?<br/>Ok I found it<br/>/etc/config/network changes was not merged<br/><a href="https://dev.openwrt.org/changeset/36384/">https://dev.openwrt.org/changeset/36384/</a><br/>Is it possible for you to push the all the changes required to AA?</p>											<p class="post-edited">(Last edited by <strong>alphasparc</strong> on 28 Sep 2013, 14:42)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p213831">
				<div class="post-metadata">
					<div class="post-num">Post #257</div>
					<div class="post-author">mikebrady</div>
					<div class="post-datetime">
						3 Oct 2013, 16:48					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ve been having trouble with relayed, think I found a bug and propose a solution.</p><p>Basically, the bug is that 6relayd is advertising bad route information on RAs -- please see <a href="https://forum.openwrt.org/viewtopic.php?id=46584">https://forum.openwrt.org/viewtopic.php?id=46584</a> for the full story.</p><p>It seems that there is a bug in the function send_router_advert in router.c. Specifically, if I change the data structure &quot;routes&quot; to accomodate a 128-bit address and make the necessary changes, everything works like I think it should.</p><p>Here is the expanded structure definition:<br/></p><div class="codebox"><pre><code> struct {
        uint8_t type;
        uint8_t len;
        uint8_t prefix;
        uint8_t flags;
        uint32_t lifetime;
        uint32_t addr[4];
    } routes[RELAYD_MAX_PREFIXES];</code></pre></div><p>See how addr[2] is now addr[4].<br/>The last two lines of the following is the extra code to fill the extra two uint32_ts:<br/></p><div class="codebox"><pre><code>        routes[routes_cnt].addr[0] = addr-&gt;addr.s6_addr32[0];
        routes[routes_cnt].addr[1] = addr-&gt;addr.s6_addr32[1];
        routes[routes_cnt].addr[2] = addr-&gt;addr.s6_addr32[2];
        routes[routes_cnt].addr[3] = addr-&gt;addr.s6_addr32[3];</code></pre></div><p>Does it look plausible? It certainly fixes the problem I reported, and kinda makes sense to me. FYI, I&#039;m running a current version of BB on a Linksys NSLU2, which is an ARM running big-endian.<br/>It is worth filing a patch at OpenWrt?<br/>Regards<br/>Mike</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p213834">
				<div class="post-metadata">
					<div class="post-num">Post #258</div>
					<div class="post-author">CyrusFF</div>
					<div class="post-datetime">
						3 Oct 2013, 17:39					</div>
				</div>
				<div class="post-content content">
					<p>Nope, it is OK to cut off trailing bytes in the route struct so this shouldn&#039;t be problematic. I&#039;ve seen that radvdump has problems with deciphering those but they are technically correct. Do you have any other clues on why this should be problematic the way it is and what your solution improves other than the output of radvdump?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p213838">
				<div class="post-metadata">
					<div class="post-num">Post #259</div>
					<div class="post-author">mikebrady</div>
					<div class="post-datetime">
						3 Oct 2013, 18:33					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>CyrusFF wrote:</cite><blockquote><p>Nope, it is OK to cut off trailing bytes in the route struct so this shouldn&#039;t be problematic. I&#039;ve seen that radvdump has problems with deciphering those but they are technically correct. Do you have any other clues on why this should be problematic the way it is and what your solution improves other than the output of radvdump?</p></blockquote></div><p>The main improvement is that the routing works after the fix, and doesn&#039;t work without it. The fix has completely restored IPv6 connectivity between my private network (Macs, Linux boxes, printers, etc.) and the internet. I was just using radvdump as a diagnostic. </p><p>I&#039;ve assumed that radvdump is reporting the real content of the RA, because what was happening before the fix corresponds with what I&#039;d expect to happen with faulty routing information -- devices using the RAs were unable to ping6 through the router. Then, having applied the fix (and seen the improvement in the radvdump outputs), devices were indeed able to ping6 through. BTW, the device running radvdump is a FreeBSD box.</p><p>TBH, I don&#039;t understand how it could be OK to cut off the trailing bytes, because by cutting them off, surely the rightmost 8 bytes of the ipv6 router address are cut off, so the data being passed in the RA would not actually contain a full route address at all. By my reasoning, the odd-looking route addresses displayed were constructed using four bytes of prefix and four bytes of junk from beyond the end of the data structure. It seems consistent with what radvdump was reporting and what was actually happening in terms of routing. I have to admit, though, I&#039;m guessing a lot of this on the basis of what seems plausible... <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile"/></p>											<p class="post-edited">(Last edited by <strong>mikebrady</strong> on 3 Oct 2013, 18:54)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p213841">
				<div class="post-metadata">
					<div class="post-num">Post #260</div>
					<div class="post-author">CyrusFF</div>
					<div class="post-datetime">
						3 Oct 2013, 19:17					</div>
				</div>
				<div class="post-content content">
					<p>No, that isn&#039;t the point these route options indicate that a target network (which is the last part of the route struct) is reachable through the router that send the advert. So the last field doesn&#039;t indicate a router but a route target and thus cutting off a part is legitimate. This is also in compliance with <a href="http://tools.ietf.org/html/rfc4191#section-2.3.">http://tools.ietf.org/html/rfc4191#section-2.3.</a></p><p>Just checking again with radvdump shows the same crap that you encountered e.g. route 2001:db80::1903:0:0:708/48<br/>however looking at wireshark dumps there it is recognized correctly and also obvious that the random garbage after the route is actually a product of radvdumps imagination <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink"/></p><p>But having seen so much crap in IPv6 implementations especially with what you mentioned it could very well be clients having issues. Nevertheless if this really fixes things for you you can send me a patch ( cyrus - at - openwrt - dot - org) and I can evaluate it for my queue.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p213842">
				<div class="post-metadata">
					<div class="post-num">Post #261</div>
					<div class="post-author">mikebrady</div>
					<div class="post-datetime">
						3 Oct 2013, 19:24					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for the clarification. As you say, in spite of being strictly unnecessary, it might to be useful. I&#039;ll send the patch.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p214509">
				<div class="post-metadata">
					<div class="post-num">Post #262</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						10 Oct 2013, 23:33					</div>
				</div>
				<div class="post-content content">
					<p>I have again a special situation for you:<br/>Thanks to a buggy wireless driver causing an endless reboot loop, I had today trouble with my main router and I had to flash and boot the router multiple times.</p><p>Apparently I have booted the main router (6relayd server) just after the secondary router&nbsp; (odhcp6c client) has received answer to SOLICIT and has sent a REQUEST message. Then the booting server has not answered, and as the timeout is really long, the client is apparently still waiting for the answer.</p><p>&nbsp; Thu Oct 10 20:19:56 2013 daemon.notice odhcp6c[1115]: Sending REQUEST (timeout 4294967295s)</p><p>Does the timeout for REQUEST really need to be that long?</p><div class="codebox"><pre><code>Thu Oct 10 19:49:55 2013 daemon.notice odhcp6c[1115]: Sending RENEW (timeout 1080s)
Thu Oct 10 19:49:55 2013 daemon.notice odhcp6c[1115]: Got a valid reply after 1ms
Thu Oct 10 19:49:55 2013 daemon.notice odhcp6c[1115]: Sending &lt;POLL&gt; (timeout 1800s)
Thu Oct 10 20:19:55 2013 daemon.notice odhcp6c[1115]: Sending RENEW (timeout 1080s)
Thu Oct 10 20:19:55 2013 daemon.notice odhcp6c[1115]: Got a valid reply after 2ms
Thu Oct 10 20:19:55 2013 daemon.warn odhcp6c[1115]: Server returned IAID status 3!
Thu Oct 10 20:19:55 2013 daemon.notice odhcp6c[1115]: Sending RELEASE (timeout 3s)
Thu Oct 10 20:19:55 2013 daemon.notice odhcp6c[1115]: (re)starting transaction on br-lan
Thu Oct 10 20:19:55 2013 daemon.notice odhcp6c[1115]: Sending SOLICIT (timeout 4294967295s)
Thu Oct 10 20:19:55 2013 daemon.notice odhcp6c[1115]: Got a valid reply after 37ms
Thu Oct 10 20:19:55 2013 daemon.notice netifd: Interface &#039;lan6&#039; has lost the connection
Thu Oct 10 20:19:55 2013 daemon.notice netifd: Interface &#039;lan6&#039; is now up
Thu Oct 10 20:19:56 2013 daemon.notice odhcp6c[1115]: Sending REQUEST (timeout 4294967295s)
Thu Oct 10 20:19:56 2013 daemon.info dnsmasq[1385]: reading /tmp/resolv.conf.auto
Thu Oct 10 20:19:56 2013 daemon.info dnsmasq[1385]: using nameserver fd4d:a3ef:f00::1#53
Thu Oct 10 20:19:56 2013 daemon.info dnsmasq[1385]: using nameserver 192.168.1.1#53
Thu Oct 10 20:19:56 2013 daemon.info dnsmasq[1385]: using local addresses only for domain lan
Thu Oct 10 20:35:52 2013 daemon.info dnsmasq[1385]: reading /tmp/resolv.conf.auto
Thu Oct 10 20:35:52 2013 daemon.info dnsmasq[1385]: using nameserver 2001:xxxx:yyy::1#53
Thu Oct 10 20:35:52 2013 daemon.info dnsmasq[1385]: using nameserver fd4d:a3ef:f00::1#53
Thu Oct 10 20:35:52 2013 daemon.info dnsmasq[1385]: using nameserver 192.168.1.1#53
Thu Oct 10 20:35:52 2013 daemon.info dnsmasq[1385]: using local addresses only for domain lan
Thu Oct 10 21:36:25 2013 daemon.info dnsmasq[1385]: reading /tmp/resolv.conf.auto
Thu Oct 10 21:36:25 2013 daemon.info dnsmasq[1385]: using nameserver fd4d:a3ef:f00::1#53
Thu Oct 10 21:36:25 2013 daemon.info dnsmasq[1385]: using nameserver 192.168.1.1#53
Thu Oct 10 21:36:25 2013 daemon.info dnsmasq[1385]: using local addresses only for domain lan
Thu Oct 10 22:03:38 2013 daemon.info dnsmasq[1385]: reading /tmp/resolv.conf.auto
Thu Oct 10 22:03:38 2013 daemon.info dnsmasq[1385]: using nameserver 2001:xxxx:yyy::1#53</code></pre></div>											<p class="post-edited">(Last edited by <strong>hnyman</strong> on 11 Oct 2013, 12:31)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p214536">
				<div class="post-metadata">
					<div class="post-num">Post #263</div>
					<div class="post-author">CyrusFF</div>
					<div class="post-datetime">
						11 Oct 2013, 10:34					</div>
				</div>
				<div class="post-content content">
					<p>Ok thanks. I set the timeout to 60s now which is not quite was the standard says but should be good enough for now.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216257">
				<div class="post-metadata">
					<div class="post-num">Post #264</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						30 Oct 2013, 21:41					</div>
				</div>
				<div class="post-content content">
					<p>Looks like I lost ipv6 connectivity between 38578 and 38610. Might be due to recent netifd changes?</p><p>When looking at the changes, there is not much else that could cause this (for an ar71xx build).<br/><a href="https://dev.openwrt.org/changeset?new=38610%40trunk&amp;old=38578%40trunk">https://dev.openwrt.org/changeset?new=38610%40trunk&amp;old=38578%40trunk</a></p><p>The sixxs tunnel interface does not get up, not even with ifup.<br/>And LAN interface only gets a link-local address.</p><p>EDIT:<br/>reverting just the changes on netifd today makes the ipv6 connectivity to come back. Otherwise r38610, but netifd as before the changes by r38606</p>											<p class="post-edited">(Last edited by <strong>hnyman</strong> on 30 Oct 2013, 21:54)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216280">
				<div class="post-metadata">
					<div class="post-num">Post #265</div>
					<div class="post-author">nbd</div>
					<div class="post-datetime">
						31 Oct 2013, 00:30					</div>
				</div>
				<div class="post-content content">
					<p>Are there issues with ipv4 as well? What kind of config do you use?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216293">
				<div class="post-metadata">
					<div class="post-num">Post #266</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						31 Oct 2013, 08:47					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>nbd wrote:</cite><blockquote><p>Are there issues with ipv4 as well? What kind of config do you use?</p></blockquote></div><p>I didn&#039;t notice anything special with ipv4. Traffic flows ok.</p><p>I have a static 6in4 tunnel for sixxs.</p><p>But also LAN did not get an ipv6 address and it is controlled by 6relayd, I guess.</p><p>One of my suspicisions for the reason is that the maybe protocol scripts (6in4.sh) etc. have not yet been accomodated to netifd functions being moved around between scripts. E.g. 6in4.sh references netifd-proto.sh, which is now marked non-executable, right?&nbsp; &nbsp;<a href="http://nbd.name/gitweb.cgi?p=openwrt.git;a=blob;f=package/network/ipv6/6in4/files/6in4.sh;h=647a2f89cfdc573cdac77858812e05463429cf43;hb=HEAD">http://nbd.name/gitweb.cgi?p=openwrt.gi … 43;hb=HEAD</a>&nbsp; and <a href="http://nbd.name/gitweb.cgi?p=luci2/netifd.git;a=history;f=scripts/netifd-proto.sh;h=76dcd8dcae777213383642c970e42e802f95377e;hb=HEAD">http://nbd.name/gitweb.cgi?p=luci2/neti … 7e;hb=HEAD</a></p><p>Similarly, some of the functions have been moved to utils.sh. I am not sure if the ipv6 protocol handlers have been accomodated to the changes. (If the changes actually do cause that kind need to changes scripts references.)</p><p>EDIT:<br/>Fixed by r38627 or actually by the underlying change&nbsp; in netifd: <a href="http://nbd.name/gitweb.cgi?p=luci2/netifd.git;a=commitdiff;h=199723ed921160c029a0d15fa95914ddfcdc5cb9">http://nbd.name/gitweb.cgi?p=luci2/neti … ddfcdc5cb9</a></p>											<p class="post-edited">(Last edited by <strong>hnyman</strong> on 31 Oct 2013, 17:26)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p217805">
				<div class="post-metadata">
					<div class="post-num">Post #267</div>
					<div class="post-author">Manani</div>
					<div class="post-datetime">
						17 Nov 2013, 19:05					</div>
				</div>
				<div class="post-content content">
					<p>Hi CyrusFF,<br/>I no longer have IPv6 routing. Wan and clients have well a public IPv6 address.</p><p><span class="bbu">Edit1:</span> Yet everything seems ok with the ping test.</p><p>ping -6 ipv6.google.com<br/></p><div class="codebox"><pre><code>Envoi d&#039;une requête &#039;ping&#039; sur ipv6.l.google.com [2a00:1450:400c:c05::67] avec 3
2 octets de données :
Réponse de 2a00:1450:400c:c05::67 : temps=675 ms
Réponse de 2a00:1450:400c:c05::67 : temps=29 ms
Réponse de 2a00:1450:400c:c05::67 : temps=28 ms
Réponse de 2a00:1450:400c:c05::67 : temps=28 ms

Statistiques Ping pour 2a00:1450:400c:c05::67:
    Paquets : envoyés = 4, reçus = 4, perdus = 0 (perte 0%),
Durée approximative des boucles en millisecondes :
    Minimum = 28ms, Maximum = 675ms, Moyenne = 190ms</code></pre></div><p><span class="bbu">Edit2:</span> I think 6relay returns bad gateway. fe80 class instead of 2a01 class.</p>											<p class="post-edited">(Last edited by <strong>Manani</strong> on 23 Nov 2013, 13:48)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p218923">
				<div class="post-metadata">
					<div class="post-num">Post #268</div>
					<div class="post-author">cconn</div>
					<div class="post-datetime">
						1 Dec 2013, 06:15					</div>
				</div>
				<div class="post-content content">
					<p>I am running r38896 and for Apple clients (iphone ipad etc) everything is honky dory, however my Android device that previously (r386xx versions on another platform I replaced) was working fine, is now almost always without a prefix after a few hours.</p><p>I also note that I am getting a firewall reset every time the ISP sends me an RA;</p><p>Sun Dec&nbsp; 1 04:01:54 2013 user.notice firewall: Reloading firewall due to ifup of wan6 ()<br/>Sun Dec&nbsp; 1 04:13:29 2013 user.notice firewall: Reloading firewall due to ifup of wan6 ()<br/>Sun Dec&nbsp; 1 04:25:30 2013 user.notice firewall: Reloading firewall due to ifup of wan6 ()<br/>Sun Dec&nbsp; 1 04:37:55 2013 user.notice firewall: Reloading firewall due to ifup of wan6 ()</p><p>could I be missing a package in my build?&nbsp; other than 6relayd and odhcp6c, I don&#039;t need anything in particular?&nbsp; Or do I need odhcpd?&nbsp; I&#039;d love to figure out what has changed to break my Androids.&nbsp; Anyone else having issues or is it just me?</p><p>I have tried with ULA prefix compat, without ULA prefix at all, dhcpv6 server disabled, stateless only, stateful+stateless, stateful only and it never seems to keep a prefix longer than 7xxx seconds or whatever the first RA it gets duration is.</p>											<p class="post-edited">(Last edited by <strong>cconn</strong> on 1 Dec 2013, 06:25)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p220555">
				<div class="post-metadata">
					<div class="post-num">Post #269</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						21 Dec 2013, 20:50					</div>
				</div>
				<div class="post-content content">
					<p>I seem to have lost clients&#039; ipv6 connectivity between 39150 and 39154.<br/>Everything worked with 39150. With 39154, 6relayd starts, but does not stay alive (does not stay in&nbsp; process list). The router itself can ping ipv6.google.com, but clients do not get connectivity.</p><p>39152 made changes to dnsmasq startup handling and I wonder if that has had impact.</p><p>with 39154 I see an extra log line:<br/>Sat Dec 21 20:08:13 2013 daemon.warn 6relayd[1342]: Termination requested by signal.</p><p>EDIT:<br/>Interesting, after flashing 39155 there is no such line in the log and ipv6 works again for clients. I don&#039;t see how that 39155 could have affected wired connection, so there might be a problem surfacing sometimes, but not always.</p>											<p class="post-edited">(Last edited by <strong>hnyman</strong> on 21 Dec 2013, 23:54)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p221362">
				<div class="post-metadata">
					<div class="post-num">Post #270</div>
					<div class="post-author">nunojpg</div>
					<div class="post-datetime">
						31 Dec 2013, 17:55					</div>
				</div>
				<div class="post-content content">
					<p>I have the same issue with current trunk. At boot the router broadcasts the prefix and gives DHCPv6 leases, but shortly after all stops.</p><br/><p>Thu Jan&nbsp; 1 00:00:56 1970 daemon.notice netifd: Interface &#039;wan6&#039; is now up<br/>Thu Jan&nbsp; 1 00:00:56 1970 user.notice firewall: Reloading firewall due to ifup of wan6 (wlan0)<br/>Thu Jan&nbsp; 1 00:00:57 1970 daemon.warn 6relayd[851]: Termination requested by signal.<br/>Thu Jan&nbsp; 1 00:00:58 1970 daemon.info dnsmasq[973]: read /etc/hosts - 1 addresses<br/>Thu Jan&nbsp; 1 00:00:58 1970 daemon.info dnsmasq[973]: read /tmp/hosts/6relayd - 0 addresses<br/>Thu Jan&nbsp; 1 00:00:58 1970 daemon.info dnsmasq-dhcp[973]: read /etc/ethers - 0 addresses<br/>Thu Jan&nbsp; 1 00:00:58 1970 user.notice firewall: Reloading firewall due to ifup of wan6 ()<br/>Tue Dec 31 15:33:57 2013 user.notice firewall: Reloading firewall due to ifup of wan6 ()<br/>Tue Dec 31 15:39:13 2013 user.notice firewall: Reloading firewall due to ifup of wan6 ()<br/>Tue Dec 31 15:48:39 2013 user.notice firewall: Reloading firewall due to ifup of wan6 ()</p><br/><p>So this is with current trunk, no upstream IPv6, and default config (including the default WAN6 DHCP)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p221363">
				<div class="post-metadata">
					<div class="post-num">Post #271</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						31 Dec 2013, 18:01					</div>
				</div>
				<div class="post-content content">
					<p>I have noticed with the last few trunk builds in late December that 6relayd may not stay alive during the startup process. It is mentioned in the logs, but the process silently disappears somewhere before the boot is complete. Router itself can ping ipv6.google.com, but LAN clients do not get ipv6 connectivity as 6relayd is not there providing RA.</p><p>Issuing a &quot;/etc/init.d/6relayd restart&quot; command fixes things. No changes needed for the config.</p><p>I guess that this might be due to the recent changes in netifd startup order.</p><p>I have filed bug #14710 about this: <a href="https://dev.openwrt.org/ticket/14710">https://dev.openwrt.org/ticket/14710</a></p><p>EDIT: Fixed by r39184.</p>											<p class="post-edited">(Last edited by <strong>hnyman</strong> on 26 Jan 2014, 23:16)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p223830">
				<div class="post-metadata">
					<div class="post-num">Post #272</div>
					<div class="post-author">Manani</div>
					<div class="post-datetime">
						26 Jan 2014, 22:08					</div>
				</div>
				<div class="post-content content">
					<p>Since the end of 6relay I only get IPv6 on public wan interface. The problem remains with the default settings after a new installation.<br/>IPv6 test on the router is correct.<br/>To recap, I have native 6rd.</p><p>Edit: I do not know what really happened, everything is OK after nth installation.</p>											<p class="post-edited">(Last edited by <strong>Manani</strong> on 26 Jan 2014, 22:58)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p224623">
				<div class="post-metadata">
					<div class="post-num">Post #273</div>
					<div class="post-author">cconn</div>
					<div class="post-datetime">
						5 Feb 2014, 21:35					</div>
				</div>
				<div class="post-content content">
					<p>just rebuilt r39479 and the DHCPv6 server is now refusing requests from previously working odhcp6c;</p><p>Feb&nbsp; 5 14:05:53.218: IPv6 DHCP: Received SOLICIT from FE80::68ED:9D14:A4DE:44CC on Virtual-Access3.1104<br/>Feb&nbsp; 5 14:05:53.218: IPv6 DHCP: detailed packet contents<br/>Feb&nbsp; 5 14:05:53.218:&nbsp; &nbsp;src FE80::68ED:9D14:A4DE:44CC (Virtual-Access3.1104)<br/>Feb&nbsp; 5 14:05:53.218:&nbsp; &nbsp;dst FF02::1:2<br/>Feb&nbsp; 5 14:05:53.218:&nbsp; &nbsp;type SOLICIT(1), xid 5331819<br/>Feb&nbsp; 5 14:05:53.218:&nbsp; &nbsp;option ELAPSED-TIME(8), len 2<br/>Feb&nbsp; 5 14:05:53.218:&nbsp; &nbsp; &nbsp;elapsed-time 0<br/>Feb&nbsp; 5 14:05:53.218:&nbsp; &nbsp;option ORO(6), len 20<br/>Feb&nbsp; 5 14:05:53.218:&nbsp; &nbsp; &nbsp;SIP-DOMAIN,SIP-ADDRESS,DNS-SERVERS,DOMAIN-LIST,SNTP-ADDRESS,UNKNOWN,UNKNOWN,UNKNOWN,UNKNOWN,UNKNOWN<br/>Feb&nbsp; 5 14:05:53.218:&nbsp; &nbsp;option CLIENTID(1), len 10<br/>Feb&nbsp; 5 14:05:53.218:&nbsp; &nbsp; &nbsp;00030001F81A67A4BD24<br/>Feb&nbsp; 5 14:05:53.218:&nbsp; &nbsp;option UNKNOWN(39), len 9<br/>Feb&nbsp; 5 14:05:53.218:&nbsp; &nbsp;option IA-NA(3), len 12<br/>Feb&nbsp; 5 14:05:53.218:&nbsp; &nbsp; &nbsp;IAID 0x00000001, T1 0, T2 0<br/>Feb&nbsp; 5 14:05:53.218:&nbsp; &nbsp;option IA-PD(25), len 41<br/>Feb&nbsp; 5 14:05:53.218:&nbsp; &nbsp; &nbsp;IAID 0x00000001, T1 0, T2 0<br/>Feb&nbsp; 5 14:05:53.218:&nbsp; &nbsp; &nbsp;option IAPREFIX(26), len 25<br/>Feb&nbsp; 5 14:05:53.218:&nbsp; &nbsp; &nbsp; &nbsp;preferred 0, valid 0, prefix ::/48<br/>Feb&nbsp; 5 14:05:53.218: IPv6 DHCP: Option UNKNOWN(39) is not processed<br/>Feb&nbsp; 5 14:05:53.218: IPv6 DHCP: Using interface pool v6POOL<br/>Feb&nbsp; 5 14:05:53.218: IPv6 DHCP: No binding for IA_PD 00000001<br/>Feb&nbsp; 5 14:05:53.218: IPv6 DHCP: Reclaiming addresses for client FE80::68ED:9D14:A4DE:44CC 1</p><br/><p>and on the wrt;</p><p>Wed Feb&nbsp; 5 19:15:49 2014 daemon.notice odhcp6c[5678]: (re)starting transaction on pppoe-wan<br/>Wed Feb&nbsp; 5 19:15:49 2014 daemon.notice odhcp6c[5678]: Starting SOLICIT transaction (timeout 4294967295s, max rc 0)<br/>Wed Feb&nbsp; 5 19:15:49 2014 daemon.notice odhcp6c[5678]: Got a valid reply after 6ms<br/>Wed Feb&nbsp; 5 19:15:50 2014 daemon.notice odhcp6c[5678]: Starting SOLICIT transaction (timeout 4294967295s, max rc 0)<br/>Wed Feb&nbsp; 5 19:15:50 2014 daemon.notice odhcp6c[5678]: Got a valid reply after 6ms<br/>Wed Feb&nbsp; 5 19:15:51 2014 daemon.notice odhcp6c[5678]: Starting REQUEST transaction (timeout 4294967295s, max rc 10)<br/>Wed Feb&nbsp; 5 19:15:51 2014 daemon.notice odhcp6c[5678]: Send REQUEST message (elapsed 0ms, rc 0)<br/>Wed Feb&nbsp; 5 19:15:51 2014 daemon.notice odhcp6c[5678]: Got a valid reply after 6ms<br/>Wed Feb&nbsp; 5 19:15:51 2014 daemon.warn odhcp6c[5678]: Server returned IA_NA status 2 (NOADDRS-AVAIL)</p><p>downgraded back to r39379 and its all working again.</p><br/><br/><br/><p>also I seem to have lost the 6relayd config menu in LUCI?&nbsp; what option do I have to enable to get it back?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p224624">
				<div class="post-metadata">
					<div class="post-num">Post #274</div>
					<div class="post-author">CyrusFF</div>
					<div class="post-datetime">
						5 Feb 2014, 21:47					</div>
				</div>
				<div class="post-content content">
					<p>You can configure DHCPv6 alongside DHCP now in the interface config. Static leases can be configured along the dhcp ones. 6relayd is now odhcpd so please check that you have it.</p><p>Will have a look at the dhcpv6 client tomorrow.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p224629">
				<div class="post-metadata">
					<div class="post-num">Post #275</div>
					<div class="post-author">cconn</div>
					<div class="post-datetime">
						5 Feb 2014, 22:08					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>CyrusFF wrote:</cite><blockquote><p>You can configure DHCPv6 alongside DHCP now in the interface config. Static leases can be configured along the dhcp ones. 6relayd is now odhcpd so please check that you have it.</p><p>Will have a look at the dhcpv6 client tomorrow.</p></blockquote></div><br/><p>erf.....6relayd was enabled in the .config but package odhcpd was not....(!!)</p><p>I am trying a rebuild without 6relayd and odhcpd enabled.</p>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 11 of 12</div><nav><ul><li><a href="viewtopic.php%3Fid=40853&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=40853&amp;p=9.html">9</a></li><li><a href="viewtopic.php%3Fid=40853&amp;p=10.html">10</a></li><li class="pagination-current"><span>11</span></li><li><a href="viewtopic.php%3Fid=40853&amp;p=12.html">12</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0.001 -->

</body>
</html>