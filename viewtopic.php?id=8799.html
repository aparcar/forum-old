<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> PPTPD Problems with RC6+Windows VPN</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 22 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p39876">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">cmmtchll</div>
					<div class="post-datetime">
						30 Dec 2006, 11:47					</div>
				</div>
				<div class="post-content content">
					<p>Router:Linksys WRT54G/GS/GL, using RC6<br />Client: Windows Server 2003 VPN (configured for PPTP, MS-CHAPv2)<br />(and I&#039;ve also tries Windows Vista, with no luck)</p><p>Anybody have an idea?&nbsp; I&#039;ve read other posts and tried to install iptables-* packages (and rebooted).</p><p>Clients sometiems error with 619 and sometimes with 809.</p><br /><p>Syslog:<br />Dec 30 01:11:01 (none) kern.notice pppd[2278]: Modem hangup<br />Dec 30 01:11:01 (none) kern.notice pppd[2278]: Connection terminated.<br />Dec 30 01:11:01 (none) kern.info pptpd[2277]: CTRL: Client x.x.x.x control connection finished<br />Dec 30 01:11:01 (none) kern.info pppd[2278]: Exit.<br />Dec 30 01:11:01 (none) kern.err pptpd[2277]: GRE: read(fd=7,buffer=100005c0,len=8196) from PTY failed: status = -1 error = Input/output error, usually caused by unexpected termination of pppd, check option syntax and pppd logs<br />Dec 30 01:11:01 (none) kern.err pptpd[2277]: CTRL: PTY read or GRE write failed (pty,gre)=(7,8)<br />Dec 30 01:11:01 (none) kern.debug pptpd[2277]: CTRL: Reaping child PPP[2278]<br />Dec 30 01:11:00 (none) kern.debug pppd[2278]: sent [LCP ConfRej id=0x8 &lt;pcomp&gt; &lt;accomp&gt; &lt;callback CBCP&gt;]<br />Dec 30 01:11:00 (none) kern.debug pppd[2278]: rcvd [LCP ConfReq id=0x8 &lt;mru 1400&gt; &lt;magic 0x607b6593&gt; &lt;pcomp&gt; &lt;accomp&gt; &lt;callback CBCP&gt;]<br />Dec 30 01:10:58 (none) kern.debug pppd[2278]: sent [LCP ConfReq id=0x1 &lt;mru 1482&gt; &lt;auth chap MS-v2&gt; &lt;magic 0xad9872b0&gt;]<br />Dec 30 01:10:56 (none) kern.debug pppd[2278]: sent [LCP ConfRej id=0x7 &lt;pcomp&gt; &lt;accomp&gt; &lt;callback CBCP&gt;]<br />Dec 30 01:10:56 (none) kern.debug pppd[2278]: rcvd [LCP ConfReq id=0x7 &lt;mru 1400&gt; &lt;magic 0x607b6593&gt; &lt;pcomp&gt; &lt;accomp&gt; &lt;callback CBCP&gt;]<br />Dec 30 01:10:55 (none) kern.debug pppd[2278]: sent [LCP ConfReq id=0x1 &lt;mru 1482&gt; &lt;auth chap MS-v2&gt; &lt;magic 0xad9872b0&gt;]<br />Dec 30 01:10:52 (none) kern.debug pppd[2278]: sent [LCP ConfReq id=0x1 &lt;mru 1482&gt; &lt;auth chap MS-v2&gt; &lt;magic 0xad9872b0&gt;]<br />Dec 30 01:10:52 (none) kern.debug pppd[2278]: sent [LCP ConfRej id=0x6 &lt;pcomp&gt; &lt;accomp&gt; &lt;callback CBCP&gt;]<br />Dec 30 01:10:52 (none) kern.debug pppd[2278]: rcvd [LCP ConfReq id=0x6 &lt;mru 1400&gt; &lt;magic 0x607b6593&gt; &lt;pcomp&gt; &lt;accomp&gt; &lt;callback CBCP&gt;]<br />Dec 30 01:10:49 (none) kern.debug pppd[2278]: sent [LCP ConfReq id=0x1 &lt;mru 1482&gt; &lt;auth chap MS-v2&gt; &lt;magic 0xad9872b0&gt;]<br />Dec 30 01:10:48 (none) kern.debug pppd[2278]: sent [LCP ConfRej id=0x5 &lt;pcomp&gt; &lt;accomp&gt; &lt;callback CBCP&gt;]<br />Dec 30 01:10:48 (none) kern.debug pppd[2278]: rcvd [LCP ConfReq id=0x5 &lt;mru 1400&gt; &lt;magic 0x607b6593&gt; &lt;pcomp&gt; &lt;accomp&gt; &lt;callback CBCP&gt;]<br />Dec 30 01:10:46 (none) kern.debug pppd[2278]: sent [LCP ConfReq id=0x1 &lt;mru 1482&gt; &lt;auth chap MS-v2&gt; &lt;magic 0xad9872b0&gt;]<br />Dec 30 01:10:44 (none) kern.debug pppd[2278]: sent [LCP ConfRej id=0x4 &lt;pcomp&gt; &lt;accomp&gt; &lt;callback CBCP&gt;]<br />Dec 30 01:10:44 (none) kern.debug pppd[2278]: rcvd [LCP ConfReq id=0x4 &lt;mru 1400&gt; &lt;magic 0x607b6593&gt; &lt;pcomp&gt; &lt;accomp&gt; &lt;callback CBCP&gt;]<br />Dec 30 01:10:43 (none) kern.debug pppd[2278]: sent [LCP ConfReq id=0x1 &lt;mru 1482&gt; &lt;auth chap MS-v2&gt; &lt;magic 0xad9872b0&gt;]<br />Dec 30 01:10:40 (none) kern.debug pppd[2278]: sent [LCP ConfReq id=0x1 &lt;mru 1482&gt; &lt;auth chap MS-v2&gt; &lt;magic 0xad9872b0&gt;]<br />Dec 30 01:10:40 (none) kern.debug pppd[2278]: sent [LCP ConfRej id=0x3 &lt;pcomp&gt; &lt;accomp&gt; &lt;callback CBCP&gt;]<br />Dec 30 01:10:40 (none) kern.debug pppd[2278]: rcvd [LCP ConfReq id=0x3 &lt;mru 1400&gt; &lt;magic 0x607b6593&gt; &lt;pcomp&gt; &lt;accomp&gt; &lt;callback CBCP&gt;]<br />Dec 30 01:10:37 (none) kern.debug pppd[2278]: sent [LCP ConfReq id=0x1 &lt;mru 1482&gt; &lt;auth chap MS-v2&gt; &lt;magic 0xad9872b0&gt;]<br />Dec 30 01:10:36 (none) kern.debug pppd[2278]: sent [LCP ConfRej id=0x2 &lt;pcomp&gt; &lt;accomp&gt; &lt;callback CBCP&gt;]<br />Dec 30 01:10:36 (none) kern.debug pppd[2278]: rcvd [LCP ConfReq id=0x2 &lt;mru 1400&gt; &lt;magic 0x607b6593&gt; &lt;pcomp&gt; &lt;accomp&gt; &lt;callback CBCP&gt;]<br />Dec 30 01:10:34 (none) kern.debug pppd[2278]: sent [LCP ConfReq id=0x1 &lt;mru 1482&gt; &lt;auth chap MS-v2&gt; &lt;magic 0xad9872b0&gt;]<br />Dec 30 01:10:33 (none) kern.debug pppd[2278]: sent [LCP ConfRej id=0x1 &lt;pcomp&gt; &lt;accomp&gt; &lt;callback CBCP&gt;]<br />Dec 30 01:10:33 (none) kern.debug pppd[2278]: rcvd [LCP ConfReq id=0x1 &lt;mru 1400&gt; &lt;magic 0x607b6593&gt; &lt;pcomp&gt; &lt;accomp&gt; &lt;callback CBCP&gt;]<br />Dec 30 01:10:31 (none) kern.notice pppd[2278]: pppd 2.4.3 started by root, uid 0<br />Dec 30 01:10:31 (none) kern.notice pppd[2278]: Connect: ppp0 &lt;--&gt; /dev/pts/0<br />Dec 30 01:10:31 (none) kern.info pptpd[2277]: CTRL: Starting call (launching pppd, opening GRE)<br />Dec 30 01:10:31 (none) kern.info pptpd[2277]: CTRL: Client x.x.x.x control connection started<br />Dec 30 01:10:31 (none) kern.info pppd[2278]: Using interface ppp0<br />Dec 30 01:10:31 (none) kern.debug pppd[2278]: using channel 7<br />Dec 30 01:10:31 (none) kern.debug pppd[2278]: sent [LCP ConfReq id=0x1 &lt;mru 1482&gt; &lt;auth chap MS-v2&gt; &lt;magic 0xad9872b0&gt;]<br />Dec 30 01:10:31 (none) kern.debug pppd[2278]: sent [LCP ConfRej id=0x0 &lt;pcomp&gt; &lt;accomp&gt; &lt;callback CBCP&gt;]<br />Dec 30 01:10:31 (none) kern.debug pppd[2278]: rcvd [LCP ConfReq id=0x0 &lt;mru 1400&gt; &lt;magic 0x607b6593&gt; &lt;pcomp&gt; &lt;accomp&gt; &lt;callback CBCP&gt;]</p><p>etc/firewall.user<br />### Allow PPTP control connections from WAN<br />iptables -t nat -A prerouting_rule -i $WAN -p tcp --dport 1723 -j ACCEPT<br />iptables&nbsp; &nbsp; &nbsp; &nbsp; -A input_rule&nbsp; &nbsp; &nbsp; -i $WAN -p tcp --dport 1723 -j ACCEPT<br />### Allow GRE protocol (used by PPTP data stream)<br />iptables&nbsp; &nbsp; &nbsp; &nbsp; -A output_rule&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-p 47&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-j ACCEPT<br />iptables&nbsp; &nbsp; &nbsp; &nbsp; -A input_rule&nbsp; &nbsp; &nbsp; </p><p>etc/ppp/options.pptpd<br />debug<br />logfile /tmp/pptp-server.log<br />192.168.200.1:<br />auth<br />name &quot;pptp-server&quot;<br />lcp-echo-failure 3<br />lcp-echo-interval 60<br />default-asyncmap<br />mtu 1482<br />mru 1482<br />nobsdcomp<br />nodeflate<br />proxyarp<br />#noproxyarp<br />#nomppc<br />mppe required,no40,no56,stateless<br />require-mschap-v2<br />#refuse-chap<br />#refuse-mschap<br />#refuse-eap<br />#refuse-pap<br />#ms-dns 172.16.1.1<br />#plugin radius.so<br />#radius-config-file /etc/radius.conf</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p40469">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">Sonic</div>
					<div class="post-datetime">
						8 Jan 2007, 18:39					</div>
				</div>
				<div class="post-content content">
					<p>check ### Allow GRE protocol ..<br />You have forget :<br /></p><div class="codebox"><pre><code>iptables        -A input_rule              -p 47               -j ACCEPT</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p40520">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">cmmtchll</div>
					<div class="post-datetime">
						9 Jan 2007, 09:00					</div>
				</div>
				<div class="post-content content">
					<p>My paste jub was bad and in fact did include that.&nbsp; After much mroe experimentation I discovered a separate router/NAT/firewall between my client and the destination.&nbsp; I&#039;ve corrected that problem and everything is good.</p><p>Incidentally, I ended up having wonderful success with OpenVPN which adds some additional capabilities that I rather like.&nbsp; </p><p>Thanks.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p40554">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">Sonic</div>
					<div class="post-datetime">
						9 Jan 2007, 22:28					</div>
				</div>
				<div class="post-content content">
					<p>pptpd server need kmod-gre too.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>