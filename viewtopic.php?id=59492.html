<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> A problem in configuring Wifidog on Openwrt 14.07</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 31 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p291036">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">sergeblr</div>
					<div class="post-datetime">
						9 Sep 2015, 16:56					</div>
				</div>
				<div class="post-content content">
					<p>Hello<br />TPLink WR841ND<br />Barrier Breaker 14.07 + Luci + latest wifidog<br />(not using Chaos Calmer coz there is not enough space for wifidog left when flashed it + luci)<br />Wifidog working properly as need only if i set in &quot;GatewayInterface wlan0&quot;, if i try to create new interfaces (wlan0-1, wlan0-2) and setup &quot;GatewayInterface wlan0-1&quot;, wifidog not working properly and allow access to wifi users behind this inetrface without auth page. So wifidog can be used only with default wlan0 interface or i missed something in settings?<br />Thanks for help, sorry for eng.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p291120">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">sergeblr</div>
					<div class="post-datetime">
						10 Sep 2015, 10:55					</div>
				</div>
				<div class="post-content content">
					<p>Nobody using wifidog?<br />May be somebody can tell which captive portal actual today? Thanks.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p291131">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">makarel</div>
					<div class="post-datetime">
						10 Sep 2015, 14:38					</div>
				</div>
				<div class="post-content content">
					<p>hi</p><p>check those<br /><a href="http://wiki.openwrt.org/doc/howto/wireless.hotspot.wifidog">http://wiki.openwrt.org/doc/howto/wirel â€¦ ot.wifidog</a><br /><a href="http://dev.wifidog.org/">http://dev.wifidog.org/</a><br /><a href="https://forum.openwrt.org/viewtopic.php?id=24926">https://forum.openwrt.org/viewtopic.php?id=24926</a><br />plenty of wiki</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p291137">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">yapoo</div>
					<div class="post-datetime">
						10 Sep 2015, 15:57					</div>
				</div>
				<div class="post-content content">
					<p>cat /etc/config/wifi<br />cat /etc/config/network<br />cat /etc/wifidog.conf</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p291140">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">augustus_meyer</div>
					<div class="post-datetime">
						10 Sep 2015, 17:20					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>sergeblr wrote:</cite><blockquote><p>Nobody using wifidog?<br />May be somebody can tell which captive portal actual today? Thanks.</p></blockquote></div><p>coova-chilli. However, it is a steep learning curve :-)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p292369">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">sergeblr</div>
					<div class="post-datetime">
						18 Sep 2015, 13:49					</div>
				</div>
				<div class="post-content content">
					<p>Hi all, sorry for long answer:</p><p>/etc/config/wireless:<br /></p><div class="codebox"><pre><code>config wifi-device &#039;radio0&#039;
    option type &#039;mac80211&#039;
    option hwmode &#039;11g&#039;
    option path &#039;platform/qca953x_wmac&#039;
    option htmode &#039;HT20&#039;
    option country &#039;BY&#039;
    option txpower &#039;20&#039;
    option channel &#039;9&#039;

config wifi-iface
    option device &#039;radio0&#039;
    option mode &#039;ap&#039;
    option ssid &#039;NewMain&#039;
    option encryption &#039;psk-mixed&#039;
    option key &#039;********&#039;
    option network &#039;WLAN1&#039;

config wifi-iface
    option device &#039;radio0&#039;
    option mode &#039;ap&#039;
    option ssid &#039;GuestNew&#039;
    option network &#039;Guest&#039;
    option encryption &#039;psk-mixed&#039;
    option key &#039;********&#039;

config wifi-iface
    option device &#039;radio0&#039;
    option mode &#039;ap&#039;
    option ssid &#039;New1&#039;
    option network &#039;wlanad&#039;
    option encryption &#039;psk-mixed&#039;
    option key &#039;********&#039;</code></pre></div><br /><p>/etc/config/network:<br /></p><div class="codebox"><pre><code>config interface &#039;loopback&#039;
    option ifname &#039;lo&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;127.0.0.1&#039;
    option netmask &#039;255.0.0.0&#039;

config globals &#039;globals&#039;
    option ula_prefix &#039;fdea:4cee:d193::/48&#039;

config interface &#039;lan&#039;
    option ifname &#039;eth0&#039;
    option force_link &#039;1&#039;
    option type &#039;bridge&#039;
    option proto &#039;static&#039;
    option netmask &#039;255.255.255.0&#039;
    option ip6assign &#039;60&#039;
    option ipaddr &#039;192.168.25.1&#039;
    option gateway &#039;192.168.23.1&#039;
    option dns &#039;82.209.195.12 8.8.4.4&#039;

config interface &#039;wan&#039;
    option ifname &#039;eth1&#039;
    option _orig_ifname &#039;eth1&#039;
    option _orig_bridge &#039;false&#039;
    option proto &#039;static&#039;
    option netmask &#039;255.255.255.0&#039;
    option ipaddr &#039;192.168.23.2&#039;
    option gateway &#039;192.168.23.1&#039;
    option dns &#039;82.209.195.12 8.8.4.4&#039;

config interface &#039;wan6&#039;
    option ifname &#039;@wan&#039;
    option proto &#039;dhcpv6&#039;

config switch
    option name &#039;switch0&#039;
    option reset &#039;1&#039;
    option enable_vlan &#039;1&#039;

config switch_vlan
    option device &#039;switch0&#039;
    option vlan &#039;1&#039;
    option ports &#039;0 1 2 3 4&#039;

config interface &#039;Guest&#039;
    option _orig_ifname &#039;radio0.network2&#039;
    option _orig_bridge &#039;false&#039;
    option proto &#039;static&#039;
    option netmask &#039;255.255.255.0&#039;
    option ipaddr &#039;192.168.32.1&#039;
    option gateway &#039;192.168.23.1&#039;
    option dns &#039;82.209.195.12 8.8.4.4&#039;

config interface &#039;WLAN1&#039;
    option proto &#039;static&#039;
    option netmask &#039;255.255.255.0&#039;
    option ipaddr &#039;192.168.26.1&#039;
    option gateway &#039;192.168.23.1&#039;
    option dns &#039;82.209.195.12 8.8.4.4&#039;

config interface &#039;wlanad&#039;
    option _orig_ifname &#039;wlan0-2&#039;
    option _orig_bridge &#039;false&#039;
    option proto &#039;static&#039;
    option netmask &#039;255.255.255.0&#039;
    option gateway &#039;192.168.23.1&#039;
    option dns &#039;82.209.195.12 8.8.4.4&#039;
    option ipaddr &#039;192.168.223.1&#039;</code></pre></div><br /><p>wifidog.conf:<br /></p><div class="codebox"><pre><code>GatewayID node1

# When GatewayInterface is wlan0 - Wifi on wlan0 is worked fine (redirecting users to auth server etc...)
GatewayInterface wlan0-2

AuthServer {
    Hostname ***.by
    HTTPPort 8080
    Path /
}

ClientTimeout 5

FirewallRuleSet global {
}

FirewallRuleSet validating-users {
    FirewallRule allow to 0.0.0.0/0
}

FirewallRuleSet known-users {
    FirewallRule allow to 0.0.0.0/0
}

FirewallRuleSet unknown-users {
    FirewallRule allow udp port 53
    FirewallRule allow tcp port 53
    FirewallRule allow udp port 67
    FirewallRule allow tcp port 67
}

FirewallRuleSet locked-users {
    FirewallRule block to 0.0.0.0/0
}</code></pre></div><br /><p>And:<br />/etc/config$ ifconfig<br /></p><div class="codebox"><pre><code>br-lan    Link encap:Ethernet  HWaddr 30:B5:C2:3F:75:38  
          inet addr:192.168.25.1  Bcast:192.168.25.255  Mask:255.255.255.0
          inet6 addr: fdea:4cee:d193::1/60 Scope:Global
          UP BROADCAST MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)

eth0      Link encap:Ethernet  HWaddr 30:B5:C2:3F:75:38  
          UP BROADCAST MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)
          Interrupt:5 

eth1      Link encap:Ethernet  HWaddr 30:B5:C2:3F:75:39  
          inet addr:192.168.23.2  Bcast:192.168.23.255  Mask:255.255.255.0
          inet6 addr: fdea:4cee:d193::bfd/128 Scope:Global
          inet6 addr: fdea:4cee:d193:0:32b5:c2ff:fe3f:7539/64 Scope:Global
          inet6 addr: fdea:4cee:d193:4::bfd/128 Scope:Global
          inet6 addr: fe80::32b5:c2ff:fe3f:7539/64 Scope:Link
          inet6 addr: fdea:4cee:d193:4:32b5:c2ff:fe3f:7539/64 Scope:Global
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:10539300 errors:0 dropped:0 overruns:0 frame:0
          TX packets:5529364 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:1083563876 (1.0 GiB)  TX bytes:578932219 (552.1 MiB)
          Interrupt:4 

lo        Link encap:Local Loopback  
          inet addr:127.0.0.1  Mask:255.0.0.0
          inet6 addr: ::1/128 Scope:Host
          UP LOOPBACK RUNNING  MTU:65536  Metric:1
          RX packets:24672 errors:0 dropped:0 overruns:0 frame:0
          TX packets:24672 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:1377205 (1.3 MiB)  TX bytes:1377205 (1.3 MiB)

wlan0     Link encap:Ethernet  HWaddr 30:B5:C2:3F:75:38  
          inet addr:192.168.26.1  Bcast:192.168.26.255  Mask:255.255.255.0
          inet6 addr: fe80::32b5:c2ff:fe3f:7538/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:29566 errors:0 dropped:0 overruns:0 frame:0
          TX packets:43590 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:4306262 (4.1 MiB)  TX bytes:48566953 (46.3 MiB)

wlan0-1   Link encap:Ethernet  HWaddr 32:B5:C2:3F:75:37  
          inet addr:192.168.32.1  Bcast:192.168.32.255  Mask:255.255.255.0
          inet6 addr: fe80::30b5:c2ff:fe3f:7537/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:4 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:0 (0.0 B)  TX bytes:480 (480.0 B)

wlan0-2   Link encap:Ethernet  HWaddr 32:B5:C2:3F:75:38  
          inet addr:192.168.223.1  Bcast:192.168.223.255  Mask:255.255.255.0
          inet6 addr: fe80::30b5:c2ff:fe3f:7538/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:879 errors:0 dropped:0 overruns:0 frame:0
          TX packets:903 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:158741 (155.0 KiB)  TX bytes:555385 (542.3 KiB)</code></pre></div>											<p class="post-edited">(Last edited by <strong>sergeblr</strong> on 18 Sep 2015, 13:55)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p292388">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">yapoo</div>
					<div class="post-datetime">
						18 Sep 2015, 15:52					</div>
				</div>
				<div class="post-content content">
					<p>first of all, <br />/etc/init.d/wifidog stop<br />then, connect ssid of wlan0-2 from pc. You can access the Net?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p292495">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">sergeblr</div>
					<div class="post-datetime">
						19 Sep 2015, 02:08					</div>
				</div>
				<div class="post-content content">
					<p>Hi, yes, from wlan0-2 Internet is accessable when wifidog is stopped, and also without any authorization when it started.</p>											<p class="post-edited">(Last edited by <strong>sergeblr</strong> on 19 Sep 2015, 12:27)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p292652">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">yapoo</div>
					<div class="post-datetime">
						20 Sep 2015, 02:26					</div>
				</div>
				<div class="post-content content">
					<p>How about <br />GatewayInterface wlanad</p><p>Do you need &#039;option dns&#039; and &#039;option gateway&#039; on lan, Guest, WLAN1 and wlanad interfaces?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p294066">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">sergeblr</div>
					<div class="post-datetime">
						30 Sep 2015, 16:16					</div>
				</div>
				<div class="post-content content">
					<p>Solved!!!<br />Thanks to all, found somewhere on this forum and added next lines to /etc/network/wireless at my wireless ap section:<br /></p><div class="codebox"><pre><code>option ifname &#039;wlanx&#039;</code></pre></div><p>and when i looking ifconfig new name of my wifi interface is &quot;wlanx&quot; and i setting it to GatewayInterface in wifidog.conf -&gt; all working fine as i need.</p><p>So there is some reason that wifidog cannot use created interface by it default name (excluding default eth0, wlan0, br-lan, etc)<br />Thanks to all!</p>											<p class="post-edited">(Last edited by <strong>sergeblr</strong> on 30 Sep 2015, 21:18)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>