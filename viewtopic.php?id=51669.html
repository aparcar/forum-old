<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> SOLVED: Guest WLAN: WLAN -&gt; Tagged Vlan -&gt; Untagged Vlan on Port</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 17 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p240446">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">norcon</div>
					<div class="post-datetime">
						16 Jul 2014, 20:32					</div>
				</div>
				<div class="post-content content">
					<p>Hi Guys,</p><p>i am trying the following, but did not succeded. So i decided to write a post.</p><p>Hardware:<br />2 x TP-Link TL-WR841N/ND v9<br />Installed: OpenWrt Barrier Breaker 14.07-rc1 / LuCI Trunk (svn-r10457)</p><p>What i want to have at the end:</p><p>All Traffic from GAST WLAN shoud be routed into VLAN 12 and tagged on one Network port. At the second device. the tagged traffic should be received and translated into a second port but untagged. So i can connect the Port4 of my Fritz!Box to the second WR841N on Untagged VLAN 12 Port and the guest traffic will be routed tagged through the private network to the Access Point and its SSID GAST.</p><p>Fritz!Box [Port 4] &lt;--&gt; [Port 1 untagged VLAN 12] on receiving station (the second WR841N v9) [Port 4 untagged private and tagged VLAN 12] &lt;--&gt; [Port 1 untagged private and tagged VLAN 12] on WR841N v9 as Access Point &lt;--&gt; VLAN 12 untagged to SSID GAST</p><p>One TP-Link has to be an Access Point with 2 SSIDs: WLAN and GAST. This is not the ptoblem.<br /><span class="postimg"><img src="http://pic.mirror8.de/di/8ML0/1.jpg" alt="http://pic.mirror8.de/di/8ML0/1.jpg" /></span></p><p><span class="postimg"><img src="http://pic.mirror8.de/di/S8X2/2.jpg" alt="http://pic.mirror8.de/di/S8X2/2.jpg" /></span></p><p>Now i created VLAN 12Interface:<br /><span class="postimg"><img src="http://pic.mirror8.de/di/0MAX/4.jpg" alt="http://pic.mirror8.de/di/0MAX/4.jpg" /></span></p><p>I Created an own network interface called GAST and bridged the VLAN 12 (eth0.12) with wireless lan GAST<br /><span class="postimg"><img src="http://pic.mirror8.de/di/JU7T/3.jpg" alt="http://pic.mirror8.de/di/JU7T/3.jpg" /></span></p><p>So every packet from WLAN GAST is bridged through eth0.12. And with the VLAn Config the Traffic from VLAN 12 is tagged to Port 1.</p><p>On the receiving station (the second WR841N v9) i configured like this:</p><p>I created VLAN 12 untagged on Port 1 to connect this to Fritz!Box Guest Port 4 and tagged to Port 4 on the receiving station&nbsp; . This Port is myprivate network where the access point is connected.<br /><span class="postimg"><img src="http://pic.mirror8.de/di/KKBG/5.jpg" alt="http://pic.mirror8.de/di/KKBG/5.jpg" /></span></p><br /><br /><br /><p>My Problem: It will not work! What am i doing wrong?</p><p>Thank you for your help!</p>											<p class="post-edited">(Last edited by <strong>norcon</strong> on 23 Jul 2014, 11:07)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p240451">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">neryba</div>
					<div class="post-datetime">
						16 Jul 2014, 21:19					</div>
				</div>
				<div class="post-content content">
					<p>You need to add tagged CPU port to vlan12. Wifi is on CPU side and this is not connected to your switch0.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p240454">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">norcon</div>
					<div class="post-datetime">
						16 Jul 2014, 21:37					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>neryba wrote:</cite><blockquote><p>You need to add tagged CPU port to vlan12. Wifi is on CPU side and this is not connected to your switch0.</p></blockquote></div><br /><p>I am sorry, but now the system is not reachable anymore <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> Other ideas?</p><p><span class="postimg"><img src="http://pic.mirror8.de/di/0YLI/6.jpg" alt="http://pic.mirror8.de/di/0YLI/6.jpg" /></span></p><p><span class="postimg"><img src="http://pic.mirror8.de/di/HLL4/7.jpg" alt="http://pic.mirror8.de/di/HLL4/7.jpg" /></span></p>											<p class="post-edited">(Last edited by <strong>norcon</strong> on 16 Jul 2014, 21:38)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p240457">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">neryba</div>
					<div class="post-datetime">
						16 Jul 2014, 21:45					</div>
				</div>
				<div class="post-content content">
					<p>try also set tagged CPU on vlan1.<br />Can you print network config file? /etc/config/network maybe you need also edit LAN network from eth0 to eth0.1</p>											<p class="post-edited">(Last edited by <strong>neryba</strong> on 16 Jul 2014, 21:48)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p240463">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">qasdfdsaq</div>
					<div class="post-datetime">
						16 Jul 2014, 22:10					</div>
				</div>
				<div class="post-content content">
					<p>Which part does not work? You need to isolate each component seeing as this is a complicated setup.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p240469">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">norcon</div>
					<div class="post-datetime">
						16 Jul 2014, 22:35					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>qasdfdsaq wrote:</cite><blockquote><p>Which part does not work? You need to isolate each component seeing as this is a complicated setup.</p></blockquote></div><p>I can not transfer data over VLAN 12. Everything else seems to work.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p240471">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">norcon</div>
					<div class="post-datetime">
						16 Jul 2014, 22:37					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>neryba wrote:</cite><blockquote><p>try also set tagged CPU on vlan1.<br />Can you print network config file? /etc/config/network maybe you need also edit LAN network from eth0 to eth0.1</p></blockquote></div><p>If i set&nbsp; tagged CPU on vlan1, the system not not reachable anymore.</p><p>Here the config:</p><p>root@TP-Link1:~# cat /etc/config/network</p><p>config interface &#039;loopback&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname &#039;lo&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;static&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr &#039;127.0.0.1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask &#039;255.0.0.0&#039;</p><p>config globals &#039;globals&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ula_prefix &#039;fd5b:f5b0:f5f7::/48&#039;</p><p>config interface &#039;lan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname &#039;eth0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option force_link &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option type &#039;bridge&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;static&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr &#039;192.168.1.18&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask &#039;255.255.255.0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ip6assign &#039;60&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option gateway &#039;192.168.1.1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option dns &#039;192.168.1.1&#039;</p><p>config interface &#039;wan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname &#039;eth1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;dhcp&#039;</p><p>config interface &#039;wan6&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname &#039;@wan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;dhcpv6&#039;</p><p>config switch<br />&nbsp; &nbsp; &nbsp; &nbsp; option name &#039;switch0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option reset &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option enable_vlan &#039;1&#039;</p><p>config switch_vlan<br />&nbsp; &nbsp; &nbsp; &nbsp; option device &#039;switch0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option vlan &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ports &#039;0 1 2 3 4&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option vid &#039;1&#039;</p><p>config interface &#039;GAST&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;none&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option auto &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option type &#039;bridge&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option _orig_ifname &#039;wlan0-1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option _orig_bridge &#039;true&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname &#039;eth0.12&#039;</p><p>config switch_vlan<br />&nbsp; &nbsp; &nbsp; &nbsp; option device &#039;switch0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option vlan &#039;2&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ports &#039;4t&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option vid &#039;12&#039;</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p240475">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">neryba</div>
					<div class="post-datetime">
						16 Jul 2014, 22:55					</div>
				</div>
				<div class="post-content content">
					<p>I think this is right (edited)</p><div class="codebox"><pre><code>config interface &#039;loopback&#039;
        option ifname &#039;lo&#039;
        option proto &#039;static&#039;
        option ipaddr &#039;127.0.0.1&#039;
        option netmask &#039;255.0.0.0&#039;

config globals &#039;globals&#039;
        option ula_prefix &#039;fd5b:f5b0:f5f7::/48&#039;

config interface &#039;lan&#039;
        option ifname &#039;eth0.1&#039;
        option force_link &#039;1&#039;
        option type &#039;bridge&#039;
        option proto &#039;static&#039;
        option ipaddr &#039;192.168.1.18&#039;
        option netmask &#039;255.255.255.0&#039;
        option ip6assign &#039;60&#039;
        option gateway &#039;192.168.1.1&#039;
        option dns &#039;192.168.1.1&#039;

config interface &#039;wan&#039;
        option ifname &#039;eth1&#039;
        option proto &#039;dhcp&#039;

config interface &#039;wan6&#039;
        option ifname &#039;@wan&#039;
        option proto &#039;dhcpv6&#039;

config switch
        option name &#039;switch0&#039;
        option reset &#039;1&#039;
        option enable_vlan &#039;1&#039;

config switch_vlan
        option device &#039;switch0&#039;
        option vlan &#039;1&#039;
        option ports &#039;0t 1 2 3 4&#039;
        option vid &#039;1&#039;

config interface &#039;GAST&#039;
        option proto &#039;none&#039;
        option auto &#039;1&#039;
        option type &#039;bridge&#039;
        option ifname &#039;eth0.12&#039;

config switch_vlan
        option device &#039;switch0&#039;
        option vlan &#039;12&#039;
        option ports &#039;0t 4t&#039;
        option vid &#039;12&#039;</code></pre></div>											<p class="post-edited">(Last edited by <strong>neryba</strong> on 16 Jul 2014, 23:01)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p240479">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">norcon</div>
					<div class="post-datetime">
						16 Jul 2014, 23:04					</div>
				</div>
				<div class="post-content content">
					<p>You are so right! The eth0.1 and untagged to tagged for CPU Port did the trick. Thank you man...</p><p>To help others, here my network config:</p><p>===================================================<br />AP System:<br />root@TP-Link1:~# cat /etc/config/network</p><p>config interface &#039;loopback&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname &#039;lo&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;static&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr &#039;127.0.0.1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask &#039;255.0.0.0&#039;</p><p>config globals &#039;globals&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ula_prefix &#039;fd5b:f5b0:f5f7::/48&#039;</p><p>config interface &#039;lan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname &#039;eth0.1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option force_link &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option type &#039;bridge&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;static&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr &#039;192.168.1.18&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask &#039;255.255.255.0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ip6assign &#039;60&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option gateway &#039;192.168.1.1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option dns &#039;192.168.1.1&#039;</p><p>config interface &#039;wan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname &#039;eth1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;dhcp&#039;</p><p>config interface &#039;wan6&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname &#039;@wan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;dhcpv6&#039;</p><p>config switch<br />&nbsp; &nbsp; &nbsp; &nbsp; option name &#039;switch0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option reset &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option enable_vlan &#039;1&#039;</p><p>config switch_vlan<br />&nbsp; &nbsp; &nbsp; &nbsp; option device &#039;switch0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option vlan &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ports &#039;0t 1 2 3 4&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option vid &#039;1&#039;</p><p>config interface &#039;GAST&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;none&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option auto &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option type &#039;bridge&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname &#039;eth0.12&#039;</p><p>config switch_vlan<br />&nbsp; &nbsp; &nbsp; &nbsp; option device &#039;switch0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option vlan &#039;12&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option vid &#039;12&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ports &#039;0t 2t&#039;</p><p>========================================================<br />Receiver Device</p><p>root@OpenWrt:~# cat /etc/config/network</p><p>config interface &#039;loopback&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname &#039;lo&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;static&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr &#039;127.0.0.1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask &#039;255.0.0.0&#039;</p><p>config globals &#039;globals&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ula_prefix &#039;fd9e:1018:5f93::/48&#039;</p><p>config interface &#039;lan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option force_link &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option type &#039;bridge&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;static&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask &#039;255.255.255.0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ip6assign &#039;60&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr &#039;192.168.1.16&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option gateway &#039;192.168.1.1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option dns &#039;192.168.1.1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option _orig_ifname &#039;eth0 radio0.network1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option _orig_bridge &#039;true&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname &#039;eth0.1&#039;</p><p>config interface &#039;wan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname &#039;eth1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;dhcp&#039;</p><p>config interface &#039;wan6&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname &#039;@wan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;dhcpv6&#039;</p><p>config switch<br />&nbsp; &nbsp; &nbsp; &nbsp; option name &#039;switch0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option reset &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option enable_vlan &#039;1&#039;</p><p>config switch_vlan<br />&nbsp; &nbsp; &nbsp; &nbsp; option device &#039;switch0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option vlan &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option vid &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ports &#039;0t 2 3 4&#039;</p><p>config switch_vlan<br />&nbsp; &nbsp; &nbsp; &nbsp; option device &#039;switch0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option vlan &#039;2&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option vid &#039;12&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ports &#039;0t 1 4t&#039;</p><p>config interface &#039;GAST&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname &#039;eth0.12&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option _orig_ifname &#039;eth0.12&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option _orig_bridge &#039;false&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;none&#039;</p>											<p class="post-edited">(Last edited by <strong>norcon</strong> on 16 Jul 2014, 23:34)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p240487">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">neryba</div>
					<div class="post-datetime">
						16 Jul 2014, 23:43					</div>
				</div>
				<div class="post-content content">
					<p>If I understand yours plan right, in receiver device you don&#039;t need interface GAST, and switch config could be </p><div class="codebox"><pre><code>config switch_vlan
        option device &#039;switch0&#039;
        option vlan &#039;12&#039;
        option vid &#039;12&#039;
        option ports &#039;1 4t&#039;</code></pre></div><p> Because there NO network packets what need send to CPU</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p240493">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">norcon</div>
					<div class="post-datetime">
						17 Jul 2014, 00:08					</div>
				</div>
				<div class="post-content content">
					<p>Thanks neryba, i changed it.</p><p>Now another problem. if i connect an pc to the untagged port of the receiving device, i got a ping and everything is fine. if i now connect the untagged port to port 4 of the fritz box and the tagged 1 and 12 port to a free port of the fritz box i get an loop.</p><p>Nothing is working anymore till i disconnect one of the both cables of the receiving device. Why? Tagged and untagged port should be isolated and a loop not possible.</p><p>Is there any option i missed?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p240494">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">neryba</div>
					<div class="post-datetime">
						17 Jul 2014, 00:19					</div>
				</div>
				<div class="post-content content">
					<p>Sorry I didn&#039;t understand topology from you post, can you create a picture?<br />Anyway you can add option stp to&nbsp; lan inteface protect from looping </p><div class="codebox"><pre><code>option stp      &#039;1&#039;</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p240495">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">norcon</div>
					<div class="post-datetime">
						17 Jul 2014, 00:20					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>neryba wrote:</cite><blockquote><p>Sorry I didn&#039;t understand topology from you post, can you create a picture?<br />Anyway you can add option stp to&nbsp; lan inteface protect from looping </p><div class="codebox"><pre><code>option stp      &#039;1&#039;</code></pre></div></blockquote></div><br /><p>I tested it allready, but no chance. now i test to use the wan port (eth1) for the second connection to fritz!box</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p240500">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">norcon</div>
					<div class="post-datetime">
						17 Jul 2014, 00:43					</div>
				</div>
				<div class="post-content content">
					<p>here what i want to realize in a map <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> hope u understand:</p><p><span class="postimg"><img src="http://pic.mirror8.de/di/LQ7W/map.jpg" alt="http://pic.mirror8.de/di/LQ7W/map.jpg" /></span></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p240502">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">norcon</div>
					<div class="post-datetime">
						17 Jul 2014, 00:50					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>neryba wrote:</cite><blockquote><p>Anyway you can add option stp to&nbsp; lan inteface protect from looping </p><div class="codebox"><pre><code>option stp      &#039;1&#039;</code></pre></div></blockquote></div><p>With STP Option it is looping anyway.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p240591">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">neryba</div>
					<div class="post-datetime">
						17 Jul 2014, 22:26					</div>
				</div>
				<div class="post-content content">
					<p>Has your switch support vlan tagging/trunk? Network packet with vlan is bigger than typical network packet. So if your switch doesn&#039;t support that cannot send this packages, if yes, you don&#039;t need &quot;receiving device&quot; at all.<br />You can try connect cable from switch to port 3 on &quot;receiving device&quot; and from port 4 direct to &quot;AP device&quot;. OR use for connecting from switch on &quot;receiving device&quot; eth1, then all traffic goes via CPU and stp command will help you.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p240622">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">qasdfdsaq</div>
					<div class="post-datetime">
						18 Jul 2014, 01:19					</div>
				</div>
				<div class="post-content content">
					<p>Looks like you&#039;re getting a loop because you <em>have</em> a loop. Unless both the fritzbox and private network switch support VLANs properly you&#039;ll get random awkward behaviours.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p240721">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">norcon</div>
					<div class="post-datetime">
						18 Jul 2014, 21:45					</div>
				</div>
				<div class="post-content content">
					<p>But why? If i connect port 1 of receiving device to&nbsp; fritz box port 4 it thould not cause a loop, because port 1 is untagged and so a loop should not be possible?!</p><p>A direct connection is not possible between AP and receiving device.</p><p>Any other ideas?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p240725">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">norcon</div>
					<div class="post-datetime">
						18 Jul 2014, 22:48					</div>
				</div>
				<div class="post-content content">
					<p>i think i get a loop packet, because port 1 to 4 is a built-in switch.</p><p>So another question. How to use eth1 (wan interface) as untagged vlan 12 port?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p240726">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">norcon</div>
					<div class="post-datetime">
						18 Jul 2014, 23:07					</div>
				</div>
				<div class="post-content content">
					<p>No chance. i got it, but i receive a loop to <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p240727">
				<div class="post-metadata">
					<div class="post-num">Post #21</div>
					<div class="post-author">neryba</div>
					<div class="post-datetime">
						18 Jul 2014, 23:25					</div>
				</div>
				<div class="post-content content">
					<p>try create this </p><div class="codebox"><pre><code>config interface &#039;GAST&#039;
        option proto &#039;none&#039;
        option type &#039;bridge&#039;
        option ifname &#039;eth0.12 eth1.1&#039;
        option stp      &#039;1&#039;
        option auto &#039;1&#039;

config switch_vlan
        option device &#039;switch0&#039;
        option vlan &#039;12&#039;
        option vid &#039;12&#039;
        option ports &#039;0t 4t&#039;

config switch_vlan
        option device &#039;switch0&#039;
        option vlan &#039;1&#039;
        option ports &#039;0t 1 2 3 4t&#039;
        option vid &#039;1&#039;</code></pre></div><p>Connect cable from main router to wan port. Also you need remove wan and wan6 intefaces. And enable receiving tagged vlan1 packages on AP.<br />But what main switch do you have? Can you give model name?</p>											<p class="post-edited">(Last edited by <strong>neryba</strong> on 18 Jul 2014, 23:29)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p240876">
				<div class="post-metadata">
					<div class="post-num">Post #22</div>
					<div class="post-author">qasdfdsaq</div>
					<div class="post-datetime">
						20 Jul 2014, 21:25					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>norcon wrote:</cite><blockquote><p>But why? If i connect port 1 of receiving device to&nbsp; fritz box port 4 it thould not cause a loop, because port 1 is untagged and so a loop should not be possible?!</p></blockquote></div><p>Because if the device is not designed to handle VLANs then any number of things can happen, most commonly treating tagged frames as untagged or vice versa.</p><div class="quotebox"><blockquote><p>A direct connection is not possible between AP and receiving device.</p></blockquote></div><p>How not? if they are both connected to the same switch unless the switch is hundreds of metres long I cannot see any reason why you can&#039;t connect the cables together.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p241146">
				<div class="post-metadata">
					<div class="post-num">Post #23</div>
					<div class="post-author">norcon</div>
					<div class="post-datetime">
						23 Jul 2014, 11:05					</div>
				</div>
				<div class="post-content content">
					<p>Now i found a solution. But without openWRT and TP-Link System.<br />I used my Raspberry Pi with Raspbian and connected an addititional USB Ethernet Adapter. Now i have two MAC Addresses and a loop can&#039;t be created. </p><p>The one Port is untagged VLAN 12 and the other tagged 12 and untagged 1.</p><p>I am happy now! <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>