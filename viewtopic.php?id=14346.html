<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> New OpenWrt package: Driver for Velleman K8055 USB I/O board</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 3 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p62674">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">Sempher_Pie</div>
					<div class="post-datetime">
						1 Feb 2008, 19:03					</div>
				</div>
				<div class="post-content content">
					<p>I have written a driver for the <a href="http://www.velleman.be/ot/en/product/view/?id=351346">Velleman K8055 USB Experiment Interface Board</a>.<br />The K8055 is an USB device which gives the user several digital and analog inputs and outputs.</p><p>The package is hosted on sourceforge and named &#039;K8055 Driver&#039; (k8055d).<br /><a href="http://sourceforge.net/projects/k8055d/">http://sourceforge.net/projects/k8055d/</a></p><p>From the package description:<br /></p><div class="quotebox"><blockquote><p>In need of (extra) gpio ports? If you have an openwrt compatible<br />router with USB ports like the Asus WL500gP then this may<br />no longer be a problem. This driver provides a /proc interface for<br />the in- and outputs of the Velleman K8055. Up to 4 boards are supported,<br />A single K8055 provides 5 inputs and 8 outputs (digital), 2 analog in-<br />and 2 analog outputs with 8bit resolution and 2 16bit counters.<br />The /proc interface allows the inputs and outputs to be read from and<br />written to as if they were a file.</p></blockquote></div><p>I have only been able to test the driver on my own OpenWrt device (Asus WL500gP) that is running Kamikaze 7.09 (kernel 2.4 bcrm). 2.6 support will hopefully be finished in the next release but is currently completely untested.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p62775">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">Sempher_Pie</div>
					<div class="post-datetime">
						3 Feb 2008, 19:14					</div>
				</div>
				<div class="post-content content">
					<p>I just uploaded version 0.1.1</p><p>Changelog:<br /></p><div class="quotebox"><blockquote><p>- OpenWrt: Added linux 2.6 support for kamikaze 7.09.<br /> - OpenWrt: Now loads k8055d __before__ usbhid.<br /> - i386 PC: Added &#039;make install&#039;<br /> - Fixed some typos in, and updated the README.</p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p64259">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">pfugl</div>
					<div class="post-datetime">
						28 Feb 2008, 19:35					</div>
				</div>
				<div class="post-content content">
					<p>I have tried to install the ipkg: kmod-k8055d_0.1.2_2.4.34-brcm-1_mipsel.ipk on WL500GP running openwrt-brcm-2.4-squashfs.trx. (Kamikaze 7.09)<br />Everything appears to load ok, - the proc interfaces are created nicely.<br />However if i do a:</p><p>cat /proc/k8055/0/in1&nbsp; &nbsp; &nbsp; &nbsp;it fails with:<br />cat: read error: bad address </p><p>and</p><p>echo 255 &gt; /proc/k8055/0/outputs&nbsp; &nbsp; &nbsp; &nbsp; does not set any of the outputs</p><p>Any ideas?</p>											<p class="post-edited">(Last edited by <strong>pfugl</strong> on 28 Feb 2008, 19:37)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p64381">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">knutigro</div>
					<div class="post-datetime">
						1 Mar 2008, 19:50					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>thanks for doing this work. I look forward to the support for the 2.6 kernel. </p><p>In my setup which is an Asus WL500gP that is running Kamikaze 7.09 (kernel 2.6 bcrm), the driver install nicely and it creates the /proc/k8055 folder but it does not create the rest of the folders and I dont think it recognizes the k8055 board.</p><p>knut</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p64399">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">Sempher_Pie</div>
					<div class="post-datetime">
						2 Mar 2008, 08:58					</div>
				</div>
				<div class="post-content content">
					<p>Hello pfugl and knutigro, thank you for posting your experiences with this driver.</p><p>pfugl: I am unable to reproduce the error that you get (I upgraded to the 2.6 kernel). Perhaps you can post your kernel log (dmesg | grep k8055d). I would also like to see the output of &#039;lsusb&#039;, but I believe the usbutils package is X-wrt only.</p><p>knutigro: I can reproduce the error that you get in two ways;</p><p>- The k8055 board needs to be connected directly to your router, NOT through an usb hub.<br />&nbsp; For some reason usb1 devices don&#039;t work when connected via a hub.</p><p>- USB v1 devices need the kmod-uhci (or kmod-uhci-iv) package.<br />&nbsp; The k8055 driver depends on the following packages:<br />&nbsp; &nbsp; - kmod-usb-core<br />&nbsp; &nbsp; - kmod-uhci or kmod-uhci-iv</p><p>In both your cases the kernel log should contain the following messages:</p><p>&#039;usbcore: registered new interface driver k8055d&#039;<br />This means that the driver is loaded and creates /proc/k8055.</p><p>&#039;k8055d: Velleman K8055 #0 now attached&#039;<br />&#039;k8055d: New interface created in /proc/k8055/0/...&#039;<br />This means that the k8055 was detected and creates the /proc/k8055/0/ directory.</p><p>I hope this helps.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p64412">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">pfugl</div>
					<div class="post-datetime">
						2 Mar 2008, 14:36					</div>
				</div>
				<div class="post-content content">
					<p>Thank you for trying to help. In the meantime I have upgraded to 2.6 kernel, and my K8055 works ok now.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p64444">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">knutigro</div>
					<div class="post-datetime">
						2 Mar 2008, 23:20					</div>
				</div>
				<div class="post-content content">
					<p>Yippi, </p><p>As you suggested I had missed installing the the kmod-uhci. Now it works! </p><p>Thank you&nbsp; :-)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p67365">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">pfugl</div>
					<div class="post-datetime">
						24 Apr 2008, 12:23					</div>
				</div>
				<div class="post-content content">
					<p>Unfortunately I need to go back to linux 2.4.35.4, as I need the WIFI interface, which as you may know, does not work on kernel 2.6 with ASUS WL-500GP and Broadcom wifi card.<br />So I am back to the old problem (I compiled latest SVN 10926):</p><div class="codebox"><pre><code>root@OpenWrt:/proc/k8055/0# ls
adc1       dac1       in1        in5        out3       out7
adc2       dac2       in2        inputs     out4       out8
counter1   debounce1  in3        out1       out5       outputs
counter2   debounce2  in4        out2       out6
root@OpenWrt:/proc/k8055/0# cat in1
cat: read error: Bad address</code></pre></div><p>I have compiled it with debug on, and posted the info you requested earlier in the thread:</p><div class="codebox"><pre><code>root@OpenWrt:/proc/k8055/0# dmesg | grep k8055
usb.c: registered new driver k8055d
k8055d debug: usb_k8055_send_msg: CMD 0x05, retv = -22 bytes written = 500
k8055d debug: usb_k8055_send_msg: CMD 0x05, retv = -22 bytes written = 500
k8055d debug: usb_k8055_send_msg: CMD 0x03, retv = -22 bytes written = 500
k8055d debug: usb_k8055_send_msg: CMD 0x04, retv = -22 bytes written = 500
k8055d: Velleman K8055 #0 now attached
k8055d: New interface created in /proc/k8055/0/...
k8055d debug: usb_k8055_read_msg: retv = -22 bytes written = 0
k8055d debug: proc_k8055_read: Could not read from K8055 #0</code></pre></div><div class="codebox"><pre><code>root@OpenWrt:/proc/k8055/0# lsusb
Bus 004 Device 001: ID 0000:0000
Bus 003 Device 001: ID 0000:0000
Bus 002 Device 001: ID 0000:0000
Bus 002 Device 002: ID 10cf:5500 Velleman Components, Inc. 8055 Experiment Interface Board (address=0)
Bus 001 Device 001: ID 0000:0000</code></pre></div><p>I know you are using 2.6 kernel, but if you have any suggestions, i am able to make changes to the source and recompile it her for 2.4 kernel. <br />I hope the debug output can give you a hint.</p><p>/Peter</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p67428">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">pfugl</div>
					<div class="post-datetime">
						25 Apr 2008, 14:25					</div>
				</div>
				<div class="post-content content">
					<p>I found the problem: I had both the kmod-usb-uhci and the kmod-usb-uhci-iv packages installed. When I uninstalled the kmod-usb-uhci package, leaving only the kmod-usb-uhci-iv,&nbsp; the k8055 worked ok. </p><p>/Peter</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p67547">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">Sempher_Pie</div>
					<div class="post-datetime">
						28 Apr 2008, 17:47					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ll try to fix dependancy problems like this in the next release...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p83633">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">nicoatyow</div>
					<div class="post-datetime">
						10 Mar 2009, 23:16					</div>
				</div>
				<div class="post-content content">
					<p>First of all thanks for the k8055 code, i was looking for something like this for a long time. <br />I recently installed the 8.09 release and the .ipk packages where not working for that release. So i installed the buildroot and tried compiling it myself.<br />After a lot of try and error i succeeded. The only thing that in i needed was :<br />nico@nico-desktop:~/kamikaze/package/k8055d-0.1.2/src$ diff k8055-drv.c k8055-drv.c-org<br />52d51<br />&lt; #include &lt;linux/init.h&gt;</p><p>Maybe someone can make a patch or contribute this compiled package to the repository because I don&#039;t have the knowledge nor the credentials to do this.<br />Regards,<br />Nico</p><p>BTW I used the brcm image for my asus wl500g deluxe.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p128694">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">soulman</div>
					<div class="post-datetime">
						17 Feb 2011, 18:04					</div>
				</div>
				<div class="post-content content">
					<p>Hello,<br />everything works fine with backfire 10.03 , kernel 2.6.32.10 <br />I compiled myself the package with buildroot ,&nbsp; &nbsp;only 1 problem:<br />when i do a cat&nbsp; /proc/k8055/0/in3&nbsp; &nbsp;or cat /proc/k8055/0/outputs&nbsp; &nbsp; then it displays a value , and then keeps on scrolling !!<br />cursor is not coming back&nbsp; until&nbsp; ctrl-c</p><p>what can it be ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p128841">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">jarimacfed</div>
					<div class="post-datetime">
						19 Feb 2011, 17:23					</div>
				</div>
				<div class="post-content content">
					<p>I have the same problem both on nslu2 and asus-wl500.<br />This problem appear with release k8055d-0.1.5.<br />I use release k8055d-0.1.3 and this works fine with trunk 2.6.32.27-1.<br />release k8055d-0.1.4 does not compile.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>