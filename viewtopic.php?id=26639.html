<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> OpenWRT on BT Homehub V1/V1.5 - what is the best approach?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 11 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p117484">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">simonh</div>
					<div class="post-datetime">
						19 Sep 2010, 11:24					</div>
				</div>
				<div class="post-content content">
					<p>Dear all,</p><p>there is an active comunity hacking the BT Homehub V1/V1.5, and we&#039;ve now enabled flashing of the unit from broadcom CFE to Redboot (built from source) and OpenWRT.<br />Starting from the Livebox OpenWRT implementation (a very similar router), a couple of us have modified OpenWRT to boot on the router.<br />Now we&#039;re at a state where we need guidance on correct procedure, and correct approach to adding OpenWRT patches to support the BT Homehub in this configuration.</p><p>I don&#039;t really understand the build system in terms of what is SVNed and what is not - currently we&#039;ve modified/added files in the build directory, but this folder seems to be generated by the build process from the target definition?&nbsp; So to make/submit a patch, exactly where in the directory structure do we make modifications?</p><p>What is the correct approach to adding board support?&nbsp; There is the generic BCM963xx target (includes neufbox, etc. but is tuned for CFE use?), but also a &#039;separate&#039; livebox target.&nbsp; Our first approach was to duplicate the livebox target, and modify appropriately, as this includes redboot support, etc., so we would add a new file for mtd support and for board support.&nbsp; Is this the right approach, or should we shoe-horn it into the (seemingly more modern) BCM963xx files with #defines to change the required functionality?</p><p>all advice gratefully received,</p><p>Simon</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p117486">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						19 Sep 2010, 12:56					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>your Kernel modifications must be added in the form of patches to target/linux/brcm63xx/patches[-2.6.x]/.<br />If you have completely new files, e.g. a new flashmap or something, you can put it into target/linux/brcm63xx/files[-2.6.x]/.</p><p>A subtarget is probably the best way to add this board.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p117509">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">simonh</div>
					<div class="post-datetime">
						19 Sep 2010, 22:20					</div>
				</div>
				<div class="post-content content">
					<p>so, if I understand correctly...</p><p>modify files in build directory, build, test, test, test,</p><p>then create patches to go into the patches folder in the target folder.<br />(how is this done?&nbsp; do I need to keep the original files and then diff them?)<br />At this point, a clean/rebuild should automagically make modified files and build correctly...</p><p>Then run<br />svn diff &gt; all_changes.patch<br />to gather all the new patches and build file changes into one patch for submission?<br />(do i need to svn add the new patch files I created?).</p><p>please confirm..</p><p>I&#039;ll look into how to make it a sub-target.</p><p>br,</p><p>simon</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p117513">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						19 Sep 2010, 22:47					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>simonh wrote:</cite><blockquote><p>modify files in build directory, build, test, test, test,</p></blockquote></div><p>Start with a clean, unmodified build_dir</p><div class="quotebox"><cite>simonh wrote:</cite><blockquote><p>then create patches to go into the patches folder in the target folder.<br />(how is this done?&nbsp; do I need to keep the original files and then diff them?)</p></blockquote></div><p><a href="http://wiki.openwrt.org/doc/devel/patches">http://wiki.openwrt.org/doc/devel/patches</a><br />Summary:<br /></p><div class="codebox"><pre><code>$ make target/linux/{clean,prepare} V=99 QUILT=1
$ cd build_dir/linux-brcm63xx/linux-2.6.*/
$ quilt push -a
$ quilt new platform/990-add-my-board.patch
$ quilt edit arch/mips/...
$ quilt edit drivers/...
$ quilt refresh
$ cd ../../../
$ make target/linux/update
$ make target/linux/{clean,compile,install} V=99</code></pre></div><div class="quotebox"><cite>simonh wrote:</cite><blockquote><p>Then run<br />svn diff &gt; all_changes.patch<br />to gather all the new patches and build file changes into one patch for submission?</p></blockquote></div><p>Correct. You should split it into parts though, one for modifying the kernel, one for adding the subtarget definitions etc.</p><div class="quotebox"><cite>simonh wrote:</cite><blockquote><p>(do i need to svn add the new patch files I created?).</p></blockquote></div><p>Yes.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p117514">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">simonh</div>
					<div class="post-datetime">
						19 Sep 2010, 22:53					</div>
				</div>
				<div class="post-content content">
					<p>thankyou!&nbsp; will play with quilt (not seen this before, was looking at <a href="https://dev.openwrt.org/wiki/SubmittingPatches">https://dev.openwrt.org/wiki/SubmittingPatches</a> , and it&#039;s not mentioned <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> ).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p117515">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						19 Sep 2010, 22:54					</div>
				</div>
				<div class="post-content content">
					<p>Note that I forgot &quot;make target/linux/update&quot; in my previous post, I updated it accordingly. Will add a link to the wiki page as well.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p117922">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">simonh</div>
					<div class="post-datetime">
						26 Sep 2010, 19:13					</div>
				</div>
				<div class="post-content content">
					<p>ok, patch submitted;</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p117963">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">simonh</div>
					<div class="post-datetime">
						27 Sep 2010, 15:27					</div>
				</div>
				<div class="post-content content">
					<p>how does the patch get included in the trunk?&nbsp; What is the procedure, and do I need to progress it with anyone specific?</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>