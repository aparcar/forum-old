<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Clock resolution?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 3 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p36820">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">Loconut1389</div>
					<div class="post-datetime">
						8 Nov 2006, 22:56					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m working on an application that needs a fairly precise clock on several WRTSL54GS units- I&#039;m wondering two things- is the clock resolution better or worse than a pc (1/8th second?) and 2- what&#039;s the best way to get at that resolution (time.h&#039;s clock()?)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p36822">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">mbm</div>
					<div class="post-datetime">
						8 Nov 2006, 23:00					</div>
				</div>
				<div class="post-content content">
					<p>There is no clock. Absolutely no RTC on the board.</p><p>Expect some pretty wide drifts from the clock function.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p36824">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">Loconut1389</div>
					<div class="post-datetime">
						8 Nov 2006, 23:05					</div>
				</div>
				<div class="post-content content">
					<p>know of any good, serial external clocks with 100ths or better resolution and low drift?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p36825">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">mbm</div>
					<div class="post-datetime">
						8 Nov 2006, 23:09					</div>
				</div>
				<div class="post-content content">
					<p>Your other option would be to set up an ntp server on the lan and periodically syncing. How often you sync will determine the real resolution of the clock.</p><p>(You shouldn&#039;t hammer a public ntp server by constantly attempting to sync the clock)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p36831">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">booBot</div>
					<div class="post-datetime">
						9 Nov 2006, 00:44					</div>
				</div>
				<div class="post-content content">
					<p>Did you try the <strong>OpenNTPd</strong>?<br />It works very well on <strong>OpenWRT</strong> - I always use it instead of an <strong>ntpclient</strong>.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p36863">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">Loconut1389</div>
					<div class="post-datetime">
						9 Nov 2006, 16:35					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>booBot wrote:</cite><blockquote><p>Did you try the <strong>OpenNTPd</strong>?<br />It works very well on <strong>OpenWRT</strong> - I always use it instead of an <strong>ntpclient</strong>.</p></blockquote></div><p>I do have that setup- but was hoping to find out if I could reliably produce the same time to somewhere near 100ths of a second on two separate units.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p36864">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">Loconut1389</div>
					<div class="post-datetime">
						9 Nov 2006, 16:36					</div>
				</div>
				<div class="post-content content">
					<p>wanted to add a thanks for everyone&#039;s replies so far!</p><p>Interesting that there&#039;s no RTC- so cheap to add and you&#039;d think it would help with logging/people doing linux on these things.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p36866">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">booBot</div>
					<div class="post-datetime">
						9 Nov 2006, 16:52					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Loconut1389 wrote:</cite><blockquote><p>I was hoping to find out if I could reliably produce the same time to somewhere near 100ths of a second on two separate units.</p></blockquote></div><p>I believe that the regular NTP daemon - this <a href="http://ntp.isc.org/bin/view/Main/SoftwareDownloads">one</a>, if ported to OpenWRT, would &quot;discipline&quot; the system timer so that there would be no skew and all boxes would reliably show the <strong>very</strong> close time readings. (If you configure them to have the common reference server(s) and each other as the peer as well.)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p36879">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">monnier</div>
					<div class="post-datetime">
						9 Nov 2006, 21:32					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Loconut1389 wrote:</cite><blockquote><div class="quotebox"><cite>booBot wrote:</cite><blockquote><p>Did you try the <strong>OpenNTPd</strong>?<br />It works very well on <strong>OpenWRT</strong> - I always use it instead of an <strong>ntpclient</strong>.</p></blockquote></div><p>I do have that setup- but was hoping to find out if I could reliably produce the same time to somewhere near 100ths of a second on two separate units.</p></blockquote></div><p>I use my router (formely wl500g, now wrtsl54gs) as an NTP server for my machines and I&#039;ve tried various servers: OpenNTPd, plain old &quot;full blown&quot; ntpd, and a hacked OpenNTPd.<br />My conclusion is that those machines are no good at time keeping.&nbsp; Using either of the above, I easily get a time error less than 1s, maybe even within 0.1s, but 0.01s?&nbsp; not a chance.</p><p>More specifically:<br />- OpenNTPd seems to not even try to get a very fine time keeping.&nbsp; It just tries to keep the error within acceptable bounds.&nbsp; E.g. it doesn&#039;t use the more powerful functionality of `adjtimex&#039; (maybe because it&#039;s not available under OpenBSD?)<br />- ntpd seemed to have trouble sometimes keeping the time in sync: it seems to assume that the drift of your machine is constant, which is not the case for my routers.&nbsp; So it&#039;ll settle on one particular drift when the router is mostly idle and when suddenly a lot of activity ends up changing the drift, ntpd gets all confused and will get out of sync and start all over again.&nbsp; So the maximum error is still rather large.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p36880">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">booBot</div>
					<div class="post-datetime">
						9 Nov 2006, 21:46					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>monnier wrote:</cite><blockquote><p>- ntpd seemed to have trouble sometimes keeping the time in sync</p></blockquote></div><p>Thank you for the valuable information.</p><p>I too use my <strong>WRT54GL</strong> as the NTP server (with OpenNTPd) - I agree that it has a sort of a &quot;saw-tooth&quot; looking time delta against the reference servers. But for my applications it is small enough - less than 50~100ms.<br />(I use it as the back-up NTP server for my RT31P2 box which needs the current time|date for SSL-based VoIP encryption)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p36888">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">Loconut1389</div>
					<div class="post-datetime">
						10 Nov 2006, 02:37					</div>
				</div>
				<div class="post-content content">
					<p>Well, I&#039;ve gotten out my two GPS receivers and was starting to play with GPSD, but am noticing that the version in backports doesn&#039;t support some of the options I&#039;m seeing in posts from linux folks and am wondering what I need to do to get it working. My GPS will do 4800 or 9600 bps, ideally 9600- but seeing as the examples for openwrt I&#039;ve found are 4800, that&#039;s what I have it set at (and NMEA 0183 2.0), but my clock is not being set still... so I&#039;m obviously missing something. Any experience with GPSD?</p><p>update: gpsd -N -D 4 -f /dev/tts/1 at least gets me information, but it complains about the value of field 3 being wrong, and if I set my GPS to NMEA 0183 1.5, I get &quot;unknown sentence: &quot;$GPRMB.....*snipped*&quot;, so I assume 2.0 is correct.. either way, it closed out the GPS device right away and I never get anywhere useful.</p><p>Also, to the folks who&#039;ve been so helpful so far- I was operating under the assumption that this will get me better clock resolution, but upon thinking about it, if the gps is only doing updates per second, my sub-second timing may still be imperfect? Ultimately, as long as my seconds are coordinated perfectly, I can deal without the fractions.</p><p>update 2: after analyzing the code, it seems whatever you set the serial rate to, gpsd will pick up on it, so 9600 is no problem- and the debug log shows correct data at 9600 too.. but I&#039;m still getting this as a log (with Garmin GPS12XL in NMEA/NMEA 0183 2.0 mode):</p><p>root@OpenWrt:~#&nbsp; gpsd -N -D 4 -f /dev/tts/1<br />gpsd: launching (Version 2.30)<br />gpsd: listening on port 2947<br />gpsd: running with effective group ID 0<br />gpsd: running with effective user ID 0<br />gpsd: opening GPS data source at &#039;/dev/tts/1&#039;<br />gpsd: no probe matched...<br />gpsd: speed 9600, 8N1<br />gpsd: gpsd_activate: opened GPS (5)<br />gpsd: flagging descriptor 5 in open_device<br />gpsd: packet sniff finds type -1<br />gpsd: packet sniff finds type -1<br />gpsd: packet sniff finds type -1<br />gpsd: packet sniff finds type 0<br />gpsd: Selecting Generic NMEA driver...<br />gpsd: =&gt; GPS: $PFEC,GPint,GSA01,DTM00,ZDA01,RMC01,GLL00,VTG00,GSV05*3B\x0d</p><p>gpsd: =&gt; GPS: @NC10151010\x0d</p><p>gpsd: =&gt; GPS: $PMOTG,ZDA,1*2F\x0d</p><p>gpsd: =&gt; GPS: $PGRMCE*0E\x0d</p><p>gpsd: =&gt; GPS: $PSRF105,1*3E\x0d</p><p>gpsd: =&gt; GPS: $PFST*11\x0d</p><p>gpsd: &lt;= GPS: $PGRMM,WGS 84*06<br />gpsd: unknown sentence: &quot;$PGRMM,WGS 84*06\x0d\x0a&quot;<br />gpsd: unflagging descriptor 5 in open_device<br />gpsd: closing GPS=/dev/tts/1 (5)<br />gpsd: closing GPS=/dev/tts/1 (-1)<br />gpsd: Received terminating signal 2. Exiting...</p>											<p class="post-edited">(Last edited by <strong>Loconut1389</strong> on 10 Nov 2006, 05:54)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p36896">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">strider22</div>
					<div class="post-datetime">
						10 Nov 2006, 06:10					</div>
				</div>
				<div class="post-content content">
					<p>RE: the assumption that this will get me better clock resolution<br />The satellites are used to syncronize your clock. The benefit being that there are multiple sources. GPS I have worked with require 3 satellites to update the GPS clock. This is because there are some broken satellite clocks up there. With an accurate time source such as GPS you can program away the local errors by self correction.</p><p>Time Synchronization Accuracy (from <a href="http://www.endruntechnologies.com/time-synchronization.htm)">http://www.endruntechnologies.com/time- … ation.htm)</a><br />The timing accuracy of a GPS receiver in a Network Time Server is typically 100 nanoseconds.&nbsp; The accuracy of the NTP timestamp is within 10 microseconds of UTC, and network factors, such as traffic and routers, reduce the overall network synchronization accuracy to be typically within 1/2 to 2 milliseconds.</p><p>Too bad you don&#039;t give any hints about the application or where and why the accuracy is required or more help could be provided. You may be trying to do the impossible.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p36897">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">Loconut1389</div>
					<div class="post-datetime">
						10 Nov 2006, 06:39					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>strider22 wrote:</cite><blockquote><p>RE: the assumption that this will get me better clock resolution<br />The satellites are used to syncronize your clock. The benefit being that there are multiple sources. GPS I have worked with require 3 satellites to update the GPS clock. This is because there are some broken satellite clocks up there. With an accurate time source such as GPS you can program away the local errors by self correction.</p><p>Time Synchronization Accuracy (from <a href="http://www.endruntechnologies.com/time-synchronization.htm)">http://www.endruntechnologies.com/time- … ation.htm)</a><br />The timing accuracy of a GPS receiver in a Network Time Server is typically 100 nanoseconds.&nbsp; The accuracy of the NTP timestamp is within 10 microseconds of UTC, and network factors, such as traffic and routers, reduce the overall network synchronization accuracy to be typically within 1/2 to 2 milliseconds.</p><p>Too bad you don&#039;t give any hints about the application or where and why the accuracy is required or more help could be provided. You may be trying to do the impossible.</p></blockquote></div><p>Update 3: I found gpsd -nN -D 5 and so it keeps running now, but gets unknown sentence a bazillion times- despite my GPS being listed on the compatibility page.</p><p>As far as application- does it really change any responses? Unfortunately, I can&#039;t say the application- but I can re-state that I&#039;m trying to get at least 2 units synchronized to a high-degree and am encountering problems with gpsd not liking the supposedly supported NMEA 0183 v2.0 output of my Garmin GPS12XL that&#039;s on their hardware support list for version 2.30.</p><p>I&#039;m still all for any other suggestions as to an clock-source, aside from GPS. GPS seems like a decent way to go if I can get gpsd to actually set my clock.</p><p>Currently, it&#039;s seeing about 6 sattelites with strong bars, so the minimum three shouldn&#039;t be a problem.</p><p>I definitely appreciate any input and the work that&#039;s been done on the gpsd application, as well as OpenWRT itself- makes for quite useful little devices!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p36935">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">booBot</div>
					<div class="post-datetime">
						10 Nov 2006, 20:40					</div>
				</div>
				<div class="post-content content">
					<p>It takes a lot of heavy filtering to use the GPS as the reference PPS-signal because the RS232 link is <strong>very</strong> jittery...<br />(Have a look <a href="http://phk.freebsd.dk/soekris/pps/">here</a>.)</p><p>Unless OpenWRT sports the properly working <strong>adjtimex()</strong> you will not get any sub-millisecond precision. GPS or not.</p>											<p class="post-edited">(Last edited by <strong>booBot</strong> on 10 Nov 2006, 20:41)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p36971">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">Loconut1389</div>
					<div class="post-datetime">
						11 Nov 2006, 08:11					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>booBot wrote:</cite><blockquote><p>It takes a lot of heavy filtering to use the GPS as the reference PPS-signal because the RS232 link is <strong>very</strong> jittery...<br />(Have a look <a href="http://phk.freebsd.dk/soekris/pps/">here</a>.)</p><p>Unless OpenWRT sports the properly working <strong>adjtimex()</strong> you will not get any sub-millisecond precision. GPS or not.</p></blockquote></div><p>ah- well I suppose that&#039;s the answer I was looking for.</p><p>I&#039;m about halfway through developing an RS232-SPI RTC bridge that can be hooked on the ttyS1 of many of these routers and I&#039;m hoping that I can just query the thing at 115200 and get reasonably close.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>