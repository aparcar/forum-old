<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> [SOLVED] [12.09] LAN-to-LAN PPtP routed VPN (no NAT)</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 29 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p218274">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">uqbar</div>
					<div class="post-datetime">
						23 Nov 2013, 15:45					</div>
				</div>
				<div class="post-content content">
					<p>What I have reached so far is the following:</p><p>1. Client OpenWRT box connects and reconnects to Server OpenWRT box.<br />2. From inside Client box I can reach all machines on Server box&#039; LAN<br />2.1 From Client box&#039; LAN I can reach all machines on Server box&#039; LAN<br />3. From inside Server box I can reach all machines on Client box&#039; LAN<br />3.1 From Server box&#039; LAN I <strong>CANNOT</strong> reach any machine on Client box&#039; LAN</p><p>I am missing &quot;just&quot; (tm)&nbsp; the firewalling part on the server and would like to get some hint to understand the needed CLI commands.</p><p><strong>[UPDATE]</strong>I am laso missing a way to have the static routes added back to client box&#039; LAN as soon as the PPtP is back online. /etc/ppp/ip-up seems not to work! <strong>Scripts go in /etc/ppp/ip-up.d instead!</strong></p><p>Once all this is done, my next steps will be to:</p><p>1. Enable also single PPtP client to connect and<br />2. Enable multiple LAN_to-LAN VPNs.</p><p>Any good hint/pointer ?</p><p>TIA</p><p><strong>UPDATE and SOLUTION</strong>. Thanks to myself. I turned the syslog ON on the server side of the firewall and found out something like:<br /></p><div class="codebox"><pre><code>kernel: [  825.440000] DROP(lan):IN=br-lan OUT=ppp1 MAC=...</code></pre></div><p>while trying to get from the server LAN to the client LAN.<br />I then went to the server firewall (Network--&gt;Firewall--&gt;Zones) and turned the forward action for LAN--&gt;WAN from DROP to ACCEPT.<br />Everything started working.<br />I am not sure whether this is the right action (probably not), but at least now I can make it work.</p>											<p class="post-edited">(Last edited by <strong>uqbar</strong> on 27 Nov 2013, 09:42)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p218340">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">uqbar</div>
					<div class="post-datetime">
						24 Nov 2013, 16:11					</div>
				</div>
				<div class="post-content content">
					<p>How should the firewall rules in the server box look like?</p>											<p class="post-edited">(Last edited by <strong>uqbar</strong> on 25 Nov 2013, 16:01)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p218440">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">uqbar</div>
					<div class="post-datetime">
						25 Nov 2013, 16:02					</div>
				</div>
				<div class="post-content content">
					<p>I need at least a way to &quot;see&quot; which rules is blocking what.<br />Any idea?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p218610">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">uqbar</div>
					<div class="post-datetime">
						27 Nov 2013, 09:46					</div>
				</div>
				<div class="post-content content">
					<p>I managed to solve the problem.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>