<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> pppoe disables forwarding ?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 3 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p61488">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">romal</div>
					<div class="post-datetime">
						9 Jan 2008, 14:28					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>I&#039;m running 7.09 (kernel 2.6, I don`t need wireless, only routing) on a wrt54gl.</p><p>It sit`s behind an AVM fritzbox (pppoe passthrough is enabled). Some PCs are behind the Linksys.</p><p>If I use</p><p>/etc/config/network</p><p>#### WAN configuration&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />config interface&nbsp; &nbsp; &nbsp; &nbsp; wan&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname&nbsp; &nbsp;&quot;eth0.1&quot;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; dhcp </p><p>and do a network restart</p><p>root@OpenWrt:/# /etc/init.d/network restart<br />udhcpc (v1.4.2) started<br />root@OpenWrt:/# Sending discover...<br />Sending select for 192.168.101.23...<br />Lease of 192.168.101.23 obtained, lease time 864000<br />adding router 192.168.101.254<br />deleting old routes<br />adding dns 192.168.101.254</p><p>all works. I can access the internet from behind OpenWRT. Perfect.</p><p>But I want to use pppoe, so /etc/config/network looks like this:</p><p>#### WAN configuration&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />config interface&nbsp; &nbsp; &nbsp; &nbsp; wan&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname&nbsp; &nbsp;&quot;eth0.1&quot;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp;option proto&nbsp; &nbsp; pppoe&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp;option username &quot;killed&quot;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp;option password &quot;killed&quot;&nbsp; </p><p>the system build the pppoe-connection:</p><p>Jan&nbsp; 1 00:13:41 OpenWrt daemon.info pppd[874]: Plugin rp-pppoe.so loaded.<br />Jan&nbsp; 1 00:13:41 OpenWrt daemon.notice pppd[875]: pppd 2.4.3 started by root, uid 0<br />Jan&nbsp; 1 00:13:41 OpenWrt daemon.info pppd[875]: PPP session is 2944<br />Jan&nbsp; 1 00:13:41 OpenWrt daemon.info pppd[875]: Using interface ppp0<br />Jan&nbsp; 1 00:13:41 OpenWrt daemon.notice pppd[875]: Connect: ppp0 &lt;--&gt; eth0.1<br />Jan&nbsp; 1 00:13:41 OpenWrt daemon.warn pppd[875]: Couldn&#039;t increase MTU to 1500<br />Jan&nbsp; 1 00:13:41 OpenWrt daemon.warn pppd[875]: Couldn&#039;t increase MRU to 1500<br />Jan&nbsp; 1 00:13:41 OpenWrt daemon.warn pppd[875]: Couldn&#039;t increase MTU to 1500<br />Jan&nbsp; 1 00:13:41 OpenWrt daemon.warn pppd[875]: Couldn&#039;t increase MRU to 1500<br />Jan&nbsp; 1 00:13:41 OpenWrt daemon.notice pppd[875]: PAP authentication succeeded<br />Jan&nbsp; 1 00:13:41 OpenWrt daemon.notice pppd[875]: PAP authentication succeeded<br />Jan&nbsp; 1 00:13:41 OpenWrt daemon.notice pppd[875]: peer from calling number 00:15:0C:68:38:67 authorized<br />Jan&nbsp; 1 00:13:41 OpenWrt daemon.notice pppd[875]: local&nbsp; IP address 212.60.130.101<br />Jan&nbsp; 1 00:13:41 OpenWrt daemon.notice pppd[875]: remote IP address 82.139.222.46<br />Jan&nbsp; 1 00:13:41 OpenWrt daemon.notice pppd[875]: primary&nbsp; &nbsp;DNS address 81.92.1.1<br />Jan&nbsp; 1 00:13:41 OpenWrt daemon.notice pppd[875]: secondary DNS address 81.92.1.2</p><p>but the PCs behind OpenWRT cannot access the internet anymore.</p><p>DHCP works (for the PCs behind OpenWRT) , DNS works (on both OpenWRT and the PCs), ipkg can download and install packages (so OpenWRT has access to the internet)</p><p>but forwarding does not work anymore ?</p><p>How do I troubleshoot this problem ? Could anyone give me a hint ?</p><p>cu romal</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p61914">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">raw</div>
					<div class="post-datetime">
						19 Jan 2008, 15:32					</div>
				</div>
				<div class="post-content content">
					<p>I have exactly the same problem, except it&#039;s not a FritzBox but a DSL Router. And I&#039;m running the 2.4 kernel on the same model.</p><p>Edit: I reflashed the firmware and it automagically started to work.</p>											<p class="post-edited">(Last edited by <strong>raw</strong> on 19 Jan 2008, 15:52)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p63171">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">stephane</div>
					<div class="post-datetime">
						10 Feb 2008, 19:05					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>I got exactly the same problem. I am not sure how you can fix it in a stable way. I think there is something messed up in kamikaze between ifnames and device names... anyway,<br />just add 2 lines to you iptables :<br />one for nat/postrouting and one for filter/forward. You will see it uses etho0.1 instead of ppp0.<br />Just add 2 rules that allow traffic to be forwarded and nated when it comes out through ppp0.<br />(iptables -vx -L -t nat and -t filter)</p><p>Steff</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p63172">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">stephane</div>
					<div class="post-datetime">
						10 Feb 2008, 19:06					</div>
				</div>
				<div class="post-content content">
					<p>and please fill ticket 2515 of trac, to report that you also experience this problem !</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p63174">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">Wodin</div>
					<div class="post-datetime">
						10 Feb 2008, 19:28					</div>
				</div>
				<div class="post-content content">
					<p>What does the routing table look like when the PPP link is established?</p><p>Also, what does &quot;ifconfig -a&quot; or &quot;ip address show&quot; say?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p63362">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">jever</div>
					<div class="post-datetime">
						13 Feb 2008, 20:54					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>looks like i have the same problem.</p><p>WL-500gP has wan access because i can do nslookup and ping hosts.</p><p>from my PC i receive nslookup output:</p><div class="quotebox"><blockquote><p>&gt; <a href="http://www.daimler.de">www.daimler.de</a><br />Server:&nbsp; UnKnown<br />Address:&nbsp; 192.168.1.1</p><p>Nicht autorisierte Antwort:<br />Name:&nbsp; &nbsp; <a href="http://www.cms.daimler.com">www.cms.daimler.com</a><br />Address:&nbsp; 141.113.97.32<br />Aliases:&nbsp; <a href="http://www.daimler.de">www.daimler.de</a></p></blockquote></div><p>Route print on PC gives</p><div class="quotebox"><blockquote><p>C:\WINDOWS\system32&gt;route print<br />===========================================================================<br />Schnittstellenliste<br />0x1 ........................... MS TCP Loopback interface<br />0x2 ...00 90 27 37 ed 5d ...... Intel(R) PRO/100+-PCI-Adapter #2 - Paketplaner-<br />iniport<br />===========================================================================<br />===========================================================================<br />Aktive Routen:<br />&nbsp; &nbsp; &nbsp;Netzwerkziel&nbsp; &nbsp; Netzwerkmaske&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Gateway&nbsp; &nbsp;Schnittstelle&nbsp; Anzahl<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0&nbsp; &nbsp; &nbsp; 192.168.1.1&nbsp; &nbsp;192.168.1.138&nbsp; &nbsp; &nbsp; &nbsp;30<br />&nbsp; &nbsp; &nbsp; &nbsp; 127.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; 255.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; 127.0.0.1&nbsp; &nbsp; &nbsp; &nbsp;127.0.0.1&nbsp; &nbsp; &nbsp; &nbsp;1<br />&nbsp; &nbsp; &nbsp; 169.254.0.0&nbsp; &nbsp; &nbsp; 255.255.0.0&nbsp; &nbsp; 192.168.1.138&nbsp; &nbsp;192.168.1.138&nbsp; &nbsp; &nbsp; &nbsp;30<br />&nbsp; &nbsp; &nbsp; 192.168.1.0&nbsp; &nbsp; 255.255.255.0&nbsp; &nbsp; 192.168.1.138&nbsp; &nbsp;192.168.1.138&nbsp; &nbsp; &nbsp; &nbsp;30<br />&nbsp; &nbsp; 192.168.1.138&nbsp; 255.255.255.255&nbsp; &nbsp; &nbsp; &nbsp; 127.0.0.1&nbsp; &nbsp; &nbsp; &nbsp;127.0.0.1&nbsp; &nbsp; &nbsp; &nbsp;30<br />&nbsp; &nbsp; 192.168.1.255&nbsp; 255.255.255.255&nbsp; &nbsp; 192.168.1.138&nbsp; &nbsp;192.168.1.138&nbsp; &nbsp; &nbsp; &nbsp;30<br />&nbsp; &nbsp; &nbsp; &nbsp; 224.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; 240.0.0.0&nbsp; &nbsp; 192.168.1.138&nbsp; &nbsp;192.168.1.138&nbsp; &nbsp; &nbsp; &nbsp;30<br />&nbsp; 255.255.255.255&nbsp; 255.255.255.255&nbsp; &nbsp; 192.168.1.138&nbsp; &nbsp;192.168.1.138&nbsp; &nbsp; &nbsp; &nbsp;1<br />Standardgateway:&nbsp; &nbsp; &nbsp; &nbsp;192.168.1.1<br />===========================================================================<br />StÃ¤ndige Routen:<br />&nbsp; Keine</p></blockquote></div><p>route on Router gives:<br /></p><div class="quotebox"><blockquote><p>root@OpenWrt:~# route<br />Kernel IP routing table<br />Destination&nbsp; &nbsp; &nbsp;Gateway&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Genmask&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Flags Metric Ref&nbsp; &nbsp; Use Iface<br />213.191.76.49&nbsp; &nbsp;*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.255.255.255 UH&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 ppp0<br />192.168.1.0&nbsp; &nbsp; &nbsp;*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.255.255.0&nbsp; &nbsp;U&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 br-lan<br />default&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lo1.br51.weham. 0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;UG&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 ppp0</p></blockquote></div><p>my network config:<br /></p><div class="quotebox"><blockquote><p>#### VLAN configuration<br />config switch eth0<br />&nbsp; &nbsp; &nbsp; &nbsp; option vlan0&nbsp; &nbsp; &quot;1 2 3 4 5*&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; option vlan1&nbsp; &nbsp; &quot;0 5&quot;</p><br /><p>#### Loopback configuration<br />config interface loopback<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname&nbsp; &nbsp;&quot;lo&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; static<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr&nbsp; &nbsp;127.0.0.1<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask&nbsp; 255.0.0.0</p><br /><p>#### LAN configuration<br />config interface lan<br />&nbsp; &nbsp; &nbsp; &nbsp; option type&nbsp; &nbsp; &nbsp;bridge<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname&nbsp; &nbsp;&quot;eth0.0&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; static<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr&nbsp; &nbsp;192.168.1.1<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask&nbsp; 255.255.255.0</p><br /><p>#### WAN configuration<br />config interface&nbsp; &nbsp; &nbsp; &nbsp; wan<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname&nbsp; &nbsp;&quot;eth0.1&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; pppoe<br />&nbsp; &nbsp; &nbsp; &nbsp; option username &quot;xxx&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; option password &quot;xxx&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; option usepeerdns<br />&nbsp; &nbsp; &nbsp; &nbsp; option defaultroute<br />&nbsp; &nbsp; &nbsp; &nbsp; option persist<br />&nbsp; &nbsp; &nbsp; &nbsp; option noipdefault<br />&nbsp; &nbsp; &nbsp; &nbsp; option ktune<br />&nbsp; &nbsp; &nbsp; &nbsp; option unit&nbsp; &nbsp; &nbsp;0</p></blockquote></div><p>So anyway, i cannot ping any IP, i can&#039;t access the Internet via Browser...</p><p>Anyone got an idea, what&#039;s wrong ????</p><p>BTW: i compiled the cvs sources a few days ago, to get a Bleeding-Edge FW.</p><p>Thanks, Jan</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p64334">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">jever</div>
					<div class="post-datetime">
						29 Feb 2008, 19:27					</div>
				</div>
				<div class="post-content content">
					<p>Hi, </p><p>my problems still remain <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><p>anytime i flash mostly any Version of OpenWRT, i cannot connect my PC via the Router to the Internet. The Router connects via PPPoE, i can ping and do dnslookup.</p><p>Also my PC connects to the Router and gets DNS infos for example.</p><p>But a tracert call on my PC end up at the router as only reachable hop...</p><p>No Browser connection to anywhere</p><p>Looks like the Router doesn&#039;t forward the traffic.</p><p>I once had one version working (bleeding edge home build), but it broke during Installation of twonky <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><p>*** Are there any more tasks to do after installing, than editing /etc/config/network and stuff ???***</p><p>getting quite frustrated now.</p><p>Any help welcome!</p><p>Greetz, Jan</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p64466">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">Wodin</div>
					<div class="post-datetime">
						3 Mar 2008, 08:13					</div>
				</div>
				<div class="post-content content">
					<p>Please post the output of &quot;iptables -t nat -nvL&quot; and &quot;iptables -nvL&quot;</p><p>EDIT: See also this ticket:<br /><a href="https://dev.openwrt.org/ticket/2515">https://dev.openwrt.org/ticket/2515</a></p>											<p class="post-edited">(Last edited by <strong>Wodin</strong> on 3 Mar 2008, 08:49)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p69012">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">zaq-zaq</div>
					<div class="post-datetime">
						1 Jun 2008, 13:07					</div>
				</div>
				<div class="post-content content">
					<p>I have similar problem with kamikaze 7.09. <br />I have my ISP internal network and PPPOE internet connection over it on the same vlan. <br />I tried to solve it and got the following:</p><p>in network config:</p><div class="codebox"><pre><code>#### WAN configuration

config &quot;interface&quot; &quot;wan&quot;
    option proto    &#039;pppoe&#039;
    option ifname    &#039;eth0.1&#039;
    option username    &#039;xxxx&#039;
    option password    &#039;xxxx&#039;

config &quot;interface&quot; &quot;ISP_internal&quot;
    option ifname    &#039;eth0.1&#039;
    option proto    &#039;dhcp&#039;</code></pre></div><p>But when I do ifup for both of them, the latter interface brought up overwrites all routes and addresses of another. So I add them manually.</p><div class="codebox"><pre><code>root@OpenWrt:~# ifup ISP_internal
udhcpc (v1.4.2) started
Sending discover...
Sending select for 10.249.28.34...
Lease of 10.249.28.34 obtained, lease time 1200
adding router 10.249.28.254
deleting old routes

root@OpenWrt:~# ip ad sh  
...
4: eth0.1: &lt;BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue 
    link/ether 00:1d:7e:e3:96:02 brd ff:ff:ff:ff:ff:ff
    inet 10.249.28.34/24 brd 10.249.28.255 scope global eth0.1
...

root@OpenWrt:~# ip ro sh
192.168.1.0/24 dev br-lan  proto kernel  scope link  src 192.168.1.1 
10.249.28.0/24 dev eth0.1  proto kernel  scope link  src 10.249.28.34 
default via 10.249.28.254 dev eth0.1 

root@OpenWrt:~# ifup wan
Plugin rp-pppoe.so loaded.

root@OpenWrt:~# ip ad sh
...
4: eth0.1: &lt;BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue 
    link/ether 00:1d:7e:e3:96:02 brd ff:ff:ff:ff:ff:ff
...
10: ppp0: &lt;POINTOPOINT,MULTICAST,NOARP,UP&gt; mtu 1492 qdisc pfifo_fast qlen 3
    link/ppp 
    inet 10.250.28.34 peer 10.250.254.11/32 scope global ppp0
...

root@OpenWrt:~# ip ro sh
10.250.254.11 dev ppp0  proto kernel  scope link  src 10.250.28.34 
192.168.1.0/24 dev br-lan  proto kernel  scope link  src 192.168.1.1 
default via 10.250.254.11 dev ppp0</code></pre></div><p>The ifup script (I think that udhcpc does this) removes address and routes from eth0.1 interface.<br />I add them manually:</p><div class="codebox"><pre><code>ip ad add 10.249.28.34 dev eth0.1
ip ro add 10.249.28.0/24 dev eth0.1  proto static scope link  src 10.249.28.34
ip ro add to 10.248.0.0/15 via 10.249.28.254 src 10.249.28.34 dev eth0.1 proto static</code></pre></div><p>The last route adds my ISP&#039;s local network. Now I am able to access both internet and ISP&#039;s network from the router and access internet from computer connected to lan. But I can&#039;t connect to ISP&#039;s network from my lan.<br />The following iptables rules solve this issue, assuming that router has a constant address in ISP&#039;s network (if this is not the case for you, use MASQUERADE)</p><div class="codebox"><pre><code>iptables -t nat -A POSTROUTING -s 192.168.1.0/24 -d 10.248.0.0/15 -o eth0.1 -j SNAT --to-source 10.249.28.34
iptables -t filter -A FORWARD -i br-lan -o eth0.1 -j ACCEPT</code></pre></div><p>And all works fine until udhcpc renews ISP_internal. It adds a default route to it. So route table become</p><div class="codebox"><pre><code>root@OpenWrt:~# ip ro sh
10.250.254.11 dev ppp0  proto kernel  scope link  src 10.250.28.34 
192.168.1.0/24 dev br-lan  proto kernel  scope link  src 192.168.1.1 
10.249.28.0/24 dev eth0.1  proto kernel  scope link  src 10.249.28.34 
10.248.0.0/15 via 10.249.28.254 dev eth0.1  proto static  src 10.249.28.34 
default via 10.249.28.254 dev eth0.1 
default via 10.250.254.11 dev ppp0

root@OpenWrt:~# ip ro del default via 10.249.28.254</code></pre></div><p>When I remove wrong route all works fine again.<br />The problem is to specify somehow to udhcpc what routes I want to be renewed.<br />And /var/state/network is overflowing since I change routing every time.</p><p>Sorry for my terrible english.</p><p>[update]</p><p>There is <a href="https://dev.openwrt.org/ticket/3022">ticket #3022</a>.<br />I fixed it this way: added to /usr/share/udhcp/default.script in renew|bound statement before routing setup lines<br /></p><div class="codebox"><pre><code>for old_ip in $(cat /tmp/state/network | grep ipaddr | awk -F\&#039; &#039;{print $6}&#039;); do           
[ &quot;$old_ip&quot; = &quot;$ip&quot; ] &amp;&amp; {                                                                  
exit 0                                                                                      
}                                                                                           
done</code></pre></div><p>That is not good, but seems to work.</p>											<p class="post-edited">(Last edited by <strong>zaq-zaq</strong> on 1 Jun 2008, 17:23)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p72541">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">CMatters</div>
					<div class="post-datetime">
						21 Aug 2008, 20:56					</div>
				</div>
				<div class="post-content content">
					<p>Hello... I am having a similar problem.&nbsp; I can connect to my ISP via pppoe. By that I mean the router can authenticate and connect to the ISP&#039;s network.&nbsp; However, I cannot see anything from my PC.&nbsp; &nbsp;I can ping from the router ssh session but not from my PC.&nbsp; I have followed the directions in the bug report (adding &quot;start&quot; to the /etc/init.d/network file.)&nbsp; No success.&nbsp; I am using a WRT54GL v1.1, Kamikaze 7.09.</p><p>It&#039;s a very simple setup.&nbsp; Cable modem attached to WAN port on router, PC connected to LAN port on router.&nbsp; Period.</p><p>My /etc/config/network file<br /></p><div class="codebox"><pre><code>#### VLAN configuration
config switch eth0
        option vlan0    &quot;0 1 2 3 5*&quot;
        option vlan1    &quot;4 5&quot;

#### Loopback configuration
config interface loopback
        option ifname   &quot;lo&quot;
        option proto    static
        option ipaddr   127.0.0.1
        option netmask  255.0.0.0

#### LAN configuration
config interface lan
        option type     bridge
        option ifname   &quot;eth0.0&quot;
        option proto    static
        option ipaddr   192.168.1.1
        option netmask  255.255.255.0

#### WAN configuration
config interface        wan
        option ifname   &quot;eth0.1&quot;
        option proto    pppoe
        option username xxxxxx
        option password xxxxx
        option macaddr  00:19:B9:7B:8B:12</code></pre></div><p>and result of ifconfig<br /></p><div class="codebox"><pre><code>root@OpenWrt:/# ifconfig
br-lan    Link encap:Ethernet  HWaddr 00:21:29:A5:BB:A2
          inet addr:192.168.1.1  Bcast:192.168.1.255  Mask:255.255.255.0
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:71 errors:0 dropped:0 overruns:0 frame:0
          TX packets:38 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:3819 (3.7 KiB)  TX bytes:4038 (3.9 KiB)

eth0      Link encap:Ethernet  HWaddr 00:21:29:A5:BB:A2
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:313 errors:0 dropped:0 overruns:0 frame:0
          TX packets:75 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:22439 (21.9 KiB)  TX bytes:7574 (7.3 KiB)
          Interrupt:4

eth0.0    Link encap:Ethernet  HWaddr 00:21:29:A5:BB:A2
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:79 errors:0 dropped:0 overruns:0 frame:0
          TX packets:45 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:4624 (4.5 KiB)  TX bytes:4890 (4.7 KiB)

eth0.1    Link encap:Ethernet  HWaddr 00:19:B9:7B:8B:12
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:223 errors:0 dropped:0 overruns:0 frame:0
          TX packets:32 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:11691 (11.4 KiB)  TX bytes:2172 (2.1 KiB)

lo        Link encap:Local Loopback
          inet addr:127.0.0.1  Mask:255.0.0.0
          UP LOOPBACK RUNNING  MTU:16436  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)

ppp0      Link encap:Point-to-Point Protocol
          inet addr:10.40.38.231  P-t-P:10.40.32.1  Mask:255.255.255.255
          UP POINTOPOINT RUNNING NOARP MULTICAST  MTU:1492  Metric:1
          RX packets:6 errors:0 dropped:0 overruns:0 frame:0
          TX packets:22 errors:0 dropped:0 overruns:0 carrier:0</code></pre></div><p>and route<br /></p><div class="codebox"><pre><code>root@OpenWrt:/# route
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
10.40.32.1      *               255.255.255.255 UH    0      0        0 ppp0
192.168.1.0     *               255.255.255.0   U     0      0        0 br-lan
default         10.40.32.1      0.0.0.0         UG    0      0        0 ppp0</code></pre></div><p>Any ideas?&nbsp; Looks like a routing problem but I am not sure where to start.&nbsp; Thanks!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p72543">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">XeoNoX</div>
					<div class="post-datetime">
						21 Aug 2008, 22:38					</div>
				</div>
				<div class="post-content content">
					<p>it seems as if everything is right; reset the router and try fresh maybe?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p72544">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">CMatters</div>
					<div class="post-datetime">
						21 Aug 2008, 23:05					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>XeoNoX wrote:</cite><blockquote><p>it seems as if everything is right; reset the router and try fresh maybe?</p></blockquote></div><p>I have &quot;reboot&quot; the router at least a dozen times.&nbsp; I have also cycled the power on the modem.&nbsp; Is there something else I should do to start fresh?&nbsp; Thanks!</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>