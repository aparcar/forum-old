<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> OpenWRT Noob needs serious help with OpenVPN</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 22 Apr 2018 and 4 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 2</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=73637&amp;p=2.html">2</a></li></ul></nav></div>
			
		
		
			<article class="post" id="p374418">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">Inf1n1nty</div>
					<div class="post-datetime">
						25 Mar 2018, 16:44					</div>
				</div>
				<div class="post-content content">
					<p>Greetings, I am new to DD-WRT and I need serial help with my OpenVPN configuration.</p><p>I use an Linksys WRT32X with Stock Firmware.</p><p>Here are my configuration files and log&#039;s.</p><p>I cannot find a config log on my Router.</p><p>Is ist possible that OpenVPN Server is locked out from Linksys on the WRT32X??</p><p>Thank you!</p><p><strong>firewall</strong></p><div class="codebox"><pre><code>config defaults
    option syn_flood &#039;1&#039;
    option input &#039;ACCEPT&#039;
    option output &#039;ACCEPT&#039;
    option forward &#039;REJECT&#039;

config zone
    option name &#039;lan&#039;
    list network &#039;lan&#039;
    option input &#039;ACCEPT&#039;
    option output &#039;ACCEPT&#039;
    option forward &#039;ACCEPT&#039;

config zone
    option name &#039;wan&#039;
    list network &#039;wan&#039;
    list network &#039;wan6&#039;
    option input &#039;REJECT&#039;
    option output &#039;ACCEPT&#039;
    option forward &#039;REJECT&#039;
    option masq &#039;1&#039;
    option mtu_fix &#039;1&#039;

config forwarding
    option src &#039;lan&#039;
    option dest &#039;wan&#039;

config rule
    option name &#039;Allow-DHCP-Renew&#039;
    option src &#039;wan&#039;
    option proto &#039;udp&#039;
    option dest_port &#039;68&#039;
    option target &#039;ACCEPT&#039;
    option family &#039;ipv4&#039;

config rule
    option name &#039;Allow-Ping&#039;
    option src &#039;wan&#039;
    option proto &#039;icmp&#039;
    option icmp_type &#039;echo-request&#039;
    option family &#039;ipv4&#039;
    option target &#039;DROP&#039;

config rule
    option name &#039;Allow-IGMP&#039;
    option src &#039;wan&#039;
    option proto &#039;igmp&#039;
    option family &#039;ipv4&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-DHCPv6&#039;
    option src &#039;wan&#039;
    option proto &#039;udp&#039;
    option src_ip &#039;fc00::/6&#039;
    option dest_ip &#039;fc00::/6&#039;
    option dest_port &#039;546&#039;
    option family &#039;ipv6&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-MLD&#039;
    option src &#039;wan&#039;
    option proto &#039;icmp&#039;
    option src_ip &#039;fe80::/10&#039;
    list icmp_type &#039;130/0&#039;
    list icmp_type &#039;131/0&#039;
    list icmp_type &#039;132/0&#039;
    list icmp_type &#039;143/0&#039;
    option family &#039;ipv6&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-ICMPv6-Input&#039;
    option src &#039;wan&#039;
    option proto &#039;icmp&#039;
    list icmp_type &#039;echo-request&#039;
    list icmp_type &#039;echo-reply&#039;
    list icmp_type &#039;destination-unreachable&#039;
    list icmp_type &#039;packet-too-big&#039;
    list icmp_type &#039;time-exceeded&#039;
    list icmp_type &#039;bad-header&#039;
    list icmp_type &#039;unknown-header-type&#039;
    list icmp_type &#039;router-solicitation&#039;
    list icmp_type &#039;neighbour-solicitation&#039;
    list icmp_type &#039;router-advertisement&#039;
    list icmp_type &#039;neighbour-advertisement&#039;
    option limit &#039;1000/sec&#039;
    option family &#039;ipv6&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-ICMPv6-Forward&#039;
    option src &#039;wan&#039;
    option dest &#039;*&#039;
    option proto &#039;icmp&#039;
    list icmp_type &#039;echo-request&#039;
    list icmp_type &#039;echo-reply&#039;
    list icmp_type &#039;destination-unreachable&#039;
    list icmp_type &#039;packet-too-big&#039;
    list icmp_type &#039;time-exceeded&#039;
    list icmp_type &#039;bad-header&#039;
    list icmp_type &#039;unknown-header-type&#039;
    option limit &#039;1000/sec&#039;
    option family &#039;ipv6&#039;
    option target &#039;ACCEPT&#039;

config include
    option path &#039;/etc/firewall.user&#039;

config rule
    option src &#039;wan&#039;
    option dest &#039;lan&#039;
    option proto &#039;esp&#039;
    option target &#039;ACCEPT&#039;

config rule
    option src &#039;wan&#039;
    option dest &#039;lan&#039;
    option dest_port &#039;500&#039;
    option proto &#039;udp&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Samba&#039;
    option src &#039;lan&#039;
    option proto &#039;tcp&#039;
    option dest_port &#039;139&#039;
    option target &#039;ACCEPT&#039;

config include &#039;miniupnpd&#039;
    option type &#039;script&#039;
    option path &#039;/usr/share/miniupnpd/firewall.include&#039;
    option family &#039;any&#039;
    option reload &#039;1&#039;

config include &#039;krouter&#039;
    option path &#039;/usr/lib/krouter-scripts/firemark.sh&#039;

config redirect
    option enabled &#039;1&#039;
    option target &#039;DNAT&#039;
    option src &#039;wan&#039;
    option dest &#039;lan&#039;
    option name &#039;RDP_Client1&#039;
    option dest_ip &#039;192.168.4.10&#039;
    option dest_port &#039;3310&#039;
    option src_dport &#039;3389&#039;
    option proto &#039;tcp udp icmp&#039;

config rule
    option name &#039;Allow-OpenVPN-Inbound&#039;
    option target &#039;ACCEPT&#039;
    option src &#039;*&#039;
    option proto &#039;tcpudp&#039;
    option dest_port &#039;1194&#039;

config zone
    option name &#039;vpnserver&#039;
    option input &#039;ACCEPT&#039;
    option forward &#039;REJECT&#039;
    option output &#039;ACCEPT&#039;
    option masq &#039;1&#039;
    option network &#039;vpnserver&#039;

config forwarding
    option src &#039;vpnserver&#039;
    option dest &#039;wan&#039;

config forwarding
    option src &#039;wan&#039;
    option dest &#039;vpnserver&#039;

config forwarding
    option src &#039;vpnserver&#039;
    option dest &#039;lan&#039;

config forwarding
    option src &#039;lan&#039;
    option dest &#039;vpnserver&#039;</code></pre></div><br /><p><strong>network</strong></p><div class="codebox"><pre><code>config interface &#039;loopback&#039;
    option ifname &#039;lo&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;127.0.0.1&#039;
    option netmask &#039;255.0.0.0&#039;

config globals &#039;globals&#039;
    option ula_prefix &#039;fd85:f178:0495::/48&#039;

config interface &#039;lan&#039;
    option type &#039;bridge&#039;
    option ifname &#039;eth1&#039;
    option proto &#039;static&#039;
    option netmask &#039;255.255.255.0&#039;
    option ip6assign &#039;60&#039;
    option ipaddr &#039;192.168.4.254&#039;

config interface &#039;wan&#039;
    option ifname &#039;eth0&#039;
    option disabled &#039;0&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;x.x.x.x&#039;
    option gateway &#039;x.x.x.x&#039;
    option netmask &#039;&#039;x.x.x.x&#039;
    list dns &#039;&#039;x.x.x.x&#039;
    list dns  &#039;x.x.x.x&#039;

config interface &#039;wan6&#039;
    option ifname &#039;eth0&#039;
    option proto &#039;dhcpv6&#039;
    option disabled &#039;0&#039;

config switch
    option name &#039;switch0&#039;
    option reset &#039;1&#039;
    option enable_vlan &#039;1&#039;

config switch_vlan
    option device &#039;switch0&#039;
    option vlan &#039;1&#039;
    option ports &#039;0 1 2 3 6&#039;

config switch_vlan
    option device &#039;switch0&#039;
    option vlan &#039;2&#039;
    option ports &#039;4 5&#039;

config interface &#039;vpnserver&#039;
    option proto &#039;none&#039;
    option ifname &#039;ovpns0&#039;
    option auto &#039;1&#039;</code></pre></div><br /><p><strong>OpenVPN Client Config</strong></p><p> </p><div class="codebox"><pre><code> client
  dev tun
  proto udp
  fast-io
  remote x.x.x.x. 1194
  remote-cert-tls server
  nobind
  persist-key
  persist-tun
  comp-lzo no
  verb 3
  key-direction 1
&lt;ca&gt;
-----BEGIN CERTIFICATE-----
-----END CERTIFICATE-----
&lt;/ca&gt;
&lt;cert&gt;
Certificate:
  -----BEGIN CERTIFICATE-----
-----END CERTIFICATE-----
&lt;/cert&gt;
&lt;key&gt;
-----BEGIN PRIVATE KEY-----
-----END PRIVATE KEY-----
&lt;/key&gt;
&lt;tls-auth&gt;
#
# 2048 bit OpenVPN static key
#
-----BEGIN OpenVPN Static key V1-----

-----END OpenVPN Static key V1-----
&lt;/tls-auth&gt;</code></pre></div><br /><p><strong>Logfile OpenVPN Client (Windows):</strong></p><br /><br /><div class="codebox"><pre><code>Sun Mar 25 15:37:30 2018 OpenVPN 2.4.4 x86_64-w64-mingw32 [SSL (OpenSSL)] [LZO] [LZ4] [PKCS11] [AEAD] built on Sep 26 2017
Sun Mar 25 15:37:30 2018 Windows version 6.2 (Windows 8 or greater) 64bit
Sun Mar 25 15:37:30 2018 library versions: OpenSSL 1.0.2l  25 May 2017, LZO 2.10
Sun Mar 25 15:37:30 2018 MANAGEMENT: TCP Socket listening on [AF_INET]127.0.0.1:25342
Sun Mar 25 15:37:30 2018 Need hold release from management interface, waiting...
Sun Mar 25 15:37:31 2018 MANAGEMENT: Client connected from [AF_INET]127.0.0.1:25342
Sun Mar 25 15:37:31 2018 MANAGEMENT: CMD &#039;state on&#039;
Sun Mar 25 15:37:31 2018 MANAGEMENT: CMD &#039;log all on&#039;
Sun Mar 25 15:37:31 2018 MANAGEMENT: CMD &#039;echo all on&#039;
Sun Mar 25 15:37:31 2018 MANAGEMENT: CMD &#039;hold off&#039;
Sun Mar 25 15:37:31 2018 MANAGEMENT: CMD &#039;hold release&#039;
Sun Mar 25 15:37:31 2018 NOTE: --fast-io is disabled since we are running on Windows
Sun Mar 25 15:37:31 2018 Outgoing Control Channel Authentication: Using 160 bit message hash &#039;SHA1&#039; for HMAC authentication
Sun Mar 25 15:37:31 2018 Incoming Control Channel Authentication: Using 160 bit message hash &#039;SHA1&#039; for HMAC authentication
Sun Mar 25 15:37:31 2018 TCP/UDP: Preserving recently used remote address: [AF_INET]x.x.x.x:1194
Sun Mar 25 15:37:31 2018 Socket Buffers: R=[65536-&gt;65536] S=[65536-&gt;65536]
Sun Mar 25 15:37:31 2018 UDP link local: (not bound)
Sun Mar 25 15:37:31 2018 UDP link remote: [AF_INET]x.x.x.x:1194
Sun Mar 25 15:37:31 2018 MANAGEMENT: &gt;STATE:1521985051,WAIT,,,,,,
Sun Mar 25 15:37:31 2018 read UDP: Unknown error (code=10054)
Sun Mar 25 15:37:33 2018 read UDP: Unknown error (code=10054)
Sun Mar 25 15:37:37 2018 read UDP: Unknown error (code=10054)
Sun Mar 25 15:37:45 2018 read UDP: Unknown error (code=10054)
Sun Mar 25 15:38:01 2018 read UDP: Unknown error (code=10054)
Sun Mar 25 15:38:31 2018 TLS Error: TLS key negotiation failed to occur within 60 seconds (check your network connectivity)
Sun Mar 25 15:38:31 2018 TLS Error: TLS handshake failed
Sun Mar 25 15:38:31 2018 SIGUSR1[soft,tls-error] received, process restarting
Sun Mar 25 15:38:31 2018 MANAGEMENT: &gt;STATE:1521985111,RECONNECTING,tls-error,,,,,
Sun Mar 25 15:38:31 2018 Restart pause, 5 second(s)
Sun Mar 25 15:38:36 2018 NOTE: --fast-io is disabled since we are running on Windows
Sun Mar 25 15:38:36 2018 TCP/UDP: Preserving recently used remote address: [AF_INET]x.x.x.x.:1194
Sun Mar 25 15:38:36 2018 Socket Buffers: R=[65536-&gt;65536] S=[65536-&gt;65536]
Sun Mar 25 15:38:36 2018 UDP link local: (not bound)
Sun Mar 25 15:38:36 2018 UDP link remote: [AF_INET]x.x.x.x:1194
Sun Mar 25 15:38:36 2018 MANAGEMENT: &gt;STATE:1521985116,WAIT,,,,,,
Sun Mar 25 15:38:36 2018 read UDP: Unknown error (code=10054)
Sun Mar 25 15:38:38 2018 read UDP: Unknown error (code=10054)
Sun Mar 25 15:38:42 2018 read UDP: Unknown error (code=10054)
Sun Mar 25 15:38:50 2018 read UDP: Unknown error (code=10054)
Sun Mar 25 15:39:07 2018 read UDP: Unknown error (code=10054)
Sun Mar 25 15:39:36 2018 TLS Error: TLS key negotiation failed to occur within 60 seconds (check your network connectivity)
Sun Mar 25 15:39:36 2018 TLS Error: TLS handshake failed
Sun Mar 25 15:39:36 2018 SIGUSR1[soft,tls-error] received, process restarting
Sun Mar 25 15:39:36 2018 MANAGEMENT: &gt;STATE:1521985176,RECONNECTING,tls-error,,,,,
Sun Mar 25 15:39:36 2018 Restart pause, 5 second(s)</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p374420">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">Inf1n1nty</div>
					<div class="post-datetime">
						25 Mar 2018, 17:09					</div>
				</div>
				<div class="post-content content">
					<p>I have found one more thing:</p><p>When I execute the command &quot;#netstat -ltnup | grep 1194&quot; I can see that OpenVPN is not listening on port 1194!?</p><p>What can I do?</p><p>Is is possible that the OEM-WRT Firmware is blocking OpenVPN Server?</p><p>Thank you</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p374422">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">600cc</div>
					<div class="post-datetime">
						25 Mar 2018, 18:05					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Inf1n1nty wrote:</cite><blockquote><p>I am new to DD-WRT</p></blockquote></div><p>This forum is devoted to OpenWRT. It&#039;s similar to DD-WRT, but there are differences. You might be better off asking in the DD-WRT forum.</p><p>However, in case we can tempt you away from DD-WRT and onto OpenWRT, we&#039;ll try to be helpful, if we can.</p><p>Try to launch the OpenVPN server on your router. Then, straight afterwards, obtain the output of the following two commands:<br /></p><div class="codebox"><pre><code>ps | grep openvpn
logread -e openvpn</code></pre></div><p>The first command will tell you if openvpn is running. The second command will provide some log entries which might help to troubleshoot.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p374425">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">Inf1n1nty</div>
					<div class="post-datetime">
						25 Mar 2018, 18:35					</div>
				</div>
				<div class="post-content content">
					<p>Sorry I am an Idiot..</p><p>I am new to <strong>Open</strong>-WRT.</p><p>My former router had DD-WRT installed, so I am sorry for this mistake.</p><p>This is what I get so I think OpenVPN is running:</p><div class="codebox"><pre><code>root@WRT32X:~# ps | grep openvpn
19155 root      1080 S    grep openvpn</code></pre></div><br /><br /><p>The logread-command shows no output</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p374426">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">Inf1n1nty</div>
					<div class="post-datetime">
						25 Mar 2018, 18:40					</div>
				</div>
				<div class="post-content content">
					<p>Maybe this helps too:</p><p>When I execute this command&nbsp; to install openvpn I get an error, I have read that the Repo for my Router is rejected.<br />In GUI there is still an Openvpn Client. Maybe some installation package on my router are missing?</p><p><strong>root@WRT32X:~# opkg update &amp;&amp; opkg install openvpn-openssl openssl-util luci-app-openvp</strong></p><br /><div class="codebox"><pre><code>Downloading http://downloads.openwrt.org/snapshots/trunk/mvebu/generic/packages/base/Packages.gz.
# custom headers to add: 0
Updated list of available packages in /var/opkg-lists/designated_driver_base.
Downloading http://downloads.openwrt.org/snapshots/trunk/mvebu/generic/packages/base/Packages.sig.
# custom headers to add: 0
Signature check passed.
Downloading http://downloads.openwrt.org/snapshots/trunk/mvebu/generic/packages/kernel/Packages.gz.
# custom headers to add: 0
Updated list of available packages in /var/opkg-lists/designated_driver_kernel.
Downloading http://downloads.openwrt.org/snapshots/trunk/mvebu/generic/packages/kernel/Packages.sig.
# custom headers to add: 0
Signature check passed.
Downloading http://downloads.openwrt.org/snapshots/trunk/mvebu/generic/packages/linksys/Packages.gz.
# custom headers to add: 0
Downloading http://downloads.openwrt.org/snapshots/trunk/mvebu/generic/packages/linksys/Packages.sig.
# custom headers to add: 0
Signature check failed.
Remove wrong Signature file.
Downloading http://downloads.openwrt.org/snapshots/trunk/mvebu/generic/packages/packages/Packages.gz.
# custom headers to add: 0
Updated list of available packages in /var/opkg-lists/designated_driver_packages.
Downloading http://downloads.openwrt.org/snapshots/trunk/mvebu/generic/packages/packages/Packages.sig.
# custom headers to add: 0
Signature check passed.
Downloading http://downloads.openwrt.org/snapshots/trunk/mvebu/generic/packages/routing/Packages.gz.
# custom headers to add: 0
Updated list of available packages in /var/opkg-lists/designated_driver_routing.
Downloading http://downloads.openwrt.org/snapshots/trunk/mvebu/generic/packages/routing/Packages.sig.
# custom headers to add: 0
Signature check passed.
Downloading http://downloads.openwrt.org/snapshots/trunk/mvebu/generic/packages/telephony/Packages.gz.
# custom headers to add: 0
Updated list of available packages in /var/opkg-lists/designated_driver_telephony.
Downloading http://downloads.openwrt.org/snapshots/trunk/mvebu/generic/packages/telephony/Packages.sig.
# custom headers to add: 0
Signature check passed.
Collected errors:
 * opkg_download: Failed to download http://downloads.openwrt.org/snapshots/trunk/mvebu/generic/packages/linksys/Packages.gz, wget returned 8.
 * opkg_download: Failed to download http://downloads.openwrt.org/snapshots/trunk/mvebu/generic/packages/linksys/Packages.sig, wget returned 8.</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p374429">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">600cc</div>
					<div class="post-datetime">
						25 Mar 2018, 19:00					</div>
				</div>
				<div class="post-content content">
					<p>What OpenWRT build version is your router running? Is openvpn packaged for that build?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p374431">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">Inf1n1nty</div>
					<div class="post-datetime">
						25 Mar 2018, 19:16					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>600cc wrote:</cite><blockquote><p>Is openvpn packaged for that build?</p></blockquote></div><br /><p>I don&#039;t have a Clue sorry..</p><br /><p>Openvpn was already installed with this OEM Firmware.</p><br /><p>This is what I get on Information from the Router:</p><br /><p>BusyBox v1.24.2 () built-in shell (ash)</p><p>&nbsp; _______&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;________&nbsp; &nbsp; &nbsp; &nbsp; __<br /> |&nbsp; &nbsp; &nbsp; &nbsp;|.-----.-----.-----.|&nbsp; |&nbsp; |&nbsp; |.----.|&nbsp; |_<br /> |&nbsp; &nbsp;-&nbsp; &nbsp;||&nbsp; _&nbsp; |&nbsp; -__|&nbsp; &nbsp; &nbsp;||&nbsp; |&nbsp; |&nbsp; ||&nbsp; &nbsp;_||&nbsp; &nbsp;_|<br /> |_______||&nbsp; &nbsp;__|_____|__|__||________||__|&nbsp; |____|<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |__| W I R E L E S S&nbsp; &nbsp;F R E E D O M<br /> -----------------------------------------------------<br /> DESIGNATED DRIVER (Bleeding Edge, 50140)<br /> -----------------------------------------------------<br />&nbsp; * 2 oz. Orange Juice&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Combine all juices in a<br />&nbsp; * 2 oz. Pineapple Juice&nbsp; &nbsp; &nbsp; tall glass filled with<br />&nbsp; * 2 oz. Grapefruit Juice&nbsp; &nbsp; &nbsp;ice, stir well.<br />&nbsp; * 2 oz. Cranberry Juice<br /> -----------------------------------------------------</p><br /><br /><p>root@WRT32X:~# uname -r<br /><strong>4.4.14</strong></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p374434">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">600cc</div>
					<div class="post-datetime">
						25 Mar 2018, 19:33					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Inf1n1nty wrote:</cite><blockquote><div class="quotebox"><cite>600cc wrote:</cite><blockquote><p>Is openvpn packaged for that build?</p></blockquote></div><br /><p>I don&#039;t have a Clue sorry..</p><p>[...]</p><p>DESIGNATED DRIVER (Bleeding Edge, 50140)</p></blockquote></div><p>That&#039;s going to be your first hurdle.</p><p>If the manufacturer included an OpenVPN package with the firmware, then use that package. If the manufacturer didn&#039;t, then you&#039;ll need to delve into the mysteries of package compilation (which is one reason why I use stable release builds now; it might be behind the curve, but I don&#039;t have the time and patience for, or interest in, playing with snapshots).</p><br /><div class="quotebox"><cite>Inf1n1nty wrote:</cite><blockquote><p>Openvpn was already installed with this OEM Firmware.</p></blockquote></div><p>Let&#039;s prove it, one way or the other. The manufacturer might have included the GUI component, but might have failed to include the actual software that does the work. It&#039;s unlikely, but not impossible. One thing my job has taught me is to ask these three questions whenever I&#039;m troubleshooting:<br /></p><ul><li><p>What&#039;s it supposed to be doing?</p></li><li><p>What do I think it&#039;s supposed to be doing (which might not be the same thing)?</p></li><li><p>What is it actually doing?</p></li></ul><p>In other words, always check and verify your assumptions.</p><p>What are the outputs from these commands?</p><div class="codebox"><pre><code>opkg list-installed | grep openvpn
openvpn --version</code></pre></div>											<p class="post-edited">(Last edited by <strong>600cc</strong> on 25 Mar 2018, 19:33)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p374435">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">Inf1n1nty</div>
					<div class="post-datetime">
						25 Mar 2018, 19:39					</div>
				</div>
				<div class="post-content content">
					<p>Now I have a Log File (I inserted a Line in openvpn config file) but when I connect nothing happens at logging...</p><div class="codebox"><pre><code>Sun Mar 25 18:33:13 2018 OpenVPN 2.3.11 arm-openwrt-linux-gnu [SSL (PolarSSL)] [LZO] [EPOLL] [MH] [IPv6]
Sun Mar 25 18:33:13 2018 library versions: PolarSSL 1.3.17, LZO 2.09
Sun Mar 25 18:33:13 2018 NOTE: the current --script-security setting may allow this configuration to call user-defined scripts</code></pre></div><br /><div class="codebox"><pre><code>root@WRT32X:~# opkg list-installed | grep openvpn
openvpn-easy-rsa - 2013-01-30-2
openvpn-polarssl - 2.3.11-1</code></pre></div><div class="codebox"><pre><code>root@WRT32X:~# openvpn --version
OpenVPN 2.3.11 arm-openwrt-linux-gnu [SSL (PolarSSL)] [LZO] [EPOLL] [MH] [IPv6]
library versions: PolarSSL 1.3.17, LZO 2.09
Originally developed by James Yonan
Copyright (C) 2002-2010 OpenVPN Technologies, Inc. &lt;sales@openvpn.net&gt;</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p374436">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">Inf1n1nty</div>
					<div class="post-datetime">
						25 Mar 2018, 19:42					</div>
				</div>
				<div class="post-content content">
					<p>I have installed Easy-RSA for creating the Keys, the openvpn-polarssl Package was already installed from linksys.</p><p>Unfortunately there is no other Open-WRT Firmware (what I can see) for this Router so I cannot switch to another release <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p374438">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">600cc</div>
					<div class="post-datetime">
						25 Mar 2018, 19:46					</div>
				</div>
				<div class="post-content content">
					<p>Time for a couple of really dumb questions, I&#039;m afraid. Apologies if these have already been addressed.</p><p>Firstly, in your first post, I can see a client configuration, but not a server configuration. What are the contents of /etc/config/openvpn on your router? If the certificates and keys are shown inline in the config file, then remove them.</p><p>Secondly, your client config in your first post has placeholders for certificates and keys, but the details are blank (which is good - we don&#039;t need to see your keys and certs). However, for the avoidance of doubt, does your real client config file have actual certificates in it?</p>											<p class="post-edited">(Last edited by <strong>600cc</strong> on 25 Mar 2018, 19:49)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p374439">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">Inf1n1nty</div>
					<div class="post-datetime">
						25 Mar 2018, 20:09					</div>
				</div>
				<div class="post-content content">
					<p>This are no dumb questions <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>This is the content of /etc/config/openvpn:</p><div class="codebox"><pre><code>config openvpn &#039;vpnserver&#039;
    option enabled &#039;1&#039;
    option dev_type &#039;tun&#039;
    option dev &#039;ovpns0&#039;
    option port &#039;1194&#039;
    option proto &#039;udp&#039;
    option comp_lzo &#039;yes&#039;
    option keepalive &#039;10 120&#039;
    option persist_key &#039;1&#039;
    option persist_tun &#039;1&#039;
    option ca &#039;/etc/openvpn/ca.crt&#039;
    option cert &#039;/etc/openvpn/my-server.crt&#039;
    option key &#039;/etc/openvpn/my-server.key&#039;
    option dh &#039;/etc/openvpn/dh2048.pem&#039;
    option tls_auth &#039;/etc/openvpn/tls-auth.key 0&#039;
    option mode &#039;server&#039;
    option tls_server &#039;1&#039;
    option server &#039;192.168.200.0 255.255.255.0&#039;
    option topology &#039;subnet&#039;
    option route_gateway &#039;dhcp&#039;
    option client_to_client &#039;1&#039;
    option log &#039;/tmp/openvpn.log&#039;
    list push &#039;comp-lzo yes&#039;
    list push &#039;persist-key&#039;
    list push &#039;persist-tun&#039;
    list push &#039;topology subnet&#039;
    list push &#039;route-gateway dhcp&#039;
    list push &#039;redirect-gateway def1 bypass-dhcp&#039;
    list push &#039;route 192.168.4.0 255.255.255.0&#039;
    list push &#039;dhcp-option DNS 192.168.4.1&#039;</code></pre></div><br /><p>I have removed the Certificates <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p374441">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">Inf1n1nty</div>
					<div class="post-datetime">
						25 Mar 2018, 20:26					</div>
				</div>
				<div class="post-content content">
					<p>[url]https://openwrt.org/docs/guide-user/services/vpn/openvpn/server.setup?s[]=openvpn[/url]</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p374443">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">Inf1n1nty</div>
					<div class="post-datetime">
						25 Mar 2018, 20:29					</div>
				</div>
				<div class="post-content content">
					<p>This is the Guide I used to configure OpenVPN.</p><br /><p>I believe that there is a Mistake:</p><p>cd /tmp &amp;&amp; wget <a href="https://openwrt.org/_export/code/docs/guide-user/services/vpn/openvpn/server.setup?codeblock=3">https://openwrt.org/_export/code/docs/g … odeblock=3</a></p><p>mv server.setup?codeblock=<strong>1</strong> create-certs.sh &amp;&amp; chmod 754 ./create-certs.sh &amp;&amp; ./create-certs.sh </p><p>I have exchanged codeblock=3 with codeblock=1</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p374444">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">600cc</div>
					<div class="post-datetime">
						25 Mar 2018, 20:43					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m not familiar with that particular document, so I can&#039;t comment. However, if you believe you&#039;ve found a mistake in the documentation and can provide a correction, please do so. The wiki is open to everyone who registers.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p374445">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">Inf1n1nty</div>
					<div class="post-datetime">
						25 Mar 2018, 20:53					</div>
				</div>
				<div class="post-content content">
					<p>Is my Server Configuration ok? Can you see if i made a mistake?</p><p>Thank you</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p374450">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">600cc</div>
					<div class="post-datetime">
						25 Mar 2018, 22:29					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Inf1n1nty wrote:</cite><blockquote><p>Is my Server Configuration ok? Can you see if i made a mistake?</p></blockquote></div><p>Your configuration doesn&#039;t quite match the way I&#039;d do it - <a href="https://forum.openwrt.org/viewtopic.php?pid=373075#p373075">https://forum.openwrt.org/viewtopic.php … 75#p373075</a> - but you&#039;re running a different version of OpenWRT and OpenVPN.</p><p>There are some changes in the way the configurations are put together, so the fact that yours is different isn&#039;t necessarily a problem.</p><p>Nothing immediately leaps out at me about your configuration, but something must not be right because the openvpn process isn&#039;t running.</p><p>The configuration you&#039;re seeing isn&#039;t the real configuration used by OpenVPN. Instead, it&#039;s an abstracted configuration in OpenWRT&#039;s UCI syntax. It gets translated into a real OpenVPN configuration file, which is then used when launching the openvpn process.</p><p>In LEDE 17.01.4 the real configuration lives in /tmp/etc (on mine, using the configuration linked in the post above, the configuration is /tmp/etc/openvpn-routed_udp.conf). I don&#039;t know where it lives on Designated Driver, but I&#039;d look in /tmp/etc to begin with, for a file called &quot;openvpn-vpnserver.conf&quot; (the part of the name after &quot;openvpn-&quot; is taken from the section name in /etc/config/openvpn).</p><p>If it&#039;s not there, search the entire filesystem, starting with /tmp and widening your search if nothing&#039;s in /tmp and below. The file might not be called &quot;openvpn-vpnserver.conf&quot;; be prepared to search for anything. You can also use grep to look for text which could help identify the file in question. For example: <strong>grep -ilr &quot;redirect-gateway&quot; /tmp/*</strong> would tell you the name of any file which contains the text &quot;redirect-gateway&quot; and lives in /tmp or below.</p><p>If you tried running &quot;logread&quot; <em>immediately </em>after trying to start the OpenVPN server and can&#039;t see anything, then it might be possible to see what&#039;s wrong by launching the openvpn process manually.</p><p>Once you&#039;ve found your real OpenVPN configuration file, you can use it when launching the openvpn process:<br /></p><div class="codebox"><pre><code>openvpn --config /path/to/configuration/file.conf</code></pre></div><p>Replace /path/to/configuration/file.conf with the real configuration file path.</p><p>If the process stops at the text &quot;Initialization Sequence Completed&quot; and doesn&#039;t do anything else, then OpenVPN is running. Open a second SSH session to continue investigations, if you want to see which port(s) are being used by OpenVPN. Alternately, press Ctrl-C to stop the OpenVPN server and close any open ports.</p><p>If the process fails to launch, somewhere in the bunch of on-screen text should be one or more clues about why.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p374476">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">Inf1n1nty</div>
					<div class="post-datetime">
						26 Mar 2018, 09:07					</div>
				</div>
				<div class="post-content content">
					<p>Thank you very much, this is a very good hint!</p><br /><p>I have seen a some parameters in the original OpenVPN config file with a path.</p><p>I have saved this file before i made my changes. For the next few hours I am at work and cannot connect to my router <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> </p><p>When I am at home I will look up and post the content of the original config file.</p><p>Thank you!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p374510">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">Inf1n1nty</div>
					<div class="post-datetime">
						26 Mar 2018, 21:27					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>I have restored original openvpn file:</p><div class="codebox"><pre><code>package openvpn

#################################################
# Sample to include a custom config file.       #
#################################################

config openvpn custom_config

    # Set to 1 to enable this instance:
    option enabled 0

    # Include OpenVPN configuration
    option config /etc/openvpn/my-vpn.conf


#################################################
# Sample OpenVPN 2.0 uci config for             #
# multi-client server.                          #
#################################################

config openvpn sample_server

    # Set to 1 to enable this instance:
    option enabled 0

    # Which local IP address should OpenVPN
    # listen on? (optional)
#    option local 0.0.0.0

    # Which TCP/UDP port should OpenVPN listen on?
    # If you want to run multiple OpenVPN instances
    # on the same machine, use a different port
    # number for each one.  You will need to
    # open up this port on your firewall.
    option port 1194

    # TCP or UDP server?
#    option proto tcp
    option proto udp

    # &quot;dev tun&quot; will create a routed IP tunnel,
    # &quot;dev tap&quot; will create an ethernet tunnel.
    # Use &quot;dev tap0&quot; if you are ethernet bridging
    # and have precreated a tap0 virtual interface
    # and bridged it with your ethernet interface.
    # If you want to control access policies
    # over the VPN, you must create firewall
    # rules for the the TUN/TAP interface.
    # On non-Windows systems, you can give
    # an explicit unit number, such as tun0.
    # On Windows, use &quot;dev-node&quot; for this.
    # On most systems, the VPN will not function
    # unless you partially or fully disable
    # the firewall for the TUN/TAP interface.
#    option dev tap
    option dev tun

    # SSL/TLS root certificate (ca), certificate
    # (cert), and private key (key).  Each client
    # and the server must have their own cert and
    # key file.  The server and all clients will
    # use the same ca file.
    #
    # See the &quot;easy-rsa&quot; directory for a series
    # of scripts for generating RSA certificates
    # and private keys.  Remember to use
    # a unique Common Name for the server
    # and each of the client certificates.
    #
    # Any X509 key management system can be used.
    # OpenVPN can also use a PKCS #12 formatted key file
    # (see &quot;pkcs12&quot; directive in man page).
    option ca /etc/openvpn/ca.crt
    option cert /etc/openvpn/server.crt
    # This file should be kept secret:
    option key /etc/openvpn/server.key

    # Diffie hellman parameters.
    # Generate your own with:
    #   openssl dhparam -out dh1024.pem 1024
    # Substitute 2048 for 1024 if you are using
    # 2048 bit keys.
    option dh /etc/openvpn/dh1024.pem

    # Configure server mode and supply a VPN subnet
    # for OpenVPN to draw client addresses from.
    # The server will take 10.8.0.1 for itself,
    # the rest will be made available to clients.
    # Each client will be able to reach the server
    # on 10.8.0.1. Comment this line out if you are
    # ethernet bridging. See the man page for more info.
    option server &quot;10.8.0.0 255.255.255.0&quot;

    # Maintain a record of client &lt;-&gt; virtual IP address
    # associations in this file.  If OpenVPN goes down or
    # is restarted, reconnecting clients can be assigned
    # the same virtual IP address from the pool that was
    # previously assigned.
    option ifconfig_pool_persist /tmp/ipp.txt

    # Configure server mode for ethernet bridging.
    # You must first use your OS&#039;s bridging capability
    # to bridge the TAP interface with the ethernet
    # NIC interface.  Then you must manually set the
    # IP/netmask on the bridge interface, here we
    # assume 10.8.0.4/255.255.255.0.  Finally we
    # must set aside an IP range in this subnet
    # (start=10.8.0.50 end=10.8.0.100) to allocate
    # to connecting clients.  Leave this line commented
    # out unless you are ethernet bridging.
#    option server_bridge &quot;10.8.0.4 255.255.255.0 10.8.0.50 10.8.0.100&quot;

    # Push routes to the client to allow it
    # to reach other private subnets behind
    # the server.  Remember that these
    # private subnets will also need
    # to know to route the OpenVPN client
    # address pool (10.8.0.0/255.255.255.0)
    # back to the OpenVPN server.
#    list push &quot;route 192.168.10.0 255.255.255.0&quot;
#    list push &quot;route 192.168.20.0 255.255.255.0&quot;

    # To assign specific IP addresses to specific
    # clients or if a connecting client has a private
    # subnet behind it that should also have VPN access,
    # use the subdirectory &quot;ccd&quot; for client-specific
    # configuration files (see man page for more info).

    # EXAMPLE: Suppose the client
    # having the certificate common name &quot;Thelonious&quot;
    # also has a small subnet behind his connecting
    # machine, such as 192.168.40.128/255.255.255.248.
    # First, uncomment out these lines:
#    option client_config_dir /etc/openvpn/ccd
#    list route &quot;192.168.40.128 255.255.255.248&quot;
    # Then create a file ccd/Thelonious with this line:
    #   iroute 192.168.40.128 255.255.255.248
    # This will allow Thelonious&#039; private subnet to
    # access the VPN.  This example will only work
    # if you are routing, not bridging, i.e. you are
    # using &quot;dev tun&quot; and &quot;server&quot; directives.

    # EXAMPLE: Suppose you want to give
    # Thelonious a fixed VPN IP address of 10.9.0.1.
    # First uncomment out these lines:
#    option client_config_dir /etc/openvpn/ccd
#    list route &quot;10.9.0.0 255.255.255.252&quot;
#    list route &quot;192.168.100.0 255.255.255.0&quot;
    # Then add this line to ccd/Thelonious:
    #   ifconfig-push &quot;10.9.0.1 10.9.0.2&quot;

    # Suppose that you want to enable different
    # firewall access policies for different groups
    # of clients.  There are two methods:
    # (1) Run multiple OpenVPN daemons, one for each
    #     group, and firewall the TUN/TAP interface
    #     for each group/daemon appropriately.
    # (2) (Advanced) Create a script to dynamically
    #     modify the firewall in response to access
    #     from different clients.  See man
    #     page for more info on learn-address script.
#    option learn_address /etc/openvpn/script

    # If enabled, this directive will configure
    # all clients to redirect their default
    # network gateway through the VPN, causing
    # all IP traffic such as web browsing and
    # and DNS lookups to go through the VPN
    # (The OpenVPN server machine may need to NAT
    # the TUN/TAP interface to the internet in
    # order for this to work properly).
    # CAVEAT: May break client&#039;s network config if
    # client&#039;s local DHCP server packets get routed
    # through the tunnel.  Solution: make sure
    # client&#039;s local DHCP server is reachable via
    # a more specific route than the default route
    # of 0.0.0.0/0.0.0.0.
#    list push &quot;redirect-gateway&quot;

    # Certain Windows-specific network settings
    # can be pushed to clients, such as DNS
    # or WINS server addresses.  CAVEAT:
    # http://openvpn.net/faq.html#dhcpcaveats
#    list push &quot;dhcp-option DNS 10.8.0.1&quot;
#    list push &quot;dhcp-option WINS 10.8.0.1&quot;

    # Uncomment this directive to allow different
    # clients to be able to &quot;see&quot; each other.
    # By default, clients will only see the server.
    # To force clients to only see the server, you
    # will also need to appropriately firewall the
    # server&#039;s TUN/TAP interface.
#    option client_to_client 1

    # Uncomment this directive if multiple clients
    # might connect with the same certificate/key
    # files or common names.  This is recommended
    # only for testing purposes.  For production use,
    # each client should have its own certificate/key
    # pair.
    #
    # IF YOU HAVE NOT GENERATED INDIVIDUAL
    # CERTIFICATE/KEY PAIRS FOR EACH CLIENT,
    # EACH HAVING ITS OWN UNIQUE &quot;COMMON NAME&quot;,
    # UNCOMMENT THIS LINE OUT.
#    option duplicate_cn 1

    # The keepalive directive causes ping-like
    # messages to be sent back and forth over
    # the link so that each side knows when
    # the other side has gone down.
    # Ping every 10 seconds, assume that remote
    # peer is down if no ping received during
    # a 120 second time period.
    option keepalive &quot;10 120&quot;

    # For extra security beyond that provided
    # by SSL/TLS, create an &quot;HMAC firewall&quot;
    # to help block DoS attacks and UDP port flooding.
    #
    # Generate with:
    #   openvpn --genkey --secret ta.key
    #
    # The server and each client must have
    # a copy of this key.
    # The second parameter should be &#039;0&#039;
    # on the server and &#039;1&#039; on the clients.
    # This file is secret:
#    option tls_auth &quot;/etc/openvpn/ta.key 0&quot;

    # Select a cryptographic cipher.
    # This config item must be copied to
    # the client config file as well.
    # Blowfish (default):
#    option cipher BF-CBC
    # AES:
#    option cipher AES-128-CBC
    # Triple-DES:
#    option cipher DES-EDE3-CBC

    # Enable compression on the VPN link.
    # If you enable it here, you must also
    # enable it in the client config file.
    option comp_lzo yes

    # The maximum number of concurrently connected
    # clients we want to allow.
#    option max_clients 100

    # The persist options will try to avoid
    # accessing certain resources on restart
    # that may no longer be accessible because
    # of the privilege downgrade.
    option persist_key 1
    option persist_tun 1
    option user nobody

    # Output a short status file showing
    # current connections, truncated
    # and rewritten every minute.
    option status /tmp/openvpn-status.log

    # By default, log messages will go to the syslog (or
    # on Windows, if running as a service, they will go to
    # the &quot;\Program Files\OpenVPN\log&quot; directory).
    # Use log or log-append to override this default.
    # &quot;log&quot; will truncate the log file on OpenVPN startup,
    # while &quot;log-append&quot; will append to it.  Use one
    # or the other (but not both).
#    option log         /tmp/openvpn.log
#    option log_append  /tmp/openvpn.log

    # Set the appropriate level of log
    # file verbosity.
    #
    # 0 is silent, except for fatal errors
    # 4 is reasonable for general usage
    # 5 and 6 can help to debug connection problems
    # 9 is extremely verbose
    option verb 3

    # Silence repeating messages.  At most 20
    # sequential messages of the same message
    # category will be output to the log.
#    option mute 20


##############################################
# Sample client-side OpenVPN 2.0 uci config  #
# for connecting to multi-client server.     #
##############################################

config openvpn sample_client

    # Set to 1 to enable this instance:
    option enabled 0

    # Specify that we are a client and that we
    # will be pulling certain config file directives
    # from the server.
    option client 1

    # Use the same setting as you are using on
    # the server.
    # On most systems, the VPN will not function
    # unless you partially or fully disable
    # the firewall for the TUN/TAP interface.
#    option dev tap
    option dev tun

    # Are we connecting to a TCP or
    # UDP server?  Use the same setting as
    # on the server.
#    option proto tcp
    option proto udp

    # The hostname/IP and port of the server.
    # You can have multiple remote entries
    # to load balance between the servers.
    list remote &quot;my_server_1 1194&quot;
#    list remote &quot;my_server_2 1194&quot;

    # Choose a random host from the remote
    # list for load_balancing.  Otherwise
    # try hosts in the order specified.
#    option remote_random 1

    # Keep trying indefinitely to resolve the
    # host name of the OpenVPN server.  Very useful
    # on machines which are not permanently connected
    # to the internet such as laptops.
    option resolv_retry infinite

    # Most clients don&#039;t need to bind to
    # a specific local port number.
    option nobind 1

    # Try to preserve some state across restarts.
    option persist_key 1
    option persist_tun 1
    option user nobody

    # If you are connecting through an
    # HTTP proxy to reach the actual OpenVPN
    # server, put the proxy server/IP and
    # port number here.  See the man page
    # if your proxy server requires
    # authentication.
    # retry on connection failures:
#    option http_proxy_retry 1
    # specify http proxy address and port:
#    option http_proxy &quot;192.168.1.100 8080&quot;

    # Wireless networks often produce a lot
    # of duplicate packets.  Set this flag
    # to silence duplicate packet warnings.
#    option mute_replay_warnings 1

    # SSL/TLS parms.
    # See the server config file for more
    # description.  It&#039;s best to use
    # a separate .crt/.key file pair
    # for each client.  A single ca
    # file can be used for all clients.
    option ca /etc/openvpn/ca.crt
    option cert /etc/openvpn/client.crt
    option key /etc/openvpn/client.key

    # Verify server certificate by checking
    # that the certicate has the nsCertType
    # field set to &quot;server&quot;.  This is an
    # important precaution to protect against
    # a potential attack discussed here:
    #  http://openvpn.net/howto.html#mitm
    #
    # To use this feature, you will need to generate
    # your server certificates with the nsCertType
    # field set to &quot;server&quot;.  The build_key_server
    # script in the easy_rsa folder will do this.
#    option ns_cert_type server

    # If a tls_auth key is used on the server
    # then every client must also have the key.
#    option tls_auth &quot;/etc/openvpn/ta.key 1&quot;

    # Select a cryptographic cipher.
    # If the cipher option is used on the server
    # then you must also specify it here.
#    option cipher x

    # Enable compression on the VPN link.
    # Don&#039;t enable this unless it is also
    # enabled in the server config file.
    option comp_lzo yes

    # Set log file verbosity.
    option verb 3

    # Silence repeating messages
#    option mute 20</code></pre></div><p>When I try to open the untouched openvpn config from the tutorial I got the Following error:</p><div class="codebox"><pre><code>client-to-client
persist-key
persist-tun
tls-server
ca /etc/openvpn/ca.crt
cert /etc/openvpn/my-server.crt
comp-lzo yes
dev ovpns0
dev-type tun
dh /etc/openvpn/dh2048.pem
keepalive 10 120
key /etc/openvpn/my-server.key
log /tmp/openvpn.log
mode server
port 1194
proto udp
route-gateway dhcp
server 192.168.200.0 255.255.255.0
tls-auth /etc/openvpn/tls-auth.key 0
topology subnet
push comp-lzo yes
push persist-key
push persist-tun
push topology subnet
push route-gateway dhcp
push redirect-gateway def1 bypass-dhcp
push route 192.168.4.0 255.255.255.0
push dhcp-option DNS 192.168.4.1</code></pre></div><div class="codebox"><pre><code>root@WRT32X:~# root@WRT32X:~# openvpn -- config /tmp/etc/openvpn-vpnserver.conf
-ash: root@WRT32X:~#: not found
root@WRT32X:~# Options error: Unrecognized option or missing parameter(s) in [CM
D-LINE]:1:  (2.3.11)
-ash: syntax error: unexpected &quot;(&quot;</code></pre></div><br /><p>When I start your config file I got the following error:</p><div class="codebox"><pre><code>config openvpn &#039;vpnserver&#039;
        option local &#039;x.x.x.x&#039;
        option port &#039;1194&#039;
        option proto &#039;udp&#039;
        option dev &#039;tun&#039;
        option ca &#039;/etc/openvpn/ca.crt&#039;
        option cert &#039;/etc/openvpn/my-server.crt&#039;
        option key &#039;/etc/openvpn/my-server.key&#039;
        option dh &#039;/etc/openvpn/dh2048.pem&#039;
        option tls_auth &#039;/etc/openvpn/tls-auth.key 0&#039;
        option duplicate_cn &#039;1&#039;
        option server &#039;192.168.200.0 255.255.255.0&#039;
        option topology &#039;subnet&#039;
        list push &#039;topology subnet&#039;
        list push &#039;redirect-gateway def1 bypass-dhcp&#039;
        list push &#039;route 192.168.4.0 255.255.255.0&#039;
        list push &#039;dhcp-option DNS 192.168.4.1&#039;
        list push &#039;dhcp-option DOMAIN lan&#039;
        option client_to_client &#039;1&#039;
        option keepalive &#039;10 120&#039;
        option cipher &#039;AES-256-GCM&#039;
        option compress &#039;lzo&#039;
        option verb &#039;3&#039;
        option persist_key &#039;1&#039;
        option persist_tun &#039;1&#039;
        option user &#039;nobody&#039;
        option status &#039;/tmp/openvpn-udp-status.log&#039;
        option mute &#039;20&#039;
        option enabled &#039;1&#039;</code></pre></div><div class="codebox"><pre><code>root@WRT32X:~# root@WRT32X:~# openvpn -- config /tmp/etc/test.conf
-ash: root@WRT32X:~#: not found</code></pre></div><br /><br /><p>Now i have tested to import an OpenVPN Client file (.ovpn) and the file /etc/config/openvpn got filled, so maybe this is the right Config file?</p><div class="codebox"><pre><code>config openvpn &#039;custom_config&#039;
    option enabled &#039;0&#039;
    option config &#039;/etc/openvpn/my-vpn.conf&#039;

config openvpn &#039;sample_server&#039;
    option enabled &#039;0&#039;
    option port &#039;1194&#039;
    option proto &#039;udp&#039;
    option dev &#039;tun&#039;
    option ca &#039;/etc/openvpn/ca.crt&#039;
    option cert &#039;/etc/openvpn/server.crt&#039;
    option key &#039;/etc/openvpn/server.key&#039;
    option dh &#039;/etc/openvpn/dh1024.pem&#039;
    option server &#039;10.8.0.0 255.255.255.0&#039;
    option ifconfig_pool_persist &#039;/tmp/ipp.txt&#039;
    option keepalive &#039;10 120&#039;
    option comp_lzo &#039;yes&#039;
    option persist_key &#039;1&#039;
    option persist_tun &#039;1&#039;
    option user &#039;nobody&#039;
    option status &#039;/tmp/openvpn-status.log&#039;
    option verb &#039;3&#039;

config openvpn &#039;sample_client&#039;
    option enabled &#039;0&#039;
    option client &#039;1&#039;
    option dev &#039;tun&#039;
    option proto &#039;udp&#039;
    list remote &#039;my_server_1 1194&#039;
    option resolv_retry &#039;infinite&#039;
    option nobind &#039;1&#039;
    option persist_key &#039;1&#039;
    option persist_tun &#039;1&#039;
    option user &#039;nobody&#039;
    option ca &#039;/etc/openvpn/ca.crt&#039;
    option cert &#039;/etc/openvpn/client.crt&#039;
    option key &#039;/etc/openvpn/client.key&#039;
    option comp_lzo &#039;yes&#039;
    option verb &#039;3&#039;

config openvpn
    option enabled &#039;1&#039;
    option name &#039;test.ovpn&#039;
    option config &#039;/etc/openvpn/openvpn.conf&#039;
    option ping_restart &#039;0&#039;
    option log &#039;/tmp/openvpn.log&#039;
    option dev &#039;tun0&#039;
    option verb &#039;4&#039;
    option askpass &#039;test&#039;</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p374513">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">Inf1n1nty</div>
					<div class="post-datetime">
						26 Mar 2018, 21:34					</div>
				</div>
				<div class="post-content content">
					<p>There is a Script /etc/openvpn_updown, i don&#039;t know if this matters but here is the content:</p><br /><br /><div class="codebox"><pre><code>#!/bin/sh

echo &quot;remote1: $remote_1&quot;
echo &quot;script_context: $script_context&quot;
echo &quot;script_type: $script_type&quot;
echo &quot;signal: $signal&quot;
echo &quot;trusted_ip: $trusted_ip&quot;
echo &quot;untrusted_ip: $untrusted_ip&quot;

#use wan gateway in a case when it is different than ovpn detected gateway
gateway=$route_net_gateway
echo &quot;gateway1: $gateway&quot;
gateway2=$(ubus call network.interface.wan status 2&gt;/dev/null | jsonfilter -e &#039;@.route[@.target=&quot;0.0.0.0&quot;].nexthop&#039; 2&gt;/dev/null)
echo &quot;gateway2: $gateway2&quot;
[ &quot;$gateway&quot; != &quot;$gateway2&quot; ] &amp;&amp; [ &quot;$gateway2&quot; ] &amp;&amp; gateway=$gateway2
echo &quot;gateway: $gateway&quot;

cleanup() {
    #remove ovpn resolv file and set system resolv file to be last modified because of dnsmasq pooling stuff
    rm /tmp/resolv.conf.openvpn 2&gt; /dev/null
    touch /tmp/resolv.conf.auto
}

case $script_type in
  up)
    ubus call network.interface.vpn0 set_data &#039;{ &quot;status&quot;: &quot;up&quot;, &quot;last_context&quot;: &quot;&#039;$script_context&#039;&quot; }&#039;

    cleanup

    #iterate over pushed options and store vpn dns servers to ovpn resolv file
    c=1
    while true ; do
         v=foreign_option_$c
         eval &quot;fo=\$$v&quot;
         [ -n &quot;$fo&quot; ] || break

         if [ &quot;${fo%% *}&quot; == &quot;dhcp-option&quot; ]; then
              s=${fo#dhcp-option }
              if [ &quot;${s%% *}&quot; == &quot;DNS&quot; ]; then
                echo &quot;nameserver ${s#DNS }&quot;
                   echo &quot;nameserver ${s#DNS }&quot; &gt;&gt; /tmp/resolv.conf.openvpn
              fi
         fi
        c=$(( $c+1 ))
    done
     ;;
  down)
    ubus call network.interface.vpn0 set_data &#039;{ &quot;status&quot;: &quot;down&quot;, &quot;last_context&quot;: &quot;&#039;$script_context&#039;&quot; }&#039;

    #recreate default route to vpn server in case of a wan up/down
    #in case there is no default gateway on wan, restart vpn
    if [ &quot;$script_context&quot; == &quot;restart&quot; ]; then
        if [ -z &quot;$gateway&quot; ]; then
            echo &quot;gateway empty&quot;
            cleanup
                    /etc/init.d/openvpn restart
                    exit
        fi

        #can&#039;t resolve host
        if [[ -n &quot;$remote_1&quot; ]] &amp;&amp; [[ -z &quot;$trusted_ip&quot; ]]; then
            echo &quot;dns fail&quot;
            cleanup
            /etc/init.d/openvpn restart
            exit
        fi

        echo &quot;execute /sbin/route add -net $trusted_ip netmask 255.255.255.255 gw $gateway&quot;
        /sbin/route add -net $trusted_ip netmask 255.255.255.255 gw $gateway
    fi

    cleanup
    ;;
esac</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p374514">
				<div class="post-metadata">
					<div class="post-num">Post #21</div>
					<div class="post-author">600cc</div>
					<div class="post-datetime">
						26 Mar 2018, 21:53					</div>
				</div>
				<div class="post-content content">
					<p>There should be no space between &quot;--&quot; and &quot;config&quot;. The switch is &quot;--config&quot;, not &quot;-- config&quot;.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p374516">
				<div class="post-metadata">
					<div class="post-num">Post #22</div>
					<div class="post-author">Inf1n1nty</div>
					<div class="post-datetime">
						26 Mar 2018, 21:58					</div>
				</div>
				<div class="post-content content">
					<p>I have got another hint:</p><p>The content from /etc/config/openvpn is copied to /tmp/etc/openvpn-vpnserver.conf when I start Openvpn Service.</p><br /><p>I have googled a litte bit and maybe found the error:</p><div class="codebox"><pre><code>Options error: Unrecognized option or missing parameter(s) in [CMD-LINE]:1:  (2.3.11)</code></pre></div><p>This Line could mean that my openvpn-server is not understanding a Line from the config file. </p><p>I found a thread that means the version 2.3.11 cannot handle compression !?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p374519">
				<div class="post-metadata">
					<div class="post-num">Post #23</div>
					<div class="post-author">Inf1n1nty</div>
					<div class="post-datetime">
						26 Mar 2018, 22:35					</div>
				</div>
				<div class="post-content content">
					<p>I have found something in the Router Log (non openVPN log):</p><p>Mon Mar 26 21:26:53 2018 daemon.err openvpn(my-vpn)[8976]: Options error: In /etc/openvpn/my-vpn.conf:1: Error opening configuration file: openvpn<br />Mon Mar 26 21:26:53 2018 daemon.warn openvpn(my-vpn)[8976]: Use --help for more information.<br />Mon Mar 26 21:26:53 2018 daemon.err openvpn(openvpn)[8977]: Options error: Unrecognized option or missing parameter(s) in /etc/openvpn/openvpn.conf:6: <strong>block-outside-dns (2.3.11)</strong></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p374522">
				<div class="post-metadata">
					<div class="post-num">Post #24</div>
					<div class="post-author">600cc</div>
					<div class="post-datetime">
						27 Mar 2018, 00:20					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Inf1n1nty wrote:</cite><blockquote><p>Unrecognized option or missing parameter(s) in /etc/openvpn/openvpn.conf:6: <strong>block-outside-dns (2.3.11)</strong></p></blockquote></div><p>block-outside-dns is a Windows client-side option only. It won&#039;t work on the server-side, and won&#039;t work under Linux.</p><p>If you search for &quot;OpenVPN DNS leak&quot; you&#039;ll find a more in-depth explanation of what the block-outside-dns option does, and what the Linux client equivalent is (should you wish to run an OpenVPN client on Linux/Android/Mac/etc.).</p>											<p class="post-edited">(Last edited by <strong>600cc</strong> on 27 Mar 2018, 00:20)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p374565">
				<div class="post-metadata">
					<div class="post-num">Post #25</div>
					<div class="post-author">Inf1n1nty</div>
					<div class="post-datetime">
						27 Mar 2018, 17:56					</div>
				</div>
				<div class="post-content content">
					<p>Thank you,</p><p>now my Port Forwardings are not working any more..</p><p>Something is wrong with my config and I will reset my router and make a new OpenVPN Config.</p><p>Is there a complete tutorial how I should configure OpenVPN with your config? (With Creating RSA Key&#039;s etc.).</p><p>Or should i start with this guide?</p><p><a href="https://wiki.openwrt.org/doc/howto/openvpn-streamlined-server-setup">https://wiki.openwrt.org/doc/howto/open … rver-setup</a></p><p>Thank you!</p>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 1 of 2</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=73637&amp;p=2.html">2</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>