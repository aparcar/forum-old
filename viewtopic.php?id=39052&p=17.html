<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> mwan3; multi-wan policy routing (general topic)</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 22 May 2013 and 6 May 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 17 of 65</div><nav><ul><li><a href="viewtopic.php%3Fid=39052&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=15.html">15</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=16.html">16</a></li><li class="pagination-current"><span>17</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=18.html">18</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=19.html">19</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=65.html">65</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p209203">
				<div class="post-metadata">
					<div class="post-num">Post #401</div>
					<div class="post-author">tcherenato</div>
					<div class="post-datetime">
						7 Aug 2013, 20:37					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><p>Hi tcherenato,</p><br/><p>I&#039;d like to help you and get things running. But all in the right order. Your fiddling with mwan3, but your main routing table is still not correct. My advise to you is:</p><p>- Start over with reinstall of openwrt, but don&#039;t install mwan3 yet.<br/>- Make sure your network config is OK and you have a default route for each wan interface in your default routing table.<br/>- Don&#039;t continue with mwan3, until you extensively tested this setup. (reboot router, bring interfaces up and down and each time check if the main routing table is correct.)</p><p>Only then continue installing mwan3. Your current setup is (as far as i can see) not an mwan3 problem.</p></blockquote></div><p>Hi Tim, thanks for your reply!</p><p>I think that the routing tables are correct:<br/></p><div class="codebox"><pre><code>root-&gt; ip route
default via 192.168.67.254 dev eth1  proto static  metric 40 
default via 10.64.64.64 dev 3g-wan1  proto static  metric 50 
10.64.64.64 dev 3g-wan1  proto kernel  scope link  src 187.119.141.115 
192.168.66.0/24 dev eth0  proto kernel  scope link  src 192.168.66.254 
192.168.67.0/24 dev eth1  proto static  scope link  metric 40

root-&gt; ping -c 1 -I eth1 google.com
PING google.com (186.215.92.113): 56 data bytes
64 bytes from 186.215.92.113: seq=0 ttl=57 time=10.324 ms

root-&gt; ping -c 1 -I 3g-wan1 google.com
PING google.com (186.215.92.93): 56 data bytes
64 bytes from 186.215.92.93: seq=0 ttl=52 time=407.254 ms</code></pre></div><p>I can turn off and on the network interfaces without problems.<br/></p><div class="codebox"><pre><code>root-&gt; ifconfig 3g-wan1 down

root-&gt; ip route
default via 192.168.67.254 dev eth1  proto static  metric 40 
192.168.66.0/24 dev eth0  proto kernel  scope link  src 192.168.66.254 
192.168.67.0/24 dev eth1  proto static  scope link  metric 40

MWAN3 Multi-WAN Interface Live Status
Aug  7 12:47:30 MR3220V12 user.info mwan3track: Interface wan1 (3g-wan1) is offline

root-&gt; /etc/init.d/network restart

root-&gt; ifconfig 3g-wan1
3g-wan1   Link encap:Point-to-Point Protocol  
          inet addr:189.96.231.203  P-t-P:10.64.64.64  Mask:255.255.255.255
          UP POINTOPOINT RUNNING NOARP MULTICAST  MTU:1500  Metric:1
          RX packets:7 errors:0 dropped:0 overruns:0 frame:0
          TX packets:7 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:3 
          RX bytes:124 (124.0 B)  TX bytes:148 (148.0 B)

Aug  7 12:59:15 MR3220V12 user.info mwan3: ifup interface wan1 (3g-wan1)

root-&gt; ip route
default via 192.168.67.254 dev eth1  proto static  metric 40 
default via 10.64.64.64 dev 3g-wan1  proto static  metric 50 
10.64.64.64 dev 3g-wan1  proto kernel  scope link  src 177.145.52.81 
192.168.66.0/24 dev eth0  proto kernel  scope link  src 192.168.66.254 
192.168.67.0/24 dev eth1  proto static  scope link  metric 40 </code></pre></div><div class="codebox"><pre><code>root-&gt; ifconfig eth1 down

root-&gt; ip route
default via 10.64.64.64 dev 3g-wan1  proto static  metric 50 
10.64.64.64 dev 3g-wan1  proto kernel  scope link  src 189.96.231.203 
192.168.66.0/24 dev eth0  proto kernel  scope link  src 192.168.66.254 

Aug  7 13:03:13 MR3220V12 user.info mwan3track: Interface wan2 (eth1) is offline

root-&gt; /etc/init.d/network restart

root-&gt; ifconfig eth1
eth1      Link encap:Ethernet  HWaddr 90:F6:52:B9:CF:29  
          inet addr:192.168.67.1  Bcast:192.168.67.255  Mask:255.255.255.0
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:6101 errors:0 dropped:0 overruns:0 frame:0
          TX packets:6494 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:1915537 (1.8 MiB)  TX bytes:939629 (917.6 KiB)
          Interrupt:4 

Aug  7 13:06:21 MR3220V12 user.info mwan3: ifup interface wan2 (eth1)

root-&gt; ip route
default via 192.168.67.254 dev eth1  proto static  metric 40 
default via 10.64.64.64 dev 3g-wan1  proto static  metric 50 
10.64.64.64 dev 3g-wan1  proto kernel  scope link  src 177.145.52.81 
192.168.66.0/24 dev eth0  proto kernel  scope link  src 192.168.66.254 
192.168.67.0/24 dev eth1  proto static  scope link  metric 40 </code></pre></div><p>Testing a rule:<br/></p><div class="codebox"><pre><code>config rule &#039;whatsmyip&#039;
    option dest_ip &#039;whatsmyip.us&#039;               (67.228.228.244)
    option proto &#039;all&#039;
    option use_policy &#039;wan1_only&#039;</code></pre></div><p>Ping inside the network:<br/></p><div class="codebox"><pre><code>renato@FX6100:~$ ping -c1 67.228.228.244
PING 67.228.228.244 (67.228.228.244) 56(84) bytes of data.
64 bytes from 67.228.228.244: icmp_req=1 ttl=47 time=409 ms

In OpenWRT:
root-&gt; tcpdump -i eth1 dst host 67.228.228.244 -n -v
tcpdump: listening on eth1, link-type EN10MB (Ethernet), capture size 65535 bytes
NOTHING

root-&gt; tcpdump -i 3g-wan1 dst host 67.228.228.244 -n -v
tcpdump: listening on 3g-wan1, link-type LINUX_SLL (Linux cooked), capture size 65535 bytes
13:30:24.569295 IP (tos 0x0, ttl 63, id 0, offset 0, flags [DF], proto ICMP (1), length 84)
    177.145.52.81 &gt; 67.228.228.244: ICMP echo request, id 3671, seq 1, length 64

MWAN is working perfectly!</code></pre></div><p>Now 3g-wan is off:<br/></p><div class="codebox"><pre><code>root-&gt; ifconfig 3g-wan1 down

Aug  7 13:36:00 MR3220V12 user.info mwan3track: Interface wan1 (3g-wan1) is offline

renato@FX6100:~$ ping -c1 67.228.228.244
PING 67.228.228.244 (67.228.228.244) 56(84) bytes of data.
64 bytes from 67.228.228.244: icmp_req=1 ttl=49 time=234 ms

root-&gt; tcpdump -i eth1 dst host 67.228.228.244 -n -v
tcpdump: listening on eth1, link-type EN10MB (Ethernet), capture size 65535 bytes
13:36:55.054979 IP (tos 0x0, ttl 63, id 0, offset 0, flags [DF], proto ICMP (1), length 84)
    192.168.67.1 &gt; 67.228.228.244: ICMP echo request, id 3693, seq 1, length 64

By rule, should go out only by wan1, but is leaving by wan2 when wan1 is off.

root-&gt; iptables -L -t mangle -n -v |grep &#039;mwan3_rules\|67.228.228.244&#039;
  391 24097 mwan3_rules  all  --  *      *       0.0.0.0/0            0.0.0.0/0           mark match 0x0/0xff00 
Chain mwan3_rules (1 references)
    4   240 MARK       all  --  *      *       0.0.0.0/0            67.228.228.244      mark match 0x0/0xff00 MARK xset 0x1000/0xff00</code></pre></div><div class="codebox"><pre><code>root-&gt; ip route list table 0
default via 10.64.64.64 dev 3g-wan1  table 1016  metric 1 
default via 192.168.67.254 dev eth1  table 1022  metric 1 
default via 10.64.64.64 dev 3g-wan1  table 1022  metric 2 
default via 192.168.67.254 dev eth1  table 1020  metric 1 
default via 10.64.64.64 dev 3g-wan1  table 1020  metric 2 
default  table 1018  metric 1 
        nexthop via 192.168.67.254  dev eth1 weight 2
        nexthop via 10.64.64.64  dev 3g-wan1 weight 3
default via 192.168.67.254 dev eth1  table 1002 
default via 192.168.67.254 dev eth1  proto static  metric 40 
default via 10.64.64.64 dev 3g-wan1  proto static  metric 50 
10.64.64.64 dev 3g-wan1  proto kernel  scope link  src 179.224.184.192 
192.168.66.0/24 dev eth0  proto kernel  scope link  src 192.168.66.254 
192.168.67.0/24 dev eth1  proto static  scope link  metric 40 
default via 10.64.64.64 dev 3g-wan1  table 1001 
default via 192.168.67.254 dev eth1  table 1021  metric 2 
default via 10.64.64.64 dev 3g-wan1  table 1019  metric 1 
default via 192.168.67.254 dev eth1  table 1019  metric 2 
default via 192.168.67.254 dev eth1  table 1017  metric 1 
broadcast 127.0.0.0 dev lo  table local  proto kernel  scope link  src 127.0.0.1 
local 127.0.0.0/8 dev lo  table local  proto kernel  scope host  src 127.0.0.1 
local 127.0.0.1 dev lo  table local  proto kernel  scope host  src 127.0.0.1 
broadcast 127.255.255.255 dev lo  table local  proto kernel  scope link  src 127.0.0.1 
local 179.224.184.192 dev 3g-wan1  table local  proto kernel  scope host  src 179.224.184.192 
broadcast 192.168.66.0 dev eth0  table local  proto kernel  scope link  src 192.168.66.254 
local 192.168.66.254 dev eth0  table local  proto kernel  scope host  src 192.168.66.254 
broadcast 192.168.66.255 dev eth0  table local  proto kernel  scope link  src 192.168.66.254 
broadcast 192.168.67.0 dev eth1  table local  proto kernel  scope link  src 192.168.67.1 
local 192.168.67.1 dev eth1  table local  proto kernel  scope host  src 192.168.67.1 
broadcast 192.168.67.255 dev eth1  table local  proto kernel  scope link  src 192.168.67.1 
[~]</code></pre></div><div class="codebox"><pre><code>Software versions : 

OpenWrt - OpenWrt Attitude Adjustment 12.09 (r36088)
mwan3 - 1.2-17
luci-app-mwan3 - 1.1-13

Firewall default output policy (must be ACCEPT) : 

ACCEPT

Output of &quot;ip route show&quot; : 

default via 192.168.67.254 dev eth1  proto static  metric 40 
default via 10.64.64.64 dev 3g-wan1  proto static  metric 50 
10.64.64.64 dev 3g-wan1  proto kernel  scope link  src 179.224.184.192 
192.168.66.0/24 dev eth0  proto kernel  scope link  src 192.168.66.254 
192.168.67.0/24 dev eth1  proto static  scope link  metric 40

Output of &quot;ip rule show&quot; : 

0:    from all lookup local 
1001:    from all fwmark 0x100/0xff00 lookup 1001 
1002:    from all fwmark 0x200/0xff00 lookup 1002 
1016:    from all fwmark 0x1000/0xff00 lookup 1016 
1017:    from all fwmark 0x1100/0xff00 lookup 1017 
1018:    from all fwmark 0x1200/0xff00 lookup 1018 
1019:    from all fwmark 0x1300/0xff00 lookup 1019 
1020:    from all fwmark 0x1400/0xff00 lookup 1020 
1021:    from all fwmark 0x1500/0xff00 lookup 1021 
1022:    from all fwmark 0x1600/0xff00 lookup 1022 
32766:    from all lookup main 
32767:    from all lookup default

Output of &quot;ip route list table 1001-1099&quot; (1001-1015 = interface tables, 1016-1099 = policy tables) : 

1001
default via 10.64.64.64 dev 3g-wan1 
1002
default via 192.168.67.254 dev eth1 
1016
default via 10.64.64.64 dev 3g-wan1  metric 1 
1017
default via 192.168.67.254 dev eth1  metric 1 
1018
default  metric 1 
    nexthop via 192.168.67.254  dev eth1 weight 2
    nexthop via 10.64.64.64  dev 3g-wan1 weight 3
1019
default via 10.64.64.64 dev 3g-wan1  metric 1 
default via 192.168.67.254 dev eth1  metric 2 
1020
default via 192.168.67.254 dev eth1  metric 1 
default via 10.64.64.64 dev 3g-wan1  metric 2 
1021
default via 192.168.67.254 dev eth1  metric 2 
1022
default via 192.168.67.254 dev eth1  metric 1 
default via 10.64.64.64 dev 3g-wan1  metric 2

Output of &quot;iptables -L -t mangle -v -n | awk &#039;/mwan3/&#039; RS=&quot; : 

Chain PREROUTING (policy ACCEPT 2951 packets, 594K bytes)
 pkts bytes target     prot opt in     out     source               destination         
 3032  601K mwan3_pre  all  --  *      *       0.0.0.0/0            0.0.0.0/0           

Chain INPUT (policy ACCEPT 1183 packets, 93953 bytes)
 pkts bytes target     prot opt in     out     source               destination         
 1235 98251 mwan3_post  all  --  *      *       0.0.0.0/0            0.0.0.0/0           

Chain OUTPUT (policy ACCEPT 1214 packets, 418K bytes)
 pkts bytes target     prot opt in     out     source               destination         
 1276  430K mwan3_pre  all  --  *      *       0.0.0.0/0            0.0.0.0/0           

Chain POSTROUTING (policy ACCEPT 2982 packets, 918K bytes)
 pkts bytes target     prot opt in     out     source               destination         
 3066  932K mwan3_post  all  --  *      *       0.0.0.0/0            0.0.0.0/0           

Chain mwan3_default (1 references)
 pkts bytes target     prot opt in     out     source               destination         
    1   142 MARK       all  --  *      *       0.0.0.0/0            224.0.0.0/3         mark match 0x0/0xff00 MARK xset 0x7f00/0xff00 
    0     0 MARK       all  --  *      *       0.0.0.0/0            127.0.0.0/8         mark match 0x0/0xff00 MARK xset 0x7f00/0xff00 
    0     0 MARK       all  --  *      *       0.0.0.0/0            10.64.64.64         mark match 0x0/0xff00 MARK xset 0x7f00/0xff00 
   62  4787 MARK       all  --  *      *       0.0.0.0/0            192.168.66.0/24     mark match 0x0/0xff00 MARK xset 0x7f00/0xff00 
    0     0 MARK       all  --  *      *       0.0.0.0/0            192.168.67.0/24     mark match 0x0/0xff00 MARK xset 0x7f00/0xff00 

Chain mwan3_post (2 references)
 pkts bytes target     prot opt in     out     source               destination         
  742 89863 MARK       all  --  *      eth1    0.0.0.0/0            0.0.0.0/0           mark match !0x7f00/0xff00 MARK xset 0x200/0xff00 
  487 70061 MARK       all  --  *      3g-wan1  0.0.0.0/0            0.0.0.0/0           mark match !0x7f00/0xff00 MARK xset 0x100/0xff00 
 1112  386K MARK       all  --  *      *       0.0.0.0/0            0.0.0.0/0           mark match 0x8000/0x8000 MARK and 0xffff7fff 
 4301 1030K CONNMARK   all  --  *      *       0.0.0.0/0            0.0.0.0/0           CONNMARK save mask 0xff00 

Chain mwan3_pre (2 references)
 pkts bytes target     prot opt in     out     source               destination         
 4308 1031K CONNMARK   all  --  *      *       0.0.0.0/0            0.0.0.0/0           CONNMARK restore mask 0xff00 
  689  278K MARK       all  --  eth1   *       0.0.0.0/0            0.0.0.0/0           MARK xset 0x8200/0xff00 
  423  108K MARK       all  --  3g-wan1 *       0.0.0.0/0            0.0.0.0/0           MARK xset 0x8100/0xff00 
  486 47698 mwan3_default  all  --  *      *       0.0.0.0/0            0.0.0.0/0           mark match 0x0/0xff00 
  408 41149 mwan3_wan  all  --  *      *       0.0.0.0/0            0.0.0.0/0           mark match 0x0/0xff00 
  140 20184 mwan3_rules  all  --  *      *       0.0.0.0/0            0.0.0.0/0           mark match 0x0/0xff00 

Chain mwan3_rules (1 references)
 pkts bytes target     prot opt in     out     source               destination         
    8   480 MARK       all  --  *      *       0.0.0.0/0            67.228.228.244      mark match 0x0/0xff00 MARK xset 0x1000/0xff00 
   29  1761 MARK       tcp  --  *      *       0.0.0.0/0            0.0.0.0/0           multiport sports 0:65535 multiport dports 443 mark match 0x0/0xff00 MARK xset 0x1000/0xff00 
   74 14448 MARK       all  --  *      *       0.0.0.0/0            0.0.0.0/0           mark match 0x0/0xff00 MARK xset 0x1400/0xff00 

Chain mwan3_wan (1 references)
 pkts bytes target     prot opt in     out     source               destination         
  408 41149 mwan3_wan1  all  --  *      *       0.0.0.0/0            0.0.0.0/0           
  380 37828 mwan3_wan2  all  --  *      *       0.0.0.0/0            0.0.0.0/0           

Chain mwan3_wan1 (1 references)
 pkts bytes target     prot opt in     out     source               destination         
   62  5192 MARK       all  --  *      *       179.224.184.192      0.0.0.0/0           MARK xset 0x100/0xff00 

Chain mwan3_wan2 (1 references)
 pkts bytes target     prot opt in     out     source               destination         
  206 15773 MARK       all  --  *      *       192.168.67.1         0.0.0.0/0           MARK xset 0x200/0xff00

Output of &quot;ifconfig&quot; : 

3g-wan1   Link encap:Point-to-Point Protocol  
          inet addr:179.224.184.192  P-t-P:10.64.64.64  Mask:255.255.255.255
          UP POINTOPOINT RUNNING NOARP MULTICAST  MTU:1500  Metric:1
          RX packets:453 errors:0 dropped:0 overruns:0 frame:0
          TX packets:522 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:3 
          RX bytes:110095 (107.5 KiB)  TX bytes:72267 (70.5 KiB)

eth0      Link encap:Ethernet  HWaddr 90:F6:52:B9:CF:27  
          inet addr:192.168.66.254  Bcast:192.168.66.255  Mask:255.255.255.0
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:12615 errors:0 dropped:0 overruns:0 frame:0
          TX packets:11188 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:1593959 (1.5 MiB)  TX bytes:4966966 (4.7 MiB)
          Interrupt:5 

eth1      Link encap:Ethernet  HWaddr 90:F6:52:B9:CF:29  
          inet addr:192.168.67.1  Bcast:192.168.67.255  Mask:255.255.255.0
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:2137 errors:0 dropped:0 overruns:0 frame:0
          TX packets:3146 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:732417 (715.2 KiB)  TX bytes:408158 (398.5 KiB)
          Interrupt:4 

lo        Link encap:Local Loopback  
          inet addr:127.0.0.1  Mask:255.0.0.0
          UP LOOPBACK RUNNING  MTU:16436  Metric:1
          RX packets:151 errors:0 dropped:0 overruns:0 frame:0
          TX packets:151 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:11666 (11.3 KiB)  TX bytes:11666 (11.3 KiB)

Output of &quot;cat /etc/config/mwan3&quot; : 

config rule &#039;whatsmyip&#039;
    option dest_ip &#039;whatsmyip.us&#039;
    option proto &#039;all&#039;
    option use_policy &#039;wan1_only&#039;

config rule &#039;Porta443&#039;
    option dest_port &#039;443&#039;
    option proto &#039;tcp&#039;
    option use_policy &#039;wan1_only&#039;

config rule &#039;DefaultGW&#039;
    option dest_ip &#039;0.0.0.0/0&#039;
    option proto &#039;all&#039;
    option use_policy &#039;wan2_pri_wan1_sec&#039;

config interface &#039;wan1&#039;
    option enabled &#039;1&#039;
    option count &#039;1&#039;
    option down &#039;3&#039;
    option up &#039;8&#039;
    option reroute &#039;0&#039;
    list track_ip &#039;8.8.8.8&#039;
    list track_ip &#039;208.67.220.220&#039;
    option reliability &#039;1&#039;
    option timeout &#039;3&#039;
    option interval &#039;10&#039;

config interface &#039;wan2&#039;
    option enabled &#039;1&#039;
    list track_ip &#039;8.8.8.8&#039;
    list track_ip &#039;208.67.220.220&#039;
    option reliability &#039;1&#039;
    option count &#039;1&#039;
    option timeout &#039;2&#039;
    option interval &#039;5&#039;
    option down &#039;3&#039;
    option up &#039;8&#039;
    option reroute &#039;0&#039;

config member &#039;wan1_m1_w3&#039;
    option interface &#039;wan1&#039;
    option metric &#039;1&#039;
    option weight &#039;3&#039;

config member &#039;wan1_m2_w3&#039;
    option interface &#039;wan1&#039;
    option metric &#039;2&#039;
    option weight &#039;3&#039;

config member &#039;wan2_m1_w2&#039;
    option interface &#039;wan2&#039;
    option metric &#039;1&#039;
    option weight &#039;2&#039;

config member &#039;wan2_m2_w2&#039;
    option interface &#039;wan2&#039;
    option metric &#039;2&#039;
    option weight &#039;2&#039;

config policy &#039;wan1_only&#039;
    list use_member &#039;wan1_m1_w3&#039;

config policy &#039;wan2_only&#039;
    list use_member &#039;wan2_m1_w2&#039;

config policy &#039;wan1_wan2_loadbalanced&#039;
    list use_member &#039;wan1_m1_w3&#039;
    list use_member &#039;wan2_m1_w2&#039;

config policy &#039;wan1_pri_wan2_sec&#039;
    list use_member &#039;wan1_m1_w3&#039;
    list use_member &#039;wan2_m2_w2&#039;

config policy &#039;wan2_pri_wan1_sec&#039;
    list use_member &#039;wan1_m2_w3&#039;
    list use_member &#039;wan2_m1_w2&#039;

config interface &#039;wan3&#039;
    list track_ip &#039;8.8.8.8&#039;
    list track_ip &#039;208.67.220.220&#039;
    option reliability &#039;1&#039;
    option count &#039;1&#039;
    option timeout &#039;2&#039;
    option interval &#039;5&#039;
    option down &#039;3&#039;
    option up &#039;5&#039;
    option reroute &#039;0&#039;
    option enabled &#039;1&#039;

config member &#039;wan3_m1_w2&#039;
    option interface &#039;wan3&#039;
    option metric &#039;1&#039;
    option weight &#039;2&#039;

config member &#039;wan3_m2_w2&#039;
    option interface &#039;wan3&#039;
    option metric &#039;2&#039;
    option weight &#039;2&#039;

config policy &#039;wan2_wan3_loadbalanced&#039;
    list use_member &#039;wan2_m2_w2&#039;
    list use_member &#039;wan3_m2_w2&#039;

config policy &#039;wan2_wan3_Pri_wan1_sec&#039;
    list use_member &#039;wan1_m2_w3&#039;
    list use_member &#039;wan2_m1_w2&#039;
    list use_member &#039;wan3_m1_w2&#039;

Output of &quot;cat /etc/config/network&quot; : 

config interface &#039;loopback&#039;
    option ifname &#039;lo&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;127.0.0.1&#039;
    option netmask &#039;255.0.0.0&#039;

config interface &#039;lan&#039;
    option proto &#039;static&#039;
    option netmask &#039;255.255.255.0&#039;
    option ipaddr &#039;192.168.66.254&#039;
    option _orig_ifname &#039;eth0&#039;
    option _orig_bridge &#039;false&#039;
    option ifname &#039;eth0&#039;

config switch
    option name &#039;eth0&#039;
    option reset &#039;1&#039;

config interface &#039;wan1&#039;
    option proto &#039;3g&#039;
    option device &#039;/dev/ttyUSB2&#039;
    option apn &#039;zap.vivo.com.br&#039;
    USERNAME HIDDEN
    PASSWORD HIDDEN
    option metric &#039;50&#039;

config interface &#039;wan2&#039;
    option proto &#039;dhcp&#039;
    option ifname &#039;eth1&#039;
    option metric &#039;40&#039;

config interface &#039;wan3&#039;
    option proto &#039;dhcp&#039;
    option metric &#039;20&#039;</code></pre></div><p>Sorry for my english and post size.</p><p>[]&#039;s<br/>Renato</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p209205">
				<div class="post-metadata">
					<div class="post-num">Post #402</div>
					<div class="post-author">tcherenato</div>
					<div class="post-datetime">
						7 Aug 2013, 20:59					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>Another problem that happens sometimes:</p><div class="codebox"><pre><code>root-&gt; ps|grep mwan
 5086 root      1508 S    {mwan3track} /bin/sh /usr/sbin/mwan3track wan1 3g-wan1 1 1 3 10 3 8 208.67.220.220 8.8.8.8
 5604 root      1508 S    {mwan3track} /bin/sh /usr/sbin/mwan3track wan2 eth1 1 1 2 5 3 8 208.67.220.220 8.8.8.8
 5781 root      1492 S    grep mwan
[02:45:28 /]
root-&gt; /etc/init.d/mwan3 restart
Segmentation fault
[02:45:43 /]
root-&gt; ps|grep mwan
 6123 root      1508 S    {mwan3track} /bin/sh /usr/sbin/mwan3track wan1 3g-wan1 1 1 3 10 3 8 208.67.220.220 8.8.8.8
 6646 root      1492 S    grep mwan
[02:45:44 /]
root-&gt; /etc/init.d/mwan3 restart
Segmentation fault
[02:45:58 /]
root-&gt; ps|grep mwan
 7360 root      1508 S    {mwan3track} /bin/sh /usr/sbin/mwan3track wan2 eth1 1 1 2 5 3 8 208.67.220.220 8.8.8.8
 7531 root      1492 S    grep mwan
[02:46:02 /]
root-&gt; /etc/init.d/mwan3 restart
Segmentation fault
[02:46:15 /]
root-&gt; ps|grep mwan
 8277 root      1508 S    {mwan3track} /bin/sh /usr/sbin/mwan3track wan2 eth1 1 1 2 5 3 8 208.67.220.220 8.8.8.8
 8416 root      1492 S    grep mwan
[02:46:17 /]
root-&gt; /etc/init.d/mwan3 restart
Segmentation fault
Segmentation fault
[02:46:29 /]
root-&gt; ps|grep mwan
 9102 root      1492 S    grep mwan
[02:46:30 /]
root-&gt; /etc/init.d/mwan3 restart
Segmentation fault
[02:46:43 /]
root-&gt; ps|grep mwan
 9739 root      1508 S    {mwan3track} /bin/sh /usr/sbin/mwan3track wan2 eth1 1 1 2 5 3 8 208.67.220.220 8.8.8.8
 9893 root      1492 S    grep mwan
[02:46:44 /]
root-&gt; /etc/init.d/mwan3 restart
Segmentation fault
[02:46:58 /]
root-&gt; ps|grep mwan
10227 root      1508 S    {mwan3track} /bin/sh /usr/sbin/mwan3track wan1 3g-wan1 1 1 3 10 3 8 208.67.220.220 8.8.8.8
10775 root      1492 S    grep mwan
[02:47:00 /]
root-&gt; /etc/init.d/mwan3 restart
[02:47:19 /]
root-&gt; ps|grep mwan
11176 root      1508 S    {mwan3track} /bin/sh /usr/sbin/mwan3track wan1 3g-wan1 1 1 3 10 3 8 208.67.220.220 8.8.8.8
11651 root      1508 S    {mwan3track} /bin/sh /usr/sbin/mwan3track wan2 eth1 1 1 2 5 3 8 208.67.220.220 8.8.8.8
11813 root      1492 S    grep mwan
[02:47:21 /]
root-&gt;</code></pre></div><br/><p>I found that the problem is here:<br/></p><div class="codebox"><pre><code>root-&gt; env -i ACTION=ifdown INTERFACE=wan2 DEVICE=eth1 /sbin/hotplug-call iface
[05:44:21 ~]
root-&gt; env -i ACTION=ifdown INTERFACE=wan2 DEVICE=eth1 /sbin/hotplug-call iface
[05:44:28 ~]
root-&gt; env -i ACTION=ifdown INTERFACE=wan2 DEVICE=eth1 /sbin/hotplug-call iface
[05:44:33 ~]
root-&gt; env -i ACTION=ifdown INTERFACE=wan2 DEVICE=eth1 /sbin/hotplug-call iface
[05:44:39 ~]
root-&gt; env -i ACTION=ifdown INTERFACE=wan2 DEVICE=eth1 /sbin/hotplug-call iface
Segmentation fault
[05:44:43 ~]
root-&gt; env -i ACTION=ifdown INTERFACE=wan2 DEVICE=eth1 /sbin/hotplug-call iface
Segmentation fault
[05:44:47 ~]
root-&gt; env -i ACTION=ifdown INTERFACE=wan2 DEVICE=eth1 /sbin/hotplug-call iface
[05:44:52 ~]
root-&gt; env -i ACTION=ifdown INTERFACE=wan2 DEVICE=eth1 /sbin/hotplug-call iface
[05:44:58 ~]
root-&gt; env -i ACTION=ifdown INTERFACE=wan2 DEVICE=eth1 /sbin/hotplug-call iface
[05:45:04 ~]
root-&gt; env -i ACTION=ifdown INTERFACE=wan2 DEVICE=eth1 /sbin/hotplug-call iface
[05:45:09 ~]
root-&gt; env -i ACTION=ifdown INTERFACE=wan2 DEVICE=eth1 /sbin/hotplug-call iface
[05:45:14 ~]
root-&gt; env -i ACTION=ifdown INTERFACE=wan2 DEVICE=eth1 /sbin/hotplug-call iface
[05:45:20 ~]
root-&gt; env -i ACTION=ifdown INTERFACE=wan2 DEVICE=eth1 /sbin/hotplug-call iface
[05:45:25 ~]
root-&gt; env -i ACTION=ifdown INTERFACE=wan2 DEVICE=eth1 /sbin/hotplug-call iface
[05:45:29 ~]
root-&gt; env -i ACTION=ifdown INTERFACE=wan2 DEVICE=eth1 /sbin/hotplug-call iface
Segmentation fault
[05:45:33 ~]
root-&gt; env -i ACTION=ifdown INTERFACE=wan2 DEVICE=eth1 /sbin/hotplug-call iface
[05:45:38 ~]
root-&gt; </code></pre></div>											<p class="post-edited">(Last edited by <strong>tcherenato</strong> on 7 Aug 2013, 23:49)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p209214">
				<div class="post-metadata">
					<div class="post-num">Post #403</div>
					<div class="post-author">tcherenato</div>
					<div class="post-datetime">
						8 Aug 2013, 00:37					</div>
				</div>
				<div class="post-content content">
					<p>Hi Tim,</p><p>I solved my problem with mwan3track:</p><div class="codebox"><pre><code>[06:20:19 ~]
root-&gt; /etc/init.d/mwan3 restart
[06:20:45 ~]
root-&gt; /etc/init.d/mwan3 restart
[06:21:12 ~]
root-&gt; /etc/init.d/mwan3 restart
[06:21:40 ~]
root-&gt; /etc/init.d/mwan3 restart
[06:22:10 ~]
root-&gt; ps|grep mwan3
 3421 root      1508 S    {mwan3track} /bin/sh /usr/sbin/mwan3track wan1 3g-wan1 1 1 3 10 3 8 20
 3979 root      1508 S    {mwan3track} /bin/sh /usr/sbin/mwan3track wan2 eth1 1 1 2 5 3 8 208.67
 4273 root      1492 S    grep mwan3
[06:22:17 ~]
root-&gt; /etc/init.d/mwan3 restart
[06:22:44 ~]
root-&gt; /etc/init.d/mwan3 restart
[06:23:09 ~]
root-&gt; /etc/init.d/mwan3 restart
[06:23:37 ~]
root-&gt; /etc/init.d/mwan3 restart
[06:24:04 ~]
root-&gt; /etc/init.d/mwan3 restart
[06:24:32 ~]
root-&gt; /etc/init.d/mwan3 restart
[06:24:59 ~]
root-&gt; ps|grep mwan3                                                                              
10620 root      1508 S    {mwan3track} /bin/sh /usr/sbin/mwan3track wan1 3g-wan1 1 1 3 10 3 8 20
11167 root      1508 S    {mwan3track} /bin/sh /usr/sbin/mwan3track wan2 eth1 1 1 2 5 3 8 208.67
11382 root      1492 S    grep mwan3
[06:25:01 ~]
root-&gt; /etc/init.d/mwan3 restart
[06:25:29 ~]
root-&gt; /etc/init.d/mwan3 restart                                                                  
[06:25:57 ~]
root-&gt; /etc/init.d/mwan3 restart
[06:26:23 ~]
root-&gt; ps|grep mwan3                                                                              
14179 root      1508 S    {mwan3track} /bin/sh /usr/sbin/mwan3track wan1 3g-wan1 1 1 3 10 3 8 20
14764 root      1508 S    {mwan3track} /bin/sh /usr/sbin/mwan3track wan2 eth1 1 1 2 5 3 8 208.67
14968 root      1492 S    grep mwan3
[06:26:25 ~]
root-&gt; </code></pre></div><p>if it is useful for someone else, I added a &quot;sleep 1&quot; in /sbin/hotplug-call, line 16:<br/></p><div class="codebox"><pre><code>root-&gt; cat /sbin/hotplug-call                                                                     
#!/bin/sh
# Copyright (C) 2006-2010 OpenWrt.org

export HOTPLUG_TYPE=&quot;$1&quot;

. /lib/functions.sh

PATH=/bin:/sbin:/usr/bin:/usr/sbin
LOGNAME=root
USER=root
export PATH LOGNAME USER

[ \! -z &quot;$1&quot; -a -d /etc/hotplug.d/$1 ] &amp;&amp; {
        for script in $(ls /etc/hotplug.d/$1/* 2&gt;&amp;-); do (
                [ -f $script ] &amp;&amp; . $script
                sleep 1
        ); done
}</code></pre></div><p>[]&#039;s<br/>Renato</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p209228">
				<div class="post-metadata">
					<div class="post-num">Post #404</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						8 Aug 2013, 04:21					</div>
				</div>
				<div class="post-content content">
					<p>Hi Renato,</p><br/><p>Thank you for the extensive replies. It makes trouble-shooting easy. As for your problem, it works as designed.</p><p>If you have a traffic rule that matches and marks the packet to be send out of a wan interface that is down, it will not match any ip rule. Therefor it will use the main routing table te determine which interface to use.</p><p>If you don&#039;t want this behaviour, you could try the loopback trick, described earlier in this thread. Or you could just firewall the traffic.</p><br/><p>PS: I&#039;m not Tim&nbsp; <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink"/></p>											<p class="post-edited">(Last edited by <strong>Adze</strong> on 8 Aug 2013, 04:22)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p209230">
				<div class="post-metadata">
					<div class="post-num">Post #405</div>
					<div class="post-author">tcherenato</div>
					<div class="post-datetime">
						8 Aug 2013, 04:50					</div>
				</div>
				<div class="post-content content">
					<p>Thank you Tim,</p><p>My goal is to allow traffic through port 443 only by wan1, then I just blocked all traffic going out through port 443 by WAN2, in firewall rules. Problem solved!</p><p>I was in doubt due to the wiki:<br/><a href="http://wiki.openwrt.org/doc/howto/mwan3">http://wiki.openwrt.org/doc/howto/mwan3</a><br/></p><div class="quotebox"><blockquote><p>wan1_only</p><p>&nbsp; &nbsp; send traffic out only through wan1; if wan1 goes down, <span style="color: #FF0000">any traffic assigned to go to this policy will fail to send</span> (this is done by only including the single policy &quot;wan1_m1_w3&quot;)</p></blockquote></div><p>Now I began to understand better mwan3.</p><p>Thanks for the great package. Is very useful! Better than the multiw... imho!</p><p>[]&#039;s<br/>Renato</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p209265">
				<div class="post-metadata">
					<div class="post-num">Post #406</div>
					<div class="post-author">thdyck</div>
					<div class="post-datetime">
						8 Aug 2013, 15:21					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>tcherenato wrote:</cite><blockquote><p>I was in doubt due to the wiki:<br/><a href="http://wiki.openwrt.org/doc/howto/mwan3">http://wiki.openwrt.org/doc/howto/mwan3</a></p></blockquote></div><p>Hi tcherenato,</p><p>Sorry about that. I wrote that in the wiki just based on the &quot;_only&quot; language in the rule name. I have updated the wiki page with Adze&#039;s explanation.</p><p>p.s. This is Tim but it is Adze, the author of mwan3, that was replying before.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p209267">
				<div class="post-metadata">
					<div class="post-num">Post #407</div>
					<div class="post-author">tcherenato</div>
					<div class="post-datetime">
						8 Aug 2013, 15:41					</div>
				</div>
				<div class="post-content content">
					<p>So Sorry (I Made A Mistake)!!!&nbsp; &nbsp; :-(&nbsp; &nbsp;I think I am going crazy...</p><p>Thank you too, Adze and excuse my stumbling!</p><p>[]&#039;s<br/>Renato</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p209273">
				<div class="post-metadata">
					<div class="post-num">Post #408</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						8 Aug 2013, 17:50					</div>
				</div>
				<div class="post-content content">
					<p>Hi thdyck,</p><p>Thanks again for the wiki!!! I will do a thorough reading tonight. And add some extra info.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p209283">
				<div class="post-metadata">
					<div class="post-num">Post #409</div>
					<div class="post-author">thdyck</div>
					<div class="post-datetime">
						8 Aug 2013, 21:03					</div>
				</div>
				<div class="post-content content">
					<p>non-primary wan2 goes down and up, traffic switches to mwan2</p><p>Hi, wanted to check on this one.</p><p>mwan3 is configured to route all traffic to wan1 with wan2 being the failover (wan1_pri_wan2_sec).</p><p>Early this morning, wan2 went down. No problem as wan1 is fine. But when wan2 came up again around 9:30, traffic switched over to going out wan2 at that point.&nbsp; I needed to run /etc/init.d/mwan3 restart to restore wan1 as the default.</p><p>The output below is from before the mwan3 restart, while wan2 was still sending out traffic.</p><p>I will try to reproduce in a test environment but wanted to raise it in case Adze sees right away why this might be.</p><p>Thanks,<br/>Tim</p><br/><p>==</p><p>Both wan interfaces are reported up in LuCI:</p><p>MWAN3 Multi-WAN Interface Live Status<br/>&nbsp; &nbsp; wan1 (eth0.50) : ONLINEwan2 (eth0.51) : ONLINE</p><p>MWAN3 Multi-WAN Interface Systemlog<br/>Last 50 MWAN3 systemlog entries. Newest entries sorted at the top :</p><p>Aug&nbsp; 8 09:22:48 mccokGW02 user.info mwan3: ifup interface wan2 (eth0.51)<br/>Aug&nbsp; 8 09:22:46 mccokGW02 user.info mwan3track: Interface wan2 (eth0.51) is online<br/>Aug&nbsp; 8 09:15:33 mccokGW02 user.info mwan3track: Lost 794 ping(s) on interface wan2 (eth0.51)</p><br/><br/><br/><p>==</p><p>Software versions : </p><p>OpenWrt - OpenWrt Attitude Adjustment 12.09 (r36088)<br/>mwan3 - 1.2-17<br/>luci-app-mwan3 - 1.1-13</p><p>Firewall default output policy (must be ACCEPT) : </p><p>ACCEPT</p><p>Output of &quot;ip route show&quot; : </p><p>default via 99.235.226.1 dev eth0.50&nbsp; proto static&nbsp; metric 10 <br/>default via 10.1.51.1 dev eth0.51&nbsp; proto static&nbsp; metric 20 <br/>10.1.1.0/24 via 10.1.4.2 dev br-lan&nbsp; proto static <br/>10.1.4.0/24 dev br-lan&nbsp; proto kernel&nbsp; scope link&nbsp; src 10.1.4.1 <br/>10.1.6.0/24 via 10.1.254.1 dev tun0&nbsp; scope link <br/>10.1.7.0/24 via 10.1.254.1 dev tun0&nbsp; scope link <br/>10.1.51.0/24 dev eth0.51&nbsp; proto static&nbsp; scope link&nbsp; metric 20 <br/>10.1.254.0/24 dev tun0&nbsp; proto kernel&nbsp; scope link&nbsp; src 10.1.254.1 <br/>10.2.1.0/24 via 10.1.254.1 dev tun0&nbsp; scope link <br/>10.2.4.0/24 via 10.1.254.1 dev tun0&nbsp; scope link <br/>10.3.1.0/24 via 10.1.254.1 dev tun0&nbsp; scope link <br/>10.3.4.0/24 via 10.1.254.1 dev tun0&nbsp; scope link <br/>10.4.1.0/24 via 10.1.254.1 dev tun0&nbsp; scope link <br/>10.4.4.0/24 via 10.1.254.1 dev tun0&nbsp; scope link <br/>10.5.1.0/24 via 10.1.254.1 dev tun0&nbsp; scope link <br/>10.5.4.0/24 via 10.1.254.1 dev tun0&nbsp; scope link <br/>10.6.4.0/24 via 10.1.254.1 dev tun0&nbsp; scope link <br/>10.7.4.0/24 via 10.1.254.1 dev tun0&nbsp; scope link <br/>99.235.226.0/23 dev eth0.50&nbsp; proto static&nbsp; scope link&nbsp; metric 10 <br/>192.168.6.0/24 via 10.1.254.1 dev tun0&nbsp; scope link</p><p>Output of &quot;ip rule show&quot; : </p><p>0:&nbsp; &nbsp; from all lookup local <br/>1001:&nbsp; &nbsp; from all fwmark 0x100/0xff00 lookup 1001 <br/>1002:&nbsp; &nbsp; from all fwmark 0x200/0xff00 lookup 1002 <br/>1016:&nbsp; &nbsp; from all fwmark 0x1000/0xff00 lookup 1016 <br/>1017:&nbsp; &nbsp; from all fwmark 0x1100/0xff00 lookup 1017 <br/>1018:&nbsp; &nbsp; from all fwmark 0x1200/0xff00 lookup 1018 <br/>1019:&nbsp; &nbsp; from all fwmark 0x1300/0xff00 lookup 1019 <br/>1020:&nbsp; &nbsp; from all fwmark 0x1400/0xff00 lookup 1020 <br/>32766:&nbsp; &nbsp; from all lookup main <br/>32767:&nbsp; &nbsp; from all lookup default</p><p>Output of &quot;ip route list table 1001-1099&quot; (1001-1015 = interface tables, 1016-1099 = policy tables) : </p><p>1001<br/>default via 99.235.226.1 dev eth0.50 <br/>1002<br/>default via 10.1.51.1 dev eth0.51 <br/>1016<br/>default via 99.235.226.1 dev eth0.50&nbsp; metric 1 <br/>1017<br/>default via 10.1.51.1 dev eth0.51&nbsp; metric 1 <br/>1018<br/>default&nbsp; metric 1 <br/>&nbsp; &nbsp; nexthop via 10.1.51.1&nbsp; dev eth0.51 weight 2<br/>&nbsp; &nbsp; nexthop via 99.235.226.1&nbsp; dev eth0.50 weight 3<br/>1019<br/>default via 10.1.51.1 dev eth0.51&nbsp; metric 2 <br/>1020<br/>default via 10.1.51.1 dev eth0.51&nbsp; metric 1</p><p>Output of &quot;iptables -L -t mangle -v -n | awk &#039;/mwan3/&#039; RS=&quot; : </p><p>Chain PREROUTING (policy ACCEPT 214K packets, 40M bytes)<br/> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br/>&nbsp; 42M 7758M mwan3_pre&nbsp; all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p><p>Chain INPUT (policy ACCEPT 36527 packets, 7345K bytes)<br/> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br/>8302K 1727M mwan3_post&nbsp; all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p><p>Chain OUTPUT (policy ACCEPT 35788 packets, 7884K bytes)<br/> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br/>8622K 2058M mwan3_pre&nbsp; all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p><p>Chain POSTROUTING (policy ACCEPT 213K packets, 41M bytes)<br/> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br/>&nbsp; 43M 8087M mwan3_post&nbsp; all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p><p>Chain mwan3_default (1 references)<br/> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br/>&nbsp; &nbsp; 9&nbsp; &nbsp;856 MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 224.0.0.0/3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mark match 0x0/0xff00 MARK xset 0x7f00/0xff00 <br/>&nbsp; &nbsp;88&nbsp; 6154 MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 127.0.0.0/8&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mark match 0x0/0xff00 MARK xset 0x7f00/0xff00 <br/>&nbsp; 176 82882 MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 10.1.1.0/24&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mark match 0x0/0xff00 MARK xset 0x7f00/0xff00 <br/> 1051 80883 MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 10.1.4.0/24&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mark match 0x0/0xff00 MARK xset 0x7f00/0xff00 <br/>&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 10.1.6.0/24&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mark match 0x0/0xff00 MARK xset 0x7f00/0xff00 <br/>&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 10.1.7.0/24&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mark match 0x0/0xff00 MARK xset 0x7f00/0xff00 <br/>&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 10.1.51.0/24&nbsp; &nbsp; &nbsp; &nbsp; mark match 0x0/0xff00 MARK xset 0x7f00/0xff00 <br/>&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 10.1.254.0/24&nbsp; &nbsp; &nbsp; &nbsp;mark match 0x0/0xff00 MARK xset 0x7f00/0xff00 <br/>&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 10.2.1.0/24&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mark match 0x0/0xff00 MARK xset 0x7f00/0xff00 <br/>&nbsp; &nbsp;14&nbsp; 2153 MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 10.2.4.0/24&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mark match 0x0/0xff00 MARK xset 0x7f00/0xff00 <br/>&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 10.3.1.0/24&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mark match 0x0/0xff00 MARK xset 0x7f00/0xff00 <br/>&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 10.3.4.0/24&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mark match 0x0/0xff00 MARK xset 0x7f00/0xff00 <br/>&nbsp; &nbsp; 1&nbsp; &nbsp;234 MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 10.4.1.0/24&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mark match 0x0/0xff00 MARK xset 0x7f00/0xff00 <br/>&nbsp; 212 53221 MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 10.4.4.0/24&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mark match 0x0/0xff00 MARK xset 0x7f00/0xff00 <br/>&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 10.5.1.0/24&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mark match 0x0/0xff00 MARK xset 0x7f00/0xff00 <br/>&nbsp; &nbsp;48&nbsp; 4805 MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 10.5.4.0/24&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mark match 0x0/0xff00 MARK xset 0x7f00/0xff00 <br/>&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 10.6.4.0/24&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mark match 0x0/0xff00 MARK xset 0x7f00/0xff00 <br/>&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 10.7.4.0/24&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mark match 0x0/0xff00 MARK xset 0x7f00/0xff00 <br/>&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 99.235.226.0/23&nbsp; &nbsp; &nbsp;mark match 0x0/0xff00 MARK xset 0x7f00/0xff00 <br/>&nbsp; &nbsp;25&nbsp; 4641 MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 192.168.6.0/24&nbsp; &nbsp; &nbsp; mark match 0x0/0xff00 MARK xset 0x7f00/0xff00 </p><p>Chain mwan3_post (2 references)<br/> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br/>61996&nbsp; &nbsp;11M MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; eth0.51&nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mark match !0x7f00/0xff00 MARK xset 0x200/0xff00 <br/>1729K&nbsp; 294M MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; eth0.50&nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mark match !0x7f00/0xff00 MARK xset 0x100/0xff00 <br/>&nbsp; 18M 3467M MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mark match 0x8000/0x8000 MARK and 0xffff7fff <br/>&nbsp; 51M 9815M CONNMARK&nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;CONNMARK save mask 0xff00 </p><p>Chain mwan3_pre (2 references)<br/> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br/>&nbsp; 51M 9816M CONNMARK&nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;CONNMARK restore mask 0xff00 <br/>62805&nbsp; &nbsp;12M MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; eth0.51 *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;MARK xset 0x8200/0xff00 <br/>1766K&nbsp; 299M MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; eth0.50 *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;MARK xset 0x8100/0xff00 <br/> 869K&nbsp; &nbsp;86M mwan3_default&nbsp; all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mark match 0x0/0xff00 <br/> 680K&nbsp; &nbsp;57M mwan3_wan&nbsp; all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mark match 0x0/0xff00 <br/> 680K&nbsp; &nbsp;57M mwan3_rules&nbsp; all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mark match 0x0/0xff00 </p><p>Chain mwan3_rules (1 references)<br/> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br/> 2880&nbsp; 240K MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mark match 0x0/0xff00 MARK xset 0x1300/0xff00 </p><p>Chain mwan3_wan (1 references)<br/> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination</p><p>Output of &quot;ifconfig&quot; : </p><p>br-lan&nbsp; &nbsp; Link encap:Ethernet&nbsp; HWaddr 64:70:02:5C:58:FC&nbsp; <br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:10.1.4.1&nbsp; Bcast:10.1.4.255&nbsp; Mask:255.255.255.0<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:20087557 errors:0 dropped:15207 overruns:0 frame:0<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:19871305 errors:0 dropped:0 overruns:0 carrier:0<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0 <br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:3629747669 (3.3 GiB)&nbsp; TX bytes:3675359913 (3.4 GiB)</p><p>eth0&nbsp; &nbsp; &nbsp; Link encap:Ethernet&nbsp; HWaddr 64:70:02:5C:58:FC&nbsp; <br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:43782793 errors:0 dropped:20 overruns:60235 frame:0<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:40600350 errors:0 dropped:0 overruns:0 carrier:0<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:1000 <br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:4207347209 (3.9 GiB)&nbsp; TX bytes:4043388156 (3.7 GiB)<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Interrupt:4 </p><p>eth0.4&nbsp; &nbsp; Link encap:Ethernet&nbsp; HWaddr 64:70:02:5C:58:FC&nbsp; <br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:20095141 errors:0 dropped:0 overruns:0 frame:0<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:19878687 errors:0 dropped:0 overruns:0 carrier:0<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0 <br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:3630121275 (3.3 GiB)&nbsp; TX bytes:3675699485 (3.4 GiB)</p><p>eth0.50&nbsp; &nbsp;Link encap:Ethernet&nbsp; HWaddr 64:70:02:5C:58:FC&nbsp; <br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:99.235.226.25&nbsp; Bcast:99.235.227.255&nbsp; Mask:255.255.254.0<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:14487359 errors:0 dropped:1797820 overruns:0 frame:0<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:11373774 errors:0 dropped:0 overruns:0 carrier:0<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0 <br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:2144013383 (1.9 GiB)&nbsp; TX bytes:2179852942 (2.0 GiB)</p><p>eth0.51&nbsp; &nbsp;Link encap:Ethernet&nbsp; HWaddr 64:70:02:5C:58:FC&nbsp; <br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:10.1.51.2&nbsp; Bcast:10.1.51.255&nbsp; Mask:255.255.255.0<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:9200211 errors:0 dropped:9 overruns:0 frame:0<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:9347888 errors:0 dropped:0 overruns:0 carrier:0<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0 <br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:1940079871 (1.8 GiB)&nbsp; TX bytes:2320400586 (2.1 GiB)</p><p>lo&nbsp; &nbsp; &nbsp; &nbsp; Link encap:Local Loopback&nbsp; <br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:127.0.0.1&nbsp; Mask:255.0.0.0<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP LOOPBACK RUNNING&nbsp; MTU:16436&nbsp; Metric:1<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:46567 errors:0 dropped:0 overruns:0 frame:0<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:46567 errors:0 dropped:0 overruns:0 carrier:0<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0 <br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:4900210 (4.6 MiB)&nbsp; TX bytes:4900210 (4.6 MiB)</p><p>tun0&nbsp; &nbsp; &nbsp; Link encap:UNSPEC&nbsp; HWaddr 00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00&nbsp; <br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:10.1.254.1&nbsp; P-t-P:10.1.254.1&nbsp; Mask:255.255.255.0<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP POINTOPOINT RUNNING NOARP MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:7517871 errors:0 dropped:0 overruns:0 frame:0<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:7982978 errors:0 dropped:0 overruns:0 carrier:0<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:100 <br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:1227390363 (1.1 GiB)&nbsp; TX bytes:1533870637 (1.4 GiB)</p><p>Output of &quot;cat /etc/config/mwan3&quot; : </p><p>config rule &#039;default&#039;<br/>&nbsp; &nbsp; option dest_ip &#039;0.0.0.0/0&#039;<br/>&nbsp; &nbsp; option proto &#039;all&#039;<br/>&nbsp; &nbsp; option use_policy &#039;wan1_pri_wan2_sec&#039;</p><p>config interface &#039;wan1&#039;<br/>&nbsp; &nbsp; option enabled &#039;1&#039;<br/>&nbsp; &nbsp; list track_ip &#039;8.8.4.4&#039;<br/>&nbsp; &nbsp; list track_ip &#039;8.8.8.8&#039;<br/>&nbsp; &nbsp; list track_ip &#039;208.67.222.222&#039;<br/>&nbsp; &nbsp; list track_ip &#039;208.67.220.220&#039;<br/>&nbsp; &nbsp; option reliability &#039;2&#039;<br/>&nbsp; &nbsp; option count &#039;1&#039;<br/>&nbsp; &nbsp; option timeout &#039;2&#039;<br/>&nbsp; &nbsp; option interval &#039;5&#039;<br/>&nbsp; &nbsp; option down &#039;3&#039;<br/>&nbsp; &nbsp; option up &#039;8&#039;<br/>&nbsp; &nbsp; option reroute &#039;1&#039;</p><p>config interface &#039;wan2&#039;<br/>&nbsp; &nbsp; option enabled &#039;1&#039;<br/>&nbsp; &nbsp; list track_ip &#039;8.8.8.8&#039;<br/>&nbsp; &nbsp; list track_ip &#039;208.67.220.220&#039;<br/>&nbsp; &nbsp; option count &#039;1&#039;<br/>&nbsp; &nbsp; option down &#039;3&#039;<br/>&nbsp; &nbsp; option up &#039;8&#039;<br/>&nbsp; &nbsp; option reroute &#039;1&#039;<br/>&nbsp; &nbsp; option timeout &#039;3&#039;<br/>&nbsp; &nbsp; option interval &#039;60&#039;<br/>&nbsp; &nbsp; option reliability &#039;1&#039;</p><p>config member &#039;wan1_m1_w3&#039;<br/>&nbsp; &nbsp; option interface &#039;wan1&#039;<br/>&nbsp; &nbsp; option metric &#039;1&#039;<br/>&nbsp; &nbsp; option weight &#039;3&#039;</p><p>config member &#039;wan1_m2_w3&#039;<br/>&nbsp; &nbsp; option interface &#039;wan1&#039;<br/>&nbsp; &nbsp; option metric &#039;2&#039;<br/>&nbsp; &nbsp; option weight &#039;3&#039;</p><p>config member &#039;wan2_m1_w2&#039;<br/>&nbsp; &nbsp; option interface &#039;wan2&#039;<br/>&nbsp; &nbsp; option metric &#039;1&#039;<br/>&nbsp; &nbsp; option weight &#039;2&#039;</p><p>config member &#039;wan2_m2_w2&#039;<br/>&nbsp; &nbsp; option interface &#039;wan2&#039;<br/>&nbsp; &nbsp; option metric &#039;2&#039;<br/>&nbsp; &nbsp; option weight &#039;2&#039;</p><p>config policy &#039;wan1_only&#039;<br/>&nbsp; &nbsp; list use_member &#039;wan1_m1_w3&#039;</p><p>config policy &#039;wan2_only&#039;<br/>&nbsp; &nbsp; list use_member &#039;wan2_m1_w2&#039;</p><p>config policy &#039;wan1_wan2_loadbalanced&#039;<br/>&nbsp; &nbsp; list use_member &#039;wan1_m1_w3&#039;<br/>&nbsp; &nbsp; list use_member &#039;wan2_m1_w2&#039;</p><p>config policy &#039;wan1_pri_wan2_sec&#039;<br/>&nbsp; &nbsp; list use_member &#039;wan1_m1_w3&#039;<br/>&nbsp; &nbsp; list use_member &#039;wan2_m2_w2&#039;</p><p>config policy &#039;wan2_pri_wan1_sec&#039;<br/>&nbsp; &nbsp; list use_member &#039;wan1_m2_w3&#039;<br/>&nbsp; &nbsp; list use_member &#039;wan2_m1_w2&#039;</p><p>Output of &quot;cat /etc/config/network&quot; : </p><p>config interface &#039;loopback&#039;<br/>&nbsp; &nbsp; option ifname &#039;lo&#039;<br/>&nbsp; &nbsp; option proto &#039;static&#039;<br/>&nbsp; &nbsp; option ipaddr &#039;127.0.0.1&#039;<br/>&nbsp; &nbsp; option netmask &#039;255.0.0.0&#039;</p><p>config interface &#039;lan&#039;<br/>&nbsp; &nbsp; option ifname &#039;eth0.4&#039;<br/>&nbsp; &nbsp; option type &#039;bridge&#039;<br/>&nbsp; &nbsp; option proto &#039;static&#039;<br/>&nbsp; &nbsp; option ipaddr &#039;10.1.4.1&#039;<br/>&nbsp; &nbsp; option netmask &#039;255.255.255.0&#039;</p><p>config interface &#039;wan1&#039;<br/>&nbsp; &nbsp; option ifname &#039;eth0.50&#039;<br/>&nbsp; &nbsp; option proto &#039;dhcp&#039;<br/>&nbsp; &nbsp; option metric &#039;10&#039;</p><p>config interface &#039;wan2&#039;<br/>&nbsp; &nbsp; option ifname &#039;eth0.51&#039;<br/>&nbsp; &nbsp; option _orig_ifname &#039;eth0.51&#039;<br/>&nbsp; &nbsp; option _orig_bridge &#039;false&#039;<br/>&nbsp; &nbsp; option proto &#039;static&#039;<br/>&nbsp; &nbsp; option netmask &#039;255.255.255.0&#039;<br/>&nbsp; &nbsp; option metric &#039;20&#039;<br/>&nbsp; &nbsp; option ipaddr &#039;10.1.51.2&#039;<br/>&nbsp; &nbsp; option gateway &#039;10.1.51.1&#039;</p><p>config switch<br/>&nbsp; &nbsp; option name &#039;rtl8366rb&#039;<br/>&nbsp; &nbsp; option reset &#039;1&#039;<br/>&nbsp; &nbsp; option enable_vlan &#039;1&#039;<br/>&nbsp; &nbsp; option enable_vlan4k &#039;1&#039;</p><p>config switch_vlan<br/>&nbsp; &nbsp; option device &#039;rtl8366rb&#039;<br/>&nbsp; &nbsp; option vlan &#039;1&#039;<br/>&nbsp; &nbsp; option ports &#039;5t&#039;</p><p>config switch_vlan<br/>&nbsp; &nbsp; option device &#039;rtl8366rb&#039;<br/>&nbsp; &nbsp; option vlan &#039;2&#039;<br/>&nbsp; &nbsp; option ports &#039;5t&#039;</p><p>config switch_vlan<br/>&nbsp; &nbsp; option device &#039;rtl8366rb&#039;<br/>&nbsp; &nbsp; option ports &#039;0 1 2 5t&#039;<br/>&nbsp; &nbsp; option vlan &#039;4&#039;</p><p>config switch_vlan<br/>&nbsp; &nbsp; option device &#039;rtl8366rb&#039;<br/>&nbsp; &nbsp; option ports &#039;3 5t&#039;<br/>&nbsp; &nbsp; option vlan &#039;50&#039;</p><p>config switch_vlan<br/>&nbsp; &nbsp; option device &#039;rtl8366rb&#039;<br/>&nbsp; &nbsp; option vlan &#039;51&#039;<br/>&nbsp; &nbsp; option ports &#039;4 5t&#039;</p><p>config interface &#039;vpn&#039;<br/>&nbsp; &nbsp; option proto &#039;none&#039;<br/>&nbsp; &nbsp; option ifname &#039;tun0&#039;</p><p>config route<br/>&nbsp; &nbsp; option interface &#039;lan&#039;<br/>&nbsp; &nbsp; option target &#039;10.1.1.0&#039;<br/>&nbsp; &nbsp; option netmask &#039;255.255.255.0&#039;<br/>&nbsp; &nbsp; option gateway &#039;10.1.4.2&#039;</p><p>===</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p209299">
				<div class="post-metadata">
					<div class="post-num">Post #410</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						8 Aug 2013, 23:49					</div>
				</div>
				<div class="post-content content">
					<p>Hi Tim,</p><br/><p>Maybe a long shot, but try to remove the following lines in your network config:<br/></p><div class="codebox"><pre><code>    option _orig_ifname &#039;eth0.51&#039;
    option _orig_bridge &#039;false&#039;</code></pre></div><p>It maybe related to a bug in mwan3...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p209352">
				<div class="post-metadata">
					<div class="post-num">Post #411</div>
					<div class="post-author">vinca</div>
					<div class="post-datetime">
						9 Aug 2013, 15:11					</div>
				</div>
				<div class="post-content content">
					<p>Hello,<br/>I try to configure 3G failover.<br/>This is routing table:<br/>root@openwrt:~# route -n<br/>Kernel IP routing table<br/>Destination&nbsp; &nbsp; &nbsp;Gateway&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Genmask&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Flags Metric Ref&nbsp; &nbsp; Use Iface<br/>10.64.64.64&nbsp; &nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.255.255.255 UH&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 3gg<br/>192.168.1.0&nbsp; &nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.255.255.0&nbsp; &nbsp;U&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 br-lan<br/>192.168.30.0&nbsp; &nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.255.252.0&nbsp; &nbsp;U&nbsp; &nbsp; &nbsp;10&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp; 0 eth1<br/>0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;192.168.30.1&nbsp; &nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;UG&nbsp; &nbsp; 10&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp; 0 eth1<br/>0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;10.64.64.64&nbsp; &nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;UG&nbsp; &nbsp; 30&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp; 0 3gg<br/>and<br/>MWAN3 Multi-WAN Troubleshooting<br/>MWAN3 package versions : <br/>mwan3 - 1.2-9<br/>luci-app-mwan3 - local-1<br/>Firewall default output policy (must be ACCEPT) : <br/>ACCEPT<br/>Output of &quot;ip route show&quot; : </p><p>10.64.64.64 dev 3gg&nbsp; proto kernel&nbsp; scope link&nbsp; src 188.198.20.205 <br/>192.168.1.0/24 dev br-lan&nbsp; proto kernel&nbsp; scope link&nbsp; src 192.168.1.1 <br/>192.168.30.0/22 dev eth1&nbsp; proto static&nbsp; scope link&nbsp; metric 10 <br/>default via 192.168.30.1 dev eth1&nbsp; proto static&nbsp; metric 10 <br/>default via 10.64.64.64 dev 3gg&nbsp; proto static&nbsp; metric 30 </p><p>Output of &quot;ip rule show&quot; : </p><p>0:&nbsp; &nbsp; from all lookup local <br/>1001:&nbsp; &nbsp; from all fwmark 0x100/0xff00 lookup 1001 <br/>1002:&nbsp; &nbsp; from all fwmark 0x200/0xff00 lookup 1002 <br/>1016:&nbsp; &nbsp; from all fwmark 0x1000/0xff00 lookup 1016 <br/>1017:&nbsp; &nbsp; from all fwmark 0x1100/0xff00 lookup 1017 <br/>1018:&nbsp; &nbsp; from all fwmark 0x1200/0xff00 lookup 1018 <br/>32766:&nbsp; &nbsp; from all lookup main <br/>32767:&nbsp; &nbsp; from all lookup default </p><p>Output of &quot;ip route list table 1001-1099&quot; (1001-1015 = interface tables, 1016-1099 = policy tables) : </p><p>1001<br/>default via 192.168.30.1 dev eth1 <br/>1002<br/>default via 10.64.64.64 dev 3gg <br/>1016<br/>default via 192.168.30.1 dev eth1&nbsp; metric 1 <br/>default via 10.64.64.64 dev 3gg&nbsp; metric 2 <br/>1017<br/>default via 192.168.30.1 dev eth1&nbsp; metric 1 <br/>1018<br/>default via 10.64.64.64 dev 3gg&nbsp; metric 1 </p><p>Output of &quot;iptables -L -t mangle -v -n | awk &#039;/mwan3/&#039; RS=&quot; : </p><p>Chain PREROUTING (policy ACCEPT 2389 packets, 777K bytes)<br/> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br/> 7357 2660K mwan3_pre&nbsp; all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p><p>Chain INPUT (policy ACCEPT 634 packets, 72088 bytes)<br/> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br/> 1707&nbsp; 188K mwan3_post&nbsp; all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p><p>Chain OUTPUT (policy ACCEPT 239 packets, 62329 bytes)<br/> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br/>&nbsp; 616&nbsp; 142K mwan3_pre&nbsp; all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p><p>Chain POSTROUTING (policy ACCEPT 1824 packets, 739K bytes)<br/> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br/> 5793 2567K mwan3_post&nbsp; all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p><p>Chain mwan3_default (1 references)<br/> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br/>&nbsp; &nbsp;23&nbsp; 2380 MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 224.0.0.0/3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mark match !0x8000/0x8000 MARK or 0x8000 <br/>&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 127.0.0.0/8&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mark match !0x8000/0x8000 MARK or 0x8000 <br/>&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 10.64.64.64&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mark match !0x8000/0x8000 MARK or 0x8000 <br/>&nbsp; 354 80526 MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 192.168.1.0/24&nbsp; &nbsp; &nbsp; mark match !0x8000/0x8000 MARK or 0x8000 <br/>&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 192.168.30.0/22&nbsp; &nbsp; &nbsp; mark match !0x8000/0x8000 MARK or 0x8000 </p><p>Chain mwan3_post (2 references)<br/> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br/>&nbsp; &nbsp;24&nbsp; 2016 MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; 3gg&nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mark match !0x8000/0x8000 MARK xset 0x200/0xff00 <br/> 2452&nbsp; 646K MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; eth1&nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mark match !0x8000/0x8000 MARK xset 0x100/0xff00 <br/> 4997 2105K MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mark match 0x8000/0x8000 MARK and 0xffff7fff <br/> 7500 2755K CONNMARK&nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;CONNMARK save mask 0xff00 </p><p>Chain mwan3_pre (2 references)<br/> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br/> 7973 2802K CONNMARK&nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;CONNMARK restore mask 0xff00 <br/>&nbsp; &nbsp;24&nbsp; 2016 MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; 3gg&nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;MARK xset 0x8200/0xff00 <br/> 3867 1908K MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; eth1&nbsp; &nbsp;*&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;MARK xset 0x8100/0xff00 <br/> 3965&nbsp; 878K mwan3_default&nbsp; all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mark match !0x8000/0x8000 <br/>&nbsp; 534 36118 mwan3_rules&nbsp; all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mark match 0x0/0xff00 </p><p>Chain mwan3_rules (1 references)<br/> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br/>&nbsp; 104&nbsp; 7867 MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mark match 0x0/0xff00 MARK xset 0x1000/0xff00 </p><p>Output of &quot;ifconfig&quot; : </p><p>3gg&nbsp; &nbsp; &nbsp;Link encap:Point-to-Point Protocol&nbsp; <br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:188.198.20.205&nbsp; P-t-P:10.64.64.64&nbsp; Mask:255.255.255.255<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP POINTOPOINT RUNNING NOARP MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:31 errors:0 dropped:0 overruns:0 frame:0<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:31 errors:0 dropped:0 overruns:0 carrier:0<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:3 <br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:2140 (2.0 KiB)&nbsp; TX bytes:2164 (2.1 KiB)</p><p>br-lan&nbsp; &nbsp; Link encap:Ethernet&nbsp; HWaddr 00:D0:50:43:BF:C6&nbsp; <br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:192.168.1.1&nbsp; Bcast:192.168.1.255&nbsp; Mask:255.255.255.0<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet6 addr: fe80::2d0:50ff:fe43:bfc6/64 Scope:Link<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:3305 errors:0 dropped:0 overruns:0 frame:0<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:3170 errors:0 dropped:0 overruns:0 carrier:0<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0 <br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:735095 (717.8 KiB)&nbsp; TX bytes:1942486 (1.8 MiB)</p><p>eth0&nbsp; &nbsp; &nbsp; Link encap:Ethernet&nbsp; HWaddr 00:D0:50:43:BF:C6&nbsp; <br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:3376 errors:0 dropped:0 overruns:0 frame:0<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:3163 errors:0 dropped:0 overruns:0 carrier:0<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:1000 <br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:841530 (821.8 KiB)&nbsp; TX bytes:1942060 (1.8 MiB)<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Base address:0x6000 </p><p>eth1&nbsp; &nbsp; &nbsp; Link encap:Ethernet&nbsp; HWaddr 00:D0:50:43:BF:C7&nbsp; <br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:172.30.19.54&nbsp; Bcast:172.30.19.255&nbsp; Mask:255.255.252.0<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet6 addr: fe80::2d0:50ff:fe43:bfc7/64 Scope:Link<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:6823 errors:0 dropped:0 overruns:0 frame:0<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:2505 errors:0 dropped:0 overruns:0 carrier:0<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:1000 <br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:2282539 (2.1 MiB)&nbsp; TX bytes:687391 (671.2 KiB)<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Base address:0xe000 </p><p>lo&nbsp; &nbsp; &nbsp; &nbsp; Link encap:Local Loopback&nbsp; <br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:127.0.0.1&nbsp; Mask:255.0.0.0<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet6 addr: ::1/128 Scope:Host<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP LOOPBACK RUNNING&nbsp; MTU:16436&nbsp; Metric:1<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:35 errors:0 dropped:0 overruns:0 frame:0<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:35 errors:0 dropped:0 overruns:0 carrier:0<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0 <br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:2619 (2.5 KiB)&nbsp; TX bytes:2619 (2.5 KiB)</p><p>Output of &quot;cat /etc/config/mwan3&quot; : </p><p>config interface &#039;wan&#039;<br/>&nbsp; &nbsp; option enabled &#039;1&#039;<br/>&nbsp; &nbsp; list track_ip &#039;8.8.8.8&#039;<br/>&nbsp; &nbsp; list track_ip &#039;8.8.4.4&#039;<br/>&nbsp; &nbsp; option reliability &#039;1&#039;<br/>&nbsp; &nbsp; option count &#039;1&#039;<br/>&nbsp; &nbsp; option timeout &#039;2&#039;<br/>&nbsp; &nbsp; option interval &#039;5&#039;<br/>&nbsp; &nbsp; option down &#039;3&#039;<br/>&nbsp; &nbsp; option up &#039;3&#039;</p><p>config interface &#039;3g&#039;<br/>&nbsp; &nbsp; option enabled &#039;1&#039;<br/>&nbsp; &nbsp; list track_ip &#039;8.8.8.8&#039;<br/>&nbsp; &nbsp; list track_ip &#039;8.8.4.4&#039;<br/>&nbsp; &nbsp; option reliability &#039;1&#039;<br/>&nbsp; &nbsp; option count &#039;1&#039;<br/>&nbsp; &nbsp; option timeout &#039;2&#039;<br/>&nbsp; &nbsp; option interval &#039;5&#039;<br/>&nbsp; &nbsp; option down &#039;3&#039;<br/>&nbsp; &nbsp; option up &#039;3&#039;</p><p>config member &#039;wan_m1_w2&#039;<br/>&nbsp; &nbsp; option interface &#039;wan&#039;<br/>&nbsp; &nbsp; option metric &#039;1&#039;<br/>&nbsp; &nbsp; option weight &#039;2&#039;</p><p>config member &#039;wan_m2_w2&#039;<br/>&nbsp; &nbsp; option interface &#039;wan&#039;<br/>&nbsp; &nbsp; option metric &#039;2&#039;<br/>&nbsp; &nbsp; option weight &#039;2&#039;</p><p>config member &#039;3g_m1_w3&#039;<br/>&nbsp; &nbsp; option interface &#039;3g&#039;<br/>&nbsp; &nbsp; option metric &#039;1&#039;<br/>&nbsp; &nbsp; option weight &#039;3&#039;</p><p>config member &#039;3g_m2_w3&#039;<br/>&nbsp; &nbsp; option interface &#039;3g&#039;<br/>&nbsp; &nbsp; option metric &#039;2&#039;<br/>&nbsp; &nbsp; option weight &#039;3&#039;</p><p>config policy &#039;wan_pri_3g_sec&#039;<br/>&nbsp; &nbsp; list use_member &#039;wan_m1_w2&#039;<br/>&nbsp; &nbsp; list use_member &#039;3g_m2_w3&#039;</p><p>config policy &#039;wan_only&#039;<br/>&nbsp; &nbsp; list use_member &#039;wan_m1_w2&#039;</p><p>config policy &#039;3g_only&#039;<br/>&nbsp; &nbsp; list use_member &#039;3g_m1_w3&#039;</p><p>config rule &#039;wan_g3&#039;<br/>&nbsp; &nbsp; option dest_ip &#039;0.0.0.0/0&#039;<br/>&nbsp; &nbsp; option proto &#039;all&#039;<br/>&nbsp; &nbsp; option use_policy &#039;wan_pri_3g_sec&#039;</p><p>Output of &quot;cat /etc/config/network&quot; : </p><p>config switch &#039;eth0&#039;<br/>&nbsp; &nbsp; option enable &#039;1&#039;</p><p>config switch_vlan &#039;eth0_1&#039;<br/>&nbsp; &nbsp; option device &#039;eth0&#039;<br/>&nbsp; &nbsp; option vlan &#039;1&#039;<br/>&nbsp; &nbsp; option ports &#039;0 1 2 3 4&#039;</p><p>config interface &#039;loopback&#039;<br/>&nbsp; &nbsp; option ifname &#039;lo&#039;<br/>&nbsp; &nbsp; option proto &#039;static&#039;<br/>&nbsp; &nbsp; option ipaddr &#039;127.0.0.1&#039;<br/>&nbsp; &nbsp; option netmask &#039;255.0.0.0&#039;</p><p>config interface &#039;lan&#039;<br/>&nbsp; &nbsp; option ifname &#039;eth0&#039;<br/>&nbsp; &nbsp; option type &#039;bridge&#039;<br/>&nbsp; &nbsp; option proto &#039;static&#039;<br/>&nbsp; &nbsp; option ipaddr &#039;192.168.1.1&#039;<br/>&nbsp; &nbsp; option netmask &#039;255.255.255.0&#039;</p><p>config interface &#039;3g&#039;<br/>&nbsp; &nbsp; option ifname &#039;ppp0&#039;<br/>&nbsp; &nbsp; option device &#039;/dev/ttyUSB2&#039;<br/>&nbsp; &nbsp; option service &#039;umts&#039;<br/>&nbsp; &nbsp; option proto &#039;3g&#039;<br/>&nbsp; &nbsp; option ctrldev &#039;/dev/ttyUSB1&#039;<br/>&nbsp; &nbsp; option apn &#039;AGD&#039;<br/>&nbsp; &nbsp; option pincode &#039;1234&#039;<br/>&nbsp; &nbsp; option username &#039;user&#039;<br/>&nbsp; &nbsp; option password &#039;user&#039;<br/>&nbsp; &nbsp; option metric &#039;30&#039;</p><p>config interface &#039;wan&#039;<br/>&nbsp; &nbsp; option proto &#039;dhcp&#039;<br/>&nbsp; &nbsp; option ifname &#039;eth1&#039;<br/>&nbsp; &nbsp; option metric &#039;10&#039;</p><p>When I unplug eth1 cable, routing table is not changed – eth1 entries are not deleted:<br/>root@openwrt:~# route -n<br/>Kernel IP routing table<br/>Destination&nbsp; &nbsp; &nbsp;Gateway&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Genmask&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Flags Metric Ref&nbsp; &nbsp; Use Iface<br/>10.64.64.64&nbsp; &nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.255.255.255 UH&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 3gg<br/>192.168.1.0&nbsp; &nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.255.255.0&nbsp; &nbsp;U&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 br-lan<br/>192.168.30.0&nbsp; &nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.255.252.0&nbsp; &nbsp;U&nbsp; &nbsp; &nbsp;10&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp; 0 eth1<br/>0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;192.168.30.1&nbsp; &nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;UG&nbsp; &nbsp; 10&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp; 0 eth1<br/>0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;10.64.64.64&nbsp; &nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;UG&nbsp; &nbsp; 30&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp; 0 3gg</p><p>When I unplug 3g dongle, 3gg entries are removed from routing table:</p><p>root@openwrt:~# route -n<br/>Kernel IP routing table<br/>Destination&nbsp; &nbsp; &nbsp;Gateway&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Genmask&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Flags Metric Ref&nbsp; &nbsp; Use Iface<br/>192.168.1.0&nbsp; &nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.255.255.0&nbsp; &nbsp;U&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 br-lan<br/>192.168.30.0&nbsp; &nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.255.252.0&nbsp; &nbsp;U&nbsp; &nbsp; &nbsp;10&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp; 0 eth1<br/>0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;192.168.30.1&nbsp; &nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;UG&nbsp; &nbsp; 10&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp; 0 eth1</p><br/><p>Why eth1 entries from rooting table are not removed when eth1 cable is unpluged? Is mwan3 correctly configured?<br/>Why for entry 10.64.64.64&nbsp; &nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.255.255.255 UH&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 3gg&nbsp; &nbsp;metric is 0, and not 30?</p><p>Thanks</p>											<p class="post-edited">(Last edited by <strong>vinca</strong> on 12 Aug 2013, 11:39)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p209356">
				<div class="post-metadata">
					<div class="post-num">Post #412</div>
					<div class="post-author">headless.cross</div>
					<div class="post-datetime">
						9 Aug 2013, 16:09					</div>
				</div>
				<div class="post-content content">
					<p>Hello and thanks everyone once again, for the contribution to this project. Finally I&#039;ve found some spare time to post some feedback.</p><p>I&#039;m stuck on <strong>mwan3_1.2-11_all.ipk</strong> instead of the latest <strong>mwan3_1.2-17_all.ipk</strong> because I had some issues, which I will try to describe below.</p><p>Using the mwan3_1.2-11_all.ipk I had to do the loopback trick to loadbalance traffic generated from the router itself. Since some versions this is not needed anymore (as I can understand), so I removed the loopback trick and installed the latest (<strong>mwan3_1.2-17_all.ipk</strong>) version and then some strange behavior started.</p><p>This is the new config (with the option reroute, which is <strong>the only difference</strong> between the old config):</p><div class="codebox"><pre><code>config rule &#039;dnsomatic&#039;
    option use_policy &#039;default&#039;
    option dest_ip &#039;67.215.92.0/24&#039;

config rule &#039;skype&#039;
    option proto &#039;tcp&#039;
    option use_policy &#039;wan_only&#039;
    option dest_port &#039;8000&#039;
    option dest_ip &#039;0.0.0.0/0&#039;

config rule &#039;https&#039;
    option proto &#039;tcp&#039;
    option use_policy &#039;wwan_only&#039;
    option dest_port &#039;443,8443,2087&#039;
    option dest_ip &#039;0.0.0.0/0&#039;

config rule &#039;internet&#039;
    option use_policy &#039;wan_wwan_loadbalanced&#039;
    option dest_ip &#039;0.0.0.0/0&#039;
    option equalize &#039;1&#039;

config interface &#039;wan&#039;
    option enabled &#039;1&#039;
    option timeout &#039;5&#039;
    option down &#039;5&#039;
    option up &#039;3&#039;
    option reliability &#039;3&#039;
    option count &#039;3&#039;
    option interval &#039;30&#039;
    list track_ip &#039;xxx.xxx.xxx.xxx&#039;
    list track_ip &#039;xxx.xxx.xxx.xxx&#039;
    list track_ip &#039;xxx.xxx.xxx.xxx&#039;
    option reroute &#039;1&#039;

config interface &#039;wwan&#039;
    option enabled &#039;1&#039;
    list track_ip &#039;xxx.xxx.xxx.xxx&#039;
    list track_ip &#039;xxx.xxx.xxx.xxx&#039;
    list track_ip &#039;xxx.xxx.xxx.xxx&#039;
    option timeout &#039;5&#039;
    option down &#039;5&#039;
    option up &#039;3&#039;
    option reliability &#039;3&#039;
    option count &#039;3&#039;
    option interval &#039;30&#039;
    option reroute &#039;1&#039;

config member &#039;wan_m1_w4&#039;
    option interface &#039;wan&#039;
    option metric &#039;1&#039;
    option weight &#039;4&#039;

config member &#039;wan_m2_w4&#039;
    option interface &#039;wan&#039;
    option metric &#039;2&#039;
    option weight &#039;4&#039;

config member &#039;wwan_m1_w3&#039;
    option interface &#039;wwan&#039;
    option metric &#039;1&#039;
    option weight &#039;3&#039;

config member &#039;wwan_m2_w3&#039;
    option interface &#039;wwan&#039;
    option metric &#039;2&#039;
    option weight &#039;3&#039;

config policy &#039;wan_only&#039;
    list use_member &#039;wan_m1_w4&#039;

config policy &#039;wwan_only&#039;
    list use_member &#039;wwan_m1_w3&#039;

config policy &#039;wan_wwan_loadbalanced&#039;
    list use_member &#039;wan_m1_w4&#039;
    list use_member &#039;wwan_m1_w3&#039;

config policy &#039;wan_pri_wwan_sec&#039;
    list use_member &#039;wan_m1_w4&#039;
    list use_member &#039;wwan_m2_w3&#039;

config policy &#039;wwan_pri_wan_sec&#039;
    list use_member &#039;wan_m2_w4&#039;
    list use_member &#039;wwan_m1_w3&#039;</code></pre></div><p>The errors:</p><p>First of all I ran <strong>/etc/init.d/mwan3 restart</strong>, and it blew this one: <strong>iptables: Too many levels of symbolic links</strong>.<br/>A restart is needed, I thought, and did so. When the system was ready, I re-ran the above command, with the same result, errors.</p><p>After that, I did one more restart to check everything else was OK. Only sites using https was able to load, and everything else was giving me a &quot;Connection Reset&quot; errors. I thought maybe there was a misconfiguration, so I did the following:</p><p>Disabled <strong>wan</strong> interface and routed all the traffic (using mwan3 rules) through <strong>wwan</strong>. The result was the same: https was ok, everything else was dead. After that I had no time to spend to investigate further the problem (for which I&#039;m sorry, because I have no free time at all to contribute more) and rolled back to <strong>mwan3_1.2-11_all.ipk</strong>.</p><p>That&#039;s my story. Thanks in advance for reading my post. If anything more is needed or I have missed anything, let me know.</p>											<p class="post-edited">(Last edited by <strong>headless.cross</strong> on 9 Aug 2013, 16:10)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p209359">
				<div class="post-metadata">
					<div class="post-num">Post #413</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						9 Aug 2013, 16:54					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>vinca wrote:</cite><blockquote><p>Why eth1 entries from rooting table are not removed when eth1 cable is unpluged? Is mwan3 correctly configured?</p></blockquote></div><p>Mwan3 does nothing to the default routing table! Any entry removed or added to the default routing table is done by another application or process.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p209426">
				<div class="post-metadata">
					<div class="post-num">Post #414</div>
					<div class="post-author">coltect</div>
					<div class="post-datetime">
						10 Aug 2013, 15:51					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>headless.cross wrote:</cite><blockquote><p>First of all I ran <strong>/etc/init.d/mwan3 restart</strong>, and it blew this one: <strong>iptables: Too many levels of symbolic links</strong>.</p></blockquote></div><p>I found the same error with iptables, It is due to you using &quot;wan&quot; as an interface name.&nbsp; If you change your wan interface name to wan0 or anything apart from wan it will work, or at least it will get past this problem.</p>											<p class="post-edited">(Last edited by <strong>coltect</strong> on 10 Aug 2013, 15:53)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p209463">
				<div class="post-metadata">
					<div class="post-num">Post #415</div>
					<div class="post-author">orz</div>
					<div class="post-datetime">
						10 Aug 2013, 23:19					</div>
				</div>
				<div class="post-content content">
					<p>Hi Adze,<br/>I am using mwan3 and getting some trouble,could you help me fix them?Thank you very much!<br/>My h.w is RG100A-AA, F.W version is OP Backfire 10.03.1, mwan3 shows wan1(pppoe-wan1) ONLINE, wan2(pppoe-wan2) ONLINE, but there is a warning on the Luci webpage:<br/></p><div class="codebox"><pre><code>WARNING: some interfaces have duplicate metrics configured in /etc/config/network!</code></pre></div><p>I am sure the metrics in /etc/config/network are not the same,here is my config in network:<br/></p><div class="codebox"><pre><code># Copyright (C) 2008 OpenWrt.org

config &#039;switch&#039; &#039;eth1&#039;
    option &#039;reset&#039; &#039;1&#039;
    option &#039;enable_vlan&#039; &#039;3&#039;
        
config &#039;switch_vlan&#039;
    option &#039;device&#039; &#039;eth1&#039;
    option &#039;vlan&#039; &#039;0&#039;
    option &#039;ports&#039; &#039;0 5&#039;
                
config &#039;interface&#039; &#039;loopback&#039;
        option &#039;ifname&#039; &#039;lo&#039;
    option &#039;proto&#039; &#039;static&#039;
    option &#039;ipaddr&#039; &#039;127.0.0.1&#039;
    option &#039;netmask&#039; &#039;255.0.0.0&#039;
                                
config &#039;interface&#039; &#039;lan&#039;
    option &#039;type&#039; &#039;bridge&#039;
    option &#039;ifname&#039; &#039;eth1.0&#039;
        option &#039;proto&#039; &#039;static&#039;
        option &#039;ipaddr&#039; &#039;192.168.1.1&#039;
    option &#039;netmask&#039; &#039;255.255.255.0&#039;
        option &#039;nat&#039; &#039;1&#039;
    option &#039;dns&#039; &#039;8.8.8.8&#039;
                                                    
config &#039;switch_vlan&#039; &#039;eth1_1&#039;
    option &#039;device&#039; &#039;eth1&#039;
    option &#039;vlan&#039; &#039;1&#039;
    option &#039;ports&#039; &#039;1 2 5&#039;

config &#039;switch_vlan&#039; &#039;eth1_2&#039;
        option &#039;device&#039; &#039;eth1&#039;
     option &#039;vlan&#039; &#039;2&#039;
    option &#039;ports&#039; &#039;3 5&#039;

config &#039;interface&#039; &#039;wan1&#039;
    option &#039;ifname&#039; &#039;eth1.1&#039;
    option &#039;_orig_ifname&#039; &#039;eth1.1&#039;
    option &#039;_orig_bridge&#039; &#039;false&#039;
    option &#039;proto&#039; &#039;pppoe&#039;
    option &#039;username&#039; &#039;b*****8&#039;
    option &#039;password&#039; &#039;******&#039;
    option &#039;peerdns&#039; &#039;0&#039;
    option &#039;dns&#039; &#039;8.8.8.8&#039;
    option &#039;metric&#039; &#039;10&#039;
    
config &#039;interface&#039; &#039;wan2&#039;
    option &#039;ifname&#039; &#039;eth1.2&#039;
    option &#039;_orig_ifname&#039; &#039;eth1.2&#039;
    option &#039;_orig_bridge&#039; &#039;false&#039;
    option &#039;proto&#039; &#039;pppoe&#039;
    option &#039;username&#039; &#039;1*********6&#039;
    option &#039;password&#039; &#039;******&#039;
    option &#039;metric&#039; &#039;20&#039;
    option &#039;peerdns&#039; &#039;0&#039;
    option &#039;dns&#039; &#039;8.8.4.4 8.8.8.8&#039;

config &#039;interface&#039; &#039;wan&#039;     
    option &#039;ifname&#039;    &#039;eth0&#039;
    option &#039;proto&#039;    &#039;dhcp&#039;
    option &#039;metric&#039; &#039;30&#039;</code></pre></div><p>and route -n shows:<br/></p><div class="codebox"><pre><code>Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
*.*.102.1    0.0.0.0         255.255.255.255 UH    0      0        0 pppoe-wan2
*.*.136.1   0.0.0.0         255.255.255.255 UH    0      0        0 pppoe-wan1
192.168.1.0     0.0.0.0         255.255.255.0   U     0      0        0 br-lan
0.0.0.0         *.*.136.1   0.0.0.0         UG    0      0        0 pppoe-wan1</code></pre></div><p>Is there missing <br/></p><div class="codebox"><pre><code>0.0.0.0         *.*.102.1   0.0.0.0         UG    0      0        0 pppoe-wan2</code></pre></div><p>and all the metrics are 0, I don&#039;t know where I config incorrect :-(</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p209464">
				<div class="post-metadata">
					<div class="post-num">Post #416</div>
					<div class="post-author">thdyck</div>
					<div class="post-datetime">
						10 Aug 2013, 23:51					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>orz wrote:</cite><blockquote><p>My h.w is RG100A-AA, F.W version is OP Backfire 10.03.1, and all the metrics are 0, I don&#039;t know where I config incorrect</p></blockquote></div><p>Hi orz, I don&#039;t think OpenWrt Backfire 10.03.1 is supported by mwan3. Have you tried OpenWrt 12.09?</p><p>Regards,<br/>Tim</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p209482">
				<div class="post-metadata">
					<div class="post-num">Post #417</div>
					<div class="post-author">orz</div>
					<div class="post-datetime">
						11 Aug 2013, 11:20					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>thdyck wrote:</cite><blockquote><div class="quotebox"><cite>orz wrote:</cite><blockquote><p>My h.w is RG100A-AA, F.W version is OP Backfire 10.03.1, and all the metrics are 0, I don&#039;t know where I config incorrect</p></blockquote></div><p>Hi orz, I don&#039;t think OpenWrt Backfire 10.03.1 is supported by mwan3. Have you tried OpenWrt 12.09?</p><p>Regards,<br/>Tim</p></blockquote></div><p>Dear Tim,<br/>&nbsp; &nbsp; Thank you so much, you are right, I&#039;ve updated the F.W version,now it is 12.09, and the problems I mentioned above are all gone, mwan3 works well, it&#039;s so amazing, thank you again :-)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p209557">
				<div class="post-metadata">
					<div class="post-num">Post #418</div>
					<div class="post-author">thdyck</div>
					<div class="post-datetime">
						12 Aug 2013, 05:52					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><p>Hi Tim,<br/>Maybe a long shot, but try to remove the following lines in your network config:<br/></p><div class="codebox"><pre><code>    option _orig_ifname &#039;eth0.51&#039;
    option _orig_bridge &#039;false&#039;</code></pre></div><p>It maybe related to a bug in mwan3...</p></blockquote></div><p>Hi Adze, thanks for the idea. I removed those lines and re-tested -- the unexpected failover to wan2 did _not_ occur. So, that looks like it did the trick.</p><p>Thanks also for all your updates to the wiki page. There is a lot more technical detail there now.</p><p>Regards,<br/>Tim</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p209559">
				<div class="post-metadata">
					<div class="post-num">Post #419</div>
					<div class="post-author">thdyck</div>
					<div class="post-datetime">
						12 Aug 2013, 06:01					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>tcherenato wrote:</cite><blockquote><p>Hi Tim,<br/>if it is useful for someone else, I added a &quot;sleep 1&quot; in /sbin/hotplug-call, line 16:<br/>Renato</p></blockquote></div><p>Hi Renato, thanks for finding that. I had a problem where if I configured OpenVPN to start at device bootup along with ddns-scripts and mwan3, I would have a segmentation fault sometimes. Adding the sleep 1 fix you describe avoids the segmentation fault.</p><p>Regards,<br/>Tim</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p209681">
				<div class="post-metadata">
					<div class="post-num">Post #420</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						13 Aug 2013, 16:20					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>coltect wrote:</cite><blockquote><div class="quotebox"><cite>headless.cross wrote:</cite><blockquote><p>First of all I ran <strong>/etc/init.d/mwan3 restart</strong>, and it blew this one: <strong>iptables: Too many levels of symbolic links</strong>.</p></blockquote></div><p>I found the same error with iptables, It is due to you using &quot;wan&quot; as an interface name.&nbsp; If you change your wan interface name to wan0 or anything apart from wan it will work, or at least it will get past this problem.</p></blockquote></div><p>Above problem is fixed in version 1.2-18. Thank you for reporting!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p209682">
				<div class="post-metadata">
					<div class="post-num">Post #421</div>
					<div class="post-author">vinca</div>
					<div class="post-datetime">
						13 Aug 2013, 16:33					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><div class="quotebox"><cite>vinca wrote:</cite><blockquote><p>Why eth1 entries from rooting table are not removed when eth1 cable is unpluged? Is mwan3 correctly configured?</p></blockquote></div><p>Mwan3 does nothing to the default routing table! Any entry removed or added to the default routing table is done by another application or process.</p></blockquote></div><p>Hi Adze,</p><p>I&#039;m interested if the test scenario is correct. So, if I unplug cable, rules for this interface from default routing table must be removed. Correct? Otherwise, if rules remain in default routing table, 3g is not used for failover.</p><p>Thanks</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p209685">
				<div class="post-metadata">
					<div class="post-num">Post #422</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						13 Aug 2013, 16:45					</div>
				</div>
				<div class="post-content content">
					<p>Hi Vinca,</p><br/><p>Routing entries for ethernet based interfaces will stay in the default routing table, as there is no mean of detecting that the cable is disconnected. Mwan3 only uses the default routing table for information on next-hop addresses.</p><p>It is incorrect to state that that the failover will not occur as long as the rules for the primary interface are still in the default routing table.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p209692">
				<div class="post-metadata">
					<div class="post-num">Post #423</div>
					<div class="post-author">tcherenato</div>
					<div class="post-datetime">
						13 Aug 2013, 17:39					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><p>Above problem is fixed in version 1.2-18. Thank you for reporting!</p></blockquote></div><p>Thank you {{{ Adze }}}. I&#039;ll upgrade. Version 1.2-18 is ready?</p><p>Now hit the name!!!&nbsp; ;-)</p><p>[]&#039;s<br/>Rnato</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p209695">
				<div class="post-metadata">
					<div class="post-num">Post #424</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						13 Aug 2013, 18:18					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>tcherenato wrote:</cite><blockquote><p>Version 1.2-18 is ready?</p></blockquote></div><p>Yes and it&#039;s available at <a href="https://github.com/Adze1502/mwan">https://github.com/Adze1502/mwan</a></p><div class="quotebox"><cite>tcherenato wrote:</cite><blockquote><p>Now hit the name!!!&nbsp; ;-)</p></blockquote></div><p>hehe&nbsp; <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink"/></p>											<p class="post-edited">(Last edited by <strong>Adze</strong> on 13 Aug 2013, 18:18)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p209701">
				<div class="post-metadata">
					<div class="post-num">Post #425</div>
					<div class="post-author">headless.cross</div>
					<div class="post-datetime">
						13 Aug 2013, 19:25					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>coltect wrote:</cite><blockquote><div class="quotebox"><cite>headless.cross wrote:</cite><blockquote><p>First of all I ran <strong>/etc/init.d/mwan3 restart</strong>, and it blew this one: <strong>iptables: Too many levels of symbolic links</strong>.</p></blockquote></div><p>I found the same error with iptables, It is due to you using &quot;wan&quot; as an interface name.&nbsp; If you change your wan interface name to wan0 or anything apart from wan it will work, or at least it will get past this problem.</p></blockquote></div><p>Thank you for the clarification. Before updating to the newest release, it worked like a charm (and works now, of course)!</p><br/><div class="quotebox"><cite>Adze wrote:</cite><blockquote><p>Above problem is fixed in version 1.2-18. Thank you for reporting!</p></blockquote></div><p>Thank you for fixing that! As stated above, I have already updated the binary and I finally figured out what is causing all those &quot;Connection Reset&quot; errors <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile"/>: I was running (successfully, with previous versions of mwan3) a transparent proxy (privoxy) for content filtering, just redirecting all http traffic at port 80, to internal 8118 (this is the port which privoxy is listening to). After disabling that redirect, no more &quot;Connection Reset&quot; errors (on port 80, of course), but no content filtering <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad"/>.</p><p>What info can I provide to investigate further the problem?</p><br/><p><strong>Edit</strong>: I just did again all the tests and the resulst is the same: When privoxy is running and the firewall rule redirects all http traffic on port 80 for filtering, the browser responds with &quot;Connection Reset&quot; error.</p>											<p class="post-edited">(Last edited by <strong>headless.cross</strong> on 13 Aug 2013, 21:04)</p>
									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 17 of 65</div><nav><ul><li><a href="viewtopic.php%3Fid=39052&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=15.html">15</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=16.html">16</a></li><li class="pagination-current"><span>17</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=18.html">18</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=19.html">19</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=65.html">65</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0.001 -->

</body>
</html>