<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> configuring router so that some devices completely bypass vpn [SOLVED]</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 13 Apr 2018 and 23 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 2</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=72112&amp;p=2.html">2</a></li></ul></nav></div>
			
		
		
			<article class="post" id="p365622">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">GNUser</div>
					<div class="post-datetime">
						21 Sep 2017, 03:20					</div>
				</div>
				<div class="post-content content">
					<p>I have openvpn running in my OpenWRT router so that all devices in my home network connect to internet through vpn.</p><p>The only other thing I need is to have two devices connected to the router NOT be behind the vpn: My Roku stick and a laptop that I&#039;d like to ssh to from work. Both of these devices have a static local ip address.</p><p>I&#039;ve tried the vpnbypass package and it works great for the Roku, but ssh&#039;ing to laptop just doesn&#039;t work while vpn is on, no matter what I try. I think the issue is that the vpnbypass package was designed with outgoing traffic in mind, but in the case of ssh the &quot;vpnbypass&quot; needs to be bidirectional.</p><p>I&#039;ve asked for help at the vpnbypass thread (at the LEDE forum), but I&#039;ve gotten nowhere and get the feeling that the thread just doesn&#039;t get a lot of eyeballs. I&#039;m frustrated enough that I&#039;m ready to ditch vpnbypass and try something else such as a boot script or manual firewall configuration. Problem is that I don&#039;t know enough about firewalls and routing to come up with the solution myself. </p><p>By the way, with vpn off and port forwarding configured I can ssh to the laptop from work just fine.</p><p>Please, I&#039;m willing to learn and experiment for hours if need be, but I&#039;ve run out of ideas and am just going around in circles at this point. Can anyone point me in the right direction?</p>											<p class="post-edited">(Last edited by <strong>GNUser</strong> on 23 Sep 2017, 23:34)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p365623">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">kelhgvrb</div>
					<div class="post-datetime">
						21 Sep 2017, 03:28					</div>
				</div>
				<div class="post-content content">
					<p>You can ssh into your devices using TOR. You dont need to bypass VPN. The devices are then simply available anonymously over xxxxxxxxxxxxx.onion .<br />You can use a Router in front of devices that you dont own (dont have the full code for those). In case of your laptop you probably can directly turn on ssh deamon and tor on the laptop itself.</p>											<p class="post-edited">(Last edited by <strong>kelhgvrb</strong> on 21 Sep 2017, 03:29)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p365625">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">GNUser</div>
					<div class="post-datetime">
						21 Sep 2017, 03:40					</div>
				</div>
				<div class="post-content content">
					<p>Wow, thanks for suggesting that. I never knew it was an option. I will try it out. (BTW, sshd is already running on the laptop, of course--it would just be a matter of figuring out the tor component.)</p><p>Nevertheless, I would still like to learn how to make the router allow ssh traffic to/from laptop to travel outside the vpn tunnel--after struggling with this for so many days, finding a more traditional solution would be quite satisfying <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>											<p class="post-edited">(Last edited by <strong>GNUser</strong> on 21 Sep 2017, 04:06)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p365641">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">ulmwind</div>
					<div class="post-datetime">
						21 Sep 2017, 17:51					</div>
				</div>
				<div class="post-content content">
					<p><strong>vpnbypass</strong> is wrapper for ipset and iptables. Please, post iptables rules, when port forwarding to internal IP doesn&#039;t work, and when it works without vpnbypass. It should work, we&#039;ll compare it.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p365644">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">GNUser</div>
					<div class="post-datetime">
						21 Sep 2017, 18:52					</div>
				</div>
				<div class="post-content content">
					<p>Thank you, ulmwind. I will post both. Before I do so, which command will output exactly what you want to see? Is it one (or more) of these, or something else?</p><div class="codebox"><pre><code>iptables -vL -t filter
iptables -vL -t nat
iptables -vL -t mangle
iptables -vL -t raw
iptables -vL -t security
iptables -S</code></pre></div><p>I don&#039;t know if it was clear before, but the laptop I want to connect to is at home, on vpnbypass subnet, has a static local ip, and port 22 is forwarded to it in the router. </p><p>EDIT: <br />I discovered something new: While I cannot connect to the laptop from any machine on my home network (regardless of whether the machine is bypassing vpn or not), I *am* able connect from *outside* my network. I hadnâ€™t tried connecting remotely because I usually test things out at home first.</p><p>I hope examining the iptables rules with and without openvpn+vpnbypass will explain this unexpected behavior.</p>											<p class="post-edited">(Last edited by <strong>GNUser</strong> on 21 Sep 2017, 21:56)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p365656">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">ulmwind</div>
					<div class="post-datetime">
						21 Sep 2017, 22:37					</div>
				</div>
				<div class="post-content content">
					<p>Let&#039;s start with<br /></p><div class="codebox"><pre><code>iptables -nvL
iptables -S</code></pre></div><p>It is strange, because both IP&#039;s are in the same LAN.</p>											<p class="post-edited">(Last edited by <strong>ulmwind</strong> on 21 Sep 2017, 22:37)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p365660">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">GNUser</div>
					<div class="post-datetime">
						22 Sep 2017, 00:10					</div>
				</div>
				<div class="post-content content">
					<p>I tried pasting the output in pastebin, but this forum is not allowing me to post links. So here they go:</p><p>When openvpn and vpnbypass are *disabled*, I can ssh to 192.168.10.61 *both* from lan and wan.<br />This is the output of iptables -nvL:<br /></p><div class="codebox"><pre><code>Chain INPUT (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination         
    0     0 ACCEPT     all  --  lo     *       0.0.0.0/0            0.0.0.0/0            ID:66773300
  471 47834 input_rule  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 /* user chain for input */
  348 35381 ACCEPT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 ctstate RELATED,ESTABLISHED
   26  2232 DROP       all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 ctstate INVALID
    3   144 syn_flood  tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 tcp flags:0x17/0x02
   80  8168 zone_lan_input  all  --  br-lan *       0.0.0.0/0            0.0.0.0/0            ID:66773300
   17  2053 zone_wan_input  all  --  eth1   *       0.0.0.0/0            0.0.0.0/0            ID:66773300

Chain FORWARD (policy DROP 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination         
 1823 1267K forwarding_rule  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 /* user chain for forwarding */
 1737 1259K ACCEPT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 ctstate RELATED,ESTABLISHED
    8  1400 DROP       all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 ctstate INVALID
   77  5696 zone_lan_forward  all  --  br-lan *       0.0.0.0/0            0.0.0.0/0            ID:66773300
    1    60 zone_wan_forward  all  --  eth1   *       0.0.0.0/0            0.0.0.0/0            ID:66773300
    0     0 reject     all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300

Chain OUTPUT (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination         
    0     0 ACCEPT     all  --  *      lo      0.0.0.0/0            0.0.0.0/0            ID:66773300
  317 48925 output_rule  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 /* user chain for output */
  245 42484 ACCEPT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 ctstate RELATED,ESTABLISHED
    0     0 DROP       all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 ctstate INVALID
    7  2039 zone_lan_output  all  --  *      br-lan  0.0.0.0/0            0.0.0.0/0            ID:66773300
   65  4402 zone_wan_output  all  --  *      eth1    0.0.0.0/0            0.0.0.0/0            ID:66773300

Chain forwarding_lan_rule (1 references)
 pkts bytes target     prot opt in     out     source               destination         

Chain forwarding_rule (1 references)
 pkts bytes target     prot opt in     out     source               destination         

Chain forwarding_wan_rule (1 references)
 pkts bytes target     prot opt in     out     source               destination         

Chain input_lan_rule (1 references)
 pkts bytes target     prot opt in     out     source               destination         

Chain input_rule (1 references)
 pkts bytes target     prot opt in     out     source               destination         

Chain input_wan_rule (1 references)
 pkts bytes target     prot opt in     out     source               destination         

Chain output_lan_rule (1 references)
 pkts bytes target     prot opt in     out     source               destination         

Chain output_rule (1 references)
 pkts bytes target     prot opt in     out     source               destination         

Chain output_wan_rule (1 references)
 pkts bytes target     prot opt in     out     source               destination         

Chain reject (3 references)
 pkts bytes target     prot opt in     out     source               destination         
    5   537 REJECT     tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 reject-with tcp-reset
   12  1516 REJECT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 reject-with icmp-port-unreachable

Chain syn_flood (1 references)
 pkts bytes target     prot opt in     out     source               destination         
    3   144 RETURN     tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 tcp flags:0x17/0x02 limit: avg 25/sec burst 50
    0     0 DROP       all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300

Chain zone_lan_dest_ACCEPT (4 references)
 pkts bytes target     prot opt in     out     source               destination         
    7  2039 ACCEPT     all  --  *      br-lan  0.0.0.0/0            0.0.0.0/0            ID:66773300

Chain zone_lan_forward (1 references)
 pkts bytes target     prot opt in     out     source               destination         
   77  5696 forwarding_lan_rule  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 /* user chain for forwarding */
   77  5696 zone_wan_dest_ACCEPT  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 /* forwarding lan -&gt; wan */
    1    60 ACCEPT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 ctstate DNAT /* Accept port forwards */
    0     0 zone_lan_dest_ACCEPT  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300

Chain zone_lan_input (1 references)
 pkts bytes target     prot opt in     out     source               destination         
   80  8168 input_lan_rule  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 /* user chain for input */
    0     0 ACCEPT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 ctstate DNAT /* Accept port redirections */
   80  8168 zone_lan_src_ACCEPT  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300

Chain zone_lan_output (1 references)
 pkts bytes target     prot opt in     out     source               destination         
    7  2039 output_lan_rule  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 /* user chain for output */
    7  2039 zone_lan_dest_ACCEPT  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300

Chain zone_lan_src_ACCEPT (1 references)
 pkts bytes target     prot opt in     out     source               destination         
   80  8168 ACCEPT     all  --  br-lan *       0.0.0.0/0            0.0.0.0/0            ID:66773300

Chain zone_wan_dest_ACCEPT (2 references)
 pkts bytes target     prot opt in     out     source               destination         
  141 10038 ACCEPT     all  --  *      eth1    0.0.0.0/0            0.0.0.0/0            ID:66773300

Chain zone_wan_dest_REJECT (1 references)
 pkts bytes target     prot opt in     out     source               destination         
    0     0 reject     all  --  *      eth1    0.0.0.0/0            0.0.0.0/0            ID:66773300

Chain zone_wan_forward (1 references)
 pkts bytes target     prot opt in     out     source               destination         
    1    60 forwarding_wan_rule  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 /* user chain for forwarding */
    0     0 zone_lan_dest_ACCEPT  esp  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 /* @rule[7] */
    0     0 zone_lan_dest_ACCEPT  udp  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 udp dpt:500 /* @rule[8] */
    1    60 ACCEPT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 ctstate DNAT /* Accept port forwards */
    0     0 zone_wan_dest_REJECT  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300

Chain zone_wan_input (1 references)
 pkts bytes target     prot opt in     out     source               destination         
   17  2053 input_wan_rule  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 /* user chain for input */
    0     0 ACCEPT     udp  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 udp dpt:68 /* Allow-DHCP-Renew */
    0     0 ACCEPT     icmp --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 icmptype 8 /* Allow-Ping */
    0     0 ACCEPT     2    --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 /* Allow-IGMP */
    0     0 ACCEPT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 ctstate DNAT /* Accept port redirections */
   17  2053 zone_wan_src_REJECT  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300

Chain zone_wan_output (1 references)
 pkts bytes target     prot opt in     out     source               destination         
   65  4402 output_wan_rule  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 /* user chain for output */
   65  4402 zone_wan_dest_ACCEPT  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300

Chain zone_wan_src_REJECT (1 references)
 pkts bytes target     prot opt in     out     source               destination         
   17  2053 reject     all  --  eth1   *       0.0.0.0/0            0.0.0.0/0            ID:66773300</code></pre></div><p>And this is the output of iptables -S:<br /></p><div class="codebox"><pre><code>-P INPUT ACCEPT
-P FORWARD DROP
-P OUTPUT ACCEPT
-N forwarding_lan_rule
-N forwarding_rule
-N forwarding_wan_rule
-N input_lan_rule
-N input_rule
-N input_wan_rule
-N output_lan_rule
-N output_rule
-N output_wan_rule
-N reject
-N syn_flood
-N zone_lan_dest_ACCEPT
-N zone_lan_forward
-N zone_lan_input
-N zone_lan_output
-N zone_lan_src_ACCEPT
-N zone_wan_dest_ACCEPT
-N zone_wan_dest_REJECT
-N zone_wan_forward
-N zone_wan_input
-N zone_wan_output
-N zone_wan_src_REJECT
-A INPUT -i lo -m id --id 0x66773300 -j ACCEPT
-A INPUT -m id --id 0x66773300 -m comment --comment &quot;user chain for input&quot; -j input_rule
-A INPUT -m id --id 0x66773300 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A INPUT -m id --id 0x66773300 -m conntrack --ctstate INVALID -j DROP
-A INPUT -p tcp -m id --id 0x66773300 -m tcp --tcp-flags FIN,SYN,RST,ACK SYN -j syn_flood
-A INPUT -i br-lan -m id --id 0x66773300 -j zone_lan_input
-A INPUT -i eth1 -m id --id 0x66773300 -j zone_wan_input
-A FORWARD -m id --id 0x66773300 -m comment --comment &quot;user chain for forwarding&quot; -j forwarding_rule
-A FORWARD -m id --id 0x66773300 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A FORWARD -m id --id 0x66773300 -m conntrack --ctstate INVALID -j DROP
-A FORWARD -i br-lan -m id --id 0x66773300 -j zone_lan_forward
-A FORWARD -i eth1 -m id --id 0x66773300 -j zone_wan_forward
-A FORWARD -m id --id 0x66773300 -j reject
-A OUTPUT -o lo -m id --id 0x66773300 -j ACCEPT
-A OUTPUT -m id --id 0x66773300 -m comment --comment &quot;user chain for output&quot; -j output_rule
-A OUTPUT -m id --id 0x66773300 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A OUTPUT -m id --id 0x66773300 -m conntrack --ctstate INVALID -j DROP
-A OUTPUT -o br-lan -m id --id 0x66773300 -j zone_lan_output
-A OUTPUT -o eth1 -m id --id 0x66773300 -j zone_wan_output
-A reject -p tcp -m id --id 0x66773300 -j REJECT --reject-with tcp-reset
-A reject -m id --id 0x66773300 -j REJECT --reject-with icmp-port-unreachable
-A syn_flood -p tcp -m id --id 0x66773300 -m tcp --tcp-flags FIN,SYN,RST,ACK SYN -m limit --limit 25/sec --limit-burst 50 -j RETURN
-A syn_flood -m id --id 0x66773300 -j DROP
-A zone_lan_dest_ACCEPT -o br-lan -m id --id 0x66773300 -j ACCEPT
-A zone_lan_forward -m id --id 0x66773300 -m comment --comment &quot;user chain for forwarding&quot; -j forwarding_lan_rule
-A zone_lan_forward -m id --id 0x66773300 -m comment --comment &quot;forwarding lan -&gt; wan&quot; -j zone_wan_dest_ACCEPT
-A zone_lan_forward -m id --id 0x66773300 -m conntrack --ctstate DNAT -m comment --comment &quot;Accept port forwards&quot; -j ACCEPT
-A zone_lan_forward -m id --id 0x66773300 -j zone_lan_dest_ACCEPT
-A zone_lan_input -m id --id 0x66773300 -m comment --comment &quot;user chain for input&quot; -j input_lan_rule
-A zone_lan_input -m id --id 0x66773300 -m conntrack --ctstate DNAT -m comment --comment &quot;Accept port redirections&quot; -j ACCEPT
-A zone_lan_input -m id --id 0x66773300 -j zone_lan_src_ACCEPT
-A zone_lan_output -m id --id 0x66773300 -m comment --comment &quot;user chain for output&quot; -j output_lan_rule
-A zone_lan_output -m id --id 0x66773300 -j zone_lan_dest_ACCEPT
-A zone_lan_src_ACCEPT -i br-lan -m id --id 0x66773300 -j ACCEPT
-A zone_wan_dest_ACCEPT -o eth1 -m id --id 0x66773300 -j ACCEPT
-A zone_wan_dest_REJECT -o eth1 -m id --id 0x66773300 -j reject
-A zone_wan_forward -m id --id 0x66773300 -m comment --comment &quot;user chain for forwarding&quot; -j forwarding_wan_rule
-A zone_wan_forward -p esp -m id --id 0x66773300 -m comment --comment &quot;@rule[7]&quot; -j zone_lan_dest_ACCEPT
-A zone_wan_forward -p udp -m id --id 0x66773300 -m udp --dport 500 -m comment --comment &quot;@rule[8]&quot; -j zone_lan_dest_ACCEPT
-A zone_wan_forward -m id --id 0x66773300 -m conntrack --ctstate DNAT -m comment --comment &quot;Accept port forwards&quot; -j ACCEPT
-A zone_wan_forward -m id --id 0x66773300 -j zone_wan_dest_REJECT
-A zone_wan_input -m id --id 0x66773300 -m comment --comment &quot;user chain for input&quot; -j input_wan_rule
-A zone_wan_input -p udp -m id --id 0x66773300 -m udp --dport 68 -m comment --comment Allow-DHCP-Renew -j ACCEPT
-A zone_wan_input -p icmp -m id --id 0x66773300 -m icmp --icmp-type 8 -m comment --comment Allow-Ping -j ACCEPT
-A zone_wan_input -p igmp -m id --id 0x66773300 -m comment --comment Allow-IGMP -j ACCEPT
-A zone_wan_input -m id --id 0x66773300 -m conntrack --ctstate DNAT -m comment --comment &quot;Accept port redirections&quot; -j ACCEPT
-A zone_wan_input -m id --id 0x66773300 -j zone_wan_src_REJECT
-A zone_wan_output -m id --id 0x66773300 -m comment --comment &quot;user chain for output&quot; -j output_wan_rule
-A zone_wan_output -m id --id 0x66773300 -j zone_wan_dest_ACCEPT
-A zone_wan_src_REJECT -i eth1 -m id --id 0x66773300 -j reject</code></pre></div>											<p class="post-edited">(Last edited by <strong>GNUser</strong> on 22 Sep 2017, 00:12)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p365661">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">GNUser</div>
					<div class="post-datetime">
						22 Sep 2017, 00:11					</div>
				</div>
				<div class="post-content content">
					<p>When openvpn and vpnbypass are *enabled*, I can ssh to 192.168.10.61 *only* from wan, not from lan.<br />This is the output of iptables -nvL:<br /></p><div class="codebox"><pre><code>Chain INPUT (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination         
    0     0 ACCEPT     all  --  lo     *       0.0.0.0/0            0.0.0.0/0            ID:66773300
  520 67548 input_rule  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 /* user chain for input */
  427 58234 ACCEPT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 ctstate RELATED,ESTABLISHED
    9   444 DROP       all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 ctstate INVALID
    4   180 syn_flood  tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 tcp flags:0x17/0x02
   53  4390 zone_lan_input  all  --  br-lan *       0.0.0.0/0            0.0.0.0/0            ID:66773300
   31  4480 zone_wan_input  all  --  eth1   *       0.0.0.0/0            0.0.0.0/0            ID:66773300
    0     0 zone_VPN_input  all  --  tun0   *       0.0.0.0/0            0.0.0.0/0            ID:66773300

Chain FORWARD (policy DROP 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination         
  376 59590 forwarding_rule  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 /* user chain for forwarding */
  329 55537 ACCEPT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 ctstate RELATED,ESTABLISHED
    0     0 DROP       all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 ctstate INVALID
   46  3993 zone_lan_forward  all  --  br-lan *       0.0.0.0/0            0.0.0.0/0            ID:66773300
    1    60 zone_wan_forward  all  --  eth1   *       0.0.0.0/0            0.0.0.0/0            ID:66773300
    0     0 zone_VPN_forward  all  --  tun0   *       0.0.0.0/0            0.0.0.0/0            ID:66773300
    0     0 reject     all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300

Chain OUTPUT (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination         
    0     0 ACCEPT     all  --  *      lo      0.0.0.0/0            0.0.0.0/0            ID:66773300
  455 92458 output_rule  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 /* user chain for output */
  402 88562 ACCEPT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 ctstate RELATED,ESTABLISHED
    0     0 DROP       all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 ctstate INVALID
    1   335 zone_lan_output  all  --  *      br-lan  0.0.0.0/0            0.0.0.0/0            ID:66773300
    0     0 zone_wan_output  all  --  *      eth1    0.0.0.0/0            0.0.0.0/0            ID:66773300
   52  3561 zone_VPN_output  all  --  *      tun0    0.0.0.0/0            0.0.0.0/0            ID:66773300

Chain forwarding_VPN_rule (1 references)
 pkts bytes target     prot opt in     out     source               destination         

Chain forwarding_lan_rule (1 references)
 pkts bytes target     prot opt in     out     source               destination         

Chain forwarding_rule (1 references)
 pkts bytes target     prot opt in     out     source               destination         

Chain forwarding_wan_rule (1 references)
 pkts bytes target     prot opt in     out     source               destination         

Chain input_VPN_rule (1 references)
 pkts bytes target     prot opt in     out     source               destination         

Chain input_lan_rule (1 references)
 pkts bytes target     prot opt in     out     source               destination         

Chain input_rule (1 references)
 pkts bytes target     prot opt in     out     source               destination         

Chain input_wan_rule (1 references)
 pkts bytes target     prot opt in     out     source               destination         

Chain output_VPN_rule (1 references)
 pkts bytes target     prot opt in     out     source               destination         

Chain output_lan_rule (1 references)
 pkts bytes target     prot opt in     out     source               destination         

Chain output_rule (1 references)
 pkts bytes target     prot opt in     out     source               destination         

Chain output_wan_rule (1 references)
 pkts bytes target     prot opt in     out     source               destination         

Chain reject (5 references)
 pkts bytes target     prot opt in     out     source               destination         
   13  2390 REJECT     tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 reject-with tcp-reset
   18  2090 REJECT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 reject-with icmp-port-unreachable

Chain syn_flood (1 references)
 pkts bytes target     prot opt in     out     source               destination         
    4   180 RETURN     tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 tcp flags:0x17/0x02 limit: avg 25/sec burst 50
    0     0 DROP       all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300

Chain zone_VPN_dest_ACCEPT (2 references)
 pkts bytes target     prot opt in     out     source               destination         
   70  5626 ACCEPT     all  --  *      tun0    0.0.0.0/0            0.0.0.0/0            ID:66773300

Chain zone_VPN_dest_REJECT (1 references)
 pkts bytes target     prot opt in     out     source               destination         
    0     0 reject     all  --  *      tun0    0.0.0.0/0            0.0.0.0/0            ID:66773300

Chain zone_VPN_forward (1 references)
 pkts bytes target     prot opt in     out     source               destination         
    0     0 forwarding_VPN_rule  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 /* user chain for forwarding */
    0     0 ACCEPT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 ctstate DNAT /* Accept port forwards */
    0     0 zone_VPN_dest_REJECT  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300

Chain zone_VPN_input (1 references)
 pkts bytes target     prot opt in     out     source               destination         
    0     0 input_VPN_rule  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 /* user chain for input */
    0     0 ACCEPT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 ctstate DNAT /* Accept port redirections */
    0     0 zone_VPN_src_REJECT  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300

Chain zone_VPN_output (1 references)
 pkts bytes target     prot opt in     out     source               destination         
   52  3561 output_VPN_rule  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 /* user chain for output */
   52  3561 zone_VPN_dest_ACCEPT  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300

Chain zone_VPN_src_REJECT (1 references)
 pkts bytes target     prot opt in     out     source               destination         
    0     0 reject     all  --  tun0   *       0.0.0.0/0            0.0.0.0/0            ID:66773300

Chain zone_lan_dest_ACCEPT (4 references)
 pkts bytes target     prot opt in     out     source               destination         
    1   335 ACCEPT     all  --  *      br-lan  0.0.0.0/0            0.0.0.0/0            ID:66773300

Chain zone_lan_forward (1 references)
 pkts bytes target     prot opt in     out     source               destination         
   46  3993 forwarding_lan_rule  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 /* user chain for forwarding */
   46  3993 zone_wan_dest_ACCEPT  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 /* forwarding lan -&gt; wan */
   18  2065 zone_VPN_dest_ACCEPT  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 /* forwarding lan -&gt; VPN */
    0     0 ACCEPT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 ctstate DNAT /* Accept port forwards */
    0     0 zone_lan_dest_ACCEPT  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300

Chain zone_lan_input (1 references)
 pkts bytes target     prot opt in     out     source               destination         
   53  4390 input_lan_rule  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 /* user chain for input */
    0     0 ACCEPT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 ctstate DNAT /* Accept port redirections */
   53  4390 zone_lan_src_ACCEPT  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300

Chain zone_lan_output (1 references)
 pkts bytes target     prot opt in     out     source               destination         
    1   335 output_lan_rule  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 /* user chain for output */
    1   335 zone_lan_dest_ACCEPT  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300

Chain zone_lan_src_ACCEPT (1 references)
 pkts bytes target     prot opt in     out     source               destination         
   53  4390 ACCEPT     all  --  br-lan *       0.0.0.0/0            0.0.0.0/0            ID:66773300

Chain zone_wan_dest_ACCEPT (2 references)
 pkts bytes target     prot opt in     out     source               destination         
   28  1928 ACCEPT     all  --  *      eth1    0.0.0.0/0            0.0.0.0/0            ID:66773300

Chain zone_wan_dest_REJECT (1 references)
 pkts bytes target     prot opt in     out     source               destination         
    0     0 reject     all  --  *      eth1    0.0.0.0/0            0.0.0.0/0            ID:66773300

Chain zone_wan_forward (1 references)
 pkts bytes target     prot opt in     out     source               destination         
    1    60 forwarding_wan_rule  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 /* user chain for forwarding */
    0     0 zone_lan_dest_ACCEPT  esp  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 /* @rule[7] */
    0     0 zone_lan_dest_ACCEPT  udp  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 udp dpt:500 /* @rule[8] */
    1    60 ACCEPT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 ctstate DNAT /* Accept port forwards */
    0     0 zone_wan_dest_REJECT  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300

Chain zone_wan_input (1 references)
 pkts bytes target     prot opt in     out     source               destination         
   31  4480 input_wan_rule  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 /* user chain for input */
    0     0 ACCEPT     udp  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 udp dpt:68 /* Allow-DHCP-Renew */
    0     0 ACCEPT     icmp --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 icmptype 8 /* Allow-Ping */
    0     0 ACCEPT     2    --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 /* Allow-IGMP */
    0     0 ACCEPT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 ctstate DNAT /* Accept port redirections */
   31  4480 zone_wan_src_REJECT  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300

Chain zone_wan_output (1 references)
 pkts bytes target     prot opt in     out     source               destination         
    0     0 output_wan_rule  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 /* user chain for output */
    0     0 zone_wan_dest_ACCEPT  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300

Chain zone_wan_src_REJECT (1 references)
 pkts bytes target     prot opt in     out     source               destination         
   31  4480 reject     all  --  eth1   *       0.0.0.0/0            0.0.0.0/0            ID:66773300</code></pre></div><p>And this is the output of iptables -S:<br /></p><div class="codebox"><pre><code>-P INPUT ACCEPT
-P FORWARD DROP
-P OUTPUT ACCEPT
-N forwarding_VPN_rule
-N forwarding_lan_rule
-N forwarding_rule
-N forwarding_wan_rule
-N input_VPN_rule
-N input_lan_rule
-N input_rule
-N input_wan_rule
-N output_VPN_rule
-N output_lan_rule
-N output_rule
-N output_wan_rule
-N reject
-N syn_flood
-N zone_VPN_dest_ACCEPT
-N zone_VPN_dest_REJECT
-N zone_VPN_forward
-N zone_VPN_input
-N zone_VPN_output
-N zone_VPN_src_REJECT
-N zone_lan_dest_ACCEPT
-N zone_lan_forward
-N zone_lan_input
-N zone_lan_output
-N zone_lan_src_ACCEPT
-N zone_wan_dest_ACCEPT
-N zone_wan_dest_REJECT
-N zone_wan_forward
-N zone_wan_input
-N zone_wan_output
-N zone_wan_src_REJECT
-A INPUT -i lo -m id --id 0x66773300 -j ACCEPT
-A INPUT -m id --id 0x66773300 -m comment --comment &quot;user chain for input&quot; -j input_rule
-A INPUT -m id --id 0x66773300 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A INPUT -m id --id 0x66773300 -m conntrack --ctstate INVALID -j DROP
-A INPUT -p tcp -m id --id 0x66773300 -m tcp --tcp-flags FIN,SYN,RST,ACK SYN -j syn_flood
-A INPUT -i br-lan -m id --id 0x66773300 -j zone_lan_input
-A INPUT -i eth1 -m id --id 0x66773300 -j zone_wan_input
-A INPUT -i tun0 -m id --id 0x66773300 -j zone_VPN_input
-A FORWARD -m id --id 0x66773300 -m comment --comment &quot;user chain for forwarding&quot; -j forwarding_rule
-A FORWARD -m id --id 0x66773300 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A FORWARD -m id --id 0x66773300 -m conntrack --ctstate INVALID -j DROP
-A FORWARD -i br-lan -m id --id 0x66773300 -j zone_lan_forward
-A FORWARD -i eth1 -m id --id 0x66773300 -j zone_wan_forward
-A FORWARD -i tun0 -m id --id 0x66773300 -j zone_VPN_forward
-A FORWARD -m id --id 0x66773300 -j reject
-A OUTPUT -o lo -m id --id 0x66773300 -j ACCEPT
-A OUTPUT -m id --id 0x66773300 -m comment --comment &quot;user chain for output&quot; -j output_rule
-A OUTPUT -m id --id 0x66773300 -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A OUTPUT -m id --id 0x66773300 -m conntrack --ctstate INVALID -j DROP
-A OUTPUT -o br-lan -m id --id 0x66773300 -j zone_lan_output
-A OUTPUT -o eth1 -m id --id 0x66773300 -j zone_wan_output
-A OUTPUT -o tun0 -m id --id 0x66773300 -j zone_VPN_output
-A reject -p tcp -m id --id 0x66773300 -j REJECT --reject-with tcp-reset
-A reject -m id --id 0x66773300 -j REJECT --reject-with icmp-port-unreachable
-A syn_flood -p tcp -m id --id 0x66773300 -m tcp --tcp-flags FIN,SYN,RST,ACK SYN -m limit --limit 25/sec --limit-burst 50 -j RETURN
-A syn_flood -m id --id 0x66773300 -j DROP
-A zone_VPN_dest_ACCEPT -o tun0 -m id --id 0x66773300 -j ACCEPT
-A zone_VPN_dest_REJECT -o tun0 -m id --id 0x66773300 -j reject
-A zone_VPN_forward -m id --id 0x66773300 -m comment --comment &quot;user chain for forwarding&quot; -j forwarding_VPN_rule
-A zone_VPN_forward -m id --id 0x66773300 -m conntrack --ctstate DNAT -m comment --comment &quot;Accept port forwards&quot; -j ACCEPT
-A zone_VPN_forward -m id --id 0x66773300 -j zone_VPN_dest_REJECT
-A zone_VPN_input -m id --id 0x66773300 -m comment --comment &quot;user chain for input&quot; -j input_VPN_rule
-A zone_VPN_input -m id --id 0x66773300 -m conntrack --ctstate DNAT -m comment --comment &quot;Accept port redirections&quot; -j ACCEPT
-A zone_VPN_input -m id --id 0x66773300 -j zone_VPN_src_REJECT
-A zone_VPN_output -m id --id 0x66773300 -m comment --comment &quot;user chain for output&quot; -j output_VPN_rule
-A zone_VPN_output -m id --id 0x66773300 -j zone_VPN_dest_ACCEPT
-A zone_VPN_src_REJECT -i tun0 -m id --id 0x66773300 -j reject
-A zone_lan_dest_ACCEPT -o br-lan -m id --id 0x66773300 -j ACCEPT
-A zone_lan_forward -m id --id 0x66773300 -m comment --comment &quot;user chain for forwarding&quot; -j forwarding_lan_rule
-A zone_lan_forward -m id --id 0x66773300 -m comment --comment &quot;forwarding lan -&gt; wan&quot; -j zone_wan_dest_ACCEPT
-A zone_lan_forward -m id --id 0x66773300 -m comment --comment &quot;forwarding lan -&gt; VPN&quot; -j zone_VPN_dest_ACCEPT
-A zone_lan_forward -m id --id 0x66773300 -m conntrack --ctstate DNAT -m comment --comment &quot;Accept port forwards&quot; -j ACCEPT
-A zone_lan_forward -m id --id 0x66773300 -j zone_lan_dest_ACCEPT
-A zone_lan_input -m id --id 0x66773300 -m comment --comment &quot;user chain for input&quot; -j input_lan_rule
-A zone_lan_input -m id --id 0x66773300 -m conntrack --ctstate DNAT -m comment --comment &quot;Accept port redirections&quot; -j ACCEPT
-A zone_lan_input -m id --id 0x66773300 -j zone_lan_src_ACCEPT
-A zone_lan_output -m id --id 0x66773300 -m comment --comment &quot;user chain for output&quot; -j output_lan_rule
-A zone_lan_output -m id --id 0x66773300 -j zone_lan_dest_ACCEPT
-A zone_lan_src_ACCEPT -i br-lan -m id --id 0x66773300 -j ACCEPT
-A zone_wan_dest_ACCEPT -o eth1 -m id --id 0x66773300 -j ACCEPT
-A zone_wan_dest_REJECT -o eth1 -m id --id 0x66773300 -j reject
-A zone_wan_forward -m id --id 0x66773300 -m comment --comment &quot;user chain for forwarding&quot; -j forwarding_wan_rule
-A zone_wan_forward -p esp -m id --id 0x66773300 -m comment --comment &quot;@rule[7]&quot; -j zone_lan_dest_ACCEPT
-A zone_wan_forward -p udp -m id --id 0x66773300 -m udp --dport 500 -m comment --comment &quot;@rule[8]&quot; -j zone_lan_dest_ACCEPT
-A zone_wan_forward -m id --id 0x66773300 -m conntrack --ctstate DNAT -m comment --comment &quot;Accept port forwards&quot; -j ACCEPT
-A zone_wan_forward -m id --id 0x66773300 -j zone_wan_dest_REJECT
-A zone_wan_input -m id --id 0x66773300 -m comment --comment &quot;user chain for input&quot; -j input_wan_rule
-A zone_wan_input -p udp -m id --id 0x66773300 -m udp --dport 68 -m comment --comment Allow-DHCP-Renew -j ACCEPT
-A zone_wan_input -p icmp -m id --id 0x66773300 -m icmp --icmp-type 8 -m comment --comment Allow-Ping -j ACCEPT
-A zone_wan_input -p igmp -m id --id 0x66773300 -m comment --comment Allow-IGMP -j ACCEPT
-A zone_wan_input -m id --id 0x66773300 -m conntrack --ctstate DNAT -m comment --comment &quot;Accept port redirections&quot; -j ACCEPT
-A zone_wan_input -m id --id 0x66773300 -j zone_wan_src_REJECT
-A zone_wan_output -m id --id 0x66773300 -m comment --comment &quot;user chain for output&quot; -j output_wan_rule
-A zone_wan_output -m id --id 0x66773300 -j zone_wan_dest_ACCEPT
-A zone_wan_src_REJECT -i eth1 -m id --id 0x66773300 -j reject</code></pre></div>											<p class="post-edited">(Last edited by <strong>GNUser</strong> on 22 Sep 2017, 00:13)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p365685">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">ulmwind</div>
					<div class="post-datetime">
						22 Sep 2017, 10:58					</div>
				</div>
				<div class="post-content content">
					<p>Ok, I can&#039;t see ipset in the rules. I can see new chains for VPN zone, but neither ipsets nor redirections. No ip. It is interesting. Let&#039;s continue. Post output of:<br /></p><div class="codebox"><pre><code>ipset list
iptables -nvL -t mangle
iptables -nvL -t nat</code></pre></div>											<p class="post-edited">(Last edited by <strong>ulmwind</strong> on 22 Sep 2017, 10:59)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p365691">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">GNUser</div>
					<div class="post-datetime">
						22 Sep 2017, 14:26					</div>
				</div>
				<div class="post-content content">
					<p>Thank you for your help so far, ulmwind. This seems pretty intense.</p><p>Ok, so first the outputs when openvpn/vpnbypass are disabled and everything works as expected.</p><p>ipset list produces no output</p><div class="codebox"><pre><code># iptables -nvL -t mangle
Chain PREROUTING (policy ACCEPT 730 packets, 105K bytes)
 pkts bytes target     prot opt in     out     source               destination         

Chain INPUT (policy ACCEPT 491 packets, 38223 bytes)
 pkts bytes target     prot opt in     out     source               destination         

Chain FORWARD (policy ACCEPT 228 packets, 55870 bytes)
 pkts bytes target     prot opt in     out     source               destination         
    9   540 TCPMSS     tcp  --  *      eth1    0.0.0.0/0            0.0.0.0/0            ID:66773300 tcp flags:0x06/0x02 /* wan (mtu_fix) */ TCPMSS clamp to PMTU

Chain OUTPUT (policy ACCEPT 255 packets, 33689 bytes)
 pkts bytes target     prot opt in     out     source               destination         

Chain POSTROUTING (policy ACCEPT 481 packets, 89383 bytes)
 pkts bytes target     prot opt in     out     source               destination         </code></pre></div><div class="codebox"><pre><code># iptables -nvL -t nat
Chain PREROUTING (policy ACCEPT 60 packets, 16296 bytes)
 pkts bytes target     prot opt in     out     source               destination         
   61 16356 prerouting_rule  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 /* user chain for prerouting */
   35 13138 zone_lan_prerouting  all  --  br-lan *       0.0.0.0/0            0.0.0.0/0            ID:66773300
   26  3218 zone_wan_prerouting  all  --  eth1   *       0.0.0.0/0            0.0.0.0/0            ID:66773300

Chain INPUT (policy ACCEPT 3 packets, 317 bytes)
 pkts bytes target     prot opt in     out     source               destination         

Chain OUTPUT (policy ACCEPT 28 packets, 2078 bytes)
 pkts bytes target     prot opt in     out     source               destination         

Chain POSTROUTING (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination         
   49  3714 postrouting_rule  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 /* user chain for postrouting */
    1    60 zone_lan_postrouting  all  --  *      br-lan  0.0.0.0/0            0.0.0.0/0            ID:66773300
   48  3654 zone_wan_postrouting  all  --  *      eth1    0.0.0.0/0            0.0.0.0/0            ID:66773300

Chain postrouting_lan_rule (1 references)
 pkts bytes target     prot opt in     out     source               destination         

Chain postrouting_rule (1 references)
 pkts bytes target     prot opt in     out     source               destination         

Chain postrouting_wan_rule (1 references)
 pkts bytes target     prot opt in     out     source               destination         

Chain prerouting_lan_rule (1 references)
 pkts bytes target     prot opt in     out     source               destination         

Chain prerouting_rule (1 references)
 pkts bytes target     prot opt in     out     source               destination         

Chain prerouting_wan_rule (1 references)
 pkts bytes target     prot opt in     out     source               destination         

Chain zone_lan_postrouting (1 references)
 pkts bytes target     prot opt in     out     source               destination         
    1    60 postrouting_lan_rule  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 /* user chain for postrouting */
    0     0 SNAT       tcp  --  *      *       192.168.10.0/24      192.168.10.61        ID:66773300 tcp dpt:5500 /* bruno port forwarding (reflection) */ to:192.168.10.1
    1    60 SNAT       tcp  --  *      *       192.168.10.0/24      192.168.10.61        ID:66773300 tcp dpt:22 /* bruno port forwarding 2 (reflection) */ to:192.168.10.1

Chain zone_lan_prerouting (1 references)
 pkts bytes target     prot opt in     out     source               destination         
   35 13138 prerouting_lan_rule  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 /* user chain for prerouting */
    0     0 DNAT       tcp  --  *      *       192.168.10.0/24      73.226.70.41         ID:66773300 tcp dpt:5500 /* bruno port forwarding (reflection) */ to:192.168.10.61:5500
    1    60 DNAT       tcp  --  *      *       192.168.10.0/24      73.226.70.41         ID:66773300 tcp dpt:22 /* bruno port forwarding 2 (reflection) */ to:192.168.10.61:22

Chain zone_wan_postrouting (1 references)
 pkts bytes target     prot opt in     out     source               destination         
   48  3654 postrouting_wan_rule  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 /* user chain for postrouting */
   48  3654 MASQUERADE  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300

Chain zone_wan_prerouting (1 references)
 pkts bytes target     prot opt in     out     source               destination         
   26  3218 prerouting_wan_rule  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 /* user chain for prerouting */
    0     0 DNAT       tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 tcp dpt:5500 /* bruno port forwarding */ to:192.168.10.61:5500
    0     0 DNAT       tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 tcp dpt:22 /* bruno port forwarding 2 */ to:192.168.10.61:22</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p365692">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">GNUser</div>
					<div class="post-datetime">
						22 Sep 2017, 14:30					</div>
				</div>
				<div class="post-content content">
					<p>And here are the outputs when openvpn/vpnbypass are on, when I can&#039;t ssh to 192.168.10.61 from lan:</p><div class="codebox"><pre><code># ipset list
Name: vpnbypass
Type: hash:ip
Revision: 4
Header: family inet hashsize 1024 maxelem 65536
Size in memory: 8248
References: 0
Members:</code></pre></div><div class="codebox"><pre><code># iptables -nvL -t mangle
Chain PREROUTING (policy ACCEPT 539 packets, 76579 bytes)
 pkts bytes target     prot opt in     out     source               destination         
  730  130K VPNBYPASS  all  --  *      *       0.0.0.0/0            0.0.0.0/0           [goto]  mark match 0x0/0xff0000

Chain INPUT (policy ACCEPT 400 packets, 44108 bytes)
 pkts bytes target     prot opt in     out     source               destination         

Chain FORWARD (policy ACCEPT 131 packets, 21735 bytes)
 pkts bytes target     prot opt in     out     source               destination         
   11   660 TCPMSS     tcp  --  *      eth1    0.0.0.0/0            0.0.0.0/0            ID:66773300 tcp flags:0x06/0x02 /* wan (mtu_fix) */ TCPMSS clamp to PMTU
    1    60 TCPMSS     tcp  --  *      tun0    0.0.0.0/0            0.0.0.0/0            ID:66773300 tcp flags:0x06/0x02 /* VPN (mtu_fix) */ TCPMSS clamp to PMTU

Chain OUTPUT (policy ACCEPT 288 packets, 39333 bytes)
 pkts bytes target     prot opt in     out     source               destination         

Chain POSTROUTING (policy ACCEPT 417 packets, 60892 bytes)
 pkts bytes target     prot opt in     out     source               destination         

Chain VPNBYPASS (1 references)
 pkts bytes target     prot opt in     out     source               destination         
  309 32250 MARK       all  --  *      *       192.168.10.56/29     0.0.0.0/0            MARK xset 0x10000/0xff0000</code></pre></div><div class="codebox"><pre><code># iptables -nvL -t nat
Chain PREROUTING (policy ACCEPT 95 packets, 21962 bytes)
 pkts bytes target     prot opt in     out     source               destination         
   97 22082 prerouting_rule  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 /* user chain for prerouting */
   39 13399 zone_lan_prerouting  all  --  br-lan *       0.0.0.0/0            0.0.0.0/0            ID:66773300
   58  8683 zone_wan_prerouting  all  --  eth1   *       0.0.0.0/0            0.0.0.0/0            ID:66773300
    0     0 zone_VPN_prerouting  all  --  tun0   *       0.0.0.0/0            0.0.0.0/0            ID:66773300

Chain INPUT (policy ACCEPT 6 packets, 814 bytes)
 pkts bytes target     prot opt in     out     source               destination         

Chain OUTPUT (policy ACCEPT 37 packets, 2894 bytes)
 pkts bytes target     prot opt in     out     source               destination         

Chain POSTROUTING (policy ACCEPT 3 packets, 436 bytes)
 pkts bytes target     prot opt in     out     source               destination         
   68  5294 postrouting_rule  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 /* user chain for postrouting */
    4   496 zone_lan_postrouting  all  --  *      br-lan  0.0.0.0/0            0.0.0.0/0            ID:66773300
   14  1038 zone_wan_postrouting  all  --  *      eth1    0.0.0.0/0            0.0.0.0/0            ID:66773300
   50  3760 zone_VPN_postrouting  all  --  *      tun0    0.0.0.0/0            0.0.0.0/0            ID:66773300

Chain postrouting_VPN_rule (1 references)
 pkts bytes target     prot opt in     out     source               destination         

Chain postrouting_lan_rule (1 references)
 pkts bytes target     prot opt in     out     source               destination         

Chain postrouting_rule (1 references)
 pkts bytes target     prot opt in     out     source               destination         

Chain postrouting_wan_rule (1 references)
 pkts bytes target     prot opt in     out     source               destination         

Chain prerouting_VPN_rule (1 references)
 pkts bytes target     prot opt in     out     source               destination         

Chain prerouting_lan_rule (1 references)
 pkts bytes target     prot opt in     out     source               destination         

Chain prerouting_rule (1 references)
 pkts bytes target     prot opt in     out     source               destination         

Chain prerouting_wan_rule (1 references)
 pkts bytes target     prot opt in     out     source               destination         

Chain zone_VPN_postrouting (1 references)
 pkts bytes target     prot opt in     out     source               destination         
   50  3760 postrouting_VPN_rule  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 /* user chain for postrouting */
   50  3760 MASQUERADE  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300

Chain zone_VPN_prerouting (1 references)
 pkts bytes target     prot opt in     out     source               destination         
    0     0 prerouting_VPN_rule  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 /* user chain for prerouting */

Chain zone_lan_postrouting (1 references)
 pkts bytes target     prot opt in     out     source               destination         
    4   496 postrouting_lan_rule  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 /* user chain for postrouting */
    0     0 SNAT       tcp  --  *      *       192.168.10.0/24      192.168.10.61        ID:66773300 tcp dpt:5500 /* bruno port forwarding (reflection) */ to:192.168.10.1
    1    60 SNAT       tcp  --  *      *       192.168.10.0/24      192.168.10.61        ID:66773300 tcp dpt:22 /* bruno port forwarding 2 (reflection) */ to:192.168.10.1

Chain zone_lan_prerouting (1 references)
 pkts bytes target     prot opt in     out     source               destination         
   39 13399 prerouting_lan_rule  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 /* user chain for prerouting */
    0     0 DNAT       tcp  --  *      *       192.168.10.0/24      73.226.70.41         ID:66773300 tcp dpt:5500 /* bruno port forwarding (reflection) */ to:192.168.10.61:5500
    1    60 DNAT       tcp  --  *      *       192.168.10.0/24      73.226.70.41         ID:66773300 tcp dpt:22 /* bruno port forwarding 2 (reflection) */ to:192.168.10.61:22

Chain zone_wan_postrouting (1 references)
 pkts bytes target     prot opt in     out     source               destination         
   14  1038 postrouting_wan_rule  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 /* user chain for postrouting */
   14  1038 MASQUERADE  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300

Chain zone_wan_prerouting (1 references)
 pkts bytes target     prot opt in     out     source               destination         
   58  8683 prerouting_wan_rule  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 /* user chain for prerouting */
    0     0 DNAT       tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 tcp dpt:5500 /* bruno port forwarding */ to:192.168.10.61:5500
    1    60 DNAT       tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            ID:66773300 tcp dpt:22 /* bruno port forwarding 2 */ to:192.168.10.61:22</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p365695">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">ulmwind</div>
					<div class="post-datetime">
						22 Sep 2017, 15:05					</div>
				</div>
				<div class="post-content content">
					<p>What is IP 192.168.10.56?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p365696">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">GNUser</div>
					<div class="post-datetime">
						22 Sep 2017, 15:38					</div>
				</div>
				<div class="post-content content">
					<p>No device on my network has that IP address, nor did I enter it into any config file.</p><p>This is what my home network looks like:<br />- Router at 192.168.10.1<br />- Printer at 192.168.10.7<br />- I manually set 192.168.10.60/29 to be the vpnbypass range (via the vpnbypass LuCI GUI), and have two devices in that range:<br />&nbsp; &nbsp;- Roku stick at 192.168.10.60<br />&nbsp; &nbsp;- Laptop at 192.168.10.61<br />- All other devices on my home network get their ip via DHCP, which starts at 192.168.10.100</p><p>Not that I understand much of the outputs I&#039;ve gotten for you, but this makes no sense to me either:<br /></p><div class="codebox"><pre><code>Chain VPNBYPASS (1 references)
 pkts bytes target     prot opt in     out     source               destination         
  309 32250 MARK       all  --  *      *       192.168.10.56/29     0.0.0.0/0  </code></pre></div>											<p class="post-edited">(Last edited by <strong>GNUser</strong> on 22 Sep 2017, 16:01)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p365697">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">GNUser</div>
					<div class="post-datetime">
						22 Sep 2017, 15:41					</div>
				</div>
				<div class="post-content content">
					<p>Aha! It seems that 192.168.10.60/29 and 192.168.10.56/29 are equivalent. Something must be automatically converting my manually-entered 192.168.10.60/29 into 192.168.10.56/29, which in itself shouldn&#039;t hurt anything.</p><p>I think vpnbypass is the source of my problem, but something else that it&#039;s doing must be to blame.</p>											<p class="post-edited">(Last edited by <strong>GNUser</strong> on 22 Sep 2017, 16:09)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p365702">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">ulmwind</div>
					<div class="post-datetime">
						22 Sep 2017, 16:45					</div>
				</div>
				<div class="post-content content">
					<p>Ok, 192.168.10.56/29=57-62, it is subnet, containing your set of IPs. It is used in mangle table, please, write the whole string, because without end it is senseless:<br /></p><div class="codebox"><pre><code>  309 32250 MARK       all  --  *      *       192.168.10.56/29     0.0.0.0/0            MARK xset 0x10000/0xff0000</code></pre></div><p>It marks specific packets, and after that they pass specific routes.<br />Now we&#039;ll analyze routing table.<br />Post output of:<br /></p><div class="codebox"><pre><code>/etc/iproute2/rt_tables
ip route
ip rule list</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p365708">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">GNUser</div>
					<div class="post-datetime">
						22 Sep 2017, 17:31					</div>
				</div>
				<div class="post-content content">
					<p>Oops, sorry for cutting off the end of the string. I didn&#039;t know there was more. I&#039;m educating myself about this stuff as we work through this issue, so hopefully I won&#039;t be such noobie forever <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>I&#039;ll post the output of those as soon as I get home from work this evening. Again, thank you so much for your help.</p>											<p class="post-edited">(Last edited by <strong>GNUser</strong> on 22 Sep 2017, 23:51)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p365724">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">GNUser</div>
					<div class="post-datetime">
						22 Sep 2017, 23:43					</div>
				</div>
				<div class="post-content content">
					<p>Here&#039;s with openvpn/vpnbypass off, when everything works normally:</p><div class="codebox"><pre><code># /etc/iproute2/rt_tables
-ash: /etc/iproute2/rt_tables: Permission denied

# cat /etc/iproute2/rt_tables
#
# reserved values
#
128    prelocal
255    local
254    main
253    default
0    unspec
#
# local
#
#1    inr.ruhep

# ip route
default via 73.226.68.1 dev eth1  src 73.226.70.41 
73.226.68.0/22 dev eth1  src 73.226.70.41 
73.226.68.1 dev eth1  src 73.226.70.41 
192.168.10.0/24 dev br-lan  src 192.168.10.1 

# ip rule list
0:    from all lookup local 
32766:    from all lookup main 
32767:    from all lookup default </code></pre></div><p>And here&#039;s with openvpn/vpnbypass on, which causes aforementioned squirrely behavior:<br /></p><div class="codebox"><pre><code># /etc/iproute2/rt_tables
-ash: /etc/iproute2/rt_tables: Permission denied

# cat /etc/iproute2/rt_tables
#
# reserved values
#
128    prelocal
255    local
254    main
253    default
0    unspec
#
# local
#
#1    inr.ruhep

# ip route
0.0.0.0/1 via 10.31.10.5 dev tun0 
default via 73.226.68.1 dev eth1  src 73.226.70.41 
10.31.10.1 via 10.31.10.5 dev tun0 
10.31.10.5 dev tun0  src 10.31.10.6 
73.226.68.0/22 dev eth1  src 73.226.70.41 
73.226.68.1 dev eth1  src 73.226.70.41 
107.191.33.9 via 73.226.68.1 dev eth1 
128.0.0.0/1 via 10.31.10.5 dev tun0 
192.168.10.0/24 dev br-lan  src 192.168.10.1 

# ip rule list
0:    from all lookup local 
32765:    from all fwmark 0x10000 lookup 200 
32766:    from all lookup main 
32767:    from all lookup default </code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p365767">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">ulmwind</div>
					<div class="post-datetime">
						23 Sep 2017, 15:50					</div>
				</div>
				<div class="post-content content">
					<p>OK, routing for fwmark is defined in separate table 200.<br />Please, post output for </p><div class="codebox"><pre><code>ip route show all</code></pre></div><p>Also for second case (vpnbypass+openvpn) try to ping from &quot;vpn-lan&quot; IP from &quot;vpnbypass-lan&quot;, and vice-versa. Try to run command traceroute 192.168.X.X or tracert 192.168.X.X, depending on OS.</p>											<p class="post-edited">(Last edited by <strong>ulmwind</strong> on 23 Sep 2017, 15:52)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p365773">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">GNUser</div>
					<div class="post-datetime">
						23 Sep 2017, 16:39					</div>
				</div>
				<div class="post-content content">
					<p>No problem. Here you go:</p><p>With openvpn/vpnbypass off:<br /></p><div class="codebox"><pre><code># ip route show all
default via 73.226.68.1 dev eth1  src 73.226.70.41 
73.226.68.0/22 dev eth1  src 73.226.70.41 
73.226.68.1 dev eth1  src 73.226.70.41 
192.168.10.0/24 dev br-lan  src 192.168.10.1 </code></pre></div><p>With openvpn/vpnbypass on:<br /></p><div class="codebox"><pre><code># ip route show all
0.0.0.0/1 via 10.20.10.5 dev tun0 
default via 73.226.68.1 dev eth1  src 73.226.70.41 
10.20.10.1 via 10.20.10.5 dev tun0 
10.20.10.5 dev tun0  src 10.20.10.6 
73.226.68.0/22 dev eth1  src 73.226.70.41 
73.226.68.1 dev eth1  src 73.226.70.41 
107.191.33.9 via 73.226.68.1 dev eth1 
128.0.0.0/1 via 10.20.10.5 dev tun0 
192.168.10.0/24 dev br-lan  src 192.168.10.1</code></pre></div><p>For second case, here&#039;s me doing a ping and traceroute from my laptop on vpnbypass-lan to my wife&#039;s computer on vpn-lan:<br /></p><div class="codebox"><pre><code>bruno@thinkpad:~$ ping -c 2 192.168.10.229
PING 192.168.10.229 (192.168.10.229) 56(84) bytes of data.
64 bytes from 192.168.10.229: icmp_seq=1 ttl=64 time=130 ms
64 bytes from 192.168.10.229: icmp_seq=2 ttl=64 time=2.13 ms

--- 192.168.10.229 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1001ms
rtt min/avg/max/mdev = 2.132/66.232/130.333/64.101 ms

bruno@thinkpad:~$ traceroute 192.168.10.229
traceroute to 192.168.10.229 (192.168.10.229), 30 hops max, 60 byte packets
 1  vaio.lan (192.168.10.229)  5.753 ms  8.052 ms  8.488 ms</code></pre></div><p>And here is from my wife&#039;s computer on vpn-lan to my laptop on vpnbypass-lan:<br /></p><div class="codebox"><pre><code>eileen@vaio:~$ ping -c 2 192.168.10.61
PING 192.168.10.61 (192.168.10.61) 56(84) bytes of data.
64 bytes from 192.168.10.61: icmp_seq=1 ttl=64 time=2.09 ms
64 bytes from 192.168.10.61: icmp_seq=2 ttl=64 time=2.10 ms

--- 192.168.10.61 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1001ms
rtt min/avg/max/mdev = 2.090/2.097/2.105/0.046 ms

eileen@vaio:~$ traceroute 192.168.10.61
traceroute to 192.168.10.61 (192.168.10.61), 30 hops max, 60 byte packets
 1  192.168.10.61 (192.168.10.61)  3.605 ms  3.566 ms  5.477 ms</code></pre></div>											<p class="post-edited">(Last edited by <strong>GNUser</strong> on 23 Sep 2017, 16:40)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p365778">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">ulmwind</div>
					<div class="post-datetime">
						23 Sep 2017, 18:19					</div>
				</div>
				<div class="post-content content">
					<p>Sorry, I wrote command with the same effect, as previous.<br />Correct command:<br /></p><div class="codebox"><pre><code>ip route show table all</code></pre></div><p>So you can ping computers between &quot;vpn-lan&quot; and &quot;vpnbypass-lan&quot;. We should reproduce behavior, you mentioned, that you can&#039;t login to your local device. Could you ping device and what error message do you get trying to login to it when vpnbypass is active?</p>											<p class="post-edited">(Last edited by <strong>ulmwind</strong> on 23 Sep 2017, 18:26)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p365786">
				<div class="post-metadata">
					<div class="post-num">Post #21</div>
					<div class="post-author">GNUser</div>
					<div class="post-datetime">
						23 Sep 2017, 20:01					</div>
				</div>
				<div class="post-content content">
					<p>In trying to reproduce the &quot;problem&quot;, I think I had a breakthrough. I hope this is not expected behavior...</p><p>I had been trying to ssh using the ISP&#039;s public IP, like this:</p><div class="codebox"><pre><code>eileen@vaio:~$ ssh bruno@73.226.70.41</code></pre></div><p>Doing it the above way only works when openvpn and vpnbypass are both off. With those things on, cursor just blinks and eventually the connection attempt times out--even though vpnbypass is definitely working and my laptop&#039;s public IP is 73.226.70.41.</p><p>Using the local IP address like this, though, always works:<br /></p><div class="codebox"><pre><code>eileen@vaio:~$ ssh bruno@192.168.10.61</code></pre></div><p>Is this expected behavior? If so, my profuse apologies and why is it that using the ISP&#039;s public IP only works when openvpn/vpnbypass are off?</p>											<p class="post-edited">(Last edited by <strong>GNUser</strong> on 23 Sep 2017, 20:04)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p365788">
				<div class="post-metadata">
					<div class="post-num">Post #22</div>
					<div class="post-author">ulmwind</div>
					<div class="post-datetime">
						23 Sep 2017, 20:22					</div>
				</div>
				<div class="post-content content">
					<p>Yes, it is expected behavior (as I&#039;ve expected it). With local address it should work always.</p><p>I don&#039;t understand, you tried to login from computer in lan to different IPs? Have you tried to login from wan side?</p><div class="codebox"><pre><code>eileen@vaio:~$ ssh bruno@73.226.70.41</code></pre></div>											<p class="post-edited">(Last edited by <strong>ulmwind</strong> on 23 Sep 2017, 21:18)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p365796">
				<div class="post-metadata">
					<div class="post-num">Post #23</div>
					<div class="post-author">GNUser</div>
					<div class="post-datetime">
						23 Sep 2017, 23:32					</div>
				</div>
				<div class="post-content content">
					<p>From wan it works fine. And from lan it works fine if I use local IP.</p><p>I thought connecting from lan using ISP public IP should work with vpnbypass (it does work when openvpn/vpnbypass are off), but I guess I was wrong.</p><p>Gosh, I feel terrible for all the trouble. I&#039;ve been using GNU/Linux for a long time and have gotten support from peers before, but never anything like this. If I can buy you a few beers for the effort, please let me know how at routernoob AT dantas DOT airpost DOT net.</p>											<p class="post-edited">(Last edited by <strong>GNUser</strong> on 23 Sep 2017, 23:33)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p365799">
				<div class="post-metadata">
					<div class="post-num">Post #24</div>
					<div class="post-author">ulmwind</div>
					<div class="post-datetime">
						24 Sep 2017, 00:16					</div>
				</div>
				<div class="post-content content">
					<p>You are welcome! I have experience in teaching and explaining applied mathematics, physics and other subjects :-) So if you or your friends need help, let me know, I&#039;ll write you message.<br />OK, let&#039;s explore the issue. We&#039;ll solve it and after that modify your script, because it is similar task. Try to login via ssh from lan side to wan IP of your router, redirecting you to your device, as you did, and write result.<br />1) openvpn is down, vpnbypass is down - you wrote, OK.<br />2) openvpn is up, vpnbypass is down - ?<br />3) openvpn is up, vpnbypass is up - ?<br />4) openvpn is down, vpnbypass is up - ?<br />The last item is strange, if it doesn&#039;t work, ignore it.</p><p>I think, answer will be as follows:<br />2) OK<br />3) BAD</p><p>Let&#039;s check my assumption.</p>											<p class="post-edited">(Last edited by <strong>ulmwind</strong> on 24 Sep 2017, 00:29)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p365801">
				<div class="post-metadata">
					<div class="post-num">Post #25</div>
					<div class="post-author">GNUser</div>
					<div class="post-datetime">
						24 Sep 2017, 00:34					</div>
				</div>
				<div class="post-content content">
					<p>1) Works. This one is straight-forward both locally and remotely, and makes sense to me.</p><p>2) Not expected to work because I don&#039;t have port forwarding configured with my vpn provider</p><p>3) This is the strange one. I can connect from lan to laptop on vpnbypass using laptop&#039;s local IP address, and can connect to it from wan using its public IP address. I just can&#039;t connect to it from lan using its public IP address. I don&#039;t understand it at all but am happy to let it be. Hopefully it will make sense to me when I know a bit more.</p><p>4) This situation would never happen. No need to run vpnbypass if openvpn is off.</p><p>I&#039;m happy with how this stands. I have learned a ton and will learn even more from revisiting this thread as I learn more.</p>											<p class="post-edited">(Last edited by <strong>GNUser</strong> on 24 Sep 2017, 00:35)</p>
									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 1 of 2</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=72112&amp;p=2.html">2</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>