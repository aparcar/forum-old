<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> DNS problem with Windows7 and Linux with dual boot</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 7 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p238162">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">dr431</div>
					<div class="post-datetime">
						26 Jun 2014, 23:22					</div>
				</div>
				<div class="post-content content">
					<p>I have a TPLINK WR1043ND v2 router with Openwrt (Barrier Breaker r40593) set up as a subnet on my verizon router. The TPLINK is 192.168.2.1 and the verizon router is 192.168.1.1, with the verizon router providing DNS.</p><p>When I boot my PC with Linux (Fedora core 19) it is able to pull in the DNS information and I can run NSLOOKUP without any problems.</p><p>nslookup output from Linux:<br />Default server: 192.168.1.1<br />Address: 192.168.1.1#53<br />Default server: fd32:f5e9:753a::1<br />Address: fd32:f5e9:753a::1#53</p><p>Set options:<br />&nbsp; novc&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; nodebug&nbsp; &nbsp; &nbsp; &nbsp; nod2<br />&nbsp; search&nbsp; &nbsp; &nbsp; &nbsp; recurse<br />&nbsp; timeout = 0&nbsp; &nbsp; &nbsp; &nbsp; retry = 3&nbsp; &nbsp; port = 53<br />&nbsp; querytype = A&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; class = IN<br />&nbsp; srchlist = home</p><p>When I boot the same PC with Window7 it is not able to get the DNS information and NSLOOKUP fails unless I specify the lookup server like this: </p><p>NSLOOKUP servername 192.168.1.1</p><p>If I do ipconfig/all the DNS server is listed as 192.168.1.1, which is as expected/desired</p><p>nslookup output from Windows7:</p><p>Default Server:&nbsp; UnKnown<br />Address:&nbsp; fd32:f5e9:753a::1</p><p>&gt; Set options:&nbsp; &nbsp;nodebug&nbsp; &nbsp;defname&nbsp; &nbsp;search&nbsp; &nbsp;recurse&nbsp; &nbsp;nod2&nbsp; &nbsp;novc&nbsp; &nbsp;noignoretc&nbsp; &nbsp;port=53&nbsp; &nbsp;type=A+AAAA&nbsp; &nbsp;class=IN&nbsp; &nbsp;timeout=2&nbsp; &nbsp;retry=1&nbsp; &nbsp;root=A.ROOT-SERVERS.NET.&nbsp; &nbsp;domain=home&nbsp; &nbsp;MSxfr&nbsp; &nbsp;IXFRversion=1 Default Server:&nbsp; UnKnown<br />Address:&nbsp; fd32:f5e9:753a::1</p><p>&nbsp; srchlist=home</p><p>&gt; </p><p>Does anyone have an idea what would prevent Windows7 from pulling in the DNS info while Linux gets it just fine? </p><p>Same machine, same NIC, heck it even gets the same IP address whether I boot Windows or Linix. Any suggestions would be really appreciated.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p238167">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">nebbia88</div>
					<div class="post-datetime">
						26 Jun 2014, 23:39					</div>
				</div>
				<div class="post-content content">
					<p>if you don&#039;t need it, try disabling ipv6 protocol from nic&#039;s proprieties...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p238179">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">qasdfdsaq</div>
					<div class="post-datetime">
						27 Jun 2014, 00:57					</div>
				</div>
				<div class="post-content content">
					<p>^^ This. You&#039;re trying to use an IPV6 DNS server.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p238268">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">dr431</div>
					<div class="post-datetime">
						27 Jun 2014, 17:55					</div>
				</div>
				<div class="post-content content">
					<p>That&#039;s pretty amazing, but turning off ipv6 on the nic worked! </p><p>Thanks for the idea, but I would prefer to not have to run around to all the windows devices in my family and disable IPV6 on their machines in case they take their laptops somewhere that IPV6 is required.</p><p>Is there anything I can do on the router side to either get Win7 to work with ipv6 or turn off ipv6 on the Openwrt router? I tried Googling &#039;Openwrt disable ipv6&#039; but no luck really. A lot on how to enable ipv6 though.</p><p>Thanks for your help so far - At least I have a work-around of sorts. Much appreciated.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p238277">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">nebbia88</div>
					<div class="post-datetime">
						27 Jun 2014, 20:05					</div>
				</div>
				<div class="post-content content">
					<p>I won&#039;t try to disable ipv6 on openwrt, read this about dns:</p><p><a href="https://forum.openwrt.org/viewtopic.php?id=48071">https://forum.openwrt.org/viewtopic.php?id=48071</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p238279">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">qasdfdsaq</div>
					<div class="post-datetime">
						27 Jun 2014, 20:37					</div>
				</div>
				<div class="post-content content">
					<p>The first thing I&#039;d do is figure out what device fd32:f5e9:753a::1 is and then figure out what is telling your computers to use that as a DNS server.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p238312">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">cconn</div>
					<div class="post-datetime">
						28 Jun 2014, 00:22					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>qasdfdsaq wrote:</cite><blockquote><p>The first thing I&#039;d do is figure out what device fd32:f5e9:753a::1 is and then figure out what is telling your computers to use that as a DNS server.</p></blockquote></div><p>OpenWRT now configures a unique-local prefix (fc00::/7), so fd32:f5e9:753a::/64 is likely the one selected by OpenWRT and fd32:f5e9:753a::1 is most definately your openwrt router.</p><p>what you need to do is not disable IPv6, but figure out why when your windows box sends a DNS query to that IP, why it is not working.</p><p>I would run a wireshark to see what is being sent and if there is an answer.</p><p>And, does your FC19 box autoconfigure a ULA prefix from fd32:f5e9:753a::/64 as well?&nbsp; You can run a dig -t A @fd32:f5e9:753a::1 <a href="http://www.openwrt.com">www.openwrt.com</a> to see if it can resolve from that IP using Linux.</p>											<p class="post-edited">(Last edited by <strong>cconn</strong> on 28 Jun 2014, 00:23)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p238353">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">makro</div>
					<div class="post-datetime">
						28 Jun 2014, 12:36					</div>
				</div>
				<div class="post-content content">
					<p>Windows Vista (or 7) and later prefers IPv6 over IPv4. If Windows knows of a DNS server available over IPv6, it will always try that. Unfortunately Windows doesn&#039;t figure that if the server doesn&#039;t provide answers to queries, it should switch to another server. And as OpenWrt configures a local IPv6 prefix by default, as mentioned, all of your Windows devices will try the IPv6 DNS server. If your ISP provides IPv6, look into how to set up OpenWrt to use it. If your ISP doesn&#039;t provide it, you could try setting up an IPv6 tunnel with e.g. <a href="http://he.net">he.net</a>, or just disable IPv6 on the LAN interface of OpenWrt.</p>											<p class="post-edited">(Last edited by <strong>makro</strong> on 28 Jun 2014, 12:39)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p238370">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">dr431</div>
					<div class="post-datetime">
						28 Jun 2014, 17:42					</div>
				</div>
				<div class="post-content content">
					<p>Well I tried a couple of things, and it appears to be working. First I tried enabling IPV6 on the verizon router, but that didn&#039;t make any difference, so I turned it back off.</p><p>The comments about the the local prefix from cconn and makro about the local prefix and that Windows will always try the ipv6 dns server got me to thinking that possibly Windows was going to the Openwrt server for dns even though I had specified the verizon router for dns. </p><p>On a WAG, I commented out the &#039;option ula_prefix&#039; line in /etc/config/network and then windows got the DNS information and nslookup was working. Booting back to linux everything seems to be ok there as well. </p><p>I don&#039;t know much about ipv6 and what ula&#039;s are used for other than they are like ipv4 private addresses. The question now is: have I set myself up for different problems by commenting out the ula prefix line? If not, then I&#039;ll just leave the ula prefix commented out.</p><p>Once again, thanks everyone for their help and suggestions.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p238389">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">makro</div>
					<div class="post-datetime">
						28 Jun 2014, 23:11					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>dr431 wrote:</cite><blockquote><p>I don&#039;t know much about ipv6 and what ula&#039;s are used for other than they are like ipv4 private addresses. The question now is: have I set myself up for different problems by commenting out the ula prefix line? If not, then I&#039;ll just leave the ula prefix commented out.</p></blockquote></div><p>Good to hear you found a satisfying solution. I believe your only &quot;problem&quot; is that your local network is IPv4-only, which isn&#039;t an issue as you don&#039;t have IPv6 on WAN anyway. It can be useful to have IPv6 locally even without WAN access, but not at all necessary - and if you don&#039;t see the potential uses, don&#039;t worry one bit.</p><p>IPv4 and IPv6 are configured independently. You had specified the Verizon router as DNS server for <strong>IPv4</strong> configuration, but I assume you hadn&#039;t touched the IPv6 settings. If a device other than OpenWrt handles DHCP and DNS for IPv4, OpenWrt device can still announce IPv6 configuration to other computers, and it does so by default. Windows knew about your Verizon router as DNS server all along, it just didn&#039;t use it because it received IPv6 configuration from your OpenWrt device. Normally applications (such as web browsers) will fail over to your IPv4 DNS servers, but nslookup commands won&#039;t work, because it doesn&#039;t switch to IPv4 DNS servers for some reason. At least that&#039;s the case in my network with Windows 8.1 devices - IPv4 DNS servers are external, OpenWrt configures local IPv6. Applications on Windows can surf just fine, but nslookup won&#039;t work unless I specify a DNS server to use.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p238407">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">dr431</div>
					<div class="post-datetime">
						29 Jun 2014, 00:55					</div>
				</div>
				<div class="post-content content">
					<p>thanks makro. Only my verizon router is serving up dns and IPV44 on the 1.x subnet and, the openwrt router is handing out ipv6 addresses on the 2.x subnet. Like you, I had to specify the DNS server for nslookup until I stumbled upon this solution.</p><p>I think my next experiment will be to turn IPV6 back on on the verizon side and if everything works ok, let both routers run IPV6.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p238427">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">qasdfdsaq</div>
					<div class="post-datetime">
						29 Jun 2014, 04:00					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>makro wrote:</cite><blockquote><p>or just disable IPv6 on the LAN interface of OpenWrt.</p></blockquote></div><p>Or tell the DHCP server to not tell devices to use a non-working DNS server.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>