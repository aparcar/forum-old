<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Can&#039;t get USB storage to work on TL-MR3020</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 30 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p172558">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">tzippy</div>
					<div class="post-datetime">
						17 Jul 2012, 22:37					</div>
				</div>
				<div class="post-content content">
					<p>I have installed alle the required packages but all I see with dmesg when I connect it is this:</p><p>[&nbsp; 491.160000] usb 1-1: new high-speed USB device number 5 using ehci-platform</p><p>I am completely out of ideas. I have the latest trunk version installed.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p172564">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">johan666</div>
					<div class="post-datetime">
						17 Jul 2012, 23:55					</div>
				</div>
				<div class="post-content content">
					<p>I am completely out of ideas what you are talking about.....<br />that message is correct.</p><p>[&nbsp; &nbsp; 1.610000] usb 1-1: new high-speed USB device number 2 using ehci-platform<br />[&nbsp; &nbsp; 3.600000] Registered led device: tp-link:green:3g<br />[&nbsp; &nbsp; 3.600000] Registered led device: tp-link:green:wlan<br />[&nbsp; &nbsp; 3.600000] Registered led device: tp-link:green:lan<br />[&nbsp; &nbsp; 3.600000] Registered led device: tp-link:green:wps<br />[&nbsp; &nbsp; 7.600000] SCSI subsystem initialized<br />[&nbsp; &nbsp; 7.710000] Initializing USB Mass Storage driver...<br />[&nbsp; &nbsp; 7.720000] scsi0 : usb-storage 1-1:1.0<br />[&nbsp; &nbsp; 7.720000] usbcore: registered new interface driver usb-storage<br />[&nbsp; &nbsp; 7.730000] USB Mass Storage support registered.<br />[&nbsp; &nbsp; 8.720000] scsi 0:0:0:0: Direct-Access&nbsp; &nbsp; &nbsp;CBM&nbsp; &nbsp; &nbsp; Flash Disk&nbsp; &nbsp; &nbsp; &nbsp;5.00 PQ: 0 ANSI: 2<br />[&nbsp; &nbsp; 8.730000] sd 0:0:0:0: [sda] Write Protect is off<br />[&nbsp; &nbsp; 8.750000] sd 0:0:0:0: [sda] No Caching mode page present<br />[&nbsp; &nbsp; 8.790000] sd 0:0:0:0: [sda] Attached SCSI removable disk<br />[&nbsp; &nbsp;28.280000] EXT4-fs (sda1): warning: mounting unchecked fs, running e2fsck is recommended<br />[&nbsp; &nbsp;28.290000] EXT4-fs (sda1): mounted filesystem without journal. Opts: (null)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p172566">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">tzippy</div>
					<div class="post-datetime">
						18 Jul 2012, 00:13					</div>
				</div>
				<div class="post-content content">
					<p>THe Thing is I do not get the rest of the messages. That&#039;s all i get when plugging the USB drive in.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p172567">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">ninno</div>
					<div class="post-datetime">
						18 Jul 2012, 00:22					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>tzippy wrote:</cite><blockquote><p>THe Thing is I do not get the rest of the messages. That&#039;s all i get when plugging the USB drive in.</p></blockquote></div><p>usb_storage module is loaded for sure / checked this with lsmod?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p172570">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">tzippy</div>
					<div class="post-datetime">
						18 Jul 2012, 01:36					</div>
				</div>
				<div class="post-content content">
					<p>It is not loaded as I just noticed. But when I try to load it (insmod usb-storage) and check with lsmod, it didn&#039;t load. Allthough it exists in /lib/modules/3.3.8/usb-storage.ko</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p172571">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">tzippy</div>
					<div class="post-datetime">
						18 Jul 2012, 02:01					</div>
				</div>
				<div class="post-content content">
					<p>Okay, I deinstalled the module, installed it again. I got this now in&nbsp; dmesg:</p><br /><p>[11157.720000] usb_storage: version magic &#039;3.3.8 mod_unload MIPS32_R2 32BIT &#039; should be &#039;3.3.6 mod_unload MIPS32_R2 32BIT &#039;</p><p>I guess something with the versions, but I have no idea what to do.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p172576">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">johan666</div>
					<div class="post-datetime">
						18 Jul 2012, 06:48					</div>
				</div>
				<div class="post-content content">
					<p>It is kernel module, it should match to your kernel.</p><p>You are using old firmware which contain old kernel,<br />but the module you try to install is for update kernel.<br />What are you thinking ?<br />Why don&#039;t you update everything ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p172592">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">ninno</div>
					<div class="post-datetime">
						18 Jul 2012, 09:06					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>tzippy wrote:</cite><blockquote><p>Okay, I deinstalled the module, installed it again. I got this now in&nbsp; dmesg:</p><br /><p>[11157.720000] usb_storage: version magic &#039;3.3.8 mod_unload MIPS32_R2 32BIT &#039; should be &#039;3.3.6 mod_unload MIPS32_R2 32BIT &#039;</p><p>I guess something with the versions, but I have no idea what to do.</p></blockquote></div><p>You need to install a new image, because you wont get back the packages matching your kernel version anymore.<br />If you want to preserve your config on the router, fetch a new image and use sysupgrade:<br /><a href="http://wiki.openwrt.org/doc/howto/generic.sysupgrade">http://wiki.openwrt.org/doc/howto/generic.sysupgrade</a></p><p>You are currently bound to trunk releases with your router, installing kernel modules in trunk is only guraranteed until the next build-bot finishes building the next image. If the kernel changes, you wont be able to install any kernel packages without forcing opkg to do so (like you did for sure in this case).<br />You can try this if the version is still the same, but not if the Kernel Version has changed (3.3.8 != 3.3.6).</p><p>So better download the imagebuilder archive parallel to your copy of todays trunk image and keep it, it contains all kernel module packages matching your release - you can store everything on a local http server and modify /etc/opkg.conf to pull the files from there (comfortable way once set up), or just copy them to the router and install them manually.</p>											<p class="post-edited">(Last edited by <strong>ninno</strong> on 18 Jul 2012, 09:08)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>