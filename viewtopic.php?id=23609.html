<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> OpenWRT 8.09.2 booting from USB stick with NSLU2</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 24 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p102915">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">dolphs</div>
					<div class="post-datetime">
						14 Feb 2010, 17:17					</div>
				</div>
				<div class="post-content content">
					<p>Hi guys, flashed today 8.09.2 and spent some time reading several (outdated) topics but cannot get my nslu2 booting properly, hopefully can get a hint from you guys:</p><p>When I boot my nslu2 at this stage it shows the following&nbsp; &quot; df -h&quot; :</p><p>root@OpenWrt:~# df -h<br />Filesystem&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Size&nbsp; &nbsp; &nbsp; Used Available Use% Mounted on<br />rootfs&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1.4M&nbsp; &nbsp; &nbsp; 1.4M&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 100% /<br />/dev/root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1.4M&nbsp; &nbsp; &nbsp; 1.4M&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 100% /rom<br />/dev/mtdblock5&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 4.9M&nbsp; &nbsp; &nbsp; 1.1M&nbsp; &nbsp; &nbsp; 3.7M&nbsp; 23% /jffs<br />mini_fo:/jffs&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1.4M&nbsp; &nbsp; &nbsp; 1.4M&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 100% /</p><br /><p>These steps have been executed so far for Kamikaze 8.09-2</p><p>upslug2 -i openwrt-nslu2-squashfs.bin</p><p>telnet 192.168.1.1<br />vi /etc/config/network</p><p>config interface lan<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname&nbsp; &nbsp;eth0<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; &nbsp; static<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr&nbsp; &nbsp; 192.168.178.77<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask 255.255.255.0<br />&nbsp; &nbsp; &nbsp; &nbsp; option gateway 192.168.178.1<br />&nbsp; &nbsp; <br />vi /etc/resolv.conf<br />&nbsp; &nbsp; nameserver 192.168.178.1</p><p>vi /etc/hostname</p><p>passwd</p><p>/etc/init.d/network restart</p><p>Unplug LAN cable and put both pc/laptop and nslu2 on router<br />Open a new terminal and log in to kamikaze on new address specified<br />?<br />opkg update<br />opkg install e2fsprogs tune2fs fdisk kmod-usb-corekmod-usb2 kmod-scsi-core kmod-usb-storage kmod-fs-ext3<br />opkg remove -recursive ppp-mod-pppoe wireless-tools</p><br /><p>vi /etc/modules.d/60-usb-storage ( for multicard readers )<br />&nbsp; &nbsp; scsi_mod max_sci_luns=8<br />sd_mod<br />usb-storage</p><br /><p>dmesg to see if usb device is registered:<br />Initializing USB Mass Storage driver...<br />usbcore: registered new interface driver usb-storage<br />USB Mass Storage support registered.</p><p>usb 3-2: new high speed USB device using ehci_hcd and address 2<br />usb 3-2: configuration #1 chosen from 1 choice<br />scsi0 : SCSI emulation for USB Mass Storage devices<br />usb-storage: device found at 2<br />usb-storage: waiting for device to settle before scanning<br />scsi 0:0:0:0: Direct-Access&nbsp; &nbsp; &nbsp;Kingston DataTraveler 2.0 PMAP PQ: 0 ANSI: 0 CCS<br />sd 0:0:0:0: [sda] 1007616 512-byte hardware sectors (516 MB)<br />sd 0:0:0:0: [sda] Write Protect is off<br />sd 0:0:0:0: [sda] Mode Sense: 23 00 00 00<br />sd 0:0:0:0: [sda] Assuming drive cache: write through<br />sd 0:0:0:0: [sda] 1007616 512-byte hardware sectors (516 MB)<br />sd 0:0:0:0: [sda] Write Protect is off<br />sd 0:0:0:0: [sda] Mode Sense: 23 00 00 00<br />sd 0:0:0:0: [sda] Assuming drive cache: write through<br /> sda: sda1<br />sd 0:0:0:0: [sda] Attached SCSI removable disk<br />usb-storage: device scan complete<br />kjournald starting.&nbsp; Commit interval 5 seconds<br />EXT3 FS on sda1, internal journal<br />EXT3-fs: mounted filesystem with ordered data mode.</p><br /><p>fdisk -l ( should show /dev/sda1 )<br />fdisk /dev/sda<br /> ( make EXT3 partition without any swap )<br />reboot</p><p>umount /dev/sda1&nbsp; &nbsp; <br />mke2fs -j /dev/sda1<br />tune2fs -c0 -i0 /dev/sda1<br />( if reboot executed: umount -f /home )<br />mount -t ext3 /dev/sda1 /mnt<br />mkdir /tmp/root<br />mount -o bind /rom /tmp/root<br />cp /tmp/root/* /mnt -a<br />umount /tmp/root<br />umount /mnt</p><br /><p>vi /etc/init.d/pivotroot<br />#!/bin/sh<br />boot_dev=&quot;/dev/sda1&quot;<br />/sbin/hotplug2 --override -persistent --max-children 1 --no-coldplug &amp;</p><p>for module in usbcore ehci-hcd scsi_mod usb-storage jbd ext3; do {<br />&nbsp; &nbsp; &nbsp; &nbsp; insmod $module<br />}; done</p><p>killall hotplug2</p><br /><p># mount the usb stick<br />sleep 10s<br />mount &quot;$boot_dev&quot; /mnt<br /># if everything looks ok, do the pivot root<br />[ -x /mnt/sbin/init ] &amp;&amp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; mount -o move /proc /mnt/proc &amp;&amp; \<br />&nbsp; &nbsp; &nbsp; &nbsp; pivot_root /mnt /mnt/mnt &amp;&amp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mount -o move /mnt/dev /dev<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mount -o move /mnt/tmp /tmp<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mount -o move /mnt/jffs /jffs 2&gt;&amp;-<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mount -o move /mnt/sys /sys 2&gt;&amp;-<br />&nbsp; &nbsp; &nbsp; &nbsp; }<br />}</p><br /><p>chmod +x /etc/init.d/pivotroot</p><p>vi /etc/init.d/rcS</p><p>#!/bin/sh&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br /># Copyright (C) 2006 OpenWrt.org&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />run_scripts() {&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; for i in /etc/rc.d/$1*; do&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [ -x $i ] &amp;&amp; $i $2 2&gt;&amp;1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; done | $LOGGER&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />}&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />LOGGER=&quot;cat&quot;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />[ -x /usr/bin/logger ] &amp;&amp; LOGGER=&quot;logger -s -p 6 -t sysinit&quot;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />#&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br /># Switch to pivoroot if available&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />#&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />if [ &quot;$2&quot; == &quot;boot&quot; -a -x /etc/init.d/pivotroot ] ; then&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; echo &quot;[`date`]: Pivot root log created.&quot; &gt; /tmp/pivotroot.log&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp; /etc/init.d/pivotroot &gt;&gt; /tmp/pivotroot.log&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />fi&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />if [ &quot;$1&quot; = &quot;S&quot; ]; then&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; run_scripts &quot;$1&quot; &quot;$2&quot; &amp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />else&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; run_scripts &quot;$1&quot; &quot;$2&quot;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />fi&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </p><br /><br /><p>cat /tmp/pivotroot.log<br />oot@OpenWrt:~# cat /tmp/pivotroot.log <br />[Sun Feb 14 15:02:32 UTC 2010]: Pivot root log created.<br />root@OpenWrt:~# </p><br /><p>root@OpenWrt:~# ls -last /etc/init.d/pivotroot <br />&nbsp; &nbsp;1 -rwxr-xr-x&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 895 Feb 14 14:52 /etc/init.d/pivotroot<br />root@OpenWrt:~# </p><br /><p>Like to know what I am doing wrong here as when I execute the pivotroot manually things start to roll:</p><p>root@OpenWrt:~# /etc/init.d/pivotroot&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />insmod: cannot insert &#039;/lib/modules/2.6.26.8/usbcore.ko&#039;: File exists (-1): File exists<br />insmod: cannot insert &#039;/lib/modules/2.6.26.8/ehci-hcd.ko&#039;: File exists (-1): File exists<br />insmod: cannot insert &#039;/lib/modules/2.6.26.8/scsi_mod.ko&#039;: File exists (-1): File exists<br />insmod: cannot insert &#039;/lib/modules/2.6.26.8/usb-storage.ko&#039;: File exists (-1): File exists<br />insmod: cannot insert &#039;/lib/modules/2.6.26.8/jbd.ko&#039;: File exists (-1): File exists<br />insmod: cannot insert &#039;/lib/modules/2.6.26.8/ext3.ko&#039;: File exists (-1): File exists</p><p>root@OpenWrt:/mnt/root# cat /tmp/pivotroot.log <br />[Sun Feb 14 15:02:32 UTC 2010]: Pivot root log created.<br />root@OpenWrt:/mnt/root# </p><p>root@OpenWrt:/mnt/root# df -h<br />Filesystem&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Size&nbsp; &nbsp; &nbsp; Used Available Use% Mounted on<br />rootfs&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 470.9M&nbsp; &nbsp; &nbsp;14.7M&nbsp; &nbsp; 431.9M&nbsp; &nbsp;3% /<br />/dev/root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1.4M&nbsp; &nbsp; &nbsp; 1.4M&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 100% /mnt/rom<br />/dev/mtdblock5&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 4.9M&nbsp; &nbsp; &nbsp; 1.1M&nbsp; &nbsp; &nbsp; 3.7M&nbsp; 23% /mnt/jffs<br />mini_fo:/jffs&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1.4M&nbsp; &nbsp; &nbsp; 1.4M&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 100% /mnt<br />/dev/sda1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;470.9M&nbsp; &nbsp; &nbsp;14.7M&nbsp; &nbsp; 431.9M&nbsp; &nbsp;3% /<br />root@OpenWrt:/mnt/root# </p><br /><p>When I don&#039;t execute steps from &quot;&nbsp; vi /etc/init.d/pivotroot &quot;&nbsp; and below I get:<br />root@OpenWrt:~# df -h<br />Filesystem&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Size&nbsp; &nbsp; &nbsp; Used Available Use% Mounted on<br />rootfs&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1.4M&nbsp; &nbsp; &nbsp; 1.4M&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 100% /<br />/dev/root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1.4M&nbsp; &nbsp; &nbsp; 1.4M&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 100% /rom<br />/dev/mtdblock5&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 4.9M&nbsp; &nbsp; &nbsp; 1.1M&nbsp; &nbsp; &nbsp; 3.7M&nbsp; 23% /jffs<br />mini_fo:/jffs&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1.4M&nbsp; &nbsp; &nbsp; 1.4M&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 100% /<br />/dev/sda1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;470.9M&nbsp; &nbsp; &nbsp;14.7M&nbsp; &nbsp; 431.9M&nbsp; &nbsp;3% /home<br />root@OpenWrt:~# </p><br /><br /><p>All I am trying to achieve is to boot from USB Stick, write all settings and packages to&nbsp; USB stick instead of flash so I can build my own little system. Did things changes since 8.09.2?</p><p>Please awaiting your answers!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p102943">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">dolphs</div>
					<div class="post-datetime">
						15 Feb 2010, 08:19					</div>
				</div>
				<div class="post-content content">
					<p>updated working sequence for me, steps shown as below were taken. <br />Currently thinking of better way of removing symbolic link to /var and which other redundant packages I can remove from the nslu2</p><br /><p>apt-get install upslug2<br />download <a href="http://downloads.openwrt.org/kamikaze/ver/ixp4xx/">http://downloads.openwrt.org/kamikaze/ver/ixp4xx/</a> openwrt-nslu2-squashfs.bin<br />sudo su<br />upslug -i openwrt-nslu2-squashfs.bin</p><br /><p>telnet 192.168.1.1<br />passwd</p><p>vi /etc/config/network<br />&nbsp; &nbsp; config interface lan<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; option ifname&nbsp; &nbsp; &nbsp; &nbsp; eth0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; &nbsp; &nbsp; static<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; option ipaddr&nbsp; &nbsp; &nbsp; &nbsp; 192.168.178.77<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; option netmask&nbsp; &nbsp; 255.255.255.0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; option gateway&nbsp; &nbsp; 192.168.178.1</p><p>echo &quot;nameserver 192.168.178.1&quot; &gt; /etc/resolv.conf</p><p>/etc/init.d/network restart</p><p>touch /.ext3flash<br />echo &quot;0&quot; &gt; /proc/sys/vm/swappiness</p><p>opkg update<br />opkg install kmod-fs-ext3 kmod-usb2 kmod-usb-storage fdisk e2fsprogs<br />opkg remove -recursive ppp-mod-pppoe wireless-tools<br />df -h<br />&nbsp; &nbsp; Filesystem&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Size&nbsp; &nbsp; &nbsp; Used Available Use% Mounted on<br />&nbsp; &nbsp; rootfs&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1.4M&nbsp; &nbsp; &nbsp; 1.4M&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 100% /<br />&nbsp; &nbsp; /dev/root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1.4M&nbsp; &nbsp; &nbsp; 1.4M&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 100% /rom<br />&nbsp; &nbsp; mini_fo:/tmp/root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1.4M&nbsp; &nbsp; &nbsp; 1.4M&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 100% /tmp/root<br />&nbsp; &nbsp; /dev/mtdblock5&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 4.9M&nbsp; &nbsp; &nbsp; 1.1M&nbsp; &nbsp; &nbsp; 3.8M&nbsp; 22% /jffs<br />&nbsp; &nbsp; mini_fo:/jffs&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1.4M&nbsp; &nbsp; &nbsp; 1.4M&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 100% /</p><p>( plug in usb disk if formatted )<br />df -h<br />&nbsp; &nbsp; Filesystem&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Size&nbsp; &nbsp; &nbsp; Used Available Use% Mounted on<br />&nbsp; &nbsp; rootfs&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1.4M&nbsp; &nbsp; &nbsp; 1.4M&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 100% /<br />&nbsp; &nbsp; /dev/root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1.4M&nbsp; &nbsp; &nbsp; 1.4M&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 100% /rom<br />&nbsp; &nbsp; mini_fo:/tmp/root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1.4M&nbsp; &nbsp; &nbsp; 1.4M&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 100% /tmp/root<br />&nbsp; &nbsp; /dev/mtdblock5&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 4.9M&nbsp; &nbsp; &nbsp; 1.1M&nbsp; &nbsp; &nbsp; 3.8M&nbsp; 22% /jffs<br />&nbsp; &nbsp; mini_fo:/jffs&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1.4M&nbsp; &nbsp; &nbsp; 1.4M&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 100% /<br />&nbsp; &nbsp; /dev/sda1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;470.9M&nbsp; &nbsp; &nbsp;10.3M&nbsp; &nbsp; 436.3M&nbsp; &nbsp;2% /home<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; <br />( not formatted )<br />fdisk /dev/sda1<br />reboot</p><p>umount /dev/sda1<br />mkfs.ext3 /dev/sda1 ( take note of &quot; Use tune2fs -c or -i to override &quot; )<br />mount -t ext3 /dev/sda1 /mnt<br />mkdir /tmp/root<br />mount -o bind /rom /tmp/root<br />cp /tmp/root/* /mnt -a</p><p>rm /mnt/etc/resolv.conf ( to remove symbolic link to /tmp/resolv.conf ) <br />echo &quot;nameserver 192.168.178.1&quot; &gt; /mnt/etc/resolv.conf</p><p>mkdir /mnt/var2<br />cp -R /mnt/var/* /mnt/var2<br />umount /tmp<br />mv var2 var<br />cd /<br />umount /mnt<br />df -h<br />&nbsp; &nbsp; &nbsp; &nbsp; Filesystem&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Size&nbsp; &nbsp; &nbsp; Used Available Use% Mounted on<br />&nbsp; &nbsp; &nbsp; &nbsp; rootfs&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1.4M&nbsp; &nbsp; &nbsp; 1.4M&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 100% /<br />&nbsp; &nbsp; &nbsp; &nbsp; /dev/root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1.4M&nbsp; &nbsp; &nbsp; 1.4M&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 100% /rom<br />&nbsp; &nbsp; &nbsp; &nbsp; /dev/mtdblock5&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 4.9M&nbsp; &nbsp; &nbsp; 1.1M&nbsp; &nbsp; &nbsp; 3.8M&nbsp; 23% /jffs<br />&nbsp; &nbsp; &nbsp; &nbsp; mini_fo:/jffs&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1.4M&nbsp; &nbsp; &nbsp; 1.4M&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 100% /</p><p>vi /etc/init.d/pivotroot<br />#!/bin/sh<br />boot_dev=&quot;/dev/sda1&quot;<br />/sbin/hotplug2 --override --persistent --max-children 1 --no-coldplug &amp;<br />for module in usbcore ehci-hcd scsi_mod usb-storage jbd ext3 ; do {<br />&nbsp; &nbsp; &nbsp; &nbsp; insmod $module<br />&nbsp; &nbsp; &nbsp; &nbsp; }; done<br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; # this may need to be higher if your disk is slow to initialize<br />&nbsp; &nbsp; &nbsp; &nbsp; sleep 4s<br />&nbsp; &nbsp; &nbsp; &nbsp; # mount the usb stick<br />&nbsp; &nbsp; &nbsp; &nbsp; mount &quot;$boot_dev&quot; /mnt<br />&nbsp; &nbsp; &nbsp; &nbsp; # if everything looks ok, do the pivot root<br />killall hotplug2<br />&nbsp; &nbsp; &nbsp; &nbsp; [ -x /mnt/sbin/init ] &amp;&amp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mount -o move /proc /mnt/proc &amp;&amp; \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pivot_root /mnt /mnt/mnt &amp;&amp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mount -o move /mnt/dev /dev<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mount -o move /mnt/tmp /tmp<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mount -o move /mnt/jffs2 /jffs2 2&gt;&amp;-<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mount -o move /mnt/sys /sys 2&gt;&amp;-<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />}</p><br /><p>chmod 755 /etc/init.d/pivotroot<br />ln -s /etc/init.d/pivotroot /etc/rc.d/S10pivotroot</p><br /><p>vi /etc/init.d/rcS<br />&nbsp; &nbsp; &nbsp; &nbsp; #!/bin/sh<br />&nbsp; &nbsp; &nbsp; &nbsp; # Copyright (C) 2006 OpenWrt.org<br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; run_scripts() {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for i in /etc/rc.d/$1*; do<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [ -x $i ] &amp;&amp; $i $2 2&gt;&amp;1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; done | $LOGGER<br />&nbsp; &nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; if [ $2 == &quot;boot&quot; -a -x /etc/init.d/pivotroot ] ; then<br />&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/etc/init.d/pivotroot &gt; /tmp/pivotroot.log<br />&nbsp; &nbsp; &nbsp; &nbsp; fi<br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; LOGGER=&quot;cat&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; [ -x /usr/bin/logger ] &amp;&amp; LOGGER=&quot;logger -s -p 6 -t sysinit&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; if [ &quot;$1&quot; = &quot;S&quot; ]; then<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; run_scripts &quot;$1&quot; &quot;$2&quot; &amp;<br />&nbsp; &nbsp; &nbsp; &nbsp; else<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; run_scripts &quot;$1&quot; &quot;$2&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; fi<br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; <br />echo &quot;Booted off internal flash&quot; &gt;&gt; /etc/banner</p><br /><p>reboot</p><br /><p>telnet 192.168.178.77 ( ssh does not work now if all went fine )<br />passwd<br />df -h:<br />&nbsp; &nbsp; Filesystem&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Size&nbsp; &nbsp; &nbsp; Used Available Use% Mounted on<br />&nbsp; &nbsp; rootfs&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 470.9M&nbsp; &nbsp; &nbsp;14.6M&nbsp; &nbsp; 432.0M&nbsp; &nbsp;3% /<br />&nbsp; &nbsp; /dev/root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1.4M&nbsp; &nbsp; &nbsp; 1.4M&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 100% /mnt/rom<br />&nbsp; &nbsp; /dev/mtdblock5&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 4.9M&nbsp; &nbsp; &nbsp; 1.1M&nbsp; &nbsp; &nbsp; 3.8M&nbsp; 23% /mnt/jffs<br />&nbsp; &nbsp; mini_fo:/jffs&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1.4M&nbsp; &nbsp; &nbsp; 1.4M&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 100% /mnt<br />&nbsp; &nbsp; /dev/sda1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;470.9M&nbsp; &nbsp; &nbsp;14.6M&nbsp; &nbsp; 432.0M&nbsp; &nbsp;3% /<br />&nbsp; &nbsp; <br />touch /.ext3flash<br />echo &quot;0&quot; &gt; /proc/sys/vm/swappiness</p><p>opkg update<br />opkg install procps -force-overwrite<br />opkg install tune2fs usbutils unzip bzip2<br />tune2fs -c0 -i0 /dev/sda1</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p103067">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">dolphs</div>
					<div class="post-datetime">
						16 Feb 2010, 22:04					</div>
				</div>
				<div class="post-content content">
					<p>Hmm still not satisfied but guess I am learning:<br />Few remaining questions regarding booting off USB Stick:</p><br /><p>If I remove /etc/fstab in order to remove symolic link to tmp and recreate fstab as below this should not do any harm, I am asking as default setting is sync which I made async as the stick stays on the nslu2 and noatime to limit writes<br />/etc/fstab -&nbsp; /dev/sda1&nbsp; &nbsp; &nbsp; &nbsp;/home&nbsp; &nbsp;ext3&nbsp; &nbsp; noauto,rw,async,noatime&nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp;0</p><br /><br /><p>When pivotroot has been created and I restart from stick I notice that usually dev/sda1 gets mounted twice, how can I get rid of that behaviour?<br />/dev/sda1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;470.9M&nbsp; &nbsp; &nbsp;16.5M&nbsp; &nbsp; 430.1M&nbsp; &nbsp;4% /mnt/home<br />/dev/sda1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;470.9M&nbsp; &nbsp; &nbsp;16.5M&nbsp; &nbsp; 430.1M&nbsp; &nbsp;4% /</p><p>OR</p><p>/dev/sda1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;470.9M&nbsp; &nbsp; &nbsp;14.6M&nbsp; &nbsp; 432.0M&nbsp; &nbsp;3% /mnt/mnt/sda1<br />/dev/sda1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;470.9M&nbsp; &nbsp; &nbsp;14.6M&nbsp; &nbsp; 432.0M&nbsp; &nbsp;3% /</p><br /><br /><p>For some reason I cannot keep these settings as these reset all the time on reboot, how to avoid this?<br />echo &quot;0&quot; &gt; /proc/sys/vm/swappiness ( after reboot back to 60 )<br />echo &quot;2&quot; &gt; /proc/cpu/alignment ( after reboot back to 0 )</p><br /><br /><p>When I install vsftp after pivotroot, booting off usb stick, I cannot get the vsftpd running while rebooting the slug. Is it correct this needs to be configured before the pivotroot is in place so in other words make it work in flash before moving on to boot from usb?</p><p>vi /etc/vsftpd.conf<br />&nbsp; &nbsp; &nbsp; background=YES<br />&nbsp; &nbsp; listen=YES <br />&nbsp; &nbsp; anonymous_enable=NO<br />&nbsp; &nbsp; local_enable=YES<br />&nbsp; &nbsp; write_enable=YES<br />&nbsp; &nbsp; local_umask=022<br />&nbsp; &nbsp; check_shell=NO <br />&nbsp; &nbsp; use_localtime=YES<br />&nbsp; &nbsp; xferlog_enable=NO<br />&nbsp; &nbsp; session_support=NO<br />&nbsp; &nbsp; connect_from_port_20=YES<br />&nbsp; &nbsp; chroot_local_user=YES<br />&nbsp; &nbsp; chroot_list_enable=YES<br />&nbsp; &nbsp; chroot_list_file=/etc/vsftpd.chroot_list<br />&nbsp; &nbsp; ls_recurse_enable=YES</p><p>echo &quot;root&quot; &gt; /etc/vsftpd.chroot_list<br />chmod 644 /etc/vsftpd.conf<br />ln -s /etc/init.d/vsftpd /etc/rc.d/S50vsftpd<br />/etc/init.d/vsftpd enable<br />/etc/init.d/vsftpd start</p><p>starting manually on prompt vsftpd runs fine &quot; 2311 root&nbsp; &nbsp; &nbsp; 20&nbsp; &nbsp;0&nbsp; &nbsp;808&nbsp; 204&nbsp; 148 S&nbsp; 0.0&nbsp; 0.7&nbsp; &nbsp;0:00.00 vsftpd &quot;</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>