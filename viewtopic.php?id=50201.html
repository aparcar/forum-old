<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Custom DNS server</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 23 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p230808">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">itaysk</div>
					<div class="post-datetime">
						20 Apr 2014, 13:11					</div>
				</div>
				<div class="post-content content">
					<p>Hi,<br />I have just installed OpenWRT on my Linksys WRT54GL and it works great.<br />One last step of configuration is setting up a custom DNS server. I am using &quot;unblock-us&quot; which is a service that allows me to consume services outside the USA that normally would have been blocked to me.<br />This requires changing the DNS server to theirs.<br />In luCI, I see two possible options:<br />1. under the LAN interface, there&#039;s an option to &quot;Use custom DNS servers&quot;.<br />2. under &quot;DHCP and DNS&quot; there&#039;s &quot;DNS forwardings&quot;. <br />Which one should I use? (potion 2 feels better to me).</p><p>Thanks.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p230834">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">nozombian</div>
					<div class="post-datetime">
						20 Apr 2014, 18:52					</div>
				</div>
				<div class="post-content content">
					<p>This is what works for me, but I can do it only via command line, I don&#039;t use luci:</p><p>1. vi /etc/config/resolv.user<br /># press a as for add and paste there your dns servers (these are opennic):<br />nameserver 78.138.98.82<br />nameserver 192.121.121.14<br /># :wq</p><p>2. vi /etc/config/dhcp<br /># press a and edit the resolvfile option to use the custom file you have just created:<br />&nbsp; &nbsp; &nbsp; &nbsp; option resolvfile &#039;/etc/config/resolv.user&#039;<br /># :wq</p><p>That should be it.</p>											<p class="post-edited">(Last edited by <strong>nozombian</strong> on 20 Apr 2014, 18:53)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p230835">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						20 Apr 2014, 19:27					</div>
				</div>
				<div class="post-content content">
					<p>Untick &quot;use peer dns&quot; in the wan interface and enter your custom dns servers</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p230836">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">zopico</div>
					<div class="post-datetime">
						20 Apr 2014, 19:28					</div>
				</div>
				<div class="post-content content">
					<p>Does this work with pppoe connections as well? I would hate to try this just to find out that I messed up my router.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p230838">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">itaysk</div>
					<div class="post-datetime">
						20 Apr 2014, 19:33					</div>
				</div>
				<div class="post-content content">
					<p>Ended up configuring this os the WAN interface as per this answer:https://forum.openwrt.org/viewtopic.php?id=39954<br />Seems to work fine.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p249355">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">rseiler</div>
					<div class="post-datetime">
						6 Oct 2014, 09:08					</div>
				</div>
				<div class="post-content content">
					<p>That seems to be the opinion. What I can&#039;t find though is the purpose of &quot;Use custom DNS servers&quot; in the LAN interface. Particularly considering the one in WAN is essentially hidden, the one in LAN is probably getting considerable more use.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p249422">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">written_direcon</div>
					<div class="post-datetime">
						6 Oct 2014, 20:44					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>nozombian wrote:</cite><blockquote><p>This is what works for me, but I can do it only via command line, I don&#039;t use luci:</p><p>1. vi /etc/config/resolv.user<br /># press a as for add and paste there your dns servers (these are opennic):<br />nameserver 78.138.98.82<br />nameserver 192.121.121.14<br /># :wq</p><p>2. vi /etc/config/dhcp<br /># press a and edit the resolvfile option to use the custom file you have just created:<br />&nbsp; &nbsp; &nbsp; &nbsp; option resolvfile &#039;/etc/config/resolv.user&#039;<br /># :wq</p><p>That should be it.</p></blockquote></div><p>Then do it the right way:</p><div class="codebox"><pre><code>uci set network.wan.peerdns=0
uci set network.wan.dns=&quot;8.8.8.8 8.8.4.4&quot;
uci commit network
ifup wan
/etc/init.d/dnsmasq restart</code></pre></div><p>Done :-)</p>											<p class="post-edited">(Last edited by <strong>written_direcon</strong> on 6 Oct 2014, 20:46)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>