<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> The Structure of Imghdr of DI-624S</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 9 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p56064">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">macpaul</div>
					<div class="post-datetime">
						20 Sep 2007, 12:40					</div>
				</div>
				<div class="post-content content">
					<p>Hi all,<br />I&#039;m trying to analyze the structure of imghdr of DI-624S<br />After studying the source tarball of DI-624S, I&#039;ve found the image tools are exist under tools direcory.</p><p>I&#039;ve download all the released firmwares (5 files) of DI-624S from D-LINK&#039;s website.<br />I also have used Madedit tring to split kernel+romfs and imghdr.<br />I also applied splitted firmware with tools/packbin to regenerate the firmware image.<br />And I&#039;ve convinced the analyzed firmware image should be correct.<br />But I have no jtag device so I&#039;m afraid to reflash the repacked firmware to DI-624S.<br />I&#039;ve found that webpage upgrade of DI-624S only compatible with IE browser.</p><p>The following is the imghdr structure and the log of using packbin to repack the &quot;kernel+romfs&quot; into firmware.</p><p>./packbin kenel_romfs_header.bix k 0 test.bix</p><p>(0x00-0x03) 0x60420011&nbsp; &nbsp; =fake (also magic number?, or should be (-0x04)- (-0x01)?)<br />(0x04-0x07) 0x59A0E842&nbsp; &nbsp; =magic number (from packbin)<br />(0x08-0x0B) 0x8DC90100&nbsp; &nbsp; (?)<br />(0x0C-0x0D) 0x07D7&nbsp; &nbsp; &nbsp; &nbsp; =2007<br />(0x0E-0x13) 0x061D0C0D0300=06/29 12:13:03,00 (mo,da,hr,mm,sec)<br />(0x14-0x17) 0x0036BA1c&nbsp; &nbsp; =3586588&nbsp; (size of Kernel+romfs+hdrof(kernel+romfs))<br />(0x18-0x1B) 0x00004038&nbsp; &nbsp; =0x00004038<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x40=body checksum<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x38=Header checksum<br />(0x1C-0x1F) 0x41374B5A&nbsp; &nbsp; =A7KZ<br />(0x20-0x23) 0x80470000&nbsp; &nbsp; =(magic number?)<br />(0x24-0x27) 0x000F49F4&nbsp; &nbsp; =1001972 (kernel length?)<br />(0x28-0x2B) 0x00000001&nbsp; &nbsp; =(type?)<br />(0x2C-0x2F) 0x00277000&nbsp; &nbsp; =2584576 (romfs length)</p><p>If some is interested of it I could mail the repacked firmware to you then U could try do upload it. ;p</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>