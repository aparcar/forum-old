<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> WRTSL54GS RC5 slow ethernet&lt;&gt;wan, fast wireless&lt;&gt;wan?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 27 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p40203">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">fargle</div>
					<div class="post-datetime">
						5 Jan 2007, 09:53					</div>
				</div>
				<div class="post-content content">
					<p>Okay, I&#039;m at my wit&#039;s end here, and yes, I&#039;ve searched.</p><p>I have a WRTSL54GS running White Russian RC5.&nbsp; Until recently, I&#039;ve been pretty much doing all my high-performance downloading (Linux ISO&#039;s from Easynews) via wireless - I had two boxes cabled to it, a Windows desktop and a Linux MiniITX system, but haven&#039;t used them for throughput downloading, just net access.&nbsp; I also have a MythTV box that was, until recently, hooked up via a WGA54G etherenet to wireless game adapter.&nbsp; Again, zoom.</p><p>I&#039;m on Comcast and have an 8 megabit download speed.&nbsp; On my MythTV box via the wireless converter, plugged into eth0, I can get download speeds consistently from Easynews in the 600 KB/sec range, peaking at times at 1 MB/sec.</p><p>But here&#039;s the wierd thing - I ran a cable to my basement and plugged the MythTV box directly in via a premade 50-foot drop cable.&nbsp; To the same Ethernet interface that, via the wireless converter, gets the high speeds.&nbsp; Except now, I peak out at 133 KB/sec when going out the WAN to Easynews.&nbsp; I thought hmm, maybe it&#039;s a cable problem.&nbsp; But when I set up an FTP server on the box and downloaded a 700MB file to the Windows desktop, also wired, I got nearly 64 megabits/second throughput, so it&#039;s not the cable.</p><p>So then I investigated the other Linux box and the Windows desktop, both happily wired close to the router with 6-foot drop cables.&nbsp; Same deal, 130 KB/sec maximum throughput to Easynews.&nbsp; That Linux box used to get high throughput wired to a WRT54GS.&nbsp; And at the same exact time, I can get 400 KB/sec on my Windows laptop via wireless, which is what its stack maxes out at without tweaks, which I can&#039;t be bothered to do.</p><p>So it would appear that the upshot is, I get crappy performance to the WAN when accessing it via wired hosts, but not when accessing it via wireless hosts.&nbsp; But transfers between wired hosts scream, the problem is only when going to the WAN.</p><p>Does anyone have any ideas?&nbsp; Please please?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p40224">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">Onis</div>
					<div class="post-datetime">
						5 Jan 2007, 15:39					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m struggling with same kind of problem.</p><p>My friend and I tested OpenWrt with Buffalo, Asus and Linksys (g/gs) routers. The best was Asus deluxe model. We managed to get 60mbit from LAN-&gt;WAN with Asus, ~30mbit with Linksys and 40mbit with Buffalo. All test were done by stable OpenWrt from svn.</p><p>I assume the bottleneck is in NAT conversion, with this little ~200mhz processor. Is there any way to improve LAN &lt;&gt; WAN speeds?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p40230">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">fargle</div>
					<div class="post-datetime">
						5 Jan 2007, 17:58					</div>
				</div>
				<div class="post-content content">
					<p>I thought that too, but that doesn&#039;t explain why I can get the high speeds on wireless, but not wired!&nbsp; That&#039;s what I&#039;m struggling with.&nbsp; There&#039;s definitely a difference going on somewhere between going from the wireless to the WAN and going from the wired switch to the WAN, I just can&#039;t for the life of me see what it is.</p><p>So no, it&#039;s not just NAT translation, because I can get much higher speeds on wireless than on wired.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p40234">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">khisanth</div>
					<div class="post-datetime">
						5 Jan 2007, 18:56					</div>
				</div>
				<div class="post-content content">
					<p>WRT54G v2.0 with 200mhz processor was tested to do about 30mbit routing traffic.</p><p>I have a WRTSL54GS which has a 264 mhz processor, but I haven&#039;t actually done traffic testing on it yet.</p><p>I think there is still a bit of tweaking that could be done in the iptables rules, as I feel those are where another large chunk of CPU time goes.</p>											<p class="post-edited">(Last edited by <strong>khisanth</strong> on 6 Jan 2007, 02:13)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p40236">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">fargle</div>
					<div class="post-datetime">
						5 Jan 2007, 19:09					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for the responses.&nbsp; This WRTSL54GS definitely isn&#039;t doing even a megabit on single connections through the WAN via the wired side, but is happily doing at least 8 megabits on the wireless side.&nbsp; I don&#039;t have a host outside on the WAN port to test raw routing throughput, but I may have to figure that out as well.</p><p>I think I&#039;ll have to check the iptables rules - but I can&#039;t think of how that could have many differences at all, because all of these hosts are in the same IP subnet, wired or wireless.&nbsp; It seems like there&#039;s a pretty huge bottleneck for some reason coming from the switch uplink into the CPU to go out the WAN.</p><p>One thing I need to check - the speed from wireless clients to wired clients internal, and see if there&#039;s a bottleneck there as well or not.&nbsp; Those packets wouldn&#039;t have to be routed though, either, would they?&nbsp; I can&#039;t see how since again, all are in the same subnet, so I doubt I&#039;ll see a bottleneck there either.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p40238">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">Grimson</div>
					<div class="post-datetime">
						5 Jan 2007, 19:25					</div>
				</div>
				<div class="post-content content">
					<p>Do a &quot;cat /proc/loadavg&quot; or take a look using &quot;top&quot; while you experience the slow speed, to see if the CPU is the bottleneck and which process is using the cpu up. Maybe it&#039;s a bug in the switch driver.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p40241">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">fargle</div>
					<div class="post-datetime">
						5 Jan 2007, 19:46					</div>
				</div>
				<div class="post-content content">
					<p>Great idea!</p><p>Just did it, nothing - it&#039;s staying at 0.00, all three.</p><p>I also ran &quot;top&quot;, and the only thing showing up is dropbear using max 0.5% CPU.&nbsp; Nothing wierd on the memory either.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p40242">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">Grimson</div>
					<div class="post-datetime">
						5 Jan 2007, 19:56					</div>
				</div>
				<div class="post-content content">
					<p>If you look at the interface diagram the wan and wlan is directly connected to the cpu while the ethernet ports go over the BCM5325 switch. That&#039;s the only difference I see, though I&#039;m not a developer.</p><p><a href="http://wiki.openwrt.org/OpenWrtDocs/Hardware/Linksys/WRTSL54GS#head-90ef1bbb872b0506a9aaad459f26d8871f2f4102">http://wiki.openwrt.org/OpenWrtDocs/Har â€¦ 871f2f4102</a></p><p>Maybe the problem is the connection from the BCM5325 to the CPU, in that case transfers from wlan to the ethernet clients should also be slow.</p><p>My Asus also uses the BCM5325, but I only have a 1Mbit internet connection.I&#039;ll try to do some speedtests from the ethernet to the wan ports, during the weekend.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p40243">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">fargle</div>
					<div class="post-datetime">
						5 Jan 2007, 19:56					</div>
				</div>
				<div class="post-content content">
					<p>And I looked at the iptables rules in S45firewall and /etc/firewall.user.&nbsp; I don&#039;t see anywhere at all that anything is configured in any way differently between the wireless and wired ports there.&nbsp; In fact, the only reference to the internal hosts at all are in the forward chain:</p><p>&nbsp; iptables -A FORWARD -i br0 -o br0 -j ACCEPT<br />&nbsp; iptables -A FORWARD -i $LAN -o $WAN -j ACCEPT</p><p>both of which refer onl to br0, which I believe is both wired and wireless together.</p><p>Stranger and stranger!&nbsp; Appreciate the brainstorming, and I would definitely love to hear from anyone else who can test this out and make sure they see the same thing.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p40244">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">fargle</div>
					<div class="post-datetime">
						5 Jan 2007, 20:00					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ll have to check tonight if the wireless&lt;&gt;wired is slow, I&#039;m doing this stuff remotely from work but don&#039;t have a wireless client, other than my XBox, to test with remotely.&nbsp; The XBox is hooked to a WRT54GS running DD-WRT in wireless client mode to the SL and acting as a router.&nbsp; I was using that box as the main router previously with the Linksys firmware and didn&#039;t see this wierdness.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p40248">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">Grimson</div>
					<div class="post-datetime">
						5 Jan 2007, 20:34					</div>
				</div>
				<div class="post-content content">
					<p>I just did a little test by connecting a second machine, running and ftp server, to the wan port of my Asus and got about 3,5 Mbyte/sec up and 5,1 Mbyte/sec down. I don&#039;t have any WLAN clients to test the speed there. At this rate the router CPU was running around 60% and the load was around 0.8. This is with Whiterussian 0.9 (Rev. 5967 from svn). So it&#039;s not the BCM5325 in general.</p>											<p class="post-edited">(Last edited by <strong>Grimson</strong> on 5 Jan 2007, 20:35)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p40262">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">fargle</div>
					<div class="post-datetime">
						5 Jan 2007, 23:52					</div>
				</div>
				<div class="post-content content">
					<p>Just a stab - in searches I&#039;ve seen mention of a &quot;Wired QoS&quot; setting in the Linksys firmware on some WRT models - there couldn&#039;t be something like that going on here, maybe that&#039;s a default and isn&#039;t getting changed by OpenWRT?&nbsp; That would sure explain what&#039;s going on...&nbsp; But if it was iptables-based then it&#039;s not, because that&#039;s not in my iptables setup.</p><p>Again, just a stab in the dark.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p40271">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">khisanth</div>
					<div class="post-datetime">
						6 Jan 2007, 01:58					</div>
				</div>
				<div class="post-content content">
					<p>Also curious, maybe you can run ethereal on your PC when you run the wired wan&lt;&gt;lan throughput tests. See if you&#039;re getting any packetloss.</p><p>Run Iperf on two machines - one on WAN port, one one LAN port...<br /><a href="http://dast.nlanr.net/Projects/Iperf/">http://dast.nlanr.net/Projects/Iperf/</a></p><p>My WRTSL54GS is currently on Kamikaze-2.4 svn 5897</p><p>Are you running any other Qos scripts?&nbsp; iptables -t mangle -nvL</p><p>I&#039;ve got QoS turned on but without any download limits.</p><p>Linux machine behind a WRT54Gv2-ddwrt-wireless-client-bridge<br />ftp&gt; get linux-2.6.19.1.tar.gz<br />local: linux-2.6.19.1.tar.gz remote: linux-2.6.19.1.tar.gz<br />200 PORT command successful. Consider using PASV.<br />150 Opening BINARY mode data connection for linux-2.6.19.1.tar.gz (53773703 bytes).<br />226 File send OK.<br />53773703 bytes received in 127.05 secs (413.3 kB/s)</p><p>I don&#039;t have any wired clients directly attached to the WRTSL54GS...<br />I&#039;ll test that this weekend, or sometime next week.</p>											<p class="post-edited">(Last edited by <strong>khisanth</strong> on 6 Jan 2007, 02:30)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p40297">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">fargle</div>
					<div class="post-datetime">
						6 Jan 2007, 09:02					</div>
				</div>
				<div class="post-content content">
					<p>Okay, I tried the wireless&lt;&gt;lan test, and got 2931.20 KBytes per second downloading a 700MB file.</p><p>So no bottleneck there, or at least definitely nothing like the LAN&lt;&gt;WAN one.</p><p>One thing I noticed - I had been just looking at S45firewall to see what was in iptables.&nbsp; But when I do an iptables -n -L, I see this line:</p><p>TCPMSS&nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;tcp flags:0x06/0x02 TCPMSS clamp to PMTU</p><p>where the heck did that come from?&nbsp; I didn&#039;t see it in S45firewall.&nbsp; And viewing it with iptables -v -n -L, I see that it&#039;s fired on 1305K of data, which is probably about right for LAN&lt;&gt;WAN since I downloaded a 700MB file and have done some other smaller stuff since the WRTSL54GS was rebooted.</p><p>UPDATE: Okay, I saw it in S45firewall (how did I miss that?), commented it out, reran the script, but it seems to have had little or no effect.</p>											<p class="post-edited">(Last edited by <strong>fargle</strong> on 6 Jan 2007, 09:07)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p40301">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">khisanth</div>
					<div class="post-datetime">
						6 Jan 2007, 10:48					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m thinking it might be an optimization issue in whiterussian somehow.&nbsp; I just plugged my mac powerbook directly into the WRTSL54GS switch port, and ran the same FTP test to the same site.</p><p>Also, mine is labeled WRTSL54GS v1.1 (8 MB flash, 32MB ram)</p><p>ftp&gt; get linux-2.6.19.1.tar.gz<br />local: linux-2.6.19.1.tar.gz remote: linux-2.6.19.1.tar.gz<br />229 Entering Extended Passive Mode (|||6425|)<br />150 Opening BINARY mode data connection for linux-2.6.19.1.tar.gz (53773703 bytes).<br />100% |***************************************************************| 52513 KB&nbsp; 546.78 KB/s&nbsp; &nbsp; 01:36&nbsp; &nbsp; <br />226 File send OK.<br />53773703 bytes received in 01:36 (546.35 KB/s)</p><p>I have a 6000 down/768 up kbps DSL line.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p40329">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">fargle</div>
					<div class="post-datetime">
						6 Jan 2007, 21:48					</div>
				</div>
				<div class="post-content content">
					<p>Hmm.&nbsp; Mine just says WRTSL54GS on the label, CJK0 serial number, and has 8 MB of flash.</p><p>So yours gets fine throughput on Kamikaze, hmm?</p><p>I&#039;m trying to decide at this point whether to try that or try DD-WRT, I&#039;m using it on my WRT54GS running as a wireless client router and it&#039;s quite nice with a great Web interface as well - best of both worlds.</p><p>Well, thanks for the info and for trying things, all - I&#039;m still struggling to see where the problem can be, since it&#039;s obviously not the switch coming into the CPU after my wireless&lt;&gt;lan test was happy.&nbsp; It&#039;s not that White Russian isn&#039;t optimized, it&#039;s that there&#039;s something markedly different between the wireless and the wired going to the WAN only.</p><p>Ah well.&nbsp; Again, thanks all.&nbsp; If anyone finds anything else of interest I&#039;d still love to hear it!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p40330">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">Grimson</div>
					<div class="post-datetime">
						6 Jan 2007, 21:55					</div>
				</div>
				<div class="post-content content">
					<p>You could try the 0.9 test version: <a href="http://downloads.openwrt.org/people/nbd/09test/">http://downloads.openwrt.org/people/nbd/09test/</a> but this is also a stab in the dark.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p40367">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">fargle</div>
					<div class="post-datetime">
						7 Jan 2007, 11:14					</div>
				</div>
				<div class="post-content content">
					<p>Well, I loaded up DD-WRT v23SP2 on the box, and same thing.&nbsp; &nbsp;Sigh.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p40390">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">fargle</div>
					<div class="post-datetime">
						7 Jan 2007, 19:33					</div>
				</div>
				<div class="post-content content">
					<p>And I downloaded a 700MB file via wireless to my Dell laptop running Ubuntu (much better TCP stack than Windows) at 1.25 MB/second.&nbsp; Still maxed out at 133 KB/second from the wired Linux box.</p><p>Sigh.&nbsp; I wonder if this thing had a hardware problem?&nbsp; It&#039;s not showing any errors anywhere though.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p40393">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">khisanth</div>
					<div class="post-datetime">
						7 Jan 2007, 20:35					</div>
				</div>
				<div class="post-content content">
					<p>It sounds like maybe a duplex mismatch issue, but if you&#039;re not seeing any errors, I&#039;m not sure.</p><p>Could you run Ethereal each time when running the download, then analyze the trace using the Filter: tcp.analysis.flags to see if you&#039;re getting more lost segments wired vs wireless?</p>											<p class="post-edited">(Last edited by <strong>khisanth</strong> on 7 Jan 2007, 20:36)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>