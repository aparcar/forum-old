<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Multi-WAN Load Balancing</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 29 Mar 2018 and 3 May 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 14 of 14</div><nav><ul><li><a href="viewtopic.php%3Fid=23904&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=23904&amp;p=12.html">12</a></li><li><a href="viewtopic.php%3Fid=23904&amp;p=13.html">13</a></li><li class="pagination-current"><span>14</span></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p165983">
				<div class="post-metadata">
					<div class="post-num">Post #326</div>
					<div class="post-author">Sorbe</div>
					<div class="post-datetime">
						28 Apr 2012, 05:06					</div>
				</div>
				<div class="post-content content">
					<p>Same gateway address for both WANs = trouble load-balancing AFAIK.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p165984">
				<div class="post-metadata">
					<div class="post-num">Post #327</div>
					<div class="post-author">_Pink_</div>
					<div class="post-datetime">
						28 Apr 2012, 05:21					</div>
				</div>
				<div class="post-content content">
					<p>Yup, no idea why.</p><p>Also, as you can tell I have the same ISP. Is it possible to channel bond the connection through two cable wan&#039;s?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p165985">
				<div class="post-metadata">
					<div class="post-num">Post #328</div>
					<div class="post-author">freddyarenas</div>
					<div class="post-datetime">
						28 Apr 2012, 07:29					</div>
				</div>
				<div class="post-content content">
					<p>I want tell all users asking for support in same gateway loadbalancing,</p><p>well this is a multiwan bug, i checked when i got the same gateway of my ISP, because i have the 2 internet lines of the same ISP.</p><p>To fix that, you must NAT the lines to have differents gateway because if the multiwan check you have gateway with the same IP, he will think is only 1 internet line so this will not balance.</p><p>Also the MultiWan is bug with QoS, they cannot work together.. multiwan do not make the QoS work, that is the only very bad bug here.</p><p>I need QoS with my MultiWans, the script must be get fixed soon because it will kill my mind thinking how fix that!</p>											<p class="post-edited">(Last edited by <strong>freddyarenas</strong> on 28 Apr 2012, 07:31)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p166300">
				<div class="post-metadata">
					<div class="post-num">Post #329</div>
					<div class="post-author">Jermin</div>
					<div class="post-datetime">
						2 May 2012, 10:10					</div>
				</div>
				<div class="post-content content">
					<p>Can anyone please upload the two files posted in the first post? The provided links are dead.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p167974">
				<div class="post-metadata">
					<div class="post-num">Post #330</div>
					<div class="post-author">ScHwAnG</div>
					<div class="post-datetime">
						23 May 2012, 09:15					</div>
				</div>
				<div class="post-content content">
					<p>Hi All,</p><p>Wondering if someone might lend me their wisdom for this issue I&#039;m getting - I&#039;m sure I&#039;ve screwed something up but not 100% sure where.<br />Have configured a Netgear WNDR3700v2 with Multi-WAN installed from vanilla 10.03.1 and the multi-wan package from the luci interface.<br />It appears that all my traffic goes down the PPPoE interface - this is the only one displayed in the Status - Overview.<br />ip route gives:</p><p>203.215.17.248 dev pppoe-wan1&nbsp; proto kernel&nbsp; scope link&nbsp; src 203.206.128.62<br />192.168.16.0/24 dev br-lan&nbsp; proto kernel&nbsp; scope link&nbsp; src 192.168.16.1<br />203.33.119.0/24 dev eth1&nbsp; proto kernel&nbsp; scope link&nbsp; src 203.33.119.250<br />default via 203.215.17.248 dev pppoe-wan1<br />default via 203.33.119.1 dev eth1</p><p>So I can see that both default gateways are present - but ip route show table 123 gives nothing, making me think I&#039;ve done something wrong</p><br /><p>cat /etc/config/network</p><p>config &#039;interface&#039; &#039;loopback&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ifname&#039; &#039;lo&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;proto&#039; &#039;static&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ipaddr&#039; &#039;127.0.0.1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;netmask&#039; &#039;255.0.0.0&#039;</p><p>config &#039;interface&#039; &#039;lan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ifname&#039; &#039;eth0.1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;type&#039; &#039;bridge&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;proto&#039; &#039;static&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;netmask&#039; &#039;255.255.255.0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ipaddr&#039; &#039;192.168.16.1&#039;</p><p>config &#039;interface&#039; &#039;wan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ifname&#039; &#039;eth1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;_orig_ifname&#039; &#039;eth1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;_orig_bridge&#039; &#039;false&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;proto&#039; &#039;static&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ipaddr&#039; &#039;203.33.119.250&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;netmask&#039; &#039;255.255.255.0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;gateway&#039; &#039;203.33.119.1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;dns&#039; &#039;203.33.113.3&#039;</p><p>config &#039;switch&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;name&#039; &#039;rtl8366s&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;reset&#039; &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;enable_vlan&#039; &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;blinkrate&#039; &#039;2&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;enable_vlan4k&#039; &#039;1&#039;</p><p>config &#039;switch_vlan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;device&#039; &#039;rtl8366s&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;vlan&#039; &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ports&#039; &#039;0 1 2 5t&#039;</p><p>config &#039;switch_port&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;device&#039; &#039;rtl8366s&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;port&#039; &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;led&#039; &#039;6&#039;</p><p>config &#039;switch_port&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;device&#039; &#039;rtl8366s&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;port&#039; &#039;2&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;led&#039; &#039;9&#039;</p><p>config &#039;switch_port&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;device&#039; &#039;rtl8366s&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;port&#039; &#039;5&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;led&#039; &#039;2&#039;</p><p>config &#039;switch_vlan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;device&#039; &#039;rtl8366s&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;vlan&#039; &#039;2&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ports&#039; &#039;3 5t&#039;</p><p>config &#039;interface&#039; &#039;wan1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;proto&#039; &#039;pppoe&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ifname&#039; &#039;eth0.2&#039;</p><p>cat /etc/config/multiwan</p><p>config &#039;multiwan&#039; &#039;config&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;default_route&#039; &#039;fastbalancer&#039;</p><p>config &#039;interface&#039; &#039;wan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;timeout&#039; &#039;3&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;health_fail_retries&#039; &#039;3&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;health_recovery_retries&#039; &#039;5&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;dns&#039; &#039;auto&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;health_interval&#039; &#039;disable&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;icmp_hosts&#039; &#039;disable&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;weight&#039; &#039;5&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;failover_to&#039; &#039;disable&#039;</p><p>config &#039;mwanfw&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;wanrule&#039; &#039;fastbalancer&#039;</p><p>config &#039;interface&#039; &#039;wan1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;timeout&#039; &#039;3&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;health_fail_retries&#039; &#039;3&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;health_recovery_retries&#039; &#039;5&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;dns&#039; &#039;auto&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;failover_to&#039; &#039;disable&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;health_interval&#039; &#039;disable&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;icmp_hosts&#039; &#039;disable&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;weight&#039; &#039;5&#039;</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p168046">
				<div class="post-metadata">
					<div class="post-num">Post #331</div>
					<div class="post-author">TurtleTech</div>
					<div class="post-datetime">
						24 May 2012, 02:34					</div>
				</div>
				<div class="post-content content">
					<p>Use these commands:</p><p>ip route show table LoadBalancer<br />iptables -L MultiWanRules -t mangle -v<br />ip route get xxx.xxx.xxx.xxx<br />ping -c 100 -s 1400 -W 10 -I eth0.1&nbsp; 4.2.2.2</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p170175">
				<div class="post-metadata">
					<div class="post-num">Post #332</div>
					<div class="post-author">alexalouit</div>
					<div class="post-datetime">
						17 Jun 2012, 15:24					</div>
				</div>
				<div class="post-content content">
					<p>Hi all,</p><p>I recently test to run openwrt with multi wan package (with 2 wan connections in dhcp, x86 plateform, not to switch vlan..).</p><p>Here is my network and multiwan configuration</p><p>----------------<br />cat /etc/config/network<br />config interface &#039;loopback&#039;<br />&nbsp; &nbsp; option ifname &#039;lo&#039;<br />&nbsp; &nbsp; option proto &#039;static&#039;<br />&nbsp; &nbsp; option ipaddr &#039;127.0.0.1&#039;<br />&nbsp; &nbsp; option netmask &#039;255.0.0.0&#039;</p><p>config interface &#039;lan&#039;<br />&nbsp; &nbsp; option ifname &#039;eth0&#039;<br />&nbsp; &nbsp; option type &#039;bridge&#039;<br />&nbsp; &nbsp; option proto &#039;static&#039;<br />&nbsp; &nbsp; option netmask &#039;255.255.255.0&#039;<br />&nbsp; &nbsp; option ipaddr &#039;192.168.2.251&#039;<br />&nbsp; &nbsp; option stp &#039;1&#039;<br />&nbsp; &nbsp; option broadcast &#039;192.168.2.255&#039;</p><p>config interface &#039;wan&#039;<br />&nbsp; &nbsp; option proto &#039;dhcp&#039;<br />&nbsp; &nbsp; option _orig_ifname &#039;eth1&#039;<br />&nbsp; &nbsp; option _orig_bridge &#039;false&#039;<br />&nbsp; &nbsp; option ifname &#039;eth1&#039;<br />&nbsp; &nbsp; option accept_ra &#039;0&#039;<br />&nbsp; &nbsp; option send_rs &#039;1&#039;<br />&nbsp; &nbsp; option gateway &#039;0&#039;</p><p>config interface &#039;wan2&#039;<br />&nbsp; &nbsp; option proto &#039;dhcp&#039;<br />&nbsp; &nbsp; option _orig_ifname &#039;eth2&#039;<br />&nbsp; &nbsp; option _orig_bridge &#039;false&#039;<br />&nbsp; &nbsp; option ifname &#039;eth2&#039;<br />&nbsp; &nbsp; option accept_ra &#039;0&#039;<br />&nbsp; &nbsp; option send_rs &#039;1&#039;<br />&nbsp; &nbsp; option gateway &#039;0&#039;</p><p>----------------<br />cat /etc/config/multiwan<br />config multiwan &#039;config&#039;<br />&nbsp; &nbsp; option health_monitor &#039;serial&#039;<br />&nbsp; &nbsp; option enabled &#039;1&#039;<br />&nbsp; &nbsp; option debug &#039;1&#039;<br />&nbsp; &nbsp; option default_route &#039;fastbalancer&#039;</p><p>config interface &#039;wan&#039;<br />&nbsp; &nbsp; option dns &#039;auto&#039;<br />&nbsp; &nbsp; option timeout &#039;3&#039;<br />&nbsp; &nbsp; option weight &#039;10&#039;<br />&nbsp; &nbsp; option health_interval &#039;5&#039;<br />&nbsp; &nbsp; option icmp_hosts &#039;disable&#039;<br />&nbsp; &nbsp; option health_fail_retries &#039;3&#039;<br />&nbsp; &nbsp; option health_recovery_retries &#039;3&#039;<br />&nbsp; &nbsp; option failover_to &#039;wan2&#039;</p><p>config interface &#039;wan2&#039;<br />&nbsp; &nbsp; option dns &#039;auto&#039;<br />&nbsp; &nbsp; option timeout &#039;3&#039;<br />&nbsp; &nbsp; option weight &#039;10&#039;<br />&nbsp; &nbsp; option health_interval &#039;5&#039;<br />&nbsp; &nbsp; option icmp_hosts &#039;disable&#039;<br />&nbsp; &nbsp; option health_fail_retries &#039;3&#039;<br />&nbsp; &nbsp; option health_recovery_retries &#039;3&#039;<br />&nbsp; &nbsp; option failover_to &#039;wan&#039;</p><p>----------------<br />ip route show table LoadBalancer<br />default&nbsp; proto static <br />&nbsp; &nbsp; nexthop dev eth1 weight 10<br />&nbsp; &nbsp; nexthop dev eth2 weight 10<br />wan1sub/24 dev eth1&nbsp; proto kernel&nbsp; scope link&nbsp; src wan1ip <br />wan2sub/24 dev eth2&nbsp; proto kernel&nbsp; scope link&nbsp; src wan2ip <br />192.168.2.0/24 dev br-lan&nbsp; proto kernel&nbsp; scope link&nbsp; src 192.168.2.251 </p><p>----------------<br />ip route<br />wan1sub/24 dev eth1&nbsp; proto kernel&nbsp; scope link&nbsp; src wan1ip <br />wan2sub/24 dev eth2&nbsp; proto kernel&nbsp; scope link&nbsp; src wan2ip <br />192.168.2.0/24 dev br-lan&nbsp; proto kernel&nbsp; scope link&nbsp; src 192.168.2.251</p><br /><p>Only one wan works, the multi wan distribution is not done. Do you have an idea?</p><p>ping -I eth1&nbsp; 8.8.8.8<br />is down<br />ping -I eth2&nbsp; 8.8.4.4<br />is down</p><br /><p>When I add the manually the route (ip route add default via wan1gw dev eth1 metric 0 &amp;&amp; ip route add default via wan2gw.xxx.xxx.xxx dev eth2 metric 1), the 2 ping work, but the router distribution is not done..</p><p>I feel badly that the packets are routed, or the routes are poorly added.<br />Did I miss something?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p174042">
				<div class="post-metadata">
					<div class="post-num">Post #333</div>
					<div class="post-author">alexalouit</div>
					<div class="post-datetime">
						4 Aug 2012, 13:04					</div>
				</div>
				<div class="post-content content">
					<p><a href="https://dev.openwrt.org/ticket/11780">https://dev.openwrt.org/ticket/11780</a> patch solved my problem (thank&#039;s to cb1986ster)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p187540">
				<div class="post-metadata">
					<div class="post-num">Post #334</div>
					<div class="post-author">yanggis</div>
					<div class="post-datetime">
						1 Jan 2013, 11:43					</div>
				</div>
				<div class="post-content content">
					<p>Does Multiwan&nbsp; work if the WAN connections are on the same subnet and share the same default gateway?<br />I have two connections provides by the same isp and both protocols are DHCP. <br />When I setup the both WAN connections, I always get two IP addresses having the same subnet and share the same default gateway. <br />Does Multiwan work for this condition?</p><p>Kernel IP routing table<br />Destination&nbsp; &nbsp; &nbsp;Gateway&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Genmask&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Flags Metric Ref&nbsp; &nbsp; Use Iface<br />default&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;172.24.210.1&nbsp; &nbsp; 0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;UG&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 eth2<br />default&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;172.24.210.1&nbsp; &nbsp; 0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;UG&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 eth0.2<br />172.24.210.0&nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.255.254.0&nbsp; &nbsp;U&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 eth0.2<br />172.24.210.0&nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.255.254.0&nbsp; &nbsp;U&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 eth2<br />192.168.1.0&nbsp; &nbsp; &nbsp;*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.255.255.0&nbsp; &nbsp;U&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 br-lan</p>											<p class="post-edited">(Last edited by <strong>yanggis</strong> on 1 Jan 2013, 11:47)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p206045">
				<div class="post-metadata">
					<div class="post-num">Post #335</div>
					<div class="post-author">Almaz</div>
					<div class="post-datetime">
						30 Jun 2013, 08:07					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>SouthPawn wrote:</cite><blockquote><div class="quotebox"><cite>cowboydrg wrote:</cite><blockquote><p>root@OpenWrt:/# ip rule<br />ip: RTNETLINK answers: Operation not supported<br />ip: dump terminated</p></blockquote></div><p>There&#039;s the problem, it sounds like this would most likely be caused by CONFIG_IP_MULTIPLE_TABLES not being enabled in your kernel.</p><p>The reason ifdown wan2 seemingly makes it work is not because it enables failover, but because it disables the last configured interface, leaving the first wan to be the only default route and therefore all traffic goes through it. In the current setup you would see the same behavior with or without the Multi-WAN script.</p><p>Hope this helps,<br />-Craig</p></blockquote></div><br /><p>How to check if IP_MULTIPLE_TABLES is enabled in Kernel?<br />&nbsp; <br />Linksys WRT160N<br />OpenWrt Backfire 10.03.1 / LuCI 0.10.0 Release (0.10.0)<br />Kernel Version&nbsp; &nbsp; 2.4.37.9</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p206046">
				<div class="post-metadata">
					<div class="post-num">Post #336</div>
					<div class="post-author">Almaz</div>
					<div class="post-datetime">
						30 Jun 2013, 08:07					</div>
				</div>
				<div class="post-content content">
					<p>Looks like I got it somehow MultiWan script working but I&#039;m getting another error.&nbsp; </p><p>OpenWrt user.notice multiwan: Performance load balancer(fastbalanacer) is unavailable due to current kernel limitations.<br />OpenWrt daemon.info dnsmasq[1117]: reading /tmp/resolv.conf.auto<br />OpenWrt daemon.info dnsmasq[1117]: using nameserver 8.8.8.8#53<br />OpenWrt daemon.info dnsmasq[1117]: using nameserver 8.8.8.8#53<br />OpenWrt daemon.info dnsmasq[1117]: using local addresses only for domain lan<br />OpenWrt user.notice multiwan: Succesfully Initialized</p><p>Can anyone suggest what should I do about it?</p>											<p class="post-edited">(Last edited by <strong>Almaz</strong> on 30 Jun 2013, 12:01)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p211735">
				<div class="post-metadata">
					<div class="post-num">Post #337</div>
					<div class="post-author">Ramesh_P</div>
					<div class="post-datetime">
						6 Sep 2013, 14:27					</div>
				</div>
				<div class="post-content content">
					<p>Hi SouthPawn,</p><p>I&#039;m newbee to this, it may be silly question to you but still i want this information badly.<br />How can download your script, and also please provide me configuration details through multwan web page from openWRT.<br />and also it will be helpful if you provide me how to configure multiwan step-by-step.</p><p>thanks in advance.</p>											<p class="post-edited">(Last edited by <strong>Ramesh_P</strong> on 6 Sep 2013, 14:27)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p214954">
				<div class="post-metadata">
					<div class="post-num">Post #338</div>
					<div class="post-author">r1ppz</div>
					<div class="post-datetime">
						16 Oct 2013, 18:56					</div>
				</div>
				<div class="post-content content">
					<p>It seems that I can&#039;t use WANs on the same subnet even if the gateway IP is different:<br /><a href="https://forum.openwrt.org/viewtopic.php?id=46804">https://forum.openwrt.org/viewtopic.php?id=46804</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p224810">
				<div class="post-metadata">
					<div class="post-num">Post #339</div>
					<div class="post-author">diraol</div>
					<div class="post-datetime">
						8 Feb 2014, 05:32					</div>
				</div>
				<div class="post-content content">
					<p>Hello friends, I&#039;m trying to setup a mutiwan configuration with load balancing, but there is something going wrong and I can&#039;t find out what is.</p><p>I&#039;ve done almost everything from the web interface, but if I need to go to the console mode I have no problems with that.</p><p>I have two ISPs, both of them with routers that do a NAT configuration, giving me just the local C class IP address.</p><p>My personal router, with OpenWRT, is a Buffalo WZR-HP-G300NH.</p><p>I have already installed the multiwan package and tryied to configure it, but I just can get the packages to flow from one of both connections.<br />Currently situation:<br /><strong>A</strong> - 1 Router (ISP) with public IP address starting in 2**.*.*.* and private address on the range of 192.168.0.0<br /><strong>B</strong> - 1 Router (ISP) with public IP address starting in 1**.*.*.* and private address on the range of 192.168.1.0<br /><strong>C</strong> - My private Router with OpenWRT serving the local network on the range 172.16.20.0.</p><p>I have setup the <strong>C</strong> router to have two WAN ports (and it seems to be working ok), but the load balancing and failsafe is not working.</p><p>Below are some informations from my <strong>C</strong> router:<br /><strong># route</strong><br /></p><div class="codebox"><pre><code>Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
172.16.20.0     *               255.255.255.0   U     0      0        0 br-lan
192.168.1.0     *               255.255.255.0   U     0      0        0 eth0.2
192.168.0.0     *               255.255.255.0   U     0      0        0 eth1
default         MyRouter.Home   0.0.0.0         UG    0      0        0 eth0.2</code></pre></div><p> </p><p><strong>ifconfig</strong><br /></p><div class="codebox"><pre><code>br-lan    Link encap:Ethernet  HWaddr 00:1D:73:8F:69:96  
          inet addr:172.16.20.1  Bcast:172.16.20.254  Mask:255.255.255.0
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:17098440 errors:0 dropped:0 overruns:0 frame:0
          TX packets:16875315 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:2235357076 (2.0 GiB)  TX bytes:3282329585 (3.0 GiB)

eth0      Link encap:Ethernet  HWaddr 00:1D:73:8F:69:96  
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:33966054 errors:0 dropped:0 overruns:93388 frame:0
          TX packets:33865088 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:1590958719 (1.4 GiB)  TX bytes:1483812589 (1.3 GiB)
          Interrupt:4 

eth0.1    Link encap:Ethernet  HWaddr 00:1D:73:8F:69:96  
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:17011830 errors:0 dropped:0 overruns:0 frame:0
          TX packets:16789820 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:2287658164 (2.1 GiB)  TX bytes:3247708115 (3.0 GiB)

eth0.2    Link encap:Ethernet  HWaddr 00:1D:73:8F:69:96  
          inet addr:192.168.1.11  Bcast:192.168.1.255  Mask:255.255.255.0
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:16953844 errors:0 dropped:0 overruns:0 frame:0
          TX packets:17075261 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:3122683035 (2.9 GiB)  TX bytes:2531070219 (2.3 GiB)

eth1      Link encap:Ethernet  HWaddr 00:1D:73:8F:69:97  
          inet addr:192.168.0.5  Bcast:192.168.0.255  Mask:255.255.255.0
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:62369 errors:0 dropped:0 overruns:0 frame:0
          TX packets:2972 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:19301889 (18.4 MiB)  TX bytes:309756 (302.4 KiB)
          Interrupt:5 

lo        Link encap:Local Loopback  
          inet addr:127.0.0.1  Mask:255.0.0.0
          UP LOOPBACK RUNNING  MTU:16436  Metric:1
          RX packets:130 errors:0 dropped:0 overruns:0 frame:0
          TX packets:130 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:12623 (12.3 KiB)  TX bytes:12623 (12.3 KiB)

mon.wlan0 Link encap:UNSPEC  HWaddr 00-1D-73-8F-69-96-00-00-00-00-00-00-00-00-00-00  
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:3121977 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:32 
          RX bytes:755147745 (720.1 MiB)  TX bytes:0 (0.0 B)

wlan0     Link encap:Ethernet  HWaddr 00:1D:73:8F:69:96  
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:94031 errors:0 dropped:0 overruns:0 frame:0
          TX packets:133361 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:32 
          RX bytes:19506653 (18.6 MiB)  TX bytes:117832293 (112.3 MiB)</code></pre></div><p><strong>/etc/config/network</strong><br /></p><div class="codebox"><pre><code>config &#039;interface&#039; &#039;loopback&#039;
    option &#039;ifname&#039; &#039;lo&#039;
    option &#039;proto&#039; &#039;static&#039;
    option &#039;ipaddr&#039; &#039;127.0.0.1&#039;
    option &#039;netmask&#039; &#039;255.0.0.0&#039;

config &#039;interface&#039; &#039;lan&#039;
    option &#039;type&#039; &#039;bridge&#039;
    option &#039;proto&#039; &#039;static&#039;
    option &#039;netmask&#039; &#039;255.255.255.0&#039;
    option &#039;ipaddr&#039; &#039;172.16.20.1&#039;
    option &#039;gateway&#039; &#039;172.16.20.1&#039;
    option &#039;broadcast&#039; &#039;172.16.20.254&#039;
    option &#039;_orig_ifname&#039; &#039;eth0 wlan0&#039;
    option &#039;_orig_bridge&#039; &#039;true&#039;
    option &#039;ifname&#039; &#039;eth0.1&#039;
    option &#039;dns&#039; &#039;208.67.222.222 208.67.220.220 8.8.8.8 8.8.4.4&#039;

config &#039;interface&#039; &#039;wan1&#039;
    option &#039;ifname&#039; &#039;eth1&#039;
    option &#039;proto&#039; &#039;dhcp&#039;
    option &#039;hostname&#039; &#039;BuffaloETH1&#039;

config &#039;switch&#039;
    option &#039;name&#039; &#039;switch0&#039;
    option &#039;reset&#039; &#039;1&#039;
    option &#039;enable_vlan&#039; &#039;1&#039;
    option &#039;enable_vlan4k&#039; &#039;1&#039;

config &#039;switch_vlan&#039;
    option &#039;device&#039; &#039;switch0&#039;
    option &#039;vlan&#039; &#039;1&#039;
    option &#039;ports&#039; &#039;1 2 3 5t&#039;

config &#039;switch_vlan&#039;
    option &#039;device&#039; &#039;switch0&#039;
    option &#039;vlan&#039; &#039;2&#039;
    option &#039;ports&#039; &#039;0 5t&#039;

config &#039;interface&#039; &#039;wan2&#039;
    option &#039;proto&#039; &#039;dhcp&#039;
    option &#039;ifname&#039; &#039;eth0.2&#039;
    option &#039;hostname&#039; &#039;BuffaloWAN2&#039;</code></pre></div><p><strong>/etc/config/multiwan</strong><br /></p><div class="codebox"><pre><code>config &#039;multiwan&#039; &#039;config&#039;
    option &#039;default_route&#039; &#039;balancer&#039;

config &#039;interface&#039; &#039;wan2&#039;
    option &#039;health_interval&#039; &#039;10&#039;
    option &#039;icmp_hosts&#039; &#039;gateway&#039;
    option &#039;timeout&#039; &#039;3&#039;
    option &#039;health_fail_retries&#039; &#039;3&#039;
    option &#039;health_recovery_retries&#039; &#039;5&#039;
    option &#039;failover_to&#039; &#039;balancer&#039;
    option &#039;dns&#039; &#039;auto&#039;
    option &#039;weight&#039; &#039;10&#039;

config &#039;interface&#039; &#039;wan1&#039;
    option &#039;weight&#039; &#039;10&#039;
    option &#039;health_interval&#039; &#039;10&#039;
    option &#039;icmp_hosts&#039; &#039;dns&#039;
    option &#039;timeout&#039; &#039;3&#039;
    option &#039;health_fail_retries&#039; &#039;3&#039;
    option &#039;health_recovery_retries&#039; &#039;5&#039;
    option &#039;failover_to&#039; &#039;balancer&#039;
    option &#039;dns&#039; &#039;auto&#039;</code></pre></div><p><strong>/etc/config/firewall</strong><br /></p><div class="codebox"><pre><code>config &#039;defaults&#039;
    option &#039;syn_flood&#039; &#039;1&#039;
    option &#039;input&#039; &#039;ACCEPT&#039;
    option &#039;output&#039; &#039;ACCEPT&#039;
    option &#039;forward&#039; &#039;REJECT&#039;
    option &#039;drop_invalid&#039; &#039;1&#039;

config &#039;zone&#039;
    option &#039;name&#039; &#039;lan&#039;
    option &#039;network&#039; &#039;lan&#039;
    option &#039;input&#039; &#039;ACCEPT&#039;
    option &#039;output&#039; &#039;ACCEPT&#039;
    option &#039;forward&#039; &#039;REJECT&#039;

config &#039;zone&#039;
    option &#039;name&#039; &#039;wan&#039;
    option &#039;input&#039; &#039;REJECT&#039;
    option &#039;output&#039; &#039;ACCEPT&#039;
    option &#039;forward&#039; &#039;REJECT&#039;
    option &#039;masq&#039; &#039;1&#039;
    option &#039;mtu_fix&#039; &#039;1&#039;
    option &#039;network&#039; &#039;wan1 wan2&#039;

config &#039;forwarding&#039;
    option &#039;src&#039; &#039;lan&#039;
    option &#039;dest&#039; &#039;wan&#039;

config &#039;rule&#039;
    option &#039;name&#039; &#039;Allow-DHCP-Renew&#039;
    option &#039;src&#039; &#039;wan&#039;
    option &#039;proto&#039; &#039;udp&#039;
    option &#039;dest_port&#039; &#039;68&#039;
    option &#039;target&#039; &#039;ACCEPT&#039;
    option &#039;family&#039; &#039;ipv4&#039;

config &#039;rule&#039;
    option &#039;name&#039; &#039;Allow-DHCPv6&#039;
    option &#039;src&#039; &#039;wan&#039;
    option &#039;proto&#039; &#039;udp&#039;
    option &#039;src_ip&#039; &#039;fe80::/10&#039;
    option &#039;src_port&#039; &#039;547&#039;
    option &#039;dest_ip&#039; &#039;fe80::/10&#039;
    option &#039;dest_port&#039; &#039;546&#039;
    option &#039;family&#039; &#039;ipv6&#039;
    option &#039;target&#039; &#039;ACCEPT&#039;

config &#039;rule&#039;
    option &#039;name&#039; &#039;Allow-ICMPv6-Input&#039;
    option &#039;src&#039; &#039;wan&#039;
    option &#039;proto&#039; &#039;icmp&#039;
    list &#039;icmp_type&#039; &#039;echo-request&#039;
    list &#039;icmp_type&#039; &#039;destination-unreachable&#039;
    list &#039;icmp_type&#039; &#039;packet-too-big&#039;
    list &#039;icmp_type&#039; &#039;time-exceeded&#039;
    list &#039;icmp_type&#039; &#039;bad-header&#039;
    list &#039;icmp_type&#039; &#039;unknown-header-type&#039;
    list &#039;icmp_type&#039; &#039;router-solicitation&#039;
    list &#039;icmp_type&#039; &#039;neighbour-solicitation&#039;
    option &#039;limit&#039; &#039;1000/sec&#039;
    option &#039;family&#039; &#039;ipv6&#039;
    option &#039;target&#039; &#039;ACCEPT&#039;

config &#039;rule&#039;
    option &#039;name&#039; &#039;Allow-ICMPv6-Forward&#039;
    option &#039;src&#039; &#039;wan&#039;
    option &#039;dest&#039; &#039;*&#039;
    option &#039;proto&#039; &#039;icmp&#039;
    list &#039;icmp_type&#039; &#039;echo-request&#039;
    list &#039;icmp_type&#039; &#039;destination-unreachable&#039;
    list &#039;icmp_type&#039; &#039;packet-too-big&#039;
    list &#039;icmp_type&#039; &#039;time-exceeded&#039;
    list &#039;icmp_type&#039; &#039;bad-header&#039;
    list &#039;icmp_type&#039; &#039;unknown-header-type&#039;
    option &#039;limit&#039; &#039;1000/sec&#039;
    option &#039;family&#039; &#039;ipv6&#039;
    option &#039;target&#039; &#039;ACCEPT&#039;

config &#039;include&#039;
    option &#039;path&#039; &#039;/etc/firewall.user&#039;</code></pre></div><p><strong>ip route show table LoadBalancer</strong><br /></p><div class="codebox"><pre><code>172.16.20.0/24 dev br-lan  proto kernel  scope link  src 172.16.20.1 
192.168.1.0/24 dev eth0.2  proto kernel  scope link  src 192.168.1.11 
192.168.0.0/24 dev eth1  proto kernel  scope link  src 192.168.0.5 
default via 192.168.1.1 dev eth0.2  proto static </code></pre></div><p><strong>iptables -L MultiWanRules -t mangle -v</strong><br /></p><div class="codebox"><pre><code>Chain MultiWanRules (1 references)
 pkts bytes target     prot opt in     out     source               destination         
   30  1800 FW1MARK    all  --  any    any     anywhere             www.whatismyipaddress.eu mark match 0x0 
 269K   33M LoadBalancer  all  --  any    any     anywhere             anywhere            mark match 0x0 
    0     0 LoadBalancer  all  --  any    any     anywhere             anywhere            mark match 0x0 </code></pre></div><p>And if I try to ping from the eth1 interface (192.168.0.*) I don&#039;t get any answer back.</p><p>Thanks for any help!</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 14 of 14</div><nav><ul><li><a href="viewtopic.php%3Fid=23904&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=23904&amp;p=12.html">12</a></li><li><a href="viewtopic.php%3Fid=23904&amp;p=13.html">13</a></li><li class="pagination-current"><span>14</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>