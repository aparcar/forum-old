<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Cron+script to reset wireless</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 19 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p175780">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">industrial</div>
					<div class="post-datetime">
						25 Aug 2012, 13:22					</div>
				</div>
				<div class="post-content content">
					<p>Hello, because of some reason my wifi on wr-741nd sometimes just turn off and i need just to enable it to get it work, but because i don&#039;t wish to do that every time that happen i wish to enable script in cron that will do that for me on 2 hour basis. so i created script in folder /usr/bin/ with filename wifionoff chmode it 777, and this is whole content of script:</p><p>uci set wireless.@wifi-device[0].disabled=1 &amp;&amp; wifi<br />uci set wireless.@wifi-device[0].disabled=0 &amp;&amp; wifi</p><p>when i call it from console it does its job as it suppose to do but when i put it in cron in any setup it simply would not run.</p><p>i try to set it up on correct time like</p><p>0 14 * * * wifionoff</p><p>then i try like on 2 hours <br />0 */2 * * * wifionoff</p><p>then i try on 15 min base</p><p>*/15 * * * * wifionoff</p><p>but it still just wont wish to run....<br />can u help me to see where i made mistake. i suspect that i made some of next mistakes:<br />1. Make cron run correctly?<br />2. Made something wrong with script thou it run from ssh console?<br />3. Made mistake in cron scheduling setup?</p><p>btw this is hw/sw info<br />Router Name&nbsp; &nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &nbsp; OpenWrt<br />Router Model&nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; TP-Link TL-WR741N/ND v4<br />Firmware Version &nbsp; &nbsp; OpenWrt Attitude Adjustment r32782 / LuCI Trunk (trunk+svn8887)<br />Kernel Version&nbsp; &nbsp; &nbsp;&nbsp; &nbsp; 3.3.8</p>											<p class="post-edited">(Last edited by <strong>industrial</strong> on 25 Aug 2012, 13:24)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p175799">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">vargalex</div>
					<div class="post-datetime">
						26 Aug 2012, 00:24					</div>
				</div>
				<div class="post-content content">
					<p>Hi!</p><p>Have you stared the cron daemon, after you added your crontab to /etc/crontabs/root? Or have you rebooted?</p><p>The crond init script dont starts the daemon when your crontab file is empty.</p><p>vargalex</p><div class="quotebox"><cite>industrial wrote:</cite><blockquote><p>Hello, because of some reason my wifi on wr-741nd sometimes just turn off and i need just to enable it to get it work, but because i don&#039;t wish to do that every time that happen i wish to enable script in cron that will do that for me on 2 hour basis. so i created script in folder /usr/bin/ with filename wifionoff chmode it 777, and this is whole content of script:</p><p>uci set wireless.@wifi-device[0].disabled=1 &amp;&amp; wifi<br />uci set wireless.@wifi-device[0].disabled=0 &amp;&amp; wifi</p><p>when i call it from console it does its job as it suppose to do but when i put it in cron in any setup it simply would not run.</p><p>i try to set it up on correct time like</p><p>0 14 * * * wifionoff</p><p>then i try like on 2 hours <br />0 */2 * * * wifionoff</p><p>then i try on 15 min base</p><p>*/15 * * * * wifionoff</p><p>but it still just wont wish to run....<br />can u help me to see where i made mistake. i suspect that i made some of next mistakes:<br />1. Make cron run correctly?<br />2. Made something wrong with script thou it run from ssh console?<br />3. Made mistake in cron scheduling setup?</p><p>btw this is hw/sw info<br />Router Name&nbsp; &nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &nbsp; OpenWrt<br />Router Model&nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; TP-Link TL-WR741N/ND v4<br />Firmware Version &nbsp; &nbsp; OpenWrt Attitude Adjustment r32782 / LuCI Trunk (trunk+svn8887)<br />Kernel Version&nbsp; &nbsp; &nbsp;&nbsp; &nbsp; 3.3.8</p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p175804">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">industrial</div>
					<div class="post-datetime">
						26 Aug 2012, 02:37					</div>
				</div>
				<div class="post-content content">
					<p>Hi, i already have reboot added in cron jobs that work in 6 am daily that work so i guess daemon is started but if u can past me here how to check and properly start him cause maybe i messed up something.&nbsp; Btw as i understand from documentation i read what i past in scheduled jobs in luci it add it in /etc/crontabs/root and&nbsp; i checked file it have all params.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p175818">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">flux</div>
					<div class="post-datetime">
						26 Aug 2012, 15:03					</div>
				</div>
				<div class="post-content content">
					<p>source /etc/profile in your script</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p175822">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">industrial</div>
					<div class="post-datetime">
						26 Aug 2012, 16:15					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>flux wrote:</cite><blockquote><p>source /etc/profile in your script</p></blockquote></div><p>i don&#039;t understand?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p175827">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">mips</div>
					<div class="post-datetime">
						26 Aug 2012, 17:31					</div>
				</div>
				<div class="post-content content">
					<p>use the &quot;ps&quot; command to check if the crond start?<br />add some &quot;echo&quot; message in you &quot;wifionoff&quot; to check it&#039;s get chance to run?<br />if you just want to restart wirless,maybe you don&#039;t need to change the &quot;/etc/config/wireless&quot;,just try the &quot;wifi down&quot; and then the&nbsp; &quot;wifi&quot; command.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p175834">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">industrial</div>
					<div class="post-datetime">
						26 Aug 2012, 18:24					</div>
				</div>
				<div class="post-content content">
					<p>i already made another script&nbsp; with wifi down and wifi up that should be started a min after this one but logs don&#039;t show anything.</p><p>ps display</p><p>@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@<br />&nbsp; PID USER&nbsp; &nbsp; &nbsp; &nbsp;VSZ STAT COMMAND<br />&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp; 1504 S&nbsp; &nbsp; init<br />&nbsp; &nbsp; 2 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&nbsp; &nbsp;[kthreadd]<br />&nbsp; &nbsp; 3 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&nbsp; &nbsp;[ksoftirqd/0]<br />&nbsp; &nbsp; 5 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&nbsp; &nbsp;[kworker/u:0]<br />&nbsp; &nbsp; 6 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&lt;&nbsp; [khelper]<br />&nbsp; &nbsp; 7 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&nbsp; &nbsp;[kworker/u:1]<br />&nbsp; &nbsp;62 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&nbsp; &nbsp;[sync_supers]<br />&nbsp; &nbsp;64 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&nbsp; &nbsp;[bdi-default]<br />&nbsp; &nbsp;66 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&lt;&nbsp; [kblockd]<br />&nbsp; &nbsp;95 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&nbsp; &nbsp;[kswapd0]<br />&nbsp; 143 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&nbsp; &nbsp;[fsnotify_mark]<br />&nbsp; 170 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&lt;&nbsp; [ath79-spi]<br />&nbsp; 181 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&nbsp; &nbsp;[mtdblock0]<br />&nbsp; 186 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&nbsp; &nbsp;[mtdblock1]<br />&nbsp; 191 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&nbsp; &nbsp;[mtdblock2]<br />&nbsp; 196 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&nbsp; &nbsp;[mtdblock3]<br />&nbsp; 201 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&nbsp; &nbsp;[mtdblock4]<br />&nbsp; 206 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&nbsp; &nbsp;[mtdblock5]<br />&nbsp; 444 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SWN&nbsp; [jffs2_gcd_mtd3]<br />&nbsp; 462 root&nbsp; &nbsp; &nbsp; 1504 S&nbsp; &nbsp; init<br />&nbsp; 499 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&lt;&nbsp; [cfg80211]<br />&nbsp; 507 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&nbsp; &nbsp;[khubd]<br />&nbsp; 575 root&nbsp; &nbsp; &nbsp; 1508 S&nbsp; &nbsp; /sbin/syslogd -l 6 -C16<br />&nbsp; 577 root&nbsp; &nbsp; &nbsp; 1492 S&nbsp; &nbsp; /sbin/klogd<br />&nbsp; 579 root&nbsp; &nbsp; &nbsp; &nbsp;896 S&nbsp; &nbsp; /sbin/hotplug2 --override --persistent --set-rules-f<br />&nbsp; 585 root&nbsp; &nbsp; &nbsp; &nbsp;860 S&nbsp; &nbsp; /sbin/ubusd<br />&nbsp; 589 root&nbsp; &nbsp; &nbsp; 1516 S&nbsp; &nbsp; /sbin/netifd<br />&nbsp; 664 root&nbsp; &nbsp; &nbsp; 1620 S&nbsp; &nbsp; /usr/sbin/pppd nodetach ipparam wan ifname pppoe-wan<br />&nbsp; 735 root&nbsp; &nbsp; &nbsp; 1500 S&nbsp; &nbsp; /sbin/watchdog -t 5 /dev/watchdog<br /> 1031 root&nbsp; &nbsp; &nbsp; 1572 S&nbsp; &nbsp; {dynamic_dns_upd} /bin/sh /usr/lib/ddns/dynamic_dns_<br /> 1032 root&nbsp; &nbsp; &nbsp; 1572 S&nbsp; &nbsp; {dynamic_dns_upd} /bin/sh /usr/lib/ddns/dynamic_dns_<br /> 1790 root&nbsp; &nbsp; &nbsp; 1516 S&nbsp; &nbsp; /usr/sbin/crond -c /etc/crontabs -l 8<br /> 1805 root&nbsp; &nbsp; &nbsp; 1152 S&nbsp; &nbsp; /usr/sbin/dropbear -P /var/run/dropbear.1.pid -p 22<br /> 1823 root&nbsp; &nbsp; &nbsp; 1124 S&nbsp; &nbsp; /usr/sbin/uhttpd -f -h /www -r OpenWrt -x /cgi-bin -<br /> 1857 nobody&nbsp; &nbsp; &nbsp;956 S&nbsp; &nbsp; /usr/sbin/dnsmasq -C /var/etc/dnsmasq.conf<br /> 1870 root&nbsp; &nbsp; &nbsp; 1504 S&nbsp; &nbsp; /usr/sbin/ntpd -n -p 0.openwrt.pool.ntp.org -p 1.ope<br />10496 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&nbsp; &nbsp;[kworker/0:1]<br />11712 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&nbsp; &nbsp;[kworker/0:2]<br />11895 root&nbsp; &nbsp; &nbsp; 1488 S&nbsp; &nbsp; sleep 600<br />11908 root&nbsp; &nbsp; &nbsp; 1488 S&nbsp; &nbsp; sleep 600<br />13352 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&nbsp; &nbsp;[kworker/0:0]<br />13781 root&nbsp; &nbsp; &nbsp; 1412 S&nbsp; &nbsp; hostapd -P /var/run/wifi-phy0.pid -B /var/run/hostap<br />13894 root&nbsp; &nbsp; &nbsp; 1216 S&nbsp; &nbsp; /usr/sbin/dropbear -P /var/run/dropbear.1.pid -p 22<br />13929 root&nbsp; &nbsp; &nbsp; 1504 S&nbsp; &nbsp; -ash<br />13940 root&nbsp; &nbsp; &nbsp; 1496 R&nbsp; &nbsp; ps<br />@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</p><br /><br /><p>ash shown <br />1790 root&nbsp; &nbsp; &nbsp; 1516 S&nbsp; &nbsp; /usr/sbin/crond -c /etc/crontabs -l 8<br />its started....</p>											<p class="post-edited">(Last edited by <strong>industrial</strong> on 26 Aug 2012, 18:26)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p175838">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">hvkls</div>
					<div class="post-datetime">
						26 Aug 2012, 20:08					</div>
				</div>
				<div class="post-content content">
					<p>1. Use the full paths everywhere (in your script and in your crontab)<br />2. Make sure your shell script is complete (starts with &quot;#!/bin/sh&quot;; is executable (&quot;chmod 0755 /path/to/script&quot;))</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p175893">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">industrial</div>
					<div class="post-datetime">
						27 Aug 2012, 11:17					</div>
				</div>
				<div class="post-content content">
					<p>ok ill try that and ill post results. tnx</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>