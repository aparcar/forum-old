<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> [TL-WR841N v9] Physically defective Wi-Fi or bad configuration?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 13 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p306783">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">Sawyer</div>
					<div class="post-datetime">
						8 Jan 2016, 21:52					</div>
				</div>
				<div class="post-content content">
					<p>Hello everyone, <br />I usually try to resolve issues only by searching whats already there, but this time it feels like I need another way of getting help. This is the first router I own and I have no linux experience and I just couldn&#039;t find anyone with a problem like mine, which is&nbsp; - <span style="color: #FF0000"><strong>slow wifi</strong></span>, no matter what, it seems. I already returned one of those routers due to a very, very loud coil whine (in AC power adaptor, not the router itself), this one has it too, but barely audible, only if theres no ambient noise at all. Fun fact: coil noise changed based on settings, atleast with stock firmware. I&#039;d like not get a 3rd one and keep this, perhaps even if I can&#039;t get it fixed, will see. Too bad I didn&#039;t test the first one, but whatever. Lets begin.</p><p><strong>Model name</strong>: TL-WR841N v9 (should be <span style="color: green">300mbps</span> wi-fi)<br /><strong>ISP plan speed</strong>: <span style="color: green">100mbps</span><br /><strong>LAN speedtest</strong>:&nbsp; <span style="color: green">96mbps</span> up/down<br />---------------------------------------------------------------<br /><strong>Wi-Fi speedtest</strong>: Galaxy S2, stock/updated router firmware - <span style="color: red">~32-39mbps</span> down/up<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Galaxy S2, OpenWrt Chaos Calmer 15.05&nbsp; -&nbsp; <span style="color: red">~20-30mbps</span> down/ <span style="color: red">32-35mbps</span> up <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Galaxy S3, stock/updated router firmware - <span style="color: orange">~40-43mbps</span> down/up<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Galaxy S3, OpenWrt Chaos Calmer 15.05&nbsp; - <span style="color: orange">~40-43mbps</span> down/up<br />---------------------------------------------------------------<br />I lost around <span style="color: red">15 mbps</span> download on Galaxy S2 (avg. is 27mbps, could be as low as 20mbps) while upload speed is relatively the same, perhaps <strong>identical to stock</strong> router firmware (34-36mbps)</p><p>Galaxy S3 on the other hand, has the same speeds with both firmwares, stock and OpenWrt. But only a couple of mbps higher than S2, which doesn&#039;t satisfy me at all. </p><p>The reason I did a custom firmware is the configurability, but it seemingly made it worse or neutral.</p><p>My logic suggested that if I do two simultaneous tests and the results stay the same - phones are at fault, but no.<br />Speedtest got halved. Both phones did around <span style="color: red">15mbps</span> down/up, which is a bit more than double the loss, so the way I understand - <strong>routers wi-fi is the bottleneck here</strong>. Enough of this small talk, lets proceed to my settings, or the lack of them. <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /><br />-------------------------------------------------------------------<br />config wifi-device &#039;radio0&#039;<br />&nbsp; &nbsp; option type &#039;mac80211&#039;<br />&nbsp; &nbsp; option path &#039;platform/qca953x_wmac&#039;<br />&nbsp; &nbsp; option country &#039;LT&#039;&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; option hwmode &#039;11ng&#039;&nbsp; <em>(does nothing)</em><br />&nbsp; &nbsp; option htmode &#039;HT40&#039;&nbsp; <em>(does nothing)</em><br />&nbsp; &nbsp; option noscan &#039;1&#039;&nbsp; &nbsp; &nbsp; <em>(this seemingly does nothing either)</em><br />&nbsp; &nbsp; option txpower &#039;30&#039;&nbsp; <em>(tried a lot of the values, below you will see the value router gives)</em><br />&nbsp; &nbsp; option channel &#039;9&#039;&nbsp; &nbsp; <em>(tried all the channels)</em></p><p>config wifi-iface<br />&nbsp; &nbsp; option device &#039;radio0&#039;<br />&nbsp; &nbsp; option key &#039;password&#039;<br />&nbsp; &nbsp; option ssid &#039;name&#039;<br />&nbsp; &nbsp; option encryption &#039;psk2+ccmp&#039;<br />&nbsp; &nbsp; option mode &#039;ap&#039;<br />&nbsp; &nbsp; option network &#039;lan&#039;<br />----------------------<br /><strong>LuCi Web-U.I</strong></p><p><strong><em>Wi-Fi</em></strong></p><p><strong>Generic MAC80211</strong> 802.11bgn (radio0)<br /><strong>Channel</strong>: 9 (2.452 GHz) | <strong>Bitrate: ? Mbit/s</strong> <em>(I dont know why, it doesn&#039;t show the speed now, but when it did, never went past <span style="color: orange">65mbps</span>. The router on its own was locked to <span style="color: orange">65 mbps</span>. Only with S3 connected it got to <span style="color: orange">73mbps</span>, but the actual speed wasn&#039;t even close).</em><br /><strong>Operating Frequency</strong>: Mode N, Channel 9, Width 40 MHz<br /><strong>Transmit Power</strong>: 20 dBm (100 mW)<br /><strong>Tx-Power</strong>: <span style="color: red">16 dBm</span> <em>(I think it always stays the same)</em><br /><strong>Signal</strong>: -32/-37 dBm <em>(currently 0 while nothing is connected)</em><br /><strong>Bitrate</strong>: <span style="color: orange">65 mbits</span> <em>(while S2 is connected)</em><br /><strong>Noise</strong>: -95 dBm <em>(always the same)</em><br /><strong>WMM Mode</strong>: Ticked on</p><p>&nbsp; &nbsp; &nbsp; &nbsp; <strong><em>Advanced settings</em></strong></p><p><strong>Distance Optimization</strong>: nothing is set <em>(didn&#039;t actually try much of it, only a few low values up to 100)</em><br /><strong>Fragmentation Threshold</strong>: nothing is set <em>(in the past I&#039;ve tried stock firmware default values with no benefit)</em><br /><strong>RTS/CTS Threshold</strong>: nothing is set <em>(in the past I&#039;ve tried stock firmware default values with no benefit)</em></p><p>&nbsp; &nbsp; &nbsp; &nbsp;<strong><em>Associated stations</em></strong><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<em>Galaxy S2 values</em></p><p><strong>RX Rate</strong>: 65.0 Mbit/s, MCS 7, 20MHz<br /><strong>TX Rate</strong>: 65.0 Mbit/s, MCS 7, 20MHz<br />-------------------------------------------------<br />I&#039;m not sure what else to provide, so feel free to ask. Open to any suggestions, I&#039;ll try whatever just to have a shot of fixing the problem, please. Atleast getting the performance of stock firmware would be a start. Thank you for your time.</p><br /><p>Edit: Went back to stock, S2 has the speed of 40mbps. Anyway, do you guys think its broken wifi? I do, and probably the only way is to return it.</p>											<p class="post-edited">(Last edited by <strong>Sawyer</strong> on 8 Jan 2016, 23:50)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p306839">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">mwCT</div>
					<div class="post-datetime">
						9 Jan 2016, 14:39					</div>
				</div>
				<div class="post-content content">
					<p>Regrettably, there is more to wifi throughput than what is posted on the box.&nbsp; I found the following very helpful:</p><p><a href="http://wiki.openwrt.org/doc/faq/faq.wireless">http://wiki.openwrt.org/doc/faq/faq.wireless</a></p><p>The 300mbs you see advertised requires 2x2 on both ends in 40MHz mode.&nbsp; 40MHz takes up 2/3rds of the available band that you share with your neighbors.&nbsp; So although HT40 is selected, chances are you are in 20MHz mode (the drivers are helping you) and your phone is 1x1, e.g. the 65.0 Mbit/s, MCS 7, 20MHz you see reported.&nbsp; With overhead from encryption, interference, re-transmission, etc, getting half of 65 is good.&nbsp; Sorry.&nbsp; And don&#039;t forget, cell phones have mechanisms to save power, which further impacts performance.</p><p>This is a snapshot of what I get with 2x2 at both ends:</p><p>&nbsp; &nbsp; &nbsp; &nbsp; signal:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-54 [-55, -60] dBm<br />&nbsp; &nbsp; &nbsp; &nbsp; signal avg:&nbsp; &nbsp; &nbsp;-55 [-56, -63] dBm<br />&nbsp; &nbsp; &nbsp; &nbsp; tx bitrate:&nbsp; &nbsp; &nbsp;130.0 MBit/s MCS 15<br />&nbsp; &nbsp; &nbsp; &nbsp; rx bitrate:&nbsp; &nbsp; &nbsp;65.0 MBit/s MCS 7<br />&nbsp; &nbsp; &nbsp; &nbsp; expected throughput:&nbsp; &nbsp; 43.725Mbps<br />&nbsp; &nbsp; &nbsp; &nbsp; authorized:&nbsp; &nbsp; &nbsp;yes<br />&nbsp; &nbsp; &nbsp; &nbsp; authenticated:&nbsp; yes<br />&nbsp; &nbsp; &nbsp; &nbsp; preamble:&nbsp; &nbsp; &nbsp; &nbsp;long<br />&nbsp; &nbsp; &nbsp; &nbsp; WMM/WME:&nbsp; &nbsp; &nbsp; &nbsp; yes<br />&nbsp; &nbsp; &nbsp; &nbsp; MFP:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; no<br />&nbsp; &nbsp; &nbsp; &nbsp; TDLS peer:&nbsp; &nbsp; &nbsp; no</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p306861">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">Sawyer</div>
					<div class="post-datetime">
						9 Jan 2016, 17:15					</div>
				</div>
				<div class="post-content content">
					<p>Thank you for your answer. I really thought that Wi-Fi is broken, so I returned the router. Looking at some benchmarks right now, the router itself can go to 100mbps, but the phones vary from 40 to 80. Maybe it was all alright after all. <img src="https://forum.openwrt.org/img/smilies/hmm.png" width="15" height="15" alt="hmm" /> Hard to tell, very late at night there weren&#039;t many wi&#039;fi signals around (seems people turn the routers off, around &lt;6) so interference shouldn&#039;t be that bad, + no encryption didn&#039;t boost the speed either. Also its interesting that 2x20 doesn&#039;t share the bandwidth, since 2 phones doing tests are more than halved, around 15 mbps each.</p>											<p class="post-edited">(Last edited by <strong>Sawyer</strong> on 9 Jan 2016, 19:35)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p307119">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">vilpalu</div>
					<div class="post-datetime">
						11 Jan 2016, 09:50					</div>
				</div>
				<div class="post-content content">
					<p>did you test wifi with laptop or something who has 2x2 MIMO? Mostly smartphones have 1x1 SISO antenna configuration and use 20MHz (single channel) which gives 65-72 Mb/s phy. In data layer (TCP) you got 20-40Mb/s maximum. <br />if you use option country &#039;LT&#039;&nbsp; &nbsp;option you can get maximum 20dBm output so if you got 4dBi antennas your transmitter power will be limited to 16dBm. Its country regulations in EIRP to use 20dBm for WiFi.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p307133">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">user5077</div>
					<div class="post-datetime">
						11 Jan 2016, 13:08					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>mwCT wrote:</cite><blockquote><p>Regrettably, there is more to wifi throughput than what is posted on the box.&nbsp; I found the following very helpful:</p><p><a href="http://wiki.openwrt.org/doc/faq/faq.wireless">http://wiki.openwrt.org/doc/faq/faq.wireless</a></p><p>The 300mbs you see advertised requires 2x2 on both ends in 40MHz mode.&nbsp; 40MHz takes up 2/3rds of the available band that you share with your neighbors.&nbsp; So although HT40 is selected, chances are you are in 20MHz mode (the drivers are helping you) and your phone is 1x1, e.g. the 65.0 Mbit/s, MCS 7, 20MHz you see reported.&nbsp; With overhead from encryption, interference, re-transmission, etc, getting half of 65 is good.&nbsp; Sorry.&nbsp; And don&#039;t forget, cell phones have mechanisms to save power, which further impacts performance.</p><p>This is a snapshot of what I get with 2x2 at both ends:</p><p>&nbsp; &nbsp; &nbsp; &nbsp; signal:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-54 [-55, -60] dBm<br />&nbsp; &nbsp; &nbsp; &nbsp; signal avg:&nbsp; &nbsp; &nbsp;-55 [-56, -63] dBm<br />&nbsp; &nbsp; &nbsp; &nbsp; tx bitrate:&nbsp; &nbsp; &nbsp;130.0 MBit/s MCS 15<br />&nbsp; &nbsp; &nbsp; &nbsp; rx bitrate:&nbsp; &nbsp; &nbsp;65.0 MBit/s MCS 7<br />&nbsp; &nbsp; &nbsp; &nbsp; expected throughput:&nbsp; &nbsp; 43.725Mbps<br />&nbsp; &nbsp; &nbsp; &nbsp; authorized:&nbsp; &nbsp; &nbsp;yes<br />&nbsp; &nbsp; &nbsp; &nbsp; authenticated:&nbsp; yes<br />&nbsp; &nbsp; &nbsp; &nbsp; preamble:&nbsp; &nbsp; &nbsp; &nbsp;long<br />&nbsp; &nbsp; &nbsp; &nbsp; WMM/WME:&nbsp; &nbsp; &nbsp; &nbsp; yes<br />&nbsp; &nbsp; &nbsp; &nbsp; MFP:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; no<br />&nbsp; &nbsp; &nbsp; &nbsp; TDLS peer:&nbsp; &nbsp; &nbsp; no</p></blockquote></div><p>-55 dBm... that&#039;s good, I have the same router as the OP and I barely get -67...-69 dBm at 4-5 meters away from the router, and I have txpower set to 21(works if you set country to US) so it shall be enough.(tough there are quite many walls between the router and client, but I don&#039;t have a range extender so don&#039;t &quot;suggest&quot; that). No 40MHz on any device, they probably don&#039;t suppport it at all, oddly some do support 5 GHz. If I can&#039;t fix the signal issue I&#039;ll be buying a wr1043nd instead.</p>											<p class="post-edited">(Last edited by <strong>user5077</strong> on 11 Jan 2016, 13:10)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>