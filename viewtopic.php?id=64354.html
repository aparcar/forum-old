<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> masq from guest to LAN</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 29 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p320851">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">Xennex</div>
					<div class="post-datetime">
						22 Apr 2016, 16:43					</div>
				</div>
				<div class="post-content content">
					<p>Hi quick question.</p><p>I have two zones: lan and guest.</p><p>lan is a bridge of one wireless SSID and the normal eth0. So the device for it is called br-lan.</p><p>guest is tied to another SSID, its device is ath0-1</p><p>I thought I had it configured before but now I don&#039;t understand anymore.</p><p>At this point everything has access to everything, except &quot;input&quot; for guest zone is denied (so you cannot log on to the access point using e.g. ssh from guest) and forwarding to 192.168.1.0 is denied (so you cannot access computers on the LAN). And I thought I had it working before :-/.</p><p>guest DHCP gives devices on guest something in the range of 192.168.2.X and its gateway becomes 192.168.2.1. This is simply a second IP of the openwrt device right.</p><p>There are two SSIDs: &quot;openwrt&quot;&nbsp; and &quot;openwrt_guest&quot; at this point. Traffic on &quot;openwrt&quot; is just transparently forwarded.</p><p>But if I allow traffic from &quot;openwrt_guest&quot; that has 192.168.2.X to be forwarded to my router, which is not openwrt, just a regular router, the router won&#039;t know how to send it back because it has no routing entry for 192.168.2.0/24.</p><p>So I need to masquerade 192.168.2.X onto 192.168.1.2 (which is my LAN address) using 192.168.2.1 as the router (which is my &quot;guest&quot; address).</p><p>How do I do this?</p><p>Since 192.168.2.1 is the router, there is no address on 192.168.1.0 that should or would need to be addressable by guest directly. So I think denying 192.168.1.0/24 for guest should work.</p><p>Now all I need is traffic from 192.168.2.0/24 to be masqueraded (or conversely, from ath0-1) and given a LAN IP address (basically SNAT to 192.168.1.2, currently) and reverse traffic to be DNATted to 192.168.2.X according to the state.</p><p>How do I do this most easily?</p><p>Regards.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p320857">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">Max Hopper</div>
					<div class="post-datetime">
						22 Apr 2016, 16:55					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Xennex wrote:</cite><blockquote><p>So I need to masquerade 192.168.2.X onto 192.168.1.2 (which is my LAN address) using 192.168.2.1 as the router (which is my &quot;guest&quot; address).</p></blockquote></div><p>???</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>