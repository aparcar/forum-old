<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> RB450 - using Five Ethernet Ports</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 6 Feb 2018 and 6 May 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 7 of 9</div><nav><ul><li><a href="viewtopic.php%3Fid=17501&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=17501&amp;p=5.html">5</a></li><li><a href="viewtopic.php%3Fid=17501&amp;p=6.html">6</a></li><li class="pagination-current"><span>7</span></li><li><a href="viewtopic.php%3Fid=17501&amp;p=8.html">8</a></li><li><a href="viewtopic.php%3Fid=17501&amp;p=9.html">9</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p89917">
				<div class="post-metadata">
					<div class="post-num">Post #151</div>
					<div class="post-author">jirka</div>
					<div class="post-datetime">
						15 Jun 2009, 18:57					</div>
				</div>
				<div class="post-content content">
					<p>I used patch <a href="https://dev.openwrt.org/attachment/tick">https://dev.openwrt.org/attachment/tick</a> … _phy.patch . I have tried to configure switch /etc/config/network . I used latest revision openwrt and RB450.</p><p>swconfig dev eth1 help .. Failed to connect to the switch</p><p>I disabled iptables /etc/init.d/firewall stop. I have tried ping on 1-4 ports and nothing response (eth1.2 - eth1.5). Eth0 is ok.</p><p>I check patch <a href="https://dev.openwrt.org/attachment/tick">https://dev.openwrt.org/attachment/tick</a> … _phy.patch&nbsp; and there are:<br />1. Link speed and link status corrections build_dir/linux-ar71xx/linux-2.6.28.10/drivers/net/ag71xx/ag71xx_phy.c</p><p>2. Drivers remove/install<br />- remove Intel(R) PRO/1000 Gigabit Ethernet support<br />- remove Intel(R) PRO/1000 PCI-Express Gigabit Ethernet support<br />- remove IBM EMAC Ethernet support&nbsp; &nbsp; (CONFIG_IBM_NEW_EMAC)<br />- insert ICL EtherTeam 16i/32 support<br />- insert Zorro Ethernet cards using an NS8390-compatible</p><br /><p>I think that this patch does not effect on switch and ip175c.</p><p>I have read datasheet of ip175c and i think that first port is enabled alone. Other ports has only one interface. Ports are tagged(VLAN) and switch is configured to port = tag.</p><p>Jirka</p><div class="quotebox"><cite>robrob wrote:</cite><blockquote><p>jirka,</p><p>Without the patch phorn linked to above none of the switch ethernet ports will work. eth0 is the WAN port, eth1 is the switch. Apply the patch, run the above clean command, compile and it should work.</p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p89935">
				<div class="post-metadata">
					<div class="post-num">Post #152</div>
					<div class="post-author">robrob</div>
					<div class="post-datetime">
						15 Jun 2009, 22:50					</div>
				</div>
				<div class="post-content content">
					<p>jirka,</p><p>I was having a similar problem and it was caused by not running the clean command--the patch wasn&#039;t being installed. Did you run phorn&#039;s clean command?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p89941">
				<div class="post-metadata">
					<div class="post-num">Post #153</div>
					<div class="post-author">jirka</div>
					<div class="post-datetime">
						16 Jun 2009, 00:27					</div>
				</div>
				<div class="post-content content">
					<p>hi,<br />I removed my copy of trunk. I download svn trunk again and I used patch. I only add +CONFIG_SWCONFIG=y by hand, it does not patch sucessfully.</p><p>Dmesg shows that PHY is detected.<br /></p><div class="codebox"><pre><code>dmesg
...
eth0: Atheros AG71xx at 0xba000000, irq 5
eth0: connected to PHY at 0:04 [uid=02430d80, driver=Generic PHY]
eth1: Atheros AG71xx at 0xb9000000, irq 4
eth1: connected to 4 PHYs
eth1: connected to 4 PHYs
...</code></pre></div><p>There area a lot of messages<br />Trying 10/HALF<br />Trying 10/HALF<br />Trying 10/HALF<br />Trying 10/HALF<br />...</p><p>I does not matter if there is ethernet cable connected. Messages stop when i run &quot;ifcconfig eth1 down&quot;.</p><p>Swconfig returns info ...<br /></p><div class="codebox"><pre><code>root@OpenWrt:/# swconfig dev eth1 help
Switch 1: eth1(eth1), ports: 6, vlans: 16
     --switch
        Attribute 1 (int): enable_vlan (Flag to enable or disable VLANs and tagg
ing)
        Attribute 2 (string): name (Returns the type of IC+ chip.)
        Attribute 3 (int): phy (Direct register access: set phy (0-4, or 29,30,3
1))
        Attribute 4 (int): reg (Direct register access: set mii number (0-31))
        Attribute 5 (int): val (Direct register access: read/write to register (
0-65535))
        Attribute 6 (none): apply (Activate changes in the hardware)
        Attribute 7 (none): reset (Reset the switch)
     --vlan
        Attribute 1 (ports): ports (VLAN port mapping)
     --port
        Attribute 1 (string): status (Returns Detailed port status)
        Attribute 2 (int): link (Link speed. Can write 0 for auto-negotiate, or
10 or 100)
        Attribute 3 (int): tagged (0 = untag, 1 = add tags, 2 = do not alter (Th
is value is reset if vlans are altered))
        Attribute 4 (int): pvid (Primary VLAN ID)
root@OpenWrt:/#</code></pre></div><p>I have tried set up switch vlans, but it does not run. </p><div class="codebox"><pre><code>vi /etc/config/network

config &#039;switch&#039; &#039;eth1&#039;          
        option &#039;vlan2&#039; &#039;3 4t 5t&#039;
        option &#039;vlan3&#039; &#039;2 4t 5t&#039;
        option &#039;vlan4&#039; &#039;1 4t 5t&#039;   
        option &#039;vlan5&#039; &#039;0 4t 5t&#039;    
                                    
config &#039;interface&#039; &#039;loopback&#039;       
        option &#039;ifname&#039; &#039;lo&#039;        
        option &#039;proto&#039; &#039;static&#039;     
        option &#039;ipaddr&#039; &#039;127.0.0.1&#039;   
        option &#039;netmask&#039; &#039;255.0.0.0&#039;    
                                        
config &#039;interface&#039; &#039;vlan1&#039;               
        option &#039;ifname&#039; &#039;eth0&#039;          
        option &#039;proto&#039; &#039;static&#039;         
        option &#039;ipaddr&#039; &#039;172.16.16.99&#039;  
        option &#039;netmask&#039; &#039;255.255.240.0&#039;
                                        
config &#039;interface&#039; &#039;vlan2&#039;               
        option &#039;ifname&#039; &#039;eth1.2&#039;        
        option &#039;proto&#039; &#039;static&#039;         
        option &#039;ipaddr&#039; &#039;192.168.102.62&#039;
        option &#039;netmask&#039; &#039;255.255.255.0&#039;
                                        
config &#039;interface&#039; &#039;vlan3&#039;               
        option &#039;ifname&#039; &#039;eth1.3&#039;        
        option &#039;proto&#039; &#039;static&#039;         
        option &#039;ipaddr&#039; &#039;192.168.103.63&#039;
        option &#039;netmask&#039; &#039;255.255.255.0&#039;

config &#039;interface&#039; &#039;vlan4&#039;               
        option &#039;ifname&#039; &#039;eth1.4&#039;        
        option &#039;proto&#039; &#039;static&#039;         
        option &#039;ipaddr&#039; &#039;192.168.104.63&#039;
        option &#039;netmask&#039; &#039;255.255.255.0&#039;

config &#039;interface&#039; &#039;vlan5&#039;               
        option &#039;ifname&#039; &#039;eth1.5&#039;        
        option &#039;proto&#039; &#039;static&#039;         
        option &#039;ipaddr&#039; &#039;192.168.105.63&#039;
        option &#039;netmask&#039; &#039;255.255.255.0&#039;</code></pre></div><p>Eth1 receives some bytes ... &quot;RX bytes:5916&quot;, but not send. I tried ping from and to this intreface ... . I will try tcpdump ... .</p><br /><div class="codebox"><pre><code>       ifconfig

... 

eth1      Link encap:Ethernet  HWaddr 00:0C:42:2E:A1:71
          UP BROADCAST MULTICAST  MTU:1500  Metric:1
          RX packets:40 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:5916 (5.7 KiB)  TX bytes:0 (0.0 B)
          Interrupt:4

eth1.2    Link encap:Ethernet  HWaddr 00:0C:42:2E:A1:71
          inet addr:192.168.99.62  Bcast:192.168.99.255  Mask:255.255.255.0
          UP BROADCAST MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)

...</code></pre></div><p>Jirka</p><br /><div class="quotebox"><cite>robrob wrote:</cite><blockquote><p>jirka,</p><p>I was having a similar problem and it was caused by not running the clean command--the patch wasn&#039;t being installed. Did you run phorn&#039;s clean command?</p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p89948">
				<div class="post-metadata">
					<div class="post-num">Post #154</div>
					<div class="post-author">phorn</div>
					<div class="post-datetime">
						16 Jun 2009, 03:57					</div>
				</div>
				<div class="post-content content">
					<p>swconfig does not use the same configuration as the old system.<br />Your configuration needs to look more like this (Note the separate &quot;config switch_vlan&quot; section for each vlan)<br /></p><div class="codebox"><pre><code>config switch eth1
option reset 1
option enable_vlan 1

config switch_vlan
option device eth1
option vlan 1
option ports &quot;0 1 2 5t&quot;

config switch_vlan
option device eth1
option vlan 2
option ports &quot;3 4 5t&quot;

config interface lan1
option ifname &quot;eth1.1&quot;
option proto static
option type bridge
option ipaddr 192.168.1.7
option netmask 255.255.255.0

config interface lan2
option ifname &quot;eth1.2&quot;
option proto static
option ipaddr 192.168.2.7
option netmask 255.255.255.0

config interface wan
option ifname &quot;eth0&quot;
option proto dhcp</code></pre></div><p>About the TRYING 10/HALF, does the message go away if you plug a cable into port 0 or port 4?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p89949">
				<div class="post-metadata">
					<div class="post-num">Post #155</div>
					<div class="post-author">phorn</div>
					<div class="post-datetime">
						16 Jun 2009, 04:07					</div>
				</div>
				<div class="post-content content">
					<p>I have no idea which device is causing the kernel messages.</p><p>One thing you can do is to go to build_dir/linux-ar71xx/linux-2.6.28.10/drivers/net/phy/phy.c<br />Search for both places that print &quot;Trying %d/%s&quot;, and add the following statement after each one:<br /></p><div class="codebox"><pre><code>        printk(KERN_DEBUG &quot;PHY is %s &quot;
            &quot;[uid=%08x, driver=%s]\n&quot;,
            dev_name(&amp;phydev-&gt;dev),
            phydev-&gt;phy_id, phydev-&gt;drv?phydev-&gt;drv-&gt;name:&quot;NONE&quot;);</code></pre></div><p>That should print extra information out, but it will include the driver that is responsible.</p><p>One thing you could try is going to drivers/net/phy/ip175c.c:<br />static int ip175c_read_status(struct phy_device *pdev)<br />{<br />&nbsp; &nbsp; pdev-&gt;speed = SPEED_100;<br />&nbsp; &nbsp; pdev-&gt;duplex = DUPLEX_FULL;<br />&nbsp; &nbsp; pdev-&gt;pause = pdev-&gt;asym_pause = 0;<br />&nbsp; &nbsp; return 0;<br />}<br />Before the &quot;return 0&quot;, add this:<br /></p><div class="codebox"><pre><code>pdev-&gt;irq = PHY_IGNORE_INTERRUPT;</code></pre></div><p>That might make it stop trying to poll for status changes.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p89970">
				<div class="post-metadata">
					<div class="post-num">Post #156</div>
					<div class="post-author">jirka</div>
					<div class="post-datetime">
						16 Jun 2009, 13:35					</div>
				</div>
				<div class="post-content content">
					<p>Hi,<br />KERN_DEBUG did not shown any information. I tried echo &quot;8 8 8 8&quot; &gt; /proc/sys/kernel/printk . <br />Is there any compilation flag to include debug&nbsp; ?</p><p>I changed code to:<br /></p><div class="codebox"><pre><code>    pr_info(&quot;pr_info PHY is %s %s %xd (phy_force_reduction)&quot;
               &quot;[uid=%08x, driver=%s]\n&quot;,
               dev_name(&amp;phydev-&gt;dev),
               phydev-&gt;bus-&gt;name,phydev-&gt;addr,phydev-&gt;phy_id,phydev-&gt;drv?phydev-&gt;drv-&gt;name:&quot;NONE&quot;);
    printk(KERN_DEBUG, &quot;PHY is %s %s %xd (phy_force_reduction)&quot;
               &quot;[uid=%08x, driver=%s]\n&quot;,
               dev_name(&amp;phydev-&gt;dev),
               phydev-&gt;bus-&gt;name,phydev-&gt;addr,phydev-&gt;phy_id,phydev-&gt;drv?phydev-&gt;drv-&gt;name:&quot;NONE&quot;);</code></pre></div><p>Cable was in eth0:</p><div class="codebox"><pre><code>root@OpenWrt:/# Trying 100/FULL
pr_info PHY is 0:00 ag71xx_mdio 0d (phy_state_machine)[uid=02430d80, driver=IC+
IP175C]
pr_info PHY is 0:00 ag71xx_mdio 0d (phy_force_reduction)[uid=02430d80, driver=IC
+ IP175C]</code></pre></div><p>Cable was in eth1:<br /></p><div class="codebox"><pre><code>root@OpenWrt:/# br-lan: port 1(eth0) entering disabled state
Trying 10/FULL
pr_info PHY is 0:00 ag71xx_mdio 0d (phy_force_reduction)[uid=02430d80, driver=IC
+ IP175C]
pr_info PHY is 0:00 ag71xx_mdio 0d (phy_force_reduction)[uid=02430d80, driver=IC
+ IP175C]</code></pre></div><p>Cable was in eth2:<br /></p><div class="codebox"><pre><code>root@OpenWrt:/# pr_info PHY is 0:00 ag71xx_mdio 0d (phy_force_reduction)[uid=024
30d80, driver=IC+ IP175C]
pr_info PHY is 0:00 ag71xx_mdio 0d (phy_force_reduction)[uid=02430d80, driver=IC
+ IP175C]</code></pre></div><p>Cable was in eth3:<br /></p><div class="codebox"><pre><code>root@OpenWrt:/# pr_info PHY is 0:00 ag71xx_mdio 0d (phy_force_reduction)[uid=024
30d80, driver=IC+ IP175C]
pr_info PHY is 0:00 ag71xx_mdio 0d (phy_force_reduction)[uid=02430d80, driver=IC
+ IP175C]</code></pre></div><p>Cable was in eth4:<br /></p><div class="codebox"><pre><code>root@OpenWrt:/# eth1: link up (10Mbps/Half duplex)</code></pre></div><div class="codebox"><pre><code>root@OpenWrt:/# ifconfig
br-lan    Link encap:Ethernet  HWaddr 00:0C:42:2E:A1:70
          inet addr:192.168.1.1  Bcast:192.168.1.255  Mask:255.255.255.0
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:2 errors:0 dropped:0 overruns:0 frame:0
          TX packets:2 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:712 (712.0 B)  TX bytes:814 (814.0 B)

eth0      Link encap:Ethernet  HWaddr 00:0C:42:2E:A1:70
          UP BROADCAST MULTICAST  MTU:1500  Metric:1
          RX packets:2 errors:0 dropped:0 overruns:0 frame:0
          TX packets:2 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:740 (740.0 B)  TX bytes:814 (814.0 B)
          Interrupt:5

eth1      Link encap:Ethernet  HWaddr 00:0C:42:2E:A1:71
          inet addr:192.168.99.223  Bcast:192.168.99.255  Mask:255.255.255.0
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:28 errors:0 dropped:0 overruns:0 frame:0
          TX packets:5 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:4864 (4.7 KiB)  TX bytes:960 (960.0 B)
          Interrupt:4

lo        Link encap:Local Loopback
          inet addr:127.0.0.1  Mask:255.0.0.0
          UP LOOPBACK RUNNING  MTU:16436  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)</code></pre></div><div class="codebox"><pre><code>root@OpenWrt:/# swconfig dev eth1 help
Switch 1: eth1(eth1), ports: 6, vlans: 16
     --switch
        Attribute 1 (int): enable_vlan (Flag to enable or disable VLANs and tagg
ing)
        Attribute 2 (string): name (Returns the type of IC+ chip.)
        Attribute 3 (int): phy (Direct register access: set phy (0-4, or 29,30,3
1))
        Attribute 4 (int): reg (Direct register access: set mii number (0-31))
        Attribute 5 (int): val (Direct register access: read/write to register (
0-65535))
        Attribute 6 (none): apply (Activate changes in the hardware)
        Attribute 7 (none): reset (Reset the switch)
     --vlan
        Attribute 1 (ports): ports (VLAN port mapping)
     --port
        Attribute 1 (string): status (Returns Detailed port status)
        Attribute 2 (int): link (Link speed. Can write 0 for auto-negotiate, or
10 or 100)
        Attribute 3 (int): tagged (0 = untag, 1 = add tags, 2 = do not alter (Th
is value is reset if vlans are altered))
        Attribute 4 (int): pvid (Primary VLAN ID)</code></pre></div><div class="codebox"><pre><code>root@OpenWrt:/# ifconfig eth1 192.168.99.19/24
root@OpenWrt:/# ifconfig eth0 down
br-lan: port 1(eth0) entering disabled state
root@OpenWrt:/# ping 192.168.99.99
PING 192.168.99.99 (192.168.99.99): 56 data bytes
64 bytes from 192.168.99.99: seq=0 ttl=64 time=4.151 ms
64 bytes from 192.168.99.99: seq=1 ttl=64 time=172.498 ms
64 bytes from 192.168.99.99: seq=2 ttl=64 time=0.450 ms
64 bytes from 192.168.99.99: seq=3 ttl=64 time=0.428 ms
^C
--- 192.168.99.99 ping statistics ---
4 packets transmitted, 4 packets received, 0% packet loss
round-trip min/avg/max = 0.428/44.381/172.498 ms</code></pre></div><div class="codebox"><pre><code>root@OpenWrt:/#
root@OpenWrt:/# uci export
package &#039;dhcp&#039;

config &#039;dnsmasq&#039;
        option &#039;domainneeded&#039; &#039;1&#039;
        option &#039;boguspriv&#039; &#039;1&#039;
        option &#039;filterwin2k&#039; &#039;0&#039;
        option &#039;localise_queries&#039; &#039;1&#039;
        option &#039;local&#039; &#039;/lan/&#039;
        option &#039;domain&#039; &#039;lan&#039;
        option &#039;expandhosts&#039; &#039;1&#039;
        option &#039;nonegcache&#039; &#039;0&#039;
        option &#039;authoritative&#039; &#039;1&#039;
        option &#039;readethers&#039; &#039;1&#039;
        option &#039;leasefile&#039; &#039;/tmp/dhcp.leases&#039;
        option &#039;resolvfile&#039; &#039;/tmp/resolv.conf.auto&#039;

config &#039;dhcp&#039; &#039;lan&#039;
        option &#039;interface&#039; &#039;lan&#039;
        option &#039;start&#039; &#039;100&#039;
        option &#039;limit&#039; &#039;150&#039;
        option &#039;leasetime&#039; &#039;12h&#039;

config &#039;dhcp&#039; &#039;wan&#039;
        option &#039;interface&#039; &#039;wan&#039;
        option &#039;ignore&#039; &#039;1&#039;

package &#039;dropbear&#039;

config &#039;dropbear&#039;
        option &#039;PasswordAuth&#039; &#039;on&#039;
        option &#039;Port&#039; &#039;22&#039;

package &#039;firewall&#039;

config &#039;defaults&#039;
        option &#039;syn_flood&#039; &#039;1&#039;
        option &#039;input&#039; &#039;ACCEPT&#039;
        option &#039;output&#039; &#039;ACCEPT&#039;
        option &#039;forward&#039; &#039;REJECT&#039;

config &#039;zone&#039;
        option &#039;name&#039; &#039;lan&#039;
        option &#039;input&#039; &#039;ACCEPT&#039;
        option &#039;output&#039; &#039;ACCEPT&#039;
        option &#039;forward&#039; &#039;REJECT&#039;

config &#039;zone&#039;
        option &#039;name&#039; &#039;wan&#039;
        option &#039;input&#039; &#039;REJECT&#039;
        option &#039;output&#039; &#039;ACCEPT&#039;
        option &#039;forward&#039; &#039;REJECT&#039;
        option &#039;masq&#039; &#039;1&#039;

config &#039;forwarding&#039;
        option &#039;src&#039; &#039;lan&#039;
        option &#039;dest&#039; &#039;wan&#039;
        option &#039;mtu_fix&#039; &#039;1&#039;

config &#039;include&#039;
        option &#039;path&#039; &#039;/etc/firewall.user&#039;

package &#039;fstab&#039;

config &#039;mount&#039;
        option &#039;target&#039; &#039;/home&#039;
        option &#039;device&#039; &#039;/dev/sda1&#039;
        option &#039;fstype&#039; &#039;ext3&#039;
        option &#039;options&#039; &#039;rw,sync&#039;
        option &#039;enabled&#039; &#039;0&#039;

config &#039;swap&#039;
        option &#039;device&#039; &#039;/dev/sda2&#039;
        option &#039;enabled&#039; &#039;0&#039;

package &#039;httpd&#039;

config &#039;httpd&#039;
        option &#039;port&#039; &#039;80&#039;
        option &#039;home&#039; &#039;/www&#039;

package &#039;network&#039;

config &#039;interface&#039; &#039;loopback&#039;
        option &#039;ifname&#039; &#039;lo&#039;
        option &#039;proto&#039; &#039;static&#039;
        option &#039;ipaddr&#039; &#039;127.0.0.1&#039;
        option &#039;netmask&#039; &#039;255.0.0.0&#039;

config &#039;interface&#039; &#039;lan&#039;
        option &#039;ifname&#039; &#039;eth0&#039;
        option &#039;type&#039; &#039;bridge&#039;
        option &#039;proto&#039; &#039;static&#039;
        option &#039;ipaddr&#039; &#039;192.168.1.1&#039;
        option &#039;netmask&#039; &#039;255.255.255.0&#039;

config &#039;interface&#039; &#039;wan&#039;
        option &#039;ifname&#039; &#039;eth1&#039;
        option &#039;proto&#039; &#039;dhcp&#039;

package &#039;system&#039;

config &#039;system&#039;
        option &#039;hostname&#039; &#039;OpenWrt&#039;
        option &#039;timezone&#039; &#039;UTC&#039;

package &#039;wireless&#039;</code></pre></div><p>Eth0 is ok .<br />Eth1 is running in 4 x ports on RB450. i can ping from any of 4s port. Only last port(right corner port) changes status of cable connection. I think that switch is not set up. I will try set up vlan.</p><p>Jirka</p>											<p class="post-edited">(Last edited by <strong>jirka</strong> on 16 Jun 2009, 16:56)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p89984">
				<div class="post-metadata">
					<div class="post-num">Post #157</div>
					<div class="post-author">jirka</div>
					<div class="post-datetime">
						16 Jun 2009, 17:54					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>phorn wrote:</cite><blockquote><p>One thing you could try is going to drivers/net/phy/ip175c.c:<br />static int ip175c_read_status(struct phy_device *pdev)<br />{<br />&nbsp; &nbsp; pdev-&gt;speed = SPEED_100;<br />&nbsp; &nbsp; pdev-&gt;duplex = DUPLEX_FULL;<br />&nbsp; &nbsp; pdev-&gt;pause = pdev-&gt;asym_pause = 0;<br />&nbsp; &nbsp; return 0;<br />}<br />Before the &quot;return 0&quot;, add this:<br /></p><div class="codebox"><pre><code>pdev-&gt;irq = PHY_IGNORE_INTERRUPT;</code></pre></div><p>That might make it stop trying to poll for status changes.</p></blockquote></div><p>This does not help. </p><p>Why do drivers ic175 and icplus have same id 02430d80 ? </p><p>Jirka</p>											<p class="post-edited">(Last edited by <strong>jirka</strong> on 16 Jun 2009, 18:09)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p90007">
				<div class="post-metadata">
					<div class="post-num">Post #158</div>
					<div class="post-author">jirka</div>
					<div class="post-datetime">
						16 Jun 2009, 21:40					</div>
				</div>
				<div class="post-content content">
					<p>I correct changes line every 10 secods .. Messages ... Trying 10/100/HALF ... .</p><p>ip175c.c does not implement config_aneg. There is empy metod. ip175 and icplus share same driver id, better last number could by different. Message passing from mdio goes into both drivers. Driver could inform about line status or some times kernel asks driver. This is messages about Trying, kernel asks driver. There are some bugs.</p><br /><div class="codebox"><pre><code>In phy.c:

static void phy_force_reduction(struct phy_device *phydev)
{

    // add this line
    if( phydev-&gt;addr == 0 &amp;&amp; strcmp(phydev-&gt;bus-&gt;name,&quot;0:00&quot;)) return;</code></pre></div><p>Jirka</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p90021">
				<div class="post-metadata">
					<div class="post-num">Post #159</div>
					<div class="post-author">mtadeu</div>
					<div class="post-datetime">
						17 Jun 2009, 04:05					</div>
				</div>
				<div class="post-content content">
					<p>When use /etc/config/network<br /></p><div class="codebox"><pre><code>config switch eth1
option reset 1
option enable_vlan 1

config switch_vlan
option device eth1
option vlan 2
option ports &quot;3 5t&quot;

config switch_vlan
option device eth1
option vlan 3
option ports &quot;2 5t&quot;

config switch_vlan
option device eth1
option vlan 4
option ports &quot;1 5t&quot;

config switch_vlan
option device eth1
option vlan 5
option ports &quot;0 5t&quot;</code></pre></div><p>I can configure and isolate interfaces eth1.2, eth1.3, eth1.4, eth1.5. These names corresponds to labels in the box: interface Eth2 to Eth5 (CA150)<br /> But, these interfaces only work if port 0 (eth1.5) have PHY UP (Cable connect - mii UP). <br />Once port 0 is UP one time, the other interfaces work well, and I can disconnect port 0, until next boot.</p>											<p class="post-edited">(Last edited by <strong>mtadeu</strong> on 17 Jun 2009, 05:13)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p90031">
				<div class="post-metadata">
					<div class="post-num">Post #160</div>
					<div class="post-author">jirka</div>
					<div class="post-datetime">
						17 Jun 2009, 09:33					</div>
				</div>
				<div class="post-content content">
					<p>It is the same on my RB450.<br />Your VLAN configuration does not run on my RB450.</p><p>I have to add CPU port 4, i think.<br />From<br />&nbsp; option ports &quot;3 5t&quot;<br />To<br />&nbsp; option ports &quot;3 4 5t&quot;</p><p>Jirka<br /></p><div class="quotebox"><cite>mtadeu wrote:</cite><blockquote><p>When use /etc/config/network<br /></p><div class="codebox"><pre><code>config switch eth1
option reset 1
option enable_vlan 1

config switch_vlan
option device eth1
option vlan 2
option ports &quot;3 5t&quot;

config switch_vlan
option device eth1
option vlan 3
option ports &quot;2 5t&quot;

config switch_vlan
option device eth1
option vlan 4
option ports &quot;1 5t&quot;

config switch_vlan
option device eth1
option vlan 5
option ports &quot;0 5t&quot;</code></pre></div><p>I can configure and isolate interfaces eth1.2, eth1.3, eth1.4, eth1.5. These names corresponds to labels in the box: interface Eth2 to Eth5 (CA150)<br /> But, these interfaces only work if port 0 (eth1.5) have PHY UP (Cable connect - mii UP). <br />Once port 0 is UP one time, the other interfaces work well, and I can disconnect port 0, until next boot.</p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p90048">
				<div class="post-metadata">
					<div class="post-num">Post #161</div>
					<div class="post-author">mtadeu</div>
					<div class="post-datetime">
						17 Jun 2009, 22:03					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>jirka wrote:</cite><blockquote><p>It is the same on my RB450.<br />Your VLAN configuration does not run on my RB450.</p><p>I have to add CPU port 4, i think.<br />From<br />&nbsp; option ports &quot;3 5t&quot;<br />To<br />&nbsp; option ports &quot;3 4 5t&quot;</p><p>Jirka</p></blockquote></div><p>I try<br />&nbsp; option ports &quot;3 4 5t&quot;<br />and<br />&nbsp; option ports &quot;3 4t 5t&quot;<br />Both make same result. Need to connect port 0<br />I not use bridge. <br />The (real) eth1 link is up, only when port 0 is UP. See that, when connect port 0:<br /></p><div class="codebox"><pre><code># logread -f
eth1: link up (100Mbps/Full duplex)
Jan  1 00:01:04 OpenWrt user.debug kernel: ar71xx: pll_reg 0xb8050010: 0x1099
Jan  1 00:01:04 OpenWrt user.info kernel: eth1: link up (100Mbps/Full duplex)</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p90059">
				<div class="post-metadata">
					<div class="post-num">Post #162</div>
					<div class="post-author">phorn</div>
					<div class="post-datetime">
						18 Jun 2009, 05:32					</div>
				</div>
				<div class="post-content content">
					<p>Hmm, it seems like something is monitoring Phy 0, since that is the address that the switch is attached to.</p><p>There should be a way to force the port to always be in the &quot;up&quot; state, since it was clearly doing that before I added the code to attach to the phy.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p92363">
				<div class="post-metadata">
					<div class="post-num">Post #163</div>
					<div class="post-author">gdamjan</div>
					<div class="post-datetime">
						6 Aug 2009, 03:52					</div>
				</div>
				<div class="post-content content">
					<p>Hi, all... I get this on my RB493<br /></p><div class="codebox"><pre><code>ip175c_init called.
ag71xx_mdio: probed
eth0: Atheros AG71xx at 0xb9000000, irq 4
eth1: Atheros AG71xx at 0xba000000, irq 5
eth1: connected to PHY at 0:00 [uid=02430d80, driver=IC+ IP175C]
...
root@OpenWrt:/# swconfig dev eth1 get enable_vlan
0
root@OpenWrt:/# swconfig dev eth1 get name
IP178C</code></pre></div><p>take note of the driver=IC+ IP175C on the eth1 PHY, while it should maybe be IP178C?? Or are they using the same driver?</p><p>The main problem beeing that &quot;swconfig dev eth1 set enable_vlan 1&quot; doesn&#039;t enable the vlan</p>											<p class="post-edited">(Last edited by <strong>gdamjan</strong> on 6 Aug 2009, 03:54)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p97150">
				<div class="post-metadata">
					<div class="post-num">Post #164</div>
					<div class="post-author">mschank</div>
					<div class="post-datetime">
						10 Nov 2009, 18:37					</div>
				</div>
				<div class="post-content content">
					<p>Hello Group,</p><p>Just an FYI for other RB450 users.&nbsp; We recently purchased a batch of RB450 boards and most of them had the ip175D switch device instead of the ip175C.&nbsp; These two devices are not software compatible, so neither the current ip175c.c nor the current icplus.c driver will work.&nbsp; Below is the modification I made to icplus.c to add support for the ip175d.&nbsp; This simply configures the device to be a basic 4 port switch.</p><div class="codebox"><pre><code>static int ip175c_config_init(struct phy_device *phydev)
{
    int err, i;
    static int full_reset_performed = 0;

    if (full_reset_performed == 0) {

        /* Determine if the device is really a IP175D */
        if(phydev-&gt;bus-&gt;read(phydev-&gt;bus, 20, 0) == 0x175d){
            printk(KERN_INFO &quot;IP175D detected\n&quot;);
            
            /* master reset */
            err = phydev-&gt;bus-&gt;write(phydev-&gt;bus, 20, 2, 0x175d);
            if (err &lt; 0)
                return err;

            /* ensure no bus delays overlap reset period */
            err = phydev-&gt;bus-&gt;read(phydev-&gt;bus, 20, 2);

            /* data sheet specifies reset period is 2 msec -
             * This part seems to take longer - wait for master
             * reset register to self-clear
             */
            for(i=0; i&lt;20; i++){
                mdelay(2);
                if(phydev-&gt;bus-&gt;read(phydev-&gt;bus, 20, 2) == 0)
                    break;
            }

            /* Enable learning and forwarding for all ports */
            phydev-&gt;bus-&gt;write(phydev-&gt;bus, 20, 6, phydev-&gt;bus-&gt;read(phydev-&gt;bus, 20, 6) | 0x3f3f);

            /* Disable Special tagging for Tx and Rx */
            phydev-&gt;bus-&gt;write(phydev-&gt;bus, 21, 22, phydev-&gt;bus-&gt;read(phydev-&gt;bus, 21, 22) &amp; 0xfffC);
            
            /* Disable all ingress rules */
            phydev-&gt;bus-&gt;write(phydev-&gt;bus, 22, 1, 0x0400);
            
            /* Keep vlan tags */
            phydev-&gt;bus-&gt;write(phydev-&gt;bus, 22, 2, 0x003F);

            /* All port are in pvid 1 - not sure if this is necessary */
            for(i=4; i&lt;=9; i++)
                phydev-&gt;bus-&gt;write(phydev-&gt;bus, 22, i, 0x0001);

            /* All ports, except 4, are members of the same 
             * vlan group.
             */
            phydev-&gt;bus-&gt;write(phydev-&gt;bus, 23, 0, 0x2f2f);
            phydev-&gt;bus-&gt;write(phydev-&gt;bus, 23, 1, 0x2f2f);
            phydev-&gt;bus-&gt;write(phydev-&gt;bus, 23, 2, 0x2f00);
            for(i=3; i&lt;=7; i++)
                phydev-&gt;bus-&gt;write(phydev-&gt;bus, 23, i, 0x0000);

            /* Don&#039;t add or remove tags.
             */
            for(i=8; i&lt;=23; i++)
                phydev-&gt;bus-&gt;write(phydev-&gt;bus, 23, i, 0);
        }
        else{
            printk(KERN_INFO &quot;IP175C detected\n&quot;);

            /* master reset */
            err = phydev-&gt;bus-&gt;write(phydev-&gt;bus, 30, 0, 0x175c);
            if (err &lt; 0)
                return err;
            
            /* ensure no bus delays overlap reset period */
            err = phydev-&gt;bus-&gt;read(phydev-&gt;bus, 30, 0);
            
            /* data sheet specifies reset period is 2 msec */
            mdelay(2);

            /* enable IP175C mode */
            err = phydev-&gt;bus-&gt;write(phydev-&gt;bus, 29, 31, 0x175c);
            if (err &lt; 0)
                return err;

            /* Set MII0 speed and duplex (in PHY mode) */
            err = phydev-&gt;bus-&gt;write(phydev-&gt;bus, 29, 22, 0x420);
            if (err &lt; 0)
                return err;

            /* Configure ports 5, 0, 1, 2, 3 to be
             * members of the same vlan.  Exclude port 4
             * Disable tagging
             */
            phydev-&gt;bus-&gt;write(phydev-&gt;bus, 29, 19, phydev-&gt;bus-&gt;read(phydev-&gt;bus, 29, 19) | 0x8f8f);
            phydev-&gt;bus-&gt;write(phydev-&gt;bus, 29, 20, phydev-&gt;bus-&gt;read(phydev-&gt;bus, 29, 20) | 0x8f8f);
            phydev-&gt;bus-&gt;write(phydev-&gt;bus, 29, 21, phydev-&gt;bus-&gt;read(phydev-&gt;bus, 29, 21) &amp; 0x70ff);
            phydev-&gt;bus-&gt;write(phydev-&gt;bus, 29, 23, phydev-&gt;bus-&gt;read(phydev-&gt;bus, 29, 23) &amp; 0x007c);
        }

        /* reset switch ports */
        for (i = 0; i &lt; 5; i++) {
            err = phydev-&gt;bus-&gt;write(phydev-&gt;bus, i,
                         MII_BMCR, BMCR_RESET);
            if (err &lt; 0)
                return err;
        }

        for (i = 0; i &lt; 5; i++)
            err = phydev-&gt;bus-&gt;read(phydev-&gt;bus, i, MII_BMCR);

        mdelay(2);

        full_reset_performed = 1;
    }

    if (phydev-&gt;addr != 4) {
        phydev-&gt;state = PHY_RUNNING;
        phydev-&gt;speed = SPEED_100;
        phydev-&gt;duplex = DUPLEX_FULL;
        phydev-&gt;link = 1;
        netif_carrier_on(phydev-&gt;attached_dev);
    }

    return 0;
}</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p98539">
				<div class="post-metadata">
					<div class="post-num">Post #165</div>
					<div class="post-author">lijan</div>
					<div class="post-datetime">
						9 Dec 2009, 20:50					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>mschank wrote:</cite><blockquote><p>Hello Group,</p><p>Just an FYI for other RB450 users.&nbsp; We recently purchased a batch of RB450 boards and most of them had the ip175D switch device instead of the ip175C.&nbsp; These two devices are not software compatible, so neither the current ip175c.c nor the current icplus.c driver will work.&nbsp; Below is the modification I made to icplus.c to add support for the ip175d.&nbsp; This simply configures the device to be a basic 4 port switch.</p><div class="codebox"><pre><code>static int ip175c_config_init(struct phy_device *phydev)
{
    int err, i;
    static int full_reset_performed = 0;

    if (full_reset_performed == 0) {

        /* Determine if the device is really a IP175D */
        if(phydev-&gt;bus-&gt;read(phydev-&gt;bus, 20, 0) == 0x175d){
            printk(KERN_INFO &quot;IP175D detected\n&quot;);
            
            /* master reset */
            err = phydev-&gt;bus-&gt;write(phydev-&gt;bus, 20, 2, 0x175d);
            if (err &lt; 0)
                return err;

            /* ensure no bus delays overlap reset period */
            err = phydev-&gt;bus-&gt;read(phydev-&gt;bus, 20, 2);

            /* data sheet specifies reset period is 2 msec -
             * This part seems to take longer - wait for master
             * reset register to self-clear
             */
            for(i=0; i&lt;20; i++){
                mdelay(2);
                if(phydev-&gt;bus-&gt;read(phydev-&gt;bus, 20, 2) == 0)
                    break;
            }

            /* Enable learning and forwarding for all ports */
            phydev-&gt;bus-&gt;write(phydev-&gt;bus, 20, 6, phydev-&gt;bus-&gt;read(phydev-&gt;bus, 20, 6) | 0x3f3f);

            /* Disable Special tagging for Tx and Rx */
            phydev-&gt;bus-&gt;write(phydev-&gt;bus, 21, 22, phydev-&gt;bus-&gt;read(phydev-&gt;bus, 21, 22) &amp; 0xfffC);
            
            /* Disable all ingress rules */
            phydev-&gt;bus-&gt;write(phydev-&gt;bus, 22, 1, 0x0400);
            
            /* Keep vlan tags */
            phydev-&gt;bus-&gt;write(phydev-&gt;bus, 22, 2, 0x003F);

            /* All port are in pvid 1 - not sure if this is necessary */
            for(i=4; i&lt;=9; i++)
                phydev-&gt;bus-&gt;write(phydev-&gt;bus, 22, i, 0x0001);

            /* All ports, except 4, are members of the same 
             * vlan group.
             */
            phydev-&gt;bus-&gt;write(phydev-&gt;bus, 23, 0, 0x2f2f);
            phydev-&gt;bus-&gt;write(phydev-&gt;bus, 23, 1, 0x2f2f);
            phydev-&gt;bus-&gt;write(phydev-&gt;bus, 23, 2, 0x2f00);
            for(i=3; i&lt;=7; i++)
                phydev-&gt;bus-&gt;write(phydev-&gt;bus, 23, i, 0x0000);

            /* Don&#039;t add or remove tags.
             */
            for(i=8; i&lt;=23; i++)
                phydev-&gt;bus-&gt;write(phydev-&gt;bus, 23, i, 0);
        }
        else{
            printk(KERN_INFO &quot;IP175C detected\n&quot;);

            /* master reset */
            err = phydev-&gt;bus-&gt;write(phydev-&gt;bus, 30, 0, 0x175c);
            if (err &lt; 0)
                return err;
            
            /* ensure no bus delays overlap reset period */
            err = phydev-&gt;bus-&gt;read(phydev-&gt;bus, 30, 0);
            
            /* data sheet specifies reset period is 2 msec */
            mdelay(2);

            /* enable IP175C mode */
            err = phydev-&gt;bus-&gt;write(phydev-&gt;bus, 29, 31, 0x175c);
            if (err &lt; 0)
                return err;

            /* Set MII0 speed and duplex (in PHY mode) */
            err = phydev-&gt;bus-&gt;write(phydev-&gt;bus, 29, 22, 0x420);
            if (err &lt; 0)
                return err;

            /* Configure ports 5, 0, 1, 2, 3 to be
             * members of the same vlan.  Exclude port 4
             * Disable tagging
             */
            phydev-&gt;bus-&gt;write(phydev-&gt;bus, 29, 19, phydev-&gt;bus-&gt;read(phydev-&gt;bus, 29, 19) | 0x8f8f);
            phydev-&gt;bus-&gt;write(phydev-&gt;bus, 29, 20, phydev-&gt;bus-&gt;read(phydev-&gt;bus, 29, 20) | 0x8f8f);
            phydev-&gt;bus-&gt;write(phydev-&gt;bus, 29, 21, phydev-&gt;bus-&gt;read(phydev-&gt;bus, 29, 21) &amp; 0x70ff);
            phydev-&gt;bus-&gt;write(phydev-&gt;bus, 29, 23, phydev-&gt;bus-&gt;read(phydev-&gt;bus, 29, 23) &amp; 0x007c);
        }

        /* reset switch ports */
        for (i = 0; i &lt; 5; i++) {
            err = phydev-&gt;bus-&gt;write(phydev-&gt;bus, i,
                         MII_BMCR, BMCR_RESET);
            if (err &lt; 0)
                return err;
        }

        for (i = 0; i &lt; 5; i++)
            err = phydev-&gt;bus-&gt;read(phydev-&gt;bus, i, MII_BMCR);

        mdelay(2);

        full_reset_performed = 1;
    }

    if (phydev-&gt;addr != 4) {
        phydev-&gt;state = PHY_RUNNING;
        phydev-&gt;speed = SPEED_100;
        phydev-&gt;duplex = DUPLEX_FULL;
        phydev-&gt;link = 1;
        netif_carrier_on(phydev-&gt;attached_dev);
    }

    return 0;
}</code></pre></div></blockquote></div><p>Hello,</p><p>I can&#039;t get it working. On 175C chip I use the ip175.c driver but change for icplus.c with your mod doesn&#039;t work on my 450 with 175D.<br />In dmesg I see:<br /></p><div class="codebox"><pre><code>IP175D detected
eth0: connected to PHY at ag71xx-mdio:04 [uid=02430d80, driver=ICPlus IP175C]
eth1: connected to 4 PHYs</code></pre></div><p>Neither swconfig nor IP address directly on eth1 works.</p><p>Can you please post your config and rev. number or some more details to get it working?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p98934">
				<div class="post-metadata">
					<div class="post-num">Post #166</div>
					<div class="post-author">OpenWRT_Forum</div>
					<div class="post-datetime">
						17 Dec 2009, 21:25					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>phorn wrote:</cite><blockquote><p>Look at the first post of this thread for info on the RB450.&nbsp; By following those directions you will end up with a router that has all 5 ports combined. </p><p>The rest of the thread is about the IP175C switch (i.e. separating the 5 ports to not be part of the same network). If you are going to try to follow it, you can look at the third page.<br />My webpage at <a href="http://inst.eecs.berkeley.edu/~pathorn/ip175c/">http://inst.eecs.berkeley.edu/~pathorn/ip175c/</a> describes how to patch openwrt 8.09 RC1 to support the switch driver.&nbsp; Try to follow them and if you get stuck, post in the forum.</p><p>Would also be nice to get this info up on the wiki so users don&#039;t have to hunt through the forum (although Google does a pretty good job at searching the openwrt forum)</p><p>@robrob, I haven&#039;t updated the patches yet for 2.6.27 or later.&nbsp; I&#039;ll try and put those up once I upgrade my router (have been busy lately). Sadly, I do not know how to get them formally into openwrt, aside from pestering the main developers... and considering how quickly the supposedly 2008 release has been going, they are probably overworked.</p></blockquote></div><p>I did follow those directions, but at the end of those discussions, the author said &quot;vi /etc/config/network&quot;, unfortunately, he didn&#039;t specify what to write on the /etc/config/network so that<br />that eth0 is wan port and all other ports (eth1 1 - 4 ) are lan ports. Can someone please provide an example of /etc/config/network on how to configure port 0 wan port and port 1-4 combined port as lan port.<br />I&#039;d really appreciate it. I searched every where, but all I can&#039;t find such standard example. <br />thanks. <br />Jerry H.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p99343">
				<div class="post-metadata">
					<div class="post-num">Post #167</div>
					<div class="post-author">phorn</div>
					<div class="post-datetime">
						26 Dec 2009, 14:43					</div>
				</div>
				<div class="post-content content">
					<p>@OpenWRT_Forum: The first 6 pages of this discussion are largely out of date--and most everything has been included in openwrt itself. If you have eth0 and eth1 already and you just want to configure a wan and a lan connection, those instructions are not correct. What you want to do is make one of your interfaces &quot;eth0&quot; and the other &quot;eth1&quot;, and delete everything to do with the switch.</p><p>@lijan: The problems with eth1 may be explained by <a href="https://dev.openwrt.org/ticket/5193">https://dev.openwrt.org/ticket/5193</a>&nbsp; &nbsp;Basically--if a single switch attaches to more than one PHY, then it will not initialze any of the PHYs instead of always initializing the first one. That&#039;s why eth0 printed out the driver, and eth1 printed out nothing. Depending on your needs, this extra step may or may not be necessary--clearly most systems work without it, so that&#039;s why it hasn&#039;t been included in openwrt yet.</p><p>Also, mschank edited the old &lt;b&gt;icplus.c&lt;/b&gt; driver, not the confusingly named &lt;b&gt;ip175.c&lt;/b&gt; one. To change this, you need to edit the kernel configuration (something like target/linux/atheros/config-2.6) and comment out CONFIG_IP175C and uncomment CONFIG_ICPLUS=y. Basically, the difference is that the generic icplus driver does the bare minimum to enable the switch and does not support VLANs.</p><p>If you want to be able to customize the switch beyond the apparent 4/1 port default, writing &quot;ip175c.c&quot; VLAN support for IP175D would probably take a fair amount of work.&nbsp; The only thing I can suggest is to spend the time to understand the datasheet and how to map the standard vlan features into the excessively large featureset of this switch.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p99881">
				<div class="post-metadata">
					<div class="post-num">Post #168</div>
					<div class="post-author">mtadeu</div>
					<div class="post-datetime">
						6 Jan 2010, 19:50					</div>
				</div>
				<div class="post-content content">
					<p>Since r19014, I can&#039;t use 4 ports connected to eth1 by IP175C. The error in detect RB450 as RB450G has corrected in r19047.<br />I update and apply patch from ticket #5193, and the switch respond well (r19047):<br /></p><div class="codebox"><pre><code>ag71xx_mdio: probed
eth0: Atheros AG71xx at 0xba000000, irq 5
eth0: connected to PHY at ag71xx-mdio:04 [uid=02430d80, driver=Generic PHY]
eth1: Atheros AG71xx at 0xb9000000, irq 4
eth1: connected to 4 PHYs
eth1: connected to PHY at ag71xx-mdio:00 [uid=02430d80, driver=IC+ IP175C]</code></pre></div><p>The eth0 works, but the ports connected to eth1 do not work.<br />I use the same confi/network that run well in r18782 (last trunk version that I had success in same board).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p103734">
				<div class="post-metadata">
					<div class="post-num">Post #169</div>
					<div class="post-author">UrsusArctos</div>
					<div class="post-datetime">
						25 Feb 2010, 15:41					</div>
				</div>
				<div class="post-content content">
					<p>I have already extended the ip175c driver by Patrick Horn to handle the IP175D as well. I hope it will get merged to OpenWRT soon, as soon as it gets some testing other than on my RB450. If you are interested, feel free to ask me for a patch by e-mail to mj@ucw.cz.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p105305">
				<div class="post-metadata">
					<div class="post-num">Post #170</div>
					<div class="post-author">sidepipe</div>
					<div class="post-datetime">
						26 Mar 2010, 13:34					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ve managed to get an RB450 working with the IP175C driver with a recent trunk version and the first mod in phorn&#039;s post 107 on this thread ( replacing the switch statement in the driver ) and the config in post 110. I&#039;ve set up a basic configuration so that eth1.2 maps to port 3, eth1.3 to port 2, eth1.4 to port 1 and ( predictably ) eth1.5 to port 0. The numbering is to match the labels on the case.</p><p>However, I&#039;m having the same problem as was mentioned a few posts ago - namely that the driver ( or something ) seems to use the status of port 0 ( at least initially ) to determine the hardware state of all of the ports connected to the switch. Ports 1, 2 and 3 do not send any data ( though tcpdump shows data being sent, the counts on the interfaces for TX bytes are&nbsp; 0 ) UNTIL something is plugged in to port 0. When that happens, the other ports start working ( and, oddly, continue to work when the cable in port 0 is removed again. )</p><p>I can probably fix this myself using trial and error and blind hacking, but it would be a bodge... so before I try I wondered if anyone had found a fix?</p>											<p class="post-edited">(Last edited by <strong>sidepipe</strong> on 26 Mar 2010, 13:35)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p105357">
				<div class="post-metadata">
					<div class="post-num">Post #171</div>
					<div class="post-author">sidepipe</div>
					<div class="post-datetime">
						27 Mar 2010, 11:10					</div>
				</div>
				<div class="post-content content">
					<p>Ok, to follow up my own post, and in case people are having this issue still, I&#039;ve had a quick look this morning and come up with a ( as opposed to <strong>the</strong> ) fix.</p><p>The behavior above is actually logical when you consider how things are connected. In reality, the &quot;eth1&quot; that appears in the rb450 is connected internally to the switch, and so it doesn&#039;t really have its own phy. However. Linux assumes that it does, and so the driver just uses the first phy it finds for the switch... so, when that port is not connected, eth1 is down, and so all VLANs connected to eth1 are also, by definition, down.</p><p>It seems to me that there are a few ways to go:</p><p>1) Create a dummy phy device which is always up. Technically, this is probably the correct way.</p><p>2) On each status change of ANY of the switch ports, make the phy status for eth1 ( or whatever is connected internally ) be the logical or of all of the link states.</p><p>3) My quick hack simple approach, which simply forces the state of the existing phy to up.</p><p>To do this, modify the code as specified by phorn in post 107 of this thread, and make sure that you have the config lines mentioned in post 110. Then, add the following to <strong>target/linux/ar71xx/files/drivers/net/ag71xx/ag71xx.h</strong>:</p><div class="codebox"><pre><code>#define AG71XX_FLAG_FORCE_LINK_UP    1</code></pre></div><p>Now, edit the ( already modified ) <strong>target/linux/ar71xx/files/drivers/net/ag71xx/ag71xx_phy.c</strong> as follows:</p><p>Around line 38 is <strong>if (!ag-&gt;link) {</strong>, modify this to read:</p><div class="codebox"><pre><code>if ((!ag-&gt;link) &amp;&amp; ((!ag-&gt;phy_dev) || (!(ag-&gt;phy_dev-&gt;dev_flags &amp; AG71XX_FLAG_FORCE_LINK_UP)))) {</code></pre></div><p>Around line 251 is an if statement which begins <strong>if (phy_count &gt; 1) {</strong>. Replace this entire if clause with:</p><div class="codebox"><pre><code>               if (phy_count &gt; 1) {
                       printk(KERN_DEBUG &quot;%s: Internally connected, Link always up\n&quot;,
                               dev-&gt;name);
               ag-&gt;phy_dev-&gt;dev_flags |= AG71XX_FLAG_FORCE_LINK_UP;
               ag-&gt;link = ag-&gt;phy_dev-&gt;link = 1;
                       ret = ag71xx_phy_connect_fixed(ag);
               }</code></pre></div><p>During boot you will get a message that the port is internally connected and so always up, followed by another message that the link is up.</p><p>Note that the above files only get copied to the real kernel build tree when needed, so if you have already built an image before making these mode, you will also need to:</p><div class="codebox"><pre><code>cp target/linux/ar71xx/files/drivers/net/ag71xx/ag71xx* build_dir/linux-ar71xx/linux-2.6.32.8/drivers/net/ag71xx/</code></pre></div><p>( If the kernel version is different to mine, then obviously the <strong>linux-2.6.32.8</strong> will reflect this in the above cp line.</p>											<p class="post-edited">(Last edited by <strong>sidepipe</strong> on 27 Mar 2010, 11:15)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p106105">
				<div class="post-metadata">
					<div class="post-num">Post #172</div>
					<div class="post-author">ceraldi</div>
					<div class="post-datetime">
						5 Apr 2010, 20:24					</div>
				</div>
				<div class="post-content content">
					<p>Has anyone made progress on getting the &quot;D&quot; version of the ip175 running on OpenWRT? so far I have had no luck getting this up and running.</p><p>Thanks,<br />Aaron</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p106196">
				<div class="post-metadata">
					<div class="post-num">Post #173</div>
					<div class="post-author">lijan</div>
					<div class="post-datetime">
						6 Apr 2010, 14:32					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>ceraldi wrote:</cite><blockquote><p>Has anyone made progress on getting the &quot;D&quot; version of the ip175 running on OpenWRT? so far I have had no luck getting this up and running.</p><p>Thanks,<br />Aaron</p></blockquote></div><p>I asked UrsusArctos for his patch and it works with the &quot;D&quot; version. Now I&#039;ll test it on &quot;C&quot; version for a backward compatibility. You can ask him too.</p><div class="quotebox"><cite>UrsusArctos wrote:</cite><blockquote><p>I have already extended the ip175c driver by Patrick Horn to handle the IP175D as well. I hope it will get merged to OpenWRT soon, as soon as it gets some testing other than on my RB450. If you are interested, feel free to ask me for a patch by e-mail to mj@ucw.cz.</p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p106305">
				<div class="post-metadata">
					<div class="post-num">Post #174</div>
					<div class="post-author">ceraldi</div>
					<div class="post-datetime">
						7 Apr 2010, 22:51					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>UrsusArctos wrote:</cite><blockquote><p>I have already extended the ip175c driver by Patrick Horn to handle the IP175D as well. I hope it will get merged to OpenWRT soon, as soon as it gets some testing other than on my RB450. If you are interested, feel free to ask me for a patch by e-mail to mj@ucw.cz.</p></blockquote></div><p>Got this patch and just wanted to say THANKS! it works perfectly with the ip175d chip and also seams to work great on a ip178c please include this patch in the trunk or backfire releases.</p><p>-A</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p106928">
				<div class="post-metadata">
					<div class="post-num">Post #175</div>
					<div class="post-author">lorenzo.allegrucci</div>
					<div class="post-datetime">
						15 Apr 2010, 10:43					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>ceraldi wrote:</cite><blockquote><div class="quotebox"><cite>UrsusArctos wrote:</cite><blockquote><p>I have already extended the ip175c driver by Patrick Horn to handle the IP175D as well. I hope it will get merged to OpenWRT soon, as soon as it gets some testing other than on my RB450. If you are interested, feel free to ask me for a patch by e-mail to mj@ucw.cz.</p></blockquote></div><p>Got this patch and just wanted to say THANKS! it works perfectly with the ip175d chip and also seams to work great on a ip178c please include this patch in the trunk or backfire releases.</p><p>-A</p></blockquote></div><p>Hi, I can&#039;t find a way to configure my RB450 with separate ports</p><div class="codebox"><pre><code>dmesg:
IP17xx: Found IP175D at ag71xx-mdio:00
ag71xx_mdio: probed
eth0: Atheros AG71xx at 0xba000000, irq 5
eth0: connected to PHY at ag71xx-mdio:04 [uid=02430d80, driver=Generic PHY]
eth1: Atheros AG71xx at 0xb9000000, irq 4
eth1: connected to PHY at ag71xx-mdio:00 [uid=02430d80, driver=IC+ IP17xx]

root@OpenWrt:~# swconfig dev eth1 show
Global attributes:
        enable_vlan: 1
        name: IP175D
        phy: 0
        reg: 0
        val: 12544
Port 0:
        status: up, 100 Mbps, full duplex, auto-negotiate
        link: 100
        tagged: 0
        pvid: 5
Port 1:
        status: down, auto-negotiate (in progress)
        link: 0
        tagged: 0
        pvid: 4
Port 2:
        status: down, auto-negotiate (in progress)
        link: 0
        tagged: 0
        pvid: 3
Port 3:
        status: down, auto-negotiate (in progress)
        link: 0
        tagged: 0
        pvid: 2
Port 4:
        status: down, auto-negotiate (in progress)
        link: 0
        tagged: 0
        pvid: 0
Port 5:
        status: up, 100 Mbps, cpu port
        link: 100
        tagged: 0
        pvid: 5
VLAN 0:
        tag: 1
        ports:
VLAN 1:
        tag: 2
        ports:
VLAN 2:
        tag: 3
        ports: 3 5
VLAN 3:
        tag: 4
        ports: 2 5
VLAN 4:
        tag: 5
        ports: 1 5
VLAN 5:
        tag: 6
        ports: 0 5
VLAN 6:
        tag: 7
        ports:
VLAN 7:
        tag: 8
        ports:
VLAN 8:
        tag: 9
        ports:
VLAN 9:
        tag: 10
        ports:
VLAN 10:
        tag: 11
        ports:
VLAN 11:
        tag: 12
        ports:
VLAN 12:
        tag: 13
        ports:
VLAN 13:
        tag: 14
        ports:
VLAN 14:
        tag: 15
        ports:
VLAN 15:
        tag: 16
        ports:

root@OpenWrt:~# ifconfig
eth0      Link encap:Ethernet  HWaddr 00:0C:42:5B:87:DD
          inet addr:192.168.250.250  Bcast:192.168.250.255  Mask:255.255.255.0
          inet6 addr: fe80::20c:42ff:fe5b:87dd/64 Scope:Link
          UP BROADCAST MULTICAST  MTU:1500  Metric:1
          RX packets:15 errors:0 dropped:0 overruns:0 frame:0
          TX packets:6 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:3156 (3.0 KiB)  TX bytes:468 (468.0 B)
          Interrupt:5

eth1      Link encap:Ethernet  HWaddr 00:0C:42:5B:87:DE
          inet addr:192.168.1.254  Bcast:192.168.1.255  Mask:255.255.255.0
          inet6 addr: fe80::20c:42ff:fe5b:87de/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:30 errors:0 dropped:0 overruns:0 frame:0
          TX packets:42 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:4264 (4.1 KiB)  TX bytes:3036 (2.9 KiB)
          Interrupt:4

eth1.2    Link encap:Ethernet  HWaddr 00:0C:42:5B:87:DE
          inet addr:192.168.2.254  Bcast:192.168.2.255  Mask:255.255.255.0
          inet6 addr: fe80::20c:42ff:fe5b:87de/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:5 errors:0 dropped:1 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:0 (0.0 B)  TX bytes:398 (398.0 B)

eth1.3    Link encap:Ethernet  HWaddr 00:0C:42:5B:87:DE
          inet addr:192.168.3.254  Bcast:192.168.3.255  Mask:255.255.255.0
          inet6 addr: fe80::20c:42ff:fe5b:87de/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:6 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:0 (0.0 B)  TX bytes:492 (492.0 B)

eth1.4    Link encap:Ethernet  HWaddr 00:0C:42:5B:87:DE
          inet addr:192.168.4.254  Bcast:192.168.4.255  Mask:255.255.255.0
          inet6 addr: fe80::20c:42ff:fe5b:87de/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:6 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:0 (0.0 B)  TX bytes:492 (492.0 B)

eth1.5    Link encap:Ethernet  HWaddr 00:0C:42:5B:87:DE
          inet addr:192.168.5.254  Bcast:192.168.5.255  Mask:255.255.255.0
          inet6 addr: fe80::20c:42ff:fe5b:87de/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:15 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:0 (0.0 B)  TX bytes:906 (906.0 B)

lo        Link encap:Local Loopback
          inet addr:127.0.0.1  Mask:255.0.0.0
          inet6 addr: ::1/128 Scope:Host
          UP LOOPBACK RUNNING  MTU:16436  Metric:1
          RX packets:9 errors:0 dropped:0 overruns:0 frame:0
          TX packets:9 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:1008 (1008.0 B)  TX bytes:1008 (1008.0 B)


root@OpenWrt:~# cat /etc/config/network
config interface loopback
        option ifname   lo
        option proto    static
        option ipaddr   127.0.0.1
        option netmask  255.0.0.0

config interface wan
        option ifname   eth0
        option proto    static
        option ipaddr   192.168.250.250
        option netmask  255.255.255.0

config interface port3
        option ifname   &quot;eth1.2&quot;
        option proto    static
        option ipaddr   192.168.2.254
        option netmask  255.255.255.0

config interface port2
        option ifname   &quot;eth1.3&quot;
        option proto    static
        option ipaddr   192.168.3.254
        option netmask  255.255.255.0

config interface port1
        option ifname   &quot;eth1.4&quot;
        option proto    static
        option ipaddr   192.168.4.254
        option netmask  255.255.255.0

config interface port0
        option ifname   &quot;eth1.5&quot;
        option proto    static
        option ipaddr   192.168.5.254
        option netmask  255.255.255.0

config switch eth1
        option name     eth1
        option reset    1
        option enable_vlan 1

config switch_vlan
        option device   eth1
        option vlan     2
        option ports    &quot;5 3&quot;

config switch_vlan
        option device   eth1
        option vlan     3
        option ports    &quot;5 2&quot;

config switch_vlan
        option device   eth1
        option vlan     4
        option ports    &quot;5 1&quot;

config switch_vlan
        option device   eth1
        option vlan     5
        option ports    &quot;5 0&quot;</code></pre></div><p>I can&#039;t ping any eth1.X, just eth1 and eth0 </p><p>Am I missing something?</p><p>ceraldi, can you please port your configuration?<br />Thank you.</p>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 7 of 9</div><nav><ul><li><a href="viewtopic.php%3Fid=17501&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=17501&amp;p=5.html">5</a></li><li><a href="viewtopic.php%3Fid=17501&amp;p=6.html">6</a></li><li class="pagination-current"><span>7</span></li><li><a href="viewtopic.php%3Fid=17501&amp;p=8.html">8</a></li><li><a href="viewtopic.php%3Fid=17501&amp;p=9.html">9</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0.001 -->

</body>
</html>