<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Discrepancy between &quot;ip -6 route&quot; and &quot;route -A inet6&quot;</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 7 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p207090">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">risa2000</div>
					<div class="post-datetime">
						14 Jul 2013, 11:39					</div>
				</div>
				<div class="post-content content">
					<p>I am running trunk build (r37268) on TL-WR1043ND.</p><p>During debugging some issues on IPv6 I noticed (to my big surprise) that there is a big difference between the information obtained via <strong>ip -6 route</strong> and <strong>route -A inet6</strong>.</p><div class="codebox"><pre><code>root@risa-wrt:~# route -A inet6
Kernel IPv6 routing table
Destination                                 Next Hop                                Flags Metric Ref    Use Iface
2a00:1450:4007:803::1016/128                fe80::207:cbff:fe96:d1de                UGC   0      5577       0 eth0.2
2a00:1450:4007:809::1010/128                fe80::207:cbff:fe96:d1de                UGC   0      2        0 eth0.2
2a00:1450:4007:809::101d/128                fe80::207:cbff:fe96:d1de                UGC   0      2        0 eth0.2
2a00:1450:400c:c03::6d/128                  fe80::207:cbff:fe96:d1de                UGC   0      18       0 eth0.2
2a01:e00::1/128                             fe80::207:cbff:fe96:d1de                UGC   0      1        0 eth0.2
2a01:e00::2/128                             fe80::207:cbff:fe96:d1de                UGC   0      1        0 eth0.2
2a01:xxxx:yyyy:1470::/64                    ::                                      U     256    0        0 eth0.2
::/0                                        fe80::207:cbff:fe96:d1de                UG    1024   0        0 eth0.2
2a01:xxxx:yyyy:1470:a00:27ff:febf:ba96/128  2a01:xxxx:yyyy:1470:a00:27ff:febf:ba96  UC    0      24       0 br-lan
2a01:xxxx:yyyy:1470:5824:b1c4:b17e:8787/128 2a01:xxxx:yyyy:1470:5824:b1c4:b17e:8787 UC    0      168       2 br-lan
2a01:xxxx:yyyy:1470::/64                    ::                                      U     256    0        0 br-lan
fe80::207:cbff:fe96:d1de/128                fe80::207:cbff:fe96:d1de                UC    0      9        0 eth0.2
fe80::a00:27ff:febf:ba96/128                fe80::a00:27ff:febf:ba96                UC    0      1        0 br-lan
fe80::/64                                   ::                                      U     256    0        0 eth0
fe80::/64                                   ::                                      U     256    0        0 br-lan
fe80::/64                                   ::                                      U     256    0        0 eth0.2
fe80::/64                                   ::                                      U     256    0        0 wlan0
::1/128                                     ::                                      U     0      0        1 lo
2a01:xxxx:yyyy:1470::/128                   ::                                      U     0      0        1 lo
2a01:xxxx:yyyy:1470::/128                   ::                                      U     0      0        1 lo
2a01:xxxx:yyyy:1470::6/128                  ::                                      U     0      2814       3 lo
2a01:xxxx:yyyy:1470:24f:4eff:fe60:4ea5/128  ::                                      U     0      10       1 lo
2a01:xxxx:yyyy:1470:24f:4eff:fe60:4ea5/128  ::                                      U     0      2        1 lo
fe80::/128                                  ::                                      U     0      0        1 lo
fe80::/128                                  ::                                      U     0      0        1 lo
fe80::/128                                  ::                                      U     0      0        1 lo
fe80::/128                                  ::                                      U     0      0        1 lo
fe80::24f:4eff:fe60:4ea5/128                ::                                      U     0      14880       1 lo
fe80::76ea:3aff:fea1:70d8/128               ::                                      U     0      0        1 lo
fe80::76ea:3aff:fea1:70d8/128               ::                                      U     0      2724       1 lo
fe80::76ea:3aff:fea1:70d8/128               ::                                      U     0      0        1 lo
ff02::1:ff00:6/128                          ff02::1:ff00:6                          UC    0      1        0 br-lan
ff02::1:ff60:4ea5/128                       ff02::1:ff60:4ea5                       UC    0      1        0 eth0.2
ff02::1:ffbf:ba96/128                       ff02::1:ffbf:ba96                       UC    0      2        0 eth0.2
ff00::/8                                    ::                                      U     256    0        0 eth0
ff00::/8                                    ::                                      U     256    0        0 br-lan
ff00::/8                                    ::                                      U     256    0        0 eth0.2
ff00::/8                                    ::                                      U     256    0        0 wlan0</code></pre></div><p>compared to<br /></p><div class="codebox"><pre><code>root@risa-wrt:~# ip -6 route
2a01:xxxx:yyyy:1470::/64 dev br-lan  proto kernel  metric 256
fe80::/64 dev eth0  proto kernel  metric 256
fe80::/64 dev br-lan  proto kernel  metric 256
fe80::/64 dev eth0.2  proto kernel  metric 256
fe80::/64 dev wlan0  proto kernel  metric 256</code></pre></div><p>When I run both commands on IPv4 they gave the expected results:</p><div class="codebox"><pre><code>root@risa-wrt:~# ip route
default via 88.aaa.bbb.254 dev eth0.2  proto static
88.aaa.bbb.0/24 dev eth0.2  proto kernel  scope link  src 88.aaa.bbb.71
192.168.4.0/24 via 192.168.100.2 dev tun0
192.168.6.0/24 dev br-lan  proto kernel  scope link  src 192.168.6.10
192.168.7.0/24 dev wlan0  proto kernel  scope link  src 192.168.7.10
192.168.100.0/24 via 192.168.100.2 dev tun0
192.168.100.2 dev tun0  proto kernel  scope link  src 192.168.100.1

root@risa-wrt:~# route
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
default         88.aaa.bbb.254  0.0.0.0         UG    0      0        0 eth0.2
88.aaa.bbb.0    *               255.255.255.0   U     0      0        0 eth0.2
192.168.4.0     192.168.100.2   255.255.255.0   UG    0      0        0 tun0
192.168.6.0     *               255.255.255.0   U     0      0        0 br-lan
192.168.7.0     *               255.255.255.0   U     0      0        0 wlan0
192.168.100.0   192.168.100.2   255.255.255.0   UG    0      0        0 tun0
192.168.100.2   *               255.255.255.255 UH    0      0        0 tun0</code></pre></div><p>Can anyone explain the difference in IPv6? Especially why is <strong>ip -6 route</strong> missing default gateway?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p207091">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">CyrusFF</div>
					<div class="post-datetime">
						14 Jul 2013, 11:58					</div>
				</div>
				<div class="post-content content">
					<p>Ipv6 routes are split up onto different routing tables. Route lists all routes from all tables whereas ip only lists the maun table by default. You can use ip -6 route show table all to list all routes.<br />Note that some tables / routes are restricted by further policy rules which are not listed here. Use ip -6 rule to list them.</p><p>See <a href="http://wiki.openwrt.org/doc/uci/network6#routing.mangement">http://wiki.openwrt.org/doc/uci/network â€¦ .mangement</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p207093">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">risa2000</div>
					<div class="post-datetime">
						14 Jul 2013, 12:15					</div>
				</div>
				<div class="post-content content">
					<p>It looks like &quot;C&quot; flag in <strong>route -A inet6</strong> output corresponds to two tables in <strong>ip -6 route show table all</strong>, one is called &quot;local&quot; and one is called &quot;1005&quot;, which in my case contains (among others) default getaway route. Now I wonder if it comes from 6relayd or odhcp6c because I do not set default gw myself (I did in the past but for some reason it stopped working with new builds)?</p><p>I am trying to figure out what exactly 6relayd or odhcp6c do and how do they do it, but it seems it is not documented anywhere.</p>											<p class="post-edited">(Last edited by <strong>risa2000</strong> on 14 Jul 2013, 12:36)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p207095">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">CyrusFF</div>
					<div class="post-datetime">
						14 Jul 2013, 12:38					</div>
				</div>
				<div class="post-content content">
					<p>Neither of those do. netifd creates a new routing table for each upstream-interfaces and adds all corresponding routes to this table. Then policy rules are added so that only packets with a matching source adress from the delegated prefix provided on that interface can use these routes. This is to ensure prefix deprecation and multiple uplinks work correctly.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p207101">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">risa2000</div>
					<div class="post-datetime">
						14 Jul 2013, 13:00					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for the tip. Looking into netifd wiki now makes me wonder if the strange changes in /etc/config/network I noticed recently comes from this.</p><p>I just wish all those &quot;under the hood&quot; automatisms would have been better traceable.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>