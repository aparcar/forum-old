<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Slow boot on TP-Link with AA</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 30 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p216148">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">vperron</div>
					<div class="post-datetime">
						30 Oct 2013, 09:10					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>I have witnessed something that is rather strange to me, since I&#039;ve been working on embedded systems for a while and am used to extremely fast boot times...</p><p>My TP-Link MR3020 and WR703N do take what feels like _ages_ to boot.<br />In other words, the &quot;boot status&quot; LED flashes for like.. 2 or 3 minutes before I have access to the system.</p><p>My question is, is that normal ? Is it the same for every OpenWRT version ? Is there a workaraound ? <br />The original (I guess no-OpenWRT based) firmware for those routers does boot in ~10 seconds. </p><p>Is is something we can achieve ? I found no mention of that whatsoever on the Web, so maybe some guru can help me there.</p><p>All the best,</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216186">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">tmo26</div>
					<div class="post-datetime">
						30 Oct 2013, 14:16					</div>
				</div>
				<div class="post-content content">
					<p>My MR3020 with AA12.09-rc1&nbsp; takes approx. 45...60sec to boot.</p><p>To get help, you should post more information about your system.</p><p>Do you have a USB thumbdrive attached? Possibly with filesystem check activated? (just guessing)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216187">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">vperron</div>
					<div class="post-datetime">
						30 Oct 2013, 14:23					</div>
				</div>
				<div class="post-content content">
					<p>Hm. 45-60 sec is still longer than my linux PC, right ? <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /><br />So, my system is a custom build using ImageBuilder, and a collection of packages - but nothing too fancy. </p><p>I do not have a USB flash drive attached, but I do include software packages to support 3G/ext drive/ etc, maybe those are doing special checks at init time - even if nothing is present ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216193">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">tmo26</div>
					<div class="post-datetime">
						30 Oct 2013, 15:10					</div>
				</div>
				<div class="post-content content">
					<p>Have a look at the logs to see what&#039;s taking that long time.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216661">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">vperron</div>
					<div class="post-datetime">
						4 Nov 2013, 08:28					</div>
				</div>
				<div class="post-content content">
					<p>Hey, </p><p>sorry to reply so lately.</p><p>I already set the $pi_mount_skip_next preinit variable to true (cf. <a href="http://wiki.openwrt.org/doc/techref/preinit_mount)">http://wiki.openwrt.org/doc/techref/preinit_mount)</a> in order to pass a few checks at startup.<br />My registered bootup time (chronometer) is now of 80 seconds, which is, well, still really slow - compared to my PC <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>So. Here the output of my dmesg which I believe is the first to start recording.</p><p>[&nbsp; &nbsp; 3.390000] Registered led device: tp-link:green:wps<br />[&nbsp; &nbsp; 6.160000] eth0: link up (100Mbps/Full duplex)<br />[&nbsp; &nbsp; 6.690000] JFFS2 notice: (440) jffs2_build_xattr_subsystem: complete building xattr subsystem, 1 of xdatum (0 unchecked, 0 orphan) and 8 of xref (0 dead, 0 orphan) found.<br />[&nbsp; &nbsp; 7.380000] SCSI subsystem initialized<br />[&nbsp; &nbsp; 7.540000] usbcore: registered new interface driver usbfs<br />[&nbsp; &nbsp; 7.550000] usbcore: registered new interface driver hub<br />[&nbsp; &nbsp; 7.560000] usbcore: registered new device driver usb<br />[&nbsp; &nbsp; 7.690000] ehci_hcd: USB 2.0 &#039;Enhanced&#039; Host Controller (EHCI) Driver<br />[&nbsp; &nbsp; 7.690000] ehci-platform ehci-platform: Generic Platform EHCI Controller<br />[&nbsp; &nbsp; 7.700000] ehci-platform ehci-platform: new USB bus registered, assigned bus number 1<br />[&nbsp; &nbsp; 7.740000] ehci-platform ehci-platform: irq 3, io mem 0x1b000000<br />[&nbsp; &nbsp; 7.760000] ehci-platform ehci-platform: USB 2.0 started, EHCI 1.00<br />[&nbsp; &nbsp; 7.760000] hub 1-0:1.0: USB hub found<br />[&nbsp; &nbsp; 7.760000] hub 1-0:1.0: 1 port detected<br />[&nbsp; &nbsp; 7.780000] Initializing USB Mass Storage driver...<br />[&nbsp; &nbsp; 7.790000] usbcore: registered new interface driver usb-storage<br />[&nbsp; &nbsp; 7.790000] USB Mass Storage support registered.<br />[&nbsp; &nbsp;28.370000] eth0: link down<br />[&nbsp; &nbsp;28.870000] Compat-drivers backport release: compat-drivers-2012-09-04-2-gddac993<br />[&nbsp; &nbsp;28.870000] Backport based on wireless-testing.git master-2012-09-07<br />[&nbsp; &nbsp;28.880000] compat.git: wireless-testing.git<br />[&nbsp; &nbsp;28.970000] cfg80211: Calling CRDA to update world regulatory domain<br />[&nbsp; &nbsp;28.970000] cfg80211: World regulatory domain updated:<br />[&nbsp; &nbsp;28.980000] cfg80211:&nbsp; &nbsp;(start_freq - end_freq @ bandwidth), (max_antenna_gain, max_eirp)<br />[&nbsp; &nbsp;28.980000] cfg80211:&nbsp; &nbsp;(2402000 KHz - 2472000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)<br />[&nbsp; &nbsp;28.990000] cfg80211:&nbsp; &nbsp;(2457000 KHz - 2482000 KHz @ 20000 KHz), (300 mBi, 2000 mBm)<br />[&nbsp; &nbsp;29.000000] cfg80211:&nbsp; &nbsp;(2474000 KHz - 2494000 KHz @ 20000 KHz), (300 mBi, 2000 mBm)<br />[&nbsp; &nbsp;29.010000] cfg80211:&nbsp; &nbsp;(5170000 KHz - 5250000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)<br />[&nbsp; &nbsp;29.010000] cfg80211:&nbsp; &nbsp;(5735000 KHz - 5835000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)<br />[&nbsp; &nbsp;29.640000] ath: EEPROM regdomain: 0x0<br />[&nbsp; &nbsp;29.640000] ath: EEPROM indicates default country code should be used<br />[&nbsp; &nbsp;29.640000] ath: doing EEPROM country-&gt;regdmn map search<br />[&nbsp; &nbsp;29.640000] ath: country maps to regdmn code: 0x3a<br />[&nbsp; &nbsp;29.640000] ath: Country alpha2 being used: US<br />[&nbsp; &nbsp;29.640000] ath: Regpair used: 0x3a<br />[&nbsp; &nbsp;29.650000] ieee80211 phy0: Selected rate control algorithm &#039;minstrel_ht&#039;<br />[&nbsp; &nbsp;29.650000] Registered led device: ath9k-phy0<br />[&nbsp; &nbsp;29.650000] ieee80211 phy0: Atheros AR9330 Rev:1 mem=0xb8100000, irq=2<br />[&nbsp; &nbsp;29.650000] cfg80211: Calling CRDA for country: US<br />[&nbsp; &nbsp;29.660000] cfg80211: Regulatory domain changed to country: US<br />[&nbsp; &nbsp;29.660000] cfg80211:&nbsp; &nbsp;(start_freq - end_freq @ bandwidth), (max_antenna_gain, max_eirp)<br />[&nbsp; &nbsp;29.670000] cfg80211:&nbsp; &nbsp;(2402000 KHz - 2472000 KHz @ 40000 KHz), (300 mBi, 2700 mBm)<br />[&nbsp; &nbsp;29.680000] cfg80211:&nbsp; &nbsp;(5170000 KHz - 5250000 KHz @ 40000 KHz), (300 mBi, 1700 mBm)<br />[&nbsp; &nbsp;29.690000] cfg80211:&nbsp; &nbsp;(5250000 KHz - 5330000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)<br />[&nbsp; &nbsp;29.700000] cfg80211:&nbsp; &nbsp;(5490000 KHz - 5600000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)<br />[&nbsp; &nbsp;29.700000] cfg80211:&nbsp; &nbsp;(5650000 KHz - 5710000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)<br />[&nbsp; &nbsp;29.710000] cfg80211:&nbsp; &nbsp;(5735000 KHz - 5835000 KHz @ 40000 KHz), (300 mBi, 3000 mBm)<br />[&nbsp; &nbsp;30.100000] ip_tables: (C) 2000-2006 Netfilter Core Team<br />[&nbsp; &nbsp;30.250000] nf_conntrack version 0.5.0 (456 buckets, 1824 max)<br />[&nbsp; &nbsp;30.890000] usbcore: registered new interface driver cdc_ether<br />[&nbsp; &nbsp;34.300000] eth0: link up (100Mbps/Full duplex)</p><br /><p>Seems that 20 seconds are already lost between: <br />[&nbsp; &nbsp; 7.790000] USB Mass Storage support registered.<br />[&nbsp; &nbsp;28.370000] eth0: link down</p><p>I don&#039;t know what is supposed to happen there though. Is it that the network driver gets loaded, and starts initializing eth0 at that time ? Is there a way to make it spawn quicker ? Are there any init params to the kernel to make that all go faster ?</p><p>Also, This accounts for ~30seconds of the total 80-90 seconds of the total. So preinit (which happens before dmesg reporting) actually takes about 60 seconds to finish. Why is that so ??</p><p>All the best and many thanks for your answers!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216664">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">vperron</div>
					<div class="post-datetime">
						4 Nov 2013, 09:00					</div>
				</div>
				<div class="post-content content">
					<p>After having activated every possible kind of debug output in the build params, here is what happens (with some more insight)</p><p>[&nbsp; &nbsp; 1.200000] Freeing unused kernel memory: 212k freed<br />....<br />[&nbsp; &nbsp; 6.160000] eth0: link up (100Mbps/Full duplex)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ###### eth0 is already up as soon as this<br />[&nbsp; &nbsp; 7.780000] USB Mass Storage support registered.<br />....<br />[&nbsp; &nbsp;28.350000] eth0: link down&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;###### But down again 22 seconds later<br />[&nbsp; &nbsp;28.850000] Compat-drivers backport release: compat-drivers-2012-09-04-2-gddac993&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;#####&nbsp; Wireless drivers are loaded<br />[&nbsp; &nbsp;28.860000] Backport based on wireless-testing.git master-2012-09-07<br />[&nbsp; &nbsp;28.870000] compat.git: wireless-testing.git<br />[&nbsp; &nbsp;28.960000] cfg80211: Calling CRDA to update world regulatory domain<br />....<br />[&nbsp; &nbsp;34.190000] eth0: link up (100Mbps/Full duplex)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;####### Up again.</p><br /><p>So... I guess the complete boot takes an extra 30 seconds, because of this network initialization, but I doubt this can be avoided.</p><p>Also... It seems that after the first boot, the /lib/preinit/00_preinit.conf has disappeared and is replaced by a /lib/preinit/00_extroot.conf which contains an... &quot; extroot_settle_time=&quot;20&quot; &quot; value.</p><p>Interesting.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>