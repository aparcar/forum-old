<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> wr740n v4 USB mod! [AR9331] [FW compiled for all wr740/741 versions!]</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 6 Jun 2015 and 1 May 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 3 of 9</div><nav><ul><li><a href="viewtopic.php%3Fid=37368&amp;p=1.html">1</a></li><li><a href="viewtopic.php%3Fid=37368&amp;p=2.html">2</a></li><li class="pagination-current"><span>3</span></li><li><a href="viewtopic.php%3Fid=37368&amp;p=4.html">4</a></li><li><a href="viewtopic.php%3Fid=37368&amp;p=5.html">5</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=37368&amp;p=9.html">9</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p202657">
				<div class="post-metadata">
					<div class="post-num">Post #51</div>
					<div class="post-author">dabyd64</div>
					<div class="post-datetime">
						24 May 2013, 16:37					</div>
				</div>
				<div class="post-content content">
					<p>hehe <img src="https://forum.openwrt.org/img/smilies/tongue.png" width="15" height="15" alt="tongue" /> I thought it wasn&#039;t, but yes, it&#039;s well written on the first post...<br /></p><div class="quotebox"><cite>dabyd64 wrote:</cite><blockquote><p><span style="color: red"><strong>Compile it for the first time</strong></span>, with the modules/settings you want.<br />For mounting USB drives, select kernel kmod modules:<br />&nbsp; &nbsp; &nbsp; &nbsp; USB support: usb2, ohci, storage<br />&nbsp; &nbsp; &nbsp; &nbsp; Filesystems: ext4, ntfs, vfat<br />&nbsp; &nbsp; &nbsp; &nbsp; Native language support: cp437,cp852,iso-8859-1, utf8.</p><p>If you want R/W NTFS support, select:<br />&nbsp; &nbsp; &nbsp; &nbsp; Utilities/filesystems/ntfs-3g<br />&nbsp; &nbsp; &nbsp; &nbsp; <br /><span style="color: red"><strong>Then</strong></span> go to build_dir/linux-ar71xx_generic/linux-3.3.8/arch/mips/ath79<br />Edit this files:</p><p>&nbsp; &nbsp; &nbsp; &nbsp; mach-tl-wr741nd-v4.c<br />add&nbsp; &nbsp; &nbsp; &nbsp; #include &quot;dev-usb.h&quot;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;at the top of the file<br />add&nbsp; &nbsp; &nbsp; &nbsp; ath79_register_usb();&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; before ath79_register_m25p80(&amp;tl_wr741ndv4_flash_data)</p><p>&nbsp; &nbsp; &nbsp; &nbsp; Kconfig<br />add&nbsp; &nbsp; &nbsp; &nbsp; select ATH79_DEV_USB&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;under &quot;config ATH79_MACH_TL_WR741ND_V4&quot;</p><p><span style="color: red"><strong>Now, run make again</strong></span>. Now the USB will work.</p></blockquote></div>											<p class="post-edited">(Last edited by <strong>dabyd64</strong> on 24 May 2013, 16:37)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p202676">
				<div class="post-metadata">
					<div class="post-num">Post #52</div>
					<div class="post-author">pczolee</div>
					<div class="post-datetime">
						24 May 2013, 22:57					</div>
				</div>
				<div class="post-content content">
					<p>Just it wasn&#039;t clear enough so I misunderstood :S, now with colours I think it is much better for beginners <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /> as well.</p><p>Cheers</p><div class="quotebox"><cite>dabyd64 wrote:</cite><blockquote><p>hehe <img src="https://forum.openwrt.org/img/smilies/tongue.png" width="15" height="15" alt="tongue" /> I thought it wasn&#039;t, but yes, it&#039;s well written on the first post...<br /></p><div class="quotebox"><cite>dabyd64 wrote:</cite><blockquote><p><span style="color: red"><strong>Compile it for the first time</strong></span>, with the modules/settings you want.<br />For mounting USB drives, select kernel kmod modules:<br />&nbsp; &nbsp; &nbsp; &nbsp; USB support: usb2, ohci, storage<br />&nbsp; &nbsp; &nbsp; &nbsp; Filesystems: ext4, ntfs, vfat<br />&nbsp; &nbsp; &nbsp; &nbsp; Native language support: cp437,cp852,iso-8859-1, utf8.</p><p>If you want R/W NTFS support, select:<br />&nbsp; &nbsp; &nbsp; &nbsp; Utilities/filesystems/ntfs-3g<br />&nbsp; &nbsp; &nbsp; &nbsp; <br /><span style="color: red"><strong>Then</strong></span> go to build_dir/linux-ar71xx_generic/linux-3.3.8/arch/mips/ath79<br />Edit this files:</p><p>&nbsp; &nbsp; &nbsp; &nbsp; mach-tl-wr741nd-v4.c<br />add&nbsp; &nbsp; &nbsp; &nbsp; #include &quot;dev-usb.h&quot;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;at the top of the file<br />add&nbsp; &nbsp; &nbsp; &nbsp; ath79_register_usb();&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; before ath79_register_m25p80(&amp;tl_wr741ndv4_flash_data)</p><p>&nbsp; &nbsp; &nbsp; &nbsp; Kconfig<br />add&nbsp; &nbsp; &nbsp; &nbsp; select ATH79_DEV_USB&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;under &quot;config ATH79_MACH_TL_WR741ND_V4&quot;</p><p><span style="color: red"><strong>Now, run make again</strong></span>. Now the USB will work.</p></blockquote></div></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p202733">
				<div class="post-metadata">
					<div class="post-num">Post #53</div>
					<div class="post-author">pczolee</div>
					<div class="post-datetime">
						25 May 2013, 12:53					</div>
				</div>
				<div class="post-content content">
					<p>Hi all.</p><p>Finally I made my own image. It is based on Attitude Adjustment 12.09 final.<br />Removed IPv6 and pppoe support (I no need it, so just waste my free space), and unnecessary packages, now we have 668 KB free space after install.<br />There is usb support complied in with vfat and ext4 support. It have luci as web interface.</p><p>Everything else can install from packages.</p><p>WR741ND v1.x <a href="http://www.sendspace.com/file/7w2k7v">http://www.sendspace.com/file/7w2k7v</a><br />WR741ND v2.x <a href="http://www.sendspace.com/file/kdiiwf">http://www.sendspace.com/file/kdiiwf</a><br />WR741ND v4.x <a href="http://www.sendspace.com/file/50u2d6">http://www.sendspace.com/file/50u2d6</a></p><p>The list of included packages and the md5sum infos are in packages above.</p><p>Other packages: <a href="http://www.sendspace.com/file/k7mcxr">http://www.sendspace.com/file/k7mcxr</a> (13MB)</p><p><strong><span style="color: #FF0000">NEW LINK!!! (updated at 2014 03 04)</span> <a href="http://www.sendspace.com/filegroup/IqmyJCilxaj6eQfUtN6VGTr%2BPX2Armrg">http://www.sendspace.com/filegroup/Iqmy … 2BPX2Armrg</a></strong></p><p>Have fun <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p>											<p class="post-edited">(Last edited by <strong>pczolee</strong> on 4 Mar 2014, 11:26)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p203526">
				<div class="post-metadata">
					<div class="post-num">Post #54</div>
					<div class="post-author">valentt</div>
					<div class="post-datetime">
						2 Jun 2013, 21:07					</div>
				</div>
				<div class="post-content content">
					<p>Guys please help me add correct info to the wiki, I added two images from this post (I hope that author agrees), but wiki page is probably missing some additional info so please check it out:<br /><a href="http://wiki.openwrt.org/toh/tp-link/tl-wr741nd#usb.host">http://wiki.openwrt.org/toh/tp-link/tl-wr741nd#usb.host</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p203537">
				<div class="post-metadata">
					<div class="post-num">Post #55</div>
					<div class="post-author">dabyd64</div>
					<div class="post-datetime">
						2 Jun 2013, 22:12					</div>
				</div>
				<div class="post-content content">
					<p>Nice work!<br />I miss some BIG title like &quot;740/741 v4.x USB MOD&quot; on top of that, else it looks that its part of the 741 v2 usb mod.<br />Another thing that needs attention is the wire lenght. Some users were not able to make usb working due they were using the small wire to connect the cpu to the usb socket directly, getting errors and other issues.<br />Use the thin wire to connect the cpu to other thicker wires, keeping the lenght of the thin wires as short as possible, then connect the thicker wires to the usb socket.<br />And connect the 100µF capacitor very near of the usb socket... for the rest it&#039;s ok <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p204172">
				<div class="post-metadata">
					<div class="post-num">Post #56</div>
					<div class="post-author">derrij</div>
					<div class="post-datetime">
						10 Jun 2013, 09:03					</div>
				</div>
				<div class="post-content content">
					<p>thank you for how to.<br />confirm error &quot;Device is not enumerated&quot; because long wire lenght . i cuted wires twice. first time wires long was near as in first post photo.&nbsp; &quot;Device is not enumerated&quot; still persist. after i left only 1 cm long wires and now all OK.<br /><a href="http://ge.tt/3Phhdxi?c">http://ge.tt/3Phhdxi?c</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p204191">
				<div class="post-metadata">
					<div class="post-num">Post #57</div>
					<div class="post-author">derrij</div>
					<div class="post-datetime">
						10 Jun 2013, 14:04					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>pczolee wrote:</cite><blockquote><p>Hi all.</p><p>Finally I made my own image. It is based on Attitude Adjustment 12.09 final.</p></blockquote></div><p> please share how to compile Attitude Adjustment 12.09 with USB support for wr740n.</p>											<p class="post-edited">(Last edited by <strong>derrij</strong> on 10 Jun 2013, 14:18)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p204249">
				<div class="post-metadata">
					<div class="post-num">Post #58</div>
					<div class="post-author">pczolee</div>
					<div class="post-datetime">
						11 Jun 2013, 11:15					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>derrij wrote:</cite><blockquote><div class="quotebox"><cite>pczolee wrote:</cite><blockquote><p>Hi all.</p><p>Finally I made my own image. It is based on Attitude Adjustment 12.09 final.</p></blockquote></div><p> please share how to compile Attitude Adjustment 12.09 with USB support for wr740n.</p></blockquote></div><br /><p>Hi.</p><p>So, the steps was (if I remember well <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /> )</p><p>If you are using debian, or ubuntu, install the needed packages in this way, other systems may have different package manager, and the package names could be also different.</p><p>apt-get install subversion build-essential libncurses5-dev zlib1g-dev gawk git ccache gettext libssl-dev xsltproc</p><p>mkdir ~/openwrt<br />cd ~/openwrt</p><p>If you want the latest svn:<br />svn co svn://svn.openwrt.org/openwrt/branches/attitude_adjustment</p><p>If you want the 12.09 final:<br />svn co svn://svn.openwrt.org/openwrt/tags/attitude_adjustment_12.09/</p><p>cd attitude_adjustment<br />./scripts/feeds update -a<br />./scripts/feeds install</p><p>Select what you want:<br />make menuconfig</p><p>Than build:<br />make</p><p>After this follow the first post (about apply the patch), and build again.</p><p>I hope it helps <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" />.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p204273">
				<div class="post-metadata">
					<div class="post-num">Post #59</div>
					<div class="post-author">derrij</div>
					<div class="post-datetime">
						11 Jun 2013, 14:39					</div>
				</div>
				<div class="post-content content">
					<p>still, can&#039;t compile firmware with usb support. tried 4 times with different branches, but I can&#039;t find build_dir/linux-ar71xx_generic folder. even after&nbsp; </p><div class="codebox"><pre><code>make prereq &amp;&amp; make tools/install &amp;&amp; make toolchain/install </code></pre></div><p> as wiki says.<br />now i have build_dir/linux-ar71xx_generic , thanks to <strong>pczolee</strong>.<br />but still usb not working. i tried attitude_adjustment_12.09<br />which version of openwrt-ar71xx-generic-tl-wr741nd-v to flash, if i have wr740n v4?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p204303">
				<div class="post-metadata">
					<div class="post-num">Post #60</div>
					<div class="post-author">pczolee</div>
					<div class="post-datetime">
						11 Jun 2013, 20:30					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>derrij wrote:</cite><blockquote><p>still, can&#039;t compile firmware with usb support. tried 4 times with different branches, but I can&#039;t find build_dir/linux-ar71xx_generic folder. even after&nbsp; </p><div class="codebox"><pre><code>make prereq &amp;&amp; make tools/install &amp;&amp; make toolchain/install </code></pre></div><p> as wiki says.<br />now i have build_dir/linux-ar71xx_generic , thanks to <strong>pczolee</strong>.<br />but still usb not working. i tried attitude_adjustment_12.09<br />which version of openwrt-ar71xx-generic-tl-wr741nd-v to flash, if i have wr740n v4?</p></blockquote></div><p>Well, I think you can use wr741nd v4, but I&#039;m not 100% sure.<br />Forget the wiki, do what I wrote above.<br />So, I don&#039;t know if I understand, what you wrote, but, finally, you built the image or not?</p><p>Otherwise, there are precompiled images in the first port for 740n v4, try it.</p><p>If you still have problems, please post the messages, debug log, or console output etc.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p204353">
				<div class="post-metadata">
					<div class="post-num">Post #61</div>
					<div class="post-author">derrij</div>
					<div class="post-datetime">
						12 Jun 2013, 09:09					</div>
				</div>
				<div class="post-content content">
					<p>the image compiled and flashed many times, many patch variation.<br />but every time, now answer to cat /sys/kernel/debug/usb/devices.<br />i tried image from the first post, but i need pwc and uvc video modules.<br /></p><div class="codebox"><pre><code>root@OpenWrt:~# opkg install kmod-video-pwc
Installing kmod-video-pwc (3.8.13-1) to root...
Downloading http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/kmod-video-pwc_3.8.13-1_ar71xx.ipk.
Multiple packages (kmod-usb-core and kmod-usb-core) providing same name marked HOLD or PREFER. Using latest.
Collected errors:
 * satisfy_dependencies_for: Cannot satisfy the following dependencies for kmod-video-pwc:
 *      kernel (= 3.8.13-1-219a148eccacc618878de12f719f457f) *  kernel (= 3.8.13-1-219a148eccacc618878de12f719f457f) *  kernel (= 3.8.13-1-219a148eccacc618878de12f719f457f) *
 * opkg_install_cmd: Cannot install package kmod-video-pwc.</code></pre></div><p>i do sysupgrade from the first post. or i need to flash factory.bin to have ability install kernel modules?</p>											<p class="post-edited">(Last edited by <strong>derrij</strong> on 12 Jun 2013, 09:28)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p204359">
				<div class="post-metadata">
					<div class="post-num">Post #62</div>
					<div class="post-author">MBS</div>
					<div class="post-datetime">
						12 Jun 2013, 10:50					</div>
				</div>
				<div class="post-content content">
					<p>derrij: if you build your custom image, you should also build the needed kernel modules and install them. trying to use the officially built ones will be pretty messy. You might need to edit your /etc/opkg.conf. Consult the documentation how to do that.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p204387">
				<div class="post-metadata">
					<div class="post-num">Post #63</div>
					<div class="post-author">dabyd64</div>
					<div class="post-datetime">
						12 Jun 2013, 16:03					</div>
				</div>
				<div class="post-content content">
					<p>Non-kernel dependant packages usually work between kernel versions, but not the &quot;kmod&quot; and other kernel related packages.<br />So...yes, you must select all the packages you need in menuconfig, specially the kmod packages.<br />If you set it with &quot;M&quot; it will compile but not add them in the final image, if you select with &quot;y&quot; it will compile and include in the image, so they will be installed from the beginning.</p>											<p class="post-edited">(Last edited by <strong>dabyd64</strong> on 12 Jun 2013, 16:08)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p204592">
				<div class="post-metadata">
					<div class="post-num">Post #64</div>
					<div class="post-author">derrij</div>
					<div class="post-datetime">
						14 Jun 2013, 10:08					</div>
				</div>
				<div class="post-content content">
					<p>successfully compiled with patch from the wiki<br /> </p><div class="codebox"><pre><code>Index: target/linux/ar71xx/patches-3.3/990-WR741ND-usb.patch
===================================================================
--- target/linux/ar71xx/patches-3.3/990-WR741ND-usb.patch    (revision 0)
+++ target/linux/ar71xx/patches-3.3/990-WR741ND-usb.patch    (revision 0)
@@ -0,0 +1,10 @@
+--- a/arch/mips/ath79/Kconfig    2013-03-12 15:18:29.827389883 +0400
++++ b/arch/mips/ath79/Kconfig    2013-03-12 15:21:57.884753554 +0400
+@@ -506,6 +506,7 @@
+     select ATH79_DEV_AP9X_PCI if PCI
+     select ATH79_DEV_ETH
+     select ATH79_DEV_GPIO_BUTTONS
++    select ATH79_DEV_USB
+     select ATH79_DEV_LEDS_GPIO
+     select ATH79_DEV_M25P80
+ 
Index: target/linux/ar71xx/files/arch/mips/ath79/mach-tl-wr741nd.c
===================================================================
--- target/linux/ar71xx/files/arch/mips/ath79/mach-tl-wr741nd.c    (revision 36033)
+++ target/linux/ar71xx/files/arch/mips/ath79/mach-tl-wr741nd.c    (working copy)
@@ -16,6 +16,7 @@
 #include &quot;dev-eth.h&quot;
 #include &quot;dev-gpio-buttons.h&quot;
 #include &quot;dev-leds-gpio.h&quot;
+#include &quot;dev-usb.h&quot;
 #include &quot;dev-m25p80.h&quot;
 #include &quot;machtypes.h&quot;
 
@@ -97,6 +98,8 @@
     u8 *mac = (u8 *) KSEG1ADDR(0x1f01fc00);
     u8 *ee = (u8 *) KSEG1ADDR(0x1fff1000);
 
+    ath79_register_usb();
+
     ath79_register_m25p80(&amp;tl_wr741nd_flash_data);
 
     ath79_gpio_function_disable(AR724X_GPIO_FUNC_ETH_SWITCH_LED0_EN |</code></pre></div><p>if patch applied after first make. do make clean first, then make again</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p211912">
				<div class="post-metadata">
					<div class="post-num">Post #65</div>
					<div class="post-author">n_dandanov</div>
					<div class="post-datetime">
						9 Sep 2013, 00:38					</div>
				</div>
				<div class="post-content content">
					<p>Hello All,</p><p>dabyd64, thank You for Your useful thread and all the research going on here!<br />I did Your mod to my TP-Link TL-WR740n v.4.23. Then I flashed the router with pczolee&#039;s compiled version and finally - with dabyd64&#039;s.<br />However, when I attach a USB storage (flash drive or MP3 player), I get the following added to the system log:<br /></p><div class="codebox"><pre><code>[  941.730000] usb 1-1: new full-speed USB device number 2 using ehci-platform
[  941.890000] scsi0 : usb-storage 1-1:1.0
[  942.890000] scsi 0:0:0:0: Direct-Access     OMNI     MP3 Player       0100 PQ: 0 ANSI: 4
[  942.900000] scsi 0:0:0:1: Direct-Access     OMNI     MP3 Player       0100 PQ: 0 ANSI: 4
[  942.920000] sd 0:0:0:0: [sda] 247808 512-byte logical blocks: (126 MB/121 MiB)
[  942.940000] sd 0:0:0:0: [sda] Write Protect is off
[  942.940000] sd 0:0:0:0: [sda] Mode Sense: 38 00 00 00
[  942.960000] sd 0:0:0:0: [sda] No Caching mode page present
[  942.960000] sd 0:0:0:0: [sda] Assuming drive cache: write through
[  942.970000] sd 0:0:0:1: [sdb] Attached SCSI removable disk
[  942.990000] sd 0:0:0:0: [sda] No Caching mode page present
[  943.000000] sd 0:0:0:0: [sda] Assuming drive cache: write through
[  943.010000]  sda: sda1
[  943.030000] sd 0:0:0:0: [sda] No Caching mode page present
[  943.030000] sd 0:0:0:0: [sda] Assuming drive cache: write through
[  943.040000] sd 0:0:0:0: [sda] Attached SCSI removable disk</code></pre></div><p>So the file system doesn&#039;t get mounted.<br />Here&#039;s the output of fdisk -l:<br /></p><div class="codebox"><pre><code>root@OpenWrt:~# fdisk -l

Disk /dev/mtdblock0: 0 MB, 131072 bytes
255 heads, 63 sectors/track, 0 cylinders
Units = cylinders of 16065 * 512 = 8225280 bytes

Disk /dev/mtdblock0 doesn&#039;t contain a valid partition table

Disk /dev/mtdblock1: 1 MB, 1004032 bytes
255 heads, 63 sectors/track, 0 cylinders
Units = cylinders of 16065 * 512 = 8225280 bytes

Disk /dev/mtdblock1 doesn&#039;t contain a valid partition table

Disk /dev/mtdblock2: 2 MB, 2993152 bytes
255 heads, 63 sectors/track, 0 cylinders
Units = cylinders of 16065 * 512 = 8225280 bytes

Disk /dev/mtdblock2 doesn&#039;t contain a valid partition table

Disk /dev/mtdblock3: 0 MB, 327680 bytes
255 heads, 63 sectors/track, 0 cylinders
Units = cylinders of 16065 * 512 = 8225280 bytes

Disk /dev/mtdblock3 doesn&#039;t contain a valid partition table

Disk /dev/mtdblock4: 0 MB, 65536 bytes
255 heads, 63 sectors/track, 0 cylinders
Units = cylinders of 16065 * 512 = 8225280 bytes

Disk /dev/mtdblock4 doesn&#039;t contain a valid partition table

Disk /dev/mtdblock5: 3 MB, 3997696 bytes
255 heads, 63 sectors/track, 0 cylinders
Units = cylinders of 16065 * 512 = 8225280 bytes

Disk /dev/mtdblock5 doesn&#039;t contain a valid partition table

Disk /dev/sda: 126 MB, 126877696 bytes
256 heads, 44 sectors/track, 22 cylinders
Units = cylinders of 11264 * 512 = 5767168 bytes

   Device Boot      Start         End      Blocks  Id System
/dev/sda1   *           1          22      123882   b Win95 FAT32</code></pre></div><p>And here&#039;s what happens when I create a directory /tmp/run/mountd/sda1 and try to mount /dev/sda1:<br /></p><div class="codebox"><pre><code>root@OpenWrt:/tmp/run/mountd/sda1# pwd
/tmp/run/mountd/sda1
root@OpenWrt:/tmp/run/mountd/sda1# mount /dev/sda1 /tmp/run/mountd/sda1
NTFS signature is missing.
Failed to mount &#039;/dev/sda1&#039;: Invalid argument
The device &#039;/dev/sda1&#039; doesn&#039;t seem to have a valid NTFS.
Maybe the wrong device is used? Or the whole disk instead of a
partition (e.g. /dev/sda, not /dev/sda1)? Or the other way around?</code></pre></div><p>If I try to mount /dev/sda, I also get an error:<br /></p><div class="codebox"><pre><code>root@OpenWrt:/tmp/run/mountd# mount /dev/sda /tmp/run/mountd/sda1/
NTFS signature is missing.
Failed to mount &#039;/dev/sda&#039;: Invalid argument
The device &#039;/dev/sda&#039; doesn&#039;t seem to have a valid NTFS.
Maybe the wrong device is used? Or the whole disk instead of a
partition (e.g. /dev/sda, not /dev/sda1)? Or the other way around?
mount: mounting /dev/sda on /tmp/run/mountd/sda1/ failed: Invalid argument</code></pre></div><p>The file system I formatted the player in is ext4. Here&#039;s the ouput of dmesg when I connect it to a Debian Squeeze PC:<br /></p><div class="codebox"><pre><code>[ 4960.560527] usb 2-8: new full speed USB device using ohci_hcd and address 4
[ 4960.847146] usb 2-8: New USB device found, idVendor=066f, idProduct=8305
[ 4960.847156] usb 2-8: New USB device strings: Mfr=1, Product=2, SerialNumber=3
[ 4960.847163] usb 2-8: Product: MP3 Player      
[ 4960.847168] usb 2-8: Manufacturer: OMNI    
[ 4960.847172] usb 2-8: SerialNumber: 23DE8E08B9D449A0
[ 4960.847383] usb 2-8: configuration #1 chosen from 1 choice
[ 4960.907586] Initializing USB Mass Storage driver...
[ 4960.907808] scsi6 : SCSI emulation for USB Mass Storage devices
[ 4960.908273] usbcore: registered new interface driver usb-storage
[ 4960.908279] USB Mass Storage support registered.
[ 4960.909488] usb-storage: device found at 4
[ 4960.909494] usb-storage: waiting for device to settle before scanning
[ 4965.909862] usb-storage: device scan complete
[ 4965.916826] scsi 6:0:0:0: Direct-Access     OMNI     MP3 Player       0100 PQ: 0 ANSI: 4
[ 4965.923802] scsi 6:0:0:1: Direct-Access     OMNI     MP3 Player       0100 PQ: 0 ANSI: 4
[ 4965.924962] sd 6:0:0:0: Attached scsi generic sg4 type 0
[ 4965.926398] sd 6:0:0:1: Attached scsi generic sg5 type 0
[ 4965.947800] sd 6:0:0:0: [sdd] 247808 512-byte logical blocks: (126 MB/121 MiB)
[ 4965.965816] sd 6:0:0:0: [sdd] Write Protect is off
[ 4965.965827] sd 6:0:0:0: [sdd] Mode Sense: 38 00 00 00
[ 4965.965833] sd 6:0:0:0: [sdd] Assuming drive cache: write through
[ 4965.976801] sd 6:0:0:1: [sde] Attached SCSI removable disk
[ 4966.042784] sd 6:0:0:0: [sdd] Assuming drive cache: write through
[ 4966.042796]  sdd: sdd1
[ 4966.081808] sd 6:0:0:0: [sdd] Assuming drive cache: write through
[ 4966.081821] sd 6:0:0:0: [sdd] Attached SCSI removable disk
[ 4967.325887] EXT4-fs (sdd1): recovery complete
[ 4967.325900] EXT4-fs (sdd1): mounted filesystem with ordered data mode</code></pre></div><p>I tried with other flash drives, too. Some of them were formatted in FAT32.<br />I also measured the voltage when a device is connected and it stays about 5.1 V. I also tried with another 5V power supply and the result is the same.<br />Here are some photographs of the setup:<br /><a href="http://imageshack.us/photo/my-images/62/am55.jpg/"><span class="postimg"><img src="http://img62.imageshack.us/img62/6944/am55.jpg" alt="http://img62.imageshack.us/img62/6944/am55.jpg" /></span></a><br /><a href="http://imageshack.us/photo/my-images/713/v81p.jpg/"><span class="postimg"><img src="http://img713.imageshack.us/img713/8191/v81p.jpg" alt="http://img713.imageshack.us/img713/8191/v81p.jpg" /></span></a><br /><a href="http://imageshack.us/photo/my-images/580/kw5o.jpg/"><span class="postimg"><img src="http://img580.imageshack.us/img580/4755/kw5o.jpg" alt="http://img580.imageshack.us/img580/4755/kw5o.jpg" /></span></a><br /><a href="http://imageshack.us/photo/my-images/109/5h9.jpg/"><span class="postimg"><img src="http://img109.imageshack.us/img109/7896/5h9.jpg" alt="http://img109.imageshack.us/img109/7896/5h9.jpg" /></span></a></p><br /><p>Does anybody have any clue on what this issue might be produced from?<br />Any advice will be very appreciated!<br />Thank You!</p><br /><p>Best regards,<br />Nickolay</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p211914">
				<div class="post-metadata">
					<div class="post-num">Post #66</div>
					<div class="post-author">dabyd64</div>
					<div class="post-datetime">
						9 Sep 2013, 01:09					</div>
				</div>
				<div class="post-content content">
					<p>You have some nice soldering skills! <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Install dosfstools (apt-get install dosfstools )<br />Then try to format the usb drive with FAT32: mkfs.fat32 /dev/sdx<br />Then connect it to the router and post here what happens, with dmesg and fdisk -l outputs.</p><p>Also, althought I don&#039;t think it&#039;s the problem, try with shorter wires, too long wires may cause some serious interferences and data errors...</p>											<p class="post-edited">(Last edited by <strong>dabyd64</strong> on 9 Sep 2013, 01:24)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p211915">
				<div class="post-metadata">
					<div class="post-num">Post #67</div>
					<div class="post-author">zhadoom</div>
					<div class="post-datetime">
						9 Sep 2013, 01:34					</div>
				</div>
				<div class="post-content content">
					<p>Did you install kmod-nls-cp437 and kmod-nls-iso8859-1 ? If I remmember correctly ext4 need one of them to the standard codepage of the filesystem.</p>											<p class="post-edited">(Last edited by <strong>zhadoom</strong> on 9 Sep 2013, 01:36)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p211916">
				<div class="post-metadata">
					<div class="post-num">Post #68</div>
					<div class="post-author">MBS</div>
					<div class="post-datetime">
						9 Sep 2013, 01:39					</div>
				</div>
				<div class="post-content content">
					<p>is kmod-fs-ext4 already installed/built-in the kernel?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p211917">
				<div class="post-metadata">
					<div class="post-num">Post #69</div>
					<div class="post-author">n_dandanov</div>
					<div class="post-datetime">
						9 Sep 2013, 02:35					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>dabyd64, thank You for the kind words!<br />I shortened the data wires coming from the CPU with about 10 cm. I formatted a memory card (mini SD) with FAT32 using gparted. Then connected a card reader with this card (which should essentially be the same as using a pendrive) to the router. Below are the outputs of fdisk -l and the latest lines of dmesg:</p><div class="codebox"><pre><code>root@OpenWrt:~# fdisk -l

Disk /dev/mtdblock0: 0 MB, 131072 bytes
255 heads, 63 sectors/track, 0 cylinders
Units = cylinders of 16065 * 512 = 8225280 bytes

Disk /dev/mtdblock0 doesn&#039;t contain a valid partition table

Disk /dev/mtdblock1: 1 MB, 1004032 bytes
255 heads, 63 sectors/track, 0 cylinders
Units = cylinders of 16065 * 512 = 8225280 bytes

Disk /dev/mtdblock1 doesn&#039;t contain a valid partition table

Disk /dev/mtdblock2: 2 MB, 2993152 bytes
255 heads, 63 sectors/track, 0 cylinders
Units = cylinders of 16065 * 512 = 8225280 bytes

Disk /dev/mtdblock2 doesn&#039;t contain a valid partition table

Disk /dev/mtdblock3: 0 MB, 327680 bytes
255 heads, 63 sectors/track, 0 cylinders
Units = cylinders of 16065 * 512 = 8225280 bytes

Disk /dev/mtdblock3 doesn&#039;t contain a valid partition table

Disk /dev/mtdblock4: 0 MB, 65536 bytes
255 heads, 63 sectors/track, 0 cylinders
Units = cylinders of 16065 * 512 = 8225280 bytes

Disk /dev/mtdblock4 doesn&#039;t contain a valid partition table

Disk /dev/mtdblock5: 3 MB, 3997696 bytes
255 heads, 63 sectors/track, 0 cylinders
Units = cylinders of 16065 * 512 = 8225280 bytes

Disk /dev/mtdblock5 doesn&#039;t contain a valid partition table

Disk /dev/sda: 125 MB, 125960192 bytes
76 heads, 60 sectors/track, 53 cylinders
Units = cylinders of 4560 * 512 = 2334720 bytes

   Device Boot      Start         End      Blocks  Id System
/dev/sda1               1          54      121856   b Win95 FAT32
Partition 1 has different physical/logical beginnings (non-Linux?):
     phys=(0, 32, 33) logical=(0, 34, 9)
Partition 1 has different physical/logical endings:
     phys=(15, 75, 60) logical=(53, 67, 60)
root@OpenWrt:~# dmesg
[ 1740.950000] usb 1-1: new high-speed USB device number 3 using ehci-platform
[ 1741.360000] scsi1 : usb-storage 1-1:1.0
[ 1742.360000] scsi 1:0:0:0: Direct-Access     Generic- SD/MMC           1.00 PQ: 0 ANSI: 0 CCS
[ 1743.120000] sd 1:0:0:0: [sda] 246016 512-byte logical blocks: (125 MB/120 MiB)
[ 1743.120000] sd 1:0:0:0: [sda] Write Protect is off
[ 1743.130000] sd 1:0:0:0: [sda] Mode Sense: 03 00 00 00
[ 1743.140000] sd 1:0:0:0: [sda] No Caching mode page present
[ 1743.140000] sd 1:0:0:0: [sda] Assuming drive cache: write through
[ 1743.150000] sd 1:0:0:0: [sda] No Caching mode page present
[ 1743.160000] sd 1:0:0:0: [sda] Assuming drive cache: write through
[ 1743.160000]  sda: sda1
[ 1743.170000] sd 1:0:0:0: [sda] No Caching mode page present
[ 1743.180000] sd 1:0:0:0: [sda] Assuming drive cache: write through
[ 1743.180000] sd 1:0:0:0: [sda] Attached SCSI removable disk</code></pre></div><p>To me it seems the router can recognize the device, but won&#039;t mount it. This should mean that the connections from the CPU are working properly and the power supply is sufficient.<br />Could it be a software problem? I think both distributions I tried (pczolee&#039;s and then dabyd64&#039;s) are tested successfully. </p><p>zhadoom and MBS: yes, those packages are present in the distribution I&#039;m using:<br /></p><div class="codebox"><pre><code>kmod-fs-ext4 - 3.8.7-1
kmod-nls-cp437 - 3.8.7-1
kmod-nls-iso8859-1 - 3.8.7-1</code></pre></div><p>Thank You all for the support!</p><p>Nickolay</p>											<p class="post-edited">(Last edited by <strong>n_dandanov</strong> on 10 Sep 2013, 00:22)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p211919">
				<div class="post-metadata">
					<div class="post-num">Post #70</div>
					<div class="post-author">zhadoom</div>
					<div class="post-datetime">
						9 Sep 2013, 02:55					</div>
				</div>
				<div class="post-content content">
					<p>Try this way: ( assuming /dev/sda as the device is detected )<br />1- using fdisk delete any partitions in the usb storage device<br />2- using fdisk create a ext4 partition ( sda1 ) of full size of the device. Mark the partition as 83 ( ext ).<br />3- using mke2fs -j /dev/sda1 to create a filesystem<br />4- mount the partition.</p><p>The steps 1-3 can be made in other linux if you don&#039;t have fdisk / mke2fs in openwrt.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p211921">
				<div class="post-metadata">
					<div class="post-num">Post #71</div>
					<div class="post-author">n_dandanov</div>
					<div class="post-datetime">
						9 Sep 2013, 03:20					</div>
				</div>
				<div class="post-content content">
					<p>Hello, zhadoom,</p><p>Thanks for the advices! I went through these steps. Here&#039;s the result after plugging the device in the router&#039;s USB port:</p><div class="codebox"><pre><code>root@OpenWrt:~# logread -f
Apr 17 05:43:26 OpenWrt kern.info kernel: [ 4843.300000] usb 1-1: new high-speed USB device number 4 using ehci-platform
Apr 17 05:43:27 OpenWrt kern.info kernel: [ 4843.720000] scsi2 : usb-storage 1-1:1.0
Apr 17 05:43:28 OpenWrt kern.notice kernel: [ 4844.720000] scsi 2:0:0:0: Direct-Access     Generic- SD/MMC           1.00 PQ: 0 ANSI: 0 CCS
Apr 17 05:43:29 OpenWrt kern.notice kernel: [ 4845.480000] sd 2:0:0:0: [sda] 246016 512-byte logical blocks: (125 MB/120 MiB)
Apr 17 05:43:29 OpenWrt kern.notice kernel: [ 4845.480000] sd 2:0:0:0: [sda] Write Protect is off
Apr 17 05:43:29 OpenWrt kern.debug kernel: [ 4845.490000] sd 2:0:0:0: [sda] Mode Sense: 03 00 00 00
Apr 17 05:43:29 OpenWrt kern.err kernel: [ 4845.500000] sd 2:0:0:0: [sda] No Caching mode page present
Apr 17 05:43:29 OpenWrt kern.err kernel: [ 4845.500000] sd 2:0:0:0: [sda] Assuming drive cache: write through
Apr 17 05:43:29 OpenWrt kern.err kernel: [ 4845.510000] sd 2:0:0:0: [sda] No Caching mode page present
Apr 17 05:43:29 OpenWrt kern.err kernel: [ 4845.520000] sd 2:0:0:0: [sda] Assuming drive cache: write through
Apr 17 05:43:29 OpenWrt kern.info kernel: [ 4845.530000]  sda: sda1
Apr 17 05:43:29 OpenWrt kern.err kernel: [ 4845.530000] sd 2:0:0:0: [sda] No Caching mode page present
Apr 17 05:43:29 OpenWrt kern.err kernel: [ 4845.540000] sd 2:0:0:0: [sda] Assuming drive cache: write through
Apr 17 05:43:29 OpenWrt kern.notice kernel: [ 4845.540000] sd 2:0:0:0: [sda] Attached SCSI removable disk

root@OpenWrt:~# fdisk -l

Disk /dev/sda: 125 MB, 125960192 bytes
76 heads, 60 sectors/track, 53 cylinders
Units = cylinders of 4560 * 512 = 2334720 bytes

   Device Boot      Start         End      Blocks  Id System
/dev/sda1               1          53      120810  83 Linux

root@OpenWrt:/tmp/run# mount /dev/sda1 /tmp/run/mnt/
NTFS signature is missing.
Failed to mount &#039;/dev/sda1&#039;: Invalid argument
The device &#039;/dev/sda1&#039; doesn&#039;t seem to have a valid NTFS.
Maybe the wrong device is used? Or the whole disk instead of a
partition (e.g. /dev/sda, not /dev/sda1)? Or the other way around?
root@OpenWrt:/tmp/run# mount /dev/sda /tmp/run/mnt/
NTFS signature is missing.
Failed to mount &#039;/dev/sda&#039;: Invalid argument
The device &#039;/dev/sda&#039; doesn&#039;t seem to have a valid NTFS.
Maybe the wrong device is used? Or the whole disk instead of a
partition (e.g. /dev/sda, not /dev/sda1)? Or the other way around?
mount: mounting /dev/sda on /tmp/run/mnt/ failed: Device or resource busy</code></pre></div><p>So still not able to mount the system.</p><p>Edit:<br />After reading <a href="http://wiki.openwrt.org/doc/howto/usb.storage">this wiki post</a>, I mounted the drive successfully:<br /></p><div class="codebox"><pre><code>root@OpenWrt:/tmp/run# mkdir /mnt/share
root@OpenWrt:/tmp/run# mount -t ext4 /dev/sda1 /mnt/share/ -o rw,sync
root@OpenWrt:/tmp/run# ls /mnt/share/
lost+found</code></pre></div><p>This directory is left by the Debian OS I partitioned the drive under.<br />After unmounting and unplugging the storage and then plugging it again, it got mounted automatically.<br />However, when I rebooted the router and tried again, I found something interesting. I plugged in the USB device and it didn&#039;t mount automatically. I mounted it without specifying any options and got the already mentioned error message. Despite this, the drive got mounted successfully. Here are the trimmed outputs:</p><div class="codebox"><pre><code>root@OpenWrt:~# fdisk -l

Disk /dev/sda: 125 MB, 125960192 bytes
76 heads, 60 sectors/track, 53 cylinders
Units = cylinders of 4560 * 512 = 2334720 bytes

   Device Boot      Start         End      Blocks  Id System
/dev/sda1               1          53      120810  83 Linux

root@OpenWrt:~# mount /dev/sda1 /mnt/sda1/
NTFS signature is missing.
Failed to mount &#039;/dev/sda1&#039;: Invalid argument
The device &#039;/dev/sda1&#039; doesn&#039;t seem to have a valid NTFS.
Maybe the wrong device is used? Or the whole disk instead of a
partition (e.g. /dev/sda, not /dev/sda1)? Or the other way around?

root@OpenWrt:~# logread 

Apr 17 06:13:58 OpenWrt kern.info kernel: [  314.470000] usb 1-1: new high-speed USB device number 4 using ehci-platform
Apr 17 06:13:58 OpenWrt kern.info kernel: [  314.880000] scsi2 : usb-storage 1-1:1.0
Apr 17 06:13:59 OpenWrt kern.notice kernel: [  315.880000] scsi 2:0:0:0: Direct-Access     Generic- SD/MMC           1.00 PQ: 0 ANSI: 0 CCS
Apr 17 06:14:00 OpenWrt kern.notice kernel: [  316.640000] sd 2:0:0:0: [sda] 246016 512-byte logical blocks: (125 MB/120 MiB)
Apr 17 06:14:00 OpenWrt kern.notice kernel: [  316.640000] sd 2:0:0:0: [sda] Write Protect is off
Apr 17 06:14:00 OpenWrt kern.debug kernel: [  316.650000] sd 2:0:0:0: [sda] Mode Sense: 03 00 00 00
Apr 17 06:14:00 OpenWrt kern.err kernel: [  316.660000] sd 2:0:0:0: [sda] No Caching mode page present
Apr 17 06:14:00 OpenWrt kern.err kernel: [  316.660000] sd 2:0:0:0: [sda] Assuming drive cache: write through
Apr 17 06:14:00 OpenWrt kern.err kernel: [  316.670000] sd 2:0:0:0: [sda] No Caching mode page present
Apr 17 06:14:00 OpenWrt kern.err kernel: [  316.680000] sd 2:0:0:0: [sda] Assuming drive cache: write through
Apr 17 06:14:00 OpenWrt kern.info kernel: [  316.680000]  sda: sda1
Apr 17 06:14:00 OpenWrt kern.err kernel: [  316.700000] sd 2:0:0:0: [sda] No Caching mode page present
Apr 17 06:14:00 OpenWrt kern.err kernel: [  316.700000] sd 2:0:0:0: [sda] Assuming drive cache: write through
Apr 17 06:14:00 OpenWrt kern.notice kernel: [  316.710000] sd 2:0:0:0: [sda] Attached SCSI removable disk
Apr 17 06:14:32 OpenWrt kern.info kernel: [  348.400000] EXT4-fs (sda1): mounting ext3 file system using the ext4 subsystem
Apr 17 06:14:32 OpenWrt kern.info kernel: [  348.510000] EXT4-fs (sda1): mounted filesystem with ordered data mode. Opts: (null)

root@OpenWrt:~# ls /mnt/sda1/
config      lost+found  mwan3</code></pre></div><p>Those three folders are in fact present on the drive.<br />Later I tried with a drive formatted with FAT32:<br /></p><div class="codebox"><pre><code>Disk /dev/sda: 16.0 GB, 16022241280 bytes
82 heads, 18 sectors/track, 21201 cylinders
Units = cylinders of 1476 * 512 = 755712 bytes

   Device Boot      Start         End      Blocks  Id System
/dev/sda1   *           6       21202    15642688   c Win95 FAT32 (LBA)</code></pre></div><p>The error message appeared again, but the mount seemed to be successful. </p><br /><p>Thank You,<br />Nickolay</p>											<p class="post-edited">(Last edited by <strong>n_dandanov</strong> on 9 Sep 2013, 04:08)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p212228">
				<div class="post-metadata">
					<div class="post-num">Post #72</div>
					<div class="post-author">n_dandanov</div>
					<div class="post-datetime">
						13 Sep 2013, 02:46					</div>
				</div>
				<div class="post-content content">
					<p>Hello All,</p><p>Thank You for the support so far!<br />I wanted to implement mwan3 package, as I had it running before adding the USB functionality (<a href="https://forum.openwrt.org/viewtopic.php?id=39052">https://forum.openwrt.org/viewtopic.php?id=39052</a>). This package depends on a few others, one of which is iptables-mod-conntrack-extra.<br />Currently I&#039;m having pczolee&#039;s WR741ND v4.x image installed (<a href="http://www.sendspace.com/file/50u2d6">http://www.sendspace.com/file/50u2d6</a>). When trying to install the package in question with opkg, the following error is produced:<br /></p><div class="codebox"><pre><code>Collected errors:
 * satisfy_dependencies_for: Cannot satisfy the following dependencies for iptables-mod-conntrack-extra:
 *     kernel (= 3.3.8-1-d6597ebf6203328d3519ea3c3371a493) * 
 * opkg_install_cmd: Cannot install package iptables-mod-conntrack-extra.</code></pre></div><p>If I install via the --force-depends option, the router won&#039;t boot after a restart. The sys LED will flash, but there&#039;s no ping to the device even with static network settings on the PC. I managed to reset to factory defaults via the mentioned QSS switch procedure (<a href="http://wiki.openwrt.org/toh/tp-link/tl-wr740n">http://wiki.openwrt.org/toh/tp-link/tl-wr740n</a>), afterwards connecting with telnet and static IP assignments and then running the command:<br /></p><div class="codebox"><pre><code>mtd -r erase rootfs_data</code></pre></div><p>Is there any way to make this package working properly? The error about kernel version appeared when installing other packages, too, but I forced installation and no further problems appeared. I&#039;d like to stay with the stable release.<br />If there&#039;s no easy way, I guess I&#039;ll have to learn how to build a new image based on the final Attitude adjustment. I tried today but didn&#039;t do it well and have to read more about it. However, I think that&#039;s what pczolee has done.<br />Or perhaps making the trunk stable release work with USB would be great.</p><p>Best regards,<br />Nickolay</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p212231">
				<div class="post-metadata">
					<div class="post-num">Post #73</div>
					<div class="post-author">dabyd64</div>
					<div class="post-datetime">
						13 Sep 2013, 03:34					</div>
				</div>
				<div class="post-content content">
					<p>iptables is kernel dependant. You need to compile your own firmware!<br />Check that you have the package &quot;block-mount&quot;.<br />If you compile your own, remember to enter in the block-mount setting and lower the 30 seconds wait for the usb devices to be ready.<br />I&#039;ve tried myself and 7 seconds are more than enough.<br />Otherwise your router will wait 30 seconds each boot, which can be annoying in certain circunstances!</p><p>You have to edit you <strong>/etc/fstab</strong> to mount your usb drive automatically:<br /></p><div class="codebox"><pre><code>/dev/sda1       /USB    vfat    rw,async,umask=0,dmask=0,fmask=0        0       0</code></pre></div><p>I plugged an usb drive, all went fine, see my logs:<br /><strong>dmesg</strong><br /></p><div class="codebox"><pre><code>[16497.460000] usb 1-1: new high-speed USB device number 2 using ehci-platform
[16497.610000] scsi0 : usb-storage 1-1:1.0
[16498.610000] scsi 0:0:0:0: Direct-Access     JetFlash Transcend 32GB   1.00 PQ: 0 ANSI: 6
[16498.620000] sd 0:0:0:0: [sda] 61734912 512-byte logical blocks: (31.6 GB/29.4 GiB)
[16498.620000] sd 0:0:0:0: [sda] Write Protect is off
[16498.630000] sd 0:0:0:0: [sda] Mode Sense: 23 00 00 00
[16498.640000] sd 0:0:0:0: [sda] Write cache: disabled, read cache: disabled, doesn&#039;t support DPO or FUA
[16498.650000]  sda: sda1
[16498.660000] sd 0:0:0:0: [sda] Attached SCSI removable disk</code></pre></div><p><strong>mount</strong><br /></p><div class="codebox"><pre><code>root@pc:/# mount
rootfs on / type rootfs (rw)
/dev/root on /rom type squashfs (ro,relatime)
proc on /proc type proc (rw,noatime)
sysfs on /sys type sysfs (rw,noatime)
tmpfs on /tmp type tmpfs (rw,nosuid,nodev,noatime,size=30908k)
tmpfs on /dev type tmpfs (rw,noatime,size=512k,mode=755)
devpts on /dev/pts type devpts (rw,noatime,mode=600)
/dev/mtdblock3 on /overlay type jffs2 (rw,noatime)
overlayfs:/overlay on / type overlayfs (rw,relatime,lowerdir=/,upperdir=/overlay)
debugfs on /sys/kernel/debug type debugfs (rw,relatime)
none on /proc/bus/usb type usbfs (rw,relatime)
/dev/sda1 on /USB type vfat (rw,relatime,fmask=0000,dmask=0000,allow_utime=0022,codepage=cp437,iocharset=iso8859-1,shortname=mixed,errors=remount-ro)</code></pre></div><p><strong>fdisk -l</strong><br /></p><div class="codebox"><pre><code>root@pc:/# fdisk -l

...
...blah blah mtdblock devices
...

Disk /dev/sda: 31.6 GB, 31608274944 bytes
255 heads, 63 sectors/track, 3842 cylinders
Units = cylinders of 16065 * 512 = 8225280 bytes

   Device Boot      Start         End      Blocks  Id System
/dev/sda1               1        3843    30866432   c Win95 FAT32 (LBA)</code></pre></div>											<p class="post-edited">(Last edited by <strong>dabyd64</strong> on 20 Sep 2013, 00:58)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216517">
				<div class="post-metadata">
					<div class="post-num">Post #74</div>
					<div class="post-author">n_dandanov</div>
					<div class="post-datetime">
						2 Nov 2013, 12:29					</div>
				</div>
				<div class="post-content content">
					<p>Hello, <strong>dabyd64</strong>!<br />Thank You a lot for the advices and sorry for my late response!<br />So far the USB setup seems to be running nice.<br />However, I can&#039;t get such a good performance like You mentioned:<br /></p><div class="quotebox"><blockquote><p>With fat32 formatted USB flash drive, I got 24MB/s read and 14MB/s write</p></blockquote></div><p>May I ask under which conditions were these speeds possible? Converting to Mega bits per second this would mean 192Mbps read and 112Mbps write, which is very fast for a 100Mbps router.<br />The reason I&#039;m asking is because I&#039;d like to get both extroot and USB storage working on my router. However, I don&#039;t seem to have found a nicely working USB hub.<br />I also posted in these threads:<br /><a href="https://forum.openwrt.org/viewtopic.php?pid=216516#p216516">https://forum.openwrt.org/viewtopic.php … 16#p216516</a><br /><a href="https://forum.openwrt.org/viewtopic.php?id=47045">https://forum.openwrt.org/viewtopic.php?id=47045</a></p><p>Thank You in advance!</p><p>Best regards,<br />Nickolay</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216536">
				<div class="post-metadata">
					<div class="post-num">Post #75</div>
					<div class="post-author">dabyd64</div>
					<div class="post-datetime">
						2 Nov 2013, 14:35					</div>
				</div>
				<div class="post-content content">
					<p>Hi! Obviously that speed was between the router itself and the USB drive, tested with &quot;dd if=/dev/zero of=/mnt/sda1/test.bin bs=1M count=100&quot; , not through the LAN or Wireless.<br />It was slower when transferring through network, around 5MB/s over the wireless at 4 meters.<br />Also samba limits the speed pretty much due the cpu load.</p>											<p class="post-edited">(Last edited by <strong>dabyd64</strong> on 2 Nov 2013, 14:36)</p>
									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 3 of 9</div><nav><ul><li><a href="viewtopic.php%3Fid=37368&amp;p=1.html">1</a></li><li><a href="viewtopic.php%3Fid=37368&amp;p=2.html">2</a></li><li class="pagination-current"><span>3</span></li><li><a href="viewtopic.php%3Fid=37368&amp;p=4.html">4</a></li><li><a href="viewtopic.php%3Fid=37368&amp;p=5.html">5</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=37368&amp;p=9.html">9</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>