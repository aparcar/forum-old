<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> quota and bandwidth report</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 31 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p343603">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">nicolase</div>
					<div class="post-datetime">
						13 Nov 2016, 23:46					</div>
				</div>
				<div class="post-content content">
					<p>Hi all<br />I need quota limiting and bandwidth report feature for eatch user on my network<br />gargoyle is based on openwrt so i think i can have that on openwrt<br />please help me<br />and another question I have tp-link r470t load balancing<br />is this support openwrt? how?<br />please help me<br />Best Regards</p>											<p class="post-edited">(Last edited by <strong>nicolase</strong> on 13 Nov 2016, 23:46)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p343643">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">dl12345</div>
					<div class="post-datetime">
						14 Nov 2016, 11:41					</div>
				</div>
				<div class="post-content content">
					<p>There are numerous packages available for this. You could try <a href="https://wiki.openwrt.org/doc/howto/bandwidthd">bandwidthd (in the packages repository)</a>. You will need to have a non-volatile memory area available to store the data.</p><p>You have only one router, or multiple routers? If you have multiple routers (which I think is the case because you ask about load balancing), then your solution is more complex. For a large network, you&#039;re probably better off using netflow. I use netflow on my network: softflowd can do netflow v9 and export flows to a server on your network. In my case I use Silk to collect the netflow data and have a number of scripts that use the Silk tools to extract the data I need. Netflow data is very granular.</p><p>Quota limiting is a separate subject. There is no out-of the-box solution that I am aware of. Implementing this on a per-user level could be relatively easy if you have 5 users, or very complicated if you have 1,000 users. Simple versions of quota limiting are typically accomplished using iptables rules to track the bytes transferred and then block or pass the traffic.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p343652">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">nicolase</div>
					<div class="post-datetime">
						14 Nov 2016, 12:45					</div>
				</div>
				<div class="post-content content">
					<p>thanks alot for your reply<br />would you please give me some informations and how can i use iptables?<br />i&#039;m new in openwrt<br />please help<br />Best Regards</p><div class="quotebox"><cite>dl12345 wrote:</cite><blockquote><p>Quota limiting is a separate subject. There is no out-of the-box solution that I am aware of. Implementing this on a per-user level could be relatively easy if you have 5 users, or very complicated if you have 1,000 users. Simple versions of quota limiting are typically accomplished using iptables rules to track the bytes transferred and then block or pass the traffic.</p></blockquote></div>											<p class="post-edited">(Last edited by <strong>nicolase</strong> on 14 Nov 2016, 12:46)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p343655">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">dl12345</div>
					<div class="post-datetime">
						14 Nov 2016, 13:21					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>nicolase wrote:</cite><blockquote><p>thanks alot for your reply<br />would you please give me some informations and how can i use iptables?<br />i&#039;m new in openwrt<br />please help<br />Best Regards</p><div class="quotebox"><cite>dl12345 wrote:</cite><blockquote><p>Quota limiting is a separate subject. There is no out-of the-box solution that I am aware of. Implementing this on a per-user level could be relatively easy if you have 5 users, or very complicated if you have 1,000 users. Simple versions of quota limiting are typically accomplished using iptables rules to track the bytes transferred and then block or pass the traffic.</p></blockquote></div></blockquote></div><p>This is a very short question but a very long answer. OpenWrt uses iptables, which is standard Linux, so any Linux resource on iptables would be appropriate reading. There is a lot of material on the internet regarding using iptables to implement quotas. Suggest you Google and read. If you&#039;re new to iptables, you have a significant learning curve ahead of you because I would regard quotas as a fairly advanced iptables topic.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p344059">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">nicolase</div>
					<div class="post-datetime">
						18 Nov 2016, 03:59					</div>
				</div>
				<div class="post-content content">
					<p>Hi<br />thanks again for your reply<br />I tested bandwidth but I think it&#039;s not what I&#039;m looking!<br />I downloaded 1GB for testing but it shows 170MB! an I&#039;m looking for showing in hours!<br />I found ntop in openwrt wiki but don&#039;t know how can I config that and bandwidth uses more CPU<br />How can I install ntop?<br />if you thing I&#039;m rong or bandwidth or etc is better than ntop please help<br />My router is 1043nd v1.0<br />Best Regards!</p><div class="quotebox"><cite>dl12345 wrote:</cite><blockquote><p>There are numerous packages available for this. You could try <a href="https://wiki.openwrt.org/doc/howto/bandwidthd">bandwidthd (in the packages repository)</a>. You will need to have a non-volatile memory area available to store the data.<br />.</p></blockquote></div>											<p class="post-edited">(Last edited by <strong>nicolase</strong> on 18 Nov 2016, 04:00)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p344072">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">dl12345</div>
					<div class="post-datetime">
						18 Nov 2016, 10:34					</div>
				</div>
				<div class="post-content content">
					<p>Ntop is now a commercial package. Softflowd is better as the collector. I use Silk as the backend. </p><p>This is a complicated subject. Any installation guide would take many pages to write. There are already several guides on the internet</p><p>softflowd is available as a package in the OpenWrt repository. It does the same as the ntop probe, that is to say it is a netflow probe or netflow exporter. </p><p>A netflow probe exports netflow format data to a netflow collector/analyzer. You need to setup the collector on a separate computer.</p><p><a href="https://wiki.polaire.nl/doku.php?id=flowviewer_centos7">Here is documentation on how to setup Silk on Centos 7</a></p><p>Oh - if bandwidthd is showing you download only 170MB when you download 1GB, you&#039;re almost certainly looking at the flows in the wrong direction (ie, upload data and not download data)</p>											<p class="post-edited">(Last edited by <strong>dl12345</strong> on 18 Nov 2016, 11:21)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p344075">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">nbuser</div>
					<div class="post-datetime">
						18 Nov 2016, 12:32					</div>
				</div>
				<div class="post-content content">
					<p>I am using iptables to fetch upload/download data per IP address and saving data in a non-volatile area so that data doesn&#039;t reset on reboots which in turn doesn&#039;t need any extra packages to be installed on router and saves disk space</p>											<p class="post-edited">(Last edited by <strong>nbuser</strong> on 18 Nov 2016, 12:33)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p344109">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">tapper</div>
					<div class="post-datetime">
						18 Nov 2016, 20:27					</div>
				</div>
				<div class="post-content content">
					<p>Just use gargoyle it has all the things you are asking for. Stop trying to reinvent the wheel. <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p344177">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">nicolase</div>
					<div class="post-datetime">
						19 Nov 2016, 21:53					</div>
				</div>
				<div class="post-content content">
					<p>Hi<br />Thanks for your reply<br />I installed ntop on virtual machin for my university lessons (I&#039;m IT engineering student)<br />for example may I install ntop like virtual machin?<br />or it does not detect openwrt<br />I assked because openwrt is based on linux like ntop<br />please help me<br />Best Regards!<br /></p><div class="quotebox"><cite>dl12345 wrote:</cite><blockquote><p>Ntop is now a commercial package. Softflowd is better as the collector. I use Silk as the backend. </p><p>This is a complicated subject. Any installation guide would take many pages to write. There are already several guides on the internet</p><p>softflowd is available as a package in the OpenWrt repository. It does the same as the ntop probe, that is to say it is a netflow probe or netflow exporter. </p><p>A netflow probe exports netflow format data to a netflow collector/analyzer. You need to setup the collector on a separate computer.</p><p><a href="https://wiki.polaire.nl/doku.php?id=flowviewer_centos7">Here is documentation on how to setup Silk on Centos 7</a></p><p>Oh - if bandwidthd is showing you download only 170MB when you download 1GB, you&#039;re almost certainly looking at the flows in the wrong direction (ie, upload data and not download data)</p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p344178">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">nicolase</div>
					<div class="post-datetime">
						19 Nov 2016, 21:55					</div>
				</div>
				<div class="post-content content">
					<p>Hi<br />Thanks for your reply<br />would you please give me more information about iptables?<br />Best Regards!<br /></p><div class="quotebox"><cite>nbuser wrote:</cite><blockquote><p>I am using iptables to fetch upload/download data per IP address and saving data in a non-volatile area so that data doesn&#039;t reset on reboots which in turn doesn&#039;t need any extra packages to be installed on router and saves disk space</p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p344179">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">nicolase</div>
					<div class="post-datetime">
						19 Nov 2016, 21:56					</div>
				</div>
				<div class="post-content content">
					<p>Hi<br />Thanks for your reply<br />I tried gargoyle it was perfect<br />but I need 2 featurs that is not in gargoyle:<br />1- using 2 wans<br />2- download manager<br />please help me<br />Best Regards<br /></p><div class="quotebox"><cite>tapper wrote:</cite><blockquote><p>Just use gargoyle it has all the things you are asking for. Stop trying to reinvent the wheel. <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /></p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p344277">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">nbuser</div>
					<div class="post-datetime">
						21 Nov 2016, 07:29					</div>
				</div>
				<div class="post-content content">
					<p>I am using TPlink 3220 and we all are aware of space issue it has. Thus to avoid space crunch, I have created my own customized dashboard and it doesnt use any third party softwares to perform basic tasks. At backend its only using iptables. Thus necessity is mother of invention and sometimes we do need to reinvent the wheel...:)</p><p>PFA screenshot: <a href="https://drive.google.com/file/d/0B6mvTVnPwgaaM3FfNXotZGtZNm8/view?usp=sharing">https://drive.google.com/file/d/0B6mvTV … sp=sharing</a></p>											<p class="post-edited">(Last edited by <strong>nbuser</strong> on 21 Nov 2016, 07:32)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p344288">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">nicolase</div>
					<div class="post-datetime">
						21 Nov 2016, 10:46					</div>
				</div>
				<div class="post-content content">
					<p>Thanks alot for your reply<br />would you please give me some instruction about how you did it?<br />I&#039;m looking something loke this<br />please help<br />Best Regards<br /></p><div class="quotebox"><cite>nbuser wrote:</cite><blockquote><p>I am using TPlink 3220 and we all are aware of space issue it has. Thus to avoid space crunch, I have created my own customized dashboard and it doesnt use any third party softwares to perform basic tasks. At backend its only using iptables. Thus necessity is mother of invention and sometimes we do need to reinvent the wheel...:)</p><p>PFA screenshot: <a href="https://drive.google.com/file/d/0B6mvTVnPwgaaM3FfNXotZGtZNm8/view?usp=sharing">https://drive.google.com/file/d/0B6mvTV … sp=sharing</a></p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p344307">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">nbuser</div>
					<div class="post-datetime">
						21 Nov 2016, 14:24					</div>
				</div>
				<div class="post-content content">
					<p>Its a result of shell scripting and html. My dashboard scripts can perform below functions:</p><p>1. Monitor wifi connections and alert for any outsider mac address connections via email.<br />2. Monitor my WAN connection and auto login in webpage to activate internet. My ISP requires me to login in webpage at regular interval.<br />3. Control bandwidth and maintain quota usage even if router reboots, data isn&#039;t lost.<br />4. Blocks internet of my allowed guest logins at specified interval<br />5. Maintains per day bandwidth usage of each ip address<br />6. Reset iptables counters every 1st of month to get exact usage of each ip address.<br />7. Takes backup of log files daily on SD card and by the way my SD card isn&#039;t always ON. USB power is activated to take backup and turned off when backup is done.<br />8. Every thing is running in RAM and SD card is not in use.</p>											<p class="post-edited">(Last edited by <strong>nbuser</strong> on 21 Nov 2016, 14:27)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p344335">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">nicolase</div>
					<div class="post-datetime">
						21 Nov 2016, 18:36					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for your reply<br />I&#039;m sorry I&#039;m new in this matter<br />may I have your script for my usage please? or atleast would you guid me how can I create sth with that?<br />Thanks alot<br />Best Regards!<br /></p><div class="quotebox"><cite>nbuser wrote:</cite><blockquote><p>Its a result of shell scripting and html. My dashboard scripts can perform below functions:</p><p>1. Monitor wifi connections and alert for any outsider mac address connections via email.<br />2. Monitor my WAN connection and auto login in webpage to activate internet. My ISP requires me to login in webpage at regular interval.<br />3. Control bandwidth and maintain quota usage even if router reboots, data isn&#039;t lost.<br />4. Blocks internet of my allowed guest logins at specified interval<br />5. Maintains per day bandwidth usage of each ip address<br />6. Reset iptables counters every 1st of month to get exact usage of each ip address.<br />7. Takes backup of log files daily on SD card and by the way my SD card isn&#039;t always ON. USB power is activated to take backup and turned off when backup is done.<br />8. Every thing is running in RAM and SD card is not in use.</p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p344549">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">nicolase</div>
					<div class="post-datetime">
						23 Nov 2016, 08:53					</div>
				</div>
				<div class="post-content content">
					<p>Please Help<br /></p><div class="quotebox"><cite>nbuser wrote:</cite><blockquote><p>Its a result of shell scripting and html. My dashboard scripts can perform below functions:</p><p>1. Monitor wifi connections and alert for any outsider mac address connections via email.<br />2. Monitor my WAN connection and auto login in webpage to activate internet. My ISP requires me to login in webpage at regular interval.<br />3. Control bandwidth and maintain quota usage even if router reboots, data isn&#039;t lost.<br />4. Blocks internet of my allowed guest logins at specified interval<br />5. Maintains per day bandwidth usage of each ip address<br />6. Reset iptables counters every 1st of month to get exact usage of each ip address.<br />7. Takes backup of log files daily on SD card and by the way my SD card isn&#039;t always ON. USB power is activated to take backup and turned off when backup is done.<br />8. Every thing is running in RAM and SD card is not in use.</p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p344575">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">nbuser</div>
					<div class="post-datetime">
						23 Nov 2016, 12:40					</div>
				</div>
				<div class="post-content content">
					<p>what is your router model? I have created these scripts as per my model tplink mr3220.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p344611">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">nicolase</div>
					<div class="post-datetime">
						23 Nov 2016, 17:46					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for your reply<br />My router is:<br />tplink wr1043nd<br />Best Regards!<br /></p><div class="quotebox"><cite>nbuser wrote:</cite><blockquote><p>what is your router model? I have created these scripts as per my model tplink mr3220.</p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p344613">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">nbuser</div>
					<div class="post-datetime">
						23 Nov 2016, 17:53					</div>
				</div>
				<div class="post-content content">
					<p>what do you mean by &quot;how can I create sth with that?&quot;</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p344657">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">nicolase</div>
					<div class="post-datetime">
						24 Nov 2016, 11:21					</div>
				</div>
				<div class="post-content content">
					<p>I mean how can create report page like your screenshot with IPtables<br />I&#039;m new in IPtables<br />may I have your source code?<br />does it work on wr1043nd?<br />Best Regards<br /></p><div class="quotebox"><cite>nbuser wrote:</cite><blockquote><p>what do you mean by &quot;how can I create sth with that?&quot;</p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p344860">
				<div class="post-metadata">
					<div class="post-num">Post #21</div>
					<div class="post-author">nicolase</div>
					<div class="post-datetime">
						26 Nov 2016, 13:25					</div>
				</div>
				<div class="post-content content">
					<p>please help<br /></p><div class="quotebox"><cite>nicolase wrote:</cite><blockquote><p>I mean how can create report page like your screenshot with IPtables<br />I&#039;m new in IPtables<br />may I have your source code?<br />does it work on wr1043nd?<br />Best Regards<br /></p><div class="quotebox"><cite>nbuser wrote:</cite><blockquote><p>what do you mean by &quot;how can I create sth with that?&quot;</p></blockquote></div></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p344924">
				<div class="post-metadata">
					<div class="post-num">Post #22</div>
					<div class="post-author">Kitin</div>
					<div class="post-datetime">
						26 Nov 2016, 21:24					</div>
				</div>
				<div class="post-content content">
					<p>What I did to monitor ~10 users on my OpenWrt</p><p>Installed pivot overlay with a USB stick, as my router&#039;s storage is too small to install the packages and store the bandwidth data. wiki.openwrt.org/doc/howto/extroot</p><p>Installed luci-app-statistics with collectd-mod-iptables.&nbsp; wiki.openwrt.org/doc/howto/luci_app_statistics</p><p>Setup a custom iptables settings;</p><div class="codebox"><pre><code>iptables -N TRAFFIC_ACCT_IN
iptables -N TRAFFIC_ACCT_OUT

iptables -I FORWARD -i pppoe-wan -j TRAFFIC_ACCT_IN
iptables -I FORWARD -o pppoe-wan -j TRAFFIC_ACCT_OUT

iptables -A TRAFFIC_ACCT_IN --dst 192.168.1.150 -m comment --comment &quot;user1-in&quot;
iptables -A TRAFFIC_ACCT_OUT --src 192.168.1.150 -m comment --comment &quot;user1-out&quot;</code></pre></div><p>Setup Static Leases for clients; MAC 00:11:22:33:44:FF -&gt; 192.168.1.150</p><p>Setup collectd-mod-iptables rule; name: user1-in options: user1-in</p><p>Point luci-app-statistics database to a folder in USB</p><p>That should be it, also check this out, I&#039;ve learnt from there; catonmat.net/blog/traffic-accounting-with-iptables</p><p>edit: add-usb</p>											<p class="post-edited">(Last edited by <strong>Kitin</strong> on 26 Nov 2016, 21:25)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>