<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Running Attitude Adjustment 12.09 on D-Link DIR-825 revision C1</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 4 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p208350">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">micmac</div>
					<div class="post-datetime">
						28 Jul 2013, 12:51					</div>
				</div>
				<div class="post-content content">
					<p>Hello everybody,</p><p>I bought a DIR-825 revision C1 recently and wanted to have OpenWrt running on it. Without a little effort there was only the possibility of using a Barrier Breaker trunk snapshot. But I rather have it running on a stable OpenWrt.</p><p>So I cherry-picked the source code of the Barrier Breaker trunk and put the code into Attitude Adjustment 12.09 (SVN revision 36088). I&#039;d like to know if I&#039;m using the right approach considering that my goal is to have a version of Attitude Adjustment 12.09 that is as close as possible to the official release.</p><p>Here&#039;s what I did, step by step:</p><p>- Fetch the OpenWrt Attitude Adjustment 12.09 source code<br /></p><div class="codebox"><pre><code>svn co -r36088 svn://svn.openwrt.org/openwrt/tags/attitude_adjustment_12.09</code></pre></div><p>- Apply the patch (see next entry)</p><p>- Create a copy of the file feeds.conf.default named feeds.conf</p><p>- Edit feeds.conf and add &quot;@36088&quot; at the end of the line that checks out the package feed<br /></p><div class="codebox"><pre><code>src-svn packages svn://svn.openwrt.org/openwrt/packages@36088</code></pre></div><p>- Comment all the other lines in feeds.conf</p><p>- Fetch the package feed<br /></p><div class="codebox"><pre><code>./scripts/feeds update -a</code></pre></div><p>- Install the package feed<br /></p><div class="codebox"><pre><code>./scripts/feeds install -a</code></pre></div><p>- Apply the default configuration<br /></p><div class="codebox"><pre><code>make defconfig</code></pre></div><p>- Check that all requirements for the build are met<br /></p><div class="codebox"><pre><code>make prereq</code></pre></div><p>- Configure OpenWrt for the build<br /></p><div class="codebox"><pre><code>make menuconfig</code></pre></div><p>- In the configuration dialog go to &quot;Image Configuration&quot;, &quot;Version configuration options&quot;</p><p>- Change version from 12.09-rc1 to 12.09</p><p>- Change package repository URL to point to the 12.09 repository instead of the repository for 12.09-rc1</p><p>- Go back and select the DIR-825 C1 as the target</p><p>- I also deselected IPv6 support as I have no use for it currently</p><p>- Run &quot;defconfig&quot; again, because it is suggested in the OpenWrt wiki<br /></p><div class="codebox"><pre><code>make defconfig</code></pre></div><p>- Build the image<br /></p><div class="codebox"><pre><code>make</code></pre></div><p>Afterward the dir-825-c1 squashfs factory image is ready for installation. The image works fine on my router. The only thing that is not working - as far as I can tell - are the LAN switch LEDs. But they don&#039;t work in the Barrier Breaker trunk snapshots either.</p><p>Is this all it takes or did I overlook anything?</p><p>Kind regards,<br />S.</p>											<p class="post-edited">(Last edited by <strong>micmac</strong> on 28 Jul 2013, 12:55)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p208353">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">micmac</div>
					<div class="post-datetime">
						28 Jul 2013, 13:00					</div>
				</div>
				<div class="post-content content">
					<p>Here is the patch I used:<br /></p><div class="codebox"><pre><code>cat dir-825-c1-attitude-adjustment-12.09.patch</code></pre></div><div class="codebox"><pre><code>diff -Nur aa/target/linux/ar71xx/base-files/etc/diag.sh aa-patched/target/linux/ar71xx/base-files/etc/diag.sh
--- aa/target/linux/ar71xx/base-files/etc/diag.sh       2013-07-25 20:03:15.619960593 +0200
+++ aa-patched/target/linux/ar71xx/base-files/etc/diag.sh       2013-07-27 15:18:53.116668652 +0200
@@ -67,7 +67,8 @@
        dir-615-c1)
                status_led=&quot;d-link:green:status&quot;
                ;;
-       dir-825-b1)
+       dir-825-b1|\
+       dir-825-c1)
                status_led=&quot;d-link:orange:power&quot;
                ;;
        eap7660d)
diff -Nur aa/target/linux/ar71xx/base-files/etc/uci-defaults/leds aa-patched/target/linux/ar71xx/base-files/etc/uci-defaults/leds
--- aa/target/linux/ar71xx/base-files/etc/uci-defaults/leds     2013-07-25 20:03:15.616627260 +0200
+++ aa-patched/target/linux/ar71xx/base-files/etc/uci-defaults/leds     2013-07-27 15:18:53.120001802 +0200
@@ -60,7 +60,8 @@
        ucidef_set_led_switch &quot;lan4&quot; &quot;LAN4&quot; &quot;d-link:green:lan4&quot; &quot;switch0&quot; &quot;0x10&quot;
        ;;
 
-dir-825-b1)
+dir-825-b1|\
+dir-825-c1)
        ucidef_set_led_usbdev &quot;usb&quot; &quot;USB&quot; &quot;d-link:blue:usb&quot; &quot;1-1&quot;
        ;;
 
diff -Nur aa/target/linux/ar71xx/base-files/etc/uci-defaults/network aa-patched/target/linux/ar71xx/base-files/etc/uci-defaults/network
--- aa/target/linux/ar71xx/base-files/etc/uci-defaults/network  2013-07-25 20:03:15.616627260 +0200
+++ aa-patched/target/linux/ar71xx/base-files/etc/uci-defaults/network  2013-07-27 15:18:53.120001802 +0200
@@ -146,6 +146,13 @@
        ucidef_add_switch_vlan &quot;switch0&quot; &quot;1&quot; &quot;0 1 2 3 5t&quot;
        ;;
 
+dir-825-c1)
+       ucidef_set_interfaces_lan_wan &quot;eth0.1&quot; &quot;eth0.2&quot;
+       ucidef_add_switch &quot;eth0&quot; &quot;1&quot; &quot;1&quot;
+       ucidef_add_switch_vlan &quot;eth0&quot; &quot;1&quot; &quot;0t 1 2 3 4&quot;
+       ucidef_add_switch_vlan &quot;eth0&quot; &quot;2&quot; &quot;0t 5&quot;
+       ;;
+
 all0305 |\
 aw-nr580 |\
 bullet-m |\
diff -Nur aa/target/linux/ar71xx/base-files/lib/ar71xx.sh aa-patched/target/linux/ar71xx/base-files/lib/ar71xx.sh
--- aa/target/linux/ar71xx/base-files/lib/ar71xx.sh     2013-07-25 20:03:15.609960594 +0200
+++ aa-patched/target/linux/ar71xx/base-files/lib/ar71xx.sh     2013-07-27 15:18:53.120001802 +0200
@@ -204,6 +204,9 @@
        *&quot;DIR-825 rev. B1&quot;)
                name=&quot;dir-825-b1&quot;
                ;;
+       *&quot;DIR-825 rev. C1&quot;)
+               name=&quot;dir-825-c1&quot;
+               ;;
        *EAP7660D)
                name=&quot;eap7660d&quot;
                ;;
diff -Nur aa/target/linux/ar71xx/base-files/lib/upgrade/platform.sh aa-patched/target/linux/ar71xx/base-files/lib/upgrade/platform.sh
--- aa/target/linux/ar71xx/base-files/lib/upgrade/platform.sh   2013-07-25 20:03:15.606627260 +0200
+++ aa-patched/target/linux/ar71xx/base-files/lib/upgrade/platform.sh   2013-07-27 15:18:53.120001802 +0200
@@ -105,6 +105,7 @@
        dir-600-a1 | \
        dir-615-c1 | \
        dir-615-e4 | \
+       dir-825-c1 | \
        ew-dorin | \
        ew-dorin-router | \
        mzk-w04nu | \
diff -Nur aa/target/linux/ar71xx/config-3.3 aa-patched/target/linux/ar71xx/config-3.3
--- aa/target/linux/ar71xx/config-3.3   2013-07-25 20:03:15.576627261 +0200
+++ aa-patched/target/linux/ar71xx/config-3.3   2013-07-27 15:18:53.123334916 +0200
@@ -35,6 +35,7 @@
 CONFIG_ATH79_MACH_DIR_600_A1=y
 CONFIG_ATH79_MACH_DIR_615_C1=y
 CONFIG_ATH79_MACH_DIR_825_B1=y
+CONFIG_ATH79_MACH_DIR_825_C1=y
 CONFIG_ATH79_MACH_EAP7660D=y
 CONFIG_ATH79_MACH_EW_DORIN=y
 CONFIG_ATH79_MACH_HORNET_UB=y
diff -Nur aa/target/linux/ar71xx/files/arch/mips/ath79/mach-dir-825-c1.c aa-patched/target/linux/ar71xx/files/arch/mips/ath79/mach-dir-825-c1.c
--- aa/target/linux/ar71xx/files/arch/mips/ath79/mach-dir-825-c1.c      1970-01-01 01:00:00.000000000 +0100
+++ aa-patched/target/linux/ar71xx/files/arch/mips/ath79/mach-dir-825-c1.c      2013-07-27 15:18:53.123334916 +0200
@@ -0,0 +1,206 @@
+/*
+ *  D-Link DIR-825 rev. C1 board support
+ *
+ *  Copyright (C) 2013 Alexander Stadler
+ *
+ *  This program is free software; you can redistribute it and/or modify it
+ *  under the terms of the GNU General Public License version 2 as published
+ *  by the Free Software Foundation.
+ */
+
+#include &lt;linux/pci.h&gt;
+#include &lt;linux/phy.h&gt;
+#include &lt;linux/gpio.h&gt;
+#include &lt;linux/platform_device.h&gt;
+#include &lt;linux/ath9k_platform.h&gt;
+#include &lt;linux/ar8216_platform.h&gt;
+
+#include &lt;asm/mach-ath79/ar71xx_regs.h&gt;
+
+#include &quot;common.h&quot;
+#include &quot;dev-ap9x-pci.h&quot;
+#include &quot;dev-eth.h&quot;
+#include &quot;dev-gpio-buttons.h&quot;
+#include &quot;dev-leds-gpio.h&quot;
+#include &quot;dev-m25p80.h&quot;
+#include &quot;dev-spi.h&quot;
+#include &quot;dev-usb.h&quot;
+#include &quot;dev-wmac.h&quot;
+#include &quot;machtypes.h&quot;
+
+#define DIR825C1_GPIO_LED_BLUE_USB             11
+#define DIR825C1_GPIO_LED_ORANGE_POWER         14
+#define DIR825C1_GPIO_LED_BLUE_POWER           22
+#define DIR825C1_GPIO_LED_BLUE_WPS             15
+#define DIR825C1_GPIO_LED_ORANGE_PLANET                19
+#define DIR825C1_GPIO_LED_BLUE_PLANET          18
+
+#define DIR825C1_GPIO_BTN_RESET                        17
+#define DIR825C1_GPIO_BTN_WPS                  16
+
+#define DIR825C1_KEYS_POLL_INTERVAL            20      /* msecs */
+#define DIR825C1_KEYS_DEBOUNCE_INTERVAL                (3 * DIR825C1_KEYS_POLL_INTERVAL)
+
+#define DIR825C1_MAC0_OFFSET                   0x4
+#define DIR825C1_MAC1_OFFSET                   0x18
+#define DIR825C1_WMAC_CALDATA_OFFSET           0x1000
+#define DIR825C1_PCIE_CALDATA_OFFSET           0x5000
+
+static struct gpio_led dir825c1_leds_gpio[] __initdata = {
+       {
+               .name           = &quot;d-link:blue:usb&quot;,
+               .gpio           = DIR825C1_GPIO_LED_BLUE_USB,
+               .active_low     = 1,
+       },
+       {
+               .name           = &quot;d-link:orange:power&quot;,
+               .gpio           = DIR825C1_GPIO_LED_ORANGE_POWER,
+               .active_low     = 1,
+       },
+       {
+               .name           = &quot;d-link:blue:power&quot;,
+               .gpio           = DIR825C1_GPIO_LED_BLUE_POWER,
+               .active_low     = 1,
+       },
+       {
+               .name           = &quot;d-link:blue:wps&quot;,
+               .gpio           = DIR825C1_GPIO_LED_BLUE_WPS,
+               .active_low     = 1,
+       },
+       {
+               .name           = &quot;d-link:orange:planet&quot;,
+               .gpio           = DIR825C1_GPIO_LED_ORANGE_PLANET,
+               .active_low     = 1,
+       },
+       {
+               .name           = &quot;d-link:blue:planet&quot;,
+               .gpio           = DIR825C1_GPIO_LED_BLUE_PLANET,
+               .active_low     = 1,
+       },
+};
+
+static struct gpio_keys_button dir825c1_gpio_keys[] __initdata = {
+       {
+               .desc           = &quot;reset&quot;,
+               .type           = EV_KEY,
+               .code           = KEY_RESTART,
+               .debounce_interval = DIR825C1_KEYS_DEBOUNCE_INTERVAL,
+               .gpio           = DIR825C1_GPIO_BTN_RESET,
+               .active_low     = 1,
+       },
+       {
+               .desc           = &quot;wps&quot;,
+               .type           = EV_KEY,
+               .code           = KEY_WPS_BUTTON,
+               .debounce_interval = DIR825C1_KEYS_DEBOUNCE_INTERVAL,
+               .gpio           = DIR825C1_GPIO_BTN_WPS,
+               .active_low     = 1,
+       },
+};
+
+static struct ar8327_pad_cfg dir825c1_ar8327_pad0_cfg = {
+       .mode = AR8327_PAD_MAC_RGMII,
+       .txclk_delay_en = true,
+       .rxclk_delay_en = true,
+       .txclk_delay_sel = AR8327_CLK_DELAY_SEL1,
+       .rxclk_delay_sel = AR8327_CLK_DELAY_SEL2,
+};
+
+static struct ar8327_led_cfg dir825c1_ar8327_led_cfg = {
+       .led_ctrl0 = 0xc737c737,
+       .led_ctrl1 = 0x00000000,
+       .led_ctrl2 = 0x00000000,
+       .led_ctrl3 = 0x0030c300,
+       .open_drain = false,
+};
+
+static struct ar8327_platform_data dir825c1_ar8327_data = {
+       .pad0_cfg = &amp;dir825c1_ar8327_pad0_cfg,
+       .cpuport_cfg = {
+               .force_link = 1,
+               .speed = AR8327_PORT_SPEED_1000,
+               .duplex = 1,
+               .txpause = 1,
+               .rxpause = 1,
+       },
+       .led_cfg = &amp;dir825c1_ar8327_led_cfg,
+};
+
+static struct mdio_board_info dir825c1_mdio0_info[] = {
+       {
+               .bus_id = &quot;ag71xx-mdio.0&quot;,
+               .phy_addr = 0,
+               .platform_data = &amp;dir825c1_ar8327_data,
+       },
+};
+
+static void dir825c1_read_ascii_mac(u8 *dest, u8 *src)
+{
+       int ret;
+
+       ret = sscanf(src, &quot;%02hhx:%02hhx:%02hhx:%02hhx:%02hhx:%02hhx&quot;,
+                    &amp;dest[0], &amp;dest[1], &amp;dest[2],
+                    &amp;dest[3], &amp;dest[4], &amp;dest[5]);
+
+       if (ret != ETH_ALEN)
+               memset(dest, 0, ETH_ALEN);
+}
+
+static void __init dir825c1_generic_setup(void)
+{
+       u8 *mac = (u8 *) KSEG1ADDR(0x1ffe0000);
+       u8 *art = (u8 *) KSEG1ADDR(0x1fff0000);
+       u8 mac0[ETH_ALEN], mac1[ETH_ALEN];
+       u8 wmac0[ETH_ALEN], wmac1[ETH_ALEN];
+
+       dir825c1_read_ascii_mac(mac0, mac + DIR825C1_MAC0_OFFSET);
+       dir825c1_read_ascii_mac(mac1, mac + DIR825C1_MAC1_OFFSET);
+
+       ath79_register_m25p80(NULL);
+
+       ath79_register_gpio_keys_polled(-1, DIR825C1_KEYS_POLL_INTERVAL,
+                                       ARRAY_SIZE(dir825c1_gpio_keys),
+                                       dir825c1_gpio_keys);
+
+       ath79_init_mac(wmac0, mac0, 0);
+       ath79_register_wmac(art + DIR825C1_WMAC_CALDATA_OFFSET, wmac0);
+
+       ath79_init_mac(wmac1, mac1, 1);
+       ap91_pci_init(art + DIR825C1_PCIE_CALDATA_OFFSET, wmac1);
+
+       ath79_setup_ar934x_eth_cfg(AR934X_ETH_CFG_RGMII_GMAC0);
+
+       mdiobus_register_board_info(dir825c1_mdio0_info,
+                                   ARRAY_SIZE(dir825c1_mdio0_info));
+
+       ath79_register_mdio(0, 0x0);
+
+       ath79_init_mac(ath79_eth0_data.mac_addr, mac0, 0);
+
+       /* GMAC0 is connected to an AR8327N switch */
+       ath79_eth0_data.phy_if_mode = PHY_INTERFACE_MODE_RGMII;
+       ath79_eth0_data.phy_mask = BIT(0);
+       ath79_eth0_data.mii_bus_dev = &amp;ath79_mdio0_device.dev;
+       ath79_eth0_pll_data.pll_1000 = 0x06000000;
+       ath79_register_eth(0);
+
+       ath79_register_usb();
+}
+
+static void __init dir825c1_setup(void)
+{
+       ath79_gpio_output_select(DIR825C1_GPIO_LED_BLUE_USB,
+                                AR934X_GPIO_OUT_GPIO);
+
+       ath79_register_leds_gpio(-1, ARRAY_SIZE(dir825c1_leds_gpio),
+                                dir825c1_leds_gpio);
+
+       ap9x_pci_setup_wmac_led_pin(0, 13);
+       ap9x_pci_setup_wmac_led_pin(1, 32);
+
+       dir825c1_generic_setup();
+}
+
+MIPS_MACHINE(ATH79_MACH_DIR_825_C1, &quot;DIR-825-C1&quot;,
+            &quot;D-Link DIR-825 rev. C1&quot;,
+            dir825c1_setup);
diff -Nur aa/target/linux/ar71xx/generic/profiles/d-link.mk aa-patched/target/linux/ar71xx/generic/profiles/d-link.mk
--- aa/target/linux/ar71xx/generic/profiles/d-link.mk   2013-07-25 20:03:15.643293926 +0200
+++ aa-patched/target/linux/ar71xx/generic/profiles/d-link.mk   2013-07-27 15:18:53.123334916 +0200
@@ -61,3 +61,15 @@
 endef
 
 $(eval $(call Profile,DIR825B1))
+
+
+define Profile/DIR825C1
+       NAME:=D-Link DIR-825 rev. C1
+       PACKAGES:=kmod-usb-core kmod-usb2 kmod-ledtrig-usbdev
+endef
+
+define Profile/DIR825C1/Description
+       Package set optimized for the D-Link DIR-825 rev. C1.
+endef
+
+$(eval $(call Profile,DIR825C1))
diff -Nur aa/target/linux/ar71xx/image/Makefile aa-patched/target/linux/ar71xx/image/Makefile
--- aa/target/linux/ar71xx/image/Makefile       2013-07-25 20:03:15.936627249 +0200
+++ aa-patched/target/linux/ar71xx/image/Makefile       2013-07-27 15:18:53.123334916 +0200
@@ -169,6 +169,7 @@
 cameo7240_mtdlayout=mtdparts=spi0.0:192k(u-boot)ro,64k(nvram)ro,960k(kernel),2752k(rootfs),64k(mac)ro,64k(art)ro,3712k@0x40000(firmware)
 cameo913x_mtdlayout=mtdparts=spi0.0:128k(u-boot)ro,64k(config)ro,960k(kernel),2880k(rootfs),64k(art)ro,3840k@0x30000(firmware)
 cameo933x_mtdlayout=mtdparts=spi0.0:64k(u-boot)ro,64k(art)ro,64k(mac)ro,64k(nvram)ro,192k(language)ro,896k(kernel),2752k(rootfs),3648k@0x70000(firmware)
+cameo934x_mtdlayout=mtdparts=spi0.0:64k(uboot)ro,64k(nvram)ro,1280k(kernel),14656k(rootfs),192k(lang)ro,64k(mac)ro,64k(art)ro,15936k@0x20000(firmware)
 cap4200ag_mtdlayout=mtdparts=spi0.0:256k(u-boot),64k(u-boot-env),320k(custom)ro,1536k(kernel),12096k(rootfs),2048k(failsafe),64k(art),13632k@0xa0000(firmware)
 db120_mtdlayout=mtdparts=spi0.0:256k(u-boot)ro,64k(u-boot-env)ro,6336k(rootfs),1408k(kernel),64k(nvram),64k(art)ro,7744k@0x50000(firmware)
 dir825b1_mtdlayout=mtdparts=spi0.0:256k(uboot)ro,64k(config)ro,1024k(kernel),5184k(rootfs),64k(caldata)ro,1600k(unknown)ro,6208k@0x50000(firmware),64k@0x7f0000(caldata_copy)
@@ -353,6 +354,14 @@
        $(call MkuImageLzma/initramfs,$(2),$(3) $(cameo933x_mtdlayout))
 endef
 
+define Image/Build/Cameo934x
+       $(call Image/Build/Cameo,$(1),$(2),$(3),$(cameo934x_mtdlayout),1310720,15007718,$(4))
+endef
+
+define Image/Build/Cameo934x/initramfs
+       $(call Image/Build/Cameo,$(1),$(2),$(3),$(cameo934x_mtdlayout))
+endef
+
 define Image/Build/Ath
        $(call Sysupgrade/$(7),$(1),$(2),$(5),$(6))
        if [ -e &quot;$(call sysupname,$(1),$(2))&quot; ]; then \
@@ -815,6 +824,8 @@
 
 $(eval $(call SingleProfile,Cameo933x,$(fs_squash),TEW712BR,tew-712br,TEW-712BR,ttyATH0,115200,&quot;HORNET-RT-TEW712BR-3&quot;))
 
+$(eval $(call SingleProfile,Cameo934x,$(fs_64k),DIR825C1,dir-825-c1,DIR-825-C1,ttyS0,115200,&quot;00DB120AR9344-RT-101214-00&quot;))
+
 $(eval $(call SingleProfile,CyberTAN,$(fs_64k),WRT160NL,wrt160nl,WRT160NL,ttyS0,115200,1.00.01))
 
 $(eval $(call SingleProfile,DIR825B1,$(fs_64k),DIR825B1,dir-825-b1,DIR-825-B1,ttyS0,115200,01AP94-AR7161-RT-080619-00,00AP94-AR7161-RT-080619-00))
diff -Nur aa/target/linux/ar71xx/patches-3.3/610-MIPS-ath79-openwrt-machines.patch aa-patched/target/linux/ar71xx/patches-3.3/610-MIPS-ath79-openwrt-machines.patch
--- aa/target/linux/ar71xx/patches-3.3/610-MIPS-ath79-openwrt-machines.patch    2013-07-25 20:03:15.586627261 +0200
+++ aa-patched/target/linux/ar71xx/patches-3.3/610-MIPS-ath79-openwrt-machines.patch    2013-07-27 15:18:17.026667335 +0200
@@ -1,6 +1,6 @@
 --- a/arch/mips/ath79/machtypes.h
 +++ b/arch/mips/ath79/machtypes.h
-@@ -16,18 +16,102 @@
+@@ -16,18 +16,103 @@
  
  enum ath79_mach_type {
        ATH79_MACH_GENERIC = 0,
@@ -23,6 +23,7 @@
 +      ATH79_MACH_DIR_615_C1,          /* D-Link DIR-615 rev. C1 */
 +      ATH79_MACH_DIR_615_E4,          /* D-Link DIR-615 rev. E4 */
 +      ATH79_MACH_DIR_825_B1,          /* D-Link DIR-825 rev. B1 */
++      ATH79_MACH_DIR_825_C1,          /* D-Link DIR-825 rev. C1 */
 +      ATH79_MACH_EW_DORIN,            /* embedded wireless Dorin Platform */
 +      ATH79_MACH_EW_DORIN_ROUTER,     /* embedded wireless Dorin Router Platform */
 +      ATH79_MACH_EAP7660D,            /* Senao EAP7660D */
@@ -206,7 +207,7 @@
  config ATH79_MACH_PB44
        bool &quot;Atheros PB44 reference board&quot;
        select SOC_AR71XX
-@@ -67,6 +147,456 @@ config ATH79_MACH_PB44
+@@ -67,6 +147,467 @@ config ATH79_MACH_PB44
          Say &#039;Y&#039; here if you want your kernel to support the
          Atheros PB44 reference board.
  
@@ -333,6 +334,17 @@
 +      select ATH79_DEV_M25P80
 +      select ATH79_DEV_USB
 +
++config ATH79_MACH_DIR_825_C1
++      bool &quot;D-Link DIR-825 rev. C1/DIR-835 rev. A1 board support&quot;
++      select SOC_AR934X
++      select ATH79_DEV_AP9X_PCI if PCI
++      select ATH79_DEV_ETH
++      select ATH79_DEV_GPIO_BUTTONS
++      select ATH79_DEV_LEDS_GPIO
++      select ATH79_DEV_M25P80
++      select ATH79_DEV_USB
++      select ATH79_DEV_WMAC
++
 +config ATH79_MACH_EW_DORIN
 +      bool &quot;embedded wireless Dorin Platform support&quot;
 +      select SOC_AR933X
@@ -663,7 +675,7 @@
  config ATH79_MACH_UBNT_XM
        bool &quot;Ubiquiti Networks XM (rev 1.0) board&quot;
        select SOC_AR724X
-@@ -80,6 +610,24 @@ config ATH79_MACH_UBNT_XM
+@@ -80,6 +621,24 @@ config ATH79_MACH_UBNT_XM
          Say &#039;Y&#039; here if you want your kernel to support the
          Ubiquiti Networks XM (rev 1.0) board.
  
@@ -688,7 +700,7 @@
  endmenu
  
  config SOC_AR71XX
-@@ -115,10 +663,6 @@ config SOC_QCA955X
+@@ -115,10 +674,6 @@ config SOC_QCA955X
        select PCI_AR724X if PCI
        def_bool n
  
@@ -699,7 +711,7 @@
  config ATH79_DEV_AP9X_PCI
        select ATH79_PCI_ATH9K_FIXUP
        def_bool n
-@@ -129,7 +673,14 @@ config ATH79_DEV_DSA
+@@ -129,7 +684,14 @@ config ATH79_DEV_DSA
  config ATH79_DEV_ETH
        def_bool n
  
@@ -715,7 +727,7 @@
        def_bool n
  
  config ATH79_DEV_GPIO_BUTTONS
-@@ -161,4 +712,7 @@ config ATH79_PCI_ATH9K_FIXUP
+@@ -161,4 +723,7 @@ config ATH79_PCI_ATH9K_FIXUP
  config ATH79_ROUTERBOOT
        def_bool n
  
@@ -725,7 +737,7 @@
  endif
 --- a/arch/mips/ath79/Makefile
 +++ b/arch/mips/ath79/Makefile
-@@ -38,9 +38,68 @@ obj-$(CONFIG_ATH79_ROUTERBOOT)              += route
+@@ -38,9 +38,69 @@ obj-$(CONFIG_ATH79_ROUTERBOOT)              += route
  #
  # Machines
  #
@@ -744,6 +756,7 @@
 +obj-$(CONFIG_ATH79_MACH_DIR_600_A1)   += mach-dir-600-a1.o
 +obj-$(CONFIG_ATH79_MACH_DIR_615_C1)   += mach-dir-615-c1.o
 +obj-$(CONFIG_ATH79_MACH_DIR_825_B1)   += mach-dir-825-b1.o
++obj-$(CONFIG_ATH79_MACH_DIR_825_C1)   += mach-dir-825-c1.o
 +obj-$(CONFIG_ATH79_MACH_EW_DORIN)     += mach-ew-dorin.o
 +obj-$(CONFIG_ATH79_MACH_EAP7660D)     += mach-eap7660d.o
 +obj-$(CONFIG_ATH79_MACH_JA76PF)               += mach-ja76pf.o</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p208882">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">macMeck</div>
					<div class="post-datetime">
						3 Aug 2013, 17:11					</div>
				</div>
				<div class="post-content content">
					<p>Hi there,</p><p>I&#039;m about to try exactly the same thing... but still kind of newbie in building OpenWRT. Could you please let me know how to apply the patch you provided? I&#039;m stuck...</p><p>Thanks<br />macmeck</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p208914">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">macMeck</div>
					<div class="post-datetime">
						4 Aug 2013, 02:25					</div>
				</div>
				<div class="post-content content">
					<p>It&#039;s me again, after trying some things, I can either compile without applying your patch (and then of course using revision B1 instead of C1) or apply your patch (manually in parts since it does not fully work against the revision given) and then make crushes at a certain point when it tries to apply patch &quot;platform/610-MIPS-ath79-openwrt-machines.patch.orig&quot; since the files have changed... so, could you please be more specific on how you did that?</p><p>Thanks<br />macmeck</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p208932">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">micmac</div>
					<div class="post-datetime">
						4 Aug 2013, 12:13					</div>
				</div>
				<div class="post-content content">
					<p>Hello macmeck,</p><p>the forum doesn&#039;t preserve the tabs in the patch <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> I&#039;ve pasted the patch on-line: <a href="http://paste.debian.net/22618/">http://paste.debian.net/22618/</a></p><p>At the bottom of the page is a &quot;Download&quot; button for you. Save the file. Then enter the attitude_adjustment_12.09 directory and apply it:</p><div class="codebox"><pre><code>cat ~/paste_22618 | patch -p1 --dry-run</code></pre></div><p>If the patch applies cleanly then you can remove the &quot;--dry-run&quot; and *really* apply it <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> If it doesn&#039;t apply cleanly then your attitude_adjustment_12.09 directory is dirty. You should delete it and download it again from SVN before applying the patch.</p>											<p class="post-edited">(Last edited by <strong>micmac</strong> on 4 Aug 2013, 12:18)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p208947">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">macMeck</div>
					<div class="post-datetime">
						4 Aug 2013, 16:12					</div>
				</div>
				<div class="post-content content">
					<p>Great stuff, thanks for the hint! It works <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /></p><p>I&#039;ve successfully build the images, now I have to wait for the router which is still on ebay ;-) I&#039;ll keep you posted if it all works out as soon as I have uploaded the image.</p><p>Thanks again<br />macmeck</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p210102">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">macMeck</div>
					<div class="post-datetime">
						18 Aug 2013, 22:15					</div>
				</div>
				<div class="post-content content">
					<p>Hey there,</p><p>the new router is here and... tadaaaa... is working! I followed your steps and it&#039;s almost perfect. I only struggle with the LEDs. It&#039;s about the same as you mentioned with the LAN LEDs (swconfig doesn&#039;t have the set LED command), but also the other ones triggered by netdev seem to behave strange. Don&#039;t know yet if it is a trigger or an config issue... but that&#039;s a minor thing.</p><p>Nevertheless, great work! I think you should add this info to the wiki and let others enjoy this! How about?</p><p>Cheers<br />macMeck</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p211521">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">jamesopenwrt</div>
					<div class="post-datetime">
						3 Sep 2013, 15:37					</div>
				</div>
				<div class="post-content content">
					<p>Thanks guys for your help thus far. I have another problem with the DIR-825 C1. None of the MAC addresses of the interfaces match what is printed on the sticker underneath the router. E.g. the sticker says: 11:22:33:44:55:<strong>66</strong> but the ethernet and WLAN0 interfaces are a digit before (11:22:33:44:55:<strong>65</strong>) and the WLAN1 interface is a digit after (11:22:33:44:55:<strong>67</strong>)</p><p>I need a way to get the actual MAC of WLAN1 to match what is on the router&#039;s sticker (as we have automated scripts that grab the MAC of the router and match is server side with what the customer has typed in (which would be the MAC printed on the label).</p><p>All other routers are fine, so probably something needs patching in the trunk/target/linux/ar71xx/files/arch/mips/ath79/mach-dir-825-c1.c file? I just don&#039;t know enough to modify it myself.</p><p>Any idea?</p><p>Thanks</p><p>James</p>											<p class="post-edited">(Last edited by <strong>jamesopenwrt</strong> on 3 Sep 2013, 15:38)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p211523">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">macMeck</div>
					<div class="post-datetime">
						3 Sep 2013, 15:56					</div>
				</div>
				<div class="post-content content">
					<p>Hi James,</p><p>with MAC address of the wlan interface you mean the BSSID? You can configure that for each wlan interface in /etc/config/wireless<br />No need to patch the source code, just configure it <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /></p><p>Cheers<br />macmeck</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p211525">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">jamesopenwrt</div>
					<div class="post-datetime">
						3 Sep 2013, 16:19					</div>
				</div>
				<div class="post-content content">
					<p>Hi MacMeck</p><p>Thanks for the reply. Let me explain a bit further so it becomes clearer.</p><p>We develop custom firmwares for OpenWRT devices and they have automated scripts that run on them to enable cloud-based configuration. When they boot, they cat the /sys/class/ieee80211/phy1/macaddress (for example) which gives us the MAC. We then send this to our remote server and download configuration based on the MAC. This MAC must match the one inputted by the customer, and they will type in the MAC from the label on the bottom.</p><p>So, we just need to get the MAC to match what is on the label instead of 1 digit up or down. It doesn&#039;t matter what interface we get the MAC from as long as its the right one.</p><p>On 2.4GHz devices, the phy0 MAC always matches the MAC on the label, and on 5GHz devices the phy1 MAC always matches. But it&#039;s just this D-Link model that doesn&#039;t have the correct MAC on any interface (confirmed by an ifconfig output)</p><p>Does that make sense?</p><p>Cheers</p>											<p class="post-edited">(Last edited by <strong>jamesopenwrt</strong> on 3 Sep 2013, 16:20)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p211527">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">macMeck</div>
					<div class="post-datetime">
						3 Sep 2013, 16:44					</div>
				</div>
				<div class="post-content content">
					<p>Hi James,</p><p>yes, to my understanding it makes sense. You usually set the BSSID of the wifi to the MAC address of the interface. You do that using &quot;option macaddr&quot; in /etc/config/wireless. I assume that /sys/class/ieee80211/phy1/macaddress gives you exactly what you configured here, not the real MAC address of the device read from the hardware.</p><p>You can verify that by changing the &quot;option macaddr&quot; for one of your wifi devices in /etc/config/wireless and cat /sys/class/ieee80211/phy1/macaddress again. Anything changed?</p><p>Since the DIR-825 has two wifi interfaces you have to decide to which you would like to assign the MAC address written on your device as BSSID. I guess you shouldn&#039;t assign it to both, BSSIDs should be unique as far as i know.</p><p>Cheers<br />macmeck</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p211528">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">jamesopenwrt</div>
					<div class="post-datetime">
						3 Sep 2013, 16:48					</div>
				</div>
				<div class="post-content content">
					<p>Hi again,</p><p>I&#039;m not interested in setting the MAC (or caring what its set to)), I just need to get the correct MAC that is shown on the printed label from any of the interfaces. But none of the interfaces match the MAC of the label so I have a problem.</p><p>So to confirm, I just need to get the MAC not set it... I don&#039;t care about the BSSID MAC etc - any interface that has the actual same MAC that shows on the label I can use.</p><p>Cheers</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p212101">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">micmac</div>
					<div class="post-datetime">
						11 Sep 2013, 17:41					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>jamesopenwrt wrote:</cite><blockquote><p>Hi again,</p><p>I&#039;m not interested in setting the MAC (or caring what its set to)), I just need to get the correct MAC that is shown on the printed label from any of the interfaces. But none of the interfaces match the MAC of the label so I have a problem.</p><p>So to confirm, I just need to get the MAC not set it... I don&#039;t care about the BSSID MAC etc - any interface that has the actual same MAC that shows on the label I can use.</p><p>Cheers</p></blockquote></div><p>Hello James,</p><p>What&#039;s the behavior of the stock D-Link firmware in this regard?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p212952">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">micmac</div>
					<div class="post-datetime">
						22 Sep 2013, 13:18					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>Here&#039;s an updated version of the patch. All changes are backports from upstream (barrier breaker trunk).</p><p>- add wireless bgn led support for dir-825-c1<br />- set proper wan mac (the mac from the sticker) during initial configuration on dir-825-c1<br />- fix LAN LEDs for dir-825-c1<br />- let HW switch control WAN LED on dir-825-c1<br />- vanity changes for dir-825-c1 (color and gpio names, button descriptions)<br />- enable wlan2g led in the default configuration of dir-825-c1</p><p>The updated patch can be found here:</p><p><a href="http://paste.debian.net/44702/">patch on &quot;debian Pastezone&quot;</a></p><p>This time around the patch needs to be applied with &quot;-p0&quot; instead of &quot;-p1&quot;:<br /></p><div class="codebox"><pre><code>patch -p0 --dry-run &lt;path/to/patch&gt;</code></pre></div><p>The patch will expire from the pastebin in about a week. If you want to download it afterward just shout and I&#039;ll upload it again.</p><p>Checksums:</p><p>MD5: 91fd2c48f2e74993833b9d15312d294e<br />SHA256: b10b5ded881be6bdba5e9a3ce1cb400558191c3098686ce25da9346c02929b15</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p212993">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">macMeck</div>
					<div class="post-datetime">
						23 Sep 2013, 10:03					</div>
				</div>
				<div class="post-content content">
					<p>@micmac: fantastic! do we also have a patch for attitude adjustment? I really liked the idead to set up on the stable version...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p212994">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">micmac</div>
					<div class="post-datetime">
						23 Sep 2013, 10:06					</div>
				</div>
				<div class="post-content content">
					<p>Hello macMeck,</p><p>This _is_ the patch for Attitude Adjustment <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p212995">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">macMeck</div>
					<div class="post-datetime">
						23 Sep 2013, 10:53					</div>
				</div>
				<div class="post-content content">
					<p>cool... messed up your comment... just read barrier breaker... too early in the morning ;-)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p213041">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">macMeck</div>
					<div class="post-datetime">
						24 Sep 2013, 01:15					</div>
				</div>
				<div class="post-content content">
					<p>micmac, I gave it a first try, applied the patch, compiled and sysupgrade brought it smoothly the router. But somehow not all (or none?) of the changes seem to be there. For example the LAN LEDS are not working and the LED names in Luci are still the old ones... But I see the patch has been applied to the code, files like mach-dir-825-c1.o do have timestamps from today and the router does run the newly compiled kernel. Is there any way I can check if the changes did make their way to the router???<br />What I did is to remove the old patch, applied the new patch, make menuconfig and make. This should work, right? Or do I have to explicitly clean up my directories and rebuild everything from scratch?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p213106">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">micmac</div>
					<div class="post-datetime">
						24 Sep 2013, 20:57					</div>
				</div>
				<div class="post-content content">
					<p>Hello macMeck,</p><p>You&#039;ll have to run<br /></p><div class="codebox"><pre><code>make clean</code></pre></div><p>before compiling again. Because otherwise the &quot;make&quot; system will re-use the files that are already in the &lt;build_dir&gt;. I suggest to use the factory image instead of the sysupgrade image. I&#039;d even tell Luci to overwrite the old configuration, because the default configuration regarding MAC address of WAN interface and LEDs will get updated this way.</p>											<p class="post-edited">(Last edited by <strong>micmac</strong> on 24 Sep 2013, 21:01)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p213877">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">macMeck</div>
					<div class="post-datetime">
						4 Oct 2013, 09:46					</div>
				</div>
				<div class="post-content content">
					<p>cool stuff, after a make clean, everything you described is there. Still missing some parts (5GHz LED,...) but they&#039;re also not in the trunk code yet, I know.</p><p>@jamesopenwrt: with a new image, you can now fetch the MAC address printed on the label using </p><div class="codebox"><pre><code>cat /sys/class/net/eth0.2/address</code></pre></div><p>. That&#039;s just what you needed, right?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p213917">
				<div class="post-metadata">
					<div class="post-num">Post #21</div>
					<div class="post-author">micmac</div>
					<div class="post-datetime">
						4 Oct 2013, 18:56					</div>
				</div>
				<div class="post-content content">
					<p>Hi macMeck,</p><p>A fix for the 5 GHz LED was suggested to the mailing list. Once it gets accepted and applied to trunk I will post another patch here.</p><p>You said &quot;Still missing some parts (5GHz LED, ...)&quot;, could you elaborate what else except the 5 GHz LED support you&#039;re currently missing?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p214396">
				<div class="post-metadata">
					<div class="post-num">Post #22</div>
					<div class="post-author">boom3240</div>
					<div class="post-datetime">
						9 Oct 2013, 17:50					</div>
				</div>
				<div class="post-content content">
					<p>Hello micmac,</p><p>I would be most interested by your patch. Could you publish it again as the link is now dead.</p><p>Thank you ver much</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p214427">
				<div class="post-metadata">
					<div class="post-num">Post #23</div>
					<div class="post-author">micmac</div>
					<div class="post-datetime">
						9 Oct 2013, 23:26					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p><a href="http://paste.debian.net/54545/">Link</a>. Checksums are still the same as above.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p214967">
				<div class="post-metadata">
					<div class="post-num">Post #24</div>
					<div class="post-author">macMeck</div>
					<div class="post-datetime">
						16 Oct 2013, 21:24					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>micmac wrote:</cite><blockquote><p>Hi macMeck,</p><p>A fix for the 5 GHz LED was suggested to the mailing list. Once it gets accepted and applied to trunk I will post another patch here.</p><p>You said &quot;Still missing some parts (5GHz LED, ...)&quot;, could you elaborate what else except the 5 GHz LED support you&#039;re currently missing?</p></blockquote></div><p>Hi micmac, <br />you are right. It was my other router that was still missing some features. 5GHz LED and we should be good...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p215233">
				<div class="post-metadata">
					<div class="post-num">Post #25</div>
					<div class="post-author">micmac</div>
					<div class="post-datetime">
						20 Oct 2013, 19:45					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>New version, adds 5 GHz LED fix.</p><p><a href="http://paste.debian.net/59884/">Link</a></p><p>MD5: 6cc620186413679f9e31d159c266b14d<br />SHA256: 9a8311453267b11694ca1344bf9599a3e5c6511a36342895b633f354ba9f05db</p><p>Now I&#039;m waiting for AA 12.09.1 :-)</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>