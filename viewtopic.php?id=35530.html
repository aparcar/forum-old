<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Need advice on how to Route all router traffic through VPN</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 4 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p161029">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">kiteplans</div>
					<div class="post-datetime">
						16 Mar 2012, 06:02					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>We use an OpenVPN connection every day in our office. This needs to always be turned on when working on specific projects and things, but as you might know its &quot;really&quot; hard for some people to remember to switch on the VPN!</p><p>My plan is then to setup a router for the normal internet use, and a second router for all the office use. People in the office will then only be able to connect to the office router. This router will always be connected to the VPN and all traffic will go through the VPN. Thus people will not need to turn on the VPN on their computers but simply connect to the router via Wifi.</p><p>Would it be possible to set this up??</p><p>What would I need to set this up?</p><p>I have done some research and found that I have two routers that could run openwrt:<br />1. TP-LINK WR740N <br />2. TP-LINK WR841N<br />I do however believe that they only have 4MB flash memory and that it might not be enough to run openwrt and openvpn?</p><p>If you believe my idea is possible, what router would you suggest I get to do this on?</p><p>And then the last question -<br />I would also be able to setup a linux server to act as a DHCP with two routers and then run OpenVPN on that if that would work?</p><p>Thanks and I am simply asking for suggestions.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p161102">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">mole</div>
					<div class="post-datetime">
						16 Mar 2012, 19:26					</div>
				</div>
				<div class="post-content content">
					<p>well, what is the problem about that? it is easy:</p><br /><div class="quotebox"><blockquote><p>Client ----- Router1 (OVPN Client Config)&nbsp; &lt;== VPN over Internet ==&gt; Router2 (OVPN Server Config) ------ Server<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />VPN Client somwhere at the world ---------------------------------------------- ^</p></blockquote></div><p>u need two networks on each side. like 10.1.1.0/24 on client side and 10.1.2.0/24 on server side.</p><p>u just need to tell the Router1 about the net from router2 and backwards, of course.</p><p>Openvpn is quite stable with that. I am using it with several customers. but u need to keep care for firewalling, bridging and routing.</p><p>regards</p>											<p class="post-edited">(Last edited by <strong>mole</strong> on 16 Mar 2012, 19:27)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p161247">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">kiteplans</div>
					<div class="post-datetime">
						18 Mar 2012, 10:06					</div>
				</div>
				<div class="post-content content">
					<p>What would I need to set this up?</p><p>I have done some research and found that I have two routers that could run openwrt:<br />1. TP-LINK WR740N <br />2. TP-LINK WR841N<br />I do however believe that they only have 4MB flash memory and that it might not be enough to run openwrt and openvpn?</p><p>What router would you suggest I get to do this on?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p161259">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">mole</div>
					<div class="post-datetime">
						18 Mar 2012, 13:04					</div>
				</div>
				<div class="post-content content">
					<p>Well, 4MB should be okay. I don&#039;t think that openvpm is the Problem. I think the depended openssl is much more bigger. But i think i used 4mb flash devices for that already. normaly i used buffalo for that or wrt54g.</p><p>But i dont know about that particular tp-link devices. I try to avoid that company. It made us to much stress in quality recently.</p>											<p class="post-edited">(Last edited by <strong>mole</strong> on 18 Mar 2012, 13:04)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p161280">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">lizby</div>
					<div class="post-datetime">
						18 Mar 2012, 17:47					</div>
				</div>
				<div class="post-content content">
					<p>I used dd-wrt on an Asus WL520gU (which has 4mb flash) to set up vpn (PPTP) in a manner similar to what you describe.&nbsp; The 520gU is wired to my gateway router; devices connected to the 520gU via wire or wireless are automatically connected to the VPN.</p><p>dd-wrt has recently produced firmware for the TP-WR703N.&nbsp; I&#039;ve flashed it successfully, but haven&#039;t tried the VPN setup.</p><p>Many have succeeded, but I have struggled with VPN under openWrt.</p><p>Note that the WR703N has only a single ethernet port, so if that is connected to your gateway, you have no way to connect any other wired device.</p>											<p class="post-edited">(Last edited by <strong>lizby</strong> on 18 Mar 2012, 17:51)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p161293">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">mole</div>
					<div class="post-datetime">
						18 Mar 2012, 21:14					</div>
				</div>
				<div class="post-content content">
					<p>Well, PPTP uses MPPE encryption. That is quite weak and had already been broken. I don&#039;t know whether the mppe module is included in dd-wrt. If not PPTP would be even unencrypted. That is a huge security issue, nowadays.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p161336">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">kiteplans</div>
					<div class="post-datetime">
						19 Mar 2012, 10:44					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for all the replies - yes I would only run OpenVPN due to the security risk of PPTP - but due to the 4MB Flash of my routers it looks like I will not be able to install openvpn and the needed OpenSSL.</p><p>If this is at all possible please let me know - if not what router would you suggest I get - </p><p>I can get the WRT54GS 64M RAM 8MB Flash for really cheap here.<br />Or should I look for something newer?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p161338">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">kiteplans</div>
					<div class="post-datetime">
						19 Mar 2012, 10:53					</div>
				</div>
				<div class="post-content content">
					<p>The - BUFFALO WHR-G300N V2 - is also really cheap here!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p161339">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">mole</div>
					<div class="post-datetime">
						19 Mar 2012, 10:54					</div>
				</div>
				<div class="post-content content">
					<p>As i told, I am runing a Buffalo Router just as VPN Gateway. I am sure the Buffalo just has 4MB Flash.</p><div class="quotebox"><blockquote><p>Filesystem&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1k-blocks&nbsp; &nbsp; &nbsp; Used Available Use% Mounted on<br />rootfs&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2048&nbsp; &nbsp; &nbsp; 2048&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 100% /<br />/dev/root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2048&nbsp; &nbsp; &nbsp; 2048&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 100% /rom<br />tmpfs&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 7176&nbsp; &nbsp; &nbsp; &nbsp; 52&nbsp; &nbsp; &nbsp; 7124&nbsp; &nbsp;1% /tmp<br />/dev/mtdblock/4&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1280&nbsp; &nbsp; &nbsp; &nbsp;932&nbsp; &nbsp; &nbsp; &nbsp;348&nbsp; 73% /jffs<br />mini_fo:/jffs&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2048&nbsp; &nbsp; &nbsp; 2048&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 100% /</p></blockquote></div><p>Well, OpenVPN is running there, even in bridge mod. So it is no problem to install OpenVPN at 4MB device.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p161341">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">kiteplans</div>
					<div class="post-datetime">
						19 Mar 2012, 11:05					</div>
				</div>
				<div class="post-content content">
					<p>mole - could you point me to some instructions as to how I could install openwrt and openvpn on my device? I have already gotten dd-wrt installed on my WR740N - but I believe that takes alot of space</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p161342">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">mole</div>
					<div class="post-datetime">
						19 Mar 2012, 11:14					</div>
				</div>
				<div class="post-content content">
					<p>Well, i don&#039;t us dd-wrt. That Buffalo which i mentioned has still a KAMIKAZE (8.09, r14549) with x-wrt runing. </p><div class="quotebox"><blockquote><p>Firmware&nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; OpenWrt Kamikaze - With X-Wrt Extensions 8.09<br />Kernel&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; Linux 2.4.35.4 #12 Wed Feb 18 12:17:45 CST 2009<br />MAC&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;XX:XX:XX:XX:XX:XX<br />Device&nbsp; &nbsp;&nbsp; &nbsp; &nbsp; Buffalo WHR-HP-G54<br />Board&nbsp; &nbsp;&nbsp; &nbsp; &nbsp; Broadcom BCM5352 chip rev 0<br />Username&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; root</p><p>Web mgt. console&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; Webif²<br />Version&nbsp; &nbsp; &nbsp; &nbsp; r4710</p></blockquote></div><p>As matter of the fact that this was the latest version when i installed it.</p><p>here is the output of &quot;opkg list-installed&quot;</p><br /><div class="quotebox"><blockquote><p>base-files-brcm-2.4 - 14-r14549 -<br />bridge - 1.0.6-1 -<br />busybox - 1.11.2-2 -<br />chillispot - 1.1.0-1 -<br />dnsmasq - 2.46-1 -<br />dropbear - 0.51-2 -<br />etherwake - 1.09-1 -<br />firewall - 1-1 -<br />haserl - 0.9.24-1 -<br />iptables - 1.3.8-4 -<br />iptables-mod-conntrack - 1.3.8-4 -<br />iptables-mod-nat - 1.3.8-4 -<br />kernel - 2.4.35.4-brcm-2.4-1 -<br />kmod-brcm-wl - 2.4.35.4+4.150.10.5.3-brcm-2.4-2 -<br />kmod-diag - 2.4.35.4-brcm-2.4-4 -<br />kmod-ipt-conntrack - 2.4.35.4-brcm-2.4-1 -<br />kmod-ipt-core - 2.4.35.4-brcm-2.4-1 -<br />kmod-ipt-nat - 2.4.35.4-brcm-2.4-1 -<br />kmod-ipt-nathelper - 2.4.35.4-brcm-2.4-1 -<br />kmod-ppp - 2.4.35.4-brcm-2.4-1 -<br />kmod-pppoe - 2.4.35.4-brcm-2.4-1 -<br />kmod-switch - 2.4.35.4-brcm-2.4-1 -<br />kmod-tun - 2.4.35.4-brcm-2.4-1 -<br />kmod-wlcompat - 2.4.35.4+4.150.10.5.3-brcm-2.4-2 -<br />libgcc - 3.4.6-14 -<br />liblzo - 2.03-1 -<br />libopenssl - 0.9.8i-3 -<br />libpcap - 0.9.8-1 -<br />libuci - 0.7.3-1 -<br />mtd - 8 -<br />nas - 4.150.10.5.3-2 -<br />ntpclient - 2007_365-1 -<br />nvram - 1 -<br />openvpn - 2.0.9-6 -<br />opkg - 4564-3 -<br />ppp - 2.4.3-10 -<br />ppp-mod-pppoe - 2.4.3-10 -<br />tcpdump - 3.9.8-1 -<br />uci - 0.7.3-1 -<br />uclibc - 0.9.29-14 -<br />webif - 0.3-4709 -<br />webif-hotspot - 0.1-1 -<br />webif-vpn - 0.1-1 -<br />wireless-tools - 29-2 -<br />wlc - 4.150.10.5.3-2 -<br />wol - 0.7.1-2 -<br />zlib - 1.2.3-5 -</p></blockquote></div><p>I am not sure. But i don&#039;t think i compiled the image by myself at this time. Thought, I downloaded it from x-wrt.org</p><p>But I think it shouldn&#039;t be any problem to set it also up with the current backfire version.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p161354">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">mole</div>
					<div class="post-datetime">
						19 Mar 2012, 12:29					</div>
				</div>
				<div class="post-content content">
					<p>here i find the binarys of backfire from the trunk:</p><p>Rev. 1 <a href="http://downloads.openwrt.org/snapshots/trunk/ar71xx/openwrt-ar71xx-generic-tl-wr740n-v1-jffs2-factory.bin">http://downloads.openwrt.org/snapshots/ … actory.bin</a><br />Rev. 3 <a href="http://downloads.openwrt.org/snapshots/trunk/ar71xx/openwrt-ar71xx-generic-tl-wr740n-v3-jffs2-factory.bin">http://downloads.openwrt.org/snapshots/ … actory.bin</a></p><p>I always download the packages of the snapshot considering to this trunk:</p><p><a href="http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/">http://downloads.openwrt.org/snapshots/ … /packages/</a></p><p>coz at the next trunk build the kernel mods want run anymore coz it might be another kernel.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p161362">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">kiteplans</div>
					<div class="post-datetime">
						19 Mar 2012, 13:30					</div>
				</div>
				<div class="post-content content">
					<p>Mole - thanks so much - I found the V3 snapshot already - now I just need to find out a way to revert from dd-wrt to openwrt! Thanks again!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p161374">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">mole</div>
					<div class="post-datetime">
						19 Mar 2012, 15:52					</div>
				</div>
				<div class="post-content content">
					<p>Guess TFTP should help u to flash that device. But i am not sure. As i told, i never worked with tplink routers.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p164974">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">kelxon</div>
					<div class="post-datetime">
						18 Apr 2012, 22:06					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;d recommend Buffalo WZR-HP-G300NH.&nbsp; Why?&nbsp; Because I have two of them and I bricked them multiple times but always been able to unbrick them.&nbsp; At Newegg.com, currently selling for $67.</p><p>Instruction:&nbsp; Very good instruction!<br /><a href="https://forum.openwrt.org/viewtopic.php?id=35021">https://forum.openwrt.org/viewtopic.php?id=35021</a></p><p>But change or add the following on the server config file:</p><p>&nbsp; &nbsp; &nbsp; &nbsp; option &#039;server&#039; &#039;xxx.xxx.xxx.xxx 255.255.255.0&#039;&nbsp; #this should be on a completely different subnet than your LAN<br />&nbsp; &nbsp; &nbsp; &nbsp; list &#039;push&#039; &#039;route xxx.xxx.xxx.xxx 255.255.255.0&#039; #this should MATCH your current LAN info<br />&nbsp; &nbsp; &nbsp; &nbsp; list &#039;push&#039; &#039;dhcp-option DNS xxx.xxx.xxx.xxx&#039; #this should MATCH your current LAN info<br />&nbsp; &nbsp; list &#039;push&#039; &#039;dhcp-option DOMAIN yourdomainname.com&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; list &#039;push&#039; &#039;redirect-gateway&#039;</p><p>*just in case your client router cannot connect to the server router, try adding float to the client config file, this allows it to connect to any ip on your router (WAN).</p><p>Hope this helps.</p>											<p class="post-edited">(Last edited by <strong>kelxon</strong> on 18 Apr 2012, 22:16)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>