<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Failsafe mode from redboot...</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 28 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p44011">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">intrax</div>
					<div class="post-datetime">
						9 Mar 2007, 12:46					</div>
				</div>
				<div class="post-content content">
					<p>My fonera is rebooting continiously after a wrong entry in /etc/sysctl.conf. I have tried to get it into failsafe mode by pressing the reset button, but it is not succeeding...</p><p>Is it possible to boot into failsafe mode from redboot using a kernel boot parameter or is the exec command line overwritten as I read somewhere... if that is the case will I need to reflash ?</p><p>I have no serial connection atm and running atheros 2.6 snapshot kamikaze.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p44037">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">intrax</div>
					<div class="post-datetime">
						9 Mar 2007, 18:31					</div>
				</div>
				<div class="post-content content">
					<p>I would really like to know how to get my fonera into failsafe mode. Does it work on Kamikaze ? Reset button or otherwise ?</p><p>Anyone care to reply ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p44126">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">intrax</div>
					<div class="post-datetime">
						11 Mar 2007, 04:05					</div>
				</div>
				<div class="post-content content">
					<p>Is there a failsafe kernel I could flash ? I have access to redboot and really only need to change sysctl.conf, which is causing the circulair reboot,&nbsp; so don&#039;t want to reflash and start configuring all again from scratch...</p><p>Why doesn&#039;t the reset button work on the fonera to get it into failsafe mode and why for godsake are you overwriting the command line parameter to the kernel at startup ? Couldn&#039;t this be setup a bit more intelligently f.i. not overwriting if there is a command line passed through from redboot ?</p><p>Can anybody help ?</p>											<p class="post-edited">(Last edited by <strong>intrax</strong> on 11 Mar 2007, 04:08)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p44129">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">GoldServe</div>
					<div class="post-datetime">
						11 Mar 2007, 05:03					</div>
				</div>
				<div class="post-content content">
					<p>no, i don&#039;t think there is failsafe way.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p44151">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">intrax</div>
					<div class="post-datetime">
						11 Mar 2007, 14:44					</div>
				</div>
				<div class="post-content content">
					<p>@Goldserve - Appreciate your reply... </p><p>No way to start without sysctrl.conf ?</p><p>Would be nice to have some kind of mini kernel with jffs2 support to recover from this kind of silly trouble...</p>											<p class="post-edited">(Last edited by <strong>intrax</strong> on 11 Mar 2007, 14:49)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p44156">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">fabsoft</div>
					<div class="post-datetime">
						11 Mar 2007, 15:23					</div>
				</div>
				<div class="post-content content">
					<p>hi, intrax the redboot&#039;s documentation tell that it&#039;s possible to pass kernel comand line in exec command.<br />see <a href="http://www.ecoscentric.com/ecospro/doc/html/redboot-guide/exec-command.html">http://www.ecoscentric.com/ecospro/doc/ … mmand.html</a> .<br />try exec -c init=/bin/sh vmlinux.bin.l7 in redboot prompt</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p44171">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">intrax</div>
					<div class="post-datetime">
						11 Mar 2007, 19:44					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>Yes I read that, but unfortunately that is not working because some openwrt developper decided in his/her &#039;infinite wisdom&#039; that the exec string for the kernel can easily be overwritten at kernel startup so to leave me and others in a similar situation screwed ! Moreover so as apparantly there is NO WAY to enter failsafe mode on a fonera, reset button does nothing ! Thats why I suggested to come up with a more &#039;intelligent&#039; way to do this and NOT overwrite the kernel exec parameter string if the user has specifically entered something there.... well I guess idle hope and for now only a reflash can solve this... sigh...</p><p>Anyway fabsoft many thanks for bearing with me... :-)</p>											<p class="post-edited">(Last edited by <strong>intrax</strong> on 11 Mar 2007, 19:45)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p44202">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">Kevin</div>
					<div class="post-datetime">
						12 Mar 2007, 07:43					</div>
				</div>
				<div class="post-content content">
					<p>it would not be terribly hard to make a &#039;failsafe&#039; kernel with an embedded initramfs image and jffs2 support for recovery. if you still want one i&#039;ll make one, but I think there&#039;s actually an option you could use in the buildroot configuration, to make a kernel and rootfs image combined</p><p>if you do make/get such an image, just load it into ram from redboot and run it, no need to flash it.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p44228">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">intrax</div>
					<div class="post-datetime">
						12 Mar 2007, 17:19					</div>
				</div>
				<div class="post-content content">
					<p>Hi Kevin,</p><p>Thanks for your reply.</p><p>I would appreciate if you could build such a &#039;failsafe kernel&#039; as I don&#039;t have access to an openwrt buildroot system atm.</p><p>cheers</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p44420">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">intrax</div>
					<div class="post-datetime">
						14 Mar 2007, 18:56					</div>
				</div>
				<div class="post-content content">
					<p>Anyone who can make a kamikaze &#039;failsafe kernel&#039; for Atheros 2.6 ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p44424">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">jshamlet</div>
					<div class="post-datetime">
						14 Mar 2007, 19:08					</div>
				</div>
				<div class="post-content content">
					<p>Or, for ~$10-$12 you could get a LVTTL -&gt; RS232 converter so small you could permanently mount it in your router. </p><p><a href="http://www.digilentinc.com/Products/Detail.cfm?Prod=PMOD-RS232&amp;Nav1=Products&amp;Nav2=Peripheral">http://www.digilentinc.com/Products/Det … Peripheral</a></p><p>Note - these are available from a lot of places, I just provided this link as an example.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p44439">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">intrax</div>
					<div class="post-datetime">
						14 Mar 2007, 20:34					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>jshamlet wrote:</cite><blockquote><p>Or, for ~$10-$12 you could get a LVTTL -&gt; RS232 converter so small you could permanently mount it in your router. </p><p><a href="http://www.digilentinc.com/Products/Detail.cfm?Prod=PMOD-RS232&amp;Nav1=Products&amp;Nav2=Peripheral">http://www.digilentinc.com/Products/Det … Peripheral</a></p><p>Note - these are available from a lot of places, I just provided this link as an example.</p></blockquote></div><p>Not asking for any ads and it wouldn&#039;t work if you had read the thread a bit more carefully...</p>											<p class="post-edited">(Last edited by <strong>intrax</strong> on 14 Mar 2007, 20:35)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p44440">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">GoldServe</div>
					<div class="post-datetime">
						14 Mar 2007, 20:58					</div>
				</div>
				<div class="post-content content">
					<p>While I was compiling the sources for redboot, I noticed there was a file system support with JFFS2. It is enabled on my build but i don&#039;t know how to mount the file system. Let me look into it further.</p><p>Edit: I had a look and redboot can not write to jffs2 file systems. It can only read. Sorry, out of luck!</p>											<p class="post-edited">(Last edited by <strong>GoldServe</strong> on 14 Mar 2007, 21:17)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p44443">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">jshamlet</div>
					<div class="post-datetime">
						14 Mar 2007, 21:24					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>intrax wrote:</cite><blockquote><div class="quotebox"><cite>jshamlet wrote:</cite><blockquote><p>Or, for ~$10-$12 you could get a LVTTL -&gt; RS232 converter so small you could permanently mount it in your router. </p><p><a href="http://www.digilentinc.com/Products/Detail.cfm?Prod=PMOD-RS232&amp;Nav1=Products&amp;Nav2=Peripheral">http://www.digilentinc.com/Products/Det … Peripheral</a></p><p>Note - these are available from a lot of places, I just provided this link as an example.</p></blockquote></div><p>Not asking for any ads and it wouldn&#039;t work if you had read the thread a bit more carefully...</p></blockquote></div><p>I&#039;m not posting any ads, either. I just posted a link to a board that is small enough to fit inside the router. I don&#039;t work for, or have any affiliation with, the company or product.</p><p>However, unless you have mounted your router where you can&#039;t physically access it, using a serial converter is still the best way to recover in this situation. I always make sure I have a console port handy when I&#039;m debugging an embedded system, since you can&#039;t always count on software fail-safes.</p><p>Also, the reset button on the bottom is not a standard reset button. It&#039;s actually running between to two GPIO lines, so it would require some level of software to function. One GPIO line is setup as an input, while the second is setup as an output. The button is &quot;pulled up&quot; to the output, which allows you to do a soft-reset by driving the output low. Note that the reset line isn&#039;t involved here, everything that occurs happens in software.</p><p>I would assume that the kernel has been modified to look for this input, and reset/recover when it sees it go low. This tracks, since you have to hold the button for nearly 30 seconds after power-up for the recovery to begin. (it takes a few seconds for the kernel to load) I suspect that FON&#039;s changes would need to be ported to support the same mechanism. (IOW, Kamikaze probably doesn&#039;t know about the button yet)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p44457">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">intrax</div>
					<div class="post-datetime">
						15 Mar 2007, 02:07					</div>
				</div>
				<div class="post-content content">
					<p>@GoldServe - Thanks for trying, goodluck with redboot and your awsome 32MB fonera...</p><p>@jshamlet - The serial console will not let me recover from this situation as it&#039;s a continous reboot caused by the kernel startup. I am perfectly aware of the ttl/rs232 level shifter but have not needed it and would like (if at all possible..) to keep it that way. I know the reset button will not bring the fonera in failsafe mode as I have tried several times and development should care to fix this. And yes this has all been in written in this thread before so please read...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p44582">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">intrax</div>
					<div class="post-datetime">
						17 Mar 2007, 00:09					</div>
				</div>
				<div class="post-content content">
					<p>I tried to build a openwrt failsafe kernel with kernel embedded rootfs for the fonera myself. I installed a colinux (debian) system and downloaded kamikaze trunk and all needed packages. The compile fails with error: /usr/initramfs_data.gpio.gz error 255....</p><p>edit: compiling without initramfs support works flawless....</p><p>Anyone know what&#039;s wrong here ?</p>											<p class="post-edited">(Last edited by <strong>intrax</strong> on 17 Mar 2007, 00:47)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p44870">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">intrax</div>
					<div class="post-datetime">
						20 Mar 2007, 20:24					</div>
				</div>
				<div class="post-content content">
					<p>I have built the initramfs kernel for fonera and loaded it into ram using tftp (openwrt-atheros-2.6-vmlinux.lzma from /trunk/bin)...</p><p>I load than execute the kernel using:<br /></p><div class="quotebox"><blockquote><p>load -r -b %{FREEMEMLO} openwrt-atheros-2.6-vmlinux.lzma<br />exec</p></blockquote></div><p>Doesn&#039;t seem to work, nothing on 192.168.1.1 <br />Do I need to add any command line parameters ?</p><p>Kernel does not seem to be booting... Please help ?</p>											<p class="post-edited">(Last edited by <strong>intrax</strong> on 21 Mar 2007, 02:45)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p44899">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">olg</div>
					<div class="post-datetime">
						21 Mar 2007, 08:30					</div>
				</div>
				<div class="post-content content">
					<p>Um, try it without compression:</p><div class="codebox"><pre><code>load /openwrt-atheros-2.6-vmlinux.elf
exec</code></pre></div><p>(I think also the gzipped image should work with -c , but I have not test it yet.)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p44917">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">intrax</div>
					<div class="post-datetime">
						21 Mar 2007, 14:22					</div>
				</div>
				<div class="post-content content">
					<p>@olg<br />Thanks for your reply. I tried all three kernel images (lzma, gz and elf) and none of them seems to be working...</p><p>Are you testing this yourself as well ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p44978">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">olg</div>
					<div class="post-datetime">
						22 Mar 2007, 08:57					</div>
				</div>
				<div class="post-content content">
					<p>It works fine for me:<br /></p><div class="codebox"><pre><code>RedBoot&gt; ip -h XX.XX.XX.XX
IP: 192.168.2.86/255.255.255.0, Gateway: 192.168.2.1
Default server: XX.XX.XX.XX
RedBoot&gt; load -m http -p 2000 /openwrt-atheros-2.6-vmlinux.elf
Entry point: 0x802a7000, address range: 0x80041000-0x803cddca
RedBoot&gt; exec</code></pre></div><p>What is your output?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p44996">
				<div class="post-metadata">
					<div class="post-num">Post #21</div>
					<div class="post-author">intrax</div>
					<div class="post-datetime">
						22 Mar 2007, 15:24					</div>
				</div>
				<div class="post-content content">
					<p>I load kernel through tftp i.o http, but it loads fine.</p><p>When I start kernel from redboot (connected through telnet 192.168.1.254:9000)&nbsp; there is no output anymore in the redboot console, which is normal as I have no serial connection...</p><p>If the initramfs kernel would be booting correctly I expect to be able to connect through telnet at 192.168.1.1 but sofar nothing...</p><p>What is your output ? Any special kernel_config ?</p>											<p class="post-edited">(Last edited by <strong>intrax</strong> on 23 Mar 2007, 02:33)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p45553">
				<div class="post-metadata">
					<div class="post-num">Post #22</div>
					<div class="post-author">intrax</div>
					<div class="post-datetime">
						30 Mar 2007, 15:05					</div>
				</div>
				<div class="post-content content">
					<p>I checked with serial console, the initramfs kernel is simply not booting. Has anyone loaded and ran an initramfs failsafe kernel successfully on fonera ?</p><p>edit:</p><p>pity noone but olg cared to help me...</p><p>the kernel does boot using:</p><div class="codebox"><pre><code>load openwrt-atheros-2.6-vmlinux.elf
exec</code></pre></div><p>i.o. load -r -b</p><p>than you can simply mount the jffs2 filesystem on mtd1 and correct anything wrong, reboot and voila loop SOLVED !</p>											<p class="post-edited">(Last edited by <strong>intrax</strong> on 4 Apr 2007, 01:26)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p76440">
				<div class="post-metadata">
					<div class="post-num">Post #23</div>
					<div class="post-author">smayhew</div>
					<div class="post-datetime">
						14 Nov 2008, 18:21					</div>
				</div>
				<div class="post-content content">
					<p>Redboot in the Atheros boards doesn&#039;t appear to be able to pass the exec&#039;d command line to the kernel correctly, it corrupts the command line area when you use the -c option.&nbsp; Here&#039;s a work around:</p><p>1) Find the address of the compiled in boot command line in System.map (in the build_dir), in my kernel it&#039;s 0x80240860.<br />2) Load your Gzip&#039;d kernel (or elf file or however),&nbsp; eg:<br />&nbsp; &nbsp;load -d -b 0x80041000 -r openwrt-atheros-vmlinux.gz<br />3) Wipe the original command line<br />&nbsp; &nbsp;mfill -b 0x80240860 -l 256 -p 0<br />4) load a text file using tftp or http (create this with vi or whatever) with the command line, into the command line location<br />&nbsp; &nbsp;load -r -b 0x80240860 kernel_cmdline<br />5) exec the image (need to specify the entry point, as last load sets the default)<br />&nbsp; exec 0x80041000</p><p>This works fine for me.&nbsp; Know if anyone getst the recipe to create the failsafe image let me know ;-)</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>