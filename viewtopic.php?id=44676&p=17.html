<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Easybox 904 LTE open source code to be provide soon</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 1 Apr 2018 and 5 May 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 17 of 19</div><nav><ul><li><a href="viewtopic.php%3Fid=44676&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=44676&amp;p=15.html">15</a></li><li><a href="viewtopic.php%3Fid=44676&amp;p=16.html">16</a></li><li class="pagination-current"><span>17</span></li><li><a href="viewtopic.php%3Fid=44676&amp;p=18.html">18</a></li><li><a href="viewtopic.php%3Fid=44676&amp;p=19.html">19</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p368364">
				<div class="post-metadata">
					<div class="post-num">Post #401</div>
					<div class="post-author">somebodywhoisntme</div>
					<div class="post-datetime">
						18 Nov 2017, 03:23					</div>
				</div>
				<div class="post-content content">
					<p>@QAuge</p><p>Many thanks for your amazing work <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> Have tried the last image from 08.11. and everything is working from what I can see. <br />The only thing that seems a little bit strong is that the router has rebooted 2 times without any interaction from my side.</p><p>atm I&#039;m trying to build my own Image but I lack a decent linux machine. One has to less space for the build root and the others are arm boards. <br />The orange pi zero compiles it at the moment but I changed some things and so I think I broke something <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /> </p><p>Are you interested in a 904 LTE Box? Have one laying around and I would spend it to you as a little present for all the work you&#039;ve done <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /></p><p>@Plonk</p><p>With the touchpad I don&#039;t have a clue but the display can configured at /etc/lcd4linux.conf</p><p>It&#039;s a simple system. You&#039;ve to define some widgets, a layout, the display and there you go.</p><p><a href="https://lcd4linux.bulix.org/wiki/Layout">https://lcd4linux.bulix.org/wiki/Layout</a></p><p>But there you only can do some kind of &#039;static&#039; text&#039;s which will get updated like you set in the parameters. I&#039;m trying to find out how to play videos or stream some webcam. </p><p>@metai</p><p>Nice work, I can try the weekend if the boot animation will work on a LTE device. Can I ask how you&#039;ve done this? I&#039;ve tried a little bit around with binwalk but unfortunately I&#039;m not deep enough into that reverse engineering stuff.</p><p>Do you have a little tutorial or some links where I can have at least a look how this works?</p>											<p class="post-edited">(Last edited by <strong>somebodywhoisntme</strong> on 18 Nov 2017, 03:24)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p368379">
				<div class="post-metadata">
					<div class="post-num">Post #402</div>
					<div class="post-author">metai</div>
					<div class="post-datetime">
						18 Nov 2017, 10:26					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>somebodywhoisntme wrote:</cite><blockquote><p>@metai</p><p>Nice work, I can try the weekend if the boot animation will work on a LTE device. Can I ask how you&#039;ve done this?</p></blockquote></div><p>There&#039;s actually no &quot;reverse engineering&quot; necessary. Have a look at the makefile <a href="https://github.com/uwehermann/easybox-904-xdsl-firmware/tree/master/package/arcadyan-utility/lcd_904-fb">in the arcadyan-tools directory of the original firmware source</a>, it tells you how the binary blob is formatted.</p><p>Only I don&#039;t have a build environment ready, and I&#039;m utterly unfamiliar with creating one, so I wrote a shell script based on that makefile and adapted it to work on my system (incidentally another OpenWrt/LEDE box running on a My Book Live NAS).</p><p>The whole process is actually not that complicated:<br /></p><ul><li><p>The animation needs to be a set of 81 images in raw format (I use ImageMagick convert to create them from a set of PNGs), and 10 more images containing the instructions displayed when flashing</p></li><li><p>The raw images need to be LZMA-compressed and put into a binary blob</p></li><li><p>Finally, the whole thing needs a 160-byte header (conveniently documented in the makefile), and if one sticks to the original number of images, the only value that varies there is the size of the LZMA blob.</p></li></ul><p>I had the biggest problems with creating the lzma-compressed archive because the original &quot;lzma&quot; used in the makefile has been superseded by &quot;xz tools&quot;, and even though those provide an &quot;lzma&quot;, it is not parameter compatible with the parameters in the makefile. Maybe I was too cautious, maybe as long as it is &quot;LZMA&quot; of any sort the boot process decompresses everything fine, but I wanted to be as close as possible to the original compression type. And it&#039;s surprisingly hard to find information of how the &quot;old lzma&quot; parameters are to be substituted with the new ones from XZ tools.</p><p>I also did not try to vary the amount of images used (81) because the images after that contain instructions in emergency situations and I don&#039;t know if the bootloader is smart enough to adjust the offset for those images.</p><p>Really the only reason I did not document everything yet is the fact that my set of scripts and tools is an utterly messy hodgepodge, and has nothing in common with a clean makefile. But I&#039;ll happily help in any way I can, I have no intention of keeping this a secret.</p>											<p class="post-edited">(Last edited by <strong>metai</strong> on 18 Nov 2017, 11:04)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p368443">
				<div class="post-metadata">
					<div class="post-num">Post #403</div>
					<div class="post-author">metai</div>
					<div class="post-datetime">
						19 Nov 2017, 14:24					</div>
				</div>
				<div class="post-content content">
					<p>Alright, I finally found the time to upgrade to the latest snapshot (2017-11-08), and there&#039;s something broken in that latest snapshot.</p><p>When I sysupgrade to the 11-08 snapshot from any previous version without &quot;keeping settings&quot;, or directly from the fullimage.img from post #280, the box boots into a state where the LAN does not work. No DHCP, no answer at 192.168.1.1, not even pings. LCD is coming up, so the system is up and running.</p><p>However, when I sysupgrade from fullimage.img to the 2017-09-02 sysupgrade, the box runs fine, also when I sysupgrade from any working snapshot to to the 2017-11-08 snapshot <em>keeping the settings</em>.</p><p>So I believe at least in the 2017-11-08 snapshot, the default network configuration or the initial generation thereof is b0rked. (FTR, I did not try intermediate snapshots between 2017-09-02 and 2017-11-08.)</p>											<p class="post-edited">(Last edited by <strong>metai</strong> on 19 Nov 2017, 14:37)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p368457">
				<div class="post-metadata">
					<div class="post-num">Post #404</div>
					<div class="post-author">metai</div>
					<div class="post-datetime">
						19 Nov 2017, 20:46					</div>
				</div>
				<div class="post-content content">
					<p>Some other stray observations:</p><p>The snapshot image comes with a lot of packages pre-installed. I really don&#039;t have any use for perl, adblock, collectd, and other packages so I end up uninstalling them. It would be really nice to have a &quot;clean&quot; build that resembles the base configuration of other LEDE devices, especially now that we can use the official repositories to install our own selection of packages.</p><p>And for the life of me, I can&#039;t figure out how to configure channels, standards or bandwidths for the wireless interfaces. Some documentation there would be greatly appreciated.</p><p>Finally, and I think I mentioned this before: The LCD, when running, is drawing <em>a lot</em> of CPU, I think because of the really short update intervals for some values. I have substitutes for the LCD configuration in the works that draws close to zero CPU, and also a tiny shell script as a replacement for lcdcontroller that uses almost no memory, it&#039;s just not quite ready for showtime yet.</p>											<p class="post-edited">(Last edited by <strong>metai</strong> on 19 Nov 2017, 20:48)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p368460">
				<div class="post-metadata">
					<div class="post-num">Post #405</div>
					<div class="post-author">QAuge</div>
					<div class="post-datetime">
						19 Nov 2017, 22:05					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>metai wrote:</cite><blockquote><p>Alright, I finally found the time to upgrade to the latest snapshot (2017-11-08), and there&#039;s something broken in that latest snapshot.</p><p>When I sysupgrade to the 11-08 snapshot from any previous version without &quot;keeping settings&quot;, or directly from the fullimage.img from post #280, the box boots into a state where the LAN does not work. No DHCP, no answer at 192.168.1.1, not even pings. LCD is coming up, so the system is up and running.</p><p>However, when I sysupgrade from fullimage.img to the 2017-09-02 sysupgrade, the box runs fine, also when I sysupgrade from any working snapshot to to the 2017-11-08 snapshot <em>keeping the settings</em>.</p><p>So I believe at least in the 2017-11-08 snapshot, the default network configuration or the initial generation thereof is b0rked. (FTR, I did not try intermediate snapshots between 2017-09-02 and 2017-11-08.)</p></blockquote></div><p>Thanks for your report! I found the commit, which prevents the correct initial config creation ( I added eth0 as default lan interface, which doesn&#039;t work: We have to use eth0.1 ). I start a new build.<br />I found another bug which creates a new wlan config on every sysupgrade.... I think about a fix <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p368488">
				<div class="post-metadata">
					<div class="post-num">Post #406</div>
					<div class="post-author">somebodywhoisntme</div>
					<div class="post-datetime">
						20 Nov 2017, 05:55					</div>
				</div>
				<div class="post-content content">
					<p>@metai</p><p>Many thanks.</p><p>Ha, I&#039;m not really deep into that stuff and never thought of looking into the make file of the provide source code from Arcadian xD</p><p>I think I understood but somehow I don&#039;t get it to work. Googled a little bit around and found this site: </p><p><a href="https://manned.org/lzma_alone.1">https://manned.org/lzma_alone.1</a></p><br /><br /><p>There I found the &#039;old lzma&#039; parameters mentioned in the makefile. </p><p>Just for clarification I&#039;ll post the original command and the one where I think it should with xz-utils;</p><div class="codebox"><pre><code>cat ./files/etc/lcd_boot_image/*.raw | $(STAGING_DIR_HOST)/bin/lzma e $(PKG_BUILD_DIR)/lcd_boot_image.lzma -si -a0</code></pre></div><br /><div class="codebox"><pre><code>cat custom_boot_animation/*.raw | xz --format=lzma --lzma1=preset=0 - --stdout &gt; lcd_boot_imgage.lzma</code></pre></div><br /><br /><p>So the &#039;e&#039; is for encoding which I assume just stands for compressing, the &#039;-si&#039; parameter tells lzma to take the data from stdin and the &#039;-a0&#039; parameter adjusts the compression-rate. </p><p>With xz-utils:</p><ul><li><p>&#039;--format=lzma&#039; without &#039;--decompress&#039; should be the equivalent for &#039;lzma e&#039;</p></li></ul><ul><li><p>&#039;-&#039; or nothing should be the equivalent for &#039;-si&#039;</p></li></ul><ul><li><p>&#039;--lzma1=preset=0&#039; should be the equivalent for &#039;-a0&#039;</p></li></ul><ul><li><p>somehow I was to stupid to declare the output file so I used &#039;--stdout&#039; to pipe it straight into the file(maybe that&#039;s the problem <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /> )</p></li></ul><p>Buuuut, as expected this doesn&#039;t work. If I&#039;m understand the makefile correctly the pictures won&#039;t get compressed individually rather than they get packed together in the &#039;lcd_boot_image.lmza&#039; archive, correct? <br />Also I wonder why the heck the pictures from the source code have all the same size. The ones I converted from *.png to *.raw with ImageMagick use to have all different file sizes.</p><br /><p>Here&#039;s the script I tried to create maybe you find the error if you like to check it:<br /></p><div class="codebox"><pre><code>#!/bin/bash

cat animation/*.raw | xz --format=lzma --lzma1=preset=9 - --stdout &gt; lcd_boot_image.lzma

f_size=`du -k &quot;lcd_boot_image.lzma&quot; | cut -f1`

echo &#039;write first 16 bytes: identifier&#039;
printf &quot;%s&quot; &quot;lcd_boot_image&quot; &gt; lcd_boot_image
./pad2align.sh -n  16 lcd_boot_image &gt;&amp; /dev/null

echo &#039;write next 12 bytes: LZMA compressed image size&#039;
printf &quot;%lu&quot; `ls -l lcd_boot_image.lzma | cut -d &#039; &#039; -f 5` &gt;&gt; lcd_boot_image
./pad2align.sh -n  28 lcd_boot_image &gt;&amp; /dev/null

echo &#039;write next 4 bytes: amount of files&#039;
printf &quot;%lu&quot; `ls -1 animation/*.raw | wc -l` &gt;&gt; lcd_boot_image
./pad2align.sh -n  32 lcd_boot_image &gt;&amp; /dev/null

echo &#039;write next 16 bytes: original image size&#039;
printf &quot;%lu&quot; `du -b -c animation/*.raw  | awk &#039;{ if ( $$$$2 == &quot;total&quot; ) print $$$$1 }&#039;` &gt;&gt; lcd_boot_image
./pad2align.sh -n  48 lcd_boot_image &gt;&amp; /dev/null

echo &#039;write next 4 bytes: frame time slot, in msec &#039;
echo &quot;10&quot; &gt;&gt; lcd_boot_image
./pad2align.sh -n  52 lcd_boot_image &gt;&amp; /dev/null

echo &#039;write next 108 bytes: bit vector format of display images, lsb&#039;
echo &quot;1111111111111111111111111111111111111111111111111111111111111101010101010101010110000000000&quot; &gt;&gt; lcd_boot_image
./pad2align.sh -n 160 lcd_boot_image &gt;&amp; /dev/null

echo &#039;add lcd_boot_image.lzma&#039;
cat lcd_boot_image.lzma &gt;&gt; lcd_boot_image
./pad2align.sh -n $f_size lcd_boot_image &gt;&amp; /dev/null</code></pre></div><br /><br /><p>BTW; I wanted to try your lcd_boot_image on the LTE box I&#039;ve laying around here but now I had recognize why I didn&#039;t continued the last time I was here because somehow I messed up the box¯\_(ツ)_/¯ <br />(sry I forgot about that @QAuge, was not my intention to offer you &#039;junk&#039; <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" />) </p><p>Now somehow I&#039;m not able to flash a image anymore but I&#039;ll try to recover it the next days.</p>											<p class="post-edited">(Last edited by <strong>somebodywhoisntme</strong> on 20 Nov 2017, 06:25)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p368493">
				<div class="post-metadata">
					<div class="post-num">Post #407</div>
					<div class="post-author">metai</div>
					<div class="post-datetime">
						20 Nov 2017, 10:35					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>somebodywhoisntme wrote:</cite><blockquote><p>I wonder why the heck the pictures from the source code have all the same size.</p></blockquote></div><p>Raw images are <em>uncompressed</em> bitmaps, in our case 320x240 pixels with 8 bits (1 byte) each for R, G and B. That makes them 320*240*3 = 230400 bytes.</p><div class="quotebox"><blockquote><p>The ones I converted from *.png to *.raw with ImageMagick use to have all different file sizes.</p></blockquote></div><p>Use </p><div class="codebox"><pre><code>convert file.png -depth 8 rgb:file.raw</code></pre></div><br /><div class="quotebox"><blockquote><div class="codebox"><pre><code>echo &#039;add lcd_boot_image.lzma&#039;
cat lcd_boot_image.lzma &gt;&gt; lcd_boot_image
./pad2align.sh -n $f_size lcd_boot_image &gt;&amp; /dev/null</code></pre></div></blockquote></div><p>That final padding in your script is wrong. It needs to pad to a multiple of 131072 bytes (i.e., 128 kB). The original &quot;pad2align.sh&quot; (which, in my script, I replaced with dd commands) not only pads to a certain size, it pads to a multiple of that size.</p><p>I&#039;m just in the process of cleaning up all my stuff over here and putting it on github, I try to finish that tonight. At least it will provide a tried and tested method.</p><p>Edit: Here it is: <a href="https://github.com/squarewf/easybox904-bootanimation">https://github.com/squarewf/easybox904-bootanimation</a></p>											<p class="post-edited">(Last edited by <strong>metai</strong> on 20 Nov 2017, 23:55)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p370269">
				<div class="post-metadata">
					<div class="post-num">Post #408</div>
					<div class="post-author">guraltsev</div>
					<div class="post-datetime">
						31 Dec 2017, 16:00					</div>
				</div>
				<div class="post-content content">
					<p>@QAuge</p><p>Thanks for the great work.</p><p>There seems to be a problem with the wifi in your last 2017-11-19 image on box.<br />I followed the instructions and enabled wifi in </p><div class="codebox"><pre><code>/etc/config/wireless</code></pre></div><p> but it cannot be brought up.</p><p>Earlier builds do not seem to have this problem.</p><div class="codebox"><pre><code>root@LEDE:~# cat /etc/config/wireless 

config wifi-device &#039;wl000&#039;
        option type &#039;ralink&#039;
        option channel &#039;11&#039;
        option disabled &#039;0&#039;

config wifi-iface &#039;default_wl000&#039;
        option device &#039;wl000&#039;
        option mode &#039;ap&#039;
        option ssid &#039;Lede&#039;
        option encryption &#039;psk2+aes&#039;
        option key &#039;WiFipassword&#039;

config wifi-device &#039;wl010&#039;
        option type &#039;ralink&#039;
        option channel &#039;11&#039;
        option disabled &#039;0&#039;

config wifi-iface &#039;default_wl010&#039;
        option device &#039;wl010&#039;
        option mode &#039;ap&#039;
        option ssid &#039;Lede1&#039;
        option encryption &#039;psk2+aes&#039;
        option key &#039;WiFipassword&#039;</code></pre></div><div class="codebox"><pre><code>root@LEDE:~# /etc/init.d/rt3883 restart ; /etc/init.d/network reload
scan device: wl000
Shutdown interface wl000
Invalid command : set
Invalid command : set
Invalid command : set
scan device: wl010
Shutdown interface wl010
Invalid command : set
Invalid command : set
Invalid command : set
scan device: wl000
Enable device wl000
DEVICE: wl000 VIF: default_wl000
Encryption: psk2+aes
Preparing interface &lt;wl000&gt;

Bring up interface &lt;wl000&gt; to be able to send iwpriv commands
Configure wifi device wl000

Starting wifi device wl000
iwpriv &#039;wl000&#039; set Enable=1; iwpriv &#039;wl000&#039; set Enable=0; iwpriv &#039;wl000&#039; set RadioOn=0; iwpriv &#039;wl000&#039; set AuthMode=WEPAUTO; iwpriv &#039;wl000&#039; set EncrypType=WEP; iwpriv &#039;wl000&#039; set IEEE8021X=0; echo &#039;wl000&#039; is WPA2-AES MODE; iwpriv &#039;wl000&#039; set AuthMode=WPA2PSK; iwpriv &#039;wl000&#039; set EncrypType=AES; iwpriv &#039;wl000&#039; set IEEE8021X=0; iwpriv &#039;wl000&#039; set WPAPSK=&#039;WiFipassword&#039;; iwpriv &#039;wl000&#039; set DefaultKeyID=2; iwpriv &#039;wl000&#039; set SSID=Lede ; iwpriv &#039;wl000&#039; set Enable=1; iwpriv &#039;wl000&#039; set RadioOn=1
Invalid command : set
Invalid command : set
Invalid command : set
Invalid command : set
Invalid command : set
Invalid command : set
wl000 is WPA2-AES MODE
Invalid command : set
Invalid command : set
Invalid command : set
Invalid command : set
Invalid command : set
Invalid command : set
Invalid command : set
Invalid command : set
wl000(ralink): enable failed
scan device: wl010
Enable device wl010
DEVICE: wl010 VIF: default_wl010
Encryption: psk2+aes
Preparing interface &lt;wl010&gt;

Bring up interface &lt;wl010&gt; to be able to send iwpriv commands
Configure wifi device wl010

Starting wifi device wl010
iwpriv &#039;wl010&#039; set Enable=1; iwpriv &#039;wl010&#039; set Enable=0; iwpriv &#039;wl010&#039; set RadioOn=0; iwpriv &#039;wl010&#039; set AuthMode=WEPAUTO; iwpriv &#039;wl010&#039; set EncrypType=WEP; iwpriv &#039;wl010&#039; set IEEE8021X=0; echo &#039;wl010&#039; is WPA2-AES MODE; iwpriv &#039;wl010&#039; set AuthMode=WPA2PSK; iwpriv &#039;wl010&#039; set EncrypType=AES; iwpriv &#039;wl010&#039; set IEEE8021X=0; iwpriv &#039;wl010&#039; set WPAPSK=&#039;WiFipassword&#039;; iwpriv &#039;wl010&#039; set DefaultKeyID=2; iwpriv &#039;wl010&#039; set SSID=Lede1 ; iwpriv &#039;wl010&#039; set Enable=1; iwpriv &#039;wl010&#039; set RadioOn=1
Invalid command : set
Invalid command : set
Invalid command : set
Invalid command : set
Invalid command : set
Invalid command : set
wl010 is WPA2-AES MODE
Invalid command : set
Invalid command : set
Invalid command : set
Invalid command : set
Invalid command : set
Invalid command : set
Invalid command : set
Invalid command : set
wl010(ralink): enable failed</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p370401">
				<div class="post-metadata">
					<div class="post-num">Post #409</div>
					<div class="post-author">metai</div>
					<div class="post-datetime">
						3 Jan 2018, 19:04					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>guraltsev wrote:</cite><blockquote><p>There seems to be a problem with the wifi in your last 2017-11-19 image on box.</p></blockquote></div><p>I cannot confirm that. I notice you use </p><div class="codebox"><pre><code>/etc/init.d/rt3883 restart</code></pre></div><p> to restart the wifi. I don&#039;t have to do that. A simple </p><div class="codebox"><pre><code>wifi</code></pre></div><p> brings up the wireless interfaces just fine.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p370403">
				<div class="post-metadata">
					<div class="post-num">Post #410</div>
					<div class="post-author">metai</div>
					<div class="post-datetime">
						3 Jan 2018, 19:12					</div>
				</div>
				<div class="post-content content">
					<p>I have finally found some time to follow up on this device. The very first issue I&#039;m trying to tackle is the wifi.</p><p>May I ask, where is the /lib/wifi/ralink.sh coming from? It seems to try to translate OpenWrt&#039;s UCI configuration files to something the <em>iwpriv</em> command understands, but it stops short of even basic configuration options, most obviously the channel and bandwidth settings, and I think a lot of encryption options.</p><p>I already made some modifications to /lib/wifi/ralink.sh, so now my version will accept the channel selection in /etc/config/wireless, but I&#039;m not sure if this is the right place to make such modifications.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p370404">
				<div class="post-metadata">
					<div class="post-num">Post #411</div>
					<div class="post-author">obsy</div>
					<div class="post-datetime">
						3 Jan 2018, 19:44					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>metai wrote:</cite><blockquote><p>I already made some modifications to /lib/wifi/ralink.sh, so now my version will accept the channel selection in /etc/config/wireless, but I&#039;m not sure if this is the right place to make such modifications.</p></blockquote></div><p>Open PR here: <a href="https://github.com/Quallenauge/Easybox-904-XDSL">https://github.com/Quallenauge/Easybox-904-XDSL</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p370407">
				<div class="post-metadata">
					<div class="post-num">Post #412</div>
					<div class="post-author">metai</div>
					<div class="post-datetime">
						3 Jan 2018, 19:53					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>obsy wrote:</cite><blockquote><div class="quotebox"><cite>metai wrote:</cite><blockquote><p>I already made some modifications to /lib/wifi/ralink.sh, so now my version will accept the channel selection in /etc/config/wireless, but I&#039;m not sure if this is the right place to make such modifications.</p></blockquote></div><p>Open PR here: <a href="https://github.com/Quallenauge/Easybox-904-XDSL">https://github.com/Quallenauge/Easybox-904-XDSL</a></p></blockquote></div><p>Thank you, I&#039;m aware of his repository and the possibility of making PRs. My question is a different one: It seems that there is still a lot to do on the wireless system, at least to bring it into the OpenWrt ecosystem, and I&#039;m not sure if ralink.sh is the best place to make modifications. It would help to know where that file is coming from, i.e. who created it in the first place, and what the plans are for it. I notice that the wireless bringup has already changed at least once.</p><p>Other than that, I&#039;m having a lot of problems convincing the wireless device with iwpriv. I can&#039;t seem to set a lot of parameters, no HT20, no second channel below, no base channel &gt; 48, etc.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p370410">
				<div class="post-metadata">
					<div class="post-num">Post #413</div>
					<div class="post-author">obsy</div>
					<div class="post-datetime">
						3 Jan 2018, 20:03					</div>
				</div>
				<div class="post-content content">
					<p>See post #200</p>											<p class="post-edited">(Last edited by <strong>obsy</strong> on 3 Jan 2018, 20:03)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p370411">
				<div class="post-metadata">
					<div class="post-num">Post #414</div>
					<div class="post-author">metai</div>
					<div class="post-datetime">
						3 Jan 2018, 20:24					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>obsy wrote:</cite><blockquote><p>See post #200</p></blockquote></div><p>... which talks about GPIOs. What are you trying to tell me?</p><p>To quote QAuge:<br /></p><div class="quotebox"><blockquote><p>If someone has time and would like to extend the configuration, you are welcome.</p></blockquote></div><p>I&#039;m trying to assess the current state of things (since they have been very much in flux since basic support was established) and how to improve them.</p>											<p class="post-edited">(Last edited by <strong>metai</strong> on 3 Jan 2018, 20:25)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p370428">
				<div class="post-metadata">
					<div class="post-num">Post #415</div>
					<div class="post-author">QAuge</div>
					<div class="post-datetime">
						3 Jan 2018, 23:09					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>guraltsev wrote:</cite><blockquote><p>@QAuge</p><p>Thanks for the great work.</p><p>There seems to be a problem with the wifi in your last 2017-11-19 image on box.<br />I followed the instructions and enabled wifi in </p><div class="codebox"><pre><code>/etc/config/wireless</code></pre></div><p> but it cannot be brought up.</p><p>Earlier builds do not seem to have this problem.<br /></p><div class="codebox"><pre><code>root@LEDE:~# /etc/init.d/rt3883 restart ; /etc/init.d/network reload
scan device: wl000
Shutdown interface wl000
Invalid command : set
Invalid command : set
Invalid command : set
....
wl010(ralink): enable failed</code></pre></div></blockquote></div><p>Hi @guraltsev!</p><p>Hm, such errors resulting in no or incompleted firmware uploads.<br />Maybe it helps if you can post some dmesg messages. Did you also changed the VLAN settings? (The device is initialized via the network interface - and in case this is blocked, the firmware can&#039;t be uploaded).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p370430">
				<div class="post-metadata">
					<div class="post-num">Post #416</div>
					<div class="post-author">QAuge</div>
					<div class="post-datetime">
						3 Jan 2018, 23:27					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>metai wrote:</cite><blockquote><div class="quotebox"><cite>obsy wrote:</cite><blockquote><p>See post #200</p></blockquote></div><p>... which talks about GPIOs. What are you trying to tell me?</p><p>To quote QAuge:<br /></p><div class="quotebox"><blockquote><p>If someone has time and would like to extend the configuration, you are welcome.</p></blockquote></div><p>I&#039;m trying to assess the current state of things (since they have been very much in flux since basic support was established) and how to improve them.</p></blockquote></div><p>Hi @metai!<br />The driver we have is an old one dinosaur. It uses the legacy iwpriv ioctl-command based technique for controlling.<br />Newer drivers are using the cfg80211. In case someone would convert the iwpriv-ioctl calls into the cfg80211-structures we are able to use them with more power within the LuCI interface via the state of the art interfaces.<br />I&#039;m not feeling, that I have the sufficient power to do that, since that seems to be a bigger job. Some help is needed from someone who&#039;s some knownledge already.</p><p>Regarding the existing configuration files: </p><div class="codebox"><pre><code>ralink.sh</code></pre></div><p> is located at the </p><div class="codebox"><pre><code>/lib/wifi/ralink.sh</code></pre></div><p> folder.<br />It seems, openwrt is executing all scripts within the folder. It is a standard for all drivers in openwrt. I copied&amp;pasted the file from other wifi drivers and adapted this to support some initial parameters, like on/off channel selection, SSID and decryption settings. There are much more settings available, there is a good documentation about the available iwpriv commands here: <a href="https://forum.openwrt.org/viewtopic.php?pid=358568#p358568">Post 333</a>.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p370441">
				<div class="post-metadata">
					<div class="post-num">Post #417</div>
					<div class="post-author">metai</div>
					<div class="post-datetime">
						4 Jan 2018, 05:20					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>QAuge wrote:</cite><blockquote><p>The driver we have is an old one dinosaur. It uses the legacy iwpriv ioctl-command based technique for controlling.</p></blockquote></div><p>I noticed. Like I said, I was unsuccessful to make the driver do half the things it is supposed to do, even with iwpriv, but I now realize that the <a href="https://github.com/cristiklein/ralink/blob/master/iwpriv_usage.txt">documentation I was consulting</a> might even be for a newer or different driver. Still it&#039;s curious that even our driver is just going up to channel 48 on the 5GHz band, and going on strike on any channel beyond that. The driver clearly seems to acccept <em>some</em> configuration, but it is unclear (at least to me) how much and why.</p><div class="quotebox"><blockquote><p>I copied&amp;pasted the file from other wifi drivers and adapted this to support some initial parameters, like on/off channel selection, SSID and decryption settings.</p></blockquote></div><p>That was my question, sorry for being unclear. I was thinking about extending ralink.sh to accept more configuration from the UCI files, just like you ask for in post #333.</p><div class="quotebox"><blockquote><p>There are much more settings available, there is a good documentation about the available iwpriv commands here: <a href="https://forum.openwrt.org/viewtopic.php?pid=358568#p358568">Post 333</a>.</p></blockquote></div><p>Besides the link not actually linking to post #333, there is no reference to any documentation in post #333. Am I looking in the wrong place? Do my posts order differently?</p>											<p class="post-edited">(Last edited by <strong>metai</strong> on 4 Jan 2018, 06:29)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p370445">
				<div class="post-metadata">
					<div class="post-num">Post #418</div>
					<div class="post-author">QAuge</div>
					<div class="post-datetime">
						4 Jan 2018, 08:49					</div>
				</div>
				<div class="post-content content">
					<p>Sorry, indeed it is post #307.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p370450">
				<div class="post-metadata">
					<div class="post-num">Post #419</div>
					<div class="post-author">metai</div>
					<div class="post-datetime">
						4 Jan 2018, 13:16					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>QAuge wrote:</cite><blockquote><p>Sorry, indeed it is post #307.</p></blockquote></div><p>No problem. However, I can&#039;t find any documentation for the iwpriv commands there either. The datasheets are, well, datasheets. And the link to the PDF at SourceForge leads to a &quot;forbidden&quot; error page. Am I being daft?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p370453">
				<div class="post-metadata">
					<div class="post-num">Post #420</div>
					<div class="post-author">QAuge</div>
					<div class="post-datetime">
						4 Jan 2018, 14:30					</div>
				</div>
				<div class="post-content content">
					<p>Try this one <a href="https://sourceforge.net/p/wive-ng/wive-ng-mt/ci/05d0fa0ec200e4201f3fca74694ed2dee6de6aff/tree/docs/DriversNotes/">DriverNotes</a>. I took this document as reference <a href="https://sourceforge.net/p/wive-ng/wive-ng-mt/ci/05d0fa0ec200e4201f3fca74694ed2dee6de6aff/tree/docs/DriversNotes/2011_0128_RT3x5x_5350_Linux_STA_v2.5.0.0_ReleaseNote.pdf">RT3x5x_5350_Linux_STA</a><br />Many commands are valid for our device. Also take a look at <a href="https://mega.nz/#F!KMtUwAqL!vE0VqowRSJI1_o40W3jnUg">this</a>.</p>											<p class="post-edited">(Last edited by <strong>QAuge</strong> on 4 Jan 2018, 14:30)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p370462">
				<div class="post-metadata">
					<div class="post-num">Post #421</div>
					<div class="post-author">metai</div>
					<div class="post-datetime">
						4 Jan 2018, 18:54					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>QAuge wrote:</cite><blockquote><p>Try this one</p></blockquote></div><p>[Edited most of this post, because some of my assumptions were wrong.]</p><p>Thank you for the links. I found that your guide has quite a few errors, by the way. For example, the Parameter &quot;CountryRegionForABand&quot; should really be &quot;CountryRegionABand&quot; without the &quot;For&quot;. Others are wrongly cased: &quot;HTGI&quot; or &quot;HTBW&quot; should be &quot;HtGi&quot; or &quot;HtBw&quot;. Not that they do much other than not presenting an error.</p><p>So far I have not been able to convince the adapters to do anything but 20 MHz on 2.4GHz and 40 MHz on 5GHz, also I could not switch them into 11ac mode. The adapters&#039; firmware seems to have a mind on its own, with some curious behaviours:</p><p>TKIP as &quot;encryption type&quot; for example fixes the 2.4 GHz adapter to 11g (54 mbit), switching from TKIP to AES immediately upgrades it to 11n. If the 5GHz adapter is set to any channel higher than 48 it takes the better part of a minute to come up. Sometimes, but not always, after a full reboot an uninitialized wl010 shows up as unsecured AP with 40 MHz bandwidth, something I could not make it do using iwpriv configuration. It&#039;s really a curious thing.</p><p>(I have to rely on observation since <em>iwpriv &lt;interface&gt; show</em> is not working and debug output does not travel back to OpenWrt&#039;s dmesg/log.)</p>											<p class="post-edited">(Last edited by <strong>metai</strong> on 10 Jan 2018, 08:38)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p370696">
				<div class="post-metadata">
					<div class="post-num">Post #422</div>
					<div class="post-author">scapi</div>
					<div class="post-datetime">
						9 Jan 2018, 18:53					</div>
				</div>
				<div class="post-content content">
					<p>@QAuge Can You explain how did You build recovery image ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p370730">
				<div class="post-metadata">
					<div class="post-num">Post #423</div>
					<div class="post-author">xicoyihl</div>
					<div class="post-datetime">
						10 Jan 2018, 17:59					</div>
				</div>
				<div class="post-content content">
					<p>@metai<br />It would be really awesome if you could help to bring the EasyBox 904 xDSL support to mainline Openwrt. Could you maybe already make the PullRequests for&nbsp; those speling fixes you have find?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p370731">
				<div class="post-metadata">
					<div class="post-num">Post #424</div>
					<div class="post-author">metai</div>
					<div class="post-datetime">
						10 Jan 2018, 18:06					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>xicoyihl wrote:</cite><blockquote><p>It would be really awesome if you could help to bring the EasyBox 904 xDSL support to mainline Openwrt.</p></blockquote></div><p>I will happily do my best, but keep in mind &quot;my best&quot; is superficial tinkering with shell scripts at best. I really have no deeper knowledge of how to <em>develop</em> for OpenWrt.</p><p>And as much as I would love mainline support for this device, I also agree with QAuge that mainline support is unlikely, the whole device seems to be one big hack.</p><p>A first step -- and, honestly, good enough for me -- would be &quot;clean&quot; image releases with only the most basic packages. Maybe even one with SMP and one without. At the moment we benefit from the one QAuge compiles for himself, with quite a few packages not everyone needs. But we&#039;re really very much at the grace of QAuge here.</p><div class="quotebox"><blockquote><p>Could you maybe already make the PullRequests for&nbsp; those speling fixes you have find?</p></blockquote></div><p>The spelling mistakes are in the documentation, not in any file.</p><p>What I can, and hopefully will do is publish improvements to the current ralink.sh file so it takes more parameters from /etc/config/wireless (at the moment it doesn&#039;t even take channels). But I&#039;m not quite done with it yet.</p>											<p class="post-edited">(Last edited by <strong>metai</strong> on 10 Jan 2018, 18:08)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p370733">
				<div class="post-metadata">
					<div class="post-num">Post #425</div>
					<div class="post-author">xicoyihl</div>
					<div class="post-datetime">
						10 Jan 2018, 18:11					</div>
				</div>
				<div class="post-content content">
					<p>Some other developers of LEDE/OpenWrt told that mainline OpenWrt is possible.<br />The main reason it does not get merged at the recent state is that the changes QAuge did break the support for other devices. Thats probably the first thing that should be fixed - not breaking support for non-easybox-904-devices.</p>									</div>
			</article>

			
		
						<div class="notice">
				<p>Sorry, posts 426 to 425 are missing from our archive.</p>
			</div>
		
		
	
	<div class="pagination"><div class="pagination-number">Page 17 of 19</div><nav><ul><li><a href="viewtopic.php%3Fid=44676&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=44676&amp;p=15.html">15</a></li><li><a href="viewtopic.php%3Fid=44676&amp;p=16.html">16</a></li><li class="pagination-current"><span>17</span></li><li><a href="viewtopic.php%3Fid=44676&amp;p=18.html">18</a></li><li><a href="viewtopic.php%3Fid=44676&amp;p=19.html">19</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0.001 -->

</body>
</html>