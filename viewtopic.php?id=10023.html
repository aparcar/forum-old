<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> PPPoE passthrough on OpenWRT</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 6 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p45056">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">FluffyRabbit</div>
					<div class="post-datetime">
						23 Mar 2007, 10:13					</div>
				</div>
				<div class="post-content content">
					<p>Hi all,</p><p>I&#039;ve got a Linksys WRT54GL (OpenWRT Rc0.9) connecting in client(bridged) mode to a Netgear DG...</p><p>The Netgear router connects to the internet using its internal pppoe and everything works great. Got 2 clients connected to the Linksys and its all working wonderfully. You might wonder why I&#039;m posting then and here is the crunch. I want to dial up on a seperate pppoe account from the clients. I know this is possible as I&#039;ve done it before through a wired link to a Planet router. We had the router connected on a local-only account and the clients connecting themselves on a different account.</p><p>So it is possible but whenever I try to dial the connection from within Windows it fails on the &quot;Connecting through WAN minport&quot; message. I&#039;m trying to check if the Netgear itself doesn&#039;t allow external pppoe connections through it but from the few posts trying to do this sort of thing it looks like OpenWRT doesn&#039;t support pppoe passthru by default. Does anyone know what packages I need or what configuration I should do to get this to work?</p><p>P.S. Tried RASPPPOE (no joy) and I&#039;d rather not setup the pppoe on the Linksys itself as I still want the wireless interface to bridge like a normal network. My understanding is that setting up pppoe on the wifi interface means it can&#039;t work as a normal interface.</p><p>Thanks in advance</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p45589">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">FluffyRabbit</div>
					<div class="post-datetime">
						31 Mar 2007, 12:09					</div>
				</div>
				<div class="post-content content">
					<p>bump</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p45593">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">mctiew</div>
					<div class="post-datetime">
						31 Mar 2007, 13:09					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>FluffyRabbit wrote:</cite><blockquote><p>bump</p></blockquote></div><p>I am not sure about others, but a network ( ascii ) diagram will certainly help.<br />Too many words and too difficult to understand.</p><p>Cheers.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p45642">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">FluffyRabbit</div>
					<div class="post-datetime">
						1 Apr 2007, 11:20					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for the response.</p><p>Here&#039;s a quick diagram</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Wired&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Wireless&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />PCs ----------------Client Mode Bridge(OpenWRT)----------------AP(OpenWRT)-----------------NetGear (modem)</p><p>The AP creates a pppoe connection through the netgear with no problems but I need to setup a seperate pppoe connection terminated on the clients (PCs). </p><p>Since I posted I&#039;ve got pppoe-relay working passing packets from the bridge to the AP. <br />On the AP&nbsp; someting funny happens as pppoe-relay won&#039;t relay the packets onto the wan interface. <br />Not sure if you can relay twice like that.</p><p>At the moment might consider setting up 2 pppoe connections on the AP and just do some selective iptables routing.</p><p>Ta</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p45645">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">mctiew</div>
					<div class="post-datetime">
						1 Apr 2007, 12:18					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>FluffyRabbit wrote:</cite><blockquote><p>Here&#039;s a quick diagram</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Wired&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Wireless&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />PCs ----------------Client Mode Bridge(OpenWRT)----------------AP(OpenWRT)-----------------NetGear (modem)</p></blockquote></div><p>If I understand correctly, you have a bridge bridging the wired network ( on the PC side ) and the wireless network.</p><p>However on the AP, you will still have two distinct interfaces, ie the wireless LAN and the WAN interface and therefore packets will be routed ( instead of bridged ). PPPOE will not pass through.</p><p>Did you also bridge the wireless LAN to the WAN interface on the AP ?</p><p>Cheers.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p45683">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">FluffyRabbit</div>
					<div class="post-datetime">
						2 Apr 2007, 10:07					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>You&#039;re right. The WAN and Lan segments on the AP are not bridged at the moment. </p><p>The bridging actually still doesn&#039;t repeat pppoe packets. I&#039;m not sure why but<br />I had to get pppoe-relay running on the Bridge router before I could get them to the AP.</p><p>I tried to use pppoe-relay again on the AP but couldn&#039;t get any packets to show on the wan interface.</p><p>At the moment I&#039;m trying to tackle it from a slightly different approach. Setting up 2 ppp connections on the<br />AP and then just routing according the ips but I&#039;d still like to know why this isn&#039;t working.</p><p>I think that pppoe-relay doesn&#039;t allow multiple relays or maybe a normal modem won&#039;t recognise pppoe-relay packets<br />as some additional info is added to the packet header.</p><p>On another Note:<br />The 2 pppoe connection setup isn&#039;t going that well either <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> I don&#039;t really understand the structure of the ifup.pppoe file so I don&#039;t know how to make it setup 2 different connections with different settings. Tried just repeating the call to pppd at the bottom of the file but no joy.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p45685">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">mctiew</div>
					<div class="post-datetime">
						2 Apr 2007, 11:00					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>FluffyRabbit wrote:</cite><blockquote><p>The bridging actually still doesn&#039;t repeat pppoe packets. I&#039;m not sure why but<br />I had to get pppoe-relay running on the Bridge router before I could get them to the AP.</p></blockquote></div><p>Really ? That&#039;s new to me. Any reason why it should not go through ? Did you load the pppoe kernel module ? It&#039;s my understanding the you should be able to bridge pppoe packets over a bridge.</p><div class="quotebox"><cite>FluffyRabiit wrote:</cite><blockquote><p>I tried to use pppoe-relay again on the AP but couldn&#039;t get any packets to show on the wan interface.</p></blockquote></div><p>How did you arrive at this conclusion ? Did you do traffic sniffing ? Did the PPPOE packet arrive at the incoming interface at all ?</p><p>Maybe just for the sake of getting to the bottom of things, you might want to stop the original PPPOE session on the AP. It&#039;s my understanding that some modem only allow single PPPOE session. Try to find out if it is possible to get one PPPOE session from the PC, bridged and then pppoe-relayed into the WAN.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p45696">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">FluffyRabbit</div>
					<div class="post-datetime">
						2 Apr 2007, 13:37					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>mctiew wrote:</cite><blockquote><p>Really ? That&#039;s new to me. Any reason why it should not go through ? Did you load the pppoe kernel module ? It&#039;s my understanding the you should be able to bridge pppoe packets over a bridge.</p></blockquote></div><p>I also thought it was odd. As for loading the pppoe kernel module I&#039;m running Russian 0.9 and pppoe is installed by default from what I can tell. </p><div class="quotebox"><cite>mctiew wrote:</cite><blockquote><p>How did you arrive at this conclusion ? Did you do traffic sniffing ? Did the PPPOE packet arrive at the incoming interface at all ?</p></blockquote></div><p>I have been using tcpdump to pick up the PADI packets. Until I setup pppoe-relay on the bridge they didn&#039;t appear on the eth1 interface of the AP. However, when using pppoe-relay on the AP to pass them to the wan interface they didn&#039;t appear at all. Fiddled with a whole bunch of different configurations but that was the closest I got. I think pppoe-relay doesn&#039;t work when its done 2 to the same packets.</p><div class="quotebox"><cite>mctiew wrote:</cite><blockquote><p>Maybe just for the sake of getting to the bottom of things, you might want to stop the original PPPOE session on the AP. It&#039;s my understanding that some modem only allow single PPPOE session. Try to find out if it is possible to get one PPPOE session from the PC, bridged and then pppoe-relayed into the WAN.</p></blockquote></div><p>That might be the case but until the packets are being sent out on the wan interface from the AP the modem has nothing to do with it yet. I might try it just to be sure but if that is the case it doesn&#039;t help me as I still need the AP to create its own pppoe session. </p><p>As I mentioned in my previous message I&#039;m now setting up the AP to create 2 seperate pppoe connections itself and then route the traffic from the client through the second pppoe connection (ppp1).</p><p>Any ideas on how to configure the scripts to initiate 2 sessions like that.</p><p>Thanks for your help by the way.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p46664">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">mesher</div>
					<div class="post-datetime">
						18 Apr 2007, 21:44					</div>
				</div>
				<div class="post-content content">
					<p>The right way to do this is to split the wifi part from the bridge, then use pppoe-relay (from raspppoe) to relay traffic between the intefaces. Wifi will have to join the AP in client mode and all will work properly.</p><p>The reason why wet does not work is because wet on the broadcom platform is implemented via proxy-arp and this will &quot;nat&quot; all ethernet addresses behind the bridge. This is ok for IP traffic but very bad for pppoe.</p><p>Now... if someone could make a pppoe-relay ipk :-)</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>