<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Accessing 2nd serial with microcom freezes Asus WL-500gP (WR 0.9)</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 12 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p49324">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">stb</div>
					<div class="post-datetime">
						29 May 2007, 21:42					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>I&#039;m trying to hook a cheap 20x4 LCD up to the second serial port of my Asus WL-500g Premium. Hardware-wise, this appears to be working, but the router freezes as soon as I send a character down the line. Sometimes, that character shows up, sometimes not.</p><p>I&#039;m still waiting for my USB-to-serial cable to arrive, so I can&#039;t see the serial console. When frozen, the system does not answer pings, and doesn&#039;t recover by itself within 5 minutes.</p><p>I&#039;m invoking &quot;microcom -D/dev/cua/1&quot;.</p><p>Here&#039;s a dmesg, if that is helpful:</p><div class="codebox"><pre><code>CPU revision is: 00029006
Primary instruction cache 16kB, physically tagged, 2-way, linesize 16 bytes.
Primary data cache 16kB, 2-way, linesize 16 bytes.
Linux version 2.4.30 (nbd@ds10) (gcc version 3.4.4 (OpenWrt-1.0)) #1 Sat Feb 3 13:16:08 CET 2007
Setting the PFC value as 0x15
Determined physical RAM map:
 memory: 02000000 @ 00000000 (usable)
On node 0 totalpages: 8192
zone(0): 8192 pages.
zone(1): 0 pages.
zone(2): 0 pages.
Kernel command line: root=/dev/mtdblock2 rootfstype=squashfs,jffs2 init=/etc/preinit noinitrd console=ttyS0,115200
CPU: BCM4704 rev 9 at 264 MHz
Using 132.000 MHz high precision timer.
Calibrating delay loop... 263.78 BogoMIPS
Memory: 30436k/32768k available (1455k kernel code, 2332k reserved, 104k data, 80k init, 0k highmem)
Dentry cache hash table entries: 4096 (order: 3, 32768 bytes)
Inode cache hash table entries: 2048 (order: 2, 16384 bytes)
Mount cache hash table entries: 512 (order: 0, 4096 bytes)
Buffer cache hash table entries: 1024 (order: 0, 4096 bytes)
Page-cache hash table entries: 8192 (order: 3, 32768 bytes)
Checking for &#039;wait&#039; instruction...  unavailable.
POSIX conformance testing by UNIFIX
PCI: Fixing up bus 0
PCI: Fixing up bridge
PCI: Setting latency timer of device 01:00.0 to 64
PCI: Fixing up bus 1
Linux NET4.0 for Linux 2.4
Based upon Swansea University Computer Society NET3.039
Initializing RT netlink socket
Starting kswapd
Registering mini_fo version $Id$
devfs: v1.12c (20020818) Richard Gooch (rgooch@atnf.csiro.au)
devfs: boot_options: 0x1
JFFS2 version 2.1. (C) 2001 Red Hat, Inc., designed by Axis Communications AB.
Squashfs 2.1-r2 (released 2004/12/15) (C) 2002-2004 Phillip Lougher
pty: 256 Unix98 ptys configured
Serial driver version 5.05c (2001-07-08) with MANY_PORTS SHARE_IRQ SERIAL_PCI enabled
ttyS00 at 0xb8000300 (irq = 3) is a 16550A
ttyS01 at 0xb8000400 (irq = 0) is a 16550A
b44.c:v0.93 (Mar, 2004)
PCI: Setting latency timer of device 00:01.0 to 64
eth0: Broadcom 47xx 10/100BaseT Ethernet 00:1a:92:7e:62:d5
PCI: Setting latency timer of device 00:02.0 to 64
eth1: Broadcom 47xx 10/100BaseT Ethernet 40:10:18:00:00:2d
Physically mapped flash: Found an alias at 0x800000 for the chip at 0x0
Physically mapped flash: Found an alias at 0x1000000 for the chip at 0x0
Physically mapped flash: Found an alias at 0x1800000 for the chip at 0x0
 Amd/Fujitsu Extended Query Table v1.3 at 0x0040
number of CFI chips: 1
cfi_cmdset_0002: Disabling fast programming due to code brokenness.
Flash device: 0x800000 at 0x1c000000
bootloader size: 262144
Physically mapped flash: Filesystem type: squashfs, size=0xc463e
Creating 5 MTD partitions on &quot;Physically mapped flash&quot;:
0x00000000-0x00040000 : &quot;cfe&quot;
0x00040000-0x007f0000 : &quot;linux&quot;
0x000be400-0x00190000 : &quot;rootfs&quot;
mtd: partition &quot;rootfs&quot; doesn&#039;t start on an erase block boundary -- force read-only
0x007f0000-0x00800000 : &quot;nvram&quot;
0x00190000-0x007f0000 : &quot;OpenWrt&quot;
Initializing Cryptographic API
NET4: Linux TCP/IP 1.0 for NET4.0
IP Protocols: ICMP, UDP, TCP, IGMP
IP: routing cache hash table of 512 buckets, 4Kbytes
TCP: Hash tables configured (established 2048 bind 4096)
ip_conntrack version 2.1 (5953 buckets, 5953 max) - 332 bytes per conntrack
ip_tables: (C) 2000-2002 Netfilter core team
NET4: Unix domain sockets 1.0/SMP for Linux NET4.0.
NET4: Ethernet Bridge 008 for NET4.0
802.1Q VLAN Support v1.8 Ben Greear &lt;greearb@candelatech.com&gt;
All bugs added by David S. Miller &lt;davem@redhat.com&gt;
VFS: Mounted root (squashfs filesystem) readonly.
Mounted devfs on /dev
Freeing unused kernel memory: 80k freed
Algorithmics/MIPS FPU Emulator v1.5
diag: Detected &#039;ASUS WL-500g Premium&#039;
Probing device eth0: found!
b44: eth0: Link is up at 100 Mbps, full duplex.
b44: eth0: Flow control is off for TX and off for RX.
mini_fo: using base directory: /
mini_fo: using storage directory: /jffs
jffs2.bbc: SIZE compression mode activated.
PCI: Setting latency timer of device 01:02.0 to 64
PCI: Enabling device 01:02.0 (0004 -&gt; 0006)
eth2: Broadcom BCM4318 802.11 Wireless Controller 3.90.37.0
BFL_ENETADM not set in boardflags. Use force=1 to ignore.
usb.c: registered new driver usbdevfs
usb.c: registered new driver hub
SCSI subsystem driver Revision: 1.00
Initializing USB Mass Storage driver...
usb.c: registered new driver usb-storage
USB Mass Storage support registered.
uhci.c: USB Universal Host Controller Interface driver v1.1
PCI: Enabling device 01:03.0 (0000 -&gt; 0001)
uhci.c: USB UHCI at I/O 0x100, IRQ 2
usb.c: new USB bus registered, assigned bus number 1
hub.c: USB hub found
hub.c: 2 ports detected
PCI: Enabling device 01:03.1 (0000 -&gt; 0001)
uhci.c: USB UHCI at I/O 0x120, IRQ 2
usb.c: new USB bus registered, assigned bus number 2
hub.c: USB hub found
hub.c: 2 ports detected
PCI: Enabling device 01:03.2 (0000 -&gt; 0002)
ehci_hcd 01:03.2: PCI device 1106:3104
ehci_hcd 01:03.2: irq 2, pci mem c019f000
usb.c: new USB bus registered, assigned bus number 3
EHCI: Enabling VIA 6212 workarounds
ehci_hcd 01:03.2: USB 2.0 enabled, EHCI 1.00, driver 2003-Dec-29/2.4
hub.c: USB hub found
hub.c: 4 ports detected
device eth0 entered promiscuous mode
b44: eth0: Link is up at 100 Mbps, full duplex.
b44: eth0: Flow control is off for TX and off for RX.
vlan0: add 01:00:5e:00:00:01 mcast address to master interface
vlan0: dev_set_promiscuity(master, 1)
vlan0: dev_set_allmulti(master, 1)
device eth2 entered promiscuous mode
eth2: attempt to add interface with same source address.
br0: port 2(eth2) entering listening state
br0: port 1(vlan0) entering listening state
br0: port 2(eth2) entering learning state
br0: port 2(eth2) entering forwarding state
br0: topology change detected, propagating
br0: port 1(vlan0) entering learning state
br0: port 1(vlan0) entering forwarding state
br0: topology change detected, propagating
vlan1: add 01:00:5e:00:00:01 mcast address to master interface</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p49360">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">stb</div>
					<div class="post-datetime">
						30 May 2007, 10:59					</div>
				</div>
				<div class="post-content content">
					<p>I was able to check a few more things: another Asus WL-500gP also freezes when using microcom on the second serial port (this one not opened, just WR 0.9 installed), while on a WRT54GL it works flawlessly. So I don&#039;t think it&#039;s a hardware issue with my router, but a more general initialization issue.</p><p>I&#039;m hoping my serial adapter arrives soon.&nbsp; I&#039;ll try installing kamikaze tonight to see if that makes a difference.</p>											<p class="post-edited">(Last edited by <strong>stb</strong> on 30 May 2007, 11:00)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p49364">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">forum2006</div>
					<div class="post-datetime">
						30 May 2007, 11:53					</div>
				</div>
				<div class="post-content content">
					<p>have you played with <strong>setserial</strong> to configure the seconed serial port?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p49408">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">stb</div>
					<div class="post-datetime">
						31 May 2007, 00:16					</div>
				</div>
				<div class="post-content content">
					<p>Ok, got my serial cable on the first port working.</p><p>I tried playing with setserial, but everything I tried also caused a freeze.</p><p>When the freeze happens, nothing shows on the serial console :-( except for the usual warning<br /></p><div class="codebox"><pre><code>tty_io.c: process 679 (sc) used obsolete /dev/cua/1 - update software to use /dev/ttyS1</code></pre></div><p>If I exit from the terminal program before sending anything, the router keeps working fine. I&#039;ll try Kamikaze next.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p49412">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">stb</div>
					<div class="post-datetime">
						31 May 2007, 01:55					</div>
				</div>
				<div class="post-content content">
					<p>Solution:<br /></p><div class="codebox"><pre><code>setserial /dev/cua/1 irq 3</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p49489">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">C4Vette</div>
					<div class="post-datetime">
						1 Jun 2007, 08:34					</div>
				</div>
				<div class="post-content content">
					<p>This is a very nice addition to the box I was thinking about myself. Can you tell us what hardware (LCD-display, controller) you used. What did you use to connect the display to the Asus? A 1-wire solution and/or a rs232-converter? My Asus is still on order but I have already a serial cable from a mobile-phone I hope to use by connecting it directy to the systemboard. Any suggestions?</p><p>greetings from the Netherlands</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p49534">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">stb</div>
					<div class="post-datetime">
						1 Jun 2007, 18:46					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>C4Vette wrote:</cite><blockquote><p>Can you tell us what hardware (LCD-display, controller) you used. What did you use to connect the display to the Asus? A 1-wire solution and/or a rs232-converter? My Asus is still on order but I have already a serial cable from a mobile-phone I hope to use by connecting it directy to the systemboard. Any suggestions?</p></blockquote></div><p><a href="http://www.roboter-teile.de/Shop/themes/kategorie/detail.php?artikelid=40&amp;source=2">This</a> is the display I got. It has a serial mode (9600 8N1) with TTL levels and runs on 5V.&nbsp; I soldered it to the main voltage regulator near the power jack, and soldered the rx and tx lines to the second serial port.</p><p>Both Matrix Orbital and CrystalFontz offer displays with serial interface and TTL levels, which tend to work without problems with the 3.3V levels the router uses.</p><p>For the serial console, I soldered a 2.5mm stereo headphone jack to the first serial port, and modified a Siemens S45 USB cable to connect to that (got that <a href="http://www.hot-wire-telekom.de/index.php?aktion=detail&amp;suche=Siemens%20S45(i)&amp;asuche=HW130386">here</a>).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p49556">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">stb</div>
					<div class="post-datetime">
						2 Jun 2007, 01:06					</div>
				</div>
				<div class="post-content content">
					<p>At least with my cheap display, sending largish amounts of data to the display will make the display lose sync with the sender, and garbage being displayed. I suspect that a level shifter might be necessary. I&#039;ll either add a simple &#039;04 or &#039;00, or a discrete pnp next week.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p49582">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">C4Vette</div>
					<div class="post-datetime">
						2 Jun 2007, 20:07					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for the info and pls keep us posted. Mine (WL-500 gP) has arrived and after a little looking around in the default firmware it will be replaced with OpenWrt; what else :-)<br />Next step will be OWFS for the 1-wire hardware which should be in the mail already. The first serial port will be reserved as a &#039;console&#039;-port and the second will be used for the 1-wire bus-master. One USB-port will be used for a 1 Gb flash-disk; hopefully I can use one of the two unused ones directy on the VIA-chip so the &#039;flash-disk&#039; will remain inside the box. It will hold the /opt dir and maybe more.<br />The LCD will probably be one directly on the 1-wire bus or maybe an USB-version. Or your solution but then on the first serial port. I&#039;ve read somewhere that it can be configured as a standard port other then &#039;console&#039;. Still has to be decided, there are first some configuration &#039;problems&#039; to be solved. I would like to use the wifi as a bridge to another AP but not sure if this is possible and that takes us to far off-(your)topic.</p>											<p class="post-edited">(Last edited by <strong>C4Vette</strong> on 2 Jun 2007, 20:09)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>