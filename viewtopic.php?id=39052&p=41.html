<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> mwan3; multi-wan policy routing (general topic)</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 22 May 2013 and 6 May 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 41 of 65</div><nav><ul><li><a href="viewtopic.php%3Fid=39052&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=39.html">39</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=40.html">40</a></li><li class="pagination-current"><span>41</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=42.html">42</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=43.html">43</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=65.html">65</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p254498">
				<div class="post-metadata">
					<div class="post-num">Post #1001</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						16 Nov 2014, 04:31					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>JohnV wrote:</cite><blockquote><p>Quick update, the changes seem to work at first testing.&nbsp; I am doing more work with it so will post an update shortly.</p></blockquote></div><p>Would you mind updating the mwan3 wiki with the NDS information when done?</p>											<p class="post-edited">(Last edited by <strong>arfett</strong> on 16 Nov 2014, 04:31)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p254592">
				<div class="post-metadata">
					<div class="post-num">Post #1002</div>
					<div class="post-author">JohnV</div>
					<div class="post-datetime">
						17 Nov 2014, 04:44					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>arfett wrote:</cite><blockquote><p>Would you mind updating the mwan3 wiki with the NDS information when done?</p></blockquote></div><br /><p>I tried to register to to edit the Wiki, it seems to be having issues.&nbsp; Here is the text if you can update the Wiki since I cant seem to register right now.</p><br /><br /><p>- Compatibility with NoDogSplash captive portal</p><p>NoDogSplash, by default, uses the same bits as MWAN3 to mark traffic in iptables.&nbsp; Because of this, NoDogSplash will not work with the default configuration file that is installed.&nbsp; You can modify the bits that are used by NoDogSplash easily by adding a few lines to the /etc/nodogsplash/nodogsplash.conf file:</p><div class="codebox"><pre><code># Change the default marking flags to work with MWAN3 and QOS
FW_MARK_AUTHENTICATED 17
FW_MARK_TRUSTED 18
FW_MARK_BLOCKED 19</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p254762">
				<div class="post-metadata">
					<div class="post-num">Post #1003</div>
					<div class="post-author">squallpolska</div>
					<div class="post-datetime">
						18 Nov 2014, 12:47					</div>
				</div>
				<div class="post-content content">
					<p>Can you help me? How can I disable failover? I have two interfaces: wan and wan2. I want to connect through wan only with two IP addresses. With the rest IP adress only through wan address. </p><p>Everything works until both interfaces work. When one interface is down the second ignores the policy and connects to each IP address. How to fix it? This is my config:</p><div class="codebox"><pre><code>config interface &#039;wan&#039;
        option enabled &#039;1&#039;

config interface &#039;wan2&#039;
        option enabled &#039;1&#039;

config member &#039;wan_m1_w3&#039;
        option interface &#039;wan&#039;
        option metric &#039;1&#039;
        option weight &#039;2&#039;

config member &#039;wan2_m1_w2&#039;
        option interface &#039;wan2&#039;
        option metric &#039;1&#039;
        option weight &#039;2&#039;

config policy &#039;wan_only&#039;
        list use_member &#039;wan_m1_w3&#039;

config policy &#039;wan2_only&#039;
        list use_member &#039;wan2_m1_w2&#039;

config rule &#039;shar1&#039;
        option dest_ip &#039;here is ip adress&#039;
        option use_policy &#039;wan2_only&#039;

config rule &#039;shar2&#039;
        option dest_ip &#039;here is ip adress&#039;
        option use_policy &#039;wan2_only&#039;

config rule &#039;default_rule&#039;
        option dest_ip &#039;0.0.0.0/0&#039;
        option use_policy &#039;wan_only&#039;</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p254767">
				<div class="post-metadata">
					<div class="post-num">Post #1004</div>
					<div class="post-author">biatche</div>
					<div class="post-datetime">
						18 Nov 2014, 13:51					</div>
				</div>
				<div class="post-content content">
					<p>Is it possible to route 8.8.4.4 DNS to WAN2 only?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p254775">
				<div class="post-metadata">
					<div class="post-num">Post #1005</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						18 Nov 2014, 14:44					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>squallpolska wrote:</cite><blockquote><p>Everything works until both interfaces work. When one interface is down the second ignores the policy and connects to each IP address. How to fix it?</p></blockquote></div><p>If you don&#039;t need failover, you don&#039;t need mwan3. You can just use two static routes and one deafult route..</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p254776">
				<div class="post-metadata">
					<div class="post-num">Post #1006</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						18 Nov 2014, 14:45					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>biatche wrote:</cite><blockquote><p>Is it possible to route 8.8.4.4 DNS to WAN2 only?</p></blockquote></div><p>Yes</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p254780">
				<div class="post-metadata">
					<div class="post-num">Post #1007</div>
					<div class="post-author">squallpolska</div>
					<div class="post-datetime">
						18 Nov 2014, 15:24					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><p>If you don&#039;t need failover, you don&#039;t need mwan3. You can just use two static routes and one deafult route..</p></blockquote></div><p>Could you write a how to do it? I do not know much about it ...</p>											<p class="post-edited">(Last edited by <strong>squallpolska</strong> on 18 Nov 2014, 15:30)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p254782">
				<div class="post-metadata">
					<div class="post-num">Post #1008</div>
					<div class="post-author">biatche</div>
					<div class="post-datetime">
						18 Nov 2014, 16:00					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><div class="quotebox"><cite>biatche wrote:</cite><blockquote><p>Is it possible to route 8.8.4.4 DNS to WAN2 only?</p></blockquote></div><p>Yes</p></blockquote></div><p>Should I use mwan3 rules to configure this or static route?</p><p>I do not want 8.8.4.4 pingable even if WAN2 is down.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p254795">
				<div class="post-metadata">
					<div class="post-num">Post #1009</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						18 Nov 2014, 17:23					</div>
				</div>
				<div class="post-content content">
					<p>I would suggest a mwan3 rule.</p>											<p class="post-edited">(Last edited by <strong>Adze</strong> on 18 Nov 2014, 20:47)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p254995">
				<div class="post-metadata">
					<div class="post-num">Post #1010</div>
					<div class="post-author">biatche</div>
					<div class="post-datetime">
						20 Nov 2014, 11:39					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><p>I would suggest a mwan3 rule.</p></blockquote></div><div class="codebox"><pre><code>config rule &#039;dnsstatic&#039;
        option dest_ip &#039;8.8.4.4&#039;
        option dest_port &#039;53&#039;
        option proto &#039;udp&#039;
        option use_policy &#039;wan2_only&#039;</code></pre></div><p>This rule is at the top above all else. Is this correct?</p><p>Pinging 8.8.4.4 still seem to go through &quot;wan&quot; instead of &quot;wan2&quot;.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p254997">
				<div class="post-metadata">
					<div class="post-num">Post #1011</div>
					<div class="post-author">biatche</div>
					<div class="post-datetime">
						20 Nov 2014, 11:48					</div>
				</div>
				<div class="post-content content">
					<p>Another question:</p><p>I&#039;ve been using this as my default rule for a long time.. and just noticed in wiki it&#039;s different</p><div class="codebox"><pre><code>config rule &#039;allelse&#039;                 
        option use_policy &#039;wan1pri_wan2sec&#039;</code></pre></div><p>wiki:</p><div class="codebox"><pre><code>config rule &#039;default_rule&#039;
        option dest_ip &#039;0.0.0.0/0&#039;
        option use_policy &#039;balanced&#039;</code></pre></div><p>Is dest_ip 0.0.0.0/0 necessary for rules to work properly? I have some rules that don&#039;t contain ip, just ports.</p><p>Is it ok to go without dest_ip?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p254998">
				<div class="post-metadata">
					<div class="post-num">Post #1012</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						20 Nov 2014, 11:55					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>biatche wrote:</cite><blockquote><div class="quotebox"><cite>Adze wrote:</cite><blockquote><p>I would suggest a mwan3 rule.</p></blockquote></div><div class="codebox"><pre><code>config rule &#039;dnsstatic&#039;
        option dest_ip &#039;8.8.4.4&#039;
        option dest_port &#039;53&#039;
        option proto &#039;udp&#039;
        option use_policy &#039;wan2_only&#039;</code></pre></div><p>This rule is at the top above all else. Is this correct?</p><p>Pinging 8.8.4.4 still seem to go through &quot;wan&quot; instead of &quot;wan2&quot;.</p></blockquote></div><p>You set a rule for upd port 53 traffic and you wonder why icmp traffic still goes through wan? I think you will be able to figure this one out yourself...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p255020">
				<div class="post-metadata">
					<div class="post-num">Post #1013</div>
					<div class="post-author">biatche</div>
					<div class="post-datetime">
						20 Nov 2014, 14:42					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><div class="quotebox"><cite>biatche wrote:</cite><blockquote><div class="quotebox"><cite>Adze wrote:</cite><blockquote><p>I would suggest a mwan3 rule.</p></blockquote></div><div class="codebox"><pre><code>config rule &#039;dnsstatic&#039;
        option dest_ip &#039;8.8.4.4&#039;
        option dest_port &#039;53&#039;
        option proto &#039;udp&#039;
        option use_policy &#039;wan2_only&#039;</code></pre></div><p>This rule is at the top above all else. Is this correct?</p><p>Pinging 8.8.4.4 still seem to go through &quot;wan&quot; instead of &quot;wan2&quot;.</p></blockquote></div><p>You set a rule for upd port 53 traffic and you wonder why icmp traffic still goes through wan? I think you will be able to figure this one out yourself...</p></blockquote></div><p>Yeah not too sure what I was thinking either...</p><p>Anyway I think it&#039;s fixed. Thanks!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p255047">
				<div class="post-metadata">
					<div class="post-num">Post #1014</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						20 Nov 2014, 18:59					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>biatche wrote:</cite><blockquote><p>Is dest_ip 0.0.0.0/0 necessary for rules to work properly? I have some rules that don&#039;t contain ip, just ports.</p><p>Is it ok to go without dest_ip?</p></blockquote></div><p>It should be fine without the destination IP set. 0.0.0.0/0 is assumed if nothing is entered there.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p255091">
				<div class="post-metadata">
					<div class="post-num">Post #1015</div>
					<div class="post-author">biatche</div>
					<div class="post-datetime">
						21 Nov 2014, 10:54					</div>
				</div>
				<div class="post-content content">
					<p>Have you guys heard of any strange behavior when you have 2 pppoe wan?</p><p>With 14.07 (unsure about 12.04 still) wan2 (pppoe) will have difficulty connecting... example PADO timeout, ive seen other error messages too. Once connected itll stay connected for 1-3 minutes at most before disconnecting. During this connection period, ping timeout requests are just too many.. 80% and then it&#039;ll disconnect and once again finds difficulty connecting back.</p><p>To test this further, I setup another openwrt router to host one pppoe connection for this &#039;wan2&#039; line which connects without any issues. (was unable to test 2 concurrent wans at this period.. might do so tomorrow)</p><p>Furthermore, my wan1 seem to disconnect quite frequently, maybe once every 1-2 hours. Not sure if this is 14.07 related since just before upgrading I had not been monitoring outages often...</p><p>Maybe someone here might have heard/seen something about this somewhere...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p255347">
				<div class="post-metadata">
					<div class="post-num">Post #1016</div>
					<div class="post-author">Usi</div>
					<div class="post-datetime">
						24 Nov 2014, 03:18					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>First things first. Thank you for the time and effort you&#039;ve put into making this package, it&#039;s definitely top notch stuff!</p><p>BTW.:I&#039;m a complete rookie, so please bear with me. It&#039;s also my first post here.</p><br /><p>I&#039;m using OpenWrt BB 14.07 on TP-LINK TL-WDR4300 v1.7.</p><p>I have two separate internet connections from the same ISP.</p><p>modem and modem2 are connected via. cat6 cables to the wdr4300 in bridge mode.</p><p>After configuring Vlan ports, i&#039;ve created two separate interfaces on the WDR4300, wan and wan2. The interfaces connect to the internet via. PPPoE, and I get a static public ip each, on both interfaces.<br />wan&nbsp; &nbsp;= 182.180.162.210/32<br />wan2 = 182.180.162.212/32</p><p>I&#039;m perfectly load-balancing and everything works beautifully.</p><p>The question which I want to ask:</p><p>When I surf the internet, or maybe download something, anything really; I&#039;ve noticed my external IP is changing all the time, sometimes I&#039;m using 182.180.162.210 other times 182.180.162.212.</p><p>Is it possible to configure something, so I only use one of the external IP&#039;s, either 210 or 212 and still be able to load-balance?</p><p>I&#039;ve tried on my own for several hours, but the thing is, I don&#039;t know where to start looking.</p><p>I can provide any information needed.</p><p>A helping hand please <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Thanks in advance, any help would be highly appreciated.</p><p>Kind Regards,<br />M. Usman</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p255349">
				<div class="post-metadata">
					<div class="post-num">Post #1017</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						24 Nov 2014, 03:42					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Usi wrote:</cite><blockquote><p>I&#039;ve tried on my own for several hours, but the thing is, I don&#039;t know where to start looking.</p></blockquote></div><p><a href="http://wiki.openwrt.org/doc/howto/mwan3">http://wiki.openwrt.org/doc/howto/mwan3</a><br /><a href="http://ofmodemsandmen.com/multiweb.html">http://ofmodemsandmen.com/multiweb.html</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p255355">
				<div class="post-metadata">
					<div class="post-num">Post #1018</div>
					<div class="post-author">Usi</div>
					<div class="post-datetime">
						24 Nov 2014, 05:06					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>arfett wrote:</cite><blockquote><div class="quotebox"><cite>Usi wrote:</cite><blockquote><p>I&#039;ve tried on my own for several hours, but the thing is, I don&#039;t know where to start looking.</p></blockquote></div><p><a href="http://wiki.openwrt.org/doc/howto/mwan3">http://wiki.openwrt.org/doc/howto/mwan3</a><br /><a href="http://ofmodemsandmen.com/multiweb.html">http://ofmodemsandmen.com/multiweb.html</a></p></blockquote></div><p>I&#039;ve looked at the 2nd link you&#039;ve provided: <a href="http://ofmodemsandmen.com/multiweb.html">http://ofmodemsandmen.com/multiweb.html</a><br />Every information the link states I understood, and my mwan3 configuration is setup properly with wan#1 having the higher precedence when load-balancing. But still I don&#039;t get to keep the wan#1 external ip 182.180.162.210.</p><p>I&#039;ve also tried adding a rule like rule#3 showed in the 2nd link at the bottom, but still without success.<br /></p><div class="codebox"><pre><code>config rule &#039;test&#039;
    option proto &#039;all&#039;
    option use_policy &#039;wan_only&#039;
    option src_ip &#039;182.180.162.212/32&#039;</code></pre></div><p>EDIT: I&#039;m actually getting some hits on this rule, but don&#039;t know what that means.</p><br /><p>In the first link: <a href="http://wiki.openwrt.org/doc/howto/mwan3">http://wiki.openwrt.org/doc/howto/mwan3</a><br />Am i supposed to look at SNAT?</p>											<p class="post-edited">(Last edited by <strong>Usi</strong> on 24 Nov 2014, 05:25)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p255375">
				<div class="post-metadata">
					<div class="post-num">Post #1019</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						24 Nov 2014, 10:48					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Usi wrote:</cite><blockquote><p>When I surf the internet, or maybe download something, anything really; I&#039;ve noticed my external IP is changing all the time, sometimes I&#039;m using 182.180.162.210 other times 182.180.162.212.</p><p>Is it possible to configure something, so I only use one of the external IP&#039;s, either 210 or 212 and still be able to load-balance?</p></blockquote></div><p>Yes and No...</p><p>You cannot load-balance one LAN client and have only one public ip. It is either load-balance and multiple external ip&#039;s, or active-failover. You can however (if you have multiple LAN clients) have each client load-balance to the internet and each client will have it&#039;s own external ip address. The default mwan3 configuration has an example for tcp 443, which does exactly that.</p>											<p class="post-edited">(Last edited by <strong>Adze</strong> on 24 Nov 2014, 21:04)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p255376">
				<div class="post-metadata">
					<div class="post-num">Post #1020</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						24 Nov 2014, 10:49					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Usi wrote:</cite><blockquote><p>I&#039;ve also tried adding a rule like rule#3 showed in the 2nd link at the bottom, but still without success.<br /></p><div class="codebox"><pre><code>config rule &#039;test&#039;
    option proto &#039;all&#039;
    option use_policy &#039;wan_only&#039;
    option src_ip &#039;182.180.162.212/32&#039;</code></pre></div></blockquote></div><p>Use the client LAN ip address as src-Ip and not the WAN address.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p255424">
				<div class="post-metadata">
					<div class="post-num">Post #1021</div>
					<div class="post-author">Usi</div>
					<div class="post-datetime">
						24 Nov 2014, 19:38					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><p>Yes and No...</p><p>You cannot load-balance one LAN client and have only one public ip. It is either load-balance en multiple external ip&#039;s, or active-failover. You can however (if you have multiple LAN clients) have each client load-balance to the internet and each client will have it&#039;s own external ip address. The default mwan3 configuration has an example for tcp 443, which does exactly that.</p></blockquote></div><p>So, if I&#039;ve understood correctly; I cannot load-balance one LAN client, and expect to have only one external ip; But i can add a separate rule for each LAN client (e.g. X client uses wan1, X client uses wan2 and again X client uses wan1 etc. etc.) and like that use both wan1 and wan2, and this should be achievable via. the following e.g. Right?<br /></p><div class="codebox"><pre><code>config rule &#039;test&#039;
option proto &#039;all&#039;
option use_policy &#039;wan_only&#039;
option src_ip &#039;192.168.1.110/24&#039;</code></pre></div><p>But, you&#039;re saying that it&#039;s the sticky_even and sticky_odd that can accomplish that. Now I am completely confused. I don&#039;t understand those two rules sticky_even and sticky_odd.</p><p>Can you guide me a little, I&#039;m still a bit lost.</p><p>Please don&#039;t mind me, I&#039;m new and trying to understand/learn.</p><p>Thanks so much again. So far! It feels great learning.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p255434">
				<div class="post-metadata">
					<div class="post-num">Post #1022</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						24 Nov 2014, 21:29					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Usi wrote:</cite><blockquote><p>So, if I&#039;ve understood correctly; I cannot load-balance one LAN client, and expect to have only one external ip; But i can add a separate rule for each LAN client (e.g. X client uses wan1, X client uses wan2 and again X client uses wan1 etc. etc.) and like that use both wan1 and wan2.</p></blockquote></div><p>^ Yes</p><div class="quotebox"><cite>Usi wrote:</cite><blockquote><p>and this should be achievable via. the following e.g. Right?<br /></p><div class="codebox"><pre><code>config rule &#039;test&#039;
option proto &#039;all&#039;
option use_policy &#039;wan_only&#039;
option src_ip &#039;192.168.1.110/24&#039;</code></pre></div></blockquote></div><p>^ No</p><p>This src_ip should be &#039;192.168.1.110/32&#039;, if it is for one lan client only.</p><p>The policy you have chosen is wan_only. If this wan were to go down, this client will not be able to reach the internet. You should consider a policy with a backup, like &#039;wan_wan2&#039;. But then again you only use one isp, so you should be fine.</p><div class="quotebox"><cite>Usi wrote:</cite><blockquote><p>But, you&#039;re saying that it&#039;s the sticky_even and sticky_odd that can accomplish that. Now I am completely confused. I don&#039;t understand those two rules sticky_even and sticky_odd.</p><p>Can you guide me a little, I&#039;m still a bit lost.</p></blockquote></div><p>The sticky rules can be confusing at first. I will try to explain the sticky_even example rule.</p><p>The proto and port settings need no explanation. The src_ip &#039;0.0.0.0/0.0.0.1&#039; is a bit harder to explain. The first part (0.0.0.0) is the network address, the second part the mask. Mask defines which bits should match the given network address. A mask of 0.0.0.1 means that only the very last bit of an ip address needs to match the configured network address. The last bit in the network address in this example rule is &#039;0&#039;. All the packets that match this rule have the last bit of the source ip address set to zero. TL&#039;DR: source ip addresses that end with 0, 2, 4, 6, or 8.</p><p>The reason i added the two sticky rules to the default mwan3 config is because a lot of https sites (like banking sites) don&#039;t like it when your source ip address changes during your https session. Those two sticky rules create some kind of faked lan_client-wan_address stickiness, so that all https request come from the same wan.</p>											<p class="post-edited">(Last edited by <strong>Adze</strong> on 24 Nov 2014, 21:53)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p255573">
				<div class="post-metadata">
					<div class="post-num">Post #1023</div>
					<div class="post-author">thdyck</div>
					<div class="post-datetime">
						26 Nov 2014, 01:11					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><p>The sticky rules can be confusing at first. I will try to explain the sticky_even example rule.</p><p>The proto and port settings need no explanation. The src_ip &#039;0.0.0.0/0.0.0.1&#039; is a bit harder to explain. The first part (0.0.0.0) is the network address, the second part the mask. Mask defines which bits should match the given network address. A mask of 0.0.0.1 means that only the very last bit of an ip address needs to match the configured network address. The last bit in the network address in this example rule is &#039;0&#039;. All the packets that match this rule have the last bit of the source ip address set to zero. TL&#039;DR: source ip addresses that end with 0, 2, 4, 6, or 8.</p><p>The reason i added the two sticky rules to the default mwan3 config is because a lot of https sites (like banking sites) don&#039;t like it when your source ip address changes during your https session. Those two sticky rules create some kind of faked lan_client-wan_address stickiness, so that all https request come from the same wan.</p></blockquote></div><p>Hi Adze, thanks for this note. I have seen this behavior as well on various sites that use HTTPS. I will be in an authenticated session and using the site normally and then I will suddenly be taken to the site login page for no clear reason. The cause being a source IP change makes sense and the HTTPS rules you describe fixed it.</p><p>I have added a wiki note to highlight this:</p><p><a href="http://wiki.openwrt.org/doc/howto/mwan3#fix.for.load-balancing.https.traffic">http://wiki.openwrt.org/doc/howto/mwan3 … ps.traffic</a></p><p>Regards,<br />Tim Miller Dyck</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p255751">
				<div class="post-metadata">
					<div class="post-num">Post #1024</div>
					<div class="post-author">kartheo</div>
					<div class="post-datetime">
						27 Nov 2014, 16:45					</div>
				</div>
				<div class="post-content content">
					<p>Hope can somebody help me with the dual wan setup.</p><p>I have a clean openwrt install in my tplink 1043nd v2.</p><p>vlan1 is lan ports<br />vlan2 is wan1(eth.0)<br />vlan3 is wan2(eth1.3)</p><p><a href="http://postimg.org/image/m9zresumt/"><span class="postimg"><img src="http://s10.postimg.org/m9zresumt/Screen_Shot_11_27_14_at_04_21_PM.jpg" alt="http://s10.postimg.org/m9zresumt/Screen_Shot_11_27_14_at_04_21_PM.jpg" /></span></a></p><p>Wan1 is a pppoe connection to modem #1<br />wan2 is DHCP connection to modem #2 </p><p>I have made the metric and default gateway settings in every wan connection and my route -n is as follows</p><p><span class="postimg"><img src="http://s27.postimg.org/wkkgluhg3/Screen_Shot_11_27_14_at_04_30_PM.png" alt="PunBB bbcode test" /></span></p><p>Does this look ok? Shouldnt the METRIC in third line be 10 and not 0?(Pppoe-cy)</p><p>Ping from both interfaces work ok.</p><p>I verified the acting routing table and its ok.</p><p>Should i continue to install mwan3?<br />Would it be a problem that the second connection uses dhcp?</p><br /><p>@edit<br />Everything works fine...boths interfaces tracking active. Now my two lines are combined and can have faster download speeds with download manager. </p><p>Now have to make some QoS rules so can have my iptv connection first and then web surfing and last torrent...</p>											<p class="post-edited">(Last edited by <strong>kartheo</strong> on 27 Nov 2014, 17:13)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p255753">
				<div class="post-metadata">
					<div class="post-num">Post #1025</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						27 Nov 2014, 16:49					</div>
				</div>
				<div class="post-content content">
					<p>Hi kartheo,</p><br /><p>eth1.3 and br-lan have the same ip address range. Change your br-lan settings and you are good to go. Everything else looks ok to me. Good luck!</p>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 41 of 65</div><nav><ul><li><a href="viewtopic.php%3Fid=39052&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=39.html">39</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=40.html">40</a></li><li class="pagination-current"><span>41</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=42.html">42</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=43.html">43</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=65.html">65</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0.001 -->

</body>
</html>