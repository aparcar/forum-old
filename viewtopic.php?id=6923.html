<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Buffalo WHR-G54S beyond bricked?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 21 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p32209">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">bluesguy</div>
					<div class="post-datetime">
						17 Aug 2006, 16:09					</div>
				</div>
				<div class="post-content content">
					<p>I just got two new Buffalo WHR-G54S units and installed RC5.&nbsp; Boot_wait is on by default, so tftp&#039;ing the openwrt-brcm-2.4-jffs2-4MB.trx file was not a problem.</p><p>The first unit went fine, and I got everything set up without incident.&nbsp; The second unit was not so good. :-( </p><p>The image transferred fine, I telneted in after the transfer and got the usual OpenWRT &quot;first time&quot; screen.&nbsp; I gave it a &quot;reboot&quot; command to finish off the jffs setup (since it mounts read-only on the first time), and it never rebooted.&nbsp; After a few minutes (around 5?) I pulled the power and plugged it back in, but it never came back up.</p><p>Here&#039;s the symptoms:</p><p>1)&nbsp; All the led&#039;s light up and stay light.&nbsp; &nbsp;For reference, on the other unit they go off when the bootloader starts.<br />2)&nbsp; No response from the tftp server (i.e.&nbsp; either boot_wait isn&#039;t working or the CFE is never starting the tftp server)<br />3)&nbsp; I soldered on a JTAG header and tried to debrick, but the latest version of hairydairymaid&#039;s tool (v4.5) returns all 0&#039;s for the chip-id and says it&#039;s unknown.&nbsp; (FYI - I was using the cheap xilinx style cable that I&#039;ve used on Linksys models previously).&nbsp; I did notice that the flash chip that&#039;s on the board isn&#039;t in the list of chips the debrick tool supports with the /fc option.&nbsp; I don&#039;t have the unit in front of me, but I&#039;ll post the chip part number in a follow-on post later today for reference.<br />4)&nbsp; I even resorted to <a href="http://www.dd-wrt.com/wiki/index.php?title=Recover_from_a_Bad_Flash#Reviving_the_Buffalo_WHR-G54S">trying the crude pin-shorting</a> in a last ditch effort, with no success.</p><p>I&#039;m confused why the initial flash worked (I logged in!), and why it then completely crapped out on reboot since I&#039;ve never seen that behaviour before.&nbsp; I&#039;ll settle for just recovering it though :-)</p><p>Anyone have any other experience debricking one of these or know of any other tools/methods to try?&nbsp; I&#039;m really comfortable with OpenWRT and flashing units, and I&#039;ve run out of ideas on this one.</p><br /><br /><p>Greg</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p32210">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">liquid</div>
					<div class="post-datetime">
						17 Aug 2006, 16:14					</div>
				</div>
				<div class="post-content content">
					<p>I would be willing to bet the serial number on the one that died starts with 7407 and the one that didnt starts with 3407.</p><p>Buffalo changed some stuff on the board... looking into it as we speak.</p><p>We have figured out console on the devices... next is jtag.&nbsp; Have you found any resources that have info on these devices?&nbsp; We had to figure out the pin-outs for serial on our own.</p><p>Tim</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p32212">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">bluesguy</div>
					<div class="post-datetime">
						17 Aug 2006, 16:26					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>liquid wrote:</cite><blockquote><p>I would be willing to bet the serial number on the one that died starts with 7407 and the one that didnt starts with 3407.</p></blockquote></div><p>Interesting data point.&nbsp; I&#039;ll check when I get home and let you know.</p><div class="quotebox"><cite>liquid wrote:</cite><blockquote><p>Have you found any resources that have info on these devices?&nbsp; We had to figure out the pin-outs for serial on our own.</p></blockquote></div><p>No, I just got these, and hadn&#039;t used this brand before, so I hadn&#039;t really looked into it.&nbsp; Guess I need to start researching it now :-)</p><br /><p>Greg</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p32213">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">liquid</div>
					<div class="post-datetime">
						17 Aug 2006, 16:27					</div>
				</div>
				<div class="post-content content">
					<p>I will post the pinouts and some various other information to the wiki later today.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p32237">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">liquid</div>
					<div class="post-datetime">
						17 Aug 2006, 20:09					</div>
				</div>
				<div class="post-content content">
					<p>page updated with bootloader info at:<br /><a href="http://wiki.openwrt.org/OpenWrtDocs/Hardware/Buffalo/WHR-G54S">http://wiki.openwrt.org/OpenWrtDocs/Har â€¦ o/WHR-G54S</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p32239">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">liquid</div>
					<div class="post-datetime">
						17 Aug 2006, 20:49					</div>
				</div>
				<div class="post-content content">
					<p>pinouts for serial:</p><p>1 is TX 7 is Rx<br />2 is PWR 3 is GND</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p32249">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">liquid</div>
					<div class="post-datetime">
						18 Aug 2006, 00:26					</div>
				</div>
				<div class="post-content content">
					<p>bluesguy: see this changeset... <a href="https://dev.openwrt.org/changeset/4585">https://dev.openwrt.org/changeset/4585</a></p><p>you will need a jtag (erase:nvram) or to short pin 10 (i think) to resolve your issue.</p><p>jtag is flipped as if you were coming from the back side.&nbsp; i will post that stuff to the wiki later</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p32255">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">bluesguy</div>
					<div class="post-datetime">
						18 Aug 2006, 01:29					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>liquid wrote:</cite><blockquote><p>I would be willing to bet the serial number on the one that died starts with 7407 and the one that didnt starts with 3407.</p></blockquote></div><p>Ok, this is interesting.&nbsp; Both of my units start with 7407, and yet the first one worked fine, the second one didn&#039;t.&nbsp; The *only* thing I can think of that I did different was that I booted the first one all the way up into the Buffalo GUI, because I wanted to see what it looked like and what their stock configuration looked like.&nbsp; I can&#039;t imagine this would have made a difference unless they do some kind of initial configuration during the bootup (e.g. something that modifies the flash or sets up the nvram).&nbsp; The second one (broken one) I flashed immediately on first power up as soon as the boot_wait kicked in.</p><div class="quotebox"><cite>liquid wrote:</cite><blockquote><p>bluesguy: see this changeset... <a href="https://dev.openwrt.org/changeset/4585">https://dev.openwrt.org/changeset/4585</a></p><p>you will need a jtag (erase:nvram) or to short pin 10 (i think) to resolve your issue.</p></blockquote></div><p>Ok, but this raises a couple questions:</p><p>1)&nbsp; The wiki says it&#039;s not safe to erase the nvram on this unit.&nbsp; Are you suggesting that I read the nvram off the one that&#039;s working and write it back to the broken one?&nbsp; Cause I could certainly do that.&nbsp; Or are you saying the wiki is wrong and deleting NVRAM is ok?<br />2)&nbsp; Are you saying it&#039;s just an NVRAM problem then, because the changset looks like it&#039;s just nvram variables.&nbsp; &nbsp;<br />3)&nbsp; If it is just a matter of OpenWRT incorrectly setting NVRAM then I still can&#039;t reconcile why I have one working unit, unless, as I&#039;m guessing above, Buffalo does something during that initial bootup.</p><div class="quotebox"><cite>liquid wrote:</cite><blockquote><p>jtag is flipped as if you were coming from the back side.&nbsp; i will post that stuff to the wiki later</p></blockquote></div><p>So it&#039;s a mirror image of what it should be on the long axis?&nbsp; As in, pin 1 marked on the board is really pin 2?</p><p>That would mean it looks like this (where \/ is the pin 1 marking that&#039;s on the board):</p><p>12 10 8&nbsp; &nbsp;6&nbsp; &nbsp;4&nbsp; &nbsp;2<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;\/<br />o&nbsp; &nbsp;o&nbsp; &nbsp;o&nbsp; &nbsp;o&nbsp; &nbsp;o&nbsp; &nbsp;o<br />o&nbsp; &nbsp;o&nbsp; &nbsp;o&nbsp; &nbsp;o&nbsp; &nbsp;o&nbsp; &nbsp;o<br />11 9&nbsp; &nbsp;7&nbsp; &nbsp;5&nbsp; &nbsp;3&nbsp; &nbsp;1</p><p>Is this what you mean?&nbsp; Or do you mean switched on the short axis as in pin 1 and pin 11 are swapped (along with all the others)?</p><p>Thanks for the update and all the info!!</p><p>G</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p32258">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">bluesguy</div>
					<div class="post-datetime">
						18 Aug 2006, 01:50					</div>
				</div>
				<div class="post-content content">
					<p>Oh yeah, and for the record the flash chip on this unit is an MX 29LV320<strong><span class="bbu">CBTC</span></strong> (emphasis mine) which isn&#039;t in the list of supported chips using the /fc flag of HairyDairyMaids v4.5 util.</p><p>G</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p32263">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">liquid</div>
					<div class="post-datetime">
						18 Aug 2006, 03:28					</div>
				</div>
				<div class="post-content content">
					<p>flipped on the long axis.&nbsp; we used the linux wrt54g.c jtag app and it worked fine for us (keep in mind the timings are very short.. like 1/2 second or so from initial power on).</p><p>the sdram_config on this board is different than the linksys wrt54g v2.2 (which is what that hack was in place for).&nbsp; openwrt shouldnt have been messing with that flag anyway, since it wasnt necessary.</p><p>doing so will result in a bootable system.</p><p>as for buffalo... they do some initial set up in the bootloader.</p><p>if you power on a brand new device, you will see it reboot once before coming up.&nbsp; that is a result of the device setting some defaults.</p><p>you can also watch that in console.</p><p>hope that helps.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p32264">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">bluesguy</div>
					<div class="post-datetime">
						18 Aug 2006, 03:57					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>liquid wrote:</cite><blockquote><p>flipped on the long axis.&nbsp; we used the linux wrt54g.c jtag app and it worked fine for us (keep in mind the timings are very short.. like 1/2 second or so from initial power on).</p></blockquote></div><p>Ok, so re-soldering the header on the back side of the board should do it then.&nbsp; I&#039;ll give it a whirl.</p><div class="quotebox"><cite>liquid wrote:</cite><blockquote><p>the sdram_config on this board is different than the linksys wrt54g v2.2 (which is what that hack was in place for).&nbsp; openwrt shouldnt have been messing with that flag anyway, since it wasnt necessary.</p></blockquote></div><p>Gotcha.</p><p>So is it safe to just erase the nvram on these guys, or should I grab the nvram off the other unit and load it over the b0rked one?</p><br /><br /><p>G</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p32267">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">liquid</div>
					<div class="post-datetime">
						18 Aug 2006, 06:35					</div>
				</div>
				<div class="post-content content">
					<p>i just erased it... but you can always grab the nvram from a fresh one if you are paranoid. <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p32303">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">bluesguy</div>
					<div class="post-datetime">
						18 Aug 2006, 16:13					</div>
				</div>
				<div class="post-content content">
					<p>Thanks.&nbsp; And it automatically rebuilt the default values, or did you have to enter them through the serial console?</p><p>And the serial on these units is 115,200 N,8,1, no flow control?</p><p>G</p>											<p class="post-edited">(Last edited by <strong>bluesguy</strong> on 18 Aug 2006, 16:16)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p32346">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">liquid</div>
					<div class="post-datetime">
						18 Aug 2006, 22:45					</div>
				</div>
				<div class="post-content content">
					<p>yeah, it built what it needed.. if it needed anything.</p><p>and yes, that&#039;s right on serial.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p32402">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">capaz</div>
					<div class="post-datetime">
						20 Aug 2006, 07:02					</div>
				</div>
				<div class="post-content content">
					<p>Hi liquid,</p><p>does it means that the 7407 units are supported on RC5 as well by just changing S05nvram as described on<br /><a href="https://dev.openwrt.org/changeset/4585">https://dev.openwrt.org/changeset/4585</a> <br />after initial setup, but before rebooting ?</p><p>I have an order of 4 of this units on the way, and now I&#039;m afraid that they might be 7407&#039;s ! :-(</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p32417">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">bluesguy</div>
					<div class="post-datetime">
						20 Aug 2006, 15:14					</div>
				</div>
				<div class="post-content content">
					<p>Well I&#039;m not convinced the 7407 serial number is accurate to catch the root source of the problem.&nbsp; I have two 7407 units, one&#039;s fine, the other&#039;s dead.</p><p>I&#039;ve tried everything I could think of, including liquid&#039;s suggestion of trying the JTAG from the backside of the board, and still nothing.&nbsp; (From the back I get all F&#039;s, unknown chipid)&nbsp; To make sure I hadn&#039;t screwed something up, I also tried the JTAG on the working unit, and I still get nothing.&nbsp; &nbsp;FYI - The two units are identical.&nbsp; I know my JTAG setup is working because it works flawlessly on my old wrt54gs.&nbsp; I still suspect the flash chip, since it&#039;s not on the list of supported chips in HairyDairyMaid&#039;s v4.5 debrick tool.</p><p>Here&#039;s a couple pictures of my board, and I suspect liquid and I must have different units, since his worked with the JTAG debrick tool.</p><p>Top left corner markings</p><p><span class="postimg"><img src="http://blues.gotdns.org/buffalo-whr-g54s/top-left.jpg" alt="http://blues.gotdns.org/buffalo-whr-g54s/top-left.jpg" /></span></p><p>The flash chip</p><p><span class="postimg"><img src="http://blues.gotdns.org/buffalo-whr-g54s/flash-chip.jpg" alt="http://blues.gotdns.org/buffalo-whr-g54s/flash-chip.jpg" /></span></p><p>I&#039;ve got shots of the <a href="http://blues.gotdns.org/buffalo-whr-g54s/front-side.jpg">front</a> and <a href="http://blues.gotdns.org/buffalo-whr-g54s/back-side.jpg">back</a> as well, but they&#039;ll take a while to download, if you&#039;re interested.</p><p>I&#039;ve got nothing to left to try, so maybe someone else will have a break though?&nbsp; I&#039;ll gladly post or e-mail other (higher resolution) shots if someone&#039;s interested in something specific about this unit.</p><br /><p>G</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p32615">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">bluesguy</div>
					<div class="post-datetime">
						23 Aug 2006, 14:30					</div>
				</div>
				<div class="post-content content">
					<p>FWIW, I ordered another unit.&nbsp; This one also has the 7407 serial number.&nbsp; I followed exactly the same procedure as I did the first successful unit, and...... it worked.&nbsp; So now I have three units with the 7407 serial, two good, one bad.</p><p>So either letting the WHR-G54S go through it&#039;s startup routine does something, or I just had bad luck that the other unit really is defective.&nbsp; </p><p>In either case the 7407 serial doesn&#039;t seem to be an issue, so we can probably update the wiki, but I won&#039;t know for sure until I can get a JTAG setup that works for these units.&nbsp; (see previous posts)</p><p>Liquid, do you have any more insight into how the JTAG works on these guys?&nbsp; I can&#039;t get it to work on any of these units (the two good one&#039;s or the bad one), but it works fine for my older Linksys models.&nbsp; If I could prove that I can talk to the good unit, but not to the bad unit, that would be a clincher.&nbsp; The sledgehammer patiently awaits...:-)</p><br /><p>G</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p33441">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">bhhenry</div>
					<div class="post-datetime">
						8 Sep 2006, 01:23					</div>
				</div>
				<div class="post-content content">
					<p>I just flashed a WHR-G54S with serial number beginning with 7407, and it worked. I booted up into the default Buffalo GUI first, the followed procedure as indicated above and on WHR-G54S wiki page for the older serial number.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p54085">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">ApOgEEs</div>
					<div class="post-datetime">
						17 Aug 2007, 14:52					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ve successfully installed the openwrt-brcm-2.4-squashfs.trx on my Buffalo WHR-G54S and then soldered the serial connector where I follow the schematic found on <a href="http://www.k9spud.com/whr-g54s/">http://www.k9spud.com/whr-g54s/</a> </p><p>I&#039;ve also installed microcom to check the serial communication.</p><p>My problem is, I cannot connect to my serial device using /dev/ttyS0 .... Can anybody help me?</p><p>The Buffalo serial number starts with 3407.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>