<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Does DNSMASQ work on WRT locally?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 20 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p6885">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">uhop</div>
					<div class="post-datetime">
						7 May 2005, 17:57					</div>
				</div>
				<div class="post-content content">
					<p>I have pretty much plain vanilla dnsmasq setup. Static IPs are in hosts. Dynamic IPs are handled by dnsmasq. Everything works just fine on local network. E.g., I have dynamic host COOL, and I can nslookup it (or ping it) from any computer on my lan. At the same time, if I log in to my router, I can ping only static hosts and external hosts (e.g., <a href="http://www.gnu.org">www.gnu.org</a>). It doesn&#039;t see COOL or COOL.LAN. What gives? I want to be able to resolve dynamic hosts locally on router.</p><p>Why do I need it? Mainly for SSH tunneling from outside to hosts I know only by name for remote administration.</p><p>Yeah, I&#039;ve read dnsmasq doc. Tried to replace except-interface (btw, it looks fine to me) with listen-address options. The result is the same. Any ideas?</p><p>Thank you in advance.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p6893">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">tuzzer</div>
					<div class="post-datetime">
						7 May 2005, 22:53					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>uhop wrote:</cite><blockquote><p>I want to be able to resolve dynamic hosts locally on router.</p></blockquote></div><p>Just find some way to add 127.0.0.1 to /tmp/resolv.conf.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p6896">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">wirelessjoe</div>
					<div class="post-datetime">
						8 May 2005, 01:03					</div>
				</div>
				<div class="post-content content">
					<p>get a old pc and setup a linux dns server, don&#039;t overload your router<br />not only that more service run in your router lead to security problems..</p><p>wireless joe</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p6912">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">uhop</div>
					<div class="post-datetime">
						8 May 2005, 17:59					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>tuzzer wrote:</cite><blockquote><div class="quotebox"><cite>uhop wrote:</cite><blockquote><p>I want to be able to resolve dynamic hosts locally on router.</p></blockquote></div><p>Just find some way to add 127.0.0.1 to /tmp/resolv.conf.</p></blockquote></div><p>How would it work? AFAIK resolv.conf is a list of &quot;universal&quot; DNS resolvers. 127.0.0.1 should be used only for local names. I don&#039;t know, if it possible to make such distinction on resolv.conf level. Theoretically it may loop forever.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p6913">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">uhop</div>
					<div class="post-datetime">
						8 May 2005, 18:11					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>wirelessjoe wrote:</cite><blockquote><p>get a old pc and setup a linux dns server, don&#039;t overload your router<br />not only that more service run in your router lead to security problems..</p><p>wireless joe</p></blockquote></div><p>I checked load and it is fine for my purposes. I know about security implications.</p><p>Of course I am being silly. I should throw away WRT <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" />, and use old PC instead. Chances are it would have better CPU. more memory, hard drives, and whole lot more extendable... But what fun is in it? <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /> Nope, ostrich solution is not for me! <img src="https://forum.openwrt.org/img/smilies/cool.png" width="15" height="15" alt="cool" /></p><p>I cannot believe, dnsmasq can&#039;t do what I want. Most probably it is some kind of bug: </p><div class="codebox"><pre><code>except-interface=vlan1</code></pre></div><p>should make dns service available at least on br0 (it does) and lo (it doesn&#039;t).</p><p>Thank you anyway. Your solution would work. But I am looking for something else.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p6915">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">thefRont</div>
					<div class="post-datetime">
						8 May 2005, 18:33					</div>
				</div>
				<div class="post-content content">
					<p>afaik there is no need to put 127.0.0.1 into /tmp/resolv.conf to<br />make dnsmasq work correctly. it&#039;s all a matter of a properly<br />configured /etc/dnsmasq.conf.</p><p>the dnsmasq.conf that comes with the dnsmasq package is imho<br />not a really good source to start from so I will post my dnsmasq.conf.<br />it will hopefully help you in achieving your goal <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p><p>btw. my lan and wlan are on two different subnets.<br />(lan: 10.10.1.0/24 | wlan: 10.10.2.0/24)</p><p><strong>/etc/dnsmasq.conf</strong><br /></p><div class="codebox"><pre><code>#
# DNS forwarder for external domains
#
resolv-file=/etc/resolv.conf                    # upstream name servers
no-poll                                         # do not poll resolv-file
except-interface=vlan1                          # do not answer on external i/f
domain-needed                                   # don&#039;t forward plain names
bogus-priv                                      # don&#039;t forward private addresse
bogus-nxdomain=64.94.110.11                     # keep Verisign in control
filterwin2k                                     # filter useless Windows DNS requests

#
# Local DNS name server
#
#no-hosts                                       # do not read /etc/hosts
#addn-hosts=/etc/sysconfig/dnsmaqs/hosts        # instead, read this file
expand-hosts                                    # add the domain to /etc/hosts entries
domain=wurstnetz.de                             # domain name
local=/wurstnetz.de/                            # answer these domains from /etc/hosts

#
# Automatically configure DHCP client network i/f (RFC 1533)
#
dhcp-option=1,255.255.255.0                     # subnet mask
#dhcp-option=2,-28800                           # UTC -8:00
dhcp-option=lan, 3,10.10.1.1                    # default g/w for LAN client
dhcp-option=wifi,3,10.10.2.1                    # default g/w for WiFi clients
#dhcp-option=vpn, 3,10.0.3.1                    # default g/w for VPN clients
dhcp-option=lan, 6,10.10.1.1                    # DNS server for LAN clients
dhcp-option=wifi,6,10.10.2.1                    # DNS server for WiFi clients
#dhcp-option=vpn, 6,10.0.3.1                    # DNS server for VPN clients
#dhcp-option=7,10.0.1.2                         # SYSLOG server
#dhcp-option=40,vonk                            # NIS domain
#dhcp-option=41,10.0.1.2                        # NIS domain server
#dhcp-option=42,10.0.1.1                        # NTP server

#
# DHCP address range
#
dhcp-leasefile=/var/dhcp.leases
dhcp-range=lan,10.10.1.150,10.10.1.199,255.255.255.0,15m        # DHCP addr range for LAN clients
dhcp-range=wifi,10.10.2.10,10.10.2.250,255.255.255.0,15m        # DHCP addr range for WIFI clients

#
# MAC addresses below are statically mapped to IP addresses
#
#LAN
dhcp-host=00:10:DC:31:6B:2A,net:lan,    thefront.wurstnetz.de,10.10.1.27,12h
dhcp-host=00:00:39:FB:4A:EE,net:lan,    fronti.lan.wurstnetz.de,10.10.1.127,12h
dhcp-host=00:50:BA:BA:9E:E0,net:lan,    was.wurstnetz.de,10.10.1.129,12h
dhcp-host=00:E0:06:02:FB:8F,net:lan,    hjs.wurstnetz.de,10.10.1.130,12h

#WLAN
dhcp-host=00:20:A6:4D:0E:07,net:wifi,   fronti.wlan.wurstnetz.de,10.10.2.127,12h

dhcp-lease-max=50</code></pre></div><p><strong>/etc/hosts</strong><br /></p><div class="codebox"><pre><code>#LAN
10.10.1.1       router.lan.wurstnetz.de www wurstnetz.de
10.10.1.27      thefront
10.10.1.127     fronti.lan.wurstnetz.de
10.10.1.129     was
10.10.1.130     hjs
10.10.1.200     pappschachtel

#WLAN
10.10.2.1       router.wlan.wurstnetz.de
10.10.2.127     fronti.wlan.wurstnetz.de</code></pre></div><p>this way static hostnames set in /etc/hosts and windows/linux Hostnames set on the particular machine will resolve to<br /><em>some_hostname.wurstnetz.de</em> with some ip address dynamically assigned by dnsmasq<br />with some_hostname being the hostname assinged to the machine.</p>											<p class="post-edited">(Last edited by <strong>thefRont</strong> on 8 May 2005, 18:39)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>