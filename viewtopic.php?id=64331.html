<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Help with QoS?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 26 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p320652">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">Ivoz</div>
					<div class="post-datetime">
						21 Apr 2016, 11:37					</div>
				</div>
				<div class="post-content content">
					<p>Hi there. I am trying to run QoS.</p><p>I live in Australia. Average ADSL speeds I measure are about 5-6Mbps DL, 500-600Kbps UL.<br />My connection runs<br />Phoneline -&gt; ADSL Modem in bridge mode -&gt; WNDR3800 -&gt; Lan computers</p><p>The WNDR3800 establishes internet itself, my ISP over PPPoE (LLC). That&#039;s what the WAN port is set to. The modem essentially just does ADSL translation AFAIK.</p><p>Now I have housemates and anyone using torrents can easily max out that connection if they want to. I try to tell them to be conservative setting their bandwidth etc, but obv the torrent connection can also put a strain on the router.</p><p>Problem comes when one person wants to game and one person wants to torrent.</p><p>I have mostly been using Arokh&#039;s builds for the router, for the most part they work perfectly fine. I used to use QoS-Scripts, set up ports for it to prioritise, tell everyone to use a particular port for torrents. Using this setup, games like CS:GO were still moderately playable even when someone started a torrent.</p><p><a href="https://forum.openwrt.org/viewtopic.php?id=50914">https://forum.openwrt.org/viewtopic.php?id=50914</a></p><p>However latest builds have left QoS-Scripts out, and now just come with SQM by default. Well, SQM is supposed to be the next big thing, right? They&#039;re supposed to be newer and better? However the trouble is I can&#039;t figure out to get them to give any sort of similar or better performance. I&#039;m getting 500 pings on game servers while torrents are running.</p><p>Settings I have -<br />Interface: pppoe-wan<br />Download: 5000<br />Upload: 500</p><p>Disciplines: I have tried both fq_codel / simple, and cake / layer_cake so far.</p><p>Link Layer Adaption: I have it set to ATM &amp; 44. I&#039;m not sure if this is correct or not, given my connection is over PPPoE.</p><p>I could try and re-install QoS-scripts again, but SQM is supposed to be newer and better... however I cannot figure out how to set it up, if it indeed can do the same job. Can it?</p><p>Can anyone give me advice or point out where I&#039;ve set things up wrong?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p320655">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">merc6.9</div>
					<div class="post-datetime">
						21 Apr 2016, 11:43					</div>
				</div>
				<div class="post-content content">
					<p>Hey mate</p><p>QoS-scripts are still very much relevant and if they are working for you I&#039;d stick with them.</p><p>If you still want to use SQM, check this: <a href="http://www.bufferbloat.net/projects/cerowrt/wiki/Setting_up_SQM_for_CeroWrt_310">http://www.bufferbloat.net/projects/cer â€¦ eroWrt_310</a></p><p>Same guide applies to openwrt obviously.</p><p>while Arokh&#039;s builds are nice, they come with a lot of software that runs in the background, if you don&#039;t need that I suggest you just go with a clean CC build directly from openwrt.org downloads and install qos-scripts and configure it like you used to..</p><p>You know what they say: if it ain&#039;t broken...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p320746">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						22 Apr 2016, 00:53					</div>
				</div>
				<div class="post-content content">
					<p>Hi Ivoz,</p><div class="quotebox"><cite>Ivoz wrote:</cite><blockquote><p>Hi there. I am trying to run QoS.</p><p>I live in Australia. Average ADSL speeds I measure are about 5-6Mbps DL, 500-600Kbps UL.<br />My connection runs<br />Phoneline -&gt; ADSL Modem in bridge mode -&gt; WNDR3800 -&gt; Lan computers</p><p>The WNDR3800 establishes internet itself, my ISP over PPPoE (LLC). That&#039;s what the WAN port is set to. The modem essentially just does ADSL translation AFAIK.</p><p>Now I have housemates and anyone using torrents can easily max out that connection if they want to. I try to tell them to be conservative setting their bandwidth etc, but obv the torrent connection can also put a strain on the router.</p><p>Problem comes when one person wants to game and one person wants to torrent.</p><p>I have mostly been using Arokh&#039;s builds for the router, for the most part they work perfectly fine. I used to use QoS-Scripts, set up ports for it to prioritise, tell everyone to use a particular port for torrents. Using this setup, games like CS:GO were still moderately playable even when someone started a torrent.</p><p><a href="https://forum.openwrt.org/viewtopic.php?id=50914">https://forum.openwrt.org/viewtopic.php?id=50914</a></p><p>However latest builds have left QoS-Scripts out, and now just come with SQM by default. Well, SQM is supposed to be the next big thing, right? They&#039;re supposed to be newer and better? However the trouble is I can&#039;t figure out to get them to give any sort of similar or better performance. I&#039;m getting 500 pings on game servers while torrents are running.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; So sqm aims to require less manual intervention/configuration at the router than qos-scripts, this comes at the small cost of not offering too much knobs to tweak things; unfortunatelly torrents atre currently not handled too well by default sqm-scripts. If you manage to set dscp marks on the torrenting computers (like CS1 for background traffic like torrents) simple.qos and layer_cake.qos will try to move them into the background queue, which should at least ameliorate your problem, BUT as far as I know no bittorrent client offers easy ways to set the dscp/tos marks and also this wil only ever work reasonably well for egress, if your contention hppens on ingress that is not going to help too much.<br />&nbsp; &nbsp; &nbsp; &nbsp; That said, hnyman&#039;s builds for the wndr3800 (https://www.dropbox.com/sh/t52c02rm20y8x9p/khFGAJu3gc , see <a href="https://forum.openwrt.org/viewtopic.php?id=28392">https://forum.openwrt.org/viewtopic.php?id=28392</a> ) offer more recent cake that will accept the keyword &quot;triple-isolate&quot; as advanced option strings under the &#039;Queue DIscipline&quot; tab if you check both of the &quot;Show and use advanced options&quot; and &quot;Show and use&nbsp; dangerous options&quot; checkboxes. With this set for ingress and egress cake should be a bit nicer to your gaming traffic. I say should as this option really awaits thorough testing by people that actually use bit torrent, so I very much would appreciate your help and support <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /><br /></p><div class="quotebox"><cite>Ivoz wrote:</cite><blockquote><p>Settings I have -<br />Interface: pppoe-wan<br />Download: 5000<br />Upload: 500</p><p>Disciplines: I have tried both fq_codel / simple, and cake / layer_cake so far.</p><p>Link Layer Adaption: I have it set to ATM &amp; 44. I&#039;m not sure if this is correct or not, given my connection is over PPPoE.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; May I recommend to have a look at <a href="https://github.com/moeller0/ATM_overhead_detector">https://github.com/moeller0/ATM_overhead_detector</a> This should help you in empirically figure out what exact per packet overhead your line uses.<br /></p><div class="quotebox"><cite>Ivoz wrote:</cite><blockquote><br /><p>I could try and re-install QoS-scripts again, but SQM is supposed to be newer and better... however I cannot figure out how to set it up, if it indeed can do the same job. Can it?</p><p>Can anyone give me advice or point out where I&#039;ve set things up wrong?</p></blockquote></div><br /><p>Well, sqm-scripts has a different goal than qos scripts had, ideally sqm-scripts wants to offer a no/few knobs solution that just does the right thing for most people under most circumstances without needing much care or configuration. In your case that does not seem to work too well, so sticking to qos-scripts or even gargoyle might be easiest. (That said I would still appreciate if you could squeeze in a test with layer_cake.qos and the &quot;triple-isolate&quot; keyword to see whether this makes a least a dent into the unfairness issue you see between gaming and torrent traffic)</p><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p320747">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						22 Apr 2016, 00:55					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>merc6.9 wrote:</cite><blockquote><p>Hey mate</p><p>QoS-scripts are still very much relevant and if they are working for you I&#039;d stick with them.</p><p>If you still want to use SQM, check this: <a href="http://www.bufferbloat.net/projects/cerowrt/wiki/Setting_up_SQM_for_CeroWrt_310">http://www.bufferbloat.net/projects/cer â€¦ eroWrt_310</a></p><p>Same guide applies to openwrt obviously.</p><p>while Arokh&#039;s builds are nice, they come with a lot of software that runs in the background, if you don&#039;t need that I suggest you just go with a clean CC build directly from openwrt.org downloads and install qos-scripts and configure it like you used to..</p><p>You know what they say: if it ain&#039;t broken...</p></blockquote></div><p>Rich Brown the author of the cerowrt page you link to also wrote <a href="https://wiki.openwrt.org/doc/howto/sqm">https://wiki.openwrt.org/doc/howto/sqm</a> which contains similar information tailored more to openwrt...</p><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p321569">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">Ivoz</div>
					<div class="post-datetime">
						28 Apr 2016, 01:06					</div>
				</div>
				<div class="post-content content">
					<p>Hi there, I have installed</p><p>WNDR3800-trunk-r49223-20160425-2001-sqfs-sysupgrade.bin</p><p>from hnyman WNDR3700 Openwrt build</p><p>I am running SQM, 5000 DL, 500 UL, eth1 interface, cake qdisc, layer_cake.qos script,&nbsp; and triple-isolate for both ingress and egress keywords<br />For the moment, 0 LLA.</p><p>Speedtest:</p><p><a href="https://www.dslreports.com/speedtest/3739372">SQM enabled</a></p><p><a href="https://www.dslreports.com/speedtest/3739394">SQM disabled</a></p><p>Not sure why bufferbloat went from A to D when disabling SQM...</p><p>I run Windows &amp; Linux equally, when I&#039;m next on linux hopefully I can remember to run ping_collector.sh</p><p>Hopefully I can report back whether using that keyword helps or not soon.</p><p>Yes, I&#039;ve read the SQM howto, unfortunately it doesn&#039;t describe exactly what&#039;s correct for my router&#039;s exact connection (PPPoE, instead of PPPoATM).</p><p>Thanks very much for your help.</p>											<p class="post-edited">(Last edited by <strong>Ivoz</strong> on 28 Apr 2016, 01:14)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p321571">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						28 Apr 2016, 01:33					</div>
				</div>
				<div class="post-content content">
					<p>Hi Ivoz,</p><div class="quotebox"><cite>Ivoz wrote:</cite><blockquote><p>Hi there, I have installed</p><p>WNDR3800-trunk-r49223-20160425-2001-sqfs-sysupgrade.bin</p><p>from hnyman WNDR3700 Openwrt build</p><p>I am running SQM, 5000 DL, 500 UL, eth1 interface, cake qdisc, layer_cake.qos script,&nbsp; and triple-isolate for both ingress and egress keywords<br />For the moment, 0 LLA.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; So if you do not use LLA on an ADSL link you need to reduce the ingress and egress bandwidth by 9% just to compensate for ATM&#039;s 48/53 encoding scheme...<br /></p><div class="quotebox"><cite>Ivoz wrote:</cite><blockquote><p>Speedtest:</p><p><a href="https://www.dslreports.com/speedtest/3739372">SQM enabled</a></p><p><a href="https://www.dslreports.com/speedtest/3739394">SQM disabled</a></p><p>Not sure why bufferbloat went from A to D when disabling SQM...</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; The links show a change from A to C, so definitely less buffer bloat with sqm active, just as expected...<br /></p><div class="quotebox"><cite>Ivoz wrote:</cite><blockquote><p>I run Windows &amp; Linux equally, when I&#039;m next on linux hopefully I can remember to run ping_collector.sh</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; I have not tried it myself, but I assume that cygwin might be sufficient to run it on windows, also the parser shold be able to cope with the output of hrping (<a href="https://www.cfos.de/en/ping/ping.htm">https://www.cfos.de/en/ping/ping.htm</a>) but I have no canned batch script to run hrping on windows, sorry.<br /></p><div class="quotebox"><cite>Ivoz wrote:</cite><blockquote><p>Hopefully I can report back whether using that keyword helps or not soon.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; I would be delighted to learn about your results (hopefully good ones).<br /></p><div class="quotebox"><cite>Ivoz wrote:</cite><blockquote><p>Yes, I&#039;ve read the SQM howto, unfortunately it doesn&#039;t describe exactly what&#039;s correct for my router&#039;s exact connection (PPPoE, instead of PPPoATM).</p><p>Thanks very much for your help.</p></blockquote></div><p>Figuring out the per packet overhead on ATM links is sort of a black art <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /> you either need to inquire with your ISP to get to the details, or you need to measure the real overhead empirically. For pppoe links often 40 bytes overhead is correct, but sometimes with VLAN tags 44 might be the correcter choice...</p><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p321671">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">danymarc</div>
					<div class="post-datetime">
						28 Apr 2016, 17:29					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Ivoz wrote:</cite><blockquote><p>I have housemates and anyone using torrents can easily max out that connection <br />Problem comes when one person wants to game and</p></blockquote></div><p>take a look at Gargoyle household with teenagers<br /><a href="https://www.gargoyle-router.com/wiki/doku.php?id=scenario-teenagers">https://www.gargoyle-router.com/wiki/do â€¦ -teenagers</a></p>											<p class="post-edited">(Last edited by <strong>danymarc</strong> on 28 Apr 2016, 17:29)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>