<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> How to remote upgrade when partitions changed and no sysupgrade</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 20 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p80002">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">bossie</div>
					<div class="post-datetime">
						20 Jan 2009, 23:01					</div>
				</div>
				<div class="post-content content">
					<p>I would like to do a remote FW upgrade from an old FW build to the latest kamikaze FW build (R8.09). The old FW does not have &quot;sysupgrade&quot;. The router is a Compex WP54AG using the Compex bootloader (MyLoader) for which I do not have source code.</p><p>The remote upgrade procedure could use wget to get the FW build and then mtd to write the image to a partition. The problem appears to be in the fact that the partitioning has been changed from the old FW image to the new (see below).<br />I&#039;m assuming the remote upgrade process would therefore have to manually manipulate the partitions and the partition table? Can this be done and how?</p><p>Any ideas on alternative ways of accomplishing a remote upgrade?<br />E.g. If you erase the &quot;kernel&quot; partition and reboot then the unit will start with the tftp server, which would allow you to upload the new FW image. The problem is that once it is done with the programming the unit need to be power cycled manually.</p><br /><p>The old FW would get the partition table from the second partition as follows (from boot messages):</p><div class="codebox"><pre><code>Searching for MyLoader partition table in adm5120 physically mapped flash at offset 0x10000
Creating 5 MTD partitions on &quot;adm5120 physically mapped flash&quot;:
0x00000000-0x00010000 : &quot;MyLoader&quot;
0x00010000-0x00020000 : &quot;Partition Table&quot;
0x00020000-0x00030000 : &quot;lzma loader&quot;
0x00030000-0x00100000 : &quot;kernel&quot;
0x00100000-0x00400000 : &quot;rootfs&quot;
0x00210000-0x00400000 : &quot;rootfs_data&quot;</code></pre></div><p>For the new FW it would look like this:</p><div class="codebox"><pre><code>adm5120-flash.0: searching for MyLoader partition table at offset 0x10000
4 MyLoader partitions found on MTD device adm5120-flash.0
adm5120-flash.0: adding &quot;MyLoader&quot; partitions
Creating 4 MTD partitions on &quot;adm5120-flash.0&quot;:
0x00000000-0x00010000 : &quot;MyLoader&quot;
0x00010000-0x00020000 : &quot;Partition Table&quot;
0x00020000-0x00030000 : &quot;partition0&quot;
0x00030000-0x00400000 : &quot;partition1&quot;</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p80003">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">Weedy</div>
					<div class="post-datetime">
						20 Jan 2009, 23:04					</div>
				</div>
				<div class="post-content content">
					<p>build your own image and use /files/ to keep your changes</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p80004">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">bossie</div>
					<div class="post-datetime">
						20 Jan 2009, 23:13					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Weedy wrote:</cite><blockquote><p>build your own image and use /files/ to keep your changes</p></blockquote></div><p>How do I remotely upload the new image?</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>