<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> how to capture usb scanner button?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 23 Apr 2018 and 4 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 2</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=44812&amp;p=2.html">2</a></li></ul></nav></div>
			
		
		
			<article class="post" id="p205014">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">nozombian</div>
					<div class="post-datetime">
						18 Jun 2013, 15:57					</div>
				</div>
				<div class="post-content content">
					<p>Hello, I found several tutorials, how to control scanner from openwrt terminal or from web gui, seems doable, but I&#039;d like to make idiot proof scanning solution with low power consumption, which would require put paper into scanner and press one of the buttons on the scanner, simple like fax.</p><p>What I don&#039;t know is how to detect the event, that some of the scanner buttons has been pressed on the usb scanner. Is it possible at all? Could someone please tell me?</p><p><em>The background for anyone, whos interested:</em></p><p><em>I have some old canon usb scanner and I need wifi router (as client) to get connectivity to the workplace at the store, so I was thinking about buying cheap tp link wr842nd which has 8MB flash+usb and using this old scanner.</em></p><p><em>The goal is to scan papers to the ftp instead of faxing them out, then scanning on the other side and saving them to ftp. It should be easy for store workes, who are masters at driving a forklift, but don&#039;t know anyhing about computers and computer is not needed there anyway.</em></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p205018">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">snk</div>
					<div class="post-datetime">
						18 Jun 2013, 16:24					</div>
				</div>
				<div class="post-content content">
					<p>Probably not possible, but if the router has a WPS button, you could configure that to start the scanner (assuming the scanner is supported under Linux in the first place).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p205046">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">danitool</div>
					<div class="post-datetime">
						18 Jun 2013, 22:09					</div>
				</div>
				<div class="post-content content">
					<p>Maybe possible, assuming your scanner is an usb device with HID buttons.</p><p>- Install kmod-usb-hid<br />- Install triggerhappy<br />- Restart the router<br />- follow <a href="http://wiki.openwrt.org/doc/howto/hardware.button#triggerhappy">http://wiki.openwrt.org/doc/howto/hardw â€¦ iggerhappy</a></p><p>If possible your scanner button should be mapped to /dev/input/event</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p205064">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">nozombian</div>
					<div class="post-datetime">
						19 Jun 2013, 10:26					</div>
				</div>
				<div class="post-content content">
					<p>Thank you, guys! The wps button seems like a great idea, should be easy, because it is supported in openwrt directly <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> But I will look into the HID solution first, because the wps button probably would not last long <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p205080">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">nozombian</div>
					<div class="post-datetime">
						19 Jun 2013, 16:57					</div>
				</div>
				<div class="post-content content">
					<p>Hello, I found that HID buttons don&#039;t work with scanner <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> But I found something else for linux - scanbuttond: <a href="http://scanbuttond.sourceforge.net/">http://scanbuttond.sourceforge.net/</a> Is it possible to port this to openwrt somehow (if it is not too heavy)?</p><p>I could probably still use reset/wps button for scanning, but I don&#039;t think the button is capable of surviving several clicks daily <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>											<p class="post-edited">(Last edited by <strong>nozombian</strong> on 19 Jun 2013, 16:58)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p205115">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">danitool</div>
					<div class="post-datetime">
						20 Jun 2013, 01:13					</div>
				</div>
				<div class="post-content content">
					<p>Not sure if scanbuttond would detect anything since it&#039;s just a daemon like triggerhappy.</p><p>Might be more modules are needed for HID buttons, might be polled buttons. Install these modules and give it another try<br /><strong><br />kmod-input-gpio-keys-polled<br />kmod-input-polldev<br /></strong><br />kmod-input-gpio-keys-polled shouldn&#039;t be needed but doesn&#039;t hurt.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p205128">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">nozombian</div>
					<div class="post-datetime">
						20 Jun 2013, 08:52					</div>
				</div>
				<div class="post-content content">
					<p>Thank you, I tried them too, but I still don&#039;t have no /dev/input at the first place. Maybe I&#039;m missing something? I coud test periodicaly some event myself, if I&#039;d known which, but I have all the packages you suggested installed and no /dev/input to monitor.</p><div class="codebox"><pre><code>root@wr842nd:~# lsusb
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
Bus 001 Device 004: ID 03f0:0a01 Hewlett-Packard ScanJet 2400c

root@wr842nd:~# sane-find-scanner
found USB scanner (vendor=0x03f0 [Hewlett-Packard], product=0x0a01 [hp scanjet scanner], chip=GL646_HP) at libusb:001:004

root@wr842nd:~# thd --dump /dev/input/event*
Error opening &#039;/dev/input/event*&#039;: No such file or directory</code></pre></div>											<p class="post-edited">(Last edited by <strong>nozombian</strong> on 20 Jun 2013, 09:08)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p205136">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">danitool</div>
					<div class="post-datetime">
						20 Jun 2013, 12:06					</div>
				</div>
				<div class="post-content content">
					<p>Try to connect another usb device, mouse or keyboard USB, and look at /dev/input/event again. If triggerhappy is able to work with the mouse buttons then all is ok and your scanner button cannot be mapped to /dev/input/event.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p205153">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">syssi</div>
					<div class="post-datetime">
						20 Jun 2013, 16:09					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ve packages scanbuttond for openwrt: <a href="http://patchwork.openwrt.org/patch/3380/">http://patchwork.openwrt.org/patch/3380/</a><br />My epson scanner attached to an wrt843n works fine. Your HP scanner (0x03f0, 0x0a01) is expected to work. </p><p>Kind regards,</p><p>syssi</p>											<p class="post-edited">(Last edited by <strong>syssi</strong> on 20 Jun 2013, 16:14)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p205155">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">nozombian</div>
					<div class="post-datetime">
						20 Jun 2013, 16:51					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>danitool wrote:</cite><blockquote><p>Try to connect another usb device, mouse or keyboard USB, and look at /dev/input/event again. If triggerhappy is able to work with the mouse buttons then all is ok and your scanner button cannot be mapped to /dev/input/event.</p></blockquote></div><p>Keyboard is working fine, so scanner is probably not an HID device <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> Thank you for your kind help anyway.</p><div class="quotebox"><cite>syssi wrote:</cite><blockquote><p>I&#039;ve packages scanbuttond for openwrt: <a href="http://patchwork.openwrt.org/patch/3380/">http://patchwork.openwrt.org/patch/3380/</a><br />My epson scanner attached to an wrt843n works fine. Your HP scanner (0x03f0, 0x0a01) is expected to work. </p><p>Kind regards,</p><p>syssi</p></blockquote></div><p>That&#039;s great syssi, thank you, but I have absolutely no idea what to do with your patch <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> I can compile openwrt, configure something here and there, but I&#039;m not a guru, just an user <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><p>If you or someone could point me to the right direction, maybe I&#039;ll be able to handle that <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /> Thanks!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p205160">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">danitool</div>
					<div class="post-datetime">
						20 Jun 2013, 17:20					</div>
				</div>
				<div class="post-content content">
					<p>This may help you:</p><p>- download <a href="http://patchwork.openwrt.org/patch/3380/raw/">http://patchwork.openwrt.org/patch/3380/raw/</a> to your build root<br />- apply the patch opening a terminal console in your buld root<br /></p><div class="codebox"><pre><code>patch -p0 -i OpenWrt-Devel-new-package---scanbuttond-resent.patch</code></pre></div><p>- <strong>make menuconfig</strong> an select the package scanbuttond<br />- build your firmware</p><p>Good news about this app, probably I&#039;ll add info in the wiki to<br /><a href="http://wiki.openwrt.org/doc/howto/hardware.button">http://wiki.openwrt.org/doc/howto/hardware.button</a><br />But I prefer someone testing the app write about it in the wiki.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p205161">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">mazilo</div>
					<div class="post-datetime">
						20 Jun 2013, 17:51					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>danitool wrote:</cite><blockquote><p>This may help you:</p><p>- download <a href="http://patchwork.openwrt.org/patch/3380/raw/">http://patchwork.openwrt.org/patch/3380/raw/</a> to your build root<br />- apply the patch opening a terminal console in your buld root<br /></p><div class="codebox"><pre><code>patch -p0 -i OpenWrt-Devel-new-package---scanbuttond-resent.patch</code></pre></div></blockquote></div><p>I wonder how you managed to use the above instruction to apply the downloaded patched file without error messages. When I tried your suggestion above, I got the following error messages:<br /></p><div class="codebox"><pre><code>sh-4.2$ patch -p0 -i ~/Downloads/OpenWrt-Devel-new-package---scanbuttond-resent.patch
patching file feeds/packages/utils/scanbuttond/patches/debian-0.2.3.cvs20090713-9.patch
patch: **** malformed patch at line 1339: ${libname}_ixlibrary.a&quot;; cd /sys/libs &amp;&amp; $LN_S $lib ${libname}_ixlibrary.a || exit 1; done&#039;

sh-4.2$</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p205162">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">danitool</div>
					<div class="post-datetime">
						20 Jun 2013, 17:56					</div>
				</div>
				<div class="post-content content">
					<p>I didn&#039;t, it&#039;s just a suggestion. The patch seems messed, so manual corrections will be needed.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p205165">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">mazilo</div>
					<div class="post-datetime">
						20 Jun 2013, 18:14					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>danitool wrote:</cite><blockquote><p>I didn&#039;t, it&#039;s just a suggestion. The patch seems messed, so manual corrections will be needed.</p></blockquote></div><p>Please kindly indicate so on your post.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p205186">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">nozombian</div>
					<div class="post-datetime">
						20 Jun 2013, 23:07					</div>
				</div>
				<div class="post-content content">
					<p>Thank you, but if it does not work, I second that please <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p>											<p class="post-edited">(Last edited by <strong>nozombian</strong> on 20 Jun 2013, 23:08)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p205198">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">danitool</div>
					<div class="post-datetime">
						21 Jun 2013, 01:09					</div>
				</div>
				<div class="post-content content">
					<p>The patch was borked (not my fault). It containded some broken lines. I fixed it, download this new one:</p><p>- download <a href="https://files.myopera.com/danitool/openwrt/scanbuttond-package-patch.zip">https://files.myopera.com/danitool/open â€¦ -patch.zip</a> and uncompress to your build root<br />- apply the patch opening a terminal console in your buld root<br /></p><div class="codebox"><pre><code>patch -p0 -i OpenWrt-Devel-new-package---scanbuttond-resent.patch</code></pre></div><p>- execute these commands<br /></p><div class="codebox"><pre><code>./scripts/feeds update -a
./scripts/feeds install scanbuttond</code></pre></div><p>- <strong>make menuconfig</strong> an select the package <strong>scanbuttond</strong> under utils<br />- build your firmware</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p205203">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">mazilo</div>
					<div class="post-datetime">
						21 Jun 2013, 04:11					</div>
				</div>
				<div class="post-content content">
					<p>Thank you.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p205217">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">nozombian</div>
					<div class="post-datetime">
						21 Jun 2013, 10:04					</div>
				</div>
				<div class="post-content content">
					<p>That&#039;s perfect, man! Thank you. Patch worked, I&#039;m compiling now...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p205230">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">nozombian</div>
					<div class="post-datetime">
						21 Jun 2013, 11:45					</div>
				</div>
				<div class="post-content content">
					<p>Scanbuttond seems to be running after restart, so I killed it, created /etc/scanbuttond/buttonpressed.sh, chmod 755ed it, run scanbuttond -f to see what&#039;s happening, but pressed keys still do nothing <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><p>From what I understood so far, scanbuttond schould periodically check usb scanner and look for pressed keys. But USB led is not blinking, when scanbuttond is running. It should blink, if scanbuttond communicated with scanner, right? So what I&#039;m missing yet?</p><p>Btw. SANE is scanning quite fine (more than 100dpi causes scanner to malfuction, but 100dpi is sufficient) and when scanimage is running, usb led blinks. But I have to invoke it by wps button, which is not useable for everyday use.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p205245">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">danitool</div>
					<div class="post-datetime">
						21 Jun 2013, 13:48					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>syssi wrote:</cite><blockquote><p>I&#039;ve packages scanbuttond for openwrt: <a href="http://patchwork.openwrt.org/patch/3380/">http://patchwork.openwrt.org/patch/3380/</a><br />My epson scanner attached to an wrt843n works fine. Your HP scanner (0x03f0, 0x0a01) is expected to work. </p><p>Kind regards,</p><p>syssi</p></blockquote></div><p>I didn&#039;t find&nbsp; the <strong>ID 0x03f0, 0x0a01</strong> in the scanbuttond source code, then <strong>Hewlett-Packard ScanJet 2400c scanners aren&#039;t supported </strong>unless someone patch the code to support them</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p205258">
				<div class="post-metadata">
					<div class="post-num">Post #21</div>
					<div class="post-author">nozombian</div>
					<div class="post-datetime">
						21 Jun 2013, 16:42					</div>
				</div>
				<div class="post-content content">
					<p>Ic, thank you very much for help. Looks like I&#039;m running out of luck here <img src="https://forum.openwrt.org/img/smilies/neutral.png" width="15" height="15" alt="neutral" /></p><p>So I will have to buy usb hub+mouse for adittional ~$6 and hope, that it will be possible to capture mouse button <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p230722">
				<div class="post-metadata">
					<div class="post-num">Post #22</div>
					<div class="post-author">probono</div>
					<div class="post-datetime">
						19 Apr 2014, 11:46					</div>
				</div>
				<div class="post-content content">
					<p>kmod-hid-generic must be selected for buttons on USB devices to work on trunk, at least it helped me use the buttons on my USB sound card.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p230725">
				<div class="post-metadata">
					<div class="post-num">Post #23</div>
					<div class="post-author">nozombian</div>
					<div class="post-datetime">
						19 Apr 2014, 12:35					</div>
				</div>
				<div class="post-content content">
					<p>Thanks, I will try it. Now it is solved using old mouse with broken wheel and usb hub and instead of ftp it is done via email. But it works at about 90%, sometimes it sends empty (zero bytes) page for unknown reasons, but it is useable.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p303708">
				<div class="post-metadata">
					<div class="post-num">Post #24</div>
					<div class="post-author">ujin</div>
					<div class="post-datetime">
						15 Dec 2015, 08:20					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>danitool wrote:</cite><blockquote><p>The patch was borked (not my fault). It containded some broken lines. I fixed it, download this new one:</p><p>- download <a href="https://files.myopera.com/danitool/openwrt/scanbuttond-package-patch.zip">https://files.myopera.com/danitool/open â€¦ -patch.zip</a> and uncompress to your build root</p></blockquote></div><p>Anyone still have this patch?</p>											<p class="post-edited">(Last edited by <strong>ujin</strong> on 15 Dec 2015, 08:21)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p303736">
				<div class="post-metadata">
					<div class="post-num">Post #25</div>
					<div class="post-author">mazilo</div>
					<div class="post-datetime">
						15 Dec 2015, 16:06					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>ujin wrote:</cite><blockquote><div class="quotebox"><cite>danitool wrote:</cite><blockquote><p>The patch was borked (not my fault). It containded some broken lines. I fixed it, download this new one:</p><p>- download <a href="https://files.myopera.com/danitool/openwrt/scanbuttond-package-patch.zip">https://files.myopera.com/danitool/open â€¦ -patch.zip</a> and uncompress to your build root</p></blockquote></div><p>Anyone still have this patch?</p></blockquote></div><p>You may want to read <a href="https://forum.openwrt.org/viewtopic.php?pid=205153#p205153">this</a> and contact the poster about his/her scanbuttond package. Once you get it, please kindly post here.</p>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 1 of 2</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=44812&amp;p=2.html">2</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>