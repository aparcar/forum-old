<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> [Solved] No SSH Access after system upgrade</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 26 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p281945">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">chessplayer</div>
					<div class="post-datetime">
						1 Jul 2015, 00:40					</div>
				</div>
				<div class="post-content content">
					<p>Hi,<br />my TP-Link WDR4300 running an older Barrier Breaker version decided to only start up on occasion today. So I upgraded using the appropriate <a href="https://downloads.openwrt.org/snapshots/trunk/ar71xx/generic/openwrt-ar71xx-generic-tl-wdr4300-v1-squashfs-sysupgrade.bin">file</a>. Also, I chose to keep the configuration. Router is used as a switch providing Wifi.<br />The router/switch does obtain its IP address from the primary router, I can connect my wireless devices and use the internet, so it seems to be working. Now, however, I cannot access it any longer using ssh. Instead, I always get &quot;connection refused&quot; messages.<br />I did go to failsafe mode and enabled dropbear, but no dice. This is a bit annoying, since I also have to install LUCI ...<br />Does anyone know what must be done?<br />Thanks in advance!<br />Chessplayer</p>											<p class="post-edited">(Last edited by <strong>chessplayer</strong> on 2 Jul 2015, 14:47)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p281992">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">eduperez</div>
					<div class="post-datetime">
						1 Jul 2015, 11:45					</div>
				</div>
				<div class="post-content content">
					<p>Does telnet work?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p281999">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">t3hn00b</div>
					<div class="post-datetime">
						1 Jul 2015, 12:02					</div>
				</div>
				<div class="post-content content">
					<p>By default trunk doesn&#039;t contain LuCI. So what you have to do is telnet into the router, set password with &quot;passwd root&quot; then use SSH. As to why you lost the access in the first place is beyond me. Reference: <a href="http://wiki.openwrt.org/doc/howto/firstlogin">http://wiki.openwrt.org/doc/howto/firstlogin</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p282000">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">chessplayer</div>
					<div class="post-datetime">
						1 Jul 2015, 12:41					</div>
				</div>
				<div class="post-content content">
					<p>Hi guys,</p><p>thanks for your replies. I am, however, well aware of these points. The problem is that telnet does NOT work and the SSH connection is refused. Apparently, however, the router did keep all the other configs, since it works in principle (even Wifi, as I said).</p><p>So, this is not a normal firstboot situation, but I used a system upgrade with the &quot;keep config&quot; option. Unfortunately, dropbear seems to have forgotten that it was enabled. The config, however, was still there as I was able to see in failsafe mode after mounting root. Also, I eneabled dropbear while in failsafe mode, but that did not change anything.</p><p>Any other ideas? E.g., is it possible to install packages (like LUCI) in failsafe mode?</p>											<p class="post-edited">(Last edited by <strong>chessplayer</strong> on 1 Jul 2015, 14:11)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p282044">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">danymarc</div>
					<div class="post-datetime">
						1 Jul 2015, 19:42					</div>
				</div>
				<div class="post-content content">
					<p>Can you see the files via WinSCP</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p282048">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">Borromini</div>
					<div class="post-datetime">
						1 Jul 2015, 19:57					</div>
				</div>
				<div class="post-content content">
					<p>Does</p><div class="codebox"><pre><code>logread|grep -i dropbear</code></pre></div><p> show anything? Or netstat, for Dropbear&#039;s listening ports?</p><p>I have a similar issue (but only when I try connecting from the WAN side).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p282057">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">chessplayer</div>
					<div class="post-datetime">
						1 Jul 2015, 22:21					</div>
				</div>
				<div class="post-content content">
					<p>Guys, thanks for your suggestions. But how would I even be able to logread anything or see files when I cannot even connect except for failsafe mode? Btw, my main system is Linux, so no WinSCP (just plain command line ssh).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p282060">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">Borromini</div>
					<div class="post-datetime">
						1 Jul 2015, 23:00					</div>
				</div>
				<div class="post-content content">
					<p>Sorry about that... How does ssh -v to your router look? You&#039;re not using any keys by chance?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p282145">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">chessplayer</div>
					<div class="post-datetime">
						2 Jul 2015, 14:52					</div>
				</div>
				<div class="post-content content">
					<p><strong>Solution</strong></p><p>So, I found the solution myself. Comparing the dropbear config of the router with another one I have also running Chaos Calmer, I saw that a line <br /></p><div class="codebox"><pre><code>option Interface &#039;lan&#039;</code></pre></div><p>was present in the old dropbear config, but not in the new one. Using <a href="http://wiki.openwrt.org/doc/howto/generic.failsafe">failsafe mode</a> to comment out that line in the config file did the trick.</p><p>Hope this is helpful to others as well!</p><p>Cheers,</p><p>chessplayer</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>