<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> slow samba write to usb disk, reading is fast</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 26 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p191156">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">nozombian</div>
					<div class="post-datetime">
						6 Feb 2013, 16:40					</div>
				</div>
				<div class="post-content content">
					<p>Hello, I have AA r35400 on wr1043nd, everything works fine only the write speed with samba is very slow, when I try to write 100mb file to 1TB usb hdd using dd if=/dev/zero of=/mnt/usb/test bs=1M count=100, it takes about 10 seconds, but when I try to write 100mb file over samba, it takes about 2 minutes(!), which is very slow. Read over samba is fast, it takes about 10 seconds too.</p><p>The device should be capable of writing 10mb/s even over samba, it worked some time ago, but it was that fast only sometimes, after some hours of uptime it became this slow, I never tried to catch what caused the slowdown, but I compiled new AA from svn and now it is slow from the beginning. Is there something I&#039;m missing?</p><p>What do you suggest to improve writing perfomance of samba? Thank you.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p191167">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">robthebrew</div>
					<div class="post-datetime">
						6 Feb 2013, 18:57					</div>
				</div>
				<div class="post-content content">
					<p>what fs format?<br />Also the test you showed is not real world.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p191203">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">Thongil</div>
					<div class="post-datetime">
						7 Feb 2013, 01:40					</div>
				</div>
				<div class="post-content content">
					<p>I have the same problem, i get about 3 MB/s of writing, reading isn&#039;t so much much faster.</p><p>I don&#039;t know what can be the problem, some peoplo reports that using another filesystem is faster, but I didnt get any result when i tried.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p191230">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">nozombian</div>
					<div class="post-datetime">
						7 Feb 2013, 10:01					</div>
				</div>
				<div class="post-content content">
					<p>I use ext4, which should be native, never tried with another fs, but I&#039;d prefer to use linux fs on a linux system <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /> The write speed bugs me, I guess it&#039;s something easy to solve, there is probably some write cache disabled or God knows what, but I don&#039;t even know where to start looking.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p191237">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">snk</div>
					<div class="post-datetime">
						7 Feb 2013, 12:21					</div>
				</div>
				<div class="post-content content">
					<p>Make sure you don&#039;t have &#039;sync&#039; in the mount options.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p191239">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">nozombian</div>
					<div class="post-datetime">
						7 Feb 2013, 12:53					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>snk wrote:</cite><blockquote><p>Make sure you don&#039;t have &#039;sync&#039; in the mount options.</p></blockquote></div><p>AMAZING tip! Big thanks, man. Removed sync from /etc/config/fstab, rebooted and now it just writes 10MB/s. As simple as that <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Is there anything I can do to get more usb speed? The drive is actually USB 3.0, but USB 2.0 should make up to 30MB/s. I don&#039;t know, if wr1043nd is capable of achieving such a speed, but everything worths a try <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p191253">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">snk</div>
					<div class="post-datetime">
						7 Feb 2013, 13:56					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>nozombian wrote:</cite><blockquote><p>Is there anything I can do to get more usb speed? The drive is actually USB 3.0, but USB 2.0 should make up to 30MB/s. I don&#039;t know, if wr1043nd is capable of achieving such a speed, but everything worths a try <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p></blockquote></div><p>I don&#039;t think so. In my limited testing with WZR-HP-G300NH (which I think is comparable to yours), I&#039;ve been able to achieve around 25 MB/s write speeds with dd when there has been no other load on the router. With Samba, read and write speeds are around 10 MB/s, since the router CPU is not powerful enough to handle simultaneous routing and USB I/O at higher speeds.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p191256">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">nozombian</div>
					<div class="post-datetime">
						7 Feb 2013, 14:13					</div>
				</div>
				<div class="post-content content">
					<p>Ic, that&#039;s a shame. Thank you for reply. Without that sync parameter I&#039;m now getting 25MB/s write speed, but only with dd.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p191258">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">Thongil</div>
					<div class="post-datetime">
						7 Feb 2013, 14:56					</div>
				</div>
				<div class="post-content content">
					<p>Did you remove &quot;sync&quot; option, or did you use &quot;async&quot; parameter?. I tried using async, but i didn&#039;t see a great performance.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p191260">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">nozombian</div>
					<div class="post-datetime">
						7 Feb 2013, 15:15					</div>
				</div>
				<div class="post-content content">
					<p>vi /etc/config/fstab<br /></p><div class="codebox"><pre><code>config global automount
        option from_fstab 1
        option anon_mount 1

config global autoswap
        option from_fstab 1
        option anon_swap 0

config mount
        option target   /mnt/usb
        option device   /dev/sda1
        option fstype   ext4
        option options  rw
        option enabled  1
        option enabled_fsck 1

config swap
        option device   /dev/sda2
        option enabled  0</code></pre></div><p>I have editted just line, where have been &quot;option options rw,sync&quot;, deleted sync and reboot.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p191296">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">Thongil</div>
					<div class="post-datetime">
						7 Feb 2013, 20:54					</div>
				</div>
				<div class="post-content content">
					<p>I have deleted sync parameter and now It works at 10 MBs. You can&#039;t get more speed because the router has&nbsp; a ethernet port that works at 100 Mb/s which is about 10 MB/s. Now I need to config my wifi, wich is extremely slow <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" />. Thx for posting your fstab <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p191380">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">vargalex</div>
					<div class="post-datetime">
						8 Feb 2013, 10:59					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Thongil wrote:</cite><blockquote><p>I have deleted sync parameter and now It works at 10 MBs. You can&#039;t get more speed because the router has&nbsp; a ethernet port that works at 100 Mb/s which is about 10 MB/s. Now I need to config my wifi, wich is extremely slow <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" />. Thx for posting your fstab <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p></blockquote></div><p>Hi!</p><p>The TP-Link TL-WR1043ND has gigabit ports! The ~10MB/s samba speed has a CPU limit.</p><p>vargalex</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p191406">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">nozombian</div>
					<div class="post-datetime">
						8 Feb 2013, 16:57					</div>
				</div>
				<div class="post-content content">
					<p>That&#039;s correct. I have tried to see what&#039;s going with top command while I was transferring a file and the cpu was almost 100% utilized. Gigabit ports are good only if you&#039;re planning to use it as a switch or router, for working with usb/lan simultaneously the cpu doesn&#039;t seem to be powerful enough. I have been expecting higher speeds too, but wr1043 draws much less power than a stand alone pc and for the price wr1043nd seems like a good solution to me. MKV can be streamed perfectly and when I&#039;m storing 4GB file, I can wait 6-7 minutes <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p285997">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">kartheo</div>
					<div class="post-datetime">
						2 Aug 2015, 17:05					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>snk wrote:</cite><blockquote><p>Make sure you don&#039;t have &#039;sync&#039; in the mount options.</p></blockquote></div><br /><p>THANKS for the tip!!!!<br />I had 1-4 mb/s write speed and now i have 15+ mb/s!!!<br />thanks!!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p353431">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">akucher</div>
					<div class="post-datetime">
						3 Mar 2017, 10:11					</div>
				</div>
				<div class="post-content content">
					<p>For NTFS</p><p>change<br /></p><div class="codebox"><pre><code>mount -t ntfs-3g /dev/sda1 /folder/files -o rw,sync</code></pre></div><p>to<br /></p><div class="codebox"><pre><code>mount -t ntfs-3g /dev/sda1 /folder/files -o rw</code></pre></div><p>tnx for tip!</p>											<p class="post-edited">(Last edited by <strong>akucher</strong> on 3 Mar 2017, 10:33)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>