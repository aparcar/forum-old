<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Ralink I2C issues</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 29 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p354743">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">KakuRoze</div>
					<div class="post-datetime">
						21 Mar 2017, 21:53					</div>
				</div>
				<div class="post-content content">
					<p>Hi,<br />I&#039;m having some issues with kmod_i2c_ralink where the bus randomly locks up.<br />Situation is simple. I&#039;m using ioctl and read/write to communicate with a i2c device and when doing so, I randomly get an issue where every i2c read/write starts generating timeouts. <br />Error is present in latest snapshot, but not on old chaos calmer (bleeding edge, r43860).<br />I was first thinking it was caused by noise on the SCL/SDA lines cause of having lots of relays on the board, but I have discarded that thought since it happens when no relay have been toggled for a while.</p><p>Client is a PIC18F46K22.</p><p>Issue is solved by rebooting the SoC (HLK-RM04) from the SSH terminal, so its likely Not a client issue.</p><p>Complete code can be made available if need be. </p><p>dmesg output is <br />[ 2940.645208] i2c-read line busy</p><p>I can not export the pins to gpio since they are locked by the I2C pinmux.</p><br /><p>Worth noting is that I did have reboot issues on the PIC before, but I have solved them only to stumble onto this I2C issue.<br />And SSL connections also seem to break sometimes with server giving &quot;Bad record MAC&quot; and client (HLK) giving broken pipe and terminates the program instead of failing so I can restart the socket.</p><br /><br /><p>Any thoughts?</p><br /><p>I2C cutout of mips program: <a href="https://gist.github.com/RozeDoyanawa/be631c3d8379c2cea0067e0dbbaf951b">https://gist.github.com/RozeDoyanawa/be â€¦ 0dbbaf951b</a></p><br /><p>//Kind regards.</p>											<p class="post-edited">(Last edited by <strong>KakuRoze</strong> on 21 Mar 2017, 22:35)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>