<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Mjpg_streamer causes router to reboot</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 18 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p212159">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">stuart</div>
					<div class="post-datetime">
						12 Sep 2013, 11:22					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>I am trying to use mjpg_streamer under OpenWRT on a TP-Link TL-WR1043ND router. It works - I can access the default web page and view the static image or the stream. But invariably, after less than a minute of successful operation, the router just shuts down and reboots. The router is otherwise generally very stable.</p><div class="codebox"><pre><code> mjpg_streamer -i &quot;input_uvc.so -y -d /dev/video0 -f 1 -r 640x480&quot; -o &quot;output_http.so -p 8090 -w /www/webcam&quot; </code></pre></div><p>I&#039;m not expecting anyone to know exactly what the problem is just from this brief description. But what would be helpful is some suggestions of how I can go about finding out what the problem is. I watched /var/log/messages while the command ran (up until my connection was lost due to the reboot), but no error messages were thrown up.</p><p>Grateful for any suggestions!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p212169">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">tmo26</div>
					<div class="post-datetime">
						12 Sep 2013, 14:03					</div>
				</div>
				<div class="post-content content">
					<p>Have you tried without -y already?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p212172">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">stuart</div>
					<div class="post-datetime">
						12 Sep 2013, 14:50					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for your reply.</p><p>It doesn&#039;t work at all without -y, presumably as the camera requires YUYV format.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p212173">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">FriedZombie</div>
					<div class="post-datetime">
						12 Sep 2013, 15:09					</div>
				</div>
				<div class="post-content content">
					<p>The issue sounds simillar to an external hd I connected to the router, as soon as it spun up it crashed and restarted&nbsp; the router.<br />What solved the issue for me was using a self powered usb hub, maybe the same problem is at play here.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p212193">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">tmo26</div>
					<div class="post-datetime">
						12 Sep 2013, 17:53					</div>
				</div>
				<div class="post-content content">
					<p>Do you use an USB hub at all? Active or passive?<br />Do you use any other USB devices?<br />Which OpenWRT version do you use?</p><p>And just out of curiosity: What webcam do you use?</p><p>I did a tryout with two webcams and mjpeg_streamer on a DIR-505 (+active hub) some weeks ago and it worked like a charm with both cams streaming simultaneously for more than 15mins, thus I&#039;m a bit surprised that your setup does a reboot after only 1min.</p>											<p class="post-edited">(Last edited by <strong>tmo26</strong> on 12 Sep 2013, 19:26)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p212207">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">FriedZombie</div>
					<div class="post-datetime">
						12 Sep 2013, 20:31					</div>
				</div>
				<div class="post-content content">
					<p>Drawing too much power from the wr1043nd is possible for a short while, because the powerchip can handle it to some extend. But isn&#039;t sufficiently cooled for that.</p><p>That&#039;s why it sometimes takes a short while before it restarts, it does that when the internal heat protection kicks in</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p212236">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">tmo26</div>
					<div class="post-datetime">
						13 Sep 2013, 08:03					</div>
				</div>
				<div class="post-content content">
					<p>Hmmm... how much is &quot;too much power&quot;?<br />Shouldn&#039;t the router be capable of driving 500mA through USB?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p212290">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">FriedZombie</div>
					<div class="post-datetime">
						13 Sep 2013, 20:13					</div>
				</div>
				<div class="post-content content">
					<p>I didn&#039;t design the device, you could try and complain to them.</p><p>But what I found is that if it comes above 350ma or so (give or take) it starts to struggle.<br />Also I think they didn&#039;t have two webcams in mind.</p><p>Also I wouldn&#039;t be surprised if you surpass the 500ma with two webcams and a usb hub anyaway.</p><p>Of course you could mod the device so it is capable to deliver more power (put in a better cooled and higher rated power chip).</p><p>But the easiest solution would be just simply us an active (selfpowered hub).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p212295">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">tmo26</div>
					<div class="post-datetime">
						13 Sep 2013, 21:33					</div>
				</div>
				<div class="post-content content">
					<p>I saw only one webcam in his post...</p><p>Anyway, 350mA isn&#039;t too much current supplied ... could really be reached by one webcam + passive hub.</p><p>I never had those problems, since I use *that* much USB stuff on my routers, that I almost always used active hubs. <img src="https://forum.openwrt.org/img/smilies/yikes.png" width="15" height="15" alt="yikes" />)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p212412">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">stuart</div>
					<div class="post-datetime">
						15 Sep 2013, 17:27					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>Thanks for your helpful suggestions. I had a (powered) drive and the camera on a passive hub. Replacing this with a powered hub seems to have done the trick!</p><p>*EDIT:* Unfortunately this was not as successful as I first thought. It certainly buys me more time, but after a few (five-ish) minutes at 1fps the same thing happens. Any higher fps it happens much more quickly.</p><p>The camera is an old thing I found lying around, one of the circular ones with three LEDs each side of a focus ring, which seem to go under many different brand names. I&#039;m not sure what name I originally bought it under.</p>											<p class="post-edited">(Last edited by <strong>stuart</strong> on 15 Sep 2013, 17:56)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p212423">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">FriedZombie</div>
					<div class="post-datetime">
						15 Sep 2013, 19:38					</div>
				</div>
				<div class="post-content content">
					<p>Probably a crummy active usb hub design, the power supply of the usb hub is probably parallel connected to the power leads from the usb that is going into the hub.</p><p>If you have a volt meter try to measure the positive pin of the usb powersupply jack and the positive lead from the usb that is going into the hub. probably you find out it will be connected.<br /><span class="postimg"><img src="http://wiki.bemaniso.ws/w/images/e/e9/USB_A_pinout.jpg" alt="http://wiki.bemaniso.ws/w/images/e/e9/USB_A_pinout.jpg" /></span></p><p>The ground will most likely be connected in almost all cases, and that doesn&#039;t matter. but if the postive leads are connected the power supply of the router will still feed the hub and camera (only the power draw will be less)</p><p>If that is the case, snip the red cable from the usb lead that is going into the hub (and leave the green white and black one connected). That should solve it.</p>											<p class="post-edited">(Last edited by <strong>FriedZombie</strong> on 15 Sep 2013, 23:25)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p212445">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">stuart</div>
					<div class="post-datetime">
						16 Sep 2013, 00:17					</div>
				</div>
				<div class="post-content content">
					<p>I followed FriedZombie&#039;s advice and snipped the red wire in the USB cable from the hub to the router. </p><p>Oddly, this has had the precise effect of returning me to the original situation: the router now lasts for just one minute or less before rebooting.</p><p>I find this very confusing: the power draw is clearly a factor or else using a powered hub would not have improved the situation as it did. And yet with the power to the camera now exclusively external, it&#039;s acting just as it was when the router was providing power! </p><p>Might cutting the ground help?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p212448">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">FriedZombie</div>
					<div class="post-datetime">
						16 Sep 2013, 00:21					</div>
				</div>
				<div class="post-content content">
					<p>Doesn&#039;t hurt to try, but you will loose the shielding (somewhat), that&#039;s why I didn&#039;t mention it.<br />Still weird though.</p>											<p class="post-edited">(Last edited by <strong>FriedZombie</strong> on 16 Sep 2013, 00:22)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p212457">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">tmo26</div>
					<div class="post-datetime">
						16 Sep 2013, 00:56					</div>
				</div>
				<div class="post-content content">
					<p>Somehow it must make a difference to the router if the +5V come through from the hub or not.</p><p>I&#039;m curious: What&#039;s the output of lsusb and dmesg when you plugin the hub, with and without the +5V?</p><p>How much free RAM do you have while running mjpg_streamer?</p>											<p class="post-edited">(Last edited by <strong>tmo26</strong> on 16 Sep 2013, 00:58)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p212471">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">gsenna</div>
					<div class="post-datetime">
						16 Sep 2013, 06:17					</div>
				</div>
				<div class="post-content content">
					<p>Are you using a swap partition o a swap file?<br />Maybe it&#039;s lacking RAM, as when you run transmission-daemon. If I run it without a swap, it only lasts for a couple of minutes.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p223688">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">alexa.n90.yogya</div>
					<div class="post-datetime">
						25 Jan 2014, 04:09					</div>
				</div>
				<div class="post-content content">
					<p>on some high resolution webcam mjpg-streamer on aarc firmware causes reboot. </p><p>try to use kernel 3.6 or above.</p><div class="quotebox"><cite>gsenna wrote:</cite><blockquote><p>Are you using a swap partition o a swap file?<br />Maybe it&#039;s lacking RAM, as when you run transmission-daemon. If I run it without a swap, it only lasts for a couple of minutes.</p></blockquote></div><p>i used same machine &amp; same application , this problem fixed at kernel 3.6.</p>											<p class="post-edited">(Last edited by <strong>alexa.n90.yogya</strong> on 25 Jan 2014, 04:10)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p241317">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">drossuatoy</div>
					<div class="post-datetime">
						24 Jul 2014, 19:08					</div>
				</div>
				<div class="post-content content">
					<p>hi,<br />how to upgrade to kernel 3.6 or above?<br />currently i used attitude adjustment (12.09, r36088) firmware with kernel 3.3.8</p><div class="quotebox"><cite>alexa.n90.yogya wrote:</cite><blockquote><p>on some high resolution webcam mjpg-streamer on aarc firmware causes reboot. </p><p>try to use kernel 3.6 or above.</p><div class="quotebox"><cite>gsenna wrote:</cite><blockquote><p>Are you using a swap partition o a swap file?<br />Maybe it&#039;s lacking RAM, as when you run transmission-daemon. If I run it without a swap, it only lasts for a couple of minutes.</p></blockquote></div><p>i used same machine &amp; same application , this problem fixed at kernel 3.6.</p></blockquote></div>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>