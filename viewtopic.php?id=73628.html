<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> [SOLVED] OpenVpn - client connects but no traffic (lan or wlan)</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 5 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p374378">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">Mosfet</div>
					<div class="post-datetime">
						24 Mar 2018, 23:36					</div>
				</div>
				<div class="post-content content">
					<p>First I&#039;d like to say hello and thanks for reading this. <br />If it&#039;s not obvious i&#039;m new to OpenWrt ^_^ and OpenVPN .<br />I&#039;ve struggled with this issue for 2 days, in the process reading a lot of other forum topics and following multiple tutorials. </p><p>I want to make a VPN server in order to access may local LAN and use my ISP IP-address when traveling or from public wifi<br />In order to achieve this i&#039;ve used this tutorial: openwrt.org/docs/guide-user/services/vpn/openvpn/server.setup</p><p>Setup informations : <br /></p><ul><li><p>router private lan : 192.168.100.0/24</p></li><li><p>public IP is accessed using IPS provided DDNS</p></li><li><p>TUN IP is 192.168.200.0/24</p></li></ul><p>My configuration files </p><p>/etc/config/network <br /></p><div class="codebox"><pre><code>config interface &#039;loopback&#039;
    option ifname &#039;lo&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;127.0.0.1&#039;
    option netmask &#039;255.0.0.0&#039;

config globals &#039;globals&#039;
    option ula_prefix &#039;fdb2:d044:8ff8::/48&#039;

config interface &#039;lan&#039;
    option type &#039;bridge&#039;
    option ifname &#039;eth0.1&#039;
    option proto &#039;static&#039;
    option netmask &#039;255.255.255.0&#039;
    option ip6assign &#039;60&#039;
    option ipaddr &#039;192.168.100.1&#039;

config device &#039;lan_dev&#039;
    option name &#039;eth0.1&#039;
    option macaddr &#039;&lt;&lt;MAC&gt;&gt;&#039;

config interface &#039;wan&#039;
    option ifname &#039;eth0.2&#039;
    option proto &#039;pppoe&#039;
    option username &#039;&lt;&lt;USERNAME&gt;&gt;&#039;
    option password &#039;&lt;&lt;PASSWORD&gt;&gt;&#039;

config device &#039;wan_dev&#039;
    option name &#039;eth0.2&#039;
    option macaddr &#039;84:16:f9:e8:98:15&#039;

config interface &#039;wan6&#039;
    option ifname &#039;eth0.2&#039;
    option proto &#039;dhcpv6&#039;

config switch
    option name &#039;switch0&#039;
    option reset &#039;1&#039;
    option enable_vlan &#039;1&#039;

config switch_vlan
    option device &#039;switch0&#039;
    option vlan &#039;1&#039;
    option ports &#039;1 2 3 4 0t&#039;

config switch_vlan
    option device &#039;switch0&#039;
    option vlan &#039;2&#039;
    option ports &#039;5 0t&#039;

config interface &#039;vpnserver&#039;
    option proto &#039;none&#039;
    option ifname &#039;ovpns0&#039;
    option auto &#039;1&#039;</code></pre></div><p>/etc/config/openvpn<br /></p><div class="codebox"><pre><code>config openvpn &#039;vpnserver&#039;
    option enabled &#039;1&#039;
    option dev_type &#039;tun&#039;
    option dev &#039;ovpns0&#039;
    option port &#039;1194&#039;
    option proto &#039;tcp&#039;
    option comp_lzo &#039;yes&#039;
    option keepalive &#039;10 120&#039;
    option persist_key &#039;1&#039;
    option persist_tun &#039;1&#039;
    option ca &#039;/etc/openvpn/ca.crt&#039;
    option cert &#039;/etc/openvpn/my-server.crt&#039;
    option key &#039;/etc/openvpn/my-server.key&#039;
    option dh &#039;/etc/openvpn/dh2048.pem&#039;
    option tls_auth &#039;/etc/openvpn/tls-auth.key 0&#039;
    option mode &#039;server&#039;
    option tls_server &#039;1&#039;
    option server &#039;192.168.200.0 255.255.255.0&#039;
    option topology &#039;subnet&#039;
    option route_gateway &#039;dhcp&#039;
    option client_to_client &#039;1&#039;
    list push &#039;comp-lzo yes&#039;
    list push &#039;persist-key&#039;
    list push &#039;persist-tun&#039;
    list push &#039;topology subnet&#039;
    list push &#039;route-gateway dhcp&#039;
    list push &#039;redirect-gateway def1 bypass-dhcp&#039;
    list push &#039;route 192.168.100.0 255.255.255.0&#039;
    list push &#039;dhcp-option DNS 192.168.100.1&#039;</code></pre></div><p>/etc/config/firewall<br /></p><div class="codebox"><pre><code>config defaults
    option syn_flood &#039;1&#039;
    option input &#039;ACCEPT&#039;
    option output &#039;ACCEPT&#039;
    option forward &#039;REJECT&#039;

config zone
    option name &#039;lan&#039;
    list network &#039;lan&#039;
    option input &#039;ACCEPT&#039;
    option output &#039;ACCEPT&#039;
    option forward &#039;ACCEPT&#039;

config zone
    option name &#039;wan&#039;
    list network &#039;wan&#039;
    list network &#039;wan6&#039;
    option input &#039;REJECT&#039;
    option output &#039;ACCEPT&#039;
    option forward &#039;REJECT&#039;
    option masq &#039;1&#039;
    option mtu_fix &#039;1&#039;

config forwarding
    option src &#039;lan&#039;
    option dest &#039;wan&#039;

config rule
    option name &#039;Allow-DHCP-Renew&#039;
    option src &#039;wan&#039;
    option proto &#039;udp&#039;
    option dest_port &#039;68&#039;
    option target &#039;ACCEPT&#039;
    option family &#039;ipv4&#039;

config rule
    option name &#039;Allow-Ping&#039;
    option src &#039;wan&#039;
    option proto &#039;icmp&#039;
    option icmp_type &#039;echo-request&#039;
    option family &#039;ipv4&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-IGMP&#039;
    option src &#039;wan&#039;
    option proto &#039;igmp&#039;
    option family &#039;ipv4&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-DHCPv6&#039;
    option src &#039;wan&#039;
    option proto &#039;udp&#039;
    option src_ip &#039;fc00::/6&#039;
    option dest_ip &#039;fc00::/6&#039;
    option dest_port &#039;546&#039;
    option family &#039;ipv6&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-MLD&#039;
    option src &#039;wan&#039;
    option proto &#039;icmp&#039;
    option src_ip &#039;fe80::/10&#039;
    list icmp_type &#039;130/0&#039;
    list icmp_type &#039;131/0&#039;
    list icmp_type &#039;132/0&#039;
    list icmp_type &#039;143/0&#039;
    option family &#039;ipv6&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-ICMPv6-Input&#039;
    option src &#039;wan&#039;
    option proto &#039;icmp&#039;
    list icmp_type &#039;echo-request&#039;
    list icmp_type &#039;echo-reply&#039;
    list icmp_type &#039;destination-unreachable&#039;
    list icmp_type &#039;packet-too-big&#039;
    list icmp_type &#039;time-exceeded&#039;
    list icmp_type &#039;bad-header&#039;
    list icmp_type &#039;unknown-header-type&#039;
    list icmp_type &#039;router-solicitation&#039;
    list icmp_type &#039;neighbour-solicitation&#039;
    list icmp_type &#039;router-advertisement&#039;
    list icmp_type &#039;neighbour-advertisement&#039;
    option limit &#039;1000/sec&#039;
    option family &#039;ipv6&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-ICMPv6-Forward&#039;
    option src &#039;wan&#039;
    option dest &#039;*&#039;
    option proto &#039;icmp&#039;
    list icmp_type &#039;echo-request&#039;
    list icmp_type &#039;echo-reply&#039;
    list icmp_type &#039;destination-unreachable&#039;
    list icmp_type &#039;packet-too-big&#039;
    list icmp_type &#039;time-exceeded&#039;
    list icmp_type &#039;bad-header&#039;
    list icmp_type &#039;unknown-header-type&#039;
    option limit &#039;1000/sec&#039;
    option family &#039;ipv6&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-IPSec-ESP&#039;
    option src &#039;wan&#039;
    option dest &#039;lan&#039;
    option proto &#039;esp&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-ISAKMP&#039;
    option src &#039;wan&#039;
    option dest &#039;lan&#039;
    option dest_port &#039;500&#039;
    option proto &#039;udp&#039;
    option target &#039;ACCEPT&#039;

config include
    option path &#039;/etc/firewall.user&#039;

config rule
    option name &#039;Allow-OpenVPN-Inbound&#039;
    option target &#039;ACCEPT&#039;
    option src &#039;*&#039;
    option proto &#039;tcpudp&#039;
    option dest_port &#039;1194&#039;

config zone
    option name &#039;vpnserver&#039;
    option input &#039;ACCEPT&#039;
    option forward &#039;REJECT&#039;
    option output &#039;ACCEPT&#039;
    option masq &#039;1&#039;
    option network &#039;vpnserver&#039;

config forwarding
    option src &#039;vpnserver&#039;
    option dest &#039;wan&#039;

config forwarding
    option src &#039;wan&#039;
    option dest &#039;vpnserver&#039;

config forwarding
    option src &#039;vpnserver&#039;
    option dest &#039;lan&#039;

config forwarding
    option src &#039;lan&#039;
    option dest &#039;vpnserver&#039;</code></pre></div><br /><p>openwrt routes <br /></p><div class="codebox"><pre><code>root@OpenWrt:~# route
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
default         10.0.0.1        0.0.0.0         UG    0      0        0 pppoe-wan
10.0.0.1        *               255.255.255.255 UH    0      0        0 pppoe-wan
192.168.100.0   *               255.255.255.0   U     0      0        0 br-lan
192.168.200.0   *               255.255.255.0   U     0      0        0 ovpns0</code></pre></div><p>Messages from lubuntu client ( Internet was provided via Mobile host-spot), I&#039;ve also tried connecting using an android client (openvpn app)</p><div class="codebox"><pre><code>root@Laptop:/home/mosfet# openvpn --config /home/mosfet/Desktop/MOSFET.ovpn
Sat Mar 24 22:46:50 2018 OpenVPN 2.4.3 x86_64-pc-linux-gnu [SSL (OpenSSL)] [LZO] [LZ4] [EPOLL] [PKCS11] [MH/PKTINFO] [AEAD] built on Jul  3 2017
Sat Mar 24 22:46:50 2018 library versions: OpenSSL 1.0.2g  1 Mar 2016, LZO 2.08
Sat Mar 24 22:46:50 2018 Outgoing Control Channel Authentication: Using 160 bit message hash &#039;SHA1&#039; for HMAC authentication
Sat Mar 24 22:46:50 2018 Incoming Control Channel Authentication: Using 160 bit message hash &#039;SHA1&#039; for HMAC authentication
Sat Mar 24 22:46:51 2018 TCP/UDP: Preserving recently used remote address: [AF_INET]&lt;&lt;PUBLIC_IP&gt;&gt;:1194
Sat Mar 24 22:46:51 2018 Socket Buffers: R=[212992-&gt;212992] S=[212992-&gt;212992]
Sat Mar 24 22:46:51 2018 UDP link local: (not bound)
Sat Mar 24 22:46:51 2018 UDP link remote: [AF_INET]&lt;&lt;PUBLIC_IP&gt;&gt;:1194
Sat Mar 24 22:46:51 2018 TLS: Initial packet from [AF_INET]&lt;&lt;PUBLIC_IP&gt;&gt;:1194, sid=77157d7f fbf92825
Sat Mar 24 22:46:52 2018 VERIFY OK: depth=1, C=&lt;&lt;XX&gt;&gt;, ST=&lt;&lt;XXXX&gt;&gt;, O=Home.
Sat Mar 24 22:46:52 2018 VERIFY KU OK
Sat Mar 24 22:46:52 2018 Validating certificate extended key usage
Sat Mar 24 22:46:52 2018 ++ Certificate has EKU (str) TLS Web Server Authentication, expects TLS Web Server Authentication
Sat Mar 24 22:46:52 2018 VERIFY EKU OK
Sat Mar 24 22:46:52 2018 VERIFY OK: depth=0, CN=my-server
Sat Mar 24 22:46:52 2018 WARNING: &#039;link-mtu&#039; is used inconsistently, local=&#039;link-mtu 1542&#039;, remote=&#039;link-mtu 1541&#039;
Sat Mar 24 22:46:52 2018 WARNING: &#039;comp-lzo&#039; is present in local config but missing in remote config, local=&#039;comp-lzo&#039;
Sat Mar 24 22:46:52 2018 Control Channel: TLSv1.2, cipher TLSv1/SSLv3 ECDHE-RSA-AES256-GCM-SHA384, 4096 bit RSA
Sat Mar 24 22:46:52 2018 [my-server] Peer Connection Initiated with [AF_INET]&lt;&lt;PUBLIC_IP&gt;&gt;:1194
Sat Mar 24 22:46:53 2018 SENT CONTROL [my-server]: &#039;PUSH_REQUEST&#039; (status=1)
Sat Mar 24 22:46:53 2018 PUSH: Received control message: &#039;PUSH_REPLY,comp-lzo yes,persist-key,persist-tun,topology subnet,route-gateway dhcp,redirect-gateway def1,route 192.168.200.0 255.255.255.0,dhcp-option DNS 192.168.100.1,route-gateway 192.168.200.1,topology subnet,ping 10,ping-restart 120,ifconfig 192.168.200.2 255.255.255.0,peer-id 0,cipher AES-256-GCM&#039;
Sat Mar 24 22:46:53 2018 OPTIONS IMPORT: timers and/or timeouts modified
Sat Mar 24 22:46:53 2018 OPTIONS IMPORT: compression parms modified
Sat Mar 24 22:46:53 2018 OPTIONS IMPORT: --persist options modified
Sat Mar 24 22:46:53 2018 OPTIONS IMPORT: --ifconfig/up options modified
Sat Mar 24 22:46:53 2018 OPTIONS IMPORT: route options modified
Sat Mar 24 22:46:53 2018 OPTIONS IMPORT: route-related options modified
Sat Mar 24 22:46:53 2018 OPTIONS IMPORT: --ip-win32 and/or --dhcp-option options modified
Sat Mar 24 22:46:53 2018 OPTIONS IMPORT: peer-id set
Sat Mar 24 22:46:53 2018 OPTIONS IMPORT: adjusting link_mtu to 1625
Sat Mar 24 22:46:53 2018 OPTIONS IMPORT: data channel crypto options modified
Sat Mar 24 22:46:53 2018 Data Channel: using negotiated cipher &#039;AES-256-GCM&#039;
Sat Mar 24 22:46:53 2018 Data Channel Encrypt: Cipher &#039;AES-256-GCM&#039; initialized with 256 bit key
Sat Mar 24 22:46:53 2018 Data Channel Decrypt: Cipher &#039;AES-256-GCM&#039; initialized with 256 bit key
Sat Mar 24 22:46:53 2018 ROUTE_GATEWAY 192.168.43.1/255.255.255.0 IFACE=wlp8s0 HWADDR=00:18:de:b8:17:54
Sat Mar 24 22:46:53 2018 TUN/TAP device tun0 opened
Sat Mar 24 22:46:53 2018 TUN/TAP TX queue length set to 100
Sat Mar 24 22:46:53 2018 do_ifconfig, tt-&gt;did_ifconfig_ipv6_setup=0
Sat Mar 24 22:46:53 2018 /sbin/ip link set dev tun0 up mtu 1500
Sat Mar 24 22:46:53 2018 /sbin/ip addr add dev tun0 192.168.200.2/24 broadcast 192.168.200.255
Sat Mar 24 22:46:53 2018 /sbin/ip route add &lt;&lt;PUBLIC_IP&gt;&gt;/32 via 192.168.43.1
Sat Mar 24 22:46:53 2018 /sbin/ip route add 0.0.0.0/1 via 192.168.200.1
Sat Mar 24 22:46:53 2018 /sbin/ip route add 128.0.0.0/1 via 192.168.200.1
Sat Mar 24 22:46:53 2018 /sbin/ip route add 192.168.200.0/24 via 192.168.200.1
RTNETLINK answers: File exists
Sat Mar 24 22:46:53 2018 ERROR: Linux route add command failed: external program exited with error status: 2
Sat Mar 24 22:46:53 2018 WARNING: this configuration may cache passwords in memory -- use the auth-nocache option to prevent this
Sat Mar 24 22:46:53 2018 Initialization Sequence Completed
Sat Mar 24 22:47:03 2018 Bad LZO decompression header byte: 42
Sat Mar 24 22:47:13 2018 Bad LZO decompression header byte: 42
Sat Mar 24 22:47:23 2018 Bad LZO decompression header byte: 42
Sat Mar 24 22:47:34 2018 Bad LZO decompression header byte: 42
Sat Mar 24 22:47:44 2018 Bad LZO decompression header byte: 42</code></pre></div><br /><p>THANKS again for your time and help.</p>											<p class="post-edited">(Last edited by <strong>Mosfet</strong> on 25 Mar 2018, 13:35)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p374379">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">600cc</div>
					<div class="post-datetime">
						24 Mar 2018, 23:55					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Mosfet wrote:</cite><blockquote><ul><li><p>tap IP</p></li></ul></blockquote></div><p>Use tun, not tap, if you want routing. tun is easier for novices to set up.</p><br /><div class="quotebox"><cite>Mosfet wrote:</cite><blockquote><p>/etc/config/openvpn<br /></p><div class="codebox"><pre><code>    list push &#039;redirect-gateway def1&#039;
    list push &#039;route 192.168.200.0 255.255.255.0&#039;</code></pre></div></blockquote></div><p>Replace with:<br /></p><div class="codebox"><pre><code>    list push &#039;redirect-gateway def1 bypass-dhcp&#039;
    list push &#039;route 192.168.100.0 255.255.255.0&#039;</code></pre></div><p>You don&#039;t need to push the VPN&#039;s own subnet as a route. But if you want your clients to access the LAN, then you do need to push the LAN subnet as a route.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p374380">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">Mosfet</div>
					<div class="post-datetime">
						25 Mar 2018, 00:14					</div>
				</div>
				<div class="post-content content">
					<p>Hey, THANKS <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> </p><p>tap was a typo, sorry, it was configured for TUN <br />Made the modifications suggested traffic still wont pass (tested using an android client).&nbsp; <br />I&#039;ve uprated the configuration files in first post -- it makes it easier to read.</p><p>Thanks again ^_^</p><p>P.S. 600cc makes me think your a biker, it&#039;s mid-spring where i live, but its&#039;s snowing at the moment <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> .</p><p>___________________________________________________________________________________<br />Later Edit </p><p>Testing on another windows machine <br />openvpn log <br /></p><div class="codebox"><pre><code>Sun Mar 25 00:43:42 2018 OpenVPN 2.4.5 x86_64-w64-mingw32 [SSL (OpenSSL)] [LZO] [LZ4] [PKCS11] [AEAD] built on Mar  1 2018
Sun Mar 25 00:43:42 2018 Windows version 6.2 (Windows 8 or greater) 64bit
Sun Mar 25 00:43:42 2018 library versions: OpenSSL 1.1.0f  25 May 2017, LZO 2.10
Sun Mar 25 00:43:42 2018 MANAGEMENT: TCP Socket listening on [AF_INET]127.0.0.1:25340
Sun Mar 25 00:43:42 2018 Need hold release from management interface, waiting...
Sun Mar 25 00:43:42 2018 MANAGEMENT: Client connected from [AF_INET]127.0.0.1:25340
Sun Mar 25 00:43:42 2018 MANAGEMENT: CMD &#039;state on&#039;
Sun Mar 25 00:43:42 2018 MANAGEMENT: CMD &#039;log all on&#039;
Sun Mar 25 00:43:42 2018 MANAGEMENT: CMD &#039;echo all on&#039;
Sun Mar 25 00:43:42 2018 MANAGEMENT: CMD &#039;bytecount 5&#039;
Sun Mar 25 00:43:42 2018 MANAGEMENT: CMD &#039;hold off&#039;
Sun Mar 25 00:43:42 2018 MANAGEMENT: CMD &#039;hold release&#039;
Sun Mar 25 00:43:42 2018 NOTE: --fast-io is disabled since we are running on Windows
Sun Mar 25 00:43:42 2018 Outgoing Control Channel Authentication: Using 160 bit message hash &#039;SHA1&#039; for HMAC authentication
Sun Mar 25 00:43:42 2018 Incoming Control Channel Authentication: Using 160 bit message hash &#039;SHA1&#039; for HMAC authentication
Sun Mar 25 00:43:42 2018 MANAGEMENT: &gt;STATE:1521931422,RESOLVE,,,,,,
Sun Mar 25 00:43:42 2018 TCP/UDP: Preserving recently used remote address: [AF_INET]&lt;&lt;PUBLIC_IP&gt;&gt;:1194
Sun Mar 25 00:43:42 2018 Socket Buffers: R=[65536-&gt;65536] S=[65536-&gt;65536]
Sun Mar 25 00:43:42 2018 UDP link local: (not bound)
Sun Mar 25 00:43:42 2018 UDP link remote: [AF_INET]&lt;&lt;PUBLIC_IP&gt;&gt;:1194
Sun Mar 25 00:43:42 2018 MANAGEMENT: &gt;STATE:1521931422,WAIT,,,,,,
Sun Mar 25 00:43:42 2018 MANAGEMENT: &gt;STATE:1521931422,AUTH,,,,,,
Sun Mar 25 00:43:42 2018 TLS: Initial packet from [AF_INET]&lt;&lt;PUBLIC_IP&gt;&gt;:1194, sid=742771aa 526bb8dc
Sun Mar 25 00:43:43 2018 VERIFY OK: depth=1, C=RO, ST=Bucharest, O=Home.
Sun Mar 25 00:43:43 2018 VERIFY KU OK
Sun Mar 25 00:43:43 2018 Validating certificate extended key usage
Sun Mar 25 00:43:43 2018 ++ Certificate has EKU (str) TLS Web Server Authentication, expects TLS Web Server Authentication
Sun Mar 25 00:43:43 2018 VERIFY EKU OK
Sun Mar 25 00:43:43 2018 VERIFY OK: depth=0, CN=my-server
Sun Mar 25 00:43:43 2018 WARNING: &#039;link-mtu&#039; is used inconsistently, local=&#039;link-mtu 1542&#039;, remote=&#039;link-mtu 1541&#039;
Sun Mar 25 00:43:43 2018 WARNING: &#039;comp-lzo&#039; is present in local config but missing in remote config, local=&#039;comp-lzo&#039;
Sun Mar 25 00:43:43 2018 Control Channel: TLSv1.2, cipher TLSv1.2 ECDHE-RSA-AES256-GCM-SHA384, 4096 bit RSA
Sun Mar 25 00:43:43 2018 [my-server] Peer Connection Initiated with [AF_INET]&lt;&lt;PUBLIC_IP&gt;&gt;:1194
Sun Mar 25 00:43:44 2018 MANAGEMENT: &gt;STATE:1521931424,GET_CONFIG,,,,,,
Sun Mar 25 00:43:44 2018 SENT CONTROL [my-server]: &#039;PUSH_REQUEST&#039; (status=1)
Sun Mar 25 00:43:44 2018 PUSH: Received control message: &#039;PUSH_REPLY,comp-lzo yes,persist-key,persist-tun,topology subnet,route-gateway dhcp,redirect-gateway def1 bypass-dhcp,route 192.168.100.0 255.255.255.0,dhcp-option DNS 192.168.100.1,route-gateway 192.168.200.1,topology subnet,ping 10,ping-restart 120,ifconfig 192.168.200.2 255.255.255.0,peer-id 0,cipher AES-256-GCM&#039;
Sun Mar 25 00:43:44 2018 OPTIONS IMPORT: timers and/or timeouts modified
Sun Mar 25 00:43:44 2018 OPTIONS IMPORT: compression parms modified
Sun Mar 25 00:43:44 2018 OPTIONS IMPORT: --persist options modified
Sun Mar 25 00:43:44 2018 OPTIONS IMPORT: --ifconfig/up options modified
Sun Mar 25 00:43:44 2018 OPTIONS IMPORT: route options modified
Sun Mar 25 00:43:44 2018 OPTIONS IMPORT: route-related options modified
Sun Mar 25 00:43:44 2018 OPTIONS IMPORT: --ip-win32 and/or --dhcp-option options modified
Sun Mar 25 00:43:44 2018 OPTIONS IMPORT: peer-id set
Sun Mar 25 00:43:44 2018 OPTIONS IMPORT: adjusting link_mtu to 1625
Sun Mar 25 00:43:44 2018 OPTIONS IMPORT: data channel crypto options modified
Sun Mar 25 00:43:44 2018 Data Channel: using negotiated cipher &#039;AES-256-GCM&#039;
Sun Mar 25 00:43:44 2018 Outgoing Data Channel: Cipher &#039;AES-256-GCM&#039; initialized with 256 bit key
Sun Mar 25 00:43:44 2018 Incoming Data Channel: Cipher &#039;AES-256-GCM&#039; initialized with 256 bit key
Sun Mar 25 00:43:44 2018 interactive service msg_channel=624
Sun Mar 25 00:43:44 2018 ROUTE_GATEWAY 192.168.43.1/255.255.255.0 I=4 HWADDR=00:24:d7:aa:3f:84
Sun Mar 25 00:43:44 2018 open_tun
Sun Mar 25 00:43:44 2018 TAP-WIN32 device [Ethernet 2] opened: \\.\Global\{ECCC8D0F-3D4A-443D-903D-38D6C05DF1B9}.tap
Sun Mar 25 00:43:44 2018 TAP-Windows Driver Version 9.21 
Sun Mar 25 00:43:44 2018 Set TAP-Windows TUN subnet mode network/local/netmask = 192.168.200.0/192.168.200.2/255.255.255.0 [SUCCEEDED]
Sun Mar 25 00:43:44 2018 Notified TAP-Windows driver to set a DHCP IP/netmask of 192.168.200.2/255.255.255.0 on interface {ECCC8D0F-3D4A-443D-903D-38D6C05DF1B9} [DHCP-serv: 192.168.200.254, lease-time: 31536000]
Sun Mar 25 00:43:44 2018 Successful ARP Flush on interface [35] {ECCC8D0F-3D4A-443D-903D-38D6C05DF1B9}
Sun Mar 25 00:43:44 2018 do_ifconfig, tt-&gt;did_ifconfig_ipv6_setup=0
Sun Mar 25 00:43:44 2018 MANAGEMENT: &gt;STATE:1521931424,ASSIGN_IP,,192.168.200.2,,,,
Sun Mar 25 00:43:49 2018 TEST ROUTES: 2/2 succeeded len=1 ret=1 a=0 u/d=up
Sun Mar 25 00:43:49 2018 C:\WINDOWS\system32\route.exe ADD &lt;&lt;PUBLIC_IP&gt;&gt; MASK 255.255.255.255 192.168.43.1
Sun Mar 25 00:43:49 2018 Route addition via service succeeded
Sun Mar 25 00:43:49 2018 C:\WINDOWS\system32\route.exe ADD 0.0.0.0 MASK 128.0.0.0 192.168.200.1
Sun Mar 25 00:43:49 2018 Route addition via service succeeded
Sun Mar 25 00:43:49 2018 C:\WINDOWS\system32\route.exe ADD 128.0.0.0 MASK 128.0.0.0 192.168.200.1
Sun Mar 25 00:43:49 2018 Route addition via service succeeded
Sun Mar 25 00:43:49 2018 MANAGEMENT: &gt;STATE:1521931429,ADD_ROUTES,,,,,,
Sun Mar 25 00:43:49 2018 C:\WINDOWS\system32\route.exe ADD 192.168.100.0 MASK 255.255.255.0 192.168.200.1
Sun Mar 25 00:43:49 2018 Route addition via service succeeded
Sun Mar 25 00:43:49 2018 WARNING: this configuration may cache passwords in memory -- use the auth-nocache option to prevent this
Sun Mar 25 00:43:49 2018 Initialization Sequence Completed
Sun Mar 25 00:43:49 2018 MANAGEMENT: &gt;STATE:1521931429,CONNECTED,SUCCESS,192.168.200.2,&lt;&lt;PUBLIC_IP&gt;&gt;,1194,,
Sun Mar 25 00:43:54 2018 Bad LZO decompression header byte: 42
Sun Mar 25 00:44:04 2018 Bad LZO decompression header byte: 42</code></pre></div><br /><p>Routes <br /></p><div class="codebox"><pre><code>===========================================================================
Active Routes:
Network Destination        Netmask          Gateway       Interface  Metric
          0.0.0.0          0.0.0.0     192.168.43.1   192.168.43.167     55
          0.0.0.0        128.0.0.0    192.168.200.1    192.168.200.2    291
        127.0.0.0        255.0.0.0         On-link         127.0.0.1    331
        127.0.0.1  255.255.255.255         On-link         127.0.0.1    331
  127.255.255.255  255.255.255.255         On-link         127.0.0.1    331
        128.0.0.0        128.0.0.0    192.168.200.1    192.168.200.2    291
   &lt;&lt;PUBLIC_IP&gt;&gt;   255.255.255.255     192.168.43.1   192.168.43.167    311
     192.168.43.0    255.255.255.0         On-link    192.168.43.167    311
   192.168.43.167  255.255.255.255         On-link    192.168.43.167    311
   192.168.43.255  255.255.255.255         On-link    192.168.43.167    311
    192.168.100.0    255.255.255.0    192.168.200.1    192.168.200.2    291
    192.168.200.0    255.255.255.0         On-link     192.168.200.2    291
    192.168.200.2  255.255.255.255         On-link     192.168.200.2    291
  192.168.200.255  255.255.255.255         On-link     192.168.200.2    291
        224.0.0.0        240.0.0.0         On-link         127.0.0.1    331
        224.0.0.0        240.0.0.0         On-link    192.168.43.167    311
        224.0.0.0        240.0.0.0         On-link     192.168.200.2    291
  255.255.255.255  255.255.255.255         On-link         127.0.0.1    331
  255.255.255.255  255.255.255.255         On-link    192.168.43.167    311
  255.255.255.255  255.255.255.255         On-link     192.168.200.2    291
===========================================================================
Persistent Routes:
  None</code></pre></div>											<p class="post-edited">(Last edited by <strong>Mosfet</strong> on 25 Mar 2018, 01:01)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p374381">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">600cc</div>
					<div class="post-datetime">
						25 Mar 2018, 00:58					</div>
				</div>
				<div class="post-content content">
					<p>I am indeed. Both bikes so far have been 600cc units. Next up is likely to be a Pan European or FJR or something along those lines. If the cops and paramedics ride them all day long, so can I.</p><p>Anyway, back to OpenVPN. This post - <a href="https://forum.openwrt.org/viewtopic.php?pid=373075#p373075">https://forum.openwrt.org/viewtopic.php … 75#p373075</a> - contains my working OpenVPN server configuration. Feel free to copy it for your use. Change the IP addresses to suit your needs.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p374394">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">Inf1n1nty</div>
					<div class="post-datetime">
						25 Mar 2018, 10:50					</div>
				</div>
				<div class="post-content content">
					<p>Greetings,</p><p>I am also an OpenWRT Novice and have trouble configuring OpenVPN,&nbsp; I think i have a problem with the OPENVPN Route or something. I have now copied some parts of this config, but I still get no connection.</p><p>I think it is a Routing or Portforwarding Problem.</p><p>I am running an Linksys WRT32X with stock firmware.</p><p>Here are the Log&#039;s and Config Files.</p><p>My Router-Subnet is 192.168.4.0.<br />Router IP 192.168.4.254</p><br /><p><strong>/etc/config/openvpn</strong></p><br /><div class="codebox"><pre><code>config openvpn &#039;custom_config&#039;
    option enabled &#039;0&#039;
    option config &#039;/etc/openvpn/my-vpn.conf&#039;

config openvpn &#039;sample_server&#039;
    option enabled &#039;0&#039;
    option port &#039;1194&#039;
    option proto &#039;udp&#039;
    option dev &#039;tun&#039;
    option ca &#039;/etc/openvpn/ca.crt&#039;
    option cert &#039;/etc/openvpn/server.crt&#039;
    option key &#039;/etc/openvpn/server.key&#039;
    option dh &#039;/etc/openvpn/dh1024.pem&#039;
    option server &#039;10.8.0.0 255.255.255.0&#039;
    option ifconfig_pool_persist &#039;/tmp/ipp.txt&#039;
    option keepalive &#039;10 120&#039;
    option comp_lzo &#039;yes&#039;
    option persist_key &#039;1&#039;
    option persist_tun &#039;1&#039;
    option user &#039;nobody&#039;
    option status &#039;/tmp/openvpn-status.log&#039;
    option verb &#039;3&#039;

config openvpn &#039;sample_client&#039;
    option enabled &#039;0&#039;
    option client &#039;1&#039;
    option dev &#039;tun&#039;
    option proto &#039;udp&#039;
    list remote &#039;my_server_1 1194&#039;
    option resolv_retry &#039;infinite&#039;
    option nobind &#039;1&#039;
    option persist_key &#039;1&#039;
    option persist_tun &#039;1&#039;
    option user &#039;nobody&#039;
    option ca &#039;/etc/openvpn/ca.crt&#039;
    option cert &#039;/etc/openvpn/client.crt&#039;
    option key &#039;/etc/openvpn/client.key&#039;
    option comp_lzo &#039;yes&#039;
    option verb &#039;3&#039;

config openvpn &#039;vpnserver&#039;
    option enabled &#039;1&#039;
    option dev_type &#039;tun&#039;
    option dev &#039;ovpns0&#039;
    option port &#039;1194&#039;
    option proto &#039;tcp&#039;
    option comp_lzo &#039;yes&#039;
    option keepalive &#039;10 120&#039;
    option persist_key &#039;1&#039;
    option persist_tun &#039;1&#039;
    option ca &#039;/etc/openvpn/ca.crt&#039;
    option cert &#039;/etc/openvpn/my-server.crt&#039;
    option key &#039;/etc/openvpn/my-server.key&#039;
    option dh &#039;/etc/openvpn/dh2048.pem&#039;
    option tls_auth &#039;/etc/openvpn/tls-auth.key 0&#039;
    option mode &#039;server&#039;
    option tls_server &#039;1&#039;
    option server &#039;192.168.200.0 255.255.255.0&#039;
    option topology &#039;subnet&#039;
    option route_gateway &#039;dhcp&#039;
    option client_to_client &#039;1&#039;
    list push &#039;comp-lzo yes&#039;
    list push &#039;persist-key&#039;
    list push &#039;persist-tun&#039;
    list push &#039;topology subnet&#039;
    list push &#039;route-gateway dhcp&#039;
    list push &#039;redirect-gateway def1 bypass-dhcp&#039;
    list push &#039;route 192.168.4.0 255.255.255.0&#039;
    list push &#039;dhcp-option DNS 192.168.4.1&#039;</code></pre></div><br /><p><strong>/etc/config/firewall</strong></p><div class="codebox"><pre><code>config defaults
    option syn_flood &#039;1&#039;
    option input &#039;ACCEPT&#039;
    option output &#039;ACCEPT&#039;
    option forward &#039;REJECT&#039;

config zone
    option name &#039;lan&#039;
    list network &#039;lan&#039;
    option input &#039;ACCEPT&#039;
    option output &#039;ACCEPT&#039;
    option forward &#039;ACCEPT&#039;

config zone
    option name &#039;wan&#039;
    list network &#039;wan&#039;
    list network &#039;wan6&#039;
    option input &#039;REJECT&#039;
    option output &#039;ACCEPT&#039;
    option forward &#039;REJECT&#039;
    option masq &#039;1&#039;
    option mtu_fix &#039;1&#039;

config forwarding
    option src &#039;lan&#039;
    option dest &#039;wan&#039;

config rule
    option name &#039;Allow-DHCP-Renew&#039;
    option src &#039;wan&#039;
    option proto &#039;udp&#039;
    option dest_port &#039;68&#039;
    option target &#039;ACCEPT&#039;
    option family &#039;ipv4&#039;

config rule
    option name &#039;Allow-Ping&#039;
    option src &#039;wan&#039;
    option proto &#039;icmp&#039;
    option icmp_type &#039;echo-request&#039;
    option family &#039;ipv4&#039;
    option target &#039;DROP&#039;

config rule
    option name &#039;Allow-IGMP&#039;
    option src &#039;wan&#039;
    option proto &#039;igmp&#039;
    option family &#039;ipv4&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-DHCPv6&#039;
    option src &#039;wan&#039;
    option proto &#039;udp&#039;
    option src_ip &#039;fc00::/6&#039;
    option dest_ip &#039;fc00::/6&#039;
    option dest_port &#039;546&#039;
    option family &#039;ipv6&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-MLD&#039;
    option src &#039;wan&#039;
    option proto &#039;icmp&#039;
    option src_ip &#039;fe80::/10&#039;
    list icmp_type &#039;130/0&#039;
    list icmp_type &#039;131/0&#039;
    list icmp_type &#039;132/0&#039;
    list icmp_type &#039;143/0&#039;
    option family &#039;ipv6&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-ICMPv6-Input&#039;
    option src &#039;wan&#039;
    option proto &#039;icmp&#039;
    list icmp_type &#039;echo-request&#039;
    list icmp_type &#039;echo-reply&#039;
    list icmp_type &#039;destination-unreachable&#039;
    list icmp_type &#039;packet-too-big&#039;
    list icmp_type &#039;time-exceeded&#039;
    list icmp_type &#039;bad-header&#039;
    list icmp_type &#039;unknown-header-type&#039;
    list icmp_type &#039;router-solicitation&#039;
    list icmp_type &#039;neighbour-solicitation&#039;
    list icmp_type &#039;router-advertisement&#039;
    list icmp_type &#039;neighbour-advertisement&#039;
    option limit &#039;1000/sec&#039;
    option family &#039;ipv6&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-ICMPv6-Forward&#039;
    option src &#039;wan&#039;
    option dest &#039;*&#039;
    option proto &#039;icmp&#039;
    list icmp_type &#039;echo-request&#039;
    list icmp_type &#039;echo-reply&#039;
    list icmp_type &#039;destination-unreachable&#039;
    list icmp_type &#039;packet-too-big&#039;
    list icmp_type &#039;time-exceeded&#039;
    list icmp_type &#039;bad-header&#039;
    list icmp_type &#039;unknown-header-type&#039;
    option limit &#039;1000/sec&#039;
    option family &#039;ipv6&#039;
    option target &#039;ACCEPT&#039;

config include
    option path &#039;/etc/firewall.user&#039;

config rule
    option src &#039;wan&#039;
    option dest &#039;lan&#039;
    option proto &#039;esp&#039;
    option target &#039;ACCEPT&#039;

config rule
    option src &#039;wan&#039;
    option dest &#039;lan&#039;
    option dest_port &#039;500&#039;
    option proto &#039;udp&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Samba&#039;
    option src &#039;lan&#039;
    option proto &#039;tcp&#039;
    option dest_port &#039;139&#039;
    option target &#039;ACCEPT&#039;

config include &#039;miniupnpd&#039;
    option type &#039;script&#039;
    option path &#039;/usr/share/miniupnpd/firewall.include&#039;
    option family &#039;any&#039;
    option reload &#039;1&#039;

config include &#039;krouter&#039;
    option path &#039;/usr/lib/krouter-scripts/firemark.sh&#039;

config redirect
    option enabled &#039;1&#039;
    option target &#039;DNAT&#039;
    option src &#039;wan&#039;
    option dest &#039;lan&#039;
    option name &#039;RDP_Client1&#039;
    option dest_ip &#039;192.168.4.10&#039;
    option dest_port &#039;3310&#039;
    option src_dport &#039;3389&#039;
    option proto &#039;tcp udp icmp&#039;

config rule
    option name &#039;Allow-OpenVPN-Inbound&#039;
    option target &#039;ACCEPT&#039;
    option src &#039;*&#039;
    option proto &#039;udp&#039;
    option dest_port &#039;1194&#039;

config zone
    option name &#039;vpnserver&#039;
    option input &#039;ACCEPT&#039;
    option forward &#039;REJECT&#039;
    option output &#039;ACCEPT&#039;
    option masq &#039;1&#039;
    option network &#039;vpnserver&#039;

config forwarding
    option src &#039;vpnserver&#039;
    option dest &#039;wan&#039;

config forwarding
    option src &#039;wan&#039;
    option dest &#039;vpnserver&#039;

config forwarding
    option src &#039;vpnserver&#039;
    option dest &#039;lan&#039;

config forwarding
    option src &#039;lan&#039;
    option dest &#039;vpnserver&#039;</code></pre></div><br /><p><strong>/etc/config/network</strong></p><br /><div class="codebox"><pre><code>config interface &#039;loopback&#039;
    option ifname &#039;lo&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;127.0.0.1&#039;
    option netmask &#039;255.0.0.0&#039;

config globals &#039;globals&#039;
    option ula_prefix &#039;fd85:f178:0495::/48&#039;

config interface &#039;lan&#039;
    option type &#039;bridge&#039;
    option ifname &#039;eth1&#039;
    option proto &#039;static&#039;
    option netmask &#039;255.255.255.0&#039;
    option ip6assign &#039;60&#039;
    option ipaddr &#039;192.168.4.254&#039;

config interface &#039;wan&#039;
    option ifname &#039;eth0&#039;
    option disabled &#039;0&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;xxx.xxx.xxx.xxx&#039;
    option gateway &#039;xxx.xxx.xxx.xxx&#039;
    option netmask &#039;xxx.xxx.xxx.xxx&#039;
    list dns &#039;xxx.xxx.xxx.xxx&#039;
    list dns &#039;xxx.xxx.xxx.xxx&#039;

config interface &#039;wan6&#039;
    option ifname &#039;eth0&#039;
    option proto &#039;dhcpv6&#039;
    option disabled &#039;0&#039;

config switch
    option name &#039;switch0&#039;
    option reset &#039;1&#039;
    option enable_vlan &#039;1&#039;

config switch_vlan
    option device &#039;switch0&#039;
    option vlan &#039;1&#039;
    option ports &#039;0 1 2 3 6&#039;

config switch_vlan
    option device &#039;switch0&#039;
    option vlan &#039;2&#039;
    option ports &#039;4 5&#039;

config interface &#039;vpnserver&#039;
    option proto &#039;none&#039;
    option ifname &#039;ovpns0&#039;
    option auto &#039;1&#039;</code></pre></div><p><strong>Client Config (I have deletet cert Informations)</strong></p><br /><div class="codebox"><pre><code>  client
  dev tun
  proto tcp
  fast-io
  remote xxx.xxx.xxx.xxx 1194
  remote-cert-tls server
  nobind
  persist-key
  persist-tun
  comp-lzo no
  verb 3
  key-direction 1
&lt;ca&gt;
-----BEGIN CERTIFICATE-----
-----END CERTIFICATE-----
&lt;/ca&gt;
&lt;cert&gt;
Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number: 4097 (0x1001)
    Signature Algorithm: sha256WithRSAEncryption
        Issuer: C=GB, ST=London, O=WWW Ltd.
        Validity
            Not Before: Mar 24 19:21:14 2018 GMT
            Not After : Mar 21 19:21:14 2028 GMT
        Subject: CN=my-client
        Subject Public Key Info:
            Public Key Algorithm: rsaEncryption
                Public-Key: (4096 bit)
                Modulus:                  
                Exponent: 65537 (0x10001)
        X509v3 extensions:
            X509v3 Key Usage: 
                Digital Signature
            X509v3 Extended Key Usage: 
                TLS Web Client Authentication
    Signature Algorithm: sha256WithRSAEncryption
        
-----BEGIN CERTIFICATE-----
-----END CERTIFICATE-----
&lt;/cert&gt;
&lt;key&gt;
-----BEGIN PRIVATE KEY-----

-----END PRIVATE KEY-----
&lt;/key&gt;
&lt;tls-auth&gt;
#
# 2048 bit OpenVPN static key
#
-----BEGIN OpenVPN Static key V1-----

-----END OpenVPN Static key V1-----
&lt;/tls-auth&gt;</code></pre></div><br /><br /><p><strong>Log File OpenVPN Client</strong></p><br /><div class="codebox"><pre><code>Sun Mar 25 09:46:09 2018 OpenVPN 2.4.4 x86_64-w64-mingw32 [SSL (OpenSSL)] [LZO] [LZ4] [PKCS11] [AEAD] built on Sep 26 2017
Sun Mar 25 09:46:09 2018 Windows version 6.2 (Windows 8 or greater) 64bit
Sun Mar 25 09:46:09 2018 library versions: OpenSSL 1.0.2l  25 May 2017, LZO 2.10
Sun Mar 25 09:46:09 2018 MANAGEMENT: TCP Socket listening on [AF_INET]127.0.0.1:25341
Sun Mar 25 09:46:09 2018 Need hold release from management interface, waiting...
Sun Mar 25 09:46:10 2018 MANAGEMENT: Client connected from [AF_INET]127.0.0.1:25341
Sun Mar 25 09:46:10 2018 MANAGEMENT: CMD &#039;state on&#039;
Sun Mar 25 09:46:10 2018 MANAGEMENT: CMD &#039;log all on&#039;
Sun Mar 25 09:46:10 2018 MANAGEMENT: CMD &#039;echo all on&#039;
Sun Mar 25 09:46:10 2018 MANAGEMENT: CMD &#039;hold off&#039;
Sun Mar 25 09:46:10 2018 MANAGEMENT: CMD &#039;hold release&#039;
Sun Mar 25 09:46:10 2018 NOTE: --fast-io is disabled since we are running on Windows
Sun Mar 25 09:46:10 2018 Outgoing Control Channel Authentication: Using 160 bit message hash &#039;SHA1&#039; for HMAC authentication
Sun Mar 25 09:46:10 2018 Incoming Control Channel Authentication: Using 160 bit message hash &#039;SHA1&#039; for HMAC authentication
Sun Mar 25 09:46:10 2018 TCP/UDP: Preserving recently used remote address: [AF_INET]xxx.xxx.xxx.xxx:1194
Sun Mar 25 09:46:10 2018 Socket Buffers: R=[65536-&gt;65536] S=[65536-&gt;65536]
Sun Mar 25 09:46:10 2018 Attempting to establish TCP connection with [AF_INET]xxx.xxx.xxx.xxx:1194 [nonblock]
Sun Mar 25 09:46:10 2018 MANAGEMENT: &gt;STATE:1521963970,TCP_CONNECT,,,,,,</code></pre></div><br /><p><strong>Route</strong></p><div class="codebox"><pre><code>root@WRT32X:~# route
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
default         host-xxx.xxx.xxx 0.0.0.0         UG    0      0        0 eth0
192.168.4.0     *               255.255.255.0   U     0      0        0 br-lan
xxx.xxx.xxx.xxx  *               255.255.255.224 U     0      0        0 eth0
239.0.0.0       *               255.0.0.0       U     0      0        0 br-lan</code></pre></div><br /><p>I hope somebody can help me.</p><p>I wish you all a nice Sunday <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p374395">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">Inf1n1nty</div>
					<div class="post-datetime">
						25 Mar 2018, 11:01					</div>
				</div>
				<div class="post-content content">
					<p>I have found a Mistake in my config:</p><br /><br /><div class="codebox"><pre><code>config rule
    option name &#039;Allow-OpenVPN-Inbound&#039;
    option target &#039;ACCEPT&#039;
    option src &#039;*&#039;
    [b]option proto &#039;tcp&#039;[/b]
    option dest_port &#039;1194&#039;</code></pre></div><br /><p>But still no luck:</p><div class="codebox"><pre><code>Sun Mar 25 09:57:59 2018 OpenVPN 2.4.4 x86_64-w64-mingw32 [SSL (OpenSSL)] [LZO] [LZ4] [PKCS11] [AEAD] built on Sep 26 2017
Sun Mar 25 09:57:59 2018 Windows version 6.2 (Windows 8 or greater) 64bit
Sun Mar 25 09:57:59 2018 library versions: OpenSSL 1.0.2l  25 May 2017, LZO 2.10
Sun Mar 25 09:57:59 2018 MANAGEMENT: TCP Socket listening on [AF_INET]127.0.0.1:25341
Sun Mar 25 09:57:59 2018 Need hold release from management interface, waiting...
Sun Mar 25 09:58:00 2018 MANAGEMENT: Client connected from [AF_INET]127.0.0.1:25341
Sun Mar 25 09:58:00 2018 MANAGEMENT: CMD &#039;state on&#039;
Sun Mar 25 09:58:00 2018 MANAGEMENT: CMD &#039;log all on&#039;
Sun Mar 25 09:58:00 2018 MANAGEMENT: CMD &#039;echo all on&#039;
Sun Mar 25 09:58:00 2018 MANAGEMENT: CMD &#039;hold off&#039;
Sun Mar 25 09:58:00 2018 MANAGEMENT: CMD &#039;hold release&#039;
Sun Mar 25 09:58:00 2018 NOTE: --fast-io is disabled since we are running on Windows
Sun Mar 25 09:58:00 2018 Outgoing Control Channel Authentication: Using 160 bit message hash &#039;SHA1&#039; for HMAC authentication
Sun Mar 25 09:58:00 2018 Incoming Control Channel Authentication: Using 160 bit message hash &#039;SHA1&#039; for HMAC authentication
Sun Mar 25 09:58:00 2018 TCP/UDP: Preserving recently used remote address: [AF_INET]xxx.xxx.xxx.xxx:1194
Sun Mar 25 09:58:00 2018 Socket Buffers: R=[65536-&gt;65536] S=[65536-&gt;65536]
Sun Mar 25 09:58:00 2018 Attempting to establish TCP connection with [AF_INET]xxx.xxx.xxx.xxx:1194 [nonblock]
Sun Mar 25 09:58:00 2018 MANAGEMENT: &gt;STATE:1521964680,TCP_CONNECT,,,,,,
Sun Mar 25 10:00:00 2018 TCP: connect to [AF_INET]xxx.xxx.xxx.xxx:1194 failed: Unknown error</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p374397">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">Inf1n1nty</div>
					<div class="post-datetime">
						25 Mar 2018, 11:29					</div>
				</div>
				<div class="post-content content">
					<p>@600cc I have tried your config, but I still get the same error.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p374399">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">Mosfet</div>
					<div class="post-datetime">
						25 Mar 2018, 12:23					</div>
				</div>
				<div class="post-content content">
					<p>EDITED PROBLEMS SOLVED</p><p><strong>@600cc </strong><br />Those are really nice and comfy bikes ^_^, currently i&#039;m riding an CBR600F4, planing on selling it and upgrading something like vstrom</p><p>THANKS again for your help </p><br /><p><strong>Inf1n1nty</strong> <br />Try This configurations, they work for me ! <br />Remember to modify according to your setup </p><br /><p>OPENVPN configuration<br />&nbsp; &nbsp; &nbsp;| Remember to check certificate &amp; keys path <br />&nbsp; &nbsp; &nbsp;| Remember to check subnets and devices according to network configuration (if&nbsp; your are not using cofig listed below) <br /></p><div class="codebox"><pre><code>config openvpn &#039;vpnserver&#039;
    option local &#039;&lt;&lt;IP/DDNS&gt;&gt;&#039;
    option port &#039;1194&#039;
    option proto &#039;udp&#039;
    option dev &#039;ovpns0&#039;
    option dev_type &#039;tun&#039;
    option ca &#039;/etc/openvpn/ca.crt&#039;
    option cert &#039;/etc/openvpn/my-server.crt&#039;
    option key &#039;/etc/openvpn/my-server.key&#039;
    option dh &#039;/etc/openvpn/dh2048.pem&#039;
    option tls_auth &#039;/etc/openvpn/tls-auth.key 0&#039;
    option duplicate_cn &#039;1&#039;
    option server &#039;192.168.200.0 255.255.255.0&#039;
    option topology &#039;subnet&#039;
    list push &#039;topology subnet&#039;
    list push &#039;redirect-gateway def1&#039;
    list push &#039;route 192.168.100.0 255.255.255.0&#039;
    list push &#039;dhcp-option DNS 192.168.100.1&#039;
    list push &#039;dhcp-option DOMAIN lan&#039;
    option client_to_client &#039;1&#039;
    option keepalive &#039;10 120&#039;
    option cipher &#039;AES-256-GCM&#039;
    option compress &#039;lzo&#039;
    option verb &#039;3&#039;
    option persist_key &#039;1&#039;
    option persist_tun &#039;1&#039;
    option user &#039;nobody&#039;
    option status &#039;/tmp/openvpn-udp-status.log&#039;
    option mute &#039;20&#039;
    option enabled &#039;1&#039;
    option comp_lzo &#039;yes&#039;
    list push &#039;comp-lzo yes&#039;
    list push &#039;dhcp-option DNS 8.8.8.8&#039;
       list push &#039;dhcp-option DNS 8.8.4.4&#039;</code></pre></div><br /><div class="codebox"><pre><code>config interface &#039;loopback&#039;
    option ifname &#039;lo&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;127.0.0.1&#039;
    option netmask &#039;255.0.0.0&#039;

config globals &#039;globals&#039;
    option ula_prefix &#039;fdb2:d044:8ff8::/48&#039;

config interface &#039;lan&#039;
    option type &#039;bridge&#039;
    option ifname &#039;eth0.1&#039;
    option proto &#039;static&#039;
    option netmask &#039;255.255.255.0&#039;
    option ip6assign &#039;60&#039;
    option ipaddr &#039;192.168.100.1&#039;

config device &#039;lan_dev&#039;
    option name &#039;eth0.1&#039;
    option macaddr &#039;84:16:f9:e8:98:14&#039;

config interface &#039;wan&#039;
    option ifname &#039;eth0.2&#039;
    option proto &#039;pppoe&#039;
    option username &#039;&lt;&lt;username&gt;&gt;&#039;
    option password &#039;&lt;&lt;password&gt;&gt;&#039;

config device &#039;wan_dev&#039;
    option name &#039;eth0.2&#039;
    option macaddr &#039;84:16:f9:e8:98:15&#039;

config interface &#039;wan6&#039;
    option ifname &#039;eth0.2&#039;
    option proto &#039;dhcpv6&#039;

config switch
    option name &#039;switch0&#039;
    option reset &#039;1&#039;
    option enable_vlan &#039;1&#039;

config switch_vlan
    option device &#039;switch0&#039;
    option vlan &#039;1&#039;
    option ports &#039;1 2 3 4 0t&#039;

config switch_vlan
    option device &#039;switch0&#039;
    option vlan &#039;2&#039;
    option ports &#039;5 0t&#039;

config interface &#039;vpnserver&#039;
    option proto &#039;none&#039;
    option ifname &#039;ovpns0&#039;
    option auto &#039;1&#039;</code></pre></div><p>firewall </p><div class="codebox"><pre><code>config defaults
    option syn_flood &#039;1&#039;
    option input &#039;ACCEPT&#039;
    option output &#039;ACCEPT&#039;
    option forward &#039;REJECT&#039;

config zone
    option name &#039;lan&#039;
    list network &#039;lan&#039;
    option input &#039;ACCEPT&#039;
    option output &#039;ACCEPT&#039;
    option forward &#039;ACCEPT&#039;

config zone
    option name &#039;wan&#039;
    list network &#039;wan&#039;
    list network &#039;wan6&#039;
    option input &#039;REJECT&#039;
    option output &#039;ACCEPT&#039;
    option forward &#039;REJECT&#039;
    option masq &#039;1&#039;
    option mtu_fix &#039;1&#039;

config forwarding
    option src &#039;lan&#039;
    option dest &#039;wan&#039;

config rule
    option name &#039;Allow-DHCP-Renew&#039;
    option src &#039;wan&#039;
    option proto &#039;udp&#039;
    option dest_port &#039;68&#039;
    option target &#039;ACCEPT&#039;
    option family &#039;ipv4&#039;

config rule
    option name &#039;Allow-Ping&#039;
    option src &#039;wan&#039;
    option proto &#039;icmp&#039;
    option icmp_type &#039;echo-request&#039;
    option family &#039;ipv4&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-IGMP&#039;
    option src &#039;wan&#039;
    option proto &#039;igmp&#039;
    option family &#039;ipv4&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-DHCPv6&#039;
    option src &#039;wan&#039;
    option proto &#039;udp&#039;
    option src_ip &#039;fc00::/6&#039;
    option dest_ip &#039;fc00::/6&#039;
    option dest_port &#039;546&#039;
    option family &#039;ipv6&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-MLD&#039;
    option src &#039;wan&#039;
    option proto &#039;icmp&#039;
    option src_ip &#039;fe80::/10&#039;
    list icmp_type &#039;130/0&#039;
    list icmp_type &#039;131/0&#039;
    list icmp_type &#039;132/0&#039;
    list icmp_type &#039;143/0&#039;
    option family &#039;ipv6&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-ICMPv6-Input&#039;
    option src &#039;wan&#039;
    option proto &#039;icmp&#039;
    list icmp_type &#039;echo-request&#039;
    list icmp_type &#039;echo-reply&#039;
    list icmp_type &#039;destination-unreachable&#039;
    list icmp_type &#039;packet-too-big&#039;
    list icmp_type &#039;time-exceeded&#039;
    list icmp_type &#039;bad-header&#039;
    list icmp_type &#039;unknown-header-type&#039;
    list icmp_type &#039;router-solicitation&#039;
    list icmp_type &#039;neighbour-solicitation&#039;
    list icmp_type &#039;router-advertisement&#039;
    list icmp_type &#039;neighbour-advertisement&#039;
    option limit &#039;1000/sec&#039;
    option family &#039;ipv6&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-ICMPv6-Forward&#039;
    option src &#039;wan&#039;
    option dest &#039;*&#039;
    option proto &#039;icmp&#039;
    list icmp_type &#039;echo-request&#039;
    list icmp_type &#039;echo-reply&#039;
    list icmp_type &#039;destination-unreachable&#039;
    list icmp_type &#039;packet-too-big&#039;
    list icmp_type &#039;time-exceeded&#039;
    list icmp_type &#039;bad-header&#039;
    list icmp_type &#039;unknown-header-type&#039;
    option limit &#039;1000/sec&#039;
    option family &#039;ipv6&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-IPSec-ESP&#039;
    option src &#039;wan&#039;
    option dest &#039;lan&#039;
    option proto &#039;esp&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-ISAKMP&#039;
    option src &#039;wan&#039;
    option dest &#039;lan&#039;
    option dest_port &#039;500&#039;
    option proto &#039;udp&#039;
    option target &#039;ACCEPT&#039;

config include
    option path &#039;/etc/firewall.user&#039;

config rule
    option name &#039;Allow-OpenVPN-Inbound&#039;
    option target &#039;ACCEPT&#039;
    option src &#039;*&#039;
    option proto &#039;tcpudp&#039;
    option dest_port &#039;1194&#039;

config zone
    option name &#039;vpnserver&#039;
    option input &#039;ACCEPT&#039;
    option forward &#039;REJECT&#039;
    option output &#039;ACCEPT&#039;
    option masq &#039;1&#039;
    option network &#039;vpnserver&#039;

config forwarding
    option src &#039;vpnserver&#039;
    option dest &#039;wan&#039;

config forwarding
    option src &#039;wan&#039;
    option dest &#039;vpnserver&#039;

config forwarding
    option src &#039;vpnserver&#039;
    option dest &#039;lan&#039;

config forwarding
    option src &#039;lan&#039;
    option dest &#039;vpnserver&#039;</code></pre></div><p>client config (ovpn file) <br />&nbsp; &nbsp; | certificate key and data removed <br /></p><div class="codebox"><pre><code>  client
  dev tun
  proto udp
  remote mosfet.go.ro 1194
  block-outside-dns

  remote-cert-tls server
  cipher AES-256-GCM
  persist-key
  persist-tun
  nobind
  resolv-retry infinite
  comp-lzo
  verb 5
  mute 10
key-direction 1
&lt;ca&gt;
-----BEGIN CERTIFICATE-----
-----END CERTIFICATE-----
&lt;/ca&gt;
&lt;cert&gt;
-----BEGIN CERTIFICATE-----
-----END CERTIFICATE-----
&lt;/cert&gt;
&lt;key&gt;
-----BEGIN PRIVATE KEY-----
-----END PRIVATE KEY-----
&lt;/key&gt;
&lt;tls-auth&gt;
&lt;/tls-auth&gt;</code></pre></div>											<p class="post-edited">(Last edited by <strong>Mosfet</strong> on 25 Mar 2018, 13:35)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p374406">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">600cc</div>
					<div class="post-datetime">
						25 Mar 2018, 13:22					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Inf1n1nty wrote:</cite><blockquote><p>@600cc I have tried your config, but I still get the same error.</p></blockquote></div><p>May I suggest opening a new thread, so your request doesn&#039;t get lost among this one?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p374409">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">600cc</div>
					<div class="post-datetime">
						25 Mar 2018, 13:34					</div>
				</div>
				<div class="post-content content">
					<p><strong>/etc/config/firewall</strong><br /></p><div class="codebox"><pre><code>config zone
        option input &#039;ACCEPT&#039;
        option network &#039;vtun0 vtun1 &#039;
        option output &#039;ACCEPT&#039;
        option name &#039;vpn&#039;
        option forward &#039;ACCEPT&#039;

config rule
        option target &#039;ACCEPT&#039;
        option src &#039;wan&#039;
        option proto &#039;udp&#039;
        option dest_port &#039;1194&#039;
        option name &#039;OpenVPN UDP&#039;

config rule
        option target &#039;ACCEPT&#039;
        option src &#039;wan&#039;
        option proto &#039;tcp&#039;
        option dest_port &#039;443&#039;
        option name &#039;OpenVPN TCP&#039;

config forwarding
        option dest &#039;lan&#039;
        option src &#039;vpn&#039;

config forwarding
        option dest &#039;wan&#039;
        option src &#039;vpn&#039;

config forwarding
        option dest &#039;vpn&#039;
        option src &#039;lan&#039;</code></pre></div><br /><p>I have two vtun networks because I have OpenVPN listening on two ports, one for each protocol, instead of combining both into a single instance.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p374410">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">600cc</div>
					<div class="post-datetime">
						25 Mar 2018, 13:36					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ve just spotted something else, too: you&#039;ve got masquerade enabled on your VPN zone. You only need masquerading (NAT) on the WAN, and only if your WAN interface is the IP address you present to the outside world. Under normal circumstances (and this is one) you wouldn&#039;t typically need to apply NAT on a private address range.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p374416">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">Inf1n1nty</div>
					<div class="post-datetime">
						25 Mar 2018, 16:26					</div>
				</div>
				<div class="post-content content">
					<p>@mosfet: Sorry didn&#039;t work with your config either.</p><p>I will open a new thread.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p374417">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">Inf1n1nty</div>
					<div class="post-datetime">
						25 Mar 2018, 16:26					</div>
				</div>
				<div class="post-content content">
					<p>Thanks anyway!</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>