<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> trunk to sysupgrade (sfsquash) image via SSH</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 7 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p302466">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">kojak</div>
					<div class="post-datetime">
						5 Dec 2015, 02:39					</div>
				</div>
				<div class="post-content content">
					<p>What is the process for restoring/recovering the GUI and normal functions?&nbsp; The &#039;Chaos Calmer&#039; image was functioning satisfactorily, when I attempted to upgrade using &#039;openwrt-ar71xx-generic-tl-wr841nd-v7-squashfs-sysupgrade.bin&#039;.&nbsp; After the upgrade attempt the GUI is no longer available.&nbsp; </p><p>I can telnet into the router as &#039;root&#039;, but mount_image, and firstboot result in the following to no avail.&nbsp; Thanks in advance.</p><p>///<br />login as: root</p><br /><p>BusyBox v1.24.1 (2015-11-30 15:07:02 CET) built-in shell (ash)</p><p>&nbsp; _______&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;________&nbsp; &nbsp; &nbsp; &nbsp; __<br /> |&nbsp; &nbsp; &nbsp; &nbsp;|.-----.-----.-----.|&nbsp; |&nbsp; |&nbsp; |.----.|&nbsp; |_<br /> |&nbsp; &nbsp;-&nbsp; &nbsp;||&nbsp; _&nbsp; |&nbsp; -__|&nbsp; &nbsp; &nbsp;||&nbsp; |&nbsp; |&nbsp; ||&nbsp; &nbsp;_||&nbsp; &nbsp;_|<br /> |_______||&nbsp; &nbsp;__|_____|__|__||________||__|&nbsp; |____|<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |__| W I R E L E S S&nbsp; &nbsp;F R E E D O M<br /> -----------------------------------------------------<br /> DESIGNATED DRIVER (Bleeding Edge, r47670)<br /> -----------------------------------------------------<br />&nbsp; * 2 oz. Orange Juice&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Combine all juices in a<br />&nbsp; * 2 oz. Pineapple Juice&nbsp; &nbsp; &nbsp; tall glass filled with<br />&nbsp; * 2 oz. Grapefruit Juice&nbsp; &nbsp; &nbsp;ice, stir well.<br />&nbsp; * 2 oz. Cranberry Juice<br /> -----------------------------------------------------<br />================= FAILSAFE MODE active ================<br />special commands:<br />* firstboot&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; reset settings to factory defaults<br />* mount_root&nbsp; &nbsp; &nbsp;mount root-partition with config files</p><p>after mount_root:<br />* passwd&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;change root&#039;s password<br />* /etc/config&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;directory with config files</p><p>for more help see:<br /><a href="http://wiki.openwrt.org/doc/howto/generic.failsafe">http://wiki.openwrt.org/doc/howto/generic.failsafe</a><br />=======================================================</p><p>root@(none):~# /etc/config<br />-ash: /etc/config: Permission denied<br />root@(none):~# admin<br />-ash: admin: not found<br />root@(none):~#<br />root@(none):~# mount_root<br />root@(none):~# firstboot<br />This will erase all settings and remove any installed packages. Are you sure? [N/y]<br />y<br />/dev/mtdblock3 is not mounted<br />/dev/mtdblock3 will be erased on next mount<br />root@(none):~#</p>											<p class="post-edited">(Last edited by <strong>kojak</strong> on 6 Dec 2015, 02:48)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p302471">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">makarel</div>
					<div class="post-datetime">
						5 Dec 2015, 04:03					</div>
				</div>
				<div class="post-content content">
					<p>i think you downloaded a trunk image; strange you can telnet.. do you mean ssh??<br />trunk images dont have luci so you have to install it</p><p>so do a restart&gt;ssh&gt; <br /> opkg update &amp;&amp; opkg install luci<br /> /etc/init.d/uhttpd start<br /> /etc/init.d/uhttpd enable</p><p><a href="http://wiki.openwrt.org/zh-cn/doc/howto/luci?s">http://wiki.openwrt.org/zh-cn/doc/howto/luci?s</a>[]=install&amp;s[]=luci</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p302521">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">kojak</div>
					<div class="post-datetime">
						5 Dec 2015, 17:26					</div>
				</div>
				<div class="post-content content">
					<p>Indeed you are correct I am SSH&#039;ing.&nbsp; I am preplexed as to what I should do next in order to resolve the present state of my NOT being able to login to the GUI (note that I am providing my actions in reverse chronological order - my first actions are at the bottom; applied as suggested):</p><p>login as: root</p><br /><p>BusyBox v1.24.1 (2015-11-30 15:07:02 CET) built-in shell (ash)</p><p>&nbsp; _______&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;________&nbsp; &nbsp; &nbsp; &nbsp; __<br /> |&nbsp; &nbsp; &nbsp; &nbsp;|.-----.-----.-----.|&nbsp; |&nbsp; |&nbsp; |.----.|&nbsp; |_<br /> |&nbsp; &nbsp;-&nbsp; &nbsp;||&nbsp; _&nbsp; |&nbsp; -__|&nbsp; &nbsp; &nbsp;||&nbsp; |&nbsp; |&nbsp; ||&nbsp; &nbsp;_||&nbsp; &nbsp;_|<br /> |_______||&nbsp; &nbsp;__|_____|__|__||________||__|&nbsp; |____|<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |__| W I R E L E S S&nbsp; &nbsp;F R E E D O M<br /> -----------------------------------------------------<br /> DESIGNATED DRIVER (Bleeding Edge, r47670)<br /> -----------------------------------------------------<br />&nbsp; * 2 oz. Orange Juice&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Combine all juices in a<br />&nbsp; * 2 oz. Pineapple Juice&nbsp; &nbsp; &nbsp; tall glass filled with<br />&nbsp; * 2 oz. Grapefruit Juice&nbsp; &nbsp; &nbsp;ice, stir well.<br />&nbsp; * 2 oz. Cranberry Juice<br /> -----------------------------------------------------<br />Your JFFS2-partition seems full and overlayfs is mounted read-only.<br />Please try to remove files from /overlay/upper/... and reboot!<br />root@OpenWrt:~#<br />root@OpenWrt:~# mount_root<br />root@OpenWrt:~# firstboot<br />This will erase all settings and remove any installed packages. Are you sure? [N/y]<br />y<br />/dev/mtdblock3 is mounted as /overlay, only erasing files<br />root@OpenWrt:~#</p><p>/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////</p><p>login as: root</p><br /><p>BusyBox v1.24.1 (2015-11-30 15:07:02 CET) built-in shell (ash)</p><p>&nbsp; _______&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;________&nbsp; &nbsp; &nbsp; &nbsp; __<br /> |&nbsp; &nbsp; &nbsp; &nbsp;|.-----.-----.-----.|&nbsp; |&nbsp; |&nbsp; |.----.|&nbsp; |_<br /> |&nbsp; &nbsp;-&nbsp; &nbsp;||&nbsp; _&nbsp; |&nbsp; -__|&nbsp; &nbsp; &nbsp;||&nbsp; |&nbsp; |&nbsp; ||&nbsp; &nbsp;_||&nbsp; &nbsp;_|<br /> |_______||&nbsp; &nbsp;__|_____|__|__||________||__|&nbsp; |____|<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |__| W I R E L E S S&nbsp; &nbsp;F R E E D O M<br /> -----------------------------------------------------<br /> DESIGNATED DRIVER (Bleeding Edge, r47670)<br /> -----------------------------------------------------<br />&nbsp; * 2 oz. Orange Juice&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Combine all juices in a<br />&nbsp; * 2 oz. Pineapple Juice&nbsp; &nbsp; &nbsp; tall glass filled with<br />&nbsp; * 2 oz. Grapefruit Juice&nbsp; &nbsp; &nbsp;ice, stir well.<br />&nbsp; * 2 oz. Cranberry Juice<br /> -----------------------------------------------------<br />root@OpenWrt:~# /etc/init.d/uhttpd start<br />root@OpenWrt:~# /etc/init.d/uhttpd enable<br />ln: /etc/rc.d/S50uhttpd: No space left on device<br />root@OpenWrt:~#</p><p>/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////</p><p>login as: root</p><br /><p>BusyBox v1.24.1 (2015-11-30 15:07:02 CET) built-in shell (ash)</p><p>&nbsp; _______&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;________&nbsp; &nbsp; &nbsp; &nbsp; __<br /> |&nbsp; &nbsp; &nbsp; &nbsp;|.-----.-----.-----.|&nbsp; |&nbsp; |&nbsp; |.----.|&nbsp; |_<br /> |&nbsp; &nbsp;-&nbsp; &nbsp;||&nbsp; _&nbsp; |&nbsp; -__|&nbsp; &nbsp; &nbsp;||&nbsp; |&nbsp; |&nbsp; ||&nbsp; &nbsp;_||&nbsp; &nbsp;_|<br /> |_______||&nbsp; &nbsp;__|_____|__|__||________||__|&nbsp; |____|<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |__| W I R E L E S S&nbsp; &nbsp;F R E E D O M<br /> -----------------------------------------------------<br /> DESIGNATED DRIVER (Bleeding Edge, r47670)<br /> -----------------------------------------------------<br />&nbsp; * 2 oz. Orange Juice&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Combine all juices in a<br />&nbsp; * 2 oz. Pineapple Juice&nbsp; &nbsp; &nbsp; tall glass filled with<br />&nbsp; * 2 oz. Grapefruit Juice&nbsp; &nbsp; &nbsp;ice, stir well.<br />&nbsp; * 2 oz. Cranberry Juice<br /> -----------------------------------------------------<br />root@OpenWrt:~# opkg update &amp;&amp; opkg install luci</p><p>[get] links deleted for brevity.</p><p>Installing liblua (5.1.5-1) to root...<br />Configuring lua.<br />Configuring luci-base.<br />Configuring luci-mod-admin-full.<br />Configuring uhttpd.<br />Configuring uhttpd-mod-ubus.<br />Collected errors:<br /> * verify_pkg_installable: Only have 64kb available on filesystem /overlay, pkg liblua needs 65<br /> * opkg_install_cmd: Cannot install package luci.<br /> * opkg_conf_write_status_files: Couldn&#039;t close //usr/lib/opkg/status: No space left on device.</p><p>/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////<br />eof</p>											<p class="post-edited">(Last edited by <strong>kojak</strong> on 6 Dec 2015, 02:55)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p302524">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">makarel</div>
					<div class="post-datetime">
						5 Dec 2015, 18:29					</div>
				</div>
				<div class="post-content content">
					<p>you dont have enough space to install luci<br />at this point if you really want trunk you should compile your own image with luci integrated<br />the other option is to reflash CC RC or final images which have luci integrated inside them</p><p>check your device wiki regarding safemode, CLI flashing <br />also backup the mtd partitions.. you never know..</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p302536">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">makarel</div>
					<div class="post-datetime">
						5 Dec 2015, 20:14					</div>
				</div>
				<div class="post-content content">
					<p>make backup of flash<br /><a href="http://wiki.openwrt.org/doc/howto/generic.backup">http://wiki.openwrt.org/doc/howto/generic.backup</a></p><p>list of partitions: cat /proc/mtd<br />use for every partition: dd if=/dev/mtd0 of=/tmp/mtd0.backup<br />get the files: scp root@192.168.1.1:/tmp/mtd0.backup</p><br /><p>get a sysupgrade file and md5 sum<br /><a href="http://wiki.openwrt.org/doc/howto/generic.sysupgrade">http://wiki.openwrt.org/doc/howto/generic.sysupgrade</a></p><div class="quotebox"><blockquote><p>cd /tmp<br />wget &lt;path to sysupg image&gt;</p><p># check the integrity of the image file<br />wget &lt;path to sysupg image&gt;/md5sums<br /># the desired result is that the downloaded firmware filename is listed with &quot;OK&quot; afterwards<br />md5sum -c md5sums 2&gt; /dev/null | grep OK</p></blockquote></div><p>make the sysupgrade<br /></p><div class="quotebox"><blockquote><p>sysupgrade -v /tmp/filename-of-downloaded-sysupgrade.bin</p></blockquote></div>											<p class="post-edited">(Last edited by <strong>makarel</strong> on 5 Dec 2015, 20:16)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p302560">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">kojak</div>
					<div class="post-datetime">
						6 Dec 2015, 02:47					</div>
				</div>
				<div class="post-content content">
					<p>makarel, thank you.&nbsp; LuCI and I are back together now - she&#039;s beautiful:</p><p>Switching to ramdisk...<br />Performing system upgrade...<br />Unlocking firmware ...</p><p>Writing from &lt;stdin&gt; to firmware ...<br />Appending jffs2 data from /tmp/sysupgrade.tgz to firmware...TRX header not found<br />Error fixing up TRX header<br />Upgrade completed<br />Rebooting system...</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>