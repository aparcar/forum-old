<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Bonding/aggregate wifi devices</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 22 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p156787">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">danny1</div>
					<div class="post-datetime">
						9 Feb 2012, 11:16					</div>
				</div>
				<div class="post-content content">
					<p>Have anyone had sucsess bonding 2 wifi interfaces?<br />Tried but when i add the second wifi device ( ifenslave bond0 wlan1 ) its mac gets changed into the same as the first device, and 2 ap&#039;s with the same mac can&#039;t be good, how do i get arround this?<br />Im not even sure it will work, bonding requires layer 2...<br />Mikrotik have some proprietary software using ethernet over ip tunnels for this i think.<br />Tunnels through both wifi links and then enslave the tunnel connections instead?<br />Any ideas on this would be appreciated thanks <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>root@OpenWrt:/# wifi up<br />Configuration file: /var/run/hostapd-phy0.conf<br />Using interface wlan0 with hwaddr 00:04:e2:fb:3f:7c and ssid &#039;Open1&#039;<br />Configuration file: /var/run/hostapd-phy1.conf<br />Using interface wlan1 with hwaddr 00:04:e2:f7:7c:b0 and ssid &#039;Open2&#039;<br />root@OpenWrt:/# ifconfig wlan0<br />wlan0&nbsp; &nbsp; &nbsp;Link encap:Ethernet&nbsp; HWaddr 00:04:E2:FB:3F:7C<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:0 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:18 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:32<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:0 (0.0 B)&nbsp; TX bytes:1540 (1.5 KiB)</p><p>root@OpenWrt:/# ifconfig wlan1<br />wlan1&nbsp; &nbsp; &nbsp;Link encap:Ethernet&nbsp; HWaddr 00:04:E2:F7:7C:B0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:0 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:20 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:32<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:0 (0.0 B)&nbsp; TX bytes:1696 (1.6 KiB)</p><p>root@OpenWrt:/# ifenslave bond0 wlan0<br />root@OpenWrt:/# ifconfig wlan0<br />wlan0&nbsp; &nbsp; &nbsp;Link encap:Ethernet&nbsp; HWaddr 00:04:E2:FB:3F:7C<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING SLAVE MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:0 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:39 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:32<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:0 (0.0 B)&nbsp; TX bytes:3256 (3.1 KiB)</p><p>root@OpenWrt:/# ifenslave bond0 wlan1<br />root@OpenWrt:/# ifconfig wlan1<br />wlan1&nbsp; &nbsp; &nbsp;Link encap:Ethernet&nbsp; HWaddr 00:04:E2:FB:3F:7C<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING SLAVE MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:0 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:43 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:32<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:0 (0.0 B)&nbsp; TX bytes:3568 (3.4 KiB)</p><p>root@OpenWrt:/#</p>											<p class="post-edited">(Last edited by <strong>danny1</strong> on 9 Feb 2012, 11:28)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p156789">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						9 Feb 2012, 11:28					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>danny1 wrote:</cite><blockquote><p>when i add the second wifi device ( ifenslave bond0 wlan1 ) its mac gets changed into the same as the first device</p></blockquote></div><p>That&#039;s the whole idea behind bonding... at least for ethernet links that is.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p156811">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">craigdavids</div>
					<div class="post-datetime">
						9 Feb 2012, 17:16					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>@danny1: I and others have open this post: <a href="https://forum.openwrt.org/viewtopic.php?id=34342">https://forum.openwrt.org/viewtopic.php?id=34342</a> where i speak a little of bonding/LACP (802.3ad).<br />I do not understand what the problem of &quot;when i add the second wifi device ( ifenslave bond0 wlan1 ) its mac gets changed into the same as the first device&quot;.</p><p>Here is my configuration for bonding two ethernet interfaces:<br />#ifconfig bond0 192.168.100.1 netmask 255.255.255.0 up<br />#ifenslave bond0 eth0 eth1<br />#route add default gw 192.168.1.1 bond0</p><p>Here is the output of ifconfig :<br />#ifconfig -a<br />bond0&nbsp; &nbsp; &nbsp;Link encap:Ethernet&nbsp; HWaddr A4:BA:DB:10:30:1E<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:132.207.108.7&nbsp; Bcast:192.168.1.255&nbsp; Mask:255.255.255.0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet6 addr: fe80::a6ba:dbff:fe10:301e/64 Scope:Link<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MASTER MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:572665 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:145041 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:320433098 (305.5 MiB)&nbsp; TX bytes:11531560 (10.9 MiB)</p><p>eth0&nbsp; &nbsp; &nbsp; Link encap:Ethernet&nbsp; HWaddr A4:BA:DB:FF:FA:KE<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING SLAVE MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:286461 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:87853 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:1000<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:160503391 (153.0 MiB)&nbsp; TX bytes:6747616 (6.4 MiB)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Interrupt:106 Memory:da000000-da012800 </p><p>eth1&nbsp; &nbsp; &nbsp; Link encap:Ethernet&nbsp; HWaddr A4:BA:DB:FF:FA:KE<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING SLAVE MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:286204 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:57188 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:1000<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:159929707 (152.5 MiB)&nbsp; TX bytes:4783944 (4.5 MiB)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Interrupt:114 Memory:dc000000-dc012800</p><p>eth0 and eth1 have the same MAC A4:BA:DB:FF:FA:KE, but this is needed for bonding, as far as i think.</p><p>To restore your slaves MAC addresses, you need to detach them from the bond (`ifenslave -d bond0 eth0&#039;). The bonding driver will then restore the MAC addresses that the slaves had before they were enslaved. The bond MAC address will be the taken from its first slave device in your case wlan0.</p><p>What I have is all ok. I&#039;m thinking in soon do also a success bonding of 2 or more wifi interfaces... Can or are you interested in do this and we will try do this together?, and try to solve possible problems<br />If more people are interested please join...</p><p>Regards,<br />Craig Davids</p>											<p class="post-edited">(Last edited by <strong>craigdavids</strong> on 9 Feb 2012, 17:19)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p156891">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">danny1</div>
					<div class="post-datetime">
						10 Feb 2012, 05:24					</div>
				</div>
				<div class="post-content content">
					<p>Using vtun ethernet tunneling it works, just did a few tests, with 2x atheros 11g radios in each box limited to 9 mbits with iwconfig wlan0 rate 9M fixed, had no proper antennas for all the cards so faster tests have to wait.</p><p>192.168.6.1 is the physical ip for wlan0<br />192.168.7.1 is the physical ip for wlan1<br />192.168.5.1 is the bonded device</p><p>root@OpenWrt:/# iperf -c 192.168.6.1<br />------------------------------------------------------------<br />Client connecting to 192.168.6.1, TCP port 5001<br />TCP window size: 16.0 KByte (default)<br />------------------------------------------------------------<br />[&nbsp; 3] local 192.168.6.2 port 38024 connected with 192.168.6.1 port 5001<br />[ ID] Interval&nbsp; &nbsp; &nbsp; &nbsp;Transfer&nbsp; &nbsp; &nbsp;Bandwidth<br />[&nbsp; 3]&nbsp; 0.0-10.2 sec&nbsp; 7.88 MBytes&nbsp; 6.47 Mbits/sec<br />root@OpenWrt:/# iperf -c 192.168.7.1<br />------------------------------------------------------------<br />Client connecting to 192.168.7.1, TCP port 5001<br />TCP window size: 16.0 KByte (default)<br />------------------------------------------------------------<br />[&nbsp; 3] local 192.168.7.2 port 49014 connected with 192.168.7.1 port 5001<br />[ ID] Interval&nbsp; &nbsp; &nbsp; &nbsp;Transfer&nbsp; &nbsp; &nbsp;Bandwidth<br />[&nbsp; 3]&nbsp; 0.0-10.2 sec&nbsp; 7.00 MBytes&nbsp; 5.77 Mbits/sec<br />root@OpenWrt:/# iperf -c 192.168.5.1<br />------------------------------------------------------------<br />Client connecting to 192.168.5.1, TCP port 5001<br />TCP window size: 16.0 KByte (default)<br />------------------------------------------------------------<br />[&nbsp; 3] local 192.168.5.2 port 41035 connected with 192.168.5.1 port 5001<br />[ ID] Interval&nbsp; &nbsp; &nbsp; &nbsp;Transfer&nbsp; &nbsp; &nbsp;Bandwidth<br />[&nbsp; 3]&nbsp; 0.0-10.1 sec&nbsp; 12.3 MBytes&nbsp; 10.2 Mbits/sec</p><p>EDIT:</p><p>Tried vtun using tcp encapsulation instead of udp, and got this</p><p>root@OpenWrt:/# iperf -c 192.168.6.1<br />------------------------------------------------------------<br />Client connecting to 192.168.6.1, TCP port 5001<br />TCP window size: 16.0 KByte (default)<br />------------------------------------------------------------<br />[&nbsp; 3] local 192.168.6.2 port 54736 connected with 192.168.6.1 port 5001<br />[ ID] Interval&nbsp; &nbsp; &nbsp; &nbsp;Transfer&nbsp; &nbsp; &nbsp;Bandwidth<br />[&nbsp; 3]&nbsp; 0.0-10.3 sec&nbsp; 8.13 MBytes&nbsp; 6.64 Mbits/sec<br />root@OpenWrt:/# iperf -c 192.168.7.1<br />------------------------------------------------------------<br />Client connecting to 192.168.7.1, TCP port 5001<br />TCP window size: 16.0 KByte (default)<br />------------------------------------------------------------<br />[&nbsp; 3] local 192.168.7.2 port 46629 connected with 192.168.7.1 port 5001<br />[ ID] Interval&nbsp; &nbsp; &nbsp; &nbsp;Transfer&nbsp; &nbsp; &nbsp;Bandwidth<br />[&nbsp; 3]&nbsp; 0.0-10.1 sec&nbsp; 7.13 MBytes&nbsp; 5.89 Mbits/sec<br />root@OpenWrt:/# iperf -c 192.168.5.1<br />------------------------------------------------------------<br />Client connecting to 192.168.5.1, TCP port 5001<br />TCP window size: 16.0 KByte (default)<br />------------------------------------------------------------<br />[&nbsp; 3] local 192.168.5.2 port 50305 connected with 192.168.5.1 port 5001<br />[ ID] Interval&nbsp; &nbsp; &nbsp; &nbsp;Transfer&nbsp; &nbsp; &nbsp;Bandwidth<br />[&nbsp; 3]&nbsp; 0.0-10.1 sec&nbsp; 13.4 MBytes&nbsp; 11.2 Mbits/sec</p><p>Guess that removed alotta overhead because now i actualy get the speed i was expecting.</p>											<p class="post-edited">(Last edited by <strong>danny1</strong> on 10 Feb 2012, 12:16)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p156919">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">craigdavids</div>
					<div class="post-datetime">
						10 Feb 2012, 12:57					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><br /><p>I never worked with vtun ethernet tunneling. I have also 2 atheros WIFi-cards in Router1 and Router2.<br />Using the following vtund.conf on the Router1: started with vtund -s -f /etc/vtund.conf<br />options {<br />&nbsp; &nbsp; &nbsp; &nbsp; port 51010;<br />&nbsp; &nbsp; &nbsp; &nbsp; timeout 30;<br />&nbsp; &nbsp; &nbsp; &nbsp; ifconfig /sbin/ifconfig;<br />&nbsp; &nbsp; &nbsp; &nbsp; route /sbin/route;<br />&nbsp; &nbsp; &nbsp; &nbsp; ip /sbin/ip;<br />&nbsp; &nbsp; &nbsp; &nbsp; }</p><p>default {<br />&nbsp; &nbsp; &nbsp; &nbsp; speed 0;<br />&nbsp; &nbsp; &nbsp; &nbsp; encr no;<br />&nbsp; &nbsp; &nbsp; &nbsp; proto tcp;<br />&nbsp; &nbsp; &nbsp; &nbsp; type tun;<br />&nbsp; &nbsp; &nbsp; &nbsp; keepalive yes;<br />&nbsp; &nbsp; &nbsp; &nbsp; multi killold;<br />&nbsp; &nbsp; &nbsp; &nbsp; persist yes;<br />&nbsp; &nbsp; &nbsp; &nbsp; }</p><p>gateway1 {<br />up {<br />&nbsp; &nbsp; &nbsp; &nbsp; ifconfig &quot;%% 192.168.6.1 pointopoint 192.168.6.2 mtu 1450&quot;; wlan0<br />&nbsp; &nbsp; &nbsp; &nbsp; ifconfig &quot;%% 192.168.7.1 pointopoint 192.168.7.2 mtu 1450&quot;; wlan1</p><p>};<br />down {<br />&nbsp; &nbsp; &nbsp; &nbsp; ifconfig &quot;%% down&quot;;<br /> };<br />}</p><p>I do the same on Router2. After this I bond wlan0 and wlan1 but I&#039;m not achieving the same results was you... I&#039;m messing something??<br />Can you give me a tip.</p><p>Regards<br />Craig Davids</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p156926">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">danny1</div>
					<div class="post-datetime">
						10 Feb 2012, 13:48					</div>
				</div>
				<div class="post-content content">
					<p>Okay ill post my complete config<br />Lets say we make one of the 2 boxes the &quot;primary&quot; this one will run ap&#039;s and vtund, the other one will run vtun client and sta mode.</p><p>##########<br />## Server side config<br />##########</p><p>/etc/config/network</p><p>config interface loopback<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname&nbsp; &nbsp;lo<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; static<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr&nbsp; &nbsp;127.0.0.1<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask&nbsp; 255.0.0.0</p><p>config interface lan<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname&nbsp; &nbsp;eth0<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; dhcp</p><p>config interface wireless1<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; static<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr 192.168.6.1<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask 255.255.255.0</p><p>config interface wireless2<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; static<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr 192.168.7.1<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask 255.255.255.0</p><p>/etc/config/wireless</p><p>config wifi-device&nbsp; radio1<br />&nbsp; &nbsp; &nbsp; &nbsp; option type&nbsp; &nbsp; &nbsp;mac80211<br />&nbsp; &nbsp; &nbsp; &nbsp; option channel&nbsp; 1<br />&nbsp; &nbsp; &nbsp; &nbsp; option macaddr&nbsp; 00:04:e2:fb:3f:7c<br />&nbsp; &nbsp; &nbsp; &nbsp; option hwmode&nbsp; &nbsp;11g<br />config wifi-iface<br />&nbsp; &nbsp; &nbsp; &nbsp; option device&nbsp; &nbsp;radio1<br />&nbsp; &nbsp; &nbsp; &nbsp; option mode&nbsp; &nbsp; &nbsp;ap<br />&nbsp; &nbsp; &nbsp; &nbsp; option network&nbsp; wireless1<br />&nbsp; &nbsp; &nbsp; &nbsp; option ssid&nbsp; &nbsp; &nbsp;bonding1<br />&nbsp; &nbsp; &nbsp; &nbsp; option encryption psk<br />&nbsp; &nbsp; &nbsp; &nbsp; option key bonding1</p><p>config wifi-device&nbsp; radio2<br />&nbsp; &nbsp; &nbsp; &nbsp; option type&nbsp; &nbsp; &nbsp;mac80211<br />&nbsp; &nbsp; &nbsp; &nbsp; option channel&nbsp; 11<br />&nbsp; &nbsp; &nbsp; &nbsp; option macaddr&nbsp; 00:04:e2:f7:7c:b0<br />&nbsp; &nbsp; &nbsp; &nbsp; option hwmode&nbsp; &nbsp;11g<br />config wifi-iface<br />&nbsp; &nbsp; &nbsp; &nbsp; option device&nbsp; &nbsp;radio2<br />&nbsp; &nbsp; &nbsp; &nbsp; option mode&nbsp; &nbsp; &nbsp;ap<br />&nbsp; &nbsp; &nbsp; &nbsp; option network&nbsp; wireless2<br />&nbsp; &nbsp; &nbsp; &nbsp; option ssid&nbsp; &nbsp; &nbsp;bonding2<br />&nbsp; &nbsp; &nbsp; &nbsp; option encryption psk<br />&nbsp; &nbsp; &nbsp; &nbsp; option key bonding2</p><p>/etc/vtund.conf</p><p>default {<br />&nbsp; compress no;<br />&nbsp; speed 0;<br />&nbsp; encrypt no;<br />}<br />tun1 {<br />&nbsp; passwd&nbsp; tun1;<br />&nbsp; type&nbsp; ether;<br />&nbsp; device tap1;<br />&nbsp; proto tcp;<br />&nbsp; keepalive yes;<br />}<br />tun2 {<br />&nbsp; passwd&nbsp; tun2;<br />&nbsp; type&nbsp; ether;<br />&nbsp; device tap2;<br />&nbsp; proto tcp;<br />&nbsp; keepalive yes;<br />}</p><p>/etc/rc.local</p><p>sleep 30<br />vtund -s</p><p>sleep 15<br />ifconfig bond0 up 192.168.5.1<br />ifenslave bond0 tap1 tap2<br />exit 0</p><p>##########<br />## Client side config<br />##########</p><p>/etc/config/network.conf</p><p>config interface loopback<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname&nbsp; &nbsp;lo<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; static<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr&nbsp; &nbsp;127.0.0.1<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask&nbsp; 255.0.0.0</p><p>config interface lan<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname&nbsp; &nbsp;eth0<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; dhcp</p><p>config interface wireless1<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; static<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr 192.168.6.2<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask 255.255.255.0</p><p>config interface wireless2<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; static<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr 192.168.7.2<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask 255.255.255.0</p><p>/etc/config/wireless</p><p>config wifi-device&nbsp; radio1<br />&nbsp; &nbsp; &nbsp; &nbsp; option type&nbsp; &nbsp; &nbsp;mac80211<br />&nbsp; &nbsp; &nbsp; &nbsp; option channel&nbsp; 1<br />&nbsp; &nbsp; &nbsp; &nbsp; option macaddr&nbsp; 00:25:86:b2:4c:0e<br />&nbsp; &nbsp; &nbsp; &nbsp; option hwmode&nbsp; &nbsp;11g<br />config wifi-iface<br />&nbsp; &nbsp; &nbsp; &nbsp; option device&nbsp; &nbsp;radio1<br />&nbsp; &nbsp; &nbsp; &nbsp; option mode&nbsp; &nbsp; &nbsp;sta<br />&nbsp; &nbsp; &nbsp; &nbsp; option network&nbsp; wireless1<br />&nbsp; &nbsp; &nbsp; &nbsp; option ssid&nbsp; &nbsp; &nbsp;bonding1<br />&nbsp; &nbsp; &nbsp; &nbsp; option encryption psk<br />&nbsp; &nbsp; &nbsp; &nbsp; option key bonding1</p><p>config wifi-device&nbsp; radio2<br />&nbsp; &nbsp; &nbsp; &nbsp; option type&nbsp; &nbsp; &nbsp;mac80211<br />&nbsp; &nbsp; &nbsp; &nbsp; option channel&nbsp; 14<br />&nbsp; &nbsp; &nbsp; &nbsp; option macaddr&nbsp; 00:C0:CA:33:9D:3A<br />&nbsp; &nbsp; &nbsp; &nbsp; option hwmode&nbsp; &nbsp;11g<br />config wifi-iface<br />&nbsp; &nbsp; &nbsp; &nbsp; option device&nbsp; &nbsp;radio2<br />&nbsp; &nbsp; &nbsp; &nbsp; option mode&nbsp; &nbsp; &nbsp;sta<br />&nbsp; &nbsp; &nbsp; &nbsp; option network&nbsp; wireless2<br />&nbsp; &nbsp; &nbsp; &nbsp; option ssid&nbsp; &nbsp; &nbsp;bonding2<br />&nbsp; &nbsp; &nbsp; &nbsp; option encryption psk<br />&nbsp; &nbsp; &nbsp; &nbsp; option key bonding2</p><p>/etc/vtund.conf</p><p>default {<br />&nbsp; compress no;<br />&nbsp; speed 0;<br />&nbsp; encrypt no;<br />}<br />tun1 {<br />&nbsp; passwd&nbsp; tun1;<br />&nbsp; type&nbsp; ether;<br />&nbsp; device tap1;<br />&nbsp; proto tcp;<br />&nbsp; keepalive yes;<br />}</p><p>tun2 {<br />&nbsp; passwd&nbsp; tun2;<br />&nbsp; type&nbsp; ether;<br />&nbsp; device tap2;<br />&nbsp; proto tcp;<br />&nbsp; keepalive yes;<br />}</p><p>/etc/rc.local</p><p>sleep 30<br />vtund tun1 192.168.6.1<br />vtund tun2 192.168.7.1</p><p>sleep 15<br />ifconfig bond0 up 192.168.5.2<br />ifenslave bond0 tap1 tap2<br />exit 0</p>											<p class="post-edited">(Last edited by <strong>danny1</strong> on 10 Feb 2012, 14:08)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p156928">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">craigdavids</div>
					<div class="post-datetime">
						10 Feb 2012, 14:07					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>@danny1: Thanks a lot, I owe you one... I will test this to...</p><p>If in the future someone need to create more than one bond interfaces it can be done by:<br />It turns out that in /sys/class/net/bonding_masters, you need to have bond1 or bondx listed. If not then a manual bond will fail (and of course so will an automatic bond).<br />So:<br /># echo +bond1 &gt; /sys/class/net/bonding_masters<br /># ifconfig bond1 &lt;IP&gt; netmask &lt;MASK&gt;</p><p>another way is also:<br />#insmod /lib/module/2.6.32.35/bonding.ko mode=1 miimon=100 max_bonds=x (x=1,2,3,4,n)</p><p>Regards,<br />Craig Davids</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p156929">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">danny1</div>
					<div class="post-datetime">
						10 Feb 2012, 14:10					</div>
				</div>
				<div class="post-content content">
					<p>Np cleaned it up a bit now, and added wpa encryption, good luck.<br />You can edit your /etc/modules.d/40-bonding to inset the module with the parms you want <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /><br />You will need to use bonding mode 0 for load balancing, 1 is just active-backup<br />Here the diffrend modes is explained <a href="http://www.linuxhorizon.ro/bonding.html">http://www.linuxhorizon.ro/bonding.html</a><br />My /etc/modules.d/40-bonding looks like this bonding mode=0 miimon=100<br />Note that i just protect my tunnels with a weak password, thats because we are using wpa, then tunnel encryption would just add more overhead and cpu useage</p>											<p class="post-edited">(Last edited by <strong>danny1</strong> on 10 Feb 2012, 14:16)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p159095">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">Kyungrho</div>
					<div class="post-datetime">
						29 Feb 2012, 13:09					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ve just followed your following scripts. But a server cannot communicate to a client. According to your scripts, device interface tap1, tap2 do not seem to be existing as the following:</p><p>root@Hopper:/dev# ifconfig tap1<br />ifconfig: tap1: error fetching interface information: Device not found</p><p>192.168.6.1 &lt;--&gt; 192.168.6.2, 192.168.7.1 &lt;--&gt;192.168.7.2: OK<br />192.168.5.1 and 192.168.5.2 is not connected.</p><p>Do you think your script is also working in an sta-wds mode except a wlan-client (sta) mode?</p><p>Any comments will be very appreciated of.</p><br /><div class="quotebox"><cite>danny1 wrote:</cite><blockquote><p>Okay ill post my complete config<br />Lets say we make one of the 2 boxes the &quot;primary&quot; this one will run ap&#039;s and vtund, the other one will run vtun client and sta mode.</p><p>##########<br />## Server side config<br />##########</p><p>/etc/config/network</p><p>config interface loopback<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname&nbsp; &nbsp;lo<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; static<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr&nbsp; &nbsp;127.0.0.1<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask&nbsp; 255.0.0.0</p><p>config interface lan<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname&nbsp; &nbsp;eth0<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; dhcp</p><p>config interface wireless1<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; static<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr 192.168.6.1<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask 255.255.255.0</p><p>config interface wireless2<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; static<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr 192.168.7.1<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask 255.255.255.0</p><p>/etc/config/wireless</p><p>config wifi-device&nbsp; radio1<br />&nbsp; &nbsp; &nbsp; &nbsp; option type&nbsp; &nbsp; &nbsp;mac80211<br />&nbsp; &nbsp; &nbsp; &nbsp; option channel&nbsp; 1<br />&nbsp; &nbsp; &nbsp; &nbsp; option macaddr&nbsp; 00:04:e2:fb:3f:7c<br />&nbsp; &nbsp; &nbsp; &nbsp; option hwmode&nbsp; &nbsp;11g<br />config wifi-iface<br />&nbsp; &nbsp; &nbsp; &nbsp; option device&nbsp; &nbsp;radio1<br />&nbsp; &nbsp; &nbsp; &nbsp; option mode&nbsp; &nbsp; &nbsp;ap<br />&nbsp; &nbsp; &nbsp; &nbsp; option network&nbsp; wireless1<br />&nbsp; &nbsp; &nbsp; &nbsp; option ssid&nbsp; &nbsp; &nbsp;bonding1<br />&nbsp; &nbsp; &nbsp; &nbsp; option encryption psk<br />&nbsp; &nbsp; &nbsp; &nbsp; option key bonding1</p><p>config wifi-device&nbsp; radio2<br />&nbsp; &nbsp; &nbsp; &nbsp; option type&nbsp; &nbsp; &nbsp;mac80211<br />&nbsp; &nbsp; &nbsp; &nbsp; option channel&nbsp; 11<br />&nbsp; &nbsp; &nbsp; &nbsp; option macaddr&nbsp; 00:04:e2:f7:7c:b0<br />&nbsp; &nbsp; &nbsp; &nbsp; option hwmode&nbsp; &nbsp;11g<br />config wifi-iface<br />&nbsp; &nbsp; &nbsp; &nbsp; option device&nbsp; &nbsp;radio2<br />&nbsp; &nbsp; &nbsp; &nbsp; option mode&nbsp; &nbsp; &nbsp;ap<br />&nbsp; &nbsp; &nbsp; &nbsp; option network&nbsp; wireless2<br />&nbsp; &nbsp; &nbsp; &nbsp; option ssid&nbsp; &nbsp; &nbsp;bonding2<br />&nbsp; &nbsp; &nbsp; &nbsp; option encryption psk<br />&nbsp; &nbsp; &nbsp; &nbsp; option key bonding2</p><p>/etc/vtund.conf</p><p>default {<br />&nbsp; compress no;<br />&nbsp; speed 0;<br />&nbsp; encrypt no;<br />}<br />tun1 {<br />&nbsp; passwd&nbsp; tun1;<br />&nbsp; type&nbsp; ether;<br />&nbsp; device tap1;<br />&nbsp; proto tcp;<br />&nbsp; keepalive yes;<br />}<br />tun2 {<br />&nbsp; passwd&nbsp; tun2;<br />&nbsp; type&nbsp; ether;<br />&nbsp; device tap2;<br />&nbsp; proto tcp;<br />&nbsp; keepalive yes;<br />}</p><p>/etc/rc.local</p><p>sleep 30<br />vtund -s</p><p>sleep 15<br />ifconfig bond0 up 192.168.5.1<br />ifenslave bond0 tap1 tap2<br />exit 0</p><p>##########<br />## Client side config<br />##########</p><p>/etc/config/network.conf</p><p>config interface loopback<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname&nbsp; &nbsp;lo<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; static<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr&nbsp; &nbsp;127.0.0.1<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask&nbsp; 255.0.0.0</p><p>config interface lan<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname&nbsp; &nbsp;eth0<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; dhcp</p><p>config interface wireless1<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; static<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr 192.168.6.2<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask 255.255.255.0</p><p>config interface wireless2<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; static<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr 192.168.7.2<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask 255.255.255.0</p><p>/etc/config/wireless</p><p>config wifi-device&nbsp; radio1<br />&nbsp; &nbsp; &nbsp; &nbsp; option type&nbsp; &nbsp; &nbsp;mac80211<br />&nbsp; &nbsp; &nbsp; &nbsp; option channel&nbsp; 1<br />&nbsp; &nbsp; &nbsp; &nbsp; option macaddr&nbsp; 00:25:86:b2:4c:0e<br />&nbsp; &nbsp; &nbsp; &nbsp; option hwmode&nbsp; &nbsp;11g<br />config wifi-iface<br />&nbsp; &nbsp; &nbsp; &nbsp; option device&nbsp; &nbsp;radio1<br />&nbsp; &nbsp; &nbsp; &nbsp; option mode&nbsp; &nbsp; &nbsp;sta<br />&nbsp; &nbsp; &nbsp; &nbsp; option network&nbsp; wireless1<br />&nbsp; &nbsp; &nbsp; &nbsp; option ssid&nbsp; &nbsp; &nbsp;bonding1<br />&nbsp; &nbsp; &nbsp; &nbsp; option encryption psk<br />&nbsp; &nbsp; &nbsp; &nbsp; option key bonding1</p><p>config wifi-device&nbsp; radio2<br />&nbsp; &nbsp; &nbsp; &nbsp; option type&nbsp; &nbsp; &nbsp;mac80211<br />&nbsp; &nbsp; &nbsp; &nbsp; option channel&nbsp; 14<br />&nbsp; &nbsp; &nbsp; &nbsp; option macaddr&nbsp; 00:C0:CA:33:9D:3A<br />&nbsp; &nbsp; &nbsp; &nbsp; option hwmode&nbsp; &nbsp;11g<br />config wifi-iface<br />&nbsp; &nbsp; &nbsp; &nbsp; option device&nbsp; &nbsp;radio2<br />&nbsp; &nbsp; &nbsp; &nbsp; option mode&nbsp; &nbsp; &nbsp;sta<br />&nbsp; &nbsp; &nbsp; &nbsp; option network&nbsp; wireless2<br />&nbsp; &nbsp; &nbsp; &nbsp; option ssid&nbsp; &nbsp; &nbsp;bonding2<br />&nbsp; &nbsp; &nbsp; &nbsp; option encryption psk<br />&nbsp; &nbsp; &nbsp; &nbsp; option key bonding2</p><p>/etc/vtund.conf</p><p>default {<br />&nbsp; compress no;<br />&nbsp; speed 0;<br />&nbsp; encrypt no;<br />}<br />tun1 {<br />&nbsp; passwd&nbsp; tun1;<br />&nbsp; type&nbsp; ether;<br />&nbsp; device tap1;<br />&nbsp; proto tcp;<br />&nbsp; keepalive yes;<br />}</p><p>tun2 {<br />&nbsp; passwd&nbsp; tun2;<br />&nbsp; type&nbsp; ether;<br />&nbsp; device tap2;<br />&nbsp; proto tcp;<br />&nbsp; keepalive yes;<br />}</p><p>/etc/rc.local</p><p>sleep 30<br />vtund tun1 192.168.6.1<br />vtund tun2 192.168.7.1</p><p>sleep 15<br />ifconfig bond0 up 192.168.5.2<br />ifenslave bond0 tap1 tap2<br />exit 0</p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p160123">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">danny1</div>
					<div class="post-datetime">
						8 Mar 2012, 15:30					</div>
				</div>
				<div class="post-content content">
					<p>I think you forgot to install vtun? <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p><p>Im not sure what you mean with wds, since we&#039;re using tunnels everything that you can do tcp over can be used.<br />Wds should be obsolete its a stupid way to link ap&#039;s, it slows down the entire network, using ap+sta and relayd you can make much better performance.<br />But wds adhoc everything should work, you can also have 3 devices in a mesh network, where mesh1 can se only mesh2, mesh2 can see mesh1 and mesh3 and mesh3 can only see mesh2, you just need to make your vtun servers on mesh2 then and clients on 1 and 3.<br />You need to remember that 2 clients on a tunnel/vpn talk together by using the tunnel server as relay.<br />So in this scenario puttin the vtun server on mesh3 will make mesh1 &lt;-&gt; mesh2 traffic route through mesh3, yeah its a bit confusing with all these layers <img src="https://forum.openwrt.org/img/smilies/tongue.png" width="15" height="15" alt="tongue" /></p>											<p class="post-edited">(Last edited by <strong>danny1</strong> on 8 Mar 2012, 15:46)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p161322">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">Kyungrho</div>
					<div class="post-datetime">
						19 Mar 2012, 08:27					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for your reply.</p><p>Anyway, I can manage to set up the configuration and run it but I cannot get any increasing performance. Worse than the use of individual interface.. Comments, pls.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p178529">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">Amin</div>
					<div class="post-datetime">
						17 Sep 2012, 20:16					</div>
				</div>
				<div class="post-content content">
					<p>Hi everybody,</p><p>I am trying to bond wifi0 (2.4 GHz) and wifi1 (5 GHz) wireless interfaces on NETGEAR WNDR3700 but it messes up the mesh configuration on the router. Based on what I understood from the posts in the forum, I define a new interface &quot;bond0&quot; and then run &quot;ifenslave bond0 [INTERFACE]&quot; for both interfaces but it messes up the mesh routes. If I detach them from bond0, it recovers the the mesh configuration.</p><p>Has anybody done this before? </p><p>Regards,<br />Amin</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>