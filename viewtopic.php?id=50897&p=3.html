<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Tile/Tilera</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 15 Apr 2018 and 22 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 3 of 3</div><nav><ul><li><a href="viewtopic.php%3Fid=50897&amp;p=1.html">1</a></li><li><a href="viewtopic.php%3Fid=50897&amp;p=2.html">2</a></li><li class="pagination-current"><span>3</span></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p320854">
				<div class="post-metadata">
					<div class="post-num">Post #51</div>
					<div class="post-author">HoBoPanda</div>
					<div class="post-datetime">
						22 Apr 2016, 16:47					</div>
				</div>
				<div class="post-content content">
					<p>Nice works Spooky</p><p>Works on CCR1036-8G-2S+ with no Issues all ports show up and can pull a ip but the 10G ports. will boot on a CCR1009-8g-1s-1s+ but you cant use the ether1-4 ports guessing because of the switch chip they have in there for those ports most likely but the other ports work fine.&nbsp; Will boot on a CCR1036-12g-4s but none of the ports show up I can connect a usb network card and that will work.</p><p>All 3 images on all devices will boot for me. I did try a hub but cant get it to work so I can do usb and usb network card on the one that has no networking. I don&#039;t know if this is my hub being bad or a power issue on the port not supplying the current needed to run a usb stick and a usb network interface. </p><p>using these commands i can mount the ubifs drives. </p><p>mkdir /mnt/RouterOS<br />mkdir /mnt/Kernel<br />mount -t ubifs ubi0:Kernel /mnt/Kernel/<br />mount -t ubifs ubi1:RouterOS /mnt/RouterOS/</p><br /><p>I found for the nand image it boots and looks for a ubifs drive with the default name of ubi1:RouterOS. at first I reformatted the drive and renamed it and ran into issues because the names did not match. </p><p>I have not tested the micro-sd card slot did not have a card around at the time. </p><p>I was able to set up the usb stick to boot up with a ip and routes to make it accessible via ssh on a reboot by editing the /etc/rc file and adding in the needed commands to start and set things up on boot. </p><p>Just need to get the thing booting the kernal from internal storage and we can get rid of the need of a tftp server.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p323061">
				<div class="post-metadata">
					<div class="post-num">Post #52</div>
					<div class="post-author">gbirincsik</div>
					<div class="post-datetime">
						9 May 2016, 10:11					</div>
				</div>
				<div class="post-content content">
					<p>Hey Guys,</p><p>I guess I figured out how to bring up the 10G interfaces to be up, I just need someone who helps me to make the whole kernel because based on thomasthomas&#039;s description, I was unable to make it and place the output to the console, however I saw the connection between my 10G switch came up.</p><p>Many thanks.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p323686">
				<div class="post-metadata">
					<div class="post-num">Post #53</div>
					<div class="post-author">loremipsum</div>
					<div class="post-datetime">
						13 May 2016, 15:33					</div>
				</div>
				<div class="post-content content">
					<p>Hi Spooky</p><p>Thanks for sharing your work with us.</p><p>We have a CCR1036-12g-4s and we report the same as HoBoPanda said: it boots fine, but no network interfaces show up at all. Is there anything that can be done about that? We could provide remote access to our machine if it helps in any way.</p><p>Also, we&#039;d love to have tun.ko so we can test VPN performance in this device. If you have it, would you please send it to us?</p><p>We tried compiling kernel 3.17 and it boots fine, but just after we do a &quot;exec /bin/sh&quot; in our init script, the serial port seems not to receive any characters anymore, so we can&#039;t control de machine over the serial port. Any tips?</p><p>Thanks in advance.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p323859">
				<div class="post-metadata">
					<div class="post-num">Post #54</div>
					<div class="post-author">gbirincsik</div>
					<div class="post-datetime">
						14 May 2016, 20:05					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>loremipsum wrote:</cite><blockquote><p>Hi Spooky</p><p>Thanks for sharing your work with us.</p><p>We have a CCR1036-12g-4s and we report the same as HoBoPanda said: it boots fine, but no network interfaces show up at all. Is there anything that can be done about that? We could provide remote access to our machine if it helps in any way.</p><p>Also, we&#039;d love to have tun.ko so we can test VPN performance in this device. If you have it, would you please send it to us?</p><p>We tried compiling kernel 3.17 and it boots fine, but just after we do a &quot;exec /bin/sh&quot; in our init script, the serial port seems not to receive any characters anymore, so we can&#039;t control de machine over the serial port. Any tips?</p><p>Thanks in advance.</p></blockquote></div><p>Hey, </p><p>We may work together to fix this issue. I know how we can build the driver in the kernel, we have issue with puting everything to the console.</p><p>My email address is gbirincsik@gmail.com send me an email and we can work together.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p324093">
				<div class="post-metadata">
					<div class="post-num">Post #55</div>
					<div class="post-author">spooky_boogie</div>
					<div class="post-datetime">
						16 May 2016, 09:24					</div>
				</div>
				<div class="post-content content">
					<p>Hi Loremipsum</p><p>CCR1036-12g-4S is the on-board interface driver is not applicable.<br />To use other models, or please use the USB-LAN.<br />It can be used if the chip set of ASIX AX88772.<br />AX88179 will not be able to use the kernel panic occurs.<br />Even if you build your own kernel, it is possible to ssh connected via USB-LAN.</p>											<p class="post-edited">(Last edited by <strong>spooky_boogie</strong> on 16 May 2016, 09:29)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p324118">
				<div class="post-metadata">
					<div class="post-num">Post #56</div>
					<div class="post-author">gbirincsik</div>
					<div class="post-datetime">
						16 May 2016, 11:44					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>spooky_boogie wrote:</cite><blockquote><p>Hi Loremipsum</p><p>CCR1036-12g-4S is the on-board interface driver is not applicable.<br />To use other models, or please use the USB-LAN.<br />It can be used if the chip set of ASIX AX88772.<br />AX88179 will not be able to use the kernel panic occurs.<br />Even if you build your own kernel, it is possible to ssh connected via USB-LAN.</p></blockquote></div><br /><p>I assume that is possible to resolve it anyway. My problem I am unable to put the output to the console may someone help me with that?</p><p>I used the step by step instruction what was shared here, but no output on the console.</p><p>I have CCR1036-8G-2s+</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p326064">
				<div class="post-metadata">
					<div class="post-num">Post #57</div>
					<div class="post-author">spooky_boogie</div>
					<div class="post-datetime">
						27 May 2016, 07:25					</div>
				</div>
				<div class="post-content content">
					<p>Hello.</p><p>How to use the console in the kernel that you create.</p><p>/etc/inittab<br /> hvc0::respawn:/sbin/getty -L 115200 console<br /> console::respawn:/sbin/getty -L 115200 ttyS0</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p340972">
				<div class="post-metadata">
					<div class="post-num">Post #58</div>
					<div class="post-author">chrisd</div>
					<div class="post-datetime">
						12 Oct 2016, 23:01					</div>
				</div>
				<div class="post-content content">
					<p>Hello, </p><p>is there an update to this?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p350701">
				<div class="post-metadata">
					<div class="post-num">Post #59</div>
					<div class="post-author">mhoohm</div>
					<div class="post-datetime">
						31 Jan 2017, 08:34					</div>
				</div>
				<div class="post-content content">
					<p>Nice Spooky.<br />maby hack working fine.</p><p>-bash-4.3$ cat /proc/meminfo <br />MemTotal:&nbsp; &nbsp; &nbsp; &nbsp; 2003200 kB <br />MemFree:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1775296 kB <br />Buffers:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 9408 kB <br />Cached:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 74240 kB <br />SwapCached:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 kB <br />Active:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 57216 kB <br />Inactive:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 49472 kB <br />Active(anon):&nbsp; &nbsp; &nbsp; 23680 kB <br />Inactive(anon):&nbsp; &nbsp; &nbsp; &nbsp;64 kB <br />Active(file):&nbsp; &nbsp; &nbsp; 33536 kB <br />Inactive(file):&nbsp; &nbsp; 49408 kB <br />Unevictable:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 kB <br />Mlocked:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 kB <br />SwapTotal:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 kB <br />SwapFree:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 kB <br />Dirty:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 64 kB <br />Writeback:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 kB <br />AnonPages:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;23488 kB <br />Mapped:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 17728 kB <br />Shmem:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;576 kB <br />Slab:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 64448 kB <br />SReclaimable:&nbsp; &nbsp; &nbsp; &nbsp;6784 kB <br />SUnreclaim:&nbsp; &nbsp; &nbsp; &nbsp; 57664 kB <br />KernelStack:&nbsp; &nbsp; &nbsp; &nbsp; 6848 kB <br />PageTables:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;8128 kB <br />NFS_Unstable:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 kB <br />Bounce:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 kB <br />WritebackTmp:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 kB <br />CommitLimit:&nbsp; &nbsp; &nbsp;1001600 kB <br />Committed_AS:&nbsp; &nbsp; &nbsp; 30528 kB <br />VmallocTotal:&nbsp; &nbsp; 4194304 kB <br />VmallocUsed:&nbsp; &nbsp; &nbsp; 216576 kB <br />VmallocChunk:&nbsp; &nbsp; 3964864 kB <br />Sequestered:&nbsp; &nbsp; &nbsp; &nbsp; 5312 kB <br />HugePages_Total:&nbsp; &nbsp; &nbsp; &nbsp;0 <br />HugePages_Free:&nbsp; &nbsp; &nbsp; &nbsp; 0 <br />HugePages_Rsvd:&nbsp; &nbsp; &nbsp; &nbsp; 0 <br />HugePages_Surp:&nbsp; &nbsp; &nbsp; &nbsp; 0 <br />Hugepagesize:&nbsp; &nbsp; &nbsp; 16384 kB </p><p>-bash-4.3$ cat /proc/cpuinfo <br />cpu count&nbsp; &nbsp; &nbsp; &nbsp;: 9 <br />cpu list&nbsp; &nbsp; &nbsp; &nbsp; : 0-8 <br />model name&nbsp; &nbsp; &nbsp; : tilegx <br />flags&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: <br />cpu MHz&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: 1000.000000 <br />bogomips&nbsp; &nbsp; &nbsp; &nbsp; : 2000.00 </p><p>processor&nbsp; &nbsp; &nbsp; &nbsp;: 0 </p><p>processor&nbsp; &nbsp; &nbsp; &nbsp;: 1 </p><p>processor&nbsp; &nbsp; &nbsp; &nbsp;: 2 </p><p>processor&nbsp; &nbsp; &nbsp; &nbsp;: 3 </p><p>processor&nbsp; &nbsp; &nbsp; &nbsp;: 4 </p><p>processor&nbsp; &nbsp; &nbsp; &nbsp;: 5 </p><p>processor&nbsp; &nbsp; &nbsp; &nbsp;: 6 </p><p>processor&nbsp; &nbsp; &nbsp; &nbsp;: 7 </p><p>processor&nbsp; &nbsp; &nbsp; &nbsp;: 8 <br />-bash-4.3$</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p350707">
				<div class="post-metadata">
					<div class="post-num">Post #60</div>
					<div class="post-author">mhoohm</div>
					<div class="post-datetime">
						31 Jan 2017, 09:27					</div>
				</div>
				<div class="post-content content">
					<p>now get Unixbench &amp; Runing on CCR1009 </p><p>bash-4.3# ./Run -c 9 dhry2reg<br />make all<br />make[1]: Entering directory &#039;/home/toor/temp/UnixBench&#039;<br />Checking distribution of files<br />./pgms&nbsp; exists<br />./src&nbsp; exists<br />./testdir&nbsp; exists<br />./tmp&nbsp; exists<br />./results&nbsp; exists<br />make[1]: Leaving directory &#039;/home/toor/temp/UnixBench&#039;<br />sh: 3dinfo: command not found</p><p>&nbsp; &nbsp;#&nbsp; &nbsp; #&nbsp; #&nbsp; &nbsp; #&nbsp; #&nbsp; #&nbsp; &nbsp; #&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #####&nbsp; &nbsp;######&nbsp; #&nbsp; &nbsp; #&nbsp; &nbsp;####&nbsp; &nbsp;#&nbsp; &nbsp; #<br />&nbsp; &nbsp;#&nbsp; &nbsp; #&nbsp; ##&nbsp; &nbsp;#&nbsp; #&nbsp; &nbsp;#&nbsp; #&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;#&nbsp; &nbsp; #&nbsp; #&nbsp; &nbsp; &nbsp; &nbsp;##&nbsp; &nbsp;#&nbsp; #&nbsp; &nbsp; #&nbsp; #&nbsp; &nbsp; #<br />&nbsp; &nbsp;#&nbsp; &nbsp; #&nbsp; # #&nbsp; #&nbsp; #&nbsp; &nbsp; ##&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #####&nbsp; &nbsp;#####&nbsp; &nbsp;# #&nbsp; #&nbsp; #&nbsp; &nbsp; &nbsp; &nbsp;######<br />&nbsp; &nbsp;#&nbsp; &nbsp; #&nbsp; #&nbsp; # #&nbsp; #&nbsp; &nbsp; ##&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #&nbsp; &nbsp; #&nbsp; #&nbsp; &nbsp; &nbsp; &nbsp;#&nbsp; # #&nbsp; #&nbsp; &nbsp; &nbsp; &nbsp;#&nbsp; &nbsp; #<br />&nbsp; &nbsp;#&nbsp; &nbsp; #&nbsp; #&nbsp; &nbsp;##&nbsp; #&nbsp; &nbsp;#&nbsp; #&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;#&nbsp; &nbsp; #&nbsp; #&nbsp; &nbsp; &nbsp; &nbsp;#&nbsp; &nbsp;##&nbsp; #&nbsp; &nbsp; #&nbsp; #&nbsp; &nbsp; #<br />&nbsp; &nbsp; ####&nbsp; &nbsp;#&nbsp; &nbsp; #&nbsp; #&nbsp; #&nbsp; &nbsp; #&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #####&nbsp; &nbsp;######&nbsp; #&nbsp; &nbsp; #&nbsp; &nbsp;####&nbsp; &nbsp;#&nbsp; &nbsp; #</p><p>&nbsp; &nbsp;Version 5.1.3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Based on the Byte Magazine Unix Benchmark</p><p>&nbsp; &nbsp;Multi-CPU version&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Version 5 revisions by Ian Smith,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Sunnyvale, CA, USA<br />&nbsp; &nbsp;January 13, 2011&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;johantheghost at yahoo period com</p><p>Wide character in print at ./Run line 1511.<br />Wide character in printf at ./Run line 1542.<br />Use of uninitialized value in printf at ./Run line 1380.<br />Use of uninitialized value in printf at ./Run line 1590.</p><p>9 x Dhrystone 2 using register variables&nbsp; 1 2 3 4 5 6 7 8 9 10<br />Wide character in printf at ./Run line 1484.</p><p>========================================================================<br />&nbsp; &nbsp;BYTE UNIX Benchmarks (Version 5.1.3)</p><p>&nbsp; &nbsp;System: MikroTik: GNU/Linux<br />&nbsp; &nbsp;OS: GNU/Linux -- 3.3.5 -- #4 SMP Fri Jan 27 08:53:53 UTC 2017<br />&nbsp; &nbsp;Machine: tile (unknown)<br />&nbsp; &nbsp;Language: en_US.euc (charmap=&quot;EUC&quot;, collate=&quot;EUC&quot;)<br />&nbsp; &nbsp;CPU 0: tilegx (2000.0 bogomips)</p><p>&nbsp; &nbsp;16:21:09 up&nbsp; 1:55,&nbsp; 2 users,&nbsp; load average: 2.11, 2.34, 2.18; runlevel unknown</p><p>------------------------------------------------------------------------<br />Benchmark Run: Tue Jan 31 2017 16:21:09 - 16:23:21<br />1 CPU in system; running 9 parallel copies of tests</p><p>Dhrystone 2 using register variables&nbsp; &nbsp; &nbsp; &nbsp;24387302.9 lps&nbsp; &nbsp;(10.0 s, 7 samples)</p><p>System Benchmarks Partial Index&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; BASELINE&nbsp; &nbsp; &nbsp; &nbsp;RESULT&nbsp; &nbsp; INDEX<br />Dhrystone 2 using register variables&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;116700.0&nbsp; &nbsp;24387302.9&nbsp; &nbsp;2089.7<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;========<br />System Benchmarks Index Score (Partial Only)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2089.7</p><p>bash-4.3#</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p353646">
				<div class="post-metadata">
					<div class="post-num">Post #61</div>
					<div class="post-author">thomasthomas</div>
					<div class="post-datetime">
						6 Mar 2017, 03:21					</div>
				</div>
				<div class="post-content content">
					<p>Hello @fgrep, nice work the hvfs.py, it helped me a lot understanding the filesystem structure.<br />I made the following (not the most clean code, but it seems to do the job): <a href="http://pastebin.com/bgKuNq6U">http://pastebin.com/bgKuNq6U</a></p><div class="quotebox"><blockquote><p>#!/usr/bin/python</p><p>import sys, os, zlib, io<br />from struct import pack, unpack</p><p>if (len(sys.argv) &gt; 1):<br />&nbsp; &nbsp; hvfsdir&nbsp; = sys.argv[1]<br />else:<br />&nbsp; &nbsp; print &quot;Use: hvfsmaker.py directory&quot;<br />&nbsp; &nbsp; sys.exit(0)</p><p>f = open(&quot;hvfs.fs&quot;, &quot;w+b&quot;)</p><p># Start creating our file<br />f.write(&quot;HvFs&quot;)</p><p>numfiles = 0<br />totsize = 0<br />totlen = 0</p><p>files = []</p><p>banner = &quot;Tilera Hypervisor file system by ME!&quot;<br />totlen += (4 - (len(banner)%4)) + len(banner)</p><p>for name in sorted(os.listdir(hvfsdir)):<br />&nbsp; &nbsp; long = os.path.join(hvfsdir, name)<br />&nbsp; &nbsp; filerealsize = os.stat(long).st_size<br />&nbsp; &nbsp; filesize_align = (4 - (filerealsize%4)) + filerealsize<br />&nbsp; &nbsp; namelen = (4 - (len(name)%4)) + len(name)<br />&nbsp; &nbsp; numfiles += 1<br />&nbsp; &nbsp; totsize += filerealsize<br />&nbsp; &nbsp; totlen += namelen<br />&nbsp; &nbsp; files.append((name,namelen,filesize_align,long,filerealsize))</p><p># (4_HVFS + 16_HEADER + ( 16_INODE * FILES))<br />namebase = 4 + 16 + (16 * numfiles)</p><p># (NAMEBASE + lenght of all filenames, keeping 1 char empty per name)<br />filebase = namebase + totlen</p><p>print &quot;Files to add %d&quot; % numfiles<br />print &quot;Size to add %d&quot; % totsize<br />print &quot;Starting names at %d&quot; % namebase<br />print &quot;Starting files at %d&quot; % filebase</p><p># Leave header empty for now<br />f.seek(16,1)</p><p># Inserting banner, it&#039;s the first entry at namebase<br />currentpos = f.tell()<br />f.seek(namebase,0)<br />f.write(banner)<br />namebase += len(banner)+1<br />f.seek(currentpos,0)</p><p>print &quot;Writing inodes and files&quot;<br />for file in files:<br />&nbsp; &nbsp; print &quot;Injecting file %s:name at %d and file at %d&quot; % (file[0], namebase, filebase)<br />&nbsp; &nbsp; # POS without 4_HVFS ident<br />&nbsp; &nbsp; f.write(pack(&#039;&lt;IIII&#039;, (namebase-4), (filebase-4), file[4], 0))<br />&nbsp; &nbsp; currentpos = f.tell()</p><p>&nbsp; &nbsp; # Put filename in the right place (empty trailer)<br />&nbsp; &nbsp; f.seek(namebase,0)<br />&nbsp; &nbsp; f.write(file[0])</p><p>&nbsp; &nbsp; # Copy data from our file into HVFS<br />&nbsp; &nbsp; f.seek(filebase,0)<br />&nbsp; &nbsp; copy = file[4]<br />&nbsp; &nbsp; f2 = open(file[3],&#039;rb&#039;)<br />&nbsp; &nbsp; while copy:<br />&nbsp; &nbsp; &nbsp; &nbsp; block = min(1024,copy)<br />&nbsp; &nbsp; &nbsp; &nbsp; data = f2.read(block)<br />&nbsp; &nbsp; &nbsp; &nbsp; f.write(data)<br />&nbsp; &nbsp; &nbsp; &nbsp; copy -= block<br />&nbsp; &nbsp; f2.close()</p><p>&nbsp; &nbsp; # Go back for the next file / inode<br />&nbsp; &nbsp; f.seek(currentpos,0)<br />&nbsp; &nbsp; namebase += file[1]<br />&nbsp; &nbsp; filebase += file[2]</p><p>f.seek(0, io.SEEK_END)<br />fsend = f.tell()<br />print &quot;done with inodes and files at %d&quot; % fsend</p><p># FS CRC might need to shift, create empty space if necessary (nasty hack)<br />if (fsend-4)%4 != 0 :<br />&nbsp; &nbsp; fsend += (4 - (fsend-4)%4)<br />&nbsp; &nbsp; f.seek(fsend,0)<br />&nbsp; &nbsp; f.write(pack(&quot;&lt;I&quot;, 0))</p><p># Calculate and write header CRC (pos 5-20, we left this space empty)<br />f.seek(4,0)<br />headercrc = zlib.crc32(pack(&#039;&lt;ccccIII&#039;,&quot;H&quot;, &quot;v&quot;, &quot;F&quot;, &quot;s&quot;, numfiles, (fsend-4), (16 + (16 * numfiles)))) &amp; 0xffffffff<br />f.write(pack(&#039;&lt;IIII&#039;, numfiles, (fsend-4), (16 + (16 * numfiles)), headercrc))</p><p># Filesystem (skip 4_HVFS + 16_HEADER) (end of file)<br />f.seek(20,0)<br />fscrc = zlib.crc32(f.read(fsend-20)) &amp; 0xffffffff<br />f.seek(fsend,0)<br />f.write(pack(&quot;&lt;I&quot;, fscrc))</p><p>print &quot;Header CRC: %X&quot; % headercrc<br />print &quot;Filesystem CRC: %X&quot; % fscrc</p><p>f.close()</p></blockquote></div><p>It&#039;s now more easy to create bootable code (based on the ELF included in @spooky_boogie vmlinux_initramfs, again not very clean but very functional&nbsp; <a href="http://pastebin.com/u91g81zX">http://pastebin.com/u91g81zX</a> ):</p><div class="quotebox"><blockquote><p>#!/bin/bash<br />FILE=&quot;./vmlinux_initramfs&quot;</p><p>poself=`LANG=C grep -b -a -o -P &#039;\x7f\x45\x4c\x46\x02\x01\x01&#039; $FILE | cut -d &quot;:&quot; -f 1`<br />poshvfs=`LANG=C grep -b -a -o -P &#039;\x48\x76\x46\x73&#039; $FILE | cut -d &quot;:&quot; -f 1`<br />dd bs=1 skip=$poself count=$(($poshvfs-$poself)) &lt; $FILE &gt;vmlinux</p><p>cp linux-4.10.1/vmlinux.bz2 hvfs-dir/vmlinux<br />./hvfsmaker.py hvfs-dir/</p><p>cat hvfs.fs &gt;&gt;vmlinux</p><p>headersec=`readelf -a ./vmlinux | grep &quot;Start of section headers&quot; | awk &#039;{print $5}&#039;`<br />cursize=`du -b vmlinux | awk &#039;{print $1}&#039;`<br />dd bs=1 count=$(($headersec-$cursize-200)) &lt;/dev/zero &gt;&gt; vmlinux</p><p>numsec=`readelf -a ./vmlinux | grep &quot;Number of section headers&quot; | awk &#039;{print $5}&#039;`<br />sizesec=`readelf -a ./vmlinux | grep &quot;Size of section headers&quot; | awk &#039;{print $5}&#039;`<br />poselftrailer=`LANG=C grep -b -a -o -P &#039;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x0B\x00\x00\x00\x01\x00\x00\x00&#039; $FILE | cut -d &quot;:&quot; -f 1`</p><p>dd bs=1 skip=$((poselftrailer-200)) count=$((($numsec * $sizesec)+200)) &lt; $FILE &gt;&gt;vmlinux</p></blockquote></div><p>The result should be the vmlinux file that is network bootable for the CCR (tested it with CCR1036 and CCR1072), no need anymore for the manual hvfs checksum fix.<br />I will try to include bigger initramfs images in the coming weeks to get a test environment (my lab contains 2xCCR1036 and 1xCCR1072 for now).</p>											<p class="post-edited">(Last edited by <strong>thomasthomas</strong> on 6 Mar 2017, 03:27)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p353647">
				<div class="post-metadata">
					<div class="post-num">Post #62</div>
					<div class="post-author">josiah2009</div>
					<div class="post-datetime">
						6 Mar 2017, 05:13					</div>
				</div>
				<div class="post-content content">
					<p>Right now I am testing on a CCR1036-8G-2S+. Spooky&#039;s kernel works for me and I am able to use the ethernet ports.</p><p>I was able to disassemble and figure out what Spooky&#039;s kernel did for the most part.<br />I am able to read the PHY ID on the first four ports now and I am able to get the link status. Newer kernel sources include a driver for the PHY, I am able to attach the PHY to the interface and it seems to read/set the link status properly. I am still working on figuring out how to get mPIPE sending properly. Right now the interface comes up but the PHY driver complains about the SGMII link not being up. From what I am reading, that is due to the MAC registers on the mPIPE side not being configured properly.</p><p>The built in functions to enumerate the interfaces via the hypervisor work. The code needs patched to call gxio_mpipe_init before enumeration. This still does not allow the driver to work. Code needs to be implemented to add an mdio interface for the PHY. I will be releasing my code shortly for this. It still needs more work and is very rough. The PHY/MAC index returned by the gxio_mpipe_link_open function works for the first four interfaces but after that it does not seem to work for accessing the PHYs. I was able to brute force the index/address of the PHY device but I have no way of matching each PHY to each mPIPE interface. Spooky&#039;s kernel seemed to have a lookup table of sorts that matched board name to a list of interfaces and a list of PHY IDs.</p><p>EDIT: I just finished up working on the PHY code and we actually have a link and packets moving! The SFP+ interface is still not working but it will just need a PHY driver written for it. They use the AMCC QT2025 PHY for the SFP+ interfaces. I will be releasing my patches for the kernel soon. I am currently building kernel 4.10.1 and I have ported the important patches over from the mikrotik 3.3.5 kernel. Looking to see if I can get MicroSD working shortly and then maybe even the LCD <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /></p>											<p class="post-edited">(Last edited by <strong>josiah2009</strong> on 6 Mar 2017, 07:57)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p356468">
				<div class="post-metadata">
					<div class="post-num">Post #63</div>
					<div class="post-author">thomasthomas</div>
					<div class="post-datetime">
						17 Apr 2017, 18:17					</div>
				</div>
				<div class="post-content content">
					<p>I made a more convenient building environment, this should help people to try this at home.</p><p>Small modified version of npk packet extractor ( <a href="https://pastebin.com/pKDjvrDa">https://pastebin.com/pKDjvrDa</a> ) , header is dynamic (references are different between platforms and routeros versions). We do not care about any other file besides the kernel. Not going to spend more time on this:</p><div class="quotebox"><blockquote><p>$:/usr/src/ccrdev/keep# ../tools/dumpnpkkernel.py routeros-tile-6.38.3.npk <br />Dsize: 50<br />Kernel files in package:<br />-&gt; boot/kernel1<br />$:/usr/src/ccrdev/keep#</p></blockquote></div><p>Remember, this is the outer kernel, including the Tilera HV and Mikrotik software.</p><p>Within the /usr/src/ccrdev/src I have some important directories &amp; files:<br />1) initramfs/, cross-compiled busybox including some devices, init scripts, ... </p><p>2) hvfs-dir/, used during the building of our image, contains 3 important files.<br />- config : you are able to modify some of the HV configuration, like exposed devices. It seems to be loaded, but not sure on all the possible options. ( <a href="https://pastebin.com/eJUSJ4iR">https://pastebin.com/eJUSJ4iR</a> ) <br />- vmlinux : the inner kernel (bzip2&#039;ed)<br />- initramfs.cpio.gz : cpio version of our initramfs</p><p>3) kernel sources &amp; tilegx toolset ( <a href="http://www.mellanox.com/repository/solutions/tile-scm/tilegx-x86_64.tar.bz2">http://www.mellanox.com/repository/solu … 64.tar.bz2</a> ), export.source file (to be loaded &#039;source /usr/src/ccrdev/src/export.source&#039; before compiling your kernel: <a href="https://pastebin.com/535Z6jJz">https://pastebin.com/535Z6jJz</a> )</p><p>If your kernel is ready (vmlinux) and your initramfs is populated, use this script to build (build.sh, just keep it on the /usr/src/ccrdev/src/ : <a href="https://pastebin.com/EmL575J0">https://pastebin.com/EmL575J0</a> ) </p><p>I have made the following scripts to make hvfs and to fix the final elf file (size, section headers, ...). This way we are not limited to the mikrotik outer kernel size (I even have images of 25mb booting fine)</p><p>/usr/src/ccrdev/tools/hvfsmaker.py : <a href="https://pastebin.com/Yz9RkXuw">https://pastebin.com/Yz9RkXuw</a></p><p>/usr/src/ccrdev/tools/elf_shmove.py : <a href="https://pastebin.com/N7PP78zU">https://pastebin.com/N7PP78zU</a></p><p>/usr/src/ccrdev/tools/elf_shput.py : <a href="https://pastebin.com/rMNFmfkv">https://pastebin.com/rMNFmfkv</a></p><br /><p>The build script will do most of the logic (copy &amp; bzip the kernel, making the initramfs file, populate the hvfs-dir and include it into the image), as result you should have 1 file: /usr/src/ccrdev/src/vmlinux that can be used for tftp boot on your CCR.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p356469">
				<div class="post-metadata">
					<div class="post-num">Post #64</div>
					<div class="post-author">thomasthomas</div>
					<div class="post-datetime">
						17 Apr 2017, 18:18					</div>
				</div>
				<div class="post-content content">
					<p>Just for fun we will extract some more stuff (if you only are building custom kernels you can skip these steps):</p><p>1) once to have the filesystem (/lib/modules/3.3.5) <br /></p><div class="quotebox"><blockquote><p>$:/usr/src/ccrdev/keep# binwalk -e routeros-tile-6.38.3.npk </p><p>DECIMAL&nbsp; &nbsp; &nbsp; &nbsp;HEXADECIMAL&nbsp; &nbsp; &nbsp;DESCRIPTION<br />--------------------------------------------------------------------------------<br />65536&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x10000&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Squashfs filesystem, little endian, version 4.0, compression:xz, size: 12089735 bytes, 1063 inodes, blocksize: 262144 bytes, created: 2017-02-07 10:39:08<br />12157063&nbsp; &nbsp; &nbsp; 0xB98087&nbsp; &nbsp; &nbsp; &nbsp; Executable script, shebang: &quot;/bin/bash&quot;<br />...<br />16395851&nbsp; &nbsp; &nbsp; 0xFA2E4B&nbsp; &nbsp; &nbsp; &nbsp; Unix path: /var/pdb/system/crcbin</p><p>$:/usr/src/ccrdev/keep# ls _routeros-tile-6.38.3.npk.extracted/squashfs-root/lib/modules/3.3.5/<br />drivers&nbsp; kernel&nbsp; misc&nbsp; modules.dep.system&nbsp; net<br />$:/usr/src/ccrdev/keep#</p></blockquote></div><p>2) once to have the inner kernel (this one is doing the work: <a href="https://raw.githubusercontent.com/torvalds/linux/master/scripts/extract-vmlinux">https://raw.githubusercontent.com/torva … ct-vmlinux</a> ). You can use it like any other custom compiled kernel in the later scripts to test all the building steps.<br /></p><div class="quotebox"><blockquote><p>$:/usr/src/ccrdev/keep# binwalk boot/kernel1&nbsp; | grep -A 1 bzip2<br />723238&nbsp; &nbsp; &nbsp; &nbsp; 0xB0926&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;bzip2 compressed data, block size = 900k<br />2807494&nbsp; &nbsp; &nbsp; &nbsp;0x2AD6C6&nbsp; &nbsp; &nbsp; &nbsp; xz compressed data<br />$:/usr/src/ccrdev/keep# <br />$:/usr/src/ccrdev/keep# dd if=boot/kernel1 bs=1 skip=723238 count=$((2807494-723238)) &gt; step1<br />2084256+0 records in<br />2084256+0 records out<br />2084256 bytes (2.1 MB, 2.0 MiB) copied, 2.63633 s, 791 kB/s<br />$:/usr/src/ccrdev/keep# ../tools/extract-vmlinux step1 &gt; mtvmlinux<br />$:/usr/src/ccrdev/keep# rm step1<br />$:/usr/src/ccrdev/keep#</p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p356471">
				<div class="post-metadata">
					<div class="post-num">Post #65</div>
					<div class="post-author">thomasthomas</div>
					<div class="post-datetime">
						17 Apr 2017, 18:40					</div>
				</div>
				<div class="post-content content">
					<p>I also tried to get networking up based on MT&#039;s patches and a linux 3.3.5 kernel(+ the /lib/modules, extracted out of the NPK):</p><p><a href="https://github.com/wsxarcher/routeros-linux-patch">https://github.com/wsxarcher/routeros-linux-patch</a></p><p>First it looked promising (booting, almost all modules can be loaded), but: </p><p>The patch is incomplete:<br />1) Missing a function called &quot;per_cpu_port_ifindex&quot;, it should be included within the kernel (mt&#039;s inner kernel has traces of it). Required by the net/tilegx.ko </p><p>I have made the following modifications to the ./arch/tile/rb/setup.c<br /></p><div class="quotebox"><blockquote><p>void per_cpu_port_ifindex(void) {<br />&nbsp; &nbsp; &nbsp; &nbsp; printk(&quot;per_cpu_port_ifindex\n&quot;);<br />}<br />EXPORT_SYMBOL(per_cpu_port_ifindex);</p></blockquote></div><p>This will allow the kernel modules to be all loaded, the function is never called (don&#039;t see any trace of the printk in the dmesg).</p><div class="quotebox"><blockquote><p>insmod /lib/modules/3.3.5/kernel/net/netfilter/nf_conntrack.ko<br />insmod /lib/modules/3.3.5/drivers/net/packet_hook.ko<br />insmod /lib/modules/3.3.5/drivers/net/phy_helper.ko<br />insmod /lib/modules/3.3.5/drivers/net/phy_amcc_qt2025.ko<br />insmod /lib/modules/3.3.5/drivers/net/phy_ti_tlk10232.ko<br />insmod /lib/modules/3.3.5/drivers/net/switch.ko<br />insmod /lib/modules/3.3.5/drivers/net/tilegx.ko</p></blockquote></div><div class="quotebox"><blockquote><p>/ # lsmod<br />tilegx 75830 0 - Live 0xfffffff7101b0000<br />switch 44765 1 tilegx, Live 0xfffffff710170000<br />phy_ti_tlk10232 6729 1 tilegx, Live 0xfffffff710130000<br />phy_amcc_qt2025 36145 1 tilegx, Live 0xfffffff7100f0000<br />phy_helper 24575 4 tilegx,switch,phy_ti_tlk10232,phy_amcc_qt2025, Live 0xfffffff7100b0000<br />packet_hook 175073 2 tilegx,switch, Live 0xfffffff710050000<br />nf_conntrack 71658 1 packet_hook, Live 0xfffffff710000000<br />/ #</p></blockquote></div><p>2) Lots of interfaces now, getting -1161 error (status up/down works, no packets are being forwarded). Something is still different compared to the mt&#039;s inner kernel (not just kernel module stuff)</p><div class="quotebox"><blockquote><p>[ 1635.501980] tile mpipe0: clsq_hwm:1023 num_blocks:1536 cutthrough:80<br />[ 1635.501988] tile mpipe0: hw_tx_queue_count:24<br />[ 1635.501995] tile mpipe0: notif_ring_count:256<br />[ 1635.502002] tile mpipe0: notif_group_count:32<br />[ 1635.502009] tile mpipe0: bucket_count:4160<br />[ 1635.502016] tile mpipe0: 1g devs: 8, 10g devs: 2<br />......<br />[ 1658.992279] eth9: open gbe<br />[ 1658.992288] eth9: do open phy:1<br />[ 1658.992316] eth9: equeue_size:8192 per_cpu_tx_queue_size:227 (max:8172)<br />[ 1658.992564] tilegx: gxio_mpipe_rules_commit failed: -1161<br />[ 1660.752476] eth9: phy link up (1000/full)</p></blockquote></div><p>Long list: <a href="https://pastebin.com/Ljkas4CX">https://pastebin.com/Ljkas4CX</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p361139">
				<div class="post-metadata">
					<div class="post-num">Post #66</div>
					<div class="post-author">vpritiskovic</div>
					<div class="post-datetime">
						28 Jun 2017, 19:39					</div>
				</div>
				<div class="post-content content">
					<p>@spooky_boogie<br />Hi, are you still involved with porting linux to this target?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p365462">
				<div class="post-metadata">
					<div class="post-num">Post #67</div>
					<div class="post-author">dconnrt</div>
					<div class="post-datetime">
						16 Sep 2017, 18:35					</div>
				</div>
				<div class="post-content content">
					<p>Hi everyone, Do any of you have instructions on building the kernel image to try out on a CCR1036 or any pre-build binaries (Spooky&#039;s kernel?).&nbsp; &nbsp;thanks, Derek</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p368120">
				<div class="post-metadata">
					<div class="post-num">Post #68</div>
					<div class="post-author">spooky_boogie</div>
					<div class="post-datetime">
						12 Nov 2017, 12:12					</div>
				</div>
				<div class="post-content content">
					<p>Hi All,<br />It is original RPM package.<br />please try it.<br />150.95.184.119/RPMS/</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p368884">
				<div class="post-metadata">
					<div class="post-num">Post #69</div>
					<div class="post-author">mhoohm</div>
					<div class="post-datetime">
						27 Nov 2017, 06:07					</div>
				</div>
				<div class="post-content content">
					<p>spooky_boogie ,</p><p>thx rep.<br />plz send email haha .<br />mhoohm(g.y)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p371045">
				<div class="post-metadata">
					<div class="post-num">Post #70</div>
					<div class="post-author">wbx@openadk.org</div>
					<div class="post-datetime">
						20 Jan 2018, 12:24					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>is there any progress supporting these routers?<br />Does anyone want to sell a device for hacking purpose?</p><p>best regards<br /> Waldemar</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 3 of 3</div><nav><ul><li><a href="viewtopic.php%3Fid=50897&amp;p=1.html">1</a></li><li><a href="viewtopic.php%3Fid=50897&amp;p=2.html">2</a></li><li class="pagination-current"><span>3</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>