<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> ImageBuilder w/ custom MTD layout or rootfs= option</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 27 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p336212">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">rmurch</div>
					<div class="post-datetime">
						28 Aug 2016, 11:33					</div>
				</div>
				<div class="post-content content">
					<p>I am almost able to get OpenWrt running on an Edimax BR-6478AC V2. I have 15.05.01 kernel booting OK but can not mount root &quot;/&quot;.</p><div class="codebox"><pre><code>[    0.910000] m25p80 spi32766.0: found mx25l6405d, expected en25q64
[    0.920000] m25p80 spi32766.0: mx25l6405d (8192 Kbytes)
[    0.930000] 4 ofpart partitions found on MTD device spi32766.0
[    0.940000] Creating 4 MTD partitions on &quot;spi32766.0&quot;:
[    0.950000] 0x000000000000-0x000000030000 : &quot;u-boot&quot;
[    0.960000] 0x000000030000-0x000000040000 : &quot;u-boot-env&quot;
[    0.980000] 0x000000040000-0x000000050000 : &quot;factory&quot;
[    0.990000] 0x000000050000-0x000000800000 : &quot;firmware&quot;</code></pre></div><div class="codebox"><pre><code>[    1.240000] VFS: Cannot open root device &quot;(null)&quot; or unknown-block(0,0): error -6
[    1.250000] Please append a correct &quot;root=&quot; boot option; here are the available partitions:
[    1.270000] 1f00             192 mtdblock0  (driver?)
[    1.280000] 1f01              64 mtdblock1  (driver?)
[    1.290000] 1f02              64 mtdblock2  (driver?)
[    1.300000] 1f03            7872 mtdblock3  (driver?)
[    1.310000] Kernel panic - not syncing: VFS: Unable to mount root fs on unknown-block(0,0)
[    1.310000] ---[ end Kernel panic - not syncing: VFS: Unable to mount root fs on unknown-block(0,0)</code></pre></div><br /><p>I have download ImageBuilder and build a custom image for mt7620A that boots, but I can not find how to modify the MTD layout or set a kernel boot option roofs=1f03.</p><p>Any help much appreciated!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p336222">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">MBS</div>
					<div class="post-datetime">
						28 Aug 2016, 13:37					</div>
				</div>
				<div class="post-content content">
					<p>You miss at least 2 partitons: kernel and rootfs (usually, there will even be rootfs_data, but that is determined automatically by scanning through rootfs). These 2 partitions are located within the firmware partition, size and position are passed over using the boot options. You need to post the full bootlog for more help.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p336249">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">rmurch</div>
					<div class="post-datetime">
						28 Aug 2016, 18:35					</div>
				</div>
				<div class="post-content content">
					<p>I have created a new target profile using ImageBuilder and have created the same partition layout as the original firmware reported, so &quot;Kernel&quot; and &quot;RootFS&quot; are now at the same addresses as before (is this correct?).</p><p>Passing the root=1f05 points to the same RootFS as before, but I am now getting a new JFFS2 error. From the output of the &quot;make image&quot; it looks like it only creates a squashfs. There is a boot option &quot;rootfstype=squashfs,jffs2&quot; that I can not find in the sources to remove, even after grep&#039;ing.</p><p>So I am not sure if there truly is a jffs2 filesystem or squashfs at RootFS.</p><p>Anyone familiar with the following jffs2 boot errors?</p><div class="codebox"><pre><code>## Booting image at bc070000 ...
raspi_read: from:70000 len:40 
Magic number at 0xBC070000 
raspi_read: from:70014 len:40 
   Image Name:   MIPS OpenWrt Linux-3.18.23
   Image Type:   MIPS Linux Kernel Image (lzma compressed)
   Data Size:    1179598 Bytes =  1.1 MB
   Load Address: 80000000
   Entry Point:  80000000
raspi_read: from:70054 len:11ffce 
   Uncompressing Kernel Image ... OK
No initrd
## Transferring control to Linux (at address 80000000) ...
## Giving linux memsize in MB, 64

Starting kernel ...

[    0.000000] Linux version 3.18.23 (buildbot@builder1) (gcc version 4.8.3 (OpenWrt/Linaro GCC 4.8-2014.04 r47269) ) #1 Sun Jan 31 14:11:59 CET 2016
[    0.000000] Board has DDR2
[    0.000000] Analog PMU set to hw control
[    0.000000] Digital PMU set to hw control
[    0.000000] SoC Type: MediaTek MT7620A ver:2 eco:6
[    0.000000] bootconsole [early0] enabled
[    0.000000] CPU0 revision is: 00019650 (MIPS 24KEc)
[    0.000000] MIPS: machine is Edimax BR-6478AC V2
[    0.000000] Determined physical RAM map:
[    0.000000]  memory: 04000000 @ 00000000 (usable)
[    0.000000] Initrd not found or empty - disabling initrd
[    0.000000] Zone ranges:
[    0.000000]   Normal   [mem 0x00000000-0x03ffffff]
[    0.000000] Movable zone start for each node
[    0.000000] Early memory node ranges
[    0.000000]   node   0: [mem 0x00000000-0x03ffffff]
[    0.000000] Initmem setup node 0 [mem 0x00000000-0x03ffffff]
[    0.000000] Primary instruction cache 64kB, VIPT, 4-way, linesize 32 bytes.
[    0.000000] Primary data cache 32kB, 4-way, PIPT, no aliases, linesize 32 bytes
[    0.000000] Built 1 zonelists in Zone order, mobility grouping on.  Total pages: 16256
[    0.000000] Kernel command line: console=ttyS0,57600 root=1f05 rootfstype=squashfs,jffs2
[    0.000000] PID hash table entries: 256 (order: -2, 1024 bytes)
[    0.000000] Dentry cache hash table entries: 8192 (order: 3, 32768 bytes)
[    0.000000] Inode-cache hash table entries: 4096 (order: 2, 16384 bytes)
[    0.000000] Writing ErrCtl register=00014003
[    0.000000] Readback ErrCtl register=00014003
[    0.000000] Memory: 61228K/65536K available (2622K kernel code, 129K rwdata, 528K rodata, 168K init, 190K bss, 4308K reserved)
[    0.000000] SLUB: HWalign=32, Order=0-3, MinObjects=0, CPUs=1, Nodes=1
[    0.000000] NR_IRQS:256
[    0.000000] CPU Clock: 580MHz
[    0.000000] systick: running - mult: 214748, shift: 32
[    0.010000] Calibrating delay loop... 385.84 BogoMIPS (lpj=1929216)
[    0.070000] pid_max: default: 32768 minimum: 301
[    0.070000] Mount-cache hash table entries: 1024 (order: 0, 4096 bytes)
[    0.080000] Mountpoint-cache hash table entries: 1024 (order: 0, 4096 bytes)
[    0.090000] pinctrl core: initialized pinctrl subsystem
[    0.100000] NET: Registered protocol family 16
[    0.430000] PCI host bridge /pcie@10140000 ranges:
[    0.440000]  MEM 0x0000000020000000..0x000000002fffffff
[    0.450000]   IO 0x0000000010160000..0x000000001016ffff
[    0.460000] rt2880_gpio 10000600.gpio: registering 24 gpios
[    0.470000] rt2880_gpio 10000600.gpio: registering 24 irq handlers
[    0.480000] PCI host bridge to bus 0000:00
[    0.480000] pci_bus 0000:00: root bus resource [mem 0x20000000-0x2fffffff]
[    0.490000] pci_bus 0000:00: root bus resource [io  0xffffffff]
[    0.500000] pci_bus 0000:00: No busn resource found for root bus, will use [bus 00-ff]
[    0.510000] pci 0000:00:00.0: bridge configuration invalid ([bus 00-00]), reconfiguring
[    0.520000] pci 0000:00:00.0: BAR 0: no space for [mem size 0x80000000]
[    0.530000] pci 0000:00:00.0: BAR 0: failed to assign [mem size 0x80000000]
[    0.540000] pci 0000:00:00.0: BAR 8: assigned [mem 0x20000000-0x200fffff]
[    0.550000] pci 0000:00:00.0: BAR 9: assigned [mem 0x20100000-0x201fffff pref]
[    0.560000] pci 0000:00:00.0: BAR 1: assigned [mem 0x20200000-0x2020ffff]
[    0.570000] pci 0000:01:00.0: BAR 0: assigned [mem 0x20000000-0x200fffff 64bit]
[    0.580000] pci 0000:01:00.0: BAR 6: assigned [mem 0x20100000-0x2010ffff pref]
[    0.590000] pci 0000:00:00.0: PCI bridge to [bus 01]
[    0.590000] pci 0000:00:00.0:   bridge window [mem 0x20000000-0x200fffff]
[    0.600000] pci 0000:00:00.0:   bridge window [mem 0x20100000-0x201fffff pref]
[    0.610000] pci 0000:00:00.0: card - bus=0x0, slot = 0x0 irq=0
[    0.620000] pci 0000:01:00.0: card - bus=0x1, slot = 0x0 irq=4
[    0.630000] Switched to clocksource systick
[    0.640000] NET: Registered protocol family 2
[    0.640000] TCP established hash table entries: 1024 (order: 0, 4096 bytes)
[    0.660000] TCP bind hash table entries: 1024 (order: 0, 4096 bytes)
[    0.670000] TCP: Hash tables configured (established 1024 bind 1024)
[    0.680000] TCP: reno registered
[    0.690000] UDP hash table entries: 256 (order: 0, 4096 bytes)
[    0.700000] UDP-Lite hash table entries: 256 (order: 0, 4096 bytes)
[    0.710000] NET: Registered protocol family 1
[    0.720000] rt-timer 10000100.timer: maximum frequency is 2441Hz
[    0.740000] futex hash table entries: 256 (order: -1, 3072 bytes)
[    0.760000] squashfs: version 4.0 (2009/01/31) Phillip Lougher
[    0.770000] jffs2: version 2.2 (NAND) (SUMMARY) (LZMA) (RTIME) (CMODE_PRIORITY) (c) 2001-2006 Red Hat, Inc.
[    0.790000] msgmni has been set to 119
[    0.800000] io scheduler noop registered
[    0.800000] io scheduler deadline registered (default)
[    0.820000] Serial: 8250/16550 driver, 16 ports, IRQ sharing enabled
[    0.830000] console [ttyS0] disabled
[    0.840000] 10000c00.uartlite: ttyS0 at MMIO 0x10000c00 (irq = 20, base_baud = 2500000) is a 16550A
[    0.860000] console [ttyS0] enabled
[    0.860000] console [ttyS0] enabled
[    0.870000] bootconsole [early0] disabled
[    0.870000] bootconsole [early0] disabled
[    0.910000] m25p80 spi32766.0: mx25l6405d (8192 Kbytes)
[    0.920000] 6 ofpart partitions found on MTD device spi32766.0
[    0.930000] Creating 6 MTD partitions on &quot;spi32766.0&quot;:
[    0.940000] 0x000000000000-0x000000030000 : &quot;u-boot&quot;
[    0.950000] 0x000000030000-0x000000040000 : &quot;u-boot-env&quot;
[    0.960000] 0x000000040000-0x000000050000 : &quot;factory&quot;
[    0.980000] 0x000000050000-0x000000070000 : &quot;Cimage&quot;
[    0.990000] 0x000000070000-0x000000190000 : &quot;Kernel&quot;
[    1.000000] 0x000000190000-0x0000007e0000 : &quot;RootFS&quot;
[    1.010000] ralink_soc_eth 10100000.ethernet: generated random MAC address d2:9b:0f:9d:66:ab
[    1.030000] libphy: mdio: probed
[    1.040000] ralink_soc_eth 10100000.ethernet: connected port 4 to PHY at mdio-bus:04 [uid=03a2940d, driver=Generic PHY]
[    1.060000] ralink_soc_eth 10100000.ethernet: loaded mt7620 driver
[    1.070000] ralink_soc_eth 10100000.ethernet eth0: ralink at 0xb0100000, irq 5
[    1.090000] rt2880_wdt 10000120.watchdog: Initialized
[    1.100000] TCP: cubic registered
[    1.110000] NET: Registered protocol family 17
[    1.110000] bridge: automatic filtering via arp/ip/ip6tables has been deprecated. Update your scripts to load br_netfilter if you need this.
[    1.140000] Bridge firewalling registered
[    1.150000] 8021q: 802.1Q VLAN Support v1.8
[    1.160000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00000000: 0xc291 instead
^@^@^@^@^@^@^@^@[    1.180000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00000004: 0x492c instead
^@^@^@^@^@^@^@^@[    1.200000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00000008: 0x34d8 instead
^@^@^@^@^@^@^@^@[    1.230000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x0000000c: 0x7b5b instead
^@^@^@^@^@^@^@^@[    1.250000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00000010: 0x8851 instead
^@^@^@^@^@^@^@^@[    1.270000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00000014: 0xedb3 instead
^@^@^@^@^@^@^@^@[    1.290000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00000018: 0x94be instead
^@^@^@^@^@^@^@^@[    1.310000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x0000001c: 0x301d instead</code></pre></div><br /><p>Is there any way to confirm what partitions of what sizes are built into the image before flashing? How can I confirm that the MTD partitions I create use the same addresses as the original firmware, or that proper filesystems exist at the address I expect?</p><p>Should I just calculate the size of the new kernel and set the RootFS MTD address to be the next block in the firmware after the kernel? Will the kernel partition automatically pad its size to the start of the RootFS partition set in the ImageBuilder profile .dts ?</p><p>With the original firmware there was a final partition called &quot;Freespace&quot; that used that last 20,000 blocks, I have not created it, is this ok?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p336270">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">rmurch</div>
					<div class="post-datetime">
						28 Aug 2016, 21:09					</div>
				</div>
				<div class="post-content content">
					<p>After many attempts I am almost ready to give up. I just can not get rootfs to mount, or to find a valid filesystem. The kernel is about 1.1MB and I have tried allowing 1.3MB even 2M and still it can not find a valid rootfs after the kernel.</p><p>I need to know exactly where the rootfs starts within the ImageBuilder image that is built, so I know the MTD address matches the size and location of the rootfs.</p><p>Otherwise I am not what else to do next.</p><div class="codebox"><pre><code>Starting kernel ...

[    0.000000] Linux version 3.18.23 (buildbot@builder1) (gcc version 4.8.3 (OpenWrt/Linaro GCC 4.8-2014.04 r476
[    0.000000] Board has DDR2
[    0.000000] Analog PMU set to hw control
[    0.000000] Digital PMU set to hw control
[    0.000000] SoC Type: MediaTek MT7620A ver:2 eco:6
[    0.000000] bootconsole [early0] enabled
[    0.000000] CPU0 revision is: 00019650 (MIPS 24KEc)
[    0.000000] MIPS: machine is Edimax BR-6478AC V2
[    0.000000] Determined physical RAM map:
[    0.000000]  memory: 04000000 @ 00000000 (usable)
[    0.000000] Initrd not found or empty - disabling initrd
[    0.000000] Zone ranges:
[    0.000000]   Normal   [mem 0x00000000-0x03ffffff]
[    0.000000] Movable zone start for each node
[    0.000000] Early memory node ranges
[    0.000000]   node   0: [mem 0x00000000-0x03ffffff]
[    0.000000] Initmem setup node 0 [mem 0x00000000-0x03ffffff]
[    0.000000] Primary instruction cache 64kB, VIPT, 4-way, linesize 32 bytes.
[    0.000000] Primary data cache 32kB, 4-way, PIPT, no aliases, linesize 32 bytes
[    0.000000] Built 1 zonelists in Zone order, mobility grouping on.  Total pages: 16256
[    0.000000] Kernel command line: console=ttyS0,57600 root=1f05 rootfstype=squashfs,jffs2
[    0.000000] PID hash table entries: 256 (order: -2, 1024 bytes)
[    0.000000] Dentry cache hash table entries: 8192 (order: 3, 32768 bytes)
[    0.000000] Inode-cache hash table entries: 4096 (order: 2, 16384 bytes)
[    0.000000] Writing ErrCtl register=00014003
[    0.000000] Readback ErrCtl register=00014003
[    0.000000] Memory: 61228K/65536K available (2622K kernel code, 129K rwdata, 528K rodata, 168K init, 190K bs)
[    0.000000] SLUB: HWalign=32, Order=0-3, MinObjects=0, CPUs=1, Nodes=1
[    0.000000] NR_IRQS:256
[    0.000000] CPU Clock: 580MHz
[    0.000000] systick: running - mult: 214748, shift: 32
[    0.010000] Calibrating delay loop... 385.84 BogoMIPS (lpj=1929216)
[    0.070000] pid_max: default: 32768 minimum: 301
[    0.070000] Mount-cache hash table entries: 1024 (order: 0, 4096 bytes)
[    0.080000] Mountpoint-cache hash table entries: 1024 (order: 0, 4096 bytes)
[    0.090000] pinctrl core: initialized pinctrl subsystem
[    0.100000] NET: Registered protocol family 16
[    0.430000] PCI host bridge /pcie@10140000 ranges:
[    0.440000]  MEM 0x0000000020000000..0x000000002fffffff
[    0.450000]   IO 0x0000000010160000..0x000000001016ffff
[    0.460000] rt2880_gpio 10000600.gpio: registering 24 gpios
[    0.470000] rt2880_gpio 10000600.gpio: registering 24 irq handlers
[    0.480000] PCI host bridge to bus 0000:00
[    0.480000] pci_bus 0000:00: root bus resource [mem 0x20000000-0x2fffffff]
[    0.490000] pci_bus 0000:00: root bus resource [io  0xffffffff]
[    0.500000] pci_bus 0000:00: No busn resource found for root bus, will use [bus 00-ff]
[    0.510000] pci 0000:00:00.0: bridge configuration invalid ([bus 00-00]), reconfiguring
[    0.520000] pci 0000:00:00.0: BAR 0: no space for [mem size 0x80000000]
[    0.530000] pci 0000:00:00.0: BAR 0: failed to assign [mem size 0x80000000]
[    0.540000] pci 0000:00:00.0: BAR 8: assigned [mem 0x20000000-0x200fffff]
[    0.550000] pci 0000:00:00.0: BAR 9: assigned [mem 0x20100000-0x201fffff pref]
[    0.560000] pci 0000:00:00.0: BAR 1: assigned [mem 0x20200000-0x2020ffff]
[    0.570000] pci 0000:01:00.0: BAR 0: assigned [mem 0x20000000-0x200fffff 64bit]
[    0.580000] pci 0000:01:00.0: BAR 6: assigned [mem 0x20100000-0x2010ffff pref]
[    0.590000] pci 0000:00:00.0: PCI bridge to [bus 01]
[    0.590000] pci 0000:00:00.0:   bridge window [mem 0x20000000-0x200fffff]
[    0.600000] pci 0000:00:00.0:   bridge window [mem 0x20100000-0x201fffff pref]
[    0.610000] pci 0000:00:00.0: card - bus=0x0, slot = 0x0 irq=0
[    0.620000] pci 0000:01:00.0: card - bus=0x1, slot = 0x0 irq=4
[    0.630000] Switched to clocksource systick
[    0.640000] NET: Registered protocol family 2
[    0.640000] TCP established hash table entries: 1024 (order: 0, 4096 bytes)
[    0.660000] TCP bind hash table entries: 1024 (order: 0, 4096 bytes)
[    0.670000] TCP: Hash tables configured (established 1024 bind 1024)
[    0.680000] TCP: reno registered
[    0.690000] UDP hash table entries: 256 (order: 0, 4096 bytes)
[    0.700000] UDP-Lite hash table entries: 256 (order: 0, 4096 bytes)
[    0.710000] NET: Registered protocol family 1
[    0.720000] rt-timer 10000100.timer: maximum frequency is 2441Hz
[    0.740000] futex hash table entries: 256 (order: -1, 3072 bytes)
[    0.760000] squashfs: version 4.0 (2009/01/31) Phillip Lougher
[    0.770000] jffs2: version 2.2 (NAND) (SUMMARY) (LZMA) (RTIME) (CMODE_PRIORITY) (c) 2001-2006 Red Hat, Inc.
[    0.790000] msgmni has been set to 119
[    0.800000] io scheduler noop registered
[    0.800000] io scheduler deadline registered (default)
[    0.820000] Serial: 8250/16550 driver, 16 ports, IRQ sharing enabled
[    0.830000] console [ttyS0] disabled
[    0.840000] 10000c00.uartlite: ttyS0 at MMIO 0x10000c00 (irq = 20, base_baud = 2500000) is a 16550A
[    0.860000] console [ttyS0] enabled
[    0.860000] console [ttyS0] enabled
[    0.870000] bootconsole [early0] disabled
[    0.870000] bootconsole [early0] disabled
[    0.910000] m25p80 spi32766.0: mx25l6405d (8192 Kbytes)
[    0.920000] 6 ofpart partitions found on MTD device spi32766.0
[    0.930000] Creating 6 MTD partitions on &quot;spi32766.0&quot;:
[    0.940000] 0x000000000000-0x000000030000 : &quot;u-boot&quot;
[    0.950000] 0x000000030000-0x000000040000 : &quot;u-boot-env&quot;
[    0.960000] 0x000000040000-0x000000050000 : &quot;factory&quot;
[    0.980000] 0x000000050000-0x000000070000 : &quot;cimage&quot;
[    0.990000] 0x000000070000-0x000000800000 : &quot;firmware&quot;
[    1.090000] 0x000000270000-0x000000800000 : &quot;rootfs&quot;
[    1.100000] mtd: device 5 (rootfs) set to be root filesystem
[    1.110000] mtdsplit: no squashfs found in &quot;rootfs&quot;
[    1.120000] mtdsplit: no squashfs found in &quot;spi32766.0&quot;
[    1.130000] ralink_soc_eth 10100000.ethernet: generated random MAC address e2:01:b2:fc:7e:53
[    1.150000] libphy: mdio: probed
[    1.160000] ralink_soc_eth 10100000.ethernet: connected port 4 to PHY at mdio-bus:04 [uid=03a2940d, driver=G]
[    1.180000] ralink_soc_eth 10100000.ethernet: loaded mt7620 driver
[    1.190000] ralink_soc_eth 10100000.ethernet eth0: ralink at 0xb0100000, irq 5
[    1.210000] rt2880_wdt 10000120.watchdog: Initialized
[    1.220000] TCP: cubic registered
[    1.220000] NET: Registered protocol family 17
[    1.230000] bridge: automatic filtering via arp/ip/ip6tables has been deprecated. Update your scripts to loa.
[    1.260000] Bridge firewalling registered
[    1.270000] 8021q: 802.1Q VLAN Support v1.8
[    1.280000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00000000: 0x4a73 instead
[    1.300000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00000004: 0xc7a0 instead
[    1.320000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00000008: 0xebf4 instead
[    1.340000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x0000000c: 0xfc30 instead
[    1.360000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00000010: 0xc2e1 instead</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p336274">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">MBS</div>
					<div class="post-datetime">
						28 Aug 2016, 22:11					</div>
				</div>
				<div class="post-content content">
					<p>I have had a closer look into it and would guess, that it would be better to start over properly. That said, checkout the sources of trunk and make the appropriate changes in the way of <a href="https://github.com/openwrt/openwrt/commit/ffaee94bac564f21df4e6759c09894ba4c63a825">this added device</a>.<br />Also check the history of each changed file, in case things have been reworked lately. You may even use LEDE instead, as it has seen more maintenance, lately.<br />The ramips architecture is also using DeviceTree for configuration, which means my previous comment about using boot options is obsolete.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p336280">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">elektroman</div>
					<div class="post-datetime">
						28 Aug 2016, 22:59					</div>
				</div>
				<div class="post-content content">
					<p>Hi this is your layout<br /></p><div class="codebox"><pre><code>0x000000000000-0x000000030000 : &quot;uboot&quot;
0x000000030000-0x000000040000 : &quot;uboot-env&quot;
0x000000040000-0x000000050000 : &quot;factory&quot;
0x000000050000-0x000000070000 : &quot;cimage&quot;
0x000000070000-0x000000800000 : &quot;firmware&quot;</code></pre></div><p>kernel and rootfs layout are calculated during boot.<br />To more precise OpenWRT uses kernel+squashfs in one partition<br />and recalculate other partition sizes.<br />firmware = kernel + rootfs<br />overlay (rootfs_data) after firmware</p><p>In the previous post you see a link pointing to the DTS file<br />which has only 4 partitions.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p336306">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">rmurch</div>
					<div class="post-datetime">
						29 Aug 2016, 05:04					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>MBS wrote:</cite><blockquote><p>I have had a closer look into it and would guess, that it would be better to start over properly. That said, checkout the sources of trunk and make the appropriate changes in the way of <a href="https://github.com/openwrt/openwrt/commit/ffaee94bac564f21df4e6759c09894ba4c63a825">this added device</a>.</p></blockquote></div><p>I have repeated the above steps and have a new target profile called BR-6478AC-V2, I had only half done this step before. The build is much more cleaner, and the edimax tool now also builds a factory-ready image. Image grew from 3.1M to 3.9M.</p><p>I have defined the &quot;firmware&quot; MTD partition in target/linux/ramips/dts/BR-6478AC-V2.dts from the start of the kernel 0x070000, to the end of the flash device (8M). I did hope the kernel would find the rootfs automatically during boot, but I seem to be stuck with the same error.</p><p>Without rootfs= boot option<br /></p><div class="codebox"><pre><code>Starting kernel ...

[    0.000000] Linux version 3.18.23 (buildbot@builder1) (gcc version 4.8.3 (OpenWrt/Linaro GCC 4.8-2014.04 r47269) ) 6
[    0.000000] Board has DDR2
[    0.000000] Analog PMU set to hw control
[    0.000000] Digital PMU set to hw control
[    0.000000] SoC Type: MediaTek MT7620A ver:2 eco:6
[    0.000000] bootconsole [early0] enabled
[    0.000000] CPU0 revision is: 00019650 (MIPS 24KEc)
[    0.000000] MIPS: machine is Edimax BR-6478AC V2
[    0.000000] Determined physical RAM map:
[    0.000000]  memory: 04000000 @ 00000000 (usable)
[    0.000000] Initrd not found or empty - disabling initrd
[    0.000000] Zone ranges:
[    0.000000]   Normal   [mem 0x00000000-0x03ffffff]
[    0.000000] Movable zone start for each node
[    0.000000] Early memory node ranges
[    0.000000]   node   0: [mem 0x00000000-0x03ffffff]
[    0.000000] Initmem setup node 0 [mem 0x00000000-0x03ffffff]
[    0.000000] Primary instruction cache 64kB, VIPT, 4-way, linesize 32 bytes.
[    0.000000] Primary data cache 32kB, 4-way, PIPT, no aliases, linesize 32 bytes
[    0.000000] Built 1 zonelists in Zone order, mobility grouping on.  Total pages: 16256
[    0.000000] Kernel command line: console=ttyS0,57600 rootfstype=squashfs,jffs2
[    0.000000] PID hash table entries: 256 (order: -2, 1024 bytes)
[    0.000000] Dentry cache hash table entries: 8192 (order: 3, 32768 bytes)
[    0.000000] Inode-cache hash table entries: 4096 (order: 2, 16384 bytes)
[    0.000000] Writing ErrCtl register=000426ce
[    0.000000] Readback ErrCtl register=000426ce
[    0.000000] Memory: 61228K/65536K available (2622K kernel code, 129K rwdata, 528K rodata, 168K init, 190K bss, 4308)
[    0.000000] SLUB: HWalign=32, Order=0-3, MinObjects=0, CPUs=1, Nodes=1
[    0.000000] NR_IRQS:256
[    0.000000] CPU Clock: 580MHz
[    0.000000] systick: running - mult: 214748, shift: 32
[    0.010000] Calibrating delay loop... 385.84 BogoMIPS (lpj=1929216)
[    0.070000] pid_max: default: 32768 minimum: 301
[    0.070000] Mount-cache hash table entries: 1024 (order: 0, 4096 bytes)
[    0.080000] Mountpoint-cache hash table entries: 1024 (order: 0, 4096 bytes)
[    0.090000] pinctrl core: initialized pinctrl subsystem
[    0.100000] NET: Registered protocol family 16
[    0.430000] PCI host bridge /pcie@10140000 ranges:
[    0.440000]  MEM 0x0000000020000000..0x000000002fffffff
[    0.450000]   IO 0x0000000010160000..0x000000001016ffff
[    0.460000] rt2880_gpio 10000600.gpio: registering 24 gpios
[    0.470000] rt2880_gpio 10000600.gpio: registering 24 irq handlers
[    0.480000] PCI host bridge to bus 0000:00
[    0.480000] pci_bus 0000:00: root bus resource [mem 0x20000000-0x2fffffff]
[    0.490000] pci_bus 0000:00: root bus resource [io  0xffffffff]
[    0.500000] pci_bus 0000:00: No busn resource found for root bus, will use [bus 00-ff]
[    0.510000] pci 0000:00:00.0: bridge configuration invalid ([bus 00-00]), reconfiguring
[    0.520000] pci 0000:00:00.0: BAR 0: no space for [mem size 0x80000000]
[    0.530000] pci 0000:00:00.0: BAR 0: failed to assign [mem size 0x80000000]
[    0.540000] pci 0000:00:00.0: BAR 8: assigned [mem 0x20000000-0x200fffff]
[    0.550000] pci 0000:00:00.0: BAR 9: assigned [mem 0x20100000-0x201fffff pref]
[    0.560000] pci 0000:00:00.0: BAR 1: assigned [mem 0x20200000-0x2020ffff]
[    0.570000] pci 0000:01:00.0: BAR 0: assigned [mem 0x20000000-0x200fffff 64bit]
[    0.580000] pci 0000:01:00.0: BAR 6: assigned [mem 0x20100000-0x2010ffff pref]
[    0.590000] pci 0000:00:00.0: PCI bridge to [bus 01]
[    0.590000] pci 0000:00:00.0:   bridge window [mem 0x20000000-0x200fffff]
[    0.600000] pci 0000:00:00.0:   bridge window [mem 0x20100000-0x201fffff pref]
[    0.610000] pci 0000:00:00.0: card - bus=0x0, slot = 0x0 irq=0
[    0.620000] pci 0000:01:00.0: card - bus=0x1, slot = 0x0 irq=4
[    0.630000] Switched to clocksource systick
[    0.640000] NET: Registered protocol family 2
[    0.640000] TCP established hash table entries: 1024 (order: 0, 4096 bytes)
[    0.660000] TCP bind hash table entries: 1024 (order: 0, 4096 bytes)
[    0.670000] TCP: Hash tables configured (established 1024 bind 1024)
[    0.680000] TCP: reno registered
[    0.690000] UDP hash table entries: 256 (order: 0, 4096 bytes)
[    0.700000] UDP-Lite hash table entries: 256 (order: 0, 4096 bytes)
[    0.710000] NET: Registered protocol family 1
[    0.720000] rt-timer 10000100.timer: maximum frequency is 2441Hz
[    0.740000] futex hash table entries: 256 (order: -1, 3072 bytes)
[    0.760000] squashfs: version 4.0 (2009/01/31) Phillip Lougher
[    0.770000] jffs2: version 2.2 (NAND) (SUMMARY) (LZMA) (RTIME) (CMODE_PRIORITY) (c) 2001-2006 Red Hat, Inc.
[    0.790000] msgmni has been set to 119
[    0.800000] io scheduler noop registered
[    0.800000] io scheduler deadline registered (default)
[    0.820000] Serial: 8250/16550 driver, 16 ports, IRQ sharing enabled
[    0.830000] console [ttyS0] disabled
[    0.840000] 10000c00.uartlite: ttyS0 at MMIO 0x10000c00 (irq = 20, base_baud = 2500000) is a 16550A
[    0.860000] console [ttyS0] enabled
[    0.860000] console [ttyS0] enabled
[    0.870000] bootconsole [early0] disabled
[    0.870000] bootconsole [early0] disabled
[    0.910000] m25p80 spi32766.0: mx25l6405d (8192 Kbytes)
[    0.920000] 5 ofpart partitions found on MTD device spi32766.0
[    0.930000] Creating 5 MTD partitions on &quot;spi32766.0&quot;:
[    0.940000] 0x000000000000-0x000000030000 : &quot;u-boot&quot;
[    0.950000] 0x000000030000-0x000000040000 : &quot;u-boot-env&quot;
[    0.960000] 0x000000040000-0x000000050000 : &quot;factory&quot;
[    0.980000] 0x000000050000-0x000000070000 : &quot;cimage&quot;
[    0.990000] 0x000000070000-0x000000800000 : &quot;firmware&quot;
[    1.090000] ralink_soc_eth 10100000.ethernet: generated random MAC address 16:fb:74:1a:3a:8f
[    1.110000] libphy: mdio: probed
[    1.110000] ralink_soc_eth 10100000.ethernet: connected port 4 to PHY at mdio-bus:04 [uid=03a2940d, driver=Generic ]
[    1.140000] ralink_soc_eth 10100000.ethernet: loaded mt7620 driver
[    1.150000] ralink_soc_eth 10100000.ethernet eth0: ralink at 0xb0100000, irq 5
[    1.160000] rt2880_wdt 10000120.watchdog: Initialized
[    1.170000] TCP: cubic registered
[    1.180000] NET: Registered protocol family 17
[    1.190000] bridge: automatic filtering via arp/ip/ip6tables has been deprecated. Update your scripts to load br_ne.
[    1.220000] Bridge firewalling registered
[    1.220000] 8021q: 802.1Q VLAN Support v1.8
[    1.240000] VFS: Cannot open root device &quot;(null)&quot; or unknown-block(0,0): error -6
[    1.250000] Please append a correct &quot;root=&quot; boot option; here are the available partitions:
[    1.270000] 1f00             192 mtdblock0  (driver?)
[    1.280000] 1f01              64 mtdblock1  (driver?)
[    1.290000] 1f02              64 mtdblock2  (driver?)
[    1.300000] 1f03             128 mtdblock3  (driver?)
[    1.310000] 1f04            7744 mtdblock4  (driver?)
[    1.320000] Kernel panic - not syncing: VFS: Unable to mount root fs on unknown-block(0,0)
[    1.320000] ---[ end Kernel panic - not syncing: VFS: Unable to mount root fs on unknown-block(0,0)</code></pre></div><br /><p>With rootfs=1f04 (firmware partition address, where else?)<br /></p><div class="codebox"><pre><code>Starting kernel ...

[    0.000000] Linux version 3.18.23 (buildbot@builder1) (gcc version 4.8.3 (OpenWrt/Linaro GCC 4.8-2014.04 r47269) ) 6
[    0.000000] Board has DDR2
[    0.000000] Analog PMU set to hw control
[    0.000000] Digital PMU set to hw control
[    0.000000] SoC Type: MediaTek MT7620A ver:2 eco:6
[    0.000000] bootconsole [early0] enabled
[    0.000000] CPU0 revision is: 00019650 (MIPS 24KEc)
[    0.000000] MIPS: machine is Edimax BR-6478AC V2
[    0.000000] Determined physical RAM map:
[    0.000000]  memory: 04000000 @ 00000000 (usable)
[    0.000000] Initrd not found or empty - disabling initrd
[    0.000000] Zone ranges:
[    0.000000]   Normal   [mem 0x00000000-0x03ffffff]
[    0.000000] Movable zone start for each node
[    0.000000] Early memory node ranges
[    0.000000]   node   0: [mem 0x00000000-0x03ffffff]
[    0.000000] Initmem setup node 0 [mem 0x00000000-0x03ffffff]
[    0.000000] Primary instruction cache 64kB, VIPT, 4-way, linesize 32 bytes.
[    0.000000] Primary data cache 32kB, 4-way, PIPT, no aliases, linesize 32 bytes
[    0.000000] Built 1 zonelists in Zone order, mobility grouping on.  Total pages: 16256
[    0.000000] Kernel command line: console=ttyS0,57600 root=1f04 rootfstype=squashfs,jffs2
[    0.000000] PID hash table entries: 256 (order: -2, 1024 bytes)
[    0.000000] Dentry cache hash table entries: 8192 (order: 3, 32768 bytes)
[    0.000000] Inode-cache hash table entries: 4096 (order: 2, 16384 bytes)
[    0.000000] Writing ErrCtl register=000426c8
[    0.000000] Readback ErrCtl register=000426c8
[    0.000000] Memory: 61228K/65536K available (2622K kernel code, 129K rwdata, 528K rodata, 168K init, 190K bss, 4308)
[    0.000000] SLUB: HWalign=32, Order=0-3, MinObjects=0, CPUs=1, Nodes=1
[    0.000000] NR_IRQS:256
[    0.000000] CPU Clock: 580MHz
[    0.000000] systick: running - mult: 214748, shift: 32
[    0.010000] Calibrating delay loop... 385.84 BogoMIPS (lpj=1929216)
[    0.070000] pid_max: default: 32768 minimum: 301
[    0.070000] Mount-cache hash table entries: 1024 (order: 0, 4096 bytes)
[    0.080000] Mountpoint-cache hash table entries: 1024 (order: 0, 4096 bytes)
[    0.090000] pinctrl core: initialized pinctrl subsystem
[    0.100000] NET: Registered protocol family 16
[    0.430000] PCI host bridge /pcie@10140000 ranges:
[    0.440000]  MEM 0x0000000020000000..0x000000002fffffff
[    0.450000]   IO 0x0000000010160000..0x000000001016ffff
[    0.460000] rt2880_gpio 10000600.gpio: registering 24 gpios
[    0.470000] rt2880_gpio 10000600.gpio: registering 24 irq handlers
[    0.480000] PCI host bridge to bus 0000:00
[    0.480000] pci_bus 0000:00: root bus resource [mem 0x20000000-0x2fffffff]
[    0.490000] pci_bus 0000:00: root bus resource [io  0xffffffff]
[    0.500000] pci_bus 0000:00: No busn resource found for root bus, will use [bus 00-ff]
[    0.510000] pci 0000:00:00.0: bridge configuration invalid ([bus 00-00]), reconfiguring
[    0.520000] pci 0000:00:00.0: BAR 0: no space for [mem size 0x80000000]
[    0.530000] pci 0000:00:00.0: BAR 0: failed to assign [mem size 0x80000000]
[    0.540000] pci 0000:00:00.0: BAR 8: assigned [mem 0x20000000-0x200fffff]
[    0.550000] pci 0000:00:00.0: BAR 9: assigned [mem 0x20100000-0x201fffff pref]
[    0.560000] pci 0000:00:00.0: BAR 1: assigned [mem 0x20200000-0x2020ffff]
[    0.570000] pci 0000:01:00.0: BAR 0: assigned [mem 0x20000000-0x200fffff 64bit]
[    0.580000] pci 0000:01:00.0: BAR 6: assigned [mem 0x20100000-0x2010ffff pref]
[    0.590000] pci 0000:00:00.0: PCI bridge to [bus 01]
[    0.590000] pci 0000:00:00.0:   bridge window [mem 0x20000000-0x200fffff]
[    0.600000] pci 0000:00:00.0:   bridge window [mem 0x20100000-0x201fffff pref]
[    0.610000] pci 0000:00:00.0: card - bus=0x0, slot = 0x0 irq=0
[    0.620000] pci 0000:01:00.0: card - bus=0x1, slot = 0x0 irq=4
[    0.630000] Switched to clocksource systick
[    0.640000] NET: Registered protocol family 2
[    0.640000] TCP established hash table entries: 1024 (order: 0, 4096 bytes)
[    0.660000] TCP bind hash table entries: 1024 (order: 0, 4096 bytes)
[    0.670000] TCP: Hash tables configured (established 1024 bind 1024)
[    0.680000] TCP: reno registered
[    0.690000] UDP hash table entries: 256 (order: 0, 4096 bytes)
[    0.700000] UDP-Lite hash table entries: 256 (order: 0, 4096 bytes)
[    0.710000] NET: Registered protocol family 1
[    0.720000] rt-timer 10000100.timer: maximum frequency is 2441Hz
[    0.740000] futex hash table entries: 256 (order: -1, 3072 bytes)
[    0.760000] squashfs: version 4.0 (2009/01/31) Phillip Lougher
[    0.770000] jffs2: version 2.2 (NAND) (SUMMARY) (LZMA) (RTIME) (CMODE_PRIORITY) (c) 2001-2006 Red Hat, Inc.
[    0.790000] msgmni has been set to 119
[    0.800000] io scheduler noop registered
[    0.800000] io scheduler deadline registered (default)
[    0.820000] Serial: 8250/16550 driver, 16 ports, IRQ sharing enabled
[    0.830000] console [ttyS0] disabled
[    0.840000] 10000c00.uartlite: ttyS0 at MMIO 0x10000c00 (irq = 20, base_baud = 2500000) is a 16550A
[    0.860000] console [ttyS0] enabled
[    0.860000] console [ttyS0] enabled
[    0.870000] bootconsole [early0] disabled
[    0.870000] bootconsole [early0] disabled
[    0.910000] m25p80 spi32766.0: mx25l6405d (8192 Kbytes)
[    0.920000] 5 ofpart partitions found on MTD device spi32766.0
[    0.930000] Creating 5 MTD partitions on &quot;spi32766.0&quot;:
[    0.940000] 0x000000000000-0x000000030000 : &quot;u-boot&quot;
[    0.950000] 0x000000030000-0x000000040000 : &quot;u-boot-env&quot;
[    0.960000] 0x000000040000-0x000000050000 : &quot;factory&quot;
[    0.980000] 0x000000050000-0x000000070000 : &quot;cimage&quot;
[    0.990000] 0x000000070000-0x000000800000 : &quot;firmware&quot;
[    1.090000] ralink_soc_eth 10100000.ethernet: generated random MAC address ae:a6:36:91:60:36
[    1.110000] libphy: mdio: probed
[    1.110000] ralink_soc_eth 10100000.ethernet: connected port 4 to PHY at mdio-bus:04 [uid=03a2940d, driver=Generic ]
[    1.140000] ralink_soc_eth 10100000.ethernet: loaded mt7620 driver
[    1.150000] ralink_soc_eth 10100000.ethernet eth0: ralink at 0xb0100000, irq 5
[    1.160000] rt2880_wdt 10000120.watchdog: Initialized
[    1.170000] TCP: cubic registered
[    1.180000] NET: Registered protocol family 17
[    1.190000] bridge: automatic filtering via arp/ip/ip6tables has been deprecated. Update your scripts to load br_ne.
[    1.220000] Bridge firewalling registered
[    1.220000] 8021q: 802.1Q VLAN Support v1.8
[    1.240000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00000000: 0x5343 instead
[    1.260000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x0000000c: 0x4e52 instead
[    1.280000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00000010: 0xce0e instead
[    1.300000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00000014: 0x0527 instead
[    1.310000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00000018: 0xed1f instead
[    1.330000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x0000001c: 0xc357 instead
[    1.350000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00000020: 0x1200 instead
[    1.370000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00000024: 0x0080 instead
[    1.390000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00000028: 0x0080 instead
[    1.410000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x0000002c: 0x2fae instead
[    1.430000] jffs2: Further such events for this erase block will not be printed</code></pre></div><br /><p>target/linux/ramips/dts/BR-6478AC-V2.dts<br /></p><div class="codebox"><pre><code>/dts-v1/;

/include/ &quot;mt7620a.dtsi&quot;

/ {
    compatible = &quot;ralink,mt7620a-eval-board&quot;, &quot;ralink,mt7620a-soc&quot;;
    model = &quot;Edimax BR-6478AC V2&quot;;

    chosen {
                //bootargs = &quot;console=ttyS0,57600 console=ttyS1,57600n8 root=1f05&quot;;
                //bootargs = &quot;console=ttyS0,57600 root=1f05 rootfstype=squashfs&quot;;
                bootargs = &quot;console=ttyS0,57600 root=1f04&quot;;
        };

    palmbus@10000000 {
        spi@b00 {
            status = &quot;okay&quot;;

            m25p80@0 {
                #address-cells = &lt;1&gt;;
                #size-cells = &lt;1&gt;;
                compatible = &quot;mx25l6405d&quot;;
                reg = &lt;0 0&gt;;
                linux,modalias = &quot;m25p80&quot;, &quot;mx25l6405d&quot;;
                spi-max-frequency = &lt;10000000&gt;;

                partition@0 {
                    label = &quot;u-boot&quot;;
                    reg = &lt;0x0 0x30000&gt;;
                    read-only;
                };

                partition@30000 {
                    label = &quot;u-boot-env&quot;;
                    reg = &lt;0x30000 0x10000&gt;;
                    read-only;
                };

                factory: partition@40000 {
                    label = &quot;factory&quot;;
                    reg = &lt;0x40000 0x10000&gt;;
                    read-only;
                };

                partition@50000 {
                    label = &quot;cimage&quot;;
                    reg = &lt;0x50000 0x20000&gt;;
                    read-only;
                };

                //partition@170000 {
                //    reg = &lt;0x00270000 0x00590000&gt;;
                //    label = &quot;rootfs&quot;;
                //};

                partition@70000 {
                                reg = &lt;0x00070000 0x00790000&gt;;
                                label = &quot;firmware&quot;;
                };


            };
        };
               // uart@500 { // edimax ttyS0
               //         compatible = &quot;ralink,mt7620a-uart&quot;, &quot;ralink,rt2880-uart&quot;, &quot;ns16550a&quot;;
               //         reg = &lt;0x500 0x100&gt;;
               //         resets = &lt;&amp;rstctrl 12&gt;;
               //         reset-names = &quot;uart&quot;;
               //         interrupt-parent = &lt;&amp;intc&gt;;
               //         interrupts = &lt;5&gt;;
               //         reg-shift = &lt;2&gt;;
               //         //status = &quot;enabled&quot;;
               // };
               //uartlite@c00 { // edimax ttyS1
               //         compatible = &quot;ralink,mt7620a-uart&quot;, &quot;ralink,rt2880-uart&quot;, &quot;ns16550a&quot;;
               //         reg = &lt;0xc00 0x100&gt;;
               //         resets = &lt;&amp;rstctrl 19&gt;;
               //         reset-names = &quot;uartl&quot;;
               //         interrupt-parent = &lt;&amp;intc&gt;;
               //         interrupts = &lt;12&gt;;
               //         reg-shift = &lt;2&gt;;
               //         pinctrl-names = &quot;default&quot;;
               //         pinctrl-0 = &lt;&amp;uartlite_pins&gt;;
               // };



    };

    pinctrl {
        state_default: pinctrl0 {
            gpio {
                ralink,group = &quot;i2c&quot;, &quot;uartf&quot;;
                ralink,function = &quot;gpio&quot;;
            };
        };
    };

    ethernet@10100000 {
        status = &quot;okay&quot;;

        pinctrl-names = &quot;default&quot;;
        pinctrl-0 = &lt;&amp;rgmii1_pins &amp;rgmii2_pins &amp;mdio_pins&gt;;

        ralink,port-map = &quot;llllw&quot;;

        port@4 {
            status = &quot;okay&quot;;
            phy-mode = &quot;rgmii&quot;;
            phy-handle = &lt;&amp;phy4&gt;;
        };

        port@5 {
            status = &quot;okay&quot;;
            phy-mode = &quot;rgmii&quot;;
            phy-handle = &lt;&amp;phy5&gt;;
        };

        mdio-bus {
            status = &quot;okay&quot;;

            phy4: ethernet-phy@4 {
                reg = &lt;4&gt;;
                phy-mode = &quot;rgmii&quot;;
            };

            phy5: ethernet-phy@5 {
                reg = &lt;5&gt;;
                phy-mode = &quot;rgmii&quot;;
            };
        };
    };

    gsw@10110000 {
        ralink,port4 = &quot;gmac&quot;;
    };

    sdhci@10130000 {
        status = &quot;okay&quot;;
    };

    pcie@10140000 {
        status = &quot;okay&quot;;
    };

    gpio-leds {
        compatible = &quot;gpio-leds&quot;;
        power {
            label = &quot;br-6478ac-v2:white:power&quot;;
            gpios = &lt;&amp;gpio1 15 1&gt;;
        };
        wlan {
            label = &quot;br-6478ac-v2:blue:wlan&quot;;
            gpios = &lt;&amp;gpio3 0 1&gt;;
        };
    };


    gpio-keys-polled {
        compatible = &quot;gpio-keys&quot;;
        #address-cells = &lt;1&gt;;
        #size-cells = &lt;0&gt;;
        poll-interval = &lt;20&gt;;
        s2 {
            label = &quot;S2&quot;;
            gpios = &lt;&amp;gpio0 1 1&gt;;
            linux,code = &lt;0x100&gt;;
        };
        s3 {
            label = &quot;S3&quot;;
            gpios = &lt;&amp;gpio0 2 1&gt;;
            linux,code = &lt;0x101&gt;;
        };
    };

    ehci@101c0000 {
        status = &quot;okay&quot;;
    };

    ohci@101c1000 {
        status = &quot;okay&quot;;
    };
};</code></pre></div><p>Once again, any help will be most greatly appreciated.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p336307">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">rmurch</div>
					<div class="post-datetime">
						29 Aug 2016, 05:11					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>elektroman wrote:</cite><blockquote><p>Hi this is your layout<br /></p><div class="codebox"><pre><code>0x000000000000-0x000000030000 : &quot;uboot&quot;
0x000000030000-0x000000040000 : &quot;uboot-env&quot;
0x000000040000-0x000000050000 : &quot;factory&quot;
0x000000050000-0x000000070000 : &quot;cimage&quot;
0x000000070000-0x000000800000 : &quot;firmware&quot;</code></pre></div><p>kernel and rootfs layout are calculated during boot.<br />To more precise OpenWRT uses kernel+squashfs in one partition<br />and recalculate other partition sizes.<br />firmware = kernel + rootfs<br />overlay (rootfs_data) after firmware</p><p>In the previous post you see a link pointing to the DTS file<br />which has only 4 partitions.</p></blockquote></div><p>I have added the 5th &quot;firmware&quot; partition as you mentioned above.</p><p>So if I flash the OpenWrt combined image into firmware, U-boot happily finds the kernel within the &quot;firmware&quot; partition and boots the kernel, but the kernel can not find any rootfs after that.</p><p>Should there be a rootfs= kernel option? If this is automatic I presume not?</p><p>Is the rootfstype=squashfs,jffs2 a problem? I thought the kernel looks for squashfs first and mounts read-only then later remounts as jffs2 - so why is this kernel seeking a jffs2 block during boot and not a squashfs block?</p><p>I am definitely confused at this point.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p336324">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">elektroman</div>
					<div class="post-datetime">
						29 Aug 2016, 10:15					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>rmurch wrote:</cite><blockquote><p>Should there be a rootfs= kernel option? If this is automatic I presume not?</p><p>Is the rootfstype=squashfs,jffs2 a problem? I thought the kernel looks for squashfs first and mounts read-only then later remounts as jffs2 - so why is this kernel seeking a jffs2 block during boot and not a squashfs block?</p><p>I am definitely confused at this point.</p></blockquote></div><p>For what the kernel is looking &quot;it depends&quot;.</p><p>If you provide root= the kernel looks for the root partition.</p><p>If not the (hopefully) embedded/attached initramfs will do it&#039;s magic<br />Look into &#039;packages/base-files&#039;</p><p>Please remove the root parameter</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p336329">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">rmurch</div>
					<div class="post-datetime">
						29 Aug 2016, 10:50					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>elektroman wrote:</cite><blockquote><p>Look into &#039;packages/base-files&#039;</p><p>Please remove the root parameter</p></blockquote></div><p>I have removed the root= parameter, and have tried about 50x different combinations of MTD partition layouts and all result in 1 of 2 jffs2 errors as posted previously.</p><p>I have also downloaded the full git source build and completely built openwrt from scratch, with a kernel I only built in squashfs and fuse support, still gives error rootfs errors, but admittedly its a stock profile with no extra MTD partitions defined, but the fact jffs2 is in the kernel again has made me move back to the ImageBuilder for 15.05.01.</p><p>console output for git build:<br /></p><div class="codebox"><pre><code>## Booting image at bc070000 ...
raspi_read: from:70000 len:40 
Magic number at 0xBC070000 
raspi_read: from:70014 len:40 
   Image Name:   MIPS OpenWrt Linux-4.4.14
   Image Type:   MIPS Linux Kernel Image (lzma compressed)
   Data Size:    1258298 Bytes =  1.2 MB
   Load Address: 80000000
   Entry Point:  80000000
raspi_read: from:70054 len:13333a 
   Uncompressing Kernel Image ... OK
No initrd
## Transferring control to Linux (at address 80000000) ...
## Giving linux memsize in MB, 64

Starting kernel ...

[    0.000000] Linux version 4.4.14 (rohbags@wx2.lan) (gcc version 5.3.0 (OpenWrt GCC 5.3.0 49926) ) #1 Mon Aug 29 07:6
[    0.000000] Board has DDR2
[    0.000000] Analog PMU set to hw control
[    0.000000] Digital PMU set to hw control
[    0.000000] SoC Type: MediaTek MT7620A ver:2 eco:6
[    0.000000] bootconsole [early0] enabled
[    0.000000] CPU0 revision is: 00019650 (MIPS 24KEc)
[    0.000000] MIPS: machine is Ralink MT7620a + MT7610e evaluation board
[    0.000000] Determined physical RAM map:
[    0.000000]  memory: 04000000 @ 00000000 (usable)
[    0.000000] Initrd not found or empty - disabling initrd
[    0.000000] Zone ranges:
[    0.000000]   Normal   [mem 0x0000000000000000-0x0000000003ffffff]
[    0.000000] Movable zone start for each node
[    0.000000] Early memory node ranges
[    0.000000]   node   0: [mem 0x0000000000000000-0x0000000003ffffff]
[    0.000000] Initmem setup node 0 [mem 0x0000000000000000-0x0000000003ffffff]
[    0.000000] Primary instruction cache 64kB, VIPT, 4-way, linesize 32 bytes.
[    0.000000] Primary data cache 32kB, 4-way, PIPT, no aliases, linesize 32 bytes
[    0.000000] Built 1 zonelists in Zone order, mobility grouping on.  Total pages: 16256
[    0.000000] Kernel command line: console=ttyS0,57600 rootfstype=squashfs,jffs2
[    0.000000] PID hash table entries: 256 (order: -2, 1024 bytes)
[    0.000000] Dentry cache hash table entries: 8192 (order: 3, 32768 bytes)
[    0.000000] Inode-cache hash table entries: 4096 (order: 2, 16384 bytes)
[    0.000000] Writing ErrCtl register=000400d2
[    0.000000] Readback ErrCtl register=000400d2
[    0.000000] Memory: 60836K/65536K available (2831K kernel code, 137K rwdata, 692K rodata, 172K init, 195K bss, 4700)
[    0.000000] SLUB: HWalign=32, Order=0-3, MinObjects=0, CPUs=1, Nodes=1
[    0.000000] NR_IRQS:256
[    0.000000] CPU Clock: 580MHz
[    0.000000] clocksource: systick: mask: 0xffff max_cycles: 0xffff, max_idle_ns: 583261500 ns
[    0.000000] systick: enable autosleep mode
[    0.000000] systick: running - mult: 214748, shift: 32
[    0.000000] clocksource: MIPS: mask: 0xffffffff max_cycles: 0xffffffff, max_idle_ns: 6590553264 ns
[    0.000011] sched_clock: 32 bits at 290MHz, resolution 3ns, wraps every 7405115902ns
[    0.015456] Calibrating delay loop... 385.84 BogoMIPS (lpj=1929216)
[    0.080596] pid_max: default: 32768 minimum: 301
[    0.089913] Mount-cache hash table entries: 1024 (order: 0, 4096 bytes)
[    0.102936] Mountpoint-cache hash table entries: 1024 (order: 0, 4096 bytes)
[    0.123068] clocksource: jiffies: mask: 0xffffffff max_cycles: 0xffffffff, max_idle_ns: 19112604462750000 ns
[    0.142718] pinctrl core: initialized pinctrl subsystem
[    0.153721] NET: Registered protocol family 16
[    0.648338] PCI host bridge /pcie@10140000 ranges:
[    0.657728]  MEM 0x0000000020000000..0x000000002fffffff
[    0.668103]   IO 0x0000000010160000..0x000000001016ffff
[    0.686680] rt2880_gpio 10000600.gpio: registering 24 gpios
[    0.697706] rt2880_gpio 10000600.gpio: registering 24 irq handlers
[    0.710758] PCI host bridge to bus 0000:00
[    0.718762] pci_bus 0000:00: root bus resource [mem 0x20000000-0x2fffffff]
[    0.732468] pci_bus 0000:00: root bus resource [io  0xffffffff]
[    0.744206] pci_bus 0000:00: root bus resource [??? 0x00000000 flags 0x0]
[    0.757705] pci_bus 0000:00: No busn resource found for root bus, will use [bus 00-ff]
[    0.773934] pci 0000:00:00.0: bridge configuration invalid ([bus 00-00]), reconfiguring
[    0.790536] pci 0000:00:00.0: BAR 0: no space for [mem size 0x80000000]
[    0.803582] pci 0000:00:00.0: BAR 0: failed to assign [mem size 0x80000000]
[    0.817403] pci 0000:00:00.0: BAR 8: assigned [mem 0x20000000-0x200fffff]
[    0.830904] pci 0000:00:00.0: BAR 9: assigned [mem 0x20100000-0x201fffff pref]
[    0.845268] pci 0000:00:00.0: BAR 1: assigned [mem 0x20200000-0x2020ffff]
[    0.858779] pci 0000:01:00.0: BAR 0: assigned [mem 0x20000000-0x200fffff 64bit]
[    0.873327] pci 0000:01:00.0: BAR 6: assigned [mem 0x20100000-0x2010ffff pref]
[    0.887669] pci 0000:00:00.0: PCI bridge to [bus 01]
[    0.897524] pci 0000:00:00.0:   bridge window [mem 0x20000000-0x200fffff]
[    0.911035] pci 0000:00:00.0:   bridge window [mem 0x20100000-0x201fffff pref]
[    0.925421] pci 0000:00:00.0: card - bus=0x0, slot = 0x0 irq=0
[    0.937003] pci 0000:01:00.0: card - bus=0x1, slot = 0x0 irq=4
[    0.949630] clocksource: Switched to clocksource systick
[    0.961649] NET: Registered protocol family 2
[    0.971117] TCP established hash table entries: 1024 (order: 0, 4096 bytes)
[    0.984894] TCP bind hash table entries: 1024 (order: 0, 4096 bytes)
[    0.997484] TCP: Hash tables configured (established 1024 bind 1024)
[    1.010209] UDP hash table entries: 256 (order: 0, 4096 bytes)
[    1.021740] UDP-Lite hash table entries: 256 (order: 0, 4096 bytes)
[    1.034486] NET: Registered protocol family 1
[    1.043614] rt-timer 10000100.timer: maximum frequency is 1220Hz
[    1.056460] futex hash table entries: 256 (order: -1, 3072 bytes)
[    1.087144] squashfs: version 4.0 (2009/01/31) Phillip Lougher
[    1.098674] jffs2: version 2.2 (NAND) (SUMMARY) (LZMA) (RTIME) (CMODE_PRIORITY) (c) 2001-2006 Red Hat, Inc.
[    1.120913] io scheduler noop registered
[    1.128561] io scheduler deadline registered (default)
[    1.139067] ralink-usb-phy usbphy: invalid resource
[    1.149342] Serial: 8250/16550 driver, 16 ports, IRQ sharing enabled
[    1.165689] console [ttyS0] disabled
[    1.172731] 10000c00.uartlite: ttyS0 at MMIO 0x10000c00 (irq = 20, base_baud = 2500000) is a Palmchip BK-3103
[    1.192409] console [ttyS0] enabled
[    1.192409] console [ttyS0] enabled
[    1.206227] bootconsole [early0] disabled
[    1.206227] bootconsole [early0] disabled
[    1.228487] spi spi0.0: force spi mode3
[    1.236756] m25p80 spi0.0: mx25l6405d (8192 Kbytes)
[    1.246550] 4 ofpart partitions found on MTD device spi0.0
[    1.257485] Creating 4 MTD partitions on &quot;spi0.0&quot;:
[    1.267043] 0x000000000000-0x000000030000 : &quot;u-boot&quot;
[    1.278744] 0x000000030000-0x000000040000 : &quot;u-boot-env&quot;
[    1.291266] 0x000000040000-0x000000050000 : &quot;factory&quot;
[    1.303219] 0x000000050000-0x000000800000 : &quot;firmware&quot;
[    1.381690] mtk_soc_eth 10100000.ethernet: generated random MAC address 2e:bc:00:95:d3:6e
[    1.398200] libphy: mdio: probed
[    1.405646] mtk_soc_eth 10100000.ethernet: connected port 4 to PHY at mdio-bus:04 [uid=03a2940d, driver=Generic PHY]
[    1.426783] mtk_soc_eth 10100000.ethernet: loaded mt7620 driver
[    1.439373] mtk_soc_eth 10100000.ethernet eth0: mediatek frame engine at 0xb0100000, irq 5
[    1.456450] rt2880_wdt 10000120.watchdog: Initialized
[    1.468110] NET: Registered protocol family 10
[    1.480780] NET: Registered protocol family 17
[    1.489790] bridge: automatic filtering via arp/ip/ip6tables has been deprecated. Update your scripts to load br_ne.
[    1.514948] 8021q: 802.1Q VLAN Support v1.8
[    1.526487] VFS: Cannot open root device &quot;(null)&quot; or unknown-block(0,0): error -6
[    1.541462] Please append a correct &quot;root=&quot; boot option; here are the available partitions:
[    1.558126] 1f00             192 mtdblock0  (driver?)
[    1.568204] 1f01              64 mtdblock1  (driver?)
[    1.578281] 1f02              64 mtdblock2  (driver?)
[    1.588357] 1f03            7872 mtdblock3  (driver?)
[    1.598433] Kernel panic - not syncing: VFS: Unable to mount root fs on unknown-block(0,0)
[    1.617402] ---[ end Kernel panic - not syncing: VFS: Unable to mount root fs on unknown-block(0,0)
[   81.229594] random: nonblocking pool is initialized</code></pre></div><p>Have dug through all of the ImageBuilder sources and can find nothing to help.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p336348">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">elektroman</div>
					<div class="post-datetime">
						29 Aug 2016, 13:43					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>rmurch wrote:</cite><blockquote><p>I have removed the root= parameter, and have tried about 50x different combinations of MTD partition layouts and all result in 1 of 2 jffs2 errors as posted previously.</p></blockquote></div><p>jffs2 errors are from scanning for the &#039;magic&#039; which are not found, because some error in wrong rootfs partition. End of (wrong) partition<br /></p><div class="quotebox"><cite>rmurch wrote:</cite><blockquote><p>I have also downloaded the full git source build and completely built openwrt from scratch, with a kernel I only built in squashfs and fuse support, still gives error rootfs errors, but admittedly its a stock profile with no extra MTD partitions defined, but the fact jffs2 is in the kernel again has made me move back to the ImageBuilder for 15.05.01.</p></blockquote></div><p>You have to use the git sources.<br />You can&#039;t use imagebuilder ...<br /></p><div class="quotebox"><cite>rmurch wrote:</cite><blockquote><p>Have dug through all of the ImageBuilder sources and can find nothing to help.</p></blockquote></div><p>You have some errors in DTS -&gt;Boardname<br />maybe missing setup bits (led, switch, net) </p><p>And some other thing :<br />you have no SD card reader, so remove it from DTS.</p><p>So please use git, is fairly simple to add another &quot;remotes&quot; &quot;branches&quot;<br /> ;-)<br />I need some time to check what&#039;s wrong/missing</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p336404">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">rmurch</div>
					<div class="post-datetime">
						29 Aug 2016, 18:10					</div>
				</div>
				<div class="post-content content">
					<p>I have checked out the latest git sources and am now working only with that. I have also cleaned up the DTS file but it is still incomplete (only 2 out 4 led&#039;s defined, etc). But my focus is just on getting the kernel to mount a rootfs so I can finally get a shell on this device and own it!</p><p>A patch file of changes made so far:<br /></p><div class="codebox"><pre><code>diff --git a/target/linux/ramips/base-files/etc/board.d/01_leds b/target/linux/ramips/base-files/etc/board.d/01_leds
index 460253c..9ffa456 100755
--- a/target/linux/ramips/base-files/etc/board.d/01_leds
+++ b/target/linux/ramips/base-files/etc/board.d/01_leds
@@ -74,6 +74,10 @@ bc2)
 br-6425)
     set_wifi_led &quot;$board:orange:wlan&quot;
     ;;
+br-6478ac-v2)
+    ucidef_set_led_default &quot;power&quot; &quot;POWER&quot; &quot;$board:white:power&quot; &quot;1&quot;
+    set_wifi_led &quot;$board:blue:wlan&quot;
+    ;;
 broadway)
     set_usb_led &quot;$board:red:diskmounted&quot;
     set_wifi_led &quot;$board:red:wps_active&quot;
diff --git a/target/linux/ramips/base-files/etc/board.d/02_network b/target/linux/ramips/base-files/etc/board.d/02_network
index 6157d87..ba30ea4 100755
--- a/target/linux/ramips/base-files/etc/board.d/02_network
+++ b/target/linux/ramips/base-files/etc/board.d/02_network
@@ -113,6 +113,7 @@ ramips_setup_interfaces()
     atp-52b|\
     awm002-evb|\
     awm003-evb|\
+    br-6478ac-v2 |\
     c50|\
     dir-645|\
     dir-860l-b1|\
diff --git a/target/linux/ramips/base-files/etc/diag.sh b/target/linux/ramips/base-files/etc/diag.sh
index 0c5abb2..6c318d5 100644
--- a/target/linux/ramips/base-files/etc/diag.sh
+++ b/target/linux/ramips/base-files/etc/diag.sh
@@ -33,6 +33,9 @@ get_status_led() {
     xdxrn502j)
         status_led=&quot;$board:green:power&quot;
         ;;
+    br-6478ac-v2)
+        status_led=&quot;$board:white:power&quot;
+    ;;
     a5-v11|\
     cs-qr10|\
     d105|\
diff --git a/target/linux/ramips/base-files/lib/ramips.sh b/target/linux/ramips/base-files/lib/ramips.sh
index 10139d7..e974fca 100755
--- a/target/linux/ramips/base-files/lib/ramips.sh
+++ b/target/linux/ramips/base-files/lib/ramips.sh
@@ -76,6 +76,9 @@ ramips_board_detect() {
     *&quot;BR-6475nD&quot;)
         name=&quot;br-6475nd&quot;
         ;;
+    *&quot;Edimax BR-6478AC V2&quot;)
+        name=&quot;br-6478ac-v2&quot;
+        ;;
     *&quot;Broadway&quot;)
         name=&quot;broadway&quot;
         ;;
diff --git a/target/linux/ramips/base-files/lib/upgrade/platform.sh b/target/linux/ramips/base-files/lib/upgrade/platform.sh
index e3bea00..3d81c73 100755
--- a/target/linux/ramips/base-files/lib/upgrade/platform.sh
+++ b/target/linux/ramips/base-files/lib/upgrade/platform.sh
@@ -176,6 +176,7 @@ platform_check_image() {
         }
         return 0
         ;;
+    br-6478ac-v2 |\
     br-6475nd)
         [ &quot;$magic&quot; != &quot;43535953&quot; ] &amp;&amp; {
             echo &quot;Invalid image type.&quot;
diff --git a/target/linux/ramips/dts/BR-6478AC-V2.dts b/target/linux/ramips/dts/BR-6478AC-V2.dts
new file mode 100644
index 0000000..08d5fb9
--- /dev/null
+++ b/target/linux/ramips/dts/BR-6478AC-V2.dts
@@ -0,0 +1,167 @@
+/dts-v1/;
+
+/include/ &quot;mt7620a.dtsi&quot;
+
+/ {
+    compatible = &quot;ralink,mt7620a-eval-board&quot;, &quot;ralink,mt7620a-soc&quot;;
+    model = &quot;Edimax BR-6478AC V2&quot;;
+
+    chosen {
+                //bootargs = &quot;console=ttyS0,57600 console=ttyS1,57600n8 root=1f05&quot;;
+                //bootargs = &quot;console=ttyS0,57600 root=1f05 rootfstype=squashfs&quot;;
+                bootargs = &quot;console=ttyS0,57600&quot;;
+        };
+
+    palmbus@10000000 {
+        spi@b00 {
+            status = &quot;okay&quot;;
+            m25p80@0 {
+                #address-cells = &lt;1&gt;;
+                #size-cells = &lt;1&gt;;
+                compatible = &quot;mx25l6405d&quot;;
+                reg = &lt;0 0&gt;;
+                linux,modalias = &quot;m25p80&quot;, &quot;mx25l6405d&quot;;
+                spi-max-frequency = &lt;10000000&gt;;
+                partition@0 {
+                    label = &quot;u-boot&quot;;
+                    reg = &lt;0x0 0x30000&gt;;
+                    read-only;
+                };
+                partition@30000 {
+                    label = &quot;u-boot-env&quot;;
+                    reg = &lt;0x30000 0x10000&gt;;
+                    read-only;
+                };
+                factory: partition@40000 {
+                    label = &quot;factory&quot;;
+                    reg = &lt;0x40000 0x10000&gt;;
+                    read-only;
+                };
+                partition@50000 {
+                    label = &quot;cimage&quot;;
+                    reg = &lt;0x50000 0x20000&gt;;
+                    read-only;
+                };
+
+                partition@70000 {
+                                reg = &lt;0x00070000 0x00130000&gt;;
+                                label = &quot;kernel&quot;;
+                };
+                partition@1A0000 {
+                    reg = &lt;0x001A0000 0x00320000&gt;;
+                    label = &quot;rootfs&quot;;
+                };
+                partition2@70000 {
+                                reg = &lt;0x00070000 0x00790000&gt;;
+                                label = &quot;firmware&quot;;
+                };
+
+
+            };
+        };
+               // uart@500 { // edimax ttyS0
+               //         compatible = &quot;ralink,mt7620a-uart&quot;, &quot;ralink,rt2880-uart&quot;, &quot;ns16550a&quot;;
+               //         reg = &lt;0x500 0x100&gt;;
+               //         resets = &lt;&amp;rstctrl 12&gt;;
+               //         reset-names = &quot;uart&quot;;
+               //         interrupt-parent = &lt;&amp;intc&gt;;
+               //         interrupts = &lt;5&gt;;
+               //         reg-shift = &lt;2&gt;;
+               //         //status = &quot;enabled&quot;;
+               // };
+               //uartlite@c00 { // edimax ttyS1
+               //         compatible = &quot;ralink,mt7620a-uart&quot;, &quot;ralink,rt2880-uart&quot;, &quot;ns16550a&quot;;
+               //         reg = &lt;0xc00 0x100&gt;;
+               //         resets = &lt;&amp;rstctrl 19&gt;;
+               //         reset-names = &quot;uartl&quot;;
+               //         interrupt-parent = &lt;&amp;intc&gt;;
+               //         interrupts = &lt;12&gt;;
+               //         reg-shift = &lt;2&gt;;
+               //         pinctrl-names = &quot;default&quot;;
+               //         pinctrl-0 = &lt;&amp;uartlite_pins&gt;;
+               // };
+
+    };
+
+    pinctrl {
+        state_default: pinctrl0 {
+            gpio {
+                ralink,group = &quot;i2c&quot;, &quot;uartf&quot;;
+                ralink,function = &quot;gpio&quot;;
+            };
+        };
+    };
+
+    ethernet@10100000 {
+        status = &quot;okay&quot;;
+        pinctrl-names = &quot;default&quot;;
+        pinctrl-0 = &lt;&amp;rgmii1_pins &amp;rgmii2_pins &amp;mdio_pins&gt;;
+        ralink,port-map = &quot;llllw&quot;;
+        port@4 {
+            status = &quot;okay&quot;;
+            phy-mode = &quot;rgmii&quot;;
+            phy-handle = &lt;&amp;phy4&gt;;
+        };
+        port@5 {
+            status = &quot;okay&quot;;
+            phy-mode = &quot;rgmii&quot;;
+            phy-handle = &lt;&amp;phy5&gt;;
+        };
+        mdio-bus {
+            status = &quot;okay&quot;;
+            phy4: ethernet-phy@4 {
+                reg = &lt;4&gt;;
+                phy-mode = &quot;rgmii&quot;;
+            };
+            phy5: ethernet-phy@5 {
+                reg = &lt;5&gt;;
+                phy-mode = &quot;rgmii&quot;;
+            };
+        };
+    };
+
+    gsw@10110000 {
+        ralink,port4 = &quot;gmac&quot;;
+    };
+
+    pcie@10140000 {
+        status = &quot;okay&quot;;
+    };
+
+    gpio-leds {
+        compatible = &quot;gpio-leds&quot;;
+        power {
+            label = &quot;br-6478ac-v2:white:power&quot;;
+            gpios = &lt;&amp;gpio1 15 1&gt;;
+        };
+        wlan {
+            label = &quot;br-6478ac-v2:blue:wlan&quot;;
+            gpios = &lt;&amp;gpio3 0 1&gt;;
+        };
+    };
+
+    gpio-keys-polled {
+        compatible = &quot;gpio-keys&quot;;
+        #address-cells = &lt;1&gt;;
+        #size-cells = &lt;0&gt;;
+        poll-interval = &lt;20&gt;;
+        s2 {
+            label = &quot;S2&quot;;
+            gpios = &lt;&amp;gpio0 1 1&gt;;
+            linux,code = &lt;0x100&gt;;
+        };
+        s3 {
+            label = &quot;S3&quot;;
+            gpios = &lt;&amp;gpio0 2 1&gt;;
+            linux,code = &lt;0x101&gt;;
+        };
+    };
+
+    ehci@101c0000 {
+        status = &quot;okay&quot;;
+    };
+
+    ohci@101c1000 {
+        status = &quot;okay&quot;;
+    };
+};
diff --git a/target/linux/ramips/image/Makefile b/target/linux/ramips/image/Makefile
index 52dde67..61521f9 100644
--- a/target/linux/ramips/image/Makefile
+++ b/target/linux/ramips/image/Makefile
@@ -252,8 +252,27 @@ ifeq ($(SUBTARGET),rt3883)
 include rt3883.mk
 endif
 
+
+# sign an image to make it work with edimax tftp recovery
+define BuildFirmware/Edimax/squashfs
+        $(call BuildFirmware/OF,$(1),$(2),$(3),$(4))
+        if [ -e &quot;$(call sysupname,$(1),$(2))&quot; ]; then \
+                mkedimaximg -i $(call sysupname,$(1),$(2)) \
+                        -o $(call imgname,$(1),$(2))-factory.bin \
+                        -s $(5) -m $(6) -f $(7) -S $(8); \
+        fi
+endef
+BuildFirmware/Edimax/initramfs=$(call BuildFirmware/OF/initramfs,$(1),$(2),$(3))
+
+br6478acv2_mtd_size=5832704
+Image/Build/Profile/BR-6478AC-V2=$(call BuildFirmware/Edimax/$(1),$(1),br6478ac-v2,BR-6478AC-V2, $(br6478acv2_mtd_size), CSYS, RN68, 0x70000, 0x1100000)
+
+
 ifeq ($(SUBTARGET),mt7620)
 include mt7620.mk
+define Image/Build/Profile/Default
+    $(call Image/Build/Profile/BR-6478AC-V2,$(1))
+endef
 endif
 
 ifeq ($(SUBTARGET),mt7621)
diff --git a/target/linux/ramips/image/mt7620.mk b/target/linux/ramips/image/mt7620.mk
index b1afb82..90d8a64 100644
--- a/target/linux/ramips/image/mt7620.mk
+++ b/target/linux/ramips/image/mt7620.mk
@@ -169,6 +169,15 @@ define Device/mt7620a
 endef
 TARGET_DEVICES += mt7620a
 
+define Device/br-6478ac-v2
+  DTS := BR-6478AC-V2
+  IMAGE_SIZE := $(ralink_default_fw_size_8M)
+  DEVICE_TITLE := Edimax BR-6478-AC V2
+  DEVICE_PACKAGES := kmod-usb2 kmod-usb-ohci kmod-mt76
+endef
+TARGET_DEVICES += br-6478ac-v2
+
+
 define Device/mt7620a_mt7610e
   DTS := MT7620a_MT7610e
   IMAGE_SIZE := $(ralink_default_fw_size_8M)</code></pre></div><p>Am repeatedly stuck with no rootfs found, or jffs2 errors, or if I create a &quot;rootfs&quot; MTD partition it automatically detects it at boot but fails to find a squashfs on it.</p><p>I have tried pointing &quot;rootfs&quot; to the exact byte after the kernel, as well as making &quot;kernel&quot; partition larger than the actual kernel (so no overlap) and starting &quot;rootfs&quot; way after the kernel, as well as ending &quot;rootfs&quot; before the end of the flash to allow space to create a &quot;rootfs_data&quot; at boot up, but all fail.</p><p>I have also tried creating a &quot;freespace&quot; MTD partition of the final 20000 addresses as in the stock firmware but that makes no difference (as some NOR flash chips have trouble as the end of the address space, I thought maybe this was one).</p><p>Can anyone please browse through the above patch and see if they notice any mistakes or areas of concern?</p><p>Is there anything else I can do to confirm the address of the &quot;rootfs&quot; MTD partition being created is correct? Can I somehow read the image before flashing to confirm the locations/addresses of the kernel and squashfs.root/rootfs ?</p><p>PS: I will update the other current post on porting the Edimax BR-6478AC-V2 when I finally get a success or failure result, or can move on from this MTD layout issue to whatever maybe next.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p336418">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">elektroman</div>
					<div class="post-datetime">
						29 Aug 2016, 19:08					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>elektroman wrote:</cite><blockquote><p>So please use git, is fairly simple to add another &quot;remotes&quot; &quot;branches&quot;<br /> ;-)<br />I need some time to check what&#039;s wrong/missing</p></blockquote></div><div class="quotebox"><cite>rmurch wrote:</cite><blockquote><p>I have checked out the latest git sources and am now working only with that. I have also cleaned up the DTS file but it is still incomplete (only 2 out 4 led&#039;s defined, etc). But my focus is just on getting the kernel to mount a rootfs so I can finally get a shell on this device and own it!</p></blockquote></div><p>I know<br />But you are not the keen thinker, I hope this spelling is correct ;-)</p><p>Please do this in your local git<br /></p><div class="codebox"><pre><code>git remote add elektroman git://github.com/ulli-kroll/openwrt.git
git checkout -b Edimax elektroman/do-work/Edimax</code></pre></div><p>The first will add my repository and the second will checkout my working branch.<br />There is maybe some error in the partition number for kernel/rootfs<br />I must check some other targets.</p><p>For the leds and keys, they may be defined but not tested ...</p><p>The other thing the &quot;stock&quot; firmware update thing is also missing, due the damn CSYS header ...<br />But I can build a initramfs image ..</p><p>EDIT<br />you must do<br />make clean<br />rm -Rf staging_dir/ tmp/ build_dir/ bin<br />do see the new profile for the Edimax router in mt7620 ;-)</p>											<p class="post-edited">(Last edited by <strong>elektroman</strong> on 29 Aug 2016, 20:04)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p336474">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">MBS</div>
					<div class="post-datetime">
						30 Aug 2016, 01:55					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>rmurch wrote:</cite><blockquote><div class="codebox"><pre><code>diff --git a/target/linux/ramips/base-files/etc/board.d/01_leds b/target/linux/ramips/base-files/etc/board.d/01_leds
index 460253c..9ffa456 100755
diff --git a/target/linux/ramips/dts/BR-6478AC-V2.dts b/target/linux/ramips/dts/BR-6478AC-V2.dts
new file mode 100644
index 0000000..08d5fb9
--- /dev/null
+++ b/target/linux/ramips/dts/BR-6478AC-V2.dts
@@ -0,0 +1,167 @@
+/dts-v1/;
+
+/include/ &quot;mt7620a.dtsi&quot;
+
+/ {
+    compatible = &quot;ralink,mt7620a-eval-board&quot;, &quot;ralink,mt7620a-soc&quot;;
+    model = &quot;Edimax BR-6478AC V2&quot;;
+
+    chosen {
+                //bootargs = &quot;console=ttyS0,57600 console=ttyS1,57600n8 root=1f05&quot;;
+                //bootargs = &quot;console=ttyS0,57600 root=1f05 rootfstype=squashfs&quot;;
+                bootargs = &quot;console=ttyS0,57600&quot;;
+        };
+
+    palmbus@10000000 {
+        spi@b00 {
+            status = &quot;okay&quot;;
+            m25p80@0 {
+                #address-cells = &lt;1&gt;;
+                #size-cells = &lt;1&gt;;
+                compatible = &quot;mx25l6405d&quot;;</code></pre></div></blockquote></div><p>Use the regular compatible = &quot;jedec,spi-nor&quot;<br /></p><div class="quotebox"><cite>rmurch wrote:</cite><blockquote><div class="codebox"><pre><code>+                reg = &lt;0 0&gt;;
+                linux,modalias = &quot;m25p80&quot;, &quot;mx25l6405d&quot;;
+                spi-max-frequency = &lt;10000000&gt;;
+                partition@0 {
+                    label = &quot;u-boot&quot;;
+                    reg = &lt;0x0 0x30000&gt;;
+                    read-only;
+                };
+                partition@30000 {
+                    label = &quot;u-boot-env&quot;;
+                    reg = &lt;0x30000 0x10000&gt;;
+                    read-only;
+                };
+                factory: partition@40000 {
+                    label = &quot;factory&quot;;
+                    reg = &lt;0x40000 0x10000&gt;;
+                    read-only;
+                };
+                partition@50000 {
+                    label = &quot;cimage&quot;;
+                    reg = &lt;0x50000 0x20000&gt;;
+                    read-only;
+                };
+
+                partition@70000 {
+                                reg = &lt;0x00070000 0x00130000&gt;;
+                                label = &quot;kernel&quot;;
+                };
+                partition@1A0000 {
+                    reg = &lt;0x001A0000 0x00320000&gt;;
+                    label = &quot;rootfs&quot;;
+                };</code></pre></div></blockquote></div><p>Go without those two partitions &quot;kernel&quot; and &quot;rootfs&quot;. Kernel will be allocated dynamically according to its size. Just defining &quot;firmware&quot; is fine.<br /></p><div class="quotebox"><cite>rmurch wrote:</cite><blockquote><div class="codebox"><pre><code>+                partition2@70000 {
+                                reg = &lt;0x00070000 0x00790000&gt;;
+                                label = &quot;firmware&quot;;
+                };
+
+
+            };
+        };
+               // uart@500 { // edimax ttyS0
+               //         compatible = &quot;ralink,mt7620a-uart&quot;, &quot;ralink,rt2880-uart&quot;, &quot;ns16550a&quot;;
+               //         reg = &lt;0x500 0x100&gt;;
+               //         resets = &lt;&amp;rstctrl 12&gt;;
+               //         reset-names = &quot;uart&quot;;
+               //         interrupt-parent = &lt;&amp;intc&gt;;
+               //         interrupts = &lt;5&gt;;
+               //         reg-shift = &lt;2&gt;;
+               //         //status = &quot;enabled&quot;;
+               // };
+               //uartlite@c00 { // edimax ttyS1
+               //         compatible = &quot;ralink,mt7620a-uart&quot;, &quot;ralink,rt2880-uart&quot;, &quot;ns16550a&quot;;
+               //         reg = &lt;0xc00 0x100&gt;;
+               //         resets = &lt;&amp;rstctrl 19&gt;;
+               //         reset-names = &quot;uartl&quot;;
+               //         interrupt-parent = &lt;&amp;intc&gt;;
+               //         interrupts = &lt;12&gt;;
+               //         reg-shift = &lt;2&gt;;
+               //         pinctrl-names = &quot;default&quot;;
+               //         pinctrl-0 = &lt;&amp;uartlite_pins&gt;;
+               // };
+
+    };
+
+    pinctrl {
+        state_default: pinctrl0 {
+            gpio {
+                ralink,group = &quot;i2c&quot;, &quot;uartf&quot;;
+                ralink,function = &quot;gpio&quot;;
+            };
+        };
+    };
+
+    ethernet@10100000 {
+        status = &quot;okay&quot;;
+        pinctrl-names = &quot;default&quot;;
+        pinctrl-0 = &lt;&amp;rgmii1_pins &amp;rgmii2_pins &amp;mdio_pins&gt;;
+        ralink,port-map = &quot;llllw&quot;;
+        port@4 {
+            status = &quot;okay&quot;;
+            phy-mode = &quot;rgmii&quot;;
+            phy-handle = &lt;&amp;phy4&gt;;
+        };
+        port@5 {
+            status = &quot;okay&quot;;
+            phy-mode = &quot;rgmii&quot;;
+            phy-handle = &lt;&amp;phy5&gt;;
+        };
+        mdio-bus {
+            status = &quot;okay&quot;;
+            phy4: ethernet-phy@4 {
+                reg = &lt;4&gt;;
+                phy-mode = &quot;rgmii&quot;;
+            };
+            phy5: ethernet-phy@5 {
+                reg = &lt;5&gt;;
+                phy-mode = &quot;rgmii&quot;;
+            };
+        };
+    };
+
+    gsw@10110000 {
+        ralink,port4 = &quot;gmac&quot;;
+    };
+
+    pcie@10140000 {
+        status = &quot;okay&quot;;
+    };
+
+    gpio-leds {
+        compatible = &quot;gpio-leds&quot;;
+        power {
+            label = &quot;br-6478ac-v2:white:power&quot;;
+            gpios = &lt;&amp;gpio1 15 1&gt;;
+        };
+        wlan {
+            label = &quot;br-6478ac-v2:blue:wlan&quot;;
+            gpios = &lt;&amp;gpio3 0 1&gt;;
+        };
+    };
+
+    gpio-keys-polled {
+        compatible = &quot;gpio-keys&quot;;
+        #address-cells = &lt;1&gt;;
+        #size-cells = &lt;0&gt;;
+        poll-interval = &lt;20&gt;;
+        s2 {
+            label = &quot;S2&quot;;
+            gpios = &lt;&amp;gpio0 1 1&gt;;
+            linux,code = &lt;0x100&gt;;
+        };
+        s3 {
+            label = &quot;S3&quot;;
+            gpios = &lt;&amp;gpio0 2 1&gt;;
+            linux,code = &lt;0x101&gt;;
+        };
+    };
+
+    ehci@101c0000 {
+        status = &quot;okay&quot;;
+    };
+
+    ohci@101c1000 {
+        status = &quot;okay&quot;;
+    };
+};
diff --git a/target/linux/ramips/image/Makefile b/target/linux/ramips/image/Makefile
index 52dde67..61521f9 100644
--- a/target/linux/ramips/image/Makefile
+++ b/target/linux/ramips/image/Makefile
@@ -252,8 +252,27 @@ ifeq ($(SUBTARGET),rt3883)
 include rt3883.mk
 endif
 
+
+# sign an image to make it work with edimax tftp recovery
+define BuildFirmware/Edimax/squashfs
+        $(call BuildFirmware/OF,$(1),$(2),$(3),$(4))
+        if [ -e &quot;$(call sysupname,$(1),$(2))&quot; ]; then \
+                mkedimaximg -i $(call sysupname,$(1),$(2)) \
+                        -o $(call imgname,$(1),$(2))-factory.bin \
+                        -s $(5) -m $(6) -f $(7) -S $(8); \
+        fi
+endef
+BuildFirmware/Edimax/initramfs=$(call BuildFirmware/OF/initramfs,$(1),$(2),$(3))
+
+br6478acv2_mtd_size=5832704</code></pre></div></blockquote></div><p>That should be 0x790000, so 7929856 looks more appropriate.<br /></p><div class="quotebox"><cite>rmurch wrote:</cite><blockquote><div class="codebox"><pre><code>+Image/Build/Profile/BR-6478AC-V2=$(call BuildFirmware/Edimax/$(1),$(1),br6478ac-v2,BR-6478AC-V2, $(br6478acv2_mtd_size), CSYS, RN68, 0x70000, 0x1100000)
+
+
 ifeq ($(SUBTARGET),mt7620)
 include mt7620.mk
+define Image/Build/Profile/Default
+    $(call Image/Build/Profile/BR-6478AC-V2,$(1))
+endef
 endif
 
 ifeq ($(SUBTARGET),mt7621)
diff --git a/target/linux/ramips/image/mt7620.mk b/target/linux/ramips/image/mt7620.mk
index b1afb82..90d8a64 100644
--- a/target/linux/ramips/image/mt7620.mk
+++ b/target/linux/ramips/image/mt7620.mk
@@ -169,6 +169,15 @@ define Device/mt7620a
 endef
 TARGET_DEVICES += mt7620a
 
+define Device/br-6478ac-v2
+  DTS := BR-6478AC-V2
+  IMAGE_SIZE := $(ralink_default_fw_size_8M)</code></pre></div></blockquote></div><p>I think this should be the same 0x790000 as above.<br /></p><div class="quotebox"><cite>rmurch wrote:</cite><blockquote><div class="codebox"><pre><code>+  DEVICE_TITLE := Edimax BR-6478-AC V2
+  DEVICE_PACKAGES := kmod-usb2 kmod-usb-ohci kmod-mt76
+endef
+TARGET_DEVICES += br-6478ac-v2
+
+
 define Device/mt7620a_mt7610e
   DTS := MT7620a_MT7610e
   IMAGE_SIZE := $(ralink_default_fw_size_8M)</code></pre></div><p>Is there anything else I can do to confirm the address of the &quot;rootfs&quot; MTD partition being created is correct? Can I somehow read the image before flashing to confirm the locations/addresses of the kernel and squashfs.root/rootfs ?</p></blockquote></div><p>When building, using &quot;make V=s&quot; gives very verbose output, in the end even of the image packaging process. Have a look.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p336501">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">rmurch</div>
					<div class="post-datetime">
						30 Aug 2016, 10:26					</div>
				</div>
				<div class="post-content content">
					<p>I made the changes that you both suggested, and we got a few steps closer. I added the code to make the Edimax header so I got a &quot;-factory.bin&quot; but was getting the same errors:</p><div class="codebox"><pre><code>Starting kernel ...

[    0.000000] Linux version 4.4.7 (rohbags@wx2.lan) (gcc version 5.3.0 (OpenWrt GCC 5.3.0 r49395) ) #15 Tue Aug 30 056
[    0.000000] Board has DDR2
[    0.000000] Analog PMU set to hw control
[    0.000000] Digital PMU set to hw control
[    0.000000] SoC Type: MediaTek MT7620A ver:2 eco:6
[    0.000000] bootconsole [early0] enabled
[    0.000000] CPU0 revision is: 00019650 (MIPS 24KEc)
[    0.000000] MIPS: machine is Edimax BR-6478ACV2
[    0.000000] Determined physical RAM map:
[    0.000000]  memory: 04000000 @ 00000000 (usable)
[    0.000000] Initrd not found or empty - disabling initrd
[    0.000000] Zone ranges:
[    0.000000]   Normal   [mem 0x0000000000000000-0x0000000003ffffff]
[    0.000000] Movable zone start for each node
[    0.000000] Early memory node ranges
[    0.000000]   node   0: [mem 0x0000000000000000-0x0000000003ffffff]
[    0.000000] Initmem setup node 0 [mem 0x0000000000000000-0x0000000003ffffff]
[    0.000000] Primary instruction cache 64kB, VIPT, 4-way, linesize 32 bytes.
[    0.000000] Primary data cache 32kB, 4-way, PIPT, no aliases, linesize 32 bytes
[    0.000000] Built 1 zonelists in Zone order, mobility grouping on.  Total pages: 16256
[    0.000000] Kernel command line: console=ttyS0,57600 rootfstype=squashfs,jffs2
[    0.000000] PID hash table entries: 256 (order: -2, 1024 bytes)
[    0.000000] Dentry cache hash table entries: 8192 (order: 3, 32768 bytes)
[    0.000000] Inode-cache hash table entries: 4096 (order: 2, 16384 bytes)
[    0.000000] Writing ErrCtl register=000400d2
[    0.000000] Readback ErrCtl register=000400d2
[    0.000000] Memory: 61096K/65536K available (2620K kernel code, 124K rwdata, 660K rodata, 172K init, 189K bss, 4440)
[    0.000000] SLUB: HWalign=32, Order=0-3, MinObjects=0, CPUs=1, Nodes=1
[    0.000000] NR_IRQS:256
[    0.000000] CPU Clock: 580MHz
[    0.000000] clocksource: systick: mask: 0xffff max_cycles: 0xffff, max_idle_ns: 583261500 ns
[    0.000000] systick: enable autosleep mode
[    0.000000] systick: running - mult: 214748, shift: 32
[    0.000000] clocksource: MIPS: mask: 0xffffffff max_cycles: 0xffffffff, max_idle_ns: 6590553264 ns
[    0.000012] sched_clock: 32 bits at 290MHz, resolution 3ns, wraps every 7405115902ns
[    0.015454] Calibrating delay loop... 385.84 BogoMIPS (lpj=1929216)
[    0.080596] pid_max: default: 32768 minimum: 301
[    0.089908] Mount-cache hash table entries: 1024 (order: 0, 4096 bytes)
[    0.102929] Mountpoint-cache hash table entries: 1024 (order: 0, 4096 bytes)
[    0.123277] clocksource: jiffies: mask: 0xffffffff max_cycles: 0xffffffff, max_idle_ns: 19112604462750000 ns
[    0.142894] pinctrl core: initialized pinctrl subsystem
[    0.153861] NET: Registered protocol family 16
[    0.648479] PCI host bridge /pcie@10140000 ranges:
[    0.657864]  MEM 0x0000000020000000..0x000000002fffffff
[    0.668239]   IO 0x0000000010160000..0x000000001016ffff
[    0.686717] rt2880_gpio 10000600.gpio: registering 24 gpios
[    0.697740] rt2880_gpio 10000600.gpio: registering 24 irq handlers
[    0.710801] PCI host bridge to bus 0000:00
[    0.718802] pci_bus 0000:00: root bus resource [mem 0x20000000-0x2fffffff]
[    0.732505] pci_bus 0000:00: root bus resource [io  0xffffffff]
[    0.744242] pci_bus 0000:00: root bus resource [??? 0x00000000 flags 0x0]
[    0.757746] pci_bus 0000:00: No busn resource found for root bus, will use [bus 00-ff]
[    0.773985] pci 0000:00:00.0: bridge configuration invalid ([bus 00-00]), reconfiguring
[    0.790561] pci 0000:00:00.0: BAR 0: no space for [mem size 0x80000000]
[    0.803601] pci 0000:00:00.0: BAR 0: failed to assign [mem size 0x80000000]
[    0.817421] pci 0000:00:00.0: BAR 8: assigned [mem 0x20000000-0x200fffff]
[    0.830923] pci 0000:00:00.0: BAR 9: assigned [mem 0x20100000-0x201fffff pref]
[    0.845287] pci 0000:00:00.0: BAR 1: assigned [mem 0x20200000-0x2020ffff]
[    0.858796] pci 0000:01:00.0: BAR 0: assigned [mem 0x20000000-0x200fffff 64bit]
[    0.873343] pci 0000:01:00.0: BAR 6: assigned [mem 0x20100000-0x2010ffff pref]
[    0.887690] pci 0000:00:00.0: PCI bridge to [bus 01]
[    0.897548] pci 0000:00:00.0:   bridge window [mem 0x20000000-0x200fffff]
[    0.911056] pci 0000:00:00.0:   bridge window [mem 0x20100000-0x201fffff pref]
[    0.925439] pci 0000:00:00.0: card - bus=0x0, slot = 0x0 irq=0
[    0.937020] pci 0000:01:00.0: card - bus=0x1, slot = 0x0 irq=4
[    0.949601] clocksource: Switched to clocksource systick
[    0.961538] NET: Registered protocol family 2
[    0.970999] TCP established hash table entries: 1024 (order: 0, 4096 bytes)
[    0.984772] TCP bind hash table entries: 1024 (order: 0, 4096 bytes)
[    0.997362] TCP: Hash tables configured (established 1024 bind 1024)
[    1.010091] UDP hash table entries: 256 (order: 0, 4096 bytes)
[    1.021622] UDP-Lite hash table entries: 256 (order: 0, 4096 bytes)
[    1.034346] NET: Registered protocol family 1
[    1.043462] rt-timer 10000100.timer: maximum frequency is 1220Hz
[    1.056324] futex hash table entries: 256 (order: -1, 3072 bytes)
[    1.088223] squashfs: version 4.0 (2009/01/31) Phillip Lougher
[    1.099746] jffs2: version 2.2 (NAND) (SUMMARY) (LZMA) (RTIME) (CMODE_PRIORITY) (c) 2001-2006 Red Hat, Inc.
[    1.122048] io scheduler noop registered
[    1.129761] io scheduler deadline registered (default)
[    1.140165] ralink-usb-phy usbphy: invalid resource
[    1.150453] Serial: 8250/16550 driver, 16 ports, IRQ sharing enabled
[    1.166667] console [ttyS0] disabled
[    1.173707] 10000c00.uartlite: ttyS0 at MMIO 0x10000c00 (irq = 20, base_baud = 2500000) is a Palmchip BK-3103
[    1.193382] console [ttyS0] enabled
[    1.193382] console [ttyS0] enabled
[    1.207203] bootconsole [early0] disabled
[    1.207203] bootconsole [early0] disabled
[    1.230077] spi spi0.0: force spi mode3
[    1.238230] m25p80 spi0.0: mx25l6405d (8192 Kbytes)
[    1.248039] 5 ofpart partitions found on MTD device spi0.0
[    1.258972] Creating 5 MTD partitions on &quot;spi0.0&quot;:
[    1.268524] 0x000000000000-0x000000030000 : &quot;u-boot&quot;
[    1.280314] 0x000000030000-0x000000040000 : &quot;u-boot-env&quot;
[    1.292832] 0x000000040000-0x000000050000 : &quot;factory&quot;
[    1.304799] 0x000000050000-0x000000070000 : &quot;cimage&quot;
[    1.316572] 0x000000070000-0x000000800000 : &quot;firmware&quot;
[    1.394246] libphy: mdio: probed
[    1.404737] mtk_soc_eth 10100000.ethernet: using fixed link parameters
[    1.419565] mtk_soc_eth 10100000.ethernet: loaded mt7620 driver
[    1.442266] mtk_soc_eth 10100000.ethernet: loaded mt7530 driver
[    1.454831] mtk_soc_eth 10100000.ethernet eth0: mediatek frame engine at 0xb0100000, irq 5
[    1.471907] rt2880_wdt 10000120.watchdog: Initialized
[    1.482706] NET: Registered protocol family 17
[    1.491695] bridge: automatic filtering via arp/ip/ip6tables has been deprecated. Update your scripts to load br_ne.
[    1.516851] 8021q: 802.1Q VLAN Support v1.8
[    1.529394] VFS: Cannot open root device &quot;(null)&quot; or unknown-block(0,0): error -6
[    1.544377] Please append a correct &quot;root=&quot; boot option; here are the available partitions:
[    1.561032] 1f00             192 mtdblock0  (driver?)
[    1.571110] 1f01              64 mtdblock1  (driver?)
[    1.581183] 1f02              64 mtdblock2  (driver?)
[    1.591258] 1f03             128 mtdblock3  (driver?)
[    1.601340] 1f04            7744 mtdblock4  (driver?)
[    1.611413] Kernel panic - not syncing: VFS: Unable to mount root fs on unknown-block(0,0)
[    1.630368] ---[ end Kernel panic - not syncing: VFS: Unable to mount root fs on unknown-block(0,0)</code></pre></div><p>I noticed that no matter what I tweaked I could not get a initramfs-factory build, so I did the following:</p><div class="codebox"><pre><code>[rohbags@wx2 openwrt]$ cat bin/ramips/openwrt-ramips-mt7620-br6478ac-v2-initramfs-uImage.bin bin/ramips/openwrt-ramips-mt7620-root.squashfs &gt; bin/ramips/openwrt-ramips-mt7620-br6478ac-v2-initramfs-sysupgrade.bin

[rohbags@wx2 openwrt]$ staging_dir/host/bin/mkedimaximg -i bin/ramips/openwrt-ramips-mt7620-br6478ac-v2-initramfs-sysupgrade.bin -o bin/ramips/openwrt-ramips-mt7620-br6478ac-v2-initramfs-factory.bin -s CSYS -m RN68 -f 0x70000 -S 0x1100000

[rohbags@wx2 openwrt]$ tftp -m binary 192.168.1.6 -c put openwrt-ramips-mt7620-br6478ac-v2-initramfs-factory.bin</code></pre></div><p>and amazingly I got this:</p><div class="codebox"><pre><code>## Booting image at bc070000 ...
raspi_read: from:70000 len:40 
Magic number at 0xBC070000 
raspi_read: from:70014 len:40 
   Image Name:   MIPS OpenWrt Linux-4.4.7
   Image Type:   MIPS Linux Kernel Image (lzma compressed)
   Data Size:    2834526 Bytes =  2.7 MB
   Load Address: 80000000
   Entry Point:  80000000
raspi_read: from:70054 len:2b405e 
   Uncompressing Kernel Image ... OK
No initrd
## Transferring control to Linux (at address 80000000) ...
## Giving linux memsize in MB, 64

Starting kernel ...

[    0.000000] Linux version 4.4.7 (rohbags@wx2.lan) (gcc version 5.3.0 (OpenWrt GCC 5.3.0 r49395) ) #22 Tue Aug 30 066
[    0.000000] Board has DDR2
[    0.000000] Analog PMU set to hw control
[    0.000000] Digital PMU set to hw control
[    0.000000] SoC Type: MediaTek MT7620A ver:2 eco:6
[    0.000000] bootconsole [early0] enabled
[    0.000000] CPU0 revision is: 00019650 (MIPS 24KEc)
[    0.000000] MIPS: machine is Edimax BR-6478ACV2
[    0.000000] Determined physical RAM map:
[    0.000000]  memory: 04000000 @ 00000000 (usable)
[    0.000000] Initrd not found or empty - disabling initrd
[    0.000000] Zone ranges:
[    0.000000]   Normal   [mem 0x0000000000000000-0x0000000003ffffff]
[    0.000000] Movable zone start for each node
[    0.000000] Early memory node ranges
[    0.000000]   node   0: [mem 0x0000000000000000-0x0000000003ffffff]
[    0.000000] Initmem setup node 0 [mem 0x0000000000000000-0x0000000003ffffff]
[    0.000000] Primary instruction cache 64kB, VIPT, 4-way, linesize 32 bytes.
[    0.000000] Primary data cache 32kB, 4-way, PIPT, no aliases, linesize 32 bytes
[    0.000000] Built 1 zonelists in Zone order, mobility grouping on.  Total pages: 16256
[    0.000000] Kernel command line: console=ttyS0,57600 rootfstype=squashfs,jffs2
[    0.000000] PID hash table entries: 256 (order: -2, 1024 bytes)
[    0.000000] Dentry cache hash table entries: 8192 (order: 3, 32768 bytes)
[    0.000000] Inode-cache hash table entries: 4096 (order: 2, 16384 bytes)
[    0.000000] Writing ErrCtl register=000626cc
[    0.000000] Readback ErrCtl register=000626cc
[    0.000000] Memory: 59496K/65536K available (2620K kernel code, 124K rwdata, 660K rodata, 1772K init, 189K bss, 604)
[    0.000000] SLUB: HWalign=32, Order=0-3, MinObjects=0, CPUs=1, Nodes=1
[    0.000000] NR_IRQS:256
[    0.000000] CPU Clock: 580MHz
[    0.000000] clocksource: systick: mask: 0xffff max_cycles: 0xffff, max_idle_ns: 583261500 ns
[    0.000000] systick: enable autosleep mode
[    0.000000] systick: running - mult: 214748, shift: 32
[    0.000000] clocksource: MIPS: mask: 0xffffffff max_cycles: 0xffffffff, max_idle_ns: 6590553264 ns
[    0.000012] sched_clock: 32 bits at 290MHz, resolution 3ns, wraps every 7405115902ns
[    0.015456] Calibrating delay loop... 385.84 BogoMIPS (lpj=1929216)
[    0.080611] pid_max: default: 32768 minimum: 301
[    0.089925] Mount-cache hash table entries: 1024 (order: 0, 4096 bytes)
[    0.102944] Mountpoint-cache hash table entries: 1024 (order: 0, 4096 bytes)
[    0.123300] clocksource: jiffies: mask: 0xffffffff max_cycles: 0xffffffff, max_idle_ns: 19112604462750000 ns
[    0.142918] pinctrl core: initialized pinctrl subsystem
[    0.153888] NET: Registered protocol family 16
[    0.648494] PCI host bridge /pcie@10140000 ranges:
[    0.657879]  MEM 0x0000000020000000..0x000000002fffffff
[    0.668254]   IO 0x0000000010160000..0x000000001016ffff
[    0.686740] rt2880_gpio 10000600.gpio: registering 24 gpios
[    0.697764] rt2880_gpio 10000600.gpio: registering 24 irq handlers
[    0.710822] PCI host bridge to bus 0000:00
[    0.718822] pci_bus 0000:00: root bus resource [mem 0x20000000-0x2fffffff]
[    0.732526] pci_bus 0000:00: root bus resource [io  0xffffffff]
[    0.744263] pci_bus 0000:00: root bus resource [??? 0x00000000 flags 0x0]
[    0.757766] pci_bus 0000:00: No busn resource found for root bus, will use [bus 00-ff]
[    0.774007] pci 0000:00:00.0: bridge configuration invalid ([bus 00-00]), reconfiguring
[    0.790587] pci 0000:00:00.0: BAR 0: no space for [mem size 0x80000000]
[    0.803628] pci 0000:00:00.0: BAR 0: failed to assign [mem size 0x80000000]
[    0.817447] pci 0000:00:00.0: BAR 8: assigned [mem 0x20000000-0x200fffff]
[    0.830949] pci 0000:00:00.0: BAR 9: assigned [mem 0x20100000-0x201fffff pref]
[    0.845313] pci 0000:00:00.0: BAR 1: assigned [mem 0x20200000-0x2020ffff]
[    0.858822] pci 0000:01:00.0: BAR 0: assigned [mem 0x20000000-0x200fffff 64bit]
[    0.873368] pci 0000:01:00.0: BAR 6: assigned [mem 0x20100000-0x2010ffff pref]
[    0.887716] pci 0000:00:00.0: PCI bridge to [bus 01]
[    0.897574] pci 0000:00:00.0:   bridge window [mem 0x20000000-0x200fffff]
[    0.911082] pci 0000:00:00.0:   bridge window [mem 0x20100000-0x201fffff pref]
[    0.925465] pci 0000:00:00.0: card - bus=0x0, slot = 0x0 irq=0
[    0.937046] pci 0000:01:00.0: card - bus=0x1, slot = 0x0 irq=4
[    0.949627] clocksource: Switched to clocksource systick
[    0.961580] NET: Registered protocol family 2
[    0.971041] TCP established hash table entries: 1024 (order: 0, 4096 bytes)
[    0.984813] TCP bind hash table entries: 1024 (order: 0, 4096 bytes)
[    0.997403] TCP: Hash tables configured (established 1024 bind 1024)
[    1.010130] UDP hash table entries: 256 (order: 0, 4096 bytes)
[    1.021662] UDP-Lite hash table entries: 256 (order: 0, 4096 bytes)
[    1.034387] NET: Registered protocol family 1
[    3.389875] rt-timer 10000100.timer: maximum frequency is 1220Hz
[    3.402717] futex hash table entries: 256 (order: -1, 3072 bytes)
[    3.430792] squashfs: version 4.0 (2009/01/31) Phillip Lougher
[    3.442309] jffs2: version 2.2 (NAND) (SUMMARY) (LZMA) (RTIME) (CMODE_PRIORITY) (c) 2001-2006 Red Hat, Inc.
[    3.464522] io scheduler noop registered
[    3.472235] io scheduler deadline registered (default)
[    3.482637] ralink-usb-phy usbphy: invalid resource
[    3.492911] Serial: 8250/16550 driver, 16 ports, IRQ sharing enabled
[    3.509131] console [ttyS0] disabled
[    3.516178] 10000c00.uartlite: ttyS0 at MMIO 0x10000c00 (irq = 20, base_baud = 2500000) is a Palmchip BK-3103
[    3.535846] console [ttyS0] enabled
[    3.535846] console [ttyS0] enabled
[    3.549666] bootconsole [early0] disabled
[    3.549666] bootconsole [early0] disabled
[    3.572579] spi spi0.0: force spi mode3
[    3.580778] m25p80 spi0.0: mx25l6405d (8192 Kbytes)
[    3.590569] 5 ofpart partitions found on MTD device spi0.0
[    3.601501] Creating 5 MTD partitions on &quot;spi0.0&quot;:
[    3.611054] 0x000000000000-0x000000030000 : &quot;u-boot&quot;
[    3.622764] 0x000000030000-0x000000040000 : &quot;u-boot-env&quot;
[    3.635301] 0x000000040000-0x000000050000 : &quot;factory&quot;
[    3.647272] 0x000000050000-0x000000070000 : &quot;cimage&quot;
[    3.659038] 0x000000070000-0x000000800000 : &quot;firmware&quot;
[    3.736739] libphy: mdio: probed
[    3.747258] mtk_soc_eth 10100000.ethernet: using fixed link parameters
[    3.762068] mtk_soc_eth 10100000.ethernet: loaded mt7620 driver
[    3.784777] mtk_soc_eth 10100000.ethernet: loaded mt7530 driver
[    3.797333] mtk_soc_eth 10100000.ethernet eth0: mediatek frame engine at 0xb0100000, irq 5
[    3.814395] rt2880_wdt 10000120.watchdog: Initialized
[    3.825180] NET: Registered protocol family 17
[    3.834169] bridge: automatic filtering via arp/ip/ip6tables has been deprecated. Update your scripts to load br_ne.
[    3.859326] 8021q: 802.1Q VLAN Support v1.8
[    3.881146] Freeing unused kernel memory: 1772K (80355000 - 80510000)
[    3.906837] init: Console is alive
[    3.913908] init: - watchdog -
[    3.941595] Error: Driver &#039;gpio-keys&#039; is already registered, aborting...
[    3.956553] Error: Driver &#039;gpio-keys-polled&#039; is already registered, aborting...
[    3.974455] init: - preinit -
[    4.106022] mtk_soc_eth 10100000.ethernet eth0: port 5 link up (1000Mbps/Full duplex)
[    4.122219] 8021q: adding VLAN 0 to HW filter on device eth0
Press the [f] key and hit [enter] to enter failsafe mode
Press the [1], [2], [3] or [4] key and hit [enter] to select the debug level
[    4.354365] random: procd urandom read with 8 bits of entropy available
- failsafe button reset was pressed -
- failsafe -
Generating key, this may take a while...
Public key portion is:
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAAAgQD2ICledf48LqiXcnFhCNojoA8lJKebI11D4i1qpITcFp7ERzaAUk9YBsdyiac7xX5YHJUb4dztBj+cKj)
Fingerprint: md5 c5:ac:9b:33:63:7d:12:a4:e6:3a:f1:a7:39:49:f4:13


BusyBox v1.24.2 () built-in shell (ash)

ash: can&#039;t access tty; job control turned off
  _______                     ________        __
 |       |.-----.-----.-----.|  |  |  |.----.|  |_
 |   -   ||  _  |  -__|     ||  |  |  ||   _||   _|
 |_______||   __|_____|__|__||________||__|  |____|
          |__| W I R E L E S S   F R E E D O M
 -----------------------------------------------------
 DESIGNATED DRIVER (Bleeding Edge, r49395)
 -----------------------------------------------------
  * 2 oz. Orange Juice         Combine all juices in a
  * 2 oz. Pineapple Juice      tall glass filled with
  * 2 oz. Grapefruit Juice     ice, stir well.
  * 2 oz. Cranberry Juice
 -----------------------------------------------------
================= FAILSAFE MODE active ================
special commands:
* firstboot          reset settings to factory defaults
* mount_root     mount root-partition with config files

after mount_root:
* passwd                         change root&#039;s password
* /etc/config               directory with config files

for more help see:
http://wiki.openwrt.org/doc/howto/generic.failsafe
=======================================================

root@(none):/#</code></pre></div><br /><p>Thank you very much gentleman for your help thus far, I am off to have a beer on the strength of that.</p><p>Still more issues to over come, as this uart port looks to be output only so I can use the shell, but the stock firmware loaded 2x serial82550 ports ttyS0 and ttyS1 (0x500 and 0xc00) so I need to sort that out first. Will update the other &quot;Edimax BR-6478AC V2&quot; post with this result and other issues as I face them.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p336550">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">elektroman</div>
					<div class="post-datetime">
						30 Aug 2016, 19:11					</div>
				</div>
				<div class="post-content content">
					<p>@all<br />updated in git</p><p>thanks guys.</p><p>Can some check this on real hw. I don&#039;t have this router.<br />@rmurch</p><p>for serial I will look, I think there is some misconfiguration in DTS</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p336586">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">rmurch</div>
					<div class="post-datetime">
						30 Aug 2016, 21:33					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>elektroman wrote:</cite><blockquote><p>@all<br />updated in git</p></blockquote></div><p>Which repo is updated? I checked out both openwrt-truck and do-work/Edimax but could not find it <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><div class="quotebox"><cite>elektroman wrote:</cite><blockquote><p>for serial I will look, I think there is some misconfiguration in DTS</p></blockquote></div><p>I have been trying to use &quot;uartf_pins&quot; or &quot;spi_pins&quot; for the uart@500 with no luck, &quot;spi_pins&quot; seems to crash the kernel on boot into a infinite loop right after CPU revision and before MIPS board type detection.</p><p>Not sure what is going on with uartlite@c00, with the Rx pin disconnected I get random garbage on the console, meaning the pin is floating and expecting an input (so it *is* the input pin, and the uart *is* bi-directional). Once I connect the usb-uart Tx pin to the MT7620a-uartlite Rx pin the garbage stops and the console is clean, but it acts as a uni-directional uart port, openwrt seems to receive no data on its uartlite pin.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p336595">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">elektroman</div>
					<div class="post-datetime">
						30 Aug 2016, 22:01					</div>
				</div>
				<div class="post-content content">
					<p>Damn, pushed to hidden repo, now online<br />To track and merge <br /></p><div class="codebox"><pre><code>git checkout Edimax
git branch -u elektroman/do-work/Edimax
git merge</code></pre></div><p>for serial again I must check.<br />This is the correct line from one of you previous posts here<br /></p><div class="codebox"><pre><code>[    0.840000] 10000c00.uartlite: ttyS0 at MMIO 0x10000c00 (irq = 20, base_baud = 2500000) is a 16550A</code></pre></div><p>and this is the wrong one<br /></p><div class="codebox"><pre><code>[    3.516178] 10000c00.uartlite: ttyS0 at MMIO 0x10000c00 (irq = 20, base_baud = 2500000) is a Palmchip BK-3103</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p336760">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">elektroman</div>
					<div class="post-datetime">
						31 Aug 2016, 20:21					</div>
				</div>
				<div class="post-content content">
					<p>Next update for this board<br />DTB was not added at the end</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p341960">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">liveonlinux</div>
					<div class="post-datetime">
						24 Oct 2016, 10:32					</div>
				</div>
				<div class="post-content content">
					<p>0x70000 , 0x1100000, it&#039;s same as dts file. why it&#039;s OK as follows? What is changed?</p><div class="codebox"><pre><code>[rohbags@wx2 openwrt]$ cat bin/ramips/openwrt-ramips-mt7620-br6478ac-v2-initramfs-uImage.bin bin/ramips/openwrt-ramips-mt7620-root.squashfs &gt; bin/ramips/openwrt-ramips-mt7620-br6478ac-v2-initramfs-sysupgrade.bin

[rohbags@wx2 openwrt]$ staging_dir/host/bin/mkedimaximg -i bin/ramips/openwrt-ramips-mt7620-br6478ac-v2-initramfs-sysupgrade.bin -o bin/ramips/openwrt-ramips-mt7620-br6478ac-v2-initramfs-factory.bin -s CSYS -m RN68 -f 0x70000 -S 0x1100000

[rohbags@wx2 openwrt]$ tftp -m binary 192.168.1.6 -c put openwrt-ramips-mt7620-br6478ac-v2-initramfs-factory.bin</code></pre></div>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0.001 -->

</body>
</html>