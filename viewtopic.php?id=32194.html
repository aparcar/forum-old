<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Samba performance, where is the bottleneck?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 5 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p144899">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">sliter</div>
					<div class="post-datetime">
						1 Oct 2011, 13:32					</div>
				</div>
				<div class="post-content content">
					<p>I recently build up a samba server in my routers which have 4 gigabits LAN interfaces. But the downloading rate of a linux client is only around 6.4MB/s maximum. Upload is even worse.</p><p>1. I followed all kinds of samba performance tuning, such as buffer size, socket options etc. Nothing works except when enabling sendfile makes it from 5.9MB/s to 6.4MB/s.</p><p>2. I also tried to make the configuration as bad as possible, such as increase the log level, disable all the sockets options, even disable everything in the global part. The rate stays still at 5.9MB/s</p><p>3. Oprofile shows there are about 35% of time during a transmission that CPU is in the defalut_idle function. And do_sendfile only takes 0.1% of the CPU time.</p><p>There is no problem with the router&#039;s storage device. So is anyone have some idea where the problem may be? Thanks</p><br /><p>samples&nbsp; &nbsp; %&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;image name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;app name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;symbol name<br />92859&nbsp; &nbsp; 37.6019&nbsp; &nbsp; &nbsp; &nbsp;vmlinux&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; vmlinux&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; default_idle<br />16448&nbsp; &nbsp; &nbsp;6.6604&nbsp; &nbsp; &nbsp; &nbsp; vmlinux&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; smbd&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; eth_send_packet<br />13998&nbsp; &nbsp; &nbsp;5.6683&nbsp; &nbsp; &nbsp; &nbsp; vmlinux&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; smbd&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;csum_partial_copy_from_user<br />8565&nbsp; &nbsp; &nbsp; 3.4683&nbsp; &nbsp; &nbsp;nf_conntrack&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;smbd&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/nf_conntrack<br />5974&nbsp; &nbsp; &nbsp; 2.4191&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;smbd&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;smbd&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/bin/smbd</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p144912">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">Orca</div>
					<div class="post-datetime">
						1 Oct 2011, 18:23					</div>
				</div>
				<div class="post-content content">
					<p>My car is green, consumes 10gallons/100miles and its ash tray is full. Why is there a sock in the trunk?</p><p>A brief answer is: probably you CPU is too weak to allow for more troughput! Try &quot;top&quot; during a transmission.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>