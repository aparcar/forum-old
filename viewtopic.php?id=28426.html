<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Forcing all traffic through a ssh-socks5-tunnel?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 27 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p127081">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">locutus</div>
					<div class="post-datetime">
						1 Feb 2011, 20:42					</div>
				</div>
				<div class="post-content content">
					<p>i know there are some threads with similar questions but i couldn&#039;t really find an answer in them. i also checked the wiki quite a bit yet did not find anything helpfull either.</p><p>so what i want to do is:</p><p>i can open a socks5-connection to some server via ssh (ssh -d&lt;port&gt; &lt;user@server) and use that as proxy on my normal computers (with some config of course), yet i would want to use that ssh-tunnel without having to set anything up on the computers and without having to have a running computer nearby to keep the ssh-socks-tunnel open, because i have a web-radio which has no option to configure a proxy and even if it could configure one, it couldn&#039;t establish the ssh-connection itself. <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p><p>in other words, what i want to know is:</p><p>can openwrt:</p><p>establish that ssh-tunnel? (i guess yes)<br />then route any traffic that any endpoint on the lan demands over that ssh-tunnel?<br />and how much would that reduce the throughput through the tunnel? (lets say the connection to the internet is gigabit - just as an example) - also: which router would allow the fastest throughput over that tunnel?</p><p>and, if that all is possible, how?&nbsp; is there some script/software available somewhere that i would just need to install on the openwrt to get it to work? or is there more that needs to be done?</p><p>also, i do not have an openwrt-router yet since i first want to make sure that what i want to do will really be possible. <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p127102">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">cybe</div>
					<div class="post-datetime">
						1 Feb 2011, 22:25					</div>
				</div>
				<div class="post-content content">
					<p>Take a look at <a href="https://github.com/apenwarr/sshuttle/">sshuttle</a>.<br />It requires python though.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p127103">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">Ritmo2k</div>
					<div class="post-datetime">
						1 Feb 2011, 22:37					</div>
				</div>
				<div class="post-content content">
					<p>I would imagine that would be processor intensive, hence your bottleneck would lie in the fact most routers have tiny procs.<br />Is it all traffic, or just one protocol for example you want routed?<br />If its only one protocol, you can accomplish this all with iptables and routes.<br />If its all traffic, might you consider using OpenVPN? Its designed for this...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p127113">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">locutus</div>
					<div class="post-datetime">
						2 Feb 2011, 00:15					</div>
				</div>
				<div class="post-content content">
					<p>the sshuttle solution sounds quite usefull - especially since i do not have admin privilegues on the server i am using as tunnel-endpoint. yet i do not have any knowledge in python (and only very basic knowledge in c++, assembler and java). and: as far as i can overview it: is it installing some software on the remote server in any way?</p><p>about the traffic: most important would be the traffic of my webradio, yet i do not know on which ports it is transmitting. eventhough it would really be good if any traffic would be redirected over the tunnel. but i guess sshuttle is similar to openvpn and would allow about the same features?</p><p>in the end, i guess i&#039;d give sshuttle a try. so now all i&#039;d need to know is which router would give the best performance. <br />after reading the article about supported hardware, i cut it down to these:</p><p>TP-Link TL-WR1043ND<br />D-Link DIR-825<br />Buffalo WZR-HP-G300NH<br />RouterStation Pro (gee, expensive. <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> )</p><p>which one of them would fit the need the most? if needed, i can also do soldering mods to them (i.e. exchanging ram).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p127115">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">Ritmo2k</div>
					<div class="post-datetime">
						2 Feb 2011, 00:56					</div>
				</div>
				<div class="post-content content">
					<p>I just bought a Buffalo WZR-HP-G300NH and have the latest rc4 on it, its working very well...<br />Lots of flash.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p127142">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">locutus</div>
					<div class="post-datetime">
						2 Feb 2011, 15:54					</div>
				</div>
				<div class="post-content content">
					<p>that sounds good. but what about ram? also, i cannot find any pictures of the interior, so i do not know what i could mod on the whole thing. yet i would be interested in expanding the ram along with adding everything else the board might offer (a serial port really would be usefull, i could even imagine the router doubling as a remote lirc server? o.O).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p128943">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">locutus</div>
					<div class="post-datetime">
						20 Feb 2011, 15:16					</div>
				</div>
				<div class="post-content content">
					<p>okay, so i got that Buffalo WZR-HP-G300NH. after first running in a bit of trouble with flashing openWRT (i had to go the way over dd-wrt), i tried to run sshuttle, but i guess i am not quite experienced enough to really understand what i need to do. </p><p>first, i installed the python-packages over opkg on the router. then i downloaded the sshuttle-files (as zip) onto my computer, extracted them, moved them onto an usb-stick, mounted that usb-stick on the router (according to the guidelines on the routers description page) and copied the sshuttle-folder to the /usr dir. then i tried ./sshuttle with the recomended commands, but adding an -x IP-range to exclude a specific range and a -D to run it as a daemon. after hitting enter, the ssh-console did not do anything. </p><p>so what am i doing wrong? i am not quite experienced with linux! i just want this to get to work. <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><br /><p>this is the output i got from putty: (with modified personal information like &quot;ip to exclude&quot;, &quot;ssh-server-name&quot; and such.)</p><div class="codebox"><pre><code>root@OpenWrt:~# cd /usr/sshuttle
root@OpenWrt:/usr/sshuttle# ./sshuttle -r SSH-Server-Name 0.0.0.0/0 -x IP1.0.0.0/8 -vv
Starting sshuttle proxy.
Binding: 12300
Listening on (&#039;127.0.0.1&#039;, 12300).
firewall manager ready.
c : connecting to server...
c : executing: [&#039;ssh&#039;, &#039;SSH-Server-Name&#039;, &#039;--&#039;, &#039;P=python2; $P -V 2&gt;/dev/null || P=python; &quot;$P&quot; -c \&#039;import sys; skip_imports=1; verbosity=2; exec compile(sys.stdin.read(764), &quot;assembler.py&quot;, &quot;exec&quot;)\&#039;&#039;]
c :  &gt; channel=0 cmd=PING len=7 (fullness=0)
WARNING: Ignoring unknown argument &#039;--&#039;
Login for SSH-Server-Name
Password:
server: assembling &#039;cmdline_options.py&#039; (29 bytes)
server: assembling &#039;helpers.py&#039; (693 bytes)
server: assembling &#039;ssubprocess.py&#039; (13702 bytes)
server: assembling &#039;ssnet.py&#039; (4860 bytes)
server: assembling &#039;hostwatch.py&#039; (2180 bytes)
server: assembling &#039;server.py&#039; (2074 bytes)
 s: latency control setting = True
 s: available routes:
 s:   xxx.xxx.xxx.xxx/26
 s:   192.168.1.0/24
 s:   169.254.0.0/16
c : connected.
Connected.
c : Waiting: 2 r=[3, 9] w=[9] x=[] (fullness=7/0)
c :   Ready: 2 r=[] w=[9] x=[]
c : mux wrote: 15/15
c : Waiting: 2 r=[3, 9] w=[] x=[] (fullness=7/0)
 s:  &gt; channel=0 cmd=PING len=7 (fullness=0)
 s:  &gt; channel=0 cmd=ROUTES len=46 (fullness=7)
 s: Waiting: 1 r=[4] w=[5] x=[] (fullness=53/0)
 s:   Ready: 1 r=[] w=[5] x=[]
c :   Ready: 2 r=[9] w=[] x=[]
c : &lt;  channel=0 cmd=PING len=7
c :  &gt; channel=0 cmd=PONG len=7 (fullness=7)
c : mux wrote: 15/15
c : Waiting: 2 r=[3, 9] w=[] x=[] (fullness=14/0)
 s: mux wrote: 15/15
c :   Ready: 2 r=[9] w=[] x=[]
c : &lt;  channel=0 cmd=ROUTES len=46
firewall manager: starting transproxy.
 s: mux wrote: 54/54
 s: Waiting: 1 r=[4] w=[] x=[] (fullness=53/0)
 s:   Ready: 1 r=[4] w=[] x=[]
 s: &lt;  channel=0 cmd=PING len=7
 s:  &gt; channel=0 cmd=PONG len=7 (fullness=53)
 s: mux wrote: 15/15
 s: Waiting: 1 r=[4] w=[] x=[] (fullness=60/0)
&gt;&gt; iptables -t nat -D OUTPUT -j sshuttle-12300
 s:   Ready: 1 r=[4] w=[] x=[]
 s: &lt;  channel=0 cmd=PONG len=7
 s: received PING response
 s: Waiting: 1 r=[4] w=[] x=[] (fullness=0/0)
iptables: No chain/target/match by that name.
firewall manager: undoing changes.
&gt;&gt; iptables -t nat -D OUTPUT -j sshuttle-12300
iptables: No chain/target/match by that name.
fatal: [&#039;iptables&#039;, &#039;-t&#039;, &#039;nat&#039;, &#039;-D&#039;, &#039;OUTPUT&#039;, &#039;-j&#039;, &#039;sshuttle-12300&#039;] returned 1
c : fatal: cleanup: [&#039;python&#039;, &#039;./main.py&#039;, &#039;python&#039;, &#039;-v&#039;, &#039;-v&#039;, &#039;--firewall&#039;, &#039;12300&#039;, &#039;0&#039;] returned 99
root@OpenWrt:/usr/sshuttle#</code></pre></div>											<p class="post-edited">(Last edited by <strong>locutus</strong> on 20 Feb 2011, 15:25)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>