<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> How to disable UDMA access to HDD?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 6 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p50285">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">Marek</div>
					<div class="post-datetime">
						11 Jun 2007, 23:58					</div>
				</div>
				<div class="post-content content">
					<p>How can I disable the UDMA access to HDD in kamikaze? I use WRAP-2C (x86) with (5GB Sygate Microdrive) and it doesn&#039;t support udma and the root time is horrible long..</p><div class="codebox"><pre><code>SC1200: IDE controller at PCI slot 0000:00:12.2
SC1200: chipset revision 1
SC1200: not 100% native mode: will probe irqs later
    ide0: BM-DMA at 0xfc00-0xfc07, BIOS settings: hda:pio, hdb:pio
    ide1: BM-DMA at 0xfc08-0xfc0f, BIOS settings: hdc:pio, hdd:pio
hda: ST650211CF, CFA DISK drive
Clocksource tsc unstable (delta = -490051000 ns)
Time: pit clocksource has been installed.
hda: sc1200_set_xfer_mode(UDMA 2)
ide0 at 0x1f0-0x1f7,0x3f6 on irq 14
hdc: IRQ probe failed (0xbefa)
hdc: IRQ probe failed (0xbefa)
hdc: no response (status = 0x0a), resetting drive
hdc: IRQ probe failed (0xbefa)
hdc: no response (status = 0x0a)
hdd: IRQ probe failed (0xbefa)
hdd: IRQ probe failed (0xbefa)
hdd: no response (status = 0x0a), resetting drive
hdd: IRQ probe failed (0xbefa)
hdd: no response (status = 0x0a)
hdc: IRQ probe failed (0xbefa)
hdc: IRQ probe failed (0xbefa)
hdc: no response (status = 0x0a), resetting drive
hdc: IRQ probe failed (0xbefa)
hdc: no response (status = 0x0a)
hdd: IRQ probe failed (0xbefa)
hdd: IRQ probe failed (0xbefa)
hdd: no response (status = 0x0a), resetting drive
hdd: IRQ probe failed (0xbefa)
hdd: no response (status = 0x0a)
hda: max request size: 128KiB
hda: 9767520 sectors (5000 MB) w/128KiB Cache, CHS=9690/16/63, UDMA(33)
hda: cache flushes supported
 hda:&lt;4&gt;hda: dma_timer_expiry: dma status == 0x21
hda: DMA timeout error
 ide_dma_end dma_stat=21 err=1 newerr=0
hda: dma timeout error: status=0x58 { DriveReady SeekComplete DataRequest }
ide: failed opcode was: unknown
hda: DMA disabled
ide0: reset: success
 hda1 hda2
block2mtd: version $Revision: 1.30 $
PNP: No PS/2 controller found. Probing ports directly.
i8042.c: No controller found.
mice: PS/2 mouse device common for all mice
enabling scx200 high-res timer (1 MHz +0 ppm)
nf_conntrack version 0.5.0 (512 buckets, 4096 max)
Time: scx200_hrt clocksource has been installed.
ip_tables: (C) 2000-2006 Netfilter Core Team
TCP vegas registered
NET: Registered protocol family 1
NET: Registered protocol family 17
Bridge firewalling registered
802.1Q VLAN Support v1.8 Ben Greear &lt;greearb@candelatech.com&gt;
All bugs added by David S. Miller &lt;davem@redhat.com&gt;
Using IPI Shortcut mode
hda: dma_timer_expiry: dma status == 0x21
hda: DMA timeout error
 ide_dma_end dma_stat=21 err=1 newerr=0
hda: dma timeout error: status=0x58 { DriveReady SeekComplete DataRequest }
ide: failed opcode was: unknown
hda: DMA disabled
ide0: reset: success
hda: dma_timer_expiry: dma status == 0x21
hda: DMA timeout error
 ide_dma_end dma_stat=21 err=1 newerr=0
hda: dma timeout error: status=0x58 { DriveReady SeekComplete DataRequest }
ide: failed opcode was: unknown
hda: DMA disabled
ide0: reset: success
ide0: reset: success
 hda1 hda2
block2mtd: version $Revision: 1.30 $
PNP: No PS/2 controller found. Probing ports directly.
i8042.c: No controller found.
mice: PS/2 mouse device common for all mice
enabling scx200 high-res timer (1 MHz +0 ppm)
nf_conntrack version 0.5.0 (512 buckets, 4096 max)
Time: scx200_hrt clocksource has been installed.
ip_tables: (C) 2000-2006 Netfilter Core Team
TCP vegas registered
NET: Registered protocol family 1
NET: Registered protocol family 17
Bridge firewalling registered
802.1Q VLAN Support v1.8 Ben Greear &lt;greearb@candelatech.com&gt;
All bugs added by David S. Miller &lt;davem@redhat.com&gt;
Using IPI Shortcut mode
hda: dma_timer_expiry: dma status == 0x21
hda: DMA timeout error
 ide_dma_end dma_stat=21 err=1 newerr=0
hda: dma timeout error: status=0x58 { DriveReady SeekComplete DataRequest }
ide: failed opcode was: unknown
hda: DMA disabled
ide0: reset: success
hda: dma_timer_expiry: dma status == 0x21
hda: DMA timeout error
 ide_dma_end dma_stat=21 err=1 newerr=0
hda: dma timeout error: status=0x58 { DriveReady SeekComplete DataRequest }
ide: failed opcode was: unknown
hda: DMA disabled
ide0: reset: success
hda: dma_timer_expiry: dma status == 0x21
hda: DMA timeout error
 ide_dma_end dma_stat=21 err=1 newerr=0
hda: dma timeout error: status=0x58 { DriveReady SeekComplete DataRequest }
ide: failed opcode was: unknown
hda: DMA disabled
ide0: reset: success
VFS: Mounted root (ext2 filesystem) readonly.
Freeing unused kernel memory: 128k freed
Warning: unable to open an initial console.
- preinit -
EXT2-fs warning: mounting unchecked fs, running e2fsck is recommended
- init -
init started:  BusyBox v1.4.2 (2007-06-08 13:38:32 EDT) multi-call binary</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p50865">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">Weedy</div>
					<div class="post-datetime">
						20 Jun 2007, 11:23					</div>
				</div>
				<div class="post-content content">
					<p>hdparm -X</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p50879">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">Marek</div>
					<div class="post-datetime">
						20 Jun 2007, 12:20					</div>
				</div>
				<div class="post-content content">
					<p>Should I execute it every reboot or it will disable UDMA for good?&nbsp; executing every reboot will not change anything because the problem is this long waiting until openwrt disable dma by itself...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p51106">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">Marek</div>
					<div class="post-datetime">
						23 Jun 2007, 16:24					</div>
				</div>
				<div class="post-content content">
					<p>ofcourse the hdparm -X ia a crap - it disables udma mode AFTER the system boot process so you can execute it by the hand or by init script...<br />Any other suggestions? nbd, mbm are you there?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p51126">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">Bartman007</div>
					<div class="post-datetime">
						23 Jun 2007, 21:47					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Marek wrote:</cite><blockquote><p>ofcourse the hdparm -X ia a crap - it disables udma mode AFTER the system boot process so you can execute it by the hand or by init script...</p></blockquote></div><p>[s]If you read the man page for <a href="http://www.linuxcommand.org/man_pages/hdparm8.html">hdparm(8)</a> which is available on any non-embedded linux distribution, you would realize that the -X flag (with the appropriate argument) is to be used to disable DMA <span class="bbu">on the drive itself</span>.&nbsp; This should persist reboots since it has been programmed into the drive; if it does not work then the drive itself isn&#039;t working properly.[/s]</p><p>Edit: hmm, this info was incorrect, don&#039;t know why I thought the changes would persist reboots...</p>											<p class="post-edited">(Last edited by <strong>Bartman007</strong> on 30 Aug 2007, 20:11)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p54809">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">Marek</div>
					<div class="post-datetime">
						30 Aug 2007, 14:12					</div>
				</div>
				<div class="post-content content">
					<p>I tried this, unfortuletally without success...<br />I almost sure that disabling UDMA is possible somewhere in init scripts or maybe in kernel_menuconfig before compiling. Developers, could you help me?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p54828">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">mooninite</div>
					<div class="post-datetime">
						30 Aug 2007, 19:47					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Marek wrote:</cite><blockquote><p>I tried this, unfortuletally without success...<br />I almost sure that disabling UDMA is possible somewhere in init scripts or maybe in kernel_menuconfig before compiling. Developers, could you help me?</p></blockquote></div><p>It is not possible to disable it in the kernel. That would be silly.</p><p>You *can* disable it on the kernel command line though. Add &quot;ide=nodma&quot; to your boot loader&#039;s configure file for the kernel you are booting.</p><p>This will only work if your ide driver is built-in (i.e. not a module). If it is a module you will need to pass it as a module option. This should work for both 2.4. and 2.6... but maybe not 2.6 since we&#039;ve switched to the new SATA driver in 2.6.19. (or was it .18)</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>