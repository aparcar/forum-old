<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> shairport on openwrt</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 2 Sep 2014 and 25 Apr 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 6 of 7</div><nav><ul><li><a href="viewtopic.php%3Fid=29491&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=29491&amp;p=4.html">4</a></li><li><a href="viewtopic.php%3Fid=29491&amp;p=5.html">5</a></li><li class="pagination-current"><span>6</span></li><li><a href="viewtopic.php%3Fid=29491&amp;p=7.html">7</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p192766">
				<div class="post-metadata">
					<div class="post-num">Post #126</div>
					<div class="post-author">mikejuni</div>
					<div class="post-datetime">
						22 Feb 2013, 06:00					</div>
				</div>
				<div class="post-content content">
					<p>Hi all,</p><p>I&#039;ve posted another update to my WRT feed in github.com/mikejuni/OpenWRT-ShairPort, some updates<br/>1. Defaults to ALSA and use ALSA volume mixer instead of software emulation.<br/>2. Added a asound.conf that help disable DMIX which has poor quality in USB audio devices.<br/>3. Added /etc/config/airplay and /etc/init.d/airplay which make use of UCI to config it.</p><p>Also fixed compilation for libao in the ShairPort source code. However I don&#039;t know how to make those changes required in OpenWRT make file to enable this option in OpenWRT. Anyone who wish to help could submit a patch or a git pull to me.</p><p>With these I could lower my OpenWRT shairport build CPU utilization from 40% to 10%, mainly by disabling DMIX and some tuning in calculations.</p><p>It should now be as easy as a &quot;add a feed, enable and compile&quot; in OpenWRT with no build dependency errors.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p192958">
				<div class="post-metadata">
					<div class="post-num">Post #127</div>
					<div class="post-author">gregd72002</div>
					<div class="post-datetime">
						23 Feb 2013, 21:52					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>mikejuni wrote:</cite><blockquote><p>I&#039;ll probably soon add it back after fixing the compile issue with libao which is introduced by Skaman&#039;s patch. But I believe most OpenWRT users would need alsa only because they&#039;ll be using USB based audio on routers.</p></blockquote></div><p>Sure, however note that OpenWRT is used on many different devices, not only routers.</p><p>Thanks for the input!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p193087">
				<div class="post-metadata">
					<div class="post-num">Post #128</div>
					<div class="post-author">ryzhov_al</div>
					<div class="post-datetime">
						25 Feb 2013, 07:07					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>grayman4hire wrote:</cite><blockquote><p>I went ahead and submitted a request to the entware team to update ShairPort for entware based on @skaman and @mikejuni&#039;s update below.</p></blockquote></div><p>Done! Thank you for a feedback.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p193251">
				<div class="post-metadata">
					<div class="post-num">Post #129</div>
					<div class="post-author">grayman4hire</div>
					<div class="post-datetime">
						26 Feb 2013, 20:05					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>ryzhov_al wrote:</cite><blockquote><div class="quotebox"><cite>grayman4hire wrote:</cite><blockquote><p>I went ahead and submitted a request to the entware team to update ShairPort for entware based on @skaman and @mikejuni&#039;s update below.</p></blockquote></div><p>Done! Thank you for a feedback.</p></blockquote></div><p>Thank you @ryzhov_al!</p><p>A couple of questions for @mikejuni and other shairport users.</p><p>On the previous build/version of shairport (this is on TomatoUSB), I only needed to run:<br/>shairport -a &quot;Living Room&quot; -b 282</p><p>On the latest build based on @mikejuni, I have to use:<br/>shairport -a &quot;Living Room&quot; -b 282 --ao_driver=oss</p><p>If I don&#039;t specify a ao_driver, I get a &quot;FATAL: Could not find requested ao driver&quot; message.</p><p>I fiddled with ao_driver=alsa, but still couldn&#039;t get it to work. I couldn&#039;t figure out the correct ao_devicename or ao_deviceid to use. Should I bother to figure this out? Am I correct that when I specific ao_driver=oss it actually defaults back to alsa?</p><p>Last question, what buffer settings are you using? I thought I read that 282 was recommended or do you use the lowest buffer you can get away with? Thanks</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p195429">
				<div class="post-metadata">
					<div class="post-num">Post #130</div>
					<div class="post-author">brontide</div>
					<div class="post-datetime">
						19 Mar 2013, 20:45					</div>
				</div>
				<div class="post-content content">
					<p>Any recent movement on this.&nbsp; Tried to build for 12.90-rc1 and just can&#039;t seem to get it to work.&nbsp; The stock shairport &quot;2012-10-20&quot; seems to build, install, and run, but despite running with mDNS support the clients just connect and disconnect; the mikejuni shairport-0.05 seems to crash on startup &quot;Address family not supported by protocol&quot;.</p><p>Audio is c-media USB and cat /dev/urandom &gt; /dev/audio produces static through the speakers, so at least I know that&#039;s working.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p195497">
				<div class="post-metadata">
					<div class="post-num">Post #131</div>
					<div class="post-author">brontide</div>
					<div class="post-datetime">
						20 Mar 2013, 16:43					</div>
				</div>
				<div class="post-content content">
					<p>loading kmod-ipv6 resolved some of the errors, but still both modules fail.</p><br/><p>With the one from trunk I get.<br/>root@OpenWrt:~# /usr/sbin/shairport -a TESTING3 -b 256 -v3<br/>LogLevel: 7<br/>AirName: TESTING3<br/>HWID: ZjN6PF<br/>HWID_Hex(12): 005A6A4E3650<br/>Avahi/DNS-SD started on PID: 1668<br/>Starting connection server: specified server port: 5002<br/>Waiting for clients to connect<br/>Avahi/DNS-SD Name: 005A6A4E3650@TESTING3<br/>Established under name &#039;005A6A4E3650@TESTING3&#039;<br/>Error: Unable to accept connection to server socket: Bad address<br/>Waiting for clients to connect<br/>Error: Unable to accept connection to server socket: Bad address<br/>Waiting for clients to connect</p><p>With Mikejuni I get.<br/>...</p><p>----Send Response Header----<br/>Waiting To Read...<br/>ALSA: Sample rate gotten 44100<br/>ALSA: Use ALSA Mixer rather than soft manupulating volume<br/>/usr/bin/shairport: simple.c: 282: snd_mixer_selem_get_playback_volume_range: Assertion `elem&#039; failed.<br/>Read -1 of data so far</p><p>Error reading data from socket, got: -1 bytesError reading from socket, closing client<br/>Waiting for clients to connect</p><p>Any ideas?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p195509">
				<div class="post-metadata">
					<div class="post-num">Post #132</div>
					<div class="post-author">brontide</div>
					<div class="post-datetime">
						20 Mar 2013, 18:24					</div>
				</div>
				<div class="post-content content">
					<p>UPDATE: I was able to do a</p><p>make package/shairport/prepare</p><p>diable alsa mixing in the Makefile, compile and install and the mikejuni version now works.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p195515">
				<div class="post-metadata">
					<div class="post-num">Post #133</div>
					<div class="post-author">brontide</div>
					<div class="post-datetime">
						20 Mar 2013, 19:41					</div>
				</div>
				<div class="post-content content">
					<p>Went back and did more testing with the mikejuni package that was bombing out.</p><p>If using the mikejuni package and getting the &quot;/usr/bin/shairport: simple.c: 282: snd_mixer_selem_get_playback_volume_range: Assertion `elem&#039; failed.&quot;.&nbsp; Install alsa-utils and fire up alsamixer, look at the control for the volume and change option volume &#039;&lt;VALUE&gt;&#039; in my case it was option volume &#039;PCM&#039;.&nbsp; This allowed it to start and run normally.</p><p>I have a feeling trunk shairport just won&#039;t work correctly on AA 12.09-rc1 because of library mismatches, I have a custom build that I will be working on shortly, so I can test that theory as well.&nbsp; I might try and pull out the package and build it with the older trunk feed to see if that makes a difference.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p197366">
				<div class="post-metadata">
					<div class="post-num">Post #134</div>
					<div class="post-author">weereew</div>
					<div class="post-datetime">
						5 Apr 2013, 17:28					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>brontide wrote:</cite><blockquote><p>Went back and did more testing with the mikejuni package that was bombing out.</p><p>If using the mikejuni package and getting the &quot;/usr/bin/shairport: simple.c: 282: snd_mixer_selem_get_playback_volume_range: Assertion `elem&#039; failed.&quot;.&nbsp; Install alsa-utils and fire up alsamixer, look at the control for the volume and change option volume &#039;&lt;VALUE&gt;&#039; in my case it was option volume &#039;PCM&#039;.&nbsp; This allowed it to start and run normally.</p><p>I have a feeling trunk shairport just won&#039;t work correctly on AA 12.09-rc1 because of library mismatches, I have a custom build that I will be working on shortly, so I can test that theory as well.&nbsp; I might try and pull out the package and build it with the older trunk feed to see if that makes a difference.</p></blockquote></div><p>I have the same problem with mikejuni&#039;s package when i use a USB PCM2706 DAC, after changing option volume to &#039;PCM&#039; it works. </p><p>And the problem i still have is the volume control by ios devices or itunes, it doesn&#039;t change the volume smoothly but like &quot;non-linear&quot;, by each click of the volume &#039;+&#039; or &#039;-&#039; it will increase or decrease the volume by about 50%(i have observed the volume change by perform the command &#039;alsamixer&#039; and it shows on the ssh terminal...).</p><p>So when i want to max the volume i only need click 4 or 5 time, and from max volume to almost mute also need only 4-5 clicks...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p204681">
				<div class="post-metadata">
					<div class="post-num">Post #135</div>
					<div class="post-author">lyf86822</div>
					<div class="post-datetime">
						15 Jun 2013, 07:19					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>brontide wrote:</cite><blockquote><p>loading kmod-ipv6 resolved some of the errors, but still both modules fail.</p><br/><p>With the one from trunk I get.<br/>root@OpenWrt:~# /usr/sbin/shairport -a TESTING3 -b 256 -v3<br/>LogLevel: 7<br/>AirName: TESTING3<br/>HWID: ZjN6PF<br/>HWID_Hex(12): 005A6A4E3650<br/>Avahi/DNS-SD started on PID: 1668<br/>Starting connection server: specified server port: 5002<br/>Waiting for clients to connect<br/>Avahi/DNS-SD Name: 005A6A4E3650@TESTING3<br/>Established under name &#039;005A6A4E3650@TESTING3&#039;<br/>Error: Unable to accept connection to server socket: Bad address<br/>Waiting for clients to connect<br/>Error: Unable to accept connection to server socket: Bad address<br/>Waiting for clients to connect</p><p>With Mikejuni I get.<br/>...</p><p>----Send Response Header----<br/>Waiting To Read...<br/>ALSA: Sample rate gotten 44100<br/>ALSA: Use ALSA Mixer rather than soft manupulating volume<br/>/usr/bin/shairport: simple.c: 282: snd_mixer_selem_get_playback_volume_range: Assertion `elem&#039; failed.<br/>Read -1 of data so far</p><p>Error reading data from socket, got: -1 bytesError reading from socket, closing client<br/>Waiting for clients to connect</p><p>Any ideas?</p></blockquote></div><br/><p>I have the same problem with the trunk version, but I don&#039;t know how to fix it...</p><p>root@OpenWrt:/usr/bin# shairport -b 256 -vv<br/>LogLevel: 7<br/>AirName: ShairPort<br/>HWID: aK_;Kf<br/>HWID_Hex(12): 00614B5F3B4B<br/>Avahi/DNS-SD started on PID: 2044<br/>Starting connection server: specified server port: 5002<br/>Failed to create ipv6 socket. Trying ipv4: Address family not supported by protocol<br/>Waiting for clients to connect<br/>Avahi/DNS-SD Name: 00614B5F3B4B@ShairPort<br/>Established under name &#039;00614B5F3B4B@ShairPort&#039;<br/>Error: Unable to accept connection to server socket: Bad address<br/>Waiting for clients to connect<br/>Error: Unable to accept connection to server socket: Bad address<br/>Waiting for clients to connect</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p204709">
				<div class="post-metadata">
					<div class="post-num">Post #136</div>
					<div class="post-author">lyf86822</div>
					<div class="post-datetime">
						15 Jun 2013, 18:56					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>lyf86822 wrote:</cite><blockquote><div class="quotebox"><cite>brontide wrote:</cite><blockquote><p>loading kmod-ipv6 resolved some of the errors, but still both modules fail.</p><br/><p>With the one from trunk I get.<br/>root@OpenWrt:~# /usr/sbin/shairport -a TESTING3 -b 256 -v3<br/>LogLevel: 7<br/>AirName: TESTING3<br/>HWID: ZjN6PF<br/>HWID_Hex(12): 005A6A4E3650<br/>Avahi/DNS-SD started on PID: 1668<br/>Starting connection server: specified server port: 5002<br/>Waiting for clients to connect<br/>Avahi/DNS-SD Name: 005A6A4E3650@TESTING3<br/>Established under name &#039;005A6A4E3650@TESTING3&#039;<br/>Error: Unable to accept connection to server socket: Bad address<br/>Waiting for clients to connect<br/>Error: Unable to accept connection to server socket: Bad address<br/>Waiting for clients to connect</p><p>With Mikejuni I get.<br/>...</p><p>----Send Response Header----<br/>Waiting To Read...<br/>ALSA: Sample rate gotten 44100<br/>ALSA: Use ALSA Mixer rather than soft manupulating volume<br/>/usr/bin/shairport: simple.c: 282: snd_mixer_selem_get_playback_volume_range: Assertion `elem&#039; failed.<br/>Read -1 of data so far</p><p>Error reading data from socket, got: -1 bytesError reading from socket, closing client<br/>Waiting for clients to connect</p><p>Any ideas?</p></blockquote></div><br/><p>I have the same problem with the trunk version, but I don&#039;t know how to fix it...</p><p>root@OpenWrt:/usr/bin# shairport -b 256 -vv<br/>LogLevel: 7<br/>AirName: ShairPort<br/>HWID: aK_;Kf<br/>HWID_Hex(12): 00614B5F3B4B<br/>Avahi/DNS-SD started on PID: 2044<br/>Starting connection server: specified server port: 5002<br/>Failed to create ipv6 socket. Trying ipv4: Address family not supported by protocol<br/>Waiting for clients to connect<br/>Avahi/DNS-SD Name: 00614B5F3B4B@ShairPort<br/>Established under name &#039;00614B5F3B4B@ShairPort&#039;<br/>Error: Unable to accept connection to server socket: Bad address<br/>Waiting for clients to connect<br/>Error: Unable to accept connection to server socket: Bad address<br/>Waiting for clients to connect</p></blockquote></div><br/><p>I think the latest commit has fixed this problem. Here is the link. <a href="https://github.com/abrasive/shairport/commit/b61faf1edc7823738e508519e6636fd4506774f3">https://github.com/abrasive/shairport/commit/b61faf1edc7823738e508519e6636fd4506774f3</a><br/>Can someone update the trunk version? Thanks a lot!</p>											<p class="post-edited">(Last edited by <strong>lyf86822</strong> on 16 Jun 2013, 08:03)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p205705">
				<div class="post-metadata">
					<div class="post-num">Post #137</div>
					<div class="post-author">FullOpen</div>
					<div class="post-datetime">
						26 Jun 2013, 06:31					</div>
				</div>
				<div class="post-content content">
					<p>hi,xurxo,did you build shairport successfully?I met the same problem as you,want your reply,TKS</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p206676">
				<div class="post-metadata">
					<div class="post-num">Post #138</div>
					<div class="post-author">FullOpen</div>
					<div class="post-datetime">
						8 Jul 2013, 06:32					</div>
				</div>
				<div class="post-content content">
					<p>Hi,all.<br/>When I run&nbsp; /etc/init.d/dbus start, it outputs &quot;Unknown group &quot;netdev&quot; in message bus configuration file&quot;.Anyone met this problem?I google this information,I am told this will not be harmful. Then I run the following: avahi-daemon -D,shairport -a &#039;Living Room&#039; -b 282 -d,all run perfectly.I can find itunes appear &quot;Living Room&quot; in Airplay,but when press &quot;Living Room&quot; to play music,error is produced &quot;15000&quot;.I run ps,all is OK:<br/> 2944 root&nbsp; &nbsp; &nbsp; 1704 S&nbsp; &nbsp; /usr/sbin/dbus-daemon --system<br/> 2949 nobody&nbsp; &nbsp; 2180 S&nbsp; &nbsp; avahi-daemon: running [OpenWrt.local]<br/> 2951 root&nbsp; &nbsp; &nbsp; 2568 S&nbsp; &nbsp; shairport -a Living Room -b 282 -d<br/> 2952 root&nbsp; &nbsp; &nbsp; 1628 S&nbsp; &nbsp; avahi-publish-service 00662F55622F@Living Room _raop</p><p>Anyone knows how to solve this problem?</p><p>Thanks</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p206680">
				<div class="post-metadata">
					<div class="post-num">Post #139</div>
					<div class="post-author">FullOpen</div>
					<div class="post-datetime">
						8 Jul 2013, 06:51					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>grayman4hire wrote:</cite><blockquote><div class="quotebox"><cite>FullOpen wrote:</cite><blockquote><p>Hi,all.<br/>When I run&nbsp; /etc/init.d/dbus start, it outputs &quot;Unknown group &quot;netdev&quot; in message bus configuration file&quot;.Anyone met this problem?I google this information,I am told this will not be harmful. Then I run the following: avahi-daemon -D,shairport -a &#039;Living Room&#039; -b 282 -d,all run perfectly.I can find itunes appear &quot;Living Room&quot; in Airplay,but when press &quot;Living Room&quot; to play music,error is produced &quot;15000&quot;.I run ps,all is OK:<br/> 2944 root&nbsp; &nbsp; &nbsp; 1704 S&nbsp; &nbsp; /usr/sbin/dbus-daemon --system<br/> 2949 nobody&nbsp; &nbsp; 2180 S&nbsp; &nbsp; avahi-daemon: running [OpenWrt.local]<br/> 2951 root&nbsp; &nbsp; &nbsp; 2568 S&nbsp; &nbsp; shairport -a Living Room -b 282 -d<br/> 2952 root&nbsp; &nbsp; &nbsp; 1628 S&nbsp; &nbsp; avahi-publish-service 00662F55622F@Living Room _raop</p><p>Anyone knows how to solve this problem?</p><p>Thanks</p></blockquote></div><p>Who&#039;s build are you using? If you use Mikejuni&#039;s package/Makefile it will autostart shairport properly.</p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p206682">
				<div class="post-metadata">
					<div class="post-num">Post #140</div>
					<div class="post-author">FullOpen</div>
					<div class="post-datetime">
						8 Jul 2013, 06:53					</div>
				</div>
				<div class="post-content content">
					<p>because of wr703n&#039;s small flash:4M, I opkg install shairport from openwrt,I think it should be Mikejuni&#039;s,any suggestion to solve it? thanks for your quick reply</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p206685">
				<div class="post-metadata">
					<div class="post-num">Post #141</div>
					<div class="post-author">FullOpen</div>
					<div class="post-datetime">
						8 Jul 2013, 07:40					</div>
				</div>
				<div class="post-content content">
					<p>I opkg madplay,and play music,it is perfect.I think the module needed will be no problem.<br/>Is it dbus problem?When google dbus,it need dhcdbg module to control dbus dhcp host<br/>,is that really true?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p214742">
				<div class="post-metadata">
					<div class="post-num">Post #142</div>
					<div class="post-author">Scrts</div>
					<div class="post-datetime">
						14 Oct 2013, 12:08					</div>
				</div>
				<div class="post-content content">
					<p>Maybe someone tried to run mikejuni version of shairport on current developer version of OpenWRT (Barrier Breaker)?<br/>I also get this &quot;Error: Unable to accept connection to server socket: Bad address&quot; message. Maybe someone knows what is wrong?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p218713">
				<div class="post-metadata">
					<div class="post-num">Post #143</div>
					<div class="post-author">BURR</div>
					<div class="post-datetime">
						28 Nov 2013, 00:26					</div>
				</div>
				<div class="post-content content">
					<p><strong>TP-LINK MR3020 sta mode (wireless) interference.</strong></p><p>Hi, everyone</p><p>OpenWRT Version: Attitude Adjustment , r38863<br/>Shairport Fork: <a href="https://github.com/sm3rt/OpenWRT-ShairPort">https://github.com/sm3rt/OpenWRT-ShairPort</a></p><p>I have compiled Shairport with the latest Attitude Adjustment and all is working well apart from one small problem that has me pulling my hair out for a week.</p><p>When I have my MR3020 connected directly to another access point in my network and have shairport streaming through its ethernet port I have (near) perfect audio.</p><p>When I switch to STA mode and connect my MR3020 as a client over wireless I start to have small POP´s, clicks and background noise / interference.</p><p>After a week of digging around I have come to the conclusion that it is radio wave interference caused by the internal aerial, or lack of one. Is any one able to confirm simular results? </p><p>I am using ALSA to direct Shairports output directly to the USB DAC:</p><p>asound.conf<br/></p><div class="codebox"><pre><code>pcm.!default {
  type plug
  slave.pcm &quot;hw:0,0&quot;
}</code></pre></div><br/><p>Shairport is up and running correctly with config:<br/></p><div class="codebox"><pre><code>config airplay
    option bname &#039;Numbnuts&#039;
    option initbuf 300
    option daemonize true</code></pre></div><br/><p>USB DAC status is consistent when connected through wireless client or through ethernet. I was originally hoping that it was some sort of resampling going on when connected through wireless.</p><div class="codebox"><pre><code>#cat /proc/asound/card0/stream0

C-Media Electronics Inc. USB PnP Sound Device at usb-ehci-platform-1, full spee : USB Audio

Playback:
  Status: Running
    Interface = 1
    Altset = 1
    URBs = 2 [ 1 1 ]
    Packet Size = 200
    Momentary freq = 44100 Hz (0x2c.199a)
  Interface 1
    Altset 1
    Format: S16_LE
    Channels: 2
    Endpoint: 1 OUT (ADAPTIVE)
    Rates: 48000, 44100

Capture:
  Status: Stop
  Interface 2
    Altset 1
    Format: S16_LE
    Channels: 1
    Endpoint: 2 IN (ADAPTIVE)
    Rates: 48000, 44100</code></pre></div><div class="codebox"><pre><code>#cat /proc/asound/card0/pcm0p/sub0/status

state: RUNNING
owner_pid   : 949
trigger_time: 6835.421757873
tstamp      : 10366.601723231
delay       : 65536
avail       : 44
avail_max   : 55372
-----
hw_ptr      : 155723604
appl_ptr    : 155789096</code></pre></div><p>Shairport Running with wireless connection<br/></p><div class="codebox"><pre><code>#shairport ... -vv

Failed to bind to address ::
Bound to address 0.0.0.0
avahi: avahi_register
avahi: register_service
Listening for connections.
culling threads.
new RTSP connection
received request: ANNOUNCE rtsp://192.168.10.102/3468496320 RTSP/1.0
    CSeq: 1
    Content-Type: application/sdp
    Content-Length: 574
    User-Agent: iTunes/11.1.3 (Windows; Microsoft Windows 7 x64 Home Premium Edition (Build 7600)) AppleWebKit/536.30.1
    Client-Instance: 76E89ACF4B76D5FF
    DACP-ID: 76E89ACF4B76D5FF
    Active-Remote: 1626069284
sending response: RTSP/1.0 200 OK
    CSeq: 1
    Audio-Jack-Status: connected; type=analog
received request: SETUP rtsp://192.168.10.102/3468496320 RTSP/1.0
    CSeq: 2
    Transport: RTP/AVP/UDP;unicast;interleaved=0-1;mode=record;control_port=6001;timing_port=6002
    User-Agent: iTunes/11.1.3 (Windows; Microsoft Windows 7 x64 Home Premium Edition (Build 7600)) AppleWebKit/536.30.1
    Client-Instance: 76E89ACF4B76D5FF
    DACP-ID: 76E89ACF4B76D5FF
    Active-Remote: 1626069284
rtp_setup: cport=6001 tport=6002
rtp listening on port 43915
sending response: RTSP/1.0 200 OK
    CSeq: 2
    Audio-Jack-Status: connected; type=analog
    Transport: RTP/AVP/UDP;unicast;interleaved=0-1;mode=record;control_port=6001;timing_port=6002;server_port=43915
    Session: 1
received request: RECORD rtsp://192.168.10.102/3468496320 RTSP/1.0
    CSeq: 3
    Session: 1
    Range: npt=0-
    RTP-Info: seq=46817;rtptime=748372815
    User-Agent: iTunes/11.1.3 (Windows; Microsoft Windows 7 x64 Home Premium Edition (Build 7600)) AppleWebKit/536.30.1
    Client-Instance: 76E89ACF4B76D5FF
    DACP-ID: 76E89ACF4B76D5FF
    Active-Remote: 1626069284
sending response: RTSP/1.0 200 OK
    CSeq: 3
    Audio-Jack-Status: connected; type=analog
received request: SET_PARAMETER rtsp://192.168.10.102/3468496320 RTSP/1.0
    CSeq: 4
    Session: 1
    Content-Type: text/parameters
    Content-Length: 20
    User-Agent: iTunes/11.1.3 (Windows; Microsoft Windows 7 x64 Home Premium Edition (Build 7600)) AppleWebKit/536.30.1
    Client-Instance: 76E89ACF4B76D5FF
    DACP-ID: 76E89ACF4B76D5FF
    Active-Remote: 1626069284
volume: -13.500604
sending response: RTSP/1.0 200 OK
    CSeq: 4
    Audio-Jack-Status: connected; type=analog
received request: SET_PARAMETER rtsp://192.168.10.102/3468496320 RTSP/1.0
    CSeq: 5
    Session: 1
    Content-Type: text/parameters
    Content-Length: 20
    User-Agent: iTunes/11.1.3 (Windows; Microsoft Windows 7 x64 Home Premium Edition (Build 7600)) AppleWebKit/536.30.1
    Client-Instance: 76E89ACF4B76D5FF
    DACP-ID: 76E89ACF4B76D5FF
    Active-Remote: 1626069284
volume: -13.500604
sending response: RTSP/1.0 200 OK
    CSeq: 5
    Audio-Jack-Status: connected; type=analog
syncing to first seqno B6E1
buffering over. starting play
WARNING: requesting resend on 2 packets (B86F:B870)
established desired fill of 298.965000 frames, so output chain buffered about 1.035000 frames
received request: OPTIONS * RTSP/1.0
    CSeq: 6
    User-Agent: iTunes/11.1.3 (Windows; Microsoft Windows 7 x64 Home Premium Edition (Build 7600)) AppleWebKit/536.30.1
    Client-Instance: 76E89ACF4B76D5FF
    DACP-ID: 76E89ACF4B76D5FF
    Active-Remote: 1626069284
sending response: RTSP/1.0 200 OK
    CSeq: 6
    Audio-Jack-Status: connected; type=analog
    Public: ANNOUNCE, SETUP, RECORD, PAUSE, FLUSH, TEARDOWN, OPTIONS, GET_PARAMETER, SET_PARAMETER
+++++++++
+++++++++
.........</code></pre></div><br/><p>Shairport Running with wired connection<br/></p><div class="codebox"><pre><code>#shairport ... -vv

Failed to bind to address ::
Bound to address 0.0.0.0
avahi: avahi_register
avahi: register_service
Listening for connections.
culling threads.
new RTSP connection
received request: OPTIONS * RTSP/1.0
    CSeq: 1
    User-Agent: iTunes/11.1.3 (Windows; Microsoft Windows 7 x64 Home Premium Edition (Build 7600)) AppleWebKit/536.30.1
    Client-Instance: 76E89ACF4B76D5FF
    DACP-ID: 76E89ACF4B76D5FF
    Active-Remote: 3022224022
    Apple-Challenge: 2SIjBWArEnXtMGSL8S9yHQ
sending response: RTSP/1.0 200 OK
    Apple-Response: AK86+xIYj4Pmn5KOnZ2YokfMlhjQrSr9A0qIGPHIgIQpXaUxru6Unm1eGkH/oP3eF66ywN3JGtcRpCRYLEIdlPDanwdSczZUhlTLyNNUFkkbFLJLs/mel8ERYd6UaurkrY70ci1pVL1ZvMXDoAjpP59VzncybKPmlZPtScI0m3djNT9kS6v+jzj87woHfPCnB/iXFhDauMZY7gv84LWXTVuu1bpV8ru41mduJFxmv71TZMxtlaULtqdMEXr+RIuStZLaeP5ZUzGLMYV61NKEmVGG4BefbPX2TGb+mmD1+XRt2ZSyUMoHhZzpzqtzS5ujZdehkSInGrmcx4lyI4Ye3g
    CSeq: 1
    Audio-Jack-Status: connected; type=analog
    Public: ANNOUNCE, SETUP, RECORD, PAUSE, FLUSH, TEARDOWN, OPTIONS, GET_PARAMETER, SET_PARAMETER
RTSP connection closed
closing RTSP connection
terminating RTSP thread
culling threads.
one joined
new RTSP connection
received request: ANNOUNCE rtsp://192.168.10.102/3468498685 RTSP/1.0
    CSeq: 1
    Content-Type: application/sdp
    Content-Length: 573
    User-Agent: iTunes/11.1.3 (Windows; Microsoft Windows 7 x64 Home Premium Edition (Build 7600)) AppleWebKit/536.30.1
    Client-Instance: 76E89ACF4B76D5FF
    DACP-ID: 76E89ACF4B76D5FF
    Active-Remote: 3022224022
sending response: RTSP/1.0 200 OK
    CSeq: 1
    Audio-Jack-Status: connected; type=analog
received request: SETUP rtsp://192.168.10.102/3468498685 RTSP/1.0
    CSeq: 2
    Transport: RTP/AVP/UDP;unicast;interleaved=0-1;mode=record;control_port=6001;timing_port=6002
    User-Agent: iTunes/11.1.3 (Windows; Microsoft Windows 7 x64 Home Premium Edition (Build 7600)) AppleWebKit/536.30.1
    Client-Instance: 76E89ACF4B76D5FF
    DACP-ID: 76E89ACF4B76D5FF
    Active-Remote: 3022224022
rtp_setup: cport=6001 tport=6002
rtp listening on port 53127
sending response: RTSP/1.0 200 OK
    CSeq: 2
    Audio-Jack-Status: connected; type=analog
    Transport: RTP/AVP/UDP;unicast;interleaved=0-1;mode=record;control_port=6001;timing_port=6002;server_port=53127
    Session: 1
received request: RECORD rtsp://192.168.10.102/3468498685 RTSP/1.0
    CSeq: 3
    Session: 1
    Range: npt=0-
    RTP-Info: seq=27452;rtptime=3269296137
    User-Agent: iTunes/11.1.3 (Windows; Microsoft Windows 7 x64 Home Premium Edition (Build 7600)) AppleWebKit/536.30.1
    Client-Instance: 76E89ACF4B76D5FF
    DACP-ID: 76E89ACF4B76D5FF
    Active-Remote: 3022224022
sending response: RTSP/1.0 200 OK
    CSeq: 3
    Audio-Jack-Status: connected; type=analog
received request: SET_PARAMETER rtsp://192.168.10.102/3468498685 RTSP/1.0
    CSeq: 4
    Session: 1
    Content-Type: text/parameters
    Content-Length: 20
    User-Agent: iTunes/11.1.3 (Windows; Microsoft Windows 7 x64 Home Premium Edition (Build 7600)) AppleWebKit/536.30.1
    Client-Instance: 76E89ACF4B76D5FF
    DACP-ID: 76E89ACF4B76D5FF
    Active-Remote: 3022224022
volume: -13.500604
sending response: RTSP/1.0 200 OK
    CSeq: 4
    Audio-Jack-Status: connected; type=analog
received request: SET_PARAMETER rtsp://192.168.10.102/3468498685 RTSP/1.0
    CSeq: 5
    Session: 1
    Content-Type: text/parameters
    Content-Length: 20
    User-Agent: iTunes/11.1.3 (Windows; Microsoft Windows 7 x64 Home Premium Edition (Build 7600)) AppleWebKit/536.30.1
    Client-Instance: 76E89ACF4B76D5FF
    DACP-ID: 76E89ACF4B76D5FF
    Active-Remote: 3022224022
volume: -13.500604
sending response: RTSP/1.0 200 OK
    CSeq: 5
    Audio-Jack-Status: connected; type=analog
syncing to first seqno 6B3C
buffering over. starting play
established desired fill of 297.843000 frames, so output chain buffered about 2.157000 frames
received request: OPTIONS * RTSP/1.0
    CSeq: 6
    User-Agent: iTunes/11.1.3 (Windows; Microsoft Windows 7 x64 Home Premium Edition (Build 7600)) AppleWebKit/536.30.1
    Client-Instance: 76E89ACF4B76D5FF
    DACP-ID: 76E89ACF4B76D5FF
    Active-Remote: 3022224022
sending response: RTSP/1.0 200 OK
    CSeq: 6
    Audio-Jack-Status: connected; type=analog
    Public: ANNOUNCE, SETUP, RECORD, PAUSE, FLUSH, TEARDOWN, OPTIONS, GET_PARAMETER, SET_PARAMETER
+++++++++
+++++++++
+++++++++
.........</code></pre></div><br/><p>I am still hoping I am able to still fix this through configurations. If anyone can shed any light on this would be much appreciated</p><p>Thanks in advance</p><p>Jack</p>											<p class="post-edited">(Last edited by <strong>BURR</strong> on 28 Nov 2013, 17:59)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p219473">
				<div class="post-metadata">
					<div class="post-num">Post #144</div>
					<div class="post-author">rickg</div>
					<div class="post-datetime">
						9 Dec 2013, 02:32					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m having the exact same issue as BURR.&nbsp; popping and clicking can be heard on playback.&nbsp; Downloaded everything yesterday and compiled Attitude Adjustment.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p219559">
				<div class="post-metadata">
					<div class="post-num">Post #145</div>
					<div class="post-author">rickg</div>
					<div class="post-datetime">
						10 Dec 2013, 00:31					</div>
				</div>
				<div class="post-content content">
					<p>Figured out my problem.</p><p>If I plug a small USB hub in between my WR703 and the soundcard or DAC it works fine.&nbsp; Must be some compatibility issue with the WR703 and DAC, but it&#039;s working now.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p219602">
				<div class="post-metadata">
					<div class="post-num">Post #146</div>
					<div class="post-author">BURR</div>
					<div class="post-datetime">
						10 Dec 2013, 18:23					</div>
				</div>
				<div class="post-content content">
					<p>Hi Rickg</p><p>You need to use a USB 2.0 sound card, this is not the cause of my problem. (The mr3020 is not USB 1 compatible) </p><p>I have updated my Shiarport again to fix the logging of &#039;resend packet&#039; requests as on the shairport github. It has really sorted a lot of the crackling out but every now and then I get a really big pop or crack. I have complied shairport on a few other routers and all seem to work perfectly.</p><p>I am going to try and connect a 120uF capacitor on the Vbus of the USB to see of it is voltage spiking that is causing the issues. It could be the source of the problem because it makes similar popping/crackling when I hot plug the DAC.</p><p>If anyone else can share their experience would be greatly appreciated</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p220607">
				<div class="post-metadata">
					<div class="post-num">Post #147</div>
					<div class="post-author">Davidwei</div>
					<div class="post-datetime">
						22 Dec 2013, 11:09					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>BURR wrote:</cite><blockquote><p>Hi Rickg</p><p>You need to use a USB 2.0 sound card, this is not the cause of my problem. (The mr3020 is not USB 1 compatible) </p><p>I have updated my Shiarport again to fix the logging of &#039;resend packet&#039; requests as on the shairport github. It has really sorted a lot of the crackling out but every now and then I get a really big pop or crack. I have complied shairport on a few other routers and all seem to work perfectly.</p><p>I am going to try and connect a 120uF capacitor on the Vbus of the USB to see of it is voltage spiking that is causing the issues. It could be the source of the problem because it makes similar popping/crackling when I hot plug the DAC.</p><p>If anyone else can share their experience would be greatly appreciated</p></blockquote></div><p>I use github.com/sm3rt/OpenWRT-ShairPort.git to buid shariplay in BB. it is done.<br/>but when i run etc/init.d/airplay, it show like this:<br/></p><div class="quotebox"><blockquote><p>root@Openwrt:/etc/init.d# /etc/init.d/airplay start<br/>WARNING: couldn&#039;t create avahi client: Daemon not running!<br/>Listening for connections.<br/>6989<br/>root@Openwrt:/etc/init.d# Failed to create client object: Daemon not running<br/>FATAL: MDNS child process died unexpectedly!<br/>Shutting down...</p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p220626">
				<div class="post-metadata">
					<div class="post-num">Post #148</div>
					<div class="post-author">mrwavelet</div>
					<div class="post-datetime">
						22 Dec 2013, 17:03					</div>
				</div>
				<div class="post-content content">
					<p>Hi all,<br/>i have an old Problem running shairport (Version from 2012-10-20)<br/>It runs on a Arduino Yun.</p><p>LogLevel: 7<br/>AirName: Yun6<br/>HWID: Oe,M&gt;<br/>HWID_Hex(12): 004F652C4D3E<br/>Avahi/DNS-SD started on PID: 24140<br/>Starting connection server: specified server port: 5002<br/>Waiting for clients to connect<br/>Avahi/DNS-SD Name: 004F652C4D3E@Yun6<br/>Established under name &#039;004F652C4D3E@Yun6&#039;<br/>Error: Unable to accept connection to server socket: Bad address<br/>Waiting for clients to connect</p><p>If i am right, the Problem belongs to an IPv6 issue.<br/>The issue is may solved now by fixing the IPv6 problems.<br/>BUT i am not able to compile the new Version because the arduino yun ist to small for an enviroment like gcc.<br/>If somebody has solved the issue pleas let me know and may someone is able to bring it into the linino downloads?<br/>Or is there a way of crosscompiling (openwrt sdk)?</p><p>regards, thomas</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p225009">
				<div class="post-metadata">
					<div class="post-num">Post #149</div>
					<div class="post-author">dddesign</div>
					<div class="post-datetime">
						10 Feb 2014, 17:03					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>stevo wrote:</cite><blockquote><p>Got it to work by adding a policy for avahi in the dbus configuration.</p></blockquote></div><p>what did you add exactly? I have a similar problem, see <a href="https://forum.openwrt.org/viewtopic.php?pid=224863#p224863">https://forum.openwrt.org/viewtopic.php?pid=224863#p224863</a><br/>edit: found the solution, see other topic</p>											<p class="post-edited">(Last edited by <strong>dddesign</strong> on 11 Feb 2014, 22:33)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p226217">
				<div class="post-metadata">
					<div class="post-num">Post #150</div>
					<div class="post-author">rickg</div>
					<div class="post-datetime">
						25 Feb 2014, 02:47					</div>
				</div>
				<div class="post-content content">
					<p>I think I finally fixed my popping issue on the WR703.&nbsp; Today I found there is a patch for a USB 1.1 reset.&nbsp; I was getting a huge number of resend errors along with popping.&nbsp; After installing this version it&#039;s as solid as a rock.&nbsp; The version of 703 I have, has an upgraded flash as well as memory from SLboat.&nbsp; &nbsp;I assume this patch will work on a standard WR703 with attitude adjustment, but have not tired it.</p><p>requesting resend on 1 packets (port 6001)</p><p><a href="https://github.com/SLboat/Openwrt_12.09_r36088-USB11_RESET_PATCH">https://github.com/SLboat/Openwrt_12.09_r36088-USB11_RESET_PATCH</a></p><p>Hope it helps someone who is having this issue.</p>											<p class="post-edited">(Last edited by <strong>rickg</strong> on 25 Feb 2014, 17:28)</p>
									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 6 of 7</div><nav><ul><li><a href="viewtopic.php%3Fid=29491&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=29491&amp;p=4.html">4</a></li><li><a href="viewtopic.php%3Fid=29491&amp;p=5.html">5</a></li><li class="pagination-current"><span>6</span></li><li><a href="viewtopic.php%3Fid=29491&amp;p=7.html">7</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>