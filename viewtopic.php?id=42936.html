<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Connecting 3 routers</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 19 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p195116">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">connexion2000</div>
					<div class="post-datetime">
						16 Mar 2013, 22:54					</div>
				</div>
				<div class="post-content content">
					<p>Hi,<br />I would like to connect 3 routers.<br />R1- master router with 5GHz and 2,4 GHz<br />R2- router with 5GHz and 2,4 GHz<br />R3- router with 2,4GHz</p><p>Currently R2 is connected to R1 in client bridge mode using 5GHz.<br />R3 is connected to R1 in client bridge mode using 2,4 GHz.</p><p>But I would like to to connect R3 to R2. How can I do that?<br />Currently on R2 I configured 5GHz wifi in client bridge mode to R1 and 2,4GHz works as AP. R3 is connected to this AP. But my problem is that, R3 can access internet, but it can&#039;t access devices connected to R2&#039;s LAN. Below is my R2&#039;s wireless configuration. Please help.</p><div class="codebox"><pre><code>root@r2:~# cat /etc/config/wireless

config wifi-device &#039;radio0&#039;
        option type &#039;mac80211&#039;
        option channel &#039;11&#039;
        option macaddr &#039;64:x&#039;
        option hwmode &#039;11ng&#039;
        option htmode &#039;HT20&#039;
        list ht_capab &#039;LDPC&#039;
        list ht_capab &#039;SHORT-GI-20&#039;
        list ht_capab &#039;SHORT-GI-40&#039;
        list ht_capab &#039;TX-STBC&#039;
        list ht_capab &#039;RX-STBC1&#039;
        list ht_capab &#039;DSSS_CCK-40&#039;
        option country &#039;PL&#039;
        option country_ie &#039;1&#039;
        option noscan &#039;1&#039;

config wifi-iface &#039;cfg1&#039;
        option device &#039;radio0&#039;
        option network &#039;lan&#039;
        option mode &#039;ap&#039;
        option ssid &#039;wifidrugie&#039;
        option encryption &#039;psk2&#039;
        option key &#039;xx&#039;

config wifi-device &#039;radio1&#039;
        option type &#039;mac80211&#039;
        option channel &#039;36&#039;
        option macaddr &#039;64xx&#039;
        option hwmode &#039;11na&#039;
        option htmode &#039;HT20&#039;
        list ht_capab &#039;LDPC&#039;
        list ht_capab &#039;SHORT-GI-20&#039;
        list ht_capab &#039;SHORT-GI-40&#039;
        list ht_capab &#039;TX-STBC&#039;
        list ht_capab &#039;RX-STBC1&#039;
        list ht_capab &#039;DSSS_CCK-40&#039;
        option country &#039;PL&#039;
        option country_ie &#039;1&#039;
        option noscan &#039;1&#039;

config wifi-iface &#039;cfg2&#039;
        option device &#039;radio1&#039;
        option network &#039;lan&#039;
        option mode &#039;sta&#039;
        option client_bridge &#039;1&#039;
        option ssid &#039;wifipierwsze&#039;
        option encryption &#039;psk2&#039;
        option key &#039;xxxxxxxxx&#039;</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p195212">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">jeremy.moschner</div>
					<div class="post-datetime">
						18 Mar 2013, 00:31					</div>
				</div>
				<div class="post-content content">
					<p>Could you please draw this up into a diagram with the addresses and subnets you have assigned?</p>											<p class="post-edited">(Last edited by <strong>jeremy.moschner</strong> on 18 Mar 2013, 06:29)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p195224">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">vhrm</div>
					<div class="post-datetime">
						18 Mar 2013, 03:56					</div>
				</div>
				<div class="post-content content">
					<p>Your message is conflicting.&nbsp; Is your R3&nbsp; connected to R1 or to R2</p><p>you say:<br />1) &quot;R3 is connected to R1 in client bridge mode using 2,4 GHz. &quot;&nbsp; but then <br />2) &quot;Currently on R2 ...&nbsp; 2,4GHz works as AP. R3 is connected to this AP.&quot;</p><p>)</p><p>And just to clarify, what &quot;client bridge mode&quot; are you talking about here ?&nbsp; the one w/ relayd ?</p><p>And finally, when you say &quot;can&#039;t access&quot; what do you mean exactly ?&nbsp; (TCP (telnet, web etc.) or media related broadcast / multicast dependent stuff ? )</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p195384">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">connexion2000</div>
					<div class="post-datetime">
						19 Mar 2013, 12:37					</div>
				</div>
				<div class="post-content content">
					<p>Hi,<br />thanks for replies.<br />R2 works in client bridge mode (for 5GHz radio) and AP mode (for 2,4GHz radio). When connected to 2,4 GHz wifi network I can&#039;t ping or access any device connected to R2.</p><p>R1 is 192.168.1.1, 255.255.255.0<br />R2 is 192.168.1.2, 255.255.255.0<br />R3 is 192.168.1.3, 255.255.255.0</p><p>R3 now is connected to R1 and everything is working good, but when I connect it to R2 I still can access internet, but I can&#039;t access devices connected to R2 (like in a whole 2,4 GHz Wifi network on R2).<br />On R2 it is client bridge without relayd.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p195419">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">vhrm</div>
					<div class="post-datetime">
						19 Mar 2013, 18:53					</div>
				</div>
				<div class="post-content content">
					<p>&quot;client bridge without relayd&quot; does not compute for me.&nbsp; &nbsp;What makes you think that such a thing exists or is possible (on a non-(broadcom radio router w/ the binary driver) )?&nbsp; &nbsp;</p><p>The wiki article says it&#039;s not: <br /><a href="http://wiki.openwrt.org/doc/howto/clientmode">http://wiki.openwrt.org/doc/howto/clientmode</a></p><p>You can also look at arpnat mode, but that&#039;ll take some patching (or gargoyle)&nbsp; <br /><a href="https://forum.openwrt.org/viewtopic.php?id=42614">https://forum.openwrt.org/viewtopic.php?id=42614</a></p><p>There might be some way to use WDS, but i don&#039;t know/see how that would be utilized in your dual band set-up.</p><p>edit: hmm... i wonder if anyone has ever used openvpn in tap mode for this.&nbsp; &nbsp;Set-up a set-up openvpn server on the main router and set up a&nbsp; tunnel over 5ghz from the child router to the main router.&nbsp; &nbsp; &nbsp; If you turn off encryption and have strong CPUs performance might even be acceptable (depending on what&#039;s going on on your lan).&nbsp; &nbsp; Heh.... if i get my hands on a couple of routers i might try it.&nbsp; (and i call dibs on the concept if no one else has done it :-) )</p>											<p class="post-edited">(Last edited by <strong>vhrm</strong> on 19 Mar 2013, 19:11)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p195459">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">hojuruku</div>
					<div class="post-datetime">
						20 Mar 2013, 06:17					</div>
				</div>
				<div class="post-content content">
					<p>It works fine with lazy (dynamic) client mode WDS.</p><p>You can even have r1 -&gt; r2 -&gt; r3 with the R3 router requring 3 hops to get to the internet at R1 if you want.<br />For the above example to work r2 needs to have a client (sta) and a ap (VAP) with the same encryption, settings et all.</p><p>I actually operate a hidden network for bridging and a public access point for internet connections.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p195465">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">jeremy.moschner</div>
					<div class="post-datetime">
						20 Mar 2013, 07:51					</div>
				</div>
				<div class="post-content content">
					<p>Ok - let&#039;s step back here.</p><p>I think you are making a mistake in considering your wifi connections as analogous to wired point-to-point links. You haven&#039;t given us any information about how the routers are arranged physically, so by using common wireless frequencies as the transport medium between routers you can potentially hit issues with both <a href="http://en.wikipedia.org/wiki/Exposed_node_problem">exposed</a> and <a href="http://en.wikipedia.org/wiki/Hidden_node_problem">hidden</a> nodes without RTS/CTS if the routers are close to each other.</p><p>Hojuruku is correct in that if you want clients to be able to roam between access points coverage, you need some form of WDS. However, this can be platform dependent and there can be inter-op issues.</p><p>Many routers are only capable of single wireless PHY and cannot simultaneously connect at 2.4 and 5 GHz. In addition, basic networking theory specifies that you cannot have two routing interfaces in the same L3 domain without adding something like WDS on top.</p><p>If you want to maintain the conceptual design of point to point links with no roaming capability then you need to:</p><div class="codebox"><pre><code>1. Verify that R1 and R2 have dual PHY (if not, everybody needs to use 2.4 Ghz);

2. Assuming that dual-PHY is present, configure the following subnets and wireless connections:

    R1 to R2 - 192.168.1.0/30 - 5Ghz (192.168.1.1 and 192.168.1.2 are usable IPs)
    R1 to R3 - 192.168.1.4/30 - 2.4 Ghz (192.168.1.5 and 192.168.1.6)
    R2 to R3 - 192.168.1.8/30 - 2.4 Ghz (192.168.1.9 and 192.168.1.10)
    
3. Choose to an appropriate routing protocol (eg. static, OPSF, RIP) to operate between the routers based on what your memory space allows for package installation (and what your desire to learn and manage this is - for example do you wish to prefer some ).

4. Perform NAT somewhere on one of the routers for your WAN access out to the internet.</code></pre></div><p>If you do need roaming capability, then we need to know more about your physical setup and the routers you are using. I should add that if you have any kind of budget to work with, then it would be easier to have three of the same Atheros-based APs, connect them over ethernet cabling into a switch and run a WDS between them.</p><p>Let&#039;s get your design needs straight before worrying about configuration though.</p>											<p class="post-edited">(Last edited by <strong>jeremy.moschner</strong> on 20 Mar 2013, 07:53)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>