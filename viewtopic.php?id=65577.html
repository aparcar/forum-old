<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Extroot uncommon problem</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 9 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p328601">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">hochi72</div>
					<div class="post-datetime">
						15 Jun 2016, 16:57					</div>
				</div>
				<div class="post-content content">
					<p>Hey Guys! </p><p>Im currently working on an tlmr3020 router with 4mb flash and an custom attitude adjustment 12.09 image.<br />Currently this image does not have enough space for pivot root so I need a solution because i need other packages ont that device also.<br />I know that it is possible to create an custom firmware with all the packages needed for extroot.</p><p>However, today i got an idea about installing the packages to /tmp and afterwards configuring extroot. Would this be possible? <br />Another possibility i thought of would be to configure extroot at first with an minimal image and afterwards flashing the custom openwrt image. </p><p>I know this problem isnt realy common but i hope some of you guys can help me!<br />Thanks alot.</p><p>EDIT:</p><p><em>I think people dont get my problem.. maybe i expressed myself bad. I want to use extroot while also be able to keep another firmware </em></p>											<p class="post-edited">(Last edited by <strong>hochi72</strong> on 16 Jun 2016, 10:19)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p328614">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">Max Hopper</div>
					<div class="post-datetime">
						15 Jun 2016, 18:16					</div>
				</div>
				<div class="post-content content">
					<p>You flatter yourself.</p><div class="quotebox"><cite>hochi72 wrote:</cite><blockquote><p>... installing the packages to /tmp and afterwards configuring extroot. Would this be possible?</p></blockquote></div><p>No.&nbsp; <em>/tmp</em> is RAM and not preserved across boot-up.</p><div class="quotebox"><cite>hochi72 wrote:</cite><blockquote><p>... configure extroot at first with an minimal image and afterwards flashing the custom openwrt image.</p></blockquote></div><p>Yes.</p><p>Does your &#039;custom openwrt image&#039; = installation of required packages?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p328630">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">hochi72</div>
					<div class="post-datetime">
						15 Jun 2016, 20:44					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Max Hopper wrote:</cite><blockquote><p>You flatter yourself.</p><div class="quotebox"><cite>hochi72 wrote:</cite><blockquote><p>... installing the packages to /tmp and afterwards configuring extroot. Would this be possible?</p></blockquote></div><p>No.&nbsp; <em>/tmp</em> is RAM and not preserved across boot-up.</p><div class="quotebox"><cite>hochi72 wrote:</cite><blockquote><p>... configure extroot at first with an minimal image and afterwards flashing the custom openwrt image.</p></blockquote></div><p>Yes.</p><p>Does your &#039;custom openwrt image&#039; = installation of required packages?</p></blockquote></div><p>If you mean that the minimal image has the same packages than the custom one than no. Because the minimal one just has <strong>&quot;blkid block-mount kmod-fs-ext4 kmod-usb2 kmod-usb-uhci kmod-usb-ohci kmod-usb-storage&quot;</strong>&nbsp; installed.</p><p>However, if you mean that it contains all required packages to run when flashed then yes.</p><br /><p>I think i should also explain that the custom one has also predefined configurations.. would this be a problem?</p>											<p class="post-edited">(Last edited by <strong>hochi72</strong> on 15 Jun 2016, 22:07)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p328656">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">remlei</div>
					<div class="post-datetime">
						16 Jun 2016, 00:43					</div>
				</div>
				<div class="post-content content">
					<p>I had a similar issue with MR 3420 v2, it only had 4MB flash and to make it worse, you cant literally fit required packages for extroot, I techinically removed all the packages, luci (and other dependencies) kmod-pppoe and even the wireless drivers, I ended up with a firmware that only had the very basic drivers enough to get it boot and network up and running, no luci, no pppoe no wireless. only the basic kernel and switch drivers and the packages required for extroot, with only 500kb left which is not even enough for wireless drivers installation. After that I setup my pivot-overlay setup and begin installing the things that I removed luci wireless drivers etc... After that im back to business with 14gig-ish free space for my extroot.</p><p>MR3020 on the other hand is less complicated, since you only need to removed kmod-pppoe and install the required packages for extroot and build that as a new firmware and flash it to the router.</p>											<p class="post-edited">(Last edited by <strong>remlei</strong> on 16 Jun 2016, 00:46)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p328687">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">hochi72</div>
					<div class="post-datetime">
						16 Jun 2016, 08:40					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>remlei wrote:</cite><blockquote><p>MR3020 on the other hand is less complicated, since you only need to removed kmod-pppoe and install the required packages for extroot and build that as a new firmware and flash it to the router.</p></blockquote></div><p>I think people don&#039;t get my problem :b</p><p>I want to use extroot while also be able to keep another firmware. I cant remove packages from the custom firmware because they are all set to rootfs, which is read only ofc.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p328697">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">Max Hopper</div>
					<div class="post-datetime">
						16 Jun 2016, 10:21					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>hochi72 wrote:</cite><blockquote><p>I think people don&#039;t get my problem :b</p></blockquote></div><p>Be so kind to read and &#039;get&#039; <a href="https://wiki.openwrt.org/doc/techref/filesystems?s=squashfs#explanations">this</a>, <a href="https://wiki.openwrt.org/doc/howto/extroot/extroot.theory">this</a> and <a href="https://wiki.openwrt.org/doc/howto/obtain.firmware.generate">this</a>.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p328725">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">remlei</div>
					<div class="post-datetime">
						16 Jun 2016, 14:03					</div>
				</div>
				<div class="post-content content">
					<p>I literally removed it using image builder. you cant remove a single thing when the packages is already included on the firmware.</p><p>also<br /></p><div class="quotebox"><blockquote><p>I want to use extroot while also be able to keep another firmware.</p></blockquote></div><p>that&#039;s what extroot pivot overlay do, you keep the original files on your firmware in addition of your overlay filesystem (where the additional packages installed, using a opkg command or through Software page in LuCI).<br />to get more information how this thing works read Max Hopper&#039;s post.</p>											<p class="post-edited">(Last edited by <strong>remlei</strong> on 16 Jun 2016, 14:05)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p328727">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">booBot</div>
					<div class="post-datetime">
						16 Jun 2016, 14:16					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>hochi72 wrote:</cite><blockquote><p>... router with 4mb flash...</p></blockquote></div><p>I was exactly in the same situation with my Asus WL-330N3G.</p><p>I&#039;d suggest to:<br /></p><ol class="decimal"><li><p>arrange your own BuildRoot</p></li><li><p>build your own custom image with all possible optimisations in place (<a href="http://s05.radikal.ru/i178/1603/49/e32640e19afe.png">like these</a>, removing ALL unneeded modules, etc)</p></li><li><p>include only the barest minimum necessary to enable the <strong>pivot overlay</strong> on your platform</p></li><li><p>all your relevant functional modules should go to the <em>overlay</em> partition</p></li></ol><p>Doing so I am able to run the Asterisk PBX on my WL-330N3G successfully - with LuCI, 3G USB modem support and more.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p328731">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">remlei</div>
					<div class="post-datetime">
						16 Jun 2016, 14:51					</div>
				</div>
				<div class="post-content content">
					<p>the only thing that prevents overlay working in most cases is that big package (kmod-fs-ext4) that sizes around 300kb. If only f2fs works with extroot, this will be a big treat for extroot users with 4mb flash that usually had a 200-300kb free space to work on. that f2fs package is under 10kb.</p>											<p class="post-edited">(Last edited by <strong>remlei</strong> on 16 Jun 2016, 14:52)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p328752">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">booBot</div>
					<div class="post-datetime">
						16 Jun 2016, 17:53					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>remlei wrote:</cite><blockquote><p>... If only f2fs works with extroot...</p></blockquote></div><p>Alas not, the F2FS is not supported in the OS - no matter you would patch the <strong>block</strong> utility - I did try this - and lost a lot of time in vain.<br />As of now - only the EXT4 file-system is suitable for ExtRooting, at least it is the smallest between those also working (UBIFS).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p328810">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">hochi72</div>
					<div class="post-datetime">
						17 Jun 2016, 09:14					</div>
				</div>
				<div class="post-content content">
					<p>Well thanks for your support guys. unfortunatly im not able to fix this problem even with the infos you provided me.</p>											<p class="post-edited">(Last edited by <strong>hochi72</strong> on 17 Jun 2016, 09:14)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p328816">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">Max Hopper</div>
					<div class="post-datetime">
						17 Jun 2016, 10:40					</div>
				</div>
				<div class="post-content content">
					<p>Care to share your failure(s) that others might avoid them?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p328839">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">hochi72</div>
					<div class="post-datetime">
						17 Jun 2016, 13:53					</div>
				</div>
				<div class="post-content content">
					<p>Well actually after some inspiration i think i got it working.</p><p>1) I installed extroot (pivot /) on my mr3020 with an mininimal image i generated.<br />2) I used binwalk on the other firmware to see at which offset squashfs starts.<br />3) use dd to extract the squashfs<br />4) extract it with unsquash<br />5) copy, paste all files to the usb stick<br />6) profit!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p328845">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">Max Hopper</div>
					<div class="post-datetime">
						17 Jun 2016, 15:45					</div>
				</div>
				<div class="post-content content">
					<div class="codebox"><pre><code>opkg update; opkg install &lt;your favourite packages&gt;</code></pre></div><p>is more intuitive (and SOP for <em>extroot</em> installations)</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>