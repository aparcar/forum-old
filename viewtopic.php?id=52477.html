<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> how to compile c program on openwrt</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 16 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p245347">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">nullox</div>
					<div class="post-datetime">
						29 Aug 2014, 22:18					</div>
				</div>
				<div class="post-content content">
					<p>Can anyone shed me some lights how to compile the following c program in github for openwrt? There is only one .c file. I want to compile it and install it on openwrt. However, i have no idea how to do it.</p><p>Do i need to create a makefile for this? If possible, please write a step by step guide. This is very appreciated! </p><p><a href="https://github.com/mheld/geolocation-via-wifi">https://github.com/mheld/geolocation-via-wifi</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p245352">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">zo0ok</div>
					<div class="post-datetime">
						29 Aug 2014, 22:52					</div>
				</div>
				<div class="post-content content">
					<p>I wrote this a while ago:<br />&nbsp; <a href="http://techfindings.one/archives/1487">http://techfindings.one/archives/1487</a><br />(Link to 100% non-profit site)</p>											<p class="post-edited">(Last edited by <strong>zo0ok</strong> on 27 Sep 2015, 17:26)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p245377">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">nullox</div>
					<div class="post-datetime">
						30 Aug 2014, 07:39					</div>
				</div>
				<div class="post-content content">
					<p>thanks zo0ok. I&#039;ve read your article but i still can&#039;t get it to work.</p><br /><p>I created a main.c program which has dependancy on libcurl so i copied the curl library over. I want to cross compile it for OpenWrt.However, when i compile it, i still get errors related to the curl library.</p><p><strong>main.c</strong><br />#include &lt;stdio.h&gt;<br />#include &lt;stdlib.h&gt;<br />#include &lt;string.h&gt;<br />#include &lt;curl/curl.h&gt;<br />#include &lt;regex.h&gt;</p><p><strong>gcc version</strong><br />$ gcc -v<br />Configured with: --prefix=/Applications/Xcode.app/Contents/Developer/usr --with-gxx-include-&nbsp; &nbsp;dir=/usr/include/c++/4.2.1<br />Apple LLVM version 5.1 (clang-503.0.40) (based on LLVM 3.4svn)<br />Target: x86_64-apple-darwin13.3.0<br />Thread model: posix</p><br /><p><strong>errors</strong><br />#include &quot;...&quot; search starts here:<br />#include &lt;...&gt; search starts here:<br />/usr/local/include<br />&nbsp; /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/../lib/clang/5.1/include<br />&nbsp; /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/include<br />&nbsp; /usr/include<br /> /System/Library/Frameworks (framework directory)<br /> /Library/Frameworks (framework directory)<br /> End of search list.<br /> &quot;/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/ld&quot; -demangle -dynamic -arch x86_64 -macosx_version_min 10.9.0 -o a.out&nbsp; &nbsp; &nbsp;/var/folders/3x/0142l1nd0qd2x9g905w2zx1h0000gn/T/main-db154a.o -lSystem&nbsp; &nbsp; &nbsp;/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/../lib/clang/5.1/lib/darwin/libclang_rt.osx.a<br />Undefined symbols for architecture x86_64:<br />&quot;_curl_easy_cleanup&quot;, referenced from:<br />&nbsp; _main in main-db154a.o<br /> &quot;_curl_easy_init&quot;, referenced from:<br />&nbsp; _main in main-db154a.o<br />&quot;_curl_easy_perform&quot;, referenced from:<br />&nbsp; _main in main-db154a.o<br /> &quot;_curl_easy_setopt&quot;, referenced from:<br />&nbsp; _main in main-db154a.o<br /> &quot;_curl_global_cleanup&quot;, referenced from:<br />&nbsp; _main in main-db154a.o<br />&nbsp; &quot;_curl_slist_append&quot;, referenced from:<br />&nbsp; _main in main-db154a.o<br />&nbsp; &nbsp;ld: symbol(s) not found for architecture x86_64<br /> clang: error: linker command failed with exit code 1 (use -v to see invocation)</p>											<p class="post-edited">(Last edited by <strong>nullox</strong> on 30 Aug 2014, 07:39)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p245382">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">zo0ok</div>
					<div class="post-datetime">
						30 Aug 2014, 09:17					</div>
				</div>
				<div class="post-content content">
					<p>When you run &quot;gcc -v&quot;, as you can see you are invoking Apple&#039;s compiler, that builds stuff for your Apple computer.</p><p>The openwrt compiler is called something like &quot;mipsel-openwrt-linux-uclibc-gcc&quot; (instead of gcc), and it should be in your path. Have a look inside the toolchain bin-folder.</p><p>I don&#039;t know about the libcurl dependency. You need to install a dev-version of libcurl that your toolchain can use. You&#039;ll need to use the -I (or -i) option to point the compiler to the include-directory (to successfully link) and then you&#039;ll need to use the -L (or -l) option to your libs directory and libcurl.a (perhaps with version numbers). Slight reservation here… -L/-l are used at least for dynamic linking, not 100% sure about static linking… and I think you will want to link statically agains libcurl.a (dynamic linking would be against libcurl.so).</p><p>I suggest you start with a simple c-program with no libcurl dependency, and then take it from there. Good Luck.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p245404">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">mazilo</div>
					<div class="post-datetime">
						30 Aug 2014, 15:48					</div>
				</div>
				<div class="post-content content">
					<p>This <a href="http://wiki.openwrt.org/doc/howto/obtain.firmware.sdk">using the SDK</a> wiki may be able to guide you through if you want to learn how to port this software using the OpenWRT SDK.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p245416">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">nullox</div>
					<div class="post-datetime">
						30 Aug 2014, 20:59					</div>
				</div>
				<div class="post-content content">
					<p>I used the toolchain to compile the program and got the following errors when cross compiling it on MAC. I did some searches on google but still didnt get any clue how to fix it. Any idea on this?</p><p>/Volumes/OpenWRT/barrier_breaker/staging_dir/toolchain-mips_34kc_gcc-4.8-linaro_uClibc-0.9.33.2/bin/mips-openwrt-linux-uclibc-gcc -I/usr/local/opt/curl/include main.c -L/usr/local/opt/curl/lib<br />In file included from /usr/local/opt/curl/include/curl/curl.h:35:0,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;from main.c:4:<br />/usr/local/opt/curl/include/curl/curlrules.h:142:3: error: size of array &#039;__curl_rule_01__&#039; is negative<br />&nbsp; &nbsp;__curl_rule_01__<br />&nbsp; &nbsp;^<br />/usr/local/opt/curl/include/curl/curlrules.h:152:3: error: size of array &#039;__curl_rule_02__&#039; is negative<br />&nbsp; &nbsp;__curl_rule_02__</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p245427">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">zo0ok</div>
					<div class="post-datetime">
						31 Aug 2014, 00:17					</div>
				</div>
				<div class="post-content content">
					<p>You have obviously installed curl, somehow, in /usr/local/opt/curl… that can be fine.</p><p>In that location, I would presume it is a version of curl built for the Mac (using Apples gcc, not the cross compiler mips-openwrt…gcc), and that you built it yourself. You can not build - especially not link - against a library (curl in this case), that is not also built with the cross compiler.</p><p>My question: did you build/install curl into that location using apple gcc or the cross compiler? Or perhaps you downloaded it already built somehow?</p><p>When you (cross-)compile libcurl/curl you probably run ./configure, and it has an option --prefix. I guess the most safe thing to do is to use --prefix=/Volumes/OpenWRT/barrier_breaker/staging_dir/toolchain-mips_34kc_gcc-4.8-linaro_uClibc-0.9.33.2/opt/curl , or something like that. It is not 100% OpenWRT &quot;correct&quot;, but I guess it is &quot;safe&quot;. Then make, then make install… And then you can point to that curl-directory with -I and -L. When done, perhaps you need to copy libcurl.so (or whatever it is named) to your router as well.</p><p>As someone suggested above, the right OpenWRT way to do this is probably to use the SDK, and install curl/libcurl into the SDK… but I do not know how to do.</p><p>I have never compiled libraries with the toolchain and linked against them… so all I write above is just my best effort/guess. Perhaps I am wrong and perhaps someone will tell <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>