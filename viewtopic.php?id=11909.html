<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Kamikaze 7.07 newbie questions</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 27 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p53257">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">moh</div>
					<div class="post-datetime">
						2 Aug 2007, 06:48					</div>
				</div>
				<div class="post-content content">
					<p>Background: I&#039;m running a very barebones Kamikaze 7.07 on Asus WL500gp. I&#039;m using 2.6 (openwrt-brcm47xx-2.6-squashfs.trx). I&#039;m new to Kamikaze, but very comfortable with Linux and command line/config files. I don&#039;t want wireless, so 2.6 is just fine.</p><p>Aside from the random seg faults (<a href="https://dev.openwrt.org/ticket/2035">https://dev.openwrt.org/ticket/2035</a>), things do seem to be working. I&#039;ve been testing the port forwarding of the router and sustained transfers and so far so good.</p><p>I&#039;d appreciate any help with the following questions:</p><p>1) I disabled crond (/etc/init.d/crond disable) and httpd. I don&#039;t want httpd. cron didn&#039;t seem to have any actual cron jobs to run, so it didn&#039;t seem like it was necessary. Any issues with that?</p><p>2) Where are the log files? The usual suspects are running (logger, syslogd, klogd), but there is nothing /var/log. If these are disabled somehow, is there anyway to enable them? I seem to have plenty of free ram (only 10M of 32M is in active use; I wouldn&#039;t mind using a couple of megs towards non-persistent logs).</p><p>3) I really like /etc/config/firewall. It tremendously simplifies iptables usage. There is one thing I can&#039;t figure out how to do: I&#039;d like to &quot;drop&quot; certain ports, but only if they&#039;re on the WAN side. For example, I don&#039;t want anyone to be able to see port 22 (ssh) from the WAN side, but should be allowed from the LAN side. Is there a simple syntax for this in config/firewall? If not, what is equivalent iptables command and where do I put that?</p><p>4) I&#039;m a bit confused about what files are permanent and which are not.&nbsp; Are all changes to the file system written back to flash storage? If not, which directories (other than /etc/config) are saved? Can I make changes in /etc/rc.d and expect those to survive a reboot?</p><p>5) /etc/modules.d enables both ppp and madwifi. I don&#039;t want either of those.&nbsp; Can I just remove those files and will it be permanent? are any of those modules necessary for a plain router on a broadband connection (no wireless)?</p><p>6) This may sound a bit crazy, but I gotta ask. Is there a way to disable all file system modifications once I&#039;m happy with my configuration? Can I put the router in read-only mode for security purposes? The only way to change something should be via physical access to the device.</p><p>Thanks<br />Moh<br />P.S. It might be time to change the Sticky at the top of the forum. Kamikaze seems far enough along now :-) Pretty impressive stuff.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p53272">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">candlerb</div>
					<div class="post-datetime">
						2 Aug 2007, 15:29					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>moh wrote:</cite><blockquote><p>Background: I&#039;m running a very barebones Kamikaze 7.07 on Asus WL500gp. I&#039;m using 2.6 (openwrt-brcm47xx-2.6-squashfs.trx). I&#039;m new to Kamikaze, but very comfortable with Linux and command line/config files. I don&#039;t want wireless, so 2.6 is just fine.</p><p>Aside from the random seg faults (<a href="https://dev.openwrt.org/ticket/2035">https://dev.openwrt.org/ticket/2035</a>), things do seem to be working. I&#039;ve been testing the port forwarding of the router and sustained transfers and so far so good.</p><p>I&#039;d appreciate any help with the following questions:</p><p>1) I disabled crond (/etc/init.d/crond disable) and httpd. I don&#039;t want httpd. cron didn&#039;t seem to have any actual cron jobs to run, so it didn&#039;t seem like it was necessary. Any issues with that?</p></blockquote></div><p>Sorry, where&#039;s the question? &quot;Is it safe to disable crond&quot;? As far as I know, yes it is.</p><div class="quotebox"><blockquote><p>2) Where are the log files? The usual suspects are running (logger, syslogd, klogd), but there is nothing /var/log. If these are disabled somehow, is there anyway to enable them? I seem to have plenty of free ram (only 10M of 32M is in active use; I wouldn&#039;t mind using a couple of megs towards non-persistent logs).</p></blockquote></div><p>Type &quot;logread&quot;</p><div class="quotebox"><blockquote><p>3) I really like /etc/config/firewall. It tremendously simplifies iptables usage. There is one thing I can&#039;t figure out how to do: I&#039;d like to &quot;drop&quot; certain ports, but only if they&#039;re on the WAN side. For example, I don&#039;t want anyone to be able to see port 22 (ssh) from the WAN side, but should be allowed from the LAN side. Is there a simple syntax for this in config/firewall? If not, what is equivalent iptables command and where do I put that?</p></blockquote></div><p>I think you&#039;ll find this is the default: everything is enabled from the LAN side, but blocked from the WAN side. Try it and see.</p><div class="quotebox"><blockquote><p>4) I&#039;m a bit confused about what files are permanent and which are not.&nbsp; Are all changes to the file system written back to flash storage? If not, which directories (other than /etc/config) are saved? Can I make changes in /etc/rc.d and expect those to survive a reboot?</p></blockquote></div><p>All files in the filesystem are permanent, except those mounted as ramdisk (i.e. /tmp)</p><p>In fact, the root filesystem is a union view of the immutable squashfs filesystem in the original image (which you can find under /rom) and a jffs2 filesystem containing your changes (which you can find under /jffs).</p><p>However, if you reflash your unit with a new squashfs image, all your jffs changes will be lost.</p><div class="quotebox"><blockquote><p>5) /etc/modules.d enables both ppp and madwifi. I don&#039;t want either of those.&nbsp; Can I just remove those files and will it be permanent? are any of those modules necessary for a plain router on a broadband connection (no wireless)?</p></blockquote></div><p>Clearly you don&#039;t need madwifi if not using wifi. You might need ppp for your broadband connection, if you are running as a PPPoE client.</p><p>&quot;Removing&quot; files won&#039;t actually save any space, as it just marks them in /jffs as being invisible. They still exist under /rom. If you want to save space in your image then you&#039;ll need to build your own squashfs filesystem from scratch, either using the ImageBuilder (if you have an x86_64 PC) or by rebuilding the whole of OpenWrt entirely from source, This is easier than it sounds: it&#039;s really just &quot;make menuconfig&quot; then &quot;make&quot;</p><p>I *believe* it&#039;s possible to run an entirely jffs system, i.e. jffs root with no squashfs, but have never tried this. This is a risky strategy as it&#039;s much easier to brick your router. It also makes less efficient use of flash space, as squashfs compresses lots of small files very well.</p><div class="quotebox"><blockquote><p>6) This may sound a bit crazy, but I gotta ask. Is there a way to disable all file system modifications once I&#039;m happy with my configuration? Can I put the router in read-only mode for security purposes? The only way to change something should be via physical access to the device.</p></blockquote></div><p>Well, you could modify the startup scripts to leave the root filesystem mounted read-only. Look in /sbin/mount_root. Maybe just changing &quot;remount,rw&quot; to &quot;remount&quot; will be sufficient (but if you brick your router doing this, you are on your own). But someone logging in as root could still remount the filesystem as rw.</p><p>Once you&#039;re happy that you can build squashfs filesystems, then I guess you could build an image without jffs2 support at all. It really would be unchangeable - all config files would have to be set up at the time you built the image. But I&#039;m not sure this gives you &quot;security&quot;. Consider using a strong root password instead, or using requiring RSA authentication for ssh access.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p53308">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">moh</div>
					<div class="post-datetime">
						3 Aug 2007, 04:39					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for the answers. They were quite helpful.</p><div class="quotebox"><cite>candlerb wrote:</cite><blockquote><div class="quotebox"><cite>moh wrote:</cite><blockquote><p>2) Where are the log files?</p></blockquote></div><p>Type &quot;logread&quot;</p></blockquote></div><p>Ah! I didn&#039;t realize even the system daemons were just busybox. Reading through the busybox man page was informative.</p><div class="quotebox"><blockquote><div class="quotebox"><blockquote><p>3) I really like /etc/config/firewall. It tremendously simplifies iptables usage. There is one thing I can&#039;t figure out how to do: I&#039;d like to &quot;drop&quot; certain ports, but only if they&#039;re on the WAN side. For example, I don&#039;t want anyone to be able to see port 22 (ssh) from the WAN side, but should be allowed from the LAN side. Is there a simple syntax for this in config/firewall? If not, what is equivalent iptables command and where do I put that?</p></blockquote></div><p>I think you&#039;ll find this is the default: everything is enabled from the LAN side, but blocked from the WAN side. Try it and see.</p></blockquote></div><p>You&#039;re right! An external port scan shows everything as closed. That&#039;s great.</p><div class="quotebox"><blockquote><p>&quot;Removing&quot; files won&#039;t actually save any space, as it just marks them in /jffs as being invisible.</p></blockquote></div><p>I seem to have plenty of space so that really wasn&#039;t the concern. I just want a lean, mean kernel with no extra baggage. Everything is working fine without ppp and madwifi.</p><p>One last question, the basic install (<a href="http://forum.openwrt.org/viewtopic.php?id=11451">http://forum.openwrt.org/viewtopic.php?id=11451</a>) says to add <br /></p><div class="codebox"><pre><code>        option gateway  192.168.1.254
        option dns      192.168.1.254</code></pre></div><p>what are those for? The gateway and dns options are not completely explained in the docs. There is nothing at that address (.254). So what&#039;s up with these entries?</p><p>Thanks<br />Moh</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p53329">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">candlerb</div>
					<div class="post-datetime">
						3 Aug 2007, 10:56					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>moh wrote:</cite><blockquote><p>One last question, the basic install (<a href="http://forum.openwrt.org/viewtopic.php?id=11451">http://forum.openwrt.org/viewtopic.php?id=11451</a>) says to add <br /></p><div class="codebox"><pre><code>        option gateway  192.168.1.254
        option dns      192.168.1.254</code></pre></div><p>what are those for? The gateway and dns options are not completely explained in the docs. There is nothing at that address (.254). So what&#039;s up with these entries?</p></blockquote></div><p>It just goes to show, don&#039;t believe everything you read <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>You are already picking up defaultroute and DNS settings via DHCP from the DHCP server on your WAN port. That&#039;s all you need. You definitely should <em>not</em> add these extra settings pointing to a router that you don&#039;t have.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p63913">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">pflantz</div>
					<div class="post-datetime">
						22 Feb 2008, 22:57					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>moh wrote:</cite><blockquote><div class="codebox"><pre><code>        option gateway  192.168.1.254
        option dns      192.168.1.254</code></pre></div><p>what are those for?</p></blockquote></div><p>I run an asus wl500gp with standard settings (kamikaze 7.09) -- well, except from those two lines. Without them I can only access the internet from the router, but not from a machine in the lan. I am quite surprised that those lines are needed for basic functionality but are not included in the default config and are not mentioned in any documentation except the post mentioned above.</p><p>So what do those entries do? What is the reason that I need to add them for a standard router config?</p><p>Details:<br /></p><div class="codebox"><pre><code>#### VLAN configuration 
config switch eth0
    option vlan0    &quot;1 2 3 4 5*&quot;
    option vlan1    &quot;0 5&quot;


#### Loopback configuration
config interface loopback
    option ifname    &quot;lo&quot;
    option proto    static
    option ipaddr    127.0.0.1
    option netmask    255.0.0.0


#### LAN configuration
config interface lan
    option type     bridge
    option ifname    &quot;eth0.0&quot;
    option proto    static
    option ipaddr    &#039;192.168.23.69&#039;
    option netmask    255.255.255.0
    option gateway    &#039;192.168.23.254&#039;
    option dns    &#039;192.168.23.254&#039;

#### WAN configuration
config interface    wan
    option ifname    &quot;eth0.1&quot;
    option proto    &#039;pppoe&#039;
    option username    &#039;username&#039;
    option password    &#039;password&#039;</code></pre></div><p>Best regards,<br />Jens</p>											<p class="post-edited">(Last edited by <strong>pflantz</strong> on 22 Feb 2008, 22:58)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>