<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> U-Boot mod for routers with AR9331/AR9344</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 3 Apr 2015 and 7 May 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 11 of 25</div><nav><ul><li><a href="viewtopic.php%3Fid=43237&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=43237&amp;p=9.html">9</a></li><li><a href="viewtopic.php%3Fid=43237&amp;p=10.html">10</a></li><li class="pagination-current"><span>11</span></li><li><a href="viewtopic.php%3Fid=43237&amp;p=12.html">12</a></li><li><a href="viewtopic.php%3Fid=43237&amp;p=13.html">13</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=43237&amp;p=25.html">25</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p227855">
				<div class="post-metadata">
					<div class="post-num">Post #251</div>
					<div class="post-author">Sharonbuss</div>
					<div class="post-datetime">
						18 Mar 2014, 10:58					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>pepe2k wrote:</cite><blockquote><div class="quotebox"><cite>Sharonbuss wrote:</cite><blockquote><p>I think the parameter for DDR1 memory has some different,&nbsp; <br />I want to modify the driver strength and ddr frequency,<br />could you where to make modifications?</p></blockquote></div><p>u-boot/cpu/mips/ar7240/meminit.c -&gt; function wasp_ddr_initial_config<br />Don&#039;t ask me about registers values and definitions - I don&#039;t have access to AR9341 data sheet...</p></blockquote></div><p>Thanks a lot!<br />I have found some info in Ar7240_soc.h.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p227856">
				<div class="post-metadata">
					<div class="post-num">Post #252</div>
					<div class="post-author">Sharonbuss</div>
					<div class="post-datetime">
						18 Mar 2014, 11:00					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>hackru wrote:</cite><blockquote><p>How did you forced DDR1 in config?</p></blockquote></div><p>In Meminit.c</p><p>#&nbsp; &nbsp; switch(WASP_RAM_TYPE(ar7240_reg_rd(WASP_BOOTSTRAP_REG))){<br />&nbsp; &nbsp; &nbsp; &nbsp; switch (3){</p>											<p class="post-edited">(Last edited by <strong>Sharonbuss</strong> on 25 Mar 2014, 05:45)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p228883">
				<div class="post-metadata">
					<div class="post-num">Post #253</div>
					<div class="post-author">nedoskiv</div>
					<div class="post-datetime">
						31 Mar 2014, 16:08					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>My question probabbly will be silly for some of you, but after some reading I did not find a clear way to install pepe2k uboot mod using MTD command.</p><p>I try to do it on TP-LINK 740N version 4, searial port is hard to connect on it. Need to soldier parts on board and that is not for my hands.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p228902">
				<div class="post-metadata">
					<div class="post-num">Post #254</div>
					<div class="post-author">MBS</div>
					<div class="post-datetime">
						31 Mar 2014, 21:09					</div>
				</div>
				<div class="post-content content">
					<p>You could try it this way: <a href="http://wiki.openwrt.org/toh/tp-link/tl-wr1043nd#making.bootloader.partition.writable">http://wiki.openwrt.org/toh/tp-link/tl- … n.writable</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p228918">
				<div class="post-metadata">
					<div class="post-num">Post #255</div>
					<div class="post-author">vladizlat</div>
					<div class="post-datetime">
						1 Apr 2014, 00:01					</div>
				</div>
				<div class="post-content content">
					<p>Or: Use DDWRT, to flash Ubootmod. From web 192.168.1.1 set password and in Services check SSHd and SSH TCP Forwarding. Run telnet 192.168.1.1 and do uboot backup with the command:</p><p>cat /dev/mtd0 &gt; /tmp/uboot_backup.bin</p><p>Then download uboot_backup.bin from the /tmp directory with WinSCP using SCP protocol. Uboot_backup.bin file is 128KB and open it with HEX editor (TinyHexer) and the part from 0x00 to 0x010000 replace with the contents (64KB) of ubootmod for wr740n v4. Save the file as ubootmod.bin. Upload ubootmod.bin with WinSCP to /tmp and flash it with telnet or Putty SSH:</p><p>mtd -r write /tmp/ubootmod.bin RedBoot</p><p>Good Luck</p>											<p class="post-edited">(Last edited by <strong>vladizlat</strong> on 1 Apr 2014, 00:07)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p228960">
				<div class="post-metadata">
					<div class="post-num">Post #256</div>
					<div class="post-author">nedoskiv</div>
					<div class="post-datetime">
						1 Apr 2014, 14:00					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for the quick reply, I think I will manage to do that.<br />I got another question.<br />As I understand, u-boot is responsible for gpio (router leds) initialization. Is it possible not to flash router leds during boot process. I want to connect relay box on leds, but if they blink on reboot it will be a problem.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p228962">
				<div class="post-metadata">
					<div class="post-num">Post #257</div>
					<div class="post-author">pepe2k</div>
					<div class="post-datetime">
						1 Apr 2014, 14:06					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>nedoskiv wrote:</cite><blockquote><p>As I understand, u-boot is responsible for gpio (router leds) initialization.</p></blockquote></div><p>Yes, in most case I use some GPIOs for LEDs.</p><div class="quotebox"><cite>nedoskiv wrote:</cite><blockquote><p>Is it possible not to flash router leds during boot process. I want to connect relay box on leds, but if they blink on reboot it will be a problem.</p></blockquote></div><p>Yes, but it will require changes in code and own compilation. Take a look here:<br /><a href="https://github.com/pepe2k/u-boot_mod/blob/master/u-boot/lib_mips/board.c#L462">https://github.com/pepe2k/u-boot_mod/bl … ard.c#L462</a></p><p>I have some plans to make low level GPIO initialization which can be changed in U-Boot command line (like O/C profiles for AR9331) and stored in FLASH, but... at this time I&#039;m very busy with other projects.</p>											<p class="post-edited">(Last edited by <strong>pepe2k</strong> on 1 Apr 2014, 14:07)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p228988">
				<div class="post-metadata">
					<div class="post-num">Post #258</div>
					<div class="post-author">nedoskiv</div>
					<div class="post-datetime">
						1 Apr 2014, 21:51					</div>
				</div>
				<div class="post-content content">
					<p>I report successful modifying the code (commented the line for all_led_on) and installing pepe2k u-boot using DD-WRT.<br />DD-WRT is not really finished for tp-link 740N version 4, but do the job, now will try to modify openwrt sources.</p><p>Thank you all for the help and fast responses.</p>											<p class="post-edited">(Last edited by <strong>nedoskiv</strong> on 1 Apr 2014, 22:07)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p229023">
				<div class="post-metadata">
					<div class="post-num">Post #259</div>
					<div class="post-author">rezilient</div>
					<div class="post-datetime">
						2 Apr 2014, 08:15					</div>
				</div>
				<div class="post-content content">
					<p>Hello. I hope this is the right place to post this, if not I apologize. </p><p>I have a couple of wr703n devices flashed with OpenWrt that were used for a special network appliance.&nbsp; One of them the USB host can power the device. On the other one only the micro-USB can power the device.&nbsp; We need to be able to power the device with regular USB port, not mico USB. Is there a way to enable that.</p><p>Thanks. <br />Rez</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p229227">
				<div class="post-metadata">
					<div class="post-num">Post #260</div>
					<div class="post-author">jeffjj</div>
					<div class="post-datetime">
						4 Apr 2014, 22:19					</div>
				</div>
				<div class="post-content content">
					<p>I tried to compile this u-boot for my TP-Link WDR3600, however i am not very good at this and its telling me the config is not present. Any chance you could compile it for me?&nbsp; I also need the TP-Link WDR3500 as well. Thanks!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p229389">
				<div class="post-metadata">
					<div class="post-num">Post #261</div>
					<div class="post-author">nedoskiv</div>
					<div class="post-datetime">
						6 Apr 2014, 19:23					</div>
				</div>
				<div class="post-content content">
					<p>hello again. Next question coming...</p><p>My goal is now to make web mode require a password. So far i manage to locate where are html files (u-boot/net/uip-0.9/fsdata.c), but do not have same success with the part of the code that handle them.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p229390">
				<div class="post-metadata">
					<div class="post-num">Post #262</div>
					<div class="post-author">pepe2k</div>
					<div class="post-datetime">
						6 Apr 2014, 19:27					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>jeffjj wrote:</cite><blockquote><p>I tried to compile this u-boot for my TP-Link WDR3600, however i am not very good at this and its telling me the config is not present. Any chance you could compile it for me?&nbsp; I also need the TP-Link WDR3500 as well. Thanks!</p></blockquote></div><p>I&#039;m busy... sorry.</p><div class="quotebox"><cite>nedoskiv wrote:</cite><blockquote><p>My goal is now to make web mode require a password. So far i manage to locate where are html files (u-boot/net/uip-0.9/fsdata.c), but do not have same success with the part of the code that handle them.</p></blockquote></div><p>fsdata.c file is generated from files in vendors subfolders:<br /><a href="https://github.com/pepe2k/u-boot_mod/tree/master/u-boot/httpd/vendors">https://github.com/pepe2k/u-boot_mod/tr … pd/vendors</a></p><p>Server source:<br /><a href="https://github.com/pepe2k/u-boot_mod/blob/master/u-boot/httpd/httpd.c">https://github.com/pepe2k/u-boot_mod/bl … pd/httpd.c</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p229439">
				<div class="post-metadata">
					<div class="post-num">Post #263</div>
					<div class="post-author">nedoskiv</div>
					<div class="post-datetime">
						7 Apr 2014, 11:32					</div>
				</div>
				<div class="post-content content">
					<p>Hmm... Look like my copy of the sources do not contain such folder and files. That is the reson I did not notice httpd folder.<br />Perhaps I downloaded some old version.</p><br /><p>P.S. I downloaded new version and directory tree is as described in pepe2k post. Add openwrt toolchain and just run make command to check is it working. It works with one important warrning:</p><p>Image Name:&nbsp; &nbsp;u-boot image<br />Created:&nbsp; &nbsp; &nbsp; Tue Apr&nbsp; 8 09:03:00 2014<br />Image Type:&nbsp; &nbsp;MIPS Linux Firmware (lzma compressed)<br />Data Size:&nbsp; &nbsp; 49952 Bytes = 48.78 kB = 0.05 MB<br />Load Address: 0x80010000<br />Entry Point:&nbsp; 0x80010000<br />make[1]: Entering directory `/openwrt/pepe2k-uboot-7.4.2014&#039;</p><p>======= Preparing 64KB file filled with 0xFF... =======<br />64+0 records in<br />128+0 records out<br />65536 bytes (66 kB) copied, 0,00286629 s, 22,9 MB/s</p><p>======= Copying U-Boot image... =======<br />128+1 records in<br />128+1 records out<br />65680 bytes (66 kB) copied, 0,000918969 s, 71,5 MB/s</p><p>======= U-Boot image ready, size: 65680 bytes =======</p><br /><br /><p>&nbsp; &nbsp; &nbsp;**********************************<br />&nbsp; &nbsp; &nbsp;*&nbsp; &nbsp;U-BOOT IMAGE SIZE TOO BIG!&nbsp; &nbsp;*<br />&nbsp; &nbsp; &nbsp;**********************************</p><p>I guess oversize is a&nbsp; problem? Here is old code that work without this problem:</p><br /><p>Image Name:&nbsp; &nbsp;u-boot image<br />Created:&nbsp; &nbsp; &nbsp; Tue Apr&nbsp; 8 10:42:00 2014<br />Image Type:&nbsp; &nbsp;MIPS Linux Firmware (lzma compressed)<br />Data Size:&nbsp; &nbsp; 43075 Bytes = 42.07 kB = 0.04 MB<br />Load Address: 0x80010000<br />Entry Point:&nbsp; 0x80010000<br />make[1]: Entering directory `/openwrt/pepe-uboot/u-boot_sources_for_tp-link_AR9331_by_pepe2k&#039;<br />\n======= Preparing 64 KB file filled with 0xFF... =======<br />64+0 records in<br />128+0 records out<br />65536 bytes (66 kB) copied, 0,00447146 s, 14,7 MB/s<br />\n======= Copying U-Boot image... =======<br />112+1 records in<br />112+1 records out<br />57647 bytes (58 kB) copied, 0,000844541 s, 68,3 MB/s<br />\n======= U-Boot image ready, size: 65536 bytes =======</p>											<p class="post-edited">(Last edited by <strong>nedoskiv</strong> on 8 Apr 2014, 11:55)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p229808">
				<div class="post-metadata">
					<div class="post-num">Post #264</div>
					<div class="post-author">locutus</div>
					<div class="post-datetime">
						10 Apr 2014, 17:09					</div>
				</div>
				<div class="post-content content">
					<p>This mod really helps me with my project a lot! Especially the dhcp-functionality is important for my project. I am building a custom U-BOOT for a TL-WR740n v4 which is supposed to configure the network over dhcp, download a ramfs-image and then boot that. </p><p>But I have one problem: When booting, I get:<br /></p><div class="codebox"><pre><code>Hit any key to stop autobooting:  0 

Link down: eth0
Link down: eth1
Booting image at: 0x80800000

   Image name:    
   Image type:   MIPS Linux Kernel Image (lzma compressed)
   Data size:    0 Bytes = 0 kB
   Load address: 0x20028124
   Entry point:  0x00000F22

Uncompressing kernel image... ## Error: LZMA error num: 1

## Error: failed to execute &#039;bootcmd&#039;!</code></pre></div><p>My bootcmd is &quot;dhcp; bootm&quot;<br />If I run boot from inside the uBOOT-console, the bootcmd works perfectly and the system loads and boots the remote image.</p><p>But when the bootcmd is invoked from auto-booting, the dhcp-command does not execute and thus nothing is present at the boot adress. Do you, pepe2k, or anybody else know what causes this issue and how I might solve it? </p><p>Unrelated: How can I exclude the Website stuff from the build? I do not need it and would prefer the bootloader to reset when booting the supposed image fails. (This way, the device would stay in a loop if the tftp host is down and nobody would have to go to the device and reset it!)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p229809">
				<div class="post-metadata">
					<div class="post-num">Post #265</div>
					<div class="post-author">pepe2k</div>
					<div class="post-datetime">
						10 Apr 2014, 17:18					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>locutus wrote:</cite><blockquote><p>My bootcmd is &quot;dhcp; bootm&quot;</p></blockquote></div><p>Try add proper address for bootm command.</p><div class="quotebox"><cite>locutus wrote:</cite><blockquote><p>Unrelated: How can I exclude the Website stuff from the build? I do not need it and would prefer the bootloader to reset when booting the supposed image fails. (This way, the device would stay in a loop if the tftp host is down and nobody would have to go to the device and reset it!)</p></blockquote></div><p>You will need a lot of code change for that.<br />Take a look here: <a href="https://github.com/pepe2k/u-boot_mod/blob/master/u-boot/common/main.c#L242">https://github.com/pepe2k/u-boot_mod/bl … ain.c#L242</a> and just change &quot;NetLoopHttpd()&quot; call.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p229822">
				<div class="post-metadata">
					<div class="post-num">Post #266</div>
					<div class="post-author">locutus</div>
					<div class="post-datetime">
						10 Apr 2014, 19:14					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>pepe2k wrote:</cite><blockquote><div class="quotebox"><cite>locutus wrote:</cite><blockquote><p>My bootcmd is &quot;dhcp; bootm&quot;</p></blockquote></div><p>Try add proper address for bootm command.</p></blockquote></div><p>I tried different command pairings. none work. </p><p>But after some evaluation, I noticed that the eth-devices always are down during boot. So I changed the bootdelay from 1 to 4 and also added a delay of 850ms right before execution of the bootcmd in the main.c. And all of a sudden, everything works as it should! </p><br /><div class="quotebox"><cite>pepe2k wrote:</cite><blockquote><div class="quotebox"><cite>locutus wrote:</cite><blockquote><p>Unrelated: How can I exclude the Website stuff from the build? I do not need it and would prefer the bootloader to reset when booting the supposed image fails. (This way, the device would stay in a loop if the tftp host is down and nobody would have to go to the device and reset it!)</p></blockquote></div><p>You will need a lot of code change for that.<br />Take a look here: <a href="https://github.com/pepe2k/u-boot_mod/blob/master/u-boot/common/main.c#L242">https://github.com/pepe2k/u-boot_mod/bl … ain.c#L242</a> and just change &quot;NetLoopHttpd()&quot; call.</p></blockquote></div><p>Thanks for showing me the location. I just replaced the NetLoopHttpd() with do_reset() and included the include/exports.h. This way, the router reboots every time the system fails.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p229831">
				<div class="post-metadata">
					<div class="post-num">Post #267</div>
					<div class="post-author">pepe2k</div>
					<div class="post-datetime">
						10 Apr 2014, 20:07					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>locutus wrote:</cite><blockquote><p>But after some evaluation, I noticed that the eth-devices always are down during boot. So I changed the bootdelay from 1 to 4 and also added a delay of 850ms right before execution of the bootcmd in the main.c. And all of a sudden, everything works as it should!</p></blockquote></div><p>Good point, I will add also &quot;sleep&quot; command in future.</p><p>BTW, new version has Hush shell included, so you can use more complex scripts, take a look at this commit:<br /><a href="https://github.com/pepe2k/u-boot_mod/commit/0b0a69c051cca63503214ac54fab99befb988afb">https://github.com/pepe2k/u-boot_mod/co … befb988afb</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p229972">
				<div class="post-metadata">
					<div class="post-num">Post #268</div>
					<div class="post-author">dony71</div>
					<div class="post-datetime">
						12 Apr 2014, 04:59					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m trying to make u-boot for AP94 target<br />I get source from wr703n-uboot-with-web-failsafe project<br />I can compile u-boot.bin successfully, however after flashing to my router,<br />networking not work, neither in u-boot or in root<br />Anybody knows what could be wrong?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p229978">
				<div class="post-metadata">
					<div class="post-num">Post #269</div>
					<div class="post-author">lianbinzhang</div>
					<div class="post-datetime">
						12 Apr 2014, 10:48					</div>
				</div>
				<div class="post-content content">
					<p>Thanks you do it. I download your code and compile it. I use external FLASH programmer to download it. But there is a problem.The WiFi does not work.I don&#039;t know how to solve the problem. Will you help me out?<br />Here is the U-boot blog.<br />/////////////////////////////////////////////////////////////////////////<br />/////////////////////////////////////////////////////////////////////////<br />AP121 (AR9331) U-Boot for TL-WR703N</p><p>DRAM:&nbsp; &nbsp;64 MB DDR 16-bit<br />FLASH:&nbsp; Winbond W25Q128 (16 MB)<br />CLOCKS: 400/400/200/33 MHz (CPU/RAM/AHB/SPI)</p><p>## Error: MAC is invalid, using fixed!</p><p>LED on during eth initialization...</p><p>## Error: MAC address in FLASH is invalid, using fixed!<br />## Error: MAC address in FLASH is invalid, using fixed!<br />Press reset button for at least:<br />- 3 sec. to run web failsafe mode<br />- 5 sec. to run U-Boot console<br />- 7 sec. to run U-Boot netconsole</p><p>Reset button is pressed for:&nbsp; 5</p><p>Button was pressed for 5 sec...<br />Starting U-Boot console...</p><p>uboot&gt; <br />//////////////////////////////////////////////////////////////////////////////////</p><p>And when the Openwrt start up,&nbsp; the ath9k unable to initialize.<br />///////////////////////////////////////////////////////////////////////////////////<br />[&nbsp; &nbsp; 9.220000] ath: phy0: Unable to initialize hardware; initialization status: -5<br />[&nbsp; &nbsp; 9.230000] ath9k ar933x_wmac: failed to initialize device<br />[&nbsp; &nbsp; 9.230000] ath9k: probe of ar933x_wmac failed with error -5</p>											<p class="post-edited">(Last edited by <strong>lianbinzhang</strong> on 12 Apr 2014, 11:01)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p229981">
				<div class="post-metadata">
					<div class="post-num">Post #270</div>
					<div class="post-author">pepe2k</div>
					<div class="post-datetime">
						12 Apr 2014, 10:58					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>dony71 wrote:</cite><blockquote><p>[...]however after flashing to my router, networking not work, neither in u-boot or in root[...]</p></blockquote></div><p>You need to add a proper network driver in U-Boot.<br />Network is initialized in U-boot, not again/later in OpenWrt.</p><div class="quotebox"><cite>lianbinzhang wrote:</cite><blockquote><p>[...]## Error: MAC is invalid, using fixed![...]</p></blockquote></div><p>Missing second 64 KB block from original FLASH.</p><div class="quotebox"><cite>lianbinzhang wrote:</cite><blockquote><p>[...][&nbsp; &nbsp; 9.230000] ath9k: probe of ar933x_wmac failed with error -5[...]</p></blockquote></div><p>Missing ART partition (last 64 KB block from original FLASH).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p229984">
				<div class="post-metadata">
					<div class="post-num">Post #271</div>
					<div class="post-author">lianbinzhang</div>
					<div class="post-datetime">
						12 Apr 2014, 11:31					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>pepe2k wrote:</cite><blockquote><p>[...]## Error: MAC is invalid, using fixed!<br />Missing second 64 KB block from original FLASH.[...]</p><p>[...][&nbsp; &nbsp; 9.230000] ath9k: probe of ar933x_wmac failed with error -5[...]<br />Missing ART partition (last 64 KB block from original FLASH).</p></blockquote></div><p>And what should I do to solve this problem?</p>											<p class="post-edited">(Last edited by <strong>lianbinzhang</strong> on 12 Apr 2014, 11:36)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p229986">
				<div class="post-metadata">
					<div class="post-num">Post #272</div>
					<div class="post-author">pepe2k</div>
					<div class="post-datetime">
						12 Apr 2014, 11:52					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>lianbinzhang wrote:</cite><blockquote><div class="quotebox"><cite>pepe2k wrote:</cite><blockquote><p>[...]## Error: MAC is invalid, using fixed!<br />Missing second 64 KB block from original FLASH.[...]</p><p>[...][&nbsp; &nbsp; 9.230000] ath9k: probe of ar933x_wmac failed with error -5[...]<br />Missing ART partition (last 64 KB block from original FLASH).</p></blockquote></div><p>And what should I do to solve this problem?</p></blockquote></div><p>Did you erase whole FLASH before writing there my U-Boot?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p229987">
				<div class="post-metadata">
					<div class="post-num">Post #273</div>
					<div class="post-author">lianbinzhang</div>
					<div class="post-datetime">
						12 Apr 2014, 11:58					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>pepe2k wrote:</cite><blockquote><div class="quotebox"><cite>lianbinzhang wrote:</cite><blockquote><div class="quotebox"><cite>pepe2k wrote:</cite><blockquote><p>[...]## Error: MAC is invalid, using fixed!<br />Missing second 64 KB block from original FLASH.[...]</p><p>[...][&nbsp; &nbsp; 9.230000] ath9k: probe of ar933x_wmac failed with error -5[...]<br />Missing ART partition (last 64 KB block from original FLASH).</p></blockquote></div><p>And what should I do to solve this problem?</p></blockquote></div><p>Did you erase whole FLASH before writing there my U-Boot?</p></blockquote></div><p>Yes, I did.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p229989">
				<div class="post-metadata">
					<div class="post-num">Post #274</div>
					<div class="post-author">dony71</div>
					<div class="post-datetime">
						12 Apr 2014, 12:45					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>pepe2k wrote:</cite><blockquote><div class="quotebox"><cite>dony71 wrote:</cite><blockquote><p>[...]however after flashing to my router, networking not work, neither in u-boot or in root[...]</p></blockquote></div><p>You need to add a proper network driver in U-Boot.<br />Network is initialized in U-boot, not again/later in OpenWrt.</p></blockquote></div><p>pepe2k,<br />wrt400n is based on AR8236 switch<br />i thought driver already defined in include/configs/ap94.h<br />................<br />#define CFG_ATHRS26_PHY&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1<br />#define CFG_AG7100_NMACS&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2<br />................<br />Am I understanding wrongly?</p>											<p class="post-edited">(Last edited by <strong>dony71</strong> on 12 Apr 2014, 12:51)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p229991">
				<div class="post-metadata">
					<div class="post-num">Post #275</div>
					<div class="post-author">locutus</div>
					<div class="post-datetime">
						12 Apr 2014, 13:00					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>pepe2k wrote:</cite><blockquote><div class="quotebox"><cite>lianbinzhang wrote:</cite><blockquote><p>Did you erase whole FLASH before writing there my U-Boot?</p></blockquote></div><p>Yes, I did.</p></blockquote></div><p>Do you have a backup of the original FLASH? You need to write back the <a href="http://wiki.openwrt.org/doc/howto/restore_art_partition">ART-Partition</a> and the UBoot general config partition to your device. </p><p>If you don&#039;t have a backup, you will need to get the correct files for your router from someone who has the same model as you do. But: The UBoot general config will contain a different mac adress (with a hex editor and the knowledge of the mac adress stored in the replacement, you can change it to the mac adress the router should have, though!). Regarding the ART-backup, as mentioned in the article linked above, your WLAN will most likely not perform as well as before.</p><br /><p>What programmer did you use to program? flashrom? You can tell flashrom to only write specific parts of the flash by using a rom layout file (see the <a href="http://linux.die.net/man/8/flashrom">manpage for flashrom</a>) - this should similary work for other flash programmers, too! <br />Also, it is generally a good idea to first download the whole flash as a backup and then use tools like <a href="http://rationallyparanoid.com/articles/dd-hex-editor.html">dd</a> to actually overwrite parts of &quot;!a copy of the backup!&quot; with the new data. This way, the image you will be flashing will always contain all the old stuff so if the programmer screws up, you still do not loose your data!</p>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 11 of 25</div><nav><ul><li><a href="viewtopic.php%3Fid=43237&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=43237&amp;p=9.html">9</a></li><li><a href="viewtopic.php%3Fid=43237&amp;p=10.html">10</a></li><li class="pagination-current"><span>11</span></li><li><a href="viewtopic.php%3Fid=43237&amp;p=12.html">12</a></li><li><a href="viewtopic.php%3Fid=43237&amp;p=13.html">13</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=43237&amp;p=25.html">25</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0.001 -->

</body>
</html>