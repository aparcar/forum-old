<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Has anybody succeeded to use kexec on brcm47xx platform?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 6 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p76803">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">wzab</div>
					<div class="post-datetime">
						20 Nov 2008, 16:27					</div>
				</div>
				<div class="post-content content">
					<p>Hi All,</p><p>I need to use the kexec to boot the kernel from the USB storage connected to my router.<br />Has anybody succesfully used kexec on the brcm47xx platform (namely Asus WL500gP V2)?</p><p>The idea is to have a simple kernel and basic system on the internal flash, and use it only for booting of the kernel provided on the external disk.<br />The solution should speed up development without continuous reflashing of the device...<br />-- <br />TIA, WZab</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p76884">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">wzab</div>
					<div class="post-datetime">
						22 Nov 2008, 01:10					</div>
				</div>
				<div class="post-content content">
					<p>I have compiled kernel with kexec support.<br />However when I try to use it, I get the following:<br /></p><div class="quotebox"><blockquote><p># kexec -f --command-line=&quot;root=/dev/nfs nfsroot=172.17.1.1:/usr/local/nfs/asus init=/etc/preinit noinitrd console=ttyS0,115200 ip=dhcp&quot; ll.elf&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />br-lan: port 1(eth0.0) entering disabled state&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />Starting new kernel&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />Will call new kernel at 003fa000&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />Bye ...</p></blockquote></div><p>Then my router hangs until power off...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p77567">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">n00ben</div>
					<div class="post-datetime">
						4 Dec 2008, 03:47					</div>
				</div>
				<div class="post-content content">
					<p>any luck with loading another kernel?</p><p>/Regards<br />Henrik</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p82536">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">wurststulle</div>
					<div class="post-datetime">
						24 Feb 2009, 14:15					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>wzab wrote:</cite><blockquote><p>I have compiled kernel with kexec support.<br />However when I try to use it, I get the following:<br /></p><div class="quotebox"><blockquote><p># kexec -f --command-line=&quot;root=/dev/nfs nfsroot=172.17.1.1:/usr/local/nfs/asus init=/etc/preinit noinitrd console=ttyS0,115200 ip=dhcp&quot; ll.elf&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />br-lan: port 1(eth0.0) entering disabled state&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />Starting new kernel&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />Will call new kernel at 003fa000&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />Bye ...</p></blockquote></div><p>Then my router hangs until power off...</p></blockquote></div><p>same problem here, there is a problem with the start address, but can not figure out why and how to fix this</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p82583">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">alexsamad</div>
					<div class="post-datetime">
						24 Feb 2009, 22:52					</div>
				</div>
				<div class="post-content content">
					<p>This is something I would like to see,&nbsp; i use the flash on the system for my kernel and a usb-rootfs - that way if I stuff something up I can remove the usb and have a bootable system (presuming I don&#039;t touch the system flash), but having kexec would be excelent</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p82587">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">wurststulle</div>
					<div class="post-datetime">
						24 Feb 2009, 23:30					</div>
				</div>
				<div class="post-content content">
					<p>i managed (with some help) to lead and execute a kernel using kexec. the last existing problem is, that the command-line parameters of the kernel are hardcoded. i ll see what i can do.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p82589">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">alexsamad</div>
					<div class="post-datetime">
						24 Feb 2009, 23:51					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>wurststulle wrote:</cite><blockquote><p>i managed (with some help) to lead and execute a kernel using kexec. the last existing problem is, that the command-line parameters of the kernel are hardcoded. i ll see what i can do.</p></blockquote></div><p>Want to give a bit more info on how to (or patches), the hardcoded options can be change in the build environment</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p82596">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">wurststulle</div>
					<div class="post-datetime">
						25 Feb 2009, 01:05					</div>
				</div>
				<div class="post-content content">
					<p>i ll publish the patches later this week, maybe weekend.</p><p>the problem with the hardcoded options is, that this code has to be rewritten:<br />if no options are given(normal boot), the kernel has to use the hardcoded ones, but if they are given(kexec), the given ones have to be used.</p><p>regards</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p82641">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">wurststulle</div>
					<div class="post-datetime">
						25 Feb 2009, 18:11					</div>
				</div>
				<div class="post-content content">
					<p>to solve the problem of the hardcoded command-line options i m using two trunks, one for the native image, and one for the kexec image.<br />i used the patch posted <a href="http://www.nabble.com/kexec-on-mips---anyone-has-it-working--tp17485898p22158033.html">http://www.nabble.com/kexec-on-mips---a â€¦ 58033.html</a> an included it by hand into both trunks. (i ll post some ready-to-use patches, as said, at weekend, or when its working^^)</p><p>now you should be able to execute the new kernel. to let it boot from an external device the commandline options must be changed in make kernel_menuconfig. <br />so far its working. now there is the problem to include support for your external device in the kernel. so i have added support for all things that could have something to do with usb.</p><p>all in all i have no luck getting my usb device recogniced. it also may be, that my device name /dev/sda2 is wrong. <br /></p><div class="quotebox"><blockquote><p>Kernel command line: root=/dev/sda2 rootfstype=ext2 init=/etc/preinit noinitrd console=ttyS0,115200</p></blockquote></div><div class="quotebox"><blockquote><p>ehci_hcd: USB 2.0 &#039;Enhanced&#039; Host Controller (EHCI) Driver<br />PCI: Enabling device 0000:00:02.2 (0000 -&gt; 0002)<br />PCI: Fixing up device 0000:00:02.2<br />ehci_hcd 0000:00:02.2: EHCI Host Controller<br />ehci_hcd 0000:00:02.2: new USB bus registered, assigned bus number 1<br />ehci_hcd 0000:00:02.2: irq 5, io mem 0x40002000<br />ehci_hcd 0000:00:02.2: USB 2.0 started, EHCI 1.00<br />usb usb1: configuration #1 chosen from 1 choice<br />hub 1-0:1.0: USB hub found<br />hub 1-0:1.0: 4 ports detected<br />usb usb1: New USB device found, idVendor=1d6b, idProduct=0002<br />usb usb1: New USB device strings: Mfr=3, Product=2, SerialNumber=1<br />usb usb1: Product: EHCI Host Controller<br />usb usb1: Manufacturer: Linux 2.6.28.7 ehci_hcd<br />usb usb1: SerialNumber: 0000:00:02.2<br />Initializing USB Mass Storage driver...<br />usbcore: registered new interface driver usb-storage<br />USB Mass Storage support registered.<br />usbcore: registered new interface driver libusual<br />usbcore: registered new interface driver usbhid<br />usbhid: v2.6:USB HID core driver<br />TCP vegas registered<br />NET: Registered protocol family 17<br />802.1Q VLAN Support v1.8 Ben Greear &lt;greearb@candelatech.com&gt;<br />All bugs added by David S. Miller &lt;davem@redhat.com&gt;<br />VFS: Cannot open root device &quot;sda2&quot; or unknown-block(0,0)<br />Please append a correct &quot;root=&quot; boot option; here are the available partitions:<br />1f00&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;256 mtdblock0 (driver?)<br />1f01&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 3776 mtdblock1 (driver?)<br />1f02&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 3002 mtdblock2 (driver?)<br />1f03&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;960 mtdblock3 (driver?)<br />1f04&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 64 mtdblock4 (driver?)<br />Kernel panic - not syncing: VFS: Unable to mount root fs on unknown-block(0,0)</p></blockquote></div><p>i hope, this will help someone.</p>											<p class="post-edited">(Last edited by <strong>wurststulle</strong> on 25 Feb 2009, 18:13)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p82917">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">alexsamad</div>
					<div class="post-datetime">
						28 Feb 2009, 23:57					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for that.</p><p>I was thinking there used to be a tool to set the kernel boot options - it would modify a built kernel.&nbsp; That might be better than building 2 kernels.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>