<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> I need to open all ports (DMZ) on every device connected to the router</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 21 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p285302">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">alelocooo</div>
					<div class="post-datetime">
						28 Jul 2015, 16:34					</div>
				</div>
				<div class="post-content content">
					<p>Hi, im trying to open all ports on every single device connected to the router.</p><p>Is this possible?</p><p>I&#039;ve tried almost everything.</p><p>I installed miniupndp + luci interface for this, tried portforwarding 1-65535 on every single device and still doesn&#039;t work. I have NAT restrict on the xbox and terrible lag on the pc.</p><p>This is my configuration:</p><p><a href="http://i.imgur.com/qofRpba.jpg">http://i.imgur.com/qofRpba.jpg</a></p><p><a href="http://i.imgur.com/G3GTcjR.jpg">http://i.imgur.com/G3GTcjR.jpg</a></p><p>Ant this is my upnp configuration. 192.168.1.20 is the ip from my pc.</p><p><a href="http://i.imgur.com/rledXcG.jpg">http://i.imgur.com/rledXcG.jpg</a></p><p>This is the DMZ config on the modem 192.168.0.10 is my routers IP</p><p><a href="http://i.imgur.com/I14ld4h.jpg">http://i.imgur.com/I14ld4h.jpg</a></p><p>And here, im pretty sure i dont have to touch anything as long as DMZ is directed to the router&#039;s IP.</p><p><a href="http://i.imgur.com/JAt9g6d.jpg">http://i.imgur.com/JAt9g6d.jpg</a></p><p>Am i missing something?</p><p>Also, is there any application to check what ports are open?</p><p>Thanks!</p>											<p class="post-edited">(Last edited by <strong>alelocooo</strong> on 28 Jul 2015, 16:39)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p285304">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">arokh</div>
					<div class="post-datetime">
						28 Jul 2015, 16:43					</div>
				</div>
				<div class="post-content content">
					<p>That&#039;s not how it works, you can&#039;t forward a port to several computers. miniupnpd should accomplish what you want if it&#039;s set up properly and the router&#039;s WAN port has a public IP address.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p285306">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">eduperez</div>
					<div class="post-datetime">
						28 Jul 2015, 16:49					</div>
				</div>
				<div class="post-content content">
					<p>Each external port can only be forwarded to one port on one internal computer; think about it: when receiving a connection on port X, how is OpenWRT going to decide which computer should receive that connection?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p285308">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">alelocooo</div>
					<div class="post-datetime">
						28 Jul 2015, 16:52					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>arokh wrote:</cite><blockquote><p>That&#039;s not how it works, you can&#039;t forward a port to several computers. miniupnpd should accomplish what you want if it&#039;s set up properly and the router&#039;s WAN port has a public IP address.</p></blockquote></div><br /><p>So, on the router/upnp, should i put the public ip address that the modem gives me? And thats it? After that can i remove eveything on &quot;port forwarding&quot; and just configure the UPNP?</p><p>It surprises me that on both the firewall/port forwarding section and on UPNP on openwrt,&nbsp; says &quot;internal ip address&quot;, it doesnt say anything about public putting my public ip address.</p><p>Thanks!</p>											<p class="post-edited">(Last edited by <strong>alelocooo</strong> on 28 Jul 2015, 17:03)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p285311">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">arokh</div>
					<div class="post-datetime">
						28 Jul 2015, 17:04					</div>
				</div>
				<div class="post-content content">
					<p>You don&#039;t have to do anything. I just said make sure your WAN port (meaning interface, not TCP/ip port) has a public IP address. Specifically, that you do not have another router in front doing NAT. Just make sure miniupnpd is running properly and you should be fine.</p>											<p class="post-edited">(Last edited by <strong>arokh</strong> on 28 Jul 2015, 17:04)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p285312">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">alelocooo</div>
					<div class="post-datetime">
						28 Jul 2015, 17:04					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>eduperez wrote:</cite><blockquote><p>Each external port can only be forwarded to one port on one internal computer; think about it: when receiving a connection on port X, how is OpenWRT going to decide which computer should receive that connection?</p></blockquote></div><p>So opening all ports on all devices is not possible?</p><div class="quotebox"><cite>arokh wrote:</cite><blockquote><p>You don&#039;t have to do anything. I just said make sure your WAN port has a public IP address. Specifically, that you do not have another router in front doing NAT. Just make sure miniupnpd is running properly and you should be fine.</p></blockquote></div><p>Mmm.. pretty sure both the modem and the router are with DHCP on. I did this because the modem is wireless and i can get more range when im outside this way. Also, if i disable DHCP and put&nbsp; the modem as bridge only, i cant even access to it <img src="https://forum.openwrt.org/img/smilies/hmm.png" width="15" height="15" alt="hmm" /> .</p><p>With &quot;you dont have to do anything&quot;, what do you mean? should i remove all i put on both the upnp and port forwarding tabs?</p><p>Edit: i only have one router one modem.</p><p>edit2: nevermind i give up and i dont want to set the modem as bridge only so the router wan has a public ip address. ill just open the ports i need. thanks anyways!</p>											<p class="post-edited">(Last edited by <strong>alelocooo</strong> on 28 Jul 2015, 18:38)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p285349">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">eduperez</div>
					<div class="post-datetime">
						28 Jul 2015, 21:05					</div>
				</div>
				<div class="post-content content">
					<p>You can &quot;open&quot; all ports to all devices, if that means that any device can request any port using UPNP. But you cannot &quot;forward&quot; any port to several devices at the same time. In the first case each device ask for a port as it needs it, and the router will grant it, as long as that port is not in use already.</p><p>If your router does not have a public address, even if you open a port and forward it to a device, you are going to have to do forward that port from the modem to OpenWRT too; and UPNP will not do that for you. Thus, you need to have a public IP on the router, put the modem in bridge mode, and connect all devices to the router.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p285354">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">drawz</div>
					<div class="post-datetime">
						28 Jul 2015, 21:26					</div>
				</div>
				<div class="post-content content">
					<p>It sounds to me like you may be double NATing (NAT twice, once through each router), which is going to break things. What device is &quot;in front&quot; of your OpenWrt router? Is it a modem or combination modem/router? You show screenshots of your OpenWrt router being in the DMZ of that other device. You should either bypass it if possible (making OpenWrt your primary router) or set it up in bridge mode (again making your OpenWrt the primary router). If neither of those is an option, OpenWrt needs to be configured as an access point only to avoid double NAT. </p><p>UPNP should be enabled regardless of the above to allow the Xbox to tell the router which ports it needs forwarded as needed.</p>											<p class="post-edited">(Last edited by <strong>drawz</strong> on 28 Jul 2015, 21:38)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p285363">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">drawz</div>
					<div class="post-datetime">
						28 Jul 2015, 21:39					</div>
				</div>
				<div class="post-content content">
					<p>Once you get this sorted out, I also suggest you install &amp; configure luci-app-qos or luci-app-sqm to manage your bandwidth and help keep latency low.</p>											<p class="post-edited">(Last edited by <strong>drawz</strong> on 28 Jul 2015, 21:39)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p285364">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">arokh</div>
					<div class="post-datetime">
						28 Jul 2015, 21:41					</div>
				</div>
				<div class="post-content content">
					<p>You should definitely set it to bridge. It is a requirement to get &quot;NAT open&quot; on consoles.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p285401">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">alelocooo</div>
					<div class="post-datetime">
						29 Jul 2015, 05:00					</div>
				</div>
				<div class="post-content content">
					<p>if i set my modem as bridge, i have no access to it.</p><p>is this common? does it really matter?</p><p>if i set it on bridge, the ethernet cable should go to the routers wan port right ?</p><p>thanks!</p>											<p class="post-edited">(Last edited by <strong>alelocooo</strong> on 29 Jul 2015, 05:08)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p285402">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">drawz</div>
					<div class="post-datetime">
						29 Jul 2015, 05:30					</div>
				</div>
				<div class="post-content content">
					<p>We can help you a lot more if you tell us what device (brand, model #) you&#039;re using and with which ISP. It would also help to know how all of this is currently connected. I can&#039;t answer any of your questions without that info.</p>											<p class="post-edited">(Last edited by <strong>drawz</strong> on 29 Jul 2015, 05:30)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p285404">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">alelocooo</div>
					<div class="post-datetime">
						29 Jul 2015, 05:47					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>drawz wrote:</cite><blockquote><p>We can help you a lot more if you tell us what device (brand, model #) you&#039;re using and with which ISP. It would also help to know how all of this is currently connected. I can&#039;t answer any of your questions without that info.</p></blockquote></div><br /><p>Sure, Modem is a Cisco DPC3925. Screencaps of the tabs related to this:<br /><a href="http://i.imgur.com/tMMci9F.png">http://i.imgur.com/tMMci9F.png</a><br /><a href="http://i.imgur.com/f5PDDC8.png">http://i.imgur.com/f5PDDC8.png</a><br /><a href="http://i.imgur.com/V6hmz98.png">http://i.imgur.com/V6hmz98.png</a></p><br /><p>Router: TP-Link TL-WR941N/ND v2</p><p>I got connected an ethernet cable from the modem to the wan port of the router.<br />already installed QoS, on &quot;source hoste i must pick my public ip address&quot; right? (once i setup the modem as bridge only).<br />I got connected an ethernet cable from the modem to the wan port of the router.</p><p>Both devices with DHCP on.</p><p>Thanks!</p><p>EDIT: I think im almost there, i set the modem as bridge, wan is showing the public ip address, and i can access the router using one ip from the same range as the modem (192.168.0.11 in my case, wan is 192.168.0.10):</p><p><a href="http://i.imgur.com/YL39RBV.png">http://i.imgur.com/YL39RBV.png</a></p><p><a href="http://i.imgur.com/SJ8BFzi.png">http://i.imgur.com/SJ8BFzi.png</a></p><p>Whats next?</p><p>EDIT: heres my attempt</p><p><a href="http://i.imgur.com/e9kW9lc.png">http://i.imgur.com/e9kW9lc.png</a></p><br /><p><a href="http://i.imgur.com/U85kfgP.png">http://i.imgur.com/U85kfgP.png</a><br />I want my PC to have all the ports open + higher priority than other devices on the network. Am i doing it right?</p>											<p class="post-edited">(Last edited by <strong>alelocooo</strong> on 29 Jul 2015, 06:40)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p285407">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">drawz</div>
					<div class="post-datetime">
						29 Jul 2015, 06:28					</div>
				</div>
				<div class="post-content content">
					<p>So that Cisco device is a combination modem/router/VOIP gateway. Not sure if this will disable your VOIP (or if you use it), but you should set it up as a bridge if you want to use the OpenWrt router as a router. You are definitely getting double NAT right now, which is why your having so many problems. Everything you&#039;re doing now is just making things worse - using DMZ does not help this. Reset OpenWrt to defaults after you configure the Cisco as a bridge and then reinstall/configure QOS &amp; UPNP. </p><p>It looks like setting the Cisco to bridge is via Admin-&gt;Management-&gt;Working mode-&gt;Bridge?<br />Edit: looks like this may not be so easy. See this link: <a href="http://forums.whirlpool.net.au/archive/1809080">http://forums.whirlpool.net.au/archive/1809080</a></p><p>If you can&#039;t get it into bridge mode, just configure your OpenWrt as an access point to handle wireless and do all the port forwarding, QOS, UPNP, etc on the Cisco. This probably won&#039;t actually help you though, unless the wireless is unstable on the Cisco and that is its only problem.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p285408">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">drawz</div>
					<div class="post-datetime">
						29 Jul 2015, 06:30					</div>
				</div>
				<div class="post-content content">
					<p>The other option, which is far easier, but more expensive - buy a new cable modem that is just a modem without routing functionality. This is the typical set up when using OpenWrt.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p285409">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">alelocooo</div>
					<div class="post-datetime">
						29 Jul 2015, 06:37					</div>
				</div>
				<div class="post-content content">
					<p>But guys, i already set the cisco as bridge as i said before.</p><p>I only need to know how to set up QoS/UPNP properly. I posted screenshots.</p><p>Yes, i reset&#039;d the router a few hours ago.</p><p>On QoS: Source host is my public ip or the wan IP?<br />On Upnp: is the cfg i posted on the screenshot on my last post fine?</p><p>Thanks.</p><p>Edit: on QoS, i tried my public ip and the modems internal ip as &#039;source host&#039;, and nothing. I downloaded at top speed on both devices (i used speedtest on my pc and my cellphone at the same time and it was 50-50 (instead of 90% of the speed for my pc and 10% for the phone):<br /><a href="http://i.imgur.com/ugvTA5r.png">http://i.imgur.com/ugvTA5r.png</a></p><p>Also i got upnp configured like this:<br /><a href="http://i.imgur.com/YmKQPkY.png">http://i.imgur.com/YmKQPkY.png</a></p><p>And one last question, now that i got these two plugins, should i remove all the port forwarding rules on the &#039;firewall&#039; tab?</p><p>EDIT: I think i managed to set up correctly the UPNP (i removed everything and now the xbox shows nat Open, however, id appreciate if you know about a program so i can check if my pc has all ports open aswel).</p><p>I would need help to make QoS work. My connection is 10Mb download 1Mb upload. I want my pc to have the highest priority over everything else, i checked the openwrt wiki but i couldnt understand, and it seems like its explained for non-lucy gui servers, so id really appreciate some help. Yes i enabled/start it and rebootd the modem and still nothing <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> .</p><p>Thanks.</p>											<p class="post-edited">(Last edited by <strong>alelocooo</strong> on 29 Jul 2015, 08:26)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p285435">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">eduperez</div>
					<div class="post-datetime">
						29 Jul 2015, 11:50					</div>
				</div>
				<div class="post-content content">
					<p>Unless you want to redirect a specific port to a specific device, I would delete all forwarding rules.</p><p>Now, your UPNP is configured to allow ports 1024-65535 to computer on 192.168.0.20; if that is what you want, then it looks OK to me.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p285478">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">alelocooo</div>
					<div class="post-datetime">
						29 Jul 2015, 15:50					</div>
				</div>
				<div class="post-content content">
					<p>Yea, thanks, it seems i was able to open the ports i wanted, and in the meantime i fixed the double nat thing thanks to you guys <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" />.</p><p>However, the miniupnpd thing is an absolute disaster lol. If i do a speedtest with that turned on it shows i have 0.8mb of download bandwidth lol. Im googling a bit more about it, if it still doesnt work im removing it.</p><p>Thanks everyone for your help!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p285481">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">arokh</div>
					<div class="post-datetime">
						29 Jul 2015, 16:27					</div>
				</div>
				<div class="post-content content">
					<p>miniupnpd does nothing to affect your speed, it&#039;s merely an agent for opening ports automatically. It can however report the speed of the connection, which by default is set to 1024/512 KB (uplink/downlink) and can be configured in luci. I guess that is what your speed test is reporting.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p285525">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">drawz</div>
					<div class="post-datetime">
						29 Jul 2015, 20:50					</div>
				</div>
				<div class="post-content content">
					<p>This screenshot clearly shows you are not in bridge mode. Setting up DMZ and pointing it to your other router is not the same thing!</p><p><a href="http://i.imgur.com/f5PDDC8.png">http://i.imgur.com/f5PDDC8.png</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p285627">
				<div class="post-metadata">
					<div class="post-num">Post #21</div>
					<div class="post-author">alelocooo</div>
					<div class="post-datetime">
						30 Jul 2015, 16:33					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>arokh wrote:</cite><blockquote><p>miniupnpd does nothing to affect your speed, it&#039;s merely an agent for opening ports automatically. It can however report the speed of the connection, which by default is set to 1024/512 KB (uplink/downlink) and can be configured in luci. I guess that is what your speed test is reporting.</p></blockquote></div><p>sorry i meant the QoS plugin.</p><div class="quotebox"><cite>drawz wrote:</cite><blockquote><p>This screenshot clearly shows you are not in bridge mode. Setting up DMZ and pointing it to your other router is not the same thing!</p><p><a href="http://i.imgur.com/f5PDDC8.png">http://i.imgur.com/f5PDDC8.png</a></p></blockquote></div><p>yea as i said before i already changed that, its on bridge mode now.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p285759">
				<div class="post-metadata">
					<div class="post-num">Post #22</div>
					<div class="post-author">drawz</div>
					<div class="post-datetime">
						31 Jul 2015, 07:38					</div>
				</div>
				<div class="post-content content">
					<p>Did you reset OpenWrt to defaults? Your attempted port forwards don&#039;t help?<br />Also can you show us a screenshot of bridge mode on your Cisco modem/router?</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>