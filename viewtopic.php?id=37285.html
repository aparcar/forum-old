<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> [TL-WR841N] can&#039;t initiate 802.11n mode (can only run in 11g mode)</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 31 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p169045">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">alain13</div>
					<div class="post-datetime">
						4 Jun 2012, 16:05					</div>
				</div>
				<div class="post-content content">
					<p>I have the following resulting hostapd-phy0.conf file (from /etc/config/wireless):</p><p>ctrl_interface=/var/run/hostapd-phy0<br />driver=nl80211<br />wmm_ac_bk_cwmin=4<br />wmm_ac_bk_cwmax=10<br />wmm_ac_bk_aifs=7<br />wmm_ac_bk_txop_limit=0<br />wmm_ac_bk_acm=0<br />wmm_ac_be_aifs=3<br />wmm_ac_be_cwmin=4<br />wmm_ac_be_cwmax=10<br />wmm_ac_be_txop_limit=0<br />wmm_ac_be_acm=0<br />wmm_ac_vi_aifs=2<br />wmm_ac_vi_cwmin=3<br />wmm_ac_vi_cwmax=4<br />wmm_ac_vi_txop_limit=94<br />wmm_ac_vi_acm=0<br />wmm_ac_vo_aifs=2<br />wmm_ac_vo_cwmin=2<br />wmm_ac_vo_cwmax=3<br />wmm_ac_vo_txop_limit=47<br />wmm_ac_vo_acm=0<br />tx_queue_data3_aifs=7<br />tx_queue_data3_cwmin=15<br />tx_queue_data3_cwmax=1023<br />tx_queue_data3_burst=0<br />tx_queue_data2_aifs=3<br />tx_queue_data2_cwmin=15<br />tx_queue_data2_cwmax=63<br />tx_queue_data2_burst=0<br />tx_queue_data1_aifs=1<br />tx_queue_data1_cwmin=7<br />tx_queue_data1_cwmax=15<br />tx_queue_data1_burst=3.0<br />tx_queue_data0_aifs=1<br />tx_queue_data0_cwmin=3<br />tx_queue_data0_cwmax=7<br />tx_queue_data0_burst=1.5<br /><strong>hw_mode=a<br />channel=9</strong></p><p><strong>country_code=GB</strong><br />noscan=1</p><p>ieee80211w=0<br />require_ht=1<br />logger_syslog=127<br />logger_syslog_level=2<br />logger_stdout=127<br />logger_stdout_level=2<br /><strong>ieee80211n=1</strong><br />ht_capab=[HT40-][SHORT-GI-40][TX-STBC][RX-STBC1][DSSS_CCK-40]<br />ieee80211d=1<br />macaddr_acl=1<br />accept_mac_file=/var/run/hostapd-phy0.maclist</p><p>interface=wlan0<br />ctrl_interface=/var/run/hostapd-phy0<br />ap_isolate=1<br />auth_server_addr=10.1.1.10<br />auth_server_port=1812<br />auth_server_shared_secret=xxxx<br />acct_server_addr=10.1.1.10<br />acct_server_port=1813<br />acct_server_shared_secret=xxxx<br />nas_identifier=openwrt1<br />ieee8021x=1<br />wpa_key_mgmt=WPA-EAP<br />eapol_key_index_workaround=0<br />auth_algs=1<br />wpa=2<br />wpa_pairwise=CCMP<br />ssid=yyyy<br />bridge=br-lan<br />eapol_version=2<br />own_ip_addr=10.1.1.17<br />wmm_enabled=1<br />bssid=00:27:ab:0a:99:ef<br />ignore_broadcast_ssid=1</p><br /><p>max_num_sta=2</p><br /><p>When I try to start the router with &quot;wifi&quot; I get the following (I modified /lib/wifi/mac80211.sh to include &quot;-ddt&quot; in the hostapd command line in order see what is going on):</p><p>1338767830.397051: random: Trying to read entropy from /dev/random<br />1338767830.397851: Configuration file: /var/run/hostapd-phy0.conf<br />1338767830.399996: eapol_version=2<br />1338767830.403702: nl80211: interface wlan0 in phy phy0<br />1338767830.404268: nl80211: Set mode ifindex 469 iftype 2 (STATION)<br />1338767830.451746: netlink: Operstate: linkmode=1, operstate=5<br />1338767830.452769: nl80211: Using driver-based off-channel TX<br />1338767830.454247: nl80211: Add own interface ifindex 5<br />1338767830.454796: nl80211: Add own interface ifindex 469<br />1338767830.475184: nl80211: Set mode ifindex 469 iftype 3 (AP)<br />1338767830.476337: nl80211: Create interface iftype 6 (MONITOR)<br />1338767830.478945: nl80211: New interface mon.wlan0 created: ifindex=470<br />1338767830.479517: nl80211: Add own interface ifindex 470<br />1338767830.509250: nl80211: Adding interface wlan0 into bridge br-lan<br />1338767830.511076: BSS count 1, BSSID mask 00:00:00:00:00:00 (0 bits)<br />1338767830.511690: nl80211: Regulatory information - country=GB<br />1338767830.511759: nl80211: 2402-2482 @ 40 MHz<br />1338767830.511808: nl80211: 5170-5250 @ 40 MHz<br />1338767830.511857: nl80211: 5250-5330 @ 40 MHz<br />1338767830.511905: nl80211: 5490-5710 @ 40 MHz<br />1338767830.512016: nl80211: Added 802.11b mode based on 802.11g information<br />1338767830.512057: Allowed channel: mode=1 chan=1 freq=2412 MHz max_tx_power=20 dBm<br />1338767830.512112: Allowed channel: mode=1 chan=2 freq=2417 MHz max_tx_power=20 dBm<br />1338767830.512166: Allowed channel: mode=1 chan=3 freq=2422 MHz max_tx_power=20 dBm<br />1338767830.512219: Allowed channel: mode=1 chan=4 freq=2427 MHz max_tx_power=20 dBm<br />1338767830.512273: Allowed channel: mode=1 chan=5 freq=2432 MHz max_tx_power=20 dBm<br />1338767830.512326: Allowed channel: mode=1 chan=6 freq=2437 MHz max_tx_power=20 dBm<br />1338767830.512381: Allowed channel: mode=1 chan=7 freq=2442 MHz max_tx_power=20 dBm<br />1338767830.512435: Allowed channel: mode=1 chan=8 freq=2447 MHz max_tx_power=20 dBm<br />1338767830.512489: Allowed channel: mode=1 chan=9 freq=2452 MHz max_tx_power=20 dBm<br />1338767830.512543: Allowed channel: mode=1 chan=10 freq=2457 MHz max_tx_power=20 dBm<br />1338767830.512597: Allowed channel: mode=1 chan=11 freq=2462 MHz max_tx_power=20 dBm<br />1338767830.512651: Allowed channel: mode=0 chan=1 freq=2412 MHz max_tx_power=20 dBm<br />1338767830.512706: Allowed channel: mode=0 chan=2 freq=2417 MHz max_tx_power=20 dBm<br />1338767830.512759: Allowed channel: mode=0 chan=3 freq=2422 MHz max_tx_power=20 dBm<br />1338767830.512813: Allowed channel: mode=0 chan=4 freq=2427 MHz max_tx_power=20 dBm<br />1338767830.512867: Allowed channel: mode=0 chan=5 freq=2432 MHz max_tx_power=20 dBm<br />1338767830.512920: Allowed channel: mode=0 chan=6 freq=2437 MHz max_tx_power=20 dBm<br />1338767830.512975: Allowed channel: mode=0 chan=7 freq=2442 MHz max_tx_power=20 dBm<br />1338767830.513028: Allowed channel: mode=0 chan=8 freq=2447 MHz max_tx_power=20 dBm<br />1338767830.513082: Allowed channel: mode=0 chan=9 freq=2452 MHz max_tx_power=20 dBm<br />1338767830.513136: Allowed channel: mode=0 chan=10 freq=2457 MHz max_tx_power=20 dBm<br />1338767830.513191: Allowed channel: mode=0 chan=11 freq=2462 MHz max_tx_power=20 dBm<br /><strong>1338767830.513247: Hardware does not support configured mode<br />1338767830.513347: wlan0: IEEE 802.11 Hardware does not support configured mode (2) (hw_mode in hostapd.conf)<br />1338767830.513716: Could not select hw_mode and channel. (-2)<br />1338767830.513773: wlan0: Unable to setup interface.</strong><br />1338767830.513822: Flushing old station entries<br />1338767830.516292: Deauthenticate all stations<br />rmdir[ctrl_interface]: No such file or directory<br />1338767830.528479: nl80211: Remove interface ifindex=470<br />1338767830.798671: netlink: Operstate: linkmode=0, operstate=6<br />1338767830.807058: nl80211: Set mode ifindex 469 iftype 2 (STATION)<br />Failed to start hostapd for phy0</p><br /><p>My hw_mode is set as &quot;11na&quot; in order to select the 5GHz band and run in .11n mode. What am I doing wrong?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p169051">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">vargalex</div>
					<div class="post-datetime">
						4 Jun 2012, 17:00					</div>
				</div>
				<div class="post-content content">
					<p>Hi!</p><p>The TL-WR841 has no 5 GHz radio, so the right hw_mode is <strong>11ng</strong>.</p><p>vargalex</p>											<p class="post-edited">(Last edited by <strong>vargalex</strong> on 5 Jun 2012, 10:09)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p169081">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">alain13</div>
					<div class="post-datetime">
						4 Jun 2012, 21:09					</div>
				</div>
				<div class="post-content content">
					<p>Thanks vargalex! </p><p>I was under the impression that the 802.11n mode (which my router &quot;claims&quot; to comply with) also runs in the 5GHz range. I see that the only range I could operate in is the 2.4GHz range. How am I supposed to (legally) achieve the advertised speed of 300Mbps then?</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>