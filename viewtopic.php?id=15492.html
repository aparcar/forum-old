<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Atheros AR2316 - wireless radio config missing</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 19 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p67571">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">zinbatsu</div>
					<div class="post-datetime">
						29 Apr 2008, 01:44					</div>
				</div>
				<div class="post-content content">
					<p>Hi all!</p><p>I just found my old (SMC WBR14T-G) router again and decided to try putting OpenWRT on it.<br />The device has 16 MB of RAM, Atheros AR2316 WiSoC, almost identical to what is found here:<br /><a href="http://wiki.openwrt.org/OpenWrtDocs/Hardware/Siemens/SE551">http://wiki.openwrt.org/OpenWrtDocs/Har â€¦ mens/SE551</a></p><p>(the only problem is that the flash is only 2 MB, so i&#039;ll probably use RedBoot with network booting...)<br />I downloaded kamikaze from SVN, changed start address from 0x80041000 to 0x80001000 and the serial port baud rate to 115200, compiled the kernel with built-in jffs2 and uploaded the vmlinux image to memory via serial interface (it uses arcadyan&#039;s bootloader)</p><div class="codebox"><pre><code>ar531xPlus rev 0x00000087 boot loader startup...                                                
Flash initialized                 
SDRAM initialized                 
Cache initialized                 

Copy program from 0xbfc00000 to 0x80520000, length 0x0000c56c bytes ... done                                                                            
Jump to SDRAM 0x80520cb4 [0x10000008, 0x00000000, 0x00000000]                                                             
Clear BSS section ... done                          
Stack: 0x8053e390                 
Heap: 0x8053e3a0                



==================================================================                                                                  
 Wireless Gateway WG4005E Loader V0.03 build Mar 29 2005 15:25:28                                                                 
                  Arcadyan Technology Corporation                                                 
==================================================================                                                                  

Flash Found. It is 2MB Flash....                                

Copying boot params.....DONE                            
cpuFreq=240000000 sysFreq=60000000 cntFreq=120000000                                                    

Press any key to enter command mode ...                                       

[WG4005E Boot]:m                

RAM upload destination: (default:0x80001000) : 0x                                                 
Starting XModem download...(press Enter to abort)                                                 
CCCCCCC       
Done!     
Do you want to execute the uploaded code? (Y/n) Linux version 2.6.23.16 (                                                                                
norb@bt) (gcc version 4.1.2) #16 Sat Apr 26 20:48:21 GMT 2008                                                             
CPU revision is: 000                  
Determined physical RAM map:                            
 memory: 01000000 @ 00000000 (usable)                                     
Built 1 zonelists in Zone order.  Total pages: 4064                                                   
Kernel command line: console=ttyS0,115200 rootfstype=squashfs,jffs2 init=/etc/pr                                                                                
einit     
Primary instruction cache 16kB, physically tagged, 4-way, linesize 16 bytes.                                                                            
Primary data cache 16kB, 4-way, linesize 16 bytes.                                                  
Synthesized TLB refill handler (20 instructions).                                                 
Synthesized TLB load handler fastpath (32 instructions).                                                        
Synthesized TLB store handler fastpath (32 instructions).                                                         
Synthesized TLB modify handler fastpath (31 instructions).                                                          
PID hash table entries: 64 (order: 6, 256 bytes)                                                
Using 92.000 MHz high precision timer.                                      
console [ttyS0] enabled                       
Dentry cache hash table entries: 2048 (order: 1, 8192 bytes)                                                            
Inode-cache hash table entries: 1024 (order: 0, 4096 bytes)                                                           
Memory: 14832k/16384k available (1006k kernel code, 1552k reserved, 197k data, 8                                                                                
0k init, 0k highmem)                    
Mount-cache hash table entries: 512                                   
NET: Registered protocol family 16                                  
WARNING: No board configuration data found!                                           
Time: MIPS clocksource has been installed.                                          
ar531x: Registering GPIODEV device                                  
CPU 0 Unable to handle kernel paging request at virtual address 00000050, epc ==                                                                                
 8012f900, ra == 8012e780                         
Oops[#1]:         
Cpu 0     
$ 0   : 00000000 10008400 80140000 80140000                                           
$ 4   : ffff8af2 00000000 000000b8 801017ec                                           
$ 8   : ffffffff fffffffc 00000001 00000000                                           
$12   : 80150000 80150000 fff7ffff 00200200                                           
$16   : 00000000 00000000 8014100c 00000000                                           
$20   : fffffffe 00000000 00000000 00000000                                           
$24   : 00000000 800c57cc                         
$28   : 80188000 80189f38 80                          
Hi    : 0000005b                
Lo    : c01e0000                
epc   : 8012f900 ar531x_init_reset+0x28/0x5c     Not tainted
ra    : 8012e780 kernel_init+0xbc/0x328
Status: 10008403    KERNEL EXL IE
Cause : 30800008
BadVA : 00000050
PrId  : 00019064
Modules linked in:
Process swapper (pid: 1, threadinfo=80188000, task=80187568)
Stack : 8012f568 8012f4e0 00000000 8012b31c 8012b2e0 000001bf 8012e780 8012e780
        00000000 8012e6c4 00000000 00000000 00000000 00000000 00000000 00000000
        00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
        00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
        00000000 00000000 00000000 80005454 10008403 00000000 00000000 00000000
        ...
Call Trace:
[&lt;8012f900&gt;] ar531x_init_reset+0x28/0x5c
[&lt;8012e780&gt;] kernel_init+0xbc/0x328
[&lt;80005454&gt;] kernel_thread_helper+0x10/0x18


Code: 3c038014  ac652074  ac442078 &lt;94a40050&gt; 3c078011  3c058000  24840030  24a5
1c90  24e72a24
Kernel panic - not syncing: Attempted to kill init!</code></pre></div><p>It seems that the flash does not contain atheros board config... i downloaded the whole 2MB flash and searched for the pattern 0x35333131 but found nothing, so i made an ugly hack and modified arch/mips/atheros/board.c and added a static board config, similar to the one here:<br /><a href="http://wiki.openwrt.org/WingedUnicorn">http://wiki.openwrt.org/WingedUnicorn</a></p><p>I also modified spiflash.c and added 5 static partitions.<br />Now everything works, except the wireless interface <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /><br /></p><div class="codebox"><pre><code>wlan: trunk
ath_hal: module license &#039;Proprietary&#039; taints kernel.
ath_hal: 0.9.30.13 (AR5212, AR5312, RF2316, TX_DESC_SWAP)
ath_rate_minstrel: Minstrel automatic rate control algorithm 1.2 (trunk)
ath_rate_minstrel: look around rate set to 10%
ath_rate_minstrel: EWMA rolloff level set to 75%
ath_rate_minstrel: max segment size in the mrr set to 6000 us
wlan: mac acl policy registered
ath_ahb: trunk
MadWifi: unable to attach hardware: &#039;EEPROM checksum invalid&#039; (HAL status 7)</code></pre></div><p>Since the Atheros HAL is not open source, i can&#039;t make a radio config structure the way i made the board config.<br />I tried to find radio config in the &quot;Params Area&quot; partition of the flash, but the whole partition is filled with 0xff bytes, except a small part of about 60 bytes which contain information for the bootloader. Maybe I missed something.</p><p>Is there any way i can make my wireless interfaces work?<br />BTW i heard that board config has gone missing in almost all ar2316 devices, but radio config is present in some of them. I&#039;d be grateful if someone could send me his/her &quot;params area&quot; flash partition (i think D-Link DI624 has radio params in its flash ROM)</p><p>Thank you for your effort.</p>											<p class="post-edited">(Last edited by <strong>zinbatsu</strong> on 29 Apr 2008, 01:45)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p69851">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">yoonix</div>
					<div class="post-datetime">
						19 Jun 2008, 22:48					</div>
				</div>
				<div class="post-content content">
					<p>I have a similar problem with the wireless configuration.<br />How did you resolve it?</p><p>I am getting &#039;EEPROM version invalid&#039; (HAL status 5)</p>											<p class="post-edited">(Last edited by <strong>yoonix</strong> on 27 Jun 2008, 22:28)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p69976">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">zinbatsu</div>
					<div class="post-datetime">
						23 Jun 2008, 20:52					</div>
				</div>
				<div class="post-content content">
					<p>As a matter of fact I&#039;m still looking for a fix... however i didn&#039;t check the output of ath_info so i&#039;ll give it a try. Afer all i didn&#039;t change anything in the madwifi code, only board config &amp; MTD partitions, the wireless config pointer in the kernel was initially NULL, which caused kernel panic so I allocated a 0x100 bytes buffer and filled it with zeroes.<br />This is how i got the &#039;EEPROM checksum invalid&#039; error. Now i have a lot of free time (end of final exams etc.) so i&#039;ll probably compile a new kernel from trunk, patch it and check if anything changed (saw a few atheros-related fixes in the changelog).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p69977">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">Kaloz</div>
					<div class="post-datetime">
						23 Jun 2008, 21:04					</div>
				</div>
				<div class="post-content content">
					<p>Your board doesn&#039;t use RedBoot, so the board config is probably is in vxwork&#039;s format.. When you flash redboot to such a board, it modifies/moves the board data to the format the Linux drivers use, too.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p69980">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">zinbatsu</div>
					<div class="post-datetime">
						23 Jun 2008, 23:39					</div>
				</div>
				<div class="post-content content">
					<p>thanks for the info <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /><br />i&#039;ll try putting RedBoot on it then</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p70002">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">yoonix</div>
					<div class="post-datetime">
						24 Jun 2008, 19:24					</div>
				</div>
				<div class="post-content content">
					<p>GOOD NEWS!! </p><p>I got the wifi0 created in /proc/sys/dev/.<br />It is not fully configured. But ath_ahb gets loaded without any error!</p><p>I loaded DDWRT Redboot for WR430W onto my moded WBR1310 (DI614 or something). After that I issued command &quot;bdrestore&quot;. That wiped out my fis info but created the last sector with somewhat proper configuration. I issued bunch of fis commands to recreate the fis directory. </p><p>After that voila my wifi device was loaded without any error.</p><p>I am cut and past-ing my binary file (first so many bytes of the last sector) because I don&#039;t know how to include files on this forum. If you need the binary configuration file let me know.</p><br /><br /><p>Let me know how things work out for you!</p><div class="codebox"><pre><code>0000000 3335 3131 7d13 0400 7441 6568 6f72 2073
0000010 5241 3335 3531 6420 6665 7561 746c 0000
0000020 0000 0000 0000 0000 0000 0000 0000 0000
*
0000040 0000 0000 0000 0000 0100 0000 0000 3902
0000050 0600 0700 f70a 009e 7b05 00cf 7b05 00cf
0000060 1900 d75b 2e55 1900 d75b 2f55 8000 53c8
0000070 0211 1300 0000 8000 53c8 0411 ffff ffff
0000080 ffff ffff ffff ffff ffff ffff ffff ffff
*
00000f0 ffff ffff ffff ffff 1c00 8c16 0002 0100
0000100 0000 0150 0000 62a0 8c16 0a1c 0001 0000
0000110 c201 0200 06c6 0100 0000 0000 0000 0000
0000120 0000 0000 0000 0000 0000 0000 0000 0000
0000130 0000 ebf1 be7f 0300 0000 0000 0000 0000
0000140 0000 0000 0000 0000 0000 0000 0000 0000
*
0000170 0000 a55a 0000 0000 1303 4349 5320 0471
0000180 0212 0004 0603 0100 0000 0005 0e41 b139
0000190 b51e 2d4e 5630 ffff 02e9 0007 0601 0000
00001a0 0001 0015 5207 0141 7468 6572 6f73 2043
00001b0 6f6d 6d75 6e69 6361 7469 6f6e 732c 2049
00001c0 6e63 2e00 4152 3530 3031 2d30 3030 302d
00001d0 3030 3030 0057 6972 656c 6573 7320 4c41
00001e0 4e20 5265 6665 7265 6e63 6520 4361 7264
00001f0 0030 3000 ff00 0021 0206 0122 0502 808d
0000200 5b00 2205 0240 5489 0022 0502 001b b700
0000210 2205 0280 a812 0122 0502 0036 6e01 2205
0000220 0200 5125 0222 0502 006c dc02 2205 0280
0000230 f937 0322 0502 00a2 4a04 2202 0308 2208
0000240 0406 f1eb 7fbe 0003 2202 0501 ff00 0000
0000250 0000 0000 0000 0000 ffff ffff ffff ffff
0000260 ffff ffff ffff ffff ffff ffff ffff ffff
0000270 ffff ffff ffff 0000 2b7c 0350 6ea2 0100
0000280 dc81 8201 ff02 ffe8 a315 0500 0000 0000
0000290 0000 0000 0000 0000 0000 0000 0000 0000
00002a0 2c2d 0000 0000 0000 0000 28e0 92a4 001c
00002b0 0e00 cab8 1300 0000 f808 4b6b 59c0 7115
00002c0 0000 0000 0000 0000 0000 0000 0000 0000
00002d0 0000 0000 0000 0000 0000 0000 3431 6700
00002e0 389e 9ac1 a268 45da 1c00 0700 ffb0 9501
00002f0 0000 0000 70ff ff31 0000 0000 0000 0000
0000300 0000 0000 0000 0000 0000 0000 0000 0000
0000310 0000 205f 6700 389e 9ac1 a268 45da 1c00
0000320 0e00 ffb0 9521 0000 d82f 70ff 2611 ff37
0000330 8000 0164 8607 8705 0000 0000 0000 0000
0000340 0000 0000 0000 0000 1211 4114 3142 3432
0000350 0000 0000 0000 0000 0000 0000 0000 0000
0000360 0000 0000 0000 0000 0080 0000 0000 0000
0000370 0000 7805 0807 6806 0080 0000 0000 0000
0000380 0000 0000 0000 0000 0000 0000 0000 0000
0000390 0000 0000 0000 0000 314d 547f 933c 0512
00003a0 3119 2d49 507f 933c 010e 2d19 708e ac00
00003b0 0090 431e 092a 021e 85d4 5212 0080 4226
00003c0 f929 0226 8514 5313 0080 4426 69aa 022e
00003d0 9514 4313 708e ac00 0080 432a 97a8 4209
00003e0 765c 831a 0080 451a 0729 4309 655c 6316
00003f0 0080 462e f628 4311 5420 5416 0000 0000
0000400 0000 0000 0000 0000 0000 0000 0000 0000
0000410 0000 0000 0000 0000 0000 0000 8a70 a228
0000420 8aa7 a228 8a70 9c07 8a89 9c07 8aa7 9c07
0000430 7570 00a2 0000 0000 6626 0066 0000 0000
0000440 8970 00a2 0000 0000 6621 0061 0000 0000
0000450 8989 0000 0000 0000 2626 0000 0000 0000
0000460 7570 aca2 00b8 0000 6828 2828 0028 0000
0000470 7570 aca2 0000 0000 6828 2828 0000 0000
0000480 7570 00ac 0000 0000 6424 0024 0000 0000
0000490 7570 00ac 0000 0000 5e1e 001e 0000 0000
00004a0 8989 0000 0000 0000 2020 0000 0000 0000
00004b0 0000 ffff ffff ffff ffff ffff ffff ffff
00004c0 ffff ffff ffff ffff ffff ffff ffff ffff</code></pre></div>											<p class="post-edited">(Last edited by <strong>yoonix</strong> on 24 Jun 2008, 21:10)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p70012">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">zinbatsu</div>
					<div class="post-datetime">
						24 Jun 2008, 23:22					</div>
				</div>
				<div class="post-content content">
					<p>hmm... uploaded RedBoot (ap61.rom) to the flash via the original bootloader (effectively overwriting it), but it doesn&#039;t seem to work <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><p>when i power on the router it sends a few characters of garbage on serial port, and that&#039;s all (baudrate 38400 [default], parity none, databits 8, stopbits 1, that&#039;s the default RedBoot config if i remember well; tried other configurations as well, but no luck so far). ethernet ports don&#039;t get initialised so telnet is not an option. <br />i&#039;ll build a simple unbuffered jtag cable tomorrow and see if i can get it to work.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p70014">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">yoonix</div>
					<div class="post-datetime">
						24 Jun 2008, 23:37					</div>
				</div>
				<div class="post-content content">
					<p>It&#039;s 9600 baud not 38600.</p><p>I just put up a website for debricking your box.</p><p><a href="http://wiki.openwrt.org/yoonix#preview">http://wiki.openwrt.org/yoonix#preview</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p70016">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">zinbatsu</div>
					<div class="post-datetime">
						24 Jun 2008, 23:54					</div>
				</div>
				<div class="post-content content">
					<p>thanks for the help <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>unfortunately, the serial output is still not readable on 9600 baud (tried all possible baudrates and played a bit with parity and databits, no success)</p><p>i&#039;ll buy the required stuff tomorrow (both for buffered and unbuffered cables)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p70018">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">zinbatsu</div>
					<div class="post-datetime">
						25 Jun 2008, 00:00					</div>
				</div>
				<div class="post-content content">
					<p>no problem <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>There&#039;s 14-pin connector-like thing that seems to be the JTAG connector. I measured some voltages, seems to be a standard 2.5 EJTAG conector, which makes the job a lot easier.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p70068">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">zinbatsu</div>
					<div class="post-datetime">
						25 Jun 2008, 19:07					</div>
				</div>
				<div class="post-content content">
					<p>doesnt seem to work <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><p>connected the unbuffered EJTAG cable, powered on router, tried to probe flash<br />it says<br /></p><div class="codebox"><pre><code>Probing bus ... Done

Instruction Length set to 4

CPU Chip ID: 11111111111111111111111111111111 (FFFFFF)
*** Unknown or NO CPU Chip ID Detected ***</code></pre></div><p>BTW Is it normal that all the pins on the board which are actually connected (GND, TDI, TDO, TM, TCK, TRST_N) except SRST_N have -3.3V present?</p><p>This is how i connected them:<br /></p><div class="codebox"><pre><code> (-3.3v present) TRST_N | GND  &lt;-&gt; Parport 18-25
 Parport 2   &lt;-&gt;    TDI | GND  &lt;-&gt; Parport 18-25
 Parport 13  &lt;-&gt;    TDO | GND  &lt;-&gt; Parport 18-25
 Parport 4   &lt;-&gt;    TMS | GND  &lt;-&gt; Parport 18-25
 Parport 3   &lt;-&gt;    TCK | GND  &lt;-&gt; Parport 18-25
 (connected)     SRST_N | ??? (unused)
 (unused)          DINT | VCC (+3.3v present)</code></pre></div><p>(i used 100 ohm resistors everywhere except for GND pins)</p><p>Before bootloader was overwritten, i checked the SRST_N pin and it actually restarted the bootloader (so it worked).</p><p>Another idea popped in my head ...<br />what happens if an exception occurs and no hander is installed, or another exception occurs while processing the exception on MIPS? (x86 CPUs usually halt)<br />does EJTAG work if the processor is in halted state? (if such a state exists)</p>											<p class="post-edited">(Last edited by <strong>zinbatsu</strong> on 25 Jun 2008, 19:11)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p70069">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">yoonix</div>
					<div class="post-datetime">
						25 Jun 2008, 20:05					</div>
				</div>
				<div class="post-content content">
					<p>When you program the flash using ejtag. The processor actually goes to debug state and you are already at the exception state.</p><p>There is a way to disable additional exceptions as well by writing different status to your JTAG controller register.</p><p>You can go to mips site and register to get the full documetations. I did add a new function that comes out of exception and resets. I got most of information from one of the mips document that&#039;s circulating on internet.</p><p>The reason I liked the tjtag code was it&#039;s quite simple. It&#039;s pretty much a single source file.<br />You can easily track down to the section where you want to make mods.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p70071">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">zinbatsu</div>
					<div class="post-datetime">
						25 Jun 2008, 20:11					</div>
				</div>
				<div class="post-content content">
					<p>the pinout i posted and the cable i use is the Xilinx one. I&#039;ll go and check out the documentation maybe it helps <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p70073">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">yoonix</div>
					<div class="post-datetime">
						25 Jun 2008, 20:47					</div>
				</div>
				<div class="post-content content">
					<p>Yup that looks correct actually.... Try to ground the TRST_N? I am not sure.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p70074">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">zinbatsu</div>
					<div class="post-datetime">
						25 Jun 2008, 20:52					</div>
				</div>
				<div class="post-content content">
					<p>There is already -3.3V present on TRST_N so grounding it won&#039;t affect anything <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /><br />That&#039;s my main problem, that it simply shouldn&#039;t be there, it should be 0V in theory.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p70076">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">zinbatsu</div>
					<div class="post-datetime">
						25 Jun 2008, 21:11					</div>
				</div>
				<div class="post-content content">
					<p>it&#039;s about 10 cm<br />however, i grounded the TRST_N pin and now there is 0V on TDI, TDO, TMS and TCK, now it says CPU Chip ID: 00000000000000000000000000000000 (000000), and still not working <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p70077">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">yoonix</div>
					<div class="post-datetime">
						25 Jun 2008, 21:12					</div>
				</div>
				<div class="post-content content">
					<p>maybe just 1k ohm resister and ground TRST_N? Hmm.. in theory it should be okay for the hardware.<br />you didn&#039;t short to ground did you? that may bring other pins to ground as well.. potentially.</p>											<p class="post-edited">(Last edited by <strong>yoonix</strong> on 25 Jun 2008, 21:14)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p70078">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">zinbatsu</div>
					<div class="post-datetime">
						25 Jun 2008, 21:19					</div>
				</div>
				<div class="post-content content">
					<p>ofc not... i found something weird again... after grounding TRST_N, +3.3V is present on SRST_N pin <img src="https://forum.openwrt.org/img/smilies/yikes.png" width="15" height="15" alt="yikes" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p70081">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">zinbatsu</div>
					<div class="post-datetime">
						25 Jun 2008, 21:34					</div>
				</div>
				<div class="post-content content">
					<p>I got it to work!<br />Connected TRST_N to VCC instead of GND, and it works!</p><p>CPU Chip ID: 0000000000000000000000000000001 (00000001)<br />*** Found a Atheros A531X/231X CPU Chip ***</p><p>It is now probing the flash <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>VENDID-B 0x00000020<br />DEVID-B 0x00002015<br />-&gt; 2 MB flash, 64 kbyte blocks</p><p>Now i&#039;ll make a backup and see if it really contains RedBoot</p>											<p class="post-edited">(Last edited by <strong>zinbatsu</strong> on 25 Jun 2008, 22:06)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p70084">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">yoonix</div>
					<div class="post-datetime">
						25 Jun 2008, 22:30					</div>
				</div>
				<div class="post-content content">
					<p>Awesome!!!</p><p>Look at my read me file. You have to add the chip support for it.</p><p>Then you should be able to program redboot onto it.</p><p>Good luck.</p><p>You might want to consider installing wbr1310 redboot. It uses only 2 blocks.<br />The ddwrt one uses 3 blocks of your flash.</p><p>But if you have jtag you can pretty much flash anything you want.. It&#039;s a good news... How long did it take you? It took me forever to get that jtag working. I am not much of hardware person.</p>											<p class="post-edited">(Last edited by <strong>yoonix</strong> on 25 Jun 2008, 22:43)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p70086">
				<div class="post-metadata">
					<div class="post-num">Post #21</div>
					<div class="post-author">zinbatsu</div>
					<div class="post-datetime">
						25 Jun 2008, 22:48					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for the help <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Added to the chip list and backup is now running. Initial binary comparison shows that the image at the start of the flash is indeed RedBoot (exact match), so RedBoot image is intact.&nbsp; hmm.....</p><div class="codebox"><pre><code>    { 0x0020, 0x2015, size2MB, CMD_TYPE_SPI, &quot;ST 25P16V6P                (2MB)&quot;   ,32,size64K,   0,0,    0,0,  0,0 },</code></pre></div><p>Anyway, if it won&#039;t work I&#039;ll copy the bootloader from the other router to this one.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p70087">
				<div class="post-metadata">
					<div class="post-num">Post #22</div>
					<div class="post-author">yoonix</div>
					<div class="post-datetime">
						25 Jun 2008, 22:53					</div>
				</div>
				<div class="post-content content">
					<p>Ya I also realized that you are using 2316. I was using 2317. At least now we know how to use spi bus with flash chips over the jtag. It was lacking in open wrt.&nbsp; Now we have an easier dirtyhairy code for all spi chips instead of that ejtag code. I looked at ejtag stuff it was impossible to debug or find out where i want change. </p><p>Another thing now you have jtag working. You can even pick up 5$ flash chip from digikey and get upto 4meg or 8meg. I actually don&#039;t recommend 8meg.. </p><p>The flash addresses has to change with 8meg and it becomes pain in neck to double check the kernel and redboot code to support 8meg.</p>											<p class="post-edited">(Last edited by <strong>yoonix</strong> on 25 Jun 2008, 23:06)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p70088">
				<div class="post-metadata">
					<div class="post-num">Post #23</div>
					<div class="post-author">zinbatsu</div>
					<div class="post-datetime">
						25 Jun 2008, 22:59					</div>
				</div>
				<div class="post-content content">
					<p>Well, the one i&#039;m currently experimenting with is an ar2317 one. I couldn&#039;t find the EJTAG port for the 2316, and I won&#039;t risk uploading a new bootloader till i find it <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Anyway, I&#039;ll reflash redboot and probably upload NVRAM and see if it works</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p70089">
				<div class="post-metadata">
					<div class="post-num">Post #24</div>
					<div class="post-author">yoonix</div>
					<div class="post-datetime">
						25 Jun 2008, 23:22					</div>
				</div>
				<div class="post-content content">
					<p>Well after this one is working, can you try and see if you can use tjtagspi on 2316 just program like the middle of the block using custom flag.. so you can get your kernel back.</p><p>Just to see if it works or not.</p><p>Hmm if it&#039;s ar2317 i am not sure why it didn&#039;t boot up.. strange..</p><p>AH it is possible that the boot load needs your flash chip support as well.&nbsp; I know you can down load ddwrt redboot source code but I couldn&#039;t compile it.. If you try like svn co on ddwrt it takes pretty much over 5 hours getting every different flavour of kernel source code.</p>											<p class="post-edited">(Last edited by <strong>yoonix</strong> on 25 Jun 2008, 23:24)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p70090">
				<div class="post-metadata">
					<div class="post-num">Post #25</div>
					<div class="post-author">zinbatsu</div>
					<div class="post-datetime">
						25 Jun 2008, 23:40					</div>
				</div>
				<div class="post-content content">
					<p>Err... i bricked the 2317 one, the 2316 still has the original bootloader and firmware,the bootloader allows me to upload the kernel into memory, so i won&#039;t screw up the flash (and that router is in use atm), however to access the bootloader one still needs a serial console and a rs232-ttl converter. For me, both devices have pretty much the same loader, Arcadyan-BRN mixed stuff.</p><p>I&#039;ll build a RedBoot from dd-wrt trunk if it works <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>I&#039;ll create a page for it on the wiki if i can make it work ...</p>											<p class="post-edited">(Last edited by <strong>zinbatsu</strong> on 25 Jun 2008, 23:41)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>