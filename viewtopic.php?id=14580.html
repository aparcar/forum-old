<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Error using Dansguardian on WRT54GL</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 17 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p63728">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">ridius</div>
					<div class="post-datetime">
						19 Feb 2008, 23:21					</div>
				</div>
				<div class="post-content content">
					<p>Hello All,</p><p>I only saw two posts here on my problem and neither helped me solve. I&#039;m trying to use TinyProxy and Dansguardian on my WRT54GL with Kamikaze (7.09). I successfully installed (and am able to use) TinyProxy. I also installed Dansguardian using the packetprotector package at <a href="http://packetprotector.org/download/kamikaze/dansguardian_2.9.9.2-2_mipsel.ipk">http://packetprotector.org/download/kam â€¦ mipsel.ipk</a>. But whenever I start Dansguardian, I get the following error: </p><div class="codebox"><pre><code>root@OpenWrt:~# dansguardian
Error opening filter group config: /etc/dansguardian/dansguardianf1.conf
Error reading filter group conf file(s).
Error parsing the dansguardian.conf file or other DansGuardian configuration files
root@OpenWrt:~#</code></pre></div><p>I&#039;ve noticed on another thread that someone had a similar issue that was related to memory, but I&#039;m not receiving the memory error that that person was.</p><p>Any idea&#039;s?</p><p>Thanks in advance,</p><p>Ridius</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p63748">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">ridius</div>
					<div class="post-datetime">
						20 Feb 2008, 10:40					</div>
				</div>
				<div class="post-content content">
					<p>Just to be a little more proactive, I did an strace on Dansguardian and here&#039;s what it came back with (at least, the last 75 lines of what it came back with):<br /></p><div class="codebox"><pre><code>stat(&quot;/etc/dansguardian/lists/phraselists/badwords/weighted_spanish&quot;, {st_mode=S_IFREG|0644, st_size=1108, ...}) = 0
open(&quot;/etc/TZ&quot;, O_RDONLY)               = -1 ENOENT (No such file or directory)
open(&quot;/etc/dansguardian/lists/phraselists/badwords/weighted_spanish&quot;, O_RDONLY) = 8
ioctl(8, TIOCNXCL, 0x7fff70e0)          = -1 ENOTTY (Inappropriate ioctl for device)
read(8, &quot;#\n# Spanish Swear Words Weighted&quot;..., 4095) = 1108
read(8, &quot;&quot;, 4095)                       = 0
close(8)                                = 0
read(7, &quot;weighted&gt;\n#.Include&lt;/etc/dansgua&quot;..., 4095) = 2028
stat(&quot;/etc/dansguardian/lists/phraselists/malware/weighted&quot;, {st_mode=S_IFREG|0644, st_size=2345, ...}) = 0
stat(&quot;/etc/dansguardian/lists/phraselists/malware/weighted&quot;, {st_mode=S_IFREG|0644, st_size=2345, ...}) = 0
open(&quot;/etc/TZ&quot;, O_RDONLY)               = -1 ENOENT (No such file or directory)
open(&quot;/etc/dansguardian/lists/phraselists/malware/weighted&quot;, O_RDONLY) = 8
ioctl(8, TIOCNXCL, 0x7fff70e0)          = -1 ENOTTY (Inappropriate ioctl for device)
read(8, &quot;#\n# Phraselists to block malware&quot;..., 4095) = 2345
read(8, &quot;&quot;, 4095)                       = 0
close(8)                                = 0
stat(&quot;/etc/dansguardian/lists/phraselists/proxies/weighted&quot;, {st_mode=S_IFREG|0644, st_size=2287, ...}) = 0
stat(&quot;/etc/dansguardian/lists/phraselists/proxies/weighted&quot;, {st_mode=S_IFREG|0644, st_size=2287, ...}) = 0
open(&quot;/etc/TZ&quot;, O_RDONLY)               = -1 ENOENT (No such file or directory)
open(&quot;/etc/dansguardian/lists/phraselists/proxies/weighted&quot;, O_RDONLY) = 8
ioctl(8, TIOCNXCL, 0x7fff70e0)          = -1 ENOTTY (Inappropriate ioctl for device)
read(8, &quot;#\n# Phraselists to block web-bas&quot;..., 4095) = 2287
read(8, &quot;&quot;, 4095)                       = 0
close(8)                                = 0
stat(&quot;/etc/dansguardian/lists/phraselists/warezhacking/weighted&quot;, {st_mode=S_IFREG|0644, st_size=490, ...}) = 0
stat(&quot;/etc/dansguardian/lists/phraselists/warezhacking/weighted&quot;, {st_mode=S_IFREG|0644, st_size=490, ...}) = 0
open(&quot;/etc/TZ&quot;, O_RDONLY)               = -1 ENOENT (No such file or directory)
open(&quot;/etc/dansguardian/lists/phraselists/warezhacking/weighted&quot;, O_RDONLY) = 8
ioctl(8, TIOCNXCL, 0x7fff70e0)          = -1 ENOTTY (Inappropriate ioctl for device)
read(8, &quot;#listcategory: \&quot;Warez\&quot;\n\n&lt;crackin&quot;..., 4095) = 490
read(8, &quot;&quot;, 4095)                       = 0
close(8)                                = 0
read(7, &quot;&quot;, 4095)                       = 0
close(7)                                = 0
old_mmap(NULL, 7954432, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, 0, 0) = -1 ENOMEM (Cannot allocate memory)
brk(0xdaa000)                           = 0x622000
old_mmap(NULL, 7954432, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, 0, 0) = -1 ENOMEM (Cannot allocate memory)
rt_sigaction(SIGPIPE, {SIG_DFL}, {SIG_DFL}, 16) = 0
socket(PF_FILE, SOCK_DGRAM, 0)          = 7
connect(7, {sa_family=AF_FILE, path=&quot;/dev/log&quot;}, 10) = 0
time([946712213])                       = 946712213
open(&quot;/etc/TZ&quot;, O_RDONLY)               = -1 ENOENT (No such file or directory)
getpid()                                = 878
write(7, &quot;&lt;11&gt;Jan  1 07:36:53 dansguardian&quot;..., 102) = 102
rt_sigaction(SIGPIPE, {SIG_DFL}, NULL, 16) = 0
write(2, &quot;Error opening filter group confi&quot;..., 35) = 35
write(2, &quot;/etc/dansguardian/dansguardianf1&quot;..., 37) = 37
write(2, &quot;\n&quot;, 1)                       = 1
rt_sigaction(SIGPIPE, {SIG_DFL}, {SIG_DFL}, 16) = 0
time([946712213])                       = 946712213
open(&quot;/etc/TZ&quot;, O_RDONLY)               = -1 ENOENT (No such file or directory)
getpid()                                = 878
write(7, &quot;&lt;11&gt;Jan  1 07:36:53 dansguardian&quot;..., 112) = 112
rt_sigaction(SIGPIPE, {SIG_DFL}, NULL, 16) = 0
write(2, &quot;Error reading filter group conf &quot;..., 40) = 40
write(2, &quot;\n&quot;, 1)                       = 1
rt_sigaction(SIGPIPE, {SIG_DFL}, {SIG_DFL}, 16) = 0
time([946712213])                       = 946712213
open(&quot;/etc/TZ&quot;, O_RDONLY)               = -1 ENOENT (No such file or directory)
getpid()                                = 878
write(7, &quot;&lt;11&gt;Jan  1 07:36:53 dansguardian&quot;..., 80) = 80
rt_sigaction(SIGPIPE, {SIG_DFL}, NULL, 16) = 0
rt_sigaction(SIGPIPE, {SIG_DFL}, {SIG_DFL}, 16) = 0
time([946712213])                       = 946712213
open(&quot;/etc/TZ&quot;, O_RDONLY)               = -1 ENOENT (No such file or directory)
getpid()                                = 878
write(7, &quot;&lt;11&gt;Jan  1 07:36:53 dansguardian&quot;..., 122) = 122
rt_sigaction(SIGPIPE, {SIG_DFL}, NULL, 16) = 0
write(2, &quot;Error parsing the dansguardian.c&quot;..., 82) = 82
write(2, &quot;\n&quot;, 1)                       = 1
close(5)                                = 0
close(4)                                = 0
close(3)                                = 0
brk(0x59f000)                           = 0x59f000
exit(1)                                 = ?</code></pre></div><p>Any idea&#039;s?</p><p>Ridius</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p63765">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">ridius</div>
					<div class="post-datetime">
						20 Feb 2008, 19:10					</div>
				</div>
				<div class="post-content content">
					<p>Here is my dansguardian.conf file:<br /></p><div class="codebox"><pre><code># DansGuardian config file for version 2.9.9.2

# **NOTE** as of version 2.7.5 most of the list files are now in dansguardianf1.conf


# Web Access Denied Reporting (does not affect logging)
#
# -1 = log, but do not block - Stealth mode
#  0 = just say &#039;Access Denied&#039;
#  1 = report why but not what denied phrase
#  2 = report fully
#  3 = use HTML template file (accessdeniedaddress ignored) - recommended
#
reportinglevel = 3

# Language dir where languages are stored for internationalisation.
# The HTML template within this dir is only used when reportinglevel
# is set to 3. When used, DansGuardian will display the HTML file instead of
# using the perl cgi script.  This option is faster, cleaner
# and easier to customise the access denied page.
# The language file is used no matter what setting however.
#
languagedir = &#039;/usr/share/dansguardian/languages&#039;

# language to use from languagedir.
language = &#039;ukenglish&#039;

# Logging Settings
#
# 0 = none  1 = just denied  2 = all text based  3 = all requests
loglevel = 2

# Log Exception Hits
# Log if an exception (user, ip, URL, phrase) is matched and so
# the page gets let through.  Can be useful for diagnosing
# why a site gets through the filter.
# 0 = never log exceptions
# 1 = log exceptions, but do not explicitly mark them as such
# 2 = always log &amp; mark exceptions (default)
logexceptionhits = 2

# Log File Format
# 1 = DansGuardian format (space delimited)
# 2 = CSV-style format
# 3 = Squid Log File Format
# 4 = Tab delimited
logfileformat = 1

# truncate large items in log lines
#maxlogitemlength = 400

# anonymize logs (blank out usernames &amp; IPs)
#anonymizelogs = on


# Syslog logging
#
# Use syslog for access logging instead of logging to the file
# at the defined or built-in &quot;loglocation&quot;
#syslog = on

# Log file location
#
# Defines the log directory and filename.
loglocation = &#039;/var/log/dansguardian.access.log&#039;


# Statistics log file location
#
# Defines the stat file directory and filename.
# Only used in conjunction with maxips &gt; 0
# Once every 3 minutes, the current number of IPs in the cache, and the most
# that have been in the cache since the daemon was started, are written to this
# file. IPs persist in the cache for 7 days.
statlocation = &#039;/var/log/dansguardian.stats&#039;


# Network Settings
#
# the IP that DansGuardian listens on.  If left blank DansGuardian will
# listen on all IPs.  That would include all NICs, loopback, modem, etc.
# Normally you would have your firewall protecting this, but if you want
# you can limit it to a certain IP. To bind to multiple interfaces,
# specify each IP on an individual filterip line.
filterip =

# the port that DansGuardian listens to.
filterport = 8080

# the ip of the proxy (default is the loopback - i.e. this server)
proxyip = 127.0.0.1

# the port DansGuardian connects to proxy on
proxyport = 3128

# accessdeniedaddress is the address of your web server to which the cgi
# dansguardian reporting script was copied. Only used in reporting levels 1 and 2.
#
# This webserver must be either:
#  1. Non-proxied. Either a machine on the local network, or listed as an exception
#     in your browser&#039;s proxy configuration.
#  2. Added to the exceptionsitelist. Option 1 is preferable; this option is

#     only for users using both transparent proxying and a non-local server
#     to host this script.
#
# Individual filter groups can override this setting in their own configuration.
#
#accessdeniedaddress = &#039;http://YOURSERVER.YOURDOMAIN/cgi-bin/dansguardian.pl&#039;

# Non standard delimiter (only used with accessdeniedaddress)
# To help preserve the full banned URL, including parameters, the variables
# passed into the access denied CGI are separated using non-standard
# delimiters. This can be useful to ensure correct operation of the filter
# bypass modes. Parameters are split using &quot;::&quot; in place of &quot;&amp;&quot;, and &quot;==&quot; in
# place of &quot;=&quot;.
# Default is enabled, but to go back to the standard mode, disable it.
nonstandarddelimiter = on



# Banned image replacement
# Images that are banned due to domain/url/etc reasons including those
# in the adverts blacklists can be replaced by an image.  This will,
# for example, hide images from advert sites and remove broken image
# icons from banned domains.
# on (default) | off
usecustombannedimage = on
custombannedimagefile = &#039;/usr/share/dansguardian/transparent1x1.gif&#039;



# Filter groups options
# filtergroups sets the number of filter groups. A filter group is a set of content
# filtering options you can apply to a group of users.  The value must be 1 or more.
# DansGuardian will automatically look for dansguardianfN.conf where N is the filter
# group.  To assign users to groups use the filtergroupslist option.  All users default
# to filter group 1.  You must have some sort of authentication to be able to map users
# to a group.  The more filter groups the more copies of the lists will be in RAM so
# use as few as possible.
filtergroups = 1
filtergroupslist = &#039;/etc/dansguardian/lists/filtergroupslist&#039;



# Authentication files location
bannediplist = &#039;/etc/dansguardian/lists/bannediplist&#039;
exceptioniplist = &#039;/etc/dansguardian/lists/exceptioniplist&#039;



# Show weighted phrases found
# If enabled then the phrases found that made up the total which excedes
# the naughtyness limit will be logged and, if the reporting level is
# high enough, reported. on | off
showweightedfound = on

# Weighted phrase mode
# There are 3 possible modes of operation:
# 0 = off = do not use the weighted phrase feature.
# 1 = on, normal = normal weighted phrase operation.
# 2 = on, singular = each weighted phrase found only counts once on a page.
#
weightedphrasemode = 2



# Positive (clean) result caching for URLs
# Caches good pages so they don&#039;t need to be scanned again.
# It also works with AV plugins.
# 0 = off (recommended for ISPs with users with disimilar browsing)
# 1000 = recommended for most users
# 5000 = suggested max upper limit
# If you&#039;re using an AV plugin then use at least 5000.
urlcachenumber = 1000
#
# Age before they are stale and should be ignored in seconds
# 0 = never
# 900 = recommended = 15 mins
urlcacheage = 900



# Clean cache for content (AV) scan results
# By default, to save CPU, files scanned and found to be
# clean are inserted into the clean cache and NOT scanned
# again for a while.  If you don&#039;t like this then choose
# to disable it.
# (on|off) default = on.
scancleancache = on



# Smart, Raw and Meta/Title phrase content filtering options
# Smart is where the multiple spaces and HTML are removed before phrase filtering
# Raw is where the raw HTML including meta tags are phrase filtered
# Meta/Title is where only meta and title tags are phrase filtered (v. quick)
# CPU usage can be effectively halved by using setting 0 or 1 compared to 2
# 0 = raw only
# 1 = smart only
# 2 = both of the above (default)
# 3 = meta/title
phrasefiltermode = 2

# Lower casing options
# When a document is scanned the uppercase letters are converted to lower case
# in order to compare them with the phrases.  However this can break Big5 and
# other 16-bit texts.  If needed preserve the case.  As of version 2.7.0 accented
# characters are supported.
# 0 = force lower case (default)
# 1 = do not change case
# 2 = scan first in lower case, then in original case
preservecase = 0

# Note:
# If phrasefiltermode and preserve case are both 2, this equates to 4 phrase
# filtering passes. If you have a large enough userbase for this to be a
# worry, and need to filter pages in exotic character encodings, it may be
# better to run two instances on separate servers: one with preservecase 1
# (and possibly forcequicksearch 1) and non ASCII/UTF-8 phrase lists, and one
# with preservecase 0 and ASCII/UTF-8 lists.



# Hex decoding options
# When a document is scanned it can optionally convert %XX to chars.
# If you find documents are getting past the phrase filtering due to encoding
# then enable.  However this can break Big5 and other 16-bit texts.
# off = disabled (default)
# on = enabled
hexdecodecontent = off



# Force Quick Search rather than DFA search algorithm
# The current DFA implementation is not totally 16-bit character compatible
# but is used by default as it handles large phrase lists much faster.
# If you wish to use a large number of 16-bit character phrases then
# enable this option.
# off (default) | on (Big5 compatible)
forcequicksearch = off



# Reverse lookups for banned site and URLs.
# If set to on, DansGuardian will look up the forward DNS for an IP URL
# address and search for both in the banned site and URL lists.  This would
# prevent a user from simply entering the IP for a banned address.
# It will reduce searching speed somewhat so unless you have a local caching
# DNS server, leave it off and use the Blanket IP Block option in the
# bannedsitelist file instead.
reverseaddresslookups = off



# Reverse lookups for banned and exception IP lists.
# If set to on, DansGuardian will look up the forward DNS for the IP
# of the connecting computer.  This means you can put in hostnames in
# the exceptioniplist and bannediplist.
# If a client computer is matched against an IP given in the lists, then the
# IP will be recorded in any log entries; if forward DNS is successful and a
# match occurs against a hostname, the hostname will be logged instead.
# It will reduce searching speed somewhat so unless you have a local DNS server,
# leave it off.
reverseclientiplookups = off


# Perform reverse lookups on client IPs for successful requests.
# If set to on, DansGuardian will look up the forward DNS for the IP
# of the connecting computer, and log host names (where available) rather than
# IPs against requests.
# This is not dependent on reverseclientiplookups being enabled; however, if it
# is, enabling this option does not incur any additional forward DNS requests.
logclienthostnames = off


# Build bannedsitelist and bannedurllist cache files.
# This will compare the date stamp of the list file with the date stamp of
# the cache file and will recreate as needed.
# If a bsl or bul .processed file exists, then that will be used instead.
# It will increase process start speed by 300%.  On slow computers this will
# be significant.  Fast computers do not need this option. on | off
createlistcachefiles = on



# POST protection (web upload and forms)
# does not block forms without any file upload, i.e. this is just for
# blocking or limiting uploads
# measured in kibibytes after MIME encoding and header bumph
# use 0 for a complete block
# use higher (e.g. 512 = 512Kbytes) for limiting
# use -1 for no blocking
#maxuploadsize = 512
#maxuploadsize = 0
maxuploadsize = -1



# Max content filter size
# Sometimes web servers label binary files as text which can be very
# large which causes a huge drain on memory and cpu resources.
# To counter this, you can limit the size of the document to be
# filtered and get it to just pass it straight through.
# This setting also applies to content regular expression modification.
# The value must not be higher than maxcontentramcachescansize
# The size is in Kibibytes - eg 2048 = 2Mb
# use 0 to set it to maxcontentramcachescansize
maxcontentfiltersize = 256



# Max content ram cache scan size
# This is only used if you use a content scanner plugin such as AV
# This is the max size of file that DG will download and cache
# in RAM.  After this limit is reached it will cache to disk
# This value must be less than or equal to maxcontentfilecachescansize.
# The size is in Kibibytes - eg 10240 = 10Mb
# use 0 to set it to maxcontentfilecachescansize
# This option may be ignored by the configured download manager.
maxcontentramcachescansize = 2000



# Max content file cache scan size
# This is only used if you use a content scanner plugin such as AV
# This is the max size file that DG will download
# so that it can be scanned or virus checked.
# This value must be greater or equal to maxcontentramcachescansize.
# The size is in Kibibytes - eg 10240 = 10Mb
maxcontentfilecachescansize = 20000



# File cache dir
# Where DG will download files to be scanned if too large for the
# RAM cache.
filecachedir = &#039;/tmp&#039;



# Delete file cache after user completes download
# When a file gets save to temp it stays there until it is deleted.
# You can choose to have the file deleted when the user makes a sucessful
# download.  This will mean if they click on the link to download from
# the temp store a second time it will give a 404 error.
# You should configure something to delete old files in temp to stop it filling up.
# on|off (defaults to on)
deletedownloadedtempfiles = on



# Initial Trickle delay
# This is the number of seconds a browser connection is left waiting
# before first being sent *something* to keep it alive.  The
# *something* depends on the download manager chosen.
# Do not choose a value too low or normal web pages will be affected.
# A value between 20 and 110 would be sensible
# This may be ignored by the configured download manager.
initialtrickledelay = 20



# Trickle delay
# This is the number of seconds a browser connection is left waiting
# before being sent more *something* to keep it alive.  The
# *something* depends on the download manager chosen.
# This may be ignored by the configured download manager.
trickledelay = 10



# Download Managers
# These handle downloads of files to be filtered and scanned.
# They differ in the method they deal with large downloads.
# Files usually need to be downloaded 100% before they can be
# filtered and scanned before being sent on to the browser.
# Normally the browser can just wait, but with content scanning,
# for example to AV, the browser may timeout or the user may get
# confused so the download manager has to do some sort of
# &#039;keep alive&#039;.
#
# There are various methods possible but not all are included.
# The author does not have the time to write them all so I have
# included a plugin systam.  Also, not all methods work with all
# browsers and clients.  Specifically some fancy methods don&#039;t
# work with software that downloads updates.  To solve this,
# each plugin can support a regular expression for matching
# the client&#039;s user-agent string, and lists of the mime types
# and extensions it should manage.
#
# Note that these are the matching methods provided by the base plugin
# code, and individual plugins may override or add to them.
# See the individual plugin conf files for supported options.
#
# The plugins are matched in the order you specify and the last
# one is forced to match as the default, regardless of user agent
# and other matching mechanisms.
#
downloadmanager = &#039;/etc/dansguardian/downloadmanagers/fancy.conf&#039;
##!! Not compiled !! downloadmanager = &#039;/etc/dansguardian/downloadmanagers/trickle.conf&#039;
downloadmanager = &#039;/etc/dansguardian/downloadmanagers/default.conf&#039;



# Content Scanners (Also known as AV scanners)
# These are plugins that scan the content of all files your browser fetches
# for example to AV scan.  The options are limitless.  Eventually all of
# DansGuardian will be plugin based.  You can have more than one content
# scanner. The plugins are run in the order you specify.
# This is one of the few places you can have multiple options of the same name.
#
# Some of the scanner(s) require 3rd party software and libraries eg clamav.
# See the individual plugin conf file for more options (if any).
#
#contentscanner = &#039;/etc/dansguardian/contentscanners/clamav.conf&#039;
#!! Not compiled !! contentscanner = &#039;/etc/dansguardian/contentscanners/clamdscan.conf&#039;
#!! Unimplemented !! contentscanner = &#039;/etc/dansguardian/contentscanners/kavav.conf&#039;
#!! Not compiled !! contentscanner = &#039;/etc/dansguardian/contentscanners/kavdscan.conf&#039;
#!! Not compiled !! contentscanner = &#039;/etc/dansguardian/contentscanners/icapscan.conf&#039;
#!! Not compiled !! contentscanner = &#039;/etc/dansguardian/contentscanners/commandlinescan.conf&#039;



# Content scanner timeout
# Some of the content scanners support using a timeout value to stop
# processing (eg AV scanning) the file if it takes too long.
# If supported this will be used.
# The default of 60 seconds is probably reasonable.
contentscannertimeout = 60



# Content scan exceptions
# If &#039;on&#039; exception sites, urls, users etc will be scanned
# This is probably not desirable behavour as exceptions are
# supposed to be trusted and will increase load.
# Correct use of grey lists are a better idea.
# (on|off) default = off
contentscanexceptions = off



# Auth plugins
# These replace the usernameidmethod* options in previous versions. They
# handle the extraction of client usernames from various sources, such as
# Proxy-Authorisation headers and ident servers, enabling requests to be
# handled according to the settings of the user&#039;s filter group.
# Multiple plugins can be specified, and will be queried in order until one
# of them either finds a username or throws an error. For example, if Squid
# is configured with both NTLM and Basic auth enabled, and both the &#039;proxy-basic&#039;
# and &#039;proxy-ntlm&#039; auth plugins are enabled here, then clients which do not support
# NTLM can fall back to Basic without sacrificing access rights.
#
# If you do not use multiple filter groups, you need not specify this option.
#
#authplugin = &#039;/etc/dansguardian/authplugins/proxy-basic.conf&#039;
#authplugin = &#039;/etc/dansguardian/authplugins/proxy-digest.conf&#039;
#!! Not compiled !! authplugin = &#039;/etc/dansguardian/authplugins/proxy-ntlm.conf&#039;
#authplugin = &#039;/etc/dansguardian/authplugins/ident.conf&#039;
#authplugin = &#039;/etc/dansguardian/authplugins/ip.conf&#039;



# Re-check replaced URLs
# As a matter of course, URLs undergo regular expression search/replace (urlregexplist)
# *after* checking the exception site/URL/regexpURL lists, but *before* checking against
# the banned site/URL lists, allowing certain requests that would be matched against the
# latter in their original state to effectively be converted into grey requests.
# With this option enabled, the exception site/URL/regexpURL lists are also re-checked
# after replacement, making it possible for URL replacement to trigger exceptions based
# on them.
# Defaults to off.
recheckreplacedurls = off



# Misc settings

# if on it adds an X-Forwarded-For: &lt;clientip&gt; to the HTTP request
# header.  This may help solve some problem sites that need to know the
# source ip. on | off
forwardedfor = off


# if on it uses the X-Forwarded-For: &lt;clientip&gt; to determine the client
# IP. This is for when you have squid between the clients and DansGuardian.
# Warning - headers are easily spoofed. on | off
usexforwardedfor = off


# if on it logs some debug info regarding fork()ing and accept()ing which
# can usually be ignored.  These are logged by syslog.  It is safe to leave
# it on or off
logconnectionhandlingerrors = on



# Fork pool options

# If on, this causes DG to write to the log file whenever child processes are
# created or destroyed (other than by crashes). This information can help in
# understanding and tuning the following parameters, but is not generally
# useful in production.
logchildprocesshandling = off

# sets the maximum number of processes to spawn to handle the incoming
# connections.  Max value usually 250 depending on OS.
# On large sites you might want to try 180.
maxchildren = 120


# sets the minimum number of processes to spawn to handle the incoming connections.
# On large sites you might want to try 32.
minchildren = 8


# sets the minimum number of processes to be kept ready to handle connections.
# On large sites you might want to try 8.
minsparechildren = 4


# sets the minimum number of processes to spawn when it runs out
# On large sites you might want to try 10.
preforkchildren = 6


# sets the maximum number of processes to have doing nothing.
# When this many are spare it will cull some of them.
# On large sites you might want to try 64.
maxsparechildren = 32


# sets the maximum age of a child process before it croaks it.
# This is the number of connections they handle before exiting.
# On large sites you might want to try 10000.
maxagechildren = 500


# Sets the maximum number client IP addresses allowed to connect at once.
# Use this to set a hard limit on the number of users allowed to concurrently
# browse the web. Set to 0 for no limit, and to disable the IP cache process.
maxips = 0



# Process options
# (Change these only if you really know what you are doing).
# These options allow you to run multiple instances of DansGuardian on a single machine.
# Remember to edit the log file path above also if that is your intention.

# IPC filename
#
# Defines IPC server directory and filename used to communicate with the log process.
ipcfilename = &#039;/tmp/.dguardianipc&#039;

# URL list IPC filename
#
# Defines URL list IPC server directory and filename used to communicate with the URL
# cache process.
urlipcfilename = &#039;/tmp/.dguardianurlipc&#039;

# IP list IPC filename
#
# Defines IP list IPC server directory and filename, for communicating with the client
# IP cache process.
ipipcfilename = &#039;/tmp/.dguardianipipc&#039;

# PID filename
#
# Defines process id directory and filename.
#pidfilename = &#039;/var/run/dansguardian.pid&#039;

# Disable daemoning
# If enabled the process will not fork into the background.
# It is not usually advantageous to do this.
# on|off (defaults to off)
nodaemon = off

# Disable logging process
# on|off (defaults to off)
nologger = off

# Enable logging of &quot;ADs&quot; category blocks
# on|off (defaults to off)
logadblocks = off

# Enable logging of client User-Agent
# Some browsers will cause a *lot* of extra information on each line!
# on|off (defaults to off)
loguseragent = off

# Daemon runas user and group
# This is the user that DansGuardian runs as.  Normally the user/group nobody.
# Uncomment to use.  Defaults to the user set at compile time.
# Temp files created during virus scanning are given owner and group read
# permissions; to use content scanners based on external processes, such as
# clamdscan, the two processes must run with either the same group or user ID.
daemonuser = &#039;nobody&#039;
daemongroup = &#039;nogroup&#039;

# Soft restart
# When on this disables the forced killing off all processes in the process group.
# This is not to be confused with the -g run time option - they are not related.
# on|off (defaults to off)
softrestart = off

# Mail program
# Path (sendmail-compatible) email program, with options.
# Not used if usesmtp is disabled (filtergroup specific).
#!! Not compiled !!mailer = &#039;/usr/sbin/sendmail -t&#039;</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p63766">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">Wodin</div>
					<div class="post-datetime">
						20 Feb 2008, 19:12					</div>
				</div>
				<div class="post-content content">
					<p>I have never used dansguardian...&nbsp; Do you have a dansguardianf1.conf file?&nbsp; That&#039;s what it&#039;s having trouble with.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p63767">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">forum2008</div>
					<div class="post-datetime">
						20 Feb 2008, 19:13					</div>
				</div>
				<div class="post-content content">
					<p>Set your timezone in /etc/TZ</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p63768">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">ridius</div>
					<div class="post-datetime">
						20 Feb 2008, 19:13					</div>
				</div>
				<div class="post-content content">
					<p>Here is my dansguardianf1.conf file:<br /></p><div class="codebox"><pre><code># DansGuardian filter group config file for version 2.9.9.2


# Filter group mode
# This option determines whether members of this group have their web access
# unfiltered, filtered, or banned. This mechanism replaces the &quot;banneduserlist&quot;
# and &quot;exceptionuserlist&quot; files from previous versions.
#
# 0 = banned
# 1 = filtered
# 2 = unfiltered (exception)
#
# Only filter groups with a mode of 1 need to define phrase, URL, site, extension,
# mimetype and PICS lists; in other modes, these options are ignored to conserve
# memory.
#
# Defaults to 0 if unspecified.
# Unauthenticated users are treated as being in the first filter group.
groupmode = 1

# Filter group name
# Used to fill in the -FILTERGROUP- placeholder in the HTML template file, and to
# name the group in the access logs
# Defaults to empty string
#groupname = &#039;&#039;

# Content filtering files location
bannedphraselist = &#039;/etc/dansguardian/lists/bannedphraselist&#039;
weightedphraselist = &#039;/etc/dansguardian/lists/weightedphraselist&#039;
exceptionphraselist = &#039;/etc/dansguardian/lists/exceptionphraselist&#039;
bannedsitelist = &#039;/etc/dansguardian/lists/bannedsitelist&#039;
greysitelist = &#039;/etc/dansguardian/lists/greysitelist&#039;
exceptionsitelist = &#039;/etc/dansguardian/lists/exceptionsitelist&#039;
bannedurllist = &#039;/etc/dansguardian/lists/bannedurllist&#039;
greyurllist = &#039;/etc/dansguardian/lists/greyurllist&#039;
exceptionurllist = &#039;/etc/dansguardian/lists/exceptionurllist&#039;
exceptionregexpurllist = &#039;/etc/dansguardian/lists/exceptionregexpurllist&#039;
bannedregexpurllist = &#039;/etc/dansguardian/lists/bannedregexpurllist&#039;
picsfile = &#039;/etc/dansguardian/lists/pics&#039;
contentregexplist = &#039;/etc/dansguardian/lists/contentregexplist&#039;
urlregexplist = &#039;/etc/dansguardian/lists/urlregexplist&#039;

# Filetype filtering
#
# Blanket download blocking
# If enabled, all files will be blocked, unless they match the
# exceptionextensionlist or exceptionmimetypelist.
# These lists do not override any other content filtering or virus scanning.
# Exception lists defined above override all types of filtering, including
# the blanket download block.
# Defaults to disabled.
# (on | off)
#
#blockdownloads = off
#exceptionextensionlist = &#039;/etc/dansguardian/lists/exceptionextensionlist&#039;
#exceptionmimetypelist = &#039;/etc/dansguardian/lists/exceptionmimetypelist&#039;
#
# When blanket download blocking is disabled, use the following lists to block
# specific kinds of file downloads.
#
bannedextensionlist = &#039;/etc/dansguardian/lists/bannedextensionlist&#039;
bannedmimetypelist = &#039;/etc/dansguardian/lists/bannedmimetypelist&#039;
#
# In either file filtering mode, the following list can be used to override
# MIME type &amp; extension blocks for particular domains &amp; URLs (trusted download sites).
#
exceptionfilesitelist = &#039;/etc/dansguardian/lists/exceptionfilesitelist&#039;
exceptionfileurllist = &#039;/etc/dansguardian/lists/exceptionfileurllist&#039;

# Categorise without blocking:
# Supply categorised lists here and the category string shall be logged against
# matching requests, but matching these lists does not perform any filtering
# action.
#logsitelist = &#039;/etc/dansguardian/lists/logsitelist&#039;
#logurllist = &#039;/etc/dansguardian/lists/logurllist&#039;
#logregexpurllist = &#039;/etc/dansguardian/lists/logregexpurllist&#039;

# Outgoing HTTP header rules:
# Optional lists for blocking based on, and modification of, outgoing HTTP
# request headers.  Format for headerregexplist is one modification rule per
# line, similar to content/URL modifications.  Format for
# bannedregexpheaderlist is one regular expression per line, with matching
# headers causing a request to be blocked.
# Headers are matched/replaced on a line-by-line basis, not as a contiguous
# block.
# Use for example, to remove cookies or prevent certain user-agents.
headerregexplist = &#039;/etc/dansguardian/lists/headerregexplist&#039;
bannedregexpheaderlist = &#039;/etc/dansguardian/lists/bannedregexpheaderlist&#039;

# Naughtyness limit
# This the limit over which the page will be blocked.  Each weighted phrase is given
# a value either positive or negative and the values added up.  Phrases to do with
# good subjects will have negative values, and bad subjects will have positive
# values.  See the weightedphraselist file for examples.
# As a guide:
# 50 is for young children,  100 for old children,  160 for young adults.
naughtynesslimit = 160

# Category display threshold
# This option only applies to pages blocked by weighted phrase filtering.
# Defines the minimum score that must be accumulated within a particular
# category in order for it to show up on the block pages&#039; category list.
# All categories under which the page scores positively will be logged; those
# that were not displayed to the user appear in brackets.
#
# -1 = display only the highest scoring category
# 0 = display all categories (default)
# &gt; 0 = minimum score for a category to be displayed
categorydisplaythreshold = 0

# Embedded URL weighting
# When set to something greater than zero, this option causes URLs embedded within a
# page&#039;s HTML (from links, image tags, etc.) to be extracted and checked against the
# bannedsitelist and bannedurllist. Each link to a banned page causes the amount set
# here to be added to the page&#039;s weighting.
# The behaviour of this option with regards to multiple occurrences of a site/URL is
# affected by the weightedphrasemode setting.
#
# NB: Currently, this feature uses regular expressions that require the PCRE library.
# As such, it is only available if you compiled DansGuardian with &#039;--enable-pcre=yes&#039;.
# You can check compile-time options by running &#039;dansguardian -v&#039;.
#
# Set to 0 to disable.
# Defaults to 0.
# WARNING: This option is highly CPU intensive!
embeddedurlweight = 0

# Enable PICS rating support
#
# Defaults to disabled
# (on | off)
enablepics = off

# Temporary Denied Page Bypass
# This provides a link on the denied page to bypass the ban for a few minutes.  To be
# secure it uses a random hashed secret generated at daemon startup.  You define the
# number of seconds the bypass will function for before the deny will appear again.
# To allow the link on the denied page to appear you will need to edit the template.html
# or dansguardian.pl file for your language.
# 300 = enable for 5 minutes
# 0 = disable ( defaults to 0 )
# -1 = enable but you require a separate program/CGI to generate a valid link
bypass = 0

# Temporary Denied Page Bypass Secret Key
# Rather than generating a random key you can specify one.  It must be more than 8 chars.
# &#039;&#039; = generate a random one (recommended and default)
# &#039;Mary had a little lamb.&#039; = an example
# &#039;76b42abc1cd0fdcaf6e943dcbc93b826&#039; = an example
#
# Please note: manually entered keys are converted to all lowercase before use.
#
bypasskey = &#039;&#039;

# Infection/Scan Error Bypass
# Similar to the &#039;bypass&#039; setting, but specifically for bypassing files scanned and found
# to be infected, or files that trigger scanner errors - for example, archive types with
# recognised but unsupported compression schemes, or corrupt archives.
# The option specifies the number of seconds for which the bypass link will be valid.
# 300 = enable for 5 minutes
# 0 = disable (default)
# -1 = enable, but require a separate program/CGI to generate a valid link
infectionbypass = 0

# Infection/Scan Error Bypass Secret Key
# Same as the &#039;bypasskey&#039; option, but used for infection bypass mode.
infectionbypasskey = &#039;&#039;

# Infection/Scan Error Bypass on Scan Errors Only
# Enable this option to allow infectionbypass links only when virus scanning fails,
# not when a file is found to contain a virus.
# on = enable (default and highly recommended)
# off = disable
infectionbypasserrorsonly = on

# Disable content scanning
# If you enable this option you will disable content scanning for this group.
# Content scanning primarily is AV scanning (if enabled) but could include
# other types.
# (on|off) default = off.
disablecontentscan = off

# Enable Deep URL Analysis
# When enabled, DG looks for URLs within URLs, checking against the bannedsitelist and
# bannedurllist. This can be used, for example, to block images originating from banned
# sites from appearing in Google Images search results, as the original URLs are
# embedded in the thumbnail GET requests.
# (on|off) default = off
deepurlanalysis = off

# reportinglevel
#
# -1 = log, but do not block - Stealth mode
#  0 = just say &#039;Access Denied&#039;
#  1 = report why but not what denied phrase
#  2 = report fully
#  3 = use HTML template file (accessdeniedaddress ignored) - recommended
#
# If defined, this overrides the global setting in dansguardian.conf for
# members of this filter group.
#
#reportinglevel = 3

# accessdeniedaddress is the address of your web server to which the cgi
# dansguardian reporting script was copied. Only used in reporting levels
# 1 and 2.
#
# This webserver must be either:
#  1. Non-proxied. Either a machine on the local network, or listed as an
#     exception in your browser&#039;s proxy configuration.
#  2. Added to the exceptionsitelist. Option 1 is preferable; this option is
#     only for users using both transparent proxying and a non-local server
#     to host this script.
#
# If defined, this overrides the global setting in dansguardian.conf for
# members of this filter group.
#
#accessdeniedaddress = &#039;http://YOURSERVER.YOURDOMAIN/cgi-bin/dansguardian.pl&#039;

# HTML Template override
# If defined, this specifies a custom HTML template file for members of this
# filter group, overriding the global setting in dansguardian.conf. This is
# only used in reporting level 3.
#
# The default template file path is &lt;languagedir&gt;/&lt;language&gt;/template.html
# e.g. /usr/share/dansguardian/languages/ukenglish/template.html when using &#039;ukenglish&#039;
# language.
#
# This option generates a file path of the form:
# &lt;languagedir&gt;/&lt;language&gt;/&lt;htmltemplate&gt;
# e.g. /usr/share/dansguardian/languages/ukenglish/custom.html
#
#htmltemplate = &#039;custom.html&#039;

# Email reporting - original patch by J. Gauthier

# Use SMTP
# If on, will enable system wide events to be reported by email.
# need to configure mail program (see &#039;mailer&#039; in global config)
# and email recipients
# default usesmtp = off
#!! Not compiled !!usesmtp = off

# mailfrom
# who the email would come from
# example: mailfrom = &#039;dansguardian@mycompany.com&#039;
#!! Not compiled !!mailfrom = &#039;&#039;

# avadmin
# who the virus emails go to (if notify av is on)
# example: avadmin = &#039;admin@mycompany.com&#039;
#!! Not compiled !!avadmin = &#039;&#039;

# contentdmin
# who the content emails go to (when thresholds are exceeded)
# and contentnotify is on
# example: contentadmin = &#039;admin@mycompany.com&#039;
#!! Not compiled !!contentadmin = &#039;&#039;

# avsubject
# Subject of the email sent when a virus is caught.
# only applicable if notifyav is on
# default avsubject = &#039;dansguardian virus block&#039;
#!! Not compiled !!avsubject = &#039;dansguardian virus block&#039;

# content
# Subject of the email sent when violation thresholds are exceeded
# default contentsubject = &#039;dansguardian violation&#039;
#!! Not compiled !!contentsubject = &#039;dansguardian violation&#039;

# notifyAV
# This will send a notification, if usesmtp/notifyav is on, any time an
# default contentsubject = &#039;dansguardian violation&#039;
#!! Not compiled !!contentsubject = &#039;dansguardian violation&#039;

# notifyAV
# This will send a notification, if usesmtp/notifyav is on, any time an
# infection is found.
# Important: If this option is off, viruses will still be recorded like a
# content infraction.
#!! Not compiled !!notifyav = off

# notifycontent
# This will send a notification, if usesmtp is on, based on thresholds
# below
#!! Not compiled !!notifycontent = off

# thresholdbyuser
# results are only predictable with user authenticated configs
# if enabled the violation/threshold count is kept track of by the user
#!! Not compiled !!thresholdbyuser = off

#violations
# number of violations before notification
# setting to 0 will never trigger a notification
#!! Not compiled !!violations = 0

#threshold
# this is in seconds. If &#039;violations&#039; occur in &#039;threshold&#039; seconds, then
# a notification is made.
# if this is set to 0, then whenever the set number of violations are made a
# notifaction will be sent.
#!! Not compiled !!threshold = 0</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p63769">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">ridius</div>
					<div class="post-datetime">
						20 Feb 2008, 19:45					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>forum2008 wrote:</cite><blockquote><p>Set your timezone in /etc/TZ</p></blockquote></div><p>I went ahead and set the timezone in /etc/TZ per the Wiki article, but I still get the same error.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p63801">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">ciscostu</div>
					<div class="post-datetime">
						21 Feb 2008, 04:01					</div>
				</div>
				<div class="post-content content">
					<p>From the strace output...<br /></p><div class="quotebox"><blockquote><p>old_mmap(NULL, 7954432, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, 0, 0) = -1 ENOMEM (Cannot allocate memory)<br />brk(0xdaa000)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= 0x622000<br />old_mmap(NULL, 7954432, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, 0, 0) = -1 ENOMEM (Cannot allocate memory)<br />rt_sigaction(SIGPIPE, {SIG_DFL}, {SIG_DFL}, 16) = 0</p></blockquote></div><p>I think you&#039;re running out of memory.&nbsp; <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p>											<p class="post-edited">(Last edited by <strong>ciscostu</strong> on 21 Feb 2008, 04:02)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p63803">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">ridius</div>
					<div class="post-datetime">
						21 Feb 2008, 07:22					</div>
				</div>
				<div class="post-content content">
					<p>That is my biggest fear. I know I don&#039;t have much with the WRT54GL (Only 16 MB) but none of the stores in my area had a version 1-2 WRT54GS... only version 7.</p><p>Here&#039;s the weird part though, I had top reporting memory usage every 1 second and it never got below 500kb free, even while trying to run dansguardian. I know that&#039;s not very much, but I&#039;d prefer to use content filtering rather than a proxy banlist.</p><p>Ridius</p>											<p class="post-edited">(Last edited by <strong>ridius</strong> on 21 Feb 2008, 07:38)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>