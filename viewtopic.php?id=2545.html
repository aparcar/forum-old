<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> NAT not working</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 17 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p11796">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">benoh</div>
					<div class="post-datetime">
						7 Sep 2005, 12:17					</div>
				</div>
				<div class="post-content content">
					<p>Hi guys,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Im using a WRT54G V2 which ive flashed with WhiteRussian RC2.&nbsp; Im connecting via PPPoE which is configured and working correctly, the router is connected, assigned DNS etc and has full connectivity via the WAN port.</p><p>The LAN is configured as default on 192.168.1.0/24 running DHCP and DNSMASQ which both appear to be working fine.</p><p>Clients on the LAN are assigned IPs/DNS etc and can do DNS lookups without problem via the wrt54g.</p><p>However, the NAT rules dont appear to be working as LAN clients have no internet access, their default gateway is set correctly to 192.168.1.1</p><p>Ive searched the forums and cant seem to find anything related to this, ive tried a factory reset erasing the NVRAM variables are configuring from the start but the same problem appears.</p><p>Anyone got any ideas or seen this before?</p><p>Ive included the output from nvram show below if its of any help ;-)</p><p>Regards</p><p>Ben</p><p>root@OpenWrt:~# uname -a<br />Linux OpenWrt 2.4.30 #1 Mon Jul 18 17:43:36 EDT 2005 mips unknown</p><p>root@OpenWrt:~# nvram show<br />os_ram_addr=80001000<br />boardrev=0x10<br />il0macaddr=00:0f:66:d9:69:2f<br />ppp_passwd=removed<br />ppp_idletime=0<br />et0macaddr=00:0F:66:D9:69:2D<br />boot_wait=off<br />watchdog=5000<br />et0mdcport=0<br />pmon_ver=CFE 3.51.21.0<br />ppp_username=benoh@plusdsl.net<br />gpio2=adm_eecs<br />gpio3=adm_eesk<br />gpio5=adm_eedi<br />vlan0ports=1 2 3 4 5*<br />gpio6=adm_rc<br />os_flash_addr=bfc40000<br />sromrev=2<br />boardtype=0x0101<br />lan_netmask=255.255.255.0<br />ppp_redialperiod=0<br />wl0id=0x4320<br />ag0=255<br />wl0gpio2=0<br />wl0gpio3=0<br />boardflags2=0<br />wan_proto=pppoe<br />pa0itssit=62<br />cctl=0<br />lan_ifnames=vlan0 eth1<br />pppoe_ifname=vlan1<br />pa0maxpwr=0x48<br />clkfreq=200<br />lan_ipaddr=192.168.1.1<br />vlan1hwname=et0<br />aa0=3<br />pppoe_passwd=removed<br />sdram_config=0x0032<br />vlan1ports=0 5<br />scratch=a0180000<br />ccode=0<br />pppoe_idletime=0<br />lan_ifname=br0<br />boardflags=0x0188<br />sdram_refresh=0x0000<br />sdram_ncdl=0x22<br />pppoe_username=benoh@plusdsl.net<br />et0phyaddr=30<br />wan_ifname=vlan1<br />pa0b0=0x170c<br />pa0b1=0xfa24<br />pa0b2=0xfe70<br />sdram_init=0x0000<br />vlan0hwname=et0<br />dl_ram_addr=a0001000<br />boot_ver=v2.3<br />boardnum=42<br />size: 980 bytes (31788 left)</p><p>root@OpenWrt:~# ifconfig -a<br />br0&nbsp; &nbsp; &nbsp; &nbsp;Link encap:Ethernet&nbsp; HWaddr 00:0F:66:D9:69:2D<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:192.168.1.1&nbsp; Bcast:192.168.1.255&nbsp; Mask:255.255.255.0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:16455 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:4077 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:1283345 (1.2 MiB)&nbsp; TX bytes:703682 (687.1 KiB)</p><p>eth0&nbsp; &nbsp; &nbsp; Link encap:Ethernet&nbsp; HWaddr 00:0F:66:D9:69:2D<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING PROMISC MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:18280 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:5942 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:1000<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:1912436 (1.8 MiB)&nbsp; TX bytes:967579 (944.9 KiB)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Interrupt:5 Base address:0x2000</p><p>eth1&nbsp; &nbsp; &nbsp; Link encap:Ethernet&nbsp; HWaddr 00:0F:66:D9:69:2F<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:0 errors:0 dropped:0 overruns:0 frame:209<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:0 errors:12149 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:1000<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:0 (0.0 B)&nbsp; TX bytes:0 (0.0 B)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Interrupt:4 Base address:0x1000</p><p>lo&nbsp; &nbsp; &nbsp; &nbsp; Link encap:Local Loopback<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:127.0.0.1&nbsp; Mask:255.0.0.0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP LOOPBACK RUNNING&nbsp; MTU:16436&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:0 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:0 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:0 (0.0 B)&nbsp; TX bytes:0 (0.0 B)</p><p>ppp0&nbsp; &nbsp; &nbsp; Link encap:Point-Point Protocol<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:84.92.97.160&nbsp; P-t-P:195.166.128.64&nbsp; Mask:255.255.255.255<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP POINTOPOINT RUNNING NOARP MULTICAST&nbsp; MTU:1492&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:1450 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:1480 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:3<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:196835 (192.2 KiB)&nbsp; TX bytes:195837 (191.2 KiB)</p><p>vlan0&nbsp; &nbsp; &nbsp;Link encap:Ethernet&nbsp; HWaddr 00:0F:66:D9:69:2D<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:16456 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:4077 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:1349247 (1.2 MiB)&nbsp; TX bytes:719990 (703.1 KiB)</p><p>vlan1&nbsp; &nbsp; &nbsp;Link encap:Ethernet&nbsp; HWaddr 00:0F:66:D9:69:2D<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:1819 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:1865 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:233515 (228.0 KiB)&nbsp; TX bytes:247589 (241.7 KiB)</p><br /><p>root@OpenWrt:~# iptables -L<br />Chain INPUT (policy DROP)<br />target&nbsp; &nbsp; &nbsp;prot opt source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination<br />DROP&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; state INVALID<br />ACCEPT&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; state RELATED,ESTABLISHED<br />DROP&nbsp; &nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tcp option=!2 flags:SYN/SYN<br />input_rule&nbsp; all&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere<br />ACCEPT&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere<br />ACCEPT&nbsp; &nbsp; &nbsp;icmp --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere<br />ACCEPT&nbsp; &nbsp; &nbsp;gre&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere<br />REJECT&nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; reject-with tcp-reset<br />REJECT&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; reject-with icmp-port-unreachable</p><p>Chain FORWARD (policy DROP)<br />target&nbsp; &nbsp; &nbsp;prot opt source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination<br />DROP&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; state INVALID<br />TCPMSS&nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tcp flags:SYN,RST/SYN TCPMSS clamp to PMTU<br />ACCEPT&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; state RELATED,ESTABLISHED<br />forwarding_rule&nbsp; all&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere<br />ACCEPT&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere<br />ACCEPT&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere</p><p>Chain OUTPUT (policy DROP)<br />target&nbsp; &nbsp; &nbsp;prot opt source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination<br />DROP&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; state INVALID<br />ACCEPT&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; state RELATED,ESTABLISHED<br />output_rule&nbsp; all&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere<br />ACCEPT&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere<br />REJECT&nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; reject-with tcp-reset<br />REJECT&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; reject-with icmp-port-unreachable</p><p>Chain forwarding_rule (1 references)<br />target&nbsp; &nbsp; &nbsp;prot opt source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination</p><p>Chain input_rule (1 references)<br />target&nbsp; &nbsp; &nbsp;prot opt source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination</p><p>Chain output_rule (1 references)<br />target&nbsp; &nbsp; &nbsp;prot opt source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p11797">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">Nico</div>
					<div class="post-datetime">
						7 Sep 2005, 12:26					</div>
				</div>
				<div class="post-content content">
					<p>Read the <a href="http://wiki.openwrt.org/OpenWrtFaq">FAQ</a> (41. How do I configure pppoe?)</p><p>Basically, you need this :<br /></p><div class="codebox"><pre><code>nvram set wan_ifname=ppp0</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p11799">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">hitek146</div>
					<div class="post-datetime">
						7 Sep 2005, 12:33					</div>
				</div>
				<div class="post-content content">
					<p>The firewall scripts look at the nvram variable wan_ifname, by default, to find out what interface you want to use as your outside interface.&nbsp; If your wan_ifname variable does not point to your outside interface(which should be your PPPoE(ppp0) interface, then you won&#039;t get proper routing....</p>											<p class="post-edited">(Last edited by <strong>hitek146</strong> on 7 Sep 2005, 12:34)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p11800">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">benoh</div>
					<div class="post-datetime">
						7 Sep 2005, 13:06					</div>
				</div>
				<div class="post-content content">
					<p>Cheers for the replies, it looks blindingly obvious now ;-)</p><p>However, im fairly sure it was set to ppp0 after the initial install but pppd was erroring into syslog as it couldnt find the interface, hence i changed it to vlan1 to get it connected.</p><p>Ill change it over and see how it goes from there.</p><p>Cheers again,</p><p>Ben</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>