<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> *WIP* HOWTO: TP-LINK OEM 8Mbit (not 4m) Flash TP-841N v9.2 VN variant</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 14 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p329448">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">hojuruku</div>
					<div class="post-datetime">
						22 Jun 2016, 14:44					</div>
				</div>
				<div class="post-content content">
					<p>I finally got around as promised (<a href="https://forum.openwrt.org/viewtopic.php?pid=275353#p275353">#1</a> <a href="https://forum.openwrt.org/viewtopic.php?pid=296998#p296998">#2</a>) to fixing the serial console for the TP-LINK Viettel version I had laying around. <br />I was delayed due to a 24V soldering iron tip burning out and a fake Nokia 3.3v serial cable DKU-5 that just didn&#039;t work, but now I&#039;m up and running with serial console access.</p><div class="quotebox"><cite>hojuruku wrote:</cite><blockquote><p>&quot;Error<br />Error code: 18005<br />Upgrade unsuccessfully because the version of the upgraded file was incorrect. Please check the file name.&quot;</p><p>I guess I&#039;ll have to wire up a serial cable, take some photo&#039;s and let you know I go, with a status update next week.<br />I find it really annoying that the factory upgrades don&#039;t work. It looks like the Telco may have asked TP-Link to do as much as possible to block openwrt enthusiasts, or the v9.2 is different hardware.....<br /></p><div class="codebox"><pre><code>Firmware Version:    
Flash:8M_Memory:32M_3.15.9 Build 140806 Rel.34809n
Hardware Version:    
WR841N v9 00000000</code></pre></div><p>These will be a nice one to hack. It looks like I&#039;ll be needing a custom build? Do your factory roms have IPV6 an TR-069? 4Meg flash on all the others right?</p></blockquote></div><br /><p>This TP-LINK 841N V9.2 is NOT firmware comptaible with openwrt OR TP-LINK standard firmware for the TP-Link 841n v9. The custom TP-Link/Viettel firmware has IP6 support and also TR-069.</p><p>I have sighted the custom flash chip on the board. Here is the datasheet.<br /><a href="http://www.winbond.com/hq/product/code-storage-flash-memory/serial-nor-flash/?__locale=en&amp;density=64Mbit(8MB)">http://www.winbond.com/hq/product/code- … 4Mbit(8MB)</a></p><p>Here is a picture of some Vietnamese trying to update the custom Viettel firmware with the standard TP-LINK firmware on some Vietnamese forums:<br /><a href="https://vozforums.com/showthread.php?t=4127691&amp;page=1">https://vozforums.com/showthread.php?t= … amp;page=1</a></p><p>I am now going to attempt to port openwrt to this. it shouldn&#039;t be too much work everything the is the same except for the flash chip. In order to make a Factory.bin openwrt upgrade format I need to get access to the tp-link firmware to see what signature it looks for before accepting an upgrade image. </p><p>This router is extremely common in Vietnam, and is being provided with all new Viettel internet connections in the last year. Due to the way Viettel &quot;nettopia&quot; configurations are set up, large groups of people could potentially run their own PPPOE lan parties.</p><p>Now here&#039;s access to the serial console.<br />First boot<br /></p><div class="codebox"><pre><code>U-Boot 1.1.4 (Build from LSDK-9.5.3.16 at Aug  6 2014 - 09:33:12)

ap143 - Honey Bee 1.1

DRAM:   32 MB
Flash Manuf Id 0xef, DeviceId0 0x40, DeviceId1 0x17
Flash:  8 MB
Using default environment

In:    serial
Out:   serial
Err:   serial
Net:   ath_gmac_enet_initialize...
ath_gmac_enet_initialize: reset mask:0xc02200
Scorpion ----&gt;S27 PHY*
S27 reg init
GMAC: cfg1 0x800c0000 cfg2 0x7114
eth0: XX:XX:XX:XX:XX
athrs27_phy_setup ATHR_PHY_CONTROL 4:0x1000
athrs27_phy_setup ATHR_PHY_SPEC_STAUS 4:0x10
eth0 up
Honey Bee ----&gt;  MAC 1 S27 PHY*
S27 reg init
ATHRS27: resetting s27
ATHRS27: s27 reset done
GMAC: cfg1 0x800c0000 cfg2 0x7214
eth1: XXXXXXXXXXXXXXXXXXXXXXX
athrs27_phy_setup ATHR_PHY_CONTROL 0:0x1000
athrs27_phy_setup ATHR_PHY_SPEC_STAUS 0:0x10
athrs27_phy_setup ATHR_PHY_CONTROL 1:0x1000
athrs27_phy_setup ATHR_PHY_SPEC_STAUS 1:0x10
athrs27_phy_setup ATHR_PHY_CONTROL 2:0x1000
athrs27_phy_setup ATHR_PHY_SPEC_STAUS 2:0x10
athrs27_phy_setup ATHR_PHY_CONTROL 3:0x1000
athrs27_phy_setup ATHR_PHY_SPEC_STAUS 3:0x10
eth1 up
eth0, eth1
Setting 0x181162c0 to 0x68d1a100
is_auto_upload_firmware=0
Autobooting in 1 seconds
hb&gt; </code></pre></div><p>Uboot env<br /></p><div class="codebox"><pre><code>hb&gt; printenv
bootargs=console=ttyS0,115200 root=31:02 rootfstype=squashfs init=/sbin/init mtdparts=ath-nor0:128k(u-boot),1024k(kernel),6912k(rootfs),64k(config),64k(art)
bootcmd=bootm 0x9f020000
bootdelay=1
baudrate=115200
ethaddr=XXXXXXXXXXXXXXXXXXXXX
ipaddr=192.168.1.1
serverip=192.168.1.10
dir=
lu=tftp 0x80060000 ${dir}u-boot.bin&amp;&amp;erase 0x9f000000 +$filesize&amp;&amp;cp.b $fileaddr 0x9f000000 $filesize
lf=tftp 0x80060000 ${dir}ap143${bc}-squashfs&amp;&amp;erase 0x9f120000 +$filesize&amp;&amp;cp.b $fileaddr 0x9f120000 $filesize
lk=tftp 0x80060000 ${dir}vmlinux${bc}.lzma.uImage&amp;&amp;erase 0x9f020000 +$filesize&amp;&amp;cp.b $fileaddr 0x9f020000 $filesize
stdin=serial
stdout=serial
stderr=serial
ethact=eth0

Environment size: 676/65532 bytes
hb&gt; bootm 0x9f020000
## Booting image at 9f020000 ...
   Uncompressing Kernel Image ... OK</code></pre></div><p>And the boot up of the stock firmware</p><div class="codebox"><pre><code>Starting kernel ...

Booting QCA953x
Linux version 2.6.31 (tomcat@buildserver) (gcc version 4.3.3 (GCC) ) #42 Wed Aug 6 09:35:14 CST 2014
flash_size passed from bootloader = 8
Ram size passed from bootloader =33554432
CPU revision is: 00019374 (MIPS 24Kc)
ath_sys_frequency: cpu apb ddr apb cpu 550 ddr 392 ahb 196
Determined physical RAM map:
 memory: 02000000 @ 00000000 (usable)
Zone PFN ranges:
  Normal   0x00000000 -&gt; 0x00002000
Movable zone start PFN for each node
early_node_map[1] active PFN ranges
    0: 0x00000000 -&gt; 0x00002000
Built 1 zonelists in Zone order, mobility grouping on.  Total pages: 8128
Kernel command line: console=ttyS0,115200 root=31:2 rootfstype=squashfs init=/sbin/init mtdparts=ath-nor0:128k(u-boot),1024k(kernel),6912k(rootfs),64k(configM
PID hash table entries: 128 (order: 7, 512 bytes)
Dentry cache hash table entries: 4096 (order: 2, 16384 bytes)
Inode-cache hash table entries: 2048 (order: 1, 8192 bytes)
Primary instruction cache 64kB, VIPT, 4-way, linesize 32 bytes.
Primary data cache 32kB, 4-way, VIPT, cache aliases, linesize 32 bytes
Writing ErrCtl register=00000000
Readback ErrCtl register=00000000
Memory: 24128k/32768k available (1614k kernel code, 8640k reserved, 391k data, 108k init, 0k highmem)
NR_IRQS:128
plat_time_init: plat time init done
Calibrating delay loop... 365.56 BogoMIPS (lpj=731136)
Mount-cache hash table entries: 512

****************ALLOC***********************
 Packet mem: 80222240 (0x600000 bytes)
********************************************

NET: Registered protocol family 16
bio: create slab &lt;bio-0&gt; at 0
NET: Registered protocol family 2
IP route cache hash table entries: 1024 (order: 0, 4096 bytes)
net_link: create socket ok.
TCP established hash table entries: 1024 (order: 1, 8192 bytes)
TCP bind hash table entries: 1024 (order: 0, 4096 bytes)
TCP: Hash tables configured (established 1024 bind 1024)
TCP reno registered
NET: Registered protocol family 1
ATH GPIOC major 0
squashfs: version 4.0 (2009/01/31) Phillip Lougher
msgmni has been set to 47
io scheduler noop registered
io scheduler deadline registered (default)
Serial: 8250/16550 driver, 1 ports, IRQ sharing disabled
serial8250.0: ttyS0 at MMIO 0xb8020000 (irq = 19) is a 16550A
console [ttyS0] enabled
PPP generic driver version 2.4.2
NET: Registered protocol family 24
5 cmdlinepart partitions found on MTD device ath-nor0
Creating 5 MTD partitions on &quot;ath-nor0&quot;:
0x000000000000-0x000000020000 : &quot;u-boot&quot;
0x000000020000-0x000000120000 : &quot;kernel&quot;
0x000000120000-0x0000007e0000 : &quot;rootfs&quot;
0x0000007e0000-0x0000007f0000 : &quot;config&quot;
0x0000007f0000-0x000000800000 : &quot;art&quot;
-&gt;Oops: flash id 0xef4017 . 
Ooops, why the devices couldn&#039;t been initialed?
TCP cubic registered
NET: Registered protocol family 17
802.1Q VLAN Support v1.8 Ben Greear &lt;greearb@candelatech.com&gt;
All bugs added by David S. Miller &lt;davem@redhat.com&gt;
athwdt_init: Registering WDT success
VFS: Mounted root (squashfs filesystem) readonly on device 31:2.
Freeing unused kernel memory: 108k freed
init started:  BusyBox v1.01 (2014.08.06-01:38+0000) multi-call binary
This Board use 2.6.31
xt_time: kernel timezone is -0000
nf_conntrack version 0.5.0 (512 buckets, 5120 max)
ip_tables: (C) 2000-2006 Netfilter Core Team
insmod: cannot open module `/lib/modules/2.6.31/kernel/iptable_raw.ko&#039;: No such file or directory
insmod: cannot open module `/lib/modules/2.6.31/kernel/flashid.ko&#039;: No such file or directory
PPPoL2TP kernel driver, V1.0
PPTP driver version 0.8.3
insmod: cannot open module `/lib/modules/2.6.31/kernel/harmony.ko&#039;: No such file or directory
insmod: cannot open module `/lib/modules/2.6.31/kernel/af_key.ko&#039;: No such file or directory
insmod: cannot open module `/lib/modules/2.6.31/kernel/xfrm_user.ko&#039;: No such file or directory
Now flash open!
Now flash open!

 (none) mips #42vlan init params sucess.
 Wed Aug 6 09:35qca955x_GMAC: Length per segment 1536
:14 CST 2014 (no953x_GMAC: qca953x_gmac_attach
ne)
(none) logiLink Int Enabled 
n: qca953x_set_gmac_caps  CHECK DMA STATUS 
mac:1 Registering S27....
qca955x_GMAC: RX TASKLET - Pkts per Intr:32
qca955x_GMAC: Max segments per packet :   1
qca955x_GMAC: Max tx descriptor count :   512
qca955x_GMAC: Max rx descriptor count :   128
qca955x_GMAC: Mac capability flags    :   2D81
953x_GMAC: qca953x_gmac_attach
Link Int Enabled 
qca953x_set_gmac_caps  CHECK DMA STATUS 
mac:0 Registering S27....
qca955x_GMAC: RX TASKLET - Pkts per Intr:32
qca955x_GMAC: Max segments per packet :   1
qca955x_GMAC: Max tx descriptor count :   512
qca955x_GMAC: Max rx descriptor count :   128
qca955x_GMAC: Mac capability flags    :   2581
athr_gmac_ring_alloc Allocated 8192 at 0x81c64000
athr_gmac_ring_alloc Allocated 2048 at 0x81cb1000
HONEYBEE ----&gt; S27 PHY MDIO
Setting Drop CRC Errors, Pause Frames and Length Error frames 
Setting PHY...
athr_gmac_ring_alloc Allocated 8192 at 0x81cce000
athr_gmac_ring_alloc Allocated 2048 at 0x81ebc800
HONEYBEE ----&gt; S27 PHY MDIO
ATHRS27: resetting s27
ATHRS27: s27 reset done
++++ athrs27_igmp_setup once
port0 vid is 0xb000b
port1 vid is 0x30003
port2 vid is 0x50005
port3 vid is 0x70007
port4 vid is 0x90009
++ PVID: 0x0000000b, bitmap: 0x0000001f
++ PVID: 0x00000003, bitmap: 0x0000001f
++ PVID: 0x00000005, bitmap: 0x0000001f
++ PVID: 0x00000007, bitmap: 0x0000001f
++ PVID: 0x00000009, bitmap: 0x0000001f
vtable vid: 0x00000002, bitmap 0x00000003
vtable vid: 0x00000004, bitmap 0x00000005
vtable vid: 0x00000006, bitmap 0x00000007
vtable vid: 0x00000008, bitmap 0x00000009
vtable vid: 0x0000000a, bitmap 0x0000000b
vtable vid: 0x0000000c, bitmap 0x0000000d
vtable vid: 0x0000000e, bitmap 0x0000000f
vtable vid: 0x00000010, bitmap 0x00000011
vtable vid: 0x00000012, bitmap 0x00000013
vtable vid: 0x00000014, bitmap 0x00000015
vtable vid: 0x00000016, bitmap 0x00000017
vtable vid: 0x00000018, bitmap 0x00000019
vtable vid: 0x0000001a, bitmap 0x0000001b
vtable vid: 0x0000001c, bitmap 0x0000001d
vtable vid: 0x0000001e, bitmap 0x0000001f
vtable vid: 0x00000020, bitmap 0x00000021
Setting Drop CRC Errors, Pause Frames and Length Error frames 
Setting PHY...
device eth0 entered promiscuous mode
athr_gmac_ring_free Freeing at 0x81c64000
athr_gmac_ring_free Freeing at 0x81cb1000
athr_gmac_ring_alloc Allocated 8192 at 0x81eee000
athr_gmac_ring_alloc Allocated 2048 at 0x81cb1000
HONEYBEE ----&gt; S27 PHY MDIO
Setting Drop CRC Errors, Pause Frames and Length Error frames 
Setting PHY...
Now flash open!
athr_gmac_ring_free Freeing at 0x81cce000
athr_gmac_ring_free Freeing at 0x81ebc800
athr_gmac_ring_alloc Allocated 8192 at 0x81c5a000
athr_gmac_ring_alloc Allocated 2048 at 0x81ebc800
HONEYBEE ----&gt; S27 PHY MDIO
Setting Drop CRC Errors, Pause Frames and Length Error frames 
Setting PHY...
nf_conntrack_rtsp v0.6.21 loading
nf_nat_rtsp v0.6.21 loading
adf: module license &#039;Proprietary&#039; taints kernel.
Disabling lock debugging due to kernel taint
ath_hal: 0.9.17.1 (AR5416, AR9380, REGOPS_FUNC, WRITE_EEPROM, 11D)
ath_rate_atheros: Copyright (c) 2001-2005 Atheros Communications, Inc, All Rights Reserved
ath_dev: Copyright (c) 2001-2007 Atheros Communications, Inc, All Rights Reserved
ath_ahb: 9.5.3.16 (Atheros/multi-bss)
Enterprise mode: 0x03fc0000
Restoring Cal data from Flash
ath_get_caps[5872] rx chainmask mismatch actual 3 sc_chainmak 0
ath_get_caps[5847] tx chainmask mismatch actual 3 sc_chainmak 0
ATH_RESERVED_TXBUF = 1000
wifi0: Atheros ???: mem=0xb8100000, irq=2
ath_pci: 9.5.3.16 (Atheros/multi-bss)
VAP device ath0 created 
Setting Max Stations:32
        DCS for CW interference mitigation:   0
        DCS for WLAN interference mitigation: 0
 
 DES SSID SET=trangtrinh 
 ieee80211_ioctl_siwmode: imr.ifm_active=131712, new mode=3, valid=1 
athr_gmac_ring_free Freeing at 0x81c5a000
athr_gmac_ring_free Freeing at 0x81ebc800
br0: port 1(eth0) entering disabled state
athr_gmac_ring_alloc Allocated 8192 at 0x81636000
athr_gmac_ring_alloc Allocated 2048 at 0x81ebc800
HONEYBEE ----&gt; S27 PHY MDIO
Setting Drop CRC Errors, Pause Frames and Length Error frames 
Setting PHY...
device ath0 entered promiscuous mode
br0: port 2(ath0) entering forwarding state
 ieee80211_ioctl_siwmode: imr.ifm_active=393856, new mode=3, valid=1 
br0: port 2(ath0) entering disabled state
 
 DES SSID SET=XXXXXXXX
br0: port 2(ath0) entering forwarding state
qca955x_GMAC: GE0 RX DMA ENABLE
blockWps_proc_write 806: write value = 0

 TL-WR841N mips #42 Wed Aug 6 09:35:14 CST 2014 (none)
TL-WR841N login: ap143
Password: 
Login incorrect
TL-WR841N login: root
Password: 
Login incorrect</code></pre></div><p>I will update the second post on this thread to be a guide on howto install openwrt on this router version.</p><p>Anyone with tips or suggestions please comment below.</p>											<p class="post-edited">(Last edited by <strong>hojuruku</strong> on 22 Jun 2016, 15:05)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p329455">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">hojuruku</div>
					<div class="post-datetime">
						22 Jun 2016, 15:04					</div>
				</div>
				<div class="post-content content">
					<p>Placeholder (will edit) for a howto document with detailed instructions on how to set up openwrt on this router without using a serial console. </p><p>*Work In Progress*</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p329508">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">hojuruku</div>
					<div class="post-datetime">
						23 Jun 2016, 02:16					</div>
				</div>
				<div class="post-content content">
					<p>As this thread for the time being is *WIP* (Work in Progress) before it evolves into a HOWTO as per the forum rules here is the status update.</p><p>I&#039;ll be upgrading the bootloader later as the flash chip used is supported (Winbond W25Q64)</p><p>But first of all I need to get the TP-Link firmware to find out what signature it checks for when doing a factory flash update. There are two ways apart from JTAG or soldering to get the rom that I&#039;ll be having a crack at. One crazy way of doing it is through the md (Memory Display) command in ye old das uboot. Other&#039;s have done it that way for the amazon kindle way back in 2007, but it&#039;s a bit time consuming and takes 1000s of serial commands and some perl or python scripting.</p><p>What I&#039;ll try instead first up is booting the thing via tftpboot, and having a lite openwrt installed in a kernel initrd instead of a flash filesystem. That will let me get the flash rom drivers tested and I can dump the flash over the network that way. I would have done this already but for a day long blackout back at home.</p><p>This will also hopefully get us the root password for all the newer TP-LINK router factory roms. It may require some wordlists / hacking but it wont take long if it&#039;s another 3 digit password.<br /><a href="https://forum.openwrt.org/viewtopic.php?pid=329461#p329461">https://forum.openwrt.org/viewtopic.php … 61#p329461</a><br /></p><div class="quotebox"><cite>hojuruku wrote:</cite><blockquote><p>pepe2K:<br />.....<br />The root password is different to other TP-LINK OEM Firmwares. Root/5up doesn&#039;t work as with the newer tp-link models either.<br /><a href="https://wiki.openwrt.org/toh/tp-link/tl-wdr4300">https://wiki.openwrt.org/toh/tp-link/tl-wdr4300</a><br /><a href="https://wiki.openwrt.org/toh/tp-link/tl-mr3020">https://wiki.openwrt.org/toh/tp-link/tl-mr3020</a> &lt;- as it did on the old</p></blockquote></div><p>Can someone take a look at the uboot printenv and confirm what partitioning scheme the factory rom uses? Is it using command line mtd partitions?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p329555">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">andy wang</div>
					<div class="post-datetime">
						23 Jun 2016, 12:48					</div>
				</div>
				<div class="post-content content">
					<p>Thank you for kindly sharing.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p330161">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">hojuruku</div>
					<div class="post-datetime">
						29 Jun 2016, 22:49					</div>
				</div>
				<div class="post-content content">
					<p>I have extracted the full flash rom image of this factory model. <br />If you want to know how to do it using u-boot only without root to a factory router&#039;s rom <a href="https://forum.openwrt.org/viewtopic.php?pid=330153#p330153">click here</a>.</p><p>The new tp-link root/5up replacement password is... we&#039;ll we&#039;ll get around to hash cracking it soon. Who wants to try beat me to it?</p><div class="codebox"><pre><code>root:$1$GTN.gpri$DlSyKvZKMR9A9Uj9e9wR3/:15502:0:99999:7:::</code></pre></div><p>Now to split up the rom. Note that these image files may have some padding at the end. Tp-link has a fixed cmdline partition structure that will probably be ignored when openwrt runs on this toy.<br /></p><div class="codebox"><pre><code>dd if=routerbackup.bin of=squashfs.img bs=65536 skip=18 count=108
dd if=routerbackup.bin of=kernel.img bs=65536 skip=2 count=16
dd if=routerbackup.bin of=uboot.img bs=65536 count=2</code></pre></div><p>The squashfs extracts nicely with squashfs tools that supports lzma. </p><p>Kernel file <br /></p><div class="codebox"><pre><code>00000000  01 00 00 00 54 50 2d 4c  49 4e 4b 20 54 65 63 68  |....TP-LINK Tech|
00000010  6e 6f 6c 6f 67 69 65 73  00 00 00 00 76 65 72 2e  |nologies....ver.|
00000020  20 31 2e 30 00 00 00 00  00 00 00 00 00 00 00 00  | 1.0............|
00000030  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000040  08 41 01 09 00 00 00 01  00 00 00 00 a6 41 a7 b8  |.A...........A..|
00000050  3d bd 55 0d 65 d2 50 71  7b 9a ba 57 00 00 00 00  |=.U.e.Pq{..W....|
00000060  d1 b7 1d de 5d f0 cf cb  58 3c 6e 43 2a f3 e8 8f  |....]...X&lt;nC*...|
00000070  00 00 00 00 80 00 20 00  80 19 1f 70 00 7c 00 00  |...... ....p.|..|
00000080  00 00 02 00 00 0b 59 40  00 10 00 00 00 6c 00 00  |......Y@.....l..|
00000090  00 00 00 00 00 00 00 00  00 03 00 0f 00 09 00 00  |................|
000000a0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
00000200  5d 00 00 00 02 40 0d 21  00 00 00 00 00 00 00 6f  |]....@.!.......o|
00000210  fd ff ff a3 b7 7f 63 c5  55 7e bc 4d 37 52 96 27  |......c.U~.M7R.&#039;|
00000220  37 85 77 0a 76 7c 9c ea  33 4a 4b eb b9 9b 7a 11  |7.w.v|..3JK...z.|
00000230  fb ce b9 a8 c1 a8 b2 23  a0 2a f2 cf 86 2c d3 aa  |.......#.*...,..|</code></pre></div><p>I can&#039;t extract the kernel yet but maybe I will soon, it looks lzma based. Ah yes uboot uimage.<br /></p><div class="codebox"><pre><code>./dumpimage -l /home/lmc/kernel.img foo
./dumpimage: Bad Magic Number: &quot;/home/lmc/kernel.img&quot; is no valid image
GP Header: Size 1000000 LoadAddr 54502d4c
lzmainfo kernel.img 

kernel.img
Uncompressed size:             5781104944277 MB (6061927898049949008 bytes)
Dictionary size:               1344 MB (2^30 bytes)
Literal context bits (lc):     1
Literal pos bits (lp):         0
Number of pos bits (pb):       0</code></pre></div><p>The factory router image has a /web/oem/model.conf (binary) which may be useful to know how it works (using a decompiler) to port more tp-link models to openwrt. The firmware upgrade process is managed by the custom httpd binary on installed on the factory rom. The binary can be decompiled. The model.conf has no ASCII in it. The problem with this router is there is no downloadable upgrade firmware images that I&#039;ve found so far.</p><p>I&#039;ll have to repeat the process on another new router that has a firmware downloadable image and see what the relation is to these files and the headers in the factory.bin TP-Link OEM firmwares.</p><p><a href="http://filebin.ca/2mMhFJ6Yb5u7/841nd-vn-8mb-rom-images.tar.bz2">http://filebin.ca/2mMhFJ6Yb5u7/841nd-vn … es.tar.bz2</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p331331">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">hojuruku</div>
					<div class="post-datetime">
						12 Jul 2016, 22:33					</div>
				</div>
				<div class="post-content content">
					<p>Yay how to get your TP-Link Hardware ID, as shown from /lib/ar71xx.sh</p><p>TP Link Hardware ID: <br />dd if=kernel.img bs=4 count=1 skip=16 2&gt;/dev/null | hexdump -v -n 4 -e &#039;1/1 &quot;%02x&quot;&#039;<br />08410109<br />TP LInk: Model ID<br />dd if=kernel.img bs=4 count=1 skip=17 2&gt;/dev/null | hexdump -v -n 4 -e &#039;1/1 &quot;%02x&quot;&#039;<br />00000001</p><p>Now to see if I can make an openwrt factory rom for it <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p331452">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">hojuruku</div>
					<div class="post-datetime">
						13 Jul 2016, 21:18					</div>
				</div>
				<div class="post-content content">
					<p>Wow first bootlog from factory firmware console upgrade through factory.bin through to openwrt first boot......</p><div class="codebox"><pre><code>Now flash open!
Erase from 0X20000 to 0X7E0000:............................................................................................................................
Program from 0X20000 to 0X7E0000:............................................................................................................................
write successfully
reboot in 20s...
file: drivers/mtd/devices/ath_flash_ioctl.c,line: 86==: set wdt, CPU will be reset in 20 seconds.
CPU 0 Unable to handle kernel paging request at virtual address c0020bc8, epc == 800cd60c, ra == 800cd584
Oops[#1]:
Cpu 0
$ 0   : 00000000 80210000 c0020bc8 00020000
$ 4   : fffe3d98 00003d98 fffe0000 80006000
$ 8   : 00002000 801f5ddc 00000000 7979aea9
$12   : 8174d2d8 0000007f 000028ef 801f0404
$16   : 00003d97 00000006 00000000 c0e27644
$20   : 00002960 0000000a 00003d98 c0022000
$24   : 00000001 80011144                  
$28   : 81698000 81699af0 c0e27000 800cd584
Hi    : 00000002
Lo    : 00000000
epc   : 800cd60c unlzma+0xe48/0xf7c
    Tainted: P          
ra    : 800cd584 unlzma+0xdc0/0xf7c
Status: 1000ff03    KERNEL EXL IE 
Cause : 00800008
BadVA : c0020bc8
PrId  : 00019374 (MIPS 24Kc)
Modules linked in: ct_flush(P) umac ath_dev(P) ath_rate_atheros(P) ath_hal(P) asf(P) adf(P) nf_nat_sip nf_conntrack_sip nf_nat_rtsp nf_conntrack_rtsp nf_nat_h323 nf_nat_tftp nf_s
Process httpd (pid: 643, threadinfo=81698000, task=8174d2a8, tls=00000000)
Stack : 81040078 00000002 80091750 8177b800 00000006 0000001b 0000001e 6d000200
        00000000 00000200 00000000 00000000 c0000df7 c0000000 c0008089 00008089
        21fe2662 2385e568 2385e568 00000004 0000022c 001a0fdc 00000fd4 00000000
        c0000000 00000003 00000003 00000001 00000000 c0e27644 c0e27a68 c0e27664
        00000007 800968b8 80220000 00000021 8177b884 00000000 00000000 c0008089
        ...
Call Trace:
[&lt;800cd60c&gt;] unlzma+0xe48/0xf7c
[&lt;800b37c4&gt;] lzma_uncompress+0x134/0x268
[&lt;800afd38&gt;] squashfs_read_data+0x3f8/0x5e0
[&lt;800b05ec&gt;] squashfs_cache_get+0x1c4/0x2f4
[&lt;800b1544&gt;] squashfs_readpage+0x550/0x85c
[&lt;80054d5c&gt;] __do_page_cache_readahead+0x1d8/0x23c
[&lt;80054de8&gt;] ra_submit+0x28/0x34
[&lt;8004ca90&gt;] filemap_fault+0x1f8/0x40c
[&lt;8005cd1c&gt;] __do_fault+0x70/0x44c
[&lt;8005e4b8&gt;] handle_mm_fault+0x324/0xb50
[&lt;8000fb70&gt;] do_page_fault+0x100/0x2f0
[&lt;80005e80&gt;] ret_from_exception+0x0/0xc


Code: 5040fffe  00832021  02e41021 &lt;90500000&gt; 02f41021  a0500000  8fa400bc  1080000d  26940001 
file: drivers/mtd/devices/ath_flash_ioctl.c,line: 74==:CPU will be reset now! --debug by HouXB
�

U-Boot 1.1.4 (Build from LSDK-9.5.3.16 at Aug  6 2014 - 09:33:12)

ap143 - Honey Bee 1.1

DRAM:   32 MB
Flash Manuf Id 0xef, DeviceId0 0x40, DeviceId1 0x17
Flash:  8 MB
Using default environment

In:    serial
Out:   serial
Err:   serial
Net:   ath_gmac_enet_initialize...
ath_gmac_enet_initialize: reset mask:0xc02200
Scorpion ----&gt;S27 PHY*
S27 reg init
GMAC: cfg1 0x800c0000 cfg2 0x7114
eth0: ba:be:fa:ce:08:41
athrs27_phy_setup ATHR_PHY_CONTROL 4:0x1000
athrs27_phy_setup ATHR_PHY_SPEC_STAUS 4:0x10
eth0 up
Honey Bee ----&gt;  MAC 1 S27 PHY*
S27 reg init
ATHRS27: resetting s27
ATHRS27: s27 reset done
GMAC: cfg1 0x800c0000 cfg2 0x7214
eth1: ba:be:fa:ce:08:41
athrs27_phy_setup ATHR_PHY_CONTROL 0:0x1000
athrs27_phy_setup ATHR_PHY_SPEC_STAUS 0:0x10
athrs27_phy_setup ATHR_PHY_CONTROL 1:0x1000
athrs27_phy_setup ATHR_PHY_SPEC_STAUS 1:0x10
athrs27_phy_setup ATHR_PHY_CONTROL 2:0x1000
athrs27_phy_setup ATHR_PHY_SPEC_STAUS 2:0x10
athrs27_phy_setup ATHR_PHY_CONTROL 3:0x1000
athrs27_phy_setup ATHR_PHY_SPEC_STAUS 3:0x10
eth1 up
eth0, eth1
Setting 0x181162c0 to 0x68d1a100
is_auto_upload_firmware=0
Autobooting in 1 seconds
## Booting image at 9f020000 ...
   Uncompressing Kernel Image ... OK

Starting kernel ...

Linux version 4.4.14 (lmc@hojuruku) (gcc version 5.3.0 (OpenWrt GCC 5.3.0 49810) ) #1 Wed Jul 13 17:47:50 UTC 2016
bootconsole [early0] enabled
CPU0 revision is: 00019374 (MIPS 24Kc)
SoC: Qualcomm Atheros QCA9533 ver 1 rev 1
Determined physical RAM map:
 memory: 02000000 @ 00000000 (usable)
Initrd not found or empty - disabling initrd
No valid device tree found, continuing without
Zone ranges:
  Normal   [mem 0x0000000000000000-0x0000000001ffffff]
Movable zone start for each node
Early memory node ranges
  node   0: [mem 0x0000000000000000-0x0000000001ffffff]
Initmem setup node 0 [mem 0x0000000000000000-0x0000000001ffffff]
Reserving 0MB of memory at 0MB for crashkernel
Primary instruction cache 64kB, VIPT, 4-way, linesize 32 bytes.
Primary data cache 32kB, 4-way, VIPT, cache aliases, linesize 32 bytes
Built 1 zonelists in Zone order, mobility grouping on.  Total pages: 8128
Kernel command line:  board=TL-WR841N-v9 mtdparts=spi0.0:128k(u-boot)ro,1024k(kernel),6912k(rootfs),64k(config)ro,64k(art)ro,7936k@0x20000(firmware)  console=ttyS0,115200 rootfsd
PID hash table entries: 128 (order: -3, 512 bytes)
Dentry cache hash table entries: 4096 (order: 2, 16384 bytes)
Inode-cache hash table entries: 2048 (order: 1, 8192 bytes)
Writing ErrCtl register=00000000
Readback ErrCtl register=00000000
Memory: 28316K/32768K available (2927K kernel code, 109K rwdata, 360K rodata, 180K init, 137K bss, 4452K reserved, 0K cma-reserved)
NR_IRQS:51
Clocks: CPU:550.000MHz, DDR:392.724MHz, AHB:196.362MHz, Ref:25.000MHz
clocksource: MIPS: mask: 0xffffffff max_cycles: 0xffffffff, max_idle_ns: 6950037990 ns
sched_clock: 32 bits at 275MHz, resolution 3ns, wraps every 7809031678ns
Calibrating delay loop... 366.18 BogoMIPS (lpj=1830912)
pid_max: default: 32768 minimum: 301
Mount-cache hash table entries: 1024 (order: 0, 4096 bytes)
Mountpoint-cache hash table entries: 1024 (order: 0, 4096 bytes)
clocksource: jiffies: mask: 0xffffffff max_cycles: 0xffffffff, max_idle_ns: 19112604462750000 ns
NET: Registered protocol family 16
MIPS: machine is TP-LINK TL-WR841N/ND v9
clocksource: Switched to clocksource MIPS
NET: Registered protocol family 2
TCP established hash table entries: 1024 (order: 0, 4096 bytes)
TCP bind hash table entries: 1024 (order: 0, 4096 bytes)
TCP: Hash tables configured (established 1024 bind 1024)
UDP hash table entries: 256 (order: 0, 4096 bytes)
UDP-Lite hash table entries: 256 (order: 0, 4096 bytes)
NET: Registered protocol family 1
futex hash table entries: 256 (order: -1, 3072 bytes)
squashfs: version 4.0 (2009/01/31) Phillip Lougher
jffs2: version 2.2 (NAND) (SUMMARY) (LZMA) (RTIME) (RUBIN) (CMODE_SIZE) (c) 2001-2006 Red Hat, Inc.
io scheduler noop registered
io scheduler deadline registered (default)
crc32: CRC_LE_BITS = 32, CRC_BE BITS = 32
crc32: self tests passed, processed 225944 bytes in 2904763 nsec
crc32c: CRC_LE_BITS = 32
crc32c: self tests passed, processed 225944 bytes in 1452262 nsec
crc32_combine: 8373 self tests passed
crc32c_combine: 8373 self tests passed
Serial: 8250/16550 driver, 1 ports, IRQ sharing disabled
console [ttyS0] disabled
serial8250.0: ttyS0 at MMIO 0x18020000 (irq = 11, base_baud = 1562500) is a 16550A
console [ttyS0] enabled
console [ttyS0] enabled
bootconsole [early0] disabled
bootconsole [early0] disabled
m25p80 spi0.0: found s25fl064k, expected m25p80
m25p80 spi0.0: s25fl064k (8192 Kbytes)
5 tp-link partitions found on MTD device spi0.0
Creating 5 MTD partitions on &quot;spi0.0&quot;:
0x000000000000-0x000000020000 : &quot;u-boot&quot;
0x000000020000-0x000000147d28 : &quot;kernel&quot;
0x000000147d28-0x0000007f0000 : &quot;rootfs&quot;
mtd: device 2 (rootfs) set to be root filesystem
1 squashfs-split partitions found on MTD device rootfs
0x000000520000-0x0000007f0000 : &quot;rootfs_data&quot;
0x0000007f0000-0x000000800000 : &quot;art&quot;
0x000000020000-0x0000007f0000 : &quot;firmware&quot;
libphy: ag71xx_mdio: probed
ag71xx-mdio.1: Found an AR934X built-in switch
eth0: Atheros AG71xx at 0xba000000, irq 5, mode:GMII
ag71xx ag71xx.0: connected to PHY at ag71xx-mdio.1:04 [uid=004dd042, driver=Generic PHY]
eth1: Atheros AG71xx at 0xb9000000, irq 4, mode:MII
ledtrig-cpu: registered to indicate activity on CPUs
NET: Registered protocol family 10
NET: Registered protocol family 17
bridge: automatic filtering via arp/ip/ip6tables has been deprecated. Update your scripts to load br_netfilter if you need this.
8021q: 802.1Q VLAN Support v1.8
VFS: Mounted root (squashfs filesystem) readonly on device 31:2.
Freeing unused kernel memory: 180K (803b3000 - 803e0000)
init: Console is alive
init: - watchdog -
init: - preinit -
IPv6: ADDRCONF(NETDEV_UP): eth0: link is not ready
random: procd urandom read with 10 bits of entropy available
Press the [f] key and hit [enter] to enter failsafe mode
Press the [1], [2], [3] or [4] key and hit [enter] to select the debug level
eth0: link up (1000Mbps/Full duplex)
IPv6: ADDRCONF(NETDEV_CHANGE): eth0: link becomes ready
mount_root: Could not open mtd device: /dev/mtd2
mount_root: reading rootfs failed
mount_root: jffs2 not ready yet, using temporary tmpfs overlay
eth0: link down
procd: - early -
procd: - watchdog -
procd: - ubus -
procd: - init -
Please press Enter to activate this console.
zram: Added device: zram0
Initializing XFRM netlink socket
NET: Registered protocol family 15
nbd: registered device at major 43
tun: Universal TUN/TAP device driver, 1.6
tun: (C) 1999-2004 Max Krasnyansky &lt;maxk@qualcomm.com&gt;
ipip: IPv4 over IPv4 tunneling driver
l2tp_core: L2TP core driver, V2.0
l2tp_netlink: L2TP netlink interface
sit: IPv6 over IPv4 tunneling driver
IPv4 over IPsec tunneling driver
l2tp_eth: L2TP ethernet pseudowire support (L2TPv3)
l2tp_ip: L2TP IP encapsulation support (L2TPv3)
l2tp_ip6: L2TP IP encapsulation support for IPv6 (L2TPv3)
nat46: module (version 8ff2ae59ec9840a7b8b45f976c51cae80abe0226) loaded.
gre: GRE over IPv4 demultiplexor driver
ip_gre: GRE over IPv4 tunneling driver
ip6_gre: GRE over IPv6 tunneling driver
ip6_tables: (C) 2000-2006 Netfilter Core Team
Netfilter messages via NETLINK v0.30.
ip_set: protocol 6
cryptodev: driver 1.8 loaded.
Loading modules backported from Linux version wt-2016-05-12-0-g7a54796
Backport generated by backports.git backports-20160216-0-ge3c56e4
ip_tables: (C) 2000-2006 Netfilter Core Team
nf_conntrack version 0.5.0 (445 buckets, 1780 max)
ctnetlink v0.93: registering with nfnetlink.
xt_time: kernel timezone is -0000
PPP generic driver version 2.4.2
PPP MPPE Compression module registered
NET: Registered protocol family 24
PPTP driver version 0.8.5
l2tp_ppp: PPPoL2TP kernel driver, V2.0
ieee80211 phy0: Atheros AR9531 Rev:1 mem=0xb8100000, irq=47



BusyBox v1.24.2 () built-in shell (ash)

  _______                     ________        __
 |       |.-----.-----.-----.|  |  |  |.----.|  |_
 |   -   ||  _  |  -__|     ||  |  |  ||   _||   _|
 |_______||   __|_____|__|__||________||__|  |____|
          |__| W I R E L E S S   F R E E D O M
 -----------------------------------------------------
 DESIGNATED DRIVER (Bleeding Edge, 49810)
 -----------------------------------------------------
  * 2 oz. Orange Juice         Combine all juices in a
  * 2 oz. Pineapple Juice      tall glass filled with
  * 2 oz. Grapefruit Juice     ice, stir well.
  * 2 oz. Cranberry Juice
 -----------------------------------------------------
root@OpenWrt:/# jffs2_scan_eraseblock(): End of filesystem marker found at 0x0
jffs2_build_filesystem(): unlocking the mtd device... done.
jffs2_build_filesystem(): erasing all blocks after the end marker... 
device eth0 entered promiscuous mode
IPv6: ADDRCONF(NETDEV_UP): br-lan: link is not ready
IPv6: ADDRCONF(NETDEV_UP): eth1: link is not ready
eth0: link up (1000Mbps/Full duplex)
br-lan: port 1(eth0) entered forwarding state
br-lan: port 1(eth0) entered forwarding state
IPv6: ADDRCONF(NETDEV_CHANGE): br-lan: link becomes ready
br-lan: port 1(eth0) entered forwarding state</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p331472">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">hojuruku</div>
					<div class="post-datetime">
						13 Jul 2016, 23:06					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ll update the howto (2nd post in this thread) once the next openwrt comes out that builds images for this router.<br />Can someone with access to the openwrt wiki update the toh (table of hardware)<br /><a href="https://wiki.openwrt.org/toh/tp-link/tl-wr841nd">https://wiki.openwrt.org/toh/tp-link/tl-wr841nd</a></p><p><a href="https://github.com/openwrt/openwrt/pull/29">https://github.com/openwrt/openwrt/pull/29</a><br /></p><div class="quotebox"><cite>hojuruku pull request wrote:</cite><blockquote><p>Please see the commit message or the forum. This has been run-tested on the new hardware which is basically the same as a v9 board just with the larger flash size</p><p>Users can install factory.bin&#039;s via tp-link firmware, or use sysupgrade - both tested successfully. As you can see from the factory rom extracted via uboot, it really does have different HWID&#039;s used by tp-link to distinguish the OEM order for larger flash size. They add a 1 at the end of the HWID to denote that.</p><p>If a user bricks a tp-link 841nd v9 , the factory bootloader has a tftp recovery method as demonstrated. In any case -v9-vn firmware will not install on -v9 firwmare and visa versa. There isn&#039;t much need for pico&#039;&#039;s patched u-boot I think, except for the frills of a web-browser to upgrade the flash and loosing your Ethernet mac address.</p><p><a href="https://www.youtube.com/watch?v=0k1sxwX5pMk">https://www.youtube.com/watch?v=0k1sxwX5pMk</a></p></blockquote></div><p><a href="https://github.com/openwrt/openwrt/pull/29/commits/84c616f66390230a2938f8db691e8093f1669ec2">https://github.com/openwrt/openwrt/pull … 93f1669ec2</a><br /></p><div class="quotebox"><cite>hojuruku - commit wrote:</cite><blockquote><p>&nbsp; &nbsp; I had put off for a year reflashing a tp-link router that doesn&#039;t even<br />&nbsp; &nbsp; take firmware upgrades from the tp-link website. I still have the box<br />&nbsp; &nbsp; for this one it is packaged as a TP-Link 841n v9, unless the UPC<br />&nbsp; &nbsp; barcodes and model numbers are different on the box.<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; The box has a Viettel (ISP) sticker on it for service locations.<br />&nbsp; &nbsp; The TP-Link factory sticker with the serial number says<br />&nbsp; &nbsp; &quot;Model: TL-WR841N Ver:9.2<br />&nbsp; &nbsp; S/N:214xxx<br />&nbsp; &nbsp; P/N: 1750502106&quot; I wonder if other people who bought a standard 9.2 have<br />&nbsp; &nbsp; the same part number.<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; The TP-Link web-ui shows 8MB flash.<br />&nbsp; &nbsp; The hardware/hacking howto install openwrt thread is here. The second<br />&nbsp; &nbsp; post placeholder will be updated shortly once the pull request is<br />&nbsp; &nbsp; approved.<br />&nbsp; &nbsp; <a href="https://forum.openwrt.org/viewtopic.php?id=65786">https://forum.openwrt.org/viewtopic.php?id=65786</a><br />&nbsp; &nbsp; <br />&nbsp; &nbsp; Even thought he TP_Link HWID is different of this TP-Link router, hence standard<br />&nbsp; &nbsp; openwrt v9 and TP-Link factory images are not supported the hardware is<br />&nbsp; &nbsp; identical to all aspects of the v9 except for the flash, even the switch<br />&nbsp; &nbsp; quick or numbering the ports backwards. They added a 1 to show larger<br />&nbsp; &nbsp; flash size. This may pop up again with other ISP OEM versions with<br />&nbsp; &nbsp; larger flash. I might analyse / compare the squashfs out of curiorisity<br />&nbsp; &nbsp; to find out what the ISP is adding, or is it just a newer stock<br />&nbsp; &nbsp; firmwware version with<br />&nbsp; &nbsp; IPV6 support they added for their IPTV system they are rolling out.<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; Previously openwrt accounted for Chinese variants. I can&#039;t confirm if<br />&nbsp; &nbsp; this is a Chinese variant, as it&#039;s only popped up in Vietnam from my<br />&nbsp; &nbsp; research hence the name of the sysupgrade / factory bin files.<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; When upgrading from factory firmware one should rename the openwrt<br />&nbsp; &nbsp; filename to something shorter ending with bin to appease the javascript that comes with<br />&nbsp; &nbsp; the factory rom.<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; root@OpenWrt:/# cat /tmp/sysinfo/model<br />&nbsp; &nbsp; TP-Link TL-WR841N/ND v9.2vn<br />&nbsp; &nbsp; root@OpenWrt:/# cat /tmp/sysinfo/board_name<br />&nbsp; &nbsp; tl-wr841n-v9</p><p>&nbsp; &nbsp; It&#039;s the board= /tmp/sysinfo/board_name that&#039;s used for all the kernel scripts to configure<br />&nbsp; &nbsp; switch etc on first boot, at least for the tl-wr841n-v9, not many<br />&nbsp; &nbsp; changes were required for this router.<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; I understand the openwrt images will not include luci by default. If you<br />&nbsp; &nbsp; want to enable luci by default for this one, then maybe a new buildroot<br />&nbsp; &nbsp; profile for the device needs to be created.<br />&nbsp; &nbsp; I can add that to the patch if you want, is<br />&nbsp; &nbsp; there any suggestions to use for a template?</p><p>&nbsp; &nbsp; I expect this isn&#039;t required, as people can just install via jffs, and compiling their own version is <br />&nbsp; &nbsp; preferred because you can set SQUASHFS block size to 1MB on this puppy with 1-2 cached squashfs blocks<br />&nbsp; &nbsp; in the kernel instead of 3 you can really squeeze a lot of stuff in.<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; I might distribute a version I compiled to the vietnamese users with an<br />&nbsp; &nbsp; alternative opkg location, or is that against the rules?<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; The mtdparts kernel command line may not be required but it doesn&#039;t hurt<br />&nbsp; &nbsp; tp-link partitions are used by default and the factory rom passed<br />&nbsp; &nbsp; something very similar to the factory kernel on this router if you see<br />&nbsp; &nbsp; the uboot printenv on the forum.</p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p333701">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">hoatienii</div>
					<div class="post-datetime">
						8 Aug 2016, 20:32					</div>
				</div>
				<div class="post-content content">
					<p>i have 2 ver 9.2 8M flash, could you help me install openwrt.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p340240">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">hojuruku</div>
					<div class="post-datetime">
						5 Oct 2016, 06:03					</div>
				</div>
				<div class="post-content content">
					<p>Wow if I log into my censored github account I can still see PR/29 but nobody else can so here it is seeing it&#039;s been hidden from the rest of the internet.<br />If you patch the source then you can install without attaching a serial cable like I had to. <br />If you nag openwrt to merge the &quot;secret&quot; pull request #29, then the distro roms will include a 841-v9-vn rom image.</p><p>The Vietnamese version is the SAME as the regular V9 except for more ram and a different hardware ID in the factory roms. Maybe the bootloader is patched too but I haven&#039;t investigated, hence the small number of changes to make this router work on openwrt. Approving the pull request was a no brainer - I don&#039;t know why they didn&#039;t do it in the 8 weeks they had until my account was censored.</p><br /><p> ar71xx: add tp-link 841nd-v9-vn board - 8mbit flash isp oem variant</p><p>&nbsp; &nbsp; I had put off for a year reflashing a tp-link router that doesn&#039;t even<br />&nbsp; &nbsp; take firmware upgrades from the tp-link website. I still have the box<br />&nbsp; &nbsp; for this one it is packaged as a TP-Link 841n v9, unless the UPC<br />&nbsp; &nbsp; barcodes and model numbers are different on the box.</p><p>&nbsp; &nbsp; The box has a Viettel (ISP) sticker on it for service locations.<br />&nbsp; &nbsp; The TP-Link factory sticker with the serial number says<br />&nbsp; &nbsp; &quot;Model: TL-WR841N Ver:9.2<br />&nbsp; &nbsp; S/N:214xxx<br />&nbsp; &nbsp; P/N: 1750502106&quot; I wonder if other people who bought a standard 9.2 have<br />&nbsp; &nbsp; the same part number.</p><p>&nbsp; &nbsp; The TP-Link web-ui shows 8MB flash.<br />&nbsp; &nbsp; The hardware/hacking howto install openwrt thread is here. The second<br />&nbsp; &nbsp; post placeholder will be updated shortly once the pull request is<br />&nbsp; &nbsp; approved.<br />&nbsp; &nbsp; <a href="https://forum.openwrt.org/viewtopic.php?id=65786">https://forum.openwrt.org/viewtopic.php?id=65786</a></p><p>&nbsp; &nbsp; Even thought he TP_Link HWID is different of this TP-Link router, hence standard<br />&nbsp; &nbsp; openwrt v9 and TP-Link factory images are not supported the hardware is<br />&nbsp; &nbsp; identical to all aspects of the v9 except for the flash, even the switch<br />&nbsp; &nbsp; quick or numbering the ports backwards. They added a 1 to show larger<br />&nbsp; &nbsp; flash size. This may pop up again with other ISP OEM versions with<br />&nbsp; &nbsp; larger flash. I might analyse / compare the squashfs out of curiorisity<br />&nbsp; &nbsp; to find out what the ISP is adding, or is it just a newer stock<br />&nbsp; &nbsp; firmwware version with<br />&nbsp; &nbsp; IPV6 support they added for their IPTV system they are rolling out.</p><p>&nbsp; &nbsp; Previously openwrt accounted for Chinese variants. I can&#039;t confirm if<br />&nbsp; &nbsp; this is a Chinese variant, as it&#039;s only popped up in Vietnam from my<br />&nbsp; &nbsp; research hence the name of the sysupgrade / factory bin files.</p><p>&nbsp; &nbsp; When upgrading from factory firmware one should rename the openwrt<br />&nbsp; &nbsp; filename to something shorter ending with bin to appease the javascript that comes with<br />&nbsp; &nbsp; the factory rom.</p><p>&nbsp; &nbsp; root@OpenWrt:/# cat /tmp/sysinfo/model<br />&nbsp; &nbsp; TP-Link TL-WR841N/ND v9.2vn<br />&nbsp; &nbsp; root@OpenWrt:/# cat /tmp/sysinfo/board_name<br />&nbsp; &nbsp; tl-wr841n-v9</p><p>&nbsp; &nbsp; It&#039;s the board= /tmp/sysinfo/board_name that&#039;s used for all the kernel scripts to configure<br />&nbsp; &nbsp; switch etc on first boot, at least for the tl-wr841n-v9, not many<br />&nbsp; &nbsp; changes were required for this router.</p><p>&nbsp; &nbsp; I understand the openwrt images will not include luci by default. If you<br />&nbsp; &nbsp; want to enable luci by default for this one, then maybe a new buildroot<br />&nbsp; &nbsp; profile for the device needs to be created.<br />&nbsp; &nbsp; I can add that to the patch if you want, is<br />&nbsp; &nbsp; there any suggestions to use for a template?</p><p>&nbsp; &nbsp; I expect this isn&#039;t required, as people can just install via jffs, and compiling their own version is<br />&nbsp; &nbsp; preferred because you can set SQUASHFS block size to 1MB on this puppy with 1-2 cached squashfs blocks<br />&nbsp; &nbsp; in the kernel instead of 3 you can really squeeze a lot of stuff in.</p><p>&nbsp; &nbsp; I might distribute a version I compiled to the vietnamese users with an<br />&nbsp; &nbsp; alternative opkg location, or is that against the rules?</p><p>&nbsp; &nbsp; The mtdparts kernel command line may not be required but it doesn&#039;t hurt<br />&nbsp; &nbsp; tp-link partitions are used by default and the factory rom passed<br />&nbsp; &nbsp; something very similar to the factory kernel on this router if you see<br />&nbsp; &nbsp; the uboot printenv on the forum.</p><p>&nbsp; &nbsp; Could you please update the wiki with this variant for the table of<br />&nbsp; &nbsp; hardware.</p><p>Signed-off-by: Luke McKee &lt;hojuruku@gmail.com&gt;</p><p>patch #1<br /></p><div class="codebox"><pre><code>target/linux/ar71xx/base-files/lib/ar71xx.sh
@@ -189,6 +189,13 @@ tplink_board_detect() {
             hwver=&#039; v1.5&#039;
         fi
         ;;
+    &quot;084101&quot;*)
+        model=&quot;TP-Link TL-WR841N/ND&quot;
+        if [ &quot;$hwid&quot; = &#039;08410109&#039; -a &quot;$mid&quot; = &#039;00000001&#039; ]; then
+            hwver=&#039; v9.2vn&#039;
+        fi
+
+        ;;
     &quot;084200&quot;*)
         model=&quot;TP-Link TL-WR842N/ND&quot;
         ;;</code></pre></div><p>Patch #2</p><div class="codebox"><pre><code> target/linux/ar71xx/image/tp-link.mk
@@ -468,6 +468,17 @@ define Device/tl-wr841-v9
     TPLINK_HWID := 0x08410009
 endef
 
+define Device/tl-wr841-v9-vn
+$(Device/tplink-8mlzma)
+    MTDPARTS := spi0.0:128k(u-boot)ro,1024k(kernel),6912k(rootfs),64k(config)ro,64k(art)ro,7936k@0x20000(firmware) 
+    BOARDNAME := TL-WR841N-v9
+    DEVICE_PROFILE := TLWR841
+    TPLINK_HWID := 0x08410109
+    CONSOLE := ttyS0,115200
+    IMAGE/factory.bin := append-rootfs | mktplinkfw factory -v 3.16.99
+endef
+
+
 define Device/tl-wr841-v10
     $(Device/tplink-4mlzma)
     BOARDNAME := TL-WR841N-v9
@@ -516,7 +527,7 @@ define Device/tl-wr847n-v8
     DEVICE_PROFILE := TLWR841
     TPLINK_HWID := 0x08470008
 endef
-TARGET_DEVICES += tl-wr841-v1.5 tl-wr841-v3 tl-wr841-v5 tl-wr841-v7 tl-wr841-v8 tl-wr841-v9 tl-wr841-v10 tl-wr841-v11 tl-wr842n-v1 tl-wr842n-v2 tl-wr842n-v3 tl-wr843nd-v1 tl-wr847n-v8
+TARGET_DEVICES += tl-wr841-v1.5 tl-wr841-v3 tl-wr841-v5 tl-wr841-v7 tl-wr841-v8 tl-wr841-v9 tl-wr841-v9-vn tl-wr841-v10 tl-wr841-v11 tl-wr842n-v1 tl-wr842n-v2 tl-wr842n-v3 tl-wr843nd-v1 tl-wr847n-v8
 
 define Device/tl-wr941nd-v2
     $(Device/tplink-4m)</code></pre></div>											<p class="post-edited">(Last edited by <strong>hojuruku</strong> on 5 Oct 2016, 06:04)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p340384">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">hojuruku</div>
					<div class="post-datetime">
						6 Oct 2016, 07:47					</div>
				</div>
				<div class="post-content content">
					<p>It appears the openwrt crowd censored why they cried to pro-pedo momma &amp; censored my github account. (post above the one above)</p><p>In a nutshell they say if gay marriage activists have sex with Russian infants it&#039;s homophobic to mention/critize it on chat even if gay marriage activists are trying to take your family home for homosexual vilification [of convicted infant rapists Mark Newton and Peter Truong]. It came up on the topic of political correctness. Now having sex with children is politically correct - or at least politically incorrect to oppose according to some (jow).</p><p>I only brought it up because users were asking for help - if you want binaries for the 841nd-v9-vn (8mb rom) email me at hojuruku at gmail dot com - if you want the source see above. With 8mb flash in these routers you&#039;ve got more to play with. Also tell me what packages you want compiled in. </p><p>Openwrt 6 months on should do the small PR as they have now verified that other users want it in the openwrt distribution rom images. Or just stop being racist and blocking the Vietnamese variants by removing all the Chinese rom variants from the openwrt distro and wiki.</p><p>If you want to know what paedophile lede-dev devs want to censor see my 72 year old chem eng professor father&#039;s radio interview on the matter. Surely that radio show isn&#039;t hate speech.<br /><a href="http://www.truthnews.com.au/web/radio/story/cultural_marxism_101">http://www.truthnews.com.au/web/radio/s … arxism_101</a><br />More:<br /><a href="https://johnsunol.blogspot.com/2016/07/if-nsw-anti-discrimination-act-1977-was.html">https://johnsunol.blogspot.com/2016/07/ … 7-was.html</a><br />which lead to a facebook.com/policeglbti special gay anal sex police raid - described here:<br /><a href="https://johnsunol.blogspot.com/2016/08/federal-mp-george-christensens.html">https://johnsunol.blogspot.com/2016/08/ … nsens.html</a><br /><span class="postimg"><img src="https://2.bp.blogspot.com/-KeVgtCpYhbY/V8R6xmtBO_I/AAAAAAAACao/xZTTJGsjbfoq3JJix7eljk12iZHltPy-ACLcB/s1600/getupgaypeds.png" alt="https://2.bp.blogspot.com/-KeVgtCpYhbY/V8R6xmtBO_I/AAAAAAAACao/xZTTJGsjbfoq3JJix7eljk12iZHltPy-ACLcB/s1600/getupgaypeds.png" /></span></p><p>github.com/hojuruku - R.I.P. Lesson learn&#039;t Don&#039;t use github to critize pro-pedophilia lede-dev censorship of all my contributions. accel-ppp.org openwrt PR also deleted. OpenPHT (Plex server for MIPS) pull request also can&#039;t be submitted due to my github being censored. What do you expect from git hub? It&#039;s based in San Francisco.</p><p>At least mini-snmpd PR got comitted and is part of the openwrt tree now. You better go censor that contribution too, and redact that bloated procd init script for it too - that took 3 days to write due to a lack of documentation - apart from those kind folks on the prpl wiki <a href="http://openwrtsummit.org/">http://openwrtsummit.org/</a></p><p>Due to my principals I can&#039;t kiss and make up with openwrt.org because doing so would be the same as saying paedophilia is ok, and I&#039;m not going to do that. Lede-dev is the boylover.org fork of openwrt. (I speak of the German jow and his cats)_</p>											<p class="post-edited">(Last edited by <strong>hojuruku</strong> on 6 Oct 2016, 07:56)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p340385">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">hojuruku</div>
					<div class="post-datetime">
						6 Oct 2016, 08:17					</div>
				</div>
				<div class="post-content content">
					<p>P.S. Guys do me a favour. Leave the post #11 above as my last word on the matter, and all future posts will be tech only <br />(accel-ppp patches / howto / OpenPHT MIPS plex server HOWTO) will be added.<br />If not I&#039;ll use my own blog to bring some more attention to jow and maybe escalate the matter to the German child sex crimes squad, and give them the irc logs.</p><p>The last time I suspected someone of being as as big a paedophile as someone I saw on #lede-dev chat - it ended with a tip-off and him being arrested for child porn - as he admits in the video below. The second youtube link is him in the comments trolling me last year before his child porn arrest. I&#039;ve seen this before and I know where it ends.</p><p><a href="https://www.youtube.com/watch?v=yje940Ocick">https://www.youtube.com/watch?v=yje940Ocick</a> (at 23 mins he admits being arrested for child porn)<br /><a href="http://www.youtube.com/watch?v=u6L3jx4KbM0">http://www.youtube.com/watch?v=u6L3jx4KbM0</a> (he trolls a grandmother being sued by a paedophile cult and only organization to use religious vilification thought crime laws in NSW - 9 months jail for criticizing the otoaustralia.org.au satanic cult started by Aleister Crowley - that&#039;s &quot;religious teachings&quot; mandate sex and sacrifice with &quot;preferably young boys&quot; - Book of the Law / Magick in Theorm and Practice by Alister Crowley &quot;the wickedest man in the world&quot; - watch the documentary from pro gay channel 4 UK).</p>											<p class="post-edited">(Last edited by <strong>hojuruku</strong> on 6 Oct 2016, 08:19)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>