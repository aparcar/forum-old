<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> [Solved]Need help with access to openvpn client network, vpn site2site</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 13 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p366704">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">tcm1003</div>
					<div class="post-datetime">
						14 Oct 2017, 14:58					</div>
				</div>
				<div class="post-content content">
					<p>Hey guys, </p><p>I need help with an openvpn site to site connection between two networks via two openwrt router (TP-Link WR1043N/NDv4). The connection works and the vpn client site reach hosts on vpn server site, but the other direction is a worry to me. </p><p>I used this setup guide in openwrt wiki (wiki.openwrt.org/doc/howto/vpn.openvpn).<br />I used uci / luci, because this vpn isn&#039;t for me and I think via gui it&#039;s easier to support if I&#039;m not available.<br />Besides the guide I changed some interface settings to match with my test networks and added some openvpn options via luci.</p><p>Summary:<br />vpn client network = 192.168.0.0/24<br />vpn server network = 192.168.23.0/24<br />vpn client: reach vpn server, reach vpn server network, reach own network<br />vpn client network: see above* (test before router moved in another test network, so... should be?)<br />vpn server: reach vpn client, reach own network, reach [color=FF0000]NOT[/color] vpn client network<br />vpn server network: reach vpn server, reach vpn client, reach [color=FF0000]NOT[/color] vpn client network</p><p>tracer from vpn server network to vpn client network:<br /></p><div class="codebox"><pre><code>tracert to 192.168.0.1 # internet router of vpn client network
  1    &lt;1 ms    &lt;1 ms    &lt;1 ms  fritz.box [192.168.23.1] # internet router of vpn server network
  2     1 ms    &lt;1 ms    &lt;1 ms  vpnserver[192.168.23.10]
  3     *        *        *     Zeitüberschreitung der Anforderung.
  4     *        *        *     Zeitüberschreitung der Anforderung.
[...] # this goes on until hop 30</code></pre></div><p>Below my config files + &quot;route -n&quot; of both sites. If it&#039;s to difficult to read I can offer txt-files on my webspace, but as long as links are not allowed here I try it this way:</p><br /><p><strong>Config files: </strong><br /><span class="bbu">vpnserver# /etc/config/network:</span><br /></p><div class="codebox"><pre><code>config interface &#039;loopback&#039;
    option ifname &#039;lo&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;127.0.0.1&#039;
    option netmask &#039;255.0.0.0&#039;

config globals &#039;globals&#039;
    option ula_prefix &#039;fd3c:40cb:d011::/48&#039;

config interface &#039;lan&#039;
    option type &#039;bridge&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;192.168.1.1&#039;
    option netmask &#039;255.255.255.0&#039;
    option ip6assign &#039;60&#039;
    option _orig_ifname &#039;eth0.1 radio0.network1&#039;
    option _orig_bridge &#039;true&#039;
    option ifname &#039;eth0.1&#039;

config interface &#039;wan&#039;
    option ifname &#039;eth0.2&#039;
    option proto &#039;dhcp&#039;

config interface &#039;wan6&#039;
    option ifname &#039;eth0.2&#039;
    option proto &#039;dhcpv6&#039;

config switch
    option name &#039;switch0&#039;
    option reset &#039;1&#039;
    option enable_vlan &#039;1&#039;

config switch_vlan
    option device &#039;switch0&#039;
    option vlan &#039;1&#039;
    option vid &#039;1&#039;
    option ports &#039;0t 1 2 3&#039;

config switch_vlan
    option device &#039;switch0&#039;
    option vlan &#039;2&#039;
    option ports &#039;0t 5&#039;
    option vid &#039;2&#039;

config interface &#039;vpn0&#039;
    option ifname &#039;tun0&#039;
    option proto &#039;none&#039;
    option auto &#039;1&#039;

config switch_vlan
    option device &#039;switch0&#039;
    option vlan &#039;3&#039;
    option vid &#039;3&#039;
    option ports &#039;0t 4&#039;

config interface &#039;Gate23&#039;
    option proto &#039;dhcp&#039;
    option ifname &#039;eth0.3&#039;
    option delegate &#039;0&#039;

config route
    option interface &#039;vpn0&#039;
    option target &#039;192.168.0.0&#039;
    option netmask &#039;255.255.255.0&#039;
    option gateway &#039;10.8.0.2&#039;
    option metric &#039;0&#039;
    option mtu &#039;1500&#039;</code></pre></div><p><span class="bbu">vpnserver# /etc/config/firewall:</span><br /></p><div class="codebox"><pre><code>config defaults
    option syn_flood &#039;1&#039;
    option input &#039;ACCEPT&#039;
    option output &#039;ACCEPT&#039;
    option forward &#039;REJECT&#039;

config zone
    option name &#039;lan&#039;
    option input &#039;ACCEPT&#039;
    option output &#039;ACCEPT&#039;
    option forward &#039;ACCEPT&#039;
    option network &#039;lan Gate23&#039;

config zone
    option name &#039;wan&#039;
    option input &#039;REJECT&#039;
    option output &#039;ACCEPT&#039;
    option forward &#039;REJECT&#039;
    option masq &#039;1&#039;
    option mtu_fix &#039;1&#039;
    option network &#039;wan wan6&#039;

config forwarding
    option src &#039;lan&#039;
    option dest &#039;wan&#039;

config rule
    option name &#039;Allow-DHCP-Renew&#039;
    option src &#039;wan&#039;
    option proto &#039;udp&#039;
    option dest_port &#039;68&#039;
    option target &#039;ACCEPT&#039;
    option family &#039;ipv4&#039;

config rule
    option name &#039;Allow-Ping&#039;
    option src &#039;wan&#039;
    option proto &#039;icmp&#039;
    option icmp_type &#039;echo-request&#039;
    option family &#039;ipv4&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-IGMP&#039;
    option src &#039;wan&#039;
    option proto &#039;igmp&#039;
    option family &#039;ipv4&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-DHCPv6&#039;
    option src &#039;wan&#039;
    option proto &#039;udp&#039;
    option src_ip &#039;fc00::/6&#039;
    option dest_ip &#039;fc00::/6&#039;
    option dest_port &#039;546&#039;
    option family &#039;ipv6&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-MLD&#039;
    option src &#039;wan&#039;
    option proto &#039;icmp&#039;
    option src_ip &#039;fe80::/10&#039;
    list icmp_type &#039;130/0&#039;
    list icmp_type &#039;131/0&#039;
    list icmp_type &#039;132/0&#039;
    list icmp_type &#039;143/0&#039;
    option family &#039;ipv6&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-ICMPv6-Input&#039;
    option src &#039;wan&#039;
    option proto &#039;icmp&#039;
    list icmp_type &#039;echo-request&#039;
    list icmp_type &#039;echo-reply&#039;
    list icmp_type &#039;destination-unreachable&#039;
    list icmp_type &#039;packet-too-big&#039;
    list icmp_type &#039;time-exceeded&#039;
    list icmp_type &#039;bad-header&#039;
    list icmp_type &#039;unknown-header-type&#039;
    list icmp_type &#039;router-solicitation&#039;
    list icmp_type &#039;neighbour-solicitation&#039;
    list icmp_type &#039;router-advertisement&#039;
    list icmp_type &#039;neighbour-advertisement&#039;
    option limit &#039;1000/sec&#039;
    option family &#039;ipv6&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-ICMPv6-Forward&#039;
    option src &#039;wan&#039;
    option dest &#039;*&#039;
    option proto &#039;icmp&#039;
    list icmp_type &#039;echo-request&#039;
    list icmp_type &#039;echo-reply&#039;
    list icmp_type &#039;destination-unreachable&#039;
    list icmp_type &#039;packet-too-big&#039;
    list icmp_type &#039;time-exceeded&#039;
    list icmp_type &#039;bad-header&#039;
    list icmp_type &#039;unknown-header-type&#039;
    option limit &#039;1000/sec&#039;
    option family &#039;ipv6&#039;
    option target &#039;ACCEPT&#039;

config include
    option path &#039;/etc/firewall.user&#039;

config rule
    option src &#039;wan&#039;
    option dest &#039;lan&#039;
    option proto &#039;esp&#039;
    option target &#039;ACCEPT&#039;

config rule
    option src &#039;wan&#039;
    option dest &#039;lan&#039;
    option dest_port &#039;500&#039;
    option proto &#039;udp&#039;
    option target &#039;ACCEPT&#039;

config rule &#039;Allow_OpenVPN_Inbound&#039;
    option target &#039;ACCEPT&#039;
    option src &#039;*&#039;
    option proto &#039;udp&#039;
    option dest_port &#039;9001&#039;

config zone &#039;vpn&#039;
    option name &#039;vpn&#039;
    option network &#039;vpn0&#039;
    option input &#039;ACCEPT&#039;
    option output &#039;ACCEPT&#039;
    option masq &#039;1&#039;
    option forward &#039;ACCEPT&#039;

config forwarding &#039;vpn_forwarding_lan_in&#039;
    option src &#039;vpn&#039;
    option dest &#039;lan&#039;

config forwarding &#039;vpn_forwarding_lan_out&#039;
    option src &#039;lan&#039;
    option dest &#039;vpn&#039;</code></pre></div><p><span class="bbu">vpnserver# /etc/config/openvpn:</span><br /></p><div class="codebox"><pre><code>config openvpn &#039;vpnbridge&#039;
    option enabled &#039;1&#039;
    option verb &#039;3&#039;
    option port &#039;9001&#039;
    option dev &#039;tun&#039;
    option server &#039;10.8.0.0 255.255.255.0&#039;
    option keepalive &#039;10 120&#039;
    option topology &#039;subnet&#039;
    option ifconfig &#039;10.8.0.1 255.255.255.0&#039;
    option ca &#039;/etc/openvpn/vpnbridge/ca.crt&#039;
    option cert &#039;/etc/openvpn/vpnbridge/vpnbridge-nbz.crt&#039;
    option key &#039;/etc/openvpn/vpnbridge/vpnbridge-nbz.key&#039;
    option dh &#039;/etc/openvpn/vpnbridge/dh2048.pem&#039;
    option log &#039;/etc/openvpn/vpnbridge/openvpn.log&#039;
    list push &#039;route-gateway 10.8.0.1&#039;
    list push &#039;route 192.168.23.0 255.255.255.0&#039;
    option client_to_client &#039;1&#039;
    option client_config_dir &#039;/etc/openvpn/vpnbridge/staticclients&#039;
    option ifconfig_pool &#039;10.8.0.2 10.8.0.4 255.255.255.0&#039;</code></pre></div><p><span class="bbu">vpnserver# route -n</span><br /></p><div class="codebox"><pre><code>Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
0.0.0.0         192.168.23.1    0.0.0.0         UG    0      0        0 eth0.3
10.8.0.0        0.0.0.0         255.255.255.0   U     0      0        0 tun0
192.168.0.0     10.8.0.2        255.255.255.0   UG    0      0        0 tun0
192.168.1.0     0.0.0.0         255.255.255.0   U     0      0        0 br-lan
192.168.23.0    0.0.0.0         255.255.255.0   U     0      0        0 eth0.3
192.168.23.1    0.0.0.0         255.255.255.255 UH    0      0        0 eth0.3</code></pre></div><p><span class="bbu">vpnclient# /etc/config/network:</span><br /></p><div class="codebox"><pre><code>config interface &#039;loopback&#039;
    option ifname &#039;lo&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;127.0.0.1&#039;
    option netmask &#039;255.0.0.0&#039;

config globals &#039;globals&#039;
    option ula_prefix &#039;fd94:0782:5d60::/48&#039;

config interface &#039;lan&#039;
    option type &#039;bridge&#039;
    option proto &#039;static&#039;
    option netmask &#039;255.255.255.0&#039;
    option ip6assign &#039;60&#039;
    option _orig_ifname &#039;eth0.1 wlan0&#039;
    option _orig_bridge &#039;true&#039;
    option ifname &#039;eth0.1&#039;
    option ipaddr &#039;192.168.0.50&#039;
    option gateway &#039;192.168.0.1&#039;
    option broadcast &#039;192.168.0.254&#039;
    option dns &#039;8.8.8.8&#039;
    option delegate &#039;0&#039;

config interface &#039;wan&#039;
    option ifname &#039;eth0.2&#039;
    option proto &#039;dhcp&#039;

config interface &#039;wan6&#039;
    option ifname &#039;eth0.2&#039;
    option proto &#039;dhcpv6&#039;

config switch
    option name &#039;switch0&#039;
    option reset &#039;1&#039;
    option enable_vlan &#039;1&#039;

config switch_vlan
    option device &#039;switch0&#039;
    option vlan &#039;1&#039;
    option ports &#039;1 2 3 4 0t&#039;

config switch_vlan
    option device &#039;switch0&#039;
    option vlan &#039;2&#039;
    option ports &#039;5 0t&#039;

config interface &#039;vpn0&#039;
    option ifname &#039;tun0&#039;
    option proto &#039;none&#039;
    option auto &#039;1&#039;

config interface &#039;wlan&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;192.168.21.1&#039;
    option netmask &#039;255.255.255.0&#039;
    option auto &#039;0&#039;</code></pre></div><p><span class="bbu">vpnclient# /etc/config/firewall:</span><br /></p><div class="codebox"><pre><code>config defaults
    option syn_flood &#039;1&#039;
    option input &#039;ACCEPT&#039;
    option output &#039;ACCEPT&#039;
    option forward &#039;REJECT&#039;

config zone
    option name &#039;lan&#039;
    option input &#039;ACCEPT&#039;
    option output &#039;ACCEPT&#039;
    option forward &#039;ACCEPT&#039;
    option network &#039;lan&#039;

config zone
    option name &#039;wan&#039;
    option input &#039;REJECT&#039;
    option output &#039;ACCEPT&#039;
    option forward &#039;REJECT&#039;
    option masq &#039;1&#039;
    option mtu_fix &#039;1&#039;
    option network &#039;wan wan6&#039;

config forwarding
    option src &#039;lan&#039;
    option dest &#039;wan&#039;

config rule
    option name &#039;Allow-DHCP-Renew&#039;
    option src &#039;wan&#039;
    option proto &#039;udp&#039;
    option dest_port &#039;68&#039;
    option target &#039;ACCEPT&#039;
    option family &#039;ipv4&#039;

config rule
    option name &#039;Allow-Ping&#039;
    option src &#039;wan&#039;
    option proto &#039;icmp&#039;
    option icmp_type &#039;echo-request&#039;
    option family &#039;ipv4&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-IGMP&#039;
    option src &#039;wan&#039;
    option proto &#039;igmp&#039;
    option family &#039;ipv4&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-DHCPv6&#039;
    option src &#039;wan&#039;
    option proto &#039;udp&#039;
    option src_ip &#039;fc00::/6&#039;
    option dest_ip &#039;fc00::/6&#039;
    option dest_port &#039;546&#039;
    option family &#039;ipv6&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-MLD&#039;
    option src &#039;wan&#039;
    option proto &#039;icmp&#039;
    option src_ip &#039;fe80::/10&#039;
    list icmp_type &#039;130/0&#039;
    list icmp_type &#039;131/0&#039;
    list icmp_type &#039;132/0&#039;
    list icmp_type &#039;143/0&#039;
    option family &#039;ipv6&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-ICMPv6-Input&#039;
    option src &#039;wan&#039;
    option proto &#039;icmp&#039;
    list icmp_type &#039;echo-request&#039;
    list icmp_type &#039;echo-reply&#039;
    list icmp_type &#039;destination-unreachable&#039;
    list icmp_type &#039;packet-too-big&#039;
    list icmp_type &#039;time-exceeded&#039;
    list icmp_type &#039;bad-header&#039;
    list icmp_type &#039;unknown-header-type&#039;
    list icmp_type &#039;router-solicitation&#039;
    list icmp_type &#039;neighbour-solicitation&#039;
    list icmp_type &#039;router-advertisement&#039;
    list icmp_type &#039;neighbour-advertisement&#039;
    option limit &#039;1000/sec&#039;
    option family &#039;ipv6&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-ICMPv6-Forward&#039;
    option src &#039;wan&#039;
    option dest &#039;*&#039;
    option proto &#039;icmp&#039;
    list icmp_type &#039;echo-request&#039;
    list icmp_type &#039;echo-reply&#039;
    list icmp_type &#039;destination-unreachable&#039;
    list icmp_type &#039;packet-too-big&#039;
    list icmp_type &#039;time-exceeded&#039;
    list icmp_type &#039;bad-header&#039;
    list icmp_type &#039;unknown-header-type&#039;
    option limit &#039;1000/sec&#039;
    option family &#039;ipv6&#039;
    option target &#039;ACCEPT&#039;

config include
    option path &#039;/etc/firewall.user&#039;

config rule
    option src &#039;wan&#039;
    option dest &#039;lan&#039;
    option proto &#039;esp&#039;
    option target &#039;ACCEPT&#039;

config rule
    option src &#039;wan&#039;
    option dest &#039;lan&#039;
    option dest_port &#039;500&#039;
    option proto &#039;udp&#039;
    option target &#039;ACCEPT&#039;

config zone &#039;vpn&#039;
    option name &#039;vpn&#039;
    option network &#039;vpn0&#039;
    option input &#039;ACCEPT&#039;
    option output &#039;ACCEPT&#039;
    option forward &#039;ACCEPT&#039;
    option masq &#039;1&#039;

config forwarding &#039;vpn_forwarding_lan_in&#039;
    option src &#039;vpn&#039;
    option dest &#039;lan&#039;

config forwarding &#039;vpn_forwarding_lan_out&#039;
    option src &#039;lan&#039;
    option dest &#039;vpn&#039;</code></pre></div><p><span class="bbu">vpnclient# /etc/config/openvpn:</span> <br /></p><div class="codebox"><pre><code>config openvpn &#039;vpnbridge&#039;
    option enabled &#039;1&#039;
    option dev &#039;tun&#039;
    option proto &#039;udp&#039;
    option verb &#039;3&#039;
    option ca &#039;/etc/openvpn/vpnbridge/ca.crt&#039;
    option cert &#039;/etc/openvpn/vpnbridge/vpnbridge-nat.crt&#039;
    option key &#039;/etc/openvpn/vpnbridge/vpnbridge-nat.key&#039;
    option log &#039;/etc/openvpn/vpnbridge/openvpn.log&#039;
    option client &#039;1&#039;
    option remote_cert_tls &#039;server&#039;
    list remote &#039;$domain$ 9001&#039;</code></pre></div><p><span class="bbu">vpnclient# route -n</span><br /></p><div class="codebox"><pre><code>Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
0.0.0.0         192.168.0.1     0.0.0.0         UG    0      0        0 br-lan
10.8.0.0        0.0.0.0         255.255.255.0   U     0      0        0 tun0
192.168.0.0     0.0.0.0         255.255.255.0   U     0      0        0 br-lan
192.168.23.0    10.8.0.1        255.255.255.0   UG    0      0        0 tun0</code></pre></div><p>###</p><p>If someone have a solution or just a tip to test something, I will be grateful. <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>											<p class="post-edited">(Last edited by <strong>tcm1003</strong> on 21 Oct 2017, 20:58)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p366712">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">ulmwind</div>
					<div class="post-datetime">
						14 Oct 2017, 21:00					</div>
				</div>
				<div class="post-content content">
					<p>Ok, let&#039;s be more concrete.<br />Output of </p><div class="codebox"><pre><code>ifconfig</code></pre></div><p> both from server and client?<br />Is 10.8.0.2 IP of tun0 of client?<br />On server I can see 3 networks: 0,1,23. What are they? 1 is for wan?<br />Run traceroute to 192.168.0.1 on server.</p>											<p class="post-edited">(Last edited by <strong>ulmwind</strong> on 14 Oct 2017, 21:04)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p366714">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">tcm1003</div>
					<div class="post-datetime">
						14 Oct 2017, 21:58					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>first to your questions, after that the output of ifconfig and traceroute.</p><p>1) like you will see, 10.8.0.2 is ip of tun0 (vpn interface) of vpn client, so: yes<br />2) network 23 is my home network where the vpnserver router is placed at the moment with ip 23.10.<br />network 0 is network of vpnclient and shouldn&#039;t be in direct contact with vpnserver. <br />network 1 is on one hand an old configuration from initial installation. I started with both routers in my 23 network over wan port and separated networks 1 and 2 with laptops. Later router vpnclient went to a friend (network 0) and vpnserver was configured as vpn gateway only in network 23. I didn&#039;t want to reconfigure wan port (inclusive wan zone of firewall etc), so I reconfigured one LAN port to a static address (network 23) and LAN port 2 to 4 holds as backup network 1 with dhcp, both in zone lan of firewall. (If I have to disconnect the router from my 23 network I just have to connect me to LAN 2/3/4 and have access to the router. Or wlan on the same interface). <br />(hope my text is understandable, english is not my native language)</p><p>WAN unused,<br />LAN 1 in network 23,<br />LAN 2/3/4 &amp; WLAN in network 1 with dhcp.</p><p>Note: The router shall be placed beside other routers to the internet as second gateway (into vpn) and will not connect two real networks like lan and wan. </p><p><span class="bbu">vpnclient#&nbsp; ifconfig</span><br /></p><div class="codebox"><pre><code>br-lan    Link encap:Ethernet  HWaddr 18:D6:C7:51:51:CC
          inet addr:192.168.0.50  Bcast:192.168.0.254  Mask:255.255.255.0
          inet6 addr: fd94:782:5d60::1/60 Scope:Global
          inet6 addr: fe80::1ad6:c7ff:fe51:51cc/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:69242 errors:0 dropped:0 overruns:0 frame:0
          TX packets:44049 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:6895341 (6.5 MiB)  TX bytes:8557397 (8.1 MiB)

eth0      Link encap:Ethernet  HWaddr 18:D6:C7:51:51:CC
          inet6 addr: fe80::1ad6:c7ff:fe51:51cc/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:122681 errors:0 dropped:0 overruns:0 frame:0
          TX packets:76834 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:29010511 (27.6 MiB)  TX bytes:19691287 (18.7 MiB)
          Interrupt:4

eth0.1    Link encap:Ethernet  HWaddr 18:D6:C7:51:51:CC
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:122672 errors:0 dropped:0 overruns:0 frame:0
          TX packets:45005 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:26798159 (25.5 MiB)  TX bytes:8639573 (8.2 MiB)

eth0.2    Link encap:Ethernet  HWaddr 18:D6:C7:51:51:CC
          inet6 addr: fe80::1ad6:c7ff:fe51:51cc/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:31815 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:0 (0.0 B)  TX bytes:10743030 (10.2 MiB)

lo        Link encap:Local Loopback
          inet addr:127.0.0.1  Mask:255.0.0.0
          inet6 addr: ::1/128 Scope:Host
          UP LOOPBACK RUNNING  MTU:65536  Metric:1
          RX packets:2164 errors:0 dropped:0 overruns:0 frame:0
          TX packets:2164 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1
          RX bytes:229949 (224.5 KiB)  TX bytes:229949 (224.5 KiB)

tun0      Link encap:UNSPEC  HWaddr 00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00
          inet addr:10.8.0.2  P-t-P:10.8.0.2  Mask:255.255.255.0
          UP POINTOPOINT RUNNING NOARP MULTICAST  MTU:1500  Metric:1
          RX packets:7182 errors:0 dropped:0 overruns:0 frame:0
          TX packets:8052 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:100
          RX bytes:761238 (743.3 KiB)  TX bytes:2377193 (2.2 MiB)</code></pre></div><br /><p><span class="bbu">vpnserver#&nbsp; ifconfig</span><br /></p><div class="codebox"><pre><code>br-lan    Link encap:Ethernet  HWaddr D4:6E:0E:F5:C1:C6
          inet addr:192.168.1.1  Bcast:192.168.1.255  Mask:255.255.255.0
          inet6 addr: fe80::d66e:eff:fef5:c1c6/64 Scope:Link
          inet6 addr: fd3c:40cb:d011::1/60 Scope:Global
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:4667 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:0 (0.0 B)  TX bytes:407666 (398.1 KiB)

eth0      Link encap:Ethernet  HWaddr D4:6E:0E:F5:C1:C6
          inet6 addr: fe80::d66e:eff:fef5:c1c6/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:81566 errors:0 dropped:0 overruns:0 frame:0
          TX packets:79830 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:17891674 (17.0 MiB)  TX bytes:22444932 (21.4 MiB)
          Interrupt:4

eth0.1    Link encap:Ethernet  HWaddr D4:6E:0E:F5:C1:C6
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:1608 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:0 (0.0 B)  TX bytes:114232 (111.5 KiB)

eth0.2    Link encap:Ethernet  HWaddr D4:6E:0E:F5:C1:C6
          inet6 addr: fe80::d66e:eff:fef5:c1c6/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:32473 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:0 (0.0 B)  TX bytes:10964161 (10.4 MiB)

eth0.3    Link encap:Ethernet  HWaddr D4:6E:0E:F5:C1:C6
          inet addr:192.168.23.10  Bcast:192.168.23.255  Mask:255.255.255.0
          inet6 addr: fe80::d66e:eff:fef5:c1c6/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:81566 errors:0 dropped:226 overruns:0 frame:0
          TX packets:45736 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:16423486 (15.6 MiB)  TX bytes:11045965 (10.5 MiB)

lo        Link encap:Local Loopback
          inet addr:127.0.0.1  Mask:255.0.0.0
          inet6 addr: ::1/128 Scope:Host
          UP LOOPBACK RUNNING  MTU:65536  Metric:1
          RX packets:18 errors:0 dropped:0 overruns:0 frame:0
          TX packets:18 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1
          RX bytes:1509 (1.4 KiB)  TX bytes:1509 (1.4 KiB)

tun0      Link encap:UNSPEC  HWaddr 00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00
          inet addr:10.8.0.1  P-t-P:10.8.0.1  Mask:255.255.255.0
          UP POINTOPOINT RUNNING NOARP MULTICAST  MTU:1500  Metric:1
          RX packets:13904 errors:0 dropped:0 overruns:0 frame:0
          TX packets:12416 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:100
          RX bytes:5075636 (4.8 MiB)  TX bytes:1180160 (1.1 MiB)</code></pre></div><p><span class="bbu">vpnserver# traceroute 192.168.0.1</span><br /></p><div class="codebox"><pre><code>traceroute to 192.168.0.1 (192.168.0.1), 30 hops max, 38 byte packets
 1  *  *  *
 2  *  *  *
 3  *  *  *
[...] # until 30 hops</code></pre></div>											<p class="post-edited">(Last edited by <strong>tcm1003</strong> on 15 Oct 2017, 02:05)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p366720">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">ulmwind</div>
					<div class="post-datetime">
						15 Oct 2017, 01:27					</div>
				</div>
				<div class="post-content content">
					<p>You&#039;ve specified both outputs as vpnclient, please, correct. I suppose, first is client, second is server. I suppose, you&#039;ve configured port forwarding on main router, connected to ISP.<br />Run traceroute to 192.168.0.50 on server.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p366722">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">tcm1003</div>
					<div class="post-datetime">
						15 Oct 2017, 02:09					</div>
				</div>
				<div class="post-content content">
					<p>Oops, I&#039;m very sorry. I corrected the post above. But you were right with your interpretation. <br />The new traceroute gives the same output like before to .0.1</p><p><span class="bbu">vpnserver# traceroute 192.168.0.50</span><br /></p><div class="codebox"><pre><code>traceroute to 192.168.0.50 (192.168.0.50), 30 hops max, 38 byte packets
 1  *  *  *
 2  *  *  *
 3  *  *  *
[...]</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p366740">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">ulmwind</div>
					<div class="post-datetime">
						15 Oct 2017, 12:54					</div>
				</div>
				<div class="post-content content">
					<p>It is interesting.<br />Try to traceroute 10.8.0.2, ping 10.8.0.2&nbsp; from server.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p366754">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">tcm1003</div>
					<div class="post-datetime">
						15 Oct 2017, 20:03					</div>
				</div>
				<div class="post-content content">
					<p>Hey,<br />I&#039;m sorry to say that I&#039;m not at home until tuesday, but I can tell you my results from previous tests. </p><p>vpnserver and vpnclient have full and direct contact to each other. ping and traceroute works fine without limits.<br />Access from 23 network to vpnclient works fine, too. <br />I can access vpnclient via ssh and luci (h-t-t-p / h-t-t-p-s [url filter of this forum is stupid]) from my windows notebook and my ping/tracert went over my fritzbox (192.168.23.1) to vpnserver (192.168.23.10/10.8.0.1) and vpnclient (10.8.0.2). And I can access vpnclient (10.8.0.2) via ssh from vpnserver shell.</p><p>If you want the CLI output, I&#039;ll write it asap on tuesday. </p><p>---</p><p>I found an openwrt wiki article about network configuration.<br />wiki.openwrt.org/doc/uci/network#ipv4_routes<br />In last paragraph before ipv6 routes there&#039;s an interesting note about gateways.</p><div class="quotebox"><blockquote><p>It seems that on openwrt 12.09 if a route is defined using a gateway in an address space where a gateway is already defined, it will be not added. Like the lan has the gateway 192.168.1.1 and we want to go to 1.2.3.4 over the gateway 192.168.1.5 within the interface lan, it will not be added.</p></blockquote></div><p>I use a openwrt trunk version / designated driver, but I don&#039;t think it&#039;s that different to stable chaos calmer - and I don&#039;t know if this &quot;bug&quot; exists in recent version. <br />But route -n shows the correct route, so... I don&#039;t know, just a thought.</p><p>I like to think, it&#039;s something in forwarding between vpn and lan zone of firewall of vpnclient, but I don&#039;t know...</p><p>Just a thought - I don&#039;t believe it, but... - the main router of 192.168.0.0/24 should not block anything shouldnt it? Like rule &#039;block everything external&#039; because of block wan, but packets from vpn are blocked, too? Don&#039;t know.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p366828">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">ulmwind</div>
					<div class="post-datetime">
						16 Oct 2017, 21:31					</div>
				</div>
				<div class="post-content content">
					<p>Now we are exploring connectivity from vpnserver to network behind vpnclient, so it doesn&#039;t matter. OK, asap check following from vpnserver:<br />traceroute 10.8.0.2, ping 10.8.0.2<br />traceroute 192.168.0.50, ping 192.168.0.50<br />It is interesting, why the latter doesn&#039;t work, because there is route on vpnserver:<br /></p><div class="codebox"><pre><code>192.168.0.0     10.8.0.2        255.255.255.0   UG    0      0        0 tun0</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p366897">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">tcm1003</div>
					<div class="post-datetime">
						17 Oct 2017, 21:37					</div>
				</div>
				<div class="post-content content">
					<p><span class="bbu">vpnserver# ping 10.8.0.2 </span><br /></p><div class="codebox"><pre><code>PING 10.8.0.2 (10.8.0.2): 56 data bytes
64 bytes from 10.8.0.2: seq=0 ttl=64 time=79.925 ms
64 bytes from 10.8.0.2: seq=1 ttl=64 time=80.368 ms
64 bytes from 10.8.0.2: seq=2 ttl=64 time=83.944 ms
64 bytes from 10.8.0.2: seq=3 ttl=64 time=88.410 ms
^C</code></pre></div><p><span class="bbu">vpnserver# traceroute 10.8.0.2</span><br /></p><div class="codebox"><pre><code>traceroute to 10.8.0.2 (10.8.0.2), 30 hops max, 38 byte packets
 1  10.8.0.2 (10.8.0.2)  49.970 ms  50.326 ms  53.254 ms</code></pre></div><p><span class="bbu">vpnserver# ping 192.168.0.50</span><br /></p><div class="codebox"><pre><code>PING 192.168.0.50 (192.168.0.50): 56 data bytes
^C
--- 192.168.0.50 ping statistics ---
738 packets transmitted, 0 packets received, 100% packet loss</code></pre></div><p>(I canceled the command after a few minutes...)</p><p><span class="bbu">vpnserver# traceroute 192.168.0.50</span><br /></p><div class="codebox"><pre><code>traceroute to 192.168.0.50 (192.168.0.50), 30 hops max, 38 byte packets
 1  *  *  *
 2  *  *  *
 3  *  *  *
 4  *  *  *
 5  *  *  *
 6  *  *  *
 7  *  *  *
 8  *  *  *
 9  *  *  *
10  *  *  *
11  *  *  *
12  *  *  *
13  *  *  *
14  *  *  *
15  *  *  *
16  *  *  *
17  *  *  *
18  *  *  *
19  *  *  *
20  *  *  *
21  *  *  *
22  *  *  *
23  *  *  *
24  *  *  *
25  *  *  *
26  *  *  *
27  *  *  *
28  *  *  *
29  *  *  *
30  *  *  *</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p366930">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">ulmwind</div>
					<div class="post-datetime">
						18 Oct 2017, 11:55					</div>
				</div>
				<div class="post-content content">
					<p>It is interesting, because it has route to 192.168.0.X<br />Please, provide output of </p><div class="codebox"><pre><code>route -n</code></pre></div><div class="codebox"><pre><code>ip route show table all</code></pre></div><p>from vpnserver.</p>											<p class="post-edited">(Last edited by <strong>ulmwind</strong> on 18 Oct 2017, 11:55)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p366936">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">tcm1003</div>
					<div class="post-datetime">
						18 Oct 2017, 13:38					</div>
				</div>
				<div class="post-content content">
					<p><span class="bbu">vpnserver# route -n</span><br /></p><div class="codebox"><pre><code>Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
0.0.0.0         192.168.23.1    0.0.0.0         UG    0      0        0 eth0.3
10.8.0.0        0.0.0.0         255.255.255.0   U     0      0        0 tun0
192.168.0.0     10.8.0.2        255.255.255.0   UG    0      0        0 tun0
192.168.1.0     0.0.0.0         255.255.255.0   U     0      0        0 br-lan
192.168.23.0    0.0.0.0         255.255.255.0   U     0      0        0 eth0.3
192.168.23.1    0.0.0.0         255.255.255.255 UH    0      0        0 eth0.3</code></pre></div><p><span class="bbu">vpnserver# ip route show table all</span><br /></p><div class="codebox"><pre><code>default via 192.168.23.1 dev eth0.3  src 192.168.23.10
10.8.0.0/24 dev tun0  src 10.8.0.1
192.168.0.0/24 via 10.8.0.2 dev tun0
192.168.1.0/24 dev br-lan  src 192.168.1.1
192.168.23.0/24 dev eth0.3  src 192.168.23.10
192.168.23.1 dev eth0.3  src 192.168.23.10
broadcast 10.8.0.0 dev tun0  src 10.8.0.1
local 10.8.0.1 dev tun0  src 10.8.0.1
broadcast 10.8.0.255 dev tun0  src 10.8.0.1
broadcast 127.0.0.0 dev lo  src 127.0.0.1
local 127.0.0.0/8 dev lo  src 127.0.0.1
local 127.0.0.1 dev lo  src 127.0.0.1
broadcast 127.255.255.255 dev lo  src 127.0.0.1
broadcast 192.168.1.0 dev br-lan  src 192.168.1.1
local 192.168.1.1 dev br-lan  src 192.168.1.1
broadcast 192.168.1.255 dev br-lan  src 192.168.1.1
broadcast 192.168.23.0 dev eth0.3  src 192.168.23.10
local 192.168.23.10 dev eth0.3  src 192.168.23.10
broadcast 192.168.23.255 dev eth0.3  src 192.168.23.10
fd3c:40cb:d011::/64 dev br-lan  metric 1024
unreachable fd3c:40cb:d011::/48 dev lo  metric 2147483647  error -148
fe80::/64 dev eth0  metric 256
fe80::/64 dev eth0.2  metric 256
fe80::/64 dev eth0.3  metric 256
fe80::/64 dev br-lan  metric 256
unreachable default dev lo  metric -1  error -128
local ::1 dev lo  metric 0
local fd3c:40cb:d011:: dev lo  metric 0
local fd3c:40cb:d011::1 dev lo  metric 0
local fe80:: dev lo  metric 0
local fe80:: dev lo  metric 0
local fe80:: dev lo  metric 0
local fe80:: dev lo  metric 0
local fe80::d66e:eff:fef5:c1c6 dev lo  metric 0
local fe80::d66e:eff:fef5:c1c6 dev lo  metric 0
local fe80::d66e:eff:fef5:c1c6 dev lo  metric 0
local fe80::d66e:eff:fef5:c1c6 dev lo  metric 0
ff00::/8 dev br-lan  metric 256
ff00::/8 dev eth0  metric 256
ff00::/8 dev eth0.2  metric 256
ff00::/8 dev eth0.3  metric 256
unreachable default dev lo  metric -1  error -128</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p366941">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">ulmwind</div>
					<div class="post-datetime">
						18 Oct 2017, 14:33					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ve found the answer: <a href="https://serverfault.com/questions/827832/openvpn-routing-to-lan-behind-server">https://serverfault.com/questions/82783 … ind-server</a><br />System route doesn&#039;t suffice, openvpn iroute should be used.</p>											<p class="post-edited">(Last edited by <strong>ulmwind</strong> on 18 Oct 2017, 14:33)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p367042">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">tcm1003</div>
					<div class="post-datetime">
						20 Oct 2017, 00:20					</div>
				</div>
				<div class="post-content content">
					<p>Oh, thx, didn&#039;t find that on my search. Perhaps wrong query.</p><p>After some changes I could ping/traceroute 192.168.0.50, but no other hosts in 0 network. <br />But this could be of a wrong routing in .0.1 - i have to check this.</p><p>I remembered that I wanted to activate NAT/masquerading for vpn. I checked this and now it&#039;s working. <br />If the corrected routing is working too I will check whether I use this or masquerading.</p><p>Thanks a lot for your help. </p><p>(Would it be helpful to post my edited configurations for archive, if somebody is searching for a similiar problem?)</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>