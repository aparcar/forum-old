<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Howto: Debrick a DLink DSL-502T using JTAG</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 5 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p35448">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">Z3r0</div>
					<div class="post-datetime">
						15 Oct 2006, 18:05					</div>
				</div>
				<div class="post-content content">
					<p>Hi everyone</p><p>I&#039;ve got a D-Link DSL-502T AU, this is just a guide to de-bricking it and restoring the default DLink firmware, you should probably read this before you attempt to flash the router with Openwrt. If your router stops working use the recovery procedures outlined by D-Link first of all. Before flashing please get a JTAG cable and (optionally) a Serial cable. The JTAG will allow you to talk directly to the routers AR7 processor and restore the firmware. The serial cable will give you DMESG / debug information and is useful when trying to see why OpenWRT won&#039;t start <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Another thing to check before flashing or attempting to flash to openwrt is that your flash memory chip is supported by HairyDairyMaids debrick utility, otherwise you are stuck <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> </p><p>Get it here: <a href="http://downloads.openwrt.org/utils/">http://downloads.openwrt.org/utils/</a> and run ./wrt54g and check if your flash chip is listed.</p><p>Inside the unit you will find: a 14 pin JTAG connector (soldered on mine), 14 pin GPIO (unsoldered), 5 pin Serial (soldered), 10 pin serial (unsoldered), my flash chip was Samsung K8D3216UBC (It&#039;s next to the JTAG connector).</p><p>If you have erased the bootloader or the config file you will have a dead router and need to recover using the JTAG method. This cannot happen when flashing with the default D-Link utilities! You can use the software recovery methods outlined on their site.</p><p>The only way to recover from this point is to use a JTAG cable to connect ot the router and talk directly to the AR7 MIPS based processor.</p><p>It&#039;s pretty simple, there are schematics here available for the poor mans JTAG, this is a cable with 4 or 5 resistors and no data buffer chip.</p><p>The WRT54G uses EJTAG 2.0 and a 12pin JTAG. You can buy one of these JTAG cables from ebay and then mod it to be used on your AR7 router, or you can build your own. The AR7 uses EJTAG 2.6 and has a 14pin JTAG. The difference? The WRT54G doesn&#039;t need pin 1 TRST set to high, the AR7 does. To do this you just get a 100ohm resistor and connect pin 1 to pin 8 via this resistor (note my pin numbering may be different to yours).</p><p>Pin schematics are here:<br /><a href="http://wiki.openwrt.org/AR7Port">http://wiki.openwrt.org/AR7Port</a><br /><a href="http://wiki.openwrt.org/OpenWrtDocs/Customizing/Hardware/JTAG_Cable">http://wiki.openwrt.org/OpenWrtDocs/Cus â€¦ JTAG_Cable</a></p><p>My pins are numbered as so:</p><p>1 (TRST) - 14<br />2 - 13<br />3 - 12<br />4 - 11<br />5 - 10<br />6 - 9<br />7 - 8 (VIO/VCCC/VREF)</p><p>Now, my BIOS settings for my printer port were: ECP+EPP, 0x378.</p><p>Once you do this you can use HairyDairyMaids debrick utility 4.8</p><p>Under Windows: load giveio.sys by running loaddrv.exe and adding &#039;giveio.sys&#039; to the end of the line and clicking install+start.</p><p>Under Linux (Ubuntu): Get the build essentials package, compile the binary using &#039;make&#039; from the folder you extracted the files to, then you need to do this to read the parallel port: rmmod lp, modprobe parport, mknod /dev/parport0 c 99 0</p><p>You can now do ./wrt54g -probeonly to test if the unit can be detected</p><p>I will keep this simple, first of all flash the ADAM2 bootloader (64k):</p><p>root@ZPC:~/HairyDairyMaid_WRT54G_Debrick_Utility_v48# ./wrt54g -flash:custom&nbsp; /noerase /nobreak /nodma /window:0x90000000 /start:0x90000000 /length:0x10000&nbsp; /nocwd</p><p>====================================<br />WRT54G/GS EJTAG Debrick Utility v4.8<br />====================================</p><p>Probing bus ... Done</p><p>Instruction Length set to 5</p><p>CPU Chip ID: 00000000000000000001000000001111 (0000100F)<br />*** Found a TI AR7WRD TNETD7300GDU Rev 1 CPU chip ***</p><p>&nbsp; &nbsp; - EJTAG IMPCODE ....... : 01000001010000000100000000000000 (41404000)<br />&nbsp; &nbsp; - EJTAG Version ....... : 2.6<br />&nbsp; &nbsp; - EJTAG DMA Support ... : No<br />&nbsp; &nbsp; *** DMA Mode Forced Off ***</p><p>Issuing Processor / Peripheral Reset ... Done<br />Enabling Memory Writes ... Skipped<br />Halting Processor ... Skipped<br />Clearing Watchdog ... Skipped</p><p>Probing Flash at (Flash Window: 0x90000000) ... Done</p><p>Flash Vendor ID: 00000000000000000000000011101100 (000000EC)<br />Flash Device ID: 00000000000000000010001010100010 (000022A2)<br />*** Found a K8D3216UBC&nbsp; 2Mx16 BotB&nbsp; &nbsp; &nbsp;(4MB) Flash Chip ***</p><p>&nbsp; &nbsp; - Flash Chip Window Start .... : 90000000<br />&nbsp; &nbsp; - Flash Chip Window Length ... : 00200000<br />&nbsp; &nbsp; - Selected Area Start ........ : 90000000<br />&nbsp; &nbsp; - Selected Area Length ....... : 00010000</p><p>*** You Selected to Flash the CUSTOM.BIN ***</p><p>=========================<br />Flashing Routine Started<br />=========================</p><p>Loading CUSTOM.BIN to Flash Memory...<br />[&nbsp; 0% Flashed]&nbsp; &nbsp;90000000: 40809000 40809800 401a6000 241bfffe<br />[&nbsp; 0% Flashed]&nbsp; &nbsp;90000010: 035bd024 3c1b0040 035bd025 409a6000</p><p>etc...</p><p>Done&nbsp; (CUSTOM.BIN loaded into Flash Memory OK)</p><p>=========================<br />Flashing Routine Complete<br />=========================<br />elapsed time: 1522 seconds</p><br /><p> *** REQUESTED OPERATION IS COMPLETE ***</p><p>if you find the flash gets stuck at a certain percentage, use -erase:custom first to erase that area.</p><p>(Erase of config)</p><p>=========================<br />Erasing Routine Started<br />=========================<br />Total Blocks to Erase: 8</p><p>Erasing block: 1 (addr = 903f0000)...Done<br />Erasing block: 2 (addr = 903f2000)...Done<br />Erasing block: 3 (addr = 903f4000)...Done<br />Erasing block: 4 (addr = 903f6000)...Done<br />Erasing block: 5 (addr = 903f8000)...Done<br />Erasing block: 6 (addr = 903fa000)...Done<br />Erasing block: 7 (addr = 903fc000)...Done<br />Erasing block: 8 (addr = 903fe000)...Done<br />=========================<br />Erasing Routine Complete<br />=========================<br />elapsed time: 5 seconds</p><p>It takes about 20 mins to upload 64k and about 5 seconds to erase it <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Once you have done this now you need to flash a configuration using window:0x903f0000 start:0x903f0000 length:0x10000</p><p>Get this MTD3 configuration file: <a href="http://mcmcc.bat.ru/dlinkt/restore_mtd3_50xT.rar">http://mcmcc.bat.ru/dlinkt/restore_mtd3_50xT.rar</a></p><p>Once this is done, set you lan IP as 10.8.8.1 subnet 255.0.0.0 (on Linux u need to do ifconfig eth0 10.8.8.1 to set your IP) and then reboot the router, ftp into 10.8.8.8 21 using the command prompt FTP (not anything else) and you will see an adam2 prompt (gratz!).</p><p>root@ZPC:~/HairyDairyMaid_WRT54G_Debrick_Utility_v48# ping 10.8.8.8<br />PING 10.8.8.8 (10.8.8.8) 56(84) bytes of data.<br />From 10.8.8.10 icmp_seq=1 Destination Host Unreachable<br />From 10.8.8.10 icmp_seq=2 Destination Host Unreachable<br />From 10.8.8.10 icmp_seq=3 Destination Host Unreachable<br />From 10.8.8.10 icmp_seq=4 Destination Host Unreachable<br />From 10.8.8.10 icmp_seq=5 Destination Host Unreachable<br />From 10.8.8.10 icmp_seq=6 Destination Host Unreachable<br />64 bytes from 10.8.8.8: icmp_seq=7 ttl=250 time=2006 ms<br />64 bytes from 10.8.8.8: icmp_seq=9 ttl=250 time=5.17 ms<br />64 bytes from 10.8.8.8: icmp_seq=10 ttl=250 time=5.16 ms<br />64 bytes from 10.8.8.8: icmp_seq=11 ttl=250 time=5.09 ms<br />64 bytes from 10.8.8.8: icmp_seq=12 ttl=250 time=5.09 ms<br />64 bytes from 10.8.8.8: icmp_seq=13 ttl=250 time=5.09 ms<br />64 bytes from 10.8.8.8: icmp_seq=14 ttl=250 time=5.14 ms<br />64 bytes from 10.8.8.8: icmp_seq=15 ttl=250 time=5.16 ms<br />64 bytes from 10.8.8.8: icmp_seq=16 ttl=250 time=5.09 ms<br />64 bytes from 10.8.8.8: icmp_seq=17 ttl=250 time=5.09 ms<br />64 bytes from 10.8.8.8: icmp_seq=18 ttl=250 time=5.09 ms<br />64 bytes from 10.8.8.8: icmp_seq=19 ttl=250 time=5.14 ms</p><p>This is the glorious moment when my router started working again.</p><p>I found that all the adam2 bootloaders on the internet work fine, I ended up using olegs compiled version as this has a default IP hard coded into it. <a href="http://star.oai.pp.ru/jtag/adam2-oleg.zip">http://star.oai.pp.ru/jtag/adam2-oleg.zip</a></p><p>Now on to some instructions about how to restore the firmware from this stage,</p><p>First we need the firmware, just get the .bin from D-Link and rename it fw or fw.bin or something short <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p><a href="ftp://files.dlink.com.au/products/DSL-502T/REV_A/Firmware//Firmware_v2.00B06.AU_20060808_BIN/DSL-502T_V2.00B06.AU_20060808.bin">ftp://files.dlink.com.au/products/DSL-5 â€¦ 060808.bin</a></p><p>Now, you can upload the firmware (see below for an example)</p><p>root@ZPC:~# ifconfig eth0 10.8.8.7<br />root@ZPC:~# ftp 10.8.8.8 21<br />ftp: connect: No route to host<br />ftp&gt; <br />ftp&gt; o<br />(to) 10.8.8.8 21<br />Connected to 10.8.8.8.<br />220 ADAM2 FTP Server ready.<br />Name (10.8.8.8:z): adam2<br />331 Password required for adam2.<br />Password:<br />230 adam2 logged in.<br />ftp&gt; quote MEDIA FLSH<br />200 media set to FLASH<br />ftp&gt; binary<br />200 Type set to I.<br />ftp&gt; hash<br />Hash mark printing on (1024 bytes/hash mark).<br />ftp&gt; debug<br />Debugging on (debug=1).<br />ftp&gt; put &quot;fw&quot; &quot;fs mtd4&quot;<br />local: fw remote: fs mtd4<br />---&gt; PORT 10,8,8,7,170,251<br />200 Port command successful.<br />---&gt; STOR fs mtd4<br />150 Opening BINARY mode.<br />#############################################################################################################################################################<br />#############################################################################################################################################################<br />#############################################################################################################################################################<br />#############################################################################################################################################################<br />#############################################################################################################################################################<br />#############################################################################################################################################################<br />#############################################################################################################################################################<br />#############################################################################################################################################################<br />#############################################################################################################################################################<br />#############################################################################################################################################################<br />#############################################################################################################################################################<br />#############################################################################################################################################################<br />#################################################################<br />226 Transfer complete.<br />1996699 bytes sent in 27.36 secs (71.3 kB/s)<br />ftp&gt; quote REBOOT<br />---&gt; REBOOT<br />221 Goodbye.<br />ftp&gt; </p><p>But let me guess... you didn&#039;t get the firmware to upload? <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Did you get 550 can not erase or 550 flash erase failed </p><p>I think I know why!! <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>This is because the configuration file we just uploaded had the old firmware version 1 memory map and we are trying to upload a firmware version 2 which has a different memory mapping.</p><p>You can solve this by issuing SETENV commands with the correct memory mappings before uploading the firmware</p><p>quote &quot;SETENV mtd0,0x90091000,0x903f0000&quot; - filesystem<br />quote &quot;SETENV mtd1,0x90010090,0x90090000&quot; - kernel<br />quote &quot;SETENV mtd2,0x90000000,0x90010000&quot; - bootloader (adam2 mostly)<br />quote &quot;SETENV mtd3,0x903f0000,0x90400000&quot; - configuration<br />quote &quot;SETENV mtd4,0x90010090,0x903f0000&quot; - this just covers filesystem/kernel</p><p>(p.s. the extra , is no mistake, I think it&#039;s needed)</p><p>Another way to set these environment variables and upload the firwmare is to use CICLAMAB 3.7.9 (NOT 3.8.0 or 3.8.1 both crash), it does the same thing but has a nice GUI, you need to have your LAN IP as 10.8.8.1, router off and then run CICLAMAB, click no, click no, click on partitions, go to D-Link DSL-50xT v2, click setup, click cancel to return to previous screen, select your firmware, click on connection, power on modem, if your bootloader is detected you can click on &#039;execute&#039; and you should see the following:</p><p>00:57:26&nbsp; - Connection to &quot;BootLoader&quot; in progress...<br />00:57:27 x- &lt; 220 ADAM2 FTP Server ready.<br />00:57:27&nbsp; - 220 ADAM2 FTP Server ready.<br />00:57:27&nbsp; - Connection to &quot;BootLoader&quot; done!<br />00:57:27&nbsp; - USER adam2<br />00:57:27 x- &lt; 331 Password required for adam2.<br />00:57:27&nbsp; - 331 Password required for adam2.<br />00:57:27&nbsp; - PASS adam2<br />00:57:27 x- &lt; 230 adam2 logged in.<br />00:57:27&nbsp; - 230 adam2 logged in.<br />00:57:27&nbsp; - <br />00:57:27&nbsp; - ---------------------------------------------------------<br />00:57:27&nbsp; - modem/router info:<br />00:57:27 x- GETENV flashsize<br />00:57:27 x- &lt; flashsize&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x00400000<br />200 GETENV successful<br />00:57:27&nbsp; - bootloaderType&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ADAM2<br />00:57:27 x- GETENV bootloaderVersion<br />00:57:27 x- &lt; bootloaderVersion&nbsp; &nbsp; &nbsp;0.22.02<br />200 GETENV successful<br />00:57:27&nbsp; - bootloaderVersion&nbsp; &nbsp; &nbsp;0.22.02<br />00:57:27&nbsp; - flashsize&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x00400000 (4 Mb)<br />00:57:27 x- GETENV usb_prod<br />00:57:27 x- &lt; usb_prod&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; N/A<br />200 GETENV successful<br />00:57:27&nbsp; - usb_prod&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; N/A<br />00:57:27 x- GETENV mtd0<br />00:57:27 x- &lt; mtd0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x90091000,0x903f0000<br />200 GETENV successful<br />00:57:27&nbsp; - mtd0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x90091000,0x903f0000<br />00:57:27 x- GETENV mtd1<br />00:57:27 x- &lt; mtd1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x90010090,0x90090000<br />200 GETENV successful<br />00:57:27&nbsp; - mtd1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x90010090,0x90090000<br />00:57:27 x- GETENV mtd2<br />00:57:27 x- &lt; mtd2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x90000000,0x90010000<br />200 GETENV successful<br />00:57:27&nbsp; - mtd2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x90000000,0x90010000<br />00:57:27 x- GETENV mtd3<br />00:57:27 x- &lt; mtd3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x903f0000,0x90400000<br />200 GETENV successful<br />00:57:27&nbsp; - mtd3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x903f0000,0x90400000<br />00:57:27 x- GETENV mtd4<br />00:57:27 x- &lt; mtd4&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x90010000,0x903f0000<br />200 GETENV successful<br />00:57:27&nbsp; - mtd4&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x90010000,0x903f0000<br />00:57:37 x- Transferring file:<br />00:57:37 x- &nbsp; &nbsp;&nbsp; &nbsp;Firmware: D:\FTP\software\ckz_XZ7X\DLinkAU_DSL-502T_singleimage_kernel_fs_V2.00B06.AU_20060808<br />Inputted parameters:<br />&nbsp; &nbsp;- Autoload on<br />&nbsp; &nbsp;- Partitioning mtd0, mtd1 and mtd3 for D-Link DSL-50xT/604T/G604T v2<br />&nbsp; &nbsp;To start the session:<br />00:57:45&nbsp; - ---------------------------------------------------------<br />00:57:45&nbsp; - The partitions are already of the required size.<br />00:57:45&nbsp; - SETENV autoload,1<br />00:57:45 x- &lt; 200 SETENV successful<br />00:57:45&nbsp; - 200 SETENV successful<br />00:57:45&nbsp; - TYPE I<br />00:57:45 x- &lt; 200 Type set to I.<br />00:57:45&nbsp; - 200 Type set to I.<br />00:57:45&nbsp; - MEDIA FLSH<br />00:57:45 x- &lt; 200 media set to FLASH<br />00:57:45&nbsp; - 200 media set to FLASH<br />00:57:45&nbsp; - Creating &quot;mtd4&quot; variable.<br />00:57:45&nbsp; - SETENV mtd4,0x90010000,0x903f0000<br />00:57:45 x- &lt; 200 SETENV successful<br />00:57:45&nbsp; - 200 SETENV successful<br />00:57:45&nbsp; - PASV<br />00:57:45 x- &lt; 227 Entering Passive Mode (192,168,0,1,243,72).<br />00:57:45&nbsp; - 227 Entering Passive Mode (192,168,0,1,243,72).<br />00:57:46&nbsp; - Deleting partition &quot;mtd4&quot; in progress...<br />00:57:46 x- STOR single mtd4<br />00:58:18 x- &lt; 150 Opening BINARY mode.<br />00:58:18 x- Erase time: 00&#039; 32.27&quot;<br />00:58:18 x- Nr. of blocks to send: 527<br />00:58:44 x- Transfer time: 00&#039; 26.01&quot;<br />00:58:44 x- &lt; 226 Transfer complete.<br />00:58:44&nbsp; - 226 Transfer complete.<br />00:58:44&nbsp; - REBOOT</p><p>Ok so, power cycle the router and it should now work... lights should come on after 30 secs or so.</p><p>THE END!</p><p>Some extraneous information:</p><p>If you want to upload a custom OpenWRT firmware you will need to have a deeper understanding on the way the router works.</p><p>The single combined firmware is divided as so:</p><p>HEX<br />0-90 header<br />90-80FFF kernel with padded 0s at the end <br />81000-20EFFF filesystem with padded 0s<br />20F000-20F007 checksum for the entire file made with TICHKSUM (8 Bytes)</p><p>Please remember that a hex number is 4 bits, so each byte contains 2 hex numbers, this means 8 bytes = 16 hex numbers.</p><p>The TICHKSUM is not a standard 4 Byte CRC32 or 8 Byte CRC64, it is firstly a fixed set of 8 hex numbers 23DE53C4 (magic numbers) and then an 8 hex checksum such as:</p><p>23DE53C4 07D74626</p><p>Ok so.. what am I getting at here?</p><p>Well, if you compile the openwrt trunk and examine the ar7 firmware with a hex editor you will see that the squashfs.bin uses totally different mappings, openwrt does not waste space by padding to boundaries with extra 0s.</p><p>Openwrt is usually<br />0-x kernel<br />x-eof squashfs</p><p>so for this file system to boot, you will need to find the hex values of the start of the squashfs filesystem (use ghex under linux or XVI under windows) and search for &#039;hsq&#039; this signifies the start of the squashfs. Now adjust mtd0 and mtd1 variables accordingly.</p><p>You also need to add a checksum to the end of the file by running ./tichksum under Linux or by compiling tichksum under windows.</p><p>TICHKSUM can be found in the DSL-502T source code.</p><p>--------</p><p>Note, if you compile your firmware and upload it and the DMZ lights stays on, this means your kernel has died <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> You need a serial cable to work out how to fix it... as for me... I have no serial cable and no urge to work it out, so back to the default fw for me as SVN trunk 5109 wouldn&#039;t compile <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><p>(For anyone who tries to use ndbs march ar7 firmware, no lights go on at all for me with this)</p>											<p class="post-edited">(Last edited by <strong>Z3r0</strong> on 15 Oct 2006, 18:54)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p35524">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">mctiew</div>
					<div class="post-datetime">
						17 Oct 2006, 05:02					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Z3r0 wrote:</cite><blockquote><p>so for this file system to boot, you will need to find the hex values of the start of the squashfs filesystem (use ghex under linux or XVI under windows) and search for &#039;hsq&#039; this signifies the start of the squashfs. Now adjust mtd0 and mtd1 variables accordingly.</p><p>You also need to add a checksum to the end of the file by running ./tichksum under Linux or by compiling tichksum under windows.</p><p>TICHKSUM can be found in the DSL-502T source code</p></blockquote></div><p>I have a few question.</p><p>I have checked out the whilte russian and also kamekaze. The whiterussian has no mention of compiiling for AR7 processor, so I supposed compiling for DLINK AR7 is only starting at Kamekaze ?</p><p>The second question I have is I have checked out Kamekaze r5157 and compiiled for AR7 processor, I got knocked out at this point :-</p><p>&nbsp; &nbsp; make[6] -C target/linux/ar7-2.4 modules<br />&nbsp; &nbsp;Build failed. Please re-run make with V=99 to see what&#039;s going on</p><p>After debugging then I hacked&nbsp; ~/trunk/target/linux/ar7-2.4/Makefile to remove the extra &#039;-&#039; at the back of the TAR_OPTIONS, is it as expected ?</p><p>Next I managed to proceed with everything and finally produced ~trunk/bin/openwrt-ar7-2.4-squashfs.bin. However, when I proceed to look for hsq string,&nbsp; I don&#039;t understand the part adjusting the mtd0 and mtd1, because I could not find anything looks like mtd0 and mtd1, and also I don&#039;t know what to set even if I could find it.</p><p>Finally, regarding t1chksum source code, it&#039;s meantioned that I could find it &quot;in the DSL-502T source code&quot;. Where it is supposed to be ?</p><p>Sorry this should probably be posted to Kamekaze, but I have to replly to the original post, so I am posting here to catch the original poster&#039;s attention.</p><p>Thank you for making these information available.</p><p>Best regards.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p35525">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">Z3r0</div>
					<div class="post-datetime">
						17 Oct 2006, 05:04					</div>
				</div>
				<div class="post-content content">
					<p>edit: You may need to do quote &quot;SETENV MAC_PORT,1&quot; or mac_port,1 to get the ethernet connection to work correctly! for more info see this: <a href="https://dev.openwrt.org/ticket/763">https://dev.openwrt.org/ticket/763</a></p><p>Firstly I will just post this log then reply to your question, luckily for me the firmware was fixed between rev 5109 and 5174, I think it was due to DHCP not working properly as mentioned by a dg834 user in trac <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>root@ZPC:/home/z/trunk/bin# dhclient eth0<br />There is already a pid file /var/run/dhclient.pid with pid 25053<br />killed old client process, removed PID file<br />Internet Systems Consortium DHCP Client V3.0.4<br />Copyright 2004-2006 Internet Systems Consortium.<br />All rights reserved.<br />For info, please visit <a href="http://www.isc.org/sw/dhcp/">http://www.isc.org/sw/dhcp/</a></p><p>wmaster0: unknown hardware address type 801<br />wmaster0: unknown hardware address type 801<br />Listening on LPF/eth0/00:01:6c:a6:05:93<br />Sending on&nbsp; &nbsp;LPF/eth0/00:01:6c:a6:05:93<br />Sending on&nbsp; &nbsp;Socket/fallback<br />DHCPREQUEST on eth0 to 255.255.255.255 port 67<br />DHCPREQUEST on eth0 to 255.255.255.255 port 67<br />DHCPDISCOVER on eth0 to 255.255.255.255 port 67 interval 7<br />DHCPDISCOVER on eth0 to 255.255.255.255 port 67 interval 7<br />DHCPDISCOVER on eth0 to 255.255.255.255 port 67 interval 18<br />DHCPDISCOVER on eth0 to 255.255.255.255 port 67 interval 18<br />DHCPOFFER from 192.168.1.1<br />DHCPREQUEST on eth0 to 255.255.255.255 port 67<br />DHCPACK from 192.168.1.1<br />bound to 192.168.1.111 -- renewal in 16800 seconds.<br />root@ZPC:/home/z/trunk/bin# telnet 192.168.1.111<br />Trying 192.168.1.111...<br />telnet: Unable to connect to remote host: Connection refused<br />root@ZPC:/home/z/trunk/bin# telnet 192.168.1.1<br />Trying 192.168.1.1...<br />Connected to 192.168.1.1.<br />Escape character is &#039;^]&#039;.<br /> === IMPORTANT ============================<br />&nbsp; Use &#039;passwd&#039; to set your login password<br />&nbsp; this will disable telnet and enable SSH<br /> ------------------------------------------</p><br /><p>BusyBox v1.2.1 (2006.10.17-01:23+0000) Built-in shell (ash)<br />Enter &#039;help&#039; for a list of built-in commands.</p><p>&nbsp; _______&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;________&nbsp; &nbsp; &nbsp; &nbsp; __<br /> |&nbsp; &nbsp; &nbsp; &nbsp;|.-----.-----.-----.|&nbsp; |&nbsp; |&nbsp; |.----.|&nbsp; |_<br /> |&nbsp; &nbsp;-&nbsp; &nbsp;||&nbsp; _&nbsp; |&nbsp; -__|&nbsp; &nbsp; &nbsp;||&nbsp; |&nbsp; |&nbsp; ||&nbsp; &nbsp;_||&nbsp; &nbsp;_|<br /> |_______||&nbsp; &nbsp;__|_____|__|__||________||__|&nbsp; |____|<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |__| W I R E L E S S&nbsp; &nbsp;F R E E D O M<br /> KAMIKAZE (bleeding edge, r5174) -------------------<br />&nbsp; * 10 oz Vodka&nbsp; &nbsp; &nbsp; &nbsp;Shake well with ice and strain<br />&nbsp; * 10 oz Triple sec&nbsp; mixture into 10 shot glasses.<br />&nbsp; * 10 oz lime juice&nbsp; Salute!<br /> ---------------------------------------------------<br />root@OpenWrt:/#</p>											<p class="post-edited">(Last edited by <strong>Z3r0</strong> on 19 Oct 2006, 11:33)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p35527">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">Z3r0</div>
					<div class="post-datetime">
						17 Oct 2006, 05:23					</div>
				</div>
				<div class="post-content content">
					<p>White Russian does not have AR7 support, Kamikaze can be downloaded from the svn trunk folder</p><p>svn co <a href="https://svn.openwrt.org/openwrt/trunk">https://svn.openwrt.org/openwrt/trunk</a></p><p>or you can get a specific revision with</p><p>svn -r 5174 co <a href="https://svn.openwrt.org/openwrt/trunk">https://svn.openwrt.org/openwrt/trunk</a></p><p>with the compile error, go into rules.mk and go to the second tar options and remove the -</p><p>then continue compiling and when it stops again, then go back into rules.mk and add the - again</p><p>then continue compiling</p><p>ok, now, when you are trying to upload the firmware you need to remember this.</p><p>this explanation regarding the memory mapping of the firmware could get confusing so bear with me</p><p>when you flash with the d-link singleimage.bin firmware you are flashing mtd4 and avoiding mtd2 and mtd3.</p><p>mtd4 covers mtd0 and mtd1 (fs and kernel)</p><p>with the dlink firmware they always pad the extra space between the kernel and filesystem to the existing mtd0/mtd1 boundaries, but with openwrt it removes the extra space between the fs and kernel so you need to adjust your mtd0/1 boundaries.</p><p>get ghex2 and open up openwrt-ar7-2.4-squashfs.bin the kernel starts from the beginning of the file and by searching for the string hsqs or hex 68 73 71 73 I can find that the squashfs filesystem starts from (in my case) 0x900750E0 </p><p>now I just adjust my memory mappings by using the adam2 ftp so that I have</p><p>mtd0,0x900850E0,0x9003f0000 (fs)<br />mtd1,0x90010000,0x900850E0 (note I added 10000) (kernel)<br />mtd2,0x90000000,0x90010000 (adam2 unchanged)<br />mtd3,0x9003f000,0x90040000 (config) (unused by openwrt now, only used by adam2)<br />mtd4,0x90010000,0x9003f000)</p><p>You need to add a checksum to the end of the bin file for it to upload correctly.</p><p>You need to get the source code from dlink for the 502T and then find the tichksum probably in the scripts folder and compile <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p35530">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">Z3r0</div>
					<div class="post-datetime">
						17 Oct 2006, 06:37					</div>
				</div>
				<div class="post-content content">
					<p>Here is some more info</p><p>&lt;4&gt;CPU revision is: 00018448<br />&lt;4&gt;Primary instruction cache 16kB, physically tagged, 4-way, linesize 16 bytes.<br />&lt;4&gt;Primary data cache 16kB, 4-way, linesize 16 bytes.<br />&lt;4&gt;Linux version 2.4.32 (root@ZPC) (gcc version 3.4.6 (OpenWrt-2.0)) #2 Tue Oct 17 11:29:52 EST 2006<br />&lt;4&gt;Determined physical RAM map:<br />&lt;4&gt; memory: 00020000 @ 14000000 (ROM data)<br />&lt;4&gt; memory: 00fe0000 @ 14020000 (usable)<br />&lt;4&gt;On node 0 totalpages: 4096<br />&lt;4&gt;zone(0): 4096 pages.<br />&lt;4&gt;zone(1): 0 pages.<br />&lt;4&gt;zone(2): 0 pages.<br />&lt;4&gt;Kernel command line: root=/dev/mtdblock2 rootfstype=squashfs,jffs2 init=/etc/preinit noinitrd console=ttyS0,38400<br />&lt;7&gt;set_except_vector: using long jump via k0 to reach 94025200<br />&lt;4&gt;the pacing pre-scalar has been set as 600.<br />&lt;7&gt;set_except_vector: using long jump via k0 to reach 94151f40<br />&lt;4&gt;Using 75.000 MHz high precision timer.<br />&lt;4&gt;Calibrating delay loop... 149.91 BogoMIPS<br />&lt;6&gt;Memory: 14292k/16384k available (1346k kernel code, 2092k reserved, 92k data, 72k init, 0k highmem)<br />&lt;6&gt;Dentry cache hash table entries: 2048 (order: 2, 16384 bytes)<br />&lt;6&gt;Inode cache hash table entries: 1024 (order: 1, 8192 bytes)<br />&lt;6&gt;Mount cache hash table entries: 512 (order: 0, 4096 bytes)<br />&lt;6&gt;Buffer cache hash table entries: 1024 (order: 0, 4096 bytes)<br />&lt;4&gt;Page-cache hash table entries: 4096 (order: 2, 16384 bytes)<br />&lt;4&gt;Checking for &#039;wait&#039; instruction...&nbsp; available.<br />&lt;4&gt;POSIX conformance testing by UNIFIX<br />&lt;6&gt;Linux NET4.0 for Linux 2.4<br />&lt;6&gt;Based upon Swansea University Computer Society NET3.039<br />&lt;4&gt;Initializing RT netlink socket<br />&lt;4&gt;Starting kswapd<br />&lt;6&gt;devfs: v1.12c (20020818) Richard Gooch (rgooch@atnf.csiro.au)<br />&lt;6&gt;devfs: boot_options: 0x1<br />&lt;5&gt;JFFS2 version 2.1. (C) 2001 Red Hat, Inc., designed by Axis Communications AB.<br />&lt;6&gt;squashfs: version 3.0 (2006/03/15) Phillip Lougher<br />&lt;4&gt;pty: 256 Unix98 ptys configured<br />&lt;6&gt;Serial driver version 5.05c (2001-07-08) with no serial options enabled<br />&lt;6&gt;ttyS00 at 0xa8610e00 (irq = 15) is a 16550A<br />&lt;6&gt;ttyS01 at 0xa8610f00 (irq = 16) is a 16550A<br />&lt;4&gt;VLYNQ INIT FAILED: Please try cold reboot.<br />&lt;4&gt;Vlynq CONFIG_AR7_VLYNQ_PORTS=2<br />&lt;4&gt;Vlynq Device vlynq0 registered with minor no 63 as misc device. Result=0<br />&lt;4&gt;VLYNQ 0 : init failed<br />&lt;4&gt;Vlynq Device vlynq1 registered with minor no 62 as misc device. Result=0<br />&lt;4&gt;VLYNQ 1 : init failed<br />&lt;6&gt;ar7_wdt: last system reset initiated by hardware reset<br />&lt;7&gt;ar7_wdt: disabling watchdog timer<br />&lt;6&gt;ar7_wdt: timer margin 59 seconds (prescale 65535, change 57180, freq 62500000)<br />&lt;5&gt;ar7 flash device: 0x400000 at 0x10000000.<br />&lt;5&gt; Amd/Fujitsu Extended Query Table v3.3 at 0x0040<br />&lt;5&gt;number of CFI chips: 1<br />&lt;5&gt;cfi_cmdset_0002: Disabling fast programming due to code brokenness.<br />&lt;4&gt;Parsing ADAM2 partition map...<br />&lt;4&gt;Looking for mtd device :mtd0:<br />&lt;4&gt;Found a mtd0 image (0x850e0), with size (0x36af20).<br />&lt;4&gt;Assuming default rootfs offset of 0x850e0<br />&lt;4&gt;Looking for mtd device :mtd1:<br />&lt;4&gt;Found a mtd1 image (0x10000), with size (0x750e0).<br />&lt;4&gt;Looking for mtd device :mtd2:<br />&lt;4&gt;Found a mtd2 image (0x0), with size (0x10000).<br />&lt;4&gt;Assuming adam2 size of 0x10000<br />&lt;4&gt;Looking for mtd device :mtd3:<br />&lt;4&gt;Found a mtd3 image (0x3f0000), with size (0x10000).<br />&lt;4&gt;Looking for mtd device :mtd4:<br />&lt;4&gt;Found a mtd4 image (0x10000), with size (0x3e0000).<br />&lt;4&gt;Setting new rootfs offset to 000850e0<br />&lt;4&gt;Squashfs detected (size = 0xb0085154)<br />&lt;5&gt;Creating 5 MTD partitions on &quot;Physically mapped flash&quot;:<br />&lt;5&gt;0x00000000-0x00010000 : &quot;adam2&quot;<br />&lt;5&gt;0x00010000-0x003f0000 : &quot;linux&quot;<br />&lt;5&gt;0x000850e0-0x00180000 : &quot;rootfs&quot;<br />&lt;4&gt;mtd: partition &quot;rootfs&quot; doesn&#039;t start on an erase block boundary -- force read-only<br />&lt;5&gt;0x003f0000-0x00400000 : &quot;config&quot;<br />&lt;5&gt;0x00180000-0x003f0000 : &quot;OpenWrt&quot;<br />&lt;6&gt;Initializing Cryptographic API<br />&lt;6&gt;NET4: Linux TCP/IP 1.0 for NET4.0<br />&lt;6&gt;IP Protocols: ICMP, UDP, TCP, IGMP<br />&lt;6&gt;IP: routing cache hash table of 512 buckets, 4Kbytes<br />&lt;6&gt;TCP: Hash tables configured (established 1024 bind 2048)<br />&lt;4&gt;ip_conntrack version 2.1 (5953 buckets, 5953 max) - 360 bytes per conntrack<br />&lt;4&gt;ip_tables: (C) 2000-2002 Netfilter core team<br />&lt;6&gt;NET4: Unix domain sockets 1.0/SMP for Linux NET4.0.<br />&lt;6&gt;NET4: Ethernet Bridge 008 for NET4.0<br />&lt;6&gt;802.1Q VLAN Support v1.8 Ben Greear &lt;greearb@candelatech.com&gt;<br />&lt;6&gt;All bugs added by David S. Miller &lt;davem@redhat.com&gt;<br />&lt;4&gt;VFS: Mounted root (squashfs filesystem) readonly.<br />&lt;6&gt;Mounted devfs on /dev<br />&lt;4&gt;Preserving ADAM2 memory.<br />&lt;6&gt;Freeing unused kernel memory: 72k freed<br />&lt;4&gt;Algorithmics/MIPS FPU Emulator v1.5<br />&lt;4&gt;jffs2.bbc: SIZE compression mode activated.<br />&lt;4&gt;Using the MAC with internal PHY<br />&lt;4&gt;Cpmac driver is allocating buffer memory at init time.<br />&lt;4&gt;Using the MAC with internal PHY<br />&lt;4&gt;Cpmac driver Disable TX complete interrupt setting threshold to 20.<br />&lt;4&gt;registered device TI Avalanche SAR<br />&lt;4&gt;Initializing DSL interface<br />&lt;4&gt;size=27008<br />&lt;4&gt;size=26144<br />&lt;4&gt;size=26624<br />&lt;4&gt;size=24704<br />&lt;4&gt;size=21152<br />&lt;4&gt;dsl modulation = GLITE<br />&lt;4&gt;Texas Instruments ATM driver: version:[4.02.04.00]</p><p>cat /proc/cpuinfo<br />system type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: Texas Instruments AR7<br />processor&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: 0<br />cpu model&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: MIPS 4KEc V4.8<br />BogoMIPS&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : 149.91<br />wait instruction&nbsp; &nbsp; &nbsp; &nbsp; : yes<br />microsecond timers&nbsp; &nbsp; &nbsp; : yes<br />tlb_entries&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: 16<br />extra interrupt vector&nbsp; : yes<br />hardware watchpoint&nbsp; &nbsp; &nbsp;: yes<br />VCED exceptions&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: not available<br />VCEI exceptions&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: not available<br />root@OpenWrt:~#</p><p>cat /proc/meminfo <br />Mem:&nbsp; 14708736&nbsp; 7778304&nbsp; 6930432&nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp;872448&nbsp; 2486272<br />Swap:&nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0<br />MemTotal:&nbsp; &nbsp; &nbsp; &nbsp; 14364 kB<br />MemFree:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 6768 kB<br />MemShared:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 kB<br />Buffers:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;852 kB<br />Cached:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2428 kB<br />SwapCached:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 kB<br />Active:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1988 kB<br />Inactive:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1304 kB<br />HighTotal:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 kB<br />HighFree:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 kB<br />LowTotal:&nbsp; &nbsp; &nbsp; &nbsp; 14364 kB<br />LowFree:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 6768 kB<br />SwapTotal:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 kB<br />SwapFree:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 kB</p><p>cat /proc/modules<br />tiatm&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;113524&nbsp; &nbsp;0 (unused)<br />atm&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 35928&nbsp; &nbsp;0 [tiatm]<br />avalanche_cpmac&nbsp; &nbsp; &nbsp; &nbsp; 67768&nbsp; &nbsp;1</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p35532">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">mctiew</div>
					<div class="post-datetime">
						17 Oct 2006, 08:00					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Z3r0 wrote:</cite><blockquote><p>now I just adjust my memory mappings by using the adam2 ftp so that I have</p><p>mtd0,0x900850E0,0x9003f0000 (fs)<br />mtd1,0x90010000,0x900850E0 (note I added 10000) (kernel)<br />mtd2,0x90000000,0x90010000 (adam2 unchanged)<br />mtd3,0x9003f000,0x90040000 (config) (unused by openwrt now, only used by adam2)<br />mtd4,0x90010000,0x9003f000)</p><p>You need to add a checksum to the end of the bin file for it to upload correctly.</p><p>You need to get the source code from dlink for the 502T and then find the tichksum probably in the scripts folder and compile <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p></blockquote></div><p>Okay I think I understand what you are talking about now. Right now I am working on getting tichksum and I will come back to the flashing portion later.</p><p>I am actually interested to flash a DSL-500T. If you were to make an &quot;educated guess&quot; on it, do you think DSL-500T will work the same as 502T ( in respect of the flashing portion ) ?</p><p>Again, thanks for making this info available.</p><p>Cheers.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p35533">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">Z3r0</div>
					<div class="post-datetime">
						17 Oct 2006, 08:10					</div>
				</div>
				<div class="post-content content">
					<p>should work fine <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> </p><p>If you want to know what your memory mappings are... download the 500T firmware.exe and execute it.. go to c:\documents and settings\myname\local settings\temp and find where it extracted, then open up the tiupgrade.scp</p><p>Also check that your flash chip is listed on the wrt54g utility in case you need to recover the unit</p><p><a href="http://wiki.openwrt.org/OpenWrtDocs/Hardware/D-Link/DSL-502T">http://wiki.openwrt.org/OpenWrtDocs/Har â€¦ k/DSL-502T</a></p><p>For some more concise and clearer information</p>											<p class="post-edited">(Last edited by <strong>Z3r0</strong> on 17 Oct 2006, 10:12)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p35536">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">mctiew</div>
					<div class="post-datetime">
						17 Oct 2006, 10:19					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Z3r0 wrote:</cite><blockquote><p>If you want to know what your memory mappings are... download the 500T firmware.exe and execute it.. go to c:\documents and settings\myname\local settings\temp and find where it extracted, then open up the tiupgrade.scp</p></blockquote></div><p>I did all those things but I could not find any file with the name tiupgrade.scp.<br />By the way this is where I got the firmware :-</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<a href="http://www.dlink.com.ph/products/support.asp?pid=310#firmware">http://www.dlink.com.ph/products/suppor â€¦ 0#firmware</a></p><p>Since I am in Malaysia, I tested only the MA version. Also I don&#039;t have a hardware yet ( I am checking if all these are going to work first before I am purchasing it ), so I only run the program&nbsp; &#039;DSL-500T_MAupgrade.exe&#039; up to the point where it prompts me for device IP and password.</p><p>By the way I have compiled the program tichksum. So now sorting out the memory map is the only thing in the way of me doing an upgrade.</p><p>Regards</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p35537">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">Z3r0</div>
					<div class="post-datetime">
						17 Oct 2006, 10:35					</div>
				</div>
				<div class="post-content content">
					<p>You are right, here is the simpler way of getting the mtd mappings lol</p><p>Just plug your router into your PC and do this</p><p>power off the router<br />change your IP to 10.8.8.1</p><p>ftp 10.8.8.8 21<br />quote &quot;PRINTENV&quot;</p><p>or you can try</p><p>quote &quot;GETENV mtd0&quot;</p><p>also: I can&#039;t get the adsl interface up atm <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> only ethernet</p><p>see here on how to get ADSL to work with PPPoE (it&#039;s a similar process for PPPoA with this router)<br /><a href="http://forum.openwrt.org/viewtopic.php?pid=35563#p35563">http://forum.openwrt.org/viewtopic.php?pid=35563#p35563</a></p>											<p class="post-edited">(Last edited by <strong>Z3r0</strong> on 17 Oct 2006, 18:54)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p35540">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">mctiew</div>
					<div class="post-datetime">
						17 Oct 2006, 12:18					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Z3r0 wrote:</cite><blockquote><p>You are right, here is the simpler way of getting the mtd mappings lol</p><p>Just plug your router into your PC and do this</p><p>power off the router<br />change your IP to 10.8.8.1</p><p>ftp 10.8.8.8 21<br />quote &quot;PRINTENV&quot;</p><p>or you can try</p><p>quote &quot;GETENV mtd0&quot;</p><p>also: I can&#039;t get the adsl interface up atm <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> only ethernet</p></blockquote></div><p>Urh thank you so much. Doing these will boost up my confidence. I really don&#039;t want<br />to mess up my hardware and then having to get into JTAG stuff since I am not very much a hardware person.</p><p>Looks like the only thing in the way now is the hardware. </p><p>Cheers.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p35602">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">mctiew</div>
					<div class="post-datetime">
						18 Oct 2006, 04:18					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Z3r0 wrote:</cite><blockquote><p>ok, now, when you are trying to upload the firmware you need to remember this.</p><p>this explanation regarding the memory mapping of the firmware could get confusing so bear with me</p><p>when you flash with the d-link singleimage.bin firmware you are flashing mtd4 and avoiding mtd2 and mtd3.</p><p>mtd4 covers mtd0 and mtd1 (fs and kernel)</p><p>with the dlink firmware they always pad the extra space between the kernel and filesystem to the existing mtd0/mtd1 boundaries, but with openwrt it removes the extra space between the fs and kernel so you need to adjust your mtd0/1 boundaries.</p><p>get ghex2 and open up openwrt-ar7-2.4-squashfs.bin the kernel starts from the beginning of the file and by searching for the string hsqs or hex 68 73 71 73 I can find that the squashfs filesystem starts from (in my case) 0x900750E0 </p><p>now I just adjust my memory mappings by using the adam2 ftp so that I have</p><p>mtd0,0x900850E0,0x9003f0000 (fs)<br />mtd1,0x90010000,0x900850E0 (note I added 10000) (kernel)<br />mtd2,0x90000000,0x90010000 (adam2 unchanged)<br />mtd3,0x9003f000,0x90040000 (config) (unused by openwrt now, only used by adam2)<br />mtd4,0x90010000,0x9003f000)</p><p>You need to add a checksum to the end of the bin file for it to upload correctly.</p><p>You need to get the source code from dlink for the 502T and then find the tichksum probably in the scripts folder and compile <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p></blockquote></div><p>Sorry to seem endless in this topic but I am looking through the Kamikaze distribution, there is a file called scripts/adam2flash.pl; perhaps someone might want to check if it has automated all these things mentioned here.</p><p>Regards.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p35614">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">Z3r0</div>
					<div class="post-datetime">
						18 Oct 2006, 07:59					</div>
				</div>
				<div class="post-content content">
					<p>Yeah I know about adam2flash</p><p>I tried it but it doesn&#039;t work as I think it looks for a UDP packet on port 5035? when adam2 comes up and it says it can&#039;t detect mine... I did find that if I manually set the IP in the file it would connect and then die... I don&#039;t know enough to get it working unfortunately</p><p>If you read the source code you&#039;ll see it does basically the same thing you can do manually</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p35616">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">mctiew</div>
					<div class="post-datetime">
						18 Oct 2006, 09:06					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Z3r0 wrote:</cite><blockquote><p>Yeah I know about adam2flash</p><p>I tried it but it doesn&#039;t work as I think it looks for a UDP packet on port 5035? when adam2 comes up and it says it can&#039;t detect mine... I did find that if I manually set the IP in the file it would connect and then die... I don&#039;t know enough to get it working unfortunately</p><p>If you read the source code you&#039;ll see it does basically the same thing you can do manually</p></blockquote></div><p>Ok understandable. Perl is not my cup of tea too. My wishing thinking was that if the script works, then it will save me the trouble and getting into mistakes with numbers.</p><p>There is this additional info I found after searching the web :-</p><p>&nbsp; &nbsp; &nbsp; &nbsp;<a href="http://seattlewireless.net/?ADAM2">http://seattlewireless.net/?ADAM2</a></p><p>Cheers.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p38335">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">santosh0705</div>
					<div class="post-datetime">
						5 Dec 2006, 05:06					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Z3r0 wrote:</cite><blockquote><p>Inside the unit you will find: a 14 pin JTAG connector (soldered on mine), 14 pin GPIO (unsoldered), 5 pin Serial (soldered), <strong>10 pin serial (unsoldered)</strong>, my flash chip was Samsung K8D3216UBC (It&#039;s next to the JTAG connector).</p></blockquote></div><p>Hi Z3r0,<br />can you give the pin out of second serial port on Dlink dsl-xxxT.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p38416">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">Z3r0</div>
					<div class="post-datetime">
						6 Dec 2006, 09:47					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m not too sure, but it could be a Vlynq interface?</p><p><a href="http://www.xilinx.com/bvdocs/ipcenter/data_sheet/vlynq_ds324.pdf">http://www.xilinx.com/bvdocs/ipcenter/d â€¦ _ds324.pdf</a></p>											<p class="post-edited">(Last edited by <strong>Z3r0</strong> on 6 Dec 2006, 09:48)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p38431">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">santosh0705</div>
					<div class="post-datetime">
						6 Dec 2006, 15:32					</div>
				</div>
				<div class="post-content content">
					<p>I downloaded the file it says:</p><p>An external VLYNQ serial interface may have as few as 3 pins (1 Tx, 1 Rx,<br />and 1 clock) and as many as 10 pins (4 Tx, 4 Rx, 1 clock, and 1 power management) for maximum<br />bandwidth.</p><p>but as i discovered out of 10 pins there are 2 pins connected to 3.3v and 0v respectively, 2 pins are not connected anywhere and the rest pins carrying the signal.</p><p>any more clu out there?</p><p>UPDATES</p><p>Checked all the pins by sending very long file to the /dev/tts/1 and checked for any voltage level change but not get succeeded in finding the TX pin. So I assume that 2nd serial port will not be available at all.</p>											<p class="post-edited">(Last edited by <strong>santosh0705</strong> on 7 Jan 2007, 04:25)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p77037">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">ninjamaster</div>
					<div class="post-datetime">
						25 Nov 2008, 10:22					</div>
				</div>
				<div class="post-content content">
					<p>i had found this from this thread<br /><a href="http://ftp.iasi.roedu.net/mirrors/openwrt.org/utils/">http://ftp.iasi.roedu.net/mirrors/openwrt.org/utils/</a><br />my question is now, where the heck is the skynet 4 linux?&nbsp; i really dont want to wine it and would rather have native support for generating cfe images.&nbsp; i see that he flashes a coustom cfe, but where the heck did he get it from?</p><p>sorry for diging up such an old thread, i only felt that the subject was related.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>