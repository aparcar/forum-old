<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> TP-Link TL-MR3420 V2 (2.1)</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 9 Aug 2014 and 22 Apr 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 6</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=41326&amp;p=2.html">2</a></li><li><a href="viewtopic.php%3Fid=41326&amp;p=3.html">3</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=41326&amp;p=6.html">6</a></li></ul></nav></div>
			
		
		
			<article class="post" id="p187266">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">sancho</div>
					<div class="post-datetime">
						28 Dec 2012, 20:55					</div>
				</div>
				<div class="post-content content">
					<p>I bought this router this afternoon and I&#039;d like to help port OpenWRT onto the new HW.<br />I am searching for some experience - how to start and what tools to use.<br />I am newbie to HW hacking, but I have limited experience with serial consoles on other devices.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p187272">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">nebbia88</div>
					<div class="post-datetime">
						28 Dec 2012, 22:20					</div>
				</div>
				<div class="post-content content">
					<p>You can start by posting hi res pictures of the board <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p><p>If we are lucky the fw for mr3220 v2 will work ...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p187277">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">xopal</div>
					<div class="post-datetime">
						29 Dec 2012, 00:18					</div>
				</div>
				<div class="post-content content">
					<p>Here is picture of 3420v2</p><p><span class="postimg"><img src="http://i50.tinypic.com/2iw0up2.jpg" alt="http://i50.tinypic.com/2iw0up2.jpg" /></span></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p187279">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">nebbia88</div>
					<div class="post-datetime">
						29 Dec 2012, 00:22					</div>
				</div>
				<div class="post-content content">
					<p>is it yours? you confirm it has the same chips of mr3220 v2?</p><p><a href="https://forum.openwrt.org/viewtopic.php?pid=180376#p180376">https://forum.openwrt.org/viewtopic.php … 76#p180376</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p187280">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">xopal</div>
					<div class="post-datetime">
						29 Dec 2012, 00:43					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>nebbia88 wrote:</cite><blockquote><p>is it yours? you confirm it has the same chips of mr3220 v2?</p><p><a href="https://forum.openwrt.org/viewtopic.php?pid=180376#p180376">https://forum.openwrt.org/viewtopic.php … 76#p180376</a></p></blockquote></div><p>No , i found this picture on the net</p><p>3420v2:</p><p>Chip : Atheros AL93<strong>4</strong>1-AL1A</p><p>Ram chip : Zentel A3S56D40FTP-G5</p><p>3220v2:</p><p>Chip : Atheros AL93<strong>3</strong>1-AL1A</p><p>Ram chip : Zentel A3S56D40FTP-G5</p><p>it&#039;s seems they are perfectly match except the chip</p><p><strong>Last update Patch with no USB Power</strong></p><div class="codebox"><pre><code>Index: target/linux/ar71xx/files/arch/mips/ath79/mach-tl-wr841n-v8.c
===================================================================
--- target/linux/ar71xx/files/arch/mips/ath79/mach-tl-wr841n-v8.c    (revision 35052)
+++ target/linux/ar71xx/files/arch/mips/ath79/mach-tl-wr841n-v8.c    (working copy)
@@ -1,13 +1,14 @@
 /*
- *  TP-LINK TL-WR841N/ND v8 board support
+ *  TP-LINK TL-WR841N/ND v8/TL-MR3420 v2 board support
  *
- *  Copyright (C) 2012 Gabor Juhos &lt;juhosg@openwrt.org&gt;
+ *  Copyright (C) 2011-2012 Gabor Juhos &lt;juhosg@openwrt.org&gt;
  *
  *  This program is free software; you can redistribute it and/or modify it
  *  under the terms of the GNU General Public License version 2 as published
  *  by the Free Software Foundation.
  */
 
+#include &lt;linux/gpio.h&gt;
 #include &lt;linux/platform_device.h&gt;
 
 #include &lt;asm/mach-ath79/ath79.h&gt;
@@ -18,9 +19,13 @@
 #include &quot;dev-gpio-buttons.h&quot;
 #include &quot;dev-leds-gpio.h&quot;
 #include &quot;dev-m25p80.h&quot;
+#include &quot;dev-usb.h&quot;
 #include &quot;dev-wmac.h&quot;
 #include &quot;machtypes.h&quot;
 
+#define TL_WR841NV8_GPIO_BTN_RESET    17
+#define TL_WR841NV8_GPIO_BTN_WPS    16
+
 #define TL_WR841NV8_GPIO_LED_WLAN    13
 #define TL_WR841NV8_GPIO_LED_QSS    15
 #define TL_WR841NV8_GPIO_LED_WAN    18
@@ -30,8 +35,8 @@
 #define TL_WR841NV8_GPIO_LED_LAN4    12
 #define TL_WR841NV8_GPIO_LED_SYSTEM    14
 
-#define TL_WR841NV8_GPIO_BTN_RESET    17
-#define TL_WR841NV8_GPIO_SW_RFKILL    16
+#define TL_MR3420V2_GPIO_LED_3G        11
+#define TL_MR3420V2_GPIO_USB_POWER    8
 
 #define TL_WR841NV8_KEYS_POLL_INTERVAL    20    /* msecs */
 #define TL_WR841NV8_KEYS_DEBOUNCE_INTERVAL (3 * TL_WR841NV8_KEYS_POLL_INTERVAL)
@@ -78,44 +83,44 @@
         .name        = &quot;tp-link:green:wlan&quot;,
         .gpio        = TL_WR841NV8_GPIO_LED_WLAN,
         .active_low    = 1,
+    }, {
+        /* the 3G LED is only present on the MR3420 v2 */
+        .name        = &quot;tp-link:green:3g&quot;,
+        .gpio        = TL_MR3420V2_GPIO_LED_3G,
+        .active_low    = 1,
     },
 };
 
 static struct gpio_keys_button tl_wr841n_v8_gpio_keys[] __initdata = {
     {
-        .desc        = &quot;Reset button&quot;,
+        .desc        = &quot;reset&quot;,
         .type        = EV_KEY,
         .code        = KEY_RESTART,
         .debounce_interval = TL_WR841NV8_KEYS_DEBOUNCE_INTERVAL,
         .gpio        = TL_WR841NV8_GPIO_BTN_RESET,
         .active_low    = 1,
     }, {
-        .desc        = &quot;RFKILL switch&quot;,
-        .type        = EV_SW,
-        .code        = KEY_RFKILL,
+        /* the WPS button is only present on the MR3420 v2 */
+        .desc        = &quot;WPS&quot;,
+        .type        = EV_KEY,
+        .code        = KEY_WPS_BUTTON,
         .debounce_interval = TL_WR841NV8_KEYS_DEBOUNCE_INTERVAL,
-        .gpio        = TL_WR841NV8_GPIO_SW_RFKILL,
+        .gpio        = TL_WR841NV8_GPIO_BTN_WPS,
         .active_low    = 0,
     }
 };
 
-static void __init tl_wr841n_v8_setup(void)
+static void __init tl_ap123_setup(void)
 {
     u8 *mac = (u8 *) KSEG1ADDR(0x1f01fc00);
     u8 *ee = (u8 *) KSEG1ADDR(0x1fff1000);
 
-    ath79_register_leds_gpio(-1, ARRAY_SIZE(tl_wr841n_v8_leds_gpio),
-                 tl_wr841n_v8_leds_gpio);
-
-    ath79_register_gpio_keys_polled(1, TL_WR841NV8_KEYS_POLL_INTERVAL,
-                    ARRAY_SIZE(tl_wr841n_v8_gpio_keys),
-                    tl_wr841n_v8_gpio_keys);
-
     ath79_register_m25p80(&amp;tl_wr841n_v8_flash_data);
 
     ath79_setup_ar934x_eth_cfg(AR934X_ETH_CFG_SW_PHY_SWAP);
 
     ath79_register_mdio(1, 0x0);
+    ath79_register_mdio(0, 0x0);
 
     ath79_init_mac(ath79_eth0_data.mac_addr, mac, -1);
     ath79_init_mac(ath79_eth1_data.mac_addr, mac, 0);
@@ -135,5 +140,35 @@
     ath79_register_wmac(ee, mac);
 }
 
-MIPS_MACHINE(ATH79_MACH_TL_WR841N_V8, &quot;TL-WR841N-v8&quot;, &quot;TP-LINK TL-WR841N/ND v8&quot;,
-         tl_wr841n_v8_setup);
+static void __init tl_wr841n_v8_setup(void)
+{
+    tl_ap123_setup();
+
+    ath79_register_leds_gpio(-1, ARRAY_SIZE(tl_wr841n_v8_leds_gpio) - 1,
+                 tl_wr841n_v8_leds_gpio);
+    ath79_register_gpio_keys_polled(1, TL_WR841NV8_KEYS_POLL_INTERVAL,
+                    ARRAY_SIZE(tl_wr841n_v8_gpio_keys),
+                    tl_wr841n_v8_gpio_keys);
+}
+
+MIPS_MACHINE(ATH79_MACH_TL_WR841N_V8, &quot;TL-WR841N-v8&quot;, 
+    &quot;TP-LINK TL-WR841N/ND v8&quot;, tl_wr841n_v8_setup);
+
+static void __init tl_mr3420v2_setup(void)
+{
+    tl_ap123_setup();
+
+    gpio_request_one(TL_MR3420V2_GPIO_USB_POWER,
+             GPIOF_OUT_INIT_HIGH | GPIOF_EXPORT_DIR_FIXED,
+             &quot;USB power&quot;);
+    ath79_register_usb();
+
+    ath79_register_leds_gpio(-1, ARRAY_SIZE(tl_wr841n_v8_leds_gpio),
+                 tl_wr841n_v8_leds_gpio);
+    ath79_register_gpio_keys_polled(1, TL_WR841NV8_KEYS_POLL_INTERVAL,
+                    ARRAY_SIZE(tl_wr841n_v8_gpio_keys) - 1,
+                    tl_wr841n_v8_gpio_keys);
+}
+
+MIPS_MACHINE(ATH79_MACH_TL_MR3420_V2, &quot;TL-MR3420-v2&quot;,
+    &quot;TP-LINK TL-MR3420 v2&quot;, tl_mr3420v2_setup);
Index: target/linux/ar71xx/image/Makefile
===================================================================
--- target/linux/ar71xx/image/Makefile    (revision 35052)
+++ target/linux/ar71xx/image/Makefile    (working copy)
@@ -883,7 +883,7 @@
 $(eval $(call SingleProfile,TPLINKOLD,$(fs_squash),TLWR841NV15,tl-wr841nd-v1.5,TL-WR841N-v1.5,ttyS0,115200,0x08410002,2,4M))
 
 $(eval $(call SingleProfile,TPLINK,$(fs_64kraw),TLMR3220V1,tl-mr3220-v1,TL-MR3220,ttyS0,115200,0x32200001,1,4M))
-$(eval $(call SingleProfile,TPLINK,$(fs_64kraw),TLMR3420,tl-mr3420-v1,TL-MR3420,ttyS0,115200,0x34200001,1,4M))
+$(eval $(call SingleProfile,TPLINK,$(fs_64kraw),TLMR3420V1,tl-mr3420-v1,TL-MR3420,ttyS0,115200,0x34200001,1,4M))
 $(eval $(call SingleProfile,TPLINK,$(fs_64kraw),TLWA701,tl-wa701n-v1,TL-WA901ND,ttyS0,115200,0x07010001,1,4M))
 $(eval $(call SingleProfile,TPLINK,$(fs_64kraw),TLWA7510NV1,tl-wa7510n,TL-WA7510N,ttyS0,115200,0x75100001,1,4M))
 $(eval $(call SingleProfile,TPLINK,$(fs_64kraw),TLWA801NV1,tl-wa801nd-v1,TL-WA901ND,ttyS0,115200,0x08010001,1,4M))
@@ -907,6 +907,7 @@
 $(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLMR3020,tl-mr3020-v1,TL-MR3020,ttyATH0,115200,0x30200001,1,4Mlzma))
 $(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLMR3040,tl-mr3040-v1,TL-MR3040,ttyATH0,115200,0x30400001,1,4Mlzma))
 $(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLMR3220V2,tl-mr3220-v2,TL-MR3220-v2,ttyATH0,115200,0x32200002,1,4Mlzma))
+$(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLMR3420V2,tl-mr3420-v2,TL-MR3420-v2,ttyS0,115200,0x34200002,1,4Mlzma))
 $(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLWR703,tl-wr703n-v1,TL-WR703N,ttyATH0,115200,0x07030101,1,4Mlzma))
 $(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLWR740NV4,tl-wr740n-v4,TL-WR741ND-v4,ttyATH0,115200,0x07400004,1,4Mlzma))
 $(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLWR741NV4,tl-wr741nd-v4,TL-WR741ND-v4,ttyATH0,115200,0x07410004,1,4Mlzma))
@@ -956,6 +957,7 @@
 $(eval $(call MultiProfile,OPENMESH,OM2P MR600))
 $(eval $(call MultiProfile,TEW652BRP,TEW652BRP_FW TEW652BRP_RECOVERY))
 $(eval $(call MultiProfile,TLMR3220,TLMR3220V1 TLMR3220V2))
+$(eval $(call MultiProfile,TLMR3420,TLMR3420V1 TLMR3420V2))
 $(eval $(call MultiProfile,TLWA801,TLWA801NV1))
 $(eval $(call MultiProfile,TLWA901,TLWA901NV1 TLWA901NV2))
 $(eval $(call MultiProfile,TLWA7510,TLWA7510NV1))
Index: target/linux/ar71xx/base-files/lib/ar71xx.sh
===================================================================
--- target/linux/ar71xx/base-files/lib/ar71xx.sh    (revision 35052)
+++ target/linux/ar71xx/base-files/lib/ar71xx.sh    (working copy)
@@ -357,6 +357,9 @@
     *TL-MR3420)
         name=&quot;tl-mr3420&quot;
         ;;
+    *&quot;TL-MR3420 v2&quot;)
+        name=&quot;tl-mr3420-v2&quot;
+        ;;
     *TL-WA7510N)
         name=&quot;tl-wa7510n&quot;
         ;;
Index: target/linux/ar71xx/base-files/lib/upgrade/platform.sh
===================================================================
--- target/linux/ar71xx/base-files/lib/upgrade/platform.sh    (revision 35052)
+++ target/linux/ar71xx/base-files/lib/upgrade/platform.sh    (working copy)
@@ -155,6 +155,7 @@
     tl-mr3220 | \
     tl-mr3220-v2 | \
     tl-mr3420 | \
+    tl-mr3420-v2 | \
     tl-wa7510n | \
     tl-wa901nd | \
     tl-wa901nd-v2 | \
Index: target/linux/ar71xx/base-files/etc/uci-defaults/leds
===================================================================
--- target/linux/ar71xx/base-files/etc/uci-defaults/leds    (revision 35052)
+++ target/linux/ar71xx/base-files/etc/uci-defaults/leds    (working copy)
@@ -159,6 +159,7 @@
     ucidef_set_led_wlan &quot;wlan&quot; &quot;WLAN&quot; &quot;tp-link:green:wlan&quot; &quot;phy0tpt&quot;
     ;;
 
+tl-mr3420-v2 | \
 tl-wr841n-v8)
     ucidef_set_led_netdev &quot;wan&quot; &quot;WAN&quot; &quot;tp-link:green:wan&quot; &quot;eth0&quot;
     ucidef_set_led_switch &quot;lan1&quot; &quot;LAN1&quot; &quot;tp-link:green:lan1&quot; &quot;switch0&quot; &quot;0x04&quot;
Index: target/linux/ar71xx/base-files/etc/uci-defaults/network
===================================================================
--- target/linux/ar71xx/base-files/etc/uci-defaults/network    (revision 35052)
+++ target/linux/ar71xx/base-files/etc/uci-defaults/network    (working copy)
@@ -143,6 +143,7 @@
     ucidef_set_interfaces_lan_wan &quot;lan1 lan2 lan3 lan4&quot; &quot;wan&quot;
     ;;
 
+tl-mr3420-v2 |\
 tl-wr841n-v8)
     ucidef_set_interfaces_lan_wan &quot;eth1&quot; &quot;eth0&quot;
     ucidef_add_switch &quot;switch0&quot; &quot;1&quot; &quot;1&quot;
Index: target/linux/ar71xx/base-files/etc/diag.sh
===================================================================
--- target/linux/ar71xx/base-files/etc/diag.sh    (revision 35052)
+++ target/linux/ar71xx/base-files/etc/diag.sh    (working copy)
@@ -132,6 +132,7 @@
     tl-mr3220 | \
     tl-mr3220-v2 | \
     tl-mr3420 | \
+    tl-mr3420-v2 | \
     tl-wa901nd | \
     tl-wa901nd-v2 | \
     tl-wr1041n-v2 | \
Index: target/linux/ar71xx/generic/profiles/tp-link.mk
===================================================================
--- target/linux/ar71xx/generic/profiles/tp-link.mk    (revision 35052)
+++ target/linux/ar71xx/generic/profiles/tp-link.mk    (working copy)
@@ -60,6 +60,29 @@
 $(eval $(call Profile,TLMR3420))
 
 
+define Profile/TLMR3220V2
+    NAME:=TP-LINK TL-MR3220 v2
+    PACKAGES:=kmod-usb-core kmod-usb2 kmod-ledtrig-usbdev
+endef
+
+define Profile/TLMR3220V2/Description
+    Package set optimized for the TP-LINK TL-MR3220 v2.
+endef
+$(eval $(call Profile,TLMR3220V2))
+
+
+define Profile/TLMR3420V2
+    NAME:=TP-LINK TL-MR3420 v2
+    PACKAGES:=kmod-usb-core kmod-usb2 kmod-ledtrig-usbdev
+endef
+
+define Profile/TLMR3420V2/Description
+    Package set optimized for the TP-LINK TL-MR3420 v2.
+endef
+$(eval $(call Profile,TLMR3420V2))
+
+
+
 define Profile/TLWR703
     NAME:=TP-LINK TL-WR703N
     PACKAGES:=kmod-usb-core kmod-usb2
Index: tools/firmware-utils/src/mktplinkfw.c
===================================================================
--- tools/firmware-utils/src/mktplinkfw.c    (revision 35052)
+++ tools/firmware-utils/src/mktplinkfw.c    (working copy)
@@ -34,6 +34,7 @@
 #define HWID_TL_MR3220_V1    0x32200001
 #define HWID_TL_MR3220_V2    0x32200002
 #define HWID_TL_MR3420_V1    0x34200001
+#define HWID_TL_MR3420_V2    0x34200002
 #define HWID_TL_WA701N_V1    0x07010001
 #define HWID_TL_WA7510N_V1    0x75100001
 #define HWID_TL_WA801ND_V1    0x08010001
@@ -175,8 +176,7 @@
         .kernel_ep    = 0x80060000,
         .rootfs_ofs    = 0x100000,
     }, {
-        /* terminating entry */
-    }
+        }
 };
 
 static struct board_info boards[] = {
@@ -201,6 +201,11 @@
         .hw_rev        = 1,
         .layout_id    = &quot;4M&quot;,
     }, {
+        .id        = &quot;TL-MR3420v2&quot;,
+        .hw_id        = HWID_TL_MR3420_V2,
+        .hw_rev        = 1,
+        .layout_id    = &quot;4Mlzma&quot;,
+    }, {
         .id        = &quot;TL-WA701Nv1&quot;,
         .hw_id        = HWID_TL_WA701N_V1,
         .hw_rev        = 1,</code></pre></div><br /><p><strong>612-MIPS-ath79-TL-MR3420-v2-support.patch</strong></p><br /><div class="codebox"><pre><code>--- 612-MIPS-ath79-TL-MR3420-v2-support    2013-01-08 01:01:02.000000000 +0700
+++ 612-MIPS-ath79-TL-MR3420-v2-support.patch    2013-01-08 00:59:59.000000000 +0700
@@ -0,0 +1,27 @@
+--- a/arch/mips/ath79/Kconfig
++++ b/arch/mips/ath79/Kconfig
+@@ -541,12 +541,13 @@
+     select ATH79_DEV_M25P80
+ 
+ config ATH79_MACH_TL_WR841N_V8
+-    bool &quot;TP-LINK TL-WR841N/ND v8 support&quot;
++    bool &quot;TP-LINK TL-WR841N/ND v8/TL-MR3420 v2 support&quot;
+     select SOC_AR934X
+     select ATH79_DEV_ETH
+     select ATH79_DEV_GPIO_BUTTONS
+     select ATH79_DEV_LEDS_GPIO
+     select ATH79_DEV_M25P80
++    select ATH79_DEV_USB
+     select ATH79_DEV_WMAC
+ 
+ config ATH79_MACH_TL_WR941ND
+--- a/arch/mips/ath79/machtypes.h
++++ b/arch/mips/ath79/machtypes.h
+@@ -79,6 +79,7 @@
+     ATH79_MACH_TL_MR3220,        /* TP-LINK TL-MR3220 */
+     ATH79_MACH_TL_MR3220_V2,    /* TP-LINK TL-MR3220 v2 */
+     ATH79_MACH_TL_MR3420,        /* TP-LINK TL-MR3420 */
++    ATH79_MACH_TL_MR3420_V2,    /* TP-LINK TL-MR3420 v2 */
+     ATH79_MACH_TL_WA7510N_V1,    /* TP-LINK TL-WA7510N v1*/
+     ATH79_MACH_TL_WA901ND,        /* TP-LINK TL-WA901ND */
+     ATH79_MACH_TL_WA901ND_V2,    /* TP-LINK TL-WA901ND v2 */</code></pre></div>											<p class="post-edited">(Last edited by <strong>xopal</strong> on 8 Jan 2013, 11:18)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p187304">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">nebbia88</div>
					<div class="post-datetime">
						29 Dec 2012, 10:27					</div>
				</div>
				<div class="post-content content">
					<p>ok so it could be equal to the wr841nd v8.x, plus usb port..</p><p>I think that including the support may be similar to what has been done in the patch that creates mr3220v2 image starting from wr741nd v4 profile..</p><p><a href="https://dev.openwrt.org/changeset/34779">https://dev.openwrt.org/changeset/34779</a></p><p>to </p><p><a href="https://dev.openwrt.org/changeset/34782">https://dev.openwrt.org/changeset/34782</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p187481">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">xopal</div>
					<div class="post-datetime">
						31 Dec 2012, 14:21					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m trying to add support for this router but I&#039;m stuck at the section how to determine GPIO&#039;s for this router.</p><p><a href="http://forum.openwrt-id.org/viewtopic.php?pid=1127#p1127">http://forum.openwrt-id.org/viewtopic.p … 1127#p1127</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p187483">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">robthebrew</div>
					<div class="post-datetime">
						31 Dec 2012, 15:07					</div>
				</div>
				<div class="post-content content">
					<p>from that link, isn&#039;t this what you need:</p><p>+tl-mr3420-v2)<br />+&nbsp; &nbsp; ucidef_set_led_netdev &quot;wan&quot; &quot;WAN&quot; &quot;tp-link:green:wan&quot; &quot;eth1&quot;<br />+&nbsp; &nbsp; ucidef_set_led_switch &quot;lan1&quot; &quot;LAN1&quot; &quot;tp-link:green:lan1&quot; &quot;switch0&quot; &quot;0x04&quot;<br />+&nbsp; &nbsp; ucidef_set_led_switch &quot;lan2&quot; &quot;LAN2&quot; &quot;tp-link:green:lan2&quot; &quot;switch0&quot; &quot;0x08&quot;<br />+&nbsp; &nbsp; ucidef_set_led_switch &quot;lan3&quot; &quot;LAN3&quot; &quot;tp-link:green:lan3&quot; &quot;switch0&quot; &quot;0x10&quot;<br />+&nbsp; &nbsp; ucidef_set_led_switch &quot;lan4&quot; &quot;LAN4&quot; &quot;tp-link:green:lan4&quot; &quot;switch0&quot; &quot;0x02&quot;<br />+&nbsp; &nbsp; ucidef_set_led_wlan &quot;wlan&quot; &quot;WLAN&quot; &quot;tp-link:green:wlan&quot; &quot;phy0tpt&quot;<br />+&nbsp; &nbsp; ucidef_set_led_usbdev &quot;usb&quot; &quot;USB&quot; &quot;tp-link:green:3g&quot; &quot;1-1&quot;<br />+&nbsp; &nbsp; ;;</p><p>Forgive me if I am taking rubbish. I would also like to know an easy way or general way to find GPIOs without source code.<br />Finding unused ones seems trial and error after finding a pin tied up or down.<br />But how to identify those in use is a mystery to me (unless you have source code).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p187486">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">xopal</div>
					<div class="post-datetime">
						31 Dec 2012, 15:41					</div>
				</div>
				<div class="post-content content">
					<p>Thanks rob, this is my first trial build for this router I just followed what 3220v2 way to add into openwrt support, since this routers have same design in common except the chip.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p187526">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">xopal</div>
					<div class="post-datetime">
						1 Jan 2013, 07:35					</div>
				</div>
				<div class="post-content content">
					<p>Boot log with stock firmware ,before I flash it with my build :</p><div class="codebox"><pre><code>=~=~=~=~=~=~=~=~=~=~=~= PuTTY log 2013.01.01 12:26:53 =~=~=~=~=~=~=~=~=~=~=~=
                                                                                      f 7   $ $6&gt;öÿ       $$$$6¶      $$$&amp;$66ó    &amp;&gt;     $$$&amp;66ÿ     $$$&amp;&amp;6÷  $    $$$f~   $&amp;$ $66÷    $ $&amp;4ó  $                 

U-Boot 1.1.4 (Jul  3 2012 - 15:12:08)

U-boot AP123


DRAM:  32 MB
id read 0x100000ff
Flash:  4 MB
Using default environment

In:    serial
Out:   serial
Err:   serial
Net:   ag934x_enet_initialize...
wasp reset mask:c03300
WASP ----&gt; S27 PHY
GMAC: cfg1 0x5 cfg2 0x7114
eth0: ba:be:fa:ce:08:41
s27 reg init 
athrs27_phy_setup ATHR_PHY_CONTROL 4: 0x1000
athrs27_phy_setup ATHR_PHY_SPEC_STAUS 4: 0x10
eth0 up
WASP ----&gt; S27 PHY
GMAC: cfg1 0xf cfg2 0x7214
eth1: ba:be:fa:ce:08:41
s27 reg init lan 
ATHRS27: resetting s27
ATHRS27: s27 reset done
athrs27_phy_setup ATHR_PHY_CONTROL 0: 0x1000
athrs27_phy_setup ATHR_PHY_SPEC_STAUS 0: 0x10
athrs27_phy_setup ATHR_PHY_CONTROL 1: 0x1000
athrs27_phy_setup ATHR_PHY_SPEC_STAUS 1: 0x10
athrs27_phy_setup ATHR_PHY_CONTROL 2: 0x1000
athrs27_phy_setup ATHR_PHY_SPEC_STAUS 2: 0x10
athrs27_phy_setup ATHR_PHY_CONTROL 3: 0x1000
athrs27_phy_setup ATHR_PHY_SPEC_STAUS 3: 0x10
eth1 up
eth0, eth1
Autobooting in 1 seconds
#$½½Ñ¥¹image at 9f020000 ...
   Uncompressing Kernel Image ... ÿÿOK

Starting kernel ...

Booting Atheros AR934x
 
Linux version 2.6.31--LSDK-9.2.0_U5.508 (zhongjin@rd3linux.tplink) (gcc version 4.3.3 (GCC) ) #61 Tue Jul 3 15:17:14 CST 2012
flash_size passed from bootloader = 4
Ram size passed from bootloader =33554432
CPU revision is: 0001974c (MIPS 74Kc)
ath_sys_frequency: cpu srif ddr srif cpu 535 ddr 400 ahb 200
Determined physical RAM map:
 memory: 02000000 @ 00000000 (usable)
Zone PFN ranges:
  Normal   0x00000000 -&gt; 0x00002000
Movable zone start PFN for each node
early_node_map[1] active PFN ranges
    0: 0x00000000 -&gt; 0x00002000
Built 1 zonelists in Zone order, mobility grouping on.  Total pages: 8128
Kernel command line: console=ttyS0,115200 root=31:2 rootfstype=squashfs init=/sbin/init mtdparts=ath-nor0:128k(u-boot),1024k(kernel),2816k(rootfs),64k(config),64k(art) mem=32M
PID hash table entries: 128 (order: 7, 512 bytes)
Dentry cache hash table entries: 4096 (order: 2, 16384 bytes)
Inode-cache hash table entries: 2048 (order: 1, 8192 bytes)
Primary instruction cache 64kB, VIPT, 4-way, linesize 32 bytes.
Primary data cache 32kB, 4-way, VIPT, cache aliases, linesize 32 bytes
Writing ErrCtl register=00000000
Readback ErrCtl register=00000000
Memory: 30132k/32768k available (1723k kernel code, 2636k reserved, 426k data, 112k init, 0k highmem)
NR_IRQS:128
plat_time_init: plat time init done
Calibrating delay loop... 267.26 BogoMIPS (lpj=534528)
Mount-cache hash table entries: 512
NET: Registered protocol family 16
bio: create slab &lt;bio-0&gt; at 0
usbcore: registered new interface driver usbfs
usbcore: registered new interface driver hub
usbcore: registered new device driver usb
NET: Registered protocol family 2
IP route cache hash table entries: 1024 (order: 0, 4096 bytes)
TCP established hash table entries: 1024 (order: 1, 8192 bytes)
TCP bind hash table entries: 1024 (order: 0, 4096 bytes)
TCP: Hash tables configured (established 1024 bind 1024)
TCP reno registered
NET: Registered protocol family 1
ATH GPIOC major 0
squashfs: version 4.0 (2009/01/31) Phillip Lougher
msgmni has been set to 58
io scheduler noop registered
io scheduler deadline registered (default)
Serial: 8250/16550 driver, 1 ports, IRQ sharing disabled
serial8250.0: ttyS0 at MMIO 0xb8020000 (irq = 19) is a 16550A
console [ttyS0] enabled
PPP generic driver version 2.4.2
NET: Registered protocol family 24
5 cmdlinepart partitions found on MTD device ath-nor0
Creating 5 MTD partitions on &quot;ath-nor0&quot;:
0x000000000000-0x000000020000 : &quot;u-boot&quot;
0x000000020000-0x000000120000 : &quot;kernel&quot;
0x000000120000-0x0000003e0000 : &quot;rootfs&quot;
0x0000003e0000-0x0000003f0000 : &quot;config&quot;
0x0000003f0000-0x000000400000 : &quot;art&quot;
-&gt;Oops: flash id 0x10215 . 
ehci_hcd: USB 2.0 &#039;Enhanced&#039; Host Controller (EHCI) Driver
Port Status 1c000004 
ath-ehci ath-ehci.0: ATH EHCI
ath-ehci ath-ehci.0: new USB bus registered, assigned bus number 1
ehci_reset Intialize USB CONTROLLER in host mode: 13
ehci_reset Port Status 1c000000 
ath-ehci ath-ehci.0: irq 3, io mem 0x1b000000
ehci_reset Intialize USB CONTROLLER in host mode: 13
ehci_reset Port Status 1c000000 
ath-ehci ath-ehci.0: USB 2.0 started, EHCI 1.00
usb usb1: configuration #1 chosen from 1 choice
hub 1-0:1.0: USB hub found
hub 1-0:1.0: 1 port detected
TCP cubic registered
NET: Registered protocol family 17
802.1Q VLAN Support v1.8 Ben Greear &lt;greearb@candelatech.com&gt;
All bugs added by David S. Miller &lt;davem@redhat.com&gt;
athwdt_init: Registering WDT success
ath_otp_init: Registering OTP success
ath_clksw_init: Registering Clock Switch Interface success
VFS: Mounted root (squashfs filesystem) readonly on device 31:2.
Freeing unused kernel memory: 112k freed

init started:  BusyBox v1.01 (2012.02.08-01:42+0000) multi-call binary
This Board use 2.6.31
xt_time: kernel timezone is -0000
nf_conntrack version 0.5.0 (512 buckets, 5120 max)
ip_tables: (C) 2000-2006 Netfilter Core Team
insmod: cannot open module `/lib/modules/2.6.31/kernel/iptable_raw.ko&#039;: No such file or directory
insmod: cannot open module `/lib/modules/2.6.31/kernel/flashid.ko&#039;: No such file or directory
PPPoL2TP kernel driver, V1.0
PPTP driver version 0.8.3
insmod: cannot open module `/lib/modules/2.6.31/kernel/harmony.ko&#039;: No such file or directory

Now flash open!
Now flash open!
 (none) mips #61 Tue Jul 3 15:17:14 CST 2012 (none)

(none) login: ATHR_GMAC: Length per segment 1536
ATHR_GMAC: fifo cfg 3 01f00140
ATHR_GMAC: RX TASKLET - Pkts per Intr:32
mac:1 Registering S27....
ATHR_GMAC: Max segments per packet :   1
ATHR_GMAC: Max tx descriptor count :   40
ATHR_GMAC: Max rx descriptor count :   128
ATHR_GMAC: Mac capability flags    :   2D82
ATHR_GMAC: RX TASKLET - Pkts per Intr:32
mac:0 Registering S27....
ATHR_GMAC: Max segments per packet :   1
ATHR_GMAC: Max tx descriptor count :   40
ATHR_GMAC: Max rx descriptor count :   128
ATHR_GMAC: Mac capability flags    :   2582
athr_gmac_ring_alloc Allocated 640 at 0x81e80c00
athr_gmac_ring_alloc Allocated 2048 at 0x81ccb000
WASP ----&gt; S27 PHY MDIO
Setting Drop CRC Errors, Pause Frames and Length Error frames 
Setting PHY...
athr_gmac_ring_alloc Allocated 640 at 0x81e80800
athr_gmac_ring_alloc Allocated 2048 at 0x81ebc800
WASP ----&gt; S27 PHY MDIO
Setting Drop CRC Errors, Pause Frames and Length Error frames 
ATHRS27: resetting s27
ATHRS27: s27 reset done
++++ athrs27_igmp_setup once
port0 vid is 0xb000b
port1 vid is 0x30003
port2 vid is 0x50005
port3 vid is 0x70007
port4 vid is 0x90009
++ PVID: 0x0000000b, bitmap: 0x0000001f
++ PVID: 0x00000003, bitmap: 0x0000001f
++ PVID: 0x00000005, bitmap: 0x0000001f
K+ PVID: 0x00000007, bitmap: 0x0000001f
++ PVID: 0x00000009, bitmap: 0x0000001f
vtable vid: 0x00000002, bitmap 0x00000003
vtable vid: 0x00000004, bitmap 0x00000005
vtable vid: 0x00000006, bitmap 0x00000007
ÿvtable vid: 0x00000008, bitmap 0x00000009
vtable vid: 0x0000000a, bitmap 0x0000000b
vtable vid: 0x0000000c, bitmap 0x0000000d
vtable vid: 0x0000000e, bitmap 0x0000000f
vtable vid: 0x00000010, bitmap 0x00000011
vtable vid: 0x00000012, bitmap 0x00000013
vtable vid: 0x00000014, bitmap 0x00000015
vtable vid: 0x00000016, bitmap 0x00000017
vtable vid: 0x00000018, bitmap 0x00000019
vtable vid: 0x0000001a, bitmap 0x0000001b
vtable vid: 0x0000001c, bitmap 0x0000001d
vtable vid: 0x0000001e, bitmap 0x0000001f
vtable vid: 0x00000020, bitmap 0x00000021
Setting PHY...
device eth0 entered promiscuous mode
athr_gmac_ring_free Freeing at 0x81e80c00
athr_gmac_ring_free Freeing at 0x81ccb000
athr_gmac_ring_alloc Allocated 640 at 0x81e80c00
athr_gmac_ring_alloc Allocated 2048 at 0x81ebb800
WASP ----&gt; S27 PHY MDIO
Setting Drop CRC Errors, Pause Frames and Length Error frames 
Setting PHY...
Now flash open!
athr_gmac_ring_free Freeing at 0x81e80800
athr_gmac_ring_free Freeing at 0x81ebc800
athr_gmac_ring_alloc Allocated 640 at 0x81e80800
athr_gmac_ring_alloc Allocated 2048 at 0x81ebc000
WASP ----&gt; S27 PHY MDIO
Setting Drop CRC Errors, Pause Frames and Length Error frames 
Setting PHY...
====&gt;&gt;&gt;&gt;DHCP start.dhcpc.c,dhcpcStart,914 
====&gt;&gt;&gt;&gt;DHCP end.dhcpc.c,dhcpcStart,974 
nf_conntrack_rtsp v0.6.21 loading
nf_nat_rtsp v0.6.21 loading
asf: module license &#039;Proprietary&#039; taints kernel.
Disabling lock debugging due to kernel taint
ath_hal: 0.9.17.1 (AR5416, AR9380, REGOPS_FUNC, WRITE_EEPROM, 11D)
ath_rate_atheros: Copyright (c) 2001-2005 Atheros Communications, Inc, All Rights Reserved
ath_dev: Copyright (c) 2001-2007 Atheros Communications, Inc, All Rights Reserved
ath_ahb: 9.2.0_U10.1020 (Atheros/multi-bss)
__ath_attach: Set global_scn[0]
ACBKMinfree = 48
ACBEMinfree = 32
ACVIMinfree = 16
ACVOMinfree = 0
CABMinfree = 48
UAPSDMinfree = 0
Restoring Cal data from Flash
ath_get_caps[5105] rx chainmask mismatch actual 3 sc_chainmak 0
ath_get_caps[5080] tx chainmask mismatch actual 3 sc_chainmak 0
wifi0: Atheros 9340: mem=0xb8100000, irq=2
====&gt;&gt;&gt;&gt;SystemMode : Normal Router 
wlan_vap_create : enter. devhandle=0x80c402c0, opmode=IEEE80211_M_HOSTAP, flags=0x1
wlan_vap_create : exit. devhandle=0x80c402c0, opmode=IEEE80211_M_HOSTAP, flags=0x1.
VAP device ath0 created 
====&gt;&gt;&gt;&gt;wlan: rand channel 2
 
 
 DES SSID SET=YPKI-JATIM 
 ieee80211_ioctl_siwmode: imr.ifm_active=131712, new mode=3, valid=1 
 Free buffer count 256 

sc_txq[0] : 
sc_txq[0] : depth  is 0 
 aggr_depth is 0 tidBufCount 0  bufQCount 0 axq_cnt 0
  
sc_txq[1] : 
sc_txq[1] : depth  is 0 
 aggr_depth is 0 tidBufCount 0  bufQCount 0 axq_cnt 0
  
sc_txq[2] : 
sc_txq[2] : depth  is 0 
 aggr_depth is 0 tidBufCount 0  bufQCount 0 axq_cnt 0
  
sc_txq[3] : 
sc_txq[3] : depth  is 0 
 aggr_depth is 0 tidBufCount 0  bufQCount 0 axq_cnt 0
  
sc_txq[6] : 
sc_txq[6] : depth  is 0 
 aggr_depth is 0 tidBufCount 0  bufQCount 0 axq_cnt 0
  
sc_txq[7] : 
sc_txq[7] : depth  is 0 
 aggr_depth is 0 tidBufCount 0  bufQCount 0 axq_cnt 0
  
sc_txq[8] : 
sc_txq[8] : depth  is 0 
 aggr_depth is 0 tidBufCount 0  bufQCount 0 axq_cnt 0
  

 *********************************** 
athr_gmac_ring_free Freeing at 0x81e80800
athr_gmac_ring_free Freeing at 0x81ebc000
br0: port 1(eth0) entering disabled state
athr_gmac_ring_alloc Allocated 640 at 0x81e80800
athr_gmac_ring_alloc Allocated 2048 at 0x81f07800
WASP ----&gt; S27 PHY MDIO
Setting Drop CRC Errors, Pause Frames and Length Error frames 
Setting PHY...
 Free buffer count 256 

sc_txq[0] : 
sc_txq[0] : depth  is 0 
 aggr_depth is 0 tidBufCount 0  bufQCount 0 axq_cnt 0
  
sc_txq[1] : 
sc_txq[1] : depth  is 0 
 aggr_depth is 0 tidBufCount 0  bufQCount 0 axq_cnt 0
  
sc_txq[2] : 
sc_txq[2] : depth  is 0 
 aggr_depth is 0 tidBufCount 0  bufQCount 0 axq_cnt 0
  
sc_txq[3] : 
sc_txq[3] : depth  is 0 
 aggr_depth is 0 tidBufCount 0  bufQCount 0 axq_cnt 0
  
sc_txq[6] : 
sc_txq[6] : depth  is 0 
 aggr_depth is 0 tidBufCount 0  bufQCount 0 axq_cnt 0
  
sc_txq[7] : 
sc_txq[7] : depth  is 0 
 aggr_depth is 0 tidBufCount 0  bufQCount 0 axq_cnt 0
  
sc_txq[8] : 
sc_txq[8] : depth  is 0 
 aggr_depth is 0 tidBufCount 0  bufQCount 0 axq_cnt 0
  

 *********************************** 
device ath0 entered promiscuous mode
br0: port 2(ath0) entering forwarding state
 ieee80211_ioctl_siwmode: imr.ifm_active=918144, new mode=3, valid=1 
br0: port 2(ath0) entering disabled state
 
 DES SSID SET=YPKI-JATIM 
 Free buffer count 256 

sc_txq[0] : 
sc_txq[0] : depth  is 0 
 aggr_depth is 0 tidBufCount 0  bufQCount 0 axq_cnt 0
  
sc_txq[1] : 
sc_txq[1] : depth  is 0 
 aggr_depth is 0 tidBufCount 0  bufQCount 0 axq_cnt 0
  
sc_txq[2] : 
sc_txq[2] : depth  is 0 
 aggr_depth is 0 tidBufCount 0  bufQCount 0 axq_cnt 0
  
sc_txq[3] : 
sc_txq[3] : depth  is 0 
 aggr_depth is 0 tidBufCount 0  bufQCount 0 axq_cnt 0
  
sc_txq[6] : 
sc_txq[6] : depth  is 0 
 aggr_depth is 0 tidBufCount 0  bufQCount 0 axq_cnt 0
  
sc_txq[7] : 
sc_txq[7] : depth  is 0 
 aggr_depth is 0 tidBufCount 0  bufQCount 0 axq_cnt 0
  
sc_txq[8] : 
sc_txq[8] : depth  is 0 
 aggr_depth is 0 tidBufCount 0  bufQCount 0 axq_cnt 0
  

 *********************************** 
br0: port 2(ath0) entering forwarding state
====&gt;&gt;&gt;&gt;cmdCtrl open success 
====&gt;&gt;&gt;&gt;eventCtrl open success 
====&gt;&gt;&gt;&gt;eventCtrl attach success 
ATHR_GMAC: GE0 RX DMA ENABLE

 TL-MR3420 mips #61 Tue Jul 3 15:17:14 CST 2012 (none)

TL-MR3420 login: </code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p187527">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">xopal</div>
					<div class="post-datetime">
						1 Jan 2013, 07:38					</div>
				</div>
				<div class="post-content content">
					<p>There must be a problem with my build , I set ap121 type reference board and it shows ap123 on boot log, am I correct ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p187577">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">xopal</div>
					<div class="post-datetime">
						1 Jan 2013, 19:42					</div>
				</div>
				<div class="post-content content">
					<p>After build my test firmware for 3420v2 flashed it to router, it becomes brick.</p><p>Here&#039;s my boot log</p><div class="codebox"><pre><code>U-Boot 1.1.4 (Jul  3 2012 - 15:12:08)

U-boot AP123


DRAM:  32 MB
id read 0x100000ff
Flash:  4 MB
Using default environment

In:    serial
Out:   serial
Err:   serial
Net:   ag934x_enet_initialize...
wasp reset mask:c03300
WASP ----&gt; S27 PHY
GMAC: cfg1 0x5 cfg2 0x7114
eth0: ba:be:fa:ce:08:41
s27 reg init 
athrs27_phy_setup ATHR_PHY_CONTROL 4: 0x1000
athrs27_phy_setup ATHR_PHY_SPEC_STAUS 4: 0x10
eth0 up
WASP ----&gt; S27 PHY
GMAC: cfg1 0xf cfg2 0x7214
eth1: ba:be:fa:ce:08:41
s27 reg init lan 
ATHRS27: resetting s27
ATHRS27: s27 reset done
athrs27_phy_setup ATHR_PHY_CONTROL 0: 0x1000
athrs27_phy_setup ATHR_PHY_SPEC_STAUS 0: 0x10
athrs27_phy_setup ATHR_PHY_CONTROL 1: 0x1000
athrs27_phy_setup ATHR_PHY_SPEC_STAUS 1: 0x10
athrs27_phy_setup ATHR_PHY_CONTROL 2: 0x1000
athrs27_phy_setup ATHR_PHY_SPEC_STAUS 2: 0x10
athrs27_phy_setup ATHR_PHY_CONTROL 3: 0x1000
athrs27_phy_setup ATHR_PHY_SPEC_STAUS 3: 0x10
eth1 up
eth0, eth1
Autobooting in 1 seconds
## Booting image at 9f020000 ...
   Uncompressing Kernel Image ... OK

Starting kernel ...

[    0.000000] Linux version 3.6.11 (xopal@debian) (gcc version 4.6.4 20121106 (prerelease) (Linaro GCC 4.6-2012.11) ) #1 Wed Jan 2 00:12:05 WIT 2013
[    0.000000] bootconsole [early0] enabled
[    0.000000] CPU revision is: 0001974c (MIPS 74Kc)
[    0.000000] SoC: Atheros AR9341 rev 1
[    0.000000] Clocks: CPU:535.000MHz, DDR:400.000MHz, AHB:200.000MHz, Ref:25.000MHz
[    0.000000] Determined physical RAM map:
[    0.000000]  memory: 02000000 @ 00000000 (usable)
[    0.000000] Initrd not found or empty - disabling initrd
[    0.000000] Zone ranges:
[    0.000000]   Normal   [mem 0x00000000-0x01ffffff]
[    0.000000] Movable zone start for each node
[    0.000000] Early memory node ranges
[    0.000000]   node   0: [mem 0x00000000-0x01ffffff]
[    0.000000] Primary instruction cache 64kB, VIPT, 4-way, linesize 32 bytes.
[    0.000000] Primary data cache 32kB, 4-way, VIPT, cache aliases, linesize 32 bytes
[    0.000000] Built 1 zonelists in Zone order, mobility grouping on.  Total pages: 8128
[    0.000000] Kernel command line:  board=TL-MR3420-v2 console=ttyATH0,115200 rootfstype=squashfs,jffs2 noinitrd
[    0.000000] MIPS: no machine found for id &#039;TL-MR3420-v2&#039;, supported machines:
[    0.000000] id                       name
[    0.000000] Generic                  Generic AR71XX/AR724X/AR913X based board
[    0.000000] ALFA-AP96                ALFA Network AP96
[    0.000000] ALFA-NX                  ALFA Network N2/N5
[    0.000000] ALL0258N                 Allnet ALL0258N
[    0.000000] ALL0315N                 Allnet ALL0315N
[    0.000000] AP113                    Atheros AP113
[    0.000000] AP121-MINI               Atheros AP121-MINI
[    0.000000] AP121                    Atheros AP121 reference board
[    0.000000] AP135-020                Atheros AP135-020 reference board
[    0.000000] AP136-020                Atheros AP136-020 reference board
[    0.000000] AP136-010                Atheros AP136-010 reference board
[    0.000000] AP81                     Atheros AP81 reference board
[    0.000000] AP83                     Atheros AP83
[    0.000000] AP96                     Atheros AP96
[    0.000000] AW-NR580                 AzureWave AW-NR580
[    0.000000] CAP4200AG                Senao CAP4200AG
[    0.000000] DB120                    Atheros DB120 reference board
[    0.000000] DIR-615-E4               D-Link DIR-615 rev. E4
[    0.000000] DIR-600-A1               D-Link DIR-600 rev. A1
[    0.000000] DIR-615-C1               D-Link DIR-615 rev. C1
[    0.000000] DIR-825-B1               D-Link DIR-825 rev. B1
[    0.000000] EW-DORIN-ROUTER          EmbWir-Dorin-Router
[    0.000000] EW-DORIN                 EmbWir-Dorin
[    0.000000] ALL0305                  Allnet ALL0305
[    0.000000] EAP7660D                 Senao EAP7660D
[    0.000000] JA76PF2                  jjPlus JA76PF2
[    0.000000] JA76PF                   jjPlus JA76PF
[    0.000000] JWAP003                  jjPlus JWAP003
[    0.000000] HORNET-UB                ALFA NETWORKS Hornet-UB
[    0.000000] MR600                    OpenMesh MR600
[    0.000000] MZK-W04NU                Planex MZK-W04NU
[    0.000000] MZK-W300NH               Planex MZK-W300NH
[    0.000000] NBG460N                  Zyxel NBG460N/550N/550NH
[    0.000000] OM2P-HS                  OpenMesh OM2P HS
[    0.000000] OM2P-LC                  OpenMesh OM2P LC
[    0.000000] OM2P                     OpenMesh OM2P
[    0.000000] PB42                     Atheros PB42
[    0.000000] PB44                     Atheros PB44 reference board
[    0.000000] PB92                     Atheros PB92
[    0.000000] 493G                     MikroTik RouterBOARD 493G
[    0.000000] 493                      MikroTik RouterBOARD 493/AH
[    0.000000] 450G                     MikroTik RouterBOARD 450G
[    0.000000] 450                      MikroTik RouterBOARD 450
[    0.000000] 435G                     MikroTik RouterBOARD 435G
[    0.000000] 433U                     MikroTik RouterBOARD 433UAH
[    0.000000] 433                      MikroTik RouterBOARD 433/AH
[    0.000000] 411U                     MikroTik RouterBOARD 411U
[    0.000000] 411                      MikroTik RouterBOARD 411/A/AH
[    0.000000] 751g                     MikroTik RouterBOARD 751G
[    0.000000] 751                      MikroTik RouterBOARD 751
[    0.000000] 750Gr3                   MikroTik RouterBOARD 750GL
[    0.000000] 750i                     MikroTik RouterBOARD 750
[    0.000000] 2011G                    MikroTik RouterBOARD 2011UAS-2HnD
[    0.000000] 2011L                    MikroTik RouterBOARD 2011L
[    0.000000] RW2458N                  Redwave RW2458N
[    0.000000] TEW-632BRP               TRENDnet TEW-632BRP
[    0.000000] TEW-673GRU               TRENDnet TEW-673GRU
[    0.000000] TEW-712BR                TRENDnet TEW-712BR
[    0.000000] TL-MR3040                TP-LINK TL-MR3040
[    0.000000] TL-MR11U                 TP-LINK TL-MR11U
[    0.000000] TL-MR3020                TP-LINK TL-MR3020
[    0.000000] TL-WR841N-v7             TP-LINK TL-WR841N/ND v7
[    0.000000] TL-M     Buffalo WZR-HP-AG300H
[    0.000000] WZR-HP-G450H             Buffalo WZR-HP-G450H
[    0.000000] ZCN-1523H-5              Zcomax ZCN-1523H-5
[    0.000000] ZCN-1523H-2              Zcomax ZCN-1523H-2
[    0.000000] PID hash table entries: 128 (order: -3, 512 bytes)
[    0.000000] Dentry cache hash table entries: 4096 (order: 2, 16384 bytes)
[    0.000000] Inode-cache hash table entries: 2048 (order: 1, 8192 bytes)
[    0.000000] __ex_table already sorted, skipping sort
[    0.000000] Writing ErrCtl register=00000000
[    0.000000] Readback ErrCtl register=00000000
[    0.000000] Memory: 29132k/32768k available (2105k kernel code, 3636k reserved, 396k data, 212k init, 0k highmem)
[    0.000000] SLUB: Genslabs=9, HWalign=32, Order=0-3, MinObjects=0, CPUs=1, Nodes=1
[    0.000000] NR_IRQS:51
[    0.000000] Calibrating delay loop... 266.64 BogoMIPS (lpj=1333248)
[    0.080000] pid_max: default: 32768 minimum: 301
[    0.080000] Mount-cache hash table entries: 512
[    0.090000] NET: Registered protocol family 16
[    0.090000] MIPS: machine is Generic AR71XX/AR724X/AR913X based board
[    0.100000] bio: create slab &lt;bio-0&gt; at 0
[    0.110000] Switching to clocksource MIPS
[    0.120000] NET: Registered protocol family 2
[    0.120000] TCP established hash table entries: 1024 (order: 1, 8192 bytes)
[    0.120000] TCP bind hash table entries: 1024 (order: 0, 4096 bytes)
[    0.130000] TCP: Hash tables configured (established 1024 bind 1024)
[    0.130000] TCP: reno registered
[    0.140000] UDP hash table entries: 256 (order: 0, 4096 bytes)
[    0.140000] UDP-Lite hash table entries: 256 (order: 0, 4096 bytes)
[    0.150000] NET: Registered protocol family 1
[    0.170000] squashfs: version 4.0 (2009/01/31) Phillip Lougher
[    0.170000] jffs2: version 2.2 (NAND) (SUMMARY) (LZMA) (RTIME) (CMODE_PRIORITY) (c) 2001-2006 Red Hat, Inc.
[    0.180000] msgmni has been set to 56
[    0.190000] io scheduler noop registered
[    0.190000] io scheduler deadline registered (default)
[    0.200000] Serial: 8250/16550 driver, 1 ports, IRQ sharing disabled
[    0.220000] serial8250.0: ttyS0 at MMIO 0x18020000 (irq = 11) is a 16550A
[    0.240000] TCP: cubic registered
[    0.240000] NET: Registered protocol family 17
[    0.250000] 8021q: 802.1Q VLAN Support v1.8
[    0.250000] turn off boot </code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p187580">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">nebbia88</div>
					<div class="post-datetime">
						1 Jan 2013, 20:04					</div>
				</div>
				<div class="post-content content">
					<p>Seems that the kernel does not know the board.. Did you edit the same files like in this patch?</p><p> <a href="https://dev.openwrt.org/changeset/34780">https://dev.openwrt.org/changeset/34780</a></p><br /><p>also always make clean..</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p187597">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">xopal</div>
					<div class="post-datetime">
						1 Jan 2013, 22:25					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>nebbia88 wrote:</cite><blockquote><p>Seems that the kernel does not know the board.. Did you edit the same files like in this patch?</p><p> <a href="https://dev.openwrt.org/changeset/34780">https://dev.openwrt.org/changeset/34780</a></p><br /><p>also always make clean..</p></blockquote></div><p>Yeah you&#039;re right , I&#039;ll try another shot btw debricking this router is a piece of cake but I would like to inform you guys do not trying TFTP into this router a stock firmware which have the words &quot;boot&quot; or you&#039;ll be sorry.</p><p>Default uboot env. is set as follows:</p><p>Router ip : 192.168.1.111<br />TFTP host ip : 192.168.100</p><p>This is my TFTP process boot log :</p><p>Yes I did erase process but I forgot to set putty log on save mode <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /></p><div class="codebox"><pre><code>=~=~=~=~=~=~=~=~=~=~=~= PuTTY log 2013.01.02 01:07:04 =~=~=~=~=~=~=~=~=~=~=~=
T T T T T 
Retry count exceeded; starting again
eth0 link down
Using eth1 device
TFTP from server 192.168.1.100; our IP address is 192.168.1.111
Filename &#039;code.bin&#039;.
Load address: 0x81000000
Loading: *T T T T T T 
Abort
wasp&gt; tftpboot 0x81000000 code.bin

Using eth1 device
TFTP from server 192.168.1.100; our IP address is 192.168.1.111
Filename &#039;code.bin&#039;.
Load address: 0x81000000
Loading: *#################################################################
     #################################################################
     #################################################################
     #################################################################
     #################################################################
     #################################################################
     #################################################################
     #################################################################
     #################################################################
     #################################################################
     #################################################################
     ######################################################
done
Bytes transferred = 3932160 (3c0000 hex)
wasp&gt; cp.b 0x81000000 0x9f020000 0x3c0000

Copy to Flash... write addr: 9f020000
done
wasp&gt; bootm 0x9f020000

## Booting image at 9f020000 ...
   Uncompressing Kernel Image ... OK

Starting kernel ...</code></pre></div>											<p class="post-edited">(Last edited by <strong>xopal</strong> on 2 Jan 2013, 00:26)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p187605">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">nebbia88</div>
					<div class="post-datetime">
						1 Jan 2013, 23:08					</div>
				</div>
				<div class="post-content content">
					<p>did you notice the NEW FILE in this changeset?<br />i did not see it at first look..</p><p><a href="https://dev.openwrt.org/changeset/34779">https://dev.openwrt.org/changeset/34779</a></p><p><a href="https://dev.openwrt.org/browser/trunk/target/linux/ar71xx/patches-3.6/617-MIPS-ath79-TL-MR3220-v2-support.patch?rev=34779">https://dev.openwrt.org/browser/trunk/t … ?rev=34779</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p187606">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">xopal</div>
					<div class="post-datetime">
						2 Jan 2013, 00:18					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>nebbia88 wrote:</cite><blockquote><p>did you notice the NEW FILE in this changeset?<br />i did not see it at first look..</p><p><a href="https://dev.openwrt.org/changeset/34779">https://dev.openwrt.org/changeset/34779</a></p><p><a href="https://dev.openwrt.org/browser/trunk/target/linux/ar71xx/patches-3.6/617-MIPS-ath79-TL-MR3220-v2-support.patch?rev=34779">https://dev.openwrt.org/browser/trunk/t … ?rev=34779</a></p></blockquote></div><p>No I don&#039;t , thanks for your information.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p187623">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">xopal</div>
					<div class="post-datetime">
						2 Jan 2013, 07:59					</div>
				</div>
				<div class="post-content content">
					<p>Finally I can port openwrt but something weird with my serial console, it&#039;s was stop after&nbsp; <strong>&quot;[&nbsp; &nbsp; 2.940000] turn off boot console early0&quot;</strong> msg and just sit there.</p><div class="codebox"><pre><code>=~=~=~=~=~=~=~=~=~=~=~= PuTTY log 2013.01.02 12:41:15 =~=~=~=~=~=~=~=~=~=~=~=


U-Boot 1.1.4 (Jul  3 2012 - 15:12:08)

U-boot AP123


DRAM:  32 MB
id read 0x100000ff
Flash:  4 MB
Using default environment

In:    serial
Out:   serial
Err:   serial
Net:   ag934x_enet_initialize...
wasp reset mask:c03300
WASP ----&gt; S27 PHY
GMAC: cfg1 0x5 cfg2 0x7114
eth0: ba:be:fa:ce:08:41
s27 reg init 
athrs27_phy_setup ATHR_PHY_CONTROL 4: 0x1000
athrs27_phy_setup ATHR_PHY_SPEC_STAUS 4: 0x10
eth0 up
WASP ----&gt; S27 PHY
GMAC: cfg1 0xf cfg2 0x7214
eth1: ba:be:fa:ce:08:41
s27 reg init lan 
ATHRS27: resetting s27
ATHRS27: s27 reset done
athrs27_phy_setup ATHR_PHY_CONTROL 0: 0x1000
athrs27_phy_setup ATHR_PHY_SPEC_STAUS 0: 0x10
athrs27_phy_setup ATHR_PHY_CONTROL 1: 0x1000
athrs27_phy_setup ATHR_PHY_SPEC_STAUS 1: 0x10
athrs27_phy_setup ATHR_PHY_CONTROL 2: 0x1000
athrs27_phy_setup ATHR_PHY_SPEC_STAUS 2: 0x10
athrs27_phy_setup ATHR_PHY_CONTROL 3: 0x1000
athrs27_phy_setup ATHR_PHY_SPEC_STAUS 3: 0x10
eth1 up
eth0, eth1
Autobooting in 1 seconds
## Booting image at 9f020000 ...
   Uncompressing Kernel Image ... OK

Starting kernel ...

[    0.000000] Linux version 3.6.11 (xopal@debian) (gcc version 4.6.4 20121106 (prerelease) (Linaro GCC 4.6-2012.11) ) #1 Wed Jan 2 12:06:38 WIT 2013
[    0.000000] bootconsole [early0] enabled
[    0.000000] CPU revision is: 0001974c (MIPS 74Kc)
[    0.000000] SoC: Atheros AR9341 rev 1
[    0.000000] Clocks: CPU:535.000MHz, DDR:400.000MHz, AHB:200.000MHz, Ref:25.000MHz
[    0.000000] Determined physical RAM map:
[    0.000000]  memory: 02000000 @ 00000000 (usable)
[    0.000000] Initrd not found or empty - disabling initrd
[    0.000000] Zone ranges:
[    0.000000]   Normal   [mem 0x00000000-0x01ffffff]
[    0.000000] Movable zone start for each node
[    0.000000] Early memory node ranges
[    0.000000]   node   0: [mem 0x00000000-0x01ffffff]
[    0.000000] Primary instruction cache 64kB, VIPT, 4-way, linesize 32 bytes.
[    0.000000] Primary data cache 32kB, 4-way, VIPT, cache aliases, linesize 32 bytes
[    0.000000] Built 1 zonelists in Zone order, mobility grouping on.  Total pages: 8128
[    0.000000] Kernel command line:  board=TL-WR841N-v8 console=ttyATH0,115200 rootfstype=squashfs,jffs2 noinitrd
[    0.000000] PID hash table entries: 128 (order: -3, 512 bytes)
[    0.000000] Dentry cache hash table entries: 4096 (order: 2, 16384 bytes)
[    0.000000] Inode-cache hash table entries: 2048 (order: 1, 8192 bytes)
[    0.000000] __ex_table already sorted, skipping sort
[    0.000000] Writing ErrCtl register=00000000
[    0.000000] Readback ErrCtl register=00000000
[    0.000000] Memory: 29132k/32768k available (2105k kernel code, 3636k reserved, 396k data, 212k init, 0k highmem)
[    0.000000] SLUB: Genslabs=9, HWalign=32, Order=0-3, MinObjects=0, CPUs=1, Nodes=1
[    0.000000] NR_IRQS:51
[    0.000000] Calibrating delay loop... 266.64 BogoMIPS (lpj=1333248)
[    0.080000] pid_max: default: 32768 minimum: 301
[    0.080000] Mount-cache hash table entries: 512
[    0.090000] NET: Registered protocol family 16
[    0.090000] MIPS: machine is TP-LINK TL-WR841N/ND v8
[    0.510000] bio: create slab &lt;bio-0&gt; at 0
[    0.520000] Switching to clocksource MIPS
[    0.520000] NET: Registered protocol family 2
[    0.530000] TCP established hash table entries: 1024 (order: 1, 8192 bytes)
[    0.530000] TCP bind hash table entries: 1024 (order: 0, 4096 bytes)
[    0.540000] TCP: Hash tables configured (established 1024 bind 1024)
[    0.540000] TCP: reno registered
[    0.550000] UDP hash table entries: 256 (order: 0, 4096 bytes)
[    0.550000] UDP-Lite hash table entries: 256 (order: 0, 4096 bytes)
[    0.560000] NET: Registered protocol family 1
[    0.580000] squashfs: version 4.0 (2009/01/31) Phillip Lougher
[    0.580000] jffs2: version 2.2 (NAND) (SUMMARY) (LZMA) (RTIME) (CMODE_PRIORITY) (c) 2001-2006 Red Hat, Inc.
[    0.590000] msgmni has been set to 56
[    0.600000] io scheduler noop registered
[    0.600000] io scheduler deadline registered (default)
[    0.610000] Serial: 8250/16550 driver, 1 ports, IRQ sharing disabled
‚r²š‚‚‚‚êserial8250.0: ttyS0 at MMIO 0x18020000 (irq = 11) is a 16550A
[    0.640000] ath79-spi ath79-spi: master is unqueued, this is deprecated
[    0.650000] m25p80 spi0.0: found s25sl032a, expected m25p80
[    0.660000] m25p80 spi0.0: s25sl032a (4096 Kbytes)
[    0.660000] 5 tp-link partitions found on MTD device spi0.0
[    0.670000] Creating 5 MTD partitions on &quot;spi0.0&quot;:
[    0.670000] 0x000000000000-0x000000020000 : &quot;u-boot&quot;
[    0.680000] 0x000000020000-0x0000000fbc8c : &quot;kernel&quot;
[    0.680000] mtd: partition &quot;kernel&quot; must either start or end on erase block boundary or be smaller than an erase block -- forcing read-only
[    0.700000] 0x0000000fbc8c-0x0000003f0000 : &quot;rootfs&quot;
[    0.700000] mtd: partition &quot;rootfs&quot; must either start or end on erase block boundary or be smaller than an erase block -- forcing read-only
[    0.710000] mtd: partition &quot;rootfs&quot; set to be root filesystem
[    0.720000] mtd: partition &quot;rootfs_data&quot; created automatically, ofs=270000, len=180000 
[    0.730000] 0x000000270000-0x0000003f0000 : &quot;rootfs_data&quot;
[    0.730000] 0x0000003f0000-0x000000400000 : &quot;art&quot;
[    0.740000] 0x000000020000-0x0000003f0000 : &quot;firmware&quot;
[    0.770000] libphy: ag71xx_mdio: probed
[    0.770000] eth0: Atheros AG71xx at 0xb9000000, irq 4, mode:MII
[    1.330000] ag71xx ag71xx.0: eth0: connected to PHY at ag71xx-mdio.1:00 [uid=004dd042, driver=Generic PHY]
[    1.340000] eth1: Atheros AG71xx at 0xba000000, irq 5, mode:GMII
[    1.900000] eth1: Found an AR934X built-in switch
[    2.930000] TCP: cubic registered
[    2.930000] NET: Registered protocol family 17
[    2.930000] 8021q: 802.1Q VLAN Support v1.8
[    2.940000] turn off boot console early0</code></pre></div><p>But&nbsp; telnet works here&#039;s the log :</p><br /><div class="codebox"><pre><code>=~=~=~=~=~=~=~=~=~=~=~= PuTTY log 2013.01.02 12:43:54 =~=~=~=~=~=~=~=~=~=~=~=
 === IMPORTANT ============================
  Use &#039;passwd&#039; to set your login password
  this will disable telnet and enable SSH
 ------------------------------------------


BusyBox v1.19.4 (2013-01-02 11:40:30 WIT) built-in shell (ash)
Enter &#039;help&#039; for a list of built-in commands.

  _______                     ________        __
 |       |.-----.-----.-----.|  |  |  |.----.|  |_
 |   -   ||  _  |  -__|     ||  |  |  ||   _||   _|
 |_______||   __|_____|__|__||________||__|  |____|
          |__| W I R E L E S S   F R E E D O M
 -----------------------------------------------------
 BARRIER BREAKER (Bleeding Edge, r34958)
 -----------------------------------------------------
  * 1/2 oz Galliano         Pour all ingredients into
  * 4 oz cold Coffee        an irish coffee mug filled
  * 1 1/2 oz Dark Rum       with crushed ice. Stir.
  * 2 tsp. Creme de Cacao
 -----------------------------------------------------
root@OpenWrt:/# 
root@OpenWrt:/# [Jcat /proc/cpuinfo
system type             : Atheros AR9341 rev 1
machine                 : TP-LINK TL-WR841N/ND v8
processor               : 0
cpu model               : MIPS 74Kc V4.12
BogoMIPS                : 266.64
wait instruction        : yes
microsecond timers      : yes
tlb_entries             : 32
extra interrupt vector  : yes
hardware watchpoint     : yes, count: 4, address/irw mask: [0x0000, 0x0ff8, 0x0ff8, 0x0ff8]
ASEs implemented        : mips16 dsp
shadow register sets    : 1
kscratch registers      : 0
core                    : 0
VCED exceptions         : not available
VCEI exceptions         : not available

root@OpenWrt:/# df -h
Filesystem                Size      Used Available Use% Mounted on
rootfs                    1.5M    208.0K      1.3M  14% /
/dev/root                 1.5M      1.5M         0 100% /rom
tmpfs                    14.3M     64.0K     14.3M   0% /tmp
tmpfs                   512.0K         0    512.0K   0% /dev
/dev/mtdblock3            1.5M    208.0K      1.3M  14% /overlay
overlayfs:/overlay        1.5M    208.0K      1.3M  14% /
root@OpenWrt:/# ifconfig
br-lan    Link encap:Ethernet  HWaddr 64:70:02:6B:FB:1C  
          inet addr:192.168.1.1  Bcast:192.168.1.255  Mask:255.255.255.0
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:446 errors:0 dropped:0 overruns:0 frame:0
          TX packets:193 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:36627 (35.7 KiB)  TX bytes:18610 (18.1 KiB)

eth0      Link encap:Ethernet  HWaddr 64:70:02:6B:FB:1B  
          UP BROADCAST MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)
          Interrupt:4 

eth1      Link encap:Ethernet  HWaddr 64:70:02:6B:FB:1C  
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:446 errors:0 dropped:0 overruns:0 frame:0
          TX packets:193 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:42871 (41.8 KiB)  TX bytes:18610 (18.1 KiB)
          Interrupt:5 

lo        Link encap:Local Loopback  
          inet addr:127.0.0.1  Mask:255.0.0.0
          UP LOOPBACK RUNNING  MTU:16436  Metric:1
          RX packets:1248 errors:0 dropped:0 overruns:0 frame:0
          TX packets:1248 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:84864 (82.8 KiB)  TX bytes:84864 (82.8 KiB)

root@OpenWrt:/# logread
Jan  1 00:00:11 OpenWrt syslog.info syslogd started: BusyBox v1.19.4
Jan  1 00:00:11 OpenWrt kern.notice kernel: klogd started: BusyBox v1.19.4 (2013-01-02 11:40:30 WIT)
Jan  1 00:00:11 OpenWrt kern.notice kernel: [    0.000000] Linux version 3.6.11 (xopal@debian) (gcc version 4.6.4 20121106 (prerelease) (Linaro GCC 4.6-2012.11) ) #1 Wed Jan 2 12:06:38 WIT 2013
Jan  1 00:00:11 OpenWrt kern.debug kernel: [    0.000000] MyLoader: sysp=7e32261f, boardp=2eeaf96f, parts=7e16f0c5
Jan  1 00:00:11 OpenWrt kern.info kernel: [    0.000000] bootconsole [early0] enabled
Jan  1 00:00:11 OpenWrt kern.info kernel: [    0.000000] CPU revision is: 0001974c (MIPS 74Kc)
Jan  1 00:00:11 OpenWrt kern.info kernel: [    0.000000] SoC: Atheros AR9341 rev 1
Jan  1 00:00:11 OpenWrt kern.info kernel: [    0.000000] Clocks: CPU:535.000MHz, DDR:400.000MHz, AHB:200.000MHz, Ref:25.000MHz
Jan  1 00:00:11 OpenWrt kern.info kernel: [    0.000000] Determined physical RAM map:
Jan  1 00:00:11 OpenWrt kern.info kernel: [    0.000000]  memory: 02000000 @ 00000000 (usable)
Jan  1 00:00:11 OpenWrt kern.info kernel: [    0.000000] Initrd not found or empty - disabling initrd
Jan  1 00:00:11 OpenWrt kern.warn kernel: [    0.000000] Zone ranges:
Jan  1 00:00:11 OpenWrt kern.warn kernel: [    0.000000]   Normal   [mem 0x00000000-0x01ffffff]
Jan  1 00:00:11 OpenWrt kern.warn kernel: [    0.000000] Movable zone start for each node
Jan  1 00:00:11 OpenWrt kern.warn kernel: [    0.000000] Early memory node ranges
Jan  1 00:00:11 OpenWrt kern.warn kernel: [    0.000000]   node   0: [mem 0x00000000-0x01ffffff]
Jan  1 00:00:11 OpenWrt kern.debug kernel: [    0.000000] On node 0 totalpages: 8192
Jan  1 00:00:11 OpenWrt kern.debug kernel: [    0.000000] free_area_init_node: node 0, pgdat 802d1340, node_mem_map 81000000
Jan  1 00:00:11 OpenWrt kern.debug kernel: [    0.000000]   Normal zone: 64 pages used for memmap
Jan  1 00:00:11 OpenWrt kern.debug kernel: [    0.000000]   Normal zone: 0 pages reserved
Jan  1 00:00:11 OpenWrt kern.debug kernel: [    0.000000]   Normal zone: 8128 pages, LIFO batch:0
Jan  1 00:00:11 OpenWrt kern.warn kernel: [    0.000000] Primary instruction cache 64kB, VIPT, 4-way, linesize 32 bytes.
Jan  1 00:00:11 OpenWrt kern.warn kernel: [    0.000000] Primary data cache 32kB, 4-way, VIPT, cache aliases, linesize 32 bytes
Jan  1 00:00:11 OpenWrt kern.debug kernel: [    0.000000] pcpu-alloc: s0 r0 d32768 u32768 alloc=1*32768
Jan  1 00:00:11 OpenWrt kern.debug kernel: [    0.000000] pcpu-alloc: [0] 0 
Jan  1 00:00:11 OpenWrt kern.warn kernel: [    0.000000] Built 1 zonelists in Zone order, mobility grouping on.  Total pages: 8128
Jan  1 00:00:11 OpenWrt kern.notice kernel: [    0.000000] Kernel command line:  board=TL-WR841N-v8 console=ttyATH0,115200 rootfstype=squashfs,jffs2 noinitrd
Jan  1 00:00:11 OpenWrt kern.info kernel: [    0.000000] PID hash table entries: 128 (order: -3, 512 bytes)
Jan  1 00:00:11 OpenWrt kern.info kernel: [    0.000000] Dentry cache hash table entries: 4096 (order: 2, 16384 bytes)
Jan  1 00:00:11 OpenWrt kern.info kernel: [    0.000000] Inode-cache hash table entries: 2048 (order: 1, 8192 bytes)
Jan  1 00:00:11 OpenWrt kern.notice kernel: [    0.000000] __ex_table already sorted, skipping sort
Jan  1 00:00:11 OpenWrt kern.info kernel: [    0.000000] Writing ErrCtl register=00000000
Jan  1 00:00:11 OpenWrt kern.info kernel: [    0.000000] Readback ErrCtl register=00000000
Jan  1 00:00:11 OpenWrt kern.info kernel: [    0.000000] Memory: 29132k/32768k available (2105k kernel code, 3636k reserved, 396k data, 212k init, 0k highmem)
Jan  1 00:00:11 OpenWrt kern.info kernel: [    0.000000] SLUB: Genslabs=9, HWalign=32, Order=0-3, MinObjects=0, CPUs=1, Nodes=1
Jan  1 00:00:11 OpenWrt kern.info kernel: [    0.000000] NR_IRQS:51
Jan  1 00:00:11 OpenWrt kern.info kernel: [    0.070000] Calibrating delay loop... 266.64 BogoMIPS (lpj=1333248)
Jan  1 00:00:11 OpenWrt kern.info kernel: [    0.080000] pid_max: default: 32768 minimum: 301
Jan  1 00:00:11 OpenWrt kern.info kernel: [    0.080000] Mount-cache hash table entries: 512
Jan  1 00:00:11 OpenWrt kern.info kernel: [    0.090000] NET: Registered protocol family 16
Jan  1 00:00:11 OpenWrt kern.info kernel: [    0.090000] MIPS: machine is TP-LINK TL-WR841N/ND v8
Jan  1 00:00:11 OpenWrt kern.info kernel: [    0.510000] bio: create slab &lt;bio-0&gt; at 0
Jan  1 00:00:11 OpenWrt kern.info kernel: [    0.520000] Switching to clocksource MIPS
Jan  1 00:00:11 OpenWrt kern.info kernel: [    0.520000] NET: Registered protocol family 2
Jan  1 00:00:11 OpenWrt kern.info kernel: [    0.530000] TCP established hash table entries: 1024 (order: 1, 8192 bytes)
Jan  1 00:00:11 OpenWrt kern.info kernel: [    0.530000] TCP bind hash table entries: 1024 (order: 0, 4096 bytes)
Jan  1 00:00:11 OpenWrt kern.info kernel: [    9.100000] Backport based on wireless-testing.git master-2012-12-06
Jan  1 00:00:11 OpenWrt kern.info kernel: [    9.100000] compat.git: wireless-testing.git
Jan  1 00:00:11 OpenWrt kern.info kernel: [    9.120000] cfg80211: Calling CRDA to update world regulatory domain
Jan  1 00:00:11 OpenWrt kern.info kernel: [    9.120000] cfg80211: World regulatory domain updated:
Jan  1 00:00:11 OpenWrt kern.info kernel: [    9.120000] cfg80211:   (start_freq - end_freq @ bandwidth), (max_antenna_gain, max_eirp)
Jan  1 00:00:11 OpenWrt kern.info kernel: [    9.120000] cfg80211:   (2402000 KHz - 2472000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)
Jan  1 00:00:11 OpenWrt kern.info kernel: [    9.120000] cfg80211:   (2457000 KHz - 2482000 KHz @ 20000 KHz), (300 mBi, 2000 mBm)
Jan  1 00:00:11 OpenWrt kern.info kernel: [    9.120000] cfg80211:   (2474000 KHz - 2494000 KHz @ 20000 KHz), (300 mBi, 2000 mBm)
Jan  1 00:00:11 OpenWrt kern.info kernel: [    9.120000] cfg80211:   (5170000 KHz - 5250000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)
Jan  1 00:00:11 OpenWrt kern.info kernel: [    9.120000] cfg80211:   (5735000 KHz - 5835000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)
Jan  1 00:00:11 OpenWrt kern.info kernel: [    9.320000] usbcore: registered new interface driver usbfs
Jan  1 00:00:11 OpenWrt kern.info kernel: [    9.320000] usbcore: registered new interface driver hub
Jan  1 00:00:11 OpenWrt kern.info kernel: [    9.330000] usbcore: registered new device driver usb
Jan  1 00:00:11 OpenWrt kern.debug kernel: [    9.810000] ath: EEPROM regdomain: 0x0
Jan  1 00:00:11 OpenWrt kern.debug kernel: [    9.810000] ath: EEPROM indicates default country code should be used
Jan  1 00:00:11 OpenWrt kern.debug kernel: [    9.810000] ath: doing EEPROM country-&gt;regdmn map search
Jan  1 00:00:11 OpenWrt kern.debug kernel: [    9.810000] ath: country maps to regdmn code: 0x3a
Jan  1 00:00:11 OpenWrt kern.debug kernel: [    9.810000] ath: Country alpha2 being used: US
Jan  1 00:00:11 OpenWrt kern.debug kernel: [    9.810000] ath: Regpair used: 0x3a
Jan  1 00:00:11 OpenWrt kern.debug kernel: [    9.810000] ieee80211 phy0: Selected rate control algorithm &#039;minstrel_ht&#039;
Jan  1 00:00:11 OpenWrt kern.debug kernel: [    9.810000] Registered led device: ath9k-phy0
Jan  1 00:00:11 OpenWrt kern.info kernel: [    9.810000] ieee80211 phy0: Atheros AR9340 Rev:0 mem=0xb8100000, irq=47
Jan  1 00:00:11 OpenWrt kern.info kernel: [    9.810000] cfg80211: Calling CRDA for country: US
Jan  1 00:00:11 OpenWrt kern.info kernel: [    9.810000] cfg80211: Regulatory domain changed to country: US
Jan  1 00:00:11 OpenWrt kern.info kernel: [    9.810000] cfg80211:   (start_freq - end_freq @ bandwidth), (max_antenna_gain, max_eirp)
Jan  1 00:00:11 OpenWrt kern.info kernel: [    9.810000] cfg80211:   (2402000 KHz - 2472000 KHz @ 40000 KHz), (300 mBi, 2700 mBm)
Jan  1 00:00:11 OpenWrt kern.info kernel: [    9.810000] cfg80211:   (5170000 KHz - 5250000 KHz @ 40000 KHz), (300 mBi, 1700 mBm)
Jan  1 00:00:11 OpenWrt kern.info kernel: [    9.810000] cfg80211:   (5250000 KHz - 5330000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)
Jan  1 00:00:11 OpenWrt kern.info kernel: [    9.810000] cfg80211:   (5490000 KHz - 5600000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)
Jan  1 00:00:11 OpenWrt kern.info kernel: [    9.810000] cfg80211:   (5650000 KHz - 5710000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)
Jan  1 00:00:11 OpenWrt kern.info kernel: [    9.810000] cfg80211:   (5735000 KHz - 5835000 KHz @ 40000 KHz), (300 mBi, 3000 mBm)
Jan  1 00:00:11 OpenWrt kern.info kernel: [    9.860000] PPP generic driver version 2.4.2
Jan  1 00:00:11 OpenWrt kern.info kernel: [    9.910000] ip_tables: (C) 2000-2006 Netfilter Core Team
Jan  1 00:00:11 OpenWrt kern.info kernel: [   10.000000] NET: Registered protocol family 24
Jan  1 00:00:11 OpenWrt kern.info kernel: [   10.020000] ehci_hcd: USB 2.0 &#039;Enhanced&#039; Host Controller (EHCI) Driver
Jan  1 00:00:11 OpenWrt kern.info kernel: [   10.020000] ehci-platform ehci-platform: Generic Platform EHCI Controller
Jan  1 00:00:11 OpenWrt kern.info kernel: [   10.020000] ehci-platform ehci-platform: new USB bus registered, assigned bus number 1
Jan  1 00:00:11 OpenWrt kern.info kernel: [   10.050000] ehci-platform ehci-platform: irq 3, io mem 0x1b000000
Jan  1 00:00:11 OpenWrt kern.info kernel: [   10.070000] ehci-platform ehci-platform: USB 2.0 started, EHCI 1.00
Jan  1 00:00:11 OpenWrt kern.info kernel: [   10.070000] hub 1-0:1.0: USB hub found
Jan  1 00:00:11 OpenWrt kern.info kernel: [   10.070000] hub 1-0:1.0: 1 port detected
Jan  1 00:00:11 OpenWrt kern.info kernel: [   10.080000] nf_conntrack version 0.5.0 (458 buckets, 1832 max)
Jan  1 00:00:14 OpenWrt daemon.notice netifd: Interface &#039;lan&#039; is now up
Jan  1 00:00:14 OpenWrt daemon.notice netifd: Interface &#039;loopback&#039; is now up
Jan  1 00:00:14 OpenWrt kern.info kernel: [   14.400000] device eth1 entered promiscuous mode
Jan  1 00:00:14 OpenWrt daemon.notice netifd: wan (658): udhcpc (v1.19.4) started
Jan  1 00:00:14 OpenWrt daemon.notice netifd: wan (658): Sending discover...
Jan  1 00:00:14 OpenWrt user.info sysinit: &#039;radio0&#039; is disabled
Jan  1 00:00:15 OpenWrt kern.info kernel: [   15.000000] eth1: link up (1000Mbps/Full duplex)
Jan  1 00:00:15 OpenWrt kern.info kernel: [   15.000000] br-lan: port 1(eth1) entered forwarding state
Jan  1 00:00:15 OpenWrt kern.info kernel: [   15.000000] br-lan: port 1(eth1) entered forwarding state
Jan  1 00:00:15 OpenWrt user.info sysinit: &#039;radio0&#039; is disabled
Jan  1 00:00:15 OpenWrt user.info sysinit: &#039;radio0&#039; is disabled
Jan  1 00:00:17 OpenWrt kern.info kernel: [   17.000000] br-lan: port 1(eth1) entered forwarding state
Jan  1 00:00:17 OpenWrt user.info sysinit: Loading defaults
Jan  1 00:00:17 OpenWrt user.info sysinit: Loading synflood protection
Jan  1 00:00:17 OpenWrt user.info sysinit: Adding custom chains
Jan  1 00:00:17 OpenWrt user.info sysinit: Loading zones
Jan  1 00:00:17 OpenWrt daemon.notice netifd: wan (658): Sending discover...
Jan  1 00:00:18 OpenWrt user.info sysinit: Loading forwardings
Jan  1 00:00:18 OpenWrt user.info sysinit: Loading rules
Jan  1 00:00:18 OpenWrt user.info sysinit: Loading redirects
Jan  1 00:00:18 OpenWrt user.info sysinit: Loading includes
Jan  1 00:00:18 OpenWrt user.info sysinit: Optimizing conntrack
Jan  1 00:00:18 OpenWrt user.info sysinit: Loading interfaces
Jan  1 00:00:18 OpenWrt user.info firewall: adding lan (br-lan) to zone lan
Jan  1 00:00:19 OpenWrt authpriv.info dropbear[961]: Not backgrounding
Jan  1 00:00:20 OpenWrt user.notice dnsmasq: DNS rebinding protection is active, will discard upstream RFC1918 responses!
Jan  1 00:00:20 OpenWrt user.notice dnsmasq: Allowing 127.0.0.0/8 responses
Jan  1 00:00:20 OpenWrt daemon.notice netifd: wan (658): Sending discover...
Jan  1 00:00:23 OpenWrt daemon.info dnsmasq[1007]: started, version 2.62 cachesize 150
Jan  1 00:00:23 OpenWrt daemon.info dnsmasq[1007]: compile time options: IPv6 GNU-getopt no-DBus no-i18n no-IDN DHCP no-DHCPv6 no-Lua TFTP no-conntrack
Jan  1 00:00:23 OpenWrt daemon.info dnsmasq-dhcp[1007]: DHCP, IP range 192.168.1.100 -- 192.168.1.249, lease time 12h
Jan  1 00:00:23 OpenWrt daemon.info dnsmasq[1007]: using local addresses only for domain lan
Jan  1 00:00:23 OpenWrt daemon.warn dnsmasq[1007]: no servers found in /tmp/resolv.conf.auto, will retry
Jan  1 00:00:23 OpenWrt daemon.info dnsmasq[1007]: read /etc/hosts - 1 addresses
Jan  1 00:00:23 OpenWrt daemon.info dnsmasq-dhcp[1007]: read /etc/ethers - 0 addresses
Jan  1 00:00:23 OpenWrt user.info sysinit: setting up led WAN
Jan  1 00:00:23 OpenWrt user.info sysinit: setting up led LAN1
Jan  1 00:00:23 OpenWrt user.info sysinit: setting up led LAN2
Jan  1 00:00:23 OpenWrt user.info sysinit: setting up led LAN3
Jan  1 00:00:23 OpenWrt user.info sysinit: setting up led LAN4
Jan  1 00:00:23 OpenWrt user.info sysinit: setting up led WLAN
Jan  1 00:00:28 OpenWrt daemon.info dnsmasq-dhcp[1007]: DHCPREQUEST(br-lan) 192.168.1.206 00:e0:0c:77:4f:5a 
Jan  1 00:00:28 OpenWrt daemon.info dnsmasq-dhcp[1007]: DHCPACK(br-lan) 192.168.1.206 00:e0:0c:77:4f:5a Baofeng-PC
Jan  1 00:00:33 OpenWrt daemon.info dnsmasq-dhcp[1007]: DHCPINFORM(br-lan) 192.168.1.206 00:e0:0c:77:4f:5a 
Jan  1 00:00:33 OpenWrt daemon.info dnsmasq-dhcp[1007]: DHCPACK(br-lan) 192.168.1.206 00:e0:0c:77:4f:5a Baofeng-PC
root@OpenWrt:/# exit</code></pre></div>											<p class="post-edited">(Last edited by <strong>xopal</strong> on 2 Jan 2013, 08:44)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p187641">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">MBS</div>
					<div class="post-datetime">
						2 Jan 2013, 12:48					</div>
				</div>
				<div class="post-content content">
					<p>May it be, that the kernel expects a serial port called ttyATH0, but ttyS0 is created? I see the following in your logs:<br /></p><div class="quotebox"><cite>xopal wrote:</cite><blockquote><div class="codebox"><pre><code>[    0.000000] Kernel command line:  board=TL-WR841N-v8 console=ttyATH0,115200 rootfstype=squashfs,jffs2 noinitrd</code></pre></div></blockquote></div><div class="quotebox"><cite>xopal wrote:</cite><blockquote><div class="codebox"><pre><code>[    0.610000] Serial: 8250/16550 driver, 1 ports, IRQ sharing disabled
‚r²š‚‚‚‚êserial8250.0: ttyS0 at MMIO 0x18020000 (irq = 11) is a 16550A</code></pre></div></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p187721">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">xopal</div>
					<div class="post-datetime">
						3 Jan 2013, 06:57					</div>
				</div>
				<div class="post-content content">
					<p><strong>MBS</strong>&nbsp; thank you for your clue</p><div class="quotebox"><cite>MBS wrote:</cite><blockquote><p>May it be, that the kernel expects a serial port called ttyATH0, but ttyS0 is created? I see the following in your logs:<br /></p><div class="quotebox"><cite>xopal wrote:</cite><blockquote><div class="codebox"><pre><code>[    0.000000] Kernel command line:  board=TL-WR841N-v8 console=ttyATH0,115200 rootfstype=squashfs,jffs2 noinitrd</code></pre></div></blockquote></div><div class="quotebox"><cite>xopal wrote:</cite><blockquote><div class="codebox"><pre><code>[    0.610000] Serial: 8250/16550 driver, 1 ports, IRQ sharing disabled
‚r²š‚‚‚‚êserial8250.0: ttyS0 at MMIO 0x18020000 (irq = 11) is a 16550A</code></pre></div></blockquote></div></blockquote></div><br /><br /><div class="quotebox"><cite>xopal wrote:</cite><blockquote><div class="quotebox"><cite>cindy.wijaya wrote:</cite><blockquote><div class="codebox"><pre><code>+$(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLMR3420V2,tl-mr3420-v2,TL-WR841N-v8,ttyATH0,115200,0x34200002,1,4Mlzma))</code></pre></div><p>bagaimana kl diganti dg ini:</p><div class="codebox"><pre><code>+$(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLMR3420V2,tl-mr3420-v2,TL-WR841N-v8,ttyS0,115200,0x34200002,1,4Mlzma))</code></pre></div></blockquote></div></blockquote></div><br /><p><strong>It seems my serial connection works ok now !!! :</strong></p><div class="codebox"><pre><code>=~=~=~=~=~=~=~=~=~=~=~= PuTTY log 2013.01.03 11:47:24 =~=~=~=~=~=~=~=~=~=~=~=
reboot
root@OpenWrt:/# [   99.900000] br-lan: port 2(wlan0) entered disabled state
[   99.910000] br-lan: port 1(eth1) entered disabled state
[   99.920000] device eth1 left promiscuous mode
[   99.920000] br-lan: port 1(eth1) entered disabled state
[   99.940000] eth1: link down
[   99.940000] device wlan0 left promiscuous mode
[   99.940000] br-lan: port 2(wlan0) entered disabled state
[  103.420000] Removing MTD device #3 (rootfs_data) with use count 1
[  103.440000] Restarting system.


U-Boot 1.1.4 (Jul  3 2012 - 15:12:08)

U-boot AP123


DRAM:  32 MB
id read 0x100000ff
Flash:  4 MB
Using default environment

In:    serial
Out:   serial
Err:   serial
Net:   ag934x_enet_initialize...
wasp reset mask:c03300
WASP ----&gt; S27 PHY
GMAC: cfg1 0x5 cfg2 0x7114
eth0: ba:be:fa:ce:08:41
s27 reg init 
athrs27_phy_setup ATHR_PHY_CONTROL 4: 0x1000
athrs27_phy_setup ATHR_PHY_SPEC_STAUS 4: 0x10
eth0 up
WASP ----&gt; S27 PHY
GMAC: cfg1 0xf cfg2 0x7214
eth1: ba:be:fa:ce:08:41
s27 reg init lan 
ATHRS27: resetting s27
ATHRS27: s27 reset done
athrs27_phy_setup ATHR_PHY_CONTROL 0: 0x1000
athrs27_phy_setup ATHR_PHY_SPEC_STAUS 0: 0x10
athrs27_phy_setup ATHR_PHY_CONTROL 1: 0x1000
athrs27_phy_setup ATHR_PHY_SPEC_STAUS 1: 0x10
athrs27_phy_setup ATHR_PHY_CONTROL 2: 0x1000
athrs27_phy_setup ATHR_PHY_SPEC_STAUS 2: 0x10
athrs27_phy_setup ATHR_PHY_CONTROL 3: 0x1000
athrs27_phy_setup ATHR_PHY_SPEC_STAUS 3: 0x10
eth1 up
eth0, eth1
Autobooting in 1 seconds
## Booting image at 9f020000 ...
   Uncompressing Kernel Image ... OK

Starting kernel ...

[    0.000000] Linux version 3.6.11 (xopal@debian) (gcc version 4.6.4 20121106 (prerelease) (Linaro GCC 4.6-2012.11) ) #1 Thu Jan 3 11:33:13 WIT 2013
[    0.000000] bootconsole [early0] enabled
[    0.000000] CPU revision is: 0001974c (MIPS 74Kc)
[    0.000000] SoC: Atheros AR9341 rev 1
[    0.000000] Clocks: CPU:535.000MHz, DDR:400.000MHz, AHB:200.000MHz, Ref:25.000MHz
[    0.000000] Determined physical RAM map:
[    0.000000]  memory: 02000000 @ 00000000 (usable)
[    0.000000] Initrd not found or empty - disabling initrd
[    0.000000] Zone ranges:
[    0.000000]   Normal   [mem 0x00000000-0x01ffffff]
[    0.000000] Movable zone start for each node
[    0.000000] Early memory node ranges
[    0.000000]   node   0: [mem 0x00000000-0x01ffffff]
[    0.000000] Primary instruction cache 64kB, VIPT, 4-way, linesize 32 bytes.
[    0.000000] Primary data cache 32kB, 4-way, VIPT, cache aliases, linesize 32 bytes
[    0.000000] Built 1 zonelists in Zone order, mobility grouping on.  Total pages: 8128
[    0.000000] Kernel command line:  board=TL-WR841N-v8 console=ttyS0,115200 rootfstype=squashfs,jffs2 noinitrd
[    0.000000] PID hash table entries: 128 (order: -3, 512 bytes)
[    0.000000] Dentry cache hash table entries: 4096 (order: 2, 16384 bytes)
[    0.000000] Inode-cache hash table entries: 2048 (order: 1, 8192 bytes)
[    0.000000] __ex_table already sorted, skipping sort
[    0.000000] Writing ErrCtl register=00000000
[    0.000000] Readback ErrCtl register=00000000
[    0.000000] Memory: 29132k/32768k available (2105k kernel code, 3636k reserved, 396k data, 212k init, 0k highmem)
[    0.000000] SLUB: Genslabs=9, HWalign=32, Order=0-3, MinObjects=0, CPUs=1, Nodes=1
[    0.000000] NR_IRQS:51
[    0.000000] Calibrating delay loop... 266.64 BogoMIPS (lpj=1333248)
[    0.080000] pid_max: default: 32768 minimum: 301
[    0.080000] Mount-cache hash table entries: 512
[    0.090000] NET: Registered protocol family 16
[    0.090000] MIPS: machine is TP-LINK TL-WR841N/ND v8
[    0.510000] bio: create slab &lt;bio-0&gt; at 0
[    0.520000] Switching to clocksource MIPS
[    0.520000] NET: Registered protocol family 2
[    0.530000] TCP established hash table entries: 1024 (order: 1, 8192 bytes)
[    0.530000] TCP bind hash table entries: 1024 (order: 0, 4096 bytes)
[    0.540000] TCP: Hash tables configured (established 1024 bind 1024)
[    0.540000] TCP: reno registered
[    0.550000] UDP hash table entries: 256 (order: 0, 4096 bytes)
[    0.550000] UDP-Lite hash table entries: 256 (order: 0, 4096 bytes)
[    0.560000] NET: Registered protocol family 1
[    0.580000] squashfs: version 4.0 (2009/01/31) Phillip Lougher
[    0.580000] jffs2: version 2.2 (NAND) (SUMMARY) (LZMA) (RTIME) (CMODE_PRIORITY) (c) 2001-2006 Red Hat, Inc.
[    0.590000] msgmni has been set to 56
[    0.600000] io scheduler noop registered
[    0.600000] io scheduler deadline registered (default)
[    0.610000] Serial: 8250/16550 driver, 1 ports, IRQ sharing disabled
[    0.630000] serial8250.0: ttyS0 at MMIO 0x18020000 (irq = 11) is a 16550A
[    0.640000] console [ttyS0] enabled, bootconsole disabled
[    0.640000] console [ttyS0] enabled, bootconsole disabled
[    0.650000] ath79-spi ath79-spi: master is unqueued, this is deprecated
[    0.660000] m25p80 spi0.0: found s25sl032a, expected m25p80
[    0.670000] m25p80 spi0.0: s25sl032a (4096 Kbytes)
[    0.670000] 5 tp-link partitions found on MTD device spi0.0
[    0.680000] Creating 5 MTD partitions on &quot;spi0.0&quot;:
[    0.680000] 0x000000000000-0x000000020000 : &quot;u-boot&quot;
[    0.690000] 0x000000020000-0x0000000fbda0 : &quot;kernel&quot;
[    0.700000] mtd: partition &quot;kernel&quot; must either start or end on erase block boundary or be smaller than an erase block -- forcing read-only
[    0.710000] 0x0000000fbda0-0x0000003f0000 : &quot;rootfs&quot;
[    0.720000] mtd: partition &quot;rootfs&quot; must either start or end on erase block boundary or be smaller than an erase block -- forcing read-only
[    0.730000] mtd: partition &quot;rootfs&quot; set to be root filesystem
[    0.740000] mtd: partition &quot;rootfs_data&quot; created automatically, ofs=320000, len=D0000 
[    0.740000] 0x000000320000-0x0000003f0000 : &quot;rootfs_data&quot;
[    0.750000] 0x0000003f0000-0x000000400000 : &quot;art&quot;
[    0.760000] 0x000000020000-0x0000003f0000 : &quot;firmware&quot;
[    0.790000] libphy: ag71xx_mdio: probed
[    0.790000] eth0: Atheros AG71xx at 0xb9000000, irq 4, mode:MII
[    1.350000] ag71xx ag71xx.0: eth0: connected to PHY at ag71xx-mdio.1:00 [uid=004dd042, driver=Generic PHY]
[    1.360000] eth1: Atheros AG71xx at 0xba000000, irq 5, mode:GMII
[    1.920000] eth1: Found an AR934X built-in switch
[    2.950000] TCP: cubic registered
[    2.950000] NET: Registered protocol family 17
[    2.950000] 8021q: 802.1Q VLAN Support v1.8
[    2.970000] VFS: Mounted root (squashfs filesystem) readonly on device 31:2.
[    2.970000] Freeing unused kernel memory: 212k freed
- preinit -
Press the [f] key and hit [enter] to enter failsafe mode
- regular preinit -
[    8.250000] jffs2: notice: (424) jffs2_build_xattr_subsystem: complete building xattr subsystem, 1 of xdatum (0 unchecked, 0 orphan) and 17 of xref (0 dead, 4 orphan) found.
switching to jffs2
- init -

Please press Enter to activate this console. [   10.030000] Compat-drivers backport release: compat-drivers-2012-12-04
[   10.040000] Backport based on wireless-testing.git master-2012-12-06
[   10.050000] compat.git: wireless-testing.git
[   10.100000] cfg80211: Calling CRDA to update world regulatory domain
[   10.100000] cfg80211: World regulatory domain updated:
[   10.110000] cfg80211:   (start_freq - end_freq @ bandwidth), (max_antenna_gain, max_eirp)
[   10.120000] cfg80211:   (2402000 KHz - 2472000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)
[   10.120000] cfg80211:   (2457000 KHz - 2482000 KHz @ 20000 KHz), (300 mBi, 2000 mBm)
[   10.130000] cfg80211:   (2474000 KHz - 2494000 KHz @ 20000 KHz), (300 mBi, 2000 mBm)
[   10.140000] cfg80211:   (5170000 KHz - 5250000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)
[   10.150000] cfg80211:   (5735000 KHz - 5835000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)
[   10.360000] usbcore: registered new interface driver usbfs
[   10.370000] usbcore: registered new interface driver hub
[   10.390000] usbcore: registered new device driver usb
[   10.890000] ieee80211 phy0: Atheros AR9340 Rev:0 mem=0xb8100000, irq=47
[   10.890000] cfg80211: Calling CRDA for country: US
[   10.900000] cfg80211: Regulatory domain changed to country: US
[   10.910000] cfg80211:   (start_freq - end_freq @ bandwidth), (max_antenna_gain, max_eirp)
[   10.910000] cfg80211:   (2402000 KHz - 2472000 KHz @ 40000 KHz), (300 mBi, 2700 mBm)
[   10.920000] cfg80211:   (5170000 KHz - 5250000 KHz @ 40000 KHz), (300 mBi, 1700 mBm)
[   10.930000] cfg80211:   (5250000 KHz - 5330000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)
[   10.940000] cfg80211:   (5490000 KHz - 5600000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)
[   10.950000] cfg80211:   (5650000 KHz - 5710000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)
[   10.950000] cfg80211:   (5735000 KHz - 5835000 KHz @ 40000 KHz), (300 mBi, 3000 mBm)
[   11.010000] PPP generic driver version 2.4.2
[   11.140000] ip_tables: (C) 2000-2006 Netfilter Core Team
[   11.290000] NET: Registered protocol family 24
[   11.310000] ehci_hcd: USB 2.0 &#039;Enhanced&#039; Host Controller (EHCI) Driver
[   11.310000] ehci-platform ehci-platform: Generic Platform EHCI Controller
[   11.320000] ehci-platform ehci-platform: new USB bus registered, assigned bus number 1
[   11.360000] ehci-platform ehci-platform: irq 3, io mem 0x1b000000
[   11.380000] ehci-platform ehci-platform: USB 2.0 started, EHCI 1.00
[   11.380000] hub 1-0:1.0: USB hub found
[   11.390000] hub 1-0:1.0: 1 port detected
[   11.410000] nf_conntrack version 0.5.0 (458 buckets, 1832 max)
[   11.700000] ohci_hcd: USB 1.1 &#039;Open&#039; Host Controller (OHCI) Driver
[   11.720000] uhci_hcd: USB Universal Host Controller Interface driver
[   11.830000] usbcore: registered new interface driver usbserial
[   11.830000] usbcore: registered new interface driver usbserial_generic
[   11.840000] USB Serial support registered for generic
[   11.850000] usbserial: USB Serial Driver core
[   11.880000] usbcore: registered new interface driver option
[   11.880000] USB Serial support registered for GSM modem (1-port)
[   11.900000] usbcore: registered new interface driver qcserial
[   11.910000] USB Serial support registered for Qualcomm USB modem
[   11.930000] usbcore: registered new interface driver sierra
[   11.930000] USB Serial support registered for Sierra USB modem
[   16.750000] device eth1 entered promiscuous mode
[   17.490000] eth1: link up (1000Mbps/Full duplex)
[   17.490000] br-lan: port 1(eth1) entered forwarding state
[   17.500000] br-lan: port 1(eth1) entered forwarding state
[   19.500000] br-lan: port 1(eth1) entered forwarding state
[   19.520000] device wlan0 entered promiscuous mode
[   19.600000] br-lan: port 2(wlan0) entered forwarding state
[   19.610000] br-lan: port 2(wlan0) entered forwarding state
[   21.610000] br-lan: port 2(wlan0) entered forwarding state



BusyBox v1.19.4 (2013-01-03 11:06:02 WIT) built-in shell (ash)
Enter &#039;help&#039; for a list of built-in commands.

  _______                     ________        __
 |       |.-----.-----.-----.|  |  |  |.----.|  |_
 |   -   ||  _  |  -__|     ||  |  |  ||   _||   _|
 |_______||   __|_____|__|__||________||__|  |____|
          |__| W I R E L E S S   F R E E D O M
 -----------------------------------------------------
 BARRIER BREAKER (Bleeding Edge, r34996)
 -----------------------------------------------------
  * 1/2 oz Galliano         Pour all ingredients into
  * 4 oz cold Coffee        an irish coffee mug filled
  * 1 1/2 oz Dark Rum       with crushed ice. Stir.
  * 2 tsp. Creme de Cacao
 -----------------------------------------------------
root@OpenWrt:/# cat /proc/cpuinfo
system type        : Atheros AR9341 rev 1
machine            : TP-LINK TL-WR841N/ND v8
processor        : 0
cpu model        : MIPS 74Kc V4.12
BogoMIPS        : 266.64
wait instruction    : yes
microsecond timers    : yes
tlb_entries        : 32
extra interrupt vector    : yes
hardware watchpoint    : yes, count: 4, address/irw mask: [0x0000, 0x0ff8, 0x0ff8, 0x0ff8]
ASEs implemented    : mips16 dsp
shadow register sets    : 1
kscratch registers    : 0
core            : 0
VCED exceptions        : not available
VCEI exceptions        : not available

root@OpenWrt:/# lsusb
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
root@OpenWrt:/# </code></pre></div><p>Resume of this router can be found here <a href="http://forum.openwrt-id.org/viewtopic.php?pid=73#p73">http://forum.openwrt-id.org/viewtopic.php?pid=73#p73</a> , if you like you can submit to Dev. OpenWrt&nbsp; since I don&#039;t know how to submit patches to Dev. OpenWrt.</p>											<p class="post-edited">(Last edited by <strong>xopal</strong> on 3 Jan 2013, 10:46)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p187925">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">xopal</div>
					<div class="post-datetime">
						5 Jan 2013, 08:06					</div>
				</div>
				<div class="post-content content">
					<p>Can not enable USB function</p><div class="codebox"><pre><code>Index: target/linux/ar71xx/files/arch/mips/ath79/mach-tl-wr841n-v8.c
===================================================================
--- target/linux/ar71xx/files/arch/mips/ath79/mach-tl-wr841n-v8.c    (revision 35015)
+++ target/linux/ar71xx/files/arch/mips/ath79/mach-tl-wr841n-v8.c    (working copy)
@@ -18,6 +18,7 @@
 #include &quot;dev-gpio-buttons.h&quot;
 #include &quot;dev-leds-gpio.h&quot;
 #include &quot;dev-m25p80.h&quot;
+#include &quot;dev-usb.h&quot;
 #include &quot;dev-wmac.h&quot;
 #include &quot;machtypes.h&quot;
 
@@ -110,6 +111,7 @@
     ath79_register_gpio_keys_polled(1, TL_WR841NV8_KEYS_POLL_INTERVAL,
                     ARRAY_SIZE(tl_wr841n_v8_gpio_keys),
                     tl_wr841n_v8_gpio_keys);
+    ath79_register_usb();
 
     ath79_register_m25p80(&amp;tl_wr841n_v8_flash_data);
 
Index: target/linux/ar71xx/image/Makefile
===================================================================
--- target/linux/ar71xx/image/Makefile    (revision 35015)
+++ target/linux/ar71xx/image/Makefile    (working copy)
@@ -883,7 +883,7 @@
 $(eval $(call SingleProfile,TPLINKOLD,$(fs_squash),TLWR841NV15,tl-wr841nd-v1.5,TL-WR841N-v1.5,ttyS0,115200,0x08410002,2,4M))
 
 $(eval $(call SingleProfile,TPLINK,$(fs_64kraw),TLMR3220V1,tl-mr3220-v1,TL-MR3220,ttyS0,115200,0x32200001,1,4M))
-$(eval $(call SingleProfile,TPLINK,$(fs_64kraw),TLMR3420,tl-mr3420-v1,TL-MR3420,ttyS0,115200,0x34200001,1,4M))
+$(eval $(call SingleProfile,TPLINK,$(fs_64kraw),TLMR3420V1,tl-mr3420-v1,TL-MR3420,ttyS0,115200,0x34200001,1,4M))
 $(eval $(call SingleProfile,TPLINK,$(fs_64kraw),TLWA701,tl-wa701n-v1,TL-WA901ND,ttyS0,115200,0x07010001,1,4M))
 $(eval $(call SingleProfile,TPLINK,$(fs_64kraw),TLWA7510NV1,tl-wa7510n,TL-WA7510N,ttyS0,115200,0x75100001,1,4M))
 $(eval $(call SingleProfile,TPLINK,$(fs_64kraw),TLWA801NV1,tl-wa801nd-v1,TL-WA901ND,ttyS0,115200,0x08010001,1,4M))
@@ -907,6 +907,7 @@
 $(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLMR3020,tl-mr3020-v1,TL-MR3020,ttyATH0,115200,0x30200001,1,4Mlzma))
 $(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLMR3040,tl-mr3040-v1,TL-MR3040,ttyATH0,115200,0x30400001,1,4Mlzma))
 $(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLMR3220V2,tl-mr3220-v2,TL-MR3220-v2,ttyATH0,115200,0x32200002,1,4Mlzma))
+$(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLMR3420V2,tl-mr3420-v2,TL-WR841N-v8,ttyS0,115200,0x34200002,1,4Mlzma))
 $(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLWR703,tl-wr703n-v1,TL-WR703N,ttyATH0,115200,0x07030101,1,4Mlzma))
 $(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLWR740NV4,tl-wr740n-v4,TL-WR741ND-v4,ttyATH0,115200,0x07400004,1,4Mlzma))
 $(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLWR741NV4,tl-wr741nd-v4,TL-WR741ND-v4,ttyATH0,115200,0x07410004,1,4Mlzma))
@@ -956,6 +957,7 @@
 $(eval $(call MultiProfile,OPENMESH,OM2P MR600))
 $(eval $(call MultiProfile,TEW652BRP,TEW652BRP_FW TEW652BRP_RECOVERY))
 $(eval $(call MultiProfile,TLMR3220,TLMR3220V1 TLMR3220V2))
+$(eval $(call MultiProfile,TLMR3420,TLMR3420V1 TLMR3420V2))
 $(eval $(call MultiProfile,TLWA801,TLWA801NV1))
 $(eval $(call MultiProfile,TLWA901,TLWA901NV1 TLWA901NV2))
 $(eval $(call MultiProfile,TLWA7510,TLWA7510NV1))
Index: target/linux/ar71xx/base-files/lib/ar71xx.sh
===================================================================
--- target/linux/ar71xx/base-files/lib/ar71xx.sh    (revision 35015)
+++ target/linux/ar71xx/base-files/lib/ar71xx.sh    (working copy)
@@ -357,6 +357,9 @@
     *TL-MR3420)
         name=&quot;tl-mr3420&quot;
         ;;
+    *&quot;TL-MR3420 v2&quot;)
+        name=&quot;tl-mr3420-v2&quot;
+        ;;
     *TL-WA7510N)
         name=&quot;tl-wa7510n&quot;
         ;;
Index: target/linux/ar71xx/base-files/lib/upgrade/platform.sh
===================================================================
--- target/linux/ar71xx/base-files/lib/upgrade/platform.sh    (revision 35015)
+++ target/linux/ar71xx/base-files/lib/upgrade/platform.sh    (working copy)
@@ -155,6 +155,7 @@
     tl-mr3220 | \
     tl-mr3220-v2 | \
     tl-mr3420 | \
+    tl-mr3420-v2 | \
     tl-wa7510n | \
     tl-wa901nd | \
     tl-wa901nd-v2 | \
Index: target/linux/ar71xx/base-files/etc/uci-defaults/leds
===================================================================
--- target/linux/ar71xx/base-files/etc/uci-defaults/leds    (revision 35015)
+++ target/linux/ar71xx/base-files/etc/uci-defaults/leds    (working copy)
@@ -128,6 +128,16 @@
     ucidef_set_led_usbdev &quot;usb&quot; &quot;USB&quot; &quot;tp-link:green:3g&quot; &quot;1-1&quot;
     ;;
 
+tl-mr3420-v2)
+    ucidef_set_led_netdev &quot;wan&quot; &quot;WAN&quot; &quot;tp-link:green:wan&quot; &quot;eth1&quot;
+    ucidef_set_led_switch &quot;lan1&quot; &quot;LAN1&quot; &quot;tp-link:green:lan1&quot; &quot;switch0&quot; &quot;0x04&quot;
+    ucidef_set_led_switch &quot;lan2&quot; &quot;LAN2&quot; &quot;tp-link:green:lan2&quot; &quot;switch0&quot; &quot;0x08&quot;
+    ucidef_set_led_switch &quot;lan3&quot; &quot;LAN3&quot; &quot;tp-link:green:lan3&quot; &quot;switch0&quot; &quot;0x10&quot;
+    ucidef_set_led_switch &quot;lan4&quot; &quot;LAN4&quot; &quot;tp-link:green:lan4&quot; &quot;switch0&quot; &quot;0x02&quot;
+    ucidef_set_led_wlan &quot;wlan&quot; &quot;WLAN&quot; &quot;tp-link:green:wlan&quot; &quot;phy0tpt&quot;
+    ucidef_set_led_usbdev &quot;usb&quot; &quot;USB&quot; &quot;tp-link:green:3g&quot; &quot;1-1&quot;
+    ;;
+
 tl-wa901nd)
     ucidef_set_led_netdev &quot;lan&quot; &quot;LAN&quot; &quot;tp-link:green:lan&quot; &quot;eth0&quot;
     ;;
Index: target/linux/ar71xx/base-files/etc/uci-defaults/network
===================================================================
--- target/linux/ar71xx/base-files/etc/uci-defaults/network    (revision 35015)
+++ target/linux/ar71xx/base-files/etc/uci-defaults/network    (working copy)
@@ -217,6 +217,7 @@
 tl-mr3220 |\
 tl-mr3220-v2 |\
 tl-mr3420 |\
+tl-mr3420-v2 |\
 tl-wr741nd |\
 tl-wr741nd-v4 |\
 tl-wr841n-v7 |\
Index: target/linux/ar71xx/base-files/etc/diag.sh
===================================================================
--- target/linux/ar71xx/base-files/etc/diag.sh    (revision 35015)
+++ target/linux/ar71xx/base-files/etc/diag.sh    (working copy)
@@ -132,6 +132,7 @@
     tl-mr3220 | \
     tl-mr3220-v2 | \
     tl-mr3420 | \
+    tl-mr3420-v2 | \
     tl-wa901nd | \
     tl-wa901nd-v2 | \
     tl-wr1041n-v2 | \
Index: target/linux/ar71xx/patches-3.6/610-MIPS-ath79-openwrt-machines.patch
===================================================================
--- target/linux/ar71xx/patches-3.6/610-MIPS-ath79-openwrt-machines.patch    (revision 35015)
+++ target/linux/ar71xx/patches-3.6/610-MIPS-ath79-openwrt-machines.patch    (working copy)
@@ -1,6 +1,6 @@
 --- a/arch/mips/ath79/machtypes.h
 +++ b/arch/mips/ath79/machtypes.h
-@@ -16,22 +16,112 @@
+@@ -16,22 +16,113 @@
  
  enum ath79_mach_type {
      ATH79_MACH_GENERIC = 0,
@@ -67,6 +67,7 @@
 +    ATH79_MACH_TL_MR3220,        /* TP-LINK TL-MR3220 */
 +    ATH79_MACH_TL_MR3220_V2,    /* TP-LINK TL-MR3220 v2 */
 +    ATH79_MACH_TL_MR3420,        /* TP-LINK TL-MR3420 */
++    ATH79_MACH_TL_MR3420_V2,    /* TP-LINK TL-MR3420 v2 */
 +    ATH79_MACH_TL_WA7510N_V1,    /* TP-LINK TL-WA7510N v1*/
 +    ATH79_MACH_TL_WA901ND,        /* TP-LINK TL-WA901ND */
 +    ATH79_MACH_TL_WA901ND_V2,    /* TP-LINK TL-WA901ND v2 */
Index: tools/firmware-utils/src/mktplinkfw.c
===================================================================
--- tools/firmware-utils/src/mktplinkfw.c    (revision 35015)
+++ tools/firmware-utils/src/mktplinkfw.c    (working copy)
@@ -34,6 +34,7 @@
 #define HWID_TL_MR3220_V1    0x32200001
 #define HWID_TL_MR3220_V2    0x32200002
 #define HWID_TL_MR3420_V1    0x34200001
+#define HWID_TL_MR3420_V2    0x34200002
 #define HWID_TL_WA701N_V1    0x07010001
 #define HWID_TL_WA7510N_V1    0x75100001
 #define HWID_TL_WA801ND_V1    0x08010001
@@ -175,8 +176,7 @@
         .kernel_ep    = 0x80060000,
         .rootfs_ofs    = 0x100000,
     }, {
-        /* terminating entry */
-    }
+        }
 };
 
 static struct board_info boards[] = {
@@ -201,6 +201,11 @@
         .hw_rev        = 1,
         .layout_id    = &quot;4M&quot;,
     }, {
+        .id        = &quot;TL-MR3420v2&quot;,
+        .hw_id        = HWID_TL_MR3420_V2,
+        .hw_rev        = 1,
+        .layout_id    = &quot;4Mlzma&quot;,
+    }, {
         .id        = &quot;TL-WA701Nv1&quot;,
         .hw_id        = HWID_TL_WA701N_V1,
         .hw_rev        = 1,</code></pre></div><p><a href="http://pastebin.com/Lt57e0v0">Pastebin</a></p>											<p class="post-edited">(Last edited by <strong>xopal</strong> on 5 Jan 2013, 14:59)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p188347">
				<div class="post-metadata">
					<div class="post-num">Post #21</div>
					<div class="post-author">cindy.wijaya</div>
					<div class="post-datetime">
						8 Jan 2013, 23:28					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>xopal wrote:</cite><blockquote><p>Can not enable USB function<br />[spoiler]<br /></p><div class="codebox"><pre><code>Index: target/linux/ar71xx/files/arch/mips/ath79/mach-tl-wr841n-v8.c
===================================================================
--- target/linux/ar71xx/files/arch/mips/ath79/mach-tl-wr841n-v8.c    (revision 35015)
+++ target/linux/ar71xx/files/arch/mips/ath79/mach-tl-wr841n-v8.c    (working copy)
@@ -18,6 +18,7 @@
 #include &quot;dev-gpio-buttons.h&quot;
 #include &quot;dev-leds-gpio.h&quot;
 #include &quot;dev-m25p80.h&quot;
+#include &quot;dev-usb.h&quot;
 #include &quot;dev-wmac.h&quot;
 #include &quot;machtypes.h&quot;
 
@@ -110,6 +111,7 @@
     ath79_register_gpio_keys_polled(1, TL_WR841NV8_KEYS_POLL_INTERVAL,
                     ARRAY_SIZE(tl_wr841n_v8_gpio_keys),
                     tl_wr841n_v8_gpio_keys);
+    ath79_register_usb();
 
     ath79_register_m25p80(&amp;tl_wr841n_v8_flash_data);
 
Index: target/linux/ar71xx/image/Makefile
===================================================================
--- target/linux/ar71xx/image/Makefile    (revision 35015)
+++ target/linux/ar71xx/image/Makefile    (working copy)
@@ -883,7 +883,7 @@
 $(eval $(call SingleProfile,TPLINKOLD,$(fs_squash),TLWR841NV15,tl-wr841nd-v1.5,TL-WR841N-v1.5,ttyS0,115200,0x08410002,2,4M))
 
 $(eval $(call SingleProfile,TPLINK,$(fs_64kraw),TLMR3220V1,tl-mr3220-v1,TL-MR3220,ttyS0,115200,0x32200001,1,4M))
-$(eval $(call SingleProfile,TPLINK,$(fs_64kraw),TLMR3420,tl-mr3420-v1,TL-MR3420,ttyS0,115200,0x34200001,1,4M))
+$(eval $(call SingleProfile,TPLINK,$(fs_64kraw),TLMR3420V1,tl-mr3420-v1,TL-MR3420,ttyS0,115200,0x34200001,1,4M))
 $(eval $(call SingleProfile,TPLINK,$(fs_64kraw),TLWA701,tl-wa701n-v1,TL-WA901ND,ttyS0,115200,0x07010001,1,4M))
 $(eval $(call SingleProfile,TPLINK,$(fs_64kraw),TLWA7510NV1,tl-wa7510n,TL-WA7510N,ttyS0,115200,0x75100001,1,4M))
 $(eval $(call SingleProfile,TPLINK,$(fs_64kraw),TLWA801NV1,tl-wa801nd-v1,TL-WA901ND,ttyS0,115200,0x08010001,1,4M))
@@ -907,6 +907,7 @@
 $(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLMR3020,tl-mr3020-v1,TL-MR3020,ttyATH0,115200,0x30200001,1,4Mlzma))
 $(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLMR3040,tl-mr3040-v1,TL-MR3040,ttyATH0,115200,0x30400001,1,4Mlzma))
 $(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLMR3220V2,tl-mr3220-v2,TL-MR3220-v2,ttyATH0,115200,0x32200002,1,4Mlzma))
+$(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLMR3420V2,tl-mr3420-v2,TL-WR841N-v8,ttyS0,115200,0x34200002,1,4Mlzma))
 $(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLWR703,tl-wr703n-v1,TL-WR703N,ttyATH0,115200,0x07030101,1,4Mlzma))
 $(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLWR740NV4,tl-wr740n-v4,TL-WR741ND-v4,ttyATH0,115200,0x07400004,1,4Mlzma))
 $(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLWR741NV4,tl-wr741nd-v4,TL-WR741ND-v4,ttyATH0,115200,0x07410004,1,4Mlzma))
@@ -956,6 +957,7 @@
 $(eval $(call MultiProfile,OPENMESH,OM2P MR600))
 $(eval $(call MultiProfile,TEW652BRP,TEW652BRP_FW TEW652BRP_RECOVERY))
 $(eval $(call MultiProfile,TLMR3220,TLMR3220V1 TLMR3220V2))
+$(eval $(call MultiProfile,TLMR3420,TLMR3420V1 TLMR3420V2))
 $(eval $(call MultiProfile,TLWA801,TLWA801NV1))
 $(eval $(call MultiProfile,TLWA901,TLWA901NV1 TLWA901NV2))
 $(eval $(call MultiProfile,TLWA7510,TLWA7510NV1))
Index: target/linux/ar71xx/base-files/lib/ar71xx.sh
===================================================================
--- target/linux/ar71xx/base-files/lib/ar71xx.sh    (revision 35015)
+++ target/linux/ar71xx/base-files/lib/ar71xx.sh    (working copy)
@@ -357,6 +357,9 @@
     *TL-MR3420)
         name=&quot;tl-mr3420&quot;
         ;;
+    *&quot;TL-MR3420 v2&quot;)
+        name=&quot;tl-mr3420-v2&quot;
+        ;;
     *TL-WA7510N)
         name=&quot;tl-wa7510n&quot;
         ;;
Index: target/linux/ar71xx/base-files/lib/upgrade/platform.sh
===================================================================
--- target/linux/ar71xx/base-files/lib/upgrade/platform.sh    (revision 35015)
+++ target/linux/ar71xx/base-files/lib/upgrade/platform.sh    (working copy)
@@ -155,6 +155,7 @@
     tl-mr3220 | \
     tl-mr3220-v2 | \
     tl-mr3420 | \
+    tl-mr3420-v2 | \
     tl-wa7510n | \
     tl-wa901nd | \
     tl-wa901nd-v2 | \
Index: target/linux/ar71xx/base-files/etc/uci-defaults/leds
===================================================================
--- target/linux/ar71xx/base-files/etc/uci-defaults/leds    (revision 35015)
+++ target/linux/ar71xx/base-files/etc/uci-defaults/leds    (working copy)
@@ -128,6 +128,16 @@
     ucidef_set_led_usbdev &quot;usb&quot; &quot;USB&quot; &quot;tp-link:green:3g&quot; &quot;1-1&quot;
     ;;
 
+tl-mr3420-v2)
+    ucidef_set_led_netdev &quot;wan&quot; &quot;WAN&quot; &quot;tp-link:green:wan&quot; &quot;eth1&quot;
+    ucidef_set_led_switch &quot;lan1&quot; &quot;LAN1&quot; &quot;tp-link:green:lan1&quot; &quot;switch0&quot; &quot;0x04&quot;
+    ucidef_set_led_switch &quot;lan2&quot; &quot;LAN2&quot; &quot;tp-link:green:lan2&quot; &quot;switch0&quot; &quot;0x08&quot;
+    ucidef_set_led_switch &quot;lan3&quot; &quot;LAN3&quot; &quot;tp-link:green:lan3&quot; &quot;switch0&quot; &quot;0x10&quot;
+    ucidef_set_led_switch &quot;lan4&quot; &quot;LAN4&quot; &quot;tp-link:green:lan4&quot; &quot;switch0&quot; &quot;0x02&quot;
+    ucidef_set_led_wlan &quot;wlan&quot; &quot;WLAN&quot; &quot;tp-link:green:wlan&quot; &quot;phy0tpt&quot;
+    ucidef_set_led_usbdev &quot;usb&quot; &quot;USB&quot; &quot;tp-link:green:3g&quot; &quot;1-1&quot;
+    ;;
+
 tl-wa901nd)
     ucidef_set_led_netdev &quot;lan&quot; &quot;LAN&quot; &quot;tp-link:green:lan&quot; &quot;eth0&quot;
     ;;
Index: target/linux/ar71xx/base-files/etc/uci-defaults/network
===================================================================
--- target/linux/ar71xx/base-files/etc/uci-defaults/network    (revision 35015)
+++ target/linux/ar71xx/base-files/etc/uci-defaults/network    (working copy)
@@ -217,6 +217,7 @@
 tl-mr3220 |\
 tl-mr3220-v2 |\
 tl-mr3420 |\
+tl-mr3420-v2 |\
 tl-wr741nd |\
 tl-wr741nd-v4 |\
 tl-wr841n-v7 |\
Index: target/linux/ar71xx/base-files/etc/diag.sh
===================================================================
--- target/linux/ar71xx/base-files/etc/diag.sh    (revision 35015)
+++ target/linux/ar71xx/base-files/etc/diag.sh    (working copy)
@@ -132,6 +132,7 @@
     tl-mr3220 | \
     tl-mr3220-v2 | \
     tl-mr3420 | \
+    tl-mr3420-v2 | \
     tl-wa901nd | \
     tl-wa901nd-v2 | \
     tl-wr1041n-v2 | \
Index: target/linux/ar71xx/patches-3.6/610-MIPS-ath79-openwrt-machines.patch
===================================================================
--- target/linux/ar71xx/patches-3.6/610-MIPS-ath79-openwrt-machines.patch    (revision 35015)
+++ target/linux/ar71xx/patches-3.6/610-MIPS-ath79-openwrt-machines.patch    (working copy)
@@ -1,6 +1,6 @@
 --- a/arch/mips/ath79/machtypes.h
 +++ b/arch/mips/ath79/machtypes.h
-@@ -16,22 +16,112 @@
+@@ -16,22 +16,113 @@
  
  enum ath79_mach_type {
      ATH79_MACH_GENERIC = 0,
@@ -67,6 +67,7 @@
 +    ATH79_MACH_TL_MR3220,        /* TP-LINK TL-MR3220 */
 +    ATH79_MACH_TL_MR3220_V2,    /* TP-LINK TL-MR3220 v2 */
 +    ATH79_MACH_TL_MR3420,        /* TP-LINK TL-MR3420 */
++    ATH79_MACH_TL_MR3420_V2,    /* TP-LINK TL-MR3420 v2 */
 +    ATH79_MACH_TL_WA7510N_V1,    /* TP-LINK TL-WA7510N v1*/
 +    ATH79_MACH_TL_WA901ND,        /* TP-LINK TL-WA901ND */
 +    ATH79_MACH_TL_WA901ND_V2,    /* TP-LINK TL-WA901ND v2 */
Index: tools/firmware-utils/src/mktplinkfw.c
===================================================================
--- tools/firmware-utils/src/mktplinkfw.c    (revision 35015)
+++ tools/firmware-utils/src/mktplinkfw.c    (working copy)
@@ -34,6 +34,7 @@
 #define HWID_TL_MR3220_V1    0x32200001
 #define HWID_TL_MR3220_V2    0x32200002
 #define HWID_TL_MR3420_V1    0x34200001
+#define HWID_TL_MR3420_V2    0x34200002
 #define HWID_TL_WA701N_V1    0x07010001
 #define HWID_TL_WA7510N_V1    0x75100001
 #define HWID_TL_WA801ND_V1    0x08010001
@@ -175,8 +176,7 @@
         .kernel_ep    = 0x80060000,
         .rootfs_ofs    = 0x100000,
     }, {
-        /* terminating entry */
-    }
+        }
 };
 
 static struct board_info boards[] = {
@@ -201,6 +201,11 @@
         .hw_rev        = 1,
         .layout_id    = &quot;4M&quot;,
     }, {
+        .id        = &quot;TL-MR3420v2&quot;,
+        .hw_id        = HWID_TL_MR3420_V2,
+        .hw_rev        = 1,
+        .layout_id    = &quot;4Mlzma&quot;,
+    }, {
         .id        = &quot;TL-WA701Nv1&quot;,
         .hw_id        = HWID_TL_WA701N_V1,
         .hw_rev        = 1,</code></pre></div><p>[/spoiler]</p><p><a href="http://pastebin.com/Lt57e0v0">Pastebin</a></p></blockquote></div><p>Actually USB is enable but does not power up <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /></p><p><strong>Update:</strong><br />SOLVED - DONE!</p>											<p class="post-edited">(Last edited by <strong>cindy.wijaya</strong> on 10 Jan 2013, 11:09)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p188467">
				<div class="post-metadata">
					<div class="post-num">Post #22</div>
					<div class="post-author">cindy.wijaya</div>
					<div class="post-datetime">
						10 Jan 2013, 10:16					</div>
				</div>
				<div class="post-content content">
					<p><strong>Adding support to TP-LINK MR3220 V.2 + MR3420 V.2<br />OpenWrt Attitude Adjustment 12.09-rc1</strong></p><p>diff<br /></p><div class="codebox"><pre><code>Index: target/linux/ar71xx/files/arch/mips/ath79/mach-tl-wr841n-v8.c
===================================================================
--- target/linux/ar71xx/files/arch/mips/ath79/mach-tl-wr841n-v8.c    (revision 35052)
+++ target/linux/ar71xx/files/arch/mips/ath79/mach-tl-wr841n-v8.c    (working copy)
@@ -8,6 +8,9 @@
  *  by the Free Software Foundation.
  */
 
+#include &quot;dev-usb.h&quot; 
+#include &lt;linux/gpio.h&gt;
+
 #include &lt;linux/platform_device.h&gt;
 
 #include &lt;asm/mach-ath79/ath79.h&gt;
@@ -32,7 +35,7 @@
 
 #define TL_WR841NV8_GPIO_BTN_RESET    17
 #define TL_WR841NV8_GPIO_SW_RFKILL    16
-
+#define TL_WR841NV8_GPIO_USB_POWER    4
 #define TL_WR841NV8_KEYS_POLL_INTERVAL    20    /* msecs */
 #define TL_WR841NV8_KEYS_DEBOUNCE_INTERVAL (3 * TL_WR841NV8_KEYS_POLL_INTERVAL)
 
@@ -111,6 +114,13 @@
                     ARRAY_SIZE(tl_wr841n_v8_gpio_keys),
                     tl_wr841n_v8_gpio_keys);
 
+    /* enable power for the USB port */
+    gpio_request(TL_WR841NV8_GPIO_USB_POWER, &quot;USB power&quot;);
+    gpio_direction_input(TL_WR841NV8_GPIO_USB_POWER);
+
+    ath79_register_usb();
+    /* END for the USB port */
+
     ath79_register_m25p80(&amp;tl_wr841n_v8_flash_data);
 
     ath79_setup_ar934x_eth_cfg(AR934X_ETH_CFG_SW_PHY_SWAP);
@@ -135,5 +145,5 @@
     ath79_register_wmac(ee, mac);
 }
 
-MIPS_MACHINE(ATH79_MACH_TL_WR841N_V8, &quot;TL-WR841N-v8&quot;, &quot;TP-LINK TL-WR841N/ND v8&quot;,
+MIPS_MACHINE(ATH79_MACH_TL_WR841N_V8, &quot;TL-WR841N-v8&quot;, &quot;TP-LINK TL-MR3420 v2 | TP-LINK TL-WR841N/ND v8 (3G)&quot;,
          tl_wr841n_v8_setup);
Index: target/linux/ar71xx/files/arch/mips/ath79/mach-tl-wr741nd-v4.c
===================================================================
--- target/linux/ar71xx/files/arch/mips/ath79/mach-tl-wr741nd-v4.c    (revision 35052)
+++ target/linux/ar71xx/files/arch/mips/ath79/mach-tl-wr741nd-v4.c    (working copy)
@@ -13,6 +13,7 @@
 #include &lt;asm/mach-ath79/ath79.h&gt;
 #include &lt;asm/mach-ath79/ar71xx_regs.h&gt;
 
+#include &quot;dev-usb.h&quot;
 #include &quot;common.h&quot;
 #include &quot;dev-eth.h&quot;
 #include &quot;dev-gpio-buttons.h&quot;
@@ -120,6 +121,7 @@
                     ARRAY_SIZE(tl_wr741ndv4_gpio_keys),
                     tl_wr741ndv4_gpio_keys);
 
+    ath79_register_usb();
     ath79_register_m25p80(&amp;tl_wr741ndv4_flash_data);
     ath79_init_mac(ath79_eth0_data.mac_addr, mac, 1);
     ath79_init_mac(ath79_eth1_data.mac_addr, mac, -1);
@@ -132,4 +134,4 @@
 }
 
 MIPS_MACHINE(ATH79_MACH_TL_WR741ND_V4, &quot;TL-WR741ND-v4&quot;,
-         &quot;TP-LINK TL-WR741ND v4&quot;, tl_wr741ndv4_setup);
+         &quot;TP-LINK TL-MR3220 v2 | TP-LINK TL-WR741ND v4 (3G)&quot;, tl_wr741ndv4_setup);
Index: target/linux/ar71xx/image/Makefile
===================================================================
--- target/linux/ar71xx/image/Makefile    (revision 35052)
+++ target/linux/ar71xx/image/Makefile    (working copy)
@@ -848,8 +848,7 @@
 
 $(eval $(call SingleProfile,TPLINKOLD,$(fs_squash),TLWR841NV15,tl-wr841nd-v1.5,TL-WR841N-v1.5,ttyS0,115200,0x08410002,2,4M))
 
-$(eval $(call SingleProfile,TPLINK,$(fs_64kraw),TLMR3220,tl-mr3220-v1,TL-MR3220,ttyS0,115200,0x32200001,1,4M))
-$(eval $(call SingleProfile,TPLINK,$(fs_64kraw),TLMR3420,tl-mr3420-v1,TL-MR3420,ttyS0,115200,0x34200001,1,4M))
+
 $(eval $(call SingleProfile,TPLINK,$(fs_64kraw),TLWA701,tl-wa701n-v1,TL-WA901ND,ttyS0,115200,0x07010001,1,4M))
 $(eval $(call SingleProfile,TPLINK,$(fs_64kraw),TLWA7510NV1,tl-wa7510n,TL-WA7510N,ttyS0,115200,0x75100001,1,4M))
 $(eval $(call SingleProfile,TPLINK,$(fs_64kraw),TLWA901NV1,tl-wa901nd-v1,TL-WA901ND,ttyS0,115200,0x09010001,1,4M))
@@ -869,11 +868,12 @@
 $(eval $(call SingleProfile,TPLINK,$(fs_64kraw),TLWR1043,tl-wr1043nd-v1,TL-WR1043ND,ttyS0,115200,0x10430001,1,8M))
 
 $(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLMR11U,tl-mr11u-v1,TL-MR11U,ttyATH0,115200,0x00110101,1,4Mlzma))
-$(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLMR3020,tl-mr3020-v1,TL-MR3020,ttyATH0,115200,0x30200001,1,4Mlzma))
-$(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLMR3040,tl-mr3040-v1,TL-MR3040,ttyATH0,115200,0x30400001,1,4Mlzma))
+
 $(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLWR703,tl-wr703n-v1,TL-WR703N,ttyATH0,115200,0x07030101,1,4Mlzma))
 $(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLWR740NV4,tl-wr740n-v4,TL-WR741ND-v4,ttyATH0,115200,0x07400004,1,4Mlzma))
+########### referensi mr3220 v.2
 $(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLWR741NV4,tl-wr741nd-v4,TL-WR741ND-v4,ttyATH0,115200,0x07410004,1,4Mlzma))
+########### 
 $(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLWR841NV8,tl-wr841n-v8,TL-WR841N-v8,ttyS0,115200,0x08410008,1,4Mlzma))
 $(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLWR1041,tl-wr1041n-v2,TL-WR1041N-v2,ttyS0,115200,0x10410002,1,4Mlzma))
 $(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLWR2543,tl-wr2543-v1,TL-WR2543N,ttyS0,115200,0x25430001,1,8Mlzma,-v 3.13.99))
@@ -912,6 +912,19 @@
 
 $(eval $(call SingleProfile,ZyXEL,$(fs_64k),NBG_460N_550N_550NH,nbg460n_550n_550nh,NBG460N,ttyS0,115200,NBG-460N))
 
+$(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLMR3020V1,tl-mr3020-v1,TL-MR3020,ttyATH0,115200,0x30200001,1,4Mlzma))
+$(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLMR3040V1,tl-mr3040-v1,TL-MR3040,ttyATH0,115200,0x30400001,1,4Mlzma))
+$(eval $(call SingleProfile,TPLINK,$(fs_64kraw),TLMR3220V1,tl-mr3220-v1,TL-MR3220,ttyS0,115200,0x32200001,1,4M))
+$(eval $(call SingleProfile,TPLINK,$(fs_64kraw),TLMR3420V1,tl-mr3420-v1,TL-MR3420,ttyS0,115200,0x34200001,1,4M))
+############ MR3220 V.2
+$(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLMR3220V2,tl-mr3220-v2,TL-WR741ND-v4,ttyATH0,115200,0x32200002,1,4Mlzma))
+$(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLMR3420V2,tl-mr3420-v2,TL-WR841N-v8,ttyS0,115200,0x34200002,1,4Mlzma))
+############ 
+#----------------------tambahan
+$(eval $(call MultiProfile,TLMR3220,TLMR3220V1 TLMR3220V2))
+$(eval $(call MultiProfile,TLMR3420,TLMR3420V1 TLMR3420V2))
+$(eval $(call MultiProfile,TLMR3020,TLMR3020V1 TLMR3020V2))
+#----------------------
 $(eval $(call MultiProfile,AP121,AP121_2M AP121_4M))
 $(eval $(call MultiProfile,EWDORIN, EWDORINAP EWDORINRT))
 $(eval $(call MultiProfile,TEW652BRP,TEW652BRP_FW TEW652BRP_RECOVERY))
Index: target/linux/ar71xx/patches-3.3/610-MIPS-ath79-openwrt-machines.patch
===================================================================
--- target/linux/ar71xx/patches-3.3/610-MIPS-ath79-openwrt-machines.patch    (revision 35052)
+++ target/linux/ar71xx/patches-3.3/610-MIPS-ath79-openwrt-machines.patch    (working copy)
@@ -555,6 +555,7 @@
 +config ATH79_MACH_TL_WR741ND_V4
 +    bool &quot;TP-LINK TL-WR741ND v4 support&quot;
 +    select SOC_AR933X
++    select ATH79_DEV_USB
 +    select ATH79_DEV_ETH
 +    select ATH79_DEV_GPIO_BUTTONS
 +    select ATH79_DEV_LEDS_GPIO
@@ -573,6 +574,7 @@
 +config ATH79_MACH_TL_WR841N_V8
 +    bool &quot;TP-LINK TL-WR841N/ND v8 support&quot;
 +    select SOC_AR934X
++    select ATH79_DEV_USB
 +    select ATH79_DEV_ETH
 +    select ATH79_DEV_GPIO_BUTTONS
 +    select ATH79_DEV_LEDS_GPIO
Index: target/linux/ar71xx/base-files/etc/uci-defaults/network
===================================================================
--- target/linux/ar71xx/base-files/etc/uci-defaults/network    (revision 35052)
+++ target/linux/ar71xx/base-files/etc/uci-defaults/network    (working copy)
@@ -134,6 +134,12 @@
     ucidef_add_switch_vlan &quot;switch0&quot; &quot;1&quot; &quot;0 1 2 3 4&quot;
     ;;
 
+tl-mr3420-v2)
+    ucidef_set_interfaces_lan_wan &quot;eth1&quot; &quot;eth0&quot;
+    ucidef_add_switch &quot;switch0&quot; &quot;1&quot; &quot;1&quot;
+    ucidef_add_switch_vlan &quot;switch0&quot; &quot;1&quot; &quot;0 1 2 3 4&quot;
+    ;;
+
 wrt160nl)
     ucidef_set_interfaces_lan_wan &quot;eth0&quot; &quot;eth1&quot;
     ucidef_add_switch &quot;eth0&quot; &quot;1&quot; &quot;1&quot;
@@ -187,6 +193,7 @@
 tew-632brp |\
 tew-712br |\
 tl-mr3220 |\
+tl-mr3220-v2 |\
 tl-mr3420 |\
 tl-wr741nd |\
 tl-wr741nd-v4 |\
Index: tools/firmware-utils/src/mktplinkfw.c
===================================================================
--- tools/firmware-utils/src/mktplinkfw.c    (revision 35052)
+++ tools/firmware-utils/src/mktplinkfw.c    (working copy)
@@ -32,7 +32,9 @@
 #define HEADER_VERSION_V1    0x01000000
 #define HWID_TL_MR3020_V1    0x30200001
 #define HWID_TL_MR3220_V1    0x32200001
+#define HWID_TL_MR3220_V2    0x32200002
 #define HWID_TL_MR3420_V1    0x34200001
+#define HWID_TL_MR3420_V2    0x34200002
 #define HWID_TL_WA701N_V1    0x07010001
 #define HWID_TL_WA7510N_V1    0x75100001
 #define HWID_TL_WA901ND_V1    0x09010001
@@ -173,6 +175,12 @@
         .kernel_ep    = 0x80060000,
         .rootfs_ofs    = 0x100000,
     }, {
+        .id             = &quot;16Mlzma&quot;,
+        .fw_max_len     = 0xfc0000,
+        .kernel_la      = 0x80060000,
+        .kernel_ep      = 0x80060000,
+        .rootfs_ofs     = 0x100000,
+    }, {
         /* terminating entry */
     }
 };
@@ -189,11 +197,21 @@
         .hw_rev        = 1,
         .layout_id    = &quot;4M&quot;,
     }, {
+        .id        = &quot;TL-MR3220v2&quot;,
+        .hw_id        = HWID_TL_MR3220_V2,
+        .hw_rev        = 1,
+        .layout_id    = &quot;4Mlzma&quot;,
+    }, {
         .id        = &quot;TL-MR3420v1&quot;,
         .hw_id        = HWID_TL_MR3420_V1,
         .hw_rev        = 1,
         .layout_id    = &quot;4M&quot;,
     }, {
+        .id        = &quot;TL-MR3420v2&quot;,
+        .hw_id        = HWID_TL_MR3420_V2,
+        .hw_rev        = 1,
+        .layout_id    = &quot;4Mlzma&quot;,
+    }, {
         .id        = &quot;TL-WA701Nv1&quot;,
         .hw_id        = HWID_TL_WA701N_V1,
         .hw_rev        = 1,</code></pre></div><p><a href="http://pastebin.com/gzf2VNhK">pastebin-diff</a></p><p>Download (iix)<br /><a href="http://openwrt.agromapia.com/firmware/aarc1/">http://openwrt.agromapia.com/firmware/aarc1/</a></p><p>Download (int)<br /><a href="https://www.box.com/s/qebaprwq0798dyu19h1c">https://www.box.com/s/qebaprwq0798dyu19h1c</a></p><p>folder contains:<br /></p><div class="codebox"><pre><code>md5sums
openwrt-ar71xx-generic-tl-mr3020-v1-squashfs-factory.bin
openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin
openwrt-ar71xx-generic-tl-mr3220-v2-squashfs-factory.bin
openwrt-ar71xx-generic-tl-mr3420-v1-squashfs-factory.bin
openwrt-ar71xx-generic-tl-mr3420-v2-squashfs-factory.bin</code></pre></div><br /><p>Previous firmware:<br /><a href="https://www.box.com/s/cqk23ztqlux1zs034896">https://www.box.com/s/cqk23ztqlux1zs034896</a>[/spoiler]</p><p><strong><span style="color: green">Mission Accomplished</span></strong></p><p><strong><span class="postimg"><img src="https://encrypted-tbn2.gstatic.com/images?q=tbn:ANd9GcRQXgOGs5oW9_YFoQvf-f9OqZg6Lt_N0V17VpbNGeQyiFfZ2o7U" alt="https://encrypted-tbn2.gstatic.com/images?q=tbn:ANd9GcRQXgOGs5oW9_YFoQvf-f9OqZg6Lt_N0V17VpbNGeQyiFfZ2o7U" /></span></strong></p>											<p class="post-edited">(Last edited by <strong>cindy.wijaya</strong> on 10 Jan 2013, 10:18)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p188484">
				<div class="post-metadata">
					<div class="post-num">Post #23</div>
					<div class="post-author">mang</div>
					<div class="post-datetime">
						10 Jan 2013, 13:58					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>cindy.wijaya wrote:</cite><blockquote><p><strong>Adding support to TP-LINK MR3220 V.2 + MR3420 V.2<br />OpenWrt Attitude Adjustment 12.09-rc1</strong></p><p>diff<br /></p><div class="codebox"><pre><code>Index: target/linux/ar71xx/files/arch/mips/ath79/mach-tl-wr841n-v8.c
===================================================================
--- target/linux/ar71xx/files/arch/mips/ath79/mach-tl-wr841n-v8.c    (revision 35052)
+++ target/linux/ar71xx/files/arch/mips/ath79/mach-tl-wr841n-v8.c    (working copy)
@@ -8,6 +8,9 @@
  *  by the Free Software Foundation.
  */
 
+#include &quot;dev-usb.h&quot; 
+#include &lt;linux/gpio.h&gt;
+
 #include &lt;linux/platform_device.h&gt;
 
 #include &lt;asm/mach-ath79/ath79.h&gt;
@@ -32,7 +35,7 @@
 
 #define TL_WR841NV8_GPIO_BTN_RESET    17
 #define TL_WR841NV8_GPIO_SW_RFKILL    16
-
+#define TL_WR841NV8_GPIO_USB_POWER    4
 #define TL_WR841NV8_KEYS_POLL_INTERVAL    20    /* msecs */
 #define TL_WR841NV8_KEYS_DEBOUNCE_INTERVAL (3 * TL_WR841NV8_KEYS_POLL_INTERVAL)
 
@@ -111,6 +114,13 @@
                     ARRAY_SIZE(tl_wr841n_v8_gpio_keys),
                     tl_wr841n_v8_gpio_keys);
 
+    /* enable power for the USB port */
+    gpio_request(TL_WR841NV8_GPIO_USB_POWER, &quot;USB power&quot;);
+    gpio_direction_input(TL_WR841NV8_GPIO_USB_POWER);
+
+    ath79_register_usb();
+    /* END for the USB port */
+
     ath79_register_m25p80(&amp;tl_wr841n_v8_flash_data);
 
     ath79_setup_ar934x_eth_cfg(AR934X_ETH_CFG_SW_PHY_SWAP);
@@ -135,5 +145,5 @@
     ath79_register_wmac(ee, mac);
 }
 
-MIPS_MACHINE(ATH79_MACH_TL_WR841N_V8, &quot;TL-WR841N-v8&quot;, &quot;TP-LINK TL-WR841N/ND v8&quot;,
+MIPS_MACHINE(ATH79_MACH_TL_WR841N_V8, &quot;TL-WR841N-v8&quot;, &quot;TP-LINK TL-MR3420 v2 | TP-LINK TL-WR841N/ND v8 (3G)&quot;,
          tl_wr841n_v8_setup);
Index: target/linux/ar71xx/files/arch/mips/ath79/mach-tl-wr741nd-v4.c
===================================================================
--- target/linux/ar71xx/files/arch/mips/ath79/mach-tl-wr741nd-v4.c    (revision 35052)
+++ target/linux/ar71xx/files/arch/mips/ath79/mach-tl-wr741nd-v4.c    (working copy)
@@ -13,6 +13,7 @@
 #include &lt;asm/mach-ath79/ath79.h&gt;
 #include &lt;asm/mach-ath79/ar71xx_regs.h&gt;
 
+#include &quot;dev-usb.h&quot;
 #include &quot;common.h&quot;
 #include &quot;dev-eth.h&quot;
 #include &quot;dev-gpio-buttons.h&quot;
@@ -120,6 +121,7 @@
                     ARRAY_SIZE(tl_wr741ndv4_gpio_keys),
                     tl_wr741ndv4_gpio_keys);
 
+    ath79_register_usb();
     ath79_register_m25p80(&amp;tl_wr741ndv4_flash_data);
     ath79_init_mac(ath79_eth0_data.mac_addr, mac, 1);
     ath79_init_mac(ath79_eth1_data.mac_addr, mac, -1);
@@ -132,4 +134,4 @@
 }
 
 MIPS_MACHINE(ATH79_MACH_TL_WR741ND_V4, &quot;TL-WR741ND-v4&quot;,
-         &quot;TP-LINK TL-WR741ND v4&quot;, tl_wr741ndv4_setup);
+         &quot;TP-LINK TL-MR3220 v2 | TP-LINK TL-WR741ND v4 (3G)&quot;, tl_wr741ndv4_setup);
Index: target/linux/ar71xx/image/Makefile
===================================================================
--- target/linux/ar71xx/image/Makefile    (revision 35052)
+++ target/linux/ar71xx/image/Makefile    (working copy)
@@ -848,8 +848,7 @@
 
 $(eval $(call SingleProfile,TPLINKOLD,$(fs_squash),TLWR841NV15,tl-wr841nd-v1.5,TL-WR841N-v1.5,ttyS0,115200,0x08410002,2,4M))
 
-$(eval $(call SingleProfile,TPLINK,$(fs_64kraw),TLMR3220,tl-mr3220-v1,TL-MR3220,ttyS0,115200,0x32200001,1,4M))
-$(eval $(call SingleProfile,TPLINK,$(fs_64kraw),TLMR3420,tl-mr3420-v1,TL-MR3420,ttyS0,115200,0x34200001,1,4M))
+
 $(eval $(call SingleProfile,TPLINK,$(fs_64kraw),TLWA701,tl-wa701n-v1,TL-WA901ND,ttyS0,115200,0x07010001,1,4M))
 $(eval $(call SingleProfile,TPLINK,$(fs_64kraw),TLWA7510NV1,tl-wa7510n,TL-WA7510N,ttyS0,115200,0x75100001,1,4M))
 $(eval $(call SingleProfile,TPLINK,$(fs_64kraw),TLWA901NV1,tl-wa901nd-v1,TL-WA901ND,ttyS0,115200,0x09010001,1,4M))
@@ -869,11 +868,12 @@
 $(eval $(call SingleProfile,TPLINK,$(fs_64kraw),TLWR1043,tl-wr1043nd-v1,TL-WR1043ND,ttyS0,115200,0x10430001,1,8M))
 
 $(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLMR11U,tl-mr11u-v1,TL-MR11U,ttyATH0,115200,0x00110101,1,4Mlzma))
-$(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLMR3020,tl-mr3020-v1,TL-MR3020,ttyATH0,115200,0x30200001,1,4Mlzma))
-$(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLMR3040,tl-mr3040-v1,TL-MR3040,ttyATH0,115200,0x30400001,1,4Mlzma))
+
 $(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLWR703,tl-wr703n-v1,TL-WR703N,ttyATH0,115200,0x07030101,1,4Mlzma))
 $(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLWR740NV4,tl-wr740n-v4,TL-WR741ND-v4,ttyATH0,115200,0x07400004,1,4Mlzma))
+########### referensi mr3220 v.2
 $(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLWR741NV4,tl-wr741nd-v4,TL-WR741ND-v4,ttyATH0,115200,0x07410004,1,4Mlzma))
+########### 
 $(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLWR841NV8,tl-wr841n-v8,TL-WR841N-v8,ttyS0,115200,0x08410008,1,4Mlzma))
 $(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLWR1041,tl-wr1041n-v2,TL-WR1041N-v2,ttyS0,115200,0x10410002,1,4Mlzma))
 $(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLWR2543,tl-wr2543-v1,TL-WR2543N,ttyS0,115200,0x25430001,1,8Mlzma,-v 3.13.99))
@@ -912,6 +912,19 @@
 
 $(eval $(call SingleProfile,ZyXEL,$(fs_64k),NBG_460N_550N_550NH,nbg460n_550n_550nh,NBG460N,ttyS0,115200,NBG-460N))
 
+$(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLMR3020V1,tl-mr3020-v1,TL-MR3020,ttyATH0,115200,0x30200001,1,4Mlzma))
+$(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLMR3040V1,tl-mr3040-v1,TL-MR3040,ttyATH0,115200,0x30400001,1,4Mlzma))
+$(eval $(call SingleProfile,TPLINK,$(fs_64kraw),TLMR3220V1,tl-mr3220-v1,TL-MR3220,ttyS0,115200,0x32200001,1,4M))
+$(eval $(call SingleProfile,TPLINK,$(fs_64kraw),TLMR3420V1,tl-mr3420-v1,TL-MR3420,ttyS0,115200,0x34200001,1,4M))
+############ MR3220 V.2
+$(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLMR3220V2,tl-mr3220-v2,TL-WR741ND-v4,ttyATH0,115200,0x32200002,1,4Mlzma))
+$(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLMR3420V2,tl-mr3420-v2,TL-WR841N-v8,ttyS0,115200,0x34200002,1,4Mlzma))
+############ 
+#----------------------tambahan
+$(eval $(call MultiProfile,TLMR3220,TLMR3220V1 TLMR3220V2))
+$(eval $(call MultiProfile,TLMR3420,TLMR3420V1 TLMR3420V2))
+$(eval $(call MultiProfile,TLMR3020,TLMR3020V1 TLMR3020V2))
+#----------------------
 $(eval $(call MultiProfile,AP121,AP121_2M AP121_4M))
 $(eval $(call MultiProfile,EWDORIN, EWDORINAP EWDORINRT))
 $(eval $(call MultiProfile,TEW652BRP,TEW652BRP_FW TEW652BRP_RECOVERY))
Index: target/linux/ar71xx/patches-3.3/610-MIPS-ath79-openwrt-machines.patch
===================================================================
--- target/linux/ar71xx/patches-3.3/610-MIPS-ath79-openwrt-machines.patch    (revision 35052)
+++ target/linux/ar71xx/patches-3.3/610-MIPS-ath79-openwrt-machines.patch    (working copy)
@@ -555,6 +555,7 @@
 +config ATH79_MACH_TL_WR741ND_V4
 +    bool &quot;TP-LINK TL-WR741ND v4 support&quot;
 +    select SOC_AR933X
++    select ATH79_DEV_USB
 +    select ATH79_DEV_ETH
 +    select ATH79_DEV_GPIO_BUTTONS
 +    select ATH79_DEV_LEDS_GPIO
@@ -573,6 +574,7 @@
 +config ATH79_MACH_TL_WR841N_V8
 +    bool &quot;TP-LINK TL-WR841N/ND v8 support&quot;
 +    select SOC_AR934X
++    select ATH79_DEV_USB
 +    select ATH79_DEV_ETH
 +    select ATH79_DEV_GPIO_BUTTONS
 +    select ATH79_DEV_LEDS_GPIO
Index: target/linux/ar71xx/base-files/etc/uci-defaults/network
===================================================================
--- target/linux/ar71xx/base-files/etc/uci-defaults/network    (revision 35052)
+++ target/linux/ar71xx/base-files/etc/uci-defaults/network    (working copy)
@@ -134,6 +134,12 @@
     ucidef_add_switch_vlan &quot;switch0&quot; &quot;1&quot; &quot;0 1 2 3 4&quot;
     ;;
 
+tl-mr3420-v2)
+    ucidef_set_interfaces_lan_wan &quot;eth1&quot; &quot;eth0&quot;
+    ucidef_add_switch &quot;switch0&quot; &quot;1&quot; &quot;1&quot;
+    ucidef_add_switch_vlan &quot;switch0&quot; &quot;1&quot; &quot;0 1 2 3 4&quot;
+    ;;
+
 wrt160nl)
     ucidef_set_interfaces_lan_wan &quot;eth0&quot; &quot;eth1&quot;
     ucidef_add_switch &quot;eth0&quot; &quot;1&quot; &quot;1&quot;
@@ -187,6 +193,7 @@
 tew-632brp |\
 tew-712br |\
 tl-mr3220 |\
+tl-mr3220-v2 |\
 tl-mr3420 |\
 tl-wr741nd |\
 tl-wr741nd-v4 |\
Index: tools/firmware-utils/src/mktplinkfw.c
===================================================================
--- tools/firmware-utils/src/mktplinkfw.c    (revision 35052)
+++ tools/firmware-utils/src/mktplinkfw.c    (working copy)
@@ -32,7 +32,9 @@
 #define HEADER_VERSION_V1    0x01000000
 #define HWID_TL_MR3020_V1    0x30200001
 #define HWID_TL_MR3220_V1    0x32200001
+#define HWID_TL_MR3220_V2    0x32200002
 #define HWID_TL_MR3420_V1    0x34200001
+#define HWID_TL_MR3420_V2    0x34200002
 #define HWID_TL_WA701N_V1    0x07010001
 #define HWID_TL_WA7510N_V1    0x75100001
 #define HWID_TL_WA901ND_V1    0x09010001
@@ -173,6 +175,12 @@
         .kernel_ep    = 0x80060000,
         .rootfs_ofs    = 0x100000,
     }, {
+        .id             = &quot;16Mlzma&quot;,
+        .fw_max_len     = 0xfc0000,
+        .kernel_la      = 0x80060000,
+        .kernel_ep      = 0x80060000,
+        .rootfs_ofs     = 0x100000,
+    }, {
         /* terminating entry */
     }
 };
@@ -189,11 +197,21 @@
         .hw_rev        = 1,
         .layout_id    = &quot;4M&quot;,
     }, {
+        .id        = &quot;TL-MR3220v2&quot;,
+        .hw_id        = HWID_TL_MR3220_V2,
+        .hw_rev        = 1,
+        .layout_id    = &quot;4Mlzma&quot;,
+    }, {
         .id        = &quot;TL-MR3420v1&quot;,
         .hw_id        = HWID_TL_MR3420_V1,
         .hw_rev        = 1,
         .layout_id    = &quot;4M&quot;,
     }, {
+        .id        = &quot;TL-MR3420v2&quot;,
+        .hw_id        = HWID_TL_MR3420_V2,
+        .hw_rev        = 1,
+        .layout_id    = &quot;4Mlzma&quot;,
+    }, {
         .id        = &quot;TL-WA701Nv1&quot;,
         .hw_id        = HWID_TL_WA701N_V1,
         .hw_rev        = 1,</code></pre></div><p><a href="http://pastebin.com/gzf2VNhK">pastebin-diff</a></p><p>Download (iix)<br /><a href="http://openwrt.agromapia.com/firmware/aarc1/">http://openwrt.agromapia.com/firmware/aarc1/</a></p><p>Download (int)<br /><a href="https://www.box.com/s/qebaprwq0798dyu19h1c">https://www.box.com/s/qebaprwq0798dyu19h1c</a></p><p>folder contains:<br /></p><div class="codebox"><pre><code>md5sums
openwrt-ar71xx-generic-tl-mr3020-v1-squashfs-factory.bin
openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin
openwrt-ar71xx-generic-tl-mr3220-v2-squashfs-factory.bin
openwrt-ar71xx-generic-tl-mr3420-v1-squashfs-factory.bin
openwrt-ar71xx-generic-tl-mr3420-v2-squashfs-factory.bin</code></pre></div><br /><p>Previous firmware:<br /><a href="https://www.box.com/s/cqk23ztqlux1zs034896">https://www.box.com/s/cqk23ztqlux1zs034896</a>[/spoiler]</p><p><strong><span style="color: green">Mission Accomplished</span></strong></p><p><strong><span class="postimg"><img src="https://encrypted-tbn2.gstatic.com/images?q=tbn:ANd9GcRQXgOGs5oW9_YFoQvf-f9OqZg6Lt_N0V17VpbNGeQyiFfZ2o7U" alt="https://encrypted-tbn2.gstatic.com/images?q=tbn:ANd9GcRQXgOGs5oW9_YFoQvf-f9OqZg6Lt_N0V17VpbNGeQyiFfZ2o7U" /></span></strong></p></blockquote></div><p>sip miss, good job <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p188547">
				<div class="post-metadata">
					<div class="post-num">Post #24</div>
					<div class="post-author">martek1</div>
					<div class="post-datetime">
						10 Jan 2013, 23:47					</div>
				</div>
				<div class="post-content content">
					<p>Hi!</p><p>Is it possible to install OpenWRT on TL-MR3420 without access to serial port? I have full access (via telnet) to my busybox installed on default firmware with &#039;dd&#039; tool and I can dump and (probably) write MTD devices.</p><p>Any hints? <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p188552">
				<div class="post-metadata">
					<div class="post-num">Post #25</div>
					<div class="post-author">xopal</div>
					<div class="post-datetime">
						11 Jan 2013, 00:20					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>martek1 wrote:</cite><blockquote><p>Hi!</p><p>Is it possible to install OpenWRT on TL-MR3420 without access to serial port? I have full access (via telnet) to my busybox installed on default firmware with &#039;dd&#039; tool and I can dump and (probably) write MTD devices.</p><p>Any hints? <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p></blockquote></div><p>What is your current firmware on 3420 , and what is your hardware version.</p>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 1 of 6</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=41326&amp;p=2.html">2</a></li><li><a href="viewtopic.php%3Fid=41326&amp;p=3.html">3</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=41326&amp;p=6.html">6</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>