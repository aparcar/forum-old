<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> PC Engines APU2 + Huawei ME909s-120 4G LTE modem</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 1 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p343725">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">MartijnW</div>
					<div class="post-datetime">
						14 Nov 2016, 22:27					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>I&#039;ve recently bought an Huawei ME909s-120 mPCI modem to serve as a 4G backup on my PC Engines APU2 running OpenWrt.<br />However the modem is not showing up in the /dev directory as a ttyUSBx, ttySx or cdc-wdm device.<br />&quot;lsusb&quot; output is showing the modem.<br />I&#039;ve succesfully tested the modem using Ubuntu to exclude HW-failure.</p><p>Any ideas on what might be going wrong?<br />every help on this is much appreciated!</p><p>thanks!</p><p>system information:<br />Firmware Version: OpenWrt Designated Driver 49941 / LuCI Master (git-16.288.36935-1e1a706)<br />Kernel Version:&nbsp; &nbsp; 4.4.14<br />--------</p><div class="codebox"><pre><code>root@OpenWrt:~# lsusb
Bus 001 Device 003: ID 12d1:15c1 Huawei Technologies Co., Ltd.
Bus 003 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub
Bus 002 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
Bus 001 Device 002: ID 0438:7900 Advanced Micro Devices, Inc.
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub


root@OpenWrt:~# opkg list-installed
at - 3.1.16-2
ath10k-firmware-qca988x - 2014-11-13-b00eb8d30fbebb6a5047ccacefa8c37e072fca9c-1
badblocks - 1.43.1-2
base-files - 169-49941
busybox - 1.24.2-1
chat - 2.4.7-9
comgt - 0.32-27
diffutils - 3.3-2
dnsmasq - 2.76-1
dropbear - 2016.74-1
e2fsprogs - 1.43.1-2
firewall - 2016-01-29
fstools - 2016-07-24-addd7dc21fe99f2701c1d4708071578052af401d
hostapd-common - 2016-06-15-1
hwclock - 2.28-1
ip - 4.4.0-1
ip6tables - 1.4.21-2
iperf3 - 3.1.3-1
ipset - 6.24-1
iptables - 1.4.21-2
iptables-mod-conntrack-extra - 1.4.21-2
iptables-mod-ipopt - 1.4.21-2
iw - 4.3-1
jshn - 2016-07-29-290c64ef5b5c3e75be851594f269d6a9568e64e5
jsonfilter - 2016-07-02-dea067ad67d977c247c300c06676a06adf21e0c7
kernel - 4.4.14-1-e503a97778c286d21bde254f5b5e451b
kmod-3c59x - 4.4.14-1
kmod-8139too - 4.4.14-1
kmod-ath - 4.4.14+2016-05-12-1
kmod-ath10k - 4.4.14+2016-05-12-1
kmod-ath5k - 4.4.14+2016-05-12-1
kmod-ath9k - 4.4.14+2016-05-12-1
kmod-ath9k-common - 4.4.14+2016-05-12-1
kmod-button-hotplug - 4.4.14-3
kmod-cfg80211 - 4.4.14+2016-05-12-1
kmod-crypto-aead - 4.4.14-1
kmod-crypto-cbc - 4.4.14-1
kmod-crypto-ecb - 4.4.14-1
kmod-crypto-hash - 4.4.14-1
kmod-crypto-hw-geode - 4.4.14-1
kmod-crypto-manager - 4.4.14-1
kmod-crypto-null - 4.4.14-1
kmod-crypto-ocf - 4.4.14-1
kmod-crypto-pcompress - 4.4.14-1
kmod-crypto-sha1 - 4.4.14-1
kmod-e100 - 4.4.14-1
kmod-e1000 - 4.4.14-1
kmod-hwmon-core - 4.4.14-1
kmod-hwmon-lm90 - 4.4.14-1
kmod-i2c-algo-bit - 4.4.14-1
kmod-i2c-algo-pca - 4.4.14-1
kmod-i2c-algo-pcf - 4.4.14-1
kmod-i2c-core - 4.4.14-1
kmod-i2c-gpio - 4.4.14-1
kmod-igb - 4.4.14-1
kmod-input-core - 4.4.14-1
kmod-input-gpio-keys-polled - 4.4.14-1
kmod-input-polldev - 4.4.14-1
kmod-ip6tables - 4.4.14-1
kmod-ipt-conntrack - 4.4.14-1
kmod-ipt-conntrack-extra - 4.4.14-1
kmod-ipt-core - 4.4.14-1
kmod-ipt-filter - 4.4.14-1
kmod-ipt-ipopt - 4.4.14-1
kmod-ipt-ipset - 4.4.14-1
kmod-ipt-nat - 4.4.14-1
kmod-leds-gpio - 4.4.14-1
kmod-ledtrig-gpio - 4.4.14-1
kmod-ledtrig-heartbeat - 4.4.14-1
kmod-ledtrig-netdev - 4.4.14-1
kmod-lib-crc-ccitt - 4.4.14-1
kmod-lib-textsearch - 4.4.14-1
kmod-libphy - 4.4.14-1
kmod-mac80211 - 4.4.14+2016-05-12-1
kmod-mii - 4.4.14-1
kmod-mppe - 4.4.14-1
kmod-natsemi - 4.4.14-1
kmod-ne2k-pci - 4.4.14-1
kmod-nf-conntrack - 4.4.14-1
kmod-nf-conntrack6 - 4.4.14-1
kmod-nf-ipt - 4.4.14-1
kmod-nf-ipt6 - 4.4.14-1
kmod-nf-nat - 4.4.14-1
kmod-nf-nathelper - 4.4.14-1
kmod-nfnetlink - 4.4.14-1
kmod-nls-base - 4.4.14-1
kmod-pcnet32 - 4.4.14-1
kmod-ppp - 4.4.14-1
kmod-pppoe - 4.4.14-1
kmod-pppox - 4.4.14-1
kmod-pps - 4.4.14-1
kmod-ptp - 4.4.14-1
kmod-r8169 - 4.4.14-1
kmod-sched-connmark - 4.4.14-1
kmod-sched-core - 4.4.14-1
kmod-sis900 - 4.4.14-1
kmod-slhc - 4.4.14-1
kmod-tg3 - 4.4.14-1
kmod-tun - 4.4.14-1
kmod-usb-core - 4.4.14-1
kmod-usb-net - 4.4.14-1
kmod-usb-net-cdc-ncm - 4.4.14-1
kmod-usb-net-huawei-cdc-ncm - 4.4.14-1
kmod-usb-net-qmi-wwan - 4.4.14-1
kmod-usb-ohci - 4.4.14-1
kmod-usb-serial - 4.4.14-1
kmod-usb-serial-sierrawireless - 4.4.14-1
kmod-usb-serial-wwan - 4.4.14-1
kmod-usb-uhci - 4.4.14-1
kmod-usb-wdm - 4.4.14-1
kmod-usb2 - 4.4.14-1
kmod-usb3 - 4.4.14-1
kmod-via-rhine - 4.4.14-1
kmod-via-velocity - 4.4.14-1
libblkid - 2.28-1
libblobmsg-json - 2016-07-29-290c64ef5b5c3e75be851594f269d6a9568e64e5
libc - 1.1.15-1
libelf1 - 0.165-1
libext2fs - 1.43.1-2
libgcc - 5.3.0-1
libip4tc - 1.4.21-2
libip6tc - 1.4.21-2
libiwinfo - 2016-01-25-e4aca3910dff532ed878d0ceaf1ab6e8ad7719bf
libiwinfo-lua - 2016-01-25-e4aca3910dff532ed878d0ceaf1ab6e8ad7719bf
libjson-c - 0.12-1
libjson-script - 2016-07-29-290c64ef5b5c3e75be851594f269d6a9568e64e5
liblua - 5.1.5-1
liblzo - 2.09-1
libmnl - 1.0.3-2
libncursesw - 5.9-3
libnetsnmp - 5.4.4-2
libnl-tiny - 0.1-5
libopenssl - 1.0.2j-1
libpolarssl - 1.3.17-1
libpthread - 1.1.15-1
librt - 1.1.15-1
libubox - 2016-07-29-290c64ef5b5c3e75be851594f269d6a9568e64e5
libubus - 2016-07-02-053be7df871e05478284235732f8b0608089512f
libubus-lua - 2016-07-02-053be7df871e05478284235732f8b0608089512f
libuci - 2016-07-04.1-1
libuci-lua - 2016-07-04.1-1
libuclient - 2016-01-28-2e0918c7e0612449024caaaa8d44fb2d7a33f5f3
libusb-1.0 - 1.0.20-1
libustream-openssl - 2016-07-02-ec80adaa1b47f28d426fa19c692011ce60b992d6
libuuid - 2.28-1
libxtables - 1.4.21-2
logd - 2016-07-19-aead2c0cbffdda9b46d74a998a4c6aeef423b21a
lua - 5.1.5-1
luci - git-16.288.36935-1e1a706-1
luci-app-commands - git-16.288.36935-1e1a706-1
luci-app-firewall - git-16.288.36935-1e1a706-1
luci-app-meshwizard - git-16.288.36935-1e1a706-1
luci-app-mwan3 - 1.4-4
luci-app-openvpn - git-16.288.36935-1e1a706-1
luci-base - git-16.288.36935-1e1a706-1
luci-lib-ip - git-16.288.36935-1e1a706-1
luci-lib-jsonc - git-16.288.36935-1e1a706-1
luci-lib-nixio - git-16.288.36935-1e1a706-1
luci-mod-admin-full - git-16.288.36935-1e1a706-1
luci-proto-3g - git-16.288.36935-1e1a706-1
luci-proto-ipv6 - git-16.288.36935-1e1a706-1
luci-proto-ppp - git-16.288.36935-1e1a706-1
luci-ssl-openssl - git-16.288.36935-1e1a706-1
luci-theme-bootstrap - git-16.288.36935-1e1a706-1
meshwizard - 0.3.1
mtd - 21
mwan3 - 2.0-3
netifd - 2016-06-06-99e6dc68bbac5a57a0ebca810a9dc36e38667821
odhcp6c - 2016-06-30-7533a6243dc3ac5a747cf6ccbc4d0539dafd3e07
odhcpd - 2015-11-19-01d3f9d64486ac1daa144848944e877e7f0cb762
openvpn-openssl - 2.3.11-1
opkg - 9c97d5ecd795709c8584e972bfdf3aee3a5b846d-12
ppp - 2.4.7-9
ppp-mod-pppoe - 2.4.7-9
procd - 2016-07-29-2c9f5d4af1559b840c42f1443ede9f9fe809c58b
px5g - 4
r8169-firmware - 2016-01-25-52442afee9907bc32a058f22bb3295d040677c26-1
rpcd - 2016-06-30-23417e94d25570e6d62542bac46edd51e8e0243a
sudo - 1.8.14p3-1
terminfo - 5.9-3
ubox - 2016-07-19-aead2c0cbffdda9b46d74a998a4c6aeef423b21a
ubus - 2016-07-02-053be7df871e05478284235732f8b0608089512f
ubusd - 2016-07-02-053be7df871e05478284235732f8b0608089512f
uci - 2016-07-04.1-1
uclient-fetch - 2016-01-28-2e0918c7e0612449024caaaa8d44fb2d7a33f5f3
uh-t-t-p-d - 2015-11-08-fe01ef3f52adae9da38ef47926cd50974af5d6b7
uh-t-t-p-d-mod-ubus - 2015-11-08-fe01ef3f52adae9da38ef47926cd50974af5d6b7
uqmi - 2015-09-17-8a97586e9445a60e355dea13aa87885ab3dcb277
usb-modeswitch - 2014-08-26-993a9a542791953c4804f7ddbb3a07756738e37a
usbutils - 007-4
usign - 2016-07-04-ef6419142a3b0fbcddcccf536e3c1880302c6f89
vim-full - 7.4-3
wpad - 2016-06-15-1
wwan - 2014-07-17-1
zlib - 1.2.8-1</code></pre></div>											<p class="post-edited">(Last edited by <strong>MartijnW</strong> on 14 Nov 2016, 22:35)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p343754">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">milankocvara</div>
					<div class="post-datetime">
						15 Nov 2016, 08:49					</div>
				</div>
				<div class="post-content content">
					<p>Try install kmod-usb-serial-option yet.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p343811">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">MartijnW</div>
					<div class="post-datetime">
						15 Nov 2016, 23:35					</div>
				</div>
				<div class="post-content content">
					<p>Hi milankocvara,</p><p>Thanks!<br />the modem is now showing up in /dev directory as a ttyUSB0, ttyUSB1, ttyUSB2, ttyUSB3 and ttyUSB4.</p><p>Any suggestions on what the nexts steps should be in getting the modem operational?<br />I know the modem should support QMI mode and am thinking on trying the<br />h t t p s://wiki.openwrt.org/doc/recipes/ltedongle recipe</p><p>my first ever attempt to get a 4g-modem up and running (and probably missing out on one or more essential steps):</p><p>I&#039;ve been editting the /etc/config/network file with the following snippet (for each of the ttyUSB&#039;s above)</p><div class="codebox"><pre><code>config interface &#039;wwan&#039;
    option proto &#039;ppp&#039;
    option device &#039;/dev/ttyUSB0&#039;
    option username &#039;root&#039;
    option password &#039;admin&#039;
    option ipv6 &#039;auto&#039;</code></pre></div><p>and </p><div class="codebox"><pre><code>config interface &#039;wwan&#039;
    option proto &#039;3g&#039;
    option service &#039;umts_only&#039;
    option apn &#039;portalmmm.nl&#039;
    option pincode &#039;0000&#039;
    option username &#039;root&#039;
    option password &#039;admin&#039;
    option dialnumber &#039;*99#&#039;
    option ipv6 &#039;auto&#039;
    option device &#039;/dev/ttyUSB4&#039;</code></pre></div><p>no matter what I do, no wwan interface is showing up in the &quot;ifconfig&quot; output.</p>											<p class="post-edited">(Last edited by <strong>MartijnW</strong> on 15 Nov 2016, 23:35)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p343834">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">milankocvara</div>
					<div class="post-datetime">
						16 Nov 2016, 09:08					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>MartijnW wrote:</cite><blockquote><p>Hi milankocvara,</p><p>Thanks!<br />the modem is now showing up in /dev directory as a ttyUSB0, ttyUSB1, ttyUSB2, ttyUSB3 and ttyUSB4.</p><p>Any suggestions on what the nexts steps should be in getting the modem operational?<br />I know the modem should support QMI mode and am thinking on trying the<br />h t t p s://wiki.openwrt.org/doc/recipes/ltedongle recipe</p><p>my first ever attempt to get a 4g-modem up and running (and probably missing out on one or more essential steps):</p><p>I&#039;ve been editting the /etc/config/network file with the following snippet (for each of the ttyUSB&#039;s above)</p><div class="codebox"><pre><code>config interface &#039;wwan&#039;
    option proto &#039;ppp&#039;
    option device &#039;/dev/ttyUSB0&#039;
    option username &#039;root&#039;
    option password &#039;admin&#039;
    option ipv6 &#039;auto&#039;</code></pre></div><p>and </p><div class="codebox"><pre><code>config interface &#039;wwan&#039;
    option proto &#039;3g&#039;
    option service &#039;umts_only&#039;
    option apn &#039;portalmmm.nl&#039;
    option pincode &#039;0000&#039;
    option username &#039;root&#039;
    option password &#039;admin&#039;
    option dialnumber &#039;*99#&#039;
    option ipv6 &#039;auto&#039;
    option device &#039;/dev/ttyUSB4&#039;</code></pre></div><p>no matter what I do, no wwan interface is showing up in the &quot;ifconfig&quot; output.</p></blockquote></div><p>I think</p><p>change /dev/ttyUSB4 to ttyUSB0. ttyUSB2 is then for additional AT communication with modem over for example minicom or gcom scripts. <br />ttyUSB1, 3 and 4 is for... I dont know :-)</p><p>Good additional package is 3ginfo yet. <a href="http://eko.one.pl/?p=openwrt-3ginfo.">http://eko.one.pl/?p=openwrt-3ginfo.</a> It add next uhttpd server on port 81 and there it shows great information about BTS etc.</p><p>For working LTE (if you have a LTE SIM) it is needed some changes in sources. (I did these changes and LTE is working for me)</p><p>If you have LUCI installed (u have)</p><p>in /usr/lib/lua/luci/model/cbi/admin_network/proto_3g.lua </p><p>27c27,28<br />&lt; service:value(&quot;umts&quot;, &quot;UMTS/GPRS&quot;)<br />---<br />&gt; service:value(&quot;umts&quot;, &quot;LTE/UMTS/GPRS&quot;)<br />&gt; service:value(&quot;lte_only&quot;, translate(&quot;LTE only&quot;))</p><p>in /lib/netifd/proto/3g.sh</p><p>64,66c61,64<br />&lt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;umts_only) CODE=&quot;14,2&quot;;;<br />&lt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;gprs_only) CODE=&quot;13,1&quot;;;<br />&lt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*) CODE=&quot;2,2&quot;;;<br />---<br />&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lte_only) CODE=&quot;03&quot;;;<br />&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;umts_only) CODE=&quot;02&quot;;;<br />&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;gprs_only) CODE=&quot;01&quot;;;<br />&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*) CODE=&quot;00&quot;;;<br />68c66<br />&lt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;export MODE=&quot;AT^SYSCFG=${CODE},3FFFFFFF,2,4&quot;<br />---<br />&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;export MODE=&quot;AT^SYSCFGEX=\&quot;$CODE\&quot;,3FFFFFFF,1,2,7FFFFFFFFFFFFFFF,,&quot;</p>											<p class="post-edited">(Last edited by <strong>milankocvara</strong> on 16 Nov 2016, 09:08)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p343872">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">augustus_meyer</div>
					<div class="post-datetime">
						16 Nov 2016, 14:32					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>milankocvara wrote:</cite><blockquote><p>For working LTE (if you have a LTE SIM) it is needed some changes in sources. (I did these changes and LTE is working for me)</p></blockquote></div><p>How fast is LTE for you, as you use serial driver ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p343884">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">milankocvara</div>
					<div class="post-datetime">
						16 Nov 2016, 15:39					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>augustus_meyer wrote:</cite><blockquote><div class="quotebox"><cite>milankocvara wrote:</cite><blockquote><p>For working LTE (if you have a LTE SIM) it is needed some changes in sources. (I did these changes and LTE is working for me)</p></blockquote></div><p>How fast is LTE for you, as you use serial driver ?</p></blockquote></div><p>About 25 - 30Mbit in range of good connected BTS. I dont need much more, so over the other interface I didnt tested yet (QMI?).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p343932">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">augustus_meyer</div>
					<div class="post-datetime">
						16 Nov 2016, 22:40					</div>
				</div>
				<div class="post-content content">
					<p>Wow, that would be good enough for me, too. <br />I have a special router supplier in China,<br />and they told me, Huawei does not support QMI.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p343933">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">obsy</div>
					<div class="post-datetime">
						16 Nov 2016, 22:45					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>augustus_meyer wrote:</cite><blockquote><p>Wow, that would be good enough for me, too. <br />I have a special router supplier in China,<br />and they told me, Huawei does not support QMI.</p></blockquote></div><p>But NCM should.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p343938">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">MartijnW</div>
					<div class="post-datetime">
						16 Nov 2016, 23:23					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><blockquote><p>I think<br />change /dev/ttyUSB4 to ttyUSB0. ttyUSB2 is then for additional AT communication with modem over for example minicom or gcom scripts. <br />ttyUSB1, 3 and 4 is for... I dont know :-)<br />Good additional package is 3ginfo yet. <a href="http://h%20t%20t%20p://eko.one.pl/?p=openwrt-3ginfo.">h t t p://eko.one.pl/?p=openwrt-3ginfo.</a> It add next u h t t p d server on port 81 and there it shows great information about BTS etc.<br />For working LTE (if you have a LTE SIM) it is needed some changes in sources. (I did these changes and LTE is working for me)<br />If you have LUCI installed (u have)<br />in /usr/lib/lua/luci/model/cbi/admin_network/proto_3g.lua<br />27c27,28<br />&lt; service:value(&quot;umts&quot;, &quot;UMTS/GPRS&quot;)<br />---<br />&gt; service:value(&quot;umts&quot;, &quot;LTE/UMTS/GPRS&quot;)<br />&gt; service:value(&quot;lte_only&quot;, translate(&quot;LTE only&quot;))<br />in /lib/netifd/proto/3g.sh<br />64,66c61,64<br />&lt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;umts_only) CODE=&quot;14,2&quot;;;<br />&lt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;gprs_only) CODE=&quot;13,1&quot;;;<br />&lt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*) CODE=&quot;2,2&quot;;;<br />---<br />&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lte_only) CODE=&quot;03&quot;;;<br />&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;umts_only) CODE=&quot;02&quot;;;<br />&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;gprs_only) CODE=&quot;01&quot;;;<br />&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*) CODE=&quot;00&quot;;;<br />68c66<br />&lt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;export MODE=&quot;AT^SYSCFG=${CODE},3FFFFFFF,2,4&quot;<br />---<br />&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;export MODE=&quot;AT^SYSCFGEX=\&quot;$CODE\&quot;,3FFFFFFF,1,2,7FFFFFFFFFFFFFFF,,&quot;</p></blockquote></div><p>I can confirm that the changes Milankocvara suggested, resulted in adding the &quot;LTE&quot; option in LUCI.<br />@ Milankocvara: Thanks for that!<br />I will check out the 3ginfo package you&#039;ve suggested as it looks very useful.</p><p>my progress so far:<br />after changing the proto_3g.lua and 3g.sh I was able to configure the modem using LUCI.<br />this resulted in the following in /ect/config/network file<br /></p><div class="codebox"><pre><code> config interface &#039;WWAN&#039;
    option proto &#039;3g&#039;
    option device &#039;/dev/ttyUSB0&#039;
    option ipv6 &#039;auto&#039;
    option apn &#039;fastinternet&#039;
    option dialnumber &#039;*99#&#039;
    option username &#039;usr&#039;
    option password &#039;pwd&#039;
    option service &#039;lte_only&#039;</code></pre></div><p>looking at the log which is showing a lot of AT like entries:</p><div class="codebox"><pre><code>Wed Nov 16 20:55:14 2016 daemon.notice netifd: Interface &#039;WWAN&#039; is setting up now
Wed Nov 16 20:55:16 2016 daemon.notice netifd: WWAN (29130): Trying to set mode
Wed Nov 16 20:55:17 2016 daemon.notice pppd[29153]: pppd 2.4.7 started by root, uid 0
Wed Nov 16 20:55:18 2016 local2.info chat[29155]: abort on (BUSY)
Wed Nov 16 20:55:18 2016 local2.info chat[29155]: abort on (NO CARRIER)
Wed Nov 16 20:55:18 2016 local2.info chat[29155]: abort on (ERROR)
Wed Nov 16 20:55:18 2016 local2.info chat[29155]: report (CONNECT)
Wed Nov 16 20:55:18 2016 local2.info chat[29155]: timeout set to 10 seconds
Wed Nov 16 20:55:18 2016 local2.info chat[29155]: send (AT&amp;F^M)
Wed Nov 16 20:55:18 2016 local2.info chat[29155]: expect (OK)
Wed Nov 16 20:55:19 2016 local2.info chat[29155]: AT&amp;F^M^M
Wed Nov 16 20:55:19 2016 local2.info chat[29155]: OK
Wed Nov 16 20:55:19 2016 local2.info chat[29155]:  -- got it
Wed Nov 16 20:55:19 2016 local2.info chat[29155]: send (ATE1^M)
Wed Nov 16 20:55:19 2016 local2.info chat[29155]: expect (OK)
Wed Nov 16 20:55:19 2016 local2.info chat[29155]: ^M
Wed Nov 16 20:55:19 2016 local2.info chat[29155]: ATE1^M^M
Wed Nov 16 20:55:19 2016 local2.info chat[29155]: OK
Wed Nov 16 20:55:19 2016 local2.info chat[29155]:  -- got it
Wed Nov 16 20:55:19 2016 local2.info chat[29155]: send (AT+CGDCONT=1,&quot;IP&quot;,&quot;fastinternet&quot;^M)
Wed Nov 16 20:55:19 2016 local2.info chat[29155]: timeout set to 30 seconds
Wed Nov 16 20:55:19 2016 local2.info chat[29155]: expect (OK)
Wed Nov 16 20:55:19 2016 local2.info chat[29155]: ^M
Wed Nov 16 20:55:19 2016 local2.info chat[29155]: AT+CGDCONT=1,&quot;IP&quot;,&quot;fastinternet&quot;^M^M
Wed Nov 16 20:55:19 2016 local2.info chat[29155]: OK
Wed Nov 16 20:55:19 2016 local2.info chat[29155]:  -- got it
Wed Nov 16 20:55:19 2016 local2.info chat[29155]: send (ATD*99#^M)
Wed Nov 16 20:55:19 2016 local2.info chat[29155]: expect (CONNECT)
Wed Nov 16 20:55:19 2016 local2.info chat[29155]: ^M
Wed Nov 16 20:55:19 2016 local2.info chat[29155]: ATD*99#^M^M
Wed Nov 16 20:55:19 2016 local2.info chat[29155]: +CME ERROR
Wed Nov 16 20:55:19 2016 local2.info chat[29155]:  -- failed
Wed Nov 16 20:55:19 2016 local2.info chat[29155]: Failed (ERROR)
Wed Nov 16 20:55:19 2016 daemon.err pppd[29153]: Connect script failed
Wed Nov 16 20:55:20 2016 daemon.info pppd[29153]: Exit.
Wed Nov 16 20:55:20 2016 daemon.notice netifd: Interface &#039;WWAN&#039; is now down</code></pre></div><p>setting the SIM pincode (also via LUCI) results in the following log message:</p><div class="codebox"><pre><code>Wed Nov 16 20:55:20 2016 daemon.notice netifd: Interface &#039;WWAN&#039; is setting up now
Wed Nov 16 20:55:26 2016 daemon.notice netifd: WWAN (29189): Error setting PIN, check card manually
Wed Nov 16 20:55:26 2016 daemon.notice netifd: Interface &#039;WWAN&#039; is now down</code></pre></div><p>I will have to recheck correct SIM functionality again on my reference setup which is available on friday.<br />Not yet the result I hoped for but at least I&#039;m now able to set LTE mode via LUCI and verified AT communication with the modem.</p><p>I will do some more tinkering on friday and will revert the actions and their results.</p>											<p class="post-edited">(Last edited by <strong>MartijnW</strong> on 16 Nov 2016, 23:27)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p344111">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">MartijnW</div>
					<div class="post-datetime">
						18 Nov 2016, 22:55					</div>
				</div>
				<div class="post-content content">
					<p>Victory!<br />The LTE-modem is working now. Turns out that the SIM-slot on APU2 is only connected to mPCIe slot 2 (J13). Swapping the modem to slot 2 solved the issue for me. </p><p>so basically:<br />- installed kmod-usb-serial-option<br />- followed milankocvara&#039;s instructions to modify the scripts<br />- inserted the modem in mPCIe slot 2 (J13)<br />- added and configured the WWAN interface using LUCI<br />- Victory!</p><p>thanks for your support!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p346619">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">riodda</div>
					<div class="post-datetime">
						13 Dec 2016, 19:26					</div>
				</div>
				<div class="post-content content">
					<p>This post was a great finding for me too ! did struggle to get LTE speeds on the 909s but thanks to yuor post i suceed !! I think this changes shuld be pushed to main stream.<br />I did a further small change adding a LTE+UMTS config only:</p><div class="codebox"><pre><code>in /usr/lib/lua/luci/model/cbi/admin_network/proto_3g.lua
27c27,28,29
&lt; service:value(&quot;umts&quot;, &quot;UMTS/GPRS&quot;)
---
&gt; service:value(&quot;umts&quot;, &quot;LTE/UMTS/GPRS&quot;)
&gt; service:value(&quot;lte_umts&quot;, &quot;LTE/UMTS&quot;)
&gt; service:value(&quot;lte_only&quot;, translate(&quot;LTE only&quot;))

in /lib/netifd/proto/3g.sh
64,66c61,64
&lt;                                       umts_only) CODE=&quot;14,2&quot;;;
&lt;                                       gprs_only) CODE=&quot;13,1&quot;;;
&lt;                                       *) CODE=&quot;2,2&quot;;;
---
&gt;                                       lte_only) CODE=&quot;03&quot;;;
&gt;                                       umts_only) CODE=&quot;02&quot;;;
&gt;                                       gprs_only) CODE=&quot;01&quot;;;
&gt;                                       lte_umts) CODE=&quot;0302&quot;;;
&gt;                                       *) CODE=&quot;00&quot;;;</code></pre></div><p>all the rest is the same</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p346620">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">riodda</div>
					<div class="post-datetime">
						13 Dec 2016, 19:30					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>obsy wrote:</cite><blockquote><div class="quotebox"><cite>augustus_meyer wrote:</cite><blockquote><p>Wow, that would be good enough for me, too. <br />I have a special router supplier in China,<br />and they told me, Huawei does not support QMI.</p></blockquote></div><p>But NCM should.</p></blockquote></div><p>I can only make it working in ndis mode, but for that you to configure the interface usb0 (cdc_ether) as dhcp and invoke this commans on the ttyUSB0<br />For mine ME909s-120 no way to have the NCM driver recognizing it.</p><br /><div class="codebox"><pre><code>AT+CPIN=XYZK
AT+COPS=0
AT^SYSCFGEX=&quot;0302&quot;,3FFFFFFF,1,2,7FFFFFFFFFFFFFFF,,
AT^NDISDUP=1,1,&quot;yourapn&quot;</code></pre></div><p>the 0302 enables LTE/UMTS connection as per the AT command reference.<br />To kill the connection</p><div class="codebox"><pre><code>AT^NDISDUP=1,0</code></pre></div><p>But the way to make it working automaticcally it&#039;s quite hard for me.<br />With my provider i haven&#039;t found a big difference between the speed with cdc_ether interface and ppp.</p><p>In both cases i have 20 mbit down and 1mbit up (vodafone IT).</p>											<p class="post-edited">(Last edited by <strong>riodda</strong> on 22 Dec 2016, 10:50)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p349389">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">milankocvara</div>
					<div class="post-datetime">
						16 Jan 2017, 15:44					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><blockquote><p>This post was a great finding for me too ! did struggle to get LTE speeds on the 909s but thanks to yuor post i suceed !! I think this changes shuld be pushed to main stream.</p></blockquote></div><p>Im not sure that everything is correct</p><div class="quotebox"><blockquote><p>I did a further small change adding a LTE+UMTS config only:</p></blockquote></div><p>Are you sure, that this is working? </p><div class="quotebox"><blockquote><p>But the way to make it working automaticcally it&#039;s quite hard for me.</p></blockquote></div><p>Take a look to gcom scripts. :-)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p373112">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">skil3cyber</div>
					<div class="post-datetime">
						2 Mar 2018, 10:57					</div>
				</div>
				<div class="post-content content">
					<p>there is a manual and firmware.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>