<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> ffmpeg Based Home Surveillance</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 28 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p293052">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">AAccount</div>
					<div class="post-datetime">
						23 Sep 2015, 04:37					</div>
				</div>
				<div class="post-content content">
					<p>I want to use my webcam as a home surveillance system. I made everything on my desktop which runs fedora 22. It works just fine. The surveillance system is really simple. It&#039;s just bash script with this ffmpeg command taping 1 hour videos and re run by cron every hour</p><div class="codebox"><pre><code>    ffmpeg -t 3559 -f video4linux2 -input_format mjpeg -i /dev/video$i -c:v mpeg2video -b:v 2500k $savedir/$rec_name.mkv -vf fps=1 -updatefirst 1 $picdir/cam$i.jpg</code></pre></div><p>Not shown is how the bash script only keeps a days worth of video but that&#039;s not relevant and will make this post much longer. The way the surveillance system works is that while taping videos, it also updates a thumbnail every second. The thumbnail is stored on a ram disk. I wrote a simple php front end that takes a password and then lets you choose between the various usb web cams. When you choose a webcam a javascript just updates the thumbnail every second giving the appearance of live video. I&#039;m recording in inefficient mpeg2 because I think that&#039;s all the router can handle. (Archer c7 v2)</p><p>I wanted to test just the thumbnailing but when I run the command by hand in the terminal I get</p><div class="codebox"><pre><code>root@OpenWrt:~# ffmpeg -f video4linux2 -input_format mjpeg -i /dev/video0 -vf -fps=1 -updatefirst 1 /tmp/cam.jpg
ffmpeg version 0.11.5 Copyright (c) 2000-2014 the FFmpeg developers
  built on Sep 23 2014 08:52:59 with gcc 4.8.3
  configuration: --enable-cross-compile --cross-prefix=mips-openwrt-linux-uclibc- --arch=mips --target-os=linux --prefix=/usr --enable-shared --enable-static --disable-debug --pkg-config=pkg-config --enable-gpl --enable-version3 --disable-altivec --disable-asm --disable-doc --disable-dxva2 --enable-pthreads --disable-optimizations --enable-small --disable-stripping --enable-zlib --disable-outdevs
  libavutil      51. 54.100 / 51. 54.100
  libavcodec     54. 23.100 / 54. 23.100
  libavformat    54.  6.100 / 54.  6.100
  libavdevice    54.  0.100 / 54.  0.100
  libavfilter     2. 77.100 /  2. 77.100
  libswscale      2.  1.100 /  2.  1.100
  libswresample   0. 15.100 /  0. 15.100
  libpostproc    52.  0.100 / 52.  0.100
[video4linux2,v4l2 @ 0xb3f5d0] Buffer len [0] = 213333 != 307200
/dev/video0: Operation not permitted
root@OpenWrt:~# ls -l /dev/video0
crw-r--r--    1 root     root       81,   0 Sep 22 21:28 /dev/video0</code></pre></div><p>I like the idea of using the router to do this because of the power consumption compared to the my pentium 4 northwood desktop I retired last year (It served me well). </p><p>Any ideas as to what&#039;s wrong with the ffmpeg command?</p><p>With all the Snowden leaks there&#039;s no way I&#039;d get a commercial home surveillance system.</p>											<p class="post-edited">(Last edited by <strong>AAccount</strong> on 23 Sep 2015, 04:38)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p293069">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">tmo26</div>
					<div class="post-datetime">
						23 Sep 2015, 08:42					</div>
				</div>
				<div class="post-content content">
					<p><a href="http://ffmpeg.gusari.org/viewforum.php?f=11">http://ffmpeg.gusari.org/viewforum.php?f=11</a></p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>