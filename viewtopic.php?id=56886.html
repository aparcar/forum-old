<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Archer C7 V2 wireless switch on/off</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 29 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p272855">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">Rampler</div>
					<div class="post-datetime">
						17 Apr 2015, 16:24					</div>
				</div>
				<div class="post-content content">
					<p>On my Archer C7 with cc&nbsp; r45474 the wireless switch on the rear of the router does not work.<br />It seems, that no Event is generated.<br />the wps/reset button is working fine.<br />Any ideas ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p272897">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">Rampler</div>
					<div class="post-datetime">
						17 Apr 2015, 21:05					</div>
				</div>
				<div class="post-content content">
					<p>Also interesting for me, is to know, if the wireless switch is working on your side.<br />Maybe i forgot to add some modules during compile ...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p272933">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">Rampler</div>
					<div class="post-datetime">
						18 Apr 2015, 11:43					</div>
				</div>
				<div class="post-content content">
					<p>Switching to &quot;on&quot; results in:<br />root@OpenWrt:~# cat /sys/kernel/debug/gpio<br />GPIOs 0-23, ath79:<br /> gpio-12&nbsp; (tp-link:blue:wlan2g ) out lo<br /> gpio-13&nbsp; (RFKILL switch&nbsp; &nbsp; &nbsp; &nbsp;) in&nbsp; lo<br /> gpio-14&nbsp; (tp-link:blue:system ) out lo<br /> gpio-15&nbsp; (tp-link:blue:qss&nbsp; &nbsp; ) out hi<br /> gpio-16&nbsp; (Reset button&nbsp; &nbsp; &nbsp; &nbsp; ) in&nbsp; hi<br /> gpio-17&nbsp; (tp-link:blue:wlan5g ) out lo<br /> gpio-18&nbsp; (tp-link:green:usb1&nbsp; ) out hi<br /> gpio-19&nbsp; (tp-link:green:usb2&nbsp; ) out hi<br /> gpio-21&nbsp; (USB2 power&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ) out hi<br /> gpio-22&nbsp; (USB1 power&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ) out hi</p><p>Switching to &quot;off&quot; results:<br />root@OpenWrt:~# cat /sys/kernel/debug/gpio<br />GPIOs 0-23, ath79:<br /> gpio-12&nbsp; (tp-link:blue:wlan2g ) out lo<br /> gpio-13&nbsp; (RFKILL switch&nbsp; &nbsp; &nbsp; &nbsp;) in&nbsp; lo<br /> gpio-14&nbsp; (tp-link:blue:system ) out lo<br /> gpio-15&nbsp; (tp-link:blue:qss&nbsp; &nbsp; ) out hi<br /> gpio-16&nbsp; (Reset button&nbsp; &nbsp; &nbsp; &nbsp; ) in&nbsp; hi<br /> gpio-17&nbsp; (tp-link:blue:wlan5g ) out lo<br /> gpio-18&nbsp; (tp-link:green:usb1&nbsp; ) out hi<br /> gpio-19&nbsp; (tp-link:green:usb2&nbsp; ) out hi<br /> gpio-21&nbsp; (USB2 power&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ) out hi<br /> gpio-22&nbsp; (USB1 power&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ) out hi</p><br /><p>There must be something wrong with gpio-13 ....</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p272943">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">ninno</div>
					<div class="post-datetime">
						18 Apr 2015, 15:08					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Rampler wrote:</cite><blockquote><p> gpio-13&nbsp; (RFKILL switch&nbsp; &nbsp; &nbsp; &nbsp;) in&nbsp; lo<br />...<br />There must be something wrong with gpio-13 ....</p></blockquote></div><p>Just tested it on mine, same result: the RFKILL stays &quot;lo&quot;.<br />Currently mine is running r44972).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p272952">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">Rampler</div>
					<div class="post-datetime">
						18 Apr 2015, 16:14					</div>
				</div>
				<div class="post-content content">
					<p>There are two open tickets for that:</p><p><a href="https://dev.openwrt.org/ticket/19503">https://dev.openwrt.org/ticket/19503</a><br />and<br /><a href="https://dev.openwrt.org/ticket/19013">https://dev.openwrt.org/ticket/19013</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p273015">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">ninno</div>
					<div class="post-datetime">
						19 Apr 2015, 10:39					</div>
				</div>
				<div class="post-content content">
					<p>I tested a bit, and on an Archer-C7 v2 GPIO13 is not connected to that switch, its GPIO23.</p><p>You can test for yourself:<br /></p><div class="codebox"><pre><code>cd /sys/class/gpio
echo 23 &gt; export
echo in &gt; gpio23/direction

...

root@ap1:/sys/class/gpio# cat gpio23/value
0
root@ap1:/sys/class/gpio# cat gpio23/value
1</code></pre></div><p><a href="https://wiki.openwrt.org/doc/devel/add.new.device#gpios">https://wiki.openwrt.org/doc/devel/add.new.device#gpios</a></p><br /><br /><p>I patched &amp; compiled a kernel for mine, and afterwards both &quot;buttons&quot; are working:<br /></p><div class="codebox"><pre><code>Sun Apr 19 09:03:50 2015 user.notice root: the button was wps and the action was pressed
Sun Apr 19 09:03:50 2015 user.notice root: the button was wps and the action was released

Sun Apr 19 09:04:32 2015 user.notice root: the button was rfkill and the action was pressed
Sun Apr 19 09:06:00 2015 user.notice root: the button was rfkill and the action was released</code></pre></div><br /><p>Patch (works for me using an Archer C7 v2, warning - could possibly break Archer C7v1 or Archer C5):<br /></p><div class="codebox"><pre><code>diff --git a/target/linux/ar71xx/files/arch/mips/ath79/mach-archer-c7.c b/target/linux/ar71xx/files/arch/mips/ath79/mach-archer-c7.c
index fc12513..d93dab2 100644
--- a/target/linux/ar71xx/files/arch/mips/ath79/mach-archer-c7.c
+++ b/target/linux/ar71xx/files/arch/mips/ath79/mach-archer-c7.c
@@ -50,7 +50,7 @@
 #define ARCHER_C7_GPIO_LED_USB1                18
 #define ARCHER_C7_GPIO_LED_USB2                19
 
-#define ARCHER_C7_GPIO_BTN_RFKILL      13
+#define ARCHER_C7_GPIO_BTN_RFKILL      23
 #define ARCHER_C7_GPIO_BTN_RESET       16
 
 #define ARCHER_C7_GPIO_USB1_POWER      22</code></pre></div><br /><p>Could someone using an Archer-C7 v1&nbsp; or Archer-C5 verify if this doesnt break anything for their routers? I assume the GPIO Pins are only changed for Archer-C7 v2 ...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p273034">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">Rampler</div>
					<div class="post-datetime">
						19 Apr 2015, 17:28					</div>
				</div>
				<div class="post-content content">
					<p>@ninno<br />Great Job... <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p><p>Unfortunetly i see no change for gpio23 on my side.<br />I suspect, i miss some modules, because i&#039;m using a custom build.</p><p>Would you please so Kind to list your installed modules:<br />root@OpenWrt:/sys/class/gpio# opkg list-installed<br />base-files - 157-r45483<br />busybox - 1.23.2-1<br />dnsmasq - 2.73rc4-2<br />dropbear - 2014.65-2<br />firewall - 2015-02-26<br />fstools - 2015-04-14-e6004000ff15d7bd32cf5663e8690fc94d7ec747<br />hostapd-common - 2015-03-25-1<br />ip6tables - 1.4.21-1<br />iptables - 1.4.21-1<br />iw - 3.17-1<br />iwinfo - 2015-03-23-40f2844fadc05f4a4de7699dbc12fee295b7057b<br />jshn - 2015-03-22-b8d9b382e39823850331edc2a92379173daf1be3<br />jsonfilter - 2014-06-19-cdc760c58077f44fc40adbbe41e1556a67c1b9a9<br />kernel - 3.18.11-1-1626a5485dd815ad757ec9d104664202<br />kmod-ath - 3.18.11+2015-03-09-3<br />kmod-ath10k - 3.18.11+2015-03-09-3<br />kmod-ath9k - 3.18.11+2015-03-09-3<br />kmod-ath9k-common - 3.18.11+2015-03-09-3<br />kmod-cfg80211 - 3.18.11+2015-03-09-3<br />kmod-crypto-aes - 3.18.11-1<br />kmod-crypto-arc4 - 3.18.11-1<br />kmod-crypto-core - 3.18.11-1<br />kmod-gpio-button-hotplug - 3.18.11-1<br />kmod-ip6tables - 3.18.11-1<br />kmod-ipt-conntrack - 3.18.11-1<br />kmod-ipt-core - 3.18.11-1<br />kmod-ipt-nat - 3.18.11-1<br />kmod-ipv6 - 3.18.11-1<br />kmod-ledtrig-usbdev - 3.18.11-1<br />kmod-lib-crc-ccitt - 3.18.11-1<br />kmod-mac80211 - 3.18.11+2015-03-09-3<br />kmod-nf-conntrack - 3.18.11-1<br />kmod-nf-conntrack6 - 3.18.11-1<br />kmod-nf-ipt - 3.18.11-1<br />kmod-nf-ipt6 - 3.18.11-1<br />kmod-nf-nat - 3.18.11-1<br />kmod-nf-nathelper - 3.18.11-1<br />kmod-nls-base - 3.18.11-1<br />kmod-ppp - 3.18.11-1<br />kmod-pppoe - 3.18.11-1<br />kmod-pppox - 3.18.11-1<br />kmod-slhc - 3.18.11-1<br />kmod-usb-core - 3.18.11-1<br />kmod-usb2 - 3.18.11-1<br />libblobmsg-json - 2015-03-22-b8d9b382e39823850331edc2a92379173daf1be3<br />libc - 0.9.33.2-1<br />libgcc - 4.8-linaro-1<br />libip4tc - 1.4.21-1<br />libip6tc - 1.4.21-1<br />libiwinfo - 2015-03-23-40f2844fadc05f4a4de7699dbc12fee295b7057b<br />libiwinfo-lua - 2015-03-23-40f2844fadc05f4a4de7699dbc12fee295b7057b<br />libjson-c - 0.12-1<br />libjson-script - 2015-03-22-b8d9b382e39823850331edc2a92379173daf1be3<br />liblua - 5.1.5-1<br />libnl-tiny - 0.1-4<br />libubox - 2015-03-22-b8d9b382e39823850331edc2a92379173daf1be3<br />libubus - 2015-01-22-2d660c519d2fcff95248da9f4fd9b37d61f9eb09<br />libubus-lua - 2015-01-22-2d660c519d2fcff95248da9f4fd9b37d61f9eb09<br />libuci - 2015-04-09.1-1<br />libuci-lua - 2015-04-09.1-1<br />libxtables - 1.4.21-1<br />lua - 5.1.5-1<br />luci - git-15.107.38351-ec09e99-1<br />luci-app-firewall - git-15.107.38351-ec09e99-1<br />luci-base - git-15.107.38351-ec09e99-1<br />luci-lib-ip - git-15.107.38351-ec09e99-1<br />luci-lib-nixio - git-15.107.38351-ec09e99-1<br />luci-mod-admin-full - git-15.107.38351-ec09e99-1<br />luci-proto-ppp - git-15.107.38351-ec09e99-1<br />luci-proto-relay - git-15.107.38351-ec09e99-1<br />luci-theme-bootstrap - git-15.107.38351-ec09e99-1<br />mtd - 20<br />netifd - 2015-04-17-944f30d3f96577464545dd35691f96b06fbcc6ab<br />odhcp6c - 2015-04-17-cc1ecd2c994d5cdf31b8184d87f8849b20b0c37c<br />odhcpd - 2015-04-14-33858d341fa7eff6e7245a2486fc42aee64c81ff<br />opkg - 9c97d5ecd795709c8584e972bfdf3aee3a5b846d-7<br />ppp - 2.4.7-5<br />ppp-mod-pppoe - 2.4.7-5<br />procd - 2015-04-10-27159f21f76b973a9fa3ec92b8fee2e390d43a43<br />relayd - 2015-03-13-2970ff60bac6b70ecb682779d5c776dc559dc0b9<br />rpcd - 2015-04-14-9a6bfa110a5f8caa10951921b63bafdbb6e97d33<br />swconfig - 10<br />uboot-envtools - 2014.10-2<br />ubox - 2015-04-02-6fbafd7d5b2835d00eb9d1684e7c6ccf907177b8<br />ubus - 2015-01-22-2d660c519d2fcff95248da9f4fd9b37d61f9eb09<br />ubusd - 2015-01-22-2d660c519d2fcff95248da9f4fd9b37d61f9eb09<br />uci - 2015-04-09.1-1<br />uhttpd - 2015-03-30-b9178b9357798ae23a5724333cc6572d14f23958<br />uhttpd-mod-ubus - 2015-03-30-b9178b9357798ae23a5724333cc6572d14f23958<br />wpad-mini - 2015-03-25-1</p><p>My hope is the kmod-input-polldev !</p><p>I think the gpio settings are identically for C5 and C7, i have read anywhere in the www that the wireless slider isn&#039;t working also for C5.</p><p>Supplement:<br />With Module kmod-input-polldev all buttons and Switches are working fine !!<br />:cool <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /> <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p>											<p class="post-edited">(Last edited by <strong>Rampler</strong> on 19 Apr 2015, 18:15)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p273037">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">Rampler</div>
					<div class="post-datetime">
						19 Apr 2015, 18:17					</div>
				</div>
				<div class="post-content content">
					<p>You are sending the patch to openwrt?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p273246">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">ninno</div>
					<div class="post-datetime">
						21 Apr 2015, 08:58					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Rampler wrote:</cite><blockquote><p>I think the gpio settings are identically for C5 and C7, i have read anywhere in the www that the wireless slider isn&#039;t working also for C5.<br />...<br />You are sending the patch to openwrt?</p></blockquote></div><p>I first would like to make sure it really doesnt break others (Archer-C5, Archer-C7 v1), so i hope someone with that models step over this topic <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /><br />Then yes...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p273553">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">zloop</div>
					<div class="post-datetime">
						23 Apr 2015, 11:34					</div>
				</div>
				<div class="post-content content">
					<p>Archer C7 v1 report:</p><p>The wireless switch seems to work with default trunk.<br />So the patch would break v1.</p><p>Only has its logic inverted:Wireless Off enables the radio</p><p>I could export the 23 gpio with direction &quot;in&quot; (because its an input and not an led i think) but I observed no change there when I toggled between states.</p>											<p class="post-edited">(Last edited by <strong>zloop</strong> on 23 Apr 2015, 11:34)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p273633">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">ninno</div>
					<div class="post-datetime">
						23 Apr 2015, 20:57					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>zloop wrote:</cite><blockquote><p>Archer C7 v1 report:<br />The wireless switch seems to work with default trunk.<br />So the patch would break v1.</p></blockquote></div><p>Hello zloop,</p><p>thanks for your test - now its getting a bit more complicated, but it surely cant be used as-is.</p><p>So currently i know:<br />Archer C7 v1: trunk working, patch would break it<br />Archer C7 v2: patch working<br />Archer C5 v1.20: patch working</p><p>Anyone using one of the WDR7500 models?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p290389">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">yatakama</div>
					<div class="post-datetime">
						3 Sep 2015, 21:37					</div>
				</div>
				<div class="post-content content">
					<p>I applied the patch to the 15.05 branch r46751 and I noticed that at boot time, regardless of the switch position, wifi is always turned on.<br />After boot, the first change in position is always interpreted as &quot;pressed&quot; and wifi is turned off. A subsequent change in position results in &quot;released&quot; and wifi is turned back on. No custom hotplug scripts are necessary for this, it works out-of-the-box.</p><p>So the logic is not &quot;inverted&quot;, it&#039;s just that the initial position is ignored.<br />I&#039;m not sure how this works on V1 but I suspect it&#039;s the same.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>