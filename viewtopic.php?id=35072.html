<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Serial data won&#039;t make any sense</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 30 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p159013">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">smacker</div>
					<div class="post-datetime">
						28 Feb 2012, 15:52					</div>
				</div>
				<div class="post-content content">
					<p>While sysupgrading something went wrong and my Buffalo WZR-HP-G300NH stuck during boot.</p><p>Then I tried to connect via serial port.<br />First tried the RS232 interface and then a serial-USB adaptor.<br />In both case, what I read from serial port when I plug the adaptor in is something like this:</p><div class="codebox"><pre><code>xaa:\0xfa+\0xaa*
\0xda\0xd4\0xb4\0xec\0xeb\0xd66\0x96\0xe9\0x9b\0xdaT\0xaa\0xba*\0xeb\0x00R\0xfb\0xfb\0xfb\0xdb6\0xdb\0xf6\0xf6\0xf6\0xf6\0xf6V\0xeaK\0xd5\0xda\0x1a\0xaa:\0xfa\0xfb\0xd4\0x1aj\0xca\0xfa+\0xfb\0x1b
\0xba\0xf4\0xcb\0xd44)j\0x1a\0x8aZ\0xf6\0x1b\0x85\0xfak\0x1aj\0xba\0xf4\0x9b
\0xaa4\0xba\0x1a\0xfb\0xfb\0xbb\0xb5\0xd4\0xe8\0xfb\0xd4\0xca\0x94\0xd4i)\0xd3k\0x1aj\0xbaT\0xf6\0x0b\0xfat\0xd4)i\0xd2\0xbb\0x14\0xfaK\0xaa\0xda4\0xaa:\0x1a\0xfb\0xcbU\0xaa\0xfa;\0xb5\0x1a\0xaa\0xf4\0xf4\0xbb\0x85\0xca\0xaaT\0xaa\0x1a\0xba\0xd4\0xba\0xd4
\0x1a
k\0x1aj\0xba4\0xbb\0xf4t\0xf4\0x9b
\0xda\0xf4\0x8b\0xaa\0xd4\0xba\0xea\0x1a\0xca\0xaa\0x1a+\0xeb\0x00</code></pre></div><p>Serial terminal settings are correct and I used the same settings before. (115200,8,N,1)</p><p>Also tried other baud rates just in case, but no luck.</p><p>Something wrong with bootloader?</p><p>Thanks in advance.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p159142">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">MBS</div>
					<div class="post-datetime">
						29 Feb 2012, 20:28					</div>
				</div>
				<div class="post-content content">
					<p>are you using the right voltage?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p159184">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">smacker</div>
					<div class="post-datetime">
						1 Mar 2012, 09:02					</div>
				</div>
				<div class="post-content content">
					<p>For rs232, the board, IC and adaptor are what I had used before to install ddwrt and then openwrt.<br />Just in case I also tried a usb-serial converter.</p><p>But in these configurations I only used the RX, TX and GND pins, not the 3.3V pin.<br />This is what I did before and succeeded. USB-serial converter also has 3 I/O as RX, TX and GND.<br />Do you think this might be a problem?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p159190">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">cornelus2009</div>
					<div class="post-datetime">
						1 Mar 2012, 11:11					</div>
				</div>
				<div class="post-content content">
					<p>try to change caracter encoding, i see those caracters with winvi , in utf-8 mode</p><p>change to ansi in hyperterminal or putty aplications</p>											<p class="post-edited">(Last edited by <strong>cornelus2009</strong> on 1 Mar 2012, 11:12)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p159230">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">smacker</div>
					<div class="post-datetime">
						1 Mar 2012, 19:10					</div>
				</div>
				<div class="post-content content">
					<p>Unfortunately changing character sets didn&#039;t work. <br />Before, I was using &quot;cutecom&quot; to get serial data but it does not support to change character encoding.<br />Changed to &quot;putty&quot; and &quot;screen&quot;.<br />Screen does not change encoding either but I set putty to translate character set to latin1.<br />It still prints some weird characters.</p><p>Might there be any problem with hardware?<br />As I said it failed during sysupgrade. There must not be any problem with hardware imho.<br />I&#039;m stuck with LAN cable since the router not working. <br />If you have any idea,&nbsp; please help me.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p160489">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">cititechs</div>
					<div class="post-datetime">
						12 Mar 2012, 04:26					</div>
				</div>
				<div class="post-content content">
					<p>By chance is it the WZR-HP-G300NH2 ? If so I noticed on new models that are shipping with sticker code A1 A0 the serial port doesnt work. I&#039;d like to figure out how to get the serial working on the WZR-HP-G300NH2&nbsp; A1 A0 models .</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p160505">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">fyi</div>
					<div class="post-datetime">
						12 Mar 2012, 08:11					</div>
				</div>
				<div class="post-content content">
					<p>Make sure the USB to serial converter being good by connecting TX to RX and test with PuTTY.</p><p>Then, connect the converter to the router.<br /></p><div class="quotebox"><blockquote><p>Pin 2&nbsp; &nbsp; GND &nbsp; &nbsp; to adapter GND<br />Pin 3&nbsp; &nbsp; TX&nbsp; &nbsp; to adapter RX<br />Pin 4&nbsp; &nbsp; RX&nbsp; &nbsp; to adapter TX</p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p160535">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">mazilo</div>
					<div class="post-datetime">
						12 Mar 2012, 13:15					</div>
				</div>
				<div class="post-content content">
					<p>I have a Nokia DKU-5 cable that emits the same problem when used on a Linux desktop computer (with minicom) and not a WinXP computer. The cable used to work on both platforms when the Linux desktop computer was running on a Linux kernel v2.4.x (under Debian 3.1). If there is a way to configure minicom to change the settings to use UTF-8 mode, I sure would like to give that a try.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p160537">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">smacker</div>
					<div class="post-datetime">
						12 Mar 2012, 13:20					</div>
				</div>
				<div class="post-content content">
					<p>WZR-HP-G300NH Rev:V1&nbsp; &nbsp;,&nbsp; &nbsp;21514WG300NH1A1 Rev:A1&nbsp; &nbsp;written on the board. And there are A0 A1 on the sticker backside. This one is one of those problematic Japanese ones. But that problem has been overcome for 2 years. And I successfully installed DDWRT and OpenWRT on this router before. This time something went wrong during sysupgrade.</p><p>First I used the same serial interface that I used before to install OpenWRT successfully. Then I tried a USB-serial adaptor.<br />And today I tried another usb-serial adaptor. It seems there is no serial output from the router anymore. </p><p>When I plug it in, first LED1 is on, then blink all the LEDs together, then LED1 and LED2 stay on permanently. Also after a couple of minutes the metal cooler becomes slightly warm.</p><p>I&#039;m afraid it&#039;s totally bricked but trying to find a way to make it live again. Because even if I buy a new router (I can&#039;t buy the same one because it&#039;s too expensive), I won&#039;t be able to use my external hard-drive which is formatted ext4. That&#039;s why I want to save this and use OpenWRT again.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p160541">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">smacker</div>
					<div class="post-datetime">
						12 Mar 2012, 13:58					</div>
				</div>
				<div class="post-content content">
					<p>Now I tried on a Win7 too. This time I used bot usb serial adaptor and rs232 together. </p><p>From router to rs232 and from rs232 to serial-usb adaptor.</p><p>Putty prints strange characters out, in this configuration. For instance;</p><p>&nbsp; &nbsp; </p><div class="codebox"><pre><code>èÿò     þäàÿÿõ…¡-àQ›
                    ýÿ
                      ¡?úü ø¸ø(ÿúþÿóèüÿÿý[eðý0*ÿÿUêÿà÷åýüÓþ
                                                           ÿõúÿÿÒÿ
                                                                  ÿøÿøóÿøêýûö&#039;ÿÿýüÿþýûëýZðý ýAÿ(ü¨Àÿª!ÿ¸à
                         ýý!5ýåýÿýÿþêýý¸ýøúCýA ÿý(ÿ&amp;þýúÿAý…ÿÿûõýÿ&#039;ÿA|à¸üÿ ü©þÿÿÿ¨úùõúõÿúýýúþ ÿ
         ÿíùàõøú?ýMÿúåþ`ý9ýÿú€ÿÿÿÿþ ÿ   ÿûÔýýqüà þüþÿ¤sýþµþøûý—úÿÿÿÿõ @ûêÿ¥ÿ_ò!üÿÿÿÿü¤ýÿÿÿÿÛxÑÃÿýú ýúÿô èªÿúýäÿþ¸ÿÿÿÿÇÿÿÿþ ÿáÿöÿþmñýàýÿúÿ ¸}ÿÿýÿÿýôäà×êýþý þüÿýøýîÿÿÿS0ÿÛúþüÿÿüá“+ÿÿþÿÿøÿ ‘ÿú•uSÿÿÿïÿâÿÿþè‹½ÿA÷üÕðÿú#ü#ûÿïàPÿÿ÷ÿEûÿ„Aýý! Dðûùÿÿ&quot;ÿúÿÿ ý9ÿÀúÿ”ÿÿÿÂúþþüýR
                      ÿè;±G»ÿüÿûøÿúúüÿ¬ýÿÛWWüÿÐÛMÿþþÿÿþÿS*ÿþÿ·ßÿ ¿ýÿÿýèEþý ýÿüþþÿýÿúýðþÿñÛü÷Aý«ýýýõÿÿü÷þøAýûÿÐ(ÿà*AÈSæðºÿüÿ[¬ýI÷3÷;ÿ(è?àýÕêöÿ¨ÿýúý‘ /ýýý„ø»êÿúÿÿÿÿÿÿÿúÿÿÿÿÿÂª[äòÿÿ{ÿþÿÿËÝOï€ÿÿ_úöüÿÿüÿâýøüôü ÿÿäÿßûÿü ÿÿÿÿöÈý+ø¨…ýýü÷ÿ •á&quot;ÿþþýÿýèÿ…ÿÿÿúÿÿøûÿþüýÿÿÿ€ÿ:ÿÿ±ÿþþüüÿýûÿüþüÿÿÿüÿþÿÿÐªQúþ_øþÿÿÿÿ½ ÿõ    üûÿÿÿÿÿÝÿÿô &quot;ôàúÿüýþ ÿáÿþÿÿýÿÿý%ßÿ°úý$_úÿÿýÿüèüÿùÿþÛÿÿþÿÿýÿÿþúÿÿýý èñ@Aþ_üJÿüÿA€tWýàšÿùþtÿÿû
                                                                            ÿÿÿÿÿþ0êúÿòÿøÿþúÿýÿüÿÿ?ýÿþÿùü³°þýùÿ¨ÿÿÿþèé ÿ•¿</code></pre></div><p>I tried changing encoding too but it just made the characters to another weird ones.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p160927">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">smacker</div>
					<div class="post-datetime">
						15 Mar 2012, 13:15					</div>
				</div>
				<div class="post-content content">
					<p>Today I tried with a brand new usb-serial converter too, but nothing comes from the router anymore.</p><p>But when I try to put something from computer to router over tftp, the transfer goes smoothly. (but I don&#039;t know what happens at the router side since I can&#039;t see anything from the serial port.) This made me think that the bootloader is alive but there is something wrong with the filesysytem. Am I wrong? </p><p>If it it so, how can I reflash the filesystem without using the serial port? I just can push the bin file to the router but that doesn&#039;t work.</p><p>Any comments please?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p167405">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">Zgembo</div>
					<div class="post-datetime">
						15 May 2012, 15:54					</div>
				</div>
				<div class="post-content content">
					<p>Seems like some models of WZR-HP-G300NH2 and its Japanese variant WZR-HP-G302H have &quot;special&quot; u-boot version. Serial is disabled in u-boot 1.08. Only blind TFTP flashing of OpenWRT will enable serial in kernel boot stage and afterwards.</p><p>Can someone please provide binary copy of WZR-HP-G300NH2 u-boot and u-boot-env 1.03 partitions? In my case these correspond to:</p><p> </p><div class="codebox"><pre><code>u-boot       - 256kB - mtdblock2
u-boot-env   -  64kB - mtdblock3</code></pre></div><p>I&#039;d like to try flashing u-boot v1.03 to one of these boards to test above mentioned theory...</p>											<p class="post-edited">(Last edited by <strong>Zgembo</strong> on 15 May 2012, 16:01)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p167642">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">cititechs</div>
					<div class="post-datetime">
						18 May 2012, 09:19					</div>
				</div>
				<div class="post-content content">
					<p>Zgembo, How do you export and import the partitions that you are looking for ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p168640">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">Zgembo</div>
					<div class="post-datetime">
						31 May 2012, 07:41					</div>
				</div>
				<div class="post-content content">
					<p>Thanks to all these nice people who provided the files. Initial findings suggest:</p><p>WZR-HP-G300NH2 A0 A1 comes with u-boot 1.03, which is unlocked<br />WZR-HP-G300NH2 A1 A0 comes with u-boot 1.08, which has disabled serial console<br />WZR-HP-G302H (Japanese variant) A1 A0 also comes with u-boot 1.08, which has disabled serial console</p><p>Also, it seems that WZR-HP-G300NH2 A1 A0 and WZR-HP-G302H A1 A0 are identical hardware, as both are shipped with dual 16MiB SIP flash ROM, with erase bock size of 64k.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p168642">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">cititechs</div>
					<div class="post-datetime">
						31 May 2012, 07:44					</div>
				</div>
				<div class="post-content content">
					<p>Zgembo, Is it possible to load u-boot 1.03 onto u-boot 1.08 essentially downgrade to get the serial console enabled ? Or this being blocked by hardware.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p168664">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">Zgembo</div>
					<div class="post-datetime">
						31 May 2012, 10:34					</div>
				</div>
				<div class="post-content content">
					<p>Now, that you had asked, this is getting interesting. I was just playing with my WZR-HP-G302H (most probably identical to WZR-HP-G300NH2 A1 A0), and there is an easy way to enable u-boot serial console, without flashing u-boot 1.03. At 1.08 u-boot checks for presence of new u-boot-env variable, &quot;force_uart&quot;, which, when set to true, enables u-boot serial console! Just tested and it worked. But, you need a way to set this variable, on OpenWrt one needs to have fw_setenv &amp; fw_printenv (package uboot-envtools), and a config file describing a flash layout at /etc/fw_env.config. Also, beware that incorrect fw_env.config when using fw_setenv may lead you to a total brick, so do this at your own risk. Also, there is a way to set u-boot variables from stock firmware and DDWrt. I am about to put some more details at WiKi.</p><p>And again, thanks for all the people that had given me a chance to look into u-boot binaries, i wouldn&#039;t be able to find out about this buffalo BS without you! Now, i wonder what is the next BS they are planning, maybe a hardware encrypted data on serial?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p168827">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">cititechs</div>
					<div class="post-datetime">
						1 Jun 2012, 20:37					</div>
				</div>
				<div class="post-content content">
					<p>Zgembo,&nbsp; I installed the uboot-envtools and I can print everything in uboot.&nbsp; But fw_setenv didn&#039;t get installed.&nbsp; Would you happen to know how to get fw_setenv installed ?<br />If I do figure out how to get fw_setenv going. You state to enable force_uart to true. Could you provide the syntax you used please.</p><p>Also I look forward to your instructions on how to do this from dd_wrt.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p168865">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">Zgembo</div>
					<div class="post-datetime">
						2 Jun 2012, 09:53					</div>
				</div>
				<div class="post-content content">
					<p>fw_setenv is actually the same binary as fw_printenv. Maybe by default a symbolic link to fw_setenv -&gt; fw_printenv is not set? There is an option somewhere in menuconfig if you compile your FW from source. You can always set it manually later on. But be 100% sue that your fw_env.config is correct before you proceed, you may end up with brick otherwise. Syntax is same one used for accept_open_rt_fmt trick...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p168907">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">cititechs</div>
					<div class="post-datetime">
						2 Jun 2012, 21:06					</div>
				</div>
				<div class="post-content content">
					<p>Zgembo, I have confirmed that this works thanks !<br />USA - WZR-HP-G300NH2<br />Sticker A1 A0</p><p>Serial Starting with 106F</p><p>My steps</p><p>1.) opkg install uboot-envtools</p><p>2.) Made changes to&nbsp; <br />vi /etc/fw_env.config</p><p>root@OpenWrt:~# vi /etc/fw_env.config<br />MTD device name Device offset&nbsp; &nbsp;Env. size&nbsp; &nbsp; &nbsp; &nbsp;Flash sector size<br />/dev/mtd0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x40000&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x10000&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x10000</p><p>3.) Created SymLink&nbsp; as mentioned in wiki -- <a href="http://wiki.openwrt.org/toh/buffalo/wzr-hp-g300h#locked.u-boot.too.short.time.tftp.window">http://wiki.openwrt.org/toh/buffalo/wzr … ftp.window</a><br />ln -sf /usr/sbin/fw_printenv /usr/sbin/fw_setenv</p><p>4.) Ran command to enable Serial Output<br />root@OpenWrt:/sbin# fw_setenv force_uart 1<br />root@OpenWrt:/sbin# fw_printenv force_uart<br />force_uart=1</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p169313">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">cititechs</div>
					<div class="post-datetime">
						7 Jun 2012, 03:44					</div>
				</div>
				<div class="post-content content">
					<p>From DD-WRT</p><p>root@DD-WRT:~# ubootenv set force_uart 1<br />root@DD-WRT:~# ubootenv list</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>