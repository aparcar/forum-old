<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Setting up OpenVPN</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 7 Apr 2018 and 19 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 2</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=65092&amp;p=2.html">2</a></li></ul></nav></div>
			
		
		
			<article class="post" id="p325727">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">dirk1312</div>
					<div class="post-datetime">
						25 May 2016, 10:47					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>I use LinkSys EA4500 router and installed OpenWrt some days ago. Now I&#039;d like to setup a OpenVPN server on the device and therefore found an introduction <a href="https://wiki.openwrt.org/doc/howto/vpn.openvpn.">https://wiki.openwrt.org/doc/howto/vpn.openvpn.</a></p><p>What I don&#039;t really get is, what this introduction really covers, as there is a hint &quot;For non-beginners or real-world tunnels&quot; to use the openvpn tutorial.</p><p>What I want to have is:<br />- the possibility to connect via the internet to my router <br />- access network devices like my rasperry pi, running in my network<br />- add different accounts with different permissions<br />- the vpn tunnel should run all requests over my router, this means, i don&#039;t want e.g. to pass through requests to the internet, but every request over my router&#039;s internet ip</p><p>Why do I not directly start with the openvpn introduction? My fear is, that there are differences in commands that are mentioned in the introduction, but perhaps cannot be executed for openwrt. In that case I&#039;m not sure if my linux knowledge is deep enough.</p><p>Perhaps you can give me some hints.</p><p>Thanks and kind regards,</p><p>Dirk</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p325734">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">khain</div>
					<div class="post-datetime">
						25 May 2016, 11:37					</div>
				</div>
				<div class="post-content content">
					<p>1) You can achieve that with opening ports on WAN, but openvpn connection is more secure.<br />2) Yes, first reason why you want to configure openvpn<br />3) What do you want to achieve? You can block some IP addresses to reach subnet behind server. <br />4) Yes, second reason why you want to configure openvpn. When you use a unsecure hotspot and connect to openvpn server, all traffic goes through tunnel so it is save to visit e.g. bank website.<br />If you want to have 2 or more users connected to vpn you have to create certificates with this guide <a href="https://openvpn.net/index.php/open-source/documentation/howto.html#pki">https://openvpn.net/index.php/open-sour … o.html#pki</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p325766">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">eduperez</div>
					<div class="post-datetime">
						25 May 2016, 14:15					</div>
				</div>
				<div class="post-content content">
					<p>What &quot;different permissions&quot; are you planning to give each user?</p><p>Other than that, I have my router configured to do exactly what you are asking; I cannot produce a complete guide, but can provide my configuration files.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p325776">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">RangerZ</div>
					<div class="post-datetime">
						25 May 2016, 15:15					</div>
				</div>
				<div class="post-content content">
					<p>There are a large number of OpenWrt\OpenVPN documents.&nbsp; Search the wiki for OpenVPN.&nbsp; <a href="https://wiki.openwrt.org/start?do=search&amp;id=openvpn">https://wiki.openwrt.org/start?do=search&amp;id=openvpn</a><br /> I like this one (right now).&nbsp; <a href="https://wiki.openwrt.org/doc/howto/openvpn-streamlined-server-setup">https://wiki.openwrt.org/doc/howto/open … rver-setup</a><br />Some are oriented to UCI, some to management via a text editor (my preference).&nbsp; I use WinSCP and edit the /etc/config/openvpn file directly.</p><p>The first decision you need to make is bridging vs routing.&nbsp; <a href="https://openvpn.net/index.php/open-source/documentation/miscellaneous/76-ethernet-bridging.html">https://openvpn.net/index.php/open-sour … dging.html</a> (TAP vs TUN)&nbsp; I use TAP, but understand that you can add some rules and gain access tot he LAN with TUN.&nbsp; </p><p>This article is also good:&nbsp; <a href="https://openvpn.net/index.php/open-source/documentation/miscellaneous/76-ethernet-bridging.html">https://openvpn.net/index.php/open-sour … dging.html</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p326078">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">dirk1312</div>
					<div class="post-datetime">
						27 May 2016, 09:18					</div>
				</div>
				<div class="post-content content">
					<p>Hi all,</p><p>thanks a lot for your responses. All are very helpful. The mentioned wiki page looks quite good. I didn&#039;t expect to be more than one documentation / howto for the openvpn installation available. Sorry for that.</p><p>The permissions I&#039;d like to give are e.g., that not all users shall be able to open luci in the browser. Some I don&#039;t want to allow to access LAN devices and only use the VPN to secure their connection when they are in a free wifi lan, e.g. So for example my parents / sister / brother could connect to my VPN when they are on vacation and ensure no one is reading their &quot;connection contents&quot;.</p><p>Thanks and kind regards,</p><p>Dirk</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p326079">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">khain</div>
					<div class="post-datetime">
						27 May 2016, 09:29					</div>
				</div>
				<div class="post-content content">
					<p>Best solution for you will be TUN interface and client-config-dir option <a href="https://openvpn.net/index.php/open-source/documentation/howto.html#control">https://openvpn.net/index.php/open-sour … ml#control</a> so you can push route to server&#039;s LAN only for user you want to and set static IP for clients, so you can block traffc from specific host to server&#039;s LAN using iptables (to be secured if someone enter route option in his openvpn client config).</p>											<p class="post-edited">(Last edited by <strong>khain</strong> on 27 May 2016, 09:30)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p326080">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">dirk1312</div>
					<div class="post-datetime">
						27 May 2016, 09:40					</div>
				</div>
				<div class="post-content content">
					<p>Hi khain,</p><p>thanks, that sounds very interessting. I&#039;ll have a look at it today in the evening.</p><p>Thanks and kind regards,</p><p>Dirk</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p326288">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">dirk1312</div>
					<div class="post-datetime">
						28 May 2016, 22:39					</div>
				</div>
				<div class="post-content content">
					<p>Hi all,</p><p>today I followed the instructions of RangerZ&#039; prefered wiki entry (<a href="https://wiki.openwrt.org/doc/howto/openvpn-streamlined-server-setup">https://wiki.openwrt.org/doc/howto/open … rver-setup</a>) until I reached the point VPN-Clients (<a href="https://wiki.openwrt.org/doc/howto/openvpn-streamlined-server-setup#vpn_clients">https://wiki.openwrt.org/doc/howto/open … pn_clients</a>).</p><p>My clients are Windows 7 and iPhone, but I don&#039;t know, how to name the XML file quoted in the description and don&#039;t understand, which files I need else. The following sentences confuse me a little bit:</p><div class="quotebox"><blockquote><p>In Windows, if the p12 certificate isn&#039;t stored in the same directory as the ovpn config file, you will need to reference the path to the p12 cert</p></blockquote></div><p>As Windows client I would use the Securepoint SSL VPN client, which I already use to connect to my companies VPN which runs also with OpenVPN on OpenWrt.</p><p>Would be very kind, if you could help me with these (temporarily) last steps.</p><p>Thanks and kind regards,</p><p>Dirk</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p326318">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">RangerZ</div>
					<div class="post-datetime">
						29 May 2016, 02:12					</div>
				</div>
				<div class="post-content content">
					<p>I did not use a p12 certificate, so not sure I can help with that, but the above basically says put the p12 in with all the other certs to make it easy.</p><p>As for IOS, I use the IOS openvpn app, and drag my cred files into the right side of the OpenVPN apps window in iTunes.&nbsp; It uploads the files during the sync process.</p><p>As for windows, I use the OpenVPN app, all the files go in:&nbsp; C:\Program Files\OpenVPN\config</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p326370">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">dirk1312</div>
					<div class="post-datetime">
						29 May 2016, 12:29					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for your fast response.</p><p>I now created an .ovpn file in addition with ca.crt, my-client.crt and my-client.key it looks not soooo bad, even if the openvpn cannot connect to the ovpn server, as a timeout occurred.</p><p>Is it possible, that the reason is<br />- that I try to connect from my LAN to the ovpn server?<br />- for me it looks, that port 1194 is not open in my firewall settings. May this be a reason?</p><p>Thanks and kind regards,</p><p>Dirk</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p326396">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">RangerZ</div>
					<div class="post-datetime">
						29 May 2016, 17:41					</div>
				</div>
				<div class="post-content content">
					<p>You can not run VPN from inside your LAN.&nbsp; You need to come in through the WAN.&nbsp; &nbsp;</p><p>I have taken an &quot;extra&quot; router and set it up in front of my main router as a &quot;fake&quot; ISP.&nbsp; Connect your main router and client to&nbsp; the LAN, of the fake ISP and freshen up your open vpn files with the IP assigned to the server.&nbsp; Connect the fake ISP WAN to the internet.</p><p>Once its working you can use <a href="http://totusoft.com/lanspeed1/">http://totusoft.com/lanspeed1/</a> to test your speed (windows) for the LAN (as opposed to internet).&nbsp; This will eliminate the isp and other factors that may impact your performance and let you measure the hardware.&nbsp; Enjoy, you will never see this speed in real life, but have a clear benchmark to gauge your hardware.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p326454">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">dirk1312</div>
					<div class="post-datetime">
						30 May 2016, 09:05					</div>
				</div>
				<div class="post-content content">
					<p>Hi RangerZ,</p><p>thanks. I tried it from my working place and the same error occurred:</p><div class="quotebox"><blockquote><p>Try to start OpenVPN connection ****************<br />Mon May 30 08:02:01 2016 OpenVPN 2.3.3 x86_64-w64-mingw32 [SSL (OpenSSL)] [LZO] [PKCS11] [IPv6] built on Apr&nbsp; 9 2014<br />Mon May 30 08:02:02 2016 Socket Buffers: R=[8192-&gt;8192] S=[64512-&gt;64512]<br />Mon May 30 08:02:02 2016 UDPv4 link local: [undef]<br />Mon May 30 08:02:02 2016 UDPv4 link remote: [AF_INET]95.208.122.125:1194<br /><span style="color: red">ERROR: TLS error! See log for detailsMon May 30 08:03:02 2016 TLS Error: TLS key negotiation failed to occur within 60 seconds (check your network connectivity)<br />Mon May 30 08:03:02 2016 TLS Error: TLS handshake failed</span><br />Mon May 30 08:03:02 2016 SIGUSR1[soft,tls-error] received, process restarting<br />Mon May 30 08:03:02 2016 Restart pause, 2 second(s)<br /><span style="color: red">DisconnectedTimeout[Maybe your cetificates are not valid. Please check if it is revoked], restart pause will be ignored! Shuting down OpenVPN ...</span></p></blockquote></div><p>Any idea what goes wrong?</p><p>Thanks and kind regards,</p><p>Dirk</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p326459">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">khain</div>
					<div class="post-datetime">
						30 May 2016, 10:36					</div>
				</div>
				<div class="post-content content">
					<p><a href="https://openvpn.net/index.php/open-source/faq/79-client/253-tls-error-tls-key-negotiation-failed-to-occur-within-60-seconds-check-your-network-connectivity.html">https://openvpn.net/index.php/open-sour … ivity.html</a></p>											<p class="post-edited">(Last edited by <strong>khain</strong> on 30 May 2016, 10:39)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p326484">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">RangerZ</div>
					<div class="post-datetime">
						30 May 2016, 18:58					</div>
				</div>
				<div class="post-content content">
					<p>I assume this is your server.&nbsp; The error refers to a log file, which you may have specified a location for in your openvpn config file.&nbsp; What does it say?&nbsp; Have you tried to connect the client?&nbsp; What does it&#039;s log say?</p><p>If khain&#039;s suggestion does not help you will need to post your files<br />OpenWrt network, firewall, and openvpn.<br />Client openvpn<br />what ever logs for both<br />remove any personal info in your config (IP, MAC, name and email where relevant)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p326854">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">dirk1312</div>
					<div class="post-datetime">
						2 Jun 2016, 12:31					</div>
				</div>
				<div class="post-content content">
					<p>Sorry for my late response. In my first test to connect from the company to my vpn, I made the mistake, that I forgot, I always unplug my router and cable modem, as they are not used, when I&#039;m not at home. Of course, in that case it couldn&#039;t work.</p><p>Today I let both plugged-in in the power socket, but it didn&#039;t work neither.</p><p>As written earlier, I guess / fear the error is, that port 1194 is not opened, even if one of the firewall rules in the tutorial are about that. I&#039;ll check this at home and will open it manually, if not yet open.</p><p>Which config files would you need to see, so I can post them tomorrow, if my test tomorrow will fail or today in the evening, if the port is already open.</p><p>Thanks and kind regards,</p><p>Dirk</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p326857">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">khain</div>
					<div class="post-datetime">
						2 Jun 2016, 12:40					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>dirk1312 wrote:</cite><blockquote><p>Which config files would you need to see...</p></blockquote></div><div class="codebox"><pre><code>/etc/config/network
/etc/config/firewall
/etc/config/openvpn</code></pre></div><p>and log from server and client, but first check if the port is opened.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p326924">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">dirk1312</div>
					<div class="post-datetime">
						2 Jun 2016, 20:39					</div>
				</div>
				<div class="post-content content">
					<p>Port seems to be open (regarding the firewall settings). My networks IP addresses are 10.50.50.x (only, because I had to configure in Firewall settings src_ip and dest_ip.</p><p><strong>/etc/config/network</strong><br /></p><div class="codebox"><pre><code>config interface &#039;loopback&#039;
    option ifname &#039;lo&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;127.0.0.1&#039;
    option netmask &#039;255.0.0.0&#039;

config globals &#039;globals&#039;
    option ula_prefix &#039;fd49:8e60:7962::/48&#039;

config interface &#039;lan&#039;
    option type &#039;bridge&#039;
    option ifname &#039;eth0&#039;
    option proto &#039;static&#039;
    option netmask &#039;255.255.255.0&#039;
    option ip6assign &#039;60&#039;
    option ipaddr &#039;10.50.50.1&#039;

config interface &#039;wan&#039;
    option ifname &#039;eth1&#039;
    option proto &#039;dhcp&#039;

config interface &#039;wan6&#039;
    option ifname &#039;eth1&#039;
    option proto &#039;dhcpv6&#039;

config switch
    option name &#039;switch0&#039;
    option reset &#039;1&#039;
    option enable_vlan &#039;1&#039;

config switch_vlan
    option device &#039;switch0&#039;
    option vlan &#039;1&#039;
    option ports &#039;0 1 2 3 5&#039;

config switch_vlan
    option device &#039;switch0&#039;
    option vlan &#039;2&#039;
    option ports &#039;4 6&#039;

config interface &#039;guest&#039;
    option type &#039;bridge&#039;
    option _orig_ifname &#039;radio0.network2 wlan1-1&#039;
    option _orig_bridge &#039;true&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;192.168.3.1&#039;
    option netmask &#039;255.255.255.0&#039;
    option gateway &#039;192.168.3.1&#039;
    option dns &#039;8.8.8.8 8.8.4.4&#039;

config interface &#039;vpn0&#039;
    option ifname &#039;tun0&#039;
    option proto &#039;none&#039;</code></pre></div><p><strong>/etc/config/firewall</strong><br /></p><div class="codebox"><pre><code>config rule
    option target &#039;ACCEPT&#039;
    option proto &#039;tcp udp&#039;
    option family &#039;ipv4&#039;
    option src &#039;*&#039;
    option dest_port &#039;1194&#039;
    option name &#039;Allow Inbound VPN0&#039;

config rule
    option target &#039;ACCEPT&#039;
    option proto &#039;tcp udp&#039;
    option family &#039;ipv4&#039;
    option src &#039;*&#039;
    option src_ip &#039;10.1.1.0/24&#039;
    option dest_ip &#039;192.168.1.0/26&#039;
    option name &#039;Allow Inbound VPN0 Traffic to LAN&#039;

config rule
    option target &#039;ACCEPT&#039;
    option proto &#039;tcp udp&#039;
    option family &#039;ipv4&#039;
    option src &#039;*&#039;
    option src_ip &#039;10.1.1.0/24&#039;
    option dest &#039;*&#039;
    option dest_ip &#039;192.168.1.0/26&#039;
    option name &#039;Allow Forwarded VPN0 Traffic to LAN&#039;

config rule
    option target &#039;ACCEPT&#039;
    option proto &#039;icmp&#039;
    option src_ip &#039;10.1.1.0/24&#039;
    option src &#039;*&#039;
    option dest &#039;lan&#039;
    option name &#039;Allow Inbound ICMP Traffic from VPN0 to LAN&#039;

config rule
    option target &#039;ACCEPT&#039;
    option proto &#039;icmp&#039;
    option src &#039;*&#039;
    option src_ip &#039;10.1.1.0/24&#039;
    option dest &#039;wan&#039;
    option name &#039;Allow Outbound ICMP Echo Request (8) from VPN0&#039;
    list icmp_type &#039;echo-request&#039;

config defaults
    option syn_flood &#039;1&#039;
    option input &#039;ACCEPT&#039;
    option output &#039;ACCEPT&#039;
    option drop_invalid &#039;1&#039;
    option forward &#039;DROP&#039;

config zone
    option name &#039;lan&#039;
    option input &#039;ACCEPT&#039;
    option output &#039;ACCEPT&#039;
    option network &#039;lan&#039;
    option forward &#039;DROP&#039;

config zone
    option name &#039;vpn&#039;
    option input &#039;ACCEPT&#039;
    option forward &#039;ACCEPT&#039;
    option output &#039;ACCEPT&#039;
    option network &#039;vpn0&#039;
    option family &#039;ipv4&#039;

config zone
    option name &#039;wan&#039;
    option output &#039;ACCEPT&#039;
    option masq &#039;1&#039;
    option mtu_fix &#039;1&#039;
    option network &#039;wan wan6&#039;
    option input &#039;DROP&#039;
    option forward &#039;DROP&#039;

config include
    option path &#039;/etc/firewall.user&#039;

config forwarding
    option dest &#039;wan&#039;
    option src &#039;lan&#039;

config forwarding
    option dest &#039;lan&#039;
    option src &#039;vpn&#039;

config forwarding
    option dest &#039;vpn&#039;
    option src &#039;lan&#039;

config defaults
    option syn_flood &#039;1&#039;
    option input &#039;ACCEPT&#039;
    option output &#039;ACCEPT&#039;
    option forward &#039;REJECT&#039;

config zone
    option name &#039;lan&#039;
    option input &#039;ACCEPT&#039;
    option output &#039;ACCEPT&#039;
    option forward &#039;ACCEPT&#039;
    option network &#039;lan&#039;

config zone
    option name &#039;wan&#039;
    option input &#039;REJECT&#039;
    option output &#039;ACCEPT&#039;
    option forward &#039;REJECT&#039;
    option masq &#039;1&#039;
    option mtu_fix &#039;1&#039;
    option network &#039;wan wan6&#039;

config forwarding
    option src &#039;lan&#039;
    option dest &#039;wan&#039;

config rule
    option name &#039;Allow-DHCP-Renew&#039;
    option src &#039;wan&#039;
    option proto &#039;udp&#039;
    option dest_port &#039;68&#039;
    option target &#039;ACCEPT&#039;
    option family &#039;ipv4&#039;

config rule
    option name &#039;Allow-Ping&#039;
    option src &#039;wan&#039;
    option proto &#039;icmp&#039;
    option icmp_type &#039;echo-request&#039;
    option family &#039;ipv4&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-IGMP&#039;
    option src &#039;wan&#039;
    option proto &#039;igmp&#039;
    option family &#039;ipv4&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-DHCPv6&#039;
    option src &#039;wan&#039;
    option proto &#039;udp&#039;
    option src_ip &#039;fc00::/6&#039;
    option dest_ip &#039;fc00::/6&#039;
    option dest_port &#039;546&#039;
    option family &#039;ipv6&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-MLD&#039;
    option src &#039;wan&#039;
    option proto &#039;icmp&#039;
    option src_ip &#039;fe80::/10&#039;
    list icmp_type &#039;130/0&#039;
    list icmp_type &#039;131/0&#039;
    list icmp_type &#039;132/0&#039;
    list icmp_type &#039;143/0&#039;
    option family &#039;ipv6&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-ICMPv6-Input&#039;
    option src &#039;wan&#039;
    option proto &#039;icmp&#039;
    list icmp_type &#039;echo-request&#039;
    list icmp_type &#039;echo-reply&#039;
    list icmp_type &#039;destination-unreachable&#039;
    list icmp_type &#039;packet-too-big&#039;
    list icmp_type &#039;time-exceeded&#039;
    list icmp_type &#039;bad-header&#039;
    list icmp_type &#039;unknown-header-type&#039;
    list icmp_type &#039;router-solicitation&#039;
    list icmp_type &#039;neighbour-solicitation&#039;
    list icmp_type &#039;router-advertisement&#039;
    list icmp_type &#039;neighbour-advertisement&#039;
    option limit &#039;1000/sec&#039;
    option family &#039;ipv6&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-ICMPv6-Forward&#039;
    option src &#039;wan&#039;
    option dest &#039;*&#039;
    option proto &#039;icmp&#039;
    list icmp_type &#039;echo-request&#039;
    list icmp_type &#039;echo-reply&#039;
    list icmp_type &#039;destination-unreachable&#039;
    list icmp_type &#039;packet-too-big&#039;
    list icmp_type &#039;time-exceeded&#039;
    list icmp_type &#039;bad-header&#039;
    list icmp_type &#039;unknown-header-type&#039;
    option limit &#039;1000/sec&#039;
    option family &#039;ipv6&#039;
    option target &#039;ACCEPT&#039;

config include
    option path &#039;/etc/firewall.user&#039;

config rule
    option src &#039;wan&#039;
    option dest &#039;lan&#039;
    option proto &#039;esp&#039;
    option target &#039;ACCEPT&#039;

config rule
    option src &#039;wan&#039;
    option dest &#039;lan&#039;
    option dest_port &#039;500&#039;
    option proto &#039;udp&#039;
    option target &#039;ACCEPT&#039;

config zone
    option name &#039;guest&#039;
    option input &#039;ACCEPT&#039;
    option forward &#039;REJECT&#039;
    option output &#039;ACCEPT&#039;
    option network &#039;guest&#039;
    option masq &#039;1&#039;

config rule
    option target &#039;ACCEPT&#039;
    option proto &#039;tcp udp&#039;
    option dest_port &#039;53&#039;
    option name &#039;Guest DNS&#039;
    option src &#039;guest&#039;

config rule
    option target &#039;ACCEPT&#039;
    option proto &#039;udp&#039;
    option dest_port &#039;67-68&#039;
    option name &#039;Guest DHCP&#039;
    option src &#039;guest&#039;

config zone
    option name &#039;vpn&#039;
    option input &#039;ACCEPT&#039;
    option forward &#039;ACCEPT&#039;
    option output &#039;ACCEPT&#039;
    option network &#039;vpn0&#039;

config forwarding
    option src &#039;vpn&#039;
    option dest &#039;lan&#039;

config forwarding
    option src &#039;lan&#039;
    option dest &#039;vpn&#039;

config forwarding
    option dest &#039;lan&#039;
    option src &#039;guest&#039;

config redirect
    option target &#039;SNAT&#039;
    option src &#039;guest&#039;
    option dest &#039;lan&#039;
    option proto &#039;all&#039;
    option src_dip &#039;10.50.50.1&#039;
    option name &#039;allow-guest-INTERNET&#039;
    option enabled &#039;0&#039;

config rule
    option src &#039;guest&#039;
    option dest &#039;lan&#039;
    option name &#039;reject-guest-any-lan&#039;
    option proto &#039;all&#039;
    option target &#039;REJECT&#039;
    option enabled &#039;0&#039;</code></pre></div><p><strong>/etc/config/openvpn</strong><br /></p><div class="codebox"><pre><code>config openvpn &#039;VPNserver&#039;
 
        option enabled     &#039;1&#039;
 
    # --- Protocol ---#
        option dev         &#039;tun&#039;
        option dev         &#039;tun0&#039;
        option topology    &#039;subnet&#039;
        option proto       &#039;udp&#039;
        option port        &#039;1194&#039;
 
    #--- Routes ---#
        option server    &#039;10.1.1.0 255.255.255.0&#039;
        option ifconfig  &#039;10.1.1.1 255.255.255.0&#039;
 
    #--- Client Config ---#
#       option ccd_exclusive           &#039;1&#039;
#       option ifconfig_pool_persist   &#039;/etc/openvpn/clients/ipp.txt&#039;
#       option client_config_dir       &#039;/etc/openvpn/clients/&#039;
 
    #--- Pushed Routes ---#
        list push    &#039;route 192.168.1.0 255.255.255.0&#039;
        list push    &#039;dhcp-option DNS 192.168.1.1&#039;
        list push    &#039;dhcp-option WINS 192.168.1.1&#039;
        list push    &#039;dhcp-option DNS 8.8.8.8&#039;
        list push    &#039;dhcp-option DNS 8.8.4.4&#039;
        list push    &#039;dhcp-option NTP 129.6.15.30&#039;
 
    #--- Encryption ---#
        option cipher     &#039;AES-256-CBC&#039;
        option dh         &#039;/etc/openvpn/keys/dh2048.pem&#039;
        option pkcs12     &#039;/etc/openvpn/keys/my-server.p12&#039;
        option tls_auth   &#039;/etc/openvpn/keys/ta.key 0&#039;
 
    #--- Logging ---#
        option log           &#039;/tmp/openvpn.log&#039;
        option status        &#039;/tmp/openvpn-status.log&#039;
        option verb          &#039;7&#039;
 
    #--- Connection Options ---#
        option keepalive        &#039;10 120&#039;
        option comp_lzo         &#039;yes&#039;
 
    #--- Connection Reliability ---#
        option client_to_client &#039;1&#039;
        option persist_key      &#039;1&#039;
        option persist_tun      &#039;1&#039;
 
    #--- Connection Speed ---#    
        option sndbuf            &#039;393216&#039;
        option rcvbuf            &#039;393216&#039;
        option fragment          &#039;0&#039;
        option mssfix            &#039;0&#039;
        option tun_mtu           &#039;24000&#039;
 
    #--- Pushed Buffers ---#
        list push    &#039;sndbuf 393216&#039;
        list push    &#039;rcvbuf 393216&#039;
 
    #--- Permissions ---#
        option user     &#039;nobody&#039;
        option group    &#039;nogroup&#039;</code></pre></div><p><strong>/etc/openvpn.log</strong><br /></p><div class="codebox"><pre><code>Thu Jun  2 19:04:56 2016 us=165289 OpenVPN 2.3.10 arm-openwrt-linux-gnu [SSL (OpenSSL)] [LZO] [EPOLL] [MH] [IPv6]
Thu Jun  2 19:04:56 2016 us=166868 library versions: OpenSSL 1.0.2h  3 May 2016, LZO 2.09
Thu Jun  2 19:04:56 2016 us=239441 Diffie-Hellman initialized with 2048 bit key
Thu Jun  2 19:04:56 2016 us=523622 Control Channel Authentication: using &#039;/etc/openvpn/keys/ta.key&#039; as a OpenVPN static key file
Thu Jun  2 19:04:56 2016 us=523841 Outgoing Control Channel Authentication: Using 160 bit message hash &#039;SHA1&#039; for HMAC authentication
Thu Jun  2 19:04:56 2016 us=523995 Incoming Control Channel Authentication: Using 160 bit message hash &#039;SHA1&#039; for HMAC authentication
Thu Jun  2 19:04:56 2016 us=524118 crypto_adjust_frame_parameters: Adjusting frame parameters for crypto by 56 bytes
Thu Jun  2 19:04:56 2016 us=524235 crypto_adjust_frame_parameters: Adjusting frame parameters for crypto by 28 bytes
Thu Jun  2 19:04:56 2016 us=525496 TLS-Auth MTU parms [ L:24058 D:1184 EF:66 EB:0 ET:0 EL:3 ]
Thu Jun  2 19:04:56 2016 us=526208 Socket Buffers: R=[163840-&gt;327680] S=[163840-&gt;327680]
Thu Jun  2 19:04:56 2016 us=541231 TUN/TAP device tun0 opened
Thu Jun  2 19:04:56 2016 us=541447 TUN/TAP TX queue length set to 100
Thu Jun  2 19:04:56 2016 us=541604 do_ifconfig, tt-&gt;ipv6=0, tt-&gt;did_ifconfig_ipv6_setup=0
Thu Jun  2 19:04:56 2016 us=541833 /sbin/ifconfig tun0 10.1.1.1 netmask 255.255.255.0 mtu 24000 broadcast 10.1.1.255
Thu Jun  2 19:04:56 2016 us=567508 Data Channel MTU parms [ L:24058 D:24058 EF:58 EB:143 ET:0 EL:3 AF:3/1 ]
Thu Jun  2 19:04:56 2016 us=567822 GID set to nogroup
Thu Jun  2 19:04:56 2016 us=567970 UID set to nobody
Thu Jun  2 19:04:56 2016 us=568102 UDPv4 link local (bound): [undef]
Thu Jun  2 19:04:56 2016 us=568222 UDPv4 link remote: [undef]
Thu Jun  2 19:04:56 2016 us=568879 MULTI: multi_init called, r=256 v=256
Thu Jun  2 19:04:56 2016 us=569666 IFCONFIG POOL: base=10.1.1.2 size=252, ipv6=0
Thu Jun  2 19:04:56 2016 us=571047 Initialization Sequence Completed</code></pre></div><p><strong>/etc/openvpn-status.log</strong><br /></p><div class="codebox"><pre><code>OpenVPN CLIENT LIST
Updated,Thu Jun  2 19:35:02 2016
Common Name,Real Address,Bytes Received,Bytes Sent,Connected Since
ROUTING TABLE
Virtual Address,Common Name,Real Address,Last Ref
GLOBAL STATS
Max bcast/mcast queue length,0
END</code></pre></div><p>Additional info: The tutorial&#039;s command<br /></p><div class="codebox"><pre><code>build-key-server my-server
 
#--- Converts Server certificate to a PKCS12 certificate (DO NOT set a password for THIS SPECIFIC certificate) ---#
openssl pkcs12 -export -in keys/my-server.crt -inkey keys/my-server.key -certfile keys/ca.crt -name My-Server -out keys/my-server.p12 ; chmod 0600 keys/my-server.p12
 </code></pre></div><p>was adjusted to run as</p><div class="codebox"><pre><code>build-key-server my-server
 
#--- Converts Server certificate to a PKCS12 certificate (DO NOT set a password for THIS SPECIFIC certificate) ---#
openssl pkcs12 -export -in keys/my-server.crt -inkey keys/my-server.key -certfile keys/ca.crt -name [b][color=red]MY_LAST_NAME[/color][/b] -out keys/my-server.p12 ; chmod 0600 keys/my-server.p12
 </code></pre></div><p>No clue, if that&#039;s a problem. For one of the steps being asked to set a password, I set one, but when I try to connect via VPN, I&#039;m not asked to enter a password.</p><p>Thanks and kind regards,</p><p>Dirk</p>											<p class="post-edited">(Last edited by <strong>dirk1312</strong> on 2 Jun 2016, 20:39)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p326934">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">RangerZ</div>
					<div class="post-datetime">
						2 Jun 2016, 21:58					</div>
				</div>
				<div class="post-content content">
					<p>Your OpenVPN file has two lines for option dev.&nbsp; Should only be 1, I think the tun0.</p><p>It also looks like you have duplicate zones for LAN, WAN and VPN.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p326938">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">khain</div>
					<div class="post-datetime">
						2 Jun 2016, 22:08					</div>
				</div>
				<div class="post-content content">
					<p>And most important, you didn&#039;t put path for certificates in openvpn config!<br />For static key use secret option<br />and for multi-client certificates use ca, cert and key option.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p326944">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">dirk1312</div>
					<div class="post-datetime">
						2 Jun 2016, 23:09					</div>
				</div>
				<div class="post-content content">
					<p>Thanks a lot for your responses.</p><div class="quotebox"><cite>RangerZ wrote:</cite><blockquote><p>Your OpenVPN file has two lines for option dev.&nbsp; Should only be 1, I think the tun0.</p><p>It also looks like you have duplicate zones for LAN, WAN and VPN.</p></blockquote></div><p>I commented the tun option. Both were in the tutorial I used (the one you mentioned). Not sure, what you exactly mean with the duplicate zones for LAN, WAN and VPN. In the /etc/config/network?</p><div class="quotebox"><cite>khain wrote:</cite><blockquote><p>And most important, you didn&#039;t put path for certificates in openvpn config!<br />For static key use secret option<br />and for multi-client certificates use ca, cert and key option.</p></blockquote></div><p>I changed my file /etc/config/openvpn to use the options &quot;ca&quot;, &quot;cert&quot; and &quot;key&quot; instead of &quot;dh&quot;, &quot;pkcs12&quot; and &quot;tls_auth&quot;. Please see below. Is that, what you meant? Or are there still other changes I have to do?</p><p>Do both of you perhaps think it would make more sense to restart my openvpn installation with another tutorial that supports multi-client? Perhaps one that uses LUCI and its openvpn plugin?</p><div class="codebox"><pre><code>...
    # --- Protocol ---#
#        option dev         &#039;tun&#039;
        option dev         &#039;tun0&#039;
        option topology    &#039;subnet&#039;
...
    #--- Encryption ---#
        option cipher     &#039;AES-256-CBC&#039;
        option dh         &#039;/etc/openvpn/keys/dh2048.pem&#039;
#        option pkcs12     &#039;/etc/openvpn/keys/my-server.p12&#039;
        option tls_auth   &#039;/etc/openvpn/keys/ta.key 0&#039;
        option ca         &#039;/etc/openvpn/keys/ca.crt&#039;
        option cert       &#039;/etc/openvpn/keys/my-server.crt&#039;
        option key        &#039;/etc/openvpn/keys/my-server.key&#039;
...</code></pre></div><p>I restarted my router, but can only test it tomorrow in the morning.</p><p>Thanks and kind regards,</p><p>Dirk</p>											<p class="post-edited">(Last edited by <strong>dirk1312</strong> on 2 Jun 2016, 23:25)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p326948">
				<div class="post-metadata">
					<div class="post-num">Post #21</div>
					<div class="post-author">RangerZ</div>
					<div class="post-datetime">
						3 Jun 2016, 00:36					</div>
				</div>
				<div class="post-content content">
					<p>you also need <br />&nbsp; &nbsp; &nbsp;list push&nbsp; &nbsp; &#039;redirect-gateway def1 local&#039; <br />in your openvpn file.&nbsp; I would comment out the last 3 sections of the openvpn config for now in both the server and client (speed, buffer, permissions).&nbsp; They are performance tweaks.&nbsp; Looks like you have different parameters for buffers on your server and client.&nbsp; Rationalize your&nbsp; server and client openvpn files for consistency.</p><p>Do you have your crt files in the /etc/openvpn/ folder?&nbsp; I do not think you need the ta.key file, but not sure it&#039;s a problem. pem file is still needed on the server.&nbsp; &nbsp;Not clear on your key issues.&nbsp; I find it&#039;s easier to build them on a real PC (i use windows) and then upload them.&nbsp; </p><p>Zones are in your firewall file.&nbsp; Notice how the reference wiki has rules organized into sections.&nbsp; <a href="https://wiki.openwrt.org/doc/howto/openvpn-streamlined-server-setup">https://wiki.openwrt.org/doc/howto/open … rver-setup</a></p><p>Please include full files going forward and not that they are for client or server.&nbsp; Include your client openvpn file.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p326964">
				<div class="post-metadata">
					<div class="post-num">Post #22</div>
					<div class="post-author">khain</div>
					<div class="post-datetime">
						3 Jun 2016, 09:12					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>RangerZ wrote:</cite><blockquote><p> I do not think you need the ta.key file, but not sure it&#039;s a problem.</p></blockquote></div><p>Tls-auth it&#039;s an additional authentication to all SSL/TLS handshake packets, so it is optional, but when you use it you have to set proper directions. If you have &#039;0&#039; in server conf, you need to put &#039;1&#039; in the client conf.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p327060">
				<div class="post-metadata">
					<div class="post-num">Post #23</div>
					<div class="post-author">dirk1312</div>
					<div class="post-datetime">
						3 Jun 2016, 23:16					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>RangerZ wrote:</cite><blockquote><p>you also need <br />&nbsp; &nbsp; &nbsp;list push&nbsp; &nbsp; &#039;redirect-gateway def1 local&#039; <br />in your openvpn file.&nbsp; I would comment out the last 3 sections of the openvpn config for now in both the server and client (speed, buffer, permissions).&nbsp; They are performance tweaks.&nbsp; Looks like you have different parameters for buffers on your server and client.&nbsp; Rationalize your&nbsp; server and client openvpn files for consistency.</p></blockquote></div><p>Thanks. I did so (please find current state of /etc/config/openvpn file at the end of the post).</p><div class="quotebox"><cite>RangerZ wrote:</cite><blockquote><p>Do you have your crt files in the /etc/openvpn/ folder?&nbsp; I do not think you need the ta.key file, but not sure it&#039;s a problem. pem file is still needed on the server.&nbsp; &nbsp;Not clear on your key issues.&nbsp; I find it&#039;s easier to build them on a real PC (i use windows) and then upload them.</p></blockquote></div><p>No. The files are located in /etc/openvpn/keys folder. The tls_auth option is now, after khain said it&#039;s only optional, commented. Not sure what you want to tell me with the &quot;key issues&quot;. Do you think the keys generated on the router may not be valid?</p><div class="quotebox"><cite>RangerZ wrote:</cite><blockquote><p>Zones are in your firewall file.&nbsp; Notice how the reference wiki has rules organized into sections.&nbsp; <a href="https://wiki.openwrt.org/doc/howto/openvpn-streamlined-server-setup">https://wiki.openwrt.org/doc/howto/open … rver-setup</a></p></blockquote></div><p>Thanks for that hint. I&#039;ll read it.</p><div class="codebox"><pre><code>config openvpn &#039;VPNserver&#039;
 
        option enabled     &#039;1&#039;
 
    # --- Protocol ---#
#        option dev         &#039;tun&#039;
        option dev         &#039;tun0&#039;
        option topology    &#039;subnet&#039;
        option proto       &#039;udp&#039;
        option port        &#039;1194&#039;
 
    #--- Routes ---#
        option server    &#039;10.1.1.0 255.255.255.0&#039;
        option ifconfig  &#039;10.1.1.1 255.255.255.0&#039;
 
    #--- Client Config ---#
#       option ccd_exclusive           &#039;1&#039;
#       option ifconfig_pool_persist   &#039;/etc/openvpn/clients/ipp.txt&#039;
#       option client_config_dir       &#039;/etc/openvpn/clients/&#039;
 
    #--- Pushed Routes ---#
        list push    &#039;route 192.168.1.0 255.255.255.0&#039;
        list push    &#039;dhcp-option DNS 192.168.1.1&#039;
        list push    &#039;dhcp-option WINS 192.168.1.1&#039;
        list push    &#039;dhcp-option DNS 8.8.8.8&#039;
        list push    &#039;dhcp-option DNS 8.8.4.4&#039;
        list push    &#039;dhcp-option NTP 129.6.15.30&#039;
        list push    &#039;redirect-gateway def1 local&#039; 
 
    #--- Encryption ---#
        option cipher     &#039;AES-256-CBC&#039;
        option dh         &#039;/etc/openvpn/keys/dh2048.pem&#039;
#        option pkcs12     &#039;/etc/openvpn/keys/my-server.p12&#039;
#        option tls_auth   &#039;/etc/openvpn/keys/ta.key 0&#039;
        option ca         &#039;/etc/openvpn/keys/ca.crt&#039;
        option cert       &#039;/etc/openvpn/keys/my-server.crt&#039;
        option key        &#039;/etc/openvpn/keys/my-server.key&#039;
 
    #--- Logging ---#
        option log           &#039;/tmp/openvpn.log&#039;
        option status        &#039;/tmp/openvpn-status.log&#039;
        option verb          &#039;7&#039;
 
    #--- Connection Options ---#
        option keepalive        &#039;10 120&#039;
        option comp_lzo         &#039;yes&#039;
 
    #--- Connection Reliability ---#
        option client_to_client &#039;1&#039;
        option persist_key      &#039;1&#039;
        option persist_tun      &#039;1&#039;
 
    #--- Connection Speed ---#    
#        option sndbuf            &#039;393216&#039;
#        option rcvbuf            &#039;393216&#039;
#        option fragment          &#039;0&#039;
#        option mssfix            &#039;0&#039;
#        option tun_mtu           &#039;24000&#039;
  
    #--- Pushed Buffers ---#
#        list push    &#039;sndbuf 393216&#039;
#        list push    &#039;rcvbuf 393216&#039;

    #--- Permissions ---#
#        option user     &#039;nobody&#039;
#        option group    &#039;nogroup&#039;</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p327091">
				<div class="post-metadata">
					<div class="post-num">Post #24</div>
					<div class="post-author">RangerZ</div>
					<div class="post-datetime">
						4 Jun 2016, 03:53					</div>
				</div>
				<div class="post-content content">
					<p>All i was trying to validate was that the keys were where they were suppose to be.</p><p>The above looks OK.&nbsp; What happens?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p327385">
				<div class="post-metadata">
					<div class="post-num">Post #25</div>
					<div class="post-author">dirk1312</div>
					<div class="post-datetime">
						6 Jun 2016, 10:32					</div>
				</div>
				<div class="post-content content">
					<p>Sorry for my missing response. I was on a &quot;city trip&quot;(?) over the week-end and could test it again, today.</p><p>For me it looks, now it worked. The Securepoint SSL client shows green &quot;connected&quot; state, the logs show the following (all personal data replaced with MYCITY, MYLASTNAME, MYSERVER,...):</p><div class="codebox"><pre><code>Try to start OpenVPN connection MYSERVER 
Mon Jun 06 09:19:43 2016 OpenVPN 2.3.3 x86_64-w64-mingw32 [SSL (OpenSSL)] [LZO] [PKCS11] [IPv6] built on Apr  9 2014
Mon Jun 06 09:19:43 2016 Socket Buffers: R=[8192-&gt;8192] S=[64512-&gt;64512]
Mon Jun 06 09:19:43 2016 UDPv4 link local: [undef]
Mon Jun 06 09:19:43 2016 UDPv4 link remote: [AF_INET]95.208.243.202:1194
Mon Jun 06 09:19:43 2016 TLS: Initial packet from [AF_INET]95.208.243.202:1194, sid=00a977e1 0bdc3b9f
Mon Jun 06 09:19:44 2016 VERIFY OK: depth=1, C=DE, ST=MYSTATE, L=MYCITY, O=MYLASTNAME, OU=MYLASTNAME, CN=MYLASTNAME.local, name=vpnserver, emailAddress=me@web.de
Mon Jun 06 09:19:44 2016 VERIFY OK: nsCertType=SERVER
Mon Jun 06 09:19:44 2016 VERIFY OK: depth=0, C=DE, ST=MYSTATE, L=MYCITY, O=MYLASTNAME, OU=MYLASTNAME, CN=MYLASTNAME.local, name=vpnserver, emailAddress=me@web.de
Mon Jun 06 09:19:44 2016 Data Channel Encrypt: Cipher &#039;AES-256-CBC&#039; initialized with 256 bit key
Mon Jun 06 09:19:44 2016 Data Channel Encrypt: Using 160 bit message hash &#039;SHA1&#039; for HMAC authentication
Mon Jun 06 09:19:44 2016 Data Channel Decrypt: Cipher &#039;AES-256-CBC&#039; initialized with 256 bit key
Mon Jun 06 09:19:44 2016 Data Channel Decrypt: Using 160 bit message hash &#039;SHA1&#039; for HMAC authentication
Mon Jun 06 09:19:44 2016 Control Channel: TLSv1.2, cipher TLSv1/SSLv3 DHE-RSA-AES256-GCM-SHA384, 2048 bit RSA
Mon Jun 06 09:19:44 2016 [MYSERVER.local] Peer Connection Initiated with [AF_INET]95.208.243.202:1194
Mon Jun 06 09:19:47 2016 SENT CONTROL [MYSERVER.local]: &#039;PUSH_REQUEST&#039; (status=1)
Mon Jun 06 09:19:47 2016 PUSH: Received control message: &#039;PUSH_REPLY,route 192.168.1.0 255.255.255.0,dhcp-option DNS 192.168.1.1,dhcp-option WINS 192.168.1.1,dhcp-option DNS 8.8.8.8,dhcp-option DNS 8.8.4.4,dhcp-option NTP 129.6.15.30,redirect-gateway def1 local,route-gateway 10.1.1.1,topology subnet,ping 10,ping-restart 120,ifconfig 10.1.1.2 255.255.255.0&#039;
Mon Jun 06 09:19:47 2016 OPTIONS IMPORT: timers and/or timeouts modified
Mon Jun 06 09:19:47 2016 OPTIONS IMPORT: --ifconfig/up options modified
Mon Jun 06 09:19:47 2016 OPTIONS IMPORT: route options modified
Mon Jun 06 09:19:47 2016 OPTIONS IMPORT: route-related options modified
Mon Jun 06 09:19:47 2016 OPTIONS IMPORT: --ip-win32 and/or --dhcp-option options modified
Mon Jun 06 09:19:47 2016 do_ifconfig, tt-&gt;ipv6=0, tt-&gt;did_ifconfig_ipv6_setup=0
Mon Jun 06 09:19:47 2016 open_tun, tt-&gt;ipv6=0
Mon Jun 06 09:19:47 2016 TAP-WIN32 device [LAN-Verbindung 2] opened: \\.\Global\{EE773150-51AB-4DFF-A3CA-B17D2E7BF6CF}.tap
Mon Jun 06 09:19:47 2016 TAP-Windows Driver Version 9.9 
Mon Jun 06 09:19:47 2016 Set TAP-Windows TUN subnet mode network/local/netmask = 10.1.1.0/10.1.1.2/255.255.255.0 [SUCCEEDED]
Mon Jun 06 09:19:47 2016 Notified TAP-Windows driver to set a DHCP IP/netmask of 10.1.1.2/255.255.255.0 on interface {EE773150-51AB-4DFF-A3CA-B17D2E7BF6CF} [DHCP-serv: 10.1.1.254, lease-time: 31536000]
Mon Jun 06 09:19:47 2016 Successful ARP Flush on interface [77] {EE773150-51AB-4DFF-A3CA-B17D2E7BF6CF}
Mon Jun 06 09:19:52 2016 TEST ROUTES: 2/2 succeeded len=1 ret=1 a=0 u/d=up
Mon Jun 06 09:19:52 2016 C:\Windows\system32\route.exe ADD 0.0.0.0 MASK 128.0.0.0 10.1.1.1
Mon Jun 06 09:19:52 2016 ROUTE: CreateIpForwardEntry succeeded with dwForwardMetric1=30 and dwForwardType=4
Mon Jun 06 09:19:52 2016 Route addition via IPAPI succeeded [adaptive]
Mon Jun 06 09:19:52 2016 C:\Windows\system32\route.exe ADD 128.0.0.0 MASK 128.0.0.0 10.1.1.1
Mon Jun 06 09:19:52 2016 ROUTE: CreateIpForwardEntry succeeded with dwForwardMetric1=30 and dwForwardType=4
Mon Jun 06 09:19:52 2016 Route addition via IPAPI succeeded [adaptive]
Mon Jun 06 09:19:52 2016 C:\Windows\system32\route.exe ADD 192.168.1.0 MASK 255.255.255.0 10.1.1.1
Mon Jun 06 09:19:52 2016 ROUTE: CreateIpForwardEntry succeeded with dwForwardMetric1=30 and dwForwardType=4
Mon Jun 06 09:19:52 2016 Route addition via IPAPI succeeded [adaptive]
Mon Jun 06 09:19:52 2016 Initialization Sequence Completed
Mon Jun 06 09:19:47 2016 do_ifconfig, tt-&gt;ipv6=0, tt-&gt;did_ifconfig_ipv6_setup=0
Mon Jun 06 09:19:47 2016 open_tun, tt-&gt;ipv6=0
Mon Jun 06 09:19:47 2016 TAP-WIN32 device [LAN-Verbindung 2] opened: \\.\Global\{EE773150-51AB-4DFF-A3CA-B17D2E7BF6CF}.tap
Mon Jun 06 09:19:47 2016 TAP-Windows Driver Version 9.9 
Mon Jun 06 09:19:47 2016 Set TAP-Windows TUN subnet mode network/local/netmask = 10.1.1.0/10.1.1.2/255.255.255.0 [SUCCEEDED]
Mon Jun 06 09:19:47 2016 Notified TAP-Windows driver to set a DHCP IP/netmask of 10.1.1.2/255.255.255.0 on interface {EE773150-51AB-4DFF-A3CA-B17D2E7BF6CF} [DHCP-serv: 10.1.1.254, lease-time: 31536000]
Mon Jun 06 09:19:47 2016 Successful ARP Flush on interface [77] {EE773150-51AB-4DFF-A3CA-B17D2E7BF6CF}</code></pre></div><p>Before it worked I still had to adjust my .ovpn file to use the same cipher as the server:<br /></p><div class="codebox"><pre><code>Mon Jun 06 09:10:38 2016 WARNING: &#039;cipher&#039; is used inconsistently, local=&#039;cipher BF-CBC&#039;, remote=&#039;cipher AES-256-CBC&#039;
...
Mon Jun 06 09:11:01 2016 Authenticate/Decrypt packet error: cipher final failed</code></pre></div><p>I decided to use AES-256-CBC - or would you recommend another one? I found on the openvpn website, there are quite many. <strong>This warning does not appear any more and the connection contains no warnings / errors.</strong></p><p>Nevertheless there&#039;s At least one problem left: When I connect to my VPN server, I can neither surf in the internet, nor connect to local network devices (I tried my router&#039;s luci to connect to).</p><p>For me it looks on the one hand, the network address is out of my network scope and the standard gateway is missing (sorry, the information is in english):</p><div class="codebox"><pre><code>Ethernet-Adapter LAN-Verbindung 2:

   Verbindungsspezifisches DNS-Suffix:
   Beschreibung. . . . . . . . . . . : TAP-Windows Adapter V9
   Physikalische Adresse . . . . . . : 00-FF-EE-77-31-50
   DHCP aktiviert. . . . . . . . . . : Ja
   Autokonfiguration aktiviert . . . : Ja
   Verbindungslokale IPv6-Adresse  . : fe80::59b7:a1da:6a9c:faf3%77(Bevorzugt)
   IPv4-Adresse  . . . . . . . . . . : 10.1.1.2(Bevorzugt)
   Subnetzmaske  . . . . . . . . . . : 255.255.255.0
   Lease erhalten. . . . . . . . . . : Montag, 6. Juni 2016 09:19:53
   Lease läuft ab. . . . . . . . . . : Dienstag, 6. Juni 2017 09:19:52
   Standardgateway . . . . . . . . . :
   DHCP-Server . . . . . . . . . . . : 10.1.1.254
   DHCPv6-IAID . . . . . . . . . . . : 1291911150
   DHCPv6-Client-DUID. . . . . . . . : 00-01-00-01-1C-94-CE-94-5C-51-4F-56-26-BF

   DNS-Server  . . . . . . . . . . . : 192.168.1.1
                                       8.8.8.8
                                       8.8.4.4
   Primärer WINS-Server. . . . . . . : 192.168.1.1
   NetBIOS über TCP/IP . . . . . . . : Aktiviert</code></pre></div><p>My network address is now 10.1.1.2, the DHCP-Server address is 10.1.1.254 and the first DNS-Server is 192.168.1.1. I would expect the DHCP-Server to be my router&#039;s ip (10.50.50.1), as well as the DNS-Server?!<br />The ip address I&#039;m not sure, if it has to be something like 10.50.50.X.</p><p>Thanks and kind regards,</p><p>Dirk</p>											<p class="post-edited">(Last edited by <strong>dirk1312</strong> on 6 Jun 2016, 10:34)</p>
									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 1 of 2</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=65092&amp;p=2.html">2</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>