<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> WRT54GL and 64MB RAM upgrade: [partial] success.</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 11 Apr 2018 and 24 Apr 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 4 of 6</div><nav><ul><li><a href="viewtopic.php%3Fid=10780&amp;p=1.html">1</a></li><li><a href="viewtopic.php%3Fid=10780&amp;p=2.html">2</a></li><li><a href="viewtopic.php%3Fid=10780&amp;p=3.html">3</a></li><li class="pagination-current"><span>4</span></li><li><a href="viewtopic.php%3Fid=10780&amp;p=5.html">5</a></li><li><a href="viewtopic.php%3Fid=10780&amp;p=6.html">6</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p51366">
				<div class="post-metadata">
					<div class="post-num">Post #76</div>
					<div class="post-author">hutarios</div>
					<div class="post-datetime">
						27 Jun 2007, 17:24					</div>
				</div>
				<div class="post-content content">
					<p>You can find the right modules on a KVR400X64SC3A/512</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p51376">
				<div class="post-metadata">
					<div class="post-num">Post #77</div>
					<div class="post-author">xtrem57</div>
					<div class="post-datetime">
						27 Jun 2007, 19:45					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>hutarios wrote:</cite><blockquote><p>You can find the right modules on a KVR400X64SC3A/512</p></blockquote></div><p>For sure ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p51386">
				<div class="post-metadata">
					<div class="post-num">Post #78</div>
					<div class="post-author">nekmech</div>
					<div class="post-datetime">
						27 Jun 2007, 21:15					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>xtrem57 wrote:</cite><blockquote><div class="quotebox"><cite>hutarios wrote:</cite><blockquote><p>You can find the right modules on a KVR400X64SC3A/512</p></blockquote></div><p>For sure ?</p></blockquote></div><p>This document seems to concur</p><p><a href="http://www.valueram.com/datasheets/KVR400X64SC3A_512.pdf">http://www.valueram.com/datasheets/KVR4 … 3A_512.pdf</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p51394">
				<div class="post-metadata">
					<div class="post-num">Post #79</div>
					<div class="post-author">booBot</div>
					<div class="post-datetime">
						28 Jun 2007, 00:11					</div>
				</div>
				<div class="post-content content">
					<p>I would not bet on it, but the KVR400X<strong>64</strong>SC3A does not look like a pure coincidence.<br />However - one should consult the relevant PDF for every chip found on any double-sided eight-chip module, just in case.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p51574">
				<div class="post-metadata">
					<div class="post-num">Post #80</div>
					<div class="post-author">pzh</div>
					<div class="post-datetime">
						30 Jun 2007, 23:54					</div>
				</div>
				<div class="post-content content">
					<p>Try Jameco</p><p><a href="http://www.jameco.com/webapp/wcs/stores/servlet/ProductDisplay?langId=-1&amp;storeId=10001&amp;catalogId=10001&amp;productId=699181&amp;pa=699181PS">http://www.jameco.com/webapp/wcs/stores … a=699181PS</a></p><p>or Digikey.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p51740">
				<div class="post-metadata">
					<div class="post-num">Post #81</div>
					<div class="post-author">booBot</div>
					<div class="post-datetime">
						3 Jul 2007, 19:28					</div>
				</div>
				<div class="post-content content">
					<p><a href="http://www.megajournal.ru/journal/view_msg.php?id_user=11049&amp;id_msg=24608">Here</a> are some photos of my toolchain.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p51793">
				<div class="post-metadata">
					<div class="post-num">Post #82</div>
					<div class="post-author">hutarios</div>
					<div class="post-datetime">
						4 Jul 2007, 10:54					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>hutarios wrote:</cite><blockquote><p>You can find the right modules on a KVR400X64SC3A/512</p></blockquote></div><p>chip =&gt; 8x HYB25D512800CE-5<br />pdf =&gt; <a href="http://www.qimonda.com/download.jsp?ref=/qis_docs/Datasheets/Datasheets%20DDR/HYB25D512xxxCx_rev131_www.pdf">http://www.qimonda.com/download.jsp?ref … 31_www.pdf</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p52207">
				<div class="post-metadata">
					<div class="post-num">Post #83</div>
					<div class="post-author">freezer2k</div>
					<div class="post-datetime">
						12 Jul 2007, 09:28					</div>
				</div>
				<div class="post-content content">
					<p>i was wondering why it&#039;s possible to replace sdram chips with ddr-ram!?</p><p>I just read <a href="http://www.nslu2-linux.org/wiki/HowTo/FattenYourSlug">http://www.nslu2-linux.org/wiki/HowTo/FattenYourSlug</a></p><p>So is it possible to mod the nslu2 also with tsop-chips from ddr so-dimm modules?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p52226">
				<div class="post-metadata">
					<div class="post-num">Post #84</div>
					<div class="post-author">$@m</div>
					<div class="post-datetime">
						12 Jul 2007, 14:31					</div>
				</div>
				<div class="post-content content">
					<p>it is already DDR in fact <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p52238">
				<div class="post-metadata">
					<div class="post-num">Post #85</div>
					<div class="post-author">freezer2k</div>
					<div class="post-datetime">
						12 Jul 2007, 18:57					</div>
				</div>
				<div class="post-content content">
					<p>what do you mean?</p><p>On the first page/post is written SDRAM!&nbsp; So in many other posts...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p52288">
				<div class="post-metadata">
					<div class="post-num">Post #86</div>
					<div class="post-author">booBot</div>
					<div class="post-datetime">
						13 Jul 2007, 20:53					</div>
				</div>
				<div class="post-content content">
					<p>Reading your link makes me think that NSLU2 indeed uses the SDRAM.</p><p>SDRAMs are not interchangable with DDRs.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p52386">
				<div class="post-metadata">
					<div class="post-num">Post #87</div>
					<div class="post-author">$@m</div>
					<div class="post-datetime">
						16 Jul 2007, 11:46					</div>
				</div>
				<div class="post-content content">
					<p>on wrt, it is : DDR SDRam (the right complete name, cut to DDR, in common language)<br />maybe NSLU2 : it is just SDRam... (old ram)</p>											<p class="post-edited">(Last edited by <strong>$@m</strong> on 16 Jul 2007, 11:46)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p52976">
				<div class="post-metadata">
					<div class="post-num">Post #88</div>
					<div class="post-author">nekmech</div>
					<div class="post-datetime">
						28 Jul 2007, 12:29					</div>
				</div>
				<div class="post-content content">
					<p>Seeking advice here.<br />I bought 3 of these chips from digikey:<br /><a href="http://www.digikey.com/scripts/DkSearch/dksus.dll?Detail?name=557-1212-1-ND">http://www.digikey.com/scripts/DkSearch … -1212-1-ND</a></p><p>Tried upgrading 2 different routers. Even removed and tried again the same router.<br />Routers are WRT54GL.<br />In all cases, a no go. Routers don&#039;t boot and console is blank.</p><p>I then put back the original RAM chip on one of the routers and presto, boots fine and works as before the mod attempt.</p><p>Any ideas?</p>											<p class="post-edited">(Last edited by <strong>nekmech</strong> on 28 Jul 2007, 12:30)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p53094">
				<div class="post-metadata">
					<div class="post-num">Post #89</div>
					<div class="post-author">booBot</div>
					<div class="post-datetime">
						30 Jul 2007, 16:05					</div>
				</div>
				<div class="post-content content">
					<p>Hmmm...<br />These ICs look perfectly right - the same as I use here.</p><p>&quot;Should work&quot;.</p><p>Are you sure you did not make any mistakes soldering them? (pinning errors, short-circuits, etc)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p53097">
				<div class="post-metadata">
					<div class="post-num">Post #90</div>
					<div class="post-author">nekmech</div>
					<div class="post-datetime">
						30 Jul 2007, 16:21					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>booBot wrote:</cite><blockquote><p>Hmmm...<br />These ICs look perfectly right - the same as I use here.</p><p>&quot;Should work&quot;.</p><p>Are you sure you did not make any mistakes soldering them? (pinning errors, short-circuits, etc)</p></blockquote></div><p>Pretty sure which is why I did it 3 times.<br />I&#039;m also sure I didn&#039;t rip any pads. Even took photos of the PCB&#039;s without the RAM and zoomed on the PC to check.<br />Can&#039;t understand what I&#039;m doing wrong, especially since cleaning up the original chip and soldering it in, works.</p><p>About ready to tear my hair out..<br />You didn&#039;t do anything special apart from just removing the original and soldering in the new chip, did you?<br />I saw on the PDF that pins 19,50 are supposed to be NC.</p><p>I think I&#039;ll order some more from Jameco and try again.<br />I tried to find SODIMMS for a while but gave up on that.</p><p>Thanks booBot really just trying to confirm these were the right chips.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p53102">
				<div class="post-metadata">
					<div class="post-num">Post #91</div>
					<div class="post-author">booBot</div>
					<div class="post-datetime">
						30 Jul 2007, 16:36					</div>
				</div>
				<div class="post-content content">
					<p>All I did was to unsolder a chip off a SoDIMM, remove the excessive solder and flux off it&#039;s pins.<br />Then I used the same hot-air gun to unsolder the original chip off the PCB, cleaned the pads.</p><p>As soon as I soldered the new chip and cleaned the PCB - no extra wires or capacitors|resistors added - the device was usable (with only the 32MB, as described earlyer in this thread).</p><p>My WRT65GL is v1.0, a friend of mine brought his WRT54GL v1.1 - the same success - we both now have the 64MB RAM on our boxen.</p><p>It <strong>must</strong> because of some error, either the chips you&#039;ve bought are defective. If you could obtain the fourth chip - you probably could put them on a SoDIMM to test in a PC...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p53307">
				<div class="post-metadata">
					<div class="post-num">Post #92</div>
					<div class="post-author">jshamlet</div>
					<div class="post-datetime">
						3 Aug 2007, 03:08					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>nekmech wrote:</cite><blockquote><p>Seeking advice here.<br />I bought 3 of these chips from digikey:<br /><a href="http://www.digikey.com/scripts/DkSearch/dksus.dll?Detail?name=557-1212-1-ND">http://www.digikey.com/scripts/DkSearch … -1212-1-ND</a></p><p>Tried upgrading 2 different routers. Even removed and tried again the same router.<br />Routers are WRT54GL.<br />In all cases, a no go. Routers don&#039;t boot and console is blank.</p><p>I then put back the original RAM chip on one of the routers and presto, boots fine and works as before the mod attempt.</p><p>Any ideas?</p></blockquote></div><p>This happened to me while I was attempting a RAM upgrade on a La Fonera. The chip was new (so it hadn&#039;t been previously soldered), yet despite examining EVERY pad under a microscope, the device wouldn&#039;t boot. The original still worked fine. I also used the other two chips, from the same lot, on two more Fonera&#039;s that are working just fine. </p><p>It could have just been a bad part, or you may have inadvertently damaged it with with ESD.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p53348">
				<div class="post-metadata">
					<div class="post-num">Post #93</div>
					<div class="post-author">nekmech</div>
					<div class="post-datetime">
						3 Aug 2007, 17:34					</div>
				</div>
				<div class="post-content content">
					<p>I tried all 3 chips I bought on 2 different routers.<br />No way I can know if I damaged them all with ESD, but if the original chips work after soldering them back in, then either I&#039;m lucky the original chips didn&#039;t get damaged too, or the new parts are more susceptible to ESD damage.</p><p>Haven&#039;t given up on this upgrade yet....</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p55874">
				<div class="post-metadata">
					<div class="post-num">Post #94</div>
					<div class="post-author">dwkoeller</div>
					<div class="post-datetime">
						17 Sep 2007, 17:30					</div>
				</div>
				<div class="post-content content">
					<p>Has anyone had any luck with an elpida DD5116ADTA.&nbsp; This appears to be a 32Mb x 16 TSOP chip which I have 8 mounted on a 512MB DDR 333 laptop SO-DIMM.&nbsp; I can&#039;t seem to locate a data sheet anywhere online for this particular revision to compare it to the Micron chip mentioned in this thread.&nbsp; I did find a data sheet on a DD5116AFTA here: <a href="http://www.elpida.com/pdfs/E0699E50.pdf">http://www.elpida.com/pdfs/E0699E50.pdf</a>.&nbsp; Looks like the only difference is the revision of the chip.&nbsp; Anyone have any insight before I take the plunge and try de-soldering these chips.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p57112">
				<div class="post-metadata">
					<div class="post-num">Post #95</div>
					<div class="post-author">michelinok76</div>
					<div class="post-datetime">
						6 Oct 2007, 13:05					</div>
				</div>
				<div class="post-content content">
					<p>Got mad...<br />I would like to upgrade my WRT54GL v1.1, but couldn&#039;t understand what kind of RAM should I use.<br />I&#039;ve TONS of DIMMs and DDR, which should I use? and which SPEED??? 100Mhz,133Mhz? 233Mhz?<br />Any help is welcome!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p58491">
				<div class="post-metadata">
					<div class="post-num">Post #96</div>
					<div class="post-author">moroboshi</div>
					<div class="post-datetime">
						4 Nov 2007, 20:41					</div>
				</div>
				<div class="post-content content">
					<p>I went and got one of those Kingston Modules (KVR400X64SC3A/512) and mine has Nanya NT5DS32M16BS Chips.<br />I removed the Chips from the SODIMM using a hot air gun.&nbsp; For the GL, I had some trouble with the method from video2_tsop48.wmv and damaged some pads without actually removing the chip. <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /><br />Using thin copper wire, I bent up all pins of the old Hynix chip. I then soldered in the new Nanya chip and connected the missing pads to vias using the thin coated copper wire. The router booted up fine (with 32MB), however after changing the nvram values it doesn&#039;t boot anymore (nothing on the serial console). Looks like I&#039;ll have to make a hairydairymaid cable.&nbsp; Maybe I should have just changed sdram_init without touching sdram_ncdl. I&#039;d expect if the current timing works, the number of cas lines used shouldn&#039;t make a difference. <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /><br />At least I&#039;m pretty sure I can get it to boot again (wrote down the old nvram values), then I&#039;ll have to look if the 32MB configuration is really ok/stable and try changing sdram_ncdl again.<br />Does someone know the meaning of the ncdl bits? Might be nice to be able to tweak them manually instead of relying on the automated tweaking by the CFE...</p><p><span class="postimg"><img src="http://uguu.de/~ranma/S6001629s.jpg" alt="http://uguu.de/~ranma/S6001629s.jpg" /></span><br /><span class="postimg"><img src="http://uguu.de/~ranma/S6001634s.jpg" alt="http://uguu.de/~ranma/S6001634s.jpg" /></span></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p58576">
				<div class="post-metadata">
					<div class="post-num">Post #97</div>
					<div class="post-author">booBot</div>
					<div class="post-datetime">
						6 Nov 2007, 19:00					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m afraid, the wires that go underneath the PCB a way too long...<br />You&#039;d better try to reach these vias on the same side of the PCB as the chip sits (from the underneath of the chip itself rather than the PCB).</p>											<p class="post-edited">(Last edited by <strong>booBot</strong> on 6 Nov 2007, 19:01)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p58765">
				<div class="post-metadata">
					<div class="post-num">Post #98</div>
					<div class="post-author">moroboshi</div>
					<div class="post-datetime">
						10 Nov 2007, 19:42					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>booBot wrote:</cite><blockquote><p>I&#039;m afraid, the wires that go underneath the PCB a way too long...<br />You&#039;d better try to reach these vias on the same side of the PCB as the chip sits (from the underneath of the chip itself rather than the PCB).</p></blockquote></div><p>Well, it&#039;s booting again though.<br />Using the hairydairymaid JTAG tool I was able to erase the nvram (using the custom flash command, despite detecting a 4MB flash it wanted to read/write nvram from somewhere around 2MB). </p><p>The reason it wasn&#039;t booting anymore was a nonsense value in sdram_init (0x0519 instead of 0x0113), which didn&#039;t have the &#039;16bit interface&#039; flag set (as documented on <a href="http://wl500g.dyndns.org/sdram.html)">http://wl500g.dyndns.org/sdram.html)</a>.<br />Now I put the right value into nvram and it is detecting all 64MB of ram (despite the overly long copper to /ras and /cas and /we). I also changed sdram_config to 0x0032 (CL 3 instead of CL 2.5, as the Kingston module is supposed to be CL3 and because of the long copper wire <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" />), now I&#039;ve got to do some stability tests...</p><p>[edit]<br />Since the cache line size is 16 Bytes (according to linux boot messages) I upped sdram_config to 0x0033 (8 word burst instead of 4 word burst, should mean 16 bytes per burst I think).</p><p>I wonder how fast the memory is clocked?<br />The old hynix chip was a -J, which according to the datasheet I have means DDR333; 133MHz@CL2&nbsp; or 166MHz@CL2.5 (2.5-3-3) or 166MHz@CL3 (3-3-3)<br />And the old sdram_config value was for CL2.5.</p><p>The new Nanya chip is a -5T (DDR400); 166MHz@CL2.5 or 200MHz@CL3</p><p>I&#039;d assume the memory clock is either 100MHz or 200MHz and the latter looks rather unlikely, given the hynix specs.<br />Also, the (non-ddr) sdram memory in my WRT54GS is rated for at most 143MHz@CL3 or 100MHz@CL2. Here sdram_config is 0x0022 (burst 4, CL2).</p><p>So, the new Nanya memory is really way too fast, maybe I should lower CL back to 2.5 or even 2 and look at the longterm stability. <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /><br />OTOH that may be the reason it even works at all given the long connections to the bottom vias...<br />[/edit]</p><p>[edit2]<br />Hmm, no openwrt memtester package. But Debian memtester-2.93.1 compiles fine with make CC=mipsel-linux-uclibc-gcc.<br />Looking good so far:</p><div class="codebox"><pre><code>root@OpenWrt:~# /tmp/memtest 50M                                                
memtest v. 2.93.1                                                               
(C) 2000 Charles Cazabon &lt;memtest@discworld.dyndns.org&gt;                         
Original v.1 (C) 1999 Simon Kirby &lt;sim@stormix.com&gt; &lt;sim@neato.org&gt;             
                                                                                
Current limits:                                                                 
  RLIMIT_RSS  0x7fffffff                                                        
  RLIMIT_VMEM   0x8000                                                          
Raising limits...                                                               
Allocated 52428800 bytes...trying mlock...success.  Starting tests...           
                                                                                
Testing 52424704 bytes at 0x2abe1000 (4088 bytes lost to page alignment).       

Run    1:                                                                       
  Test  1:         Stuck Address:  Testing...Passed.                            
  Test  2:          Random value:  Setting...Testing...Passed.                  
  Test  3:        XOR comparison:  Setting...Testing...Passed.                  
  Test  4:        SUB comparison:  Setting...Testing...Passed.                  
  Test  5:        MUL comparison:  Setting...Testing...Passed.                  
  Test  6:        DIV comparison:  Setting...Testing...Passed.                  
  Test  7:         OR comparison:  Setting...Testing...Passed.                  
  Test  8:        AND comparison:  Setting...Testing...Passed.                  
  Test  9:  Sequential Increment:  Setting...Testing...Passed.                  
  Test 10:            Solid Bits:  Testing...Passed.                            
  Test 11:      Block Sequential:  Setting... 147</code></pre></div><p>[/edit2]</p>											<p class="post-edited">(Last edited by <strong>moroboshi</strong> on 10 Nov 2007, 20:57)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p58789">
				<div class="post-metadata">
					<div class="post-num">Post #99</div>
					<div class="post-author">moroboshi</div>
					<div class="post-datetime">
						11 Nov 2007, 14:01					</div>
				</div>
				<div class="post-content content">
					<p>Ok, since I was curious about the DRAM performance, I wrote a small linear read speed testing tool:</p><div class="codebox"><pre><code>#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;

#define MB 8ULL /* allocate 8MB */
#define LOOPS 32
#define SIZE (1024*1024*MB)

static int quiet = 0;

void die(char *msg)
{
    fprintf(stderr, &quot;%s\n&quot;, msg);
    exit(1);
}

void say(char *msg)
{
    if (!quiet) fprintf(stderr, &quot;%s\n&quot;, msg);
}

int main(int argc, char **argv)
{
    struct timeval tv1, tv2, tv3, tv4;
    long long t1, t2, t3, t4;
    int i, j, k;
    int *mem;

    quiet = argc &gt; 1;

    if (!quiet) fprintf(stderr, &quot;Allocating %d MB... &quot;, MB);
    mem = malloc(SIZE);
    if (mem == NULL) {
        die(&quot;malloc failed&quot;);
    } else {
        say(&quot;ok&quot;);
    }
    if (!quiet) fprintf(stderr, &quot;Renicing to -20... &quot;);
    if (nice(-20) == -1) {
        say(&quot;nice(-20) failed&quot;);
    } else {
        say(&quot;ok&quot;);
    }

    for (k=2; k&gt;0; k--) { /* loop twice, to make sure we are hot */
        gettimeofday(&amp;tv1, NULL);
        for (j=LOOPS; j&gt;0; j--) {
            /**
             * Unrolled loop for memory read bandwidth testing.
             * Using 8 registers is overkill, but doesn&#039;t hurt either.
             * 2 would probably suffice here.
             **/
            asm(&quot;.set noreorder\n&quot;
                &quot;.set nomacro\n&quot;
                &quot;move  $2, %0\n&quot;
                &quot;li    $3, %1\n&quot;
                // &quot;.align 4\n&quot; /* 2^4 == 16 */
                &quot;loop:\n&quot;
                &quot;addiu $3,$3,-32  \n&quot;
                &quot;lw $8,  0x00($2) \n&quot;
                &quot;lw $9,  0x04($2) \n&quot;
                &quot;lw $10, 0x08($2) \n&quot;
                &quot;lw $11, 0x0c($2) \n&quot;
                &quot;lw $12, 0x10($2) \n&quot;
                &quot;lw $13, 0x14($2) \n&quot;
                &quot;lw $14, 0x18($2) \n&quot;
                &quot;lw $15, 0x1c($2) \n&quot;
                &quot;lw $8,  0x20($2) \n&quot;
                &quot;lw $9,  0x24($2) \n&quot;
                &quot;lw $10, 0x28($2) \n&quot;
                &quot;lw $11, 0x2c($2) \n&quot;
                &quot;lw $12, 0x30($2) \n&quot;
                &quot;lw $13, 0x34($2) \n&quot;
                &quot;lw $14, 0x38($2) \n&quot;
                &quot;lw $15, 0x3c($2) \n&quot;
                &quot;lw $8,  0x40($2) \n&quot;
                &quot;lw $9,  0x44($2) \n&quot;
                &quot;lw $10, 0x48($2) \n&quot;
                &quot;lw $11, 0x4c($2) \n&quot;
                &quot;lw $12, 0x50($2) \n&quot;
                &quot;lw $13, 0x54($2) \n&quot;
                &quot;lw $14, 0x58($2) \n&quot;
                &quot;lw $15, 0x5c($2) \n&quot;
                &quot;lw $8,  0x60($2) \n&quot;
                &quot;lw $9,  0x64($2) \n&quot;
                &quot;lw $10, 0x68($2) \n&quot;
                &quot;lw $11, 0x6c($2) \n&quot;
                &quot;lw $12, 0x70($2) \n&quot;
                &quot;lw $13, 0x74($2) \n&quot;
                &quot;lw $14, 0x78($2) \n&quot;
                &quot;lw $15, 0x7c($2) \n&quot;
                &quot;bgtz  $3,loop    \n&quot; /* note: delayed branching */
                &quot;addiu $2,$2,128  \n&quot; /* address is incremented in delay slot of branch */
                &quot;.set macro       \n&quot;
                &quot;.set reorder     \n&quot;
                :
                : &quot;r&quot; (mem),
                  &quot;i&quot; (SIZE/sizeof(*mem))
                : &quot;$2&quot;,  &quot;$3&quot;,
                  &quot;$8&quot;,  &quot;$9&quot;,  &quot;$10&quot;, &quot;$11&quot;,
                  &quot;$12&quot;, &quot;$13&quot;, &quot;$14&quot;, &quot;$15&quot;);
        }
        gettimeofday(&amp;tv2, NULL);
    }

    t1 = tv1.tv_sec;
    t1 *= 1000000ULL;
    t1 += tv1.tv_usec;
    t2 = tv2.tv_sec;
    t2 *= 1000000ULL;
    t2 += tv2.tv_usec;

    for (k=2; k&gt;0; k--) { /* loop twice, to make sure we are hot */
        gettimeofday(&amp;tv1, NULL);
        for (j=LOOPS; j&gt;0; j--) {
            /**
             * Unrolled loop for L1 read bandwidth testing
             * Using 8 registers is overkill, but doesn&#039;t hurt either.
             * 2 would probably suffice here.
             * This is a copy of the previous loop, with the
             * address increment replaced by 0.
             **/
            asm(&quot;.set noreorder\n&quot;
                &quot;.set nomacro\n&quot;
                &quot;move  $2, %0\n&quot;
                &quot;li    $3, %1\n&quot;
                // &quot;.align 4\n&quot; /* 2^4 == 16 */
                &quot;loop2:\n&quot;
                &quot;addiu $3,$3,-32  \n&quot;
                &quot;lw $8,  0x00($2) \n&quot;
                &quot;lw $9,  0x04($2) \n&quot;
                &quot;lw $10, 0x08($2) \n&quot;
                &quot;lw $11, 0x0c($2) \n&quot;
                &quot;lw $12, 0x10($2) \n&quot;
                &quot;lw $13, 0x14($2) \n&quot;
                &quot;lw $14, 0x18($2) \n&quot;
                &quot;lw $15, 0x1c($2) \n&quot;
                &quot;lw $8,  0x20($2) \n&quot;
                &quot;lw $9,  0x24($2) \n&quot;
                &quot;lw $10, 0x28($2) \n&quot;
                &quot;lw $11, 0x2c($2) \n&quot;
                &quot;lw $12, 0x30($2) \n&quot;
                &quot;lw $13, 0x34($2) \n&quot;
                &quot;lw $14, 0x38($2) \n&quot;
                &quot;lw $15, 0x3c($2) \n&quot;
                &quot;lw $8,  0x40($2) \n&quot;
                &quot;lw $9,  0x44($2) \n&quot;
                &quot;lw $10, 0x48($2) \n&quot;
                &quot;lw $11, 0x4c($2) \n&quot;
                &quot;lw $12, 0x50($2) \n&quot;
                &quot;lw $13, 0x54($2) \n&quot;
                &quot;lw $14, 0x58($2) \n&quot;
                &quot;lw $15, 0x5c($2) \n&quot;
                &quot;lw $8,  0x60($2) \n&quot;
                &quot;lw $9,  0x64($2) \n&quot;
                &quot;lw $10, 0x68($2) \n&quot;
                &quot;lw $11, 0x6c($2) \n&quot;
                &quot;lw $12, 0x70($2) \n&quot;
                &quot;lw $13, 0x74($2) \n&quot;
                &quot;lw $14, 0x78($2) \n&quot;
                &quot;lw $15, 0x7c($2) \n&quot;
                &quot;bgtz  $3,loop2   \n&quot; /* note: delayed branching */
                &quot;addiu $2,$2,0    \n&quot; /* address is incremented in delay slot of branch */
                &quot;.set macro       \n&quot;
                &quot;.set reorder     \n&quot;
                :
                : &quot;r&quot; (mem),
                  &quot;i&quot; (SIZE/sizeof(*mem))
                : &quot;$2&quot;,  &quot;$3&quot;,
                  &quot;$8&quot;,  &quot;$9&quot;,  &quot;$10&quot;, &quot;$11&quot;,
                  &quot;$12&quot;, &quot;$13&quot;, &quot;$14&quot;, &quot;$15&quot;);
        }
        gettimeofday(&amp;tv2, NULL);
    }
    t3 = tv1.tv_sec;
    t3 *= 1000000ULL;
    t3 += tv1.tv_usec;
    t4 = tv2.tv_sec;
    t4 *= 1000000ULL;
    t4 += tv2.tv_usec;

#define ADJUST1 35 /* inner loop has 32 loads in 35 instructions */
#define ADJUST2 32 /* inner loop has 32 loads in 35 instructions */
    printf(&quot;%d loops over %dMB in %lld usecs: %lld.%02lld MB/s\n&quot;,
           (int)LOOPS, (int)MB,
           t2 - t1,
           (LOOPS*MB*1000000ULL*ADJUST1)/(t2-t1)/ADJUST2,
           ((100ULL*LOOPS*MB*1000000ULL*ADJUST1)/(t2-t1)/ADJUST2)%100ULL);
    printf(&quot;L1: %lld.%02lld MB/s\n&quot;,
           (LOOPS*MB*1000000ULL*ADJUST1)/(t4-t3)/ADJUST2,
           ((100ULL*LOOPS*MB*1000000ULL*ADJUST1)/(t4-t3)/ADJUST2)%100ULL);

    free(mem);
}</code></pre></div><p>This is the result on the WRT54GL (16bit DDR RAM):</p><div class="codebox"><pre><code>root@wrt54gl64:/# /tmp/wrtramspeed                                              
Allocating 8 MB... ok                                                           
Renicing to -20... ok                                                           
32 loops over 8MB in 383013 usecs: 731.04 MB/s                                  
L1: 759.62 MB/s</code></pre></div><p>And this is on my WRT54GS (32bit SDRAM)</p><div class="codebox"><pre><code>root@wrt54gs:~# /tmp/wrtramspeed
Allocating 8 MB... ok
Renicing to -20... ok
32 loops over 8MB in 439148 usecs: 637.59 MB/s
L1: 744.71 MB/s</code></pre></div><p>Theoretical maximum for L1 speed should be 800MB/s (200MHz times 4bytes per load instruction / 1 clock cycle per instruction).<br />This would seem to point to a ~180 MHz memory clock for the GL and a ~160 MHz memory clock for the GS (well, if the code is working as I expect, that is).<br />_If_ this is approximately correct, then memory is overclocked in both cases (Hynix DDR rated for 166MHz, ISSI SDRAM rated for 143 MHz).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p63962">
				<div class="post-metadata">
					<div class="post-num">Post #100</div>
					<div class="post-author">moroboshi</div>
					<div class="post-datetime">
						24 Feb 2008, 13:01					</div>
				</div>
				<div class="post-content content">
					<p>Hi, I&#039;d like to report that I just successfully upgraded a WRT54G v2.2 to 64MB of RAM. It had the same Hynix chip as my WRT54GL, which I replaced with one of the NanYa chips.<br />It first detected 32MB as expected and after changing to <br /></p><div class="codebox"><pre><code>sdram_config=0x0063
sdram_ncdl=0
sdram_init=0x0113</code></pre></div><p>it now runs happily with all 64MB usable (However I haven&#039;t done any longterm stability tests so far).</p><p><span class="postimg"><img src="http://tdiedrich.de/~ranma/S6002406s.jpg" alt="http://tdiedrich.de/~ranma/S6002406s.jpg" /></span><br /><span class="postimg"><img src="http://tdiedrich.de/~ranma/S6002412s.jpg" alt="http://tdiedrich.de/~ranma/S6002412s.jpg" /></span></p>									</div>
			</article>

			
		
						<div class="notice">
				<p>Sorry, posts 101 to 100 are missing from our archive.</p>
			</div>
		
		
	
	<div class="pagination"><div class="pagination-number">Page 4 of 6</div><nav><ul><li><a href="viewtopic.php%3Fid=10780&amp;p=1.html">1</a></li><li><a href="viewtopic.php%3Fid=10780&amp;p=2.html">2</a></li><li><a href="viewtopic.php%3Fid=10780&amp;p=3.html">3</a></li><li class="pagination-current"><span>4</span></li><li><a href="viewtopic.php%3Fid=10780&amp;p=5.html">5</a></li><li><a href="viewtopic.php%3Fid=10780&amp;p=6.html">6</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0.001 -->

</body>
</html>