<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Netgear DGN1000</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 24 Apr 2018 and 6 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 2 of 3</div><nav><ul><li><a href="viewtopic.php%3Fid=39319&amp;p=1.html">1</a></li><li class="pagination-current"><span>2</span></li><li><a href="viewtopic.php%3Fid=39319&amp;p=3.html">3</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p324894">
				<div class="post-metadata">
					<div class="post-num">Post #26</div>
					<div class="post-author">krembuk</div>
					<div class="post-datetime">
						20 May 2016, 05:27					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>zx82 wrote:</cite><blockquote><p>Which zip from Netgear did you use?</p></blockquote></div><p>I got it from here: <a href="http://download2.polytechnic.edu.na/pub4/sourceforge/o/of/officialnetgearfirmware/DGN1000SP_V.2.1.00.44_RG_src.tar.zip">http://download2.polytechnic.edu.na/pub … rc.tar.zip</a></p><div class="quotebox"><cite>zx82 wrote:</cite><blockquote><p>It is fairly impressive that the build is sufficiently self-contained to still work; unfortunately it&#039;s probably a kernel from the dark ages with tons of vulnerabilities, and getting OpenWrt userspace working on that doesn&#039;t strike me as fun.<br />Good luck!&nbsp; Turns out I have both the 16/4 variant and the 32/8 variant here.&nbsp; Out of curiosity I had a go at booting the generic ASE kernel from Attitude Adjustment (still pretty old, 3.3.8) on the 32/8 variant.&nbsp; It booted and panicked at the lack of root filesystem; I see no mention of flash probing (NOR, NAND or SPI) in the output, so I suspect the generic kernel might have no support for AmazonSE SPI.&nbsp; Then I somehow managed to overwrite U-Boot, so called it a day.</p><p>I&#039;ll see if I can restore U-Boot over serial later, and see whether the SPI support is just a missing config flag, or whether the Danube SPI driver works, or whether the Infineon driver in the 2.x code drop might build in a 3.x kernel.</p></blockquote></div><p>I feel sorry for your U-Boot accident.</p><p>Yes it was straight-forward build for the GPL source, only that I had to use Mint 3.1 for the working version of dev packages until it was all built, then I transfer them all to my latest Linux. Haven&#039;t tried tftpd boot of the kernel etc, though. Still struggling with learning openwrt&#039;s make-menuconfig entries and also which staging toolchain is used for this device. The processor seems to match AR231x/AR5312 (MIPS 4KEc), am I correct?</p><div class="codebox"><pre><code># cat cpuinfo
system type             : R0416_BSP_EPHY_SPI_HOST_A4
processor               : 0
cpu model               : MIPS 4KEc V6.12
BogoMIPS                : 266.24
wait instruction        : yes
microsecond timers      : yes
tlb_entries             : 16
extra interrupt vector  : yes
hardware watchpoint     : yes
ASEs implemented        : mips16
VCED exceptions         : not available
VCEI exceptions         : not available

Creating 8 MTD partitions on &quot;amazon_se-spi&quot;:
0x00000000-0x00020000 : &quot;U-Boot&quot;         -&gt; (mtd0) U-Boot
0x00020000-0x00030000 : &quot;ENV_MAC&quot;        -&gt; (mtd1) U-Boot-data
0x00030000-0x00040000 : &quot;DPF&quot;            -&gt; (mtd2) ? 
0x00040000-0x00050000 : &quot;NVRAM&quot;          -&gt; (mtd3) Atheros art
0x00050000-0x00700000 : &quot;RootFS_DPUMP&quot;  -&gt; (mtd4) rootfs
0x00700000-0x00800000 : &quot;Kernel&quot;        -&gt; (mtd5) kernel
0x00050000-0x00800000 : &quot;ROOTFS_KERNEL&quot;  -&gt; (mtd6) LEVEL 1 of rootfs + kernel
0x00000000-0x00020000 : &quot;POT&quot;            -&gt; (mtd7) U-Boot</code></pre></div><br /><p>Flash: MX25L6445E&nbsp; <a href="http://www.macronix.com/CachePages/en-us-Product-NORFlash-SerialFlash.aspx#64MbSerialV">http://www.macronix.com/CachePages/en-u … 4MbSerialV</a><br />SoC: Lantiq PSB 50601 HL v1.2<br />RAM: Etrontech EM63A165TS-6G <a href="http://www.etron.com/manager/uploads/EM63A165TS_v1.4.pdf">http://www.etron.com/manager/uploads/EM … S_v1.4.pdf</a></p><br /><p>I thought I saw its JTAG pinouts somewhere, I&#039;ll post it if I can find it again. Not sure whether it will be significant for an advanced like you, though.<br />Please inform me how to do serial U-Boot restore, if you succeed. I have another device with overwritten U-Boot, too.</p>											<p class="post-edited">(Last edited by <strong>krembuk</strong> on 20 May 2016, 10:36)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p324933">
				<div class="post-metadata">
					<div class="post-num">Post #27</div>
					<div class="post-author">zx82</div>
					<div class="post-datetime">
						20 May 2016, 12:18					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>krembuk wrote:</cite><blockquote><p>Still struggling with learning openwrt&#039;s make-menuconfig entries and also which staging toolchain is used for this device. The processor seems to match AR231x/AR5312 (MIPS 4KEc), am I correct?</p></blockquote></div><p>Are you trying to build trunk?&nbsp; You&#039;ll almost certainly need AmazonSE support specifically; you&#039;d be very lucky if another MIPS 4KEc platform worked.&nbsp; As far as I can tell, OpenWrt dropped what support it had for Amazon-SE after Attitude Adjustment/12.09.&nbsp; Amazon-SE falls under the XWAY brand, and OpenWrt still has an &#039;xway&#039; platform, but I don&#039;t think the &#039;xway&#039; platform includes any Amazon-SE support (only Danube and beyond). So for any degree of OpenWrt support on this unit, the options seem to be: 1) build an Attitude Adjustment kernel with missing support enabled/patched back in, and don&#039;t use the router for anything important; or 2) forward-port AmazonSE support into a more recent kernel.&nbsp; I think (1) sounds more realistic.&nbsp; Amazon isn&#039;t that different from Danube, but is probably different enough that you&#039;d need to do some kernel work.&nbsp; (I could be wrong.)</p><p>I&#039;ll be taking route 1.&nbsp; I went on a detour documenting the gory details of UART boot, and satisfying my curiosity about some technical bits of the boot ROM, so I haven&#039;t got anywhere yet.</p><div class="quotebox"><cite>krembuk wrote:</cite><blockquote><div class="codebox"><pre><code>0x00020000-0x00030000 : &quot;ENV_MAC&quot;        -&gt; (mtd1) U-Boot-data</code></pre></div></blockquote></div><p>U-Boot environment variables, yes.</p><div class="quotebox"><cite>krembuk wrote:</cite><blockquote><div class="codebox"><pre><code>0x00030000-0x00040000 : &quot;DPF&quot;            -&gt; (mtd2) ?</code></pre></div></blockquote></div><p>Don&#039;t know!</p><div class="quotebox"><cite>krembuk wrote:</cite><blockquote><div class="codebox"><pre><code>0x00040000-0x00050000 : &quot;NVRAM&quot;          -&gt; (mtd3) Atheros art</code></pre></div></blockquote></div><p>On stock firmware, the config variables for the userspace firmware live here.&nbsp; Stock firmware does everything with variables, rather than having config files in an overlay or read/write filesystem.</p><div class="quotebox"><cite>krembuk wrote:</cite><blockquote><div class="codebox"><pre><code>0x00000000-0x00020000 : &quot;POT&quot;            -&gt; (mtd7) U-Boot</code></pre></div></blockquote></div><p>Yeah, I don&#039;t know why there&#039;s a duplicate mapping for U-Boot, and I&#039;ve not looked into what &quot;POT&quot; means in Netgear world.</p><div class="quotebox"><cite>krembuk wrote:</cite><blockquote><p>I thought I saw its JTAG pinouts somewhere, I&#039;ll post it if I can find it again. Not sure whether it will be significant for an advanced like you, though.</p></blockquote></div><p>I documented <a href="https://wiki.openwrt.org/doc/hardware/soc/soc.lantiq#jtag">the JTAG pins of the SoC</a> (I have another unit based on the same SoC with a JTAG header), but:<br /></p><ul><li><p>Accessing it directly at the chip is tricky; the chip comes in TQFP meaning the soldering required is quite fine-pitch.&nbsp; It would be easier to access at the pull-up/pull-down resistors on a board like this with no JTAG header.&nbsp; It looks like the JTAG pins are pulled up/down by R23, R26 (topside) and R36, R24, R25 (underside) but I haven&#039;t yet documented which side of which resistor is which JTAG pin (yet).<br /></p></li><li><p>Being able to reach the JTAG pins is not quite the same as being able to use JTAG for recovery.&nbsp; There needs to be support for the board&#039;s flash interface.&nbsp; I&#039;m not sure that this support exists yet for this chip family.</p></li><li><p>You should hopefully never need it anyway if you have serial access.&nbsp; Lantiq/Infineon SoCs, including this one, seem to generally support booting over UART.</p></li></ul><div class="quotebox"><cite>krembuk wrote:</cite><blockquote><p>Please inform me how to do serial U-Boot restore, if you succeed. I have another device with overwritten U-Boot, too.</p></blockquote></div><p>I haven&#039;t got around to it just yet, but I can outline it.&nbsp; UART (serial) restore is a Lantiq/Infineon feature.&nbsp; You can reach UART mode by pulling a pin or two at boot; how you do that depends on the exact device (there are no generic instructions!).&nbsp; On this model I&#039;ve accidentally forced UART mode by shorting pins 47&amp;48 on the SoC, but <strong>that might damage the chip</strong>; it would probably be kinder to pull the SPI flash&#039;s <span class="bbu">/HOLD</span> pin low (but I&#039;ve not tried that yet; mine falls into UART mode anyway, so I may have trashed the signature at the start of flash).&nbsp; Maybe that would work on other devices too.</p><p>Then you need to find or build a U-Boot image (some source is included in the zip), convert it to the format UART mode expects (the zip uses the gct or gct.pl script to do that), and present it to the router (as simple as &#039;cat&#039; on Linux, or something like &quot;send plain file&quot; in GUIs).&nbsp; Once U-Boot is running from RAM, you need to use its commands to flash a replacement image.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p324943">
				<div class="post-metadata">
					<div class="post-num">Post #28</div>
					<div class="post-author">krembuk</div>
					<div class="post-datetime">
						20 May 2016, 13:31					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>zx82 wrote:</cite><blockquote><p>Are you trying to build trunk?&nbsp; You&#039;ll almost certainly need AmazonSE support specifically; you&#039;d be very lucky if another MIPS 4KEc platform worked.&nbsp; As far as I can tell, OpenWrt dropped what support it had for Amazon-SE after Attitude Adjustment/12.09.&nbsp; Amazon-SE falls under the XWAY brand, and OpenWrt still has an &#039;xway&#039; platform, but I don&#039;t think the &#039;xway&#039; platform includes any Amazon-SE support (only Danube and beyond). So for any degree of OpenWrt support on this unit, the options seem to be: 1) build an Attitude Adjustment kernel with missing support enabled/patched back in, and don&#039;t use the router for anything important; or 2) forward-port AmazonSE support into a more recent kernel.&nbsp; I think (1) sounds more realistic.&nbsp; Amazon isn&#039;t that different from Danube, but is probably different enough that you&#039;d need to do some kernel work.&nbsp; (I could be wrong.)</p><p>I&#039;ll be taking route 1.&nbsp; I went on a detour documenting the gory details of UART boot, and satisfying my curiosity about some technical bits of the boot ROM, so I haven&#039;t got anywhere yet.</p></blockquote></div><p>You just saved me from useless tinkering! <br />I&#039;m still learning about kernel coding, cross compiling, so let alone talking about me getting anywhere. I&#039;m still struggling in the basement, filling up my suitcase. <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Will revert to Attitude Adjustment, then.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p325030">
				<div class="post-metadata">
					<div class="post-num">Post #29</div>
					<div class="post-author">zx82</div>
					<div class="post-datetime">
						20 May 2016, 23:28					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>zx82 wrote:</cite><blockquote><div class="quotebox"><cite>krembuk wrote:</cite><blockquote><div class="codebox"><pre><code>0x00030000-0x00040000 : &quot;DPF&quot;            -&gt; (mtd2) ?</code></pre></div></blockquote></div><p>Don&#039;t know!</p></blockquote></div><p>D&#039;oh.&nbsp; DPF = Device Provisioning File and is just a gzipped XML file full of factory reset settings.&nbsp; Kill it with fire.</p><p>I restored my corrupted unit via UART mode, so we know that can be done; somewhat easier than wiring/soldering to write the SPI flash from another machine.&nbsp; Forcing UART mode on an otherwise working unit by pulling down <span class="bbu">/HOLD</span> didn&#039;t work for me though; I had to pull <span class="bbu">DI</span> or <span class="bbu">DO</span> low, or any CPU SPI signal high (use a suitable resistor, or risk damage).&nbsp; You can make an image from the u-boot.ifx in the source dump:<br /></p><div class="codebox"><pre><code>objcopy --adjust-vma=0xa0010000 -I binary -O srec bootloader_src/spi-uboot/tools/u-boot.ifx u-boot.srec</code></pre></div><p>and then convert it using <a href="https://dev.openwrt.org/browser/trunk/package/boot/uboot-lantiq/patches/0017-tools-add-some-helper-tools-for-Lantiq-SoCs.patch?rev=40482">gct.pl</a>, supplying a slightly fudged <span class="bbu">bootloader_src/spi-uboot/tools/<br />amse_uboot.conf</span> from the dump to prepend the RAM init.</p><p>It crossed my mind that a more fully-featured/modern U-Boot might be nice, but there&#039;s no U-Boot support for AmazonSE in the u-boot-lantiq nor official U-Boot repositories (only in the Netgear source dumps).&nbsp; There is support for Danube in u-boot-lantiq and OpenWrt&#039;s patches but I think all the supported models are either chainloaded from brnboot or running from NOR flash, so support for reading from serial flash in Amazon would have to be added, along with some voodoo for setting up the low-level peripherals that differ from Danube.&nbsp; Probably not too hard if you&#039;re desperate for a fuller U-Boot, but I&#039;d be pretty surprised if changes ever got accepted upstream.</p><p>I had a bit of a dig through the history of AmazonSE under OpenWrt.&nbsp; Seems like a few factors undermined support.&nbsp; Not enough docs.&nbsp; Not a very popular chipset (not many models, mostly low-end).&nbsp; And timing; the Attitude Adjustment feature freeze happened, and people are always less eager to run trunk.&nbsp; The generic AA image doesn&#039;t seem to have working serial flash support.&nbsp; After AA this model did see specific support added, and I think general serial flash support appeared for Lantiq/XWAY.&nbsp; In theory the foundations are all still there in the kernel; code was written to support Amazon and work was done to merge Amazon and Danube into one XWAY platform, but I suspect this merge may have broken Amazon devices because nobody was testing on them.&nbsp; And then I think because there were no users, build support for this model disappeared from the tree again before Barrier Breaker froze.</p><p>So I&#039;m building a kernel from a point somewhere between AA and BB (maybe I should call it &quot;Attitude Breaker&quot;), and hoping that point falls after Amazon support stabilised but before the potentially cruel XWAY merge.&nbsp; Tweaked the DTS slightly to reflect the larger flash and the death of DPF.&nbsp; We&#039;ll see.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p325057">
				<div class="post-metadata">
					<div class="post-num">Post #30</div>
					<div class="post-author">zx82</div>
					<div class="post-datetime">
						21 May 2016, 03:14					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>zx82 wrote:</cite><blockquote><p>We&#039;ll see.</p></blockquote></div><p>Didn&#039;t work.&nbsp; It hangs, probably in the SPI driver given that the last message comes from there:<br /></p><div class="codebox"><pre><code>[    0.288000] spi-xway 1e100800.spi: master is unqueued, this is deprecated</code></pre></div><p><a href="https://forum.openwrt.org/viewtopic.php?id=45386">This problem</a> has been <a href="https://forum.openwrt.org/viewtopic.php?id=45942">seen before</a>.&nbsp; It&#039;s odd, because the driver was apparently <a href="https://dev.openwrt.org/browser/trunk/target/linux/lantiq/patches-4.1/0033-SPI-MIPS-lantiq-adds-spi-xway.patch?rev=47158">first tested on Amazon-SE</a>.&nbsp; It has not been <a href="https://dev.openwrt.org/changeset/31910">without</a> its <a href="https://lists.openwrt.org/pipermail/openwrt-devel/2015-October/036610.html">problems</a>, though, and trunk <a href="http://comments.gmane.org/gmane.comp.embedded.openwrt.devel/37888">has a newer, rewritten driver</a>.</p><p>So maybe I spoke too soon about trunk being a bad idea; maybe resurrecting the AmazonSE build on trunk holds more promise than trying to fix the SPI driver in AA.&nbsp; I&#039;ll give it a whirl.</p>											<p class="post-edited">(Last edited by <strong>zx82</strong> on 21 May 2016, 03:14)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p325076">
				<div class="post-metadata">
					<div class="post-num">Post #31</div>
					<div class="post-author">krembuk</div>
					<div class="post-datetime">
						21 May 2016, 07:34					</div>
				</div>
				<div class="post-content content">
					<p>I just downloaded the Attitude Adjustment Amazon SE generic kernel uImage, did the tftpboot, and here it is:</p><div class="codebox"><pre><code>AMAZON_SE # tftpboot
Using AMAZON_SE Switch device
TFTP from server 192.168.1.2; our IP address is 192.168.1.1
Filename &#039;uImage&#039;.
Load address: 0x80100000
Loading: #################################################################
         #################################################################
         ############################################################
done
Bytes transferred = 972193 (ed5a1 hex)
AMAZON_SE # bootm
## Booting image at 80100000 ...
   Image Name:   MIPS OpenWrt Linux-3.3.8
   Created:      2013-03-23  13:11:17 UTC
   Image Type:   MIPS Linux Kernel Image (lzma compressed)
   Data Size:    972129 Bytes = 949.3 kB
   Load Address: 80002000
   Entry Point:  80002000
   Verifying Checksum ... OK
   Uncompressing Kernel Image ... ERROR: LzmaDecode.c, 561

Decoding error = 1
LZMA ERROR 1 - must RESET board to recover</code></pre></div><p>the device did not stuck and requested hard power off, but seems to continue with normal boot from flash, afterward, with the following messages right after the one I posted above:</p><div class="codebox"><pre><code>ROM VER: 1.2.0
CFG 04
EEPROM Data OK


U-Boot 1.1.5-2.2 (Mar 19 2011 - 00:58:03)

DRAM:  32 MB

 relocate_code start
 relocate_code finish.
Now running in RAM - U-Boot at: 81fc0000
Flash:  8 MB
using default environment

In:    serial
Out:   serial
Err:   serial
Net:   External Clock
Selected EPHY_MODE
AMAZON_SE Switch
mac = 00:8e:f2:7f:45:a6
AMAZON_SE_GPIO_P0_IN = 0xa9ff..
AMAZON_SE_GPIO_P1_IN = 0x2b08..

Type &quot;run flash_nfs&quot; to mount root filesystem over NFS

Input Ctrl-c to stop autoboot:  0
Check FW intergality...OK
Ethernet Init Done!
No NMRP Server found
De-init Ethernet..Done!bootloader verion = 1.09
## Booting image at 00700000 ...
   Image Name:   MIPS Linux-2.6.20
   Created:      2012-03-05   4:37:24 UTC
   Image Type:   MIPS Linux Kernel Image (lzma compressed)
   Data Size:    874532 Bytes = 854 kB
   Load Address: 80002000
   Entry Point:  802a2000
   Verifying Checksum ... OK
   Uncompressing Kernel Image ... OK

Starting kernel ...

Linux version 2.6.20-Amazon_SE
 (root@localhost.localdomain) (gcc version 3.4.4 20050119 (MIPS SDE)) #51 Mon Mar 5 12:37:17 CST 2012
Current Model:R0416_BSP_EPHY_SPI_HOST_A4
This model supports only basic BSP feature on Amazon SE Small board with SPI flash USB host and PPE A4 firmware
CPU revision is: 0001906c
Determined physical RAM map:
User-defined physical RAM map:
 memory: 02000000 @ 00000000 (usable)
Built 1 zonelists.  Total pages: 8128
Kernel command line: root=/dev/mtdblock4 ip=192.168.1.1:192.168.1.2::::eth0:on console=ttyS0,115200 ethaddr=00:8e:f2:7f:45:a6 mem=32M panic=1
Primary instruction cache 8kB, physically tagged, 4-way, linesize 16 bytes.
Primary data cache 8kB, 2-way, linesize 16 bytes.
Synthesized TLB refill handler (20 instructions).
Synthesized TLB load handler fastpath (32 instructions).
Synthesized TLB store handler fastpath (32 instructions).
Synthesized TLB modify handler fastpath (31 instructions).
PID hash table entries: 128 (order: 7, 512 bytes)
mips_hpt_frequency:133333333
r4k_offset: 00145855(1333333)
Using 133.333 MHz high precision timer.
Dentry cache hash table entries: 4096 (order: 2, 16384 bytes)
Inode-cache hash table entries: 2048 (order: 1, 8192 bytes)
Memory: 29520k/32768k available (2267k kernel code, 3248k reserved, 418k data, 132k init, 0k highmem)
Mount-cache hash table entries: 512
NET: Registered protocol family 16
SCSI subsystem initialized
usbcore: registered new interface driver usbfs
usbcore: registered new interface driver hub
usbcore: registered new device driver usb
NET: Registered protocol family 8
NET: Registered protocol family 20
NET: Registered protocol family 2
IP route cache hash table entries: 1024 (order: 0, 4096 bytes)
TCP established hash table entries: 1024 (order: 0, 4096 bytes)
TCP bind hash table entries: 512 (order: -1, 2048 bytes)
TCP: Hash tables configured (established 1024 bind 512)
TCP reno registered
amazon_se_dma_init
dma_chip_init
gptu: totally 6 16-bit timers/counters
gptu: misc_register on minor 63
gptu: succeeded to request irq 25 for timer[0]
gptu: succeeded to request irq 26 for timer[1]
gptu: succeeded to request irq 27 for timer[2]
gptu: succeeded to request irq 28 for timer[3]
gptu: succeeded to request irq 29 for timer[4]
gptu: succeeded to request irq 30 for timer[5]
squashfs: version 3.2-r2 (2007/01/15) Phillip Lougher
squashfs: LZMA suppport for slax.org by jro
fuse init (API version 7.8)
io scheduler noop registered (default)
Infineon Technologies port driver version 1.0.2
cgu: misc_register on minor = 62
led: misc_register on minor = 151
drivers/char/amazon_se_led.c amazon_se_led_config 1244: f_software_update = 1
drivers/char/amazon_se_led.c amazon_se_led_config 1244: f_software_update = 1
drivers/char/amazon_se_led.c amazon_se_led_config 1244: f_software_update = 1
drivers/char/amazon_se_led.c amazon_se_led_config 1244: f_software_update = 1
Unknown module try to reserve GPIO
Unknown module try to reserve GPIO
Infineon Technologies Synchronous Serial Controller (SSC) driver version 0.2.1
IFX MEI Version 4.00.01

Infineon CPE API Driver version: DSL CPE API V3.20.5.1

DSL_DRV: using proc fs
ttyS0 at MMIO 0xbe100c00 (irq = 2) is a IFX_ASC
PPP generic driver version 2.4.2
NET: Registered protocol family 24
IMQ starting with 2 devices...
IMQ driver loaded successfully.
        Hooking IMQ before NAT on PREROUTING.
        Hooking IMQ after NAT on POSTROUTING.
Loading A4 (ATM+MII0) driver ...... Force to 100MB Duplex
Succeeded!
PPE datapath driver info:
  Version ID: 8.3.5.1.0.0.1
  Family    : Amazon-SE
  DR Type   : Normal Data Path | Indirect-Fast Path
  Interface : MII0 | ATM
  Mode      : Routing
  Release   : 0.0.1
PPE firmware info:
  Version ID: 3.1.2.6.1.6
  Family    : Amazon-SE
  FW Type   : Standard
  Interface : MII0 + ATM
  Mode      : Bridging + IPv4 Routing
  Release   : 1.6
PPA API --- init successfully
Infineon Technologies Synchronous SPI flash driver version 0.0.1
MTD driver for SPI flash.
Probing for Serial flash ...
Update rx_eff_size to 4
 &lt;5&gt;Creating 8 MTD partitions on &quot;amazon_se-spi&quot;:
0x00000000-0x00020000 : &quot;U-Boot&quot;
0x00020000-0x00030000 : &quot;ENV_MAC&quot;
0x00030000-0x00040000 : &quot;DPF&quot;
0x00040000-0x00050000 : &quot;NVRAM&quot;
0x00050000-0x00700000 : &quot;RootFS_DPUMP&quot;
0x00700000-0x00800000 : &quot;Kernel&quot;
0x00050000-0x00800000 : &quot;ROOTFS_KERNEL&quot;
0x00000000-0x00020000 : &quot;POT&quot;
Update rx_eff_size to 4096
 &lt;6&gt;dwc_otg: version 2.2-RC3
dwc_otg dwc_otg: DWC OTG Controller
dwc_otg dwc_otg: new USB bus registered, assigned bus number 1
dwc_otg dwc_otg: irq 31, io mem 0x00000000
DWC_otg: Init: Power Port (0)
usb usb1: configuration #1 chosen from 1 choice
hub 1-0:1.0: USB hub found
hub 1-0:1.0: 1 port detected
nf_conntrack version 0.5.0 (256 buckets, 2048 max)
nf_ct_ftp: registering helper for pf: 2 port: 21
nf_ct_ftp: registering helper for pf: 10 port: 21
GRE over IPv4 tunneling driver
ip_tables: (C) 2000-2006 Netfilter Core Team
usb 1-1: new high speed USB device using dwc_otg and address 2
usb 1-1: configuration #1 chosen from 1 choice
TCP cubic registered
NET: Registered protocol family 1
NET: Registered protocol family 17
NET: Registered protocol family 8
atmpvc_init() failed with -17
802.1Q VLAN Support v1.8 Ben Greear &lt;greearb@candelatech.com&gt;
All bugs added by David S. Miller &lt;davem@redhat.com&gt;
Time: MIPS clocksource has been installed.
VFS: Mounted root (squashfs filesystem) readonly.
Freeing unused kernel memory: 132k freed
init started: BusyBox v1.13.1 (2012-03-01 17:48:55 CST
starting pid 14, tty &#039;&#039;: &#039;/usr/etc/rcS
Algorithmics/MIPS FPU Emulator v1.5
netfilter PSD loaded - (c) astaro AG
ipt_http_string: module license &#039;SERCOMM&#039; taints kernel.
init:866
cat: can&#039;t open &#039;/tmp/etc/block.htm&#039;: No such file or directory
insmod: cannot insert &#039;/lib/modules/igmp_snooping.ko&#039;: unknown symbol in module, or unknown parameter
device eth0 entered promiscuous mode
br0: port 1(eth0) entering learning state
userspace registering PID
cat: can&#039;t open &#039;/proc/nvram/BaseMacAddr&#039;: No such file or directory
ap_name=(null) action=start
/bin/echo GMT+0 &gt; /etc/TZ
killall: udhcpd: no process killed
iptables: No chain/target/match by that name
killall: miniupnpd: no process killed
killall: dnrd: no process killed
Notice: caching turned off
Warning: Using /etc/hosts will be removed in a future version. Please use only the /etc/dnrd/master file or use -m off.
dnrd -a 192.168.0.1 -m hosts -c off --timeout=0 -b  -s 1.1.1.1
Do not need swap cal data
VAP-Name -- ath0
BGSCAN --   0
Fast-Frame-Txq-Min -- 1000
SHORT GI --   1
CWM MODE --   1
CWM EXTOFFSET --   1
CWM EXTPROTSPACING --   0
AMPDU --   1
TX CHAIN MASK --   1
RX CHAIN MASK --   1
HIDESSID --   0
APBRIDGE --   1
Frequency -- 0.0
SSID -- virginmedia0265831
COUNTRY CODE --   0x114
WDS --   0
MACCMD --   0
DOTH --   0
COUNTRY IE --   1

Please press Enter to activate this console. ff
WaitForConfiguration
100
WaitForLinkActivate
200
0
WaitForConfiguration
100
WaitForLinkActivate
200</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p325078">
				<div class="post-metadata">
					<div class="post-num">Post #32</div>
					<div class="post-author">krembuk</div>
					<div class="post-datetime">
						21 May 2016, 07:41					</div>
				</div>
				<div class="post-content content">
					<p>oh, wait. Is it because of the load addresss? I just realized that they are different after posting them above, just now.</p><p>It is annoying that my Windows 7 does not seem to pass tftp request to my tftp server although I turned off the firewall, and I had to bring another computer with WinXP. Will try again, later.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p325079">
				<div class="post-metadata">
					<div class="post-num">Post #33</div>
					<div class="post-author">krembuk</div>
					<div class="post-datetime">
						21 May 2016, 07:50					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>zx82 wrote:</cite><blockquote><p>I had a bit of a dig through the history of AmazonSE under OpenWrt.&nbsp; Seems like a few factors undermined support.&nbsp; Not enough docs.&nbsp; Not a very popular chipset (not many models, mostly low-end).&nbsp; And timing; the Attitude Adjustment feature freeze happened, and people are always less eager to run trunk.&nbsp; The generic AA image doesn&#039;t seem to have working serial flash support.&nbsp; After AA this model did see specific support added, and I think general serial flash support appeared for Lantiq/XWAY.&nbsp; In theory the foundations are all still there in the kernel; code was written to support Amazon and work was done to merge Amazon and Danube into one XWAY platform, but I suspect this merge may have broken Amazon devices because nobody was testing on them.&nbsp; And then I think because there were no users, build support for this model disappeared from the tree again before Barrier Breaker froze.</p><p>So I&#039;m building a kernel from a point somewhere between AA and BB (maybe I should call it &quot;Attitude Breaker&quot;), and hoping that point falls after Amazon support stabilised but before the potentially cruel XWAY merge.&nbsp; Tweaked the DTS slightly to reflect the larger flash and the death of DPF.&nbsp; We&#039;ll see.</p></blockquote></div><p>I&#039;m starting to think about dirty porting everything from Openwrt AA into the cleanly-compiled, provided source code of the DGN1000SP. But, I also have not tested the compiled firmware. As I&#039;ve mentioned, I still have to fight this Windows 7&#039;s tftp issue, too.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p325103">
				<div class="post-metadata">
					<div class="post-num">Post #34</div>
					<div class="post-author">zx82</div>
					<div class="post-datetime">
						21 May 2016, 11:58					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>krembuk wrote:</cite><blockquote><p>I just downloaded the Attitude Adjustment Amazon SE generic kernel uImage, did the tftpboot, and here it is: ...</p><div class="codebox"><pre><code>...
Decoding error = 1
LZMA ERROR 1 - must RESET board to recover</code></pre></div><div class="codebox"><pre><code>...
   Image Name:   MIPS Linux-2.6.20</code></pre></div></blockquote></div><p>So it tried to boot a kernel TFTPd into memory, had a problem, reset and booted into the default kernel in flash.</p><p>I can&#039;t explain why you got a decoding error; I&#039;ve booted the very same kernel and as I&#039;ve said, on mine it gets as far as the panic (no serial flash, so no root fs).&nbsp; Given that the checksum passes, I&#039;d say 1) try again just in case it was a glitch; 2) there&#039;s the slim possibility it&#039;s <a href="https://forum.openwrt.org/viewtopic.php?pid=253545#p253545">U-Boot disagreeing with the LZMA</a>; I have a different U-Boot build (you have 1.1.5-2.2 Mar 19 2011 - 00:58:03, I have 1.1.5-2.2 Dec&nbsp; 3 2009 - 16:57:11).</p><div class="quotebox"><cite>krembuk wrote:</cite><blockquote><p>I&#039;m starting to think about dirty porting everything from Openwrt AA into the cleanly-compiled, provided source code of the DGN1000SP.</p></blockquote></div><p>You&#039;d be stuck on an ancient kernel forever, and you&#039;d probably never get to use any kernel modules from OpenWrt, but I guess that&#039;s not a million miles away from how things would be if we had AA working.</p><div class="quotebox"><cite>zx82 wrote:</cite><blockquote><p>I&#039;ll give [trunk] a whirl.</p></blockquote></div><p>My trunk build hangs even earlier than my AB build, this time after:<br /></p><div class="codebox"><pre><code>[    0.000000] Linux version 4.4.7 (me@mine) (gcc version 5.3.0 (OpenWrt GCC 5.3.0 r49377) ) #3 Sat May 21 08:14:16 UTC 2016
[    0.000000] SoC: Amazon_SE rev 1.3
[    0.000000] bootconsole [early0] enabled
[    0.000000] CPU0 revision is: 0001906c (MIPS 4KEc)
[    0.000000] MIPS: machine is DGN1000B - Netgear DGN1000B
[    0.000000] Determined physical RAM map:
[    0.000000]  memory: 00485000 @ 00002000 (usable)
[    0.000000]  memory: 00129000 @ 00487000 (usable after init)
[    0.000000] Wasting 64 bytes for tracking 2 unused pages</code></pre></div><p>So indeed I suspect the merged xway code hasn&#039;t been tested on AmazonSE.&nbsp; That RAM map looks screwy.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p325107">
				<div class="post-metadata">
					<div class="post-num">Post #35</div>
					<div class="post-author">krembuk</div>
					<div class="post-datetime">
						21 May 2016, 12:41					</div>
				</div>
				<div class="post-content content">
					<p>I think I experienced what you got earlier. This time it works when I changed the load address:</p><div class="codebox"><pre><code>ROM VER: 1.2.0
CFG 04
EEPROM Data OK


U-Boot 1.1.5-2.2 (Mar 19 2011 - 00:58:03)

DRAM:  32 MB

 relocate_code start
 relocate_code finish.
Now running in RAM - U-Boot at: 81fc0000
Flash:  8 MB
using default environment

In:    serial
Out:   serial
Err:   serial
Net:   External Clock
Selected EPHY_MODE
AMAZON_SE Switch
mac = 00:8e:f2:7f:45:a6
AMAZON_SE_GPIO_P0_IN = 0xa9ff..
AMAZON_SE_GPIO_P1_IN = 0x2b08..

Type &quot;run flash_nfs&quot; to mount root filesystem over NFS

Input Ctrl-c to stop autoboot:  0
AMAZON_SE # tftpboot 0x00700000 uImage
Using AMAZON_SE Switch device
TFTP from server 192.168.1.2; our IP address is 192.168.1.1
Filename &#039;uImage&#039;.
Load address: 0x700000
Loading: checksum bad
checksum bad
#################################################################
         #################################################################
         ############################################################
done
Bytes transferred = 972193 (ed5a1 hex)
AMAZON_SE # bootm 0x00700000
## Booting image at 00700000 ...
   Image Name:   MIPS Linux-2.6.20
   Created:      2012-03-05   4:37:24 UTC
   Image Type:   MIPS Linux Kernel Image (lzma compressed)
   Data Size:    874532 Bytes = 854 kB
   Load Address: 80002000
   Entry Point:  802a2000
   Verifying Checksum ... OK
   Uncompressing Kernel Image ... OK

Starting kernel ...

Linux version 2.6.20-Amazon_SE
 (root@localhost.localdomain) (gcc version 3.4.4 20050119 (MIPS SDE)) #51 Mon Mar 5 12:37:17 CST 2012
Current Model:R0416_BSP_EPHY_SPI_HOST_A4
This model supports only basic BSP feature on Amazon SE Small board with SPI flash USB host and PPE A4 firmware
CPU revision is: 0001906c
Determined physical RAM map:
User-defined physical RAM map:
 memory: 02000000 @ 00000000 (usable)
Built 1 zonelists.  Total pages: 8128
Kernel command line:  mem=32M
Primary instruction cache 8kB, physically tagged, 4-way, linesize 16 bytes.
Primary data cache 8kB, 2-way, linesize 16 bytes.
Synthesized TLB refill handler (20 instructions).
Synthesized TLB load handler fastpath (32 instructions).
Synthesized TLB store handler fastpath (32 instructions).
Synthesized TLB modify handler fastpath (31 instructions).
PID hash table entries: 128 (order: 7, 512 bytes)
mips_hpt_frequency:133333333
r4k_offset: 00145855(1333333)
Using 133.333 MHz high precision timer.
Dentry cache hash table entries: 4096 (order: 2, 16384 bytes)
Inode-cache hash table entries: 2048 (order: 1, 8192 bytes)
Memory: 29520k/32768k available (2267k kernel code, 3248k reserved, 418k data, 132k init, 0k highmem)
Mount-cache hash table entries: 512
NET: Registered protocol family 16
SCSI subsystem initialized
usbcore: registered new interface driver usbfs
usbcore: registered new interface driver hub
usbcore: registered new device driver usb
NET: Registered protocol family 8
NET: Registered protocol family 20
NET: Registered protocol family 2
IP route cache hash table entries: 1024 (order: 0, 4096 bytes)
TCP established hash table entries: 1024 (order: 0, 4096 bytes)
TCP bind hash table entries: 512 (order: -1, 2048 bytes)
TCP: Hash tables configured (established 1024 bind 512)
TCP reno registered
amazon_se_dma_init
dma_chip_init
gptu: totally 6 16-bit timers/counters
gptu: misc_register on minor 63
gptu: succeeded to request irq 25 for timer[0]
gptu: succeeded to request irq 26 for timer[1]
gptu: succeeded to request irq 27 for timer[2]
gptu: succeeded to request irq 28 for timer[3]
gptu: succeeded to request irq 29 for timer[4]
gptu: succeeded to request irq 30 for timer[5]
squashfs: version 3.2-r2 (2007/01/15) Phillip Lougher
squashfs: LZMA suppport for slax.org by jro
fuse init (API version 7.8)
io scheduler noop registered (default)
Infineon Technologies port driver version 1.0.2
cgu: misc_register on minor = 62
led: misc_register on minor = 151
drivers/char/amazon_se_led.c amazon_se_led_config 1244: f_software_update = 1
drivers/char/amazon_se_led.c amazon_se_led_config 1244: f_software_update = 1
drivers/char/amazon_se_led.c amazon_se_led_config 1244: f_software_update = 1
drivers/char/amazon_se_led.c amazon_se_led_config 1244: f_software_update = 1
Unknown module try to reserve GPIO
Unknown module try to reserve GPIO
Infineon Technologies Synchronous Serial Controller (SSC) driver version 0.2.1
IFX MEI Version 4.00.01

Infineon CPE API Driver version: DSL CPE API V3.20.5.1

DSL_DRV: using proc fs
ttyS0 at MMIO 0xbe100c00 (irq = 2) is a IFX_ASC
PPP generic driver version 2.4.2
NET: Registered protocol family 24
IMQ starting with 2 devices...
IMQ driver loaded successfully.
        Hooking IMQ before NAT on PREROUTING.
        Hooking IMQ after NAT on POSTROUTING.
Loading A4 (ATM+MII0) driver ...... Force to 100MB Duplex
Succeeded!
PPE datapath driver info:
  Version ID: 8.3.5.1.0.0.1
  Family    : Amazon-SE
  DR Type   : Normal Data Path | Indirect-Fast Path
  Interface : MII0 | ATM
  Mode      : Routing
  Release   : 0.0.1
PPE firmware info:
  Version ID: 3.1.2.6.1.6
  Family    : Amazon-SE
  FW Type   : Standard
  Interface : MII0 + ATM
  Mode      : Bridging + IPv4 Routing
  Release   : 1.6
PPA API --- init successfully
Infineon Technologies Synchronous SPI flash driver version 0.0.1
MTD driver for SPI flash.
Probing for Serial flash ...
Update rx_eff_size to 4
 &lt;5&gt;Creating 8 MTD partitions on &quot;amazon_se-spi&quot;:
0x00000000-0x00020000 : &quot;U-Boot&quot;
0x00020000-0x00030000 : &quot;ENV_MAC&quot;
0x00030000-0x00040000 : &quot;DPF&quot;
0x00040000-0x00050000 : &quot;NVRAM&quot;
0x00050000-0x00700000 : &quot;RootFS_DPUMP&quot;
0x00700000-0x00800000 : &quot;Kernel&quot;
0x00050000-0x00800000 : &quot;ROOTFS_KERNEL&quot;
0x00000000-0x00020000 : &quot;POT&quot;
Update rx_eff_size to 4096
 &lt;6&gt;dwc_otg: version 2.2-RC3
dwc_otg dwc_otg: DWC OTG Controller
dwc_otg dwc_otg: new USB bus registered, assigned bus number 1
dwc_otg dwc_otg: irq 31, io mem 0x00000000
DWC_otg: Init: Power Port (0)
usb usb1: configuration #1 chosen from 1 choice
hub 1-0:1.0: USB hub found
hub 1-0:1.0: 1 port detected
nf_conntrack version 0.5.0 (256 buckets, 2048 max)
nf_ct_ftp: registering helper for pf: 2 port: 21
nf_ct_ftp: registering helper for pf: 10 port: 21
GRE over IPv4 tunneling driver
ip_tables: (C) 2000-2006 Netfilter Core Team
usb 1-1: new high speed USB device using dwc_otg and address 2
usb 1-1: configuration #1 chosen from 1 choice
TCP cubic registered
NET: Registered protocol family 1
NET: Registered protocol family 17
NET: Registered protocol family 8
atmpvc_init() failed with -17
802.1Q VLAN Support v1.8 Ben Greear &lt;greearb@candelatech.com&gt;
All bugs added by David S. Miller &lt;davem@redhat.com&gt;
VFS: Cannot open root device &quot;&lt;NULL&gt;&quot; or unknown-block(0,0)
Please append a correct &quot;root=&quot; boot option
Time: MIPS clocksource has been installed.
Kernel panic - not syncing: VFS: Unable to mount root fs on unknown-block(0,0)</code></pre></div><p>Will try with my GPL compiled kernel, later</p>											<p class="post-edited">(Last edited by <strong>krembuk</strong> on 21 May 2016, 12:52)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p325108">
				<div class="post-metadata">
					<div class="post-num">Post #36</div>
					<div class="post-author">krembuk</div>
					<div class="post-datetime">
						21 May 2016, 13:02					</div>
				</div>
				<div class="post-content content">
					<p>My compiled kernel is giving exactly the same message as above. I&#039;m confused.</p><p>BTW, when I tried to go into pressing Ctrl-C quickly after turning on the power, I once got:</p><div class="codebox"><pre><code>ROM VER: 1.2.0
CFG 04
UART</code></pre></div><p>instead of </p><div class="codebox"><pre><code>ROM VER: 1.2.0
CFG 04
EEPROM Data OK</code></pre></div>											<p class="post-edited">(Last edited by <strong>krembuk</strong> on 21 May 2016, 13:40)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p325112">
				<div class="post-metadata">
					<div class="post-num">Post #37</div>
					<div class="post-author">krembuk</div>
					<div class="post-datetime">
						21 May 2016, 13:22					</div>
				</div>
				<div class="post-content content">
					<p>Booted the openwrt uImage, after specifying </p><div class="codebox"><pre><code>AMAZON_SE # run flashargs</code></pre></div><p> which </p><div class="codebox"><pre><code>flashargs=setenv bootargs root=/dev/mtdblock4</code></pre></div><p>With message of kernel build seems exactly the same as the original (build time, etc). I&#039;m confused.</p><div class="codebox"><pre><code>AMAZON_SE # tftpboot 0x00700000 uImage
Using AMAZON_SE Switch device
TFTP from server 192.168.1.2; our IP address is 192.168.1.1
Filename &#039;uImage&#039;.
Load address: 0x700000
Loading: checksum bad
checksum bad
#################################################################
         #################################################################
         ############################################################
done
Bytes transferred = 972193 (ed5a1 hex)
AMAZON_SE # tftpboot 0x00700000 uImage
Using AMAZON_SE Switch device
TFTP from server 192.168.1.2; our IP address is 192.168.1.1
Filename &#039;uImage&#039;.
Load address: 0x700000
Loading: #################################################################
         #################################################################
         ############################################################
done
Bytes transferred = 972193 (ed5a1 hex)
AMAZON_SE # run flashargs
AMAZON_SE # bootm 0x00700000
## Booting image at 00700000 ...
   Image Name:   MIPS Linux-2.6.20
   Created:      2012-03-05   4:37:24 UTC
   Image Type:   MIPS Linux Kernel Image (lzma compressed)
   Data Size:    874532 Bytes = 854 kB
   Load Address: 80002000
   Entry Point:  802a2000
   Verifying Checksum ... OK
   Uncompressing Kernel Image ... OK

Starting kernel ...

Linux version 2.6.20-Amazon_SE
 (root@localhost.localdomain) (gcc version 3.4.4 20050119 (MIPS SDE)) #51 Mon Mar 5 12:37:17 CST 2012
Current Model:R0416_BSP_EPHY_SPI_HOST_A4
This model supports only basic BSP feature on Amazon SE Small board with SPI flash USB host and PPE A4 firmware
CPU revision is: 0001906c
Determined physical RAM map:
User-defined physical RAM map:
 memory: 02000000 @ 00000000 (usable)
Built 1 zonelists.  Total pages: 8128
Kernel command line: root=/dev/mtdblock4  mem=32M
Primary instruction cache 8kB, physically tagged, 4-way, linesize 16 bytes.
Primary data cache 8kB, 2-way, linesize 16 bytes.
Synthesized TLB refill handler (20 instructions).
Synthesized TLB load handler fastpath (32 instructions).
Synthesized TLB store handler fastpath (32 instructions).
Synthesized TLB modify handler fastpath (31 instructions).
PID hash table entries: 128 (order: 7, 512 bytes)
mips_hpt_frequency:133333333
r4k_offset: 00145855(1333333)
Using 133.333 MHz high precision timer.
Dentry cache hash table entries: 4096 (order: 2, 16384 bytes)
Inode-cache hash table entries: 2048 (order: 1, 8192 bytes)
Memory: 29520k/32768k available (2267k kernel code, 3248k reserved, 418k data, 132k init, 0k highmem)
Mount-cache hash table entries: 512
NET: Registered protocol family 16
SCSI subsystem initialized
usbcore: registered new interface driver usbfs
usbcore: registered new interface driver hub
usbcore: registered new device driver usb
NET: Registered protocol family 8
NET: Registered protocol family 20
NET: Registered protocol family 2
IP route cache hash table entries: 1024 (order: 0, 4096 bytes)
TCP established hash table entries: 1024 (order: 0, 4096 bytes)
TCP bind hash table entries: 512 (order: -1, 2048 bytes)
TCP: Hash tables configured (established 1024 bind 512)
TCP reno registered
amazon_se_dma_init
dma_chip_init
gptu: totally 6 16-bit timers/counters
gptu: misc_register on minor 63
gptu: succeeded to request irq 25 for timer[0]
gptu: succeeded to request irq 26 for timer[1]
gptu: succeeded to request irq 27 for timer[2]
gptu: succeeded to request irq 28 for timer[3]
gptu: succeeded to request irq 29 for timer[4]
gptu: succeeded to request irq 30 for timer[5]
squashfs: version 3.2-r2 (2007/01/15) Phillip Lougher
squashfs: LZMA suppport for slax.org by jro
fuse init (API version 7.8)
io scheduler noop registered (default)
Infineon Technologies port driver version 1.0.2
cgu: misc_register on minor = 62
led: misc_register on minor = 151
drivers/char/amazon_se_led.c amazon_se_led_config 1244: f_software_update = 1
drivers/char/amazon_se_led.c amazon_se_led_config 1244: f_software_update = 1
drivers/char/amazon_se_led.c amazon_se_led_config 1244: f_software_update = 1
drivers/char/amazon_se_led.c amazon_se_led_config 1244: f_software_update = 1
Unknown module try to reserve GPIO
Unknown module try to reserve GPIO
Infineon Technologies Synchronous Serial Controller (SSC) driver version 0.2.1
IFX MEI Version 4.00.01

Infineon CPE API Driver version: DSL CPE API V3.20.5.1

DSL_DRV: using proc fs
ttyS0 at MMIO 0xbe100c00 (irq = 2) is a IFX_ASC
PPP generic driver version 2.4.2
NET: Registered protocol family 24
IMQ starting with 2 devices...
IMQ driver loaded successfully.
        Hooking IMQ before NAT on PREROUTING.
        Hooking IMQ after NAT on POSTROUTING.
Loading A4 (ATM+MII0) driver ...... Force to 100MB Duplex
Succeeded!
PPE datapath driver info:
  Version ID: 8.3.5.1.0.0.1
  Family    : Amazon-SE
  DR Type   : Normal Data Path | Indirect-Fast Path
  Interface : MII0 | ATM
  Mode      : Routing
  Release   : 0.0.1
PPE firmware info:
  Version ID: 3.1.2.6.1.6
  Family    : Amazon-SE
  FW Type   : Standard
  Interface : MII0 + ATM
  Mode      : Bridging + IPv4 Routing
  Release   : 1.6
PPA API --- init successfully
Infineon Technologies Synchronous SPI flash driver version 0.0.1
MTD driver for SPI flash.
Probing for Serial flash ...
Update rx_eff_size to 4
 &lt;5&gt;Creating 8 MTD partitions on &quot;amazon_se-spi&quot;:
0x00000000-0x00020000 : &quot;U-Boot&quot;
0x00020000-0x00030000 : &quot;ENV_MAC&quot;
0x00030000-0x00040000 : &quot;DPF&quot;
0x00040000-0x00050000 : &quot;NVRAM&quot;
0x00050000-0x00700000 : &quot;RootFS_DPUMP&quot;
0x00700000-0x00800000 : &quot;Kernel&quot;
0x00050000-0x00800000 : &quot;ROOTFS_KERNEL&quot;
0x00000000-0x00020000 : &quot;POT&quot;
Update rx_eff_size to 4096
 &lt;6&gt;dwc_otg: version 2.2-RC3
dwc_otg dwc_otg: DWC OTG Controller
dwc_otg dwc_otg: new USB bus registered, assigned bus number 1
dwc_otg dwc_otg: irq 31, io mem 0x00000000
DWC_otg: Init: Power Port (0)
usb usb1: configuration #1 chosen from 1 choice
hub 1-0:1.0: USB hub found
hub 1-0:1.0: 1 port detected
nf_conntrack version 0.5.0 (256 buckets, 2048 max)
nf_ct_ftp: registering helper for pf: 2 port: 21
nf_ct_ftp: registering helper for pf: 10 port: 21
GRE over IPv4 tunneling driver
ip_tables: (C) 2000-2006 Netfilter Core Team
usb 1-1: new high speed USB device using dwc_otg and address 2
usb 1-1: configuration #1 chosen from 1 choice
TCP cubic registered
NET: Registered protocol family 1
NET: Registered protocol family 17
NET: Registered protocol family 8
atmpvc_init() failed with -17
802.1Q VLAN Support v1.8 Ben Greear &lt;greearb@candelatech.com&gt;
All bugs added by David S. Miller &lt;davem@redhat.com&gt;
Time: MIPS clocksource has been installed.
VFS: Mounted root (squashfs filesystem) readonly.
Freeing unused kernel memory: 132k freed
init started: BusyBox v1.13.1 (2012-03-01 17:48:55 CST
starting pid 14, tty &#039;&#039;: &#039;/usr/etc/rcS
Algorithmics/MIPS FPU Emulator v1.5
netfilter PSD loaded - (c) astaro AG
ipt_http_string: module license &#039;SERCOMM&#039; taints kernel.
init:866
cat: can&#039;t open &#039;/tmp/etc/block.htm&#039;: No such file or directory
insmod: cannot insert &#039;/lib/modules/igmp_snooping.ko&#039;: unknown symbol in module, or unknown parameter
device eth0 entered promiscuous mode
br0: port 1(eth0) entering learning state
userspace registering PID
cat: can&#039;t open &#039;/proc/nvram/BaseMacAddr&#039;: No such file or directory
ap_name=(null) action=start
/bin/echo GMT+0 &gt; /etc/TZ
killall: udhcpd: no process killed
iptables: No chain/target/match by that name
killall: miniupnpd: no process killed
killall: dnrd: no process killed
Notice: caching turned off
Warning: Using /etc/hosts will be removed in a future version. Please use only the /etc/dnrd/master file or use -m off.
dnrd -a 192.168.0.1 -m hosts -c off --timeout=0 -b  -s 1.1.1.1
Do not need swap cal data
Error doing ioctl(): Unknown error -1
Error doing ioctl(): Unknown error -1
Error doing ioctl(): Unknown error -1
Error doing ioctl(): Unknown error -1
Error doing ioctl(): Unknown error -1
Error doing ioctl(): Unknown error -1
Error doing ioctl(): Unknown error -1
Error doing ioctl(): Unknown error -1
Error doing ioctl(): Unknown error -1
Error doing ioctl(): Unknown error -1
Error doing ioctl(): Unknown error -1
Error doing ioctl(): Unknown error -1
Error doing ioctl(): Unknown error -1
Error doing ioctl(): Unknown error -1
Error doing ioctl(): Unknown error -1
Error doing ioctl(): Unknown error -1
Error doing ioctl(): Unknown error -1
Error doing ioctl(): Unknown error -1
interface ath0 does not exist!
Error doing ioctl(): Unknown error -1
Error doing ioctl(): Unknown error -1
ff
WaitForConfiguration
100

Please press Enter to activate this console. WaitForLinkActivate</code></pre></div><br /><p>Here is the original boot message from factory flash firmware</p><div class="codebox"><pre><code>ROM VER: 1.2.0
CFG 04
EEPROM Data OK


U-Boot 1.1.5-2.2 (Mar 19 2011 - 00:58:03)

DRAM:  32 MB

 relocate_code start
 relocate_code finish.
Now running in RAM - U-Boot at: 81fc0000
Flash:  8 MB
using default environment

In:    serial
Out:   serial
Err:   serial
Net:   External Clock
Selected EPHY_MODE
AMAZON_SE Switch
mac = 00:8e:f2:7f:45:a6
AMAZON_SE_GPIO_P0_IN = 0xa9ff..
AMAZON_SE_GPIO_P1_IN = 0x2b08..

Type &quot;run flash_nfs&quot; to mount root filesystem over NFS

Input Ctrl-c to stop autoboot:  0
Check FW intergality...OK
Ethernet Init Done!
SC: RX pkt len:148
SC: RX pkt len:60
SC: RX pkt len:86
SC: RX pkt len:90
SC: RX pkt len:60
SC: RX pkt len:90
SC: RX pkt len:60
SC: RX pkt len:1036
SC: RX pkt len:1056
SC: RX pkt len:86
SC: RX pkt len:66
SC: RX pkt len:1056
SC: RX pkt len:1036
SC: RX pkt len:62
SC: RX pkt len:110
SC: RX pkt len:698
SC: RX pkt len:718
SC: RX pkt len:698
SC: RX pkt len:718
SC: RX pkt len:60
SC: RX pkt len:86
SC: RX pkt len:66
SC: RX pkt len:148
SC: RX pkt len:175
SC: RX pkt len:60
No NMRP Server found
De-init Ethernet..Done!bootloader verion = 1.09
## Booting image at 00700000 ...
   Image Name:   MIPS Linux-2.6.20
   Created:      2012-03-05   4:37:24 UTC
   Image Type:   MIPS Linux Kernel Image (lzma compressed)
   Data Size:    874532 Bytes = 854 kB
   Load Address: 80002000
   Entry Point:  802a2000
   Verifying Checksum ... OK
   Uncompressing Kernel Image ... OK

Starting kernel ...

Linux version 2.6.20-Amazon_SE
 (root@localhost.localdomain) (gcc version 3.4.4 20050119 (MIPS SDE)) #51 Mon Mar 5 12:37:17 CST 2012
Current Model:R0416_BSP_EPHY_SPI_HOST_A4
This model supports only basic BSP feature on Amazon SE Small board with SPI flash USB host and PPE A4 firmware
CPU revision is: 0001906c
Determined physical RAM map:
User-defined physical RAM map:
 memory: 02000000 @ 00000000 (usable)
Built 1 zonelists.  Total pages: 8128
Kernel command line: root=/dev/mtdblock4 ip=192.168.1.1:192.168.1.2::::eth0:on console=ttyS0,115200 ethaddr=00:8e:f2:7f:45:a6 mem=32M panic=1
Primary instruction cache 8kB, physically tagged, 4-way, linesize 16 bytes.
Primary data cache 8kB, 2-way, linesize 16 bytes.
Synthesized TLB refill handler (20 instructions).
Synthesized TLB load handler fastpath (32 instructions).
Synthesized TLB store handler fastpath (32 instructions).
Synthesized TLB modify handler fastpath (31 instructions).
PID hash table entries: 128 (order: 7, 512 bytes)
mips_hpt_frequency:133333333
r4k_offset: 00145855(1333333)
Using 133.333 MHz high precision timer.
Dentry cache hash table entries: 4096 (order: 2, 16384 bytes)
Inode-cache hash table entries: 2048 (order: 1, 8192 bytes)
Memory: 29520k/32768k available (2267k kernel code, 3248k reserved, 418k data, 132k init, 0k highmem)
Mount-cache hash table entries: 512
NET: Registered protocol family 16
SCSI subsystem initialized
usbcore: registered new interface driver usbfs
usbcore: registered new interface driver hub
usbcore: registered new device driver usb
NET: Registered protocol family 8
NET: Registered protocol family 20
NET: Registered protocol family 2
IP route cache hash table entries: 1024 (order: 0, 4096 bytes)
TCP established hash table entries: 1024 (order: 0, 4096 bytes)
TCP bind hash table entries: 512 (order: -1, 2048 bytes)
TCP: Hash tables configured (established 1024 bind 512)
TCP reno registered
amazon_se_dma_init
dma_chip_init
gptu: totally 6 16-bit timers/counters
gptu: misc_register on minor 63
gptu: succeeded to request irq 25 for timer[0]
gptu: succeeded to request irq 26 for timer[1]
gptu: succeeded to request irq 27 for timer[2]
gptu: succeeded to request irq 28 for timer[3]
gptu: succeeded to request irq 29 for timer[4]
gptu: succeeded to request irq 30 for timer[5]
squashfs: version 3.2-r2 (2007/01/15) Phillip Lougher
squashfs: LZMA suppport for slax.org by jro
fuse init (API version 7.8)
io scheduler noop registered (default)
Infineon Technologies port driver version 1.0.2
cgu: misc_register on minor = 62
led: misc_register on minor = 151
drivers/char/amazon_se_led.c amazon_se_led_config 1244: f_software_update = 1
drivers/char/amazon_se_led.c amazon_se_led_config 1244: f_software_update = 1
drivers/char/amazon_se_led.c amazon_se_led_config 1244: f_software_update = 1
drivers/char/amazon_se_led.c amazon_se_led_config 1244: f_software_update = 1
Unknown module try to reserve GPIO
Unknown module try to reserve GPIO
Infineon Technologies Synchronous Serial Controller (SSC) driver version 0.2.1
IFX MEI Version 4.00.01

Infineon CPE API Driver version: DSL CPE API V3.20.5.1

DSL_DRV: using proc fs
ttyS0 at MMIO 0xbe100c00 (irq = 2) is a IFX_ASC
PPP generic driver version 2.4.2
NET: Registered protocol family 24
IMQ starting with 2 devices...
IMQ driver loaded successfully.
        Hooking IMQ before NAT on PREROUTING.
        Hooking IMQ after NAT on POSTROUTING.
Loading A4 (ATM+MII0) driver ...... Force to 100MB Duplex
Succeeded!
PPE datapath driver info:
  Version ID: 8.3.5.1.0.0.1
  Family    : Amazon-SE
  DR Type   : Normal Data Path | Indirect-Fast Path
  Interface : MII0 | ATM
  Mode      : Routing
  Release   : 0.0.1
PPE firmware info:
  Version ID: 3.1.2.6.1.6
  Family    : Amazon-SE
  FW Type   : Standard
  Interface : MII0 + ATM
  Mode      : Bridging + IPv4 Routing
  Release   : 1.6
PPA API --- init successfully
Infineon Technologies Synchronous SPI flash driver version 0.0.1
MTD driver for SPI flash.
Probing for Serial flash ...
Update rx_eff_size to 4
 &lt;5&gt;Creating 8 MTD partitions on &quot;amazon_se-spi&quot;:
0x00000000-0x00020000 : &quot;U-Boot&quot;
0x00020000-0x00030000 : &quot;ENV_MAC&quot;
0x00030000-0x00040000 : &quot;DPF&quot;
0x00040000-0x00050000 : &quot;NVRAM&quot;
0x00050000-0x00700000 : &quot;RootFS_DPUMP&quot;
0x00700000-0x00800000 : &quot;Kernel&quot;
0x00050000-0x00800000 : &quot;ROOTFS_KERNEL&quot;
0x00000000-0x00020000 : &quot;POT&quot;
Update rx_eff_size to 4096
 &lt;6&gt;dwc_otg: version 2.2-RC3
dwc_otg dwc_otg: DWC OTG Controller
dwc_otg dwc_otg: new USB bus registered, assigned bus number 1
dwc_otg dwc_otg: irq 31, io mem 0x00000000
DWC_otg: Init: Power Port (0)
usb usb1: configuration #1 chosen from 1 choice
hub 1-0:1.0: USB hub found
hub 1-0:1.0: 1 port detected
nf_conntrack version 0.5.0 (256 buckets, 2048 max)
nf_ct_ftp: registering helper for pf: 2 port: 21
nf_ct_ftp: registering helper for pf: 10 port: 21
GRE over IPv4 tunneling driver
ip_tables: (C) 2000-2006 Netfilter Core Team
usb 1-1: new high speed USB device using dwc_otg and address 2
usb 1-1: configuration #1 chosen from 1 choice
TCP cubic registered
NET: Registered protocol family 1
NET: Registered protocol family 17
NET: Registered protocol family 8
atmpvc_init() failed with -17
802.1Q VLAN Support v1.8 Ben Greear &lt;greearb@candelatech.com&gt;
All bugs added by David S. Miller &lt;davem@redhat.com&gt;
Time: MIPS clocksource has been installed.
VFS: Mounted root (squashfs filesystem) readonly.
Freeing unused kernel memory: 132k freed
init started: BusyBox v1.13.1 (2012-03-01 17:48:55 CST
starting pid 14, tty &#039;&#039;: &#039;/usr/etc/rcS
Algorithmics/MIPS FPU Emulator v1.5
netfilter PSD loaded - (c) astaro AG
ipt_http_string: module license &#039;SERCOMM&#039; taints kernel.
init:866
cat: can&#039;t open &#039;/tmp/etc/block.htm&#039;: No such file or directory
insmod: cannot insert &#039;/lib/modules/igmp_snooping.ko&#039;: unknown symbol in module, or unknown parameter
device eth0 entered promiscuous mode
br0: port 1(eth0) entering learning state
userspace registering PID
cat: can&#039;t open &#039;/proc/nvram/BaseMacAddr&#039;: No such file or directory
ap_name=(null) action=start
/bin/echo GMT+0 &gt; /etc/TZ
killall: udhcpd: no process killed
iptables: No chain/target/match by that name
killall: miniupnpd: no process killed
killall: dnrd: no process killed
Notice: caching turned off
Warning: Using /etc/hosts will be removed in a future version. Please use only the /etc/dnrd/master file or use -m off.
dnrd -a 192.168.0.1 -m hosts -c off --timeout=0 -b  -s 1.1.1.1
Do not need swap cal data
VAP-Name -- ath0
BGSCAN --   0
Fast-Frame-Txq-Min -- 1000
SHORT GI --   1
CWM MODE --   1
CWM EXTOFFSET --   1
CWM EXTPROTSPACING --   0
AMPDU --   1
TX CHAIN MASK --   1
RX CHAIN MASK --   1
HIDESSID --   0
APBRIDGE --   1
Frequency -- 0.0
SSID -- virginmedia0265831
COUNTRY CODE --   0x114
WDS --   0
MACCMD --   0
DOTH --   0
COUNTRY IE --   1

Please press Enter to activate this console. ff</code></pre></div><br /><p>The difference is right at the end of boot message</p><p>My manual tftpboot + bootm resulted in:</p><div class="codebox"><pre><code>cat: can&#039;t open &#039;/proc/nvram/BaseMacAddr&#039;: No such file or directory
ap_name=(null) action=start
/bin/echo GMT+0 &gt; /etc/TZ
killall: udhcpd: no process killed
iptables: No chain/target/match by that name
killall: miniupnpd: no process killed
killall: dnrd: no process killed
Notice: caching turned off
Warning: Using /etc/hosts will be removed in a future version. Please use only the /etc/dnrd/master file or use -m off.
dnrd -a 192.168.0.1 -m hosts -c off --timeout=0 -b  -s 1.1.1.1
Do not need swap cal data
Error doing ioctl(): Unknown error -1
Error doing ioctl(): Unknown error -1
Error doing ioctl(): Unknown error -1
Error doing ioctl(): Unknown error -1
Error doing ioctl(): Unknown error -1
Error doing ioctl(): Unknown error -1
Error doing ioctl(): Unknown error -1
Error doing ioctl(): Unknown error -1
Error doing ioctl(): Unknown error -1
Error doing ioctl(): Unknown error -1
Error doing ioctl(): Unknown error -1
Error doing ioctl(): Unknown error -1
Error doing ioctl(): Unknown error -1
Error doing ioctl(): Unknown error -1
Error doing ioctl(): Unknown error -1
Error doing ioctl(): Unknown error -1
Error doing ioctl(): Unknown error -1
Error doing ioctl(): Unknown error -1
interface ath0 does not exist!
Error doing ioctl(): Unknown error -1
Error doing ioctl(): Unknown error -1
ff
WaitForConfiguration
100

Please press Enter to activate this console. WaitForLinkActivate</code></pre></div><p>while normal boot without interruption ends with:</p><div class="codebox"><pre><code>cat: can&#039;t open &#039;/proc/nvram/BaseMacAddr&#039;: No such file or directory
ap_name=(null) action=start
/bin/echo GMT+0 &gt; /etc/TZ
killall: udhcpd: no process killed
iptables: No chain/target/match by that name
killall: miniupnpd: no process killed
killall: dnrd: no process killed
Notice: caching turned off
Warning: Using /etc/hosts will be removed in a future version. Please use only the /etc/dnrd/master file or use -m off.
dnrd -a 192.168.0.1 -m hosts -c off --timeout=0 -b  -s 1.1.1.1
Do not need swap cal data
VAP-Name -- ath0
BGSCAN --   0
Fast-Frame-Txq-Min -- 1000
SHORT GI --   1
CWM MODE --   1
CWM EXTOFFSET --   1
CWM EXTPROTSPACING --   0
AMPDU --   1
TX CHAIN MASK --   1
RX CHAIN MASK --   1
HIDESSID --   0
APBRIDGE --   1
Frequency -- 0.0
SSID -- virginmedia0265831
COUNTRY CODE --   0x114
WDS --   0
MACCMD --   0
DOTH --   0
COUNTRY IE --   1

Please press Enter to activate this console. ff</code></pre></div>											<p class="post-edited">(Last edited by <strong>krembuk</strong> on 21 May 2016, 14:29)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p325213">
				<div class="post-metadata">
					<div class="post-num">Post #38</div>
					<div class="post-author">zx82</div>
					<div class="post-datetime">
						22 May 2016, 01:34					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>zx82 wrote:</cite><blockquote><p>That RAM map looks screwy.</p></blockquote></div><p>I tried overriding it with a &quot;mem=32M&quot; kernel cmdline via U-Boot bootargs, which didn&#039;t work (bootargs doesn&#039;t seem to get passed in the way the kernel expects, so can&#039;t be used in place of/as an extension of device tree args).&nbsp; So I put the mem=32M into the device tree.&nbsp; &nbsp;That got things as far as enumerating the MTD partitions and panicked because no root is set; so root=... went in the device tree too.</p><p>Next, a rootfs.&nbsp; Being too impatient and lazy to build the rootfs just yet, I grabbed a generic one.&nbsp; I used Attitude Adjustment instead of BB or CC because the latter may be built for Danube/VRX units with 34Kc support, not this unit with 4KEc.&nbsp; Did try a CC, but it hung in init; didn&#039;t hear a peep after:<br /></p><div class="codebox"><pre><code>[    0.689279] VFS: Mounted root (squashfs filesystem) readonly on device 31:3.
[    0.701317] Freeing unused kernel memory: 1236K (8046b000 - 805a0000)
[    1.213739] random: nonblocking pool is initialized</code></pre></div><p>The AA userspace boots atop a trunk kernel, but with two problems.&nbsp; One, the overlay never comes up, because AA checks for JFFS2 magic &quot;deadc0de&quot; but trunk&#039;s JFFS2 uses &quot;19852003&quot;, so AA thinks the FS creation hasn&#039;t completed.&nbsp; Two, no ethernet; the drivers complain of:<br /></p><div class="codebox"><pre><code>[    0.578485] libphy: ltq_mii: probed
[    0.580739] eth0 (uninitialized): no PHY found
[    0.585350] etop: mdio probe failed</code></pre></div><p>This process unearthed some problems with stock U-Boot (besides the bootargs problem).&nbsp; Turns out it ignores the settings in <span class="bbu">mtdblock1</span> (it fakes the CRC check on the partition, pretending it failed) and always uses its own embedded defaults.&nbsp; Saving variables is also disabled (wouldn&#039;t be any use).&nbsp; This is annoying because trunk kernels don&#039;t fit in the default last-meg-of-flash location, but you can&#039;t change where it looks for the kernel without rebuilding U-Boot or intervening every time.&nbsp; It has no facility to erase portions of serial flash either.&nbsp; That provokes the initial JFFS format into very loud complaints about the flash not being empty, but can be worked around with <span class="bbu">mtd erase</span>.</p><p>Next up: build a trunk rootfs, and see if that ethernet thing can be explained.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p325221">
				<div class="post-metadata">
					<div class="post-num">Post #39</div>
					<div class="post-author">zx82</div>
					<div class="post-datetime">
						22 May 2016, 02:10					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>krembuk wrote:</cite><blockquote><p>I think I experienced what you got earlier. This time it works when I changed the load address:<br /></p><div class="codebox"><pre><code>AMAZON_SE # tftpboot 0x00700000 uImage
...
AMAZON_SE # bootm 0x00700000
## Booting image at 00700000 ...
   Image Name:   MIPS Linux-2.6.20
...</code></pre></div></blockquote></div><p>I don&#039;t think that&#039;s doing what you think it&#039;s doing.&nbsp; <span class="bbu">tftpboot</span> reads an image from the network into memory, but (stock) U-Boot treats 0x0 through 0x00800000 as flash.&nbsp; It seems unlikely it&#039;d let you do both (i.e. network straight into flash) in one go; in that case I&#039;m not sure quite what it does, but it doesn&#039;t look like it&#039;s doing what you want.</p><p>You need to decide:<br /></p><ul><li><p>Are you going to send kernels every time you want to boot them? (slow, boring, repetitive, but saves flash wear and lets you test kernels bigger than 1MiB).&nbsp; If so, use &quot;<span class="bbu">tftpboot 0x81000000</span>&quot; then &quot;<span class="bbu">bootm 0x81000000</span>&quot;.&nbsp; At the time U-Boot is running, <span class="bbu">0x81000000</span> is smack-bang in the middle of (unused) RAM.</p></li><li><p>Or are you going to flash kernels each time which are always smaller than 1MiB?&nbsp; If the kernel is mostly working (perhaps you&#039;re working on userspace fixes), flashing it saves sending it again the next time you boot.&nbsp; If so, to flash you need to &quot;<span class="bbu">tftpboot 0x81000000</span>&quot; then &quot;<span class="bbu">cp.b 0x81000000 0x700000 $(filesize)</span>&quot;.&nbsp; Then &quot;<span class="bbu">bootm</span>&quot;.</p></li><li><p>If you want to do something else, U-Boot is going to get in your way unless you hack and rebuild it.</p></li></ul><div class="quotebox"><cite>krembuk wrote:</cite><blockquote><p>BTW, when I tried to go into pressing Ctrl-C quickly after turning on the power, I once got:</p><div class="codebox"><pre><code>ROM VER: 1.2.0
CFG 04
UART</code></pre></div><p>instead of</p><div class="codebox"><pre><code>ROM VER: 1.2.0
CFG 04
EEPROM Data OK</code></pre></div></blockquote></div><p>Given that it didn&#039;t say &quot;EEPROM Data OK&quot;, I&#039;d guess that either the power wasn&#039;t stable and the flash chip was in a funny state, or that a stray wire or something touched the flash.&nbsp; You can force UART mode by doing something nasty like pulling the flash /CE high, or by corrupting the flash signature.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p325235">
				<div class="post-metadata">
					<div class="post-num">Post #40</div>
					<div class="post-author">zx82</div>
					<div class="post-datetime">
						22 May 2016, 04:51					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>zx82 wrote:</cite><blockquote><p>see if that ethernet thing can be explained.</p></blockquote></div><p>Basic ethernet now works on that trunk kernel too.&nbsp; Haven&#039;t tested switch/VLANs (there&#039;s no swconfig in the generic AA rootfs anyway).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p325247">
				<div class="post-metadata">
					<div class="post-num">Post #41</div>
					<div class="post-author">krembuk</div>
					<div class="post-datetime">
						22 May 2016, 08:37					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>zx82 wrote:</cite><blockquote><p>I don&#039;t think that&#039;s doing what you think it&#039;s doing.&nbsp; <span class="bbu">tftpboot</span> reads an image from the network into memory, but (stock) U-Boot treats 0x0 through 0x00800000 as flash.&nbsp; It seems unlikely it&#039;d let you do both (i.e. network straight into flash) in one go; in that case I&#039;m not sure quite what it does, but it doesn&#039;t look like it&#039;s doing what you want.</p><p>You need to decide:<br /></p><ul><li><p>Are you going to send kernels every time you want to boot them? (slow, boring, repetitive, but saves flash wear and lets you test kernels bigger than 1MiB).&nbsp; If so, use &quot;<span class="bbu">tftpboot 0x81000000</span>&quot; then &quot;<span class="bbu">bootm 0x81000000</span>&quot;.&nbsp; At the time U-Boot is running, <span class="bbu">0x81000000</span> is smack-bang in the middle of (unused) RAM.</p></li><li><p>Or are you going to flash kernels each time which are always smaller than 1MiB?&nbsp; If the kernel is mostly working (perhaps you&#039;re working on userspace fixes), flashing it saves sending it again the next time you boot.&nbsp; If so, to flash you need to &quot;<span class="bbu">tftpboot 0x81000000</span>&quot; then &quot;<span class="bbu">cp.b 0x81000000 0x700000 $(filesize)</span>&quot;.&nbsp; Then &quot;<span class="bbu">bootm</span>&quot;.</p></li><li><p>If you want to do something else, U-Boot is going to get in your way unless you hack and rebuild it.</p></li></ul></blockquote></div><p>I did tftpboot to test the externally built kernels, I&#039;m a newbie in this kind of &quot;cooking class&quot;. I don&#039;t want to brick this device in the first place, so I always took safety measures before replacing any mtdblock, by transferring anything into memory and not touching the mtd in any way until I know what I have is 100% working.</p><p>You seem to build something in trunk. Are you porting Amazon SE to trunk?<br />The u-boot source code is available as part of the GPL source of the factory firmware.</p><p>BTW, could give me comment about USB-mod suitable for this device? It has a place for USB port (J2, lower right side), the factory kernel detects USB, but seems there is one missing chip on board for USB. I&#039;m still thinking of USB storage to hold backup of the MTDs. Probably I can use ramdisk and a little trick with httpd, and this USB mod is a bit distraction to me, but having USB storage working sounds cool <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p><span class="postimg"><img src="https://farm8.staticflickr.com/7308/26888697650_b888b2e43b_z.jpg" alt="https://farm8.staticflickr.com/7308/26888697650_b888b2e43b_z.jpg" /></span></p>											<p class="post-edited">(Last edited by <strong>krembuk</strong> on 22 May 2016, 08:38)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p325265">
				<div class="post-metadata">
					<div class="post-num">Post #42</div>
					<div class="post-author">zx82</div>
					<div class="post-datetime">
						22 May 2016, 12:16					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>krembuk wrote:</cite><blockquote><p>I don&#039;t want to brick this device in the first place, so I always took safety measures before replacing any mtdblock, by transferring anything into memory and not touching the mtd in any way until I know what I have is 100% working.</p></blockquote></div><p>Backups are important, and avoiding bricking saves time!&nbsp; But in this case I think U-Boot&#039;s memory map is tricking you into doing something <em>more</em> dangerous.&nbsp; Once U-Boot gives you a prompt on this unit, it makes memory appear like this:<br /></p><ul><li><p><strong>0x00000000 -- 0x00800000</strong>: U-Boot pretends this region is memory, when it&#039;s really flash.&nbsp; If you <span class="bbu">cp.b</span> to there, you&#039;re actually writing to the serial flash.&nbsp; (I don&#039;t think this is a genuine hardware mapping, just something faked by U-Boot, either with exception handlers or just by translating addresses you type.)</p></li><li><p><strong>0x80000000 -- 0x80002000</strong>: this is RAM, but is typically used for exception handlers so is not a good place to put anything.</p></li><li><p><strong>0x80002000 -- 0x81fc0000</strong>: free for you or U-Boot to copy things into; in particular, if you <span class="bbu">bootm</span> from somewhere within 0x00000000 -- 0x00800000, what U-Boot will really do is copy the kernel from flash into somewhere in this region before running it.&nbsp; When it&#039;s a Linux image, it&#039;ll also be decompressed (maybe by U-Boot, maybe by its own decompresser) to somewhere else in RAM.&nbsp; Typically it&#039;s safest to use addresses in the middle for scratchpad, so that nothing else conflicts.</p></li><li><p><strong>0x81fc0000 -- 0x82000000</strong>: after the ROM loads U-Boot, U-Boot decompresses itself and then relocates itself to here, the highest 256KiB.&nbsp; U-Boot runs from here, so don&#039;t write to it.</p></li></ul><p>So: feel free to put kernel images in the middle of free RAM before booting them, or to put kernel images or payloads you want to flash in the free RAM before flashing them.&nbsp; But you should only be using flash addresses <span class="bbu">when flashing</span>.</p><div class="quotebox"><cite>krembuk wrote:</cite><blockquote><p>You seem to build something in trunk. Are you porting Amazon SE to trunk?</p></blockquote></div><p>Support for AmazonSE in Linux/OpenWrt was added, and basically finished, by John Crispin (blogic) and others back in 2011--2013.&nbsp; Unfortunately the <em>build system</em> support in OpenWrt missed Attitude Adjustment and didn&#039;t get enough testing so it got removed before Barrier Breaker, but all the <em>code</em> supporting the AmazonSE platform is still there.&nbsp; So I&#039;m just restoring the glue that makes it build.&nbsp; You couldn&#039;t really call it porting.</p><p>I&#039;m basing this on trunk because before January (i.e. Chaos Calmer and earlier) the serial flash driver was buggy.</p><p>No promises, but things are looking encouraging right now.&nbsp; I&#039;ll keep this thread updated with progress.&nbsp; If support progresses enough to call it useful, I&#039;ll update the <a href="https://wiki.openwrt.org/toh/netgear/dgn1000b">wiki page</a> and consider asking the maintainers to resurrect it officially.</p><div class="quotebox"><cite>krembuk wrote:</cite><blockquote><p>The u-boot source code is available as part of the GPL source of the factory firmware.</p></blockquote></div><p>Yes, but I really hate building/tweaking manufacturer source dumps, and while there&#039;s other productive stuff I can be doing, I will avoid it.&nbsp; When I do it (if it builds with OpenWrt&#039;s toolchain without too much pain) I&#039;ll post the patch, the new binary, and a payload for UART mode booting.</p><div class="quotebox"><cite>krembuk wrote:</cite><blockquote><p>BTW, could give me comment about USB-mod suitable for this device?</p></blockquote></div><p>The board uses its USB hardware to talk to the WiFi chipset, directly.&nbsp; The manufacturer built the board with the option of a hub and a USB port, but chose not to use it.&nbsp; The hub chip they left out is no longer made and would need various support bits.&nbsp; So, broadly, you can:<br /></p><ul><li><p>with some hacking, have one USB port <strong>instead of WiFi</strong> (to which you could add an external powered hub)</p></li><li><p>find a perfectly compatible replacement USB hub chip, and obtain and solder lots of fine-pitch components, giving you onboard WiFi <em>and</em> a USB port</p></li></ul><p>So neither option sounds like much fun.</p>											<p class="post-edited">(Last edited by <strong>zx82</strong> on 22 May 2016, 14:20)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p325422">
				<div class="post-metadata">
					<div class="post-num">Post #43</div>
					<div class="post-author">krembuk</div>
					<div class="post-datetime">
						23 May 2016, 10:18					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>zx82 wrote:</cite><blockquote><p>Backups are important, and avoiding bricking saves time!&nbsp; But in this case I think U-Boot&#039;s memory map is tricking you into doing something <em>more</em> dangerous.</p></blockquote></div><p>Thanks, learned something again. So I was just lucky putting that uImage into flash memory map, but it didn&#039;t replace the original thing.<br />I still have that LZMA problem with the uImage if I tftp it into 0x8*****, but I&#039;ll keep looking.</p><div class="quotebox"><cite>zx82 wrote:</cite><blockquote><p>No promises, but things are looking encouraging right now.&nbsp; I&#039;ll keep this thread updated with progress.&nbsp; If support progresses enough to call it useful, I&#039;ll update the <a href="https://wiki.openwrt.org/toh/netgear/dgn1000b">wiki page</a> and consider asking the maintainers to resurrect it officially.</p></blockquote></div><p>Hearing that you&#039;re doing something on this is giving me hope, actually <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><div class="quotebox"><cite>zx82 wrote:</cite><blockquote><p>The board uses its USB hardware ....<br />So neither option sounds like much fun.</p></blockquote></div><p>I&#039;m dropping that idea, now. Thanks!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p325446">
				<div class="post-metadata">
					<div class="post-num">Post #44</div>
					<div class="post-author">krembuk</div>
					<div class="post-datetime">
						23 May 2016, 14:25					</div>
				</div>
				<div class="post-content content">
					<p>Ha! My LZMA issue was caused the default tftpboot is using 0x80001000 instead of 0x80002000<br />I just realized that after reading it many times. Looks like I can&#039;t trust the default options.</p><p>Here it is using the factory GPL kernel:</p><div class="codebox"><pre><code>AMAZON_SE # tftpboot 0x80200000 uImage
Using AMAZON_SE Switch device
TFTP from server 192.168.1.2; our IP address is 192.168.1.1
Filename &#039;uImage&#039;.
Load address: 0x80200000
Loading: #################################################################
         #################################################################
         #########################
done
Bytes transferred = 791515 (c13db hex)
AMAZON_SE #  tftpboot 0x80200000 uImage
Using AMAZON_SE Switch device
TFTP from server 192.168.1.2; our IP address is 192.168.1.1
Filename &#039;uImage&#039;.
Load address: 0x80200000
Loading: #################################################################
         #################################################################
         #########################
done
Bytes transferred = 791515 (c13db hex)
AMAZON_SE # bootm 0x80200000
## Booting image at 80200000 ...
   Image Name:   MIPS Linux-2.6.20
   Created:      2016-05-20   2:08:16 UTC
   Image Type:   MIPS Linux Kernel Image (lzma compressed)
   Data Size:    791451 Bytes = 772.9 kB
   Load Address: 80002000
   Entry Point:  80265000
   Verifying Checksum ... OK
   Uncompressing Kernel Image ... OK

Starting kernel ...

Linux version 2.6.20-Amazon_SE
 (root@threef) (gcc version 3.4.4 20050119 (MIPS SDE)) #64 Fri May 20 08:46:11 WIB 2016
Current Model:R0416_BSP_EPHY_SPI_HOST_A4
This model supports only basic BSP feature on Amazon SE Small board with SPI flash USB host and PPE A4 firmware
CPU revision is: 0001906c
Determined physical RAM map:
User-defined physical RAM map:
 memory: 02000000 @ 00000000 (usable)
Built 1 zonelists.  Total pages: 8128
Kernel command line:  mem=32M
Primary instruction cache 8kB, physically tagged, 4-way, linesize 16 bytes.
Primary data cache 8kB, 2-way, linesize 16 bytes.
Synthesized TLB refill handler (20 instructions).
Synthesized TLB load handler fastpath (32 instructions).
Synthesized TLB store handler fastpath (32 instructions).
Synthesized TLB modify handler fastpath (31 instructions).
PID hash table entries: 128 (order: 7, 512 bytes)
mips_hpt_frequency:133333333
r4k_offset: 00145855(1333333)
Using 133.333 MHz high precision timer.
Dentry cache hash table entries: 4096 (order: 2, 16384 bytes)
Inode-cache hash table entries: 2048 (order: 1, 8192 bytes)
Memory: 29772k/32768k available (2064k kernel code, 2996k reserved, 377k data, 128k init, 0k highmem)
Mount-cache hash table entries: 512
NET: Registered protocol family 16
usbcore: registered new interface driver usbfs
usbcore: registered new interface driver hub
usbcore: registered new device driver usb
NET: Registered protocol family 8
NET: Registered protocol family 20
NET: Registered protocol family 2
IP route cache hash table entries: 1024 (order: 0, 4096 bytes)
TCP established hash table entries: 1024 (order: 0, 4096 bytes)
TCP bind hash table entries: 512 (order: -1, 2048 bytes)
TCP: Hash tables configured (established 1024 bind 512)
TCP reno registered
amazon_se_dma_init
dma_chip_init
gptu: totally 6 16-bit timers/counters
gptu: misc_register on minor 63
gptu: succeeded to request irq 25 for timer[0]
gptu: succeeded to request irq 26 for timer[1]
gptu: succeeded to request irq 27 for timer[2]
gptu: succeeded to request irq 28 for timer[3]
gptu: succeeded to request irq 29 for timer[4]
gptu: succeeded to request irq 30 for timer[5]
squashfs: version 3.2-r2 (2007/01/15) Phillip Lougher
squashfs: LZMA suppport for slax.org by jro
io scheduler noop registered (default)
Infineon Technologies port driver version 1.0.2
cgu: misc_register on minor = 62
led: misc_register on minor = 151
drivers/char/amazon_se_led.c amazon_se_led_config 1244: f_software_update = 1
drivers/char/amazon_se_led.c amazon_se_led_config 1244: f_software_update = 1
drivers/char/amazon_se_led.c amazon_se_led_config 1244: f_software_update = 1
drivers/char/amazon_se_led.c amazon_se_led_config 1244: f_software_update = 1
Unknown module try to reserve GPIO
Unknown module try to reserve GPIO
Infineon Technologies Synchronous Serial Controller (SSC) driver version 0.2.1
IFX MEI Version 4.00.01

Infineon CPE API Driver version: DSL CPE API V3.20.5.1

DSL_DRV: using proc fs
ttyS0 at MMIO 0xbe100c00 (irq = 2) is a IFX_ASC
PPP generic driver version 2.4.2
NET: Registered protocol family 24
IMQ starting with 2 devices...
IMQ driver loaded successfully.
        Hooking IMQ before NAT on PREROUTING.
        Hooking IMQ after NAT on POSTROUTING.
Loading A4 (ATM+MII0) driver ...... Force to 100MB Duplex
Succeeded!
PPE datapath driver info:
  Version ID: 8.3.5.1.0.0.1
  Family    : Amazon-SE
  DR Type   : Normal Data Path | Indirect-Fast Path
  Interface : MII0 | ATM
  Mode      : Routing
  Release   : 0.0.1
PPE firmware info:
  Version ID: 3.1.2.6.1.6
  Family    : Amazon-SE
  FW Type   : Standard
  Interface : MII0 + ATM
  Mode      : Bridging + IPv4 Routing
  Release   : 1.6
PPA API --- init successfully
Infineon Technologies Synchronous SPI flash driver version 0.0.1
MTD driver for SPI flash.
Probing for Serial flash ...
Update rx_eff_size to 4
 &lt;5&gt;Creating 8 MTD partitions on &quot;amazon_se-spi&quot;:
0x00000000-0x00020000 : &quot;U-Boot&quot;
0x00020000-0x00030000 : &quot;ENV_MAC&quot;
0x00030000-0x00040000 : &quot;DPF&quot;
0x00040000-0x00050000 : &quot;NVRAM&quot;
0x00050000-0x00700000 : &quot;RootFS_DPUMP&quot;
0x00700000-0x00800000 : &quot;Kernel&quot;
0x00050000-0x00800000 : &quot;ROOTFS_KERNEL&quot;
0x00000000-0x00020000 : &quot;POT&quot;
Update rx_eff_size to 4096
 &lt;6&gt;dwc_otg: version 2.2-RC3
dwc_otg dwc_otg: DWC OTG Controller
dwc_otg dwc_otg: new USB bus registered, assigned bus number 1
dwc_otg dwc_otg: irq 31, io mem 0x00000000
DWC_otg: Init: Power Port (0)
usb usb1: configuration #1 chosen from 1 choice
hub 1-0:1.0: USB hub found
hub 1-0:1.0: 1 port detected
nf_conntrack version 0.5.0 (256 buckets, 2048 max)
nf_ct_ftp: registering helper for pf: 2 port: 21
nf_ct_ftp: registering helper for pf: 10 port: 21
GRE over IPv4 tunneling driver
ip_tables: (C) 2000-2006 Netfilter Core Team
usb 1-1: new high speed USB device using dwc_otg and address 2
usb 1-1: configuration #1 chosen from 1 choice
TCP cubic registered
NET: Registered protocol family 1
NET: Registered protocol family 17
NET: Registered protocol family 8
atmpvc_init() failed with -17
802.1Q VLAN Support v1.8 Ben Greear &lt;greearb@candelatech.com&gt;
All bugs added by David S. Miller &lt;davem@redhat.com&gt;
VFS: Cannot open root device &quot;&lt;NULL&gt;&quot; or unknown-block(0,0)
Please append a correct &quot;root=&quot; boot option
Time: MIPS clocksource has been installed.
Kernel panic - not syncing: VFS: Unable to mount root fs on unknown-block(0,0)</code></pre></div><p>but now I still can&#039;t reproduce the boot, using exactly the same parameter. Getting that LZMA issue again. Strange.</p>											<p class="post-edited">(Last edited by <strong>krembuk</strong> on 23 May 2016, 15:04)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p325450">
				<div class="post-metadata">
					<div class="post-num">Post #45</div>
					<div class="post-author">zx82</div>
					<div class="post-datetime">
						23 May 2016, 14:57					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>krembuk wrote:</cite><blockquote><p>Ha! My LZMA issue was caused the default tftpboot is using 0x80001000 instead of 0x80002000<br />I just realized that after reading it many times. Looks like I can&#039;t trust the default options.</p></blockquote></div><p>So your self-built kernel boots now?</p><div class="quotebox"><cite>krembuk wrote:</cite><blockquote><p>Hearing that you&#039;re doing something on this is giving me hope, actually</p></blockquote></div><p>The current status here is that a very slightly modified trunk builds, boots to userspace and has working basic ethernet.&nbsp; The switch (VLANs) and the WiFi don&#039;t work yet.</p><p>The WiFi problem manifests as the USB driver re-registering many times after being recognised:<br /></p><div class="codebox"><pre><code>[    8.244590] IFXUSB: ifxusb_hcd: version 3.2 B110801
[    8.762205] IFXUSB: USB core #0 soft-reset
[    8.970154] IFXUSB: USB core #0 soft-reset
[    8.973044] ifxusb_hcd ifxusb_hcd: IFX USB Controller
[    8.978141] ifxusb_hcd ifxusb_hcd: new USB bus registered, assigned bus number 1
[    8.985451] ifxusb_hcd ifxusb_hcd: irq 39, io mem 0xbe101000
[    8.990965] IFXUSB: Init: Power Port (0)
[    9.001593] hub 1-0:1.0: USB hub found
[    9.005529] hub 1-0:1.0: 1 port detected
[    9.017500] IFXUSB: ifxusb_hcd: version 3.2 B110801
[    9.021154] Error: Driver &#039;ifxusb_hcd&#039; is already registered, aborting...
[    9.027863] IFXUSB: ifxusb_hcd_driver_init retval=-16
[    9.042089] IFXUSB: ifxusb_hcd: version 3.2 B110801
[    9.045744] Error: Driver &#039;ifxusb_hcd&#039; is already registered, aborting...
[    9.052453] IFXUSB: ifxusb_hcd_driver_init retval=-16</code></pre></div><p>Unsurprisingly this interferes with the WiFi driver loading:<br /></p><div class="codebox"><pre><code>[   19.632170] usb 1-1: ath9k_htc: Transferred FW: ath9k_htc/htc_9271-1.4.0.fw, size: 51008
[   21.491450] usb 1-1: Service connection timeout for: 256
[   21.495836] ath9k_htc 1-1:1.0: ath9k_htc: Unable to initialize HTC services
[   21.502820] ath9k_htc: Failed to initialize the device
[   21.521298] usb 1-1: ath9k_htc: USB layer deinitialized</code></pre></div><p>The switch comes up fine in EPHY mode (as though just plugged into the switch with an ethernet cable, no swconfig or /proc/switch):<br /></p><div class="codebox"><pre><code>[    0.573527] Selected EPHY mode
[    0.591467] libphy: ltq_mii: probed
[    0.601018] eth0: attached PHY [Generic PHY] (phy_addr=1e180000.etop-ff:08, irq=-1)</code></pre></div><p>But in MII mode, no such luck:<br /></p><div class="codebox"><pre><code>[    1.052588] libphy: ltq_mii: probed
[    1.062018] eth0 (uninitialized): no PHY found</code></pre></div><p>even though <span class="bbu">CONFIG_AR8216_PHY=y</span> in my kernel.&nbsp; Some added debug tells me all 32 MDIO addresses look empty in MII mode.</p><p>It <em>should</em> look like it does on some Danube-based units with working switches (spw504v):<br /></p><div class="codebox"><pre><code>[ 0.576000] switch0: Atheros AR8216 rev. 1 switch registered on 1e180000.etop-ff
[ 0.616000] libphy: ltq_mii: probed
[ 0.656000] eth0: attached PHY [Atheros AR8216/AR8236/AR8316] (phy_addr=1e180000.etop-ff:00, irq=-1)</code></pre></div><p>I&#039;m somewhat out of my depth on both problems at this point.&nbsp; Besides seeing what a bit more debug tells me about the probe process, I have one more thing to investigate before I cry for help from upstream: I have a TG585v8 which has the same SoC but a BCM5325 switch.&nbsp; I notice it has a 25MHz crystal only for the switch, whereas the DGN1000 has a 25MHz crystal both on the switch and on the SoC, which might hint at this being a clock source problem.&nbsp; I&#039;ll try adding b53 support to this kernel, UART-booting the TG585v8 (which is otherwise entirely locked down) with it, and see if the switch on that one gets detected in MII mode.&nbsp; That would at least indicate that AmazonSE can do MII mode with the current driver.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p325453">
				<div class="post-metadata">
					<div class="post-num">Post #46</div>
					<div class="post-author">krembuk</div>
					<div class="post-datetime">
						23 May 2016, 15:08					</div>
				</div>
				<div class="post-content content">
					<p>Found it. I have to run </p><div class="codebox"><pre><code>tftpboot 0x80200000 uImage</code></pre></div><p> twice so it won&#039;t stuck with LZMA decode error. What kind of voodoo is this?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p325456">
				<div class="post-metadata">
					<div class="post-num">Post #47</div>
					<div class="post-author">krembuk</div>
					<div class="post-datetime">
						23 May 2016, 15:15					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>zx82 wrote:</cite><blockquote><p>So your self-built kernel boots now?</p></blockquote></div><p>Yes, it does, from the factory GPL source. Only that it complains on the wireless parts, seems it can&#039;t find the art partition.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p325458">
				<div class="post-metadata">
					<div class="post-num">Post #48</div>
					<div class="post-author">zx82</div>
					<div class="post-datetime">
						23 May 2016, 15:21					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>krembuk wrote:</cite><blockquote><p>Yes, it does, from the factory GPL source. Only that it complains on the wireless parts, seems it can&#039;t find the art partition.</p></blockquote></div><p>I&#039;m not convinced there is one.&nbsp; What&#039;s the error message?&nbsp; The only reference to Atheros in the stock blob is within the U-Boot env partition, and it&#039;s pretty short (might be regional radio or MAC address settings, but doesn&#039;t look like a firmware).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p325460">
				<div class="post-metadata">
					<div class="post-num">Post #49</div>
					<div class="post-author">krembuk</div>
					<div class="post-datetime">
						23 May 2016, 15:35					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>zx82 wrote:</cite><blockquote><div class="quotebox"><cite>krembuk wrote:</cite><blockquote><p>Yes, it does, from the factory GPL source. Only that it complains on the wireless parts, seems it can&#039;t find the art partition.</p></blockquote></div><p>I&#039;m not convinced there is one.&nbsp; What&#039;s the error message?&nbsp; The only reference to Atheros in the stock blob is within the U-Boot env partition, and it&#039;s pretty short (might be regional radio or MAC address settings, but doesn&#039;t look like a firmware).</p></blockquote></div><br /><p>Please wait, I&#039;m having that LZMA error again, though I ran tftpboot twice. Seems like running twice tftpboot is not the solution. Basically it is similar with issue that I posted earlier, on the difference between the automatic internal flash booting and the manual tftp booting.</p><p>But maybe you&#039;re right, because I only use rootfs=/dev/mtdblock4 for the boot param. Looks like I need to add MAC etc, based on printenv.</p><p>Will try again tomorrow..</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p325467">
				<div class="post-metadata">
					<div class="post-num">Post #50</div>
					<div class="post-author">krembuk</div>
					<div class="post-datetime">
						23 May 2016, 16:00					</div>
				</div>
				<div class="post-content content">
					<p>OK. I have to let it &quot;cool down&quot; after turning off power, then I won&#039;t have that LZMA issue.<br />Now I add &quot;run addmisc&quot; to add boot param, which according to printenv:</p><div class="codebox"><pre><code>addmisc=setenv bootargs $(bootargs) console=ttyS0,$(baudrate) ethaddr=$(ethaddr) mem=$(mem) panic=1</code></pre></div><p>And it boots properly:</p><div class="codebox"><pre><code>AMAZON_SE # tftpboot 0x80200000  uImage.comp
Using AMAZON_SE Switch device
TFTP from server 192.168.1.2; our IP address is 192.168.1.1
Filename &#039;uImage.comp&#039;.
Load address: 0x80200000
Loading: checksum bad
checksum bad
checksum bad
checksum bad
checksum bad
checksum bad
#################################################################
         #################################################################
         #########################
done
Bytes transferred = 791515 (c13db hex)
AMAZON_SE #  tftpboot 0x80200000  uImage.comp
Using AMAZON_SE Switch device
TFTP from server 192.168.1.2; our IP address is 192.168.1.1
Filename &#039;uImage.comp&#039;.
Load address: 0x80200000
Loading: #################################################################
         #################################################################
         #########################
done
Bytes transferred = 791515 (c13db hex)
AMAZON_SE # run flashargs
AMAZON_SE # run addmisc
AMAZON_SE # bootm 0x80200000
## Booting image at 80200000 ...
   Image Name:   MIPS Linux-2.6.20
   Created:      2016-05-20   2:08:16 UTC
   Image Type:   MIPS Linux Kernel Image (lzma compressed)
   Data Size:    791451 Bytes = 772.9 kB
   Load Address: 80002000
   Entry Point:  80265000
   Verifying Checksum ... OK
   Uncompressing Kernel Image ... OK

Starting kernel ...

Linux version 2.6.20-Amazon_SE
 (root@threef) (gcc version 3.4.4 20050119 (MIPS SDE)) #64 Fri May 20 08:46:11 WIB 2016
Current Model:R0416_BSP_EPHY_SPI_HOST_A4
This model supports only basic BSP feature on Amazon SE Small board with SPI flash USB host and PPE A4 firmware
CPU revision is: 0001906c
Determined physical RAM map:
User-defined physical RAM map:
 memory: 02000000 @ 00000000 (usable)
Built 1 zonelists.  Total pages: 8128
Kernel command line: root=/dev/mtdblock4 console=ttyS0,115200 ethaddr=00:8e:f2:7f:45:a6 mem=32M panic=1
Primary instruction cache 8kB, physically tagged, 4-way, linesize 16 bytes.
Primary data cache 8kB, 2-way, linesize 16 bytes.
Synthesized TLB refill handler (20 instructions).
Synthesized TLB load handler fastpath (32 instructions).
Synthesized TLB store handler fastpath (32 instructions).
Synthesized TLB modify handler fastpath (31 instructions).
PID hash table entries: 128 (order: 7, 512 bytes)
mips_hpt_frequency:133333333
r4k_offset: 00145855(1333333)
Using 133.333 MHz high precision timer.
Dentry cache hash table entries: 4096 (order: 2, 16384 bytes)
Inode-cache hash table entries: 2048 (order: 1, 8192 bytes)
Memory: 29772k/32768k available (2064k kernel code, 2996k reserved, 377k data, 128k init, 0k highmem)
Mount-cache hash table entries: 512
NET: Registered protocol family 16
usbcore: registered new interface driver usbfs
usbcore: registered new interface driver hub
usbcore: registered new device driver usb
NET: Registered protocol family 8
NET: Registered protocol family 20
NET: Registered protocol family 2
IP route cache hash table entries: 1024 (order: 0, 4096 bytes)
TCP established hash table entries: 1024 (order: 0, 4096 bytes)
TCP bind hash table entries: 512 (order: -1, 2048 bytes)
TCP: Hash tables configured (established 1024 bind 512)
TCP reno registered
amazon_se_dma_init
dma_chip_init
gptu: totally 6 16-bit timers/counters
gptu: misc_register on minor 63
gptu: succeeded to request irq 25 for timer[0]
gptu: succeeded to request irq 26 for timer[1]
gptu: succeeded to request irq 27 for timer[2]
gptu: succeeded to request irq 28 for timer[3]
gptu: succeeded to request irq 29 for timer[4]
gptu: succeeded to request irq 30 for timer[5]
squashfs: version 3.2-r2 (2007/01/15) Phillip Lougher
squashfs: LZMA suppport for slax.org by jro
io scheduler noop registered (default)
Infineon Technologies port driver version 1.0.2
cgu: misc_register on minor = 62
led: misc_register on minor = 151
drivers/char/amazon_se_led.c amazon_se_led_config 1244: f_software_update = 1
drivers/char/amazon_se_led.c amazon_se_led_config 1244: f_software_update = 1
drivers/char/amazon_se_led.c amazon_se_led_config 1244: f_software_update = 1
drivers/char/amazon_se_led.c amazon_se_led_config 1244: f_software_update = 1
Unknown module try to reserve GPIO
Unknown module try to reserve GPIO
Infineon Technologies Synchronous Serial Controller (SSC) driver version 0.2.1
IFX MEI Version 4.00.01

Infineon CPE API Driver version: DSL CPE API V3.20.5.1

DSL_DRV: using proc fs
ttyS0 at MMIO 0xbe100c00 (irq = 2) is a IFX_ASC
PPP generic driver version 2.4.2
NET: Registered protocol family 24
IMQ starting with 2 devices...
IMQ driver loaded successfully.
        Hooking IMQ before NAT on PREROUTING.
        Hooking IMQ after NAT on POSTROUTING.
Loading A4 (ATM+MII0) driver ...... Force to 100MB Duplex
Succeeded!
PPE datapath driver info:
  Version ID: 8.3.5.1.0.0.1
  Family    : Amazon-SE
  DR Type   : Normal Data Path | Indirect-Fast Path
  Interface : MII0 | ATM
  Mode      : Routing
  Release   : 0.0.1
PPE firmware info:
  Version ID: 3.1.2.6.1.6
  Family    : Amazon-SE
  FW Type   : Standard
  Interface : MII0 + ATM
  Mode      : Bridging + IPv4 Routing
  Release   : 1.6
PPA API --- init successfully
Infineon Technologies Synchronous SPI flash driver version 0.0.1
MTD driver for SPI flash.
Probing for Serial flash ...
Update rx_eff_size to 4
 &lt;5&gt;Creating 8 MTD partitions on &quot;amazon_se-spi&quot;:
0x00000000-0x00020000 : &quot;U-Boot&quot;
0x00020000-0x00030000 : &quot;ENV_MAC&quot;
0x00030000-0x00040000 : &quot;DPF&quot;
0x00040000-0x00050000 : &quot;NVRAM&quot;
0x00050000-0x00700000 : &quot;RootFS_DPUMP&quot;
0x00700000-0x00800000 : &quot;Kernel&quot;
0x00050000-0x00800000 : &quot;ROOTFS_KERNEL&quot;
0x00000000-0x00020000 : &quot;POT&quot;
Update rx_eff_size to 4096
 &lt;6&gt;dwc_otg: version 2.2-RC3
dwc_otg dwc_otg: DWC OTG Controller
dwc_otg dwc_otg: new USB bus registered, assigned bus number 1
dwc_otg dwc_otg: irq 31, io mem 0x00000000
DWC_otg: Init: Power Port (0)
usb usb1: configuration #1 chosen from 1 choice
hub 1-0:1.0: USB hub found
hub 1-0:1.0: 1 port detected
nf_conntrack version 0.5.0 (256 buckets, 2048 max)
nf_ct_ftp: registering helper for pf: 2 port: 21
nf_ct_ftp: registering helper for pf: 10 port: 21
GRE over IPv4 tunneling driver
ip_tables: (C) 2000-2006 Netfilter Core Team
usb 1-1: new high speed USB device using dwc_otg and address 2
usb 1-1: configuration #1 chosen from 1 choice
TCP cubic registered
NET: Registered protocol family 1
NET: Registered protocol family 17
NET: Registered protocol family 8
atmpvc_init() failed with -17
802.1Q VLAN Support v1.8 Ben Greear &lt;greearb@candelatech.com&gt;
All bugs added by David S. Miller &lt;davem@redhat.com&gt;
Time: MIPS clocksource has been installed.
VFS: Mounted root (squashfs filesystem) readonly.
Freeing unused kernel memory: 128k freed
init started: BusyBox v1.13.1 (2012-03-01 17:48:55 CST
starting pid 14, tty &#039;&#039;: &#039;/usr/etc/rcS
Algorithmics/MIPS FPU Emulator v1.5
netfilter PSD loaded - (c) astaro AG
ipt_http_string: module license &#039;SERCOMM&#039; taints kernel.
init:866
cat: can&#039;t open &#039;/tmp/etc/block.htm&#039;: No such file or directory
insmod: cannot insert &#039;/lib/modules/igmp_snooping.ko&#039;: unknown symbol in module, or unknown parameter
device eth0 entered promiscuous mode
br0: port 1(eth0) entering learning state
userspace registering PID
cat: can&#039;t open &#039;/proc/nvram/BaseMacAddr&#039;: No such file or directory
ap_name=(null) action=start
/bin/echo GMT+0 &gt; /etc/TZ
killall: udhcpd: no process killed
iptables: No chain/target/match by that name
killall: miniupnpd: no process killed
killall: dnrd: no process killed
Notice: caching turned off
Warning: Using /etc/hosts will be removed in a future version. Please use only the /etc/dnrd/master file or use -m off.
dnrd -a 192.168.0.1 -m hosts -c off --timeout=0 -b  -s 1.1.1.1
Do not need swap cal data
VAP-Name -- ath0
BGSCAN --   0
Fast-Frame-Txq-Min -- 1000
SHORT GI --   1
CWM MODE --   1
CWM EXTOFFSET --   1
CWM EXTPROTSPACING --   0
AMPDU --   1
TX CHAIN MASK --   1
RX CHAIN MASK --   1
HIDESSID --   0
APBRIDGE --   1
Frequency -- 0.0
SSID -- virginmedia0265831
COUNTRY CODE --   0x114
WDS --   0
MACCMD --   0
DOTH --   0
COUNTRY IE --   1

Please press Enter to activate this console. ff</code></pre></div>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 2 of 3</div><nav><ul><li><a href="viewtopic.php%3Fid=39319&amp;p=1.html">1</a></li><li class="pagination-current"><span>2</span></li><li><a href="viewtopic.php%3Fid=39319&amp;p=3.html">3</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>