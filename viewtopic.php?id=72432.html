<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> A Problem with the strongSwan and the Algo</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 24 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p367459">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">nikola.public</div>
					<div class="post-datetime">
						27 Oct 2017, 20:25					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m trying to connect to the remote Algo server on the DigitalOcean. But there is a problem. I ask to help.</p><br /><p>root@OpenWrt:/etc/ipsec.d/private# ipsec up ikev2<br />initiating IKE_SA ikev2[1] to 165.227.159.13<br />generating IKE_SA_INIT request 0 [ SA KE No N(NATD_S_IP) N(NATD_D_IP) N(FRAG_SUP) N(HASH_ALG) N(REDIR_SUP) ]<br />sending packet: from 10.24.10.6[500] to 165.227.159.13[500] (354 bytes)<br />received packet: from 165.227.159.13[500] to 10.24.10.6[500] (289 bytes)<br />parsed IKE_SA_INIT response 0 [ SA KE No N(NATD_S_IP) N(NATD_D_IP) CERTREQ N(FRAG_SUP) N(HASH_ALG) N(MULT_AUTH) ]<br />local host is behind NAT, sending keep alives<br />received cert request for &quot;CN=165.227.159.13&quot;<br />sending cert request for &quot;CN=165.227.159.13&quot;<br />authentication of &#039;CN=nick&#039; (myself) with ECDSA_WITH_SHA256_DER successful<br />sending end entity cert &quot;CN=nick&quot;<br />establishing CHILD_SA ikev2{1}<br />generating IKE_AUTH request 1 [ IDi CERT CERTREQ IDr AUTH CPRQ(ADDR DNS) SA TSi TSr N(MOBIKE_SUP) N(ADD_4_ADDR) N(ADD_4_ADDR) N(MULT_AUTH) N(EAP_ONLY) N(MSG_ID_SYN_SUP) ]<br />sending packet: from 10.24.10.6[4500] to 165.227.159.13[4500] (886 bytes)<br />received packet: from 165.227.159.13[4500] to 10.24.10.6[4500] (544 bytes)<br />parsed IKE_AUTH response 1 [ EF(1/2) ]<br />received fragment #1 of 2, waiting for complete IKE message<br />received packet: from 165.227.159.13[4500] to 10.24.10.6[4500] (324 bytes)<br />parsed IKE_AUTH response 1 [ EF(2/2) ]<br />received fragment #2 of 2, reassembling fragmented IKE message<br />parsed IKE_AUTH response 1 [ IDr CERT AUTH CPRP(ADDR DNS DNS) SA TSi TSr N(MOBIKE_SUP) N(ADD_4_ADDR) ]<br />received end entity cert &quot;CN=165.227.159.13&quot;<br />&nbsp; using certificate &quot;CN=165.227.159.13&quot;<br />&nbsp; using trusted ca certificate &quot;CN=165.227.159.13&quot;<br />checking certificate status of &quot;CN=165.227.159.13&quot;<br />certificate status is not available<br />&nbsp; reached self-signed root ca with a path length of 0<br />authentication of &#039;165.227.159.13&#039; with ECDSA_WITH_SHA256_DER successful<br />IKE_SA ikev2[1] established between 10.24.10.6[CN=nick]...165.227.159.13[165.227.159.13]<br />installing DNS server 8.8.8.8 to /etc/resolv.conf<br />installing DNS server 8.8.4.4 to /etc/resolv.conf<br />installing new virtual IP 10.19.48.1<br />received netlink error: Function not implemented (38)<br />unable to add SAD entry with SPI cf5468cc (FAILED)<br />received netlink error: Function not implemented (38)<br />unable to add SAD entry with SPI c0c7eb50 (FAILED)<br />unable to install inbound and outbound IPsec SA (SAD) in kernel<br />failed to establish CHILD_SA, keeping IKE_SA<br />peer supports MOBIKE<br />sending DELETE for ESP CHILD_SA with SPI cf5468cc<br />generating INFORMATIONAL request 2 [ D ]<br />sending packet: from 10.24.10.6[4500] to 165.227.159.13[4500] (69 bytes)<br />received packet: from 165.227.159.13[4500] to 10.24.10.6[4500] (69 bytes)<br />parsed INFORMATIONAL response 2 [ D ]<br />establishing connection &#039;ikev2&#039; failed</p><p>ipsec.conf:</p><p># Add connections here.</p><p>conn ikev2<br />&nbsp; &nbsp; fragmentation=yes<br />&nbsp; &nbsp; rekey=no<br />&nbsp; &nbsp; dpdaction=clear<br />&nbsp; &nbsp; keyexchange=ikev2<br />&nbsp; &nbsp; compress=no<br />&nbsp; &nbsp; dpddelay=35s</p><p>&nbsp; &nbsp; ike=aes128gcm16-prfsha512-ecp256,aes128-sha2_512-prfsha512-ecp256,aes128-sha2_384-prfsha384-ecp256!<br />&nbsp; &nbsp; esp=aes128gcm16-ecp256,aes128-sha2_512-prfsha512-ecp256!</p><p>&nbsp; &nbsp; right=165.227.159.13<br />&nbsp; &nbsp; rightid=165.227.159.13<br />&nbsp; &nbsp; rightsubnet=0.0.0.0/0<br />&nbsp; &nbsp; rightauth=pubkey</p><p>&nbsp; &nbsp; leftsourceip=%config<br />&nbsp; &nbsp; leftauth=pubkey<br />&nbsp; &nbsp; leftcert=nick.crt<br />&nbsp; &nbsp; leftfirewall=yes<br />&nbsp; &nbsp; left=%defaultroute</p><p>&nbsp; &nbsp; auto=add</p>											<p class="post-edited">(Last edited by <strong>nikola.public</strong> on 27 Oct 2017, 20:26)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p367860">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">openwrt_geek</div>
					<div class="post-datetime">
						5 Nov 2017, 12:20					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m facing the same issue, using strongswan version 5.3.3 on openwrt 15.05.1 Chaos Calmer as VPN client and ubuntu algo server. Any help would be grealy appreciated:</p><p>root@OpenWrt:/etc# ipsec restart<br />Stopping strongSwan IPsec...<br />Starting strongSwan 5.3.3 IPsec [starter]...<br />no files found matching &#039;/etc/ipsec.uci.conf&#039;<br />root@OpenWrt:/etc# ipsec up ikev2-54.153.70.247<br />initiating IKE_SA ikev2-54.153.70.247[1] to 54.153.70.247<br />generating IKE_SA_INIT request 0 [ SA KE No N(NATD_S_IP) N(NATD_D_IP) N(FRAG_SUP) N(HASH_ALG) ]<br />sending packet: from 192.168.86.105[500] to 54.153.70.247[500] (256 bytes)<br />received packet: from 54.153.70.247[500] to 192.168.86.105[500] (289 bytes)<br />parsed IKE_SA_INIT response 0 [ SA KE No N(NATD_S_IP) N(NATD_D_IP) CERTREQ N(FRAG_SUP) N(HASH_ALG) N(MULT_AUTH) ]<br />local host is behind NAT, sending keep alives<br />remote host is behind NAT<br />received cert request for &quot;CN=54.153.70.247&quot;<br />sending cert request for &quot;CN=54.153.70.247&quot;<br />authentication of &#039;CN=pravin&#039; (myself) with ECDSA_WITH_SHA256_DER successful<br />sending end entity cert &quot;CN=pravin&quot;<br />establishing CHILD_SA ikev2-54.153.70.247<br />generating IKE_AUTH request 1 [ IDi CERT N(INIT_CONTACT) CERTREQ IDr AUTH CPRQ(ADDR DNS) SA TSi TSr N(MOBIKE_SUP) N(ADD_4_ADDR) N(ADD_6_ADDR) N(MULT_AUTH) N(EAP_ONLY) ]<br />splitting IKE message with length of 860 bytes into 2 fragments<br />generating IKE_AUTH request 1 [ EF(1/2) ]<br />generating IKE_AUTH request 1 [ EF(2/2) ]<br />sending packet: from 192.168.86.105[4500] to 54.153.70.247[4500] (544 bytes)<br />sending packet: from 192.168.86.105[4500] to 54.153.70.247[4500] (381 bytes)<br />received packet: from 54.153.70.247[4500] to 192.168.86.105[4500] (544 bytes)<br />parsed IKE_AUTH response 1 [ EF(1/2) ]<br />received fragment #1 of 2, waiting for complete IKE message<br />received packet: from 54.153.70.247[4500] to 192.168.86.105[4500] (331 bytes)<br />parsed IKE_AUTH response 1 [ EF(2/2) ]<br />received fragment #2 of 2, reassembling fragmented IKE message<br />parsed IKE_AUTH response 1 [ IDr CERT AUTH CPRP(ADDR DNS DNS) SA TSi TSr N(MOBIKE_SUP) N(ADD_6_ADDR) ]<br />received end entity cert &quot;CN=54.153.70.247&quot;<br />&nbsp; using certificate &quot;CN=54.153.70.247&quot;<br />&nbsp; using trusted ca certificate &quot;CN=54.153.70.247&quot;<br />checking certificate status of &quot;CN=54.153.70.247&quot;<br />certificate status is not available<br />&nbsp; reached self-signed root ca with a path length of 0<br />authentication of &#039;54.153.70.247&#039; with ECDSA_WITH_SHA256_DER successful<br />IKE_SA ikev2-54.153.70.247[1] established between 192.168.86.105[CN=pravin]...54.153.70.247[54.153.70.247]<br />installing DNS server 8.8.8.8 to /etc/resolv.conf<br />installing DNS server 8.8.4.4 to /etc/resolv.conf<br />installing new virtual IP 10.19.48.2<br />received netlink error: Function not implemented (38)<br />unable to add SAD entry with SPI cd5950bb<br />received netlink error: Function not implemented (38)<br />unable to add SAD entry with SPI c8eb5f77<br />unable to install inbound and outbound IPsec SA (SAD) in kernel<br />failed to establish CHILD_SA, keeping IKE_SA<br />peer supports MOBIKE<br />sending DELETE for ESP CHILD_SA with SPI cd5950bb<br />generating INFORMATIONAL request 2 [ D ]<br />sending packet: from 192.168.86.105[4500] to 54.153.70.247[4500] (69 bytes)<br />received packet: from 54.153.70.247[4500] to 192.168.86.105[4500] (69 bytes)<br />parsed INFORMATIONAL response 2 [ D ]<br />establishing connection &#039;ikev2-54.153.70.247&#039; failed</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>