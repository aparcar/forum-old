<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> OpenWRT to OpenVPNAS tun0 gets no traffic?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 23 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p155633">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">ReHostClub</div>
					<div class="post-datetime">
						28 Jan 2012, 17:04					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m connecting to a (OpenVPNAS) VPS;<br />from a WZR-HP-G300NH OpenWRT router with the OpenVPN client via ssh, please see below ssh code.<br />Once authenticated, I&#039;m able to ping google.com from the ssh command line inside on the OpenWRT router,<br />I&#039;m unable to browse the internet with the client computer behind the OpenWRT router?<br />Here is the only modifications I made to the OpenWRT router.<br />All other settings are default from a fresh firmware flash.</p><p>In /etc/config/network, add:<br /></p><div class="codebox"><pre><code>config interface vpn
    option proto none
    option ifname tun0</code></pre></div><p>In /etc/config/firewall, within the wan zone section add:<br /></p><div class="codebox"><pre><code>config zone
    option name wan
    ...
    option network &quot;wan vpn&quot;</code></pre></div><p>SSH Connecting;<br /></p><div class="codebox"><pre><code>BusyBox v1.15.3 (2011-10-28 21:07:55 CEST) built-in shell (ash)
Enter &#039;help&#039; for a list of built-in commands.

  _______                     ________        __
 |       |.-----.-----.-----.|  |  |  |.----.|  |_
 |   -   ||  _  |  -__|     ||  |  |  ||   _||   _|
 |_______||   __|_____|__|__||________||__|  |____|
          |__| W I R E L E S S   F R E E D O M
 Backfire (10.03.1-RC6, r28680) --------------------
  * 1/3 shot Kahlua    In a shot glass, layer Kahlua 
  * 1/3 shot Bailey&#039;s  on the bottom, then Bailey&#039;s, 
  * 1/3 shot Vodka     then Vodka.
 ---------------------------------------------------
root@OpenWrt:~# openvpn /etc/openvpn/clienti.ovpn
Sat Jan 28 13:29:46 2012 OpenVPN 2.1.4 mips-openwrt-linux [SSL] [LZO2] [EPOLL] built on Oct 10 2011
Enter Auth Username:username
Enter Auth Password:password
Sat Jan 28 13:29:51 2012 NOTE: OpenVPN 2.1 requires &#039;--script-security 2&#039; or higher to call user-defined scripts or executables
Sat Jan 28 13:29:51 2012 Control Channel Authentication: tls-auth using INLINE static key file
Sat Jan 28 13:29:51 2012 Outgoing Control Channel Authentication: Using 160 bit message hash &#039;SHA1&#039; for HMAC authentication
Sat Jan 28 13:29:51 2012 Incoming Control Channel Authentication: Using 160 bit message hash &#039;SHA1&#039; for HMAC authentication
Sat Jan 28 13:29:51 2012 LZO compression initialized
Sat Jan 28 13:29:51 2012 Control Channel MTU parms [ L:1542 D:166 EF:66 EB:0 ET:0 EL:0 ]
Sat Jan 28 13:29:51 2012 Socket Buffers: R=[114688-&gt;200000] S=[114688-&gt;200000]
Sat Jan 28 13:29:51 2012 Data Channel MTU parms [ L:1542 D:1450 EF:42 EB:135 ET:0 EL:0 AF:3/1 ]
Sat Jan 28 13:29:51 2012 UDPv4 link local: [undef]
Sat Jan 28 13:29:51 2012 UDPv4 link remote: #.#.112.61:1194
Sat Jan 28 13:29:51 2012 TLS: Initial packet from #.#.112.61:1194, sid=be1e8 3ec33ad0
Sat Jan 28 13:29:51 2012 WARNING: this configuration may cache passwords in memory -- use the auth-nocache option to prevent this
Sat Jan 28 13:29:52 2012 VERIFY OK: depth=1, /CN=OpenVPN_CA
Sat Jan 28 13:29:52 2012 VERIFY OK: nsCertType=SERVER
Sat Jan 28 13:29:52 2012 VERIFY OK: depth=0, /CN=OpenVPN_Server
Sat Jan 28 13:29:53 2012 Data Channel Encrypt: Cipher &#039;BF-CBC&#039; initialized with 128 bit key
Sat Jan 28 13:29:53 2012 Data Channel Encrypt: Using 160 bit message hash &#039;SHA1&#039; for HMAC authentication
Sat Jan 28 13:29:53 2012 Data Channel Decrypt: Cipher &#039;BF-CBC&#039; initialized with 128 bit key
Sat Jan 28 13:29:53 2012 Data Channel Decrypt: Using 160 bit message hash &#039;SHA1&#039; for HMAC authentication
Sat Jan 28 13:29:53 2012 Control Channel: TLSv1, cipher TLSv1/SSLv3 DHE-RSA-AES256-SHA, 1024 bit RSA
Sat Jan 28 13:29:53 2012 [OpenVPN_Server] Peer Connection Initiated with #.#.112.61:1194
Sat Jan 28 13:29:55 2012 SENT CONTROL [OpenVPN_Server]: &#039;PUSH_REQUEST&#039; (status=1)
Sat Jan 28 13:29:56 2012 PUSH: Received control message: &#039;PUSH_REPLY,explicit-exit-notify,topology subnet,route-delay 5 30,dhcp-pre-release,dhcp-renew,dhcp-release,route-metric 101,ping 5,ping-restart 40,redirect-gateway def1,redirect-gateway bypass-dhcp,redirect-gateway autolocal,route-gateway 5.5.8.1,dhcp-option DNS 8.8.8.8,dhcp-option DNS 8.8.4.4,register-dns,auth-token SESS_ID_JPe5z67P/w19QkPNKFw18w==,comp-lzo yes,ifconfig 5.5.8.14 255.255.252.0&#039;
Sat Jan 28 13:29:56 2012 Unrecognized option or missing parameter(s) in [PUSH-OPTIONS]:1: explicit-exit-notify (2.1.4)
Sat Jan 28 13:29:56 2012 Unrecognized option or missing parameter(s) in [PUSH-OPTIONS]:4: dhcp-pre-release (2.1.4)
Sat Jan 28 13:29:56 2012 Unrecognized option or missing parameter(s) in [PUSH-OPTIONS]:5: dhcp-renew (2.1.4)
Sat Jan 28 13:29:56 2012 Unrecognized option or missing parameter(s) in [PUSH-OPTIONS]:6: dhcp-release (2.1.4)
Sat Jan 28 13:29:56 2012 Unrecognized option or missing parameter(s) in [PUSH-OPTIONS]:16: register-dns (2.1.4)
Sat Jan 28 13:29:56 2012 Unrecognized option or missing parameter(s) in [PUSH-OPTIONS]:17: auth-token (2.1.4)
Sat Jan 28 13:29:56 2012 OPTIONS IMPORT: timers and/or timeouts modified
Sat Jan 28 13:29:56 2012 OPTIONS IMPORT: LZO parms modified
Sat Jan 28 13:29:56 2012 OPTIONS IMPORT: --ifconfig/up options modified
Sat Jan 28 13:29:56 2012 OPTIONS IMPORT: route options modified
Sat Jan 28 13:29:56 2012 OPTIONS IMPORT: route-related options modified
Sat Jan 28 13:29:56 2012 OPTIONS IMPORT: --ip-win32 and/or --dhcp-option options modified
Sat Jan 28 13:29:56 2012 TUN/TAP device tun0 opened
Sat Jan 28 13:29:56 2012 TUN/TAP TX queue length set to 100
Sat Jan 28 13:29:56 2012 /sbin/ifconfig tun0 5.5.8.14 netmask 255.255.252.0 mtu 1500 broadcast 5.5.11.255
Sat Jan 28 13:30:01 2012 /sbin/route add -net #.#.112.61 netmask 255.255.255.255 gw 10.0.1.1
Sat Jan 28 13:30:01 2012 /sbin/route add -net 0.0.0.0 netmask 128.0.0.0 gw 5.5.8.1
Sat Jan 28 13:30:01 2012 /sbin/route add -net 128.0.0.0 netmask 128.0.0.0 gw 5.5.8.1
Sat Jan 28 13:30:01 2012 Initialization Sequence Completed</code></pre></div><p>I&#039;m able to connect and browse the Internet to the same OpenVPNAS if I use a gui dialer from a desktop client.</p><p>Thanks for your guidance!<br />Jason</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p155731">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">ReHostClub</div>
					<div class="post-datetime">
						29 Jan 2012, 16:33					</div>
				</div>
				<div class="post-content content">
					<p>RESOLVED!<br />The above configuration works!<br />I had put the firewall rules under an incorrect section....<br />Thanks<br />Jason</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>