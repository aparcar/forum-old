<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Howto: DSL-502T ADSL PPPoE GO!!!!!!!! :)</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 27 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p35563">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">Z3r0</div>
					<div class="post-datetime">
						17 Oct 2006, 18:52					</div>
				</div>
				<div class="post-content content">
					<p>Updated with PPPoA info<br />Commented out old/redundant data</p><p>Ok so... when you are compiling the firmware I advise you to disable the ANNEX you don&#039;t use so for me I disabled ANNEX B and enabled ANNEX A, you should also compile in br2684ctl and linux-atm.</p><p>When the router boots up you can do cat /proc/tiatm/avsar_modem_stats and if it says &quot;IDLE&quot; that means you&#039;ve probably set the wrong ANNEX, if it says &quot;INIT&quot; that is good, then it should say &quot;SHOWTIME&quot; when it is ready to work.</p><p>You can also do cat /proc/tiatm/avsar_modem_stats this is the best way of working out if you connection is initialised and if it is up also check ifconfig regularly</p><p>You should get something like this:</p><p>AR7 DSL Modem Statistics:<br />--------------------------------<br />[DSL Modem Stats]<br />&nbsp; &nbsp; &nbsp; &nbsp; US Connection Rate:&nbsp; &nbsp; &nbsp;128&nbsp; &nbsp; &nbsp;DS Connection Rate:&nbsp; &nbsp; &nbsp;1536<br />&nbsp; &nbsp; &nbsp; &nbsp; DS Line Attenuation:&nbsp; &nbsp; 27&nbsp; &nbsp; &nbsp; DS Margin:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 19<br />&nbsp; &nbsp; &nbsp; &nbsp; US Line Attenuation:&nbsp; &nbsp; 17&nbsp; &nbsp; &nbsp; US Margin:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 26<br />&nbsp; &nbsp; &nbsp; &nbsp; US Payload :&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp;DS Payload:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0<br />&nbsp; &nbsp; &nbsp; &nbsp; US Superframe Cnt :&nbsp; &nbsp; &nbsp;5278&nbsp; &nbsp; DS Superframe Cnt:&nbsp; &nbsp; &nbsp; 5278<br />&nbsp; &nbsp; &nbsp; &nbsp; US Transmit Power :&nbsp; &nbsp; &nbsp;8&nbsp; &nbsp; &nbsp; &nbsp;DS Transmit Power:&nbsp; &nbsp; &nbsp; 6<br />&nbsp; &nbsp; &nbsp; &nbsp; LOS errors:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp;SEF errors:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0<br />&nbsp; &nbsp; &nbsp; &nbsp; Frame mode:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3&nbsp; &nbsp; &nbsp; &nbsp;Max Frame mode:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0<br />&nbsp; &nbsp; &nbsp; &nbsp; Trained Path:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp;US Peak Cell Rate:&nbsp; &nbsp; &nbsp; 301<br />&nbsp; &nbsp; &nbsp; &nbsp; Trained Mode:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3&nbsp; &nbsp; &nbsp; &nbsp;Selected Mode:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 3<br />&nbsp; &nbsp; &nbsp; &nbsp; ATUC Vendor ID: 1196642382&nbsp; &nbsp; &nbsp; ATUC Revision:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1<br />&nbsp; &nbsp; &nbsp; &nbsp; Hybrid Selected:&nbsp; &nbsp; &nbsp; &nbsp; 1</p><p>&nbsp; &nbsp; &nbsp; &nbsp; [Upstream (TX) Interleave path]<br />&nbsp; &nbsp; &nbsp; &nbsp; CRC:&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp;FEC:&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp;NCD:&nbsp; &nbsp; 1<br />&nbsp; &nbsp; &nbsp; &nbsp; LCD:&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp;HEC:&nbsp; &nbsp; 0</p><p>&nbsp; &nbsp; &nbsp; &nbsp; [Downstream (RX) Interleave path]<br />&nbsp; &nbsp; &nbsp; &nbsp; CRC:&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp;FEC:&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp;NCD:&nbsp; &nbsp; 0<br />&nbsp; &nbsp; &nbsp; &nbsp; LCD:&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp;HEC:&nbsp; &nbsp; 0</p><p>&nbsp; &nbsp; &nbsp; &nbsp; [Upstream (TX) Fast path]<br />&nbsp; &nbsp; &nbsp; &nbsp; CRC:&nbsp; &nbsp; 1&nbsp; &nbsp; &nbsp; &nbsp;FEC:&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp;NCD:&nbsp; &nbsp; 0<br />&nbsp; &nbsp; &nbsp; &nbsp; LCD:&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp;HEC:&nbsp; &nbsp; 0</p><p>&nbsp; &nbsp; &nbsp; &nbsp; [Downstream (RX) Fast path]<br />&nbsp; &nbsp; &nbsp; &nbsp; CRC:&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp;FEC:&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp;NCD:&nbsp; &nbsp; 0<br />&nbsp; &nbsp; &nbsp; &nbsp; LCD:&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp;HEC:&nbsp; &nbsp; 0</p><p>[ATM Stats]<br />&nbsp; &nbsp; &nbsp; &nbsp; [Upstream/TX]<br />&nbsp; &nbsp; &nbsp; &nbsp; Good Cell Cnt:&nbsp; 0<br />&nbsp; &nbsp; &nbsp; &nbsp; Idle Cell Cnt:&nbsp; 27087</p><br /><p>&nbsp; &nbsp; &nbsp; &nbsp; [Downstream/RX)]<br />&nbsp; &nbsp; &nbsp; &nbsp; Good Cell Cnt:&nbsp; 0<br />&nbsp; &nbsp; &nbsp; &nbsp; Idle Cell Cnt:&nbsp; 325035<br />&nbsp; &nbsp; &nbsp; &nbsp; Bad Hec Cell Cnt:&nbsp; &nbsp; &nbsp; &nbsp;0<br />&nbsp; &nbsp; &nbsp; &nbsp; Overflow Dropped Cell Cnt:&nbsp; &nbsp; &nbsp; 0</p><p>[SAR AAL5 Stats]<br />&nbsp; &nbsp; &nbsp; &nbsp; Tx PDU&#039;s:&nbsp; &nbsp; &nbsp; &nbsp;0<br />&nbsp; &nbsp; &nbsp; &nbsp; Rx PDU&#039;s:&nbsp; &nbsp; &nbsp; &nbsp;0<br />&nbsp; &nbsp; &nbsp; &nbsp; Tx Total Bytes: 0<br />&nbsp; &nbsp; &nbsp; &nbsp; Rx Total Bytes: 0<br />&nbsp; &nbsp; &nbsp; &nbsp; Tx Total Error Counts:&nbsp; 0<br />&nbsp; &nbsp; &nbsp; &nbsp; Rx Total Error Counts:&nbsp; 0</p><br /><p>[OAM Stats]<br />&nbsp; &nbsp; &nbsp; &nbsp; Near End F5 Loop Back Count:&nbsp; &nbsp; 0<br />&nbsp; &nbsp; &nbsp; &nbsp; Near End F4 Loop Back Count:&nbsp; &nbsp; 0<br />&nbsp; &nbsp; &nbsp; &nbsp; Far End F5 Loop Back Count:&nbsp; &nbsp; &nbsp;0<br />&nbsp; &nbsp; &nbsp; &nbsp; Far End F4 Loop Back Count:&nbsp; &nbsp; &nbsp;0</p><p>You need to load the modules for ppp, most of these are already loaded.</p><p>cd /lib/modules/2.4.32<br />insmod br2684.o<br />insmod slhc.o<br />insmod ppp_generic.o<br />insmod ppp_async.o<br />insmod pppox.o #PPPoE<br />insmod pppoe.o #PPPoE<br />insmod pppoatm.o #PPPoA</p><br /><p>We need to bring up the ATM bridge to allow us to use PPPoE<br />We run br2684ctl -b -c 0 -a 8.35 to create the nas0 interface</p><p>You should get:</p><p>RFC1483/2684 bridge: Interface &quot;nas0&quot; (mtu=1500, payload=bridged) created sucessfully</p><p>RFC1483/2684 bridge: Communicating over ATM 0.8.35, encapsulation: LLC</p><p>RFC1483/2684 bridge: Interface configured</p><p>Go to /etc/config and type vi network to edit network configuration and add:<br />config interface wan<br />option ifname nas0<br />option device ppp<br />option proto pppoe #change to pppoa for PPPoA (PPP over ATM)<br />#option user &quot;me@isp.com&quot;<br />#option name &quot;me@isp.com&quot;<br />#option atm 1</p><p>#PPPoE only<br />Now do ifconfig nas0 up</p><p>we need to mknod /dev/ppp c 99 0</p><p>we need to go to /etc/ppp and edit options using vi (if read only move file and then copy back)<br />we need to add this extra information to the options file</p><p>debug<br />lock<br />defaultroute<br />noipdefault<br />noauth<br />passive<br />asyncmap 0<br />usepeerdns #important gets DNS servers from ISP and adds to resolv.conf<br />#name &quot;me@isp.com&quot;<br />user &quot;me@isp.com&quot; #REQUIRED FOR PAP/CHAP AUTH TO BE SUCCESSFUL<br />lcp-echo-interval 4<br />lcp-echo-failure 20<br />#plugin rp-pppoe.so #use pppoatm.so for PPPoA&nbsp; #No longer needed as we have a pppoe/pppoa script called from &quot;ifup wan&quot; instead<br />#nas0 #No longer needed as we have a pppoe/pppoa script called from &quot;ifup wan&quot; instead<br />mtu 1492 #pppoa should be 1500<br />mru 1492 #MTU=MRU</p><p>we then need to edit our chap-secrets and create a pap-secrets which contains:<br />&quot;me@isp.com&quot; &quot;*&quot; &quot;passwd&quot; &quot;*&quot;</p><p>just do &quot;ifup wan&quot; and it should come up, edit /lib/network/pppoe.sh or pppoa.sh to change mtu/mru (typing pppd used to bring the connection up, this doesn&#039;t work properly anymore)</p><p>do ifconfig to see if it&#039;s up and you should see a new device ppp0 with the IP assigned</p><p>eth0&nbsp; &nbsp; &nbsp; Link encap:Ethernet&nbsp; HWaddr 00:0D:08:00:03:02&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:192.168.1.1&nbsp; Bcast:192.168.1.255&nbsp; Mask:255.255.255.0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:735 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:440 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:1000 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:44262 (43.2 KiB)&nbsp; TX bytes:41685 (40.7 KiB)</p><p>lo&nbsp; &nbsp; &nbsp; &nbsp; Link encap:Local Loopback&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:127.0.0.1&nbsp; Mask:255.0.0.0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP LOOPBACK RUNNING&nbsp; MTU:16436&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:0 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:0 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:0 (0.0 B)&nbsp; TX bytes:0 (0.0 B)</p><p>nas0&nbsp; &nbsp; &nbsp; Link encap:Ethernet&nbsp; HWaddr 00:00:02:03:04:05&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:37 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:43 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:1000 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:1746 (1.7 KiB)&nbsp; TX bytes:2012 (1.9 KiB)</p><p>ppp0&nbsp; &nbsp; &nbsp; Link encap:Point-to-Point Protocol&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:61.69.250.153&nbsp; P-t-P:210.8.1.19&nbsp; Mask:255.255.255.255<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP POINTOPOINT RUNNING NOARP MULTICAST&nbsp; MTU:1480&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:3 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:3 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:3 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:114 (114.0 B)&nbsp; TX bytes:54 (54.0 B)</p><p>dmesg won&#039;t give you any information:</p><p>&lt;4&gt;registered device TI Avalanche SAR<br />&lt;4&gt;Initializing DSL interface<br />&lt;4&gt;size=10120<br />&lt;4&gt;size=38720<br />&lt;4&gt;size=46432<br />&lt;4&gt;size=45312<br />&lt;4&gt;dsl modulation = GDMT<br />&lt;4&gt;Texas Instruments ATM driver: version:[4.02.04.00]<br />&lt;4&gt;DSL in Sync<br />&lt;6&gt;CSLIP: code copyright 1989 Regents of the University of California<br />&lt;6&gt;PPP generic driver version 2.4.2</p><p>Here&#039;s a logread for the PPPoA connection coming up<br />Jan&nbsp; 1 00:16:58 (none) daemon.info pppd[1525]: Plugin pppoatm.so loaded.<br />Jan&nbsp; 1 00:16:58 (none) daemon.notice pppd[1526]: pppd 2.4.3 started by root, uid 0<br />Jan&nbsp; 1 00:16:58 (none) daemon.debug pppd[1526]: using channel 7<br />Jan&nbsp; 1 00:16:58 (none) daemon.info pppd[1526]: Using interface ppp0<br />Jan&nbsp; 1 00:16:58 (none) daemon.notice pppd[1526]: Connect: ppp0 &lt;--&gt; 8.35<br />Jan&nbsp; 1 00:16:58 (none) daemon.warn pppd[1526]: Warning - secret file /etc/ppp/pap-secrets has world and/or group access<br />Jan&nbsp; 1 00:16:58 (none) daemon.debug pppd[1526]: sent [LCP ConfReq id=0x1 &lt;magic 0xab96c977&gt;]<br />Jan&nbsp; 1 00:16:58 (none) daemon.info pppd[1575]: Plugin pppoatm.so loaded.<br />Jan&nbsp; 1 00:16:58 (none) user.warn kernel: atm_find_ci err = -125<br />Jan&nbsp; 1 00:16:59 (none) daemon.debug pppd[1526]: rcvd [LCP ConfReq id=0xb6 &lt;auth chap MD5&gt; &lt;magic 0x1997d545&gt;]<br />Jan&nbsp; 1 00:16:59 (none) daemon.debug pppd[1526]: sent [LCP ConfAck id=0xb6 &lt;auth chap MD5&gt; &lt;magic 0x1997d545&gt;]<br />Jan&nbsp; 1 00:17:01 (none) daemon.debug pppd[1526]: sent [LCP ConfReq id=0x1 &lt;magic 0xab96c977&gt;]<br />Jan&nbsp; 1 00:17:01 (none) daemon.debug pppd[1526]: rcvd [LCP ConfAck id=0x1 &lt;magic 0xab96c977&gt;]<br />Jan&nbsp; 1 00:17:01 (none) daemon.debug pppd[1526]: sent [LCP EchoReq id=0x0 magic=0xab96c977]<br />Jan&nbsp; 1 00:17:01 (none) daemon.debug pppd[1526]: rcvd [CHAP Challenge id=0xa9 &lt;a651a7d379cd0774c955779ddde30108&gt;, name = &quot;vezf-exhibition&quot;]<br />Jan&nbsp; 1 00:17:01 (none) daemon.warn pppd[1526]: Warning - secret file /etc/ppp/chap-secrets has world and/or group access<br />Jan&nbsp; 1 00:17:01 (none) daemon.debug pppd[1526]: sent [CHAP Response id=0xa9 &lt;90ee4e5c8643786cb013457da2ac580d&gt;, name = &quot;z@z.com&quot;]<br />Jan&nbsp; 1 00:17:01 (none) daemon.debug pppd[1526]: rcvd [LCP EchoRep id=0x0 magic=0x1997d545]<br />Jan&nbsp; 1 00:17:01 (none) daemon.debug pppd[1526]: rcvd [LCP ConfReq id=0x1 &lt;auth pap&gt; &lt;magic 0xe2e7dd93&gt;]<br />Jan&nbsp; 1 00:17:01 (none) daemon.warn pppd[1526]: Warning - secret file /etc/ppp/pap-secrets has world and/or group access<br />Jan&nbsp; 1 00:17:01 (none) daemon.debug pppd[1526]: sent [LCP ConfReq id=0x2 &lt;magic 0xbbdecdd3&gt;]<br />Jan&nbsp; 1 00:17:01 (none) daemon.debug pppd[1526]: sent [LCP ConfAck id=0x1 &lt;auth pap&gt; &lt;magic 0xe2e7dd93&gt;]<br />Jan&nbsp; 1 00:17:01 (none) daemon.debug pppd[1526]: rcvd [LCP ConfAck id=0x2 &lt;magic 0xbbdecdd3&gt;]<br />Jan&nbsp; 1 00:17:01 (none) daemon.debug pppd[1526]: sent [LCP EchoReq id=0x0 magic=0xbbdecdd3]<br />Jan&nbsp; 1 00:17:01 (none) daemon.warn pppd[1526]: Warning - secret file /etc/ppp/pap-secrets has world and/or group access<br />Jan&nbsp; 1 00:17:01 (none) daemon.debug pppd[1526]: sent [PAP AuthReq id=0x1 user=&quot;z@z.com&quot; password=&lt;hidden&gt;]<br />Jan&nbsp; 1 00:17:01 (none) daemon.debug pppd[1526]: rcvd [LCP EchoRep id=0x0 magic=0xe2e7dd93]<br />Jan&nbsp; 1 00:17:01 (none) daemon.debug pppd[1526]: rcvd [PAP AuthAck id=0x1 &quot;&quot;]<br />Jan&nbsp; 1 00:17:01 (none) daemon.notice pppd[1526]: PAP authentication succeeded<br />Jan&nbsp; 1 00:17:01 (none) daemon.notice pppd[1526]: PAP authentication succeeded<br />Jan&nbsp; 1 00:17:01 (none) daemon.warn pppd[1526]: kernel does not support PPP filtering<br />Jan&nbsp; 1 00:17:01 (none) daemon.debug pppd[1526]: sent [IPCP ConfReq id=0x1 &lt;compress VJ 0f 01&gt; &lt;addr 0.0.0.0&gt; &lt;ms-dns1 0.0.0.0&gt; &lt;ms-dns3 0.0.0.0&gt;]<br />Jan&nbsp; 1 00:17:01 (none) daemon.debug pppd[1526]: rcvd [IPCP ConfReq id=0x1 &lt;addr 203.63.80.134&gt;]<br />Jan&nbsp; 1 00:17:01 (none) daemon.debug pppd[1526]: sent [IPCP ConfAck id=0x1 &lt;addr 203.63.80.134&gt;]<br />Jan&nbsp; 1 00:17:01 (none) daemon.debug pppd[1526]: rcvd [IPCP ConfRej id=0x1 &lt;compress VJ 0f 01&gt;]<br />Jan&nbsp; 1 00:17:01 (none) daemon.debug pppd[1526]: sent [IPCP ConfReq id=0x2 &lt;addr 0.0.0.0&gt; &lt;ms-dns1 0.0.0.0&gt; &lt;ms-dns3 0.0.0.0&gt;]<br />Jan&nbsp; 1 00:17:01 (none) daemon.debug pppd[1526]: rcvd [IPCP ConfNak id=0x2 &lt;addr 61.68.188.199&gt; &lt;ms-dns1 203.8.183.1&gt; &lt;ms-dns3 192.189.54.33&gt;]<br />Jan&nbsp; 1 00:17:01 (none) daemon.debug pppd[1526]: sent [IPCP ConfReq id=0x3 &lt;addr 61.68.188.199&gt; &lt;ms-dns1 203.8.183.1&gt; &lt;ms-dns3 192.189.54.33&gt;]<br />Jan&nbsp; 1 00:17:01 (none) daemon.debug pppd[1526]: rcvd [IPCP ConfAck id=0x3 &lt;addr 61.68.188.199&gt; &lt;ms-dns1 203.8.183.1&gt; &lt;ms-dns3 192.189.54.33&gt;]<br />Jan&nbsp; 1 00:17:01 (none) daemon.notice pppd[1526]: local&nbsp; IP address 61.68.188.199<br />Jan&nbsp; 1 00:17:01 (none) daemon.notice pppd[1526]: remote IP address 203.63.80.134<br />Jan&nbsp; 1 00:17:01 (none) daemon.notice pppd[1526]: primary&nbsp; &nbsp;DNS address 203.8.183.1<br />Jan&nbsp; 1 00:17:01 (none) daemon.notice pppd[1526]: secondary DNS address 192.189.54.33<br />Jan&nbsp; 1 00:17:01 (none) daemon.info dnsmasq[339]: reading /tmp/resolv.conf<br />Jan&nbsp; 1 00:17:01 (none) daemon.info dnsmasq[339]: using nameserver 192.189.54.33#53<br />Jan&nbsp; 1 00:17:01 (none) daemon.info dnsmasq[339]: using nameserver 203.8.183.1#53<br />Jan&nbsp; 1 00:17:01 (none) daemon.info dnsmasq[339]: using local addresses only for domain lan<br />Jan&nbsp; 1 00:17:01 (none) daemon.debug pppd[1526]: Script /etc/ppp/ip-up started (pid 1584)<br />Jan&nbsp; 1 00:17:04 (none) daemon.debug pppd[1526]: Script /etc/ppp/ip-up finished (pid 1584), status = 0x1<br />Jan&nbsp; 1 00:17:11 (none) daemon.err pppd[1347]: connect(8.35): Address already in use<br />Jan&nbsp; 1 00:17:11 (none) daemon.info pppd[1347]: Exit.<br />Jan&nbsp; 1 00:17:11 (none) user.warn kernel: atm_find_ci err = -125<br />Jan&nbsp; 1 00:17:22 (none) daemon.err pppd[1225]: connect(8.35): Address already in use<br />Jan&nbsp; 1 00:17:22 (none) daemon.info pppd[1225]: Exit.<br />Jan&nbsp; 1 00:17:22 (none) user.warn kernel: atm_find_ci err = -125</p><p>We need a script to do &quot;ifup wan&quot; when the router comes up, it&#039;s simple to make.</p><p>see: <a href="http://forum.openwrt.org/viewtopic.php?id=8342">http://forum.openwrt.org/viewtopic.php?id=8342</a></p><p>Now we need to set up iptables (I need to get the correct info) </p><p>quick note too: if you want to change from G.DMT to G.LITE you need to go to adam2 and &quot;SETENV modulation,GDMT&quot; or GLITE</p>											<p class="post-edited">(Last edited by <strong>Z3r0</strong> on 26 Nov 2006, 02:50)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p35604">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">mrmr</div>
					<div class="post-datetime">
						18 Oct 2006, 05:11					</div>
				</div>
				<div class="post-content content">
					<p>hallo Z3r0<br />could you post a logread after a &quot;succesful&quot; pppoe connection (with debug into /etc/ppp/option)?</p><p>i&#039;ve got a 502t with openwrt from an &quot;old&quot; revision too, btw it always fail with pppd...i got always pap-auth LCP timeouts.</p><p>the problem could be:<br /></p><div class="quotebox"><blockquote><p>Texas Instruments ATM driver: version:[4.02.04.00]</p></blockquote></div><p>here there&#039;s a collection of DSP firmware...<br /><a href="http://submax.altervista.org/raccolta_DSP_Annex_A.tar.gz">http://submax.altervista.org/raccolta_D … x_A.tar.gz</a></p><p>btw, they don&#039;t load, simply cause they need &quot;new&quot; symbols from atm.o like jiffies64 and __up</p><p>Can you see a solution to this? i&#039;ve posted also some old message in this forum with my logs, looks:</p><p><a href="http://forum.openwrt.org/viewtopic.php?pid=28775#p28775">http://forum.openwrt.org/viewtopic.php?pid=28775#p28775</a></p><p>thanks <br />mrmr</p>											<p class="post-edited">(Last edited by <strong>mrmr</strong> on 18 Oct 2006, 05:11)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p35613">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">Z3r0</div>
					<div class="post-datetime">
						18 Oct 2006, 07:42					</div>
				</div>
				<div class="post-content content">
					<p>Hey, I don&#039;t know what you mean by logread (ok I know what logread is now.. remote logging tool)... there were no logs in /var/log <br />also debug doesn&#039;t do anything whatsoever, there are no messages in dmesg</p><p>I am using build 5174 and 5181, maybe you should try these builds? ... some of the newer builds #5193 from yesterday night are broken *again* as I think someone moved the AR7 drivers around and broke the includes...</p><p>Did you end up setting modulation? also it appears your script is executing before your DSL line is in sync? perhaps this is the issue? have you tried to connect manually?</p><p>I&#039;ll post more info, if there is any, when I get home tonight and get the firmware and then iptables/port forwarding working</p>											<p class="post-edited">(Last edited by <strong>Z3r0</strong> on 18 Oct 2006, 08:09)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p35644">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">mrmr</div>
					<div class="post-datetime">
						18 Oct 2006, 15:30					</div>
				</div>
				<div class="post-content content">
					<p>mmmh logread read only the circular &quot;log buffer&quot; and pppd should &quot;print&quot; something in this buffer (debug is for make it verbose)</p><p>How about modulation the DSP chip it&#039;s in SHOWTIME and i don&#039;t use a script...so it&#039;s definitely another problem</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p35695">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">Z3r0</div>
					<div class="post-datetime">
						19 Oct 2006, 14:16					</div>
				</div>
				<div class="post-content content">
					<p>woot... ok... couple of extra things to do before you can get on the net</p><p>to be able to hostnames ping (from the modems telnet prompt) you need to change /etc/resolv.conf and add &#039;search wan&#039; before the connection is brought up</p><p>My setup is: adsl (ppp0) -&gt; modem -&gt; (eth0) wireless router -&gt; PC &amp; Laptop</p><p>to be able to ping IPs from your local network you need to do this (I can&#039;t say how secure this is for your modem......) but this is how to get IP masquerading working... taken from here: <a href="http://www.yolinux.com/TUTORIALS/LinuxTutorialIptablesNetworkGateway.html">http://www.yolinux.com/TUTORIALS/LinuxT … teway.html</a></p><p>first:<br />iptables -P INPUT ACCEPT<br />iptables -P OUTPUT ACCEPT<br />iptables -P FORWARD ACCEPT</p><p>iptables --flush&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;- Flush all the rules in filter and nat tables<br />&nbsp; &nbsp;iptables --table nat --flush<br />&nbsp; &nbsp;iptables --delete-chain&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - Delete all chains that are not in default filter and nat table<br />&nbsp; &nbsp;iptables --table nat --delete-chain</p><p>&nbsp; &nbsp;# Set up IP FORWARDing and Masquerading<br />&nbsp; &nbsp;iptables --table nat --append POSTROUTING --out-interface ppp0 -j MASQUERADE<br />&nbsp; &nbsp;iptables --append FORWARD --in-interface eth0 -j ACCEPT&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;- Assuming one NIC to local LAN</p><p>&nbsp; &nbsp;echo 1 &gt; /proc/sys/net/ipv4/ip_forward&nbsp; &nbsp; &nbsp;- Enables packet forwarding by kernel</p><p>Actually the best thing to do is to use OpenWRTs existing firewall rules and add the masquerading commands to the end of /etc/firewall.user</p><p>iptables -t nat -A postrouting_rule -o ppp0 -j MASQUERADE</p><p>iptables -A forwarding_rule -i eth0 -j ACCEPT </p><p>here is the logread mrmr: </p><p>Jan&nbsp; 1 00:00:31 (none) user.warn kernel: closing channel: 0<br />Jan&nbsp; 1 00:01:03 (none) user.info kernel: CSLIP: code copyright 1989 Regents of t<br />he University of California<br />Jan&nbsp; 1 00:01:07 (none) user.info kernel: PPP generic driver version 2.4.2<br />Jan&nbsp; 1 00:01:22 (none) user.warn kernel: DSL in Sync<br />Jan&nbsp; 1 00:01:33 (none) local0.info RFC1483/2684 bridge: Interface &quot;nas0&quot; (mtu=15<br />00, payload=bridged) created sucessfully<br />Jan&nbsp; 1 00:01:33 (none) local0.info RFC1483/2684 bridge: Communicating over ATM 0<br />.8.35, encapsulation: LLC<br />Jan&nbsp; 1 00:01:33 (none) local0.info RFC1483/2684 bridge: Interface configured<br />Jan&nbsp; 1 00:01:33 (none) local0.info RFC1483/2684 bridge: RFC 1483/2684 bridge dae<br />mon started<br />Jan&nbsp; 1 00:01:34 (none) daemon.info pppd[491]: Plugin rp-pppoe.so loaded.<br />Jan&nbsp; 1 00:01:35 (none) daemon.info dnsmasq[321]: reading /tmp/resolv.conf<br />Jan&nbsp; 1 00:01:35 (none) daemon.info dnsmasq[321]: using nameserver 192.189.54.33#<br />53<br />Jan&nbsp; 1 00:01:35 (none) daemon.info dnsmasq[321]: using nameserver 203.8.183.1#53<br />Jan&nbsp; 1 00:01:35 (none) daemon.info dnsmasq[321]: using local addresses only for<br />domain lan<br />Jan&nbsp; 1 00:01:35 (none) daemon.info pppd[537]: Plugin rp-pppoe.so loaded.<br />Jan&nbsp; 1 00:01:37 (none) daemon.notice pppd[626]: pppd 2.4.3 started by root, uid<br />0<br />Jan&nbsp; 1 00:01:52 (none) daemon.warn pppd[626]: Timeout waiting for PADS packets<br />Jan&nbsp; 1 00:01:52 (none) daemon.err pppd[626]: Unable to complete PPPoE Discovery<br />Jan&nbsp; 1 00:01:52 (none) daemon.info pppd[626]: Exit.<br />Jan&nbsp; 1 00:03:10 (none) daemon.info dnsmasq[321]: DHCPDISCOVER(eth0) 192.168.1.11<br />1 00:01:6c:a6:05:93<br />Jan&nbsp; 1 00:03:10 (none) daemon.info dnsmasq[321]: DHCPOFFER(eth0) 192.168.1.111 0<br />0:01:6c:a6:05:93<br />Jan&nbsp; 1 00:03:10 (none) daemon.info dnsmasq[321]: DHCPREQUEST(eth0) 192.168.1.111<br /> 00:01:6c:a6:05:93<br />Jan&nbsp; 1 00:03:10 (none) daemon.info dnsmasq[321]: DHCPACK(eth0) 192.168.1.111 00:<br />01:6c:a6:05:93 ZPC</p><p>I had a few problems with the pppd spawning 10-20x for some reason... managed to get it working after by killing all of them... killing br2684ctl and starting again.</p>											<p class="post-edited">(Last edited by <strong>Z3r0</strong> on 26 Nov 2006, 03:17)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p36347">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">KillaB</div>
					<div class="post-datetime">
						1 Nov 2006, 02:25					</div>
				</div>
				<div class="post-content content">
					<p>@Z3r0</p><p>Thanks for your great howto!</p><p>I&#039;m able to sync using GDMT and see SHOWTIME in &quot;/proc/tiatm/avsar_modem_training&quot; after bringing up nas0 with br2684ctl.....however ppp0 never comes up.</p><p>Would you please post your working config files (minus login and passwords)?<br />Is it really &quot;user&quot; and &quot;name&quot; that we use in &quot;/etc/config/network&quot;?<br />Shouldn&#039;t that be &quot;username&quot; and &quot;passwd&quot;?</p><p>Also, what SVN build are you running?</p><p>Cheers,<br />Jason</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p36348">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">mrmr</div>
					<div class="post-datetime">
						1 Nov 2006, 02:28					</div>
				</div>
				<div class="post-content content">
					<p>@KillaB</p><p>Please, post your debug log of pppd failure...i&#039;m in the same situation for looooong time...</p><p>Thanks</p><p>mrmr</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p36379">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">KillaB</div>
					<div class="post-datetime">
						1 Nov 2006, 17:06					</div>
				</div>
				<div class="post-content content">
					<p>@mrmr</p><p>I&#039;d love to, but how?<br />Running &quot;br2684ctl -b -c 0 -a 0.35&quot; sets up the pppd process, so I don&#039;t know how to turn on debugging.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>