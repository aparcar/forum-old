<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> How to install Openwrt on bricked DLink DSL502T GEN II - simple guide.</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 31 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p184519">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">granyte</div>
					<div class="post-datetime">
						28 Nov 2012, 06:18					</div>
				</div>
				<div class="post-content content">
					<p>Big thanks to <a href="http://forum.openwrt.org/profile.php?id=5141"> Z3r0</a><br />Without him I would have been totally screwed, and if you&#039;re reading this,so would you.<br />So please give him lots of money (or a big thank you or something).</p><br /><p>Hi there everyone!<br />I just spent probably the better part of a week trying to recover my DSL502T Gen II from a bad firmware upgrade.<br />If you&#039;re in the same position, or you&#039;re just looking to install openwrt on your modem, then read on.</p><p>Obviously I can&#039;t guarantee that this will work for you as well, so if you&#039;re router is still working just fine proceed with caution.<br />If it&#039;s already broken then you&#039;ve got nothing to loose.</p><p>TL;DR&nbsp; &nbsp; If it&#039;s not broken don&#039;t fix it :p </p><p>I had no idea about openwrt, or routers or anything in this department until about a week ago, so hopefully this tutorial is easy enough to follow. If you&#039;re having any trouble, or the links are down please send me an email at <br />herbert (dot) todd (at) gmail.com</p><p>Anyway down to business.</p><br /><p>What you will need:</p><p>&nbsp; &nbsp; &nbsp;The folder of software you&#039;ll need: <a href="https://www.dropbox.com/s/2z53y4e49kgf6la/dsl502t-openwrt.zip">Download Here</a><br />&nbsp; &nbsp; &nbsp;A PC running Windows XP, with a parallel port (the big pink one you plugged printers into in the 90&#039;s)<br />&nbsp; &nbsp; &nbsp;A screwdriver to get into the modem case<br />&nbsp; &nbsp; &nbsp;Basic computer skills<br />&nbsp; &nbsp; &nbsp;Basic soldering skills and equipment (soldering iron, solder, etc)</p><p>&nbsp; &nbsp; &nbsp;Electrical components:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1 x Male Parallel Port<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5 x 100 ohm resistors<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5 x Pin clip things (Have no idea what the term is. I scavenged mine from the frontpanel of a computer, but any will do.) <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Wire</p><br /><p>Here&#039;s an overview of what we&#039;re going to do:</p><p>First we&#039;re going to build a JTAG cable. Never heard of it? Neither had I. Long story short it lets you connect your computer directly to the processor of certain devices, like routers, gaming consoles etc.</p><p>Once we&#039;ve done that we need to use this connection to wipe the router clean, and upload our new files. After that we&#039;re going to connect it up through the ethernet cable again and upload the rest of the files.</p><p>Once that&#039;s done its just a simple matter of setting up the new software.</p><br /><br /><p>Let&#039;s get started.</p><br /><p>1.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Making the JTAG cable</p><p><a href="http://Pictat.com/show.php?i=/2012/11/27/29096homemadejt.jpg"><span class="postimg"><img src="http://Pictat.com/t/2012/11/27/29096homemadejt.jpg" alt="http://Pictat.com/t/2012/11/27/29096homemadejt.jpg" /></span></a></p><p>This is our end product (click pictures for full version)</p><p>The pins on the male parallel plug should be numbered.<br />You need to solder the resistors to pins 2, 3, 4, 13.<br />Also solder a short length of wire to pins 20 and 25 (as per the picture)</p><p>Now solder a length of wire with a jumper clip on the end to the resistors.<br />Also join the two short lengths of wire from pins 20 and 25 together, and attach one wire with a jumper clip onto that. </p><p><a href="http://Pictat.com/show.php?i=/2012/11/27/20484img2001.jpg"><span class="postimg"><img src="http://Pictat.com/t/2012/11/27/20484img2001.jpg" alt="http://Pictat.com/t/2012/11/27/20484img2001.jpg" /></span></a><br />(Closer view of it, hopefully you get the idea)</p><p>It is VERY IMPORTANT that the wires are only about 15cm long (as in the pictures). If they are too much longer the cable WILL NOT WORK.</p><br /><br /><p>2. Solder Resistor to Router.</p><p>Open up your router and solder the final 100 ohm resistor from the pin labelled 1 to the pin labelled 8. <br />We will be using this set of pins in the bottom left hand corner, they should be labelled JP1</p><p><a href="http://Pictat.com/show.php?i=/2012/11/28/35091img2002.jpg"><span class="postimg"><img src="http://Pictat.com/t/2012/11/28/35091img2002.jpg" alt="http://Pictat.com/t/2012/11/28/35091img2002.jpg" /></span></a></p><br /><p>3. Attach the jumper clips to the correct pins.</p><p>Please follow this diagram:<br /><span class="postimg"><img src="http://pictat.com/i/2013/2/17/4996010424dlink.png" alt="http://pictat.com/i/2013/2/17/4996010424dlink.png" /></span></p><p>It&#039;s going to take some fiddling around with to get to work, but trust me. The layout is right.</p><br /><br /><p>4. Load the driver.</p><p>Now we&#039;re going to use a piece of software called tjtag to flash the new software onto the modem.<br />But before we can use it we need to load a driver for it.<br />You have to repeat this process every time you restart your computer before you use the tjtag software.</p><p>Copy the tjtag folder from your resources file to your desktop or somewhere.<br />Now copy the giveio.sys file from that folder to C:/WINDOWS/System32/drivers.<br />Next open up the loaddrv.exe program in the tjtag folder.</p><p>A window should open up. Change the text that says c:/windows/system32/drivers so that it says c:/windows/system32/drivers/giveio.sys.</p><p>Now click the install button, and then the start button.</p><p>The driver is ready to go, so close the program now.</p><br /><p><a href="http://Pictat.com/show.php?i=/2012/11/28/23689loaddrv.png"><span class="postimg"><img src="http://Pictat.com/t/2012/11/28/23689loaddrv.png" alt="http://Pictat.com/t/2012/11/28/23689loaddrv.png" /></span></a></p><br /><br /><br /><p>5.&nbsp; &nbsp; Check that the modem is correctly connected</p><p>Now we&#039;re ready to use tjtag.</p><p>Open command prompt (cmd) and change directory to the tjtag folder.<br />Now type in and run &quot;tjtag -probeonly&quot;</p><p>This command will check that the modem is correctly connected.</p><br /><p><a href="http://Pictat.com/show.php?i=/2012/11/28/40867probe.png"><span class="postimg"><img src="http://Pictat.com/t/2012/11/28/40867probe.png" alt="http://Pictat.com/t/2012/11/28/40867probe.png" /></span></a></p><br /><br /><p><a href="http://Pictat.com/show.php?i=/2012/11/28/40596successful.png"><span class="postimg"><img src="http://Pictat.com/t/2012/11/28/40596successful.png" alt="http://Pictat.com/t/2012/11/28/40596successful.png" /></span></a><br />This is a successful probe. This is what you want to see.</p><br /><br /><p><a href="http://Pictat.com/show.php?i=/2012/11/28/43942failedprob.png"><span class="postimg"><img src="http://Pictat.com/t/2012/11/28/43942failedprob.png" alt="http://Pictat.com/t/2012/11/28/43942failedprob.png" /></span></a><br />If you see something more like this, something isn&#039;t working.<br />Chances are that your router isn&#039;t turned on, or the cable isn&#039;t hooked up right / built right.</p><p>Fiddle around with the cable a little. Sometimes just separating the wires a little and moving the modem as far away from the computer as the wires will allow helps.</p><br /><br /><br /><br /><p>6.&nbsp; &nbsp; Erase the router</p><p>As of this step there is no turning back!</p><p>The next thing we need to do is completely wipe the router to make way for the new firmware.<br />This will only work if the probe was successful. If it wasn&#039;t, go back and keep trying. I promise that the diagrams are right.</p><p>In the same command prompt, run the command &quot;tjtag -erase:custom /window:0x90000000 /start:0x90000000 /length:0x40000 /nocwd&quot;</p><br /><p><a href="http://Pictat.com/show.php?i=/2012/11/28/41881successful.png"><span class="postimg"><img src="http://Pictat.com/t/2012/11/28/41881successful.png" alt="http://Pictat.com/t/2012/11/28/41881successful.png" /></span></a></p><p>This should have erased the entire flash chip, from the region 0x90000000 to 0x90040000. Understanding these regions is highly relevant to setting up openwrt on your router.</p><br /><br /><br /><p>7.&nbsp; &nbsp; &nbsp; Load the new bootloader</p><p>Now that we&#039;ve completely wiped the router we can start loading on the software. The first thing we need to load is the bootloader. The bootloader talks directly to the router hardware, and is the first thing we need to load back on.</p><br /><p>Side Note About regions (atleast that&#039;s what I think they&#039;re called):<br />Those big numbers above (0x900.. etc) are referring to an area of the memory inside the router. At this point we are just using those numbers to refer to the area we want to erase or fill, but soon we will start calling them by a different simpler name; &quot;mtd&quot;.</p><p>Think of them as partitions.</p><p>In this router there should be 5 of these partitions; mtd0, mtd1, mtd2, mtd3, mtd4.</p><p>Each of these partitions has a region assigned to it, and serves a certain purpose (which I don&#039;t completely understand seeing how I&#039;m learning this as I go, appologies if I&#039;m talking a complete load of rubbish).</p><p>In the DSL502T the default regions for the mtd&#039;s are as follows:</p><p>mtd&nbsp; &nbsp;&nbsp; &nbsp;start&nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;end&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; purpose<br />0&nbsp; &nbsp;&nbsp; 0x900b1000&nbsp; &nbsp;&nbsp; 0x903e0000&nbsp; &nbsp; &nbsp;filesystem?<br />1&nbsp; &nbsp;&nbsp; 0x90020090&nbsp; &nbsp;&nbsp; 0x900b1000&nbsp; &nbsp; &nbsp;kernel?<br />2&nbsp; &nbsp;&nbsp; 0x90000000&nbsp; &nbsp;&nbsp; 0x90010000&nbsp; &nbsp; &nbsp;BOOTLOADER<br />3&nbsp; &nbsp;&nbsp; 0x90010000&nbsp; &nbsp;&nbsp; 0x90020000&nbsp; &nbsp; &nbsp;CONFIG<br />4&nbsp; &nbsp;&nbsp; 0x90020000&nbsp; &nbsp;&nbsp; 0x903e0000&nbsp; &nbsp; &nbsp;Filesystem again? (We will upload our openwrt image here later)</p><p>We will change the addresses of some of these later.<br />Anyway back on topic...</p><br /><p>The first thing we want to flash is the mtd2.<br />Go into the tjtag folder and rename mtd2.bin to custom.bin. This allows us to flash it to the router with the -flash:custom command.</p><p>To do this we will issue the following command: &quot;tjtag -flash:custom /window:0x900000000 /start:0x90000000 /length:0x10000&quot;</p><p>Notice how we are flashing the range that corresponds to the mtd partition in the table above?</p><br /><p>Expect this to take a long time, perhaps about 20-30 minutes. Coffee break!</p><br /><br /><p><a href="http://Pictat.com/show.php?i=/2012/11/28/34131flashingmt.png"><span class="postimg"><img src="http://Pictat.com/t/2012/11/28/34131flashingmt.png" alt="http://Pictat.com/t/2012/11/28/34131flashingmt.png" /></span></a><br />You should be seeing a lot of this.</p><br /><br /><br /><p>8.&nbsp; &nbsp;Load the config into mtd3<br />You&#039;re still here? Good.</p><p>Okay next we want to flash the mtd3.bin image into the mtd3 partition (ranging from&nbsp; 0x90010000 - 0x90020000).</p><p>Delete the old custom.bin file in the jtag folder and rename mtd3.bin to custom.bin.</p><p>Now issue a similar command to above to flash the new custom.bin (the mtd3.bin) to a different partition:<br />&quot;tjtag -flash:custom /window:0x90010000 /start:0x90010000 /length:0x10000 /nocwd&quot;</p><p>This should also take about 20-30 minutes and look almost identical to the the last flash we did.&nbsp; **(It only took 2 minutes for me last time so don&#039;t be surprised if it doesn&#039;t take long at all)</p><br /><br /><p>9.&nbsp; &nbsp;Change the mtd1 address</p><p>If you&#039;ve made it this far, that&#039;s great! You&#039;re ready to start setting up and installing openwrt.</p><p>Turn off your router, unplug the JTAG cable from it and screw it back together. We won&#039;t be needing to use it for the remainder of this tutorial. I highly recommend that you leave the resistor soldered onto the router however, in case you do something wrong with openwrt and need to start the tutorial again.</p><br /><p>Plug it into the power (and only the power) and turn it on. The power light should come on, and then about 30 seconds later the USB light should begin to flash.<br />This is the routers way of telling us that the bootloader is installed and working properly, but there is no firmware for it to load.</p><br /><p>Now connect it to your computer via ethernet.</p><p>Next you need to change your ip settings to match the router in this funny state. <br />I have a Telecom NZ model, so the settings for me are as follows:</p><p>IP: 5.8.8.99<br />Subnet mask: 255.0.0.0<br />gateway: 5.8.8.8</p><p>dns 1:&nbsp; 5.8.8.8<br />dns 2:&nbsp; &nbsp;4.2.2.2</p><br /><p>If this doesn&#039;t work for the following step you may need to try changing all the 5&#039;s to 10&#039;s. (ip:10.8.8.99, gateway: 10.8.8.8 etc)</p><br /><p>Hopefully you know how to change you ip, but incase you don&#039;t: Control panel &gt; Network Connections &gt; Right click you ethernet adapter &gt; properties &gt; double click Internet Protocol (tcp/ip).</p><br /><p>Open up command prompt and start up the router. After about 5 seconds very quickly enter the command &quot;telnet 5.8.8.8 21&quot;&nbsp; &nbsp;(or 10.8.8.8 if that applies)</p><br /><br /><p>You should be Greeted with a screen saying&nbsp; &nbsp; &quot;220 ADAM2 FTP Server ready.&quot;</p><p>If not turn off the router, exit command prompt and try again. You have to get the timing right.</p><p>Be careful: in the telnet program you can&#039;t backspace, if you make an error you have to press enter and start typing the line again.</p><br /><p>Now we will enter commands to change the mtd1 address</p><p>Enter this:&nbsp; &nbsp; &nbsp;USER adam2<br />It will reply:&nbsp; &nbsp;331 Password required for adam2.<br />Enter this:&nbsp; &nbsp; &nbsp;PASS adam2<br />It will reply:&nbsp; &nbsp;230 User adam2 successfully logged in.<br />Enter this:&nbsp; &nbsp; &nbsp;SETENV mtd1,0x90020000,0x903e0000<br />It will reply:&nbsp; &nbsp;200 SETENV command successful</p><p>At this point you can close the command prompt (because there appears to be no other way to quit the telnet program).</p><br /><p><a href="http://Pictat.com/show.php?i=/2012/11/28/15406telnet.png"><span class="postimg"><img src="http://Pictat.com/t/2012/11/28/15406telnet.png" alt="http://Pictat.com/t/2012/11/28/15406telnet.png" /></span></a></p><br /><p>We basically just changed the address of mtd1, so that it is the same as mtd4 (which is where we are about to upload the openwrt image to)</p><br /><br /><p>10.&nbsp; Upload and install openwrt</p><p>Open command prompt and enter &quot;ftp 5.8.8.8&quot;&nbsp; &nbsp;(or 10.8.8.8 if that applies to you)</p><p>It will ask you for a username and a password, both are &quot;adam2&quot;</p><p>Once you&#039;ve logged in enter the following commands:<br />&quot;quote MEDIA FLSH&quot;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;&nbsp; yes that&#039;s FLSH, not FLASH<br />&quot;bin&quot;<br />&quot;hash&quot;</p><p>Now enter:</p><p>put (location of the openwrt.img file) &quot;fs mtd4&quot;</p><br /><p>For example, if you had the folder in C:\ you would enter:<br />put &quot;C:\dsl502t-openwrt\openwrt.img&quot; &quot;fs mtd4&quot;</p><br /><p>The openwrt image will then upload.</p><p>The whole process should look like this:<br /><a href="http://Pictat.com/show.php?i=/2012/11/28/19410successful.png"><span class="postimg"><img src="http://Pictat.com/t/2012/11/28/19410successful.png" alt="http://Pictat.com/t/2012/11/28/19410successful.png" /></span></a></p><p>Now quit command prompt and turn off the router.</p><br /><br /><p>11.&nbsp; &nbsp; Change your IP and DNS settings back to DHCP<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />Pretty self explanitory.<br />Control panel &gt; Network Connections &gt; Right click you ethernet adapter &gt; properties &gt; double click Internet Protocol (tcp/ip).</p><br /> <br /><p>12.&nbsp; &nbsp; &nbsp;Plug in the phone line and start up the router</p><p>Congratulations! Openwrt is now successfully installed on your DSL502T</p><br /><p>When the router has started up (may take a minute or two) point your browser at 192.168.1.1 to confirm that the router is working. By default there is no password.</p><p>NOTE: at this point you still won&#039;t have an internet connection. In order to use the phone jack we have to set up a new interface, bringing us to the final step.</p><p>13.&nbsp; &nbsp; &nbsp;Configuring your internet connection.</p><p>This one had me stumped for quite a while, but I finally figured it out. </p><p>Log in to LuCi (the software at 192.168.1.1 in your browser) and change mode to &quot;Administration&quot; (click administration in the top right hand corner).</p><p>Now go to Network (top left) &gt; Interfaces.<br />At the bottom of the page enter &quot;wan&quot; into the text box and press &quot;add entry&quot;.</p><p>It will then prompt you to fill in the details for the interface. Most of these settings will depend on your ISP. Give them all call up if you don&#039;t know them. They will happily tell you. </p><p>For the interface section select &quot;-- custom --&quot; and enter &quot;ppp0&quot;.</p><p>For Telecom NZ the settings are as follows.<br />Protocol: PPoA<br />Bridge interfaces.<br />Interface: ppp0<br />username: (your username/front of your email address).xadsl@xtra.co.nz<br />password: (your email password)<br />PPoA Encapsulation: VC<br />VPI: 0<br />VCI: 100<br />Replace default route: Yes<br />Use peer DNS: Yes<br />Enable ipv6 on ppp link: No</p><br /><br /><p>Enjoy your wonderful new salvaged router.</p><p>If you need help or the links are down, please try and contact me at <br />herbert (dot) todd (at) gmail.com</p>											<p class="post-edited">(Last edited by <strong>granyte</strong> on 17 Feb 2013, 02:19)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>