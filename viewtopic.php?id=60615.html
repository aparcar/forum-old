<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> perl  crypt() function is unimplemented due to excessive paranoia</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 4 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p297904">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">lsoltero</div>
					<div class="post-datetime">
						29 Oct 2015, 21:37					</div>
				</div>
				<div class="post-content content">
					<p>Hello Trying to get the perl crypt() function to work on CC 15.05.&nbsp; I installed the perl package and then did a make. Perl compiles and runs.&nbsp; &nbsp;However...&nbsp; the crypt function does not work.&nbsp; Note that this used to work on previous versions of OpenWRT.&nbsp; Any thoughts are greatly appreciated.</p><p>Here is the error I get..</p><p>root@Optimizer:/usr/local/gmnbin# perl -d</p><p>Loading DB routines from perl5db.pl version 1.44<br />Editor support available.</p><p>Enter h or &#039;h h&#039; for help, or &#039;man perldebug&#039; for more help.</p><p>crypt(&quot;helllo&quot;,&quot;hello&quot;);<br />main::(-:1):&nbsp; &nbsp; crypt(&quot;helllo&quot;,&quot;hello&quot;)<br />&nbsp; DB&lt;1&gt; n<br />The crypt() function is unimplemented due to excessive paranoia. at - line 1.<br /> at - line 1.<br />Debugged program terminated.&nbsp; Use q to quit or R to restart,<br />use o inhibit_exit to avoid stopping after program termination,<br />h q, h R or h o to get additional info.<br />&nbsp; DB&lt;1&gt; </p><br /><p>Here is perl -V showing that -lcrypt was compiled into the binary.</p><p>root@Optimizer:/usr/local/gmnbin# perl -V<br />Summary of my perl5 (revision 5 version 20 subversion 2) configuration:<br />&nbsp; &nbsp;<br />&nbsp; Platform:<br />&nbsp; &nbsp; osname=linux, osvers=2.4.30, archname=mipsel-linux-uclibc<br />&nbsp; &nbsp; uname=&#039;linux merope 2.4.30 #1 di 23. jan 15:23:42 cet 2007 mips unknown unknown gnulinux &#039;<br />&nbsp; &nbsp; config_args=&#039;-der -Dusethreads&#039;<br />&nbsp; &nbsp; hint=recommended, useposix=true, d_sigaction=define<br />&nbsp; &nbsp; useithreads=define, usemultiplicity=define<br />&nbsp; &nbsp; use64bitint=undef, use64bitall=undef, uselongdouble=undef<br />&nbsp; &nbsp; usemymalloc=n, bincompat5005=undef<br />&nbsp; Compiler:<br />&nbsp; &nbsp; cc=&#039;mipsel-openwrt-linux-uclibc-gcc&#039;, ccflags =&#039;-D_REENTRANT -D_GNU_SOURCE -Os -pipe -mno-branch-likely -mips32r2 -mtune=24kec -mdsp -fno-caller-saves -fhonour-copts -Wno-error=unused-but-set-variable -msoft-float -I/disk2/lsoltero/openwrt.cc/staging_dir/target-mipsel_24kec+dsp_uClibc-0.9.33.2/usr/include -I/disk2/lsoltero/openwrt.cc/staging_dir/target-mipsel_24kec+dsp_uClibc-0.9.33.2/include -I/disk2/lsoltero/openwrt.cc/staging_dir/toolchain-mipsel_24kec+dsp_gcc-4.8-linaro_uClibc-0.9.33.2/usr/include -I/disk2/lsoltero/openwrt.cc/staging_dir/toolchain-mipsel_24kec+dsp_gcc-4.8-linaro_uClibc-0.9.33.2/include&#039;,<br />&nbsp; &nbsp; optimize=&#039;-O2&#039;,<br />&nbsp; &nbsp; cppflags=&#039;-D_REENTRANT -D_GNU_SOURCE -Os -pipe -mno-branch-likely -mips32r2 -mtune=24kec -mdsp -fno-caller-saves -fhonour-copts -Wno-error=unused-but-set-variable -msoft-float -I/disk2/lsoltero/openwrt.cc/staging_dir/target-mipsel_24kec+dsp_uClibc-0.9.33.2/usr/include -I/disk2/lsoltero/openwrt.cc/staging_dir/target-mipsel_24kec+dsp_uClibc-0.9.33.2/include -I/disk2/lsoltero/openwrt.cc/staging_dir/toolchain-mipsel_24kec+dsp_gcc-4.8-linaro_uClibc-0.9.33.2/usr/include -I/disk2/lsoltero/openwrt.cc/staging_dir/toolchain-mipsel_24kec+dsp_gcc-4.8-linaro_uClibc-0.9.33.2/include&#039;<br />&nbsp; &nbsp; ccversion=&#039;&#039;, gccversion=&#039;3.4.3&#039;, gccosandvers=&#039;&#039;<br />&nbsp; &nbsp; intsize=4, longsize=4, ptrsize=4, doublesize=8, byteorder=1234<br />&nbsp; &nbsp; d_longlong=define, longlongsize=8, d_longdbl=define, longdblsize=8<br />&nbsp; &nbsp; ivtype=&#039;long&#039;, ivsize=4, nvtype=&#039;double&#039;, nvsize=8, Off_t=&#039;off_t&#039;, lseeksize=8<br />&nbsp; &nbsp; alignbytes=8, prototype=define<br />&nbsp; Linker and Libraries:<br />&nbsp; &nbsp; ld=&#039;mipsel-openwrt-linux-uclibc-gcc&#039;, ldflags =&#039;&#039;<br />&nbsp; &nbsp; libpth=/disk2/lsoltero/openwrt.cc/staging_dir/target-mipsel_24kec+dsp_uClibc-0.9.33.2/lib /disk2/lsoltero/openwrt.cc/staging_dir/target-mipsel_24kec+dsp_uClibc-0.9.33.2/usr/lib<br />&nbsp; &nbsp; libs=-lgdbm -ldb -ldl -lm -lcrypt -lutil -lpthread -lc<br />&nbsp; &nbsp; perllibs=-ldl -lm -lcrypt -lutil -lpthread -lc <br />&nbsp; &nbsp; libc=, so=so, useshrplib=true, libperl=libperl.so<br />&nbsp; &nbsp; gnulibc_version=&#039;&#039;<br />&nbsp; Dynamic Linking:<br />&nbsp; &nbsp; dlsrc=dl_dlopen.xs, dlext=so, d_dlsymun=undef, ccdlflags=&#039;-fPIC -Wl,-rpath,/usr/lib/perl5/5.20/CORE&#039;<br />&nbsp; &nbsp; cccdlflags=&#039;-fPIC&#039;, lddlflags=&#039;-shared -rdynamic -L/disk2/lsoltero/openwrt.cc/staging_dir/target-mipsel_24kec+dsp_uClibc-0.9.33.2/usr/lib -L/disk2/lsoltero/openwrt.cc/staging_dir/target-mipsel_24kec+dsp_uClibc-0.9.33.2/lib -L/disk2/lsoltero/openwrt.cc/staging_dir/toolchain-mipsel_24kec+dsp_gcc-4.8-linaro_uClibc-0.9.33.2/usr/lib -L/disk2/lsoltero/openwrt.cc/staging_dir/toolchain-mipsel_24kec+dsp_gcc-4.8-linaro_uClibc-0.9.33.2/lib&#039;</p><br /><p>Characteristics of this binary (from libperl): <br />&nbsp; Compile-time options: HAS_TIMES MULTIPLICITY PERLIO_LAYERS<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PERL_DONT_CREATE_GVSV<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PERL_HASH_FUNC_ONE_AT_A_TIME_HARD<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PERL_IMPLICIT_CONTEXT PERL_MALLOC_WRAP<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PERL_NEW_COPY_ON_WRITE PERL_PRESERVE_IVUV<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; USE_ITHREADS USE_LARGE_FILES USE_LOCALE<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; USE_LOCALE_COLLATE USE_LOCALE_CTYPE<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; USE_LOCALE_NUMERIC USE_PERLIO USE_PERL_ATOF<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; USE_REENTRANT_API<br />&nbsp; Built under linux<br />&nbsp; Compiled at Oct 20 2015 04:10:52<br />&nbsp; @INC:<br />&nbsp; &nbsp; /usr/lib/perl5/5.20<br />&nbsp; &nbsp; .</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p297923">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">lsoltero</div>
					<div class="post-datetime">
						29 Oct 2015, 23:37					</div>
				</div>
				<div class="post-content content">
					<p>so i copied in version of the Perl Makefile from an older version of the package. then replaced the version from 5.20.1 to 5.20.2 and updated the md5 sum and then compiled...</p><p>now crypt works again.</p><p>Here are the diffs between the older version (the +s) and the newer version (the -s)</p><p>the bit difference seems to be CONFIG_USE_GLIBC in the new make file vs CONFIG_USE_EGLIBC in the old one? what is that about?</p><p>anyway.. its working.</p><p>root@Optimizer:~# perl -d</p><p>Loading DB routines from perl5db.pl version 1.44<br />Editor support available.</p><p>Enter h or &#039;h h&#039; for help, or &#039;man perldebug&#039; for more help.</p><p>crypt(&quot;hello&quot;,&quot;hello&quot;);<br />main::(-:1):&nbsp; &nbsp; crypt(&quot;hello&quot;,&quot;hello&quot;);<br />&nbsp; DB&lt;1&gt; quit</p><br /><p>if anyone can shed light on this it would greatly be appreciated.</p><br /><p>diff --git a/lang/perl/Makefile b/lang/perl/Makefile<br />index abd327f..c28d41d 100644<br />--- a/lang/perl/Makefile<br />+++ b/lang/perl/Makefile<br />@@ -1,5 +1,5 @@<br /> #<br />-# Copyright (C) 2006-2015 OpenWrt.org<br />+# Copyright (C) 2006-2014 OpenWrt.org<br /> #<br /> # This is free software, licensed under the GNU General Public License v2.<br /> # See /LICENSE for more information.<br />@@ -36,34 +36,19 @@ HOST_BUILD_PARALLEL:=1</p><p> # Variables used during configuration/build<br /> HOST_PERL_PREFIX:=$(STAGING_DIR_HOST)/usr<br />-ifneq ($(CONFIG_USE_GLIBC),)<br />+ifneq ($(CONFIG_USE_EGLIBC),)<br />&nbsp; &nbsp; &nbsp; &nbsp; EXTRA_LIBS:=bsd<br />&nbsp; &nbsp; &nbsp; &nbsp; EXTRA_LIBDIRS:=$(STAGING_DIR)/lib<br /> endif<br />-<br /> # Filter -g3, it will break Compress-Raw-Zlib<br /> TARGET_CFLAGS_PERL:=$(patsubst -g3,-g,$(TARGET_CFLAGS))<br /> TARGET_CPPFLAGS_PERL:=$(patsubst -g3,-g,$(TARGET_CPPFLAGS))</p><p>-# Handle threading<br />-ifdef CONFIG_PERL_THREADS<br />-&nbsp; &nbsp; &nbsp; &nbsp;PERL_CONFIG_SUFFIX:=-mt<br />-<br />-&nbsp; &nbsp; &nbsp; &nbsp;# uclibc doesn&#039;t provide crypt_r(). Enable crypt() usage for glibc builds only<br />-&nbsp; &nbsp; &nbsp; &nbsp;ifdef CONFIG_USE_GLIBC<br />-&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;CRYPT_R_PROTO:=REENTRANT_PROTO_B_CCS<br />-&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;CRYPT:=define<br />-&nbsp; &nbsp; &nbsp; &nbsp;else<br />-&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;CRYPT_R_PROTO:=0<br />-&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;CRYPT:=undef<br />-&nbsp; &nbsp; &nbsp; &nbsp;endif<br />-endif<br />-<br />-# A list of disabled tests<br />+# A list of disabled testss<br /> # ExtUtils tests are disabled for now as we don&#039;t support building<br /> # native extensions on the target machine at the moment<br /> PERL_DISABLEDTESTS:=cpan/ExtUtils-Constant cpan/ExtUtils-MakeMaker<br />-# We&#039;re on Linux, so don&#039;t even package them<br />+# We&#039;re on Linux, so don&#039;t even package those<br /> PERL_DISABLEDTESTS+=cpan/Win32API-File cpan/Win32 ext/VMS-DCLsym ext/VMS-Filespec ext/VMS-Stdio ext/Win32CORE<br /> # NDBM and ODBM not supported<br /> PERL_DISABLEDTESTS+=ext/NDBM_File ext/ODBM_File<br />@@ -79,7 +64,7 @@ define Package/perl<br />&nbsp; &nbsp;CATEGORY:=Languages<br />&nbsp; &nbsp;TITLE:=The Perl intepreter<br />&nbsp; &nbsp;URL:=http://www.perl.com/<br />-&nbsp; DEPENDS:=+USE_GLIBC:libbsd +PERL_THREADS:libpthread<br />+&nbsp; DEPENDS:=+USE_EGLIBC:libbsd +libpthread<br /> endef</p><p> define Package/perl/description<br />@@ -123,12 +108,13 @@ define Build/Configure<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -e &#039;s!%%EXTRA_PERLLIBDIRS%%!$(EXTRA_LIBDIRS:%=-L%)!g&#039; \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -e &#039;s!%%IPV6%%!$(if $($(CONFIG_IPV6)),define,undef)!g&#039; \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -e &#039;s!%%HOSTMINIPERL%%!$(HOST_PERL_PREFIX)/bin/perl!g&#039; \<br />-&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-e &#039;s!%%CRYPT_R_PROTO%%!$(CRYPT_R_PROTO)!g&#039; \<br />-&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-e &#039;s!%%CRYPT%%!$(CRYPT)!g&#039; \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -e &#039;s!%%HOSTGENERATE%%!$(HOST_PERL_PREFIX)/bin/generate_uudmap!g&#039; \<br />-&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;files/config.sh-$(patsubst i386,i486,$(ARCH))$(PERL_CONFIG_SUFFIX).in \<br />+&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -e &quot;s!perllibs=&#039;!perllibs=&#039;-lpthread !&quot; \<br />+&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -e s!useithreads=.undef.!useithreads=&quot;&#039;define&#039;&quot;! \<br />+&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -e s!usemultiplicity=.undef.!usemultiplicity=&quot;&#039;define&#039;&quot;! \<br />+&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;files/config.sh-$(patsubst i386,i486,$(ARCH)).in \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &gt; $(PKG_BUILD_DIR)/config.sh<br />-&nbsp; &nbsp; &nbsp; &nbsp;(cd $(PKG_BUILD_DIR) &amp;&amp; ./Configure -S)<br />+&nbsp; &nbsp; &nbsp; &nbsp;(cd $(PKG_BUILD_DIR) &amp;&amp; ./Configure -S -Duseithreads -Dusemultiplicity)<br />&nbsp; &nbsp; &nbsp; &nbsp; install -m 0644 $(PKG_BUILD_DIR)/config.h $(PKG_BUILD_DIR)/xconfig.h<br /> endef</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p297969">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						30 Oct 2015, 10:04					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>lsoltero wrote:</cite><blockquote><p>the bit difference seems to be CONFIG_USE_GLIBC in the new make file vs CONFIG_USE_EGLIBC in the old one? what is that about?<br />....<br />&nbsp; &nbsp;-&nbsp; &nbsp; &nbsp; &nbsp;# uclibc doesn&#039;t provide crypt_r(). Enable crypt() usage for glibc builds only</p></blockquote></div><p>This is about the &quot;common C functions library&quot; providing a wide range of system functions. Earlier Openwrt builds have used &quot;uClibc&quot;, which is small and stripped down, or optionally a larger &quot;glibc&quot; or &quot;eglibc&quot;. Eglibc was combined to glibc a while ago and all references to eglibc were changed to glibc.<br /><a href="https://dev.openwrt.org/changeset/44701">https://dev.openwrt.org/changeset/44701</a><br /><a href="https://dev.openwrt.org/changeset/44702">https://dev.openwrt.org/changeset/44702</a><br /><a href="https://github.com/openwrt/packages/commit/98be2ca3e0d365d8f1150987cedb145360de582f">https://github.com/openwrt/packages/com … 5360de582f</a></p><p>So that is the reason for glibc/eglibc change.</p><p>About perl &amp; crypt:<br />Apparently crypt function is only available if threading is enabled (lines 52-59): <br /><a href="https://github.com/openwrt/packages/blob/for-15.05/lang/perl/Makefile#L48">https://github.com/openwrt/packages/blo … kefile#L48</a></p><p>The logic is explained in:<br /><a href="https://github.com/openwrt/packages/pull/854">https://github.com/openwrt/packages/pull/854</a><br /></p><div class="quotebox"><blockquote><p>One drawback of enabling threading is that crypt() and anything related to it is not available. This is due to uclibc not providing crypt_r(). We could use regular crypt() and hope no application actually uses it in more than one thread at the same time, but I&#039;ve just disabled it for now. crypt() will stay available for glibc builds though, regardless of whether threading is enabled or not.</p></blockquote></div><p>You should open an issue about this in Github packages, if you want to discuss the matter.</p>											<p class="post-edited">(Last edited by <strong>hnyman</strong> on 30 Oct 2015, 10:04)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p297993">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">lsoltero</div>
					<div class="post-datetime">
						30 Oct 2015, 13:58					</div>
				</div>
				<div class="post-content content">
					<p>issue has now moved to github...<br /><a href="https://github.com/openwrt/packages/issues/1902">https://github.com/openwrt/packages/issues/1902</a></p><p>thanks,</p><p>--luis</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>