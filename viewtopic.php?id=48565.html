<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Set usb as extroot</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 10 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p223366">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">jakarta87</div>
					<div class="post-datetime">
						21 Jan 2014, 14:17					</div>
				</div>
				<div class="post-content content">
					<p>Hi all, I&#039;m try to set a pendrive extroot, but I don&#039;t know why it&#039;s impossible for me.</p><p>I&#039;ve a hard disk set in sda1 that work for transmission and memory.<br />I&#039;ve a usb stick set in sdb for swap and extroot, work for swap but not to extroot.</p><p>config mount<br />&nbsp; &nbsp; &nbsp; &nbsp; option enabled &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option device &#039;/dev/sda1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option target &#039;/mnt/HD-RETE&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option fstype &#039;ext3&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option options &#039;rw,sync&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option enabled_fsck &#039;0&#039;</p><p>config mount<br />&nbsp; &nbsp; &nbsp; &nbsp; option enabled &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option device &#039;dev/sdc1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option target &#039;/mnt/film&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option fstype &#039;ntfs&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option options &#039;rw,sync&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option enabled_fsck &#039;0&#039;</p><p>config mount&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; option enabled &#039;1&#039;&nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; option device &#039;dev/sdb2&#039; <br />&nbsp; &nbsp; &nbsp; &nbsp; option target &#039;/mnt&#039;&nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; option fstype &#039;ext4&#039;&nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; option options &#039;rw,sync&#039; <br />&nbsp; &nbsp; &nbsp; &nbsp; option is_rootfs &#039;1&#039;&nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; option enabled_fsck &#039;0&#039;&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />config swap&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; option device &#039;/dev/sdb1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option enabled &#039;1&#039;&nbsp; </p><br /><p>I&#039;ve try to use this command</p><p>tar -C /overlay -cvf - . | tar -C /mnt/sdb2 -xf -</p><p>but with this command copy all content of /mnt/ and for that I&#039;ve just copy:<br />etc&nbsp; &nbsp;lib&nbsp; &nbsp;sbin&nbsp; usr</p><p>On reboot </p><p>root@OpenWrt:~# df -h<br />Filesystem&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Size&nbsp; &nbsp; &nbsp; Used Available Use% Mounted on<br />rootfs&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;13.0M&nbsp; &nbsp; &nbsp;12.3M&nbsp; &nbsp; 692.0K&nbsp; 95% /<br />/dev/root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1.8M&nbsp; &nbsp; &nbsp; 1.8M&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 100% /rom<br />tmpfs&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 30.1M&nbsp; &nbsp; &nbsp;84.0K&nbsp; &nbsp; &nbsp;30.1M&nbsp; &nbsp;0% /tmp<br />tmpfs&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;512.0K&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; 512.0K&nbsp; &nbsp;0% /dev<br />/dev/mtdblock3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;13.0M&nbsp; &nbsp; &nbsp;12.3M&nbsp; &nbsp; 692.0K&nbsp; 95% /overlay<br />overlayfs:/overlay&nbsp; &nbsp; &nbsp; &nbsp;13.0M&nbsp; &nbsp; &nbsp;12.3M&nbsp; &nbsp; 692.0K&nbsp; 95% /<br />/dev/sda1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;186.9G&nbsp; &nbsp; &nbsp;71.4G&nbsp; &nbsp; 106.0G&nbsp; 40% /mnt/HD-RETE<br />/dev/sdb2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1.8G&nbsp; &nbsp; &nbsp;69.3M&nbsp; &nbsp; &nbsp; 1.6G&nbsp; &nbsp;4% /mnt/sdb2</p><p>any solution?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p223418">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">kgoerbig</div>
					<div class="post-datetime">
						22 Jan 2014, 03:28					</div>
				</div>
				<div class="post-content content">
					<p>It&#039;s best to incorporate uuid&#039;s in fstab when setting up external drives, and overlay. This site has a good walk through:</p><p><a href="http://grade2linux.wordpress.com/2013/05/08/tp-link-tl-wr1043nd-openwrt-ch05_usb_storage/">http://grade2linux.wordpress.com/2013/0 â€¦ b_storage/</a></p><p>Also, your overlay partition doesn&#039;t need to be huge. I set up a 400MB partition, amd have a ton of packages installed, along with luci with a bunch of luci-apps, and have only used 20% of the 400MB.</p><p>This is what mine looks like:</p><div class="codebox"><pre><code>Filesystem                Size      Used Available Use% Mounted on
rootfs                  396.8M     73.7M    303.1M  20% /
/dev/root                 2.0M      2.0M         0 100% /rom
tmpfs                    61.9M      1.1M     60.7M   2% /tmp
tmpfs                   512.0K         0    512.0K   0% /dev
/dev/sda1               396.8M     73.7M    303.1M  20% /overlay
overlayfs:/overlay      396.8M     73.7M    303.1M  20% /
/dev/sdb2                 7.1G    234.7M      6.5G   3% /mnt/8GB
/dev/sdc1                29.7G      2.3G     25.9G   8% /mnt/32GB
/dev/sda2               148.2G      3.9G    136.9G   3% /mnt/150GB
/dev/sdb1               396.8M     73.7M    303.1M  20% /mnt/overlay-mirror
root@OpenWrt:/#</code></pre></div><div class="codebox"><pre><code>config global automount
        option from_fstab 1
        option anon_mount 1

config global autoswap
        option from_fstab 1
        option anon_swap 0

config &#039;mount&#039;
        option  target  &#039;/overlay&#039;
        option  uuid    &#039;56380f51-a834-4fb8-81ff-0a5929431a4c&#039;

config &#039;mount&#039;
        option  target  &#039;/mnt/8GB&#039;
        option  uuid    &#039;61355ff5-df9a-4b45-b89c-522db55ce108&#039;

config &#039;mount&#039;
        option  target  &#039;/mnt/32GB&#039;
        option  uuid    &#039;67eb0124-dcee-4a6c-a84b-6cdfd83ee212&#039;

config &#039;mount&#039;
        option  target  &#039;/mnt/150GB&#039;
        option  uuid    &#039;a8bee592-7131-4ff9-84aa-802479ea449f&#039;

config &#039;mount&#039;
        option  target  &#039;/mnt/overlay-mirror&#039;
        option  uuid    &#039;9b4813ad-4ca7-4780-b113-d7c17bbfec0b&#039;
root@OpenWrt:/etc/config#</code></pre></div>											<p class="post-edited">(Last edited by <strong>kgoerbig</strong> on 22 Jan 2014, 03:33)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p224354">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">jakarta87</div>
					<div class="post-datetime">
						2 Feb 2014, 18:52					</div>
				</div>
				<div class="post-content content">
					<p>I do not know what happened, I wrote an fstab according to your fstab, save and reboot.<br />Overlay works now. But if I go to see the fstab configuration is like the first time.<br />Thanks</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>