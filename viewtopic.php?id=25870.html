<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Problems with WPA2 connection to DIR-825 from Android</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 22 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p113863">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">dblevitan</div>
					<div class="post-datetime">
						27 Jul 2010, 22:13					</div>
				</div>
				<div class="post-content content">
					<p>Hi all,</p><p>I&#039;ve been using openwrt for several years now, running WhiteRussian on a WRT54GS. For various reasons, I decided to upgrade both the hardware and the software (to trunk as of yesterday), and picked out the D-Link DIR-825. Configuration has gone fine (some ipsec problems, but they&#039;re dealt with now), but I&#039;m still having issues with establishing a WPA2 connection from my Motorola Droid. The phone worked fine with the WRT54GS/WhiteRussian set up, and it&#039;s able to connect to the new D-Link if the network is open. It is not able to connect if WPA is active.</p><p>I have been able to connect with both a Macbook and my linux laptop on both 2.4 and 5 GHz bands with no issues. I&#039;ve tried changing the encryption settings between psk2+tkip+aes and psk2 (the latter is what I&#039;d prefer to leave it at) with no change in my ability to connect with the Droid. I&#039;ve tried switching the 2.4Ghz radio to 11g instead of 11ng, with no effect. I&#039;ve also tried changing channels, and changing the htmode on the 2.4 radio, again, with no effect. This appears to be purely between wpa_supplicant on the android and hostapd on the router.</p><p>I&#039;m hoping someone here can make better sense out of this than I can. This is probably a bug with Android, but getting it to work is essential to me, and I&#039;m hoping there&#039;s some way to fix this on the openwrt side. I&#039;ve tried downgrading wpad-mini to backfire and backfire betas, with no change in the results. I am running shorewall-lite, but all wireless access is open, and I don&#039;t think it should interfere.</p><p>My /etc/config/wireless and hostapd output are below. If anyone has any advice or can provide any help, I would most appreciate it. In my research, I&#039;ve run across some references that this may be a problem with the eapol version (2 vs. 1), but I haven&#039;t been able to downgrade hostapd to use eapol version 1, so don&#039;t know if this is on the right track or not.</p><p>Thanks,<br />David</p><p>First, my /etc/config/wireless:<br />config wifi-device&nbsp; radio0<br />&nbsp; &nbsp; &nbsp; &nbsp; option type&nbsp; &nbsp; &nbsp;mac80211<br />&nbsp; &nbsp; &nbsp; &nbsp; option channel&nbsp; 11<br />&nbsp; &nbsp; &nbsp; &nbsp; option macaddr&nbsp; 00:18:e7:e6:b5:21<br />&nbsp; &nbsp; &nbsp; &nbsp; option hwmode&nbsp; &nbsp;11ng<br />&nbsp; &nbsp; &nbsp; &nbsp; option htmode&nbsp; &nbsp;HT20<br />&nbsp; &nbsp; &nbsp; &nbsp; list ht_capab&nbsp; &nbsp;SHORT-GI-40<br />&nbsp; &nbsp; &nbsp; &nbsp; list ht_capab&nbsp; &nbsp;TX-STBC<br />&nbsp; &nbsp; &nbsp; &nbsp; list ht_capab&nbsp; &nbsp;RX-STBC1<br />&nbsp; &nbsp; &nbsp; &nbsp; list ht_capab&nbsp; &nbsp;DSSS_CCK-40</p><p>config wifi-iface<br />&nbsp; &nbsp; &nbsp; &nbsp; option device&nbsp; &nbsp;radio0<br />&nbsp; &nbsp; &nbsp; &nbsp; option network&nbsp; wifi<br />&nbsp; &nbsp; &nbsp; &nbsp; option mode&nbsp; &nbsp; &nbsp;ap<br />&nbsp; &nbsp; &nbsp; &nbsp; option ssid&nbsp; &nbsp; &nbsp;dlevitan<br />&nbsp; &nbsp; &nbsp; &nbsp; option encryption psk2<br />&nbsp; &nbsp; &nbsp; &nbsp; option key&nbsp; &nbsp; &nbsp; &lt;psk&gt;</p><p>config wifi-device&nbsp; radio1<br />&nbsp; &nbsp; &nbsp; &nbsp; option type&nbsp; &nbsp; &nbsp;mac80211<br />&nbsp; &nbsp; &nbsp; &nbsp; option channel&nbsp; 36<br />&nbsp; &nbsp; &nbsp; &nbsp; option macaddr&nbsp; 00:18:e7:e6:b5:22<br />&nbsp; &nbsp; &nbsp; &nbsp; option hwmode&nbsp; &nbsp;11na<br />&nbsp; &nbsp; &nbsp; &nbsp; option htmode&nbsp; &nbsp;HT40+<br />&nbsp; &nbsp; &nbsp; &nbsp; list ht_capab&nbsp; &nbsp;SHORT-GI-40<br />&nbsp; &nbsp; &nbsp; &nbsp; list ht_capab&nbsp; &nbsp;TX-STBC<br />&nbsp; &nbsp; &nbsp; &nbsp; list ht_capab&nbsp; &nbsp;RX-STBC1<br />&nbsp; &nbsp; &nbsp; &nbsp; list ht_capab&nbsp; &nbsp;DSSS_CCK-40</p><p>config wifi-iface<br />&nbsp; &nbsp; &nbsp; &nbsp; option device&nbsp; &nbsp;radio1<br />&nbsp; &nbsp; &nbsp; &nbsp; option network&nbsp; wifi<br />&nbsp; &nbsp; &nbsp; &nbsp; option mode&nbsp; &nbsp; &nbsp;ap<br />&nbsp; &nbsp; &nbsp; &nbsp; option ssid&nbsp; &nbsp; &nbsp;dlevitann<br />&nbsp; &nbsp; &nbsp; &nbsp; option encryption psk2<br />&nbsp; &nbsp; &nbsp; &nbsp; option key&nbsp; &nbsp; &nbsp; &lt;psk&gt;</p><p>And running hostapd in debug mode:</p><p>root@anduin:/tmp# hostapd -P /var/run/wifi-phy0.pid -d /var/run/hostapd-phy0.conf<br />Configuration file: /var/run/hostapd-phy0.conf<br />netlink: Operstate: linkmode=1, operstate=5<br />nl80211: Add own interface ifindex 10<br />nl80211: Add own interface ifindex 21<br />nl80211: New interface mon.wlan0 created: ifindex=25<br />nl80211: Add own interface ifindex 25<br />nl80211: Adding interface wlan0 into bridge br-wifi<br />BSS count 1, BSSID mask 00:00:00:00:00:00 (0 bits)<br />nl80211: Added 802.11b mode based on 802.11g information<br />Completing interface initialization<br />Mode: IEEE 802.11g&nbsp; Channel: 11&nbsp; Frequency: 2462 MHz<br />RATE[0] rate=10 flags=0x1<br />RATE[1] rate=20 flags=0x1<br />RATE[2] rate=55 flags=0x1<br />RATE[3] rate=110 flags=0x1<br />RATE[4] rate=60 flags=0x0<br />RATE[5] rate=90 flags=0x0<br />RATE[6] rate=120 flags=0x0<br />RATE[7] rate=180 flags=0x0<br />RATE[8] rate=240 flags=0x0<br />RATE[9] rate=360 flags=0x0<br />RATE[10] rate=480 flags=0x0<br />RATE[11] rate=540 flags=0x0<br />Flushing old station entries<br />Deauthenticate all stations<br />wpa_driver_nl80211_set_key: ifindex=21 alg=0 addr=(nil) key_idx=0 set_tx=1 seq_len=0 key_len=0<br />wpa_driver_nl80211_set_key: ifindex=21 alg=0 addr=(nil) key_idx=1 set_tx=0 seq_len=0 key_len=0<br />wpa_driver_nl80211_set_key: ifindex=21 alg=0 addr=(nil) key_idx=2 set_tx=0 seq_len=0 key_len=0<br />wpa_driver_nl80211_set_key: ifindex=21 alg=0 addr=(nil) key_idx=3 set_tx=0 seq_len=0 key_len=0<br />Using interface wlan0 with hwaddr 00:18:e7:e6:b5:21 and ssid &#039;dlevitan&#039;<br />Deriving WPA PSK based on passphrase<br />SSID - hexdump_ascii(len=8):<br />&nbsp; &nbsp; &nbsp;64 6c 65 76 69 74 61 6e&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;dlevitan&nbsp; &nbsp; &nbsp; &nbsp; <br />PSK (ASCII passphrase) - hexdump_ascii(len=36): [REMOVED]<br />PSK (from passphrase) - hexdump(len=32): [REMOVED]<br />WPA: group state machine entering state GTK_INIT (VLAN-ID 0)<br />GMK - hexdump(len=32): [REMOVED]<br />GTK - hexdump(len=16): [REMOVED]<br />WPA: group state machine entering state SETKEYSDONE (VLAN-ID 0)<br />wpa_driver_nl80211_set_key: ifindex=21 alg=3 addr=(nil) key_idx=1 set_tx=1 seq_len=0 key_len=16<br />nl80211: Set beacon (beacon_set=0)<br />wlan0: Setup of interface done.<br />RTM_NEWLINK: operstate=0 ifi_flags=0x1002 ()<br />nl80211: Interface down<br />Unknown event 29<br />RTM_NEWLINK, IFLA_IFNAME: Interface &#039;wlan0&#039; added<br />Unknown event 5<br />RTM_NEWLINK: operstate=0 ifi_flags=0x1043 ([UP][RUNNING])<br />nl80211: Interface up<br />Unknown event 28<br />RTM_NEWLINK, IFLA_IFNAME: Interface &#039;wlan0&#039; added<br />Unknown event 5<br />RTM_NEWLINK: operstate=0 ifi_flags=0x1003 ([UP])<br />RTM_NEWLINK, IFLA_IFNAME: Interface &#039;wlan0&#039; added<br />Unknown event 5<br />RTM_NEWLINK: operstate=0 ifi_flags=0x1002 ()<br />nl80211: Interface down<br />Unknown event 29<br />RTM_NEWLINK, IFLA_IFNAME: Interface &#039;wlan0&#039; added<br />Unknown event 5<br />RTM_NEWLINK: operstate=0 ifi_flags=0x1002 ()<br />RTM_NEWLINK, IFLA_IFNAME: Interface &#039;wlan0&#039; added<br />Unknown event 5<br />RTM_NEWLINK: operstate=0 ifi_flags=0x1002 ()<br />RTM_NEWLINK, IFLA_IFNAME: Interface &#039;mon.wlan0&#039; added<br />Unknown event 5<br />RTM_NEWLINK: operstate=0 ifi_flags=0x1002 ()<br />RTM_NEWLINK, IFLA_IFNAME: Interface &#039;mon.wlan0&#039; added<br />Unknown event 5<br />RTM_NEWLINK: operstate=0 ifi_flags=0x11043 ([UP][RUNNING][LOWER_UP])<br />nl80211: Interface up<br />Unknown event 28<br />RTM_NEWLINK, IFLA_IFNAME: Interface &#039;mon.wlan0&#039; added<br />Unknown event 5<br />RTM_NEWLINK: operstate=0 ifi_flags=0x1002 ()<br />nl80211: Interface down<br />Unknown event 29<br />RTM_NEWLINK, IFLA_IFNAME: Interface &#039;wlan0&#039; added<br />Unknown event 5<br />nl80211: Add ifindex 10 for bridge br-wifi<br />nl80211: Add own interface ifindex 10<br />RTM_NEWLINK: operstate=0 ifi_flags=0x1002 ()<br />RTM_NEWLINK, IFLA_IFNAME: Interface &#039;wlan0&#039; added<br />Unknown event 5<br />RTM_NEWLINK: operstate=0 ifi_flags=0x11003 ([UP][LOWER_UP])<br />nl80211: Interface up<br />Unknown event 28<br />RTM_NEWLINK, IFLA_IFNAME: Interface &#039;wlan0&#039; added<br />Unknown event 5<br />RTM_NEWLINK: operstate=0 ifi_flags=0x11003 ([UP][LOWER_UP])<br />RTM_NEWLINK, IFLA_IFNAME: Interface &#039;wlan0&#039; added<br />Unknown event 5<br />nl80211: Add ifindex 10 for bridge br-wifi<br />nl80211: Add own interface ifindex 10<br />RTM_NEWLINK: operstate=0 ifi_flags=0x11003 ([UP][LOWER_UP])<br />RTM_NEWLINK, IFLA_IFNAME: Interface &#039;wlan0&#039; added<br />Unknown event 5<br />nl80211: Add ifindex 10 for bridge br-wifi<br />nl80211: Add own interface ifindex 10<br />RTM_NEWLINK: operstate=0 ifi_flags=0x11003 ([UP][LOWER_UP])<br />RTM_NEWLINK, IFLA_IFNAME: Interface &#039;wlan0&#039; added<br />Unknown event 5<br />mgmt::auth<br />authentication: STA=00:26:ba:3b:53:91 auth_alg=0 auth_transaction=1 status_code=0 wep=0<br />&nbsp; New STA<br />wlan0: STA 00:26:ba:3b:53:91 IEEE 802.11: authentication OK (open system)<br />wlan0: STA 00:26:ba:3b:53:91 MLME: MLME-AUTHENTICATE.indication(00:26:ba:3b:53:91, OPEN_SYSTEM)<br />wlan0: STA 00:26:ba:3b:53:91 MLME: MLME-DELETEKEYS.request(00:26:ba:3b:53:91)<br />authentication reply: STA=00:26:ba:3b:53:91 auth_alg=0 auth_transaction=2 resp=0 (IE len=0)<br />mgmt::auth cb<br />wlan0: STA 00:26:ba:3b:53:91 IEEE 802.11: authenticated<br />mgmt::assoc_req<br />association request: STA=00:26:ba:3b:53:91 capab_info=0x8431 listen_interval=3<br />Validating WMM IE: OUI 00:50:f2&nbsp; OUI type 2&nbsp; OUI sub-type 0&nbsp; version 1&nbsp; QoS info 0x0<br />&nbsp; new AID 1<br />HT: STA 00:26:ba:3b:53:91 HT Capabilities Info: 0x1030<br />update_sta_ht STA 00:26:ba:3b:53:91 - 20 MHz HT, num of 20MHz HT STAs 1<br />hostapd_ht_operation_update current operation mode=0x0<br />hostapd_ht_operation_update new operation mode=0x0 changes=0<br />wlan0: STA 00:26:ba:3b:53:91 IEEE 802.11: association OK (aid 1)<br />mgmt::assoc_resp cb<br />wlan0: STA 00:26:ba:3b:53:91 IEEE 802.11: associated (aid 1)<br />wlan0: STA 00:26:ba:3b:53:91 MLME: MLME-ASSOCIATE.indication(00:26:ba:3b:53:91)<br />wlan0: STA 00:26:ba:3b:53:91 MLME: MLME-DELETEKEYS.request(00:26:ba:3b:53:91)<br />wpa_driver_nl80211_set_key: ifindex=21 alg=0 addr=0x480ac0 key_idx=0 set_tx=1 seq_len=0 key_len=0<br />&nbsp; &nbsp;addr=00:26:ba:3b:53:91<br />wlan0: STA 00:26:ba:3b:53:91 WPA: event 1 notification<br />wpa_driver_nl80211_set_key: ifindex=21 alg=0 addr=0x480ac0 key_idx=0 set_tx=1 seq_len=0 key_len=0<br />&nbsp; &nbsp;addr=00:26:ba:3b:53:91<br />wlan0: STA 00:26:ba:3b:53:91 WPA: start authentication<br />WPA: 00:26:ba:3b:53:91 WPA_PTK entering state INITIALIZE<br />wpa_driver_nl80211_set_key: ifindex=21 alg=0 addr=0x480ac0 key_idx=0 set_tx=1 seq_len=0 key_len=0<br />&nbsp; &nbsp;addr=00:26:ba:3b:53:91<br />wlan0: STA 00:26:ba:3b:53:91 IEEE 802.1X: unauthorizing port<br />WPA: 00:26:ba:3b:53:91 WPA_PTK_GROUP entering state IDLE<br />WPA: 00:26:ba:3b:53:91 WPA_PTK entering state AUTHENTICATION<br />WPA: 00:26:ba:3b:53:91 WPA_PTK entering state AUTHENTICATION2<br />WPA: 00:26:ba:3b:53:91 WPA_PTK entering state INITPSK<br />WPA: 00:26:ba:3b:53:91 WPA_PTK entering state PTKSTART<br />wlan0: STA 00:26:ba:3b:53:91 WPA: sending 1/4 msg of 4-Way Handshake<br />WPA: Send EAPOL(version=2 secure=0 mic=0 ack=1 install=0 pairwise=8 kde_len=0 keyidx=0 encr=0)<br />nl80211: Event message available<br />nl80211: Ignored unknown event (cmd=19)<br />IEEE 802.1X: 00:26:ba:3b:53:91 TX status - version=2 type=3 length=95 - ack=1<br />IEEE 802.1X: 121 bytes from 00:26:ba:3b:53:91<br />&nbsp; &nbsp;IEEE 802.1X: version=1 type=3 length=117<br />wlan0: STA 00:26:ba:3b:53:91 WPA: WPA IE from (Re)AssocReq did not match with msg 2/4<br />WPA IE in AssocReq - hexdump(len=22): 30 14 01 00 00 0f ac 04 01 00 00 0f ac 04 01 00 00 0f ac 02 00 00<br />WPA IE in msg 2/4 - hexdump(len=22): 30 14 01 00 00 0f ac 04 01 00 00 0f ac 04 01 00 00 0f ac 02 3c 00<br />hostapd_wpa_auth_disconnect: WPA authenticator requests disconnect: STA 00:26:ba:3b:53:91 reason 2<br />wlan0: STA 00:26:ba:3b:53:91 IEEE 802.11: deauthenticated due to local deauth request<br />hostapd_ht_operation_update current operation mode=0x0<br />hostapd_ht_operation_update new operation mode=0x0 changes=0<br />mgmt::deauth<br />deauthentication: STA=00:26:ba:3b:53:91 reason_code=1<br />Station 00:26:ba:3b:53:91 trying to deauthenticate, but it is not authenticated.<br />mgmt::auth<br />authentication: STA=00:23:6c:7f:1e:fb auth_alg=0 auth_transaction=1 status_code=0 wep=0<br />&nbsp; New STA<br />wlan0: STA 00:23:6c:7f:1e:fb IEEE 802.11: authentication OK (open system)<br />wlan0: STA 00:23:6c:7f:1e:fb MLME: MLME-AUTHENTICATE.indication(00:23:6c:7f:1e:fb, OPEN_SYSTEM)<br />wlan0: STA 00:23:6c:7f:1e:fb MLME: MLME-DELETEKEYS.request(00:23:6c:7f:1e:fb)<br />authentication reply: STA=00:23:6c:7f:1e:fb auth_alg=0 auth_transaction=2 resp=0 (IE len=0)<br />mgmt::auth cb<br />wlan0: STA 00:23:6c:7f:1e:fb IEEE 802.11: did not acknowledge authentication response<br />mgmt::auth<br />authentication: STA=00:26:ba:3b:53:91 auth_alg=0 auth_transaction=1 status_code=0 wep=0<br />&nbsp; New STA<br />wlan0: STA 00:26:ba:3b:53:91 IEEE 802.11: authentication OK (open system)<br />wlan0: STA 00:26:ba:3b:53:91 MLME: MLME-AUTHENTICATE.indication(00:26:ba:3b:53:91, OPEN_SYSTEM)<br />wlan0: STA 00:26:ba:3b:53:91 MLME: MLME-DELETEKEYS.request(00:26:ba:3b:53:91)<br />authentication reply: STA=00:26:ba:3b:53:91 auth_alg=0 auth_transaction=2 resp=0 (IE len=0)<br />mgmt::auth cb<br />wlan0: STA 00:26:ba:3b:53:91 IEEE 802.11: authenticated<br />mgmt::assoc_req<br />association request: STA=00:26:ba:3b:53:91 capab_info=0x8431 listen_interval=3<br />Validating WMM IE: OUI 00:50:f2&nbsp; OUI type 2&nbsp; OUI sub-type 0&nbsp; version 1&nbsp; QoS info 0x0<br />&nbsp; new AID 1<br />HT: STA 00:26:ba:3b:53:91 HT Capabilities Info: 0x1030<br />update_sta_ht STA 00:26:ba:3b:53:91 - 20 MHz HT, num of 20MHz HT STAs 1<br />hostapd_ht_operation_update current operation mode=0x0<br />hostapd_ht_operation_update new operation mode=0x0 changes=0<br />wlan0: STA 00:26:ba:3b:53:91 IEEE 802.11: association OK (aid 1)<br />mgmt::assoc_resp cb<br />wlan0: STA 00:26:ba:3b:53:91 IEEE 802.11: associated (aid 1)<br />wlan0: STA 00:26:ba:3b:53:91 MLME: MLME-ASSOCIATE.indication(00:26:ba:3b:53:91)<br />wlan0: STA 00:26:ba:3b:53:91 MLME: MLME-DELETEKEYS.request(00:26:ba:3b:53:91)<br />wpa_driver_nl80211_set_key: ifindex=21 alg=0 addr=0x480b78 key_idx=0 set_tx=1 seq_len=0 key_len=0<br />&nbsp; &nbsp;addr=00:26:ba:3b:53:91<br />wlan0: STA 00:26:ba:3b:53:91 WPA: event 1 notification<br />wpa_driver_nl80211_set_key: ifindex=21 alg=0 addr=0x480b78 key_idx=0 set_tx=1 seq_len=0 key_len=0<br />&nbsp; &nbsp;addr=00:26:ba:3b:53:91<br />wlan0: STA 00:26:ba:3b:53:91 WPA: start authentication<br />WPA: 00:26:ba:3b:53:91 WPA_PTK entering state INITIALIZE<br />wpa_driver_nl80211_set_key: ifindex=21 alg=0 addr=0x480b78 key_idx=0 set_tx=1 seq_len=0 key_len=0<br />&nbsp; &nbsp;addr=00:26:ba:3b:53:91<br />wlan0: STA 00:26:ba:3b:53:91 IEEE 802.1X: unauthorizing port<br />WPA: 00:26:ba:3b:53:91 WPA_PTK_GROUP entering state IDLE<br />WPA: 00:26:ba:3b:53:91 WPA_PTK entering state AUTHENTICATION<br />WPA: 00:26:ba:3b:53:91 WPA_PTK entering state AUTHENTICATION2<br />WPA: 00:26:ba:3b:53:91 WPA_PTK entering state INITPSK<br />WPA: 00:26:ba:3b:53:91 WPA_PTK entering state PTKSTART<br />wlan0: STA 00:26:ba:3b:53:91 WPA: sending 1/4 msg of 4-Way Handshake<br />WPA: Send EAPOL(version=2 secure=0 mic=0 ack=1 install=0 pairwise=8 kde_len=0 keyidx=0 encr=0)<br />nl80211: Event message available<br />nl80211: Ignored unknown event (cmd=19)<br />IEEE 802.1X: 00:26:ba:3b:53:91 TX status - version=2 type=3 length=95 - ack=1<br />IEEE 802.1X: 121 bytes from 00:26:ba:3b:53:91<br />&nbsp; &nbsp;IEEE 802.1X: version=1 type=3 length=117<br />wlan0: STA 00:26:ba:3b:53:91 WPA: WPA IE from (Re)AssocReq did not match with msg 2/4<br />WPA IE in AssocReq - hexdump(len=22): 30 14 01 00 00 0f ac 04 01 00 00 0f ac 04 01 00 00 0f ac 02 00 00<br />WPA IE in msg 2/4 - hexdump(len=22): 30 14 01 00 00 0f ac 04 01 00 00 0f ac 04 01 00 00 0f ac 02 3c 00<br />hostapd_wpa_auth_disconnect: WPA authenticator requests disconnect: STA 00:26:ba:3b:53:91 reason 2<br />wlan0: STA 00:26:ba:3b:53:91 IEEE 802.11: deauthenticated due to local deauth request<br />hostapd_ht_operation_update current operation mode=0x0<br />hostapd_ht_operation_update new operation mode=0x0 changes=0<br />mgmt::deauth<br />deauthentication: STA=00:26:ba:3b:53:91 reason_code=1<br />Station 00:26:ba:3b:53:91 trying to deauthenticate, but it is not authenticated.<br />^CSignal 2 received - terminating<br />wlan0: STA 00:23:6c:7f:1e:fb MLME: MLME-DEAUTHENTICATE.indication(00:23:6c:7f:1e:fb, 1)<br />wlan0: STA 00:23:6c:7f:1e:fb MLME: MLME-DELETEKEYS.request(00:23:6c:7f:1e:fb)<br />Removing station 00:23:6c:7f:1e:fb<br />hostapd_ht_operation_update current operation mode=0x0<br />hostapd_ht_operation_update new operation mode=0x0 changes=0<br />Flushing old station entries<br />Deauthenticate all stations<br />nl80211: Remove interface ifindex=25<br />netlink: Operstate: linkmode=0, operstate=6</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p113875">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">aport</div>
					<div class="post-datetime">
						28 Jul 2010, 01:40					</div>
				</div>
				<div class="post-content content">
					<p>I have the same issue with ath9k on my WNDR3700. Dot foldered.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p113880">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">dblevitan</div>
					<div class="post-datetime">
						28 Jul 2010, 04:02					</div>
				</div>
				<div class="post-content content">
					<p>Given that this appears to be very much a hostapd/wpa_supplicant issue (and I can see the one octet difference in the handshake, which appears to be the problem), I&#039;ve posted a message to the hostapd list. I&#039;ll update if any solution gets posted.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p114042">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">dblevitan</div>
					<div class="post-datetime">
						30 Jul 2010, 00:53					</div>
				</div>
				<div class="post-content content">
					<p>aport, are you running stock Android or one of the custom ROMs?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p114097">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">aport</div>
					<div class="post-datetime">
						30 Jul 2010, 21:45					</div>
				</div>
				<div class="post-content content">
					<p>I am running a custom ROM. Bugless Beast 2.2 Froyo v0.4 for the Moto Droid. I don&#039;t have any connectivity issues with a WNDR3700 with Netgear firmware.</p>											<p class="post-edited">(Last edited by <strong>aport</strong> on 30 Jul 2010, 21:46)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p114100">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">dblevitan</div>
					<div class="post-datetime">
						30 Jul 2010, 22:18					</div>
				</div>
				<div class="post-content content">
					<p>I think the 2.2 wifi drivers distributed in the current kernels are simply broken (I tested both with P3Droid&#039;s kernel and the stock CM6 kernel). Actually, I know they&#039;re broken, and badly - they violate the WPA2 specs, and I can easily see it from the capture logs I&#039;ve taken. But I can&#039;t figure out the problem because the currently distributed Android source doesn&#039;t have the latest wifi drivers. I&#039;m assuming that P3Droid has them, and I&#039;m trying to get a hold of them to see what&#039;s going on.</p><p>hostapd combined with ath9k is very strict when it comes to the specs, and isn&#039;t lenient at all. Thus, it&#039;s causing the connection problems. Disabling WMM on the hostapd side gets rid of the first problem, but causes another one that I haven&#039;t had time to investigate yet. I&#039;m working on it, but it&#039;ll probably take a while to get everything working, and will definitely require custom kernel builds on the Droid.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p114504">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">dblevitan</div>
					<div class="post-datetime">
						5 Aug 2010, 11:18					</div>
				</div>
				<div class="post-content content">
					<p>After much debugging and frustration, I&#039;ve come up with a cause, one confirmed solution one likely solution, and one possible solution. The&nbsp; cause is that the wireless driver in many of the custom ROMs is WiLink_Driver_6.1.0.0.131, which incorrectly sends two WPA2 RSN IEs that are different. It uses the value of the PTKSA from the AP to generate the PTKSA and GTKSA settings in the RSN capabilities section for the first RSN IE, but just uses 0 for the second. If WMM/WME is enabled on the AP, the AP sets its PTKSA to &gt; 0, causing the Droid to respond with one RSN IE with non-zero values. But, hostapd uses the second RSN IE, notices the mismatch, and drops the connection. I don&#039;t know if the second RSN IE is selected by the ath9k driver (I think that&#039;s the case), and this is why only the particular combination of ath9k+131 driver causes problems.</p><p>The confirmed solution is to install the kernel from the Sapphire ROM. I&#039;m using it with CM-0.6RC2 without problems thus far. That ROM includes WiLink_Driver_6.1.0.0.95_M3, which properly sends the RSN IE (only once) and is able to successfully connect. This is working on my Droid, and follows from my looking at the 95_M3 source (this is the version currently in the Android repository).</p><p>The likely solution is to disable WMM/WME on the AP. That will then cause the two RSN IE&#039;s sent by the 131 driver to both have capabilities = 0, which should work.</p><p>When I tried the second method, it failed with an invalid MIC. This appears to be a caching problem on the Droid - forgetting and enabling the network seems to work. You&#039;ll need to do it for both methods.</p><p>The possible solution is switching from WPA2 to WPA (and thus TKIP encryption). I don&#039;t believe WPA uses the RSN IEs at all, and thus this should probably work.</p><p>Hopefully this should solve your problem, and for anyone else.</p>											<p class="post-edited">(Last edited by <strong>dblevitan</strong> on 5 Aug 2010, 11:19)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p118665">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">luminoso</div>
					<div class="post-datetime">
						7 Oct 2010, 14:44					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m also running CyanongemMod on HTC Magic 32A, rom dated 10/07/2010 (DD/MM/YYYY) and the problem is still present with WNDR3700, trunk r23163. for me this problem is present since backfire (when i start to use openwrt)</p><p>In my opinion this is a phenomenon that OpenWRT should be able to deal with. If all other stock firmwares can and if even this is a Android bug, OpenWRT should be smart enough to make this work. I mean, if other firmwares can why can&#039;t OpenWrt?</p><p>Also, It may also cover other devices.</p><p>hostapd log, connect to wndr3700, using the net without problems:</p><div class="codebox"><pre><code>mgmt::auth
authentication: STA=00:23:76:22:96:94 auth_alg=0 auth_transaction=1 status_code=0 wep=0
  New STA
wlan0: STA 00:23:76:22:96:94 IEEE 802.11: authentication OK (open system)
wlan0: STA 00:23:76:22:96:94 MLME: MLME-AUTHENTICATE.indication(00:23:76:22:96:94, OPEN_SYSTEM)
wlan0: STA 00:23:76:22:96:94 MLME: MLME-DELETEKEYS.request(00:23:76:22:96:94)
authentication reply: STA=00:23:76:22:96:94 auth_alg=0 auth_transaction=2 resp=0 (IE len=0)
mgmt::auth cb
wlan0: STA 00:23:76:22:96:94 IEEE 802.11: authenticated
mgmt::assoc_req
association request: STA=00:23:76:22:96:94 capab_info=0x431 listen_interval=3
IEEE 802.11 element parse ignored unknown element (id=46 elen=1)
WMM IE - hexdump(len=7): 00 50 f2 02 00 01 00
Validating WMM IE: OUI 00:50:f2  OUI type 2  OUI sub-type 0  version 1  QoS info 0x0
  new AID 1
update_sta_no_ht STA 00:23:76:22:96:94 - no HT, num of non-HT stations 1
hostapd_ht_operation_update current operation mode=0x0
hostapd_ht_operation_update new operation mode=0x13 changes=2
nl80211: Set beacon (beacon_set=1)
wlan0: STA 00:23:76:22:96:94 IEEE 802.11: association OK (aid 1)
mgmt::assoc_resp cb
wlan0: STA 00:23:76:22:96:94 IEEE 802.11: associated (aid 1)
wlan0: STA 00:23:76:22:96:94 MLME: MLME-ASSOCIATE.indication(00:23:76:22:96:94)
wlan0: STA 00:23:76:22:96:94 MLME: MLME-DELETEKEYS.request(00:23:76:22:96:94)
wpa_driver_nl80211_set_key: ifindex=7 alg=0 addr=0x47a078 key_idx=0 set_tx=1 seq_len=0 key_len=0
   addr=00:23:76:22:96:94
wlan0: STA 00:23:76:22:96:94 WPA: event 1 notification
wpa_driver_nl80211_set_key: ifindex=7 alg=0 addr=0x47a078 key_idx=0 set_tx=1 seq_len=0 key_len=0
   addr=00:23:76:22:96:94
wlan0: STA 00:23:76:22:96:94 WPA: start authentication
WPA: 00:23:76:22:96:94 WPA_PTK entering state INITIALIZE
wpa_driver_nl80211_set_key: ifindex=7 alg=0 addr=0x47a078 key_idx=0 set_tx=1 seq_len=0 key_len=0
   addr=00:23:76:22:96:94
wlan0: STA 00:23:76:22:96:94 IEEE 802.1X: unauthorizing port
WPA: 00:23:76:22:96:94 WPA_PTK_GROUP entering state IDLE
WPA: 00:23:76:22:96:94 WPA_PTK entering state AUTHENTICATION
WPA: 00:23:76:22:96:94 WPA_PTK entering state AUTHENTICATION2
WPA: 00:23:76:22:96:94 WPA_PTK entering state INITPSK
WPA: 00:23:76:22:96:94 WPA_PTK entering state PTKSTART
wlan0: STA 00:23:76:22:96:94 WPA: sending 1/4 msg of 4-Way Handshake
WPA: Send EAPOL(version=2 secure=0 mic=0 ack=1 install=0 pairwise=8 kde_len=0 keyidx=0 encr=0)
nl80211: Event message available
nl80211: Ignored unknown event (cmd=19)
IEEE 802.1X: 00:23:76:22:96:94 TX status - version=2 type=3 length=95 - ack=1
IEEE 802.1X: 121 bytes from 00:23:76:22:96:94
   IEEE 802.1X: version=1 type=3 length=117
wlan0: STA 00:23:76:22:96:94 WPA: received EAPOL-Key frame (2/4 Pairwise)
WPA: 00:23:76:22:96:94 WPA_PTK entering state PTKCALCNEGOTIATING
WPA: PTK derivation - A1=00:24:b2:d8:28:b7 A2=00:23:76:22:96:94
WPA: PMK - hexdump(len=32): [REMOVED]
WPA: PTK - hexdump(len=48): [REMOVED]
WPA: 00:23:76:22:96:94 WPA_PTK entering state PTKCALCNEGOTIATING2
WPA: 00:23:76:22:96:94 WPA_PTK entering state PTKINITNEGOTIATING
wlan0: STA 00:23:76:22:96:94 WPA: sending 3/4 msg of 4-Way Handshake
WPA: Send EAPOL(version=2 secure=1 mic=1 ack=1 install=1 pairwise=8 kde_len=46 keyidx=1 encr=1)
Plaintext EAPOL-Key Key Data - hexdump(len=56): [REMOVED]
IEEE 802.1X: 00:23:76:22:96:94 TX status - version=2 type=3 length=151 - ack=1
IEEE 802.1X: 99 bytes from 00:23:76:22:96:94
   IEEE 802.1X: version=1 type=3 length=95
wlan0: STA 00:23:76:22:96:94 WPA: received EAPOL-Key frame (4/4 Pairwise)
WPA: 00:23:76:22:96:94 WPA_PTK entering state PTKINITDONE
wpa_driver_nl80211_set_key: ifindex=7 alg=3 addr=0x47a078 key_idx=0 set_tx=1 seq_len=0 key_len=16
   addr=00:23:76:22:96:94
AP-STA-CONNECTED 00:23:76:22:96:94
wlan0: STA 00:23:76:22:96:94 IEEE 802.1X: authorizing port
wlan0: STA 00:23:76:22:96:94 WPA: pairwise key handshake completed (RSN)</code></pre></div><p>log till the problem occurs:</p><div class="codebox"><pre><code>mgmt::deauth
deauthentication: STA=00:23:76:22:96:94 reason_code=1
AP-STA-DISCONNECTED 00:23:76:22:96:94
wlan0: STA 00:23:76:22:96:94 WPA: event 3 notification
wpa_driver_nl80211_set_key: ifindex=7 alg=0 addr=0x47a078 key_idx=0 set_tx=1 seq_len=0 key_len=0
   addr=00:23:76:22:96:94
WPA: 00:23:76:22:96:94 WPA_PTK entering state DISCONNECTED
WPA: 00:23:76:22:96:94 WPA_PTK entering state INITIALIZE
wpa_driver_nl80211_set_key: ifindex=7 alg=0 addr=0x47a078 key_idx=0 set_tx=1 seq_len=0 key_len=0
   addr=00:23:76:22:96:94
wlan0: STA 00:23:76:22:96:94 IEEE 802.1X: unauthorizing port
wlan0: STA 00:23:76:22:96:94 IEEE 802.11: deauthenticated
wlan0: STA 00:23:76:22:96:94 MLME: MLME-DEAUTHENTICATE.indication(00:23:76:22:96:94, 1)
wlan0: STA 00:23:76:22:96:94 MLME: MLME-DELETEKEYS.request(00:23:76:22:96:94)
wpa_driver_nl80211_set_key: ifindex=7 alg=0 addr=0x47a078 key_idx=0 set_tx=1 seq_len=0 key_len=0
   addr=00:23:76:22:96:94
hostapd_ht_operation_update current operation mode=0x13
hostapd_ht_operation_update new operation mode=0x0 changes=2
nl80211: Set beacon (beacon_set=1)
mgmt::auth
authentication: STA=00:23:76:22:96:94 auth_alg=0 auth_transaction=1 status_code=0 wep=0
  New STA
wlan0: STA 00:23:76:22:96:94 IEEE 802.11: authentication OK (open system)
wlan0: STA 00:23:76:22:96:94 MLME: MLME-AUTHENTICATE.indication(00:23:76:22:96:94, OPEN_SYSTEM)
wlan0: STA 00:23:76:22:96:94 MLME: MLME-DELETEKEYS.request(00:23:76:22:96:94)
authentication reply: STA=00:23:76:22:96:94 auth_alg=0 auth_transaction=2 resp=0 (IE len=0)
mgmt::auth cb
wlan0: STA 00:23:76:22:96:94 IEEE 802.11: authenticated
mgmt::assoc_req
association request: STA=00:23:76:22:96:94 capab_info=0x431 listen_interval=3
IEEE 802.11 element parse ignored unknown element (id=46 elen=1)
WMM IE - hexdump(len=7): 00 50 f2 02 00 01 00
Validating WMM IE: OUI 00:50:f2  OUI type 2  OUI sub-type 0  version 1  QoS info 0x0
  new AID 1
update_sta_no_ht STA 00:23:76:22:96:94 - no HT, num of non-HT stations 1
hostapd_ht_operation_update current operation mode=0x0
hostapd_ht_operation_update new operation mode=0x13 changes=2
nl80211: Set beacon (beacon_set=1)
wlan0: STA 00:23:76:22:96:94 IEEE 802.11: association OK (aid 1)
mgmt::assoc_resp cb
wlan0: STA 00:23:76:22:96:94 IEEE 802.11: associated (aid 1)
wlan0: STA 00:23:76:22:96:94 MLME: MLME-ASSOCIATE.indication(00:23:76:22:96:94)
wlan0: STA 00:23:76:22:96:94 MLME: MLME-DELETEKEYS.request(00:23:76:22:96:94)
wpa_driver_nl80211_set_key: ifindex=7 alg=0 addr=0x47a078 key_idx=0 set_tx=1 seq_len=0 key_len=0
   addr=00:23:76:22:96:94
wlan0: STA 00:23:76:22:96:94 WPA: event 1 notification
wpa_driver_nl80211_set_key: ifindex=7 alg=0 addr=0x47a078 key_idx=0 set_tx=1 seq_len=0 key_len=0
   addr=00:23:76:22:96:94
wlan0: STA 00:23:76:22:96:94 WPA: start authentication
WPA: 00:23:76:22:96:94 WPA_PTK entering state INITIALIZE
wpa_driver_nl80211_set_key: ifindex=7 alg=0 addr=0x47a078 key_idx=0 set_tx=1 seq_len=0 key_len=0
   addr=00:23:76:22:96:94
wlan0: STA 00:23:76:22:96:94 IEEE 802.1X: unauthorizing port
WPA: 00:23:76:22:96:94 WPA_PTK_GROUP entering state IDLE
WPA: 00:23:76:22:96:94 WPA_PTK entering state AUTHENTICATION
WPA: 00:23:76:22:96:94 WPA_PTK entering state AUTHENTICATION2
WPA: 00:23:76:22:96:94 WPA_PTK entering state INITPSK
WPA: 00:23:76:22:96:94 WPA_PTK entering state PTKSTART
wlan0: STA 00:23:76:22:96:94 WPA: sending 1/4 msg of 4-Way Handshake
WPA: Send EAPOL(version=2 secure=0 mic=0 ack=1 install=0 pairwise=8 kde_len=0 keyidx=0 encr=0)
nl80211: Event message available
nl80211: Ignored unknown event (cmd=19)
IEEE 802.1X: 00:23:76:22:96:94 TX status - version=2 type=3 length=95 - ack=1
IEEE 802.1X: 121 bytes from 00:23:76:22:96:94
   IEEE 802.1X: version=1 type=3 length=117
wlan0: STA 00:23:76:22:96:94 WPA: received EAPOL-Key frame (2/4 Pairwise)
WPA: 00:23:76:22:96:94 WPA_PTK entering state PTKCALCNEGOTIATING
WPA: PTK derivation - A1=00:24:b2:d8:28:b7 A2=00:23:76:22:96:94
WPA: PMK - hexdump(len=32): [REMOVED]
WPA: PTK - hexdump(len=48): [REMOVED]
WPA: 00:23:76:22:96:94 WPA_PTK entering state PTKCALCNEGOTIATING2
WPA: 00:23:76:22:96:94 WPA_PTK entering state PTKINITNEGOTIATING
wlan0: STA 00:23:76:22:96:94 WPA: sending 3/4 msg of 4-Way Handshake
WPA: Send EAPOL(version=2 secure=1 mic=1 ack=1 install=1 pairwise=8 kde_len=46 keyidx=1 encr=1)
Plaintext EAPOL-Key Key Data - hexdump(len=56): [REMOVED]
IEEE 802.1X: 00:23:76:22:96:94 TX status - version=2 type=3 length=151 - ack=1
IEEE 802.1X: 99 bytes from 00:23:76:22:96:94
   IEEE 802.1X: version=1 type=3 length=95
wlan0: STA 00:23:76:22:96:94 WPA: received EAPOL-Key frame (4/4 Pairwise)
WPA: 00:23:76:22:96:94 WPA_PTK entering state PTKINITDONE
wpa_driver_nl80211_set_key: ifindex=7 alg=3 addr=0x47a078 key_idx=0 set_tx=1 seq_len=0 key_len=16
   addr=00:23:76:22:96:94
AP-STA-CONNECTED 00:23:76:22:96:94
wlan0: STA 00:23:76:22:96:94 IEEE 802.1X: authorizing port
wlan0: STA 00:23:76:22:96:94 WPA: pairwise key handshake completed (RSN)
wlan0: WPA rekeying GTK
WPA: group state machine entering state SETKEYS (VLAN-ID 0)
GMK - hexdump(len=32): [REMOVED]
GTK - hexdump(len=16): [REMOVED]
WPA: 00:23:76:22:96:94 WPA_PTK_GROUP entering state REKEYNEGOTIATING
wlan0: STA 00:23:76:22:96:94 WPA: sending 1/2 msg of Group Key Handshake
WPA: Send EAPOL(version=2 secure=1 mic=1 ack=1 install=0 pairwise=0 kde_len=24 keyidx=2 encr=1)
Plaintext EAPOL-Key Key Data - hexdump(len=32): [REMOVED]
wpa_group_setkeys: GKeyDoneStations=1
IEEE 802.1X: 99 bytes from 00:23:76:22:96:94
   IEEE 802.1X: version=1 type=3 length=95
wlan0: STA 00:23:76:22:96:94 WPA: received EAPOL-Key frame (2/2 Group)
WPA: 00:23:76:22:96:94 WPA_PTK_GROUP entering state REKEYESTABLISHED
wlan0: STA 00:23:76:22:96:94 WPA: group key handshake completed (RSN)
WPA: group state machine entering state SETKEYSDONE (VLAN-ID 0)
wpa_driver_nl80211_set_key: ifindex=7 alg=3 addr=(nil) key_idx=2 set_tx=1 seq_len=0 key_len=16
WPA: 00:23:76:22:96:94 WPA_PTK_GROUP entering state IDLE
Checking STA 00:23:76:22:96:94 inactivity:
  Station has been active
Checking STA 00:23:76:22:96:94 inactivity:
  Station has been active
wlan0: WPA rekeying GTK
WPA: group state machine entering state SETKEYS (VLAN-ID 0)
GMK - hexdump(len=32): [REMOVED]
GTK - hexdump(len=16): [REMOVED]
WPA: 00:23:76:22:96:94 WPA_PTK_GROUP entering state REKEYNEGOTIATING
wlan0: STA 00:23:76:22:96:94 WPA: sending 1/2 msg of Group Key Handshake
WPA: Send EAPOL(version=2 secure=1 mic=1 ack=1 install=0 pairwise=0 kde_len=24 keyidx=1 encr=1)
Plaintext EAPOL-Key Key Data - hexdump(len=32): [REMOVED]
wpa_group_setkeys: GKeyDoneStations=1
IEEE 802.1X: 99 bytes from 00:23:76:22:96:94
   IEEE 802.1X: version=1 type=3 length=95
wlan0: STA 00:23:76:22:96:94 WPA: received EAPOL-Key frame (2/2 Group)
WPA: 00:23:76:22:96:94 WPA_PTK_GROUP entering state REKEYESTABLISHED
wlan0: STA 00:23:76:22:96:94 WPA: group key handshake completed (RSN)
WPA: group state machine entering state SETKEYSDONE (VLAN-ID 0)
wpa_driver_nl80211_set_key: ifindex=7 alg=3 addr=(nil) key_idx=1 set_tx=1 seq_len=0 key_len=16
WPA: 00:23:76:22:96:94 WPA_PTK_GROUP entering state IDLE
mgmt::deauth
deauthentication: STA=00:23:76:22:96:94 reason_code=1
AP-STA-DISCONNECTED 00:23:76:22:96:94
wlan0: STA 00:23:76:22:96:94 WPA: event 3 notification
wpa_driver_nl80211_set_key: ifindex=7 alg=0 addr=0x47a078 key_idx=0 set_tx=1 seq_len=0 key_len=0
   addr=00:23:76:22:96:94
WPA: 00:23:76:22:96:94 WPA_PTK entering state DISCONNECTED
WPA: 00:23:76:22:96:94 WPA_PTK entering state INITIALIZE
wpa_driver_nl80211_set_key: ifindex=7 alg=0 addr=0x47a078 key_idx=0 set_tx=1 seq_len=0 key_len=0
   addr=00:23:76:22:96:94
wlan0: STA 00:23:76:22:96:94 IEEE 802.1X: unauthorizing port
wlan0: STA 00:23:76:22:96:94 IEEE 802.11: deauthenticated
wlan0: STA 00:23:76:22:96:94 MLME: MLME-DEAUTHENTICATE.indication(00:23:76:22:96:94, 1)
wlan0: STA 00:23:76:22:96:94 MLME: MLME-DELETEKEYS.request(00:23:76:22:96:94)
wpa_driver_nl80211_set_key: ifindex=7 alg=0 addr=0x47a078 key_idx=0 set_tx=1 seq_len=0 key_len=0
   addr=00:23:76:22:96:94
hostapd_ht_operation_update current operation mode=0x13
hostapd_ht_operation_update new operation mode=0x0 changes=2
nl80211: Set beacon (beacon_set=1)</code></pre></div>											<p class="post-edited">(Last edited by <strong>luminoso</strong> on 7 Oct 2010, 15:18)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p129783">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">karl_k</div>
					<div class="post-datetime">
						2 Mar 2011, 17:39					</div>
				</div>
				<div class="post-content content">
					<p>Beating a dead cow, but i have just hit the same problem on a current (trunk) setup on my WNDR3700.</p><p>I have tried to raise awareness at xda-developers, but it seems its not androids fault, but something with wpa_supplicant.</p><p>Anyone willing to contact the xda people ? Maybe this can be fixed in android, if not in wpa_supplicant or even in openwrt as it seems to work with other router-firmwares ?</p><p>Here is the link to the discussion on xda:</p><p><a href="http://forum.xda-developers.com/showthread.php?t=973413">http://forum.xda-developers.com/showthread.php?t=973413</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p129803">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">ea_umea</div>
					<div class="post-datetime">
						2 Mar 2011, 21:50					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>karl_k wrote:</cite><blockquote><p>Beating a dead cow, but i have just hit the same problem on a current (trunk) setup on my WNDR3700.</p><p>I have tried to raise awareness at xda-developers, but it seems its not androids fault, but something with wpa_supplicant.</p><p>Anyone willing to contact the xda people ? Maybe this can be fixed in android, if not in wpa_supplicant or even in openwrt as it seems to work with other router-firmwares ?</p><p>Here is the link to the discussion on xda:</p><p><a href="http://forum.xda-developers.com/showthread.php?t=973413">http://forum.xda-developers.com/showthread.php?t=973413</a></p></blockquote></div><p>Saw your post at xda and i had the same issue with OpenWrt and CM7. Solved by adding wmm_enabled=0 in /lib/wifi/mac80211.sh so that hostapd gets this option.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p129818">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">dblevitan</div>
					<div class="post-datetime">
						3 Mar 2011, 02:18					</div>
				</div>
				<div class="post-content content">
					<p>This is not a problem with OpenWRT, hostapd, or wpa_supplicant (the latter two are the same project, and mostly written by one person). This is a bug with Android wifi drivers that do not properly follow spec.</p><p>The TI Wilink driver I referred to is particularly at fault, and disabling WMM on the router is a band-aid to the problem - not a fix or a real solution. wpa_supplicant is not even involved in this process since the Wilink driver generates the RSN on its own.</p><p>The people who need to address this are TI, not openwrt or CM or someone else (or CM can put in a patch to fix the TI Wilink driver, which is probably a good idea anyway).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p131667">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">karl_k</div>
					<div class="post-datetime">
						26 Mar 2011, 23:35					</div>
				</div>
				<div class="post-content content">
					<p>I have been in touch with CM devs, they say they can not fix this as the wifi driver is binary.</p><p>So, any chance we get a fix into openwrt ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p134847">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">edgewood</div>
					<div class="post-datetime">
						7 May 2011, 14:51					</div>
				</div>
				<div class="post-content content">
					<p>I ran in to this problem with the stock Droid (original) ROM, but did some more searching and found a workaround <a href="https://forum.openwrt.org/viewtopic.php?pid=124497#p124497">elsewhere</a> in the forums, so thought I would post back here.</p>											<p class="post-edited">(Last edited by <strong>edgewood</strong> on 7 May 2011, 14:51)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p138341">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">danstoner</div>
					<div class="post-datetime">
						2 Jul 2011, 04:59					</div>
				</div>
				<div class="post-content content">
					<p>The workaround linked above (disabling WMM) does solve the Droid wifi issue (for me) and I will post some more detail in the other thread.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p143967">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">kmedeiros</div>
					<div class="post-datetime">
						19 Sep 2011, 07:22					</div>
				</div>
				<div class="post-content content">
					<p>This solution posted on another forum works great!</p><br /><p>Ok</p><p>This solution works on Moto Droid with Android 2.2 and 2.2.1. Hope it will work on other android devices too</p><p>So:</p><p>1) Download wpa files from Eclair (attached)<br />2) Unzip and copy them to your phone, turn off WiFi, open Root Explorer or smth like this and place files in /system/bin/ . Don&#039;t forget to backup your original files!<br />3) Set proper permissions for newly copied files. They are needed to be set to rwxr -xr -x<br />4) Turn on WiFi. Now you&#039;d be able to connect to your WPA2-Enterprise network!</p><p>Enjoy <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><br /><p>Once you do that everything works as it should again on a Motorola Original Droid 1.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>