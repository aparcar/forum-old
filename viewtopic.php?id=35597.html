<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Best hardware for openvpn</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 21 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p161337">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">fab3d2faa544</div>
					<div class="post-datetime">
						19 Mar 2012, 10:46					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>I&#039;m looking for a hardware router with an encryption chip. <br />Which one du you use with openvpn? Does it work stable?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p161355">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">eleon216</div>
					<div class="post-datetime">
						19 Mar 2012, 12:32					</div>
				</div>
				<div class="post-content content">
					<p>hardwarecrypto and openvpn have some specific problems. <br />IPSec and hardware-crypto normally makes more sense than openvpn and hardware-crypto, because IPSec runs completly in kernelspace. <br />With openvpn it might be the case that the memorybandwith is the limiting factor not the cpu, especially of you are use hardware-crypto. (this was the case with some older broadcomchips, I tried it with a asus wl-500gp and the hardware-crypto was quite fast 200Mbit/s or something like that for aes-256-cbc, but in combination with openvpn it was slower than softwarecrypto. </p><p>So what are your performance needs? <br />there a some atheros-cpus around with 680MHz you will get 20-25Mbit/s with softwarecrypto (aes-256-cbc+sha1). <br />the amd genode cpus on the alix boards from pc engines have a hardwarecrypto-engine (for aes-128-cbc) but I don&#039;t know anything about&nbsp; the&nbsp; performance with openvpn.</p><p>the via-cpus have quite fast hardwarecrypto I had one a few years ago, and run it with debian and harddisk-encryption and it was really fast (the bottleneck was the hdd-speed, not the encryption) so you could get an itx, or nano-itx board.</p><p>but if you only need 20-25Mbit/s I wouldn&#039;t bother with hardwarecrypto-engines</p>											<p class="post-edited">(Last edited by <strong>eleon216</strong> on 20 Mar 2012, 09:34)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p161479">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">fab3d2faa544</div>
					<div class="post-datetime">
						20 Mar 2012, 08:53					</div>
				</div>
				<div class="post-content content">
					<p>20-25Mbit/s should be enough. I&#039;m using the openvpn-routers only as clients.</p><p>Which router to use in this case?</p><p>In the past I used the WRT54GL but I think there are much better ones available yet.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p161482">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">eleon216</div>
					<div class="post-datetime">
						20 Mar 2012, 09:12					</div>
				</div>
				<div class="post-content content">
					<p>with an wrt54gl you will get 5Mbit/s max</p><p>these are some devices with an atheros-cpu with 680Mhz:</p><p><a href="http://wiki.openwrt.org/toh/d-link/dir-825">http://wiki.openwrt.org/toh/d-link/dir-825</a><br /><a href="http://wiki.openwrt.org/toh/netgear/wndr3800">http://wiki.openwrt.org/toh/netgear/wndr3800</a><br /><a href="http://wiki.openwrt.org/toh/buffalo/wzr-hp-ag300h">http://wiki.openwrt.org/toh/buffalo/wzr-hp-ag300h</a><br /><a href="http://wiki.openwrt.org/toh/ubiquiti/routerstation">http://wiki.openwrt.org/toh/ubiquiti/routerstation</a><br /><a href="http://wiki.openwrt.org/toh/ubiquiti/routerstation.pro">http://wiki.openwrt.org/toh/ubiquiti/routerstation.pro</a></p><p>they cost between 60 and 100euro. </p><p>If 10-15Mbit/s are enough, you can get some devices with a 400MHz Atheros-CPU, there are many around and they are really cheap (20-50euros)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p173442">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">toolame</div>
					<div class="post-datetime">
						27 Jul 2012, 17:26					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>eleon216 wrote:</cite><blockquote><p>hardwarecrypto and openvpn have some specific problems. <br />IPSec and hardware-crypto normally makes more sense than openvpn and hardware-crypto, because IPSec runs completly in kernelspace. <br />With openvpn it might be the case that the memorybandwith is the limiting factor not the cpu, especially of you are use hardware-crypto. (this was the case with some older broadcomchips, I tried it with a asus wl-500gp and the hardware-crypto was quite fast 200Mbit/s or something like that for aes-256-cbc, but in combination with openvpn it was slower than softwarecrypto. </p><p>So what are your performance needs? <br />there a some atheros-cpus around with 680MHz you will get 20-25Mbit/s with softwarecrypto (aes-256-cbc+sha1). <br />the amd genode cpus on the alix boards from pc engines have a hardwarecrypto-engine (for aes-128-cbc) but I don&#039;t know anything about&nbsp; the&nbsp; performance with openvpn.</p><p>the via-cpus have quite fast hardwarecrypto I had one a few years ago, and run it with debian and harddisk-encryption and it was really fast (the bottleneck was the hdd-speed, not the encryption) so you could get an itx, or nano-itx board.</p><p>but if you only need 20-25Mbit/s I wouldn&#039;t bother with hardwarecrypto-engines</p></blockquote></div><p>Very interested in hearing how did you use hardware crypto in wl500gP in combination with OpenVPN.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p173462">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">eleon216</div>
					<div class="post-datetime">
						27 Jul 2012, 19:55					</div>
				</div>
				<div class="post-content content">
					<p>you need kmod-ocf-ubsec-ssb (support for the hardwarecryptochip) kernel 2.6/3.x and crytodev support (but I think this is already selected by kmod_ocf_ubsec-ssb).<br />And than you only have to specify the engine crytodev in the openvpn-config. If you get good results let me know, but I doubt it.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p173464">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">toolame</div>
					<div class="post-datetime">
						27 Jul 2012, 20:36					</div>
				</div>
				<div class="post-content content">
					<p>I have a firmware based on Linux 2.6.22.19 (new oleg&#039;s firmware, not openwrt) could you point me exactly which module I need?</p><p>I have already compiled aes.ko support, but not sure if it&#039;s uses hardware encryption.</p><p>Interesting is there an OpenWRT build based on 3.x kernel for ASUS WL-500gP v1?</p><p>here is an image:<br /><span class="postimg"><img src="http://i.imgur.com/Cd3Tx.jpg" alt="http://i.imgur.com/Cd3Tx.jpg" /></span></p><p>NOTE: hardware crypto devices is empty for me for some reason.</p><p>EDIT: i think it&#039;s not bundled with this kernel, I found it here - <a href="https://dev.openwrt.org/browser/trunk/package/ubsec_ssb?rev=15242">https://dev.openwrt.org/browser/trunk/p â€¦ ?rev=15242</a></p><p>probably need to try to compile it within my kernel.</p>											<p class="post-edited">(Last edited by <strong>toolame</strong> on 27 Jul 2012, 21:02)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p173494">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">Gideon7</div>
					<div class="post-datetime">
						28 Jul 2012, 08:26					</div>
				</div>
				<div class="post-content content">
					<p>My favorite routers are the TP-Link TL-WDR4300 and the D-Link DIR-825.&nbsp; Both have plenty of CPU horsepower and RAM (128MB and 64MB respectively).&nbsp; They should handle 25 Mbit/s or better.&nbsp; They are easy to flash from the factory GUI and support concurrent 2.4Ghz and 5Ghz traffic.</p><p>The DIR-825 is supported in the stable branch (Backfire).&nbsp; The TL-WDR4300 has better specs but is only supported on the main trunk currently.&nbsp; I have both and they both work great.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p173496">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">eleon216</div>
					<div class="post-datetime">
						28 Jul 2012, 09:30					</div>
				</div>
				<div class="post-content content">
					<p>@toolame: kmod-ocf-ubsec-ssb (the driver for the broadcom hardwarecryptochip) is not part of the mainline kernel, it&#039;s a patch included in openwrt, so I don&#039;t think you would find it in oleg, Why not just try openwrt, it&#039;s a lot easier than patching the oleg-sources with openwrt-modifications. you will need the driver, the ocf-framework, you need to compile openssl and openvpn with hardwarecryptosupport,... or you just use openwrt <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>@Gideon7: one idea behind openwrt is to make the most out of your device, so getting hardwarecrypto running on the wl-500gp is an interessing project. Sure you can always buy newer/faster hardware, but that&#039;s really not the point here!</p>											<p class="post-edited">(Last edited by <strong>eleon216</strong> on 28 Jul 2012, 09:39)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p173513">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">toolame</div>
					<div class="post-datetime">
						28 Jul 2012, 15:57					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>eleon216 wrote:</cite><blockquote><p>@toolame: kmod-ocf-ubsec-ssb (the driver for the broadcom hardwarecryptochip) is not part of the mainline kernel, it&#039;s a patch included in openwrt, so I don&#039;t think you would find it in oleg, Why not just try openwrt, it&#039;s a lot easier than patching the oleg-sources with openwrt-modifications. you will need the driver, the ocf-framework, you need to compile openssl and openvpn with hardwarecryptosupport,... or you just use openwrt <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p></blockquote></div><p>well, the problem is I&#039;m using WL500gP with BCM43222 card as a wireless (to have 802.11n) on it.</p><p>it works only within new oleg&#039;s firmware with closed source driver, i tried backfire 10.3 but wireless didn&#039;t work for me with b43 driver.</p><p>i&#039;m mostly interested in recent kernel build because wireless might work there.</p><p>also there is another problem with sirq high usage on 2.6.x kernel (both on OpenWRT and Oleg&#039;s-rtn) (i think it&#039;s due et driver&#039;s implementation).</p><p>OpenWRT lacks fast_nat&#039;s Broadcom implementation and few things which present in Oleg&#039;s firmware.. Basically, If I&#039;m gonna switch I&#039;d need to configure everything from scratch, writing scripts etc, not convinient at all and a lot of time whilst on the other side OpenWRT is bit slower than Oleg&#039;s. (tested through the ethernet - max I could get on 100 mbit/sec line around 40 mbit/sec, on rtn Oleg - 50-54 mbit/sec).</p><p>But I&#039;d like to use this hardware crypto advantage because I&#039;m running multiple OpenVPN instances. Will probably give it a shot, thanks for the info.</p><div class="quotebox"><cite>eleon216 wrote:</cite><blockquote><p>@Gideon7: one idea behind openwrt is to make the most out of your device, so getting hardwarecrypto running on the wl-500gp is an interessing project. Sure you can always buy newer/faster hardware, but that&#039;s really not the point here![</p></blockquote></div><p>exactly! this is what I&#039;m trying to achieve... already made it 802.11n wireless capable for about 10$ bucks <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><div class="quotebox"><cite>Gideon7 wrote:</cite><blockquote><p>My favorite routers are the TP-Link TL-WDR4300 and the D-Link DIR-825.&nbsp; Both have plenty of CPU horsepower and RAM (128MB and 64MB respectively).&nbsp; They should handle 25 Mbit/s or better.&nbsp; They are easy to flash from the factory GUI and support concurrent 2.4Ghz and 5Ghz traffic.</p><p>The DIR-825 is supported in the stable branch (Backfire).&nbsp; The TL-WDR4300 has better specs but is only supported on the main trunk currently.&nbsp; I have both and they both work great.</p></blockquote></div><p>If I had some money for the new router - I&#039;d go for Netgear&#039;s recent models. Never liked D-Link or TP-Link, both always are having problems (DIR-620 had WAN and LAN ports fucked up, heard about TP-Link lots of negative comments).</p>											<p class="post-edited">(Last edited by <strong>toolame</strong> on 28 Jul 2012, 16:01)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p173528">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">freezer2k</div>
					<div class="post-datetime">
						28 Jul 2012, 22:05					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Gideon7 wrote:</cite><blockquote><p>My favorite routers are the TP-Link TL-WDR4300 and the D-Link DIR-825.&nbsp; Both have plenty of CPU horsepower and RAM (128MB and 64MB respectively).&nbsp; They should handle 25 Mbit/s or better.&nbsp; They are easy to flash from the factory GUI and support concurrent 2.4Ghz and 5Ghz traffic.</p><p>The DIR-825 is supported in the stable branch (Backfire).&nbsp; The TL-WDR4300 has better specs but is only supported on the main trunk currently.&nbsp; I have both and they both work great.</p></blockquote></div><p>Not all DIR-825 revisions are fully supported in Backfire.</p><p>See the wiki for this: &quot;Newer revisions (FW 2.05EU) store mac-addresses differently, which leads to non-working wlan0/1. Working with trunk as of r29119&quot;</p><br /><p>I&#039;ve got one of these, they seem to do fine with latest trunk though.</p>											<p class="post-edited">(Last edited by <strong>freezer2k</strong> on 28 Jul 2012, 22:07)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p173531">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">eleon216</div>
					<div class="post-datetime">
						28 Jul 2012, 22:43					</div>
				</div>
				<div class="post-content content">
					<p>As I wrote earlier, when I tested it 2 years ago, I got hardwarecrypto working, and openssl-speedtests were really fast, and I got openvpn using the hardware, but openvpn didn&#039;t perform well it was even slower than with softwarecrypto. So maybe you should test the performance with openwrt before you try to port it to oleg&#039;s firmware.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p173532">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">toolame</div>
					<div class="post-datetime">
						28 Jul 2012, 22:47					</div>
				</div>
				<div class="post-content content">
					<p>did you patch openssl as well? or it was &#039;inside the box&#039; already?</p><p>OK, I will try to test it, i&#039;m also interested in using this module for filesystem encryption, maybe it will give some speed.</p>											<p class="post-edited">(Last edited by <strong>toolame</strong> on 28 Jul 2012, 22:48)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p173544">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">eleon216</div>
					<div class="post-datetime">
						29 Jul 2012, 08:25					</div>
				</div>
				<div class="post-content content">
					<p>when I tested it 3 years ago, it I got everything from here: <a href="http://danm.de/index.php?action=source">http://danm.de/index.php?action=source</a> (ubsec_ssb) but it should be in openwrt now, and I think openssl has support out of the box, too. <br />But you should really test it before you spend too much time with getting it working with oleg&#039;s firmware. The context switches userspace-&gt;kernelspace and kernelspace-&gt;userspace might still be a problem. So I guess you will only be able to use hardwarecrypto with a vpnsolution running in kernelspace (e.g. IPsec)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p190873">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">toolame</div>
					<div class="post-datetime">
						4 Feb 2013, 12:17					</div>
				</div>
				<div class="post-content content">
					<p>hey eleon216.</p><p>I&#039;ve recently bought Netgear WNDR3800 (680Mhz CPU+128mb memory), but the speeds over OpenVPN are around ~6.4 mbit/sec (~800kbytes/sec) (lzo+aes256 enabled over UDP), you&#039;ve said speeds should be around 20-25mbit/sec (~2.5-3mbytes/sec), but I do not see such speeds here.</p><p>Here is my client configuration:<br /></p><div class="codebox"><pre><code>dev tun13
client
remote x.x.x.x
proto udp
port 25500
daemon

key main/me.key
cert main/me.crt
ca main/ca.crt

comp-lzo
keepalive 10 60
ping-timer-rem
persist-tun
persist-key
ns-cert-type server
resolv-retry infinite
mssfix 1430

;log main.log
verb 0
daemon
#mute 20
pull</code></pre></div><p>I also have a rule to fix MSS for tun+ interfaces in mangle chain of iptables:<br /></p><div class="codebox"><pre><code>   1    60 TCPMSS     tcp  --  *      tun+    0.0.0.0/0            0.0.0.0/0           tcp flags:0x06/0x02 TCPMSS clamp to PMTU</code></pre></div><p>do you think it&#039;s worth trying hardware crypto ?</p>											<p class="post-edited">(Last edited by <strong>toolame</strong> on 4 Feb 2013, 12:18)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p217866">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">burning daylight</div>
					<div class="post-datetime">
						18 Nov 2013, 18:04					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>toolame wrote:</cite><blockquote><p> (lzo+aes256 enabled over UDP)<br />do you think it&#039;s worth trying hardware crypto ?</p></blockquote></div><p>I would try disabling compression. Using it with encryption decreases the throughput, because CPU is the limiting factor in this case. To my knowledge, wndr3800 does not have any hardware crypto.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>