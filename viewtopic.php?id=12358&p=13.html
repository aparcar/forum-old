<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Support for Marvell 88F5xx81 based routers</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 18 Jan 2014 and 6 May 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 13 of 46</div><nav><ul><li><a href="viewtopic.php%3Fid=12358&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=12358&amp;p=11.html">11</a></li><li><a href="viewtopic.php%3Fid=12358&amp;p=12.html">12</a></li><li class="pagination-current"><span>13</span></li><li><a href="viewtopic.php%3Fid=12358&amp;p=14.html">14</a></li><li><a href="viewtopic.php%3Fid=12358&amp;p=15.html">15</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=12358&amp;p=46.html">46</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p82527">
				<div class="post-metadata">
					<div class="post-num">Post #301</div>
					<div class="post-author">cmoegele</div>
					<div class="post-datetime">
						24 Feb 2009, 08:44					</div>
				</div>
				<div class="post-content content">
					<p>for TFTP-server setup and Building of the image:</p><p>With serial connection use `printenv Â´ and look for the correct<br />ip-adresses used in uboot environment, in my case the router expects&nbsp; TFTP-server to have 172.21.5.30 IP-adress<br />and with this information I compiled my image already with 172.21.5.1 for router-IP, so you donÂ´t have to change always<br />the IP-adresses from your server, or other PC<br />the login for Telnet, or http is also 172.21.5.1</p><p>br</p><p>cm</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p83299">
				<div class="post-metadata">
					<div class="post-num">Post #302</div>
					<div class="post-author">DaBigMac</div>
					<div class="post-datetime">
						6 Mar 2009, 04:03					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>maddes.b wrote:</cite><blockquote><p>(as normal user)<br />mkdir ~/kamikaze-webtest/&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />... do all the checkout stuff from the HowTo ...<br />patch -p0&nbsp; &lt; &lt;patchfile&gt;<br />svn add tools/wrt350nv2-builder<br />svn propset svn:executable &quot;*&quot; tools/wrt350nv2-builder/src/wrt350nv2-reflashscript</p></blockquote></div><p>I&#039;ve been having trouble with the build after issuing the svn propset command. Without it, build works fine, but when I set it, make fails at the point of compiling webupgrade. If I don&#039;t set it (I forgot to one time) make works just fine and a .img file is created, however if I add this command, build doesn&#039;t work.. Have I made some kind of mistake? (I am a noob, it&#039;s not unlikely!) I tried my best to follow the instructions to the letter...</p><p>Update:</p><p>Build finally worked! A flashable image was created and using the web interface I was able to flash successfully!</p><p>However.... (don&#039;t you hate that word? I think it was invented specifically for geeks and beta testers <img src="https://forum.openwrt.org/img/smilies/hmm.png" width="15" height="15" alt="hmm" /> )</p><p>I can connect via telnet (thank god).</p><p>I can&#039;t edit /etc/config/network. I can open it in vi, I can make all the changes I like, I can write the file, but when I reboot the router, all my changes are gone!</p><p>I did a df, everything is full <img src="https://forum.openwrt.org/img/smilies/hmm.png" width="15" height="15" alt="hmm" /> 100%</p><p>Is there something I need to mount? I let the router do it&#039;s thing after the upgrade, I remember Dirk mentioning a 2nd reboot and some kind of formatting of jffs2, but I don&#039;t see any /jffs2 listed in the df..</p><p>Any ideas anyone?</p>											<p class="post-edited">(Last edited by <strong>DaBigMac</strong> on 14 Mar 2009, 19:02)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p84068">
				<div class="post-metadata">
					<div class="post-num">Post #303</div>
					<div class="post-author">relghuar</div>
					<div class="post-datetime">
						17 Mar 2009, 19:51					</div>
				</div>
				<div class="post-content content">
					<p>Check what does mount say about mini_fo - you should have jffs2 partition mounted on /jffs and merged with squashfs on root, something like:<br /></p><div class="codebox"><pre><code>/dev/mtdblock2 on /jffs type jffs2 (rw)
mini_fo:/jffs on / type mini_fo (rw)</code></pre></div><p>There should also be a rootfs_data mtd partition created automatically by kernel (this one takes up all the space inside rootfs partition that&#039;s not actually occupied by squashfs):<br /></p><div class="codebox"><pre><code>root@OpenWrt:/# cat /proc/mtd
dev:    size   erasesize  name
mtd0: 00160000 00010000 &quot;kernel&quot;
mtd1: 00660000 00010000 &quot;rootfs&quot;
mtd2: 001a0000 00010000 &quot;rootfs_data&quot;
mtd3: 00040000 00010000 &quot;u-boot&quot;</code></pre></div><p>What you describe looks like you only have ramdisk merged on root, which means any files you write will get lost after reset. JFFS2 partition should be created some time after the first system boot, and then mounted automatically on every reboot. Can you post whole serial console log from reset to a completely started system? There&#039;s probably something wrong with jffs2 creation (not enough place perhaps? how large&#039;s your kernel+root image?)</p>											<p class="post-edited">(Last edited by <strong>relghuar</strong> on 17 Mar 2009, 19:54)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p84090">
				<div class="post-metadata">
					<div class="post-num">Post #304</div>
					<div class="post-author">maddes.b</div>
					<div class="post-datetime">
						17 Mar 2009, 23:15					</div>
				</div>
				<div class="post-content content">
					<p>For me it looks like this:<br /></p><div class="codebox"><pre><code>root@OpenWrt:/# mount mini_fo
mount: can&#039;t find mini_fo in /etc/fstab
root@OpenWrt:/# mount
...
mini_fo:/tmp/root on / type mini_fo (rw)</code></pre></div><div class="codebox"><pre><code>root@OpenWrt:/# cat /proc/mtd
dev:    size   erasesize  name
mtd0: 00100000 00010000 &quot;kernel&quot;
mtd1: 00650000 00010000 &quot;rootfs&quot;
mtd2: 00170000 00010000 &quot;rootfs_data&quot;
mtd3: 00040000 00010000 &quot;u-boot&quot;</code></pre></div><p>The images have the following sizes:<br />openwrt-wrt350nv2-uImage = 989KB<br />openwrt-wnr854t-squashfs.img = 2.432KB<br />openwrt-wrt350nv2-webupgrade.img = 5.942KB</p><p>Here&#039;s the complete log:<br /></p><div class="codebox"><pre><code>...snip....
Uncompressing Linux................................................................. done, booting the kernel.
Linux version 2.6.28.7 (openwrt@debian5) (gcc version 4.1.2) #2 Sun Mar 15 17:58:48 CET 2009
...snip....
squashfs: version 3.0 (2006/03/15) Phillip Lougher
Registering mini_fo version $Id$
JFFS2 version 2.2. (NAND) (SUMMARY)  Ã‚Â© 2001-2006 Red Hat, Inc.
msgmni has been set to 59
io scheduler noop registered
io scheduler deadline registered (default)
Serial: 8250/16550 driver2 ports, IRQ sharing disabled
serial8250.0: ttyS0 at MMIO 0xf1012000 (irq = 3) is a 16550A
console [ttyS0] enabled
MV-643xx 10/100/1000 ethernet driver version 1.4
mv643xx_eth smi: probed
net eth0: port 0 with MAC address 00:00:00:00:51:81
physmap platform flash device: 00800000 at f4000000
physmap-flash.0: Found 1 x16 devices at 0x0 in 8-bit bank
 Amd/Fujitsu Extended Query Table at 0x0040
physmap-flash.0: Swapping erase regions for broken CFI table.
number of CFI chips: 1
cfi_cmdset_0002: Disabling erase-suspend-program due to code brokenness.
cmdlinepart partition parsing not available
Searching for RedBoot partition table in physmap-flash.0 at offset 0x7f0000
No RedBoot partition table detected in physmap-flash.0
Using physmap partition information
Creating 3 MTD partitions on &quot;physmap-flash.0&quot;:
0x00000000-0x00100000 : &quot;kernel&quot;
0x00100000-0x00750000 : &quot;rootfs&quot;
mtd: partition &quot;rootfs&quot; set to be root filesystem
mtd: partition &quot;rootfs_data&quot; created automatically, ofs=5E0000, len=170000
0x005e0000-0x00750000 : &quot;rootfs_data&quot;
0x007c0000-0x00800000 : &quot;u-boot&quot;
i2c /dev entries driver
TCP westwood registered
NET: Registered protocol family 17
Distributed Switch Architecture driver version 0.1
eth0: detected a Marvell 88E6131 switch
dsa slave smi: probed
802.1Q VLAN Support v1.8 Ben Greear &lt;greearb@candelatech.com&gt;
All bugs added by David S. Miller &lt;davem@redhat.com&gt;
drivers/rtc/hctosys.c: unable to open rtc device (rtc0)
VFS: Mounted root (squashfs filesystem) readonly.
Freeing init memory: 88K
Please be patient, while OpenWrt loads ...
- preinit -
Press CTRL-C for failsafe
switching to jffs2
Cowardly refusing to erase blocks on filesystem with no valid JFFS2 nodes
empty_blocks 0, bad_blocks 0, c-&gt;nr_blocks 23
jffs2 not ready yet; using ramdisk
mini_fo: using base directory: /
mini_fo: using storage directory: /tmp/root
- init -

Please press Enter to activate this console. eth0: link up, 1000 Mb/s, full duplex, flow control disabled
eth0: link up, 1000 Mb/s, full duplex, flow control disabled
device lan2 entered promiscuous mode
device eth0 entered promiscuous mode
device lan1 entered promiscuous mode
device lan3 entered promiscuous mode
device lan4 entered promiscuous mode
cfg80211: Using static regulatory domain info
cfg80211: Regulatory domain: US
        (start_freq - end_freq @ bandwidth), (max_antenna_gain, max_eirp)
        (2402000 KHz - 2472000 KHz @ 40000 KHz), (600 mBi, 2700 mBm)
        (5170000 KHz - 5190000 KHz @ 40000 KHz), (600 mBi, 2300 mBm)
        (5190000 KHz - 5210000 KHz @ 40000 KHz), (600 mBi, 2300 mBm)
        (5210000 KHz - 5230000 KHz @ 40000 KHz), (600 mBi, 2300 mBm)
        (5230000 KHz - 5330000 KHz @ 40000 KHz), (600 mBi, 2300 mBm)
        (5735000 KHz - 5835000 KHz @ 40000 KHz), (600 mBi, 3000 mBm)
cfg80211: Calling CRDA for country: US
Registered led device: ath9k-phy0::radio
Registered led device: ath9k-phy0::assoc
Registered led device: ath9k-phy0::tx
Registered led device: ath9k-phy0::rx
phy0: Atheros AR5416 MAC/BB Rev:2 AR2133 RF Rev:81: mem=0xc2980000, irq=36
cfg80211: Calling CRDA for country: AT
PPP generic driver version 2.4.2
ip_tables: (C) 2000-2006 Netfilter Core Team
nf_conntrack version 0.5.0 (512 buckets, 2048 max)



BusyBox v1.11.3 (2009-03-14 18:06:36 CET) built-in shell (ash)
Enter &#039;help&#039; for a list of built-in commands.

  _______                     ________        __
 |       |.-----.-----.-----.|  |  |  |.----.|  |_
 |   -   ||  _  |  -__|     ||  |  |  ||   _||   _|
 |_______||   __|_____|__|__||________||__|  |____|
          |__| W I R E L E S S   F R E E D O M
 KAMIKAZE (bleeding edge, r14889) -------------------
  * 10 oz Vodka       Shake well with ice and strain
  * 10 oz Triple sec  mixture into 10 shot glasses.
  * 10 oz lime juice  Salute!
 ---------------------------------------------------
root@OpenWrt:/#</code></pre></div><p>After some minutes the following came up:<br /></p><div class="codebox"><pre><code>Cowardly refusing to erase blocks on filesystem with no valid JFFS2 nodes
empty_blocks 0, bad_blocks 0, c-&gt;nr_blocks 23</code></pre></div><p>Build was done from scratch, just target system &quot;Marvell Orion&quot; selected then saved and compiled.</p>											<p class="post-edited">(Last edited by <strong>maddes.b</strong> on 21 Mar 2009, 11:30)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p84102">
				<div class="post-metadata">
					<div class="post-num">Post #305</div>
					<div class="post-author">relghuar</div>
					<div class="post-datetime">
						18 Mar 2009, 02:33					</div>
				</div>
				<div class="post-content content">
					<p>Hmm strange one... I&#039;ve never seen this message before, it&#039;s a kernel output probably from jffs2 module. The only thing I can think of now is the image creation patch and webupgrade process. It&#039;s not quite straightforward actually, if you would only take stock webupgrade image from linksys site and burn it directly to flash it wouldn&#039;t work (you wouldn&#039;t even get to u-boot command line, just to some strange ethernet interface from sercomm), so the webupgrade process modifies the image in some ways. I have no idea how exactly, but I suppose it could possibly cause problems for jffs2 format process.<br />I can&#039;t really test it as I&#039;ve never used the webupgrade way, just direct u-boot flashing. And I&#039;m not sure after all the tweaks I&#039;ve done to u-boot and router itself that I can still bring the stock firmware back online <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /><br />If you feel adventurous you can try to flash openwrt through u-boot (see my post in this thread about a month back). If the process is not clear from my ranting there, just let me know and I can set up an exact procedure for you...</p>											<p class="post-edited">(Last edited by <strong>relghuar</strong> on 18 Mar 2009, 02:34)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p84103">
				<div class="post-metadata">
					<div class="post-num">Post #306</div>
					<div class="post-author">dirkNL</div>
					<div class="post-datetime">
						18 Mar 2009, 02:56					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>maddes.b wrote:</cite><blockquote><p>For me it looks like this:</p><p>After some minutes the following came up:<br /></p><div class="codebox"><pre><code>Cowardly refusing to erase blocks on filesystem with no valid JFFS2 nodes
empty_blocks 0, bad_blocks 0, c-&gt;nr_blocks 23</code></pre></div><p>Build was done from scratch, just target system &quot;Marvell Orion&quot; selected then saved and compiled.</p></blockquote></div><p>Could you check to see if you have a file called &#039;/bin/root.squashfs.clean&#039; in you system? If that&#039;s the case the reflash hasn&#039;t done it&#039;s work yet, you should just be able to use dd to flash this clean filesystem to your rootfs partition. Just reboot after that and everthing should be fine.</p><div class="codebox"><pre><code>dd if=/bin/root.squashfs.clean of=/dev/mtdblock1</code></pre></div>											<p class="post-edited">(Last edited by <strong>dirkNL</strong> on 18 Mar 2009, 02:56)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p84166">
				<div class="post-metadata">
					<div class="post-num">Post #307</div>
					<div class="post-author">maddes.b</div>
					<div class="post-datetime">
						18 Mar 2009, 23:52					</div>
				</div>
				<div class="post-content content">
					<p>File is present and flashed it as told:<br /></p><div class="codebox"><pre><code>root@OpenWrt:/# ls -la /bin/root*
-rwx------    1 root     root      1310724 Mar 15  2009 /bin/root.squashfs.clean
root@OpenWrt:/# dd if=/bin/root.squashfs.clean of=/dev/mtdblock1
2560+1 records in
2560+1 records out</code></pre></div><p>On the first reboot I got the following additional log:<br /></p><div class="codebox"><pre><code>jffs2_scan_eraseblock(): End of filesystem marker found at 0x0
jffs2_build_filesystem(): unlocking the mtd device... done.
jffs2_build_filesystem(): erasing all blocks after the end marker... done.
mini_fo: using base directory: /
mini_fo: using storage directory: /jffs
...
root@OpenWrt:/# mount
...
mini_fo:/jffs on / type mini_fo (rw)</code></pre></div><p>When I changed some settings then they were available after the next reboot:<br /></p><div class="codebox"><pre><code>root@OpenWrt:/# uci set network.lan.dns=10.0.0.254
root@OpenWrt:/# uci set network.lan.gateway=10.0.0.254
root@OpenWrt:/# uci commit
root@OpenWrt:/# reboot
...
root@OpenWrt:/# uci show network</code></pre></div><p>Thanks for your help Dirk, that fixed it.<br />It seems the webupgrade image still has some issues <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><p>Kind regards<br />Maddes</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p84169">
				<div class="post-metadata">
					<div class="post-num">Post #308</div>
					<div class="post-author">dirkNL</div>
					<div class="post-datetime">
						19 Mar 2009, 01:07					</div>
				</div>
				<div class="post-content content">
					<p>Well, you could check if the filesystem you initially flashed contains a file in the rc called S99flash or something similar. Perhaps this &quot;service&quot; wasn&#039;t copied and so the reflash wasn&#039;t done for you...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p84290">
				<div class="post-metadata">
					<div class="post-num">Post #309</div>
					<div class="post-author">maddes.b</div>
					<div class="post-datetime">
						21 Mar 2009, 02:10					</div>
				</div>
				<div class="post-content content">
					<p>I reflashed and checked, the file /etc/rc.d/S99reflash was present but not executable.<br />Updated the webupgrade patches to include a &quot;chmod +x&quot; for it, reflashed and it worked.<br />Get it from <a href="http://forum.openwrt.org/viewtopic.php?pid=82410#p82410">this post</a>.</p>											<p class="post-edited">(Last edited by <strong>maddes.b</strong> on 21 Mar 2009, 02:10)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p84489">
				<div class="post-metadata">
					<div class="post-num">Post #310</div>
					<div class="post-author">DaBigMac</div>
					<div class="post-datetime">
						25 Mar 2009, 03:20					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ve made some unwise changes to my config. Is there any way to clear the nvram, or restore default settings??</p><p>I&#039;ve tried various lengths of time pressing the reset button, nothing seems to restore defaults..</p><p>I have a serial connection, so I have access to uboot and the openwrt terminal..</p><p>P.S. The problem with the /jffs2 was solved by the solution suggested. I had exactly the same problems as maddes.b did. I have not as yet tried the new webupgrade patch, but it&#039;s on my to do list. I&#039;d prefer to get my current configuration working again.</p><p>Many thanks,</p><p>Mannie.</p>											<p class="post-edited">(Last edited by <strong>DaBigMac</strong> on 25 Mar 2009, 03:48)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p84532">
				<div class="post-metadata">
					<div class="post-num">Post #311</div>
					<div class="post-author">dirkNL</div>
					<div class="post-datetime">
						25 Mar 2009, 15:08					</div>
				</div>
				<div class="post-content content">
					<p>BigMac, nvram isn&#039;t used anymore, in its place is the jffs2 overlay.</p><p>You can run &#039;firstboot&#039; in order to completely clean the the jffs2 overlay. Do a reboot afterwards and you should be running the default image again.</p><p>edit:<br />Oh wait, you haven&#039;t got linux. well ehr, can&#039;t you boot a clean image with tftp?</p><p>edit2:<br />i keep misreading... if you have the linux console, just run &#039;firstboot&#039;, and do a reboot. All should be restored to default</p>											<p class="post-edited">(Last edited by <strong>dirkNL</strong> on 25 Mar 2009, 16:22)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p84569">
				<div class="post-metadata">
					<div class="post-num">Post #312</div>
					<div class="post-author">mrk</div>
					<div class="post-datetime">
						25 Mar 2009, 19:54					</div>
				</div>
				<div class="post-content content">
					<p>I want to say hello; I followed Your diskussion for a while and now I&#039;ll&nbsp; try to set up my wrt350nv2 with OpenWrt. So let&#039;s go...</p><p>@maddes.b Your tutorials and summaries were very helpful, thank You!</p><p>After a couple of reflashing, the latest snapshot and LuCI are working.</p><p>But now I&#039;m confused, because my wlan will not get up.<br />I have configured the wrt as N-client with WPA2-PSK.</p><p>$ uci show<br /></p><div class="codebox"><pre><code>wireless.wlan0=wifi-device
wireless.wlan0.type=mac80211
wireless.wlan0.channel=11
wireless.wlan0.disabled=1
wireless.@wifi-iface[0]=wifi-iface
wireless.@wifi-iface[0].device=wlan0
wireless.@wifi-iface[0].network=lan
wireless.@wifi-iface[0].mode=sta
wireless.@wifi-iface[0].encryption=psk2
wireless.@wifi-iface[0].key=deadbeef
wireless.@wifi-iface[0].ssid=openWRT</code></pre></div><p>Seems to be OK.<br />My AP (WNR834B) displays the connection at 89% ... 49% ... off ... 89% ... and so on.<br />Serialconsole shows in a loop:<br /></p><div class="codebox"><pre><code>...
br-lan: topology change detected, propagating
br-lan: port 5(wlan0) entering forwarding state
br-lan: port 5(wlan0) entering disabled state
br-lan: topology change detected, propagating
br-lan: port 5(wlan0) entering forwarding state
br-lan: port 5(wlan0) entering disabled state
...</code></pre></div><p>Is that still an issue?<br />Or is a stable N/WPA2 link possible and I just have to configure something elsewhere.</p><br /><p>@dirkNL<br />thanx for the advice concerning &#039;firstboot&#039;, but my wrt300nV2 hangs afterwards.<br />Serialconsole shows in a loop:<br /></p><div class="codebox"><pre><code>mini_fo_lookup: ERR from storage dentry, lookup failed.
mini_fo_d_delete: negative dentry passed.
mini_fo_d_release: no private data.
mini_fo_lookup: ERR from storage dentry, lookup failed.
mini_fo_d_delete: negative dentry passed.
mini_fo_d_release: no private data.
.......</code></pre></div><p>After swiching off an on, it started clean, so no problem at all.</p><p>Update: <br />The unstable connection results of a different Fragmentation Threshold in my WNR834B.<br />Nevertheless, there is a handshake with the AP by now, but no data transmission.</p><p>I&#039;ll try a tcpdump....</p>											<p class="post-edited">(Last edited by <strong>mrk</strong> on 1 Apr 2009, 17:32)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p84613">
				<div class="post-metadata">
					<div class="post-num">Post #313</div>
					<div class="post-author">DaBigMac</div>
					<div class="post-datetime">
						26 Mar 2009, 08:24					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>dirkNL wrote:</cite><blockquote><p>BigMac, nvram isn&#039;t used anymore, in its place is the jffs2 overlay.</p><p>You can run &#039;firstboot&#039; in order to completely clean the the jffs2 overlay. Do a reboot afterwards and you should be running the default image again.</p><p>edit:<br />Oh wait, you haven&#039;t got linux. well ehr, can&#039;t you boot a clean image with tftp?</p><p>edit2:<br />i keep misreading... if you have the linux console, just run &#039;firstboot&#039;, and do a reboot. All should be restored to default</p></blockquote></div><p>Thanks DirkNL,</p><p>firstboot worked wonderfully. Now for some heavy BT&#039;ing and stability testing.. Lets see how this thing handles load..</p><p>Update:</p><p>It seems there is still some way to go in utilizing the full performance of this router. Initial tests are not impressive. Over a 2Mb/s link, using PPPoE with standard settings (as per using LUCI to configure my WAN link), I was barely able to sustain 25K/s, barely more than 10% of the links capacity.</p><p>Wireless was even less impressive, I got an initial connection using an Intel 3945 wifi card, but within seconds, data flow would stop. I am planning further tests with other wifi adapters.</p>											<p class="post-edited">(Last edited by <strong>DaBigMac</strong> on 28 Mar 2009, 17:19)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p85047">
				<div class="post-metadata">
					<div class="post-num">Post #314</div>
					<div class="post-author">maddes.b</div>
					<div class="post-datetime">
						2 Apr 2009, 22:56					</div>
				</div>
				<div class="post-content content">
					<p>To point your working copy to the new repository, go inside the working copy and execute:<br /></p><div class="codebox"><pre><code>svn switch --relocate https://svn.openwrt.org/openwrt/trunk svn://svn.openwrt.org/openwrt/trunk
svn up
./scripts/feeds update packages luci</code></pre></div>											<p class="post-edited">(Last edited by <strong>maddes.b</strong> on 6 Jul 2009, 02:37)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p85121">
				<div class="post-metadata">
					<div class="post-num">Post #315</div>
					<div class="post-author">dirkNL</div>
					<div class="post-datetime">
						4 Apr 2009, 04:20					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>DaBigMac wrote:</cite><blockquote><p>It seems there is still some way to go in utilizing the full performance of this router. Initial tests are not impressive. Over a 2Mb/s link, using PPPoE with standard settings (as per using LUCI to configure my WAN link), I was barely able to sustain 25K/s, barely more than 10% of the links capacity.</p><p>Wireless was even less impressive, I got an initial connection using an Intel 3945 wifi card, but within seconds, data flow would stop. I am planning further tests with other wifi adapters.</p></blockquote></div><p>I can&#039;t say anything about wireless, cause I stopped testing new versions some time ago. But I&#039;m surprised at the PPPoE speeds, normal routed traffic (WAN-&gt;LAN) shows a very solid 13MB/s on my device as well as the one used by Striker. Don&#039;t know about the PPPoE overhead but I couldn&#039;t believe that it will be this bad. Maybe someone else can confirm?</p><p>Striker and I are both using the router quite some time now on a 100mbit internet connection and so far everything is flying, so I&#039;m surprised to read about this poor PPPoE ratings...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p85418">
				<div class="post-metadata">
					<div class="post-num">Post #316</div>
					<div class="post-author">mrk</div>
					<div class="post-datetime">
						8 Apr 2009, 23:22					</div>
				</div>
				<div class="post-content content">
					<p>Wireless link ist now working in my configuration.</p><p>It is necessary to modify <em>/etc/config/wireless</em>, because <strong>LuCi</strong> can not handle 11n wifi by now.</p><p>The wireless config should be:<br /></p><div class="codebox"><pre><code>config &#039;wifi-device&#039; &#039;wlan0&#039;
        option &#039;type&#039; &#039;mac80211&#039;
        option &#039;channel&#039; &#039;9&#039;
        option &#039;hwmode&#039; &#039;11ng&#039;
        option &#039;ht_capab&#039; &#039;[HT40-][SHORT-GI-40][DSSS_CCK-40]&#039;
        option &#039;disabled&#039; &#039;0&#039;

config &#039;wifi-iface&#039;
        option &#039;device&#039; &#039;wlan0&#039;
        option &#039;mode&#039; &#039;ap&#039;
        option &#039;network&#039; &#039;lan&#039;
        option &#039;encryption&#039; &#039;psk2&#039;
        option &#039;key&#039; &#039;&#039;YourCode&#039;
        option &#039;ssid&#039; &#039;openWRT&#039;</code></pre></div><p>The important options are <strong>hwmode</strong> and <strong>ht_capab</strong> and be aware chossing a <strong>channel</strong> beyond &#039;6&#039;. <br />The options will be transformed by <em>/etc/lib/wifi/hostapd.sh</em> to the correct <em>hostapd.conf</em> file.<br />You can whatch the result in <em>/var/run</em> directory.</p><p>A usefull link is <a href="http://www.mail-archive.com/ath9k-devel@lists.ath9k.org/msg01138.html">http://www.mail-archive.com/ath9k-devel … 01138.html</a></p><p>The wireless link could be better, but is <span class="bbu">stable</span>!<br />My best iperf result -with standard values- has been about 12Mbits/s. <br />My general values are around 6Mbits/s, but the ap is now circa two walls away in another room.</p><p>I think it is now necessary to analyse the wireless stream an collect some debug information for the wireless testing team.</p><p>By the way, I have (only) a 10GB - DSL and speed.io shows a bandwith around 9000KBits/s using ppoe.<br />For me it&#039;s as good as before with the original firmware.</p><p>Well, I enjoy openWrt on my WRT350Nv2. And I will keep going it and playing something around.<br />Can someone give me some hints concerning the leds. They are aweful for wifi.</p><p>Well my next step will be to harden the webupdate application. <br />Doing some error checking and the &#039;-v&#039; parameter.</p><p>And maybe I will write a tutorial with the &quot;hall of pitfalls&quot; for newbies.<br />I&#039;ve learned quite much about openWrt in the last weeks and it&#039;s fascinating.</p><p>But now my girl want&#039;s me back for some time and I have to go on vacation ;-)</p><p>Greets Michael</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p86732">
				<div class="post-metadata">
					<div class="post-num">Post #317</div>
					<div class="post-author">maddes.b</div>
					<div class="post-datetime">
						27 Apr 2009, 16:33					</div>
				</div>
				<div class="post-content content">
					<p>Just tested r15432, but lan port #4 is still not working.</p>											<p class="post-edited">(Last edited by <strong>maddes.b</strong> on 29 Apr 2009, 00:26)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p86908">
				<div class="post-metadata">
					<div class="post-num">Post #318</div>
					<div class="post-author">Kaloz</div>
					<div class="post-datetime">
						29 Apr 2009, 13:59					</div>
				</div>
				<div class="post-content content">
					<p>It&#039;s an issue in the upstream drivers, not OpenWrt specific.. When it&#039;s fixed, this issue will be gone.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p87272">
				<div class="post-metadata">
					<div class="post-num">Post #319</div>
					<div class="post-author">dirkNL</div>
					<div class="post-datetime">
						4 May 2009, 17:46					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Kaloz wrote:</cite><blockquote><p>It&#039;s an issue in the upstream drivers, not OpenWrt specific.. When it&#039;s fixed, this issue will be gone.</p></blockquote></div><p>Maybe sooner than you think <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Lennert and I were just looking to find what was causing the disabled port, turns out it was the switch-chip not setting up all of its in/external ports. Though it will fixed upstream with kernel 2.6.30, if you can&#039;t wait here&#039;s the fix:</p><p>In the kernel sources open up file: <strong>net/dsa/mv88e6131.c</strong><br />line 271 should state:<br /></p><div class="codebox"><pre><code>for (i = 0; i &lt; 6; i++) {</code></pre></div><p>replace that with:<br /></p><div class="codebox"><pre><code>for (i = 0; i &lt; 11; i++) {</code></pre></div><p>And you&#039;re good to go.</p><br /><p>As for the wireless, I can confirm the post by mrk. Wifi is now stable, though I&#039;d like to add one note. If you are, like me, only using wireless G. Change the hwmode to 11g instead of 11ng. Early tests pointed out 25% increase in wireless G transferspeed with the use of WPA2.</p>											<p class="post-edited">(Last edited by <strong>dirkNL</strong> on 4 May 2009, 17:47)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p87282">
				<div class="post-metadata">
					<div class="post-num">Post #320</div>
					<div class="post-author">maddes.b</div>
					<div class="post-datetime">
						4 May 2009, 21:49					</div>
				</div>
				<div class="post-content content">
					<p>Created a patch file called &quot;999-net_dsa_mv88e6131_port_fix.patch&quot; for this and uploaded it on my ftp space.<br />Just place it inside target/linux/generic-2.6/patches-2.6.28 (or whatever kernel version before 2.6.30 you compile).</p><p>Tested with revision 15597 and lan port #4 works fine.</p><p>Update: Complete patch from Lennert now in OpenWrt repository.</p>											<p class="post-edited">(Last edited by <strong>maddes.b</strong> on 8 May 2009, 18:44)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p87600">
				<div class="post-metadata">
					<div class="post-num">Post #321</div>
					<div class="post-author">maddes.b</div>
					<div class="post-datetime">
						8 May 2009, 18:11					</div>
				</div>
				<div class="post-content content">
					<p>The patch for lan port #4 from Lennert was added by Kaloz in <a href="https://dev.openwrt.org/changeset/15697">revision 15697</a>.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p87769">
				<div class="post-metadata">
					<div class="post-num">Post #322</div>
					<div class="post-author">maddes.b</div>
					<div class="post-datetime">
						12 May 2009, 00:54					</div>
				</div>
				<div class="post-content content">
					<p>The snapshot repositories are still not available after the server change, hence I created a repository for Marvel Orion with all buildable packages of revision 15772.</p><p>Edit the first lines in /etc/opkg.conf to deactivate the original snapshot repository by outcommenting it, then add a new line which points to my package repository:<br /></p><div class="codebox"><pre><code>#src/gz snapshots http://downloads.openwrt.org/snapshots/orion/packages
src/gz Maddes ftp://ftp.maddes.net/openwrt/kamikaze/orion/packages</code></pre></div><p>Another Orion repository is also available from X-Wrt:<br /></p><div class="codebox"><pre><code>src X-Wrt http://downloads.x-wrt.org/xwrt/kamikaze/snapshots/orion/packages</code></pre></div><p><span class="bbu">Update:</span><br />Original repository <a href="http://forum.openwrt.org/viewtopic.php?pid=88156#p88156">is back</a>, [s]but <a href="http://forum.openwrt.org/viewtopic.php?pid=89765#p89765">with issues</a>[/s].</p>											<p class="post-edited">(Last edited by <strong>maddes.b</strong> on 13 Jul 2009, 23:29)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p87882">
				<div class="post-metadata">
					<div class="post-num">Post #323</div>
					<div class="post-author">StrikerNL</div>
					<div class="post-datetime">
						13 May 2009, 10:49					</div>
				</div>
				<div class="post-content content">
					<p>That&#039;s all very useful maddes, thanks a lot for your work!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p88026">
				<div class="post-metadata">
					<div class="post-num">Post #324</div>
					<div class="post-author">heji</div>
					<div class="post-datetime">
						15 May 2009, 07:51					</div>
				</div>
				<div class="post-content content">
					<p>root@OpenWrt:/tmp# dd if=wrt350nv2-uImage of=/dev/mtdblock0<br />dd: writing &#039;/dev/mtdblock0&#039;: No space left on device<br />2049+0 records in<br />2048+0 records out</p><p>copy kernel from 0xff800000 to 0x400000 with size 0x200000<br />## Booting image at 00400000 ...<br />&nbsp; &nbsp;Image Name:&nbsp; &nbsp;Linux-2.6.28.10<br />&nbsp; &nbsp;Image Type:&nbsp; &nbsp;ARM Linux Kernel Image (uncompressed)<br />&nbsp; &nbsp;Data Size:&nbsp; &nbsp; 1061680 Bytes =&nbsp; 1 MB<br />&nbsp; &nbsp;Load Address: 00008000<br />&nbsp; &nbsp;Entry Point:&nbsp; 00008000<br />&nbsp; &nbsp;Verifying Checksum ... Bad Data CRC<br />Marvell&gt;&gt;</p><p>How to change the size of mtd0?</p>											<p class="post-edited">(Last edited by <strong>heji</strong> on 15 May 2009, 07:56)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p88156">
				<div class="post-metadata">
					<div class="post-num">Post #325</div>
					<div class="post-author">maddes.b</div>
					<div class="post-datetime">
						17 May 2009, 23:38					</div>
				</div>
				<div class="post-content content">
					<p>The repository at OpenWrt.org is back at <a href="http://downloads.openwrt.org/snapshots/trunk/orion/packages/">http://downloads.openwrt.org/snapshots/ … /packages/</a>.<br />Change/Revision <a href="https://dev.openwrt.org/changeset/15899">15899</a> also added this to opkg.conf.</p>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 13 of 46</div><nav><ul><li><a href="viewtopic.php%3Fid=12358&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=12358&amp;p=11.html">11</a></li><li><a href="viewtopic.php%3Fid=12358&amp;p=12.html">12</a></li><li class="pagination-current"><span>13</span></li><li><a href="viewtopic.php%3Fid=12358&amp;p=14.html">14</a></li><li><a href="viewtopic.php%3Fid=12358&amp;p=15.html">15</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=12358&amp;p=46.html">46</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0.001 -->

</body>
</html>