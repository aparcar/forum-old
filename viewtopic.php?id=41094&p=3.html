<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> WNDRv4 fit for openwrt - english</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 8 Feb 2018 and 2 May 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 3 of 17</div><nav><ul><li><a href="viewtopic.php%3Fid=41094&amp;p=1.html">1</a></li><li><a href="viewtopic.php%3Fid=41094&amp;p=2.html">2</a></li><li class="pagination-current"><span>3</span></li><li><a href="viewtopic.php%3Fid=41094&amp;p=4.html">4</a></li><li><a href="viewtopic.php%3Fid=41094&amp;p=5.html">5</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=41094&amp;p=17.html">17</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p212978">
				<div class="post-metadata">
					<div class="post-num">Post #51</div>
					<div class="post-author">falstaff</div>
					<div class="post-datetime">
						22 Sep 2013, 23:25					</div>
				</div>
				<div class="post-content content">
					<p>@Zsub, hm ,never tried that, but I guess it will do the same as the normal boot: Check the root filesystems CRC. This CRC checksum is currently not implemented in the OpenWRT toolchain. So we would need to add this header first to get it flashed...</p><p>But once you have it flashed, you will meet this other problem: Our kernel can&#039;t read the image which was flashed by U-Boot (and when you use TFTP, you actually flash the Firmware using U-Boot).</p><p>I don&#039;t think I will be able to unbrick my device... Maybe I will do the fastest unbrick method: Buy a new one <img src="https://forum.openwrt.org/img/smilies/hmm.png" width="15" height="15" alt="hmm" /></p><p>But then, I&#039;m not very attracted to do NAND driver hacks. This would need a reliable NAND clean command. This command&nbsp; screwed my (first) router <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><p>@zloop, oh yes, this change looks promising.</p>											<p class="post-edited">(Last edited by <strong>falstaff</strong> on 22 Sep 2013, 23:41)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p213037">
				<div class="post-metadata">
					<div class="post-num">Post #52</div>
					<div class="post-author">falstaff</div>
					<div class="post-datetime">
						23 Sep 2013, 23:38					</div>
				</div>
				<div class="post-content content">
					<p>@Zsub, I created a own repository on my Github account, see <a href="https://github.com/falstaff84/openwrt/tree/wndr4300-ubi">https://github.com/falstaff84/openwrt/tree/wndr4300-ubi</a>. In this branch I changed the Subtarget &quot;nand&quot; to generate UBI/UBIFS image including proper NAND support (including the new HW NAND support) for WNDR4300. I tested the initramfs, I still have some errors with the NAND driver, I wrote also on the mailing list about this...</p>											<p class="post-edited">(Last edited by <strong>falstaff</strong> on 23 Sep 2013, 23:38)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p213060">
				<div class="post-metadata">
					<div class="post-num">Post #53</div>
					<div class="post-author">Zsub</div>
					<div class="post-datetime">
						24 Sep 2013, 10:08					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>falstaff wrote:</cite><blockquote><p>@Zsub, I created a own repository on my Github account, see <a href="https://github.com/falstaff84/openwrt/tree/wndr4300-ubi">https://github.com/falstaff84/openwrt/tree/wndr4300-ubi</a>. In this branch I changed the Subtarget &quot;nand&quot; to generate UBI/UBIFS image including proper NAND support (including the new HW NAND support) for WNDR4300. I tested the initramfs, I still have some errors with the NAND driver, I wrote also on the mailing list about this...</p></blockquote></div><p>OK cool, I&#039;ll have a look at your repo. You obviously are <em>slightly</em> more experienced than I am <img src="https://forum.openwrt.org/img/smilies/tongue.png" width="15" height="15" alt="tongue" /></p><p>Edit: hurr durr. This is not going to work if it is not possible to dd to the flash properly, of course.<br />I think it is a good idea to try Gabor&#039;s test from 17-09-2013, at 08:18. As soon as I get my USB-&gt;3.3v serial I&#039;ll try and do that, I got an email saying they packaged everything, no tracking code yet.</p><div class="quotebox"><cite>Gabor wrote:</cite><blockquote><p>I guess that it would be easy to figure out if the bootloader uses a different<br />OOB layout or not.</p><p>1. Flash an image from U-Boot.<br />2. Boot an initramfs based image, and read the image back via the &#039;nanddump&#039;<br />utility including the OOB data.<br />3. Write the same image to the same partition from the initramfs based kernel.<br />4. Dump it again and check what is the difference in the OOB data between the two.</p></blockquote></div><p>Second edit: I made two small pull requests at your repo.</p>											<p class="post-edited">(Last edited by <strong>Zsub</strong> on 24 Sep 2013, 17:39)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p213344">
				<div class="post-metadata">
					<div class="post-num">Post #54</div>
					<div class="post-author">falstaff</div>
					<div class="post-datetime">
						28 Sep 2013, 03:33					</div>
				</div>
				<div class="post-content content">
					<p>Hi all,</p><p>Thinks looking good right now. I could flash an image using stock U-Boot (factory reset/upgrade using TFTP). The root filesystem is UBIFS on UBI. Theres no overlay right now, so the rootfs is mounted read/write.</p><p>Check this out:<br /><a href="https://github.com/falstaff84/openwrt/tree/wndr4300-ubi">https://github.com/falstaff84/openwrt/tree/wndr4300-ubi</a></p><p>@Zsub, I tried to use the suggested (and I was also sure it was right) logical erase block size (LEB) of 126Kib. But when I tried to flash UBIFS on a in-kernel generated UBI volume, it did not work:<br /></p><div class="codebox"><pre><code>[ 1437.250000] UBIFS error (pid 1170): validate_sb: LEB size mismatch: 129024 in superblock, 126976 real</code></pre></div><p>Therefor I use 124KiB now. However, 126KiB might work when we use ubinize/U-Boot to flash the image, however, I did not tried that.</p><p>Also note that I had to clean the rootfs partition first manually because UBI needs a clean partition!<br /></p><div class="codebox"><pre><code>nand erase 0x7e0000 0x17e0000</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p213851">
				<div class="post-metadata">
					<div class="post-num">Post #55</div>
					<div class="post-author">Zsub</div>
					<div class="post-datetime">
						3 Oct 2013, 21:58					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>falstaff wrote:</cite><blockquote><p>@Zsub, I tried to use the suggested (and I was also sure it was right) logical erase block size (LEB) of 126Kib. But when I tried to flash UBIFS on a in-kernel generated UBI volume, it did not work:<br /></p><div class="codebox"><pre><code>[ 1437.250000] UBIFS error (pid 1170): validate_sb: LEB size mismatch: 129024 in superblock, 126976 real</code></pre></div><p>Therefor I use 124KiB now. However, 126KiB might work when we use ubinize/U-Boot to flash the image, however, I did not tried that.</p></blockquote></div><p>I suddenly realize that the LEB <strong>must</strong> be smaller than the Physical Erase Block because of course UBI uses a little space for the erase counter.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p213940">
				<div class="post-metadata">
					<div class="post-num">Post #56</div>
					<div class="post-author">jolouis</div>
					<div class="post-datetime">
						4 Oct 2013, 22:19					</div>
				</div>
				<div class="post-content content">
					<p>Not sure if it&#039;s relevant/helpful as I&#039;m not an UBI person at all... but straight from the UBI FAQ:<br /><a href="http://www.linux-mtd.infradead.org/faq/ubifs.html#L_lebsz_mismatch">http://www.linux-mtd.infradead.org/faq/ … z_mismatch</a></p><div class="quotebox"><blockquote><p>The error message means that LEB size information which is stored in the UBIFS superblock does not match the real LEB size, which UBIFS takes from UBI. The superblock was created by the mkfs.ubifs utility, therefore you failed to pass the correct LEB size to the utility. Fix this by passing correct LEB size via the -e option.</p></blockquote></div><p>Maybe just a value missing in the UBIFS generation code? There&#039;s also a good section on how to use mtdinfo to validate all of the actual settings needed:<br /><a href="http://www.linux-mtd.infradead.org/faq/ubifs.html#L_mkfubifs">http://www.linux-mtd.infradead.org/faq/ … L_mkfubifs</a></p><p>Again you guys have probably done all of that and are well aware of it, but just wanted to link it in to be safe ;o)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p214873">
				<div class="post-metadata">
					<div class="post-num">Post #57</div>
					<div class="post-author">Zsub</div>
					<div class="post-datetime">
						15 Oct 2013, 19:03					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>jolouis wrote:</cite><blockquote><p>Not sure if it&#039;s relevant/helpful as I&#039;m not an UBI person at all... but straight from the UBI FAQ:<br /><a href="http://www.linux-mtd.infradead.org/faq/ubifs.html#L_lebsz_mismatch">http://www.linux-mtd.infradead.org/faq/ … z_mismatch</a></p><div class="quotebox"><blockquote><p>The error message means that LEB size information which is stored in the UBIFS superblock does not match the real LEB size, which UBIFS takes from UBI. The superblock was created by the mkfs.ubifs utility, therefore you failed to pass the correct LEB size to the utility. Fix this by passing correct LEB size via the -e option.</p></blockquote></div><p>Maybe just a value missing in the UBIFS generation code? There&#039;s also a good section on how to use mtdinfo to validate all of the actual settings needed:<br /><a href="http://www.linux-mtd.infradead.org/faq/ubifs.html#L_mkfubifs">http://www.linux-mtd.infradead.org/faq/ … L_mkfubifs</a></p><p>Again you guys have probably done all of that and are well aware of it, but just wanted to link it in to be safe ;o)</p></blockquote></div><p>Just to be sure I checked it (Falstaff&#039;s image did work though) and here is the output:</p><div class="codebox"><pre><code>root@OpenWrt:/# mtdinfo -u /dev/mtd8
mtd8
Name:                           rootfs
Type:                           nand
Eraseblock size:                131072 bytes, 128.0 KiB
Amount of eraseblocks:          191 (25034752 bytes, 23.9 MiB)
Minimum input/output unit size: 2048 bytes
Sub-page size:                  2048 bytes
OOB size:                       64 bytes
Character device major/minor:   90:16
Bad blocks are allowed:         true
Device is writable:             true
Default UBI VID header offset:  2048
Default UBI data offset:        4096
Default UBI LEB size:           126976 bytes, 124.0 KiB
Maximum UBI volumes count:      128</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p214991">
				<div class="post-metadata">
					<div class="post-num">Post #58</div>
					<div class="post-author">falstaff</div>
					<div class="post-datetime">
						17 Oct 2013, 00:19					</div>
				</div>
				<div class="post-content content">
					<p>@jolouis, yes I&#039;ve seen that.. Its just that the default values when using UBI tools is 124KiB LEB size, and the initial patch of Zsub suggested 126KiB. I altered ubinize.cfg to use 124KiB, then the image can be used even when using the UBI tools to write the image to the NAND...</p><p>@Zsub, I just pushed another commit which should fix the build issue. The problem was that the squashfs image target was called before the UBIFS image was created by image.mk. Since I already had those UBIFS image already on my disk, I didn&#039;t realized that this was a problem. Now the image is generated in the UBI(FS) target. Did the WAN interface works on your router? I noticed once that I don&#039;t have a WAN interface around :-)</p><br /><p>The whole ROM/overlayfs doesn&#039;t work with UBIFS right now since the userspace tools don&#039;t support it.</p><p>I also tried squashfs and jffs2 on UBI, both worked fine. I consider to look into that rather than fix the whole userspace, I think it would be the easier solution for now... The question is, in which target should generate such an image, since its a mix of all of it :-)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p215010">
				<div class="post-metadata">
					<div class="post-num">Post #59</div>
					<div class="post-author">Zsub</div>
					<div class="post-datetime">
						17 Oct 2013, 11:14					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>falstaff wrote:</cite><blockquote><p>@Zsub, I just pushed another commit which should fix the build issue. The problem was that the squashfs image target was called before the UBIFS image was created by image.mk. Since I already had those UBIFS image already on my disk, I didn&#039;t realized that this was a problem. Now the image is generated in the UBI(FS) target.</p></blockquote></div><p>Yeah, I figured that was it, also commented via GitHub <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><div class="quotebox"><cite>falstaff wrote:</cite><blockquote><p>Did the WAN interface works on your router? I noticed once that I don&#039;t have a WAN interface around :-)</p></blockquote></div><p>I haven&#039;t tested yet, I did notice the WAN led is always on, so I was suspicious. By the way, I have to reboot the device once after flashing it to make sure that the switch comes up properly, if I don&#039;t it doesn&#039;t accept any traffic via ethernet, but wifi works.</p><div class="quotebox"><cite>falstaff wrote:</cite><blockquote><p>The whole ROM/overlayfs doesn&#039;t work with UBIFS right now since the userspace tools don&#039;t support it.</p><p>I also tried squashfs and jffs2 on UBI, both worked fine. I consider to look into that rather than fix the whole userspace, I think it would be the easier solution for now... The question is, in which target should generate such an image, since its a mix of all of it :-)</p></blockquote></div><p>A relatively simple way to have both ubi and ROM/overlay could be to pivot_root (<a href="http://wiki.openwrt.org/doc/howto/extroot#duplicate.data2">http://wiki.openwrt.org/doc/howto/extro … cate.data2</a>) onto a R/W partition we create in the reserved space (mtd12) and have rootfs read-only.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p215036">
				<div class="post-metadata">
					<div class="post-num">Post #60</div>
					<div class="post-author">neophyte</div>
					<div class="post-datetime">
						17 Oct 2013, 16:50					</div>
				</div>
				<div class="post-content content">
					<p>I have just bougt a WNDR3700v4, and want to run OpenWRT on it too.</p><p>If there is anything i can do, i would like to help in developing the firmware.<br />Ex. if you want to test the builds or similiar assistance.</p>											<p class="post-edited">(Last edited by <strong>neophyte</strong> on 17 Oct 2013, 16:51)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216488">
				<div class="post-metadata">
					<div class="post-num">Post #61</div>
					<div class="post-author">falstaff</div>
					<div class="post-datetime">
						2 Nov 2013, 01:48					</div>
				</div>
				<div class="post-content content">
					<p>Hi, </p><p>Started to work again on this. I essentially manually rebased the changes on trunk. My old commits moved the nand subtarget first, but since the subtarget nand is nowadays called mikrotik, this is not necessary anymore. But this doesn&#039;t allowed a straight forward rebasing..</p><p>@Zsub, I saw all your changes but when I was at the point looking at them (and pulling them) I already rebased or developed in another direction. But your work and findings are definitely helpful!</p><div class="quotebox"><blockquote><p>A relatively simple way to have both ubi and ROM/overlay could be to pivot_root (<a href="http://wiki.openwrt.org/doc/howto/extroot#duplicate.data2">http://wiki.openwrt.org/doc/howto/extro … cate.data2</a>) onto a R/W partition we create in the reserved space (mtd12) and have rootfs read-only.</p></blockquote></div><p>pivot_root is used by OpenWRT by default. But currently, ubox (the utility which does the magic) and some scripts are coded to create a JFFS2 partition on the device with the name rootfs_data, and uses that as overlay on the ROM (the device which is mounted initially, usually rootfs).</p><br /><p>Things are working again on trunk, and I make use of the profile specific UBI settings introduced by Luka. </p><p>In my new branch called &quot;wndr4300-nand-squashfs&quot; the root MTD partition is now called ubiroot in order to solve autodetection issues (the kernel tried to split the MTD partition called rootfs). The UBI image consists now of two UBI volumes, the first wih a squashfs on it (called rootfs, which can be mounted using GLUEBI, it ends up as /dev/mtdblock12) and the data volume (rootfs_data, UBI, which ends up as /dev/mtdblock13). The layout looks like this now:<br /></p><div class="codebox"><pre><code>dev:    size   erasesize  name
mtd0: 00040000 00020000 &quot;u-boot&quot;
mtd1: 00040000 00020000 &quot;u-boot-env&quot;
mtd2: 00040000 00020000 &quot;caldata&quot;
mtd3: 00080000 00020000 &quot;pot&quot;
mtd4: 00200000 00020000 &quot;language&quot;
mtd5: 00080000 00020000 &quot;config&quot;
mtd6: 00300000 00020000 &quot;traffic_meter&quot;
mtd7: 00120000 00020000 &quot;kernel&quot;
mtd8: 017e0000 00020000 &quot;ubiroot&quot;
mtd9: 01900000 00020000 &quot;firmware&quot;
mtd10: 00040000 00020000 &quot;caldata_backup&quot;
mtd11: 06000000 00020000 &quot;reserved&quot;
mtd12: 0024d000 0001f000 &quot;rootfs&quot;
mtd13: 011ec000 0001f000 &quot;rootfs_data&quot;</code></pre></div><p>The kernel should mount the MTD called rootfs directly, but this doesn&#039;t work, so I pass root=/dev/mtdblock12 to the kernel.</p><p>When starting this image, userspace tools try to format the rootfs_data using jffs2.</p><p>At first, I haven&#039;t compiled this filesystem, so this didn&#039;t succeed:<br /></p><div class="codebox"><pre><code>Thu Jan  1 00:00:18 1970 user.err syslog: No jffs2 marker was found
Thu Jan  1 00:00:18 1970 kern.emerg switch2jffs: No jffs2 marker was found
Thu Jan  1 00:00:18 1970 user.err syslog: no jffs2 marker found
Thu Jan  1 00:00:18 1970 kern.emerg switch2jffs: no jffs2 marker found
Thu Jan  1 00:00:18 1970 user.err syslog: failed - mount -t jffs2 /dev/mtdblock13 /rom/overlay: No such device
Thu Jan  1 00:00:18 1970 kern.emerg switch2jffs: failed - mount -t jffs2 /dev/mtdblock13 /rom/overlay: No such device
Thu Jan  1 00:00:18 1970 kern.emerg setting up led WAN (green)
Thu Jan  1 00:00:18 1970 kern.emerg setting up led USB
Thu Jan  1 00:00:18 1970 kern.emerg - init complete -</code></pre></div><p>The code then falls back to a RAM based rootfs_data, which gets mounted and overlayed. So overlaying works. </p><p>When adding JFFS2 to the kernel configuration, everything works fine, the partition gets formatted and I have persistent storage!</p><p>Well, this should enable all our wishes feature wise, but technically its not a clean solution since we run JFFS2 on UBI, and using the GLUEBI layer which makes the whole a bit unclean.</p><p>Also from the image generation standpoint things are still dirty: Its now required to enable Squashfs and UBIFS as root filesytem since the UBI target is only called when UBIFS is enabled... This certainly needs cleanup.</p><p>In order to have UBIFS as rootfs_data, we would need to extend the ubox utilites (which provide switch2jffs) and some scripts and bring them to format the partition using UBIFS.</p><p>Code: <a href="https://github.com/falstaff84/openwrt/tree/wndr4300-nand-squashfs">https://github.com/falstaff84/openwrt/t … d-squashfs</a></p><p>@neophyte: I can send you an image if you&#039;re ready to take the risk. Flashing only works using factory reset (at least, I tried only that way so far). This worked already several times on my device, but I can not guarantee for anything... (in other words, it might break your device!)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216624">
				<div class="post-metadata">
					<div class="post-num">Post #62</div>
					<div class="post-author">Zsub</div>
					<div class="post-datetime">
						3 Nov 2013, 20:31					</div>
				</div>
				<div class="post-content content">
					<p>I looked over your code, looks pretty ok. I&#039;d suggest to clean up the steps for image generation and separate them further.</p><p>Also, have you seen the kernel size increase? Kufat on IRC noticed that the kernel lmza size was much bigger, especially ubifs takes 138 or something KB in the kernel, and at some point it will not fit in the kernel partition anymore. We can save a lot of space by choosing a single filesystem, I&#039;d guess. Also, for the subtarget we can disable the automatic splitting of rootfs in squashfs and rootfs_data via make kernel_menuconfig.</p><p>Another consideration is that when flashing ubi/ubifs volumes it is preferable to save erase counters. We should use ubiformat or something like that for flashing to preserve them. It would probably be a good idea to get sysupgrade to support that way <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216740">
				<div class="post-metadata">
					<div class="post-num">Post #63</div>
					<div class="post-author">Zsub</div>
					<div class="post-datetime">
						4 Nov 2013, 23:07					</div>
				</div>
				<div class="post-content content">
					<p>As an aside, I&#039;m currently sortakinda merging your (falstaff&#039;s) changes into my fork, but I&#039;m going the UBI(FS) way all the way, disabling other filesystems and splitting of the rootfs and other such stuff and my router currently boots like lightning! It feels like tens of seconds faster during boot, although I&#039;ll have to verify that at some point <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p218069">
				<div class="post-metadata">
					<div class="post-num">Post #64</div>
					<div class="post-author">danielg</div>
					<div class="post-datetime">
						20 Nov 2013, 19:52					</div>
				</div>
				<div class="post-content content">
					<p>Awesome work @Zsub and @falstaff. Is there any update on the progress? I&#039;ve been looking at the git pages. I&#039;d like to try it.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p218080">
				<div class="post-metadata">
					<div class="post-num">Post #65</div>
					<div class="post-author">falstaff</div>
					<div class="post-datetime">
						20 Nov 2013, 22:25					</div>
				</div>
				<div class="post-content content">
					<p>Hi danielg,</p><p>Yes, most work is already upstream. Currently a factory image can be built which you can flash using the webinterface of the stock firmware&nbsp; or the TFTP method.</p><p>The relevant commits were:<br /></p><ul><li><p><a href="https://dev.openwrt.org/changeset/38655">https://dev.openwrt.org/changeset/38655</a></p></li><li><p><a href="https://dev.openwrt.org/changeset/38812">https://dev.openwrt.org/changeset/38812</a></p></li></ul><p> The board is supported in the NAND subtarget of the ar71xx target. You need to manually enable the subtarget since its still marked as broken. You can do this by editing the file target/linux/ar71xx/nand/target.mk and remove &quot;broken&quot; from FEATURES. You get the file &quot;openwrt-ar71xx-nand-wndr4300-ubi-factory.img&quot; in your output folder.</p><p>sysupgrade still doesn&#039;t work. Once you flashed the OpenWRT firmware, you need to use the TFTP Server method. See also <a href="http://wiki.openwrt.org/toh/netgear/wndr3700#how.to.flash.the.firmware.to.device">the WNDR3700 installation description</a> and the <a href="http://wiki.openwrt.org/doc/howto/generic.flashing.tftp#bootloader.contains.tftp.server">generic TFTP installation</a> description.</p><p>--<br />Stefan</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p218175">
				<div class="post-metadata">
					<div class="post-num">Post #66</div>
					<div class="post-author">danielg</div>
					<div class="post-datetime">
						22 Nov 2013, 00:26					</div>
				</div>
				<div class="post-content content">
					<p>Cool! I may be blind, but I tried to svn the bleeding-edge and fetch the git repo of @Zsub, but I cannot seem to find the WNDR4300 profile in menuconfig.</p><p>Edit: Nevermind, found it.</p>											<p class="post-edited">(Last edited by <strong>danielg</strong> on 22 Nov 2013, 02:49)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p218263">
				<div class="post-metadata">
					<div class="post-num">Post #67</div>
					<div class="post-author">checksum</div>
					<div class="post-datetime">
						23 Nov 2013, 12:45					</div>
				</div>
				<div class="post-content content">
					<p>@falstaff<br />I build a firmware from openwrt svn with default options, but WNDR3700 V4 says the firmware is not a valid firmware.<br />Did I need to modify any thing?</p><p>PS: I&#039;m not a developer, just a user.</p><br /><div class="quotebox"><cite>falstaff wrote:</cite><blockquote><p>Hi danielg,</p><p>Yes, most work is already upstream. Currently a factory image can be built which you can flash using the webinterface of the stock firmware&nbsp; or the TFTP method.</p><p>The relevant commits were:<br /></p><ul><li><p><a href="https://dev.openwrt.org/changeset/38655">https://dev.openwrt.org/changeset/38655</a></p></li><li><p><a href="https://dev.openwrt.org/changeset/38812">https://dev.openwrt.org/changeset/38812</a></p></li></ul><p> The board is supported in the NAND subtarget of the ar71xx target. You need to manually enable the subtarget since its still marked as broken. You can do this by editing the file target/linux/ar71xx/nand/target.mk and remove &quot;broken&quot; from FEATURES. You get the file &quot;openwrt-ar71xx-nand-wndr4300-ubi-factory.img&quot; in your output folder.</p><p>sysupgrade still doesn&#039;t work. Once you flashed the OpenWRT firmware, you need to use the TFTP Server method. See also <a href="http://wiki.openwrt.org/toh/netgear/wndr3700#how.to.flash.the.firmware.to.device">the WNDR3700 installation description</a> and the <a href="http://wiki.openwrt.org/doc/howto/generic.flashing.tftp#bootloader.contains.tftp.server">generic TFTP installation</a> description.</p><p>--<br />Stefan</p></blockquote></div>											<p class="post-edited">(Last edited by <strong>checksum</strong> on 24 Nov 2013, 12:27)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p218364">
				<div class="post-metadata">
					<div class="post-num">Post #68</div>
					<div class="post-author">nijhawank</div>
					<div class="post-datetime">
						24 Nov 2013, 21:12					</div>
				</div>
				<div class="post-content content">
					<p>@falstaff</p><p>I want to try out this but before I take the plunge I wanted to confirm that will I be able to revert to Netgear stock from openwrt? I understand that this can only be done from the u-boot TFTP interface. </p><p>Thanks for your wonderful work.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p219008">
				<div class="post-metadata">
					<div class="post-num">Post #69</div>
					<div class="post-author">pjincz</div>
					<div class="post-datetime">
						2 Dec 2013, 09:23					</div>
				</div>
				<div class="post-content content">
					<p>Hi everyone.</p><p>I have checkout @falstaff &#039;s repo: <a href="https://github.com/falstaff84/openwrt">https://github.com/falstaff84/openwrt</a><br />When I build it with: <br /></p><div class="codebox"><pre><code>$ make menuconfig
  Target: Atheros AR7xxx/AR9xxx
  Subtarget: Ar71xx/AR913x based devices with NAND flash
  Target Profile: NETGEAR WNDR4300
$ make V=s</code></pre></div><p>I got following error:<br /></p><div class="codebox"><pre><code>dd: opening &#039;/home/jcz/tmp/openwrt/openwrt/build_dir/target-mips_34kc_uClibc-0.9.33.2/linux-ar71xx_nand/root.ubi&#039;: No such file or directory</code></pre></div><p>Any ideas?</p><p>thks.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p219146">
				<div class="post-metadata">
					<div class="post-num">Post #70</div>
					<div class="post-author">spencer</div>
					<div class="post-datetime">
						4 Dec 2013, 05:29					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>nijhawank wrote:</cite><blockquote><p>@falstaff</p><p>I want to try out this but before I take the plunge I wanted to confirm that will I be able to revert to Netgear stock from openwrt? I understand that this can only be done from the u-boot TFTP interface. </p><p>Thanks for your wonderful work.</p></blockquote></div><p>This procedure worked for me when returning to stock (WNDR4300) from some other *wrt firmware. You may want to test the procedure to give yourself some experience prior to switching (ie: follow the procedure and flash from stock Netgear to stock Netgear as a test of the process).</p><ol class="decimal"><li><p>Manually set your PC&#039;s ip address to 192.168.1.x -- Not 1.</p></li><li><p>Download the current Netgear <a href="http://support.netgear.com/product/wndr4300">firmware</a> for the router.</p></li><li><p>Download the <a href="http://www.shadowsoftware.net/shadowgameworld/downloads/">TFTP2.exe</a> utility and run.</p></li><li><p>Disconnect all network cables except your PC from the router.</p></li><li><p>In the TFTP utility:<br /></p><ol class="alpha"><li><p>Set the SERVER field to: 192.168.1.1</p></li><li><p>Set the PASSWORD field to: password</p></li><li><p>Set the FILE field to: <em>the current Netgear stock firmware file you downloaded earlier</em></p></li></ol></li><li><p>Press and hold the RESET button for 45 seconds, the green will light start blinking</p></li><li><p>Click the UPLOAD button.</p></li><li><p>After the firmware upload completes it will start the reboot cycle, <strong>wait at least 15 minutes</strong>.</p></li><li><p>Unplug the power cable and wait 1 minute.</p></li><li><p>Plug in the power cable.</p></li></ol><p>This is essentially Netgear&#039;s <a href="http://kb.netgear.com/app/answers/detail/a_id/19841">process</a> except that the reset and boot process are different with this model.</p>											<p class="post-edited">(Last edited by <strong>spencer</strong> on 4 Dec 2013, 23:19)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p219308">
				<div class="post-metadata">
					<div class="post-num">Post #71</div>
					<div class="post-author">spacecowboy</div>
					<div class="post-datetime">
						6 Dec 2013, 11:54					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>first thanks for your work to support this device.</p><p>Can someone please give a copy of the .config file for the wndr 4300 v4, or are there any compiled images already out there?<br /> I&#039;m not sure for the correct compile options for the wndr 4300 v4... </p><p>thanks in advance!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p219325">
				<div class="post-metadata">
					<div class="post-num">Post #72</div>
					<div class="post-author">paul.klingelhuber</div>
					<div class="post-datetime">
						6 Dec 2013, 18:50					</div>
				</div>
				<div class="post-content content">
					<p>I would also appreciate any download links for a pre-built image for this device! Thanks</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p220233">
				<div class="post-metadata">
					<div class="post-num">Post #73</div>
					<div class="post-author">Axeia</div>
					<div class="post-datetime">
						17 Dec 2013, 17:58					</div>
				</div>
				<div class="post-content content">
					<p>Don&#039;t want to seem impatient but atm I have a v2 and a v4 and I&#039;ll be giving one away soon. Which one I&#039;m getting rid of depends on on if openwrt will be coming to the v4. As far as I can tell from&nbsp; this topic you guys do actually have a version of openwrt (not the netgear one) up and running and are mainly changing things so they work in the proper (non-hacky) way before the changes are made upstream? If so I&#039;ll keep the v4 because of the more powerful hardware.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p220428">
				<div class="post-metadata">
					<div class="post-num">Post #74</div>
					<div class="post-author">prime_id</div>
					<div class="post-datetime">
						19 Dec 2013, 20:14					</div>
				</div>
				<div class="post-content content">
					<p>I am really looking forward to a fully &quot;working&quot; support. Where is the current build located? is port-based vlan supported?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p221175">
				<div class="post-metadata">
					<div class="post-num">Post #75</div>
					<div class="post-author">TheAsp</div>
					<div class="post-datetime">
						29 Dec 2013, 16:31					</div>
				</div>
				<div class="post-content content">
					<p>I was able to build and upload it to my WNDR4300.&nbsp; The OS loaded and ran perfectly.</p><p>I am having a problem I had on dd-wrt on this router (also on a 3700v4) where I have massive amounts of packet loss over the switch, including the WAN.&nbsp; The stock firmware does not have this problem.&nbsp; I read something in the past that may indicate that the huge netmask my ISP uses (/22) could be the cause.&nbsp; I&#039;d be interested to hear if I am alone with this problem, but this is probably outside the scope of this thread however.</p><p>Update:<br />It looks like the port is going up/down with traffic:<br />root@router:/proc# swconfig dev switch0 port 5 get link<br />port:5 link:up speed:1000baseT full-duplex auto<br />root@router:/proc# swconfig dev switch0 port 5 get link<br />port:5 link:down<br />root@router:/proc# swconfig dev switch0 port 5 get link<br />port:5 link:down<br />root@router:/proc# swconfig dev switch0 port 5 get link<br />port:5 link:up speed:1000baseT full-duplex auto</p>											<p class="post-edited">(Last edited by <strong>TheAsp</strong> on 29 Dec 2013, 19:42)</p>
									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 3 of 17</div><nav><ul><li><a href="viewtopic.php%3Fid=41094&amp;p=1.html">1</a></li><li><a href="viewtopic.php%3Fid=41094&amp;p=2.html">2</a></li><li class="pagination-current"><span>3</span></li><li><a href="viewtopic.php%3Fid=41094&amp;p=4.html">4</a></li><li><a href="viewtopic.php%3Fid=41094&amp;p=5.html">5</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=41094&amp;p=17.html">17</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0.001 -->

</body>
</html>