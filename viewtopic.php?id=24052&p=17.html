<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> WZR-HP-G300NH Support</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 6 Feb 2018 and 3 May 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 17 of 19</div><nav><ul><li><a href="viewtopic.php%3Fid=24052&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=24052&amp;p=15.html">15</a></li><li><a href="viewtopic.php%3Fid=24052&amp;p=16.html">16</a></li><li class="pagination-current"><span>17</span></li><li><a href="viewtopic.php%3Fid=24052&amp;p=18.html">18</a></li><li><a href="viewtopic.php%3Fid=24052&amp;p=19.html">19</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p153476">
				<div class="post-metadata">
					<div class="post-num">Post #401</div>
					<div class="post-author">jetsun</div>
					<div class="post-datetime">
						7 Jan 2012, 13:44					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>snk wrote:</cite><blockquote><div class="quotebox"><cite>slybunda wrote:</cite><blockquote><p>yep if you purchased a router in the EU then its limited to no more than 20dbm EIRP, so for the buffalo you have its max power will be 17dbm + 3dbm antenna gain, so your at eirp limit of 20dbm. only way to bypass this limit is to replace the regulatory domain info file with an edited one that allows more power.</p></blockquote></div><p>No, changing the regulatory.bin does not help, since the limit is in EEPROM. It only enables you to use channels above 11. The driver will always obey the calibrated Tx power limits in the EEPROM regardless of the regulatory domain.</p><p>There are WZR-HP-G300NH&#039;s in the wild with a different programmed limit (21 dBm). In addition, the hardware supposedly has a separate amplifier, which the driver does not know about. Therefore the actual Tx power might be higher.</p></blockquote></div><p>Thank your helpful answer. I understand now.<br />There are regulatory limit and hardware limit. I already replaced the regulatory.bin, the tx power still cannot be set more than 17 dBm because of some hardware limit.</p><p>Even I compile a build of OpenWrt with CONFIG_ATH_USER_REGD=y, the hardware limit still cannot be fixed.<br />Today, I have installed a Ubuntu in VirtualBox and downloaded the source of OpenWrt and made a build. <br />But I have no plan to flash the build, because it will not solve the problem.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p153503">
				<div class="post-metadata">
					<div class="post-num">Post #402</div>
					<div class="post-author">jetsun</div>
					<div class="post-datetime">
						7 Jan 2012, 16:49					</div>
				</div>
				<div class="post-content content">
					<p>Where does the setting of hardware limit for TX power be saved?<br />Is it technically feasible that I overwrite the ART data by using the data from G300NH that has no TX power 17dBm restriction?</p><p>root@OpenWrt:/proc# cat mtd<br />dev:&nbsp; &nbsp; size&nbsp; &nbsp;erasesize&nbsp; name<br />mtd0: 00040000 00020000 &quot;u-boot&quot;<br />mtd1: 00020000 00020000 &quot;u-boot-env&quot;<br />mtd2: 00100000 00020000 &quot;kernel&quot;<br />mtd3: 01e60000 00020000 &quot;rootfs&quot;<br />mtd4: 01ce0000 00020000 &quot;rootfs_data&quot;<br />mtd5: 00020000 00020000 &quot;user_property&quot;<br />mtd6: 00020000 00020000 &quot;art&quot;<br />mtd7: 01f60000 00020000 &quot;firmware&quot;</p><p>root@OpenWrt:/# hexdump -v /dev/mtd6ro </p><p>Following webpage uses dd command to backup the mtd.<br /><a href="http://www.dd-wrt.com/phpBB2/viewtopic.php?p=552159">http://www.dd-wrt.com/phpBB2/viewtopic.php?p=552159</a><br /><a href="https://forum.openwrt.org/viewtopic.php?pid=101427">https://forum.openwrt.org/viewtopic.php?pid=101427</a></p><p>I tried following command to dump the art data to a file, the file size is 128Kbytes.<br />root@OpenWrt:/# dd if=/dev/mtd6ro of=/mnt/mtd6ro_art.bin</p><p>Can anybody provde a dump of your G300NH&#039;s ART?<br />I can compare and try to overwrite my G300NH&#039;s ART.</p>											<p class="post-edited">(Last edited by <strong>jetsun</strong> on 7 Jan 2012, 16:57)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p153509">
				<div class="post-metadata">
					<div class="post-num">Post #403</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						7 Jan 2012, 17:22					</div>
				</div>
				<div class="post-content content">
					<p><a href="http://luci.subsignal.org/~jow/wzr-hp-g300nh-art.bin">http://luci.subsignal.org/~jow/wzr-hp-g300nh-art.bin</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p153555">
				<div class="post-metadata">
					<div class="post-num">Post #404</div>
					<div class="post-author">jetsun</div>
					<div class="post-datetime">
						8 Jan 2012, 06:52					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>jow wrote:</cite><blockquote><p><a href="http://luci.subsignal.org/~jow/wzr-hp-g300nh-art.bin">http://luci.subsignal.org/~jow/wzr-hp-g300nh-art.bin</a></p></blockquote></div><p>Thank you very much for provide the file.</p><p>Unfortunately,it does not work.<br />1.The boot does not continue because of BAD CRC of EEPROM, I need press Ctrl+C in serial console to make it boot.<br />2.The TX Power hardware limit is still 17dBm.</p><p>Maybe my guess is wrong, the hardware limit setting data of TX Power is not in art partition.<br />---------------------------------------<br />In order to write ART by using mtd, I modified some source of openwrt according to following web.<br />Change the art partition writable.<br /><a href="http://wiki.openwrt.org/toh/tp-link/tl-wr1043nd">http://wiki.openwrt.org/toh/tp-link/tl-wr1043nd</a></p><p>root@OpenWrt:~# dd if=/tmp/wzr-hp-g300nh-art.bin of=/dev/mtd6<br />dd: can&#039;t open &#039;/dev/mtd6&#039;: Permission denied</p><p>root@OpenWrt:~# mtd write /tmp/wzr-hp-g300nh-art.bin art<br />Could not open mtd device: art<br />Can&#039;t open device for writing!</p><p>root@OpenWrt:~# mtd unlock art<br />Could not open mtd device: art<br />Could not open mtd device: art<br />-----------------------------------------------------------<br />Following is the steps of replace ART:<br />root@OpenWrt:/# mtd unlock art<br />Unlocking art ...<br />root@OpenWrt:/# cd /tmp<br />root@OpenWrt:/tmp# wget <a href="http://192.168.1.221/wzr-hp-g300nh-art.bin">http://192.168.1.221/wzr-hp-g300nh-art.bin</a><br />Connecting to 192.168.1.221 (192.168.1.221:80)<br />wzr-hp-g300nh-art.bi 100% |*******************************|&nbsp; &nbsp;128k&nbsp; 0:00:00 ETA<br />root@OpenWrt:/tmp# mtd -r write wzr-hp-g300nh-art.bin art<br />Unlocking art ...<br />Writing from wzr-hp-g300nh-art.bin to art ...<br />Rebooting ...</p><p>In the boot,there is some error message in serial console.<br />TftpServer Timeout;<br />no file was loaded.<br />Bad CRC of EEPROM!!<br /> # LED(0x2) Blink[2] (Please press &#039;Ctrl+c&#039; to stop)</p><p>The system can boot after pressing Ctrl+c.<br />In the ssh of OpenWrt, the tx power still cannot be set more than 17dBm.<br />At last, I gave up and have to restore the ART to the original, and the CRC error of EEPROM gone.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p153569">
				<div class="post-metadata">
					<div class="post-num">Post #405</div>
					<div class="post-author">snk</div>
					<div class="post-datetime">
						8 Jan 2012, 13:25					</div>
				</div>
				<div class="post-content content">
					<p>I think that the CRC error is coming from the bootloader instead of OpenWrt, since there is a value buf_crc=5228EE27 (in my router) in u-boot-env. You could try to find out how that is calculated and replace it. My EEPROM is limited to 17 dBm as well, so I guess it&#039;s of no use to you.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p153580">
				<div class="post-metadata">
					<div class="post-num">Post #406</div>
					<div class="post-author">jetsun</div>
					<div class="post-datetime">
						8 Jan 2012, 15:44					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>snk wrote:</cite><blockquote><p>I think that the CRC error is coming from the bootloader instead of OpenWrt, since there is a value buf_crc=5228EE27 (in my router) in u-boot-env. You could try to find out how that is calculated and replace it. My EEPROM is limited to 17 dBm as well, so I guess it&#039;s of no use to you.</p></blockquote></div><p>Yes, the CRC error is from U-boot.</p><p>Following is the env from U-Boot.<br />ar7100&gt; printenv<br />bootargs=console=ttyS0,115200 root=31:03 rootfstype=jffs2 init=/sbin/init mtdpar<br />ts=ar9100-nor0:256k(u-boot),128k(u-boot-env),1024k(uImage),31104k(rootfs),128k@3<br />2640k(ART),128k@32512k(properties)<br />bootcmd=bootm 0xbe060000<br />bootdelay=4<br />baudrate=115200<br />ethaddr=02:AA:BB:CC:DD:1A<br />tmp_ram=81F00000<br />tmp_bottom=83F00000<br />fw_eaddr=BE060000 BFFDFFFF<br />uboot_eaddr=BE000000 BE03FFFF<br />u_fw=erase $fw_eaddr; cp.b $fileaddr BE060000 $filesize; bootm BE060000;<br />ut_fw=tftp $tmp_ram firmware.bin; erase $fw_eaddr; cp.b $fileaddr BE060000 $file<br />size; bootm BE060000;<br />ut_uboot=tftp $tmp_ram u-boot.bin; protect off $uboot_eaddr; erase $uboot_eaddr;<br /> cp.b $fileaddr BE000000 $filesize;<br /><span style="color: #FF0000">melco_id=RD_BB08011</span> <br />uboot_ethaddr=02:AA:BB:CC:DD:1A<br />DEF-p_wireless_ath0_11bg-authmode=psk<br />DEF-p_wireless_ath0_11bg-crypto=tkip+aes<br />DEF-p_wireless_ath0_11bg-authmode_ex=mixed-psk<br /><span style="color: #FF0000">buf_ver=1.07</span> <br />build_date=Dec 21 2009 - 10:37:11<br /><span style="color: #FF0000">buf_crc=420F2B9B</span> <br />hw_rev=0<br />pincode=*********<br />custom_id=0<br />DEF-p_wireless_ath0_11bg-wpapsk=********<br />accept_open_rt_fmt=1<br />filesize=149f0fc<br />fileaddr=81F00000<br />ipaddr=192.168.11.1<br />serverip=192.168.11.2<br />region=AP<br />tftp_wait=4<br />stdin=serial<br />stdout=serial<br />stderr=serial<br />loadaddr=81F00000<br />ethact=eth0</p><p>Environment size: 1176/131068 bytes<br />ar7100&gt; setenv region US<br />ar7100&gt; saveenv<br />Saving Environment to Flash...<br />Protect off BE040000 ... BE05FFFF<br />Un-Protecting sectors 2..2 in bank 1<br />Un-Protected 1 sectors<br />Erasing Flash...Erase Flash from 0xbe040000 to 0xbe05ffff in Bank # 1 First 0x2<br />last 0x2<br /> 100%<br />Erased 1 sectors<br />Writing to Flash...<br /> 100%<br />done<br />Protecting sectors 2..2 in bank 1<br />Protected 1 sectors<br />ar7100&gt;</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p154356">
				<div class="post-metadata">
					<div class="post-num">Post #407</div>
					<div class="post-author">thenextdon13</div>
					<div class="post-datetime">
						16 Jan 2012, 10:32					</div>
				</div>
				<div class="post-content content">
					<p>The most recent trunk (as of 15 January 2012) appears to break the LAN Vlan for V1 hardware.</p><p>Please see <a href="https://dev.openwrt.org/ticket/10793">https://dev.openwrt.org/ticket/10793</a> for more details.</p><p>After tftp flash, WAN comes up as expected (can see it pick up a dhcp lease from another server).&nbsp; LAN does not provide dhcp services, and default ip is not pingable from any LAN port.</p><p>When sysupgrading from backfire, password settings seem to be lost as well.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p161941">
				<div class="post-metadata">
					<div class="post-num">Post #408</div>
					<div class="post-author">aorth</div>
					<div class="post-datetime">
						23 Mar 2012, 20:13					</div>
				</div>
				<div class="post-content content">
					<p>The last few snapshots (in February and March) I tried all refused to boot on my A2 A0 model.&nbsp; Has anyone flashed recent snapshots successfully on this hardware?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p161945">
				<div class="post-metadata">
					<div class="post-num">Post #409</div>
					<div class="post-author">loopy123</div>
					<div class="post-datetime">
						23 Mar 2012, 20:40					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>aorth wrote:</cite><blockquote><p>The last few snapshots (in February and March) I tried all refused to boot on my A2 A0 model.&nbsp; Has anyone flashed recent snapshots successfully on this hardware?</p></blockquote></div><p>Not a recent snapshot, but the following has been working great (and stable) since January:</p><p>Buffalo WZR-HP-G300NH</p><p>Firmware Version: <br />OpenWrt Firmware Attitude Adjustment (r29561) / LuCI Trunk (trunk+svn8105)</p><p>Also noticed approx 15% increase in wifi range over the DD-WRT (2011-12-20 r18024).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p163312">
				<div class="post-metadata">
					<div class="post-num">Post #410</div>
					<div class="post-author">aorth</div>
					<div class="post-datetime">
						4 Apr 2012, 20:30					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>loopy123 wrote:</cite><blockquote><div class="quotebox"><cite>aorth wrote:</cite><blockquote><p>The last few snapshots (in February and March) I tried all refused to boot on my A2 A0 model.&nbsp; Has anyone flashed recent snapshots successfully on this hardware?</p></blockquote></div><p>Not a recent snapshot, but the following has been working great (and stable) since January:</p><p>Buffalo WZR-HP-G300NH</p><p>Firmware Version: <br />OpenWrt Firmware Attitude Adjustment (r29561) / LuCI Trunk (trunk+svn8105)</p><p>Also noticed approx 15% increase in wifi range over the DD-WRT (2011-12-20 r18024).</p></blockquote></div><p>Is yours an A2 AO?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p163314">
				<div class="post-metadata">
					<div class="post-num">Post #411</div>
					<div class="post-author">loopy123</div>
					<div class="post-datetime">
						4 Apr 2012, 20:37					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>aorth wrote:</cite><blockquote><div class="quotebox"><cite>loopy123 wrote:</cite><blockquote><div class="quotebox"><cite>aorth wrote:</cite><blockquote><p>The last few snapshots (in February and March) I tried all refused to boot on my A2 A0 model.&nbsp; Has anyone flashed recent snapshots successfully on this hardware?</p></blockquote></div><p>Not a recent snapshot, but the following has been working great (and stable) since January:</p><p>Buffalo WZR-HP-G300NH</p><p>Firmware Version: <br />OpenWrt Firmware Attitude Adjustment (r29561) / LuCI Trunk (trunk+svn8105)</p><p>Also noticed approx 15% increase in wifi range over the DD-WRT (2011-12-20 r18024).</p></blockquote></div><p>Is yours an A2 AO?</p></blockquote></div><p>Yes - A2 A0.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p163436">
				<div class="post-metadata">
					<div class="post-num">Post #412</div>
					<div class="post-author">Connor1</div>
					<div class="post-datetime">
						5 Apr 2012, 23:49					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>loopy123 wrote:</cite><blockquote><p>Not a recent snapshot, but the following has been working great (and stable) since January:</p><p>Buffalo WZR-HP-G300NH</p><p>Firmware Version: <br />OpenWrt Firmware Attitude Adjustment (r29561) / LuCI Trunk (trunk+svn8105)</p><p>Also noticed approx 15% increase in wifi range over the DD-WRT (2011-12-20 r18024).</p></blockquote></div><p>Do you know where I can find the Openwrt firmware r29561? </p><p>Thanks,<br />C.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p163437">
				<div class="post-metadata">
					<div class="post-num">Post #413</div>
					<div class="post-author">loopy123</div>
					<div class="post-datetime">
						6 Apr 2012, 00:04					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Connor1 wrote:</cite><blockquote><div class="quotebox"><cite>loopy123 wrote:</cite><blockquote><p>Not a recent snapshot, but the following has been working great (and stable) since January:</p><p>Buffalo WZR-HP-G300NH</p><p>Firmware Version: <br />OpenWrt Firmware Attitude Adjustment (r29561) / LuCI Trunk (trunk+svn8105)</p><p>Also noticed approx 15% increase in wifi range over the DD-WRT (2011-12-20 r18024).</p></blockquote></div><p>Do you know where I can find the Openwrt firmware r29561? </p><p>Thanks,<br />C.</p></blockquote></div><p>The version I used was found in this thread posted by bcmalloy (mediafire links): <br /><a href="https://forum.openwrt.org/viewtopic.php?pid=151422#p151422">https://forum.openwrt.org/viewtopic.php … 22#p151422</a></p>											<p class="post-edited">(Last edited by <strong>loopy123</strong> on 6 Apr 2012, 00:07)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p163495">
				<div class="post-metadata">
					<div class="post-num">Post #414</div>
					<div class="post-author">Okneun</div>
					<div class="post-datetime">
						6 Apr 2012, 14:18					</div>
				</div>
				<div class="post-content content">
					<p>New to open-WRT, forgive me.</p><p>I&#039;m trying to change some of the environment variables in &quot;u-boot-env&quot; on my new Buffalo WZR-HP-G300NH version 1. I&#039;ve installed the package uboot-env and configured fw_env.config as below.</p><div class="codebox"><pre><code># MTD device name    Device offset    Env. size    Flash sector size    Number of sectors
/dev/mtd1                0x0000        0x20000</code></pre></div><p>As I understand it (apparently incorrectly) I should now have access to the commands fw_printenv, fw_setenv, fw_saveenv. Unfortunately only fw_printenv is available.</p><div class="codebox"><pre><code>root@OpenWrt:~# ls /usr/sbin
brctl             hostapd           iwlist            uhttpd
chroot            iptables          iwpriv            upnpd
crond             iptables-restore  ntpd              wpa_supplicant
dnsmasq           iptables-save     pppd              wpad
dropbear          iw                px5g
fw_printenv       iwconfig          telnetd
root@OpenWrt:~# 
root@OpenWrt:~# fw_printenv
bootargs=console=ttyS0,115200 root=31:03 rootfstype=jffs2 init=/sbin/init mtdparts=ar9100-nor0:256k(u-boot),128k(u-boot-env),1024k(uImage),31104k(rootfs),128k@32640k(ART),128k@32512k(properties)
bootcmd=bootm 0xbe060000
bootdelay=4
baudrate=115200
ethaddr=02:AA:BB:CC:DD:1A
ipaddr=192.168.11.1
serverip=192.168.11.2
tmp_ram=81F00000
tmp_bottom=83F00000
fw_eaddr=BE060000 BFFDFFFF
uboot_eaddr=BE000000 BE03FFFF
u_fw=erase $fw_eaddr; cp.b $fileaddr BE060000 $filesize; bootm BE060000;
ut_fw=tftp $tmp_ram firmware.bin; erase $fw_eaddr; cp.b $fileaddr BE060000 $filesize; bootm BE060000;
ut_uboot=tftp $tmp_ram u-boot.bin; protect off $uboot_eaddr; erase $uboot_eaddr; cp.b $fileaddr BE000000 $filesize;
melco_id=RD_BB08011
tftp_wait=4
uboot_ethaddr=02:AA:BB:CC:DD:1A
DEF-p_wireless_ath0_11bg-authmode=psk
DEF-p_wireless_ath0_11bg-crypto=tkip+aes
DEF-p_wireless_ath0_11bg-authmode_ex=mixed-psk
buf_ver=1.07
build_date=Dec 21 2009 - 10:37:11
buf_crc=38EA54F9
hw_rev=0
pincode=40881096
custom_id=0
DEF-p_wireless_ath0_11bg-wpapsk=c8uu0jymxks97
region=EU
accept_open_rt_fmt=1
root@OpenWrt:~# fw_setenv
-ash: fw_setenv: not found</code></pre></div><p>Where is fw_setenv? Do I need to make the mtd1 writeable first and if so how do I do that?</p><p>I&#039;m using firmware version Attitude Adjustment (r30919) / LuCI Trunk (trunk+svn8349). Should I flash an older build? Maybe 10.03?</p><p>Any help will be greatly appreciated. Thanks</p>											<p class="post-edited">(Last edited by <strong>Okneun</strong> on 6 Apr 2012, 14:20)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p163531">
				<div class="post-metadata">
					<div class="post-num">Post #415</div>
					<div class="post-author">aorth</div>
					<div class="post-datetime">
						6 Apr 2012, 21:24					</div>
				</div>
				<div class="post-content content">
					<p>I just noticed that Gargoyle 1.5.4 was recently released and its notes specifically states:</p><p>&quot;Bumps OpenWrt version to latest Backfire version for latest wireless fixes and support of multiple switch models in Buffalo WZR-HP-G300NH routers&quot;</p><p>My A2 A0 is running great on this build (I had tried 1.5.3 and it didn&#039;t work).&nbsp; btw, Gargoyle 1.5.4 corresponds with OpenWRT revision r30752.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p164857">
				<div class="post-metadata">
					<div class="post-num">Post #416</div>
					<div class="post-author">LizardMan</div>
					<div class="post-datetime">
						18 Apr 2012, 09:02					</div>
				</div>
				<div class="post-content content">
					<p>How do I install this firmware?&nbsp; My unit is at least a year old.&nbsp; It&#039;s been all but useless, N wireless drops or locks up.&nbsp; Their locked down firmware loader is extremely annoying.&nbsp; I will never purchase another Buffalo product.&nbsp; A shame, because I&#039;ve used and instructed many others to purchase their older routers.&nbsp; This unit, their firmware bugs and locked down FW process makes it useless.</p><p>I&#039;ve tried using tftp, without it ever responding.&nbsp; It responds to DD-WRT .enc files from Buffalo&#039;s site.&nbsp; I&#039;ve used this process several times after failed attempts to use the mtd flashing method.&nbsp; It&#039;s clear their tftp flashing process responds only to .enc files.</p><p>I&#039;ve tried using mtd from within Buffalo&#039;s DD-WRT software using squashfs and jffs files.&nbsp; In both cases, the mtd command shows it erasing and writing blocks, it drops my ssh connection and reboots.&nbsp; However, it never actually boots.&nbsp; Instead the diag LED lights up solid.&nbsp; I&#039;ve waited an hour for it to reset and reformat itself.&nbsp; The diag LED remains solid, even if power cycled after an hour.</p><p>I&#039;d turn off the uboot enc format requirement, but Buffalo&#039;s DD-WRT firmware doesn&#039;t include a uboot env tool.</p><p>Nothing works.&nbsp; Their firmware isn&#039;t stable (N connectivity) and doesn&#039;t use jffs in a sane manner.&nbsp; I also don&#039;t understand or wish to use the old style NVRAM based admin.&nbsp; The current OpenWrt jffs overlay appears to be easy to use, but I can not figure out how to load it.</p><p>Buffalo&#039;s DD-WRT indicates my unit uses the rb style LAN hardware.&nbsp; The tag on the side of the unit contains &quot;A2 F0B&quot;.</p><p>I returned my first unit to Buffalo (RMA) due to the constant dropping of N wireless connections.&nbsp; I received this unit as a replacement, it doesn&#039;t work any better.&nbsp; After years of using and helping others use their WHR-HP-G54 product this product is a complete train wreak.&nbsp; It has never worked correctly.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p164994">
				<div class="post-metadata">
					<div class="post-num">Post #417</div>
					<div class="post-author">baar</div>
					<div class="post-datetime">
						19 Apr 2012, 01:08					</div>
				</div>
				<div class="post-content content">
					<p>LizardMan--the instructions at <a href="http://wiki.openwrt.org/toh/buffalo/wzr-hp-g300h">http://wiki.openwrt.org/toh/buffalo/wzr-hp-g300h</a> in the &#039;OEM installation using the TFTP method&#039; section will work if your device is not otherwise damaged.&nbsp; One thing I&#039;m not sure of is which MAC address you should set with the arp command.&nbsp; On the few occasions I&#039;ve actually tftp&#039;d an image to my G300H, I&#039;ve had to try a few different things.&nbsp; I believe I use the SSID on the label.&nbsp; Also, not sure about the A2 F0B, but I&#039;ve got the A2 A0 and I need to use trunk that I get at <a href="http://downloads.openwrt.org/snapshots/trunk/ar71xx/">http://downloads.openwrt.org/snapshots/trunk/ar71xx/</a>.&nbsp; The A2 A0 has the rtl8366rb switch so Backfire doesn&#039;t work.</p><p>If you think your device is physically ok, I&#039;d definitely take the time screwing around with tftp to get OpenWRT on it.&nbsp; Mine works great, and once you&#039;ve got it going, you can use sysupgrade images to do subsequent updates.&nbsp; I install luci and load the .bin right through the web interface.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p165006">
				<div class="post-metadata">
					<div class="post-num">Post #418</div>
					<div class="post-author">LizardMan</div>
					<div class="post-datetime">
						19 Apr 2012, 03:15					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>baar wrote:</cite><blockquote><p>LizardMan--the instructions at <a href="http://wiki.openwrt.org/toh/buffalo/wzr-hp-g300h">http://wiki.openwrt.org/toh/buffalo/wzr-hp-g300h</a> in the &#039;OEM installation using the TFTP method&#039; section will work if your device is not otherwise damaged.&nbsp; One thing I&#039;m not sure of is which MAC address you should set with the arp command.&nbsp; On the few occasions I&#039;ve actually tftp&#039;d an image to my G300H, I&#039;ve had to try a few different things.&nbsp; I believe I use the SSID on the label.&nbsp; Also, not sure about the A2 F0B, but I&#039;ve got the A2 A0 and I need to use trunk that I get at <a href="http://downloads.openwrt.org/snapshots/trunk/ar71xx/">http://downloads.openwrt.org/snapshots/trunk/ar71xx/</a>.&nbsp; The A2 A0 has the rtl8366rb switch so Backfire doesn&#039;t work.</p><p>If you think your device is physically ok, I&#039;d definitely take the time screwing around with tftp to get OpenWRT on it.&nbsp; Mine works great, and once you&#039;ve got it going, you can use sysupgrade images to do subsequent updates.&nbsp; I install luci and load the .bin right through the web interface.</p></blockquote></div><p>The latest official Buffalo DD-WRT loads fine using tftp.&nbsp; The kernel probes show this unit uses the rb style LAN switch hardware.&nbsp; However, the 10.03.1 FW should support it.&nbsp; I just can&#039;t find a way to load it.&nbsp; Buffalo seems to have locked down these A2 F0B units.&nbsp; It rejects all attempts to use anything but their .enc files.</p><p>I&#039;ve tried the tftp method:</p><p>Set static arp for the MAC used by the uboot firmware<br />Set computer IP addr to 192.168.11.2<br />Power up router<br />Send FW using tftp in binary mode</p><p>If I use the 15MB *.enc FW file from the Buffalo site (latest Alpha code on their site) it works fine.&nbsp; I&#039;ve flashed using this method several times.&nbsp; It&#039;s the only way to recover from attempts to use the mtd flash update method.</p><p>If I use a 3 to 4 MB OpenWrt squashfs or jffs file the router never responds to tftp write request probes.&nbsp; It just sits there.&nbsp; It ignores tftp, unless it&#039;s a .enc file.&nbsp; If I understand the last 16 pages of this thread correctly, this is because the uboot FW checks for the a header in the enc file.&nbsp; I could turn that check off, if I had access to the uboot env tool, but it&#039;s not included in the DD-WRT version (.enc file) available from the Buffalo site.&nbsp; Chicken and egg problem.</p><br /><p>Method two:<br />Load the Buffalo .enc DD-WRT FW<br />Transfer a copy of sysupgrade OpenWrt to /tmp on router<br />Write file to flash using the mtd command as shown on the OpenWrt site for this router<br />&quot;mtd -r write OpenWrt-firmware-file linux&#039;<br />Wait while new FW is written and router reboots.</p><p>I&#039;ve tried this many times.&nbsp; It seems to work, except the router reboots to a Diag LED on solid and never turns off.&nbsp; I&#039;ve waited an hour for it initialize and reformat jffs, but nothing happens.&nbsp; It just sits there with the green LED on (power symbol), red diag LED on, and an LED at the bottom (blue?).</p><p>After 30min to 60min I&#039;ve power cycled it, it goes back in to the same diag LED solid state.&nbsp; The only way to recover is use the official Buffalo .enc DD-WRT image with tftp.&nbsp; This works every time.&nbsp; I&#039;ve used the tftp transfer method with their FW file many times.&nbsp; It&#039;s rock solid, but only if I use their file.</p><p>I don&#039;t want to use DD-WRT on this router.&nbsp; I&#039;ve used DD-WRT for years on many routers (WRT-54GS, WRT-54G and WHR-HP-G54).&nbsp; However, I&#039;ve never found a version of DD-WRT that is stable on this router in N mode, never.&nbsp; It locks up and/or drops wireless clients.</p><p>I&#039;ve used DD-WRT for years.&nbsp; It&#039;s not in current development, and attempts to use the large flash space in this router with ipkg (no opkg) fail with a file system R/O error.&nbsp; I find the endless mass of NVRAM variables admin process a mess.&nbsp; The OpenWrt overlay file system is nice!</p><p>I&#039;m moving away from DD-WRT in general.&nbsp; I&#039;ve loaded OpenWrt on WHR-HP-G54 units, it works but leaves little flash/jffs space for loading additional programs (IPv6 tunnels, IPv6 utils and VPN code).&nbsp; This router has far more flash and RAM, but I haven&#039;t found a way to load OpenWrt on it, because Buffalo locked uboot down to prevent loading and/or using it.</p><p>I don&#039;t understand why the mtd method doesn&#039;t work.&nbsp; I&#039;ve tried it several times with both squashfs and jffs files.&nbsp; I found a slightly different mtd command on another board (adds -e linux), it erases the linux FW area first, before writing.&nbsp; Using either mtd method the diag LED comes on solid and the router never reboots.&nbsp; It&#039;s like the uboot code looks for a signature in the linux area before jumping to it, and only the Buffalo blessed FW images have this signature.&nbsp; Their FW files are much larger.&nbsp; Maybe they use a large file to initialize and write a signature across the entire flash area, a signature their uboot code looks for, before it jumps to the FW in flash.</p><p>This product has never worked correctly.&nbsp; From day 0 it has dropped or locked up if setup in N mode.&nbsp; The latest Buffalo DD-WRT FW works if I disable N mode.&nbsp; However, it&#039;s an N router and that FW will not allow me to load additional tools.&nbsp; I purchased this unit for N, its large flash and RAM for progs/utils and gigabit interfaces.&nbsp; Only the gigabit interfaces actually work, N doesn&#039;t and the extra flash space is useless with their DD-WRT.</p><p>I sent my first unit back to Buffalo (RMA) because it locked hard (unresponsive even on the wired interfaces) if in N mode.&nbsp; They sent this replacement a long time ago.&nbsp; It too locked up in N mode, so I ran DD-WRT in G mode.&nbsp; A few weeks ago I loaded their latest alpha version, which works a bit better, but drops N connections.&nbsp; It doesn&#039;t completely lock up, but it&#039;s not stable in N mode either.</p><p>I need to find a way to break out of Buffalo&#039;s locked down uboot code.&nbsp; It rejects all tftp transfers that aren&#039;t .enc files and rejects non Buffalo FW written to flash with mtd.</p><p>Why?&nbsp; This will only drive people to stop purchasing their products.&nbsp; It&#039;s not like their FW actually works.&nbsp; This unit has been a major pain from day one, and has never worked correctly.&nbsp; Their WHR-HP-G54 units worked so well.&nbsp; I have several of them and helped people use DD-WRT on them for years.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p165010">
				<div class="post-metadata">
					<div class="post-num">Post #419</div>
					<div class="post-author">baar</div>
					<div class="post-datetime">
						19 Apr 2012, 04:09					</div>
				</div>
				<div class="post-content content">
					<p>LizardMan, sorry I missed your comment before about the particular hardware revision that you have being locked.&nbsp; Maybe someone else will have some suggestions.&nbsp; As for 10.03.1 supporting the rtl8366rb switch, I&#039;m not so sure.&nbsp; Something in the release notes for one of the 10.03.1 release candidates made me think it would, but it never worked for me.&nbsp; A build of Attitude Adjustment from the link I included above worked after the first successful tftp.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p165014">
				<div class="post-metadata">
					<div class="post-num">Post #420</div>
					<div class="post-author">LizardMan</div>
					<div class="post-datetime">
						19 Apr 2012, 04:52					</div>
				</div>
				<div class="post-content content">
					<p>Does anyone have a copy of the uboot env update tool I could run under Buffalo&#039;s blessed DD-WRT to turn off the uboot locks?&nbsp; Previous posts seem to indicate it&#039;s possible to change a few variables to disable tftp .enc checks and extend the tftp time-out window.</p><p>Does anyone know if their uboot code looks for a signature in the linux flash area before jumping to that code while booting?&nbsp; If so, I&#039;d need to turn that check off as well.&nbsp; I&#039;ve repeatedly tried using the mtd flashing method within Buffalo&#039;s DD-WRT without any success.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p165025">
				<div class="post-metadata">
					<div class="post-num">Post #421</div>
					<div class="post-author">LizardMan</div>
					<div class="post-datetime">
						19 Apr 2012, 06:30					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m stunned.&nbsp; My 300NH has sat for hours with a solid red LED after another attempt at the mtd flash method early this morning.&nbsp; I started to reflash Buffalo&#039;s DD-WRT using tftp when I remembered I&#039;d downloaded gargoyle.&nbsp; It would only take a few minutes to try it.&nbsp; I wasn&#039;t expecting it to accept the gargoyle FW, but tried it anyway.</p><p>Gargoyle loaded using tftp on the first attempt.&nbsp; It just worked.&nbsp; I used the exactly the same process, including computer and cables I used trying to load various OpenWrt files.&nbsp; I was shocked when tftp started transferring.&nbsp; Then the diag LED started blinking, rather than remaining on steady.</p><p>I&#039;m using gargoyle to connect to the Net to post this.&nbsp; It&#039;s in N mode, but hasn&#039;t run long enough to determine how stable it is yet.</p><p>I didn&#039;t find a uboot env tool in gargoyle either.</p>											<p class="post-edited">(Last edited by <strong>LizardMan</strong> on 19 Apr 2012, 06:31)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p165058">
				<div class="post-metadata">
					<div class="post-num">Post #422</div>
					<div class="post-author">slybunda</div>
					<div class="post-datetime">
						19 Apr 2012, 12:37					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>jetsun wrote:</cite><blockquote><p>Thank your helpful answer. I understand now.<br />There are regulatory limit and hardware limit. I already replaced the regulatory.bin, the tx power still cannot be set more than 17 dBm because of some hardware limit.</p><p>Even I compile a build of OpenWrt with CONFIG_ATH_USER_REGD=y, the hardware limit still cannot be fixed.<br />Today, I have installed a Ubuntu in VirtualBox and downloaded the source of OpenWrt and made a build. <br />But I have no plan to flash the build, because it will not solve the problem.</p></blockquote></div><p>if you bought your router in the EU then its locked to EU regulatory domain, so it cannot exceed the 20dbm eirp, so thats 17dbm power + antenna gain to stay within regulations.</p><p>the restriction is not in the firmware, thats why the firmware builds for both EU and USA routers are the same. the restriction is in ROM (READ ONLY MEMORY) which has the region code burned in it and cannot be changed since its read only.</p><p>some preliminary testing seems to indicate that its not rom based region lockout, but from the factory, the amplifiers are disabled from factory limiting max output to 17dbm.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p165181">
				<div class="post-metadata">
					<div class="post-num">Post #423</div>
					<div class="post-author">LizardMan</div>
					<div class="post-datetime">
						20 Apr 2012, 09:59					</div>
				</div>
				<div class="post-content content">
					<p>After over 24 hours of continuous use (streaming data) in N mode gargoyle hasn&#039;t dropped or locked up.&nbsp; No other FW has ever worked this well.&nbsp; A single error message related to the N drop/lockup problem was logged, just one.</p><p>The latest Buffalo blessed DD-WRT generated streams of them, plus dropped clients.&nbsp; Previous versions, both from Buffalo&#039;s site and DD-WRT locked up within minutes, or a best an hour or two.</p><p>The error is:<br />ath: DMA failed to stop in 10 ms AR_CR=0x00000024 AR_DIAG_SW=0x42000020 DMADBG_7=0x000286c0<br />ath: Could not stop RX, we could be confusing the DMA engine when we start RX up</p><p>Any idea what causes this error message?&nbsp; HW bug, or driver issue?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p165263">
				<div class="post-metadata">
					<div class="post-num">Post #424</div>
					<div class="post-author">LizardMan</div>
					<div class="post-datetime">
						20 Apr 2012, 22:17					</div>
				</div>
				<div class="post-content content">
					<p>Posted too soon.&nbsp; Two hours ago it dropped the client.</p><p>The client logged errors stating no response from AP.</p><p>After several attempts it finally was able to reconnect to the 300NH, without rebooting either end.<br />On the 300NH I found only one error was in the log from before the drop.&nbsp; No new errors were logged during the event that caused the client to drop.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p165292">
				<div class="post-metadata">
					<div class="post-num">Post #425</div>
					<div class="post-author">LizardMan</div>
					<div class="post-datetime">
						21 Apr 2012, 06:12					</div>
				</div>
				<div class="post-content content">
					<p>Another client drop.</p><p>Logged on the client:<br />No probe response from AP 00:24:a5:XX:XX:XX after 500ms, disconnecting.</p><p>Logged on 300HN:<br />ath: Failed to stop TX DMA, queues=0x004!<br />ath: DMA failed to stop in 10 ms AR_CR=0x00000024 AR_DIAG_SW=0x42000020 DMADBG_7=0x00006020<br />ath: Could not stop RX, we could be confusing the DMA engine when we start RX up<br />ath: DMA failed to stop in 10 ms AR_CR=0x00000024 AR_DIAG_SW=0x42000020 DMADBG_7=0x00006020<br />ath: Could not stop RX, we could be confusing the DMA engine when we start RX up<br />ath: DMA failed to stop in 10 ms AR_CR=0x00000024 AR_DIAG_SW=0x42000020 DMADBG_7=0x00026020<br />ath: Could not stop RX, we could be confusing the DMA engine when we start RX up<br />ath: DMA failed to stop in 10 ms AR_CR=0x00000024 AR_DIAG_SW=0x42000020 DMADBG_7=0x00006020<br />ath: Could not stop RX, we could be confusing the DMA engine when we start RX up<br />ath: DMA failed to stop in 10 ms AR_CR=0x00000024 AR_DIAG_SW=0x42000020 DMADBG_7=0x00006020<br />ath: Could not stop RX, we could be confusing the DMA engine when we start RX up</p><p>This time a very log string of these messages.</p>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 17 of 19</div><nav><ul><li><a href="viewtopic.php%3Fid=24052&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=24052&amp;p=15.html">15</a></li><li><a href="viewtopic.php%3Fid=24052&amp;p=16.html">16</a></li><li class="pagination-current"><span>17</span></li><li><a href="viewtopic.php%3Fid=24052&amp;p=18.html">18</a></li><li><a href="viewtopic.php%3Fid=24052&amp;p=19.html">19</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>