<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> mwan3; multi-wan policy routing (general topic)</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 22 May 2013 and 6 May 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 5 of 65</div><nav><ul><li><a href="viewtopic.php%3Fid=39052&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=3.html">3</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=4.html">4</a></li><li class="pagination-current"><span>5</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=6.html">6</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=7.html">7</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=65.html">65</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p191651">
				<div class="post-metadata">
					<div class="post-num">Post #101</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						11 Feb 2013, 11:23					</div>
				</div>
				<div class="post-content content">
					<p>Hi swoofz,</p><p>Could you paste me your complete open-vpn and network config please? Not just a snippet. Thnx!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p191699">
				<div class="post-metadata">
					<div class="post-num">Post #102</div>
					<div class="post-author">swoofz</div>
					<div class="post-datetime">
						11 Feb 2013, 18:12					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><p>Hi swoofz,</p><p>Could you paste me your complete open-vpn and network config please? Not just a snippet. Thnx!</p></blockquote></div><p>Hi Adze,</p><p>Here&#039;s the complete configs :</p><div class="codebox"><pre><code>root@OpenWrt:~# cat /etc/config/network

config interface &#039;loopback&#039;
        option ifname &#039;lo&#039;
        option proto &#039;static&#039;
        option ipaddr &#039;127.0.0.1&#039;
        option netmask &#039;255.0.0.0&#039;

config interface &#039;lan&#039;
        option type &#039;bridge&#039;
        option proto &#039;static&#039;
        option netmask &#039;255.255.255.0&#039;
        option ipaddr &#039;192.168.0.1&#039;
        option gateway &#039;192.168.0.1&#039;
        option stp &#039;1&#039;
        option metric &#039;10&#039;
        option ifname &#039;eth0&#039;

config switch
        option name &#039;eth0&#039;
        option enable_vlan &#039;1&#039;

config switch_vlan
        option device &#039;eth0&#039;
        option vlan &#039;1&#039;
        option ports &#039;0 1 2 3 4&#039;

config interface &#039;WAN&#039;
        option proto &#039;dhcp&#039;
        option ifname &#039;eth1&#039;
        option metric &#039;20&#039;

config interface &#039;VPN&#039;
        option proto &#039;none&#039;
        option ifname &#039;tun0&#039;
        option defaultroute &#039;0&#039;
        option peerdns &#039;0&#039;
        option auto &#039;1&#039;
        option metric &#039;30&#039;</code></pre></div><div class="codebox"><pre><code>root@OpenWrt:~# cat /etc/config/openvpn

config openvpn &#039;pia_tun&#039;
        option nobind &#039;1&#039;
        option float &#039;1&#039;
        option client &#039;1&#039;
        option comp_lzo &#039;1&#039;
        option reneg_sec &#039;0&#039;
        option dev &#039;tun&#039;
        option persist_tun &#039;1&#039;
        option persist_key &#039;1&#039;
        option remote_cert_tls &#039;server&#039;
        option verb &#039;1&#039;
        option remote &#039;vpndomain.com&#039;
        option proto &#039;udp&#039;
        option ca &#039;/lib/uci/upload/cbid.openvpn.client_tun.ca&#039;
        option resolv_retry &#039;infinite&#039;
        option tls_client &#039;1&#039;
        option auth_user_pass &#039;/etc/openvpn/pwd.txt&#039;
        option enabled &#039;1&#039;</code></pre></div><p>Any idea what I might missed in the configs? Thanks</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p191709">
				<div class="post-metadata">
					<div class="post-num">Post #103</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						11 Feb 2013, 19:23					</div>
				</div>
				<div class="post-content content">
					<p>Hi swoofz,</p><br /><p>Please remove the gateway option and the metric option from the lan interface in your network config.&nbsp; Add the option &quot;redirect-gateway def1&quot; to your openvpn config. Reboot and try again please.</p><br /><p>Thnx!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p191736">
				<div class="post-metadata">
					<div class="post-num">Post #104</div>
					<div class="post-author">swoofz</div>
					<div class="post-datetime">
						12 Feb 2013, 02:34					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><p>Hi swoofz,</p><br /><p>Please remove the gateway option and the metric option from the lan interface in your network config.&nbsp; Add the option &quot;redirect-gateway def1&quot; to your openvpn config. Reboot and try again please.</p><br /><p>Thnx!</p></blockquote></div><p>Hi Adze,<br />Tried to do what you asked, and using the same mwan3 config still I couldn&#039;t redirect the traffic from my PC to the VPN line. </p><p>Will try it again later.&nbsp; Thanks.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p192525">
				<div class="post-metadata">
					<div class="post-num">Post #105</div>
					<div class="post-author">hayate</div>
					<div class="post-datetime">
						19 Feb 2013, 18:19					</div>
				</div>
				<div class="post-content content">
					<p>I have a question, if I define some rules, and a session doesn&#039;t match any rules, does it go to some default rule?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p192526">
				<div class="post-metadata">
					<div class="post-num">Post #106</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						19 Feb 2013, 18:24					</div>
				</div>
				<div class="post-content content">
					<p>If no rules are matched, traffic is not marked and handled by the default routing table. After the first packet leaves a wan interface it eventually does get marked. So in short the default routing table is used.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p192973">
				<div class="post-metadata">
					<div class="post-num">Post #107</div>
					<div class="post-author">swlepus</div>
					<div class="post-datetime">
						24 Feb 2013, 03:30					</div>
				</div>
				<div class="post-content content">
					<p>Dear Adze:</p><p>Thanks for your mwan3, but in my home, it seems has some problem.<br />I can only use one pppoe link, but I did dial up for 3 pppoe link.</p><p>Is this a same pppoe gateway problem? And how can I fix this?</p><p>please help.</p><p>/etc/config/mwan3 :<br /></p><div class="codebox"><pre><code>config interface &#039;wan&#039;
    option enabled &#039;1&#039;
    list track_ip &#039;61.139.2.69&#039;
    option reliability &#039;3&#039;
    option count &#039;1&#039;
    option timeout &#039;2&#039;
    option interval &#039;5&#039;
    option down &#039;3&#039;
    option up &#039;8&#039;

config interface &#039;wan2&#039;
    option enabled &#039;1&#039;
    list track_ip &#039;8.8.8.8&#039;
    list track_ip &#039;208.67.220.220&#039;
    option reliability &#039;1&#039;
    option count &#039;1&#039;
    option timeout &#039;2&#039;
    option interval &#039;5&#039;
    option down &#039;3&#039;
    option up &#039;8&#039;

config interface &#039;wan3&#039;
    option enabled &#039;1&#039;
    list track_ip &#039;61.139.2.69&#039;
    option reliability &#039;2&#039;
    option count &#039;1&#039;
    option timeout &#039;2&#039;
    option interval &#039;5&#039;
    option down &#039;3&#039;
    option up &#039;8&#039;

config member &#039;wan_m1_w3&#039;
    option metric &#039;1&#039;
    option weight &#039;3&#039;
    option interface &#039;wan&#039;

config member &#039;wan_m2_w3&#039;
    option metric &#039;2&#039;
    option weight &#039;3&#039;
    option interface &#039;wan&#039;

config member &#039;wan2_m1_w2&#039;
    option interface &#039;wan2&#039;
    option metric &#039;1&#039;
    option weight &#039;2&#039;

config member &#039;wan2_m2_w2&#039;
    option interface &#039;wan2&#039;
    option metric &#039;2&#039;
    option weight &#039;2&#039;

config member &#039;wan3_m1_w1&#039;
    option interface &#039;wan3&#039;
    option metric &#039;1&#039;
    option weight &#039;4&#039;

config member &#039;wan3_m2_w1&#039;
    option interface &#039;wan3&#039;
    option metric &#039;2&#039;
    option weight &#039;4&#039;

config policy &#039;wan_only&#039;
    list use_member &#039;wan_m1_w3&#039;

config policy &#039;wan2_only&#039;
    list use_member &#039;wan2_m1_w2&#039;

config policy &#039;wan3_only&#039;
    list use_member &#039;wan3_m1_w1&#039;

config policy &#039;wan_wan2_wan3_loadbalanced&#039;
    list use_member &#039;wan_m1_w3&#039;
    list use_member &#039;wan2_m1_w2&#039;
    list use_member &#039;wan3_m1_w1&#039;

config policy &#039;wan_pri_wan2_sec&#039;
    list use_member &#039;wan_m1_w3&#039;
    list use_member &#039;wan2_m2_w2&#039;

config policy &#039;wan2_pri_wan_sec&#039;
    list use_member &#039;wan_m2_w3&#039;
    list use_member &#039;wan2_m1_w2&#039;

config rule
    option proto &#039;tcp&#039;
    option use_policy &#039;wan2_only&#039;
    option src_ip &#039;192.168.47.0/24&#039;
    option dest_port &#039;17000&#039;

config rule
    option proto &#039;tcp&#039;
    option use_policy &#039;wan_only&#039;
    option src_ip &#039;192.168.47.10&#039;
    option src_port &#039;22&#039;

config rule
    option dest_ip &#039;0.0.0.0/0&#039;
    option use_policy &#039;wan_wan2_loadbalanced&#039;

config rule
    option dest_ip &#039;77.11.41.0/24&#039;
    option proto &#039;tcp&#039;
    option dest_port &#039;1024:65535&#039;
    option use_policy &#039;wan_pri_wan2_sec&#039;

config rule
    option dest_ip &#039;112.136.0.0/16&#039;
    option proto &#039;udp&#039;
    option dest_port &#039;5352&#039;
    option use_policy &#039;wan2_pri_wan_sec&#039;</code></pre></div><p>ifconfig:<br /></p><div class="codebox"><pre><code>br-lan    Link encap:Ethernet  HWaddr 64:16:F0:08:39:05  
          inet addr:192.168.47.1  Bcast:192.168.47.255  Mask:255.255.255.0
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:32018 errors:0 dropped:62 overruns:0 frame:0
          TX packets:36456 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:4421073 (4.2 MiB)  TX bytes:31287304 (29.8 MiB)

eth0      Link encap:Ethernet  HWaddr 64:16:F0:08:39:05  
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:38558 errors:0 dropped:0 overruns:0 frame:0
          TX packets:33609 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:30960371 (29.5 MiB)  TX bytes:5263479 (5.0 MiB)
          Interrupt:14 

eth0.1    Link encap:Ethernet  HWaddr 64:16:F0:08:39:05  
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:2558 errors:0 dropped:0 overruns:0 frame:0
          TX packets:2531 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:337239 (329.3 KiB)  TX bytes:579601 (566.0 KiB)

eth0.2    Link encap:Ethernet  HWaddr 00:27:19:98:07:3A  
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:35764 errors:0 dropped:0 overruns:0 frame:0
          TX packets:30902 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:29916868 (28.5 MiB)  TX bytes:4542226 (4.3 MiB)

eth2      Link encap:Ethernet  HWaddr 00:27:19:98:EF:14  
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:1245 errors:0 dropped:0 overruns:0 frame:0
          TX packets:1003 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:83946 (81.9 KiB)  TX bytes:30792 (30.0 KiB)

eth3      Link encap:Ethernet  HWaddr 00:27:19:72:13:B1  
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:1228 errors:0 dropped:0 overruns:0 frame:0
          TX packets:1003 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:82808 (80.8 KiB)  TX bytes:30792 (30.0 KiB)

lo        Link encap:Local Loopback  
          inet addr:127.0.0.1  Mask:255.0.0.0
          UP LOOPBACK RUNNING  MTU:65536  Metric:1
          RX packets:274 errors:0 dropped:0 overruns:0 frame:0
          TX packets:274 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:19319 (18.8 KiB)  TX bytes:19319 (18.8 KiB)

pppoe-wan Link encap:Point-to-Point Protocol  
          inet addr:118.113.16.64  P-t-P:118.114.236.12  Mask:255.255.255.255
          UP POINTOPOINT RUNNING NOARP MULTICAST  MTU:1492  Metric:1
          RX packets:32479 errors:0 dropped:0 overruns:0 frame:0
          TX packets:27888 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:3 
          RX bytes:29496161 (28.1 MiB)  TX bytes:3836106 (3.6 MiB)

pppoe-wan2 Link encap:Point-to-Point Protocol  
          inet addr:118.113.16.63  P-t-P:118.114.236.12  Mask:255.255.255.255
          UP POINTOPOINT RUNNING NOARP MULTICAST  MTU:1492  Metric:1
          RX packets:26 errors:0 dropped:0 overruns:0 frame:0
          TX packets:3 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:3 
          RX bytes:1066 (1.0 KiB)  TX bytes:54 (54.0 B)

pppoe-wan3 Link encap:Point-to-Point Protocol  
          inet addr:118.113.16.66  P-t-P:118.114.236.12  Mask:255.255.255.255
          UP POINTOPOINT RUNNING NOARP MULTICAST  MTU:1492  Metric:1
          RX packets:9 errors:0 dropped:0 overruns:0 frame:0
          TX packets:3 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:3 
          RX bytes:302 (302.0 B)  TX bytes:54 (54.0 B)

wlan0     Link encap:Ethernet  HWaddr 64:16:F0:08:39:06  
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:29784 errors:0 dropped:0 overruns:0 frame:0
          TX packets:35194 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:32 
          RX bytes:4540296 (4.3 MiB)  TX bytes:31697600 (30.2 MiB)</code></pre></div><p>ip rule list:<br /></p><div class="codebox"><pre><code>0:    from all lookup local 
1008:    from all fwmark 0x100/0xff00 lookup 1001 
1016:    from all fwmark 0x1000/0xff00 lookup 1016 
1017:    from all fwmark 0x1100/0xff00 lookup 1017 
1018:    from all fwmark 0x1200/0xff00 lookup 1018 
1019:    from all fwmark 0x1300/0xff00 lookup 1019 
1020:    from all fwmark 0x1400/0xff00 lookup 1020 
1021:    from all fwmark 0x1500/0xff00 lookup 1021 
32766:    from all lookup main 
32767:    from all lookup default </code></pre></div><p>ip route list table 1001<br /></p><div class="codebox"><pre><code>default via 118.114.236.12 dev pppoe-wan</code></pre></div><p>/etc/config/firewall<br /></p><div class="codebox"><pre><code>config defaults
    option syn_flood &#039;1&#039;
    option input &#039;ACCEPT&#039;
    option output &#039;ACCEPT&#039;
    option forward &#039;REJECT&#039;

config zone
    option name &#039;lan&#039;
    option network &#039;lan&#039;
    option input &#039;ACCEPT&#039;
    option output &#039;ACCEPT&#039;
    option forward &#039;REJECT&#039;

config zone
    option name &#039;wan&#039;
    option input &#039;REJECT&#039;
    option output &#039;ACCEPT&#039;
    option forward &#039;REJECT&#039;
    option masq &#039;1&#039;
    option mtu_fix &#039;1&#039;
    option network &#039;wan WAN&#039;

config forwarding
    option src &#039;lan&#039;
    option dest &#039;wan&#039;

config rule
    option name &#039;Allow-DHCP-Renew&#039;
    option src &#039;wan&#039;
    option proto &#039;udp&#039;
    option dest_port &#039;68&#039;
    option target &#039;ACCEPT&#039;
    option family &#039;ipv4&#039;

config rule
    option name &#039;Allow-Ping&#039;
    option src &#039;wan&#039;
    option proto &#039;icmp&#039;
    option icmp_type &#039;echo-request&#039;
    option family &#039;ipv4&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-DHCPv6&#039;
    option src &#039;wan&#039;
    option proto &#039;udp&#039;
    option src_ip &#039;fe80::/10&#039;
    option src_port &#039;547&#039;
    option dest_ip &#039;fe80::/10&#039;
    option dest_port &#039;546&#039;
    option family &#039;ipv6&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-ICMPv6-Input&#039;
    option src &#039;wan&#039;
    option proto &#039;icmp&#039;
    list icmp_type &#039;echo-request&#039;
    list icmp_type &#039;echo-reply&#039;
    list icmp_type &#039;destination-unreachable&#039;
    list icmp_type &#039;packet-too-big&#039;
    list icmp_type &#039;time-exceeded&#039;
    list icmp_type &#039;bad-header&#039;
    list icmp_type &#039;unknown-header-type&#039;
    list icmp_type &#039;router-solicitation&#039;
    list icmp_type &#039;neighbour-solicitation&#039;
    list icmp_type &#039;router-advertisement&#039;
    list icmp_type &#039;neighbour-advertisement&#039;
    option limit &#039;1000/sec&#039;
    option family &#039;ipv6&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-ICMPv6-Forward&#039;
    option src &#039;wan&#039;
    option dest &#039;*&#039;
    option proto &#039;icmp&#039;
    list icmp_type &#039;echo-request&#039;
    list icmp_type &#039;echo-reply&#039;
    list icmp_type &#039;destination-unreachable&#039;
    list icmp_type &#039;packet-too-big&#039;
    list icmp_type &#039;time-exceeded&#039;
    list icmp_type &#039;bad-header&#039;
    list icmp_type &#039;unknown-header-type&#039;
    option limit &#039;1000/sec&#039;
    option family &#039;ipv6&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Enforce-ULA-Border-Src&#039;
    option src &#039;*&#039;
    option dest &#039;wan&#039;
    option proto &#039;all&#039;
    option src_ip &#039;fc00::/7&#039;
    option family &#039;ipv6&#039;
    option target &#039;REJECT&#039;

config rule
    option name &#039;Enforce-ULA-Border-Dest&#039;
    option src &#039;*&#039;
    option dest &#039;wan&#039;
    option proto &#039;all&#039;
    option dest_ip &#039;fc00::/7&#039;
    option family &#039;ipv6&#039;
    option target &#039;REJECT&#039;

config include
    option path &#039;/etc/firewall.user&#039;

config zone
    option forward &#039;REJECT&#039;
    option output &#039;ACCEPT&#039;
    option name &#039;wan2&#039;
    option input &#039;REJECT&#039;
    option masq &#039;1&#039;
    option mtu_fix &#039;1&#039;
    option network &#039;wan2&#039;

config forwarding
    option dest &#039;wan2&#039;
    option src &#039;lan&#039;

config zone
    option forward &#039;REJECT&#039;
    option output &#039;ACCEPT&#039;
    option name &#039;wan3&#039;
    option input &#039;REJECT&#039;
    option masq &#039;1&#039;
    option mtu_fix &#039;1&#039;
    option network &#039;wan3&#039;

config forwarding
    option dest &#039;wan3&#039;
    option src &#039;lan&#039;</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p193849">
				<div class="post-metadata">
					<div class="post-num">Post #108</div>
					<div class="post-author">nozombian</div>
					<div class="post-datetime">
						5 Mar 2013, 09:04					</div>
				</div>
				<div class="post-content content">
					<p>Hi Adze, your package seems very useful, but I&#039;d like to use it a bit more differently. I don&#039;t have more wan interfaces, but all ports bridged together. I want to solve the failover by changing default route and assigning the route via option dhcp, because openwrt does not route at all. Is this possible with your package?</p><p>Yet another question, I get &quot;Cannot satisfy the following dependencies for mwan3&quot; error:<br /></p><div class="codebox"><pre><code>root@wr1043nd:~# opkg --force-depends install http://213.136.13.52/mwan3_1.1-6_a
r71xx.ipk
Downloading http://213.136.13.52/mwan3_1.1-6_ar71xx.ipk.
Installing mwan3 (1.1-6) to root...
Installing ip (3.3.0-1) to root...
Downloading http://downloads.openwrt.org/attitude_adjustment/12.09-rc1/ar71xx/generic/packages/ip_3.3.0-1_ar71xx.ipk.
Installing iptables-mod-conntrack-extra (1.4.10-4) to root...
Downloading http://downloads.openwrt.org/attitude_adjustment/12.09-rc1/ar71xx/generic/packages/iptables-mod-conntrack-extra_1.4.10-4_ar71xx.ipk.
Installing kmod-ipt-conntrack-extra (3.3.8-1) to root...
Downloading http://downloads.openwrt.org/attitude_adjustment/12.09-rc1/ar71xx/generic/packages/kmod-ipt-conntrack-extra_3.3.8-1_ar71xx.ipk.
Installing iptables-mod-ipopt (1.4.10-4) to root...
Downloading http://downloads.openwrt.org/attitude_adjustment/12.09-rc1/ar71xx/generic/packages/iptables-mod-ipopt_1.4.10-4_ar71xx.ipk.
Installing kmod-ipt-ipopt (3.3.8-1) to root...
Downloading http://downloads.openwrt.org/attitude_adjustment/12.09-rc1/ar71xx/generic/packages/kmod-ipt-ipopt_3.3.8-1_ar71xx.ipk.
Configuring ip.
Configuring kmod-ipt-conntrack-extra.
Configuring kmod-ipt-ipopt.
Configuring iptables-mod-ipopt.
Configuring iptables-mod-conntrack-extra.
Configuring mwan3.
Collected errors:
 * satisfy_dependencies_for: Cannot satisfy the following dependencies for mwan3:
 *      kernel (= 3.3.8-1-5440da3a2c45184a32da6bba25b8dd2a) *   kernel (= 3.3.8-1-5440da3a2c45184a32da6bba25b8dd2a) *</code></pre></div><p>How can I install it? I have AA r35631.</p>											<p class="post-edited">(Last edited by <strong>nozombian</strong> on 5 Mar 2013, 09:25)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p196161">
				<div class="post-metadata">
					<div class="post-num">Post #109</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						26 Mar 2013, 02:27					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><div class="quotebox"><cite>thdyck wrote:</cite><blockquote><p>6. LUCI item: In the &quot;Multiwan policy configuration&quot; and &quot;Multiwan rule configuration&quot; LuCI pages, it would be nice to have the &quot;Member used&quot; and &quot;Policy assigned&quot; fields be drop-down lists to avoid typos.</p></blockquote></div><p>WiP, but it&#039;s more Arfett&#039;s project.</p></blockquote></div><p>I was wanting to make it that way but honestly I have no idea how to code that in. If anyone knows I would be ecstatic to know how to make it work and I&#039;ll update the files.</p>											<p class="post-edited">(Last edited by <strong>arfett</strong> on 26 Mar 2013, 02:30)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p196354">
				<div class="post-metadata">
					<div class="post-num">Post #110</div>
					<div class="post-author">axishero</div>
					<div class="post-datetime">
						27 Mar 2013, 06:54					</div>
				</div>
				<div class="post-content content">
					<p>Hi,arfett,I have a 12MBit FTTB line and a 6Mbit adsl line.I want to combind their bandwidth but limit adsl&#039;s upload bandwidth to 512kbit.Is mwan3 capable of doing this?</p>											<p class="post-edited">(Last edited by <strong>axishero</strong> on 27 Mar 2013, 06:54)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p196446">
				<div class="post-metadata">
					<div class="post-num">Post #111</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						27 Mar 2013, 19:37					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>axishero wrote:</cite><blockquote><p>Hi,arfett,I have a 12MBit FTTB line and a 6Mbit adsl line.I want to combind their bandwidth but limit adsl&#039;s upload bandwidth to 512kbit.Is mwan3 capable of doing this?</p></blockquote></div><p>Yes with Quality Of Service limiting the bandwidth and mwan3 load balancing. There is a LuCI app for QOS. At least I assume this will work. Try it and report back <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>											<p class="post-edited">(Last edited by <strong>arfett</strong> on 27 Mar 2013, 20:41)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p196467">
				<div class="post-metadata">
					<div class="post-num">Post #112</div>
					<div class="post-author">MES3</div>
					<div class="post-datetime">
						27 Mar 2013, 22:56					</div>
				</div>
				<div class="post-content content">
					<p>Dear all,</p><p>I am running Attitude Adjustment 12.09 with the latest LuCI Web interface + mwan3 on a D-Link router. I would need some inputs and therefore appreciate any hints. Here is what I am trying to do:</p><p><strong>Existing situation:</strong></p><ul><li><p>Physical WAN interface of the router uses PPPoE to connect to the Internet</p></li><li><p>The LAN interface (bridge) of the router is the default gateway for LAN clients at $LAN_GW</p></li><li><p>A VPN tunnel interface is set up to run inside the PPPoE tunnel to connect to a VPN provider</p></li></ul><p>As soon as the VPN tunnel connects, all traffic is routed via the VPN as it becomes the default gateway to the internet for all LAN clients. If the VPN is down, all traffic is routed over the standard ISP tunnel.</p><br /><p><strong>To-be situation:</strong></p><p>I want to create an alias to $LAN_GW called $LAN_GW1 on the same LAN subnet.<br /></p><ul><li><p>LAN clients that have $LAN_GW as their gateway should be routed over the standard PPPoE ISP tunnel.</p></li><li><p>LAN clients that have $LAN_GW1 as their gateway should be rounted over the VPN tunnel.</p></li><li><p>If the VPN tunnel is down the traffic routed via $LAN_GW1 should be routed via the PPPoE ISP tunnel. </p></li></ul><p>I have studied the documentation of the IP package (IProute2) and mwan3 and can only find exampes for source based routing or for load-sharing and availability-based WAN link selection. What I am trying to do is gateway based routing regardless of the source. My configuration should effectively create two default gatways each with its own internet uplink.</p><p>Can mwan3 support my use case? If not pease excuse the off topic post.</p><p>Many thanks<br />MES3</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p196489">
				<div class="post-metadata">
					<div class="post-num">Post #113</div>
					<div class="post-author">axishero</div>
					<div class="post-datetime">
						28 Mar 2013, 04:43					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>arfett wrote:</cite><blockquote><div class="quotebox"><cite>axishero wrote:</cite><blockquote><p>Hi,arfett,I have a 12MBit FTTB line and a 6Mbit adsl line.I want to combind their bandwidth but limit adsl&#039;s upload bandwidth to 512kbit.Is mwan3 capable of doing this?</p></blockquote></div><p>Yes with Quality Of Service limiting the bandwidth and mwan3 load balancing. There is a LuCI app for QOS. At least I assume this will work. Try it and report back <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p></blockquote></div><p>Yes,but qos in openwrt can only limit the total sum of upload and download bandwidth.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p196492">
				<div class="post-metadata">
					<div class="post-num">Post #114</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						28 Mar 2013, 05:37					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>axishero wrote:</cite><blockquote><div class="quotebox"><cite>arfett wrote:</cite><blockquote><div class="quotebox"><cite>axishero wrote:</cite><blockquote><p>Hi,arfett,I have a 12MBit FTTB line and a 6Mbit adsl line.I want to combind their bandwidth but limit adsl&#039;s upload bandwidth to 512kbit.Is mwan3 capable of doing this?</p></blockquote></div><p>Yes with Quality Of Service limiting the bandwidth and mwan3 load balancing. There is a LuCI app for QOS. At least I assume this will work. Try it and report back <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p></blockquote></div><p>Yes,but qos in openwrt can only limit the total sum of upload and download bandwidth.</p></blockquote></div><p>On a per interface basis. Just apply it to that single interface.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p197799">
				<div class="post-metadata">
					<div class="post-num">Post #115</div>
					<div class="post-author">Bluse-Blue</div>
					<div class="post-datetime">
						9 Apr 2013, 18:01					</div>
				</div>
				<div class="post-content content">
					<p>Hi Adze,</p><p>Thx for your work to mwan3. I use your script with 2 dsl lines and the equalizer option 1, both weigths are set to 3 but only one dsl line gets used. <br />There seems to be a bug in your script while calculationg the sum weights for the iptables rules. </p><p>while looking at the output of &quot;iptables -t mangle -vL&quot;:</p><p>Chain mwan3_rules (1 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; 528&nbsp; 283K MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; any&nbsp; &nbsp; any&nbsp; &nbsp; &nbsp;anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;10.10.0.0/16&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mark match 0x0/0xff00 MARK xset 0x8000/0xff00<br />&nbsp; 822 67451 MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; any&nbsp; &nbsp; any&nbsp; &nbsp; &nbsp;anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mark match 0x0/0xff00 statistic mode random probability 0.50000000000 MARK xset 0x100/0xff00<br />&nbsp; 764 62624 MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; any&nbsp; &nbsp; any&nbsp; &nbsp; &nbsp;anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mark match 0x0/0xff00 statistic mode random probability 0.99999999953 MARK xset 0x200/0xff00</p><p>I put some debug putput in the /etc/hotplug.d/iface/15-mwan and you calculate in function mwan3_update_policy_iptables_rules() the iftotalweight=$(($old_weight+$iftotalweight)), where for the first trigger of interface-1 ...iftotalweight=0 .. so it does not respect to total sum of weights ... and for the second call for interface-2 it uses the current sum weight.</p><p>It looks a bit complicated to me how you get the weights and the total weights. </p><p>What do you think ?</p><p>Bye Bluse</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p197802">
				<div class="post-metadata">
					<div class="post-num">Post #116</div>
					<div class="post-author">Bluse-Blue</div>
					<div class="post-datetime">
						9 Apr 2013, 18:10					</div>
				</div>
				<div class="post-content content">
					<p>Hi Adze,</p><p>One more thing I explored while troubleshooting the equalizer problem is, in case you do a &quot;/etc/init.d/mwan3 restart&quot;, <br />the former {mwan3track} /bin/sh /usr/sbin/mwan3track wan1 eth0.2 2 3 5 5 5 8 8.8.4.4 8.8.8.8 processes do not get stoped properly .. so you end up with more and more mwan3tracker processes when restarting your script.</p><p>Greetings Bluse</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p197868">
				<div class="post-metadata">
					<div class="post-num">Post #117</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						10 Apr 2013, 11:41					</div>
				</div>
				<div class="post-content content">
					<p>Hi Bluse-Blue,</p><br /><p>Thank you for testing. Thanks for noticing the probability error. I can reproduce it myself here on my router. Will fix this soon!</p><p>As for multiple mwan3track instances, i found that this problem is introduced in some of the newer openwrt builds (i think it has to do with firewall3 package). There are some more serious issues with it, for instance when an interface comes back online after it has failed, mwan3track still fails at pinging the remote host. So a downed interface will never come back up on itself...</p><p>bugs bugs bugs...</p><p>As for now i advice you not to use mwan3track for the moment, until i have time to fix it.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p197878">
				<div class="post-metadata">
					<div class="post-num">Post #118</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						10 Apr 2013, 12:42					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Bluse-Blue wrote:</cite><blockquote><p>Hi Adze,</p><p>There seems to be a bug in your script while calculationg the sum weights for the iptables rules. </p><p>while looking at the output of &quot;iptables -t mangle -vL&quot;:</p><p>Chain mwan3_rules (1 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; 822 67451 MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; any&nbsp; &nbsp; any&nbsp; &nbsp; &nbsp;anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mark match 0x0/0xff00 statistic mode random probability 0.50000000000 MARK xset 0x100/0xff00<br />&nbsp; 764 62624 MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; any&nbsp; &nbsp; any&nbsp; &nbsp; &nbsp;anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;mark match 0x0/0xff00 statistic mode random probability 0.99999999953 MARK xset 0x200/0xff00</p></blockquote></div><p>It looks to me that the calculating the sum of weights is correct. First rule says that 50% of the time it should mark the flow with 0x100 and the rest of the times with 0x200. As it should (50-50) distribution. Why it doesn&#039;t load share on your setup is due to something else...</p><p>What strikes me is that iptables somehow mangles the probability value?!?<br /></p><div class="codebox"><pre><code>root@mercurius:~# iptables -I OUTPUT -p icmp -o br-lan -m statistic --mode random --probability 0.60000000000 -j DROP
root@mercurius:~# iptables -L OUTPUT -n -v
Chain OUTPUT (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination         
    0     0 DROP       icmp --  *      br-lan  0.0.0.0/0            0.0.0.0/0            statistic mode random probability 0.60000000009

root@mercurius:~# iptables -I OUTPUT -p icmp -o br-lan -m statistic --mode random --probability 1 -j DROP
root@mercurius:~# iptables -L OUTPUT -n -v
Chain OUTPUT (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination         
    0     0 DROP       icmp --  *      br-lan  0.0.0.0/0            0.0.0.0/0            statistic mode random probability 0.99999999953</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p197889">
				<div class="post-metadata">
					<div class="post-num">Post #119</div>
					<div class="post-author">Bluse-Blue</div>
					<div class="post-datetime">
						10 Apr 2013, 13:04					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><p>As for now i advice you not to use mwan3track for the moment, until i have time to fix it.</p></blockquote></div><br /><p>Hi Adze,</p><p>What do you mean by that &quot;do not use mwantrack&quot; ?<br />Do I just need to skip the hosts to ping in the mwan3 config file to skip mwan3track ?</p><p>Bye Bluse</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p197890">
				<div class="post-metadata">
					<div class="post-num">Post #120</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						10 Apr 2013, 13:06					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Bluse-Blue wrote:</cite><blockquote><p>What do you mean by that &quot;do not use mwantrack&quot; ?<br />Do I just need to skip the hosts to ping in the mwan3 config file to skip mwan3track ?</p></blockquote></div><p>Remove all options under the interface config, except for enabled:</p><div class="codebox"><pre><code>config &#039;interface&#039; &#039;wan2&#039;
    option &#039;enabled&#039; &#039;1&#039;</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p197913">
				<div class="post-metadata">
					<div class="post-num">Post #121</div>
					<div class="post-author">Bluse-Blue</div>
					<div class="post-datetime">
						10 Apr 2013, 16:37					</div>
				</div>
				<div class="post-content content">
					<p>Hi Atze,</p><p>I would like to contribute to your package.<br />What about setting up a GitHub repo to ease the developement process ?<br />Let me know if you would set up such a repo.</p><br /><p>Bye Bluse</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p197951">
				<div class="post-metadata">
					<div class="post-num">Post #122</div>
					<div class="post-author">murjak</div>
					<div class="post-datetime">
						10 Apr 2013, 21:39					</div>
				</div>
				<div class="post-content content">
					<p>Hello i have a problem with the package, it won&#039;t start</p><p>it gives me the following errors:<br /></p><div class="codebox"><pre><code>root@Gargoyle:~# /etc/init.d/mwan3 restart
root@Gargoyle:~# uci: Entry not found
sh: wan: unknown operand
uci: Entry not found
sh: wan: unknown operand
uci: Entry not found
sh: wan3: unknown operand
uci: Entry not found
sh: wan2: unknown operand
uci: Entry not found
sh: wan2: unknown operand
ERROR: No valid dynamic DNS service configurations defined
(Did you specify correct configuration file path?)
uci: Entry not found
sh: wan3: unknown operand
uci: Entry not found
sh: wan3: unknown operand
uci: Entry not found
sh: wan3: unknown operand
uci: Entry not found
sh: wan2: unknown operand
uci: Entry not found
sh: wan2: unknown operand</code></pre></div><p>mwan3 conf:<br /></p><div class="codebox"><pre><code>config &#039;interface&#039; &#039;wan&#039;
    option &#039;enabled&#039; &#039;1&#039;
    list &#039;track_ip&#039; &#039;8.8.4.4&#039;
    list &#039;track_ip&#039; &#039;8.8.8.8&#039;
    list &#039;track_ip&#039; &#039;208.67.222.222&#039;
    list &#039;track_ip&#039; &#039;208.67.220.220&#039;
    option &#039;reliability&#039; &#039;3&#039;
    option &#039;count&#039; &#039;1&#039;
    option &#039;timeout&#039; &#039;5&#039;
    option &#039;interval&#039; &#039;10&#039;
    option &#039;down&#039; &#039;3&#039;
    option &#039;up&#039; &#039;8&#039;

config &#039;interface&#039; &#039;wan2&#039;
    option &#039;enabled&#039; &#039;1&#039;
    list &#039;track_ip&#039; &#039;8.8.4.4&#039;
    list &#039;track_ip&#039; &#039;8.8.8.8&#039;
    list &#039;track_ip&#039; &#039;208.67.222.222&#039;
    list &#039;track_ip&#039; &#039;208.67.220.220&#039;
    option &#039;reliability&#039; &#039;1&#039;
    option &#039;count&#039; &#039;1&#039;
    option &#039;timeout&#039; &#039;5&#039;
    option &#039;interval&#039; &#039;10&#039;
    option &#039;down&#039; &#039;3&#039;
    option &#039;up&#039; &#039;8&#039;

config &#039;interface&#039; &#039;wan3&#039;
    option &#039;enabled&#039; &#039;1&#039;
    list &#039;track_ip&#039; &#039;8.8.4.4&#039;
    list &#039;track_ip&#039; &#039;8.8.8.8&#039;
    list &#039;track_ip&#039; &#039;208.67.222.222&#039;
    list &#039;track_ip&#039; &#039;208.67.220.220&#039;
    option &#039;reliability&#039; &#039;1&#039;
    option &#039;count&#039; &#039;1&#039;
    option &#039;timeout&#039; &#039;5&#039;
    option &#039;interval&#039; &#039;10&#039;
    option &#039;down&#039; &#039;3&#039;
    option &#039;up&#039; &#039;8&#039;

config &#039;interface&#039; &#039;wan4&#039;
    option &#039;enabled&#039; &#039;1&#039;
    list &#039;track_ip&#039; &#039;8.8.4.4&#039;
    list &#039;track_ip&#039; &#039;8.8.8.8&#039;
    list &#039;track_ip&#039; &#039;208.67.222.222&#039;
    list &#039;track_ip&#039; &#039;208.67.220.220&#039;
    option &#039;reliability&#039; &#039;1&#039;
    option &#039;count&#039; &#039;1&#039;
    option &#039;timeout&#039; &#039;5&#039;
    option &#039;interval&#039; &#039;10&#039;
    option &#039;down&#039; &#039;3&#039;
    option &#039;up&#039; &#039;8&#039;

config &#039;member&#039; &#039;wan_m1_w2&#039;
    option &#039;interface&#039; &#039;wan&#039;
    option &#039;metric&#039; &#039;1&#039;
    option &#039;weight&#039; &#039;2&#039;

config &#039;member&#039; &#039;wan_m2_w2&#039;
    option &#039;interface&#039; &#039;wan&#039;
    option &#039;metric&#039; &#039;2&#039;
    option &#039;weight&#039; &#039;2&#039;

config &#039;member&#039; &#039;wan2_m1_w2&#039;
    option &#039;interface&#039; &#039;wan2&#039;
    option &#039;metric&#039; &#039;1&#039;
    option &#039;weight&#039; &#039;2&#039;

config &#039;member&#039; &#039;wan2_m2_w2&#039;
    option &#039;interface&#039; &#039;wan2&#039;
    option &#039;metric&#039; &#039;2&#039;
    option &#039;weight&#039; &#039;2&#039;


config &#039;member&#039; &#039;wan3_m1_w2&#039;
    option &#039;interface&#039; &#039;wan3&#039;
    option &#039;metric&#039; &#039;1&#039;
    option &#039;weight&#039; &#039;2&#039;

config &#039;member&#039; &#039;wan3_m2_w2&#039;
    option &#039;interface&#039; &#039;wan3&#039;
    option &#039;metric&#039; &#039;2&#039;
    option &#039;weight&#039; &#039;2&#039;


config &#039;member&#039; &#039;wan4_m1_w2&#039;
    option &#039;interface&#039; &#039;wan4&#039;
    option &#039;metric&#039; &#039;1&#039;
    option &#039;weight&#039; &#039;2&#039;

config &#039;member&#039; &#039;wan4_m2_w2&#039;
    option &#039;interface&#039; &#039;wan4&#039;
    option &#039;metric&#039; &#039;2&#039;
    option &#039;weight&#039; &#039;2&#039;


config &#039;policy&#039; &#039;wan1_only&#039;
    list &#039;use_member&#039; &#039;wan1_m1_w2&#039;

config &#039;policy&#039; &#039;wan2_only&#039;
    list &#039;use_member&#039; &#039;wan2_m1_w2&#039;

config &#039;policy&#039; &#039;wan3_only&#039;
    list &#039;use_member&#039; &#039;wan3_m1_w2&#039;

config &#039;policy&#039; &#039;wan4_only&#039;
    list &#039;use_member&#039; &#039;wan3_m1_w2&#039;

config &#039;policy&#039; &#039;wan1_wan2_wan3_wan4_loadbalanced&#039;
    list &#039;use_member&#039; &#039;wan1_m1_w2&#039;
    list &#039;use_member&#039; &#039;wan2_m1_w2&#039;
    list &#039;use_member&#039; &#039;wan3_m1_w2&#039;
    list &#039;use_member&#039; &#039;wan4_m1_w2&#039;

config &#039;policy&#039; &#039;wan1_pri_wan2_sec&#039;
    list &#039;use_member&#039; &#039;wan1_m1_w2&#039;
    list &#039;use_member&#039; &#039;wan2_m2_w2&#039;

config &#039;policy&#039; &#039;wan2_pri_wan1_sec&#039;
    list &#039;use_member&#039; &#039;wan1_m2_w2&#039;
    list &#039;use_member&#039; &#039;wan2_m1_w2&#039;

config &#039;rule&#039;
    option &#039;dest_ip&#039; &#039;192.168.0.0/16&#039;
    option &#039;proto&#039; &#039;tcp&#039;
    option &#039;use_policy&#039; &#039;default&#039;

config &#039;rule&#039;
    option &#039;dest_ip&#039; &#039;0.0.0.0/0&#039;
    option &#039;equalize&#039; &#039;1&#039;
    option &#039;use_policy&#039; &#039;wan1_wan2_wan3_wan4_loadbalanced&#039;</code></pre></div><p>network:<br /></p><div class="codebox"><pre><code>config interface &#039;loopback&#039;
        option ifname &#039;lo&#039;
        option proto &#039;static&#039;
        option ipaddr &#039;127.0.0.1&#039;
        option netmask &#039;255.0.0.0&#039;

config interface &#039;lan&#039;
        option ifname &#039;eth0.1&#039;
        option type &#039;bridge&#039;
        option proto &#039;static&#039;
        option netmask &#039;255.255.255.0&#039;
        option dns &#039;208.67.222.222 208.67.220.220&#039;
        option ipaddr &#039;192.168.2.1&#039;

config interface &#039;wan&#039;
        option dns &#039;208.67.222.222 208.67.220.220&#039;
        option peerdns &#039;0&#039;
        option auto &#039;1&#039;
        option proto &#039;3g&#039;
        option device &#039;/dev/ttyUSB0&#039;
        option apn &#039;darmowy&#039;
        option service &#039;umts_only&#039;
        option mobile_isp &#039;Polska - Aero2&#039;
        option metric &#039;10&#039;

config switch
        option name &#039;rtl8366rb&#039;
        option reset &#039;1&#039;
        option enable_vlan &#039;1&#039;

config switch_vlan
        option device &#039;rtl8366rb&#039;
        option vlan &#039;1&#039;
        option ports &#039;1 2 3 4 5t&#039;

config switch_vlan
        option device &#039;rtl8366rb&#039;
        option vlan &#039;2&#039;
        option ports &#039;0 5t&#039;

config interface &#039;wan2&#039;
        option dns &#039;8.8.8.8&#039;
        option peerdns &#039;0&#039;
        option auto &#039;1&#039;
        option proto &#039;3g&#039;
        option device &#039;/dev/ttyUSB3&#039;
        option apn &#039;darmowy&#039;
        option service &#039;umts_only&#039;
        option mobile_isp &#039;Polska - Aero2&#039;
        option metric &#039;20&#039;

config interface &#039;wan3&#039;
        option dns &#039;208.67.222.220 208.67.220.222&#039;
        option peerdns &#039;0&#039;
        option auto &#039;1&#039;
        option proto &#039;3g&#039;
        option device &#039;/dev/ttyUSB6&#039;
        option apn &#039;darmowy&#039;
        option service &#039;umts_only&#039;
        option mobile_isp &#039;Polska - Aero2&#039;
        option metric &#039;30&#039;

config interface &#039;wan4&#039;
        option ifname &#039;eth1&#039;
        option proto &#039;dhcp&#039;
        option peerdns &#039;0&#039;
        option dns &#039;8.8.4.4&#039;
        option metric &#039;40&#039;</code></pre></div><p>ifconfig -a<br /></p><div class="codebox"><pre><code>root@Gargoyle:~# ifconfig -a
3g-wan    Link encap:Point-to-Point Protocol
          inet addr:93.154.141.132  P-t-P:10.64.64.66  Mask:255.255.255.255
          UP POINTOPOINT RUNNING NOARP MULTICAST  MTU:1500  Metric:1
          RX packets:993 errors:0 dropped:0 overruns:0 frame:0
          TX packets:1137 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:3
          RX bytes:92592 (90.4 KiB)  TX bytes:108802 (106.2 KiB)

3g-wan2   Link encap:Point-to-Point Protocol
          inet addr:78.30.111.180  P-t-P:10.64.64.65  Mask:255.255.255.255
          UP POINTOPOINT RUNNING NOARP MULTICAST  MTU:1500  Metric:1
          RX packets:2090 errors:0 dropped:0 overruns:0 frame:0
          TX packets:2235 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:3
          RX bytes:1317739 (1.2 MiB)  TX bytes:281933 (275.3 KiB)

3g-wan3   Link encap:Point-to-Point Protocol
          inet addr:78.30.83.85  P-t-P:10.64.64.64  Mask:255.255.255.255
          UP POINTOPOINT RUNNING NOARP MULTICAST  MTU:1500  Metric:1
          RX packets:3685 errors:0 dropped:0 overruns:0 frame:0
          TX packets:3146 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:3
          RX bytes:2510801 (2.3 MiB)  TX bytes:568333 (555.0 KiB)

br-lan    Link encap:Ethernet  HWaddr 64:70:02:39:36:C2
          inet addr:192.168.2.1  Bcast:192.168.2.255  Mask:255.255.255.0
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:569866 errors:0 dropped:0 overruns:0 frame:0
          TX packets:582393 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:50335726 (48.0 MiB)  TX bytes:702970499 (670.4 MiB)

eth0      Link encap:Ethernet  HWaddr 64:70:02:39:36:C2
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:570651 errors:0 dropped:0 overruns:60167 frame:0
          TX packets:582528 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:60735055 (57.9 MiB)  TX bytes:705307814 (672.6 MiB)
          Interrupt:4

eth0.1    Link encap:Ethernet  HWaddr 64:70:02:39:36:C2
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:570566 errors:0 dropped:0 overruns:0 frame:0
          TX packets:582527 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:50454992 (48.1 MiB)  TX bytes:702976663 (670.4 MiB)

imq0      Link encap:UNSPEC  HWaddr 00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00
          NOARP  MTU:16000  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:11000
          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)

imq1      Link encap:UNSPEC  HWaddr 00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00
          NOARP  MTU:16000  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:11000
          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)

lo        Link encap:Local Loopback
          inet addr:127.0.0.1  Mask:255.0.0.0
          UP LOOPBACK RUNNING  MTU:16436  Metric:1
          RX packets:11606 errors:0 dropped:0 overruns:0 frame:0
          TX packets:11606 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:882494 (861.8 KiB)  TX bytes:882494 (861.8 KiB)

wlan0     Link encap:Ethernet  HWaddr 64:70:02:39:36:C2
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:2394 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:32
          RX bytes:0 (0.0 B)  TX bytes:268909 (262.6 KiB)

wwan0     Link encap:Ethernet  HWaddr 02:50:F3:00:00:00
          BROADCAST MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)

wwan1     Link encap:Ethernet  HWaddr 02:50:F3:00:00:00
          BROADCAST MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)

wwan2     Link encap:Ethernet  HWaddr 02:50:F3:00:00:00
          BROADCAST MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p198010">
				<div class="post-metadata">
					<div class="post-num">Post #123</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						11 Apr 2013, 12:44					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Bluse-Blue wrote:</cite><blockquote><p>What about setting up a GitHub repo to ease the developement process ?<br />Let me know if you would set up such a repo.</p></blockquote></div><p>GitHub repo is up: <a href="https://github.com/Adze1502/mwan">https://github.com/Adze1502/mwan</a> . svn repo will close down shortly. Please update your &quot;feeds.conf.default&quot; file with the line &quot;src-git mwan git://github.com/Adze1502/mwan.git&quot; and remove the old svn repo.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p198011">
				<div class="post-metadata">
					<div class="post-num">Post #124</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						11 Apr 2013, 12:46					</div>
				</div>
				<div class="post-content content">
					<p>Hi murjak,</p><div class="quotebox"><cite>murjak wrote:</cite><blockquote><p>Hello i have a problem with the package, it won&#039;t start</p></blockquote></div><p>I&#039;d like to help you get this problem fixed. Is there any possibility i could get remote access to your router?</p><p>Thnx!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p198048">
				<div class="post-metadata">
					<div class="post-num">Post #125</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						11 Apr 2013, 19:05					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>murjak wrote:</cite><blockquote><p>Hello i have a problem with the package, it won&#039;t start</p><p>it gives me the following errors:<br /></p><div class="codebox"><pre><code>root@Gargoyle:~# /etc/init.d/mwan3 restart</code></pre></div></blockquote></div><p>There is no restart function in that init script. Only a start which initializes &quot;/usr/sbin/mwan3 mwan_apply&quot; at the end of boot time.</p><p>Adze,<br />Perhaps a stop/restart could be introduced which also kills off any mwantrack processes?<br /></p><div class="codebox"><pre><code>stop() {

    # code to kill off mwan processes and revert changes

}

restart() {

    stop
    start

}</code></pre></div>											<p class="post-edited">(Last edited by <strong>arfett</strong> on 11 Apr 2013, 19:09)</p>
									</div>
			</article>

			
		
						<div class="notice">
				<p>Sorry, posts 126 to 125 are missing from our archive.</p>
			</div>
		
		
	
	<div class="pagination"><div class="pagination-number">Page 5 of 65</div><nav><ul><li><a href="viewtopic.php%3Fid=39052&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=3.html">3</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=4.html">4</a></li><li class="pagination-current"><span>5</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=6.html">6</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=7.html">7</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=65.html">65</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>