<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Unable to adhoc wrt54g v2.2 BCM 4712 WLAN rev 7 - backfire 10.03.1</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 4 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p160988">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">HeXiLeD</div>
					<div class="post-datetime">
						15 Mar 2012, 20:20					</div>
				</div>
				<div class="post-content content">
					<p>I have been having a problem here that has been keepijng up for a lot of hours as i cannot seem to adhoc the router.</p><p>Model: Linksys wrt54g v2.2<br />Firmware 10.03.1</p><p>I have tried several firmwares all the way down to kamikaze and also another router (asus wl 500 gp v2 - BCM5354 chip rev 2)</p><p><strong>Problem:</strong></p><p>When i set the router to adhoc mode the router announces 54g but once i connect to it the Max Rate turns to 11b for the client and the router too. At that moment the router announces only 11b but works slows than 33k dial up.</p><p>At the same time i cannot even access youtube or any light browsing. My best result was with kamikaze 8.09.2 kernel 2.4 for the asus router which gave me 1mbit for bandwidth test but also turned 54g into 11b.<br />I also tried both b43 and wl drivers and i am out of ideas.&nbsp; If anyone can replicate (or not) the same with these configs it may help understand where the problem is. <br />I also exhausted all web searches for solutions or looking for similar problem. I am unable to understand why i cannot use a simple adhoc&nbsp; configuration without routing protocol from the the netbook&nbsp; Eeepc 1015 PED-MU17 with Broadcom Corporation BCM4313 802.11b/g/n Wireless LAN Controller (rev 01) to the router.</p><p><strong>Here are some infos:</strong></p><div class="codebox"><pre><code>~# dmesg 
Linux version 2.6.32.27 (m@box) (gcc version 4.3.3 (GCC) ) #1 Wed Mar 14 03:29:17 EDT 2012
CPU revision is: 00029007 (Broadcom BCM3302)
ssb: Core 0 found: ChipCommon (cc 0x800, rev 0x09, vendor 0x4243)
ssb: Core 1 found: IEEE 802.11 (cc 0x812, rev 0x07, vendor 0x4243)
ssb: Core 2 found: Fast Ethernet (cc 0x806, rev 0x07, vendor 0x4243)
ssb: Core 3 found: USB 1.1 Device (cc 0x818, rev 0x01, vendor 0x4243)
ssb: Core 4 found: USB 1.1 Host (cc 0x817, rev 0x01, vendor 0x4243)
ssb: Core 5 found: MIPS 3302 (cc 0x816, rev 0x01, vendor 0x4243)
ssb: Core 6 found: MEMC SDRAM (cc 0x80F, rev 0x01, vendor 0x4243)
ssb: Core 7 found: PCI (cc 0x804, rev 0x0A, vendor 0x4243)
ssb: chipcommon status is 0x0
ssb: Initializing MIPS core...
ssb: set_irq: core 0x0812, irq 4 =&gt; 4
ssb: set_irq: core 0x0806, irq 5 =&gt; 5
ssb: set_irq: core 0x0818, irq 6 =&gt; 2
ssb: set_irq: core 0x0804, irq 2 =&gt; 6
ssb: after irq reconfiguration
ssb: core 0x0800, irq : 2(S)  3* 4  5  6  D  I 
ssb: core 0x0812, irq : 2(S)  3  4* 5  6  D  I 
ssb: core 0x0806, irq : 2(S)  3  4  5* 6  D  I 
ssb: core 0x0818, irq : 2(S)* 3  4  5  6  D  I 
ssb: core 0x0817, irq : 2(S)* 3  4  5  6  D  I 
ssb: core 0x0816, irq : 2(S)* 3  4  5  6  D  I 
ssb: core 0x080f, irq : 2(S)  3  4  5  6  D  I*
ssb: core 0x0804, irq : 2(S)  3  4  5  6* D  I 
ssb: Sonics Silicon Backplane found at address 0x18000000
Serial init done.
Determined physical RAM map:
 memory: 01000000 @ 00000000 (usable)
Initrd not found or empty - disabling initrd
Zone PFN ranges:
  Normal   0x00000000 -&gt; 0x00001000
Movable zone start PFN for each node
early_node_map[1] active PFN ranges
    0: 0x00000000 -&gt; 0x00001000
On node 0 totalpages: 4096
free_area_init_node: node 0, pgdat 80289e60, node_mem_map 802cf000
  Normal zone: 32 pages used for memmap
  Normal zone: 0 pages reserved
  Normal zone: 4064 pages, LIFO batch:0
Built 1 zonelists in Zone order, mobility grouping off.  Total pages: 4064
Kernel command line: root=/dev/mtdblock2 rootfstype=squashfs,jffs2 noinitrd console=ttyS0,115200
PID hash table entries: 64 (order: -4, 256 bytes)
Dentry cache hash table entries: 2048 (order: 1, 8192 bytes)
Inode-cache hash table entries: 1024 (order: 0, 4096 bytes)
Primary instruction cache 8kB, VIPT, 2-way, linesize 16 bytes.
Primary data cache 4kB, 2-way, VIPT, no aliases, linesize 16 bytes
Memory: 13348k/16384k available (2248k kernel code, 3036k reserved, 348k data, 136k init, 0k highmem)
Hierarchical RCU implementation.
NR_IRQS:128
console [ttyS0] enabled
Calibrating delay loop... 214.52 BogoMIPS (lpj=429056)
Mount-cache hash table entries: 512
NET: Registered protocol family 16
bio: create slab &lt;bio-0&gt; at 0
Switching to clocksource MIPS
NET: Registered protocol family 2
IP route cache hash table entries: 1024 (order: 0, 4096 bytes)
TCP established hash table entries: 512 (order: 0, 4096 bytes)
TCP bind hash table entries: 512 (order: -1, 2048 bytes)
TCP: Hash tables configured (established 512 bind 512)
TCP reno registered
NET: Registered protocol family 1
squashfs: version 4.0 (2009/01/31) Phillip Lougher
Registering mini_fo version $Id$
JFFS2 version 2.2. (NAND) (SUMMARY)  Â© 2001-2006 Red Hat, Inc.
msgmni has been set to 26
io scheduler noop registered
io scheduler deadline registered (default)
Serial: 8250/16550 driver, 2 ports, IRQ sharing enabled
serial8250: ttyS0 at MMIO 0xb8000300 (irq = 3) is a 16550A
serial8250: ttyS1 at MMIO 0xb8000400 (irq = 3) is a 16550A
serial8250.0: ttyS0 at MMIO 0xb8000300 (irq = 3) is a 16550A
serial8250.0: ttyS1 at MMIO 0xb8000400 (irq = 3) is a 16550A
flash init: 0x1c000000 0x02000000
Physically mapped flash: Found 1 x16 devices at 0x0 in 16-bit bank
Physically mapped flash: Found an alias at 0x400000 for the chip at 0x0
Physically mapped flash: Found an alias at 0x800000 for the chip at 0x0
Physically mapped flash: Found an alias at 0xc00000 for the chip at 0x0
Physically mapped flash: Found an alias at 0x1000000 for the chip at 0x0
Physically mapped flash: Found an alias at 0x1400000 for the chip at 0x0
Physically mapped flash: Found an alias at 0x1800000 for the chip at 0x0
Physically mapped flash: Found an alias at 0x1c00000 for the chip at 0x0
 Intel/Sharp Extended Query Table at 0x0035
Using auto-unlock on power-up/resume
cfi_cmdset_0001: Erase suspend on write enabled
erase region 0: offset=0x0,size=0x2000,blocks=8
erase region 1: offset=0x10000,size=0x10000,blocks=63
Flash device: 0x400000 at 0x1fc00000
bootloader size: 262144
Creating 4 MTD partitions on &quot;Physically mapped flash&quot;:
0x000000000000-0x000000040000 : &quot;cfe&quot;
0x000000040000-0x0000003f0000 : &quot;linux&quot;
0x000000114400-0x0000003f0000 : &quot;rootfs&quot;
mtd: partition &quot;rootfs&quot; must either start or end on erase block boundary or be smaller than an erase block -- forcing read-only
mtd: partition &quot;rootfs&quot; set to be root filesystem
mtd: partition &quot;rootfs_data&quot; created automatically, ofs=300000, len=F0000 
0x000000300000-0x0000003f0000 : &quot;rootfs_data&quot;
0x0000003f0000-0x000000400000 : &quot;nvram&quot;
b44.c:v2.0
eth0: Broadcom 44xx/47xx 10/100BaseT Ethernet 00:12:17:be:f9:46
BCM47xx Watchdog Timer enabled (30 seconds, nowayout)
TCP westwood registered
NET: Registered protocol family 17
802.1Q VLAN Support v1.8 Ben Greear &lt;greearb@candelatech.com&gt;
All bugs added by David S. Miller &lt;davem@redhat.com&gt;
VFS: Mounted root (squashfs filesystem) readonly on device 31:2.
Freeing unused kernel memory: 136k freed
Please be patient, while OpenWrt loads ...
diag: Detected &#039;Linksys WRT54G/GS/GL&#039;
b44: eth0: Link is up at 100 Mbps, full duplex.
b44: eth0: Flow control is off for TX and off for RX.
roboswitch: Probing device eth0: found a 5325! It&#039;s a 5350.
mini_fo: using base directory: /
mini_fo: using storage directory: /overlay
b44: eth0: powering down PHY
b44: eth0: Link is up at 100 Mbps, full duplex.
b44: eth0: Flow control is off for TX and off for RX.
device eth0.0 entered promiscuous mode
device eth0 entered promiscuous mode
br-lan: port 1(eth0.0) entering forwarding state
Compat-wireless backport release: compat-wireless-2011-11-29
Backport based on wireless-testing.git master-2011-12-01
cfg80211: Calling CRDA to update world regulatory domain
b43-phy0: Broadcom 4712 WLAN found (core revision 7)
ieee80211 phy0: Selected rate control algorithm &#039;minstrel_ht&#039;
Registered led device: b43-phy0::tx
Registered led device: b43-phy0::rx
Registered led device: b43-phy0::radio
Broadcom 43xx driver loaded [ Features: PL ]
ip_tables: (C) 2000-2006 Netfilter Core Team
cfg80211: World regulatory domain updated:
cfg80211:     (start_freq - end_freq @ bandwidth), (max_antenna_gain, max_eirp)
cfg80211:     (2402000 KHz - 2472000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)
cfg80211:     (2457000 KHz - 2482000 KHz @ 20000 KHz), (300 mBi, 2000 mBm)
cfg80211:     (2474000 KHz - 2494000 KHz @ 20000 KHz), (300 mBi, 2000 mBm)
cfg80211:     (5170000 KHz - 5250000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)
cfg80211:     (5735000 KHz - 5835000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)
nf_conntrack version 0.5.0 (210 buckets, 840 max)
batman_adv: B.A.T.M.A.N. advanced 2012.0.0 (compatibility version 14) loaded
cfg80211: Calling CRDA for country: US
cfg80211: Regulatory domain changed to country: US
cfg80211:     (start_freq - end_freq @ bandwidth), (max_antenna_gain, max_eirp)
cfg80211:     (2402000 KHz - 2472000 KHz @ 40000 KHz), (300 mBi, 2700 mBm)
cfg80211:     (5170000 KHz - 5250000 KHz @ 40000 KHz), (300 mBi, 1700 mBm)
cfg80211:     (5250000 KHz - 5330000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)
cfg80211:     (5490000 KHz - 5600000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)
cfg80211:     (5650000 KHz - 5710000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)
cfg80211:     (5735000 KHz - 5835000 KHz @ 40000 KHz), (300 mBi, 3000 mBm)
b43-phy0: Loading firmware version 508.1084 (2009-01-14 01:32:01)
wlan0: Creating new IBSS network, BSSID 02:16:b8:6b:0a:1a</code></pre></div><div class="codebox"><pre><code>~# lsmod 
Module                  Size  Used by    Not tainted
batman_adv            105408  0 
nf_nat_tftp              432  0 
nf_conntrack_tftp       2400  1 nf_nat_tftp
nf_nat_irc               864  0 
nf_conntrack_irc        2592  1 nf_nat_irc
nf_nat_ftp              1360  0 
nf_conntrack_ftp        4896  1 nf_nat_ftp
ipt_MASQUERADE           992  1 
iptable_nat             2304  1 
nf_nat                 11824  5 nf_nat_tftp,nf_nat_irc,nf_nat_ftp,ipt_MASQUERADE,iptable_nat
xt_NOTRACK               672  0 
iptable_raw              656  1 
xt_state                 800  3 
nf_conntrack_ipv4       7808  6 iptable_nat,nf_nat
nf_defrag_ipv4           608  1 nf_conntrack_ipv4
nf_conntrack           42560 12 nf_nat_tftp,nf_conntrack_tftp,nf_nat_irc,nf_conntrack_irc,nf_nat_ftp,nf_conntrack_ftp,ipt_MASQUERADE,iptable_nat,nf_nat,xt_NOTRACK,xt_state,nf_conntrack_ipv4
ipt_REJECT              1984  2 
xt_TCPMSS               1952  1 
ipt_LOG                 4640  0 
xt_comment               464  0 
xt_multiport            1904  0 
xt_mac                   576  0 
xt_limit                1152  1 
iptable_mangle           992  1 
iptable_filter           768  1 
ip_tables               8864  4 iptable_nat,iptable_raw,iptable_mangle,iptable_filter
xt_tcpudp               1856  5 
x_tables                9840 13 ipt_MASQUERADE,iptable_nat,xt_NOTRACK,xt_state,ipt_REJECT,xt_TCPMSS,ipt_LOG,xt_comment,xt_multiport,xt_mac,xt_limit,ip_tables,xt_tcpudp
b43                   151056  0 
mac80211              260560  1 b43
crc16                    976  1 batman_adv
cfg80211              149136  2 b43,mac80211
compat                 13312  3 b43,mac80211,cfg80211
arc4                     816  2 
aes_generic            31056  0 
deflate                 1328  0 
ecb                     1328  0 
cbc                     2016  0 
switch_robo             4208  0 
switch_core             5216  1 switch_robo
diag                    7504  0</code></pre></div><div class="codebox"><pre><code>~# iw list
Wiphy phy0
        Band 1:
                Frequencies:
                        * 2412 MHz [1] (27.0 dBm)
                        * 2417 MHz [2] (27.0 dBm)
                        * 2422 MHz [3] (27.0 dBm)
                        * 2427 MHz [4] (27.0 dBm)
                        * 2432 MHz [5] (27.0 dBm)
                        * 2437 MHz [6] (27.0 dBm)
                        * 2442 MHz [7] (27.0 dBm)
                        * 2447 MHz [8] (27.0 dBm)
                        * 2452 MHz [9] (27.0 dBm)
                        * 2457 MHz [10] (27.0 dBm)
                        * 2462 MHz [11] (27.0 dBm)
                        * 2467 MHz [12] (disabled)
                        * 2472 MHz [13] (disabled)
                        * 2484 MHz [14] (disabled)
                Bitrates (non-HT):
                        * 1.0 Mbps
                        * 2.0 Mbps (short preamble supported)
                        * 5.5 Mbps (short preamble supported)
                        * 11.0 Mbps (short preamble supported)
                        * 6.0 Mbps
                        * 9.0 Mbps
                        * 12.0 Mbps
                        * 18.0 Mbps
                        * 24.0 Mbps
                        * 36.0 Mbps
                        * 48.0 Mbps
                        * 54.0 Mbps
        max # scan SSIDs: 4
        max scan IEs length: 2285 bytes
        Coverage class: 0 (up to 0m)
        Available Antennas: TX 0x3 RX 0x3
        Configured Antennas: TX 0x1 RX 0x1
        Supported interface modes:
                 * IBSS
                 * managed
                 * AP
                 * AP/VLAN
                 * WDS
                 * monitor
                 * mesh point
        Supported commands:
                 * new_interface
                 * set_interface
                 * new_key
                 * new_beacon
                 * new_station
                 * new_mpath
                 * set_mesh_params
                 * set_bss
                 * authenticate
                 * associate
                 * deauthenticate
                 * disassociate
                 * join_ibss
                 * join_mesh
                 * remain_on_channel
                 * set_tx_bitrate_mask
                 * action
                 * frame_wait_cancel
                 * set_wiphy_netns
                 * set_channel
                 * set_wds_peer
                 * Unknown command (84)
                 * Unknown command (87)
                 * Unknown command (85)
                 * connect
                 * disconnect
        Supported TX frame types:
                 * IBSS: 0x0000 0x0010 0x0020 0x0030 0x0040 0x0050 0x0060 0x0070 0x0080 0x0090 0x00a0 0x00b0 0x00c0 0x00d0 0x00e0 0x00f0
                 * managed: 0x0000 0x0010 0x0020 0x0030 0x0040 0x0050 0x0060 0x0070 0x0080 0x0090 0x00a0 0x00b0 0x00c0 0x00d0 0x00e0 0x00f0
                 * AP: 0x0000 0x0010 0x0020 0x0030 0x0040 0x0050 0x0060 0x0070 0x0080 0x0090 0x00a0 0x00b0 0x00c0 0x00d0 0x00e0 0x00f0
                 * AP/VLAN: 0x0000 0x0010 0x0020 0x0030 0x0040 0x0050 0x0060 0x0070 0x0080 0x0090 0x00a0 0x00b0 0x00c0 0x00d0 0x00e0 0x00f0
                 * mesh point: 0x0000 0x0010 0x0020 0x0030 0x0040 0x0050 0x0060 0x0070 0x0080 0x0090 0x00a0 0x00b0 0x00c0 0x00d0 0x00e0 0x00f0
                 * P2P-client: 0x0000 0x0010 0x0020 0x0030 0x0040 0x0050 0x0060 0x0070 0x0080 0x0090 0x00a0 0x00b0 0x00c0 0x00d0 0x00e0 0x00f0
                 * P2P-GO: 0x0000 0x0010 0x0020 0x0030 0x0040 0x0050 0x0060 0x0070 0x0080 0x0090 0x00a0 0x00b0 0x00c0 0x00d0 0x00e0 0x00f0
        Supported RX frame types:
                 * IBSS: 0x00d0
                 * managed: 0x0040 0x00d0
                 * AP: 0x0000 0x0020 0x0040 0x00a0 0x00b0 0x00c0 0x00d0
                 * AP/VLAN: 0x0000 0x0020 0x0040 0x00a0 0x00b0 0x00c0 0x00d0
                 * mesh point: 0x00b0 0x00c0 0x00d0
                 * P2P-client: 0x0040 0x00d0
                 * P2P-GO: 0x0000 0x0020 0x0040 0x00a0 0x00b0 0x00c0 0x00d0</code></pre></div><div class="codebox"><pre><code># iw reg get
country US:
        (2402 - 2472 @ 40), (3, 27)
        (5170 - 5250 @ 40), (3, 17)
        (5250 - 5330 @ 40), (3, 20), DFS
        (5490 - 5600 @ 40), (3, 20), DFS
        (5650 - 5710 @ 40), (3, 20), DFS
        (5735 - 5835 @ 40), (3, 30)</code></pre></div><div class="codebox"><pre><code># NETWORK

#### VLAN configuration
config switch eth0
        option enable   1

config switch_vlan eth0_0
        option device   &quot;eth0&quot;
        option vlan     0
        option ports    &quot;1 2 3 4 5&quot;

config switch_vlan eth0_1
        option device   &quot;eth0&quot;
        option vlan     1
        option ports    &quot;0 5&quot;

#### Loopback configuration
config interface loopback
        option ifname   &quot;lo&quot;
        option proto    static
        option ipaddr   127.0.0.1
        option netmask  255.0.0.0


#### LAN configuration
config interface lan
        option type     bridge
        option ifname   &quot;eth0.0&quot;
        option proto    static
        #option ipaddr  10.0.0.1
        #option netmask 255.255.0.0
        #option broadcast 10.0.255.255
        option ipaddr   192.168.1.1
        option netmask  255.255.255.0
        option broadcast 192.168.1.255
        #option dns      208.67.222.222,208.67.220.220</code></pre></div><div class="codebox"><pre><code>#### WAN configuration
config interface        wan
        option ifname   &quot;eth0.1&quot;
        option proto    dhcp



## WIRELESS

config wifi-device      radio0
        option type     mac80211
        option channel  11
        option phy      phy0
        option hwmode   11g
        option country  US
        option txpower  20
        option diversity 1
        option rxantenna 1              #(comment for driver default)
        option txantenna 1              #(comment for driver default)
        option disabled  0

        #option distance 5000           #(trunk)
        #option basic_rate 54000        #(trunk)
        #option beacon_int 10000        #(trunk)

        # For N capable Routers
        # Note: cannot use HT40+ with channel 11 = 11+4 = 15
        # ht &#039;40&#039; modes are for N frequencies

        #option htmode  HT20            #(comment for driver default)
        #list ht_capab  SHORT-GI-40     #(comment for driver default)
        #list ht_capab  DSSS_CCK-40     #(comment for driver default)

config wifi-iface
        option device   radio0
        option network  lan
        option hidden   0
        option mode     adhoc
        option ssid     openwireless
        option bssid    02:16:b8:6b:0a:1a
        #mcast_rate     5500            #(trunk)
        option encryption none</code></pre></div><div class="codebox"><pre><code># DHCP 
config dnsmasq
        option domainneeded     1
        option boguspriv        1
        option filterwin2k      0       # enable for dial on demand
        option localise_queries 1
        option rebind_protection 1      # disable if upstream must serve RFC1918 add resses
        option rebind_localhost 1       # enable for RBL checking and similar services

        #list rebind_domain example.lan # whitelist RFC1918 responses for domains

        option local            &#039;/lan/&#039;
        option domain           &#039;some.net&#039;
        option expandhosts      1
        option nonegcache       0
        option authoritative    1
        option readethers       1
        option leasefile        &#039;/tmp/dhcp.leases&#039;
        option resolvfile       &#039;/tmp/resolv.conf.auto&#039;
        #list server            &#039;/mycompany.local/1.2.3.4&#039;
        #option nonwildcard     1
        #list interface         br-lan
        #list notinterface      lo
        #list bogusnxdomain     &#039;64.94.110.11&#039;

config dhcp lan
        option interface        lan
        option start            51
        option limit            251
        option leasetime        24h

config dhcp wan
        option interface        wan
        option ignore           1
        option domain           some.net</code></pre></div><div class="codebox"><pre><code>~# cat /etc/config/firewall 
config defaults
        option syn_flood        1
        option input            ACCEPT
        option output           ACCEPT 
        option forward          REJECT
# Uncomment this line to disable ipv6 rules
        option disable_ipv6     1

config zone
        option name             lan
        option network          lan
        option input            ACCEPT 
        option output           ACCEPT 
        option forward          REJECT

config zone
        option name             wan
        option network          wan
        option input            REJECT
        option output           ACCEPT 
        option forward          REJECT
        option masq             1 
        option mtu_fix          1

config forwarding 
        option src              lan
        option dest             wan

# We need to accept udp packets on port 68,
# see https://dev.openwrt.org/ticket/4108
config rule
        option name             Allow-DHCP-Renew
        option src              wan
        option proto            udp
        option dest_port        68
        option target           ACCEPT
        option family           ipv4

# Allow IPv4 ping
config rule
        option name             Allow-Ping
        option src              wan
        option proto            icmp
        option icmp_type        echo-request
        option family           ipv4
        option target           ACCEPT

# SSH wan/lan/wlan
config rule
        option target ACCEPT
#       option src wan
        option proto tcp
        option dest_port 22

# include a file with users custom iptables rules
config include
        option path /etc/firewall.user</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p161218">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">HeXiLeD</div>
					<div class="post-datetime">
						17 Mar 2012, 23:57					</div>
				</div>
				<div class="post-content content">
					<p>The problem still remains but at least 50% was solved.</p><div class="quotebox"><blockquote><p>When i set the router to adhoc mode the router announces 54g but once i connect to it the Max Rate turns to 11b for the client and the router too.</p></blockquote></div><p>I found out that this was caused by the driver default settings on the computer. It is now set to auto and 54g works as it should.</p><p>As for adhoc:</p><div class="codebox"><pre><code># ifconfig br-lan down;
# brctl delbr br-lan</code></pre></div><p>Gets adhoc working. However after reboot br-lan get created again from <strong>/etc/config/network</strong>.<br />Removing the line: <br /></p><div class="codebox"><pre><code>&quot;option type bridge&quot;</code></pre></div><p>Prevents br-lan to be re-created but also does not make adhoc working so something must be missing.</p><p>Since google finds NO working config setup (uci) anywhere for this and no ONE seems to know. i feel like Columbus <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p161254">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						18 Mar 2012, 12:33					</div>
				</div>
				<div class="post-content content">
					<p>Your ad-hoc network still references lan. Simply remove &quot;option network lan&quot; to unbridge it.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p161299">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">HeXiLeD</div>
					<div class="post-datetime">
						19 Mar 2012, 00:07					</div>
				</div>
				<div class="post-content content">
					<p>I am afraid that option does not solve the problem. I applied the advice to my builds as well as official builds and the outcome was still not 100% satisfactory.</p><p>When i removed <strong>option network lan</strong> from <em>/etc/wireless</em> (since it was still there; i was able to use the wired connection which was progress but while i was able to connect to the wireless interface; i was not able to obtain dhcp address.<br />This lead me to play with configurations up to the point of creating a wlan interface with it&#039;s own dhcp setup. Maybe i failed to properly do it but i still was not able to have the problem solved.</p><p>I removed and played with that option in several configs but still without success. However as stated at least it got the wired interface working properly.</p><p><strong>Question:</strong><br />By totally removing wlan from any attachment to lan; how will wlan use dhcp without any further configuration ?</p><p>Perhaps i am failing big time here but this problem has been eating all my full time and it is driving me nuts for a simple ad-hoc setup.</p>											<p class="post-edited">(Last edited by <strong>HeXiLeD</strong> on 19 Mar 2012, 00:07)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p161472">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">HeXiLeD</div>
					<div class="post-datetime">
						20 Mar 2012, 08:39					</div>
				</div>
				<div class="post-content content">
					<p>I have been days around this now. Does anyone even have basic ad-hoc working with 10.03.1 ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p162041">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">HeXiLeD</div>
					<div class="post-datetime">
						25 Mar 2012, 01:52					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>jow wrote:</cite><blockquote><p>Your ad-hoc network still references lan. Simply remove &quot;option network lan&quot; to unbridge it.</p></blockquote></div><p>The only way i was ble to adhoc it now was by doing what i did not wanted to start with which meas having 2 subnets.<br />Initially i wanted to have adhoc working just with one subnet. (192.168.1.1 - class C)</p><p>However if i <strong>unbrigde</strong> one subnet does not seem to be possible. How will the wlan interface reach the WAN ?</p><p>So i configured it for 2 subnets&nbsp; according this wiki page.<br /><a href="http://wiki.openwrt.org/doc/recipes/routedap">http://wiki.openwrt.org/doc/recipes/routedap</a></p><p>Adhoc is working for 2 routers and they can connect to each other as well having me connected to them wired and wireless.<br />However 1 problem remains</p><div class="codebox"><pre><code>Router1 lan 192.68.1.1
Router1 wlan 172.16.0.1

Router2 lan 192.168.1.2
router2 wlan 172.16.0.2</code></pre></div><p>Whether i am connected to router one or 2 i can only ping from lan to lan and wlan to wlan.<br />I cannot ping from router1 lan to router2 wlan and vice versa.<br />BUT in within the same router i can ping lan and wlan.</p><p>Additionally from router 2 (not gw) i cannot access WAN while on router1 i can.<br />Also batman-adv is able to ping the other router mac. </p><br /><br /><p>My forwarding&nbsp; firewall rules are as follow (on top of default setup):</p><div class="codebox"><pre><code># cat /etc/config/firewall

config &#039;defaults&#039;
        option &#039;syn_flood&#039; &#039;1&#039;
        option &#039;input&#039; &#039;ACCEPT&#039;
        option &#039;output&#039; &#039;ACCEPT&#039;
        option &#039;forward&#039; &#039;REJECT&#039;
        option &#039;disable_ipv6&#039; &#039;1&#039;

config &#039;zone&#039;
        option &#039;name&#039; &#039;lan&#039;
        option &#039;network&#039; &#039;lan&#039;
        option &#039;input&#039; &#039;ACCEPT&#039;
        option &#039;output&#039; &#039;ACCEPT&#039;
        option &#039;forward&#039; &#039;REJECT&#039;

config &#039;zone&#039;
        option &#039;name&#039; &#039;wifi&#039;
        option &#039;network&#039; &#039;wifi&#039;
        option &#039;input&#039; &#039;ACCEPT&#039;
        option &#039;output&#039; &#039;ACCEPT&#039;
        option &#039;forward&#039; &#039;REJECT&#039;


config &#039;zone&#039;
        option &#039;name&#039; &#039;wan&#039;
        option &#039;network&#039; &#039;wan&#039;
        option &#039;input&#039; &#039;REJECT&#039;
        option &#039;output&#039; &#039;ACCEPT&#039;
        option &#039;forward&#039; &#039;REJECT&#039;
        option &#039;masq&#039; &#039;1&#039;

config &#039;forwarding&#039;
        option &#039;src&#039; &#039;lan&#039;
        option &#039;dest&#039; &#039;wan&#039;

config &#039;forwarding&#039;
        option &#039;src&#039; &#039;wifi&#039;
        option &#039;dest&#039; &#039;wan&#039;

config &#039;forwarding&#039;
        option &#039;src&#039; &#039;lan&#039;
        option &#039;dest&#039; &#039;wifi&#039;

config &#039;forwarding&#039;
        option &#039;src&#039; &#039;wifi&#039;
        option &#039;dest&#039; &#039;lan&#039;

config &#039;rule&#039;
        option &#039;name&#039; &#039;Allow-DHCP-Renew&#039;
        option &#039;src&#039; &#039;wan&#039;
        option &#039;proto&#039; &#039;udp&#039;
        option &#039;dest_port&#039; &#039;68&#039;
        option &#039;target&#039; &#039;ACCEPT&#039;
        option &#039;family&#039; &#039;ipv4&#039;

config &#039;rule&#039;
        option &#039;name&#039; &#039;Allow-Ping&#039;
        option &#039;src&#039; &#039;wan&#039;
        option &#039;proto&#039; &#039;icmp&#039;
        option &#039;icmp_type&#039; &#039;echo-request&#039;
        option &#039;family&#039; &#039;ipv4&#039;
        option &#039;target&#039; &#039;ACCEPT&#039;

config &#039;rule&#039;
        option &#039;target&#039; &#039;ACCEPT&#039;
        option &#039;src&#039; &#039;wan&#039;
        option &#039;proto&#039; &#039;tcp&#039;
        option &#039;dest_port&#039; &#039;22&#039;

config &#039;include&#039;
        option &#039;path&#039; &#039;/etc/firewall.user&#039;</code></pre></div><p>My questions are:</p><p>Am i missing out something for firewall rules or is this setup missing a <strong>bridge</strong>&nbsp; somewhere&nbsp; or it needs the routing protocol to take care of the rest ?</p>											<p class="post-edited">(Last edited by <strong>HeXiLeD</strong> on 25 Mar 2012, 04:45)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>