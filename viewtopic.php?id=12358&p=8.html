<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Support for Marvell 88F5xx81 based routers</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 18 Jan 2014 and 6 May 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 8 of 46</div><nav><ul><li><a href="viewtopic.php%3Fid=12358&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=12358&amp;p=6.html">6</a></li><li><a href="viewtopic.php%3Fid=12358&amp;p=7.html">7</a></li><li class="pagination-current"><span>8</span></li><li><a href="viewtopic.php%3Fid=12358&amp;p=9.html">9</a></li><li><a href="viewtopic.php%3Fid=12358&amp;p=10.html">10</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=12358&amp;p=46.html">46</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p74628">
				<div class="post-metadata">
					<div class="post-num">Post #176</div>
					<div class="post-author">jake1981</div>
					<div class="post-datetime">
						13 Oct 2008, 16:36					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ll propably buy one from U.S. by using ebay when openwrt is up and running on this hardware, some dealers there seem to be shipping worldwide, although, then it&#039;s version 1.0 - btw. what kind of power currency is used in U.S. ? In Finland we have 230 volts..</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p74631">
				<div class="post-metadata">
					<div class="post-num">Post #177</div>
					<div class="post-author">neb</div>
					<div class="post-datetime">
						13 Oct 2008, 18:13					</div>
				</div>
				<div class="post-content content">
					<p>if you know someone in France, just know that every &quot;Fnac&quot; reseller where i went still sell the box...<br />(you have to know that the WT350n have been only put on the french market on november 2007...)</p><p><a href="http://micro-informatique.fnac.com/a2166932/Reseau-Routeurs-LinkSys-routeur-sans-fil-N-WRT350N?Mn=-1&amp;Mu=-13&amp;Ra=-5000&amp;To=0&amp;Nu=1&amp;Fr=0">http://micro-informatique.fnac.com/a216 … 1&amp;Fr=0</a></p><p>but in france it&#039;s very expansive, due to taxe</p>											<p class="post-edited">(Last edited by <strong>neb</strong> on 13 Oct 2008, 18:14)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p74650">
				<div class="post-metadata">
					<div class="post-num">Post #178</div>
					<div class="post-author">relghuar</div>
					<div class="post-datetime">
						13 Oct 2008, 22:45					</div>
				</div>
				<div class="post-content content">
					<p>I know exactly how you feel - just found out today that probably noone in Slovakia sells them anymore <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> and it&#039;s just a little over 2 months as I bought the first one.<br />But that&#039;s not why I&#039;m writing here, again. I found out that JTAG communication with an ARM processor is &quot;just a little bit&quot; different than with MIPS. I&#039;ll have to study it a bit. For now I&#039;ve managed to get OpenOCD to detect the Marvell processor and initialize successfully, but I&#039;m stuck again on the &quot;halt&quot; command - it times out every time. My modified openocd.cfg:<br /></p><div class="codebox"><pre><code>telnet_port 4444
gdb_port 3333

# interface
interface ft2232
ft2232_layout oocdlink
ft2232_vid_pid 0x0403 0x6010
ft2232_device_desc &quot;Dual RS232 A&quot;

jtag_speed 0x3E8
jtag_nsrst_delay 200
jtag_ntrst_delay 200

reset_config trst_and_srst separate trst_push_pull srst_push_pull

jtag_device 4 0x1 0xffffffff 0x07926041

#target feroceon little 0
target create 88f5181 feroceon -endian little
targets

flash bank cfi 0xff800000 0x00800000 1 1 0

init</code></pre></div><p>Output with no debug after initialization:<br /></p><div class="codebox"><pre><code>NightWolf@toaster-m4/c/Installs/Hardware/JTAG/openocd/1041/src$ ./openocd
Open On-Chip Debugger 1.0 (2008-10-13-14:41) svn:1041M


BUGS? Read http://svn.berlios.de/svnroot/repos/openocd/trunk/BUGS


$URL: svn://svn.berlios.de/openocd/trunk/src/openocd.c $
jtag_speed: 1000
    CmdName    Type       Endian     ChainPos State
--  ---------- ---------- ---------- -------- ----------
 0: 88f5181    feroceon   little            0 unknown
Info:   JTAG device found: 0x07926041 (Manufacturer: 0x020, Part: 0x7926, Version: 0x0)
Error:  unknown EmbeddedICE version (comms ctrl: 0x00000018)
Warning:no tcl port specified, using default port 6666</code></pre></div><p>- I have no idea what the EmbeddedICE version error means.<br />Output from following halt command:<br /></p><div class="codebox"><pre><code>Info:   accepting &#039;telnet&#039; connection from 0
Error:  timed out while waiting for target halted
Runtime error, file &quot;command.c&quot;, line 436:</code></pre></div><p>If I turn on debug mode and don&#039;t call &quot;poll off&quot; right after the &quot;init&quot; command I get a neverending loop:<br /></p><div class="codebox"><pre><code>Debug:   167 733 jtag.c:1117 jtag_build_buffer(): fields[0].out_value: 0x00000004
Debug:   168 736 jtag.c:1117 jtag_build_buffer(): fields[1].out_value: 0x01
Debug:   169 739 jtag.c:1117 jtag_build_buffer(): fields[2].out_value: 0x00
Debug:   170 741 ft2232.c:1347 ft2232_execute_queue(): DR scan, 38 bit, end in 8
Debug:   171 744 jtag.c:1117 jtag_build_buffer(): fields[0].out_value: 0x00000004
Debug:   172 747 jtag.c:1117 jtag_build_buffer(): fields[1].out_value: 0x04
Debug:   173 749 jtag.c:1117 jtag_build_buffer(): fields[2].out_value: 0x00
Debug:   174 752 ft2232.c:1347 ft2232_execute_queue(): DR scan, 38 bit, end in 8
Debug:   175 773 jtag.c:1151 jtag_read_buffer(): fields[0].in_value: 0x00000004</code></pre></div><p>And then something very similar after &quot;halt&quot;:<br /></p><div class="codebox"><pre><code>Info:    171 8703 server.c:84 add_connection(): accepting &#039;telnet&#039; connection from 0
Debug:   173 10195 command.c:82 script_command(): script_command - halt
Debug:   174 10197 command.c:99 script_command(): script_command - halt, argv[0]=ocd_halt
Debug:   175 10199 target.c:1789 handle_halt_command(): -
Debug:   176 10201 arm7_9_common.c:979 arm7_9_halt(): target-&gt;state: running
Debug:   177 10203 embeddedice.c:403 embeddedice_write_reg(): 0: 0x00000002
Debug:   178 10204 jtag.c:1117 jtag_build_buffer(): fields[0].out_value: 0x00000002
Debug:   179 10206 jtag.c:1117 jtag_build_buffer(): fields[1].out_value: 0x00
Debug:   180 10208 jtag.c:1117 jtag_build_buffer(): fields[2].out_value: 0x01
Debug:   181 10210 ft2232.c:1347 ft2232_execute_queue(): DR scan, 38 bit, end in 8
Debug:   182 10211 jtag.c:1117 jtag_build_buffer(): fields[0].out_value: 0x00000004
Debug:   183 10213 jtag.c:1117 jtag_build_buffer(): fields[1].out_value: 0x01
Debug:   184 10215 jtag.c:1117 jtag_build_buffer(): fields[2].out_value: 0x00
Debug:   185 10217 ft2232.c:1347 ft2232_execute_queue(): DR scan, 38 bit, end in 8
Debug:   186 10219 jtag.c:1117 jtag_build_buffer(): fields[0].out_value: 0x00000004
Debug:   187 10220 jtag.c:1117 jtag_build_buffer(): fields[1].out_value: 0x04
Debug:   188 10222 jtag.c:1117 jtag_build_buffer(): fields[2].out_value: 0x00
Debug:   189 10225 ft2232.c:1347 ft2232_execute_queue(): DR scan, 38 bit, end in 8
Debug:   190 10253 jtag.c:1151 jtag_read_buffer(): fields[0].in_value: 0x00000004
Debug:   191 10255 target.c:1769 target_wait_state(): waiting for target halted...
Debug:   192 10257 jtag.c:1117 jtag_build_buffer(): fields[0].out_value: 0x00000004
Debug:   193 10259 jtag.c:1117 jtag_build_buffer(): fields[1].out_value: 0x01
Debug:   194 10261 jtag.c:1117 jtag_build_buffer(): fields[2].out_value: 0x00
Debug:   195 10263 ft2232.c:1347 ft2232_execute_queue(): DR scan, 38 bit, end in 8
Debug:   196 10265 jtag.c:1117 jtag_build_buffer(): fields[0].out_value: 0x00000004
Debug:   197 10267 jtag.c:1117 jtag_build_buffer(): fields[1].out_value: 0x04
Debug:   198 10268 jtag.c:1117 jtag_build_buffer(): fields[2].out_value: 0x00
Debug:   199 10270 ft2232.c:1347 ft2232_execute_queue(): DR scan, 38 bit, end in 8
Debug:   200 10291 jtag.c:1151 jtag_read_buffer(): fields[0].in_value: 0x00000004
...............
Error:   1506 15220 target.c:1776 target_wait_state(): timed out while waiting for target halted
Debug:   1507 15222 command.c:407 run_command(): Command failed with error code -4
User:    1508 15225 command.c:607 openocd_jim_vfprintf(): Runtime error, file &quot;command.c&quot;, line 436:
User:    1509 15227 command.c:607 openocd_jim_vfprintf():</code></pre></div><p>I&#039;ll have to study the ARM JTAG specification a lot deeper to understand this... Meanwhile, any help would be welcome <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /><br />I&#039;m going back to documentation, good night everyone.</p><p>Rel</p>											<p class="post-edited">(Last edited by <strong>relghuar</strong> on 13 Oct 2008, 22:49)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p74654">
				<div class="post-metadata">
					<div class="post-num">Post #179</div>
					<div class="post-author">StrikerNL</div>
					<div class="post-datetime">
						13 Oct 2008, 23:57					</div>
				</div>
				<div class="post-content content">
					<p>relghuar, have you read <a href="http://forum.openwrt.org/viewtopic.php?pid=74212#p74212">buytenh&#039;s post about the jtag port on the wrt350n</a>? This might save you a lot of time.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p74659">
				<div class="post-metadata">
					<div class="post-num">Post #180</div>
					<div class="post-author">relghuar</div>
					<div class="post-datetime">
						14 Oct 2008, 01:15					</div>
				</div>
				<div class="post-content content">
					<p>Of course I have read his posts - I&#039;m watching this thread very closely <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /> Only with his help have I been able to make the JTAG work. The architecture is a lot different from MIPS jtag I&#039;m used to from broadcom chips, so I made a few mistakes in the beginning, but I&#039;m slowly getting through. I&#039;m already talking to the chip, as can be seen from the openocd logs I&#039;ve sent here. TMS/TDI are swapped, TRST/SRST are set correctly, processor is providing it&#039;s IDCODE (even after instruction scan - the IDCODE for ARM is 0x0e instead of MIPS 0x01 <img src="https://forum.openwrt.org/img/smilies/neutral.png" width="15" height="15" alt="neutral" /> ). Now the only problem is to talk to it in the right way, or perhaps just to configure the openocd correctly. I have to find out what all the values from my debug logs actually mean. With a little help from <a href="http://infocenter.arm.com/help/index.jsp?topic=/com.arm.doc.ddi0222b/I842747.html">http://infocenter.arm.com/help/index.js … 42747.html</a> it should be just a matter of time. Of course if someone would recognize the problem right away and point me in the right direction, the time could be considerably shorter ;-) That&#039;s why I&#039;m posting my progress here along the way...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p74660">
				<div class="post-metadata">
					<div class="post-num">Post #181</div>
					<div class="post-author">dirkNL</div>
					<div class="post-datetime">
						14 Oct 2008, 01:28					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>relghuar wrote:</cite><blockquote><p>Of course if someone would recognize the problem right away and point me in the right direction, the time could be considerably shorter ;-) That&#039;s why I&#039;m posting my progress here along the way...</p></blockquote></div><p>Aside from the swapped TDI and TMS pins we didnâ€™t have any trouble halting the target. I tried to connect it with an ft2232 device but without any luck. I ran into similar problems with that. The simple parallel DLC5 JTAG cable solved this problem but I donâ€™t think thatâ€™s any good to you.</p><p>I thought of something that might just work, if you setup OpenOCD to use _no_ reset function of the JTAG key whatsoever and pull the TRST pin high.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p74661">
				<div class="post-metadata">
					<div class="post-num">Post #182</div>
					<div class="post-author">relghuar</div>
					<div class="post-datetime">
						14 Oct 2008, 02:03					</div>
				</div>
				<div class="post-content content">
					<p>See, that was exactly what I meant <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> The ft2232 OOCDLink is the only JTAG adapter I have, and without a parallel port I couldn&#039;t really test a dlc5 cable.<br />With &quot;reset_config none&quot; and a simple short between pins 1 and 3 the adapter works like a charm! Thanks a lot for the advice - processor halted OK, I&#039;ve just dumped a few leading words from flash memory (0xff800000) in gdb, and they&#039;re exactly what they should be... Tomorrow I&#039;ll try to put the kernel into RAM.<br />Now I only have to find out why the router won&#039;t boot with fully programmed flash <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p74662">
				<div class="post-metadata">
					<div class="post-num">Post #183</div>
					<div class="post-author">dirkNL</div>
					<div class="post-datetime">
						14 Oct 2008, 02:26					</div>
				</div>
				<div class="post-content content">
					<p>glad I could help.</p><p>I would suggest to do the same as I and dump the current contents of your flash, to do that:</p><div class="codebox"><pre><code>halt
arm7_9 fast_memory_access enable
dump_image currentflash.img 0xff800000 0x00800000</code></pre></div><p>If you find those nasty eRcOmM bits missing in the dump you&#039;ll know why it stopped working <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /> if you managed to break your u-boot you&#039;ll have to do some more work. You need to do all sorts of settings on the target before being able to run u-boot, RAM settings and such sort.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p74663">
				<div class="post-metadata">
					<div class="post-num">Post #184</div>
					<div class="post-author">relghuar</div>
					<div class="post-datetime">
						14 Oct 2008, 02:26					</div>
				</div>
				<div class="post-content content">
					<p>OK, I think I found my problem <img src="https://forum.openwrt.org/img/smilies/neutral.png" width="15" height="15" alt="neutral" /> each X..X+0x7f block contains the same data as X+0x80..X+0xff - address pin A6 on the flash must have gone bad by soldering. Hopefully nothing permanent, I&#039;ll look into it tomorrow.<br />Thanks again for the help with JTAG, dirk <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p74664">
				<div class="post-metadata">
					<div class="post-num">Post #185</div>
					<div class="post-author">relghuar</div>
					<div class="post-datetime">
						14 Oct 2008, 02:29					</div>
				</div>
				<div class="post-content content">
					<p>I don&#039;t believe the content of flash chip is damaged - I have programmed it myself and verified many times. Problem is that with A6 pin always set to 0 processor simply can&#039;t access every second block of 0x80 bytes of flash memory (just duplicates the previous one instead), which certainly doesn&#039;t make him happy <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p74726">
				<div class="post-metadata">
					<div class="post-num">Post #186</div>
					<div class="post-author">relghuar</div>
					<div class="post-datetime">
						15 Oct 2008, 01:04					</div>
				</div>
				<div class="post-content content">
					<p>My router boots from flash!!! <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /><br />Well, almost... Actually it freezes in U-Boot, but it&#039;s quite a progress since I soldered it off the board.<br />Serial console shows some nvram problems:<br /></p><div class="codebox"><pre><code>         __  __                      _ _
        |  \/  | __ _ _ ____   _____| | |
        | |\/| |/ _` | &#039;__\ \ / / _ \ | |
        | |  | | (_| | |   \ V /  __/ | |
        |_|  |_|\__,_|_|    \_/ \___|_|_|
 _   _     ____              _
| | | |   | __ )  ___   ___ | |_
| | | |___|  _ \ / _ \ / _ \| __|
| |_| |___| |_) | (_) | (_) | |_
 \___/    |____/ \___/ \___/ \__|  ** LOADER **
 ** MARVELL BOARD: RD-88F5181L-VOIP-GE LE

U-Boot 1.1.1 (Dec 12 2006 - 16:12:22) Marvell version: 1.7.3

DRAM CS[0] base 0x00000000   size  32MB
DRAM Total size  32MB
Flash: mvFlashInit base 0xff800000 devW 1 busW 1
Flash: flashStructGet manu 0xec id 0xe0
Flash: flashStructGet flash is supported.
FLASH: initFlashSecs TOP Sector Type
Flash: flashSecsInit main sector loop 0 - 127
[8192kB@ff800000] Flash:  8 MB
Addresses 20M - 0M are saved for the U-Boot usage.
Mem malloc Initialization (20M - 16M): Done
*** Warning - bad CRC, using default environment


Soc: MV88F5181 Rev 9
CPU: ARM926 (Rev 0) running @ 500Mhz
SysClock = 166Mhz , TClock = 166Mhz


USB 0: host mode
PCI 0: PCI Express Root Complex Interface
PCI 1: Conventional PCI, speed = 33000000
Net:   mvEgigaLoad: egiga0 load ok
egiga0 [PRIME]

***************DRIVER INFO*****************

DRIVER BUILD DATA: Jan  9 2007 at 18:25:44
DRIVER VERSION 1.06

*******************************************
dbSign is:65:52:63:4f:6d:4d
mac address in flash is:00:00:00:00:00:00
have eRcOmM
no node address

mvEgigaInit: egiga0 init - mvBoardPhyAddrGet()=0x0 , priv-&gt;port =0x0
ring full
mvEgigaInit: egiga0 complete ok
In Assign function</code></pre></div><p>Apparently he can&#039;t get MAC address, though it really puzzles me as the flash image is fully identical with original Linksys WRT350Nv2-ETSI-2.00.17 firmware - I dumped whole 8MB through JTAG/gdb chain and it&#039;s perfect match, just as I expected.<br />I tried to check the freezing code in linksys sources, but the Assign function is stored in board/mv88fxx81/sercomm/upgrade.o file, and there&#039;s no source for it. I&#039;m really not looking forward to disassembling it <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /><br />I&#039;ve also tried to boot kernel from RAM over JTAG, but the original Linksys kernel won&#039;t come up, it didn&#039;t even write anything to the console. I&#039;ll try it one more time, and then I&#039;ll compile a new one from kernel.org, hopefully I&#039;ll have more luck with that.<br />Does anyone know how the original flashing procedure actually works? Linksys firmware is simply a compressed full 8MB flash image, I thought it would be enough to overwrite whole flash with it. Obviously that&#039;s not enough to get U-Boot to start...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p74727">
				<div class="post-metadata">
					<div class="post-num">Post #187</div>
					<div class="post-author">dirkNL</div>
					<div class="post-datetime">
						15 Oct 2008, 01:41					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ve uploaded the stock flash contents for you, so not build from Linksys sources but really stock from the flash. It&#039;s the same dump I used to bring back my WRT to life. I only used the mtd0 part because I knew my u-boot wasn&#039;t screwed, but I&#039;ve uploaded all other partitions as well. Maybe it&#039;ll help.</p><p><a href="http://hosting.upexia.nl/wrt350n/mtd0.orig.img">mtd0.img</a> (kernel+rootfs)<br /><a href="http://hosting.upexia.nl/wrt350n/mtd1.img">mtd1.img</a> (rootfs)<br /><a href="http://hosting.upexia.nl/wrt350n/mtd2.img">mtd2.img</a> (lang)<br /><a href="http://hosting.upexia.nl/wrt350n/mtd3.img">mtd3.img</a> (nvram)<br /><a href="http://hosting.upexia.nl/wrt350n/mtd4.img">mtd4.img</a> (u-boot)</p><p>Because of the overlapping mtd0 and mtd1 you only need to use the contents of mtd0 and mtd2 through mtd4.</p><p>If you could post your image contents I can have a look and maybe find out what&#039;s missing, but I doubt you can&#039;t fix it with the images provided here.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p74729">
				<div class="post-metadata">
					<div class="post-num">Post #188</div>
					<div class="post-author">relghuar</div>
					<div class="post-datetime">
						15 Oct 2008, 04:24					</div>
				</div>
				<div class="post-content content">
					<p>Hello Dirk<br />Thanks for the images. I&#039;ve also used the stock firmware - 2.00.17 to be precise (the same you&#039;ve posted from what I can tell). Your kernel+rootfs and lang images are exactly the same as mine <a href="http://sites.google.com/site/relghuar/Home/full-image.bin">full-image.bin</a>, the only difference in u-boot is some kind of checksum at the end. Main difference is the nvram segment - in the stock image it&#039;s completely blank (all 0), while yours contains quite a lot of settings. I suppose the original flashing routine either does not overwrite that part, or generates new data after the stock image is flashed.<br />I have some problems writing to flash from openocd (flash probe always tries to access it in word mode?? probably wrong openocd.cfg). If I set &quot;flash bank cfi 0xff800000 0x00800000 1 1 0&quot;, the &quot;flash probe 0&quot; always fails. On the other hand, with &quot;flash bank cfi 0xff800000 0x00800000 1 2 0&quot; the memory is detected with 128k/16k sectors and addresses up to 16MB <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> There&#039;s probably nothing wrong with the flash itself, as calling the right mwb/mdb sequences manually behaves correctly - I&#039;ve even managed to erase both nvram sectors... I&#039;ll get back to it tomorrow, now I really need some sleep.<br />Good night.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p74753">
				<div class="post-metadata">
					<div class="post-num">Post #189</div>
					<div class="post-author">dirkNL</div>
					<div class="post-datetime">
						15 Oct 2008, 15:33					</div>
				</div>
				<div class="post-content content">
					<p>You&#039;re getting quiet a lot more out of flash/openocd as we did, but after being able to boot a kernel with openocd we figured it wasn&#039;t going to be much of help anyway. The next time I&#039;m gonna play around with the device I will try some more in OpenOCD and post back my findings. This could take a while as I&#039;m now just waiting for openwrt to have full wrt350n support in their trunk.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p74765">
				<div class="post-metadata">
					<div class="post-num">Post #190</div>
					<div class="post-author">relghuar</div>
					<div class="post-datetime">
						15 Oct 2008, 22:06					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;M IN!!! <img src="https://forum.openwrt.org/img/smilies/cool.png" width="15" height="15" alt="cool" /> <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /> Router booted fully, web interface works, wifi works. Serial console&#039;s not reacting to input, but I suppose that&#039;s a serial adapter/cable issue rather than router itself.<br />Problems with OpenOCD and flash unfortunately remained, I suppose they&#039;re caused by the 8bit flash access used on the board. Based on source code and debug outputs I assume OOCD is not quite ready to deal with 8bit CFI memories, as the 16bit access addresses are hardcoded in the flash/cfi.c module. The only way to get correct addresses is configuring the bus width 2 - unfortunately that corrupts cfi-autodetected block addresses/sizes, and probably also screws up following flash chip control sequences.<br />In the end I decided to have a little fun and write my own little flash programmer (thanks to Yagarto arm-toolchain), loaded it to ram over jtag, loaded necessary images into ram as well, and let processor do the dirty work <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> It was quite interesting, and it&#039;s also pretty fast. I expect I could get a whole 8MB image into RAM in under 5 minutes and then write it to flash in about a minute - not bad for a pure JTAG connection (I needed more time just to get 128k bootloader into the broadcom MIPS system).<br />I&#039;ll put the box back together, get the serial connection fully working and hopefully I can start playing with openwrt by weekend.<br />Thanks again to everyone here - mainly dirk, striker and buytenh for help with jtag and firmware images <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Rel</p>											<p class="post-edited">(Last edited by <strong>relghuar</strong> on 15 Oct 2008, 22:12)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p74776">
				<div class="post-metadata">
					<div class="post-num">Post #191</div>
					<div class="post-author">jake1981</div>
					<div class="post-datetime">
						15 Oct 2008, 23:46					</div>
				</div>
				<div class="post-content content">
					<p>Excellent work Rel! Actually show far it has been a pleasure to follow this thread as web is full of threads where people have similar problems - but so rarely things end up with any good <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> Indeed it seems that you&#039;ve really put a really lot on this.</p><p>Good luck.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p74833">
				<div class="post-metadata">
					<div class="post-num">Post #192</div>
					<div class="post-author">pregi</div>
					<div class="post-datetime">
						16 Oct 2008, 21:24					</div>
				</div>
				<div class="post-content content">
					<p>hi<br />i previously flashed my wrt350n v2.1 with linksys firmware 2.00.19 and bricked it.<br />can someone explain how to burn stock firmware or openwrt image via u-boot and tftp from ram to flash?</p><p>regards</p>											<p class="post-edited">(Last edited by <strong>pregi</strong> on 16 Oct 2008, 21:25)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p74841">
				<div class="post-metadata">
					<div class="post-num">Post #193</div>
					<div class="post-author">dirkNL</div>
					<div class="post-datetime">
						17 Oct 2008, 00:14					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>pregi wrote:</cite><blockquote><p>can someone explain how to burn stock firmware or openwrt image via u-boot and tftp from ram to flash?</p></blockquote></div><p>If you&#039;re 100% sure you&#039;ve bricked it you&#039;ll need at least a serial connection to your device, possibly a JTAG connection as well. If this at all sounds difficult to you, you&#039;re in for a rough ride...</p><p>I would suggest to read this thread thoroughly, mainly the posts from striker, buytenh and myself, the path relghuar had chosen to fix his device is a bit more hardcore and most likely not necessary for you. </p><p>To give you some kind of information to start with:<br />-Device uses a 3.3v TTL Serial connection (see openwrt wiki for pinout)<br />-Device uses a std ARM JTAG 20p connection, with the TDI and TMS pins swapped<br />-OpenOCD currently doesn&#039;t support the flashchip in u-boot</p><p>Some starting points:<br />-Create serial link<br />-Try to boot a kernel in u-boot with root-nfs support<br />-flash your device inside of this nfs root</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p74842">
				<div class="post-metadata">
					<div class="post-num">Post #194</div>
					<div class="post-author">pregi</div>
					<div class="post-datetime">
						17 Oct 2008, 00:39					</div>
				</div>
				<div class="post-content content">
					<p>hi<br />i got working serial connection and ethernet, also jtag if i need it<br />but i need more info about booting kernel images from ram to flash the device<br />there are just a few sites on the net about this device :-(</p><p>regards</p>											<p class="post-edited">(Last edited by <strong>pregi</strong> on 17 Oct 2008, 00:40)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p74844">
				<div class="post-metadata">
					<div class="post-num">Post #195</div>
					<div class="post-author">dirkNL</div>
					<div class="post-datetime">
						17 Oct 2008, 00:47					</div>
				</div>
				<div class="post-content content">
					<p>please read at least the last 3-4 pages</p><br /><p>Try to figure out what&#039;s wrong with you device, begin with posting your serial output, we&#039;ll build up from there on...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p74848">
				<div class="post-metadata">
					<div class="post-num">Post #196</div>
					<div class="post-author">pregi</div>
					<div class="post-datetime">
						17 Oct 2008, 01:04					</div>
				</div>
				<div class="post-content content">
					<div class="codebox"><pre><code>         __  __                      _ _
        |  \/  | __ _ _ ____   _____| | |
        | |\/| |/ _` | &#039;__\ \ / / _ \ | |
        | |  | | (_| | |   \ V /  __/ | |
        |_|  |_|\__,_|_|    \_/ \___|_|_|
 _   _     ____              _
| | | |   | __ )  ___   ___ | |_
| | | |___|  _ \ / _ \ / _ \| __|
| |_| |___| |_) | (_) | (_) | |_
 \___/    |____/ \___/ \___/ \__|  ** LOADER **
 ** MARVELL BOARD: RD-88F5181L-VOIP-GE LE

U-Boot 1.1.1 (Dec 12 2006 - 16:12:22) Marvell version: 1.7.3

DRAM CS[0] base 0x00000000   size  32MB
DRAM Total size  32MB
Flash: mvFlashInit base 0xff800000 devW 1 busW 1
Flash: flashStructGet manu 0xec id 0xe0
Flash: flashStructGet flash is supported.
FLASH: initFlashSecs TOP Sector Type
Flash: flashSecsInit main sector loop 0 - 127
[8192kB@ff800000] Flash:  8 MB
Addresses 20M - 0M are saved for the U-Boot usage.
Mem malloc Initialization (20M - 16M): Done
*** Warning - bad CRC, using default environment


Soc: MV88F5181 Rev 9
CPU: ARM926 (Rev 0) running @ 500Mhz
SysClock = 166Mhz , TClock = 166Mhz


USB 0: host mode
PCI 0: PCI Express Root Complex Interface
PCI 1: Conventional PCI, speed = 33000000
Net:   mvEgigaLoad: egiga0 load ok
egiga0 [PRIME]

***************DRIVER INFO*****************

DRIVER BUILD DATA: Jan  9 2007 at 18:25:44
DRIVER VERSION 1.06

*******************************************
dbSign is:65:52:63:4f:6d:4d
mac address in flash is:00:1d:7e:ad:37:dc
have eRcOmM
Hit ENTER to stop autoboot:  0
copy kernel from 0xff800000 to 0x400000 with size 0x200000
## Booting image at 00400000 ...
   Image Name:   Linux-2.6.12-arm1
   Image Type:   ARM Linux Kernel Image (uncompressed)
   Data Size:    1510872 Bytes =  1.4 MB
   Load Address: 00008000
   Entry Point:  00008000
   Verifying Checksum ... Bad Data CRC
Marvell&gt;&gt;</code></pre></div><p>kernel image has bad crc so it refuses to boot :-/</p><p>EDIT:<br />ok got it working again<br />booted your mtd0 image kernel from 0x400000 and flashed again via linksys webinterface<br />got this error<br /></p><div class="codebox"><pre><code>CodeReal: invalid data
SQUASHFS error: lzma_fs error while decompressing!
SQUASHFS error: Unable to read page, block 60d70, size 3d1c</code></pre></div><p>but it works from flash :-D</p>											<p class="post-edited">(Last edited by <strong>pregi</strong> on 17 Oct 2008, 01:49)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p74963">
				<div class="post-metadata">
					<div class="post-num">Post #197</div>
					<div class="post-author">relghuar</div>
					<div class="post-datetime">
						19 Oct 2008, 18:21					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>dirkNL wrote:</cite><blockquote><p>I would suggest to read this thread thoroughly, mainly the posts from striker, buytenh and myself, the path relghuar had chosen to fix his device is a bit more hardcore and most likely not necessary for you.</p></blockquote></div><p><img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /> My path was extremely hardcore, and is definitely not necessary for anyone anymore since buytenh got the JTAG working on wrt350n-v2 - though I might have to do it again soon on a friend&#039;s asus wl500g premium v1, as it doesn&#039;t seem to have jtag pins at all...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p75068">
				<div class="post-metadata">
					<div class="post-num">Post #198</div>
					<div class="post-author">dgi</div>
					<div class="post-datetime">
						20 Oct 2008, 22:15					</div>
				</div>
				<div class="post-content content">
					<p>People, the Orion chips require &quot;reset_config srst_only&quot; in OpenOCD!!! I know, because I&#039;m the one who submitted the patch to it (r950) that made it work.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p75302">
				<div class="post-metadata">
					<div class="post-num">Post #199</div>
					<div class="post-author">dogwrt</div>
					<div class="post-datetime">
						24 Oct 2008, 13:25					</div>
				</div>
				<div class="post-content content">
					<p>Hi all, great work!</p><p>Where can I find the WRT350Nv2 support? Is it everything included in the openwrt trunk svn tree?<br />Or do I have to follow StrikerNL&#039;s steps as described in <a href="http://forum.openwrt.org/viewtopic.php?pid=68981#p68981">http://forum.openwrt.org/viewtopic.php?pid=68981#p68981</a> ?</p><p>A lot of questions, but I&#039;m willing to give it a try (and have a serial and jtag cable ready just in case ;-)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p75303">
				<div class="post-metadata">
					<div class="post-num">Post #200</div>
					<div class="post-author">StrikerNL</div>
					<div class="post-datetime">
						24 Oct 2008, 13:37					</div>
				</div>
				<div class="post-content content">
					<p>Not yet, it&#039;s close though.</p><p>2.6.27 is not in the trunk yet so some support is missing. As soon as this is done (which is not up to me and DirkNL), you can give it a shot. We just replaced the kernel with 2.6.27 ourselves.</p><p>The latest status:</p><p>- wifi is not completely working yet (AP mode, as someone pointed out, does not seem to work yet)<br />- there are some problems with the switch driver, it works, but performance is not up to par yet</p><p>Other than that, everything is done.</p>									</div>
			</article>

			
		
						<div class="notice">
				<p>Sorry, posts 201 to 200 are missing from our archive.</p>
			</div>
		
		
	
	<div class="pagination"><div class="pagination-number">Page 8 of 46</div><nav><ul><li><a href="viewtopic.php%3Fid=12358&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=12358&amp;p=6.html">6</a></li><li><a href="viewtopic.php%3Fid=12358&amp;p=7.html">7</a></li><li class="pagination-current"><span>8</span></li><li><a href="viewtopic.php%3Fid=12358&amp;p=9.html">9</a></li><li><a href="viewtopic.php%3Fid=12358&amp;p=10.html">10</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=12358&amp;p=46.html">46</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0.001 -->

</body>
</html>