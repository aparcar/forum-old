<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> D-link DIR-505 support?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 2 Apr 2018 and 5 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 10 of 11</div><nav><ul><li><a href="viewtopic.php%3Fid=38742&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=38742&amp;p=8.html">8</a></li><li><a href="viewtopic.php%3Fid=38742&amp;p=9.html">9</a></li><li class="pagination-current"><span>10</span></li><li><a href="viewtopic.php%3Fid=38742&amp;p=11.html">11</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p279275">
				<div class="post-metadata">
					<div class="post-num">Post #226</div>
					<div class="post-author">donutsncreme</div>
					<div class="post-datetime">
						8 Jun 2015, 14:43					</div>
				</div>
				<div class="post-content content">
					<p>Dear fellow members,</p><p>I really need some help. I am a total noob and need some help. I was looking for a device which could convert my hard disk into a NAS (Network acess storage) device, something I could add as a network device on my PC and access. If not, atleast a device which can provide FTP access to my hard disk using Filezilla. Dlink DIR 505 was something the retailer promised could do (he just said it will help me share media across phones and PC using HDD). Given NAS devices are not easily available in stores nearby, I got the DLink DIR 505 for myself.</p><p>While this thing does partially what the retailer says, it is not exactly what I hoped for.</p><p>1) HDD, even after providing extra power using dual usb port, does not seem to be shown as a storage in shareport<br />2) USB device, though detected, can be accessed only by using the shareport web link (191.168.0.1:8181). Pointing filezilla for ftp does not work and I even cannot use the hard disk as a wifi drive.</p><p>I spent some time surfing openwrt and stumbled across this forum. My question is would the steps suggested by masamunecyrus here <a href="https://forum.openwrt.org/viewtopic.php?pid=230861#p230861">https://forum.openwrt.org/viewtopic.php â€¦ 61#p230861</a> , help me get the ftp or NAS protocol running??? If not, is there&nbsp; any alternative to make it work or I would need a different NAS device altogether? Hoping for an early response and apologies if I sound like a noob.</p><p>Thank you,</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p279288">
				<div class="post-metadata">
					<div class="post-num">Post #227</div>
					<div class="post-author">votsalo</div>
					<div class="post-datetime">
						8 Jun 2015, 16:21					</div>
				</div>
				<div class="post-content content">
					<p>Yes, if you install OpenWRT you can use this device as a NAS with various protocols.</p><p>The easiest file-serving protocol is just ssh with various client tools (scp, or sftp-like clients).&nbsp; Learn how to use ssh, if you don&#039;t already know it.&nbsp; You may be able to install OpenWRT without it, but it is very useful for troubleshooting.</p><p>If you use Windows, I would take a look at Putty.&nbsp; It may also have the ftp-like client that you need to access the files from your PC.</p><p>OpenWRT comes with an ssh server, so you don&#039;t need to install it.&nbsp; You do need to install some software in order to use the USB disk, as described here:<br /><a href="http://wiki.openwrt.org/doc/howto/usb.storage">http://wiki.openwrt.org/doc/howto/usb.storage</a></p><p>I have done this and used it with a FAT32 flash drive, an ext2 flash drive, and an NTFS hard disk (read-only).</p><p>I installed OpenWRT by installing the OpenWRT firmware from the standard web ui of the device:<br />openwrt-ar71xx-generic-dir-505-a1-squashfs-factory.bin<br />I did not use the &quot;emergency restore mode&quot;.</p><p>You can then follow the &quot;firstlogin&quot; instructions to setup a password, and use the OpenWRT web interface (Luci) to upload a second firmware file:<br />openwrt-ar71xx-generic-dir-505-a1-squashfs-sysupgrade.bin<br />I&#039;m not sure what you gain by installing the sysupgrade file.&nbsp; OpenWRT also works without it.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p279300">
				<div class="post-metadata">
					<div class="post-num">Post #228</div>
					<div class="post-author">donutsncreme</div>
					<div class="post-datetime">
						8 Jun 2015, 18:13					</div>
				</div>
				<div class="post-content content">
					<p>Ah thanks. Would try this later in the day. </p><p>Would the USB storage then appear as a drive on my pc (network location) or I would need to use FTP program like filezilla to transfer files?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p279311">
				<div class="post-metadata">
					<div class="post-num">Post #229</div>
					<div class="post-author">drbios</div>
					<div class="post-datetime">
						8 Jun 2015, 19:53					</div>
				</div>
				<div class="post-content content">
					<p>new clean installation ...is this a normal space left??</p><br /><p>&nbsp; _______&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;________&nbsp; &nbsp; &nbsp; &nbsp; __<br /> |&nbsp; &nbsp; &nbsp; &nbsp;|.-----.-----.-----.|&nbsp; |&nbsp; |&nbsp; |.----.|&nbsp; |_<br /> |&nbsp; &nbsp;-&nbsp; &nbsp;||&nbsp; _&nbsp; |&nbsp; -__|&nbsp; &nbsp; &nbsp;||&nbsp; |&nbsp; |&nbsp; ||&nbsp; &nbsp;_||&nbsp; &nbsp;_|<br /> |_______||&nbsp; &nbsp;__|_____|__|__||________||__|&nbsp; |____|<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |__| W I R E L E S S&nbsp; &nbsp;F R E E D O M<br /> -----------------------------------------------------<br /> CHAOS CALMER (Bleeding Edge, r45915)<br /> -----------------------------------------------------<br />&nbsp; * 1 1/2 oz Gin&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Shake with a glassful<br />&nbsp; * 1/4 oz Triple Sec&nbsp; &nbsp; &nbsp; &nbsp;of broken ice and pour<br />&nbsp; * 3/4 oz Lime Juice&nbsp; &nbsp; &nbsp; &nbsp;unstrained into a goblet.<br />&nbsp; * 1 1/2 oz Orange Juice<br />&nbsp; * 1 tsp. Grenadine Syrup<br /> -----------------------------------------------------<br />root@OpenWrt:~# df -h<br />Filesystem&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Size&nbsp; &nbsp; &nbsp; Used Available Use% Mounted on<br />rootfs&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 4.4M&nbsp; &nbsp; 276.0K&nbsp; &nbsp; &nbsp; 4.2M&nbsp; &nbsp;6% /<br />/dev/root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2.0M&nbsp; &nbsp; &nbsp; 2.0M&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 100% /rom<br />tmpfs&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 29.8M&nbsp; &nbsp; &nbsp;56.0K&nbsp; &nbsp; &nbsp;29.7M&nbsp; &nbsp;0% /tmp<br />/dev/mtdblock8&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 4.4M&nbsp; &nbsp; 276.0K&nbsp; &nbsp; &nbsp; 4.2M&nbsp; &nbsp;6% /overlay<br />overlayfs:/overlay&nbsp; &nbsp; &nbsp; &nbsp; 4.4M&nbsp; &nbsp; 276.0K&nbsp; &nbsp; &nbsp; 4.2M&nbsp; &nbsp;6% /<br />tmpfs&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;512.0K&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; 512.0K&nbsp; &nbsp;0% /dev<br />root@OpenWrt:~#</p><p>ROOTFS size is 4.4 MB instead of 8MB ... m i wrong?</p>											<p class="post-edited">(Last edited by <strong>drbios</strong> on 8 Jun 2015, 20:11)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p279312">
				<div class="post-metadata">
					<div class="post-num">Post #230</div>
					<div class="post-author">votsalo</div>
					<div class="post-datetime">
						8 Jun 2015, 20:05					</div>
				</div>
				<div class="post-content content">
					<p>You would need an ftp-like program, preferably a program that can use ssh instead of ftp.</p><p>It is possible for the USB storage to appear as a drive on your pc, but you would need to install and configure more packages on the device.&nbsp; I haven&#039;t done it.</p><p>Are you sure the device does not do this as is?&nbsp; Maybe you just need to configure it.&nbsp; I don&#039;t have an original device to try it (nor do I have a Windows machine to try it with), but I saved some of the screens when I first bought it.&nbsp; I see that in the REPEATER mode, it has a MEDIA SERVER screen that configures a DLNS Media Server and a STORAGE screen (I don&#039;t know what a DLNS Media Server is, but it seems relevant to what you want to do).</p><p>You should install OpenWRT only if you are willing to learn some Linux and OpenWRT adminstration.&nbsp; OpenWRT does not implement a media server out of the box.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p279385">
				<div class="post-metadata">
					<div class="post-num">Post #231</div>
					<div class="post-author">donutsncreme</div>
					<div class="post-datetime">
						9 Jun 2015, 10:11					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>votsalo wrote:</cite><blockquote><p>Yes, if you install OpenWRT you can use this device as a NAS with various protocols.</p><p>The easiest file-serving protocol is just ssh with various client tools (scp, or sftp-like clients).&nbsp; Learn how to use ssh, if you don&#039;t already know it.&nbsp; You may be able to install OpenWRT without it, but it is very useful for troubleshooting.</p><p>If you use Windows, I would take a look at Putty.&nbsp; It may also have the ftp-like client that you need to access the files from your PC.</p><p>OpenWRT comes with an ssh server, so you don&#039;t need to install it.&nbsp; You do need to install some software in order to use the USB disk, as described here:<br /><a href="http://wiki.openwrt.org/doc/howto/usb.storage">http://wiki.openwrt.org/doc/howto/usb.storage</a></p><p>I have done this and used it with a FAT32 flash drive, an ext2 flash drive, and an NTFS hard disk (read-only).</p><p>I installed OpenWRT by installing the OpenWRT firmware from the standard web ui of the device:<br />openwrt-ar71xx-generic-dir-505-a1-squashfs-factory.bin<br />I did not use the &quot;emergency restore mode&quot;.</p><p>You can then follow the &quot;firstlogin&quot; instructions to setup a password, and use the OpenWRT web interface (Luci) to upload a second firmware file:<br />openwrt-ar71xx-generic-dir-505-a1-squashfs-sysupgrade.bin<br />I&#039;m not sure what you gain by installing the sysupgrade file.&nbsp; OpenWRT also works without it.</p></blockquote></div><br /><p>i tried using the standard webUI. The device restarts on uploading the firmware but I get the old UI on reconnecting. I guess it is not accepting the firmware. I have a A1 model.</p><p>Will try doing it using emergency flash&nbsp; when I get time.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p279387">
				<div class="post-metadata">
					<div class="post-num">Post #232</div>
					<div class="post-author">donutsncreme</div>
					<div class="post-datetime">
						9 Jun 2015, 10:14					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>votsalo wrote:</cite><blockquote><p>You would need an ftp-like program, preferably a program that can use ssh instead of ftp.</p><p>It is possible for the USB storage to appear as a drive on your pc, but you would need to install and configure more packages on the device.&nbsp; I haven&#039;t done it.</p><p>Are you sure the device does not do this as is?&nbsp; Maybe you just need to configure it.&nbsp; I don&#039;t have an original device to try it (nor do I have a Windows machine to try it with), but I saved some of the screens when I first bought it.&nbsp; I see that in the REPEATER mode, it has a MEDIA SERVER screen that configures a DLNS Media Server and a STORAGE screen (I don&#039;t know what a DLNS Media Server is, but it seems relevant to what you want to do).</p><p>You should install OpenWRT only if you are willing to learn some Linux and OpenWRT adminstration.&nbsp; OpenWRT does not implement a media server out of the box.</p></blockquote></div><p>DLNS media server only uses DLNA protocol (if I am right with the name). This is a streaming protocol used by the web UI or the shareport app on mobile. Curiously, shareport app on my mobile detects the usb drive, the app on my pc does not. I need to use the web ui for streaming, which is a pain, if I want to transfer a bulk of data to the drive (including non media files like zip, exe etc.)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p279392">
				<div class="post-metadata">
					<div class="post-num">Post #233</div>
					<div class="post-author">votsalo</div>
					<div class="post-datetime">
						9 Jun 2015, 11:06					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>donutsncreme wrote:</cite><blockquote><p>The device restarts on uploading the firmware but I get the old UI on reconnecting.</p></blockquote></div><p>Even after reboot?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p279405">
				<div class="post-metadata">
					<div class="post-num">Post #234</div>
					<div class="post-author">donutsncreme</div>
					<div class="post-datetime">
						9 Jun 2015, 13:39					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>votsalo wrote:</cite><blockquote><div class="quotebox"><cite>donutsncreme wrote:</cite><blockquote><p>The device restarts on uploading the firmware but I get the old UI on reconnecting.</p></blockquote></div><p>Even after reboot?</p></blockquote></div><p>Yes</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p279686">
				<div class="post-metadata">
					<div class="post-num">Post #235</div>
					<div class="post-author">donutsncreme</div>
					<div class="post-datetime">
						11 Jun 2015, 11:23					</div>
				</div>
				<div class="post-content content">
					<p>Ok. So I uploaded the firmware using the method here:</p><p> <a href="https://forum.openwrt.org/viewtopic.php?pid=230861#p230861">https://forum.openwrt.org/viewtopic.php â€¦ 61#p230861</a> </p><p>I then telneted into the system and set a password.</p><p>I then sshed and ran all the commands as mentioned in the post.</p><p>I then took off the power connected my Dlink 505 router to my main router lan via ethernet cable. I switched the Dlink 505 on and was able to connect to Openwrt wifi network. I was also able to ssh into it over wifi. </p><p>However, the Dlink 505 is unable to connect to internet via the main router ethernet cable. I check the same cable on my PC and my pc was able to connect to internet.&nbsp; Even directly connecting the main ethernet cable (which goes into my main wifi router from my fiber optic modem) directly to Dlink 505 but still no internet. </p><p>I went to my friends house who has a broadband modem and tried using it there but still the Dlink 505 did not receive any internet. Am I doing something wrong? I am unable to install Luci because of this.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p280129">
				<div class="post-metadata">
					<div class="post-num">Post #236</div>
					<div class="post-author">donutsncreme</div>
					<div class="post-datetime">
						15 Jun 2015, 14:42					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>So I was able to connect to internet. Issue was my master router and Dlink were using same IP address. </p><p>Now, I am trying to mount my HDD with 3 partitions. I tried <a href="http://wiki.openwrt.org/doc/howto/usb.storage">http://wiki.openwrt.org/doc/howto/usb.storage</a> however while I was able to get my HDD detected once (just 2 of 3 partitions), they are not appearing anymore. I guess auto mount is not working. Can someone help?</p><p>Thank you</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p288956">
				<div class="post-metadata">
					<div class="post-num">Post #237</div>
					<div class="post-author">frietpan</div>
					<div class="post-datetime">
						24 Aug 2015, 01:53					</div>
				</div>
				<div class="post-content content">
					<p>Trying to flash openwrt, i have two dir-505 from the same seller, one installed fine a few days ago and now the second is giving me some trouble.&nbsp; </p><p>When i upload a firmware firefox gives a timeout responce.<br />After rebooting the original chinees D-link firmware still lives there</p><p>Tried the same procedure also with supwerwrt<br /><a href="https://superwrt.ro/firmware/">https://superwrt.ro/firmware/</a><br />Also no joy...&nbsp; and Ni-hao, D-Link fw still owns the box</p><p>I have the model with the EU plug<br />Both models are A1 with firmware 1.03</p><p>I&#039;m sure i downloaded the firmware for the other router direct form the openwrt repo, but it seems to be a different file. I very much doubt that the hardware is different...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p288958">
				<div class="post-metadata">
					<div class="post-num">Post #238</div>
					<div class="post-author">frietpan</div>
					<div class="post-datetime">
						24 Aug 2015, 02:20					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>donutsncreme wrote:</cite><blockquote><p>Hi,<br />however while I was able to get my HDD detected once (just 2 of 3 partitions), they are not appearing anymore.</p></blockquote></div><p>what type of partitions are on the HDD?&nbsp; fat only or also ntfs, ext3 or ext4?&nbsp; &nbsp;and if so, are the corresponding packages installed to support that filesystem?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p289478">
				<div class="post-metadata">
					<div class="post-num">Post #239</div>
					<div class="post-author">frietpan</div>
					<div class="post-datetime">
						28 Aug 2015, 00:55					</div>
				</div>
				<div class="post-content content">
					<p>Just when i wanted to give up:</p><p>I updated the D-Link v1.03 firmware to 1.07 (the last stable firmware from D-Link)<br /><a href="http://support.dlink.com/ProductInfo.aspx?m=DIR-505">http://support.dlink.com/ProductInfo.aspx?m=DIR-505</a><br />for those who also have the Chinese version the link to D-Link DIR-505&#039;s firmware page is <br /><a href="http://192.168.0.1/Firmware.htm">http://192.168.0.1/Firmware.htm</a></p><p>After I did this I finally could update to OpenWRT<br />I think it&#039;s just extremely odd that i had to go this route, since the other 505 that i have was no problem at all.<br />But just in case anyone has a similair issue, then please give it a try.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p307638">
				<div class="post-metadata">
					<div class="post-num">Post #240</div>
					<div class="post-author">luke.skywalk3r</div>
					<div class="post-datetime">
						14 Jan 2016, 20:04					</div>
				</div>
				<div class="post-content content">
					<p>Hello everybody,<br />I was trying to put the slider/switch to use (DIR-505L A2). It was easy to enable the GPIOs 19 and 20 as input. I can get their value (eg via cat) manually but I couldnâ€™t find a way to get them working automatically via /etc/rc.button (I even googled for that problem). I tried &quot;gpio&quot; and &quot;sysfs&quot; as name but I doesn&#039;t seem to be working Now my question is: what is the proper name for the rc.button-file or rather what is the correct way to use them.<br /></p><div class="codebox"><pre><code>root@OpenWrt:/etc/rc.button# cat /sys/kernel/debug/gpio 
GPIOs 0-29, ath79:
....   
 gpio-19  (sysfs               ) in  lo    
 gpio-20  (sysfs               ) in  hi    
...</code></pre></div><p>(Modified reboot script(quick and dirty))<br /></p><div class="codebox"><pre><code>#!/bin/sh

. /lib/functions.sh

if [ $(cat /sys/class/gpio19/value) -eq 0 ]
then
    if [ $(cat /sys/class/gpio20/value) -eq 1]
    then
        echo &quot;REBOOT&quot; &gt; /dev/console
        sync
        reboot
    fi
fi

return 0</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p313818">
				<div class="post-metadata">
					<div class="post-num">Post #241</div>
					<div class="post-author">manishgkasera</div>
					<div class="post-datetime">
						6 Mar 2016, 20:40					</div>
				</div>
				<div class="post-content content">
					<p><strong>Slider button based network (/etc/config) profiles</strong><br />Small script to have network profiles based on the slider switch,<br />puts this code in /etc/rc.d/S11config_modes file (you have to create this file)<br /></p><div class="codebox"><pre><code>#!/bin/sh /etc/rc.common
                                
START=11
boot() {
         
        # enable gpio pins
        echo 19 &gt; /sys/class/gpio/export
        echo 20 &gt; /sys/class/gpio/export
                                        
        k19=`cat /sys/class/gpio/gpio19/value`
        k20=`cat /sys/class/gpio/gpio20/value`
                                              
        mkdir -p /etc/config_modes
        c_dir=/etc/config_modes/$k19$k20
                                        
        # copy the current config to current mode if booting first time in this mode
        # wanted it to be default config but don&#039;t know from where to get           
        if [ ! -d &quot;$c_dir&quot; ]; then                                       
                cp -r /etc/config/ $c_dir
        fi                               
          
        # remove /etc/config
        if [ -d /etc/config ]; then
          if [ -L /etc/config ]; then
            rm /etc/config           
          else            
            rm -rf /etc/config
          fi                  
        fi  
          
        ln -snv $c_dir /etc/config
}</code></pre></div><div class="codebox"><pre><code>chmod 777 /etc/rc.d/S11config_modes
reboot</code></pre></div><ul><li><p>On the first boot in particular switch mode its going to copy the existing config for the current switch mode.<br /></p></li><li><p>after changing the switch position you have to reboot to load the corresponding config, this is same behavior as stock firmware.<br /></p></li></ul><p>To have the backup of all the modes as well on default openwrt backup run this<br /></p><div class="codebox"><pre><code>echo &quot;/etc/config_modes&quot; &gt;&gt; /etc/sysupgrade.conf</code></pre></div><p>today only i wrote this script, tested only a few times, also please share your improvements.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p315816">
				<div class="post-metadata">
					<div class="post-num">Post #242</div>
					<div class="post-author">luke.skywalk3r</div>
					<div class="post-datetime">
						20 Mar 2016, 13:13					</div>
				</div>
				<div class="post-content content">
					<p>@manishgkasera<br />Your script is awesome! <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /> It&#039;s small, simple and effective - perfect for the small router.<br />And while testing it I didn&#039;t encounter any flaws. You did a great job.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p315851">
				<div class="post-metadata">
					<div class="post-num">Post #243</div>
					<div class="post-author">stangri</div>
					<div class="post-datetime">
						20 Mar 2016, 19:47					</div>
				</div>
				<div class="post-content content">
					<p>It&#039;s been a while since I&#039;ve looked at OpenWrt on DIR-505, so I&#039;d appreciate if anyone could address a few questions:<br />1. There&#039;s just one three-position switch, is it represented by two binary GPIOs (19 &amp; 20)?<br />2. Is the only ethernet port configured as a LAN port or WAN port in default CC config?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p315884">
				<div class="post-metadata">
					<div class="post-num">Post #244</div>
					<div class="post-author">metai</div>
					<div class="post-datetime">
						20 Mar 2016, 23:29					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>stangri wrote:</cite><blockquote><p>1. There&#039;s just one three-position switch, is it represented by two binary GPIOs (19 &amp; 20)?</p></blockquote></div><p><a href="https://wiki.openwrt.org/toh/d-link/dir-505#mode-switch">https://wiki.openwrt.org/toh/d-link/dir-505#mode-switch</a><br /></p><div class="quotebox"><blockquote><p>2. Is the only ethernet port configured as a LAN port or WAN port in default CC config?</p></blockquote></div><p>Just like with all other single-port devices, it is configured as LAN. You need to configure the device and you can&#039;t do that through WAN with default firewall settings, eh?</p>											<p class="post-edited">(Last edited by <strong>metai</strong> on 20 Mar 2016, 23:30)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p315885">
				<div class="post-metadata">
					<div class="post-num">Post #245</div>
					<div class="post-author">stangri</div>
					<div class="post-datetime">
						21 Mar 2016, 00:07					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for your prompt reply. I&#039;m ashamed I&#039;ve asked something which was already in the wiki. <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /> </p><p>@luke.skywalk3r -- did you figure out how to detect the slider/switch changes on the fly? In combination with @manishgkasera&#039;s script above we could get pretty close to stock functionality then.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p315897">
				<div class="post-metadata">
					<div class="post-num">Post #246</div>
					<div class="post-author">metai</div>
					<div class="post-datetime">
						21 Mar 2016, 04:03					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>stangri wrote:</cite><blockquote><p>I&#039;m ashamed I&#039;ve asked something which was already in the wiki. <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p></blockquote></div><p>Eh, happens, don&#039;t worry about it.</p><div class="quotebox"><blockquote><p>@luke.skywalk3r -- did you figure out how to detect the slider/switch changes on the fly? In combination with @manishgkasera&#039;s script above we could get pretty close to stock functionality then.</p></blockquote></div><p>(Heavily edited.)</p><p>I&#039;m not entirely sure if that&#039;s the best way to go about it. If you reacted to the switch instantaneously, it would become hard to reach the extreme positions without reacting to the middle position in the process. You&#039;d have to &quot;debounce&quot; the switch in some way, and at that point you can use another delayed method as well.</p><p>Short of recompiling OpenWrt for the router and including the GPIOs (or at least one of them) in the hotplug configuration you will not get an instant reaction to the switch anyway. But there are other ways to go about it. You could have a cronjob check the switches every minute, or an infinitely looping shell script with an even shorter delay. You can check the GPIOs on system boot like the above script does.</p><p>Personally, I wired up a hotplug script to react to the WPS button on the side. It in turn checks the GPIOs for the switch and reacts accordingly. &quot;Set switch, confirm with button&quot; in a way.</p><p>As usual, there are half a dozen ways to go about it.</p>											<p class="post-edited">(Last edited by <strong>metai</strong> on 21 Mar 2016, 13:27)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p315914">
				<div class="post-metadata">
					<div class="post-num">Post #247</div>
					<div class="post-author">stangri</div>
					<div class="post-datetime">
						21 Mar 2016, 11:11					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>metai wrote:</cite><blockquote><div class="quotebox"><cite>stangri wrote:</cite><blockquote><p>@luke.skywalk3r -- did you figure out how to detect the slider/switch changes on the fly? In combination with @manishgkasera&#039;s script above we could get pretty close to stock functionality then.</p></blockquote></div><p>I&#039;m not entirely sure if that&#039;s the best way to go about it. Pointing out a minor flaw: The script reboots the router, if you combine this with an immediate reaction, you&#039;d have to reboot the router twice to get from one side of the switch to the other. (A simple reload of network would solve this, there really is not much of a point in rebooting the router just to change the network setting.)</p></blockquote></div><p>No, the script doesn&#039;t reboot the router, it just manages config folders.</p><div class="quotebox"><cite>metai wrote:</cite><blockquote><p>Short of recompiling OpenWrt for the router and including the GPIOs (or at least one of them) in the hotplug configuration you will not get an instant reaction to the switch. But there are other ways to go about it. You could have a cronjob check the switches every minute, or an infinitely looping shell script with an even shorter delay. Personally, I wire up a hotplug script to react to the WPS button on the side. It in turn checks the GPIOs for the switch and reacts accordingly. &quot;Set switch, confirm with button&quot; in a way.</p></blockquote></div><p>I thought about that, but I was hoping for an elegant way, detecting the slider. cronjob is a bit trickier as you&#039;d have to store previous state, but if the recompile is required to enable hotplug for gpio, I&#039;ll probably go for the WPS-button script.</p><div class="quotebox"><cite>metai wrote:</cite><blockquote><p>Or you could check the GPIOs at system start, in an init.d script starting before network does (probably position 18 or 19). You&#039;d set the switch, unplug and replug, to change the configuration.</p></blockquote></div><p>That&#039;s what the script above does and it works very well.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p315926">
				<div class="post-metadata">
					<div class="post-num">Post #248</div>
					<div class="post-author">metai</div>
					<div class="post-datetime">
						21 Mar 2016, 13:16					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>stangri wrote:</cite><blockquote><p>No, the script doesn&#039;t reboot the router, it just manages config folders. (...) That&#039;s what the script above does and it works very well.</p></blockquote></div><p>I do stand corrected, it was a wee bit late last night. You are of course right, I edited my post accordingly.</p>											<p class="post-edited">(Last edited by <strong>metai</strong> on 21 Mar 2016, 13:26)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p315975">
				<div class="post-metadata">
					<div class="post-num">Post #249</div>
					<div class="post-author">stangri</div>
					<div class="post-datetime">
						21 Mar 2016, 19:02					</div>
				</div>
				<div class="post-content content">
					<p>Maybe if I read the first 9 pages of this thread I wouldn&#039;t have ran into this, but...</p><p>I&#039;ve learnt a hard lesson that it&#039;s better to not use reghack with this model. WiFi was very flakey (to a point where it would not start after flash at all) and at first I thought I messed up my uci-defaults script or something.</p><p>I ended up using the script above, the hotplug wps button script which simply reboots the device (which is only marginally slower than network restart) and a small uci-defaults script which:<br />* Sets up WiFi AP <br />* Sets up WAN/WAN6 interfaces and detaches eth1 from LAN<br />* Creates clone of the default config into /etc/config_modes/01, -10, -11<br />* Manipulates the /etc/config softlink to properly set Hotspot and Repeater modes </p><p>I&#039;ve tried to see if I could use uci cli to make changes to folders other than /etc/config and couldn&#039;t find any info on that. There&#039;s some info on how to do that with Lua, but I couldn&#039;t make it work. If someone here has a working knowledge of Lua, I&#039;ll post my script.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p316972">
				<div class="post-metadata">
					<div class="post-num">Post #250</div>
					<div class="post-author">stangri</div>
					<div class="post-datetime">
						27 Mar 2016, 17:10					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m trying to perfect my custom image to disable STA if it can&#039;t connect to it in repeater mode, so that I could connect to the router over WiFi.</p><p>With so many options available (and iw warning &quot;Do NOT screenscrape this tool, we don&#039;t consider its output stable.&quot;) -- what&#039;s the best and most reliable way to determine if the STA connection is up/down?</p>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 10 of 11</div><nav><ul><li><a href="viewtopic.php%3Fid=38742&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=38742&amp;p=8.html">8</a></li><li><a href="viewtopic.php%3Fid=38742&amp;p=9.html">9</a></li><li class="pagination-current"><span>10</span></li><li><a href="viewtopic.php%3Fid=38742&amp;p=11.html">11</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>