<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Avahi not advertising services</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 21 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p219809">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">winnall</div>
					<div class="post-datetime">
						12 Dec 2013, 18:00					</div>
				</div>
				<div class="post-content content">
					<p>The avahi-daemon does not seem to start up properly on my system and does not advertise any systems under /etc/avahi/services. I have used avahi frequently for many years on other platforms, and it has always worked out of the box (so I&#039;m not really an expert on Avahi as such), and I&#039;m a newbie to OpenWrt.</p><p>I&#039;d be grateful to anyone who would point out from the information below what mistake I have made.</p><p>Regards,<br />Steve</p><p>I have the following platform:</p><p>&nbsp; &nbsp;&nbsp; Hostname&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; a-tp-2<br />&nbsp; &nbsp; Model&nbsp; &nbsp; TP-Link TL-WDR4300 v1<br />&nbsp; &nbsp; Firmware Version&nbsp; &nbsp;&nbsp; OpenWrt Barrier Breaker r38999 / LuCI Trunk (svn-r9939)<br />&nbsp; &nbsp; Kernel Version&nbsp; &nbsp; 3.10.21</p><p>I have installed the following avahi packages:</p><p>&nbsp; &nbsp; avahi-daemon&nbsp; &nbsp; 0.6.31-5<br />&nbsp; &nbsp; libavahi&nbsp; &nbsp; 0.6.31-5</p><p>ps shows the following:</p><p>&nbsp; &nbsp;&nbsp; 2172 nobody&nbsp; &nbsp; 2180 S&nbsp; &nbsp; avahi-daemon: registering [a-tp-2.local]</p><p>Other machines in the network only see the _workstation._tcp advertisement for a-to-2.local. The services http and ssh (I use the standard ones installed with avahi-daemon) are not visible.</p><p>The avahi-daemon.conf file contains the following:</p><p>&nbsp; &nbsp;&nbsp; &nbsp;[server]<br />&nbsp; &nbsp;&nbsp; &nbsp;use-ipv4=yes<br />&nbsp; &nbsp;&nbsp; &nbsp;use-ipv6=no<br />&nbsp; &nbsp;&nbsp; &nbsp;enable-dbus=no</p><p>&nbsp; &nbsp;&nbsp; &nbsp;[wide-area]<br />&nbsp; &nbsp;&nbsp; &nbsp;enable-wide-area=yes</p><p>&nbsp; &nbsp;&nbsp; &nbsp;[publish]<br />&nbsp; &nbsp;&nbsp; &nbsp;publish-addresses=yes<br />&nbsp; &nbsp;&nbsp; &nbsp;publish-hinfo=yes<br />&nbsp; &nbsp;&nbsp; &nbsp;publish-workstation=yes<br />&nbsp; &nbsp;&nbsp; &nbsp;publish-domain=yes<br />&nbsp; &nbsp;&nbsp; &nbsp;publish-resolv-conf-dns-servers=yes</p><p>&nbsp; &nbsp;&nbsp; &nbsp;[reflector]</p><p>&nbsp; &nbsp;&nbsp; &nbsp;[rlimits]<br />&nbsp; &nbsp;&nbsp; &nbsp;rlimit-core=0<br />&nbsp; &nbsp;&nbsp; &nbsp;rlimit-data=4194304<br />&nbsp; &nbsp;&nbsp; &nbsp;rlimit-fsize=0<br />&nbsp; &nbsp;&nbsp; &nbsp;rlimit-nofile=30<br />&nbsp; &nbsp;&nbsp; &nbsp;rlimit-stack=4194304<br />&nbsp; &nbsp;&nbsp; &nbsp;rlimit-nproc=3</p><p>The system log contains the following entries for avahi-daemon:</p><p>Thu Dec 12 16:41:12 2013 daemon.info avahi-daemon[2172]: Found user &#039;nobody&#039; (UID 65534) and group &#039;nogroup&#039; (GID 65534).<br />Thu Dec 12 16:41:12 2013 daemon.info avahi-daemon[2172]: Successfully dropped root privileges.<br />Thu Dec 12 16:41:12 2013 daemon.info avahi-daemon[2172]: avahi-daemon 0.6.31 starting up.<br />Thu Dec 12 16:41:12 2013 daemon.warn avahi-daemon[2172]: WARNING: No NSS support for mDNS detected, consider installing nss-mdns!<br />Thu Dec 12 16:41:12 2013 daemon.info avahi-daemon[2172]: Loading service file /etc/avahi/services/http.service.<br />Thu Dec 12 16:41:12 2013 daemon.info avahi-daemon[2172]: Loading service file /etc/avahi/services/ssh.service.<br />Thu Dec 12 16:41:12 2013 daemon.info avahi-daemon[2172]: Joining mDNS multicast group on interface br-lan.IPv4 with address 192.168.1.83.<br />Thu Dec 12 16:41:12 2013 daemon.info avahi-daemon[2172]: New relevant interface br-lan.IPv4 for mDNS.<br />Thu Dec 12 16:41:12 2013 daemon.info avahi-daemon[2172]: Network interface enumeration completed.<br />Thu Dec 12 16:41:12 2013 daemon.info avahi-daemon[2172]: Registering new address record for fe80::12fe:edff:fe89:1396 on eth0.2.*.<br />Thu Dec 12 16:41:12 2013 daemon.info avahi-daemon[2172]: Registering new address record for fe80::12fe:edff:fe89:1396 on br-lan.*.<br />Thu Dec 12 16:41:12 2013 daemon.info avahi-daemon[2172]: Registering new address record for 192.168.1.83 on br-lan.IPv4.<br />Thu Dec 12 16:41:12 2013 daemon.info avahi-daemon[2172]: Registering new address record for fe80::12fe:edff:fe89:1396 on eth0.*.<br />Thu Dec 12 16:41:12 2013 daemon.info avahi-daemon[2172]: Server startup complete. Host name is a-tp-2.local. Local service cookie is 961716920.<br />Thu Dec 12 16:41:12 2013 daemon.info avahi-daemon[2172]: Registering HINFO record with values &#039;MIPS&#039;/&#039;LINUX&#039;.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p224863">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">dddesign</div>
					<div class="post-datetime">
						9 Feb 2014, 01:33					</div>
				</div>
				<div class="post-content content">
					<p>did you solve this? <br />I have installed trunk 39424 on my tp-link 3220 and packages dbus and avahi-daemon. but after starting both I get following error in log:<br /></p><div class="codebox"><pre><code>Sun Feb  9 00:08:35 2014 daemon.info avahi-daemon[1430]: Found user &#039;nobody&#039; (UID 65534) and group &#039;nogroup&#039; (GID 65534).
Sun Feb  9 00:08:35 2014 daemon.info avahi-daemon[1430]: Successfully dropped root privileges.
Sun Feb  9 00:08:35 2014 daemon.info avahi-daemon[1430]: avahi-daemon 0.6.31 starting up.
Sun Feb  9 00:08:35 2014 daemon.warn avahi-daemon[1430]: WARNING: No NSS support for mDNS detected, consider installing nss-mdns!
Sun Feb  9 00:08:35 2014 daemon.err avahi-daemon[1430]: dbus_bus_request_name(): Connection &quot;:1.0&quot; is not allowed to own the service &quot;org.freedesktop.Avahi&quot; due to security policies in the configuration file
Sun Feb  9 00:08:35 2014 daemon.warn avahi-daemon[1430]: WARNING: Failed to contact D-Bus daemon.
Sun Feb  9 00:08:35 2014 daemon.info avahi-daemon[1430]: avahi-daemon 0.6.31 exiting.</code></pre></div><p>any idea what is wrong? thanks for any tips.<br />j</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p224990">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">winnall</div>
					<div class="post-datetime">
						10 Feb 2014, 13:58					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m sorry, but I never solved the problem so I removed avahi-daemon from the system. It&#039;s inconvenient, but at least I have a tidy system (no errors to distract me).</p><p>Steve</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p225041">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">Nilfred</div>
					<div class="post-datetime">
						11 Feb 2014, 02:05					</div>
				</div>
				<div class="post-content content">
					<p>Avahi is obsolete, try the new:<br />mdns-utils<br />mdnsd<br />mdnsresponder</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p225094">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">dddesign</div>
					<div class="post-datetime">
						11 Feb 2014, 22:36					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Nilfred wrote:</cite><blockquote><p>Avahi is obsolete, try the new:<br />mdns-utils<br />mdnsd<br />mdnsresponder</p></blockquote></div><p>thanks I will try it.</p><p>meanwhile I found the solution for my avhai problem:<br />1. it&#039;s working if you add one line in /etc/dbus-1/system.conf<br /></p><div class="codebox"><pre><code>&lt;deny own=&quot;*&quot;/&gt; 
&lt;allow own=&quot;org.freedesktop.Avahi&quot;/&gt; &lt;!-- add this line --&gt;
&lt;deny send_type=&quot;method_call&quot;/&gt;</code></pre></div><p>2. and if you add in /etc/avahi/avahi-daemon.conf in the [server] section this<br /></p><div class="codebox"><pre><code>enable-dbus=no</code></pre></div><p>you will not need dbus running.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p262053">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">e_x_p</div>
					<div class="post-datetime">
						19 Jan 2015, 18:23					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Nilfred wrote:</cite><blockquote><p>Avahi is obsolete, try the new:<br />mdns-utils<br />mdnsd<br />mdnsresponder</p></blockquote></div><p>How is avahi obsolete? I couldn&#039;t find any official word on it and I&#039;m trying to decide between avahi and mdnsresponder.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p262066">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">Nilfred</div>
					<div class="post-datetime">
						19 Jan 2015, 21:15					</div>
				</div>
				<div class="post-content content">
					<p>History line:<br />mDNSresponder birth (Apple propietary)<br />Avahi birth<br />Howl birth<br />mDNSresponder (Apple open source)<br />Howl dies<br />Avahi should die too, but instead borrow some code from mDNSresponder and continue.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p269580">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">gdamjan</div>
					<div class="post-datetime">
						22 Mar 2015, 15:37					</div>
				</div>
				<div class="post-content content">
					<p>Had the same issue with the latest 14.07 from git (openwrt 64ae63 / packages 01fcd1).<br />The solution was to add &quot;allow-interfaces=br-lan&quot; in the Server section of the config file /etc/avahi/avahi-daemon.conf.</p><p>The output of ps correctly changed to &quot; 1760 nobody&nbsp; &nbsp; 1664 S&nbsp; &nbsp; avahi-daemon: running [wr1043nd.local]&quot; - instead of &quot;registering&quot;.</p><p>My suspicion is that some of the extra default interfaces was confusing avahi.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>