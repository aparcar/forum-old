<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> ar9331&#039;s usb stability issue - [SOLVED]</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 23 Mar 2017 and 6 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 10 of 13</div><nav><ul><li><a href="viewtopic.php%3Fid=39956&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39956&amp;p=8.html">8</a></li><li><a href="viewtopic.php%3Fid=39956&amp;p=9.html">9</a></li><li class="pagination-current"><span>10</span></li><li><a href="viewtopic.php%3Fid=39956&amp;p=11.html">11</a></li><li><a href="viewtopic.php%3Fid=39956&amp;p=12.html">12</a></li><li><a href="viewtopic.php%3Fid=39956&amp;p=13.html">13</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p223892">
				<div class="post-metadata">
					<div class="post-num">Post #226</div>
					<div class="post-author">jmparatte</div>
					<div class="post-datetime">
						27 Jan 2014, 18:06					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Squonk wrote:</cite><blockquote><p>I submitted the patch to the dev list, but it is not yet integrated into either the BB trunk or AA branch.</p><p>It is just a matter of days before it will be integrated into BB trunk, then hopefully backported to the AA branch,.</p><p>Please be patient!</p></blockquote></div><p>Hi, I&#039;ve a similar problem with TL-WR710N. How will we be informed of the integration ?</p>											<p class="post-edited">(Last edited by <strong>jmparatte</strong> on 27 Jan 2014, 18:17)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p223898">
				<div class="post-metadata">
					<div class="post-num">Post #227</div>
					<div class="post-author">tmo26</div>
					<div class="post-datetime">
						27 Jan 2014, 19:25					</div>
				</div>
				<div class="post-content content">
					<p>see <a href="https://dev.openwrt.org/log/trunk">https://dev.openwrt.org/log/trunk</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p223899">
				<div class="post-metadata">
					<div class="post-num">Post #228</div>
					<div class="post-author">nebbia88</div>
					<div class="post-datetime">
						27 Jan 2014, 19:31					</div>
				</div>
				<div class="post-content content">
					<p><a href="https://forum.openwrt.org/viewtopic.php?pid=222296#p222296">https://forum.openwrt.org/viewtopic.php … 96#p222296</a></p><p>afaik it&#039;s already in trunk, for both ar933x and ar934x cpu&#039;s..</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p223913">
				<div class="post-metadata">
					<div class="post-num">Post #229</div>
					<div class="post-author">Squonk</div>
					<div class="post-datetime">
						27 Jan 2014, 22:28					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>nebbia88 wrote:</cite><blockquote><p><a href="https://forum.openwrt.org/viewtopic.php?pid=222296#p222296">https://forum.openwrt.org/viewtopic.php … 96#p222296</a></p><p>afaik it&#039;s already in trunk, for both ar933x and ar934x cpu&#039;s..</p></blockquote></div><p>Yes it is!</p><p>Unfortunately, the stable AA branch is, well... stable <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> Nothing yet has been back-ported into it since it changed from development to stable branch in April last year. So chances are slim that this patch will be integrated there.</p><p>If you want to have USB running on AR933x/AR934x and you need persistence across &quot;firstboots&quot;, the only way is to get BB &gt;= r39212 and compile everything yourself.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p223934">
				<div class="post-metadata">
					<div class="post-num">Post #230</div>
					<div class="post-author">jmparatte</div>
					<div class="post-datetime">
						28 Jan 2014, 09:10					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Squonk wrote:</cite><blockquote><p>Yes it is!</p></blockquote></div><p>Would you say that the integration is already done in all ar71xx models by the trunk version ?</p><p>This morning, i&#039;ve done a sysupgrade of my TL-WR710N and the problem of my usb serial link to Arduino UNO is the same!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p223993">
				<div class="post-metadata">
					<div class="post-num">Post #231</div>
					<div class="post-author">Squonk</div>
					<div class="post-datetime">
						28 Jan 2014, 22:53					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>jmparatte wrote:</cite><blockquote><div class="quotebox"><cite>Squonk wrote:</cite><blockquote><p>Yes it is!</p></blockquote></div><p>Would you say that the integration is already done in all ar71xx models by the trunk version ?</p><p>This morning, i&#039;ve done a sysupgrade of my TL-WR710N and the problem of my usb serial link to Arduino UNO is the same!</p></blockquote></div><p><a href="https://dev.openwrt.org/changeset/39212">https://dev.openwrt.org/changeset/39212</a></p><p>Please check that you are running at least BB r39212!</p><p>Tested by several persons in this list on TL-WR703N for several consecutive days without problem.</p><p>This is applicable to all ath9k-based SoC.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p224019">
				<div class="post-metadata">
					<div class="post-num">Post #232</div>
					<div class="post-author">jmparatte</div>
					<div class="post-datetime">
						29 Jan 2014, 10:10					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Squonk wrote:</cite><blockquote><p>Please check that you are running at least BB r39212!</p></blockquote></div><p>BB r39404</p><p>What is strange is that Arduino UNO /dev/ttxACMx device is affected but not Arduino 2009 /dev/ttyUSBx device.</p><p>How can be affected one kind of USB serial device and not another ?</p><p>How do I observe the problem? </p><p>I&#039;ve written a small Arduino program which justs do a special echo, it answers the decimal character code:</p><p>void setup() {<br />&nbsp; Serial.begin(9600);<br />}</p><p>void loop() {<br />&nbsp; int c;<br />&nbsp; c = Serial.read();<br />&nbsp; if (c != -1) Serial.println(c, DEC);<br />}</p><p>If I use picocom to communicate with Arduino UNO: no problems.<br />If I use a cgi script which communicates with Arduino UNO: sometimes problems.<br />I receive sometimes an empty line, sometimes twice responses.<br />Remark: I&#039;ve cut the RESET tiny wire between RESET pads of Arduino.</p><p>I think the problem is at open/close /dev/ttyACMx, detect EOL.<br />I observe that sometimes the input buffer is not flushed after close/before open /dev/ttyACMx.<br />I observe that sometimes the input line is not correctly detected.<br />I observe that if I replace the line:<br />&nbsp; if (c != -1) Serial.println(c, DEC);<br />by:<br />&nbsp; if (c != -1) {<br />&nbsp; &nbsp; Serial.print(c / 10);<br />&nbsp; &nbsp; delay(100);<br />&nbsp; &nbsp; Serial.print(c % 10);<br />&nbsp; &nbsp; delay(100);<br />&nbsp; &nbsp; Serial.print(&quot;\n&quot;);<br />&nbsp; &nbsp; delay(100);<br />&nbsp; }<br />the result is better.<br />The result is good if I unplug/plug the Arduino UNO and I send the cgi request after.<br />I confirm that /dev/ttyUSBx don&#039;t have any problems.</p><p>There are also another kind of problem with /dev/ttyACMx when I connect a MSP-430EXPG2 or MSP-430F5529.<br />When opening with picocom, the driver wait a lot of seconds at open/close. And no characters are sent/received.</p><p>The CGI SH script:</p><p>#!/bin/sh</p><p>echo &quot;Cache-Control: no-cache&quot;<br />echo &quot;Expires: 0&quot;<br />echo &quot;Access-Control-Allow-Origin: *&quot;<br />echo &quot;Content-Type: text/plain&quot;<br />echo &quot;&quot;</p><p>device=&quot;/dev/ttyACM0&quot;</p><p>form_urldecode()<br />{<br />&nbsp; &nbsp; local v<br />&nbsp; &nbsp; v=&quot;${1//+/ }&quot;<br />&nbsp; &nbsp; v=&quot;${v//\\%/\\x}&quot;<br />&nbsp; &nbsp; echo -e &quot;$v&quot;<br />}</p><p>qs=$QUERY_STRING</p><p>while [ ! -z &quot;$qs&quot; ]; do<br />&nbsp; &nbsp; p=&quot;${qs%%&amp;*}&quot;&nbsp; &nbsp; # get first part of query string<br />&nbsp; &nbsp; k=&quot;${p%%=*}&quot;&nbsp; &nbsp; # get the key (variable name) from it<br />&nbsp; &nbsp; v=&quot;${p#*=}&quot;&nbsp; &nbsp; # get the value from it<br />&nbsp; &nbsp; qs=&quot;${qs#$p*}&quot;&nbsp; &nbsp; # strip first part from query string<br />&nbsp; &nbsp; qs=&quot;${qs#&amp;*}&quot;&nbsp; &nbsp; # strip first part from query string<br />&nbsp; &nbsp; eval v=&quot;\&quot;`form_urldecode $v`\&quot;&quot;<br />&nbsp; &nbsp; eval $k=&quot;\&quot;$v\&quot;&quot;<br />done</p><p>result=&quot;#undefined error&quot;</p><p>if [ ! -c $device ]; then #not character device ?<br />&nbsp; &nbsp; result=&quot;#device not ready&quot;<br />else<br />if [ -z &quot;$command&quot; ]; then #null command ?<br />&nbsp; &nbsp; result=&quot;&quot; #set empty result<br />else<br />&nbsp; &nbsp; result=&quot;#timeout&quot; #set default result in case of timeout</p><p>&nbsp; &nbsp; set +e<br />&nbsp; &nbsp; exec 6&lt;&amp;0 &lt;$device 7&gt;&amp;1 &gt;$device<br />&nbsp; &nbsp; echo -n &quot;$command&quot;<br />&nbsp; &nbsp; read -t 1 -s result #set result with 1st line (next lines are forgotten)<br />&nbsp; &nbsp; exec &lt;&amp;6 6&lt;&amp;- &gt;&amp;7 7&gt;&amp;-<br />&nbsp; &nbsp; set -e<br />fi<br />fi</p><p>echo -n &quot;$result&quot; #output result</p><p>How to debug that device problem?</p><p>If you help me how to locate the source, I will study it.</p>											<p class="post-edited">(Last edited by <strong>jmparatte</strong> on 29 Jan 2014, 10:52)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p224163">
				<div class="post-metadata">
					<div class="post-num">Post #233</div>
					<div class="post-author">rambler</div>
					<div class="post-datetime">
						31 Jan 2014, 12:22					</div>
				</div>
				<div class="post-content content">
					<p><a href="https://dev.openwrt.org/changeset/39407/">https://dev.openwrt.org/changeset/39407/</a></p><p>Backported to AA, thanks Rafał &amp; Gabor !</p><p>Looking forward to &quot;maintenance release&quot;.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p224164">
				<div class="post-metadata">
					<div class="post-num">Post #234</div>
					<div class="post-author">Zajec</div>
					<div class="post-datetime">
						31 Jan 2014, 12:23					</div>
				</div>
				<div class="post-content content">
					<p>You&#039;re welcome <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p224171">
				<div class="post-metadata">
					<div class="post-num">Post #235</div>
					<div class="post-author">jmparatte</div>
					<div class="post-datetime">
						31 Jan 2014, 15:38					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>rambler wrote:</cite><blockquote><p><a href="https://dev.openwrt.org/changeset/39407/">https://dev.openwrt.org/changeset/39407/</a></p><p>Backported to AA, thanks Rafał &amp; Gabor !</p><p>Looking forward to &quot;maintenance release&quot;.</p></blockquote></div><p>If I understand right, it&#039;s only a port to AA, not a correction of BB.</p><p>Test of BB r39424: Arduino UNO /dev/ttxACMx device is always affected.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p224172">
				<div class="post-metadata">
					<div class="post-num">Post #236</div>
					<div class="post-author">Zajec</div>
					<div class="post-datetime">
						31 Jan 2014, 15:48					</div>
				</div>
				<div class="post-content content">
					<p>BB lives in trunk, patch to the trunk was already commited some time ago (r39212).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p224176">
				<div class="post-metadata">
					<div class="post-num">Post #237</div>
					<div class="post-author">Squonk</div>
					<div class="post-datetime">
						31 Jan 2014, 17:12					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>jmparatte wrote:</cite><blockquote><div class="quotebox"><cite>rambler wrote:</cite><blockquote><p><a href="https://dev.openwrt.org/changeset/39407/">https://dev.openwrt.org/changeset/39407/</a></p><p>Backported to AA, thanks Rafał &amp; Gabor !</p><p>Looking forward to &quot;maintenance release&quot;.</p></blockquote></div><p>If I understand right, it&#039;s only a port to AA, not a correction of BB.</p><p>Test of BB r39424: Arduino UNO /dev/ttxACMx device is always affected.</p></blockquote></div><p>The problem that this patch fixes is an USB complete lock down until the device is unplugged, not a communication problem missing characters if you run CGI and not picocom.</p><p>Using this patch with both an Arduino&nbsp; Duemillanove and a Leonardo (thus /dev/ttyUSBx and /dev/tthACMx devices) works flawlessly for days, compared to hanging between a few minutes and an hour without the patch.</p><p>I don&#039;t think your problem is addressed by this patch, though it it may reveal an issue in the CDC ACM driver.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p224309">
				<div class="post-metadata">
					<div class="post-num">Post #238</div>
					<div class="post-author">huib</div>
					<div class="post-datetime">
						2 Feb 2014, 01:52					</div>
				</div>
				<div class="post-content content">
					<p>can you advice how to install the updates through the web Luci.</p><p>guidance would be aprriciated</p><p>rgds<br />Huib</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p224405">
				<div class="post-metadata">
					<div class="post-num">Post #239</div>
					<div class="post-author">jmparatte</div>
					<div class="post-datetime">
						3 Feb 2014, 08:55					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Squonk wrote:</cite><blockquote><p>I don&#039;t think your problem is addressed by this patch, though it it may reveal an issue in the CDC ACM driver.</p></blockquote></div><p>Yes, you are right, it&#039;s exactly what I think.<br />The problem occurs when open/close/reopen/... of /dev/ttyACMx and a simple Arduino UNO.<br />The problem is worst with MSP-430EXP2 and MSP-430F5529 which also work with /dev/ttyACMx.</p>											<p class="post-edited">(Last edited by <strong>jmparatte</strong> on 3 Feb 2014, 08:57)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p226059">
				<div class="post-metadata">
					<div class="post-num">Post #240</div>
					<div class="post-author">efcis</div>
					<div class="post-datetime">
						23 Feb 2014, 16:11					</div>
				</div>
				<div class="post-content content">
					<p>Hi</p><p>Just a noob question : Does this patch / update allow to use an USB 1.0 device directly on a WR703N (without USB 2.0 hub) ?</p><p>I installed the latest (as today) r39692. I&#039;m trying to use a plain USB numeric keypad on my WR703N (with triggerhappy) with no joy. Any packages / insmod required ?</p><p>Any help please ? Thanks !</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p226066">
				<div class="post-metadata">
					<div class="post-num">Post #241</div>
					<div class="post-author">Squonk</div>
					<div class="post-datetime">
						23 Feb 2014, 17:11					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>efcis wrote:</cite><blockquote><p>Hi</p><p>Just a noob question : Does this patch / update allow to use an USB 1.0 device directly on a WR703N (without USB 2.0 hub) ?</p><p>I installed the latest (as today) r39692. I&#039;m trying to use a plain USB numeric keypad on my WR703N (with triggerhappy) with no joy. Any packages / insmod required ?</p><p>Any help please ? Thanks !</p></blockquote></div><p>AFAIK, the AR9331 USB OHCI controller does not support low-speed (1.5 MBPS) devices, only full-speed (12 MBPS), while the EHCI controller is 480 MBPS high-speed.</p><p>So if your keyboard is only low-speed (USB 1.0 doesn&#039;t tell you anything), then you still have to put an external hub in-between.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p226077">
				<div class="post-metadata">
					<div class="post-num">Post #242</div>
					<div class="post-author">efcis</div>
					<div class="post-datetime">
						23 Feb 2014, 19:05					</div>
				</div>
				<div class="post-content content">
					<p>Merci Squonk</p><p>Despite a fresh upgrade with the latest trunk build (r39692) and using a hub, the keypad can&#039;t be recognized (same behavior reported on this <a href="https://dev.openwrt.org/ticket/12686">old ticket</a>). I will open another thread on the forum on this specific topic.</p><p>Thanks !</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p226279">
				<div class="post-metadata">
					<div class="post-num">Post #243</div>
					<div class="post-author">lizby</div>
					<div class="post-datetime">
						25 Feb 2014, 23:46					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>rambler wrote:</cite><blockquote><p><a href="https://dev.openwrt.org/changeset/39407/">https://dev.openwrt.org/changeset/39407/</a></p><p>Backported to AA, thanks Rafał &amp; Gabor !</p><p>Looking forward to &quot;maintenance release&quot;.</p></blockquote></div><p>In <a href="http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/">http://downloads.openwrt.org/attitude_a … x/generic/</a> and in packages, I don&#039;t see any dates more recent than 03-Apr-2013, so what does it mean that serial fix has been &quot;backported&quot;?</p><p>If it means that if you build your own AA version complete with all needed packages, it will be fixed, then my question is &quot;How do you do that&quot; (I&#039;ve often built from trunk, but not from a specific prior revision).</p><p>If you only need to build one particular package, or several, how do you do that, and can you replace the old packages in an AA final release installation.</p><p>Finally, what revision number is AA, final release: r36088?</p>											<p class="post-edited">(Last edited by <strong>lizby</strong> on 25 Feb 2014, 23:48)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p226412">
				<div class="post-metadata">
					<div class="post-num">Post #244</div>
					<div class="post-author">rambler</div>
					<div class="post-datetime">
						27 Feb 2014, 14:13					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>lizby wrote:</cite><blockquote><div class="quotebox"><cite>rambler wrote:</cite><blockquote><p><a href="https://dev.openwrt.org/changeset/39407/">https://dev.openwrt.org/changeset/39407/</a></p><p>Backported to AA, thanks Rafał &amp; Gabor !</p><p>Looking forward to &quot;maintenance release&quot;.</p></blockquote></div><p>In <a href="http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/">http://downloads.openwrt.org/attitude_a … x/generic/</a> and in packages, I don&#039;t see any dates more recent than 03-Apr-2013, so what does it mean that serial fix has been &quot;backported&quot;?</p><p>If it means that if you build your own AA version complete with all needed packages, it will be fixed, then my question is &quot;How do you do that&quot; (I&#039;ve often built from trunk, but not from a specific prior revision).</p><p>If you only need to build one particular package, or several, how do you do that, and can you replace the old packages in an AA final release installation.</p><p>Finally, what revision number is AA, final release: r36088?</p></blockquote></div><p>As you can see in <a href="https://dev.openwrt.org/log/branches/attitude_adjustment">https://dev.openwrt.org/log/branches/at … adjustment</a>, things are still being “backported” to AA, so that they will be included in a &quot;maintenance release&quot;, if it ever happens. (It was sort of planned for August / September 2013, <a href="http://wiki.openwrt.org/about/history#attitude.adjustment">http://wiki.openwrt.org/about/history#a … adjustment</a>, except that nothing is really scheduled in OpenWRT development.)</p><p>AA final release is indeed r36088, but you can checkout a later revision of the code, such as <br /></p><div class="codebox"><pre><code>svn co -r 39407 svn://svn.openwrt.org/openwrt/branches/attitude_adjustment</code></pre></div><p>to pick AA 12.09.1 r39407, where the fix was applied, and compile it using your build environment. A “simplified” build procedure, including building only required packages, is described in <a href="http://wiki.openwrt.org/doc/howto/easy.build">http://wiki.openwrt.org/doc/howto/easy.build</a> (I never tried it though).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p226427">
				<div class="post-metadata">
					<div class="post-num">Post #245</div>
					<div class="post-author">lizby</div>
					<div class="post-datetime">
						27 Feb 2014, 16:29					</div>
				</div>
				<div class="post-content content">
					<p>Thanks, Rambler.</p><p>In the openwrt directory of my headless Ubuntu build machine, I ran the following:</p><p>svn co -r 39407 svn://svn.openwrt.org/openwrt/branches/attitude_adjustment aa_r39407<br />cd aa_r39407<br />./scripts/feeds update<br />./scripts/feeds install -a<br />make defconfig<br />make menuconfig<br />I loaded an old config of mine for the WR703N with serial.</p><p>&quot;make V=99&quot; is now running.</p><p>This is from old notes.&nbsp; Anything else needed or recommended?</p>											<p class="post-edited">(Last edited by <strong>lizby</strong> on 27 Feb 2014, 16:36)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p226435">
				<div class="post-metadata">
					<div class="post-num">Post #246</div>
					<div class="post-author">rambler</div>
					<div class="post-datetime">
						27 Feb 2014, 18:29					</div>
				</div>
				<div class="post-content content">
					<p>Seems OK, and you are in a position to find out for sure. And post comments?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p226449">
				<div class="post-metadata">
					<div class="post-num">Post #247</div>
					<div class="post-author">lizby</div>
					<div class="post-datetime">
						27 Feb 2014, 21:19					</div>
				</div>
				<div class="post-content content">
					<p>Ok, that ran to completion and gave me, among others: openwrt-ar71xx-generic-tl-wr703n-v1-squashfs-sysupgrade.bin</p><p>I copied that to /var/www on the Ubuntu machine, went to /tmp on the WR703N, DL-ed the file with wget, and flashed it with: </p><p>sysupgrade -v openwrt-ar71xx-generic-tl-wr703n-v1-squashfs-sysupgrade.bin</p><p>After a couple of minutes I cycled the power and ssh-ed in again and got this: </p><p>...&nbsp; ATTITUDE ADJUSTMENT (Attitude Adjustment, r39407) ...</p><p>So all looks good.&nbsp; I&#039;ll try a serial test later.&nbsp; Then I&#039;ll be able to upgrade other WR703Ns.</p><p>My next question is:&nbsp; How do I build all packages as packages so that I can use my Ubuntu machine as a repository and add packages with &quot;opkg update&quot; without having to reflash the whole firmware and re-configure the packages?</p><p>Or ... are the AA 12.09 final release packages (other than serial) compatible with this backported firmware?</p>											<p class="post-edited">(Last edited by <strong>lizby</strong> on 27 Feb 2014, 21:27)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p226526">
				<div class="post-metadata">
					<div class="post-num">Post #248</div>
					<div class="post-author">rambler</div>
					<div class="post-datetime">
						28 Feb 2014, 18:38					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>lizby wrote:</cite><blockquote><p>My next question is:&nbsp; How do I build all packages as packages so that I can use my Ubuntu machine as a repository and add packages with &quot;opkg update&quot; without having to reflash the whole firmware and re-configure the packages?</p></blockquote></div><p>I believe it’s all defined in .config, whether a package is compiled at all, is included in the image (CONFIG_PACKAGE_*=y), or compiled as .ipk (CONFIG_PACKAGE_*=m), see <a href="http://wiki.openwrt.org/doc/howto/build#make.menuconfig">http://wiki.openwrt.org/doc/howto/build#make.menuconfig</a>. In &quot;make menuconfig&quot;, there must be somewhere an option to enable all packages, if that’s what you want? Isn’t the default .config building pretty much everything? (I am not really experienced with this.) Otherwise, you can easily compile a single package, such as </p><div class="codebox"><pre><code> make package/feeds/packages/ffmpeg/compile </code></pre></div><p>(see <a href="http://wiki.openwrt.org/doc/howto/build#building.single.packages">http://wiki.openwrt.org/doc/howto/build … e.packages</a>).<br /></p><div class="quotebox"><blockquote><p>Or ... are the AA 12.09 final release packages (other than serial) compatible with this backported firmware?</p></blockquote></div><p>Not really. While many of them probably are, it may be unwise to &quot;force install&quot; them, especially the kernel modules.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p226530">
				<div class="post-metadata">
					<div class="post-num">Post #249</div>
					<div class="post-author">Squonk</div>
					<div class="post-datetime">
						28 Feb 2014, 22:30					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>rambler wrote:</cite><blockquote><div class="quotebox"><cite>lizby wrote:</cite><blockquote><p>My next question is:&nbsp; How do I build all packages as packages so that I can use my Ubuntu machine as a repository and add packages with &quot;opkg update&quot; without having to reflash the whole firmware and re-configure the packages?</p></blockquote></div><p>I believe it’s all defined in .config, whether a package is compiled at all, is included in the image (CONFIG_PACKAGE_*=y), or compiled as .ipk (CONFIG_PACKAGE_*=m), see <a href="http://wiki.openwrt.org/doc/howto/build#make.menuconfig">http://wiki.openwrt.org/doc/howto/build#make.menuconfig</a>. In &quot;make menuconfig&quot;, there must be somewhere an option to enable all packages, if that’s what you want? Isn’t the default .config building pretty much everything? (I am not really experienced with this.)</p></blockquote></div><p>Check this forum thread: <a href="https://forum.openwrt.org/viewtopic.php?id=29619">https://forum.openwrt.org/viewtopic.php?id=29619</a></p><p>Basically, remove your .config file and in the &quot;make menuconfig&quot;, select the &quot;Global build settings ---&gt; Select all packages by default&quot;, then save and exit.</p><p>Then launch a &quot;screen&quot; command on the headless build server to be able to reconnect later, and run:<br /></p><div class="codebox"><pre><code>make -j 5 V=99 IGNORE_ERRORS=m BUILD_LOG=1</code></pre></div><p>... where -j 5 depends on how many cores you have on the machine, just use n + 1 (1 master + 4 worker jobs).</p><div class="quotebox"><cite>rambler wrote:</cite><blockquote><div class="quotebox"><blockquote><p>Or ... are the AA 12.09 final release packages (other than serial) compatible with this backported firmware?</p></blockquote></div><p>Not really. While many of them probably are, it may be unwise to &quot;force install&quot; them, especially the kernel modules.</p></blockquote></div><p>No, not at all, especially the kernel modules that contain a hash that depends on the built modules, in order to guarantee that the kernel core and modules have a consistent ABI (Application Binary Interface), i.e. compatible entry points for variables/functions between the different binary object files.</p>											<p class="post-edited">(Last edited by <strong>Squonk</strong> on 28 Feb 2014, 22:31)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p226531">
				<div class="post-metadata">
					<div class="post-num">Post #250</div>
					<div class="post-author">lizby</div>
					<div class="post-datetime">
						28 Feb 2014, 23:01					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for the responses.&nbsp; I had tried &quot;Global build settings ---&gt; Select all packages by default&quot;, and then &quot;make V=99&quot;, but got only a handful of packages (do I look in &quot;packages&quot; directory).</p><p>&gt;remove your .config file</p><p>Does this mean I need to remove all &quot;*.config&quot; files from the directory.&nbsp; I tried &quot;make defconfig&quot; but didn&#039;t see that that changed anything.</p><p>Anyway, it&#039;s running again in a screen with &quot;make -j 2 V=99 IGNORE_ERRORS=m BUILD_LOG=1&quot;&nbsp; (Atom motherboard, so I know it will take a very long time if it actually does make all packages).</p><p>Oops--just finished, so it didn&#039;t make all.&nbsp; bin/ar71xx contains files with this runs date and time.&nbsp; Here&#039;s what was output:<br /></p><div class="codebox"><pre><code>Generating index for package ./libjson_0.11-2_ar71xx.ipk
Generating index for package ./liblua_5.1.4-8_ar71xx.ipk
Generating index for package ./libnl-tiny_0.1-3_ar71xx.ipk
Generating index for package ./libopenssl_1.0.1e-1_ar71xx.ipk
Generating index for package ./libpcap_1.1.1-2_ar71xx.ipk
Generating index for package ./libubox_2013-10-19-734d28eb1a46358743cf8837c91e5d46695c3b91_ar71xx.ipk
Generating index for package ./libubus-lua_2013-08-08-b20a8a01c7faea5bcc9d34d10dcf7736589021b8_ar71xx.ipk
Generating index for package ./libubus_2013-08-08-b20a8a01c7faea5bcc9d34d10dcf7736589021b8_ar71xx.ipk
Generating index for package ./libuci-lua_2013-06-11.1-1_ar71xx.ipk
Generating index for package ./libuci_2013-06-11.1-1_ar71xx.ipk
Generating index for package ./libxtables_1.4.10-5_ar71xx.ipk
Generating index for package ./lua_5.1.4-8_ar71xx.ipk
Generating index for package ./mtd_18.1_ar71xx.ipk
Generating index for package ./netifd_2013-07-16-2674941b06c1ec67f1aff1bff9212e1372106641_ar71xx.ipk
Generating index for package ./opkg_9c97d5ecd795709c8584e972bfdf3aee3a5b846d-3_ar71xx.ipk
Generating index for package ./ppp-mod-pppoe_2.4.5-10_ar71xx.ipk
Generating index for package ./ppp_2.4.5-10_ar71xx.ipk
Generating index for package ./swconfig_10_ar71xx.ipk
Generating index for package ./uboot-envtools_2012.04.01-1_ar71xx.ipk
Generating index for package ./ubus_2013-08-08-b20a8a01c7faea5bcc9d34d10dcf7736589021b8_ar71xx.ipk
Generating index for package ./ubusd_2013-08-08-b20a8a01c7faea5bcc9d34d10dcf7736589021b8_ar71xx.ipk
Generating index for package ./uci_2013-06-11.1-1_ar71xx.ipk
Generating index for package ./uhttpd_2012-10-30-e57bf6d8bfa465a50eea2c30269acdfe751a46fd_ar71xx.ipk
Generating index for package ./wireless-tools_29-5_ar71xx.ipk
Generating index for package ./wpad-mini_20130405-1_ar71xx.ipk
Generating index for package ./zlib_1.2.7-1_ar71xx.ipk
make[2]: Leaving directory `/home/lb/openwrt/aa_r39407&#039;
make[1]: Leaving directory `/home/lb/openwrt/aa_r39407&#039;</code></pre></div><p>So how do I start with a fresh config with which I can select all?</p>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 10 of 13</div><nav><ul><li><a href="viewtopic.php%3Fid=39956&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39956&amp;p=8.html">8</a></li><li><a href="viewtopic.php%3Fid=39956&amp;p=9.html">9</a></li><li class="pagination-current"><span>10</span></li><li><a href="viewtopic.php%3Fid=39956&amp;p=11.html">11</a></li><li><a href="viewtopic.php%3Fid=39956&amp;p=12.html">12</a></li><li><a href="viewtopic.php%3Fid=39956&amp;p=13.html">13</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>