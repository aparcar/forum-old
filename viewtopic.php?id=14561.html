<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Kamikaze 7.09 on RB532 NAND</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 21 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p63608">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">nepalken</div>
					<div class="post-datetime">
						18 Feb 2008, 12:46					</div>
				</div>
				<div class="post-content content">
					<p>I compiled Kamikaze for RB532 an tried to flash the following vmlinux.elf generated in the build_mipsel/linux-2.6-rb532/, I get this</p><p>RouterBOOT booter 2.12</p><p>RouterBoard 532</p><p>CPU frequency: 264 MHz<br />&nbsp; Memory size:&nbsp; 32 MB</p><p>Press any key within 1 seconds to enter setup.<br />kernel not found<br />trying dhcp protocol... OK<br />resolved mac address 00:18:39:EE:0A:EC<br />Gateway: 192.168.1.2<br />transfer started ........................ transfer ok, time=3.52s<br />setting up elf image... OK<br />jumping to kernel code<br />Linux version 2.6.21.5 (ken@desar) (gcc version 4.1.2) #1 Mon Feb 18 10:42:07 NPT 2008<br />CPU revision is: 0001800a<br />Determined physical RAM map:<br /> memory: 01fffa00 @ 00000400 (usable)<br />Wasting 32 bytes for tracking 1 unused pages<br />Initrd not found or empty - disabling initrd<br />Built 1 zonelists.&nbsp; Total pages: 8128<br />Kernel command line: console=ttyS0,115200 gpio=16383 kmac=00:0C:42:04:48:A1 board=500 boot=1<br />korina mac = 00:0C:42:04:48:A1<br />Primary instruction cache 8kB, physically tagged, 4-way, linesize 16 bytes.<br />Primary data cache 8kB, 4-way, linesize 16 bytes.<br />Synthesized TLB refill handler (20 instructions).<br />Synthesized TLB load handler fastpath (32 instructions).<br />Synthesized TLB store handler fastpath (32 instructions).<br />Synthesized TLB modify handler fastpath (31 instructions).<br />Initializing IRQ&#039;s: 168 out of 256<br />PID hash table entries: 128 (order: 7, 512 bytes)<br />calculating r4koff... 00142440(1320000)<br />CPU frequency 264.00 MHz<br />Using 132.000 MHz high precision timer.<br />Dentry cache hash table entries: 4096 (order: 2, 16384 bytes)<br />Inode-cache hash table entries: 2048 (order: 1, 8192 bytes)<br />Memory: 28816k/32760k available (2076k kernel code, 3944k reserved, 323k data, 120k init, 0k highmem)<br />Mount-cache hash table entries: 512<br />NET: Registered protocol family 16<br />PCI: Initializing PCI<br />registering PCI controller with io_map_base unset<br />NET: Registered protocol family 2<br />Time: MIPS clocksource has been installed.<br />IP route cache hash table entries: 1024 (order: 0, 4096 bytes)<br />TCP established hash table entries: 1024 (order: 1, 8192 bytes)<br />TCP bind hash table entries: 1024 (order: 0, 4096 bytes)<br />TCP: Hash tables configured (established 1024 bind 1024)<br />TCP reno registered<br />squashfs: version 3.0 (2006/03/15) Phillip Lougher<br />JFFS2 version 2.2. (NAND) (C) 2001-2006 Red Hat, Inc.<br />yaffs Feb 18 2008 10:39:46 Installing.<br />io scheduler noop registered<br />io scheduler deadline registered (default)<br />Serial: 8250/16550 driver $Revision: 1.90 $ 2 ports, IRQ sharing disabled<br />serial8250: ttyS0 at MMIO 0x0 (irq = 104) is a 16550A<br />cf-mips module loaded<br />cf-mips: cf card not present<br />Trying to free already-free IRQ 149<br />rb500-cf: probe of rb500-cf.0 failed with error 1<br />Using NAPI with weight 64<br />eth0: Rx IRQ 40, Tx IRQ 41, 00:0c:42:04:48:a1<br />via-rhine.c:v1.10-LK1.4.3 2007-03-06 Written by Donald Becker<br />PCI: Enabling device 0000:00:02.0 (0080 -&gt; 0083)<br />io_map_base of root PCI bus 0000:00 unset.&nbsp; Trying to continue but you better<br />fix this issue or report it to linux-mips@linux-mips.org or your vendor.<br />eth1: VIA Rhine III at 0xb8800000, 00:0c:42:04:48:a2, IRQ 142.<br />eth1: MII PHY found at address 1, status 0x7849 advertising 05e1 Link 0000.<br />PCI: Enabling device 0000:00:03.0 (0080 -&gt; 0083)<br />eth2: VIA Rhine III at 0xb8800100, 00:0c:42:04:48:a3, IRQ 143.<br />eth2: MII PHY found at address 1, status 0x7849 advertising 05e1 Link 0000.<br />block2mtd: version $Revision: 1.30 $<br />RB500 nand<br />dev2base 0x18a20000 mask 0xffff0000 c 0x02d43a00 tc 0x00001336<br />NAND device: Manufacturer ID: 0xad, Chip ID: 0xf1 (Hynix NAND 128MiB 3,3V 8-bit)<br />Scanning device for bad blocks<br />Creating 2 MTD partitions on &quot;NAND 128MiB 3,3V 8-bit&quot;:<br />0x00000000-0x00400000 : &quot;RouterBoard NAND Boot&quot;<br />0x00400000-0x08000000 : &quot;RouterBoard NAND Main&quot;<br />nf_conntrack version 0.5.0 (255 buckets, 2040 max)<br />ip_tables: (C) 2000-2006 Netfilter Core Team<br />TCP vegas registered<br />NET: Registered protocol family 1<br />NET: Registered protocol family 17<br />802.1Q VLAN Support v1.8 Ben Greear &lt;greearb@candelatech.com&gt;<br />All bugs added by David S. Miller &lt;davem@redhat.com&gt;<br />VFS: Cannot open root device &quot;&lt;NULL&gt;&quot; or unknown-block(0,0)<br />Please append a correct &quot;root=&quot; boot option<br />Kernel panic - not syncing: VFS: Unable to mount root fs on unknown-block(0,0)</p><br /><br /><br /><br /><p>Can anyone tell me what could be wrong, I followed the documentation of howto is the wiki<br /><a href="http://wiki.openwrt.org/OpenWrtDocs/Hardware/Mikrotik/RB532">http://wiki.openwrt.org/OpenWrtDocs/Har … otik/RB532</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p63622">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">Wodin</div>
					<div class="post-datetime">
						18 Feb 2008, 16:16					</div>
				</div>
				<div class="post-content content">
					<p>I haven&#039;t installed OpenWrt on an RB532, but from a glance at the wiki page it looks like you install it the same way as the RB1xx.&nbsp; (The RB532 wiki page seems to skip a bunch of instructions, though.)</p><p>It looks like you&#039;re netbooting a non-netboot kernel.&nbsp; The netboot kernel has a root filesystem embedded in it.&nbsp; The one you&#039;re booting doesn&#039;t seem to have the root fs, and there&#039;s no fs on your flash, so the kernel panics.</p><p>Try recompiling, but where you specify the image type, choose &quot;netboot&quot;.&nbsp; (This will disable the other options like tgz, cpio, ext2, etc.)&nbsp; This should generate a netboot kernel with the rootfs embedded in it.&nbsp; After booting that you should be able to download the real kernel and rootfs to /tmp and write them to the flash.</p><p>See if the instructions here help:<br /><a href="http://wiki.openwrt.org/OpenWrtDocs/Hardware/Mikrotik/RB100">http://wiki.openwrt.org/OpenWrtDocs/Har … otik/RB100</a></p><p>(There might not be a wget2nand script for RB532, though, so follow the instructions in the RB532 wiki page after you have booted the netboot kernel if wget2nand does not work.)</p>											<p class="post-edited">(Last edited by <strong>Wodin</strong> on 18 Feb 2008, 16:21)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p63640">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">nepalken</div>
					<div class="post-datetime">
						18 Feb 2008, 20:08					</div>
				</div>
				<div class="post-content content">
					<p>I flashed the image, now I get this</p><p>root@OpenWrt:/# cat /proc/mtd<br />dev:&nbsp; &nbsp; size&nbsp; &nbsp;erasesize&nbsp; name<br />mtd0: 00400000 00020000 &quot;RouterBoard NAND Boot&quot;<br />mtd1: 07c00000 00020000 &quot;RouterBoard NAND Main&quot;</p><br /><p>There is no rootfs as specified in documentation<br />root@OpenWrt:/# cat /proc/mtd<br />dev:&nbsp; &nbsp; size&nbsp; &nbsp;erasesize&nbsp; name<br />mtd0: 00400000 00020000 &quot;Routerboard NAND boot&quot;<br />mtd1: 07c00000 00020000 &quot;rootfs&quot;</p><br /><p>So I could not get it boot to openwrt.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p63647">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">Wodin</div>
					<div class="post-datetime">
						18 Feb 2008, 21:58					</div>
				</div>
				<div class="post-content content">
					<p>OK, I think this changed at some point.&nbsp; (For RB1xx, and probably for RB532 too).</p><p>The name doesn&#039;t matter too much.&nbsp; You will notice that the size is correct.</p><p>The current version of OpenWrt for adm5120 (rb1xx) names the partitions kernel and rootfs, but older versions had the &quot;RouterBoard NAND...&quot; stuff.&nbsp; Write the kernel to &quot;... Boot&quot; and the fs to &quot;... Main&quot;.</p><p>By the way, I see there is a wget2nand script for rb532 in trunk, but not in 7.09.&nbsp; There is, however, a cf2nand in 7.09 and it expects the partitions to be named as your are:<br /><a href="https://svn.openwrt.org/openwrt/tags/kamikaze_7.09/target/linux/rb532-2.6/base-files/default/sbin/cf2nand">cf2nand</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p63675">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">nepalken</div>
					<div class="post-datetime">
						19 Feb 2008, 07:38					</div>
				</div>
				<div class="post-content content">
					<p>I tried again, did everthing as mentioned in documentation, but the router doesnt boot from NAND</p><p>it says this while&nbsp; rebooting<br />root@OpenWrt:/# save exit: isCheckpointed 1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />yaffs: dev is 32505857 name is &quot;mtdblock1&quot;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />yaffs: passed flags &quot;&quot;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />yaffs: Attempting MTD mount on 31.1, &quot;mtdblock1&quot;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />yaffs: auto selecting yaffs2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />yaffs: restored from checkpoint&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />save exit: isCheckpointed 1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />root@OpenWrt:/#&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />root@OpenWrt:/# reboot&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />The system is going down NOW !!&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />Sending SIGTERM to all processes.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />: umount: tmpfs busy - remounted read-only</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p63678">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">Wodin</div>
					<div class="post-datetime">
						19 Feb 2008, 09:18					</div>
				</div>
				<div class="post-content content">
					<p>Those message should not be a problem. What does it say while booting? Does the bootloader find the kernel on the flash?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p63694">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">nepalken</div>
					<div class="post-datetime">
						19 Feb 2008, 14:22					</div>
				</div>
				<div class="post-content content">
					<p>It would not boot as it couldn&#039;t find kernel.</p><p>I downloaded everything from <a href="http://wifi.ozo.com/airo/openwrt/firmware/kamikaze/2.6/rb5xx">http://wifi.ozo.com/airo/openwrt/firmwa … /2.6/rb5xx</a> including the vmlinux.</p><p>I mounted the nand boot, and made a dir called tmp and installed kernel there<br />I mounted rootfs and made a dir called tmp and installed rootfs.tgz file there and rebooted</p><p>It didn&#039;t boot from kernel. As I was running dnsmasq in other machine which provided boot image and it booted from there, as I mounted nandboot, I could see that the tmp directory and the kernel was there, so I copied the kernel from /mnt/tmp to /mnt only and deleted the tmp folder</p><p>similarly I copied rootfs.tgz from /mnt/tmp from the mtdblock1 to /mnt only and deleted the old tmp directory. </p><p>Then I rebooted, and now it booted from nand.</p><p>I think my boot image was lacking some files. </p><p>My bootimage would create only tmpfs partition, the bootimage from the wifi.ozo.com created one more partition apart from tmpfs. I think that was the difference</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p63696">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">Wodin</div>
					<div class="post-datetime">
						19 Feb 2008, 14:56					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>nepalken wrote:</cite><blockquote><p>It would not boot as it couldn&#039;t find kernel.</p><p>I downloaded everything from <a href="http://wifi.ozo.com/airo/openwrt/firmware/kamikaze/2.6/rb5xx">http://wifi.ozo.com/airo/openwrt/firmwa … /2.6/rb5xx</a> including the vmlinux.</p><p>I mounted the nand boot, and made a dir called tmp and installed kernel there<br />I mounted rootfs and made a dir called tmp and installed rootfs.tgz file there and rebooted</p></blockquote></div><p>OK, the instructions look a little wrong.</p><p>The &quot;tmp&quot; directory mentioned in the instructions is /tmp (i.e. in RAM, not on the flash.)&nbsp; You are supposed to put the kernel directly onto the boot partition.&nbsp; Not in a subdirectory called tmp.&nbsp; It&#039;s similar for the rootfs.</p><p>I see you worked it out.</p><p>The instructions should probably look like this:<br /></p><div class="codebox"><pre><code>mount /dev/mtdblock0 /mnt
cd /tmp
wget http://wifi.ozo.com/airo/openwrt/firmware/kamikaze/2.6/rb5xx/10304/kernel
mv /tmp/kernel /mnt
umount /mnt
mount /dev/mtdblock1 /mnt
wget http://wifi.ozo.com/airo/openwrt/firmware/kamikaze/2.6/rb5xx/10304/openwrt-rb532-2.6-rootfs.tgz
cd /mnt
tar xzvf /tmp/openwrt-rb532-2.6-rootfs.tgz
cd /
umount /mnt</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p63703">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">nepalken</div>
					<div class="post-datetime">
						19 Feb 2008, 17:52					</div>
				</div>
				<div class="post-content content">
					<p>Woodin,</p><p>Thank you for your assistance and clarifying to everyone the extra step needed to flash RB532.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p68928">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">robrob</div>
					<div class="post-datetime">
						30 May 2008, 04:39					</div>
				</div>
				<div class="post-content content">
					<p>Just wanted to post a correction for the use of the wget2nand command when flashing the RB routers. When you build kamikaze using the trunk the NAND kernel image file needs to be renamed, you have to add the &quot;2.6&quot; to the name. The kernel should be called &quot;openwrt-adm5120-2.6-rb1xx-kernel&quot; so wget2nand can find it. The rootfs file does not need to be renamed.</p><p>Rob</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>