<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Sysupgrade for RB943G</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 24 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p188767">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">Del</div>
					<div class="post-datetime">
						13 Jan 2013, 14:07					</div>
				</div>
				<div class="post-content content">
					<p>I would like to add support for using sysupgrade with RB493G, but input from somebody who has done it before will probably save me a lot of time. Check out the wiki-page on RB493G here: <a href="http://wiki.openwrt.org/toh/mikrotik/rb493g">http://wiki.openwrt.org/toh/mikrotik/rb493g</a></p><p>I have already spent some hours familiarizing myself with various parts involved, and it doesn&#039;t seem too intimidating. More specifically a sysupgrade is performed by the script package/base-files/files/sbin/sysupgrade which again relies on functions in package/base-files/files/lib/functions.sh and package/base-files/files/lib/upgrade/common.sh However, I have not been able to find documentation for these scripts. Scripts are generally challenging to read when there are little or no code comments, and function names are not always self-explanatory. Is there any documentation available for these scripts? Any recipe as to what quirks one should think of when attempting to use them on a new device?</p><p>Superficially I believe I have a fairly good overview of how sysupgrade works, it seems to go like this:<br />-create a root filesystem in ram, copying over all files need to run the router<br />-change root directory from flash-chip to the new root folder in router&#039;s ram using pivot_root<br />-write new firmware image to router&#039;s flash-chip</p><p>These operations are probably quite easy put into a tailored script for RB493G, so I don&#039;t think adding sysupgrade support is a hard task once familiar with the details of the scripts. First up is that RB493G uses the yaffs2 filesystem, will that just work automagically in sysupgrade, or will it need tailoring? Second is the flash layout, here it seems this should work since the kernel and rootfs partitions are already present from factory with appropriate naming (although they have the more unusual numbers 5 and 6).</p><p>Second is the bin-file. Users would want the kernel and the rootfs packaged together in a bin file. Building a bin file will need to be included in OpenWrt&#039;s buildroot environment. Is there any documentation with regard to this, or will I need to look at how it is done for routers and try to mimick?</p>											<p class="post-edited">(Last edited by <strong>Del</strong> on 13 Jan 2013, 21:06)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>