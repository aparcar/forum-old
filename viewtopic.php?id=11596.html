<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> OpenVPN between 2 OpenWRT systems</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 17 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p52163">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">noelbou</div>
					<div class="post-datetime">
						11 Jul 2007, 18:58					</div>
				</div>
				<div class="post-content content">
					<p>Hello all !</p><p>After ready the OpenVPN docs and HowTos i am still missing something ...</p><p>My goal would be to setup a VPN in between two WRTSL54GS routers <br />to route the IAX2 traffic (UDP port 4569) ... in between them (Asterisk trunk)</p><p>Now i can&#039;t figure out to accomplish this&nbsp; ...</p><p>Do i need to run the OpenVPN Server on one side and a VPN client or the other side ? <br />Or ???<br />I would appreciate any help. No detailed installation needed just the general setup ...</p><p>Tnx.</p><p>Noel</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p52164">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">vincentfox</div>
					<div class="post-datetime">
						11 Jul 2007, 19:16					</div>
				</div>
				<div class="post-content content">
					<p><a href="http://en.wikipedia.org/wiki/UDP_hole_punching">http://en.wikipedia.org/wiki/UDP_hole_punching</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p52166">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">noelbou</div>
					<div class="post-datetime">
						11 Jul 2007, 19:40					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>vincentfox wrote:</cite><blockquote><p><a href="http://en.wikipedia.org/wiki/UDP_hole_punching">http://en.wikipedia.org/wiki/UDP_hole_punching</a></p></blockquote></div><p>Tnx Vincentefox ! ... I may be missing something but i don&#039;t really see how this can help me ... (?)<br />I am looking fo the general procedure to setup a VPN in between 2 OpenWrt ... <br />so that IAX2 traffic in between the systems would go through the VPN (for secure VoIP communication) in<br />between the systems.</p><br /><p>Noel</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p52178">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">500gx</div>
					<div class="post-datetime">
						11 Jul 2007, 23:57					</div>
				</div>
				<div class="post-content content">
					<p>As you are not giving out much clues about what you tried and what did or didn&#039;t work I will give the most basic suggestions. <br />1.First install the openvpn package (ipkg install openvpn) on both sides. <br />2.Grab the client server example files from the openvpn website and see if you can get this to work. Login to both machines using ssh and run openvpn from the command line to see its output.&nbsp; <br />3.If you manage to achieve a working setup based on the defaults start editing the configuration on both sides<br />4.Post back here your exact problems with your versions of both config files. (remove specific ip addresses or domain names if you feel that is needed for security reasons).</p><p>Good luck.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p52193">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">noelbou</div>
					<div class="post-datetime">
						12 Jul 2007, 01:40					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>500gx wrote:</cite><blockquote><p>As you are not giving out much clues about what you tried and what did or didn&#039;t work I will give the most basic suggestions. </p><p>Good luck.</p></blockquote></div><p>Tnx for your reply !</p><p>Well i haven&#039;t tried anything yet as i am still trying to understand what i need to do ;-)</p><p>I have OpenVPN installed on my WRTSL54GS ... </p><p>I have read the OpenVPNHowTo: <a href="http://wiki.openwrt.org/OpenVPNHowTo?highlight=%28HowTo%29">http://wiki.openwrt.org/OpenVPNHowTo?hi … 28HowTo%29</a><br />which give the setup for a VPN server on OpenWrt and VPN client on Windows ... </p><p>So i suppose i need Install the OpenVPN packages on both and configure one side as server (as above) <br />and the other side as a VPN client ... Right ?</p><p>BTW the Webif interface seems to offer to configure the VPN as client ...&nbsp; </p><p>Anyway i will give it a try later as &quot;trying things&quot; is&nbsp; the best way to learn&nbsp; ...<br />and will report later</p><p>Noel</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p52195">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">noelbou</div>
					<div class="post-datetime">
						12 Jul 2007, 04:07					</div>
				</div>
				<div class="post-content content">
					<p>Update ...</p><p>I have made some test with 2 WRT54GS on my local lan with one running OpenVPN Server and the other an OpenVPN client and ...<br />it seems to work ...&nbsp; </p><p>I setup the server as given in the openVPNHowTo:&nbsp; <a href="http://wiki.openwrt.org/OpenVPNHowTo?highlight=%28HowTo%29">http://wiki.openwrt.org/OpenVPNHowTo?hi … 28HowTo%29</a><br />.. and the 2nd one using the WebIF </p><p>Here are the log for the Server and the Client</p><p>+-----------------------+<br />OpenVPN server Log</p><p>Jul 12 01:01:15 (none) kern.notice openvpn[1069]: OpenVPN 2.0.9 mipsel-linux [SSL] [LZO] [EPOLL] built on Feb 13 2007<br />Jul 12 01:01:15 (none) kern.warn openvpn[1069]: WARNING: file &#039;/etc/secret.key&#039; is group or others accessible<br />Jul 12 01:01:15 (none) kern.notice openvpn[1069]: Static Encrypt: Cipher &#039;BF-CBC&#039; initialized with 128 bit key<br />Jul 12 01:01:15 (none) kern.notice openvpn[1069]: Static Encrypt: Using 160 bit message hash &#039;SHA1&#039; for HMAC authentication<br />Jul 12 01:01:15 (none) kern.notice openvpn[1069]: Static Decrypt: Cipher &#039;BF-CBC&#039; initialized with 128 bit key<br />Jul 12 01:01:15 (none) kern.notice openvpn[1069]: Static Decrypt: Using 160 bit message hash &#039;SHA1&#039; for HMAC authentication<br />Jul 12 01:01:15 (none) kern.notice openvpn[1069]: TUN/TAP device tap0 opened<br />Jul 12 01:01:15 (none) kern.notice openvpn[1069]: Data Channel MTU parms [ L:1576 D:1450 EF:44 EB:4 ET:32 EL:0 ]<br />Jul 12 01:01:15 (none) kern.notice openvpn[1069]: Local Options hash (VER=V4): &#039;8b888ddc&#039;<br />Jul 12 01:01:15 (none) kern.notice openvpn[1069]: Expected Remote Options hash (VER=V4): &#039;8b888ddc&#039;<br />Jul 12 01:01:15 (none) kern.notice openvpn[1075]: UDPv4 link local (bound): [undef]:1194<br />Jul 12 01:01:15 (none) kern.notice openvpn[1075]: UDPv4 link remote: [undef]</p><p>tap0&nbsp; &nbsp; &nbsp; Link encap:Ethernet&nbsp; HWaddr 00:FF:B4:7E:09:0C<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING PROMISC MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:0 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:0 errors:0 dropped:163 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:0 (0.0 B)&nbsp; TX bytes:0 (0.0 B)</p><br /><p>+-----------------------+</p><p>OpenVPN Client Log</p><p>Jul 12 00:42:06 (none) kern.notice openvpn[504]: OpenVPN 2.0.9 mipsel-linux [SSL] [LZO] [EPOLL] built on Feb 13 2007<br />Jul 12 00:42:06 (none) kern.notice openvpn[504]: Static Encrypt: Cipher &#039;BF-CBC&#039; initialized with 128 bit key<br />Jul 12 00:42:06 (none) kern.notice openvpn[504]: Static Encrypt: Using 160 bit message hash &#039;SHA1&#039; for HMAC authentication<br />Jul 12 00:42:06 (none) kern.notice openvpn[504]: Static Decrypt: Cipher &#039;BF-CBC&#039; initialized with 128 bit key<br />Jul 12 00:42:06 (none) kern.notice openvpn[504]: Static Decrypt: Using 160 bit message hash &#039;SHA1&#039; for HMAC authentication<br />Jul 12 00:42:06 (none) kern.notice openvpn[504]: LZO compression initialized<br />Jul 12 00:42:06 (none) kern.notice openvpn[504]: TUN/TAP device tun0 opened<br />Jul 12 00:42:06 (none) kern.notice openvpn[504]: Data Channel MTU parms [ L:1545 D:1450 EF:45 EB:135 ET:0 EL:0 AF:3/1 ]<br />Jul 12 00:42:06 (none) kern.notice openvpn[504]: Local Options hash (VER=V4): &#039;62cf4b05&#039;<br />Jul 12 00:42:06 (none) kern.notice openvpn[504]: Expected Remote Options hash (VER=V4): &#039;62cf4b05&#039;<br />Jul 12 00:42:06 (none) kern.notice openvpn[512]: UDPv4 link local: [undef]<br />Jul 12 00:42:06 (none) kern.notice openvpn[512]: UDPv4 link remote: 192.168.1.50:1194</p><br /><p>Noel</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p52243">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">noelbou</div>
					<div class="post-datetime">
						12 Jul 2007, 21:39					</div>
				</div>
				<div class="post-content content">
					<p>Last update:</p><p>I got the openVPN Server and Client running on 2 WRT54GS to work and connect on startup.</p><p>To setup the server, i basically followed the client setup in the openVPNHowTo.</p><p>For the client, i simply used the WebIf interface.</p><p>I added the server startup script as S46openvpn under /etc/init.d</p><p>and on the client side, the WebIf interface changed the nvram value so that the client is started</p><p>Some traces:</p><p>openVPN client<br />476 root&nbsp; &nbsp; &nbsp; &nbsp;1076 S&nbsp; &nbsp;openvpn --proto udp --port 1194 --remote 192.168.1.50</p><p>openVPN Server<br />507 root&nbsp; &nbsp; &nbsp; &nbsp;1092 S&nbsp; &nbsp;/usr/sbin/openvpn --daemon --config /etc/server.ovpn</p><br /><p>tap0&nbsp; &nbsp; &nbsp; Link encap:Ethernet&nbsp; HWaddr 00:FF:7A:39:4F:92<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING PROMISC MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:0 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:0 errors:0 dropped:1498 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:0 (0.0 B)&nbsp; TX bytes:0 (0.0 B)</p><p>Strangely ifconfig doesn&#039;t display a tun0 interface on the client ?</p><p>but according to the log it seems ok ... :</p><p>Jul 12 17:47:54 (none) kern.notice openvpn[468]: OpenVPN 2.0.9 mipsel-linux [SSL] [LZO] [EPOLL] built on Feb 13 2007<br />Jul 12 17:47:54 (none) kern.notice openvpn[468]: Static Encrypt: Cipher &#039;BF-CBC&#039; initialized with 128 bit key<br />Jul 12 17:47:54 (none) kern.notice openvpn[468]: Static Encrypt: Using 160 bit message hash &#039;SHA1&#039; for HMAC authentication<br />Jul 12 17:47:54 (none) kern.notice openvpn[468]: Static Decrypt: Cipher &#039;BF-CBC&#039; initialized with 128 bit key<br />Jul 12 17:47:54 (none) kern.notice openvpn[468]: Static Decrypt: Using 160 bit message hash &#039;SHA1&#039; for HMAC authentication<br />Jul 12 17:47:54 (none) kern.notice openvpn[468]: LZO compression initialized<br />Jul 12 17:47:54 (none) kern.notice openvpn[468]: TUN/TAP device tun0 opened<br />Jul 12 17:47:54 (none) kern.notice openvpn[468]: Data Channel MTU parms [ L:1545 D:1450 EF:45 EB:135 ET:0 EL:0 AF:3/1 ]<br />Jul 12 17:47:54 (none) kern.notice openvpn[468]: Local Options hash (VER=V4): &#039;62cf4b05&#039;<br />Jul 12 17:47:54 (none) kern.notice openvpn[468]: Expected Remote Options hash (VER=V4): &#039;62cf4b05&#039;<br />Jul 12 17:47:55 (none) kern.notice openvpn[476]: UDPv4 link local: [undef]<br />Jul 12 17:47:55 (none) kern.notice openvpn[476]: UDPv4 link remote: 192.168.1.50:1194</p><p>It says tun0 opened and connects to the server (on lan)</p><p>+==============================================+</p><p>I am still unsure on the VPN workings ... <br />could someone tell me please:</p><p>If i understand all traffic going in between the VPN server and client will be &quot;tuneled&quot; trough the VPN <br />no matter the dest ports or protocols ... Right ?<br />... so that the VPN will encapsulate, encript and optionally compress the data transiting in between the 2 systems ... Right ?<br />... and everything will transit on port 1194 ... Right or ?</p><p>Thanks for anyone willing to contibute to my education ;-)</p><p>Noel</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>