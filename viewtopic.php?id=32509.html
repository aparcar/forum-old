<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Routed Client with relayd (Pseudobridge)</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 1 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p146292">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">blasco51</div>
					<div class="post-datetime">
						21 Oct 2011, 01:01					</div>
				</div>
				<div class="post-content content">
					<p>I need to give Internet access via wireless lan to some wired hosts. After reading the wiki I chose the Pseudobridge way as described at <a href="http://wiki.openwrt.org/doc/recipes/relayclient">http://wiki.openwrt.org/doc/recipes/relayclient</a></p><p>openwrt gets it ip via dhcp but wired hosts don&#039;t get any.<br />What am I missing?<br />Here follow the configuration files I have:</p><br /><p>FILE: /etc/config/dhcp</p><br /><p>config &#039;dnsmasq&#039;<br />&nbsp; &nbsp; option &#039;domainneeded&#039; &#039;1&#039;<br />&nbsp; &nbsp; option &#039;boguspriv&#039; &#039;1&#039;<br />&nbsp; &nbsp; option &#039;filterwin2k&#039; &#039;0&#039;<br />&nbsp; &nbsp; option &#039;localise_queries&#039; &#039;1&#039;<br />&nbsp; &nbsp; option &#039;local&#039; &#039;/lan/&#039;<br />&nbsp; &nbsp; option &#039;domain&#039; &#039;lan&#039;<br />&nbsp; &nbsp; option &#039;expandhosts&#039; &#039;1&#039;<br />&nbsp; &nbsp; option &#039;nonegcache&#039; &#039;0&#039;<br />&nbsp; &nbsp; option &#039;authoritative&#039; &#039;1&#039;<br />&nbsp; &nbsp; option &#039;readethers&#039; &#039;1&#039;<br />&nbsp; &nbsp; option &#039;leasefile&#039; &#039;/tmp/dhcp.leases&#039;<br />&nbsp; &nbsp; option &#039;resolvfile&#039; &#039;/tmp/resolv.conf.auto&#039;</p><p>config &#039;dhcp&#039; &#039;lan&#039;<br />&nbsp; &nbsp; option &#039;interface&#039; &#039;lan&#039;<br />&nbsp; &nbsp; option &#039;start&#039; &#039;100&#039;<br />&nbsp; &nbsp; option &#039;limit&#039; &#039;150&#039;<br />&nbsp; &nbsp; option &#039;leasetime&#039; &#039;12h&#039;<br />&nbsp; &nbsp; option &#039;ignore&#039; &#039;1&#039;</p><p>config &#039;dhcp&#039; &#039;wan&#039;<br />&nbsp; &nbsp; option &#039;interface&#039; &#039;wan&#039;<br />&nbsp; &nbsp; option &#039;ignore&#039; &#039;1&#039;</p><br /><p>FILE: /etc/config/dropbear</p><p>config dropbear<br />&nbsp; &nbsp; option PasswordAuth &#039;on&#039;<br />&nbsp; &nbsp; option Port&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#039;22&#039;<br />#&nbsp; &nbsp; option BannerFile&nbsp; &nbsp;&#039;/etc/banner&#039;</p><p>FILE: /etc/config/firewall</p><br /><p>config &#039;defaults&#039;<br />&nbsp; &nbsp; option &#039;syn_flood&#039; &#039;1&#039;<br />&nbsp; &nbsp; option &#039;input&#039; &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option &#039;output&#039; &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option &#039;forward&#039; &#039;REJECT&#039;</p><p>config &#039;zone&#039;<br />&nbsp; &nbsp; option &#039;name&#039; &#039;lan&#039;<br />&nbsp; &nbsp; option &#039;input&#039; &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option &#039;output&#039; &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option &#039;forward&#039; &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option &#039;network&#039; &#039;lan wwan&#039;</p><p>config &#039;zone&#039;<br />&nbsp; &nbsp; option &#039;name&#039; &#039;wan&#039;<br />&nbsp; &nbsp; option &#039;input&#039; &#039;REJECT&#039;<br />&nbsp; &nbsp; option &#039;output&#039; &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option &#039;forward&#039; &#039;REJECT&#039;<br />&nbsp; &nbsp; option &#039;masq&#039; &#039;1&#039;<br />&nbsp; &nbsp; option &#039;mtu_fix&#039; &#039;1&#039;</p><p>config &#039;forwarding&#039;<br />&nbsp; &nbsp; option &#039;src&#039; &#039;lan&#039;<br />&nbsp; &nbsp; option &#039;dest&#039; &#039;wan&#039;</p><p>config &#039;rule&#039;<br />&nbsp; &nbsp; option &#039;src&#039; &#039;wan&#039;<br />&nbsp; &nbsp; option &#039;proto&#039; &#039;udp&#039;<br />&nbsp; &nbsp; option &#039;dest_port&#039; &#039;68&#039;<br />&nbsp; &nbsp; option &#039;target&#039; &#039;ACCEPT&#039;</p><p>config &#039;rule&#039;<br />&nbsp; &nbsp; option &#039;src&#039; &#039;wan&#039;<br />&nbsp; &nbsp; option &#039;proto&#039; &#039;icmp&#039;<br />&nbsp; &nbsp; option &#039;icmp_type&#039; &#039;echo-request&#039;<br />&nbsp; &nbsp; option &#039;target&#039; &#039;ACCEPT&#039;</p><p>config &#039;include&#039;<br />&nbsp; &nbsp; option &#039;path&#039; &#039;/etc/firewall.user&#039;</p><br /><p>FILE: /etc/config/luci</p><br /><p>config &#039;core&#039; &#039;main&#039;<br />&nbsp; &nbsp; option &#039;lang&#039; &#039;auto&#039;<br />&nbsp; &nbsp; option &#039;mediaurlbase&#039; &#039;/luci-static/openwrt.org&#039;<br />&nbsp; &nbsp; option &#039;resourcebase&#039; &#039;/luci-static/resources&#039;</p><p>config &#039;extern&#039; &#039;flash_keep&#039;<br />&nbsp; &nbsp; option &#039;uci&#039; &#039;/etc/config/&#039;<br />&nbsp; &nbsp; option &#039;dropbear&#039; &#039;/etc/dropbear/&#039;<br />&nbsp; &nbsp; option &#039;openvpn&#039; &#039;/etc/openvpn/&#039;<br />&nbsp; &nbsp; option &#039;passwd&#039; &#039;/etc/passwd&#039;<br />&nbsp; &nbsp; option &#039;opkg&#039; &#039;/etc/opkg.conf&#039;<br />&nbsp; &nbsp; option &#039;firewall&#039; &#039;/etc/firewall.user&#039;<br />&nbsp; &nbsp; option &#039;uploads&#039; &#039;/lib/uci/upload/&#039;</p><p>config &#039;internal&#039; &#039;languages&#039;<br />&nbsp; &nbsp; option &#039;en&#039; &#039;English&#039;</p><p>config &#039;internal&#039; &#039;sauth&#039;<br />&nbsp; &nbsp; option &#039;sessionpath&#039; &#039;/tmp/luci-sessions&#039;<br />&nbsp; &nbsp; option &#039;sessiontime&#039; &#039;3600&#039;</p><p>config &#039;internal&#039; &#039;ccache&#039;<br />&nbsp; &nbsp; option &#039;enable&#039; &#039;1&#039;</p><p>config &#039;internal&#039; &#039;template&#039;<br />&nbsp; &nbsp; option &#039;compiler_mode&#039; &#039;memory&#039;<br />&nbsp; &nbsp; option &#039;compiledir&#039; &#039;/tmp/luci-templatecache&#039;</p><p>config &#039;internal&#039; &#039;themes&#039;<br />&nbsp; &nbsp; option &#039;OpenWrt&#039; &#039;/luci-static/openwrt.org&#039;</p><br /><p>FILE: /etc/config/network</p><br /><p>config &#039;switch&#039; &#039;eth0&#039;<br />&nbsp; &nbsp; option &#039;enable&#039; &#039;1&#039;</p><p>config &#039;switch_vlan&#039; &#039;eth0_0&#039;<br />&nbsp; &nbsp; option &#039;device&#039; &#039;eth0&#039;<br />&nbsp; &nbsp; option &#039;vlan&#039; &#039;0&#039;<br />&nbsp; &nbsp; option &#039;ports&#039; &#039;0 1 2 3 5&#039;</p><p>config &#039;switch_vlan&#039; &#039;eth0_1&#039;<br />&nbsp; &nbsp; option &#039;device&#039; &#039;eth0&#039;<br />&nbsp; &nbsp; option &#039;vlan&#039; &#039;1&#039;<br />&nbsp; &nbsp; option &#039;ports&#039; &#039;4 5&#039;</p><p>config &#039;interface&#039; &#039;loopback&#039;<br />&nbsp; &nbsp; option &#039;ifname&#039; &#039;lo&#039;<br />&nbsp; &nbsp; option &#039;proto&#039; &#039;static&#039;<br />&nbsp; &nbsp; option &#039;ipaddr&#039; &#039;127.0.0.1&#039;<br />&nbsp; &nbsp; option &#039;netmask&#039; &#039;255.0.0.0&#039;</p><p>config &#039;interface&#039; &#039;lan&#039;<br />&nbsp; &nbsp; option &#039;type&#039; &#039;bridge&#039;<br />&nbsp; &nbsp; option &#039;ifname&#039; &#039;eth0.0&#039;<br />&nbsp; &nbsp; option &#039;proto&#039; &#039;static&#039;<br />&nbsp; &nbsp; option &#039;ipaddr&#039; &#039;192.168.1.1&#039;<br />&nbsp; &nbsp; option &#039;netmask&#039; &#039;255.255.255.0&#039;</p><p>config &#039;interface&#039; &#039;wan&#039;<br />&nbsp; &nbsp; option &#039;ifname&#039; &#039;eth0.1&#039;<br />&nbsp; &nbsp; option &#039;proto&#039; &#039;dhcp&#039;</p><p>config &#039;interface&#039; &#039;wwan&#039;<br />&nbsp; &nbsp; option &#039;proto&#039; &#039;dhcp&#039;</p><p>config &#039;interface&#039; &#039;stabridge&#039;<br />&nbsp; &nbsp; option &#039;proto&#039; &#039;relay&#039;<br />&nbsp; &nbsp; option &#039;network&#039; &#039;lan wwan&#039;</p><br /><p>FILE: /etc/config/system</p><p>config system<br />&nbsp; &nbsp; option hostname&nbsp; &nbsp; OpenWrt<br />&nbsp; &nbsp; option timezone&nbsp; &nbsp; UTC</p><p>config rdate<br />&nbsp; &nbsp; list server ntp2.ien.it<br />&nbsp; &nbsp; list server ptbtime1.ptb.de<br />&nbsp; &nbsp; list server ntp.xs4all.nl<br />&nbsp; &nbsp; list server ptbtime2.ptb.de<br />&nbsp; &nbsp; list server cudns.cit.cornell.edu</p><p>FILE: /etc/config/ucitrack</p><p>config network<br />&nbsp; &nbsp; option init network<br />&nbsp; &nbsp; list affects dhcp</p><p>config wireless<br />&nbsp; &nbsp; list affects network</p><p>config firewall<br />&nbsp; &nbsp; option init firewall<br />&nbsp; &nbsp; list affects luci-splash<br />&nbsp; &nbsp; list affects qos</p><p>config olsr<br />&nbsp; &nbsp; option init olsrd</p><p>config dhcp<br />&nbsp; &nbsp; option init dnsmasq</p><p>config dropbear<br />&nbsp; &nbsp; option init dropbear</p><p>config httpd<br />&nbsp; &nbsp; option init httpd</p><p>config fstab<br />&nbsp; &nbsp; option init fstab</p><p>config qos<br />&nbsp; &nbsp; option init qos</p><p>config system<br />&nbsp; &nbsp; option init led<br />&nbsp; &nbsp; list affects luci_statistics</p><p>config luci_splash<br />&nbsp; &nbsp; option init luci_splash</p><p>config upnpd<br />&nbsp; &nbsp; option init miniupnpd</p><p>config ntpclient<br />&nbsp; &nbsp; option init ntpclient</p><p>config samba<br />&nbsp; &nbsp; option init samba</p><p>config tinyproxy<br />&nbsp; &nbsp; option init tinyproxy</p><p>FILE: /etc/config/uhttpd</p><p># Server configuration<br />config uhttpd main</p><p>&nbsp; &nbsp; # HTTP listen addresses, multiple allowed<br />&nbsp; &nbsp; list listen_http&nbsp; &nbsp; 0.0.0.0:80<br />#&nbsp; &nbsp; list listen_http&nbsp; &nbsp; [::]:80</p><p>&nbsp; &nbsp; # HTTPS listen addresses, multiple allowed<br />&nbsp; &nbsp; list listen_https&nbsp; &nbsp; 0.0.0.0:443<br />#&nbsp; &nbsp; list listen_https&nbsp; &nbsp; [::]:443</p><p>&nbsp; &nbsp; # Server document root<br />&nbsp; &nbsp; option home&nbsp; &nbsp; &nbsp; &nbsp; /www</p><p>&nbsp; &nbsp; # Certificate and private key for HTTPS.<br />&nbsp; &nbsp; # If no listen_https addresses are given,<br />&nbsp; &nbsp; # the key options are ignored.<br />&nbsp; &nbsp; option cert&nbsp; &nbsp; &nbsp; &nbsp; /etc/uhttpd.crt<br />&nbsp; &nbsp; option key&nbsp; &nbsp; &nbsp; &nbsp; /etc/uhttpd.key</p><p>&nbsp; &nbsp; # CGI url prefix, will be searched in docroot.<br />&nbsp; &nbsp; # Default is /cgi-bin<br />&nbsp; &nbsp; option cgi_prefix&nbsp; &nbsp; /cgi-bin</p><p>&nbsp; &nbsp; # Lua url prefix and handler script.<br />&nbsp; &nbsp; # Lua support is disabled if no prefix given.<br />#&nbsp; &nbsp; option lua_prefix&nbsp; &nbsp; /luci<br />#&nbsp; &nbsp; option lua_handler&nbsp; &nbsp; /usr/lib/lua/luci/sgi/uhttpd.lua</p><p>&nbsp; &nbsp; # CGI/Lua timeout, if the called script does not<br />&nbsp; &nbsp; # write data within the given amount of seconds,<br />&nbsp; &nbsp; # the server will temrinate the request with<br />&nbsp; &nbsp; # 504 Gateway Timeout response.<br />&nbsp; &nbsp; option script_timeout&nbsp; &nbsp; 60</p><p>&nbsp; &nbsp; # Basic auth realm, defaults to local hostname<br />#&nbsp; &nbsp; option realm&nbsp; &nbsp; OpenWrt</p><p>&nbsp; &nbsp; # Configuration file in busybox httpd format<br />#&nbsp; &nbsp; option config&nbsp; &nbsp; /etc/httpd.conf</p><br /><p># Certificate defaults for px5g key generator<br />config cert px5g</p><p>&nbsp; &nbsp; # Validity time<br />&nbsp; &nbsp; option days&nbsp; &nbsp; &nbsp; &nbsp; 730</p><p>&nbsp; &nbsp; # RSA key size<br />&nbsp; &nbsp; option bits&nbsp; &nbsp; &nbsp; &nbsp; 1024</p><p>&nbsp; &nbsp; # Location<br />&nbsp; &nbsp; option country&nbsp; &nbsp; &nbsp; &nbsp; DE<br />&nbsp; &nbsp; option state&nbsp; &nbsp; &nbsp; &nbsp; Berlin<br />&nbsp; &nbsp; option location&nbsp; &nbsp; &nbsp; &nbsp; Berlin</p><p>&nbsp; &nbsp; # Common name<br />&nbsp; &nbsp; option commonname&nbsp; &nbsp; OpenWrt</p><br /><p>FILE: /etc/config/wireless</p><br /><p>config &#039;wifi-device&#039; &#039;radio0&#039;<br />&nbsp; &nbsp; option &#039;type&#039; &#039;mac80211&#039;<br />&nbsp; &nbsp; option &#039;macaddr&#039; &#039;00:16:b6:d9:dd:94&#039;<br />&nbsp; &nbsp; option &#039;hwmode&#039; &#039;11g&#039;<br />&nbsp; &nbsp; option &#039;disabled&#039; &#039;0&#039;<br />&nbsp; &nbsp; option &#039;channel&#039; &#039;11&#039;</p><p>config &#039;wifi-iface&#039;<br />&nbsp; &nbsp; option &#039;device&#039; &#039;radio0&#039;<br />&nbsp; &nbsp; option &#039;network&#039; &#039;wwan&#039;<br />&nbsp; &nbsp; option &#039;mode&#039; &#039;sta&#039;<br />&nbsp; &nbsp; option &#039;ssid&#039; &#039;BLALLY_WPA&#039;<br />&nbsp; &nbsp; option &#039;encryption&#039; &#039;psk2&#039;<br />&nbsp; &nbsp; option &#039;key&#039; &#039;Fetzxr0FOy&#039;</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p146309">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">fyi</div>
					<div class="post-datetime">
						21 Oct 2011, 08:30					</div>
				</div>
				<div class="post-content content">
					<div class="codebox"><pre><code>config &#039;switch_vlan&#039; &#039;eth0_0&#039;
    option &#039;device&#039; &#039;eth0&#039;
    option &#039;vlan&#039; &#039;0&#039;
    option &#039;ports&#039; &#039;0 1 2 3 5t&#039;

config &#039;switch_vlan&#039; &#039;eth0_1&#039;
    option &#039;device&#039; &#039;eth0&#039;
    option &#039;vlan&#039; &#039;1&#039;
    option &#039;ports&#039; &#039;4 5t&#039;</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p148474">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">tomdavidson</div>
					<div class="post-datetime">
						14 Nov 2011, 19:24					</div>
				</div>
				<div class="post-content content">
					<p>Hello, I am experiencing the same symptoms and this post is recent enough I am hopping it is the same problem.&nbsp; I did not understand the previous (fyi&#039;s) post about changing the two ports from 5 to 5t, but tried it anyway. I followed the directions at <a href="http://wiki.openwrt.org/doc/recipes/relayclient">http://wiki.openwrt.org/doc/recipes/relayclient</a> and have tried it multiple times with re-flashing in between attempts - same symptoms of the router getting and IP from the AP&#039;s DHCP server, but the wired clients do not receive and IP lease. Also, when I statically assign the address, net mask, gateway, I can not ping the AP. It must me more than not receiving the upstream DHCP broadcasts.</p><p>The hardware is a WRT54G-TM and I am running 10.3.1 brcm47xx. Here are some config files that I modified as per the recipe:</p><br /><p>/etc/config/network<br /></p><div class="codebox"><pre><code>config &#039;switch&#039; &#039;eth0&#039;
        option &#039;enable&#039; &#039;1&#039;

config &#039;switch_vlan&#039; &#039;eth0_0&#039;
        option &#039;device&#039; &#039;eth0&#039;
        option &#039;vlan&#039; &#039;0&#039;
        option &#039;ports&#039; &#039;0 1 2 3 5t&#039;

config &#039;switch_vlan&#039; &#039;eth0_1&#039;
        option &#039;device&#039; &#039;eth0&#039;
        option &#039;vlan&#039; &#039;1&#039;
        option &#039;ports&#039; &#039;4 5t&#039;

config &#039;interface&#039; &#039;loopback&#039;
        option &#039;ifname&#039; &#039;lo&#039;
        option &#039;proto&#039; &#039;static&#039;
        option &#039;ipaddr&#039; &#039;127.0.0.1&#039;
        option &#039;netmask&#039; &#039;255.0.0.0&#039;

config &#039;interface&#039; &#039;lan&#039;
        option &#039;type&#039; &#039;bridge&#039;
        option &#039;ifname&#039; &#039;eth0.0&#039;
        option &#039;proto&#039; &#039;static&#039;
        option &#039;netmask&#039; &#039;255.255.255.0&#039;
        option &#039;ipaddr&#039; &#039;192.168.10.13&#039;

config &#039;interface&#039; &#039;wan&#039;
        option &#039;ifname&#039; &#039;eth0.1&#039;
        option &#039;proto&#039; &#039;dhcp&#039;

        config &#039;interface&#039; &#039;wwan&#039;               
        option &#039;proto&#039; &#039;dhcp&#039;          
                                
config &#039;interface&#039; &#039;stabridge&#039;  
        option &#039;proto&#039; &#039;relay&#039;  
        option &#039;network&#039; &#039;lan wwan&#039;</code></pre></div><p>/etc/config/wireless<br /></p><div class="codebox"><pre><code>config &#039;wifi-device&#039; &#039;radio0&#039;
        option &#039;type&#039; &#039;mac80211&#039;
        option &#039;channel&#039; &#039;11&#039;
        option &#039;macaddr&#039; &#039;00:1c:10:5b:54:ff&#039;
        option &#039;hwmode&#039; &#039;11g&#039;
        option &#039;disabled&#039; &#039;0&#039;

config &#039;wifi-iface&#039;
        option &#039;device&#039; &#039;radio0&#039;
        option &#039;network&#039; &#039;wwan&#039;
        option &#039;mode&#039; &#039;sta&#039;
        option &#039;ssid&#039; &#039;ssidname&#039;
        option &#039;encryption&#039; &#039;none&#039;</code></pre></div><p>/etc/config/dhcp&nbsp; <br /></p><div class="codebox"><pre><code>config dnsmasq
        option domainneeded     1
        option boguspriv        1
        option filterwin2k      0  # enable for dial on demand
        option localise_queries 1
        option rebind_protection 1  # disable if upstream must serve
        option rebind_localhost 1  # enable for RBL checking and simi
        option local    &#039;/lan/&#039;
        option domain   &#039;lan&#039;
        option expandhosts      1
        option nonegcache       0
        option authoritative    1
        option readethers       1
        option leasefile        &#039;/tmp/dhcp.leases&#039;
        option resolvfile       &#039;/tmp/resolv.conf.auto&#039;

config dhcp lan
        option interface        lan
        option start    100
        option limit    150
        option leasetime        12h
        option &#039;ignore&#039; &#039;1&#039;
        
 config dhcp wan
        option interface        wan
        option ignore   1</code></pre></div><p>/etc/config/firewall (minus the commented portions)<br /></p><div class="codebox"><pre><code>config defaults
        option syn_flood        1
        option input            ACCEPT
        option output           ACCEPT
        option forward          REJECT

config zone
        option name             lan
        option network  &#039;lan wwan&#039;
        option input    ACCEPT
        option output   ACCEPT
        option forward  ACCEPT
        option &#039;network&#039; &#039;lan wwan&#039;

config zone
        option name             wan
        option network  &#039;wan&#039;
        option input    REJECT
        option output   ACCEPT
        option forward  REJECT
        option masq             1
        option mtu_fix  1

config forwarding
        option src      lan
        option dest     wan
  
      # We need to accept udp packets on port 68,
# see https://dev.openwrt.org/ticket/4108  
config rule                                
        option src              wan        
        option proto            udp        
        option dest_port        68         
        option target           ACCEPT     
        option family   ipv4               
                                           
#Allow ping                                
config rule                                
        option src wan                     
        option proto icmp                  
        option icmp_type echo-request      
        option target ACCEPT               
                                           
# include a file with users custom iptables rules
config include                                   
        option path /etc/firewall.user</code></pre></div><p>Thank you and regards,</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p148493">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">fyi</div>
					<div class="post-datetime">
						14 Nov 2011, 23:03					</div>
				</div>
				<div class="post-content content">
					<p>Install Backfire 10.03.1-rc5 and above.<br /></p><div class="codebox"><pre><code>config &#039;switch&#039; &#039;eth0&#039;
   option &#039;enable&#039;      &#039;1&#039;
   option &#039;enable_vlan&#039; &#039;1&#039;
   option &#039;reset&#039;       &#039;1&#039;</code></pre></div><p>Run &quot;ifconfig&quot;.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p148627">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">tomdavidson</div>
					<div class="post-datetime">
						15 Nov 2011, 05:40					</div>
				</div>
				<div class="post-content content">
					<p>Hello again fyi, I made the changes to /etc/config/network</p><p>ifconfig:<br /></p><div class="codebox"><pre><code>root@OW-02:~# ifconfig
br-lan    Link encap:Ethernet  HWaddr 00:1C:10:5B:54:FD  
          inet addr:192.168.10.13  Bcast:192.168.10.255  Mask:255.255.255.0
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:84 errors:0 dropped:0 overruns:0 frame:0
          TX packets:56 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:12008 (11.7 KiB)  TX bytes:8421 (8.2 KiB)

eth0      Link encap:Ethernet  HWaddr 00:1C:10:5B:54:FD  
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:85 errors:0 dropped:0 overruns:0 frame:0
          TX packets:80 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:14100 (13.7 KiB)  TX bytes:22264 (21.7 KiB)
          Interrupt:4 

eth0.0    Link encap:Ethernet  HWaddr 00:1C:10:5B:54:FD  
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:84 errors:0 dropped:0 overruns:0 frame:0
          TX packets:56 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:12344 (12.0 KiB)  TX bytes:8645 (8.4 KiB)

eth0.1    Link encap:Ethernet  HWaddr 00:1C:10:5B:54:FD  
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:21 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:0 (0.0 B)  TX bytes:8547 (8.3 KiB)

lo        Link encap:Local Loopback  
          inet addr:127.0.0.1  Mask:255.0.0.0
          UP LOOPBACK RUNNING  MTU:16436  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)

wlan0     Link encap:Ethernet  HWaddr 00:1C:10:5B:54:FF  
          inet addr:192.168.30.105  Bcast:192.168.30.255  Mask:255.255.255.0
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:16 errors:0 dropped:0 overruns:0 frame:0
          TX packets:2 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:5358 (5.2 KiB)  TX bytes:854 (854.0 B)</code></pre></div><p>I am running Backfire 10.03.1-rc5, just realized rc6 was out, but I have not switched.<br />Also, I switched to an AP that is in the same room rather than one that I only at 40% signal just to make sure the weak connection wasnt causing the issue.</p><p>br,tom</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p148645">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">fyi</div>
					<div class="post-datetime">
						15 Nov 2011, 09:59					</div>
				</div>
				<div class="post-content content">
					<p>ifconfig looks good. So? Any problem now?<br /></p><div class="quotebox"><cite>tomdavidson wrote:</cite><blockquote><div class="codebox"><pre><code>config zone
        option name             lan
        option network  &#039;lan wwan&#039;
        option input    ACCEPT
        option output   ACCEPT
        option forward  ACCEPT
        option &#039;network&#039; &#039;lan wwan&#039;</code></pre></div></blockquote></div><p>Duplicate &quot;option network &#039;lan wwan&#039;&quot; but shouldn&#039;t be a problem.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p148648">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						15 Nov 2011, 12:13					</div>
				</div>
				<div class="post-content content">
					<p>It is certainly a uci syntax error.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p148710">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">tomdavidson</div>
					<div class="post-datetime">
						16 Nov 2011, 04:54					</div>
				</div>
				<div class="post-content content">
					<p>@fyi still does not work. I took out the duplicate option network from the zone rule. entered the approperate uci command. rebooted. wired sided cleints do not recieve an IP lease, but the router does get and IP.</p><p>@jow i thought you may be right. esspcially since I didnt copy &amp; paste from the wiki. I after reverifying the symtops still exsist, I reflashed the router (with rc6). This time I used the same computer to ssh to the router that had the wiki page up and copy &amp; pasted the the commands, line by line. (eccept the ssid). I still have the same problems.&nbsp; I added the &#039;switch&#039; &#039;eth0&#039; options suggested by fyi - still a no go.</p><p>a few things to note:<br />the wiki recipe suggest useing iwlist scan, but when i run it on my WRT54G-TM, each interface &quot;doesn&#039;t support scanning&quot;</p><p>also, if I take the wifi down and than start it (wifi down; wifi) I am presented with:<br /></p><div class="quotebox"><blockquote><p>Error for wireless request &quot;Set Power Management&quot; (8B2C) :<br />&nbsp; &nbsp; SET failed on device wlan0 ; Operation not supported.</p></blockquote></div><p>udhcpc stares and the router receives its IP lease</p><br /><p>/etc/config/network<br /></p><div class="codebox"><pre><code>config &#039;switch&#039; &#039;eth0&#039;
        option &#039;enable&#039; &#039;1&#039;
        option &#039;enable_vlan&#039; &#039;1&#039;
        option &#039;reset&#039;  &#039;1&#039;

config &#039;switch_vlan&#039; &#039;eth0_0&#039;
        option &#039;device&#039; &#039;eth0&#039;
        option &#039;vlan&#039; &#039;0&#039;
        option &#039;ports&#039; &#039;0 1 2 3 5&#039;

config &#039;switch_vlan&#039; &#039;eth0_1&#039;
        option &#039;device&#039; &#039;eth0&#039;
        option &#039;vlan&#039; &#039;1&#039;
        option &#039;ports&#039; &#039;4 5&#039;

config &#039;interface&#039; &#039;loopback&#039;
        option &#039;ifname&#039; &#039;lo&#039;
        option &#039;proto&#039; &#039;static&#039;
        option &#039;ipaddr&#039; &#039;127.0.0.1&#039;
        option &#039;netmask&#039; &#039;255.0.0.0&#039;

config &#039;interface&#039; &#039;lan&#039;
        option &#039;type&#039; &#039;bridge&#039;
        option &#039;ifname&#039; &#039;eth0.0&#039;
        option &#039;proto&#039; &#039;static&#039;
        option &#039;netmask&#039; &#039;255.255.255.0&#039;
        option &#039;ipaddr&#039; &#039;192.168.10.13&#039;

config &#039;interface&#039; &#039;wan&#039;
        option &#039;ifname&#039; &#039;eth0.1&#039;
        option &#039;proto&#039; &#039;dhcp&#039;

config &#039;interface&#039; &#039;wwan&#039;
        option &#039;proto&#039; &#039;dhcp&#039;

config &#039;interface&#039; &#039;stabridge&#039;
        option &#039;proto&#039; &#039;relay&#039;
        option &#039;network&#039; &#039;lan wwan&#039;</code></pre></div><p>/etc/config/firewall<br /></p><div class="codebox"><pre><code>cconfig defaults
        option syn_flood        1
        option input            ACCEPT
        option output           ACCEPT
        option forward          REJECT

config zone
        option name             lan
        option network          &#039;lan wwan&#039;
        option input            ACCEPT
        option output           ACCEPT
        option forward          ACCEPT

config zone
        option name             wan
        option network          &#039;wan&#039;
        option input            REJECT
        option output           ACCEPT
        option forward          REJECT
        option masq             1
        option mtu_fix          1

config forwarding
        option src              lan
        option dest             wan

# We need to accept udp packets on port 68,
# see https://dev.openwrt.org/ticket/4108
config rule
        option src              wan
        option proto            udp
        option dest_port        68
        option target           ACCEPT
        option family           ipv4

# Allow IPv4 ping
config rule
        option src              wan
        option proto            icmp
        option icmp_type        echo-request
        option family           ipv4
        option target           ACCEPT

# Allow essential incoming IPv6 ICMP traffic
config rule                                 
        option src              wan         
        option proto    icmp                
        list icmp_type          echo-request
        list icmp_type          destination-unreachable
        list icmp_type          packet-too-big         
        list icmp_type          time-exceeded          
        list icmp_type          bad-header             
        list icmp_type          unknown-header-type    
        list icmp_type          router-solicitation    
        list icmp_type          neighbour-solicitation 
        option limit            1000/sec               
        option family           ipv6                   
        option target           ACCEPT                 
                                                       
# Allow essential forwarded IPv6 ICMP traffic          
config rule                                            
        option src              wan                    
        option dest             *                      
        option proto            icmp                   
        list icmp_type          echo-request           
        list icmp_type          destination-unreachable
        list icmp_type          packet-too-big         
        list icmp_type          time-exceeded          
        list icmp_type          bad-header             
        list icmp_type          unknown-header-type    
        option limit            1000/sec               
        option family           ipv6                   
        option target           ACCEPT                 
                                                       
# include a file with users custom iptables rules      
config include                                         
        option path /etc/firewall.user</code></pre></div><p>/etc/config/dhcp<br /></p><div class="codebox"><pre><code>option family           ipv4        
config dnsmasq
        option domainneeded     1
        option boguspriv        1
        option filterwin2k      0  # enable for dial on demand
        option localise_queries 1
        option rebind_protection 1  # disable if upstream must serve RFC1918 addresses
        option rebind_localhost 1  # enable for RBL checking and similar services
        #list rebind_domain example.lan  # whitelist RFC1918 responses for domains
        option local    &#039;/lan/&#039;
        option domain   &#039;lan&#039;
        option expandhosts      1
        option nonegcache       0
        option authoritative    1
        option readethers       1
        option leasefile        &#039;/tmp/dhcp.leases&#039;
        option resolvfile       &#039;/tmp/resolv.conf.auto&#039;
        #list server            &#039;/mycompany.local/1.2.3.4&#039;
        #option nonwildcard     1
        #list interface         br-lan
        #list notinterface      lo
        #list bogusnxdomain     &#039;64.94.110.11&#039;

config dhcp lan
        option interface        lan
        option start    100
        option limit    150
        option leasetime        12h
        option &#039;ignore&#039;         &#039;1&#039;

config dhcp wan
        option interface        wan
        option ignore   1</code></pre></div><p>/etc/config/wireless<br /></p><div class="codebox"><pre><code>config &#039;wifi-device&#039; &#039;radio0&#039;
        option &#039;type&#039; &#039;mac80211&#039;
        option &#039;channel&#039; &#039;11&#039;
        option &#039;macaddr&#039; &#039;00:1c:10:5b:54:ff&#039;
        option &#039;hwmode&#039; &#039;11g&#039;
        option &#039;disabled&#039; &#039;0&#039;

config &#039;wifi-iface&#039;
        option &#039;device&#039; &#039;radio0&#039;
        option &#039;network&#039; &#039;wwan&#039;
        option &#039;mode&#039; &#039;sta&#039;
        option &#039;ssid&#039; &#039;ssid&#039;
        option &#039;encryption&#039; &#039;none&#039;</code></pre></div><p>#ifconfig<br /></p><div class="quotebox"><blockquote><p>root@OW-02:/etc/config# ifconfig<br />br-lan&nbsp; &nbsp; Link encap:Ethernet&nbsp; HWaddr 00:1C:10:5B:54:FD&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:192.168.10.13&nbsp; Bcast:192.168.10.255&nbsp; Mask:255.255.255.0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:7026 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:385 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:361303 (352.8 KiB)&nbsp; TX bytes:118896 (116.1 KiB)</p><p>eth0&nbsp; &nbsp; &nbsp; Link encap:Ethernet&nbsp; HWaddr 00:1C:10:5B:54:FD&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:7027 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:4922 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:1000 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:516423 (504.3 KiB)&nbsp; TX bytes:1990266 (1.8 MiB)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Interrupt:4 </p><p>eth0.0&nbsp; &nbsp; Link encap:Ethernet&nbsp; HWaddr 00:1C:10:5B:54:FD&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:7027 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:385 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:389987 (380.8 KiB)&nbsp; TX bytes:120436 (117.6 KiB)</p><p>eth0.1&nbsp; &nbsp; Link encap:Ethernet&nbsp; HWaddr 00:1C:10:5B:54:FD&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:0 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:4533 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:0 (0.0 B)&nbsp; TX bytes:1844931 (1.7 MiB)</p><p>lo&nbsp; &nbsp; &nbsp; &nbsp; Link encap:Local Loopback&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:127.0.0.1&nbsp; Mask:255.0.0.0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP LOOPBACK RUNNING&nbsp; MTU:16436&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:38 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:38 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:3844 (3.7 KiB)&nbsp; TX bytes:3844 (3.7 KiB)</p><p>wlan0&nbsp; &nbsp; &nbsp;Link encap:Ethernet&nbsp; HWaddr 00:1C:10:5B:54:FF&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:192.168.2.51&nbsp; Bcast:192.168.2.255&nbsp; Mask:255.255.255.0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:7996 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:2970 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:32 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:482009 (470.7 KiB)&nbsp; TX bytes:247998 (242.1 KiB)</p></blockquote></div><p>Are the options suppose to all be inclosed with &#039;&#039; ? It doesn&#039;t appear consistent....<br />Thanks for your help!</p>											<p class="post-edited">(Last edited by <strong>tomdavidson</strong> on 16 Nov 2011, 06:50)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p148717">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">fyi</div>
					<div class="post-datetime">
						16 Nov 2011, 05:57					</div>
				</div>
				<div class="post-content content">
					<p><a href="http://translate.google.com/translate?sl=auto&amp;tl=en&amp;u=http://rpc.one.pl/index.php/lista-artykulow/34-openwrt/81-konfiguracja-switch-vlan-na-podstawie-swconfig-w-routerze-wr1043nd-pod-openwrt">Switch configuration and VLAN based on the router WR1043ND swconfig under OpenWrt</a> - by rpc</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p148719">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">tomdavidson</div>
					<div class="post-datetime">
						16 Nov 2011, 07:00					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for the great reference. Still working on understanding it all. I updated&nbsp; the two vlans to with port 5 being tagged:<br /></p><div class="codebox"><pre><code>config &#039;switch_vlan&#039; &#039;eth0_0&#039;
        option &#039;device&#039; &#039;eth0&#039;
        option &#039;vlan&#039; &#039;0&#039;
        option &#039;ports&#039; &#039;0 1 2 3 5t&#039;

config &#039;switch_vlan&#039; &#039;eth0_1&#039;
        option &#039;device&#039; &#039;eth0&#039;
        option &#039;vlan&#039; &#039;1&#039;
        option &#039;ports&#039; &#039;4 5t&#039;</code></pre></div><p>I do not understand what this does - port 5 is a virtual port so the CPU and all traffic comming in on port 5 will be tagged vlan 1 and vlan 0?<br />After making the above changes, I ran uci commit network and then rebooted. I still have the same problem.</p><p>Thanks for the quick reponse fyi.<br />br, tom</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p148725">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">fyi</div>
					<div class="post-datetime">
						16 Nov 2011, 09:49					</div>
				</div>
				<div class="post-content content">
					<p>Install Backfire 10.03.1-rc5.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p148726">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">fyi</div>
					<div class="post-datetime">
						16 Nov 2011, 09:55					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>tomdavidson wrote:</cite><blockquote><p>I do not understand what this does - port 5 is a virtual port so the CPU and all traffic comming in on port 5 will be tagged vlan 1 and vlan 0?</p></blockquote></div><p><a href="https://forum.openwrt.org/viewtopic.php?pid=126830#p126830">OpenWrt / Dir-825 lan config problem, cant access network from lan computets</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p148774">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">tomdavidson</div>
					<div class="post-datetime">
						16 Nov 2011, 21:12					</div>
				</div>
				<div class="post-content content">
					<p>Re-flashed back to rc5. Followed the recipe to the t as well as tagged port 5 and enabled vlan as previously directed in this thread.&nbsp; Problem still exists.</p><p>Tried changed lan interface to eth0.1 rather than eth0.0. uci commit network... still no wired client connectivity. rebooted and now I cant access the router.</p><p>lost.</p><p>thanks for helping.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p148785">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						16 Nov 2011, 23:05					</div>
				</div>
				<div class="post-content content">
					<p>Hm, I know this isn&#039;t going to help you much but I just tried relayd again to ensure nothing got broken and it works as expected here, DHCP is forwarded, pings work and the bridge is also automatically established on boot, no manual tweaking needed. At this point I suspect some issues with the wifi connection itself, do you see DMA errors in dmesg?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p148805">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">tomdavidson</div>
					<div class="post-datetime">
						17 Nov 2011, 06:22					</div>
				</div>
				<div class="post-content content">
					<p>Ha ha. I am aware that there are not many posts in the forum over relayd bridge issues. I am being very careful not to mis type or overlook any details...</p><p>Thank you for making sure it works. On your verification, did you follow the wiki? did you make the two changes above from fyi (5-&gt;5t &amp; eth0 switch)? What about changing the lan interface to use eth0.1 rather than eth0.0? </p><p>That was enough for me to try a different box (another wrt54g-tm with fresh flash), especially since I couldn&#039;t access it any more. </p><p>The problem still exists on the new box. I verified the symptoms after following the wiki, then after tagging port 5, again after the eth0 switch changes. I did not try changing lan from eth0.0 to eth0.1 because I have twice lost connectivity before and because brctl does not report a bridge (something else wrong?). I am use an AP that is in my office (strong signal) and that is known to work fine. Here is an ifconfig and a uci show of network, firewall, and wireless: <a href="http://ideone.com/EiUAO">http://ideone.com/EiUAO</a></p><p>brctl does not show any bridges, but network defines at least lan as of type bridge??</p><p>I do not notice any errors from dmesg (paste: <a href="http://ideone.com/l58kA">http://ideone.com/l58kA</a> ) and whats better is that when i run iwlist scan, wlan0 actually scans. The previous box did not scan from iwlist, but it would from the luci interface.</p><p>Thank you again jow and fyi.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p148814">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">fyi</div>
					<div class="post-datetime">
						17 Nov 2011, 09:37					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>tomdavidson wrote:</cite><blockquote><p>Tried changed lan interface to eth0.1 rather than eth0.0. uci commit network... still no wired client connectivity. rebooted and now I cant access the router.</p></blockquote></div><p><a href="http://wiki.openwrt.org/doc/howto/generic.failsafe">Generic Failsafe - OpenWrt Wiki</a><br /><a href="https://forum.openwrt.org/viewtopic.php?id=27520">OpenWrt / Can&#039;t ping router</a><br /><a href="https://forum.openwrt.org/viewtopic.php?id=32437">OpenWrt / disabled switch, access problems</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p148815">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">fyi</div>
					<div class="post-datetime">
						17 Nov 2011, 10:05					</div>
				</div>
				<div class="post-content content">
					<p>Try brcm-2.4 of rc5 and rc6.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p148821">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						17 Nov 2011, 11:46					</div>
				</div>
				<div class="post-content content">
					<p>Well first of all you don&#039;t have to change any switch settings, second you should see a br-lan bridge at least, third it is expected that the client wlan0 will *not* be part of br-lan. Yes I did follow the wiki.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p149134">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">tomdavidson</div>
					<div class="post-datetime">
						21 Nov 2011, 05:25					</div>
				</div>
				<div class="post-content content">
					<p>Hi again, I finally had time to revisit this.</p><p>@jow with the other suggestions I just wanted to make sure I was doing the right stuff - I hope my question of wither you followed the wiki page did not come a crossed wrong.</p><p>I flashed with brcm-2.5, followed the wiki. Still no DHCP leases. Nothing on brctl either... not even br-lan. The webgui shows br-lan and stabridge, but its status is &quot;unsupported protocol type&quot;. </p><p>Im pretty baffled. All of my devices are WRT54g-TMs - is there a possibility of hardware incompatibly with relayd? The recipe has the config files edited followed by identical uci entries - is this duplicative?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p149136">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						21 Nov 2011, 05:50					</div>
				</div>
				<div class="post-content content">
					<p>There might be an incompatibility, yes - either on the wifi layer, or something is not forwarding broadcasts correctly, or a firewall interferes (did you try to complete stop the firewall yet?)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p149137">
				<div class="post-metadata">
					<div class="post-num">Post #21</div>
					<div class="post-author">tomdavidson</div>
					<div class="post-datetime">
						21 Nov 2011, 06:19					</div>
				</div>
				<div class="post-content content">
					<div class="codebox"><pre><code>/etc/init.d/firewall stop
/etc/init.d/firewall disable
reboot</code></pre></div><p>Stopping the firewall doesn&#039;t make a difference.&nbsp; So it must not be firewall interference.<br />I can ping the upstream AP from the router, but not from a downstream client (with address &amp; gateway manually assigned).&nbsp; Does this rule out a problem with the forwarding broadcasts - not relying on the DHCP lease? <br />How do I verify the wifi layer functionality?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p149154">
				<div class="post-metadata">
					<div class="post-num">Post #22</div>
					<div class="post-author">tomdavidson</div>
					<div class="post-datetime">
						21 Nov 2011, 09:17					</div>
				</div>
				<div class="post-content content">
					<p>opkg list-install | grep relayd did not return any results. I installed relayd and magic.... it works! But, I trying to replicate on another box - I can confim relayd is not installed, but on this 2nd bo,x installing relayd does not fix all the problems.</p><p>rc5+ comes with relayd functionality - is it suppose to have the package &#039;relayd&#039; installed by default?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p149948">
				<div class="post-metadata">
					<div class="post-num">Post #23</div>
					<div class="post-author">espressionist</div>
					<div class="post-datetime">
						30 Nov 2011, 15:23					</div>
				</div>
				<div class="post-content content">
					<p>how did you get to install relayd? <br />opkg list-install | grep relayd shows no results so does opkg list | grep relayd</p><p>i switched to trunk but i get </p><div class="codebox"><pre><code>root@OpenWrt:/etc# opkg list |grep relayd
Package relayd version 2011-10-24-4e8f1fa4ca2b176500362843a9e57ea5abd4b7a3 has no valid architecture, ignoring.</code></pre></div><p>i flashed my wrt54gl using imagebuilder from 10.03.1-RC6, target brcm-2.4</p><p>EDIT: plz ignore this post... im sleepless for 2-3 night now, and i completely forgot that i compiled it using kernel 2.4 cause of the sd-card mod... :$</p>											<p class="post-edited">(Last edited by <strong>espressionist</strong> on 30 Nov 2011, 15:50)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p155065">
				<div class="post-metadata">
					<div class="post-num">Post #24</div>
					<div class="post-author">tomdavidson</div>
					<div class="post-datetime">
						23 Jan 2012, 03:43					</div>
				</div>
				<div class="post-content content">
					<p>Thanks Jow and Fyi. I appreciate your help and wanted to update the thread. I got a hold of a new WRT54G-TM, followed the instructions from the wiki page (just as before) and it works perfectly. I didn&#039;t edit the config files - only made changes via uci. I&#039;m chalking my previous troubles to defective hardware.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>