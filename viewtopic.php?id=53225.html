<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Ralink 5350 Board WiFi Wan issue</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 24 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p249810">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">vsidou</div>
					<div class="post-datetime">
						9 Oct 2014, 08:32					</div>
				</div>
				<div class="post-content content">
					<p>Hi evyerone,</p><p>i got myself a little mpr a1 clone board (with embedded power supply on it) photo below :</p><p><span class="postimg"><img src="http://pyxise.com/images/3g3.jpg" alt="3G Router Ralink" /></span></p><br /><p>I managed to flash it with MPRA1 build from latest trunk.<br />Here is the boot log : </p><div class="codebox"><pre><code>U-Boot 1.1.3 (Aug 11 2011 - 14:34:31)

Board: Ralink APSoC DRAM:  32 MB
relocate_code Pointer at: 81fb4000
******************************
Software System Reset Occurred
******************************
spi_wait_nsec: 42
spi device id: c8 40 16 c8 40 (4016c840)
Warning: un-recognized chip ID, please update bootloader!
raspi_read: from:30000 len:1000
.*** Warning - bad CRC, using default environment

============================================
Ralink UBoot Version: 3.5.2.0
--------------------------------------------
ASIC 5350_MP (Port5&lt;-&gt;None)
DRAM_CONF_FROM: Boot-Strapping
DRAM_TYPE: SDRAM
DRAM_SIZE: 256 Mbits
DRAM_WIDTH: 16 bits
DRAM_TOTAL_WIDTH: 16 bits
TOTAL_MEMORY_SIZE: 32 MBytes
Flash component: SPI Flash
Date:Aug 11 2011  Time:14:34:31
============================================
icache: sets:256, ways:4, linesz:32 ,total:32768
dcache: sets:128, ways:4, linesz:32 ,total:16384

 ##### The CPU freq = 360 MHZ ####
 estimate memory size =32 Mbytes

Please choose the operation:
   1: Load system code to SDRAM via TFTP.
   2: Load system code then write to Flash via TFTP.
   3: Boot system code via Flash (default).
   4: Entr boot command line interface.
   7: Load Boot Loader code then write to Flash via Serial.
   9: Load Boot Loader code then write to Flash via TFTP.                                                                  0

3: System Boot system code via Flash.
## Booting image at bc050000 ...
raspi_read: from:50000 len:40
.   Image Name:   MIPS OpenWrt Linux-3.14.18
   Created:      2014-10-08  14:06:59 UTC
   Image Type:   MIPS Linux Kernel Image (lzma compressed)
   Data Size:    1049941 Bytes =  1 MB
   Load Address: 80000000
   Entry Point:  80000000
raspi_read: from:50040 len:100555
.................   Verifying Checksum ... OK
   Uncompressing Kernel Image ... OK
No initrd
## Transferring control to Linux (at address 80000000) ...
## Giving linux memsize in MB, 32

Starting kernel ...

[    0.000000] Linux version 3.14.18 (vsidou@vsidou-Dell-System-XPS-L322X) (gcc version 4.8.3 (OpenWrt/Linaro GCC 4.8-2014.04 r42840) ) #4 Wed Oct 8 18:06:46 RET 2014
[    0.000000] SoC Type: Ralink RT5350 id:1 rev:3
[    0.000000] bootconsole [early0] enabled
[    0.000000] CPU0 revision is: 0001964c (MIPS 24KEc)
[    0.000000] MIPS: machine is Poray M3
[    0.000000] Determined physical RAM map:
[    0.000000]  memory: 02000000 @ 00000000 (usable)
[    0.000000] Initrd not found or empty - disabling initrd
[    0.000000] Zone ranges:
[    0.000000]   Normal   [mem 0x00000000-0x01ffffff]
[    0.000000] Movable zone start for each node
[    0.000000] Early memory node ranges
[    0.000000]   node   0: [mem 0x00000000-0x01ffffff]
[    0.000000] Primary instruction cache 32kB, VIPT, 4-way, linesize 32 bytes.
[    0.000000] Primary data cache 16kB, 4-way, VIPT, no aliases, linesize 32 bytes
[    0.000000] Built 1 zonelists in Zone order, mobility grouping on.  Total pages: 8128
[    0.000000] Kernel command line: console=ttyS0,57600 rootfstype=squashfs,jffs2
[    0.000000] PID hash table entries: 128 (order: -3, 512 bytes)
[    0.000000] Dentry cache hash table entries: 4096 (order: 2, 16384 bytes)
[    0.000000] Inode-cache hash table entries: 2048 (order: 1, 8192 bytes)
[    0.000000] Writing ErrCtl register=00055c80
[    0.000000] Readback ErrCtl register=00055c80
[    0.000000] Memory: 29216K/32768K available (2284K kernel code, 119K rwdata, 456K rodata, 140K init, 180K bss, 3552K reserved)
[    0.000000] SLUB: HWalign=32, Order=0-3, MinObjects=0, CPUs=1, Nodes=1
[    0.000000] NR_IRQS:256
[    0.000000] CPU Clock: 360MHz
[    0.000000] systick: running - mult: 214748, shift: 32
[    0.000000] genirq: Flags mismatch irq 7. 00014600 (timer) vs. 00014600 (systick)
[    0.010000] Calibrating delay loop... 479.23 BogoMIPS (lpj=2396160)
[    0.070000] pid_max: default: 32768 minimum: 301
[    0.070000] Mount-cache hash table entries: 1024 (order: 0, 4096 bytes)
[    0.080000] Mountpoint-cache hash table entries: 1024 (order: 0, 4096 bytes)
[    0.090000] pinctrl core: initialized pinctrl subsystem
[    0.090000] NET: Registered protocol family 16
[    0.120000] bio: create slab &lt;bio-0&gt; at 0
[    0.120000] rt2880_gpio 10000600.gpio: registering 22 gpios
[    0.130000] rt2880_gpio 10000600.gpio: registering 22 irq handlers
[    0.140000] Switched to clocksource systick
[    0.140000] NET: Registered protocol family 2
[    0.160000] TCP established hash table entries: 1024 (order: 0, 4096 bytes)
[    0.180000] TCP bind hash table entries: 1024 (order: 0, 4096 bytes)
[    0.180000] TCP: Hash tables configured (established 1024 bind 1024)
[    0.200000] TCP: reno registered
[    0.210000] UDP hash table entries: 256 (order: 0, 4096 bytes)
[    0.210000] UDP-Lite hash table entries: 256 (order: 0, 4096 bytes)
[    0.230000] NET: Registered protocol family 1
[    0.240000] rt-timer 10000100.timer: maximum frequency is 7324Hz
[    0.260000] futex hash table entries: 256 (order: -1, 3072 bytes)
[    0.320000] squashfs: version 4.0 (2009/01/31) Phillip Lougher
[    0.320000] jffs2: version 2.2 (NAND) (SUMMARY) (LZMA) (RTIME) (CMODE_PRIORITY) (c) 2001-2006 Red Hat, Inc.
[    0.350000] msgmni has been set to 57
[    0.350000] io scheduler noop registered
[    0.370000] io scheduler deadline registered (default)
[    0.380000] Serial: 8250/16550 driver, 2 ports, IRQ sharing disabled
[    0.400000] 10000c00.uartlite: ttyS0 at MMIO 0x10000c00 (irq = 20, base_baud = 2500000) is a 16550A
[    0.420000] console [ttyS0] enabled
[    0.420000] console [ttyS0] enabled
[    0.420000] bootconsole [early0] disabled
[    0.420000] bootconsole [early0] disabled
[    0.450000] m25p80 spi32766.0: found gd25q32, expected w25q32
[    0.470000] m25p80 spi32766.0: gd25q32 (4096 Kbytes)
[    0.480000] 4 ofpart partitions found on MTD device spi32766.0
[    0.490000] Creating 4 MTD partitions on &quot;spi32766.0&quot;:
[    0.500000] 0x000000000000-0x000000030000 : &quot;u-boot&quot;
[    0.510000] 0x000000030000-0x000000040000 : &quot;u-boot-env&quot;
[    0.530000] 0x000000040000-0x000000050000 : &quot;factory&quot;
[    0.540000] 0x000000050000-0x000000400000 : &quot;firmware&quot;
[    0.560000] 0x000000150595-0x000000400000 : &quot;rootfs&quot;
[    0.560000] mtd: partition &quot;rootfs&quot; must either start or end on erase block boundary or be smaller than an erase block -- forcing read-only
[    0.600000] mtd: device 4 (rootfs) set to be root filesystem
[    0.600000] 1 squashfs-split partitions found on MTD device rootfs
[    0.620000] 0x000000360000-0x000000400000 : &quot;rootfs_data&quot;
[    0.640000] eth0: done loading
[    0.660000] rt3xxx-usbphy usbphy.3: loaded
[    0.660000] rt2880_wdt 10000120.watchdog: Initialized
[    0.680000] TCP: cubic registered
[    0.680000] NET: Registered protocol family 17
[    0.700000] 8021q: 802.1Q VLAN Support v1.8
[    0.720000] VFS: Mounted root (squashfs filesystem) readonly on device 31:4.
[    0.740000] Freeing unused kernel memory: 140K (802cd000 - 802f0000)
procd: Console is alive
procd: - watchdog -
[    6.460000] usbcore: registered new interface driver usbfs
[    6.480000] usbcore: registered new interface driver hub
[    6.480000] usbcore: registered new device driver usb
[    6.500000] ehci_hcd: USB 2.0 &#039;Enhanced&#039; Host Controller (EHCI) Driver
[    6.520000] ehci-platform: EHCI generic platform driver
[    6.930000] rt3xxx-usbphy usbphy.3: remote usb device wakeup disabled
[    6.950000] rt3xxx-usbphy usbphy.3: UTMI 16bit 30MHz
[    6.950000] ehci-platform 101c0000.ehci: EHCI Host Controller
[    6.970000] ehci-platform 101c0000.ehci: new USB bus registered, assigned bus number 1
[    6.990000] ehci-platform 101c0000.ehci: irq 26, io mem 0x101c0000
[    7.010000] ehci-platform 101c0000.ehci: USB 2.0 started, EHCI 1.00
[    7.010000] hub 1-0:1.0: USB hub found
[    7.030000] hub 1-0:1.0: 1 port detected
[    7.040000] ohci_hcd: USB 1.1 &#039;Open&#039; Host Controller (OHCI) Driver
[    7.060000] ohci-platform: OHCI generic platform driver
[    7.060000] ohci-platform 101c1000.ohci: Generic Platform OHCI controller
[    7.080000] ohci-platform 101c1000.ohci: new USB bus registered, assigned bus number 2
[    7.100000] ohci-platform 101c1000.ohci: irq 26, io mem 0x101c1000
[    7.160000] hub 2-0:1.0: USB hub found
[    7.180000] hub 2-0:1.0: 1 port detected
procd: - preinit -
[    7.970000] rt305x-esw 10110000.esw: link changed 0x00
[    8.270000] random: mktemp urandom read with 71 bits of entropy available
Press the [f] key and hit [enter] to enter failsafe mode
Press the [1], [2], [3] or [4] key and hit [enter] to select the debug level
jffs2 is ready
jffs2 is ready
[   12.040000] jffs2: notice: (293) jffs2_build_xattr_subsystem: complete building xattr subsystem, 1 of xdatum (0 unchecked, 0 orphan) and 7 of xref (0 dead, 2 orphan) found.
switching to overlay
procd: - early -
procd: - watchdog -
procd: - ubus -
procd: - init -
Please press Enter to activate this console.
[   16.090000] NET: Registered protocol family 10
[   16.100000] tun: Universal TUN/TAP device driver, 1.6
[   16.120000] tun: (C) 1999-2004 Max Krasnyansky &lt;maxk@qualcomm.com&gt;
[   16.140000] ip6_tables: (C) 2000-2006 Netfilter Core Team
[   16.160000] Loading modules backported from Linux version master-2014-09-26-0-g25e3efa
[   16.180000] Backport generated by backports.git backports-20140905-1-gde42785
[   16.200000] ip_tables: (C) 2000-2006 Netfilter Core Team
[   16.240000] nf_conntrack version 0.5.0 (458 buckets, 1832 max)
[   16.310000] xt_time: kernel timezone is -0000
[   16.410000] cfg80211: Calling CRDA to update world regulatory domain
[   16.440000] cfg80211: World regulatory domain updated:
[   16.450000] cfg80211:  DFS Master region: unset
[   16.460000] cfg80211:   (start_freq - end_freq @ bandwidth), (max_antenna_gain, max_eirp), (dfs_cac_time)
[   16.480000] cfg80211:   (2402000 KHz - 2472000 KHz @ 40000 KHz), (N/A, 2000 mBm), (N/A)
[   16.500000] cfg80211:   (2457000 KHz - 2482000 KHz @ 40000 KHz), (N/A, 2000 mBm), (N/A)
[   16.520000] cfg80211:   (2474000 KHz - 2494000 KHz @ 20000 KHz), (N/A, 2000 mBm), (N/A)
[   16.520000] cfg80211:   (5170000 KHz - 5250000 KHz @ 160000 KHz), (N/A, 2000 mBm), (N/A)
[   16.550000] cfg80211:   (5250000 KHz - 5330000 KHz @ 160000 KHz), (N/A, 2000 mBm), (0 s)
[   16.560000] cfg80211:   (5490000 KHz - 5730000 KHz @ 160000 KHz), (N/A, 2000 mBm), (0 s)
[   16.560000] cfg80211:   (5735000 KHz - 5835000 KHz @ 80000 KHz), (N/A, 2000 mBm), (N/A)
[   16.560000] cfg80211:   (57240000 KHz - 63720000 KHz @ 2160000 KHz), (N/A, 0 mBm), (N/A)
[   16.560000] PPP generic driver version 2.4.2
[   16.560000] NET: Registered protocol family 24
[   16.560000] ieee80211 phy0: rt2x00_set_rt: Info - RT chipset 5350, rev 0500 detected
[   16.560000] ieee80211 phy0: rt2x00_set_rf: Info - RF chipset 5350 detected
[   24.420000] random: nonblocking pool is initialized
procd: - init complete -
[   27.520000] device eth0.1 entered promiscuous mode
[   27.520000] device eth0 entered promiscuous mode
[   27.540000] br-lan: port 1(eth0.1) entered forwarding state
[   27.560000] br-lan: port 1(eth0.1) entered forwarding state
[   29.570000] br-lan: port 1(eth0.1) entered forwarding state
[   30.720000] IPv6: ADDRCONF(NETDEV_UP): wlan0: link is not ready
[   30.740000] device wlan0 entered promiscuous mode
[   30.770000] br-lan: port 2(wlan0) entered forwarding state
[   30.790000] br-lan: port 2(wlan0) entered forwarding state
[   30.790000] IPv6: ADDRCONF(NETDEV_CHANGE): wlan0: link becomes ready
[   32.790000] br-lan: port 2(wlan0) entered forwarding state</code></pre></div><p>So far if no ethernet cable is connected on Wan and i activate wifi , well wifi is working. I can connect and get ip address.<br />If i disable WiFi and connect Wan ethernet cable (using DHCP) the router get an ip adress and i can connect on the &quot;outside&quot;.</p><p>Now if Wan is connected and i activate wifi , Wan is not working anymore. <br />And i get the following log : <br /></p><div class="codebox"><pre><code>[ 3196.280000] rt305x-esw 10110000.esw: link changed 0x00
[ 3196.350000] IPv6: ADDRCONF(NETDEV_UP): wlan0: link is not ready
[ 3196.370000] device wlan0 entered promiscuous mode
[ 3196.410000] br-lan: port 2(wlan0) entered forwarding state
[ 3196.410000] br-lan: port 2(wlan0) entered forwarding state
[ 3196.430000] IPv6: ADDRCONF(NETDEV_CHANGE): wlan0: link becomes ready
[ 3197.980000] rt305x-esw 10110000.esw: link changed 0x10
[ 3198.410000] br-lan: port 2(wlan0) entered forwarding state
[ 3199.740000] rt305x-esw 10110000.esw: link changed 0x10
[ 3201.490000] rt305x-esw 10110000.esw: link changed 0x10
[ 3203.410000] rt305x-esw 10110000.esw: link changed 0x10
[ 3205.080000] rt305x-esw 10110000.esw: link changed 0x10
[ 3206.740000] device wlan0 left promiscuous mode
[ 3206.740000] br-lan: port 2(wlan0) entered disabled state
[ 3206.800000] rt305x-esw 10110000.esw: link changed 0x10
[ 3207.440000] IPv6: ADDRCONF(NETDEV_UP): wlan0: link is not ready
[ 3207.440000] device wlan0 entered promiscuous mode
[ 3207.460000] br-lan: port 2(wlan0) entered forwarding state
[ 3207.470000] br-lan: port 2(wlan0) entered forwarding state
[ 3207.530000] IPv6: ADDRCONF(NETDEV_CHANGE): wlan0: link becomes ready
[ 3208.600000] rt305x-esw 10110000.esw: link changed 0x10
[ 3209.470000] br-lan: port 2(wlan0) entered forwarding state
[ 3210.280000] rt305x-esw 10110000.esw: link changed 0x10
[ 3212.250000] rt305x-esw 10110000.esw: link changed 0x10
[ 3214.130000] rt305x-esw 10110000.esw: link changed 0x10
[ 3215.560000] rt305x-esw 10110000.esw: link changed 0x10
[ 3217.600000] rt305x-esw 10110000.esw: link changed 0x10
[ 3219.200000] rt305x-esw 10110000.esw: link changed 0x10
[ 3221.650000] rt305x-esw 10110000.esw: link changed 0x10
[ 3223.340000] rt305x-esw 10110000.esw: link changed 0x10
[ 3224.730000] rt305x-esw 10110000.esw: link changed 0x10
[ 3227.360000] rt305x-esw 10110000.esw: link changed 0x10
[ 3229.980000] rt305x-esw 10110000.esw: link changed 0x10
[ 3232.960000] rt305x-esw 10110000.esw: link changed 0x10
[ 3234.690000] rt305x-esw 10110000.esw: link changed 0x10
[ 3236.320000] rt305x-esw 10110000.esw: link changed 0x10
[ 3237.840000] rt305x-esw 10110000.esw: link changed 0x10
[ 3239.730000] rt305x-esw 10110000.esw: link changed 0x10
[ 3241.450000] rt305x-esw 10110000.esw: link changed 0x10
[ 3243.080000] rt305x-esw 10110000.esw: link changed 0x10
[ 3244.930000] rt305x-esw 10110000.esw: link changed 0x10
[ 3246.650000] rt305x-esw 10110000.esw: link changed 0x10
[ 3249.100000] rt305x-esw 10110000.esw: link changed 0x10
[ 3250.740000] rt305x-esw 10110000.esw: link changed 0x10</code></pre></div><p>The following line appears in loop in the TTY console.<br /></p><div class="codebox"><pre><code>[ 3250.740000] rt305x-esw 10110000.esw: link changed 0x10</code></pre></div><p>The only way out is disable wifi and reboot using the TTY console.<br />Also if wan is disconnected, and wifi is activated (which is working fine), when i plug ethernet cable on wan the loop starts again and wan is not accessible nor wifi.</p><p>So far i checked the source code for the ralink5350 but it doesn&#039;t seem the issue is coming from there.<br />Must be a setting somewhere i hope someone could help me out on this.</p><p>Thanks a lot !</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p249852">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">hackru</div>
					<div class="post-datetime">
						9 Oct 2014, 15:52					</div>
				</div>
				<div class="post-content content">
					<p>Can you provide photos of outside look, e.g. case?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p249893">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">vsidou</div>
					<div class="post-datetime">
						9 Oct 2014, 21:55					</div>
				</div>
				<div class="post-content content">
					<p>It&#039;s this one :</p><p><a href="http://m.aliexpress.com/item/1986857131.html">http://m.aliexpress.com/item/1986857131.html</a></p><p>Any clue on the issue ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p250152">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">123serge123</div>
					<div class="post-datetime">
						11 Oct 2014, 20:07					</div>
				</div>
				<div class="post-content content">
					<p>You can try <a href="https://yadi.sk/d/MAaHhKppbwTjA">this image</a> or use dts-file for your own build. See <a href="http://upvel.ru/items/ur-312n4g.html">UR-312N4G</a>.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p250205">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">vsidou</div>
					<div class="post-datetime">
						12 Oct 2014, 13:07					</div>
				</div>
				<div class="post-content content">
					<p>Hi</p><p>Thanks i&#039;ll try and let you know.<br />Strangely i tried with another brand new one with HAME A1 firmware and it worked.</p><p>I&#039;ll build my own with the provided DTS and let you know thanks !</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p256668">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">d.wonderful</div>
					<div class="post-datetime">
						5 Dec 2014, 18:27					</div>
				</div>
				<div class="post-content content">
					<p>Looks like this:<br /><a href="http://www.amazon.com/dp/B00IMYMG12?psc=1">http://www.amazon.com/dp/B00IMYMG12?psc=1</a></p><p>Is a very similar design but with a US plug (110v),&nbsp; I am going to order one and crack it open and see whats inside.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p268128">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">rainkinz</div>
					<div class="post-datetime">
						9 Mar 2015, 03:52					</div>
				</div>
				<div class="post-content content">
					<p>I have exactly the same issue as the OP described with an Asus TR-n13u b1. Did you ever find out what the issue was?</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>