<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Remote logging not working after router reboot</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 30 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p120364">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">penkert</div>
					<div class="post-datetime">
						4 Nov 2010, 16:54					</div>
				</div>
				<div class="post-content content">
					<p>Edit: Please jump directly to the second paragraph my <a href="https://forum.openwrt.org/viewtopic.php?id=27203#p120543">post #8</a>. Earlier posts are irrelevant because I misinterpreted symptoms and came to a wrong conclusion.<br />________________</p><p>I have syslog-ng running on a local server (Synology DS209+) with static IP (no DHCP) and I have a Kamikaze router (Linksys WRT54GL v1.1) setup to send log messages to that server. This is working fine as long as the server is booted up after the Kamikaze box is already up and running. However, if I reboot the Kamikaze box while leaving the server running, remote logging doesn&#039;t pick up again afterwards. Also, restarting the syslog-ng daemon on the server doesn&#039;t help either. Only a complete reboot of the server seems to do the trick.</p><p>Do you have any idea what could be causing this malfunction? I&#039;ll be happy to provide more information if needed, but since I have no clue whatsoever what might be going wrong I also don&#039;t know what you might need. Thanks!</p>											<p class="post-edited">(Last edited by <strong>penkert</strong> on 12 Nov 2010, 17:27)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p120376">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">fyi</div>
					<div class="post-datetime">
						4 Nov 2010, 18:56					</div>
				</div>
				<div class="post-content content">
					<p>What&#039;s the ip address of Kamikaze router?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p120378">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">penkert</div>
					<div class="post-datetime">
						4 Nov 2010, 19:21					</div>
				</div>
				<div class="post-content content">
					<p>Kamikaze Router: 192.168.188.1<br />syslog-ng server: 192.168.188.11</p><p>communication on UDP port 5514 (though I wish it were TCP, but that&#039;s a different story)</p><p>Thanks for your help! <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p120403">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">fyi</div>
					<div class="post-datetime">
						4 Nov 2010, 23:30					</div>
				</div>
				<div class="post-content content">
					<p>[s]OpenWrt reboot will[/s] Bootloader might broadcast itself as 192.168.1.1 thus messes up the arp cache. [s]Change ip address space to 192.168.1.0/24[/s] Check the arp cache of Synology to see if that&#039;s the case.</p>											<p class="post-edited">(Last edited by <strong>fyi</strong> on 4 Nov 2010, 23:57)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p120409">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">penkert</div>
					<div class="post-datetime">
						5 Nov 2010, 00:57					</div>
				</div>
				<div class="post-content content">
					<p>Well, using the 192.168.1.0/24 subnet is working fine, but unfortunately I can&#039;t use it for good since it&#039;s already in use in another part of the network.</p><p>I was just about to ask you (after an unsuccessful forum search) where I can change OpenWRT&#039;s boot broadcast settings when I saw your changes. I guess there&#039;s nothing I can do if that 192.168.1.1 broadcast is hardcoded into the bootloader, hmmm...</p><p>I&#039;ll switch back to 192.168.188.0/24 to check the arp cache and get back here with results. Thanks again!</p>											<p class="post-edited">(Last edited by <strong>penkert</strong> on 5 Nov 2010, 00:57)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p120412">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">penkert</div>
					<div class="post-datetime">
						5 Nov 2010, 01:51					</div>
				</div>
				<div class="post-content content">
					<p>Hmmm, there is no <em>arp</em> command on the Synology NAS and no <em>neighbour</em> object for the <em>ip</em> command either. So, I&#039;m a little at a loss how to determine the contents of the arp table.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p120462">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">fyi</div>
					<div class="post-datetime">
						5 Nov 2010, 14:56					</div>
				</div>
				<div class="post-content content">
					<p>[s]I knew that RedBoot will broadcast itself as 192.168.1.1 but in your case the bootloader is CFE.[/s] It seems that the only broadcast packet is sent by OpenWrt for indicating FailSafe mode. Run Wireshark from your laptop to verify it.</p><p>There&#039;s another way to verify this situation. Disconnect ethernet from DS209+ before WRT54GL reboots and connect DS209+ after WRT54GL wlan led lights up.</p><p>No arp? I was just thinking that why not downloading arp from the internet. After knowing Synology DS209+ has a Freescale MPC8543 CPU, maybe it&#039;s not that easy.</p><p><a href="http://wiki.openwrt.org/oldwiki/openwrtdocs/troubleshooting#all.models.rc5">Troubleshooting - OpenWrt Wiki - All Models (RC5+)</a></p><p>Edit:<br />I just found that the FailSafe packet won&#039;t affect OpenWrt routers and Windows so the problem should be something else. Run Wireshark from your laptop to find it out.</p>											<p class="post-edited">(Last edited by <strong>fyi</strong> on 7 Nov 2010, 00:16)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p120543">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">penkert</div>
					<div class="post-datetime">
						7 Nov 2010, 02:53					</div>
				</div>
				<div class="post-content content">
					<p>Sorry for the delay. Meanwhile I discovered my answer about subnet 192.168.1.0/24 was premature. It seemed to be working fine at first, but after more and more testing I found it wasn&#039;t. Moreover, the problem seems to be something else entirely, even more mysterious I might add----at least to me. Sorry, I didn&#039;t catch this before!</p><p>Apparently, there is an inconsistence in the way syslog is logging messages on Kamikaze (I&#039;m running v8.09.2, kernel 2.4, X-WRT built in from their FTP server). By examining Kamikaze&#039;s own local logs I noticed there are two ways of logging the same kind of message. One gets sent out over the network, the other does not.</p><p>Version 1 (working fine):<br /><span style="color: blue">Nov&nbsp; 7 01:00:59 kernel: ...</span></p><p>Version 2 (not sent to remote server):<br /><span style="color: blue">Nov&nbsp; 7 01:02:20 HRC-Gateway user.info kernel: ...</span><br />where &quot;HRC-Gateway&quot; is the router&#039;s host name.</p><p>So far, I was not able to determine any kind of scheme behind the occurrences of version 1 versus version 2. I can only say that both versions usually show up in larger groups, thus giving the impression of remote logging working fine or failing altogether. Do you have an idea why this is happening? Does it also happen on any of your systems?</p><p>[s]If possible I&#039;ll rename the thread title to better describe the problem.[/s] (see below)</p>											<p class="post-edited">(Last edited by <strong>penkert</strong> on 9 Nov 2010, 17:22)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p120681">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">fyi</div>
					<div class="post-datetime">
						9 Nov 2010, 17:14					</div>
				</div>
				<div class="post-content content">
					<p>Please do. I think you need jow&#039;s help.</p><p>Could you install syslog server in Windows or Linux to make sure what has been missing.</p><p>You had better rephrase your question and configurations because I don&#039;t understand what you mean doesn&#039;t work. Please also read &quot;<a href="http://wiki.openwrt.org/doc/uci/system">System configuration - OpenWrt Wiki</a>&quot; regarding &quot;kconloglevel&quot; to see if it&#039;s relevant.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p120684">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">penkert</div>
					<div class="post-datetime">
						9 Nov 2010, 17:28					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ll do some more testing (ideas: another syslog server, wireshark sniffing of syslog UDP packets, plain Kamikaze 8.09.2 without X-WRT, ...) and then start a new thread so people don&#039;t have to read through all the irrelevant stuff. This might take a while though, so please standby...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p120892">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">penkert</div>
					<div class="post-datetime">
						12 Nov 2010, 14:04					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ve done some more testing----with mixed results----and that&#039;s why I&#039;m still using this thread instead of a new one. I used Wireshark to investigate which log messages get sent out to the remote syslog server and which don&#039;t. This way we can be sure it&#039;s not the syslog-ng server that&#039;s ignoring messages.</p><p>Well, the problem is very real on my Kamikaze 8.09.2 brcm-2.4 system with X-WRT baked in. For some reason this system produces two types of log messages which should actually be identical. For instance, I have a firewall entry logging outgoing WAN traffic. Here are two unaltered messages which appeared right after another within OpenWRT&#039;s <em>internal</em> log:</p><div class="codebox"><pre><code>Nov 11 02:49:38 kernel: wan: IN=br-lan OUT=eth0.5 SRC=192.168.188.136 DST=74.84.138.99 LEN=60 TOS=0x00 PREC=0x00 TTL=63 ID=21161 DF PROTO=TCP SPT=42459 DPT=80 WINDOW=5840 RES=0x00 SYN URGP=0
Nov 11 02:49:40 HRC-Gateway user.info kernel: wan: IN=br-lan OUT=eth0.5 SRC=192.168.188.136 DST=74.84.138.99 LEN=60 TOS=0x00 PREC=0x00 TTL=63 ID=33316 DF PROTO=TCP SPT=42460 DPT=80 WINDOW=5840 RES=0x00 SYN URGP=0</code></pre></div><p>As you can see the latter one has a &quot;HRC-Gateway user.info&quot; part which is omitted in the previous message. (&quot;HRC-Gateway&quot; is the router&#039;s host name.) The first message was sent out over the network, the second one was definitely <em>not</em>.</p><p>Now I tried the same on a pure Kamikaze 8.09.2 brcm-2.4 system without X-WRT. So far only log messages including host name and clear text priority level (i.e. the latter type of message from above) have been written to the internal log and all of them have also been sent out over the network. Of course, only a longterm test can show if remote logging is working reliably now but the fact that the very format that wasn&#039;t working correctly above is working fine now seems promising.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>