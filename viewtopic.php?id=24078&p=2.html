<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Fonera 2100 serial console need urgent help</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 26 Mar 2018 and 27 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 2 of 2</div><nav><ul><li><a href="viewtopic.php%3Fid=24078&amp;p=1.html">1</a></li><li class="pagination-current"><span>2</span></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p107447">
				<div class="post-metadata">
					<div class="post-num">Post #26</div>
					<div class="post-author">pedrodv</div>
					<div class="post-datetime">
						21 Apr 2010, 02:08					</div>
				</div>
				<div class="post-content content">
					<p>i already installed new firmware with him modification,<br />now i only need to use /etc/init.d/custom_user_startup but it seems dont start on begining, do you know how we start that script?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p107467">
				<div class="post-metadata">
					<div class="post-num">Post #27</div>
					<div class="post-author">fyi</div>
					<div class="post-datetime">
						21 Apr 2010, 10:44					</div>
				</div>
				<div class="post-content content">
					<p>Execute &quot;/etc/init.d/custom_user_startup enable&quot; and check /etc/rc.d/SXXcustom-user-startup</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p107793">
				<div class="post-metadata">
					<div class="post-num">Post #28</div>
					<div class="post-author">fyi</div>
					<div class="post-datetime">
						25 Apr 2010, 04:31					</div>
				</div>
				<div class="post-content content">
					<p>I also install <a href="http://www.gargoyle-router.com/download.php">Gargoyle</a> on my ASUS WL-HDD. Could you add<br /></p><div class="quotebox"><blockquote><p>option &#039;conloglevel&#039; &#039;3&#039;<br />option &#039;kconloglevel&#039; &#039;3&#039;</p></blockquote></div><p>to &quot;/etc/config/system&quot; and see if it inhibits messages of loglevel above 2 (KERN_CRIT) from being sent to console? I can&#039;t verify that because ASUS WL-HDD has no serial console.</p><p><a href="http://wiki.openwrt.org/doc/uci/system">System configuration - OpenWrt Wiki</a><br /><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/syslog.2.html">syslog(2)</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p107824">
				<div class="post-metadata">
					<div class="post-num">Post #29</div>
					<div class="post-author">pedrodv</div>
					<div class="post-datetime">
						25 Apr 2010, 14:33					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>fyi wrote:</cite><blockquote><p>I also install <a href="http://www.gargoyle-router.com/download.php">Gargoyle</a> on my ASUS WL-HDD. Could you add<br /></p><div class="quotebox"><blockquote><p>option &#039;conloglevel&#039; &#039;3&#039;<br />option &#039;kconloglevel&#039; &#039;3&#039;</p></blockquote></div><p>to &quot;/etc/config/system&quot; and see if it inhibits messages of loglevel above 2 (KERN_CRIT) from being sent to console? I can&#039;t verify that because ASUS WL-HDD has no serial console.</p><p><a href="http://wiki.openwrt.org/doc/uci/system">System configuration - OpenWrt Wiki</a><br /><a href="http://www.kernel.org/doc/man-pages/online/pages/man2/syslog.2.html">syslog(2)</a></p></blockquote></div><p>i already tried gargoyle, good firmware by the way, i used all commands for my project ( <a href="http://www.jbprojects.net/projects/wifirobot">http://www.jbprojects.net/projects/wifirobot</a> )</p><p>/usr/sbin/setserial /dev/ttyS0 irq 3&nbsp; ( had some problems because irq 3 is for wireless, so i did no changes, it gives irq 37 and i don&#039;t see anything on carserver program about irq&#039;s)<br />/usr/sbin/stty -F /dev/tyS0 raw speed 9600 ( work very well )<br />/bin/carserver &amp; ( this receives data from pc but gives no data to serial port, maybe i need to change something on carserver.c, i already changed tts/1 to ttyS0 but it gives the same problem) :S</p><div class="quotebox"><blockquote><p>option &#039;conloglevel&#039; &#039;3&#039;<br />option &#039;kconloglevel&#039; &#039;3&#039;</p></blockquote></div><p>what they do?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p107826">
				<div class="post-metadata">
					<div class="post-num">Post #30</div>
					<div class="post-author">fyi</div>
					<div class="post-datetime">
						25 Apr 2010, 14:54					</div>
				</div>
				<div class="post-content content">
					<p>By modifying the boot script from RedBoot, I think you can override the kernel command line. See the following thread, post #23.<br /></p><div class="quotebox"><blockquote><p><a href="https://forum.openwrt.org/viewtopic.php?pid=76440#p76440">OpenWrt / Failsafe mode from redboot...</a> #23</p></blockquote></div><p>For example, decompress gargoyle_1.2.3-atheros-vmlinux.gz. Search the string &quot;console=ttyS0,9600&quot; and the offset is 0x20D5B0 with length 62 bytes. Now calculate the memory offset,<br /></p><div class="quotebox"><blockquote><p>0x80041000 + 0x20D5B0 = 0x8024E5B0</p></blockquote></div><div class="codebox"><pre><code>RedBoot&gt; load -d -r -h 192.168.1.100 -m http -b 0x80041000 gargoyle_1.2.3-atheros-vmlinux.gz
Raw file loaded 0x80041000-0x80279085, assumed entry at 0x80041000
RedBoot&gt; d -b 0x8024E5B0 -l 64
8024E5B0: 63 6F 6E 73 6F 6C 65 3D  74 74 79 53 30 2C 39 36  |console=ttyS0,96|
8024E5C0: 30 30 20 72 6F 6F 74 66  73 74 79 70 65 3D 73 71  |00 rootfstype=sq|
8024E5D0: 75 61 73 68 66 73 2C 6A  66 66 73 32 20 69 6E 69  |uashfs,jffs2 ini|
8024E5E0: 74 3D 2F 65 74 63 2F 70  72 65 69 6E 69 74 00 00  |t=/etc/preinit..|
RedBoot&gt; mcopy -s 0x8024E5C3 -d 0x8024E5B0 -l 100 -1
RedBoot&gt; d -b 0x8024E5B0 -l 64
8024E5B0: 72 6F 6F 74 66 73 74 79  70 65 3D 73 71 75 61 73  |rootfstype=squas|
8024E5C0: 68 66 73 2C 6A 66 66 73  32 20 69 6E 69 74 3D 2F  |hfs,jffs2 init=/|
8024E5D0: 65 74 63 2F 70 72 65 69  6E 69 74 00 00 00 00 00  |etc/preinit.....|
8024E5E0: 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</code></pre></div><p>I think you can change the load command to &quot;fis load -d vmlinux.bin.l7&quot; so the boot_script_data might look like this,<br /></p><div class="codebox"><pre><code>fis load -d vmlinux.bin.l7
mcopy -s 0x8024E5C3 -d 0x8024E5B0 -l 100 -1
exec</code></pre></div><p>You must create vmlinux.bin.l7 with gzip&#039;d image.</p><p>Edit:<br />I just re-read &quot;<a href="http://www.karosium.com/2010/03/fonera-1-wire-microlan-extension.html">Karosium: Fonera 1-wire MicroLAN extension</a>&quot; again and I think it sheds some light on this.<br /></p><div class="quotebox"><blockquote><p>Because compiling a whole new firmware is entirely too much of a pain for something as simple as freeing up a serial port i ended up unpacking the kernel image and modifying the hardcoded string with a hex editor. Then repacking, padding, and flashing the modified image to the Fonera. (modify the string to <strong>console=/dev/null</strong>)<br />The <a href="http://www.7-zip.org/sdk.html">LZMA SDK from 7zip</a> can be used for the compression.</p></blockquote></div>											<p class="post-edited">(Last edited by <strong>fyi</strong> on 27 Apr 2010, 14:43)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p107828">
				<div class="post-metadata">
					<div class="post-num">Post #31</div>
					<div class="post-author">pedrodv</div>
					<div class="post-datetime">
						25 Apr 2010, 15:30					</div>
				</div>
				<div class="post-content content">
					<p>humm tomorrow i will try with this things</p><div class="quotebox"><blockquote><p>option &#039;conloglevel&#039; &#039;3&#039;<br />option &#039;kconloglevel&#039; &#039;3&#039;</p></blockquote></div><p>EDIT: he provided his modified firmware already with console=/dev/null <br /><a href="http://www.mediafire.com/?vv1k4ihgjjm">http://www.mediafire.com/?vv1k4ihgjjm</a></p>											<p class="post-edited">(Last edited by <strong>pedrodv</strong> on 27 Apr 2010, 16:49)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p108014">
				<div class="post-metadata">
					<div class="post-num">Post #32</div>
					<div class="post-author">fyi</div>
					<div class="post-datetime">
						27 Apr 2010, 17:05					</div>
				</div>
				<div class="post-content content">
					<p>I flashed my La Fonera+ by FON Flash to gargoyle_1.2.3-atheros-root.squashfs and gargoyle_1.2.3-atheros-vmlinux.gz. I can confirm that adding &quot;conloglevel&quot; and &quot;kconloglevel&quot; to &quot;/etc/config/system&quot; will inhibit messages sent to serial console depending on the loglevel. I also comment out &quot;ttyS0::askfirst:/bin/ash --login&quot; in /etc/inittab. Here are the messages sent to serial console while loglevel set to 3.<br /></p><div class="codebox"><pre><code>+Ethernet eth0: MAC address 00:18:84:00:18:84
IP: 192.168.1.1/255.255.255.0, Gateway: 0.0.0.0
Default server: 192.168.1.254

RedBoot(tm) bootstrap and debug environment [ROMRAM]
OpenWrt certified release, version 1.1 - built 22:32:28, May  7 2007

Copyright (C) 2000, 2001, 2002, 2003, 2004 Red Hat, Inc.

Board: FON 2201
RAM: 0x80000000-0x81000000, [0x80040290-0x80fe1000] available
FLASH: 0xa8000000 - 0xa87f0000, 128 blocks of 0x00010000 bytes each.
== Executing boot script in 10.000 seconds - enter ^C to abort
RedBoot&gt; fis load -d vmlinux.bin.l7
Image loaded from 0x80041000-0x80279086
RedBoot&gt; exec
Now booting linux kernel:
 Base address 0x80030000 Entry 0x80041000
 Cmdline :
Linux version 2.6.26.8 (eric@Osiris) (gcc version 4.1.2) #1 Sat Apr 17 19:11:44 EDT 2010
CPU revision is: 00019064 (MIPS 4KEc)
Determined physical RAM map:
 memory: 01000000 @ 00000000 (usable)
Initrd not found or empty - disabling initrd
Zone PFN ranges:
  Normal          0 -&gt;     4096
Movable zone start PFN for each node
early_node_map[1] active PFN ranges
    0:        0 -&gt;     4096
Built 1 zonelists in Zone order, mobility grouping off.  Total pages: 4064
Kernel command line: console=ttyS0,9600 rootfstype=squashfs,jffs2 init=/etc/preinit
Primary instruction cache 16kB, VIPT, 4-way, linesize 16 bytes.
Primary data cache 16kB, 4-way, VIPT, no aliases, linesize 16 bytes
PID hash table entries: 64 (order: 6, 256 bytes)
console [ttyS0] enabled
Dentry cache hash table entries: 2048 (order: 1, 8192 bytes)
Inode-cache hash table entries: 1024 (order: 0, 4096 bytes)
Memory: 13600k/16384k available (1846k kernel code, 2784k reserved, 304k data, 124k init, 0k highmem)
SLUB: Genslabs=6, HWalign=32, Order=0-3, MinObjects=0, CPUs=1, Nodes=1
Mount-cache hash table entries: 512
net_namespace: 484 bytes
NET: Registered protocol family 16
Radio config found at offset 0xf8(0x1f8)
AR531x PCI init...
done
PCI: fixing up device 0,3,0
PCI: Failed to allocate mem resource #1:4000000@84000000 for 0000:00:00.0
PCI: Failed to allocate mem resource #1:4000000@84000000 for 0000:00:03.0
NET: Registered protocol family 2
IP route cache hash table entries: 1024 (order: 0, 4096 bytes)
TCP established hash table entries: 512 (order: 0, 4096 bytes)
TCP bind hash table entries: 512 (order: -1, 2048 bytes)
TCP: Hash tables configured (established 512 bind 512)
TCP reno registered
NET: Registered protocol family 1
ar531x: Registering GPIODEV device
squashfs: version 3.0 (2006/03/15) Phillip Lougher
Registering mini_fo version $Id$
JFFS2 version 2.2. (NAND) (SUMMARY)  Â© 2001-2006 Red Hat, Inc.
msgmni has been set to 26
io scheduler noop registered
io scheduler deadline registered (default)
gpiodev: gpio device registered with major 254
gpiodev: gpio platform device registered with access mask FFFFFFFF
Serial: 8250/16550 driver $Revision: 1.90 $ 1 ports, IRQ sharing disabled
serial8250: ttyS0 at MMIO 0xb1100003 (irq = 37) is a 16550A
eth0: Atheros AR231x: 00:18:84:00:18:84, irq 4
ar2313_eth_mii: probed
eth0: Marvell 88E6060 PHY driver attached.
eth0: attached PHY driver [Marvell 88E6060] (mii_bus:phy_addr=0:1f)
cmdlinepart partition parsing not available
Searching for RedBoot partition table in spiflash at offset 0x7d0000
Searching for RedBoot partition table in spiflash at offset 0x7e0000
6 RedBoot partitions found on MTD device spiflash
Creating 6 MTD partitions on &quot;spiflash&quot;:
0x00000000-0x00030000 : &quot;RedBoot&quot;
0x00030000-0x006d0000 : &quot;rootfs&quot;
mtd: partition &quot;rootfs&quot; set to be root filesystem
mtd: partition &quot;rootfs_data&quot; created automatically, ofs=2C0000, len=410000
0x002c0000-0x006d0000 : &quot;rootfs_data&quot;
0x006d0000-0x007d0000 : &quot;vmlinux.bin.l7&quot;
0x007e0000-0x007ef000 : &quot;FIS directory&quot;
0x007ef000-0x007f0000 : &quot;RedBoot config&quot;
0x007f0000-0x00800000 : &quot;boardconfig&quot;
TCP vegas registered
NET: Registered protocol family 17
Bridge firewalling registered
802.1Q VLAN Support v1.8 Ben Greear &lt;greearb@candelatech.com&gt;
eth0: Configuring MAC for full duplex
All bugs added by David S. Miller &lt;davem@redhat.com&gt;
VFS: Mounted root (squashfs filesystem) readonly.
Freeing unused kernel memory: 124k freed
Please be patient, while OpenWrt loads ...
Algorithmics/MIPS FPU Emulator v1.5
- preinit -
Press CTRL-C for failsafe
switching to jffs2
mini_fo: using base directory: /
mini_fo: using storage directory: /jffs
- init -</code></pre></div><p>By modifying the kernel image from RedBoot, the messages sent to serial console look like,<br /></p><div class="codebox"><pre><code>+Ethernet eth0: MAC address 00:18:84:00:18:84
IP: 192.168.1.1/255.255.255.0, Gateway: 0.0.0.0
Default server: 192.168.1.254

RedBoot(tm) bootstrap and debug environment [ROMRAM]
OpenWrt certified release, version 1.1 - built 22:32:28, May  7 2007

Copyright (C) 2000, 2001, 2002, 2003, 2004 Red Hat, Inc.

Board: FON 2201
RAM: 0x80000000-0x81000000, [0x80040290-0x80fe1000] available
FLASH: 0xa8000000 - 0xa87f0000, 128 blocks of 0x00010000 bytes each.
== Executing boot script in 10.000 seconds - enter ^C to abort
^C
RedBoot&gt; fis load -d vmlinux.bin.l7
Image loaded from 0x80041000-0x80279086
RedBoot&gt; mfill -b 0x8024E5B8 -l 5 -p 0x2f -1
RedBoot&gt; mfill -b 0x8024E5B9 -l 1 -p 0x64 -1
RedBoot&gt; mfill -b 0x8024E5BA -l 1 -p 0x65 -1
RedBoot&gt; mfill -b 0x8024E5BB -l 1 -p 0x76 -1
RedBoot&gt; mfill -b 0x8024E5BD -l 1 -p 0x6E -1
RedBoot&gt; mfill -b 0x8024E5BE -l 1 -p 0x75 -1
RedBoot&gt; mfill -b 0x8024E5BF -l 2 -p 0x6C -1
RedBoot&gt; mfill -b 0x8024E5C1 -l 1 -p 0x20 -1
RedBoot&gt; d -b 0x8024E5B0 -l 64
8024E5B0: 63 6F 6E 73 6F 6C 65 3D  2F 64 65 76 2F 6E 75 6C  |console=/dev/nul|
8024E5C0: 6C 20 20 72 6F 6F 74 66  73 74 79 70 65 3D 73 71  |l  rootfstype=sq|
8024E5D0: 75 61 73 68 66 73 2C 6A  66 66 73 32 20 69 6E 69  |uashfs,jffs2 ini|
8024E5E0: 74 3D 2F 65 74 63 2F 70  72 65 69 6E 69 74 00 00  |t=/etc/preinit..|
RedBoot&gt; exec
Now booting linux kernel:
 Base address 0x80030000 Entry 0x80041000
 Cmdline :</code></pre></div><p>You can see the difference from dmesg<br /></p><div class="codebox"><pre><code>root@OpenWrt:~# dmesg
Linux version 2.6.26.8 (eric@Osiris) (gcc version 4.1.2) #1 Sat Apr 17 19:11:44 EDT 2010
CPU revision is: 00019064 (MIPS 4KEc)
Determined physical RAM map:
 memory: 01000000 @ 00000000 (usable)
Entering add_active_range(0, 0, 4096) 0 entries of 256 used
Initrd not found or empty - disabling initrd
Zone PFN ranges:
  Normal          0 -&gt;     4096
Movable zone start PFN for each node
early_node_map[1] active PFN ranges
    0:        0 -&gt;     4096
On node 0 totalpages: 4096
  Normal zone: 32 pages used for memmap
  Normal zone: 0 pages reserved
  Normal zone: 4064 pages, LIFO batch:0
  Movable zone: 0 pages used for memmap
Built 1 zonelists in Zone order, mobility grouping off.  Total pages: 4064
Kernel command line: console=/dev/null  rootfstype=squashfs,jffs2 init=/etc/preinit
Primary instruction cache 16kB, VIPT, 4-way, linesize 16 bytes.
Primary data cache 16kB, 4-way, VIPT, no aliases, linesize 16 bytes
PID hash table entries: 64 (order: 6, 256 bytes)
Dentry cache hash table entries: 2048 (order: 1, 8192 bytes)</code></pre></div><p>You can see that the following line is gone.<br /></p><div class="codebox"><pre><code>console [ttyS0] enabled</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p108015">
				<div class="post-metadata">
					<div class="post-num">Post #33</div>
					<div class="post-author">fyi</div>
					<div class="post-datetime">
						27 Apr 2010, 17:13					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>pedrodv wrote:</cite><blockquote><p>humm tomorrow i will try with this things</p><div class="quotebox"><blockquote><p>option &#039;conloglevel&#039; &#039;3&#039;<br />option &#039;kconloglevel&#039; &#039;3&#039;</p></blockquote></div><p>EDIT: he provided his modified firmware already with console=/dev/null <br /><a href="http://www.mediafire.com/?vv1k4ihgjjm">http://www.mediafire.com/?vv1k4ihgjjm</a></p></blockquote></div><p>I knew that. That&#039;s why I provided the link to his modified firmware to you. Please check #32 and you can do it by yourself. It&#039;s much easier to modify gzip&#039;d image than lzma&#039;d image.</p><p>I think that setting up loglevel should be enough for you so you don&#039;t have to depend on his modified firmware.</p>											<p class="post-edited">(Last edited by <strong>fyi</strong> on 27 Apr 2010, 17:19)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p108017">
				<div class="post-metadata">
					<div class="post-num">Post #34</div>
					<div class="post-author">pedrodv</div>
					<div class="post-datetime">
						27 Apr 2010, 17:34					</div>
				</div>
				<div class="post-content content">
					<p>can you tell me all steps you did? modifieng kernel image, how to, etc? <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> that will help alot <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>ok i will try it, of i have any questions i will ask here <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>how we edit kernel image? ( noob question i know but i need more detailed info <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> sry )</p>											<p class="post-edited">(Last edited by <strong>pedrodv</strong> on 28 Apr 2010, 00:32)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p108058">
				<div class="post-metadata">
					<div class="post-num">Post #35</div>
					<div class="post-author">fyi</div>
					<div class="post-datetime">
						28 Apr 2010, 05:53					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>pedrodv wrote:</cite><blockquote><p>how we edit kernel image? ( noob question i know but i need more detailed info <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> sry )</p></blockquote></div><p>You can see from #32 that I didn&#039;t modify kernel image from Windows but from RedBoot by several &quot;mfill&quot; commands. And I finally figure it out that since RedBoot can decompress lzma&#039;d image (of course), the trick also applies to it, not just gzip&#039;d image. At first I misinterpreted the lzma&#039;d Atheros kenel image format to be the same as Broadcom. That&#039;s why I kept thinking that the Atheros image consists of a gzip&#039;d lzma decompressor and a lzma&#039;d kernel image and there&#039;s no way to decompress the kernel image directly. I was completely wrong. The RedBoot in La Fonera can decompress lzma&#039;d image directly so there&#039;s no lzma decompressor int the Atheros-based lzma&#039;d kernel image. There&#039;s only one important note that currently there&#039;s no command to transfer lzma&#039;d image and decompress it at the same time in the RedBoot of La Fonera. Which means that there&#039;s no such command &quot;load -l.&quot; You can only do it from fis directory by &quot;fis load -l&quot; and it does the same job as &quot;fis load -d&quot; and &quot;load -d&quot; to gzip&#039;d image.</p><p>I haven&#039;t got a chance to modify lzma&#039;d image from Windows because I don&#039;t know whether RedBoot can decompress the 7zip lzma&#039;d image or not. Maybe later when I figure it out how to do that. But I really think that setting up loglevel should be enough for you because in any case you can&#039;t totally inhibit RedBoot messages from serial console. You still have to fire up OpenWrt first and the controlled device next. Maybe setting up a different baud rate other than 9600 in the controlled device is a good idea.</p><p>You can run &quot;7-Zip&quot; to decompress lzma&#039;d image and &quot;mirkes.de Tiny Hexer&quot; to find out the offset of the kernel command line options.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p108111">
				<div class="post-metadata">
					<div class="post-num">Post #36</div>
					<div class="post-author">fyi</div>
					<div class="post-datetime">
						28 Apr 2010, 22:22					</div>
				</div>
				<div class="post-content content">
					<p>Run 7-Zip to extract &quot;stty&quot; from coreutils_6.9-1_mips.ipk and upload it to Fonera.<br />Opkg install setserial, ser2net and minicom.</p><div class="codebox"><pre><code>root@OpenWrt:~# cat /etc/init.d/setserial
#!/bin/sh /etc/rc.common
# Copyright (C) 2006 OpenWrt.org

START=15
boot() {
        /usr/sbin/setserial /dev/ttyS0 irq 37
        /bin/stty -F /dev/ttyS0 speed 9600 raw -echo
}</code></pre></div><div class="codebox"><pre><code>root@OpenWrt:~# cat /etc/ser2net.conf
#  &lt;TCP port&gt;:&lt;state&gt;:&lt;timeout&gt;:&lt;device&gt;:&lt;options&gt;
2001:raw:600:/dev/ttyS0:9600 NONE 1STOPBIT 8DATABITS -XONXOFF LOCAL -RTSCTS
2002:raw:600:/dev/ttyS0:57600 NONE 1STOPBIT 8DATABITS -XONXOFF LOCAL -RTSCTS
2003:raw:600:/dev/ttyS0:115200 NONE 1STOPBIT 8DATABITS -XONXOFF LOCAL -RTSCTS</code></pre></div><div class="codebox"><pre><code>root@OpenWrt:~# ser2net -u</code></pre></div><p>Run &quot;PuTTY 0.60&quot; or &quot;Hercules Setup&quot; to connect to Serial:COM3@9600_8n1 which connects to J2 (FON2100) or JP1 (FON220x) by a USB to RS232 cable.</p><p>Run &quot;Hercules Setup&quot; and click &quot;TCP Client,&quot; IP:192.168.1.1, Port:2001 and click Connect.</p><p>Haven&#039;t tried &quot;Perle TruePort&quot; yet. &quot;com0com&quot; is also an interesting project.</p><p><a href="https://forum.openwrt.org/viewtopic.php?id=13161">OpenWrt / Serial port</a><br /><a href="http://buffalo.nas-central.org/index.php/Use_a_Nokia_Serial_Cable_on_an_ARM9_Linkstation">Use a Nokia Serial Cable on an ARM9 Linkstation - NAS-Central Buffalo - The Linkstation Wiki</a></p>											<p class="post-edited">(Last edited by <strong>fyi</strong> on 30 Apr 2010, 06:12)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p108143">
				<div class="post-metadata">
					<div class="post-num">Post #37</div>
					<div class="post-author">fyi</div>
					<div class="post-datetime">
						29 Apr 2010, 13:23					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ve got an idea that you can totally inhibit RedBoot and kernel messages by appending to TX a simple transistor circuit controlled by GPIO signal. For example, GPIO 7 on SW1-6 or GPIO 4 on SW1-2.</p><p>BTW, on some FON2100&#039;s, the RX must keep low before powering up, otherwise the RedBoot won&#039;t boot at all. So I believe that it&#039;s necessary to append a simple circuit using GPIO pins to control TX and RX on FON2100s.</p><p>Just found a very useful information that on FON2201 the GPIO 3 connects to LED4. I guess that LED4 might be the USB indicator on FON2202. Anyway, I can use it to control TX and inhibit RedBoot messages.</p><p><a href="http://www.dd-wrt.com/wiki/index.php/LaFonera_Hardware_IO_%28en%29">LaFonera Hardware IO (en) - DD-WRT Wiki</a></p>											<p class="post-edited">(Last edited by <strong>fyi</strong> on 29 Apr 2010, 18:10)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p108180">
				<div class="post-metadata">
					<div class="post-num">Post #38</div>
					<div class="post-author">pedrodv</div>
					<div class="post-datetime">
						29 Apr 2010, 17:56					</div>
				</div>
				<div class="post-content content">
					<p>what ser2net and minicom does in my case?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p108185">
				<div class="post-metadata">
					<div class="post-num">Post #39</div>
					<div class="post-author">fyi</div>
					<div class="post-datetime">
						29 Apr 2010, 18:16					</div>
				</div>
				<div class="post-content content">
					<p>&quot;ser2net&quot; stands for &quot;Serial to Ethernet&quot; converter. Through ser2net, you can remotely control /dev/ttyS0 of Fonera by connecting to the TCP ports defined in /etc/ser2net.conf.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p108186">
				<div class="post-metadata">
					<div class="post-num">Post #40</div>
					<div class="post-author">pedrodv</div>
					<div class="post-datetime">
						29 Apr 2010, 18:25					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>fyi wrote:</cite><blockquote><p>&quot;ser2net&quot; stands for &quot;Serial to Ethernet&quot; converter. Through ser2net, you can remotely control /dev/ttyS0 of Fonera by connecting to the TCP ports defined in /etc/ser2net.conf.</p></blockquote></div><p>humm, maybe with ser2net, carserver program can control /dev/ttyS0 by TCP port or i&#039;m confused... lol</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p108239">
				<div class="post-metadata">
					<div class="post-num">Post #41</div>
					<div class="post-author">fyi</div>
					<div class="post-datetime">
						30 Apr 2010, 07:34					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>pedrodv wrote:</cite><blockquote><p>humm, maybe with ser2net, carserver program can control /dev/ttyS0 by TCP port or i&#039;m confused... lol</p></blockquote></div><p><a href="http://www.jbprojects.net/projects/wifirobot/">Wifi Robot - JBProjects.net</a><br /></p><div class="quotebox"><cite>Jon Bennett wrote:</cite><blockquote><p><strong><span style="color: red">Software</span></strong></p><p>There are three pieces of software that make this project possible. The VB6 Wifi_Robot client application (runs on Windows), the CarServer which is written in C and runs on the router running OpenWRT WhiteRussian v0.9 (Linux), and the microcontroller firmware.</p></blockquote></div><p><a href="http://www.jbprojects.net/projects/wifirobot/package/carserver/src/carserver.c">carserver.c</a><br /></p><div class="codebox"><pre><code>#define SERVER_PORT 1500
...
#if DEBUG
    printf(&quot;%s: waiting for data on port TCP %u\n&quot;,argv[0],SERVER_PORT);
#endif</code></pre></div><p>You can find that the server IP:Port should be <strong>192.168.1.1:1500</strong> (TCP). If you don&#039;t want to compile &quot;carserver.c&quot; by yourself, I believe you can replace it with ser2net and edit <strong>/etc/ser2net.conf</strong><br /></p><div class="codebox"><pre><code>#  &lt;TCP port&gt;:&lt;state&gt;:&lt;timeout&gt;:&lt;device&gt;:&lt;options&gt;
1500:raw:3600:/dev/ttyS0:9600 NONE 1STOPBIT 8DATABITS -XONXOFF LOCAL -RTSCTS</code></pre></div><p>Edit <strong>/etc/init.d/setserial</strong><br /></p><div class="codebox"><pre><code>#!/bin/sh /etc/rc.common
# Copyright (C) 2006 OpenWrt.org

START=15
boot() {
        /usr/sbin/setserial /dev/ttyS0 irq 37
        /bin/stty -F /dev/ttyS0 speed 9600 raw
        /usr/sbin/ser2net -u &amp;
}</code></pre></div>											<p class="post-edited">(Last edited by <strong>fyi</strong> on 30 Apr 2010, 07:42)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p109855">
				<div class="post-metadata">
					<div class="post-num">Post #42</div>
					<div class="post-author">pedrodv</div>
					<div class="post-datetime">
						25 May 2010, 16:48					</div>
				</div>
				<div class="post-content content">
					<p>all this things didn&#039;t work, so i&#039;m thinking on another router with two serial ports and easy to make this ( with white russian compatible) anyone have suggestions about another router?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p110617">
				<div class="post-metadata">
					<div class="post-num">Post #43</div>
					<div class="post-author">fyi</div>
					<div class="post-datetime">
						6 Jun 2010, 12:28					</div>
				</div>
				<div class="post-content content">
					<p>In my case, everything is working fine. I can control Fonera+ ttyS0 from minicom or ser2net. ttyS0 is released by editing /etc/inittab and console messages are controlled by editing /etc/config/system. Two serial ports won&#039;t do you any good if you can&#039;t figure out what&#039;s going on. Besides, I&#039;d rather buying more powerful and less expensive routers like TP-Link TL-WR740N than spending money on the old Linksys WRT54G just for the extra serial port.</p><p>There&#039;s only one problem. If the router crashed because of JFFS error and no busybox over tty, the easiest way to recover it is to load &quot;<a href="http://www.moliets-bastide.info/post/FONERAM">FONERAM</a>&quot; and erase JFFS.<br /></p><div class="codebox"><pre><code>Restore default factory settings.

    root@LamaBleu:/# mtd-mount
    *** mount /dev/mtdblock3 on /rom (read-only)
    *** mount /dev/mtdblock4 on /jffs
    root@LamaBleu:/# rm -Rf /jffs/*</code></pre></div><p><a href="http://www.dd-wrt.com/wiki/index.php/Supported_Devices#Cisco">Supported Devices - DD-WRT Wiki</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p111174">
				<div class="post-metadata">
					<div class="post-num">Post #44</div>
					<div class="post-author">guiambros</div>
					<div class="post-datetime">
						14 Jun 2010, 07:45					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>fyi wrote:</cite><blockquote><p>The RedBoot in La Fonera can decompress lzma&#039;d image directly so there&#039;s no lzma decompressor int the Atheros-based lzma&#039;d kernel image. There&#039;s only one important note that currently there&#039;s no command to transfer lzma&#039;d image and decompress it at the same time in the RedBoot of La Fonera. Which means that there&#039;s no such command &quot;load -l.&quot; You can only do it from fis directory by &quot;fis load -l&quot; and it does the same job as &quot;fis load -d&quot; and &quot;load -d&quot; to gzip&#039;d image.</p></blockquote></div><p>Thanks a lot for that, <strong>fyi</strong>!&nbsp; I was also struggling to understand how Atheros was decoding the lzma&#039;d images, but reading your description on #35 and suggestions above of using mfill to patch the kernel on-the-fly (#32) I finally managed to change the hard-coded serial speed from 115200 bps to 9600.</p><p>In my case I&#039;m using DD-WRT v24 preSP2 build 13064, but the approach above should work for OpenWRT or pretty much with any other firmware with hard-coded serial speeds. If anyone is trying to also set the serial to 9600 bps so you can connect to another device running at 9600 or just to have RedBoot+console without adjusting manually between 9600/115200, just use this:</p><div class="codebox"><pre><code>fis load -l linux
mfill -b 0x802A64D8 -l 4 -4 -p 0x74747953
mfill -b 0x802A64DC -l 4 -4 -p 0x302C3936
mfill -b 0x802A64E0 -l 4 -4 -p 0x30302020
exec</code></pre></div><p>(of course if you&#039;re using a build different than 13064 you&#039;ll need uncompress the image, find the string <em>console=ttyS0,115200</em> and recalculate the offset of the exact position where the string &quot;115200&quot; starts)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p114104">
				<div class="post-metadata">
					<div class="post-num">Post #45</div>
					<div class="post-author">pedrodv</div>
					<div class="post-datetime">
						31 Jul 2010, 00:17					</div>
				</div>
				<div class="post-content content">
					<p>hey again, sorry to be boring but if it worked with you, can you post all the steps? i&#039;m confused about some things you made :S specially the part with minicrom pls</p><p>i read something about fonera 2100 vs Fonera+, fonera+ is more easy to &quot;unlock&quot; serial console with that suggestion you made.</p>											<p class="post-edited">(Last edited by <strong>pedrodv</strong> on 2 Aug 2010, 16:56)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p114342">
				<div class="post-metadata">
					<div class="post-num">Post #46</div>
					<div class="post-author">pedrodv</div>
					<div class="post-datetime">
						4 Aug 2010, 00:03					</div>
				</div>
				<div class="post-content content">
					<p>by the way i cant install now carserver on fonera, i tried different versions of openwrt, ( 7.09, 8.09.2, gargoyle) and it always says the same:&nbsp; Packages were found, but none compatible with the architectures configured :S</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 2 of 2</div><nav><ul><li><a href="viewtopic.php%3Fid=24078&amp;p=1.html">1</a></li><li class="pagination-current"><span>2</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>