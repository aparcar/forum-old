<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Wake on WLAN</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 31 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p270711">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">tof233</div>
					<div class="post-datetime">
						31 Mar 2015, 21:12					</div>
				</div>
				<div class="post-content content">
					<p>Hello<br />I am currently using wake on WLAN from a WDR3600 (OpenWrt Attitude Adjustment 12.09) to a laptop&nbsp; (Asus Rog G751jy/Intel DuaI Band Wireless-ACC 7260 )<br />I send the magic packet directly on the router using wol.</p><p>It almost works (laptop is awaken directly when I send the magic packet through wifi) except that for some reasons the laptop has insomnia every 10 minutes (without magic packet).</p><p>I opened a thread on Asus Rog forum as it could be caused by the laptop/system <a href="https://rog.asus.com/forum/showthread.php?59707-G751JY-wake-on-WLAN-insomnia&amp;p=488026#post488026">https://rog.asus.com/forum/showthread.p â€¦ post488026</a> but I think it may also be caused by openWRT :<br />When I put my laptop to sleep after&nbsp; connecting it to another router (a bbox2), it doesn&#039;t wake up every 10 minutes.<br />And&nbsp; I also have the same problem with another laptop, a macbook pro MD311LL/A&nbsp; (BCM4322)</p><p>Do you have an idea of what could trigger this wake up ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p270712">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">tof233</div>
					<div class="post-datetime">
						31 Mar 2015, 21:16					</div>
				</div>
				<div class="post-content content">
					<p>I performed a tcpdump on the router and here is what I got when my laptop wakes up: <br /><em>13:57:00.519756 IP (tos 0xc0, ttl 1, id 0, offset 0, flags [DF], proto IGMP (2), length 32, options (RA))<br />&nbsp; &nbsp; 0.0.0.0 &gt; all-systems.mcast.net: igmp query v2<br />13:59:05.959755 IP (tos 0xc0, ttl 1, id 0, offset 0, flags [DF], proto IGMP (2), length 32, options (RA))<br />&nbsp; &nbsp; 0.0.0.0 &gt; all-systems.mcast.net: igmp query v2<br />14:01:11.399757 IP (tos 0xc0, ttl 1, id 0, offset 0, flags [DF], proto IGMP (2), length 32, options (RA))<br />&nbsp; &nbsp; 0.0.0.0 &gt; all-systems.mcast.net: igmp query v2<br />14:03:16.839756 IP (tos 0xc0, ttl 1, id 0, offset 0, flags [DF], proto IGMP (2), length 32, options (RA))<br />&nbsp; &nbsp; 0.0.0.0 &gt; all-systems.mcast.net: igmp query v2<br />14:03:46.307340 EAPOL key (3) v2, len 127<br />14:03:46.808198 EAPOL key (3) v2, len 127<br />14:03:47.809544 EAPOL key (3) v2, len 127<br />14:03:48.315020 5c:c5:d4:3b:1b:55 (oui Unknown) &gt; Broadcast Null Unnumbered, xid, Flags [Response], length 6: 01 00<br />14:03:48.318382 EAPOL key (3) v2, len 95<br />14:03:48.997104 5c:c5:d4:3b:1b:55 (oui Unknown) &gt; Broadcast Null Unnumbered, xid, Flags [Response], length 6: 01 00<br />14:03:48.999671 EAPOL key (3) v2, len 95<br />14:03:49.088878 EAPOL key (3) v1, len 119<br />14:03:49.090515 EAPOL key (3) v2, len 151<br />14:03:49.091985 EAPOL key (3) v1, len 95<br />14:03:49.141487 IP6 (hlim 1, next-header UDP (17) payload length: 92) fe80::8d54:795b:41c5:cff8.dhcpv6-client &gt; ff02::1:2.dhcpv6-server: [udp sum ok] dhcp6 solicit (xid=1e9f2d (elapsed-time 0) (client-ID hwaddr/time type 1 time 475534867 08626653ad4c) (IA_NA IAID:73188820 T1:0 T2:0) (Client-FQDN) (vendor-class) (option-request DNS-search-list DNS-server vendor-specific-info Client-FQDN))<br />14:03:49.141544 IP6 (hlim 1, next-header UDP (17) payload length: 92) fe80::8d54:795b:41c5:cff8.dhcpv6-client &gt; ff02::1:2.dhcpv6-server: [udp sum ok] dhcp6 solicit (xid=1e9f2d (elapsed-time 0) (client-ID hwaddr/time type 1 time 475534867 08626653ad4c) (IA_NA IAID:73188820 T1:0 T2:0) (Client-FQDN) (vendor-class) (option-request DNS-search-list DNS-server vendor-specific-info Client-FQDN))</em></p><br /><p>The tcpdump correspond with the router logs : <br /><em>Mar 31 14:03:48 OpenWrt daemon.info hostapd: wlan1: STA 5c:c5:d4:3b:1b:40 IEEE 802.11: authenticated<br />Mar 31 14:03:48 OpenWrt daemon.info hostapd: wlan1: STA 5c:c5:d4:3b:1b:55 IEEE 802.11: associated (aid 1)<br />Mar 31 14:03:48 OpenWrt daemon.info hostapd: wlan1: STA 5c:c5:d4:3b:1b:55 IEEE 802.11: authenticated<br />Mar 31 14:03:48 OpenWrt daemon.info hostapd: wlan1: STA 5c:c5:d4:3b:1b:55 IEEE 802.11: associated (aid 1)<br />Mar 31 14:03:49 OpenWrt daemon.info hostapd: wlan1: STA 5c:c5:d4:3b:1b:55 WPA: pairwise key handshake completed (RSN)<br />Mar 31 14:03:52 OpenWrt daemon.info dnsmasq-dhcp[1208]: DHCPREQUEST(br-lan) 192.168.237.226 08:62:66:53:ad:4c <br />Mar 31 14:03:52 OpenWrt daemon.info dnsmasq-dhcp[1208]: DHCPACK(br-lan) 192.168.237.226 08:62:66:53:ad:4c ASUS</em></p><p><em>14:03:46.307340 EAPOL key (3) v2, len 127<br />14:03:46.808198 EAPOL key (3) v2, len 127<br />14:03:47.809544 EAPOL key (3) v2, len 127</em> <br />These packets are the first transmitted during the wake up sequence. So they may be the ones that cause this wake up.<br />Do anybody know what they mean?</p><p>Thanks in advance</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p271001">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">tof233</div>
					<div class="post-datetime">
						2 Apr 2015, 16:31					</div>
				</div>
				<div class="post-content content">
					<p>I have found the cause of these insomnias : WPA group rekeying.<br />By default, it is set to every 600s on openWRT. I changed it to 3600 and now my wakes up only after 1hour.<br />So a workaround would be to increase this WPA group rekeying interval. But it also means decreasing security as hackers would have more time to break the generated key before it gets renewed.</p><p>to perform this change I edited the file /lib/wifi/mac80211.sh and added the line &quot;<em>wpa_group_rekey=3600</em>&quot; just under &quot;<em>wmm_enabled=$wmm</em>&quot;.<br />So I know have <br /><em>.....<br />wmm_enabled=$wmm<br />wpa_group_rekey=3600<br />bssid=$macaddr<br />......</em><br />Then I just run the <em>wifi</em> command to apply changes.</p><p>But I am quite confused with this wpa_group_rekey as <a href="http://wiki.openwrt.org/doc/uci/wireless">http://wiki.openwrt.org/doc/uci/wireless</a> indicates it only for WPA Enterprise&nbsp; and not for WPA PSK...</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>