<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> (TL-WR703n / GPIO / Misc) AR9331 pinouts?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 7 Oct 2014 and 7 May 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 5 of 6</div><nav><ul><li><a href="viewtopic.php%3Fid=36471&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=36471&amp;p=3.html">3</a></li><li><a href="viewtopic.php%3Fid=36471&amp;p=4.html">4</a></li><li class="pagination-current"><span>5</span></li><li><a href="viewtopic.php%3Fid=36471&amp;p=6.html">6</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p179226">
				<div class="post-metadata">
					<div class="post-num">Post #101</div>
					<div class="post-author">slboat</div>
					<div class="post-datetime">
						24 Sep 2012, 15:50					</div>
				</div>
				<div class="post-content content">
					<p>but if that make hard to line them out,is any possible to make a usb2gpio small board?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p179228">
				<div class="post-metadata">
					<div class="post-num">Post #102</div>
					<div class="post-author">robthebrew</div>
					<div class="post-datetime">
						24 Sep 2012, 16:57					</div>
				</div>
				<div class="post-content content">
					<p>could do, but I want the flexibility. I will hook the wires up to a female pin header and route that through the case. Then I can experiment on a pin by pin basis. The easy way out would be a I2C expander chip, if that&#039;s what you want. I want to add hacked airwick PIRs etc. Call me cheap, but it is fun! <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p179283">
				<div class="post-metadata">
					<div class="post-num">Post #103</div>
					<div class="post-author">slboat</div>
					<div class="post-datetime">
						25 Sep 2012, 05:19					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>robthebrew wrote:</cite><blockquote><p>could do, but I want the flexibility. I will hook the wires up to a female pin header and route that through the case. Then I can experiment on a pin by pin basis. The easy way out would be a I2C expander chip, if that&#039;s what you want. I want to add hacked airwick PIRs etc. Call me cheap, but it is fun! <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p></blockquote></div><p>fun is enought,keep find out them,find all the hidden bastard.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p180117">
				<div class="post-metadata">
					<div class="post-num">Post #104</div>
					<div class="post-author">Squonk</div>
					<div class="post-datetime">
						6 Oct 2012, 01:26					</div>
				</div>
				<div class="post-content content">
					<p>For those of you that are subscribed to this topic, please also check the topic &quot;<a href="https://forum.openwrt.org/viewtopic.php?pid=180116#p180116">TP-Link TL-WR703N Reverse Engineering</a>&quot;.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p180407">
				<div class="post-metadata">
					<div class="post-num">Post #105</div>
					<div class="post-author">Squonk</div>
					<div class="post-datetime">
						13 Oct 2012, 01:26					</div>
				</div>
				<div class="post-content content">
					<p>... And now the TL-WR703N schematic:<br /><a href="https://forum.openwrt.org/viewtopic.php?pid=180406#p180406">https://forum.openwrt.org/viewtopic.php … 06#p180406</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p192039">
				<div class="post-metadata">
					<div class="post-num">Post #106</div>
					<div class="post-author">lizby</div>
					<div class="post-datetime">
						15 Feb 2013, 03:42					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ve read the whole thread for the second time (and the wiki), and still don&#039;t understand exactly which gpios are available and how to access them.</p><p>For me, with a fairly recent self-build, GPIO8 (USB Power) is working from the command line:</p><p>echo 0 &gt; /sys/class/gpio/gpio8/value<br />echo 1 &gt; /sys/class/gpio/gpio8/value</p><p>Also the blue led, GPIO27<br />echo &quot;1&quot; &gt; /sys/devices/platform/leds-gpio/leds/tp-link:blue:system/brightness<br />echo &quot;0&quot; &gt; /sys/devices/platform/leds-gpio/leds/tp-link:blue:system/brightness</p><p>But writing directly to 27 doesn&#039;t work:<br /> echo 1 &gt; /sys/class/gpio/gpio27/value<br />-ash: can&#039;t create /sys/class/gpio/gpio27/value: nonexistent directory</p><p>And trying to set up 27 doesn&#039;t work:</p><p> echo 27 &gt; /sys/class/gpio/export<br />ash: write error: Device or resource busy</p><p>I have these gpio modules installed; what else do I need?<br /></p><div class="codebox"><pre><code> opkg list_installed | grep gpio
kmod-gpio-button-hotplug - 3.7.2-1
kmod-input-gpio-keys-polled - 3.7.2-1
kmod-leds-gpio - 3.7.2-1</code></pre></div><p>Which gpios not otherwise being used (e.g., for usb power or blue led) are available other than 7 and 29 (and what module do I need to make those and any others available--not specifically for i2c)?</p>											<p class="post-edited">(Last edited by <strong>lizby</strong> on 15 Feb 2013, 03:45)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p192062">
				<div class="post-metadata">
					<div class="post-num">Post #107</div>
					<div class="post-author">robthebrew</div>
					<div class="post-datetime">
						15 Feb 2013, 10:14					</div>
				</div>
				<div class="post-content content">
					<p>27 is in use by the led, which is why you can&#039;t access it directly. Uninstall kmod-leds-gpio to get direct access.<br />The wiki lists the gpios and where they are. 0,6,14,15,29 are all usable.<br />They all have pull-up/down resistors, so you will need to take that into account, or unsolder the resistors.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p192123">
				<div class="post-metadata">
					<div class="post-num">Post #108</div>
					<div class="post-author">lizby</div>
					<div class="post-datetime">
						15 Feb 2013, 19:57					</div>
				</div>
				<div class="post-content content">
					<p>Thanks, Rob, for the list and the confirmation.&nbsp; I had also tried exporting 0, and got the same error message as with 27, and so assumed that I needed some other module.&nbsp; I&#039;ve now tried exporting and setting/resetting 7 and 29, and got no errors. </p><p>I haven&#039;t wired anything up yet, so haven&#039;t tested the actual outputs--but I have confidence now.&nbsp; I&#039;ll be using it for a 6-pin dip relay, LH1156, so keeping the existing pulldown resistors will be fine.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p192829">
				<div class="post-metadata">
					<div class="post-num">Post #109</div>
					<div class="post-author">lizby</div>
					<div class="post-datetime">
						22 Feb 2013, 19:42					</div>
				</div>
				<div class="post-content content">
					<p>Suppose you want to use gpio8 (usb power) to toggle a relay:</p><p>echo 1 &gt; /sys/devices/virtual/gpio/gpio8/value<br />echo 0 &gt; /sys/devices/virtual/gpio/gpio8/value</p><p>How do you prevent gpio8 from being turned on during bootup?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p192831">
				<div class="post-metadata">
					<div class="post-num">Post #110</div>
					<div class="post-author">Squonk</div>
					<div class="post-datetime">
						22 Feb 2013, 21:21					</div>
				</div>
				<div class="post-content content">
					<p>Put a pull-down resistor that will fix the voltage level while the GPIO is in tristate or input mode.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p192832">
				<div class="post-metadata">
					<div class="post-num">Post #111</div>
					<div class="post-author">robthebrew</div>
					<div class="post-datetime">
						22 Feb 2013, 21:32					</div>
				</div>
				<div class="post-content content">
					<p>The thing I did not record was which resistor (there was one on all the gpios I freed) was pull up and which down.<br />Squonk&#039;s schematic should clarify that.<br />I use, I made sure that every peripheral started after the router so as not to get undefined outputs, but just leaving the pulldown might be a better and easier way.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p192849">
				<div class="post-metadata">
					<div class="post-num">Post #112</div>
					<div class="post-author">lizby</div>
					<div class="post-datetime">
						23 Feb 2013, 01:53					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Squonk wrote:</cite><blockquote><p>Put a pull-down resistor that will fix the voltage level while the GPIO is in tristate or input mode.</p></blockquote></div><p>That would still not fix the problem, as I see it, of usb power being turned on sometime during the boot process.&nbsp; I was wondering if anyone knew when and where that was done so that it could be prevented from being turned on.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p192866">
				<div class="post-metadata">
					<div class="post-num">Post #113</div>
					<div class="post-author">Dioptimizer</div>
					<div class="post-datetime">
						23 Feb 2013, 10:29					</div>
				</div>
				<div class="post-content content">
					<p>How to enable control GPIO13-16:<br /><a href="https://forum.openwrt.org/viewtopic.php?pid=175021#p175021">https://forum.openwrt.org/viewtopic.php … 21#p175021</a><br /><a href="https://forum.openwrt.org/viewtopic.php?pid=186723#p186723">https://forum.openwrt.org/viewtopic.php … 23#p186723</a> &lt;=this same as upper url only difference sending RAW command</p><div class="quotebox"><cite>uboot wrote:</cite><blockquote><p>&nbsp; &nbsp; /* Disable clock obs <br />&nbsp; &nbsp; &nbsp;* clk_obs1(gpio13/bit8),&nbsp; clk_obs2(gpio14/bit9), clk_obs3(gpio15/bit10),<br />&nbsp; &nbsp; &nbsp;* clk_obs4(gpio16/bit11), clk_obs5(gpio17/bit12)<br />&nbsp; &nbsp; &nbsp;* clk_obs0(gpio1/bit19), 6(gpio11/bit20)<br />&nbsp; &nbsp; &nbsp;*/</p></blockquote></div><p><em>(from u-boot/board/ar7240/ap121/ap121.c)</em></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p192870">
				<div class="post-metadata">
					<div class="post-num">Post #114</div>
					<div class="post-author">Squonk</div>
					<div class="post-datetime">
						23 Feb 2013, 11:00					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>lizby wrote:</cite><blockquote><div class="quotebox"><cite>Squonk wrote:</cite><blockquote><p>Put a pull-down resistor that will fix the voltage level while the GPIO is in tristate or input mode.</p></blockquote></div><p>That would still not fix the problem, as I see it, of usb power being turned on sometime during the boot process.&nbsp; I was wondering if anyone knew when and where that was done so that it could be prevented from being turned on.</p></blockquote></div><p>I didn&#039;t know that you were speaking of GPIO8 specifically, as you started this thread looking for all available GPIOs.</p><p>In order to remove the automatic USB Power function on GPIO8, you need to edit the file &quot;<a href="https://dev.openwrt.org/browser/trunk/target/linux/ar71xx/files/arch/mips/ath79/mach-tl-wr703n.c?order=name#L75">trunk/target/linux/ar71xx/files/arch/mips/ath79/mach-tl-wr703n.c</a>&quot; and comment out lines 75-77, then recompile OpenWrt.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p192907">
				<div class="post-metadata">
					<div class="post-num">Post #115</div>
					<div class="post-author">lizby</div>
					<div class="post-datetime">
						23 Feb 2013, 16:26					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Squonk wrote:</cite><blockquote><p>In order to remove the automatic USB Power function on GPIO8, you need to edit the file &quot;<a href="https://dev.openwrt.org/browser/trunk/target/linux/ar71xx/files/arch/mips/ath79/mach-tl-wr703n.c?order=name#L75">trunk/target/linux/ar71xx/files/arch/mips/ath79/mach-tl-wr703n.c</a>&quot; and comment out lines 75-77, then recompile OpenWrt.</p></blockquote></div><p>Thank you Squonk.&nbsp; I was hoping there was a rc.d file or similar which could be edited, but commenting out the lines in the C code and recompiling is no big problem.</p>											<p class="post-edited">(Last edited by <strong>lizby</strong> on 23 Feb 2013, 16:26)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p192912">
				<div class="post-metadata">
					<div class="post-num">Post #116</div>
					<div class="post-author">Squonk</div>
					<div class="post-datetime">
						23 Feb 2013, 16:52					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>lizby wrote:</cite><blockquote><div class="quotebox"><cite>Squonk wrote:</cite><blockquote><p>In order to remove the automatic USB Power function on GPIO8, you need to edit the file &quot;<a href="https://dev.openwrt.org/browser/trunk/target/linux/ar71xx/files/arch/mips/ath79/mach-tl-wr703n.c?order=name#L75">trunk/target/linux/ar71xx/files/arch/mips/ath79/mach-tl-wr703n.c</a>&quot; and comment out lines 75-77, then recompile OpenWrt.</p></blockquote></div><p>Thank you Squonk.&nbsp; I was hoping there was a rc.d file or similar which could be edited, but commenting out the lines in the C code and recompiling is no big problem.</p></blockquote></div><p>Unfortunately no, there is no editable config file for that. I hate these hardwired stuff in the board support file... There should be a way to override them without recompiling, I agree.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p192966">
				<div class="post-metadata">
					<div class="post-num">Post #117</div>
					<div class="post-author">.NetRolller 3D</div>
					<div class="post-datetime">
						24 Feb 2013, 01:10					</div>
				</div>
				<div class="post-content content">
					<p>Just found this with a quick Google search.</p><p><a href="http://wenku.baidu.com/view/c130fc186c175f0e7cd137c3.html">http://wenku.baidu.com/view/c130fc186c1 … 137c3.html</a></p><p>This PCB is available @ <a href="http://www.newegg.com/Product/Product.aspx?Item=9SIA1AZ0K09220">http://www.newegg.com/Product/Product.a … 1AZ0K09220</a><br />Same SoC as the WR703n.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p192969">
				<div class="post-metadata">
					<div class="post-num">Post #118</div>
					<div class="post-author">Squonk</div>
					<div class="post-datetime">
						24 Feb 2013, 01:32					</div>
				</div>
				<div class="post-content content">
					<p>Thank you for the link!</p><p>Yes, the TL-WR703N is heavily based on Atheros AP121 reference design, although there are some differences.</p><p>I fully reversed-engineered the board, so the GPIOs are now all well know, please check:<br /><a href="http://squonk42.github.com/TL-WR703N/">http://squonk42.github.com/TL-WR703N/</a></p>											<p class="post-edited">(Last edited by <strong>Squonk</strong> on 24 Feb 2013, 01:32)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p212979">
				<div class="post-metadata">
					<div class="post-num">Post #119</div>
					<div class="post-author">carlojpisani</div>
					<div class="post-datetime">
						22 Sep 2013, 23:38					</div>
				</div>
				<div class="post-content content">
					<p>any news about jtag ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p230760">
				<div class="post-metadata">
					<div class="post-num">Post #120</div>
					<div class="post-author">valentt</div>
					<div class="post-datetime">
						19 Apr 2014, 20:41					</div>
				</div>
				<div class="post-content content">
					<p>Is it possible to convert gpio pins to be second uart via bitbanging? I searched gpio kernel modules and don&#039;t see one for uart bitbanging. Or this is just not possible to do?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p230764">
				<div class="post-metadata">
					<div class="post-num">Post #121</div>
					<div class="post-author">MBS</div>
					<div class="post-datetime">
						19 Apr 2014, 22:11					</div>
				</div>
				<div class="post-content content">
					<p>Maybe a different approach: There are different chips out there to convert SPI or I2C to UART. For example this one already has kernel support: Supported ICs are MAX3107, MAX3108, MAX3109, MAX14830. Each IC contains 128 words each of receive and transmit FIFO that can be controlled through I2C or high-speed SPI.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p230773">
				<div class="post-metadata">
					<div class="post-num">Post #122</div>
					<div class="post-author">valentt</div>
					<div class="post-datetime">
						19 Apr 2014, 23:55					</div>
				</div>
				<div class="post-content content">
					<p>Did anybody got sd card to work via spi pins on ar9331?</p><p>UPDATE: found this tutorial:<br /><a href="http://wiki.openwrt.org/doc/howto/mmc_over_gpio">http://wiki.openwrt.org/doc/howto/mmc_over_gpio</a> has anybody tried this or ar9331? I&#039;ll be using GPIO 20, 21, 22 and 23 for pins...</p>											<p class="post-edited">(Last edited by <strong>valentt</strong> on 20 Apr 2014, 00:06)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p239191">
				<div class="post-metadata">
					<div class="post-num">Post #123</div>
					<div class="post-author">valentt</div>
					<div class="post-datetime">
						3 Jul 2014, 21:23					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>bertc3p0 wrote:</cite><blockquote><div class="quotebox"><cite>robthebrew wrote:</cite><blockquote><p>imperfect, can you elaborate on the SPI contacts? </p><p>love your work btw.</p></blockquote></div><p>IMHO the flash is connected through SPI (MOSI,MISO,CLK,CS0). CS1 is shared with GPIO_0.<br />Should be all you need to connect another SPI device.</p></blockquote></div><p>How can I connect another SPI device?</p><p>If I use same SPI pins for both SPI devices (MOSI, MISO and CLK) then I use CS0 and CS1 to choose SPI device, right?<br />But wouldn&#039;t that crash device? If I disable CS0 and enable CS1, then external SPI flash memory would be used, but internal wouldn&#039;t be available anymore. Wouldn&#039;t that cause issues or even crash OpenWrt?!?</p><p>I&#039;m SPI newbie so need a bit more explanation how to connect extra SPI based flash to AR9331 while letting internal work as usual.</p><p>Thanks!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p239193">
				<div class="post-metadata">
					<div class="post-num">Post #124</div>
					<div class="post-author">valentt</div>
					<div class="post-datetime">
						3 Jul 2014, 21:33					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Squonk wrote:</cite><blockquote><p>The AR9331 has only one single hardware serial port, see <a href="http://wiki.openwrt.org/toh/tp-link/tl-wr703n#ar9331.pinout">http://wiki.openwrt.org/toh/tp-link/tl- … 331.pinout</a> for details.</p><p>Although you cantry to&nbsp; bit-bang an UART in software using simple GPIO pins, it will never be very efficient and you will not be able to get high bitrates either.</p><p>Not counting for accuracy problems with a non real-time multi-tasking kernel that will add up to some 10s of ms of jitter because of random task switching...</p><p>Maybe you can try with an USB&lt;-&gt;UART adapter, it really depends on your needs.</p></blockquote></div><p>Squonk can you please explain how to bit-bang UART via GPIO pins, I can&#039;t find this documented anywhere, so more info is much appreciated. Thanks!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p239214">
				<div class="post-metadata">
					<div class="post-num">Post #125</div>
					<div class="post-author">Squonk</div>
					<div class="post-datetime">
						3 Jul 2014, 23:34					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>valentt wrote:</cite><blockquote><div class="quotebox"><cite>Squonk wrote:</cite><blockquote><p>The AR9331 has only one single hardware serial port, see <a href="http://wiki.openwrt.org/toh/tp-link/tl-wr703n#ar9331.pinout">http://wiki.openwrt.org/toh/tp-link/tl- … 331.pinout</a> for details.</p><p>Although you cantry to&nbsp; bit-bang an UART in software using simple GPIO pins, it will never be very efficient and you will not be able to get high bitrates either.</p><p>Not counting for accuracy problems with a non real-time multi-tasking kernel that will add up to some 10s of ms of jitter because of random task switching...</p><p>Maybe you can try with an USB&lt;-&gt;UART adapter, it really depends on your needs.</p></blockquote></div><p>Squonk can you please explain how to bit-bang UART via GPIO pins, I can&#039;t find this documented anywhere, so more info is much appreciated. Thanks!</p></blockquote></div><p>First, SPI and UART are both serial interfaces, but they are different:<br /></p><ul><li><p>SPI is a <span class="bbu">synchronous</span> interface, meaning that data transitions are related to a clock signal</p></li><li><p>UART is an <span class="bbu">asynchronous</span> interface, meaning that there is no explicit synchronization to a clock, but that data transitions can be retrieved if they don&#039;t fluctuate too much from the nominal data rate, and only for a limited period of time no longer than a single character</p></li></ul><p>This is why an UART does not need a separate clock signal: it is embedded into the data in the form of a start and stop bit that help the receiver to retrieve the data transition timing, while the SPI has a separate clock.</p><p>Having no clock, this in turn explains why the UART doesn&#039;t require any master or slave election, unlike the SPI interface, unless there are more than one device willing to talk on the same signals like on the RS485 bus. In this case, this is the global application design that regulates when slaves are speaking in order to avoid collisions.</p><p>For the SPI, a device acts as a master, and all other are thus slave devices. Addressing is done by the master using a separate &quot;chip select&quot; signal for each slave device.</p><p>The UART uses 2 signals for data, one for transmitting, one for receiving, and of course, you must cross these between 2 devices <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p><p>The SPI uses also 2 signals for data, one for Master Out / Slave In (MOSI) direction, the other for Master In / Slave Out (MISO) direction.</p><p>Both interfaces require to serialize bytes to/from a single wire: this operation which must be performed at the highest possible speed is generally done in hardware using shift registers.</p><p>Back to the AR9331, it has effectively only one simple hardware UART used by the console, and one SPI interface used by the SPI Flash chip, although it also has 2 &quot;chip select&quot; (CS) signals.Unfortunately, the way it is written currently, the SPI Flash driver is not able to share the SPI access among several chips, unless you deeply modify it <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><p>As for the UART, it is rather difficult to avoid both the U-Boot bootloader and the Linux kernel from using it to output some messages, making it very difficult to use for another usage.</p><p>The only possibility left is to perform the serialization/deserialization in software using normal GPIO pins. This method, called &quot;bit-banging&quot; is difficult to implement for an UART, given that the jitter due to task switching in Linux will not allow to have accurate data transitions. It is much easier for the synchronous SPI interface, as you will drive the clock at your pace, even if it is not very regular. But don&#039;t expect the same performances as a hardware shift register, of course!</p><p>A good example of software bit-banging the SPI interface on the AR9331 is in the Arduino Yùn &quot;Bridge&quot; library, which does exactly that to interface to the AVR SPI bus using AR9331 GPIO pins.</p>											<p class="post-edited">(Last edited by <strong>Squonk</strong> on 3 Jul 2014, 23:37)</p>
									</div>
			</article>

			
		
						<div class="notice">
				<p>Sorry, posts 126 to 125 are missing from our archive.</p>
			</div>
		
		
	
	<div class="pagination"><div class="pagination-number">Page 5 of 6</div><nav><ul><li><a href="viewtopic.php%3Fid=36471&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=36471&amp;p=3.html">3</a></li><li><a href="viewtopic.php%3Fid=36471&amp;p=4.html">4</a></li><li class="pagination-current"><span>5</span></li><li><a href="viewtopic.php%3Fid=36471&amp;p=6.html">6</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>