<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> OpenWrt on raspberry pi 3 B+ not detecting physical adapters</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 28 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p373892">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">angrylemon</div>
					<div class="post-datetime">
						16 Mar 2018, 22:07					</div>
				</div>
				<div class="post-content content">
					<p>Hi,<br />I hope i&#039;m not being stupid and this is the right place for this..<br /> I&#039;m having a problem with recognising the network connectors on raspberry pi 3 B+ using OpenWrt snapshot r6449-5862f01.<br />After replacing the start.elf and bootcode.bin files I was able to get openWrt to successfully boot into cli, however ifconfig only reports the &quot;lo&quot; loopback connection. Running dmesg gives me the below errors: <br /></p><div class="codebox"><pre><code>[    7.828202] brcmfmac: brcmf_fw_map_chip_to_name: using brcm/brcmfmac43455-sdio.bin for chip 0x004345(17221) rev 0x000006
[    7.846963] brcmfmac mmc1:0001:1: Direct firmware load for brcm/brcmfmac43455-sdio.bin failed with error -2
[    7.860894] brcmfmac mmc1:0001:1: Falling back to user helper
[    7.879124] firmware brcm!brcmfmac43455-sdio.bin: firmware_loading_store: map pages failed
[   12.871558] usbcore: registered new interface driver brcmfmac
[   12.888676] kmodloader: done loading kernel modules from /etc/modules.d/*
[   13.931289] brcmfmac: brcmf_sdio_htclk: HT Avail timeout (1000000): clkctl 0x50
[   14.951362] brcmfmac: brcmf_sdio_htclk: HT Avail timeout (1000000): clkctl 0x50</code></pre></div><br /><p>I&#039;ve not had any experience with building custom images, and was wondering if there was a simple way to extract the relevant firmware from the newest version of Raspbian and installing these manually in OpenWrt?<br />As I would rather not have to return my new Pi&#039;s and get older models.</p><p>Thanks for reading!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p373903">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">iMiMx</div>
					<div class="post-datetime">
						17 Mar 2018, 11:58					</div>
				</div>
				<div class="post-content content">
					<p>Hi there,</p><p>I&#039;ve ordered one myself, but haven&#039;t found time to play yet - does brcm/brcmfmac43455-sdio.bin exist?&nbsp; Presumably in /lib/firmware?</p><p>If not, perhaps you could find it and put it in there?&nbsp; Fingers crossed it&#039;s that simple!&nbsp; Although I&#039;m doubtful, but then I&#039;m a pessimist. <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p><p>EDIT: Perhaps below?<br />github.com RPi-Distro firmware-nonfree tree/master brcm</p><p>can&#039;t post urls it seems.</p>											<p class="post-edited">(Last edited by <strong>iMiMx</strong> on 17 Mar 2018, 12:10)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p373935">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">arti107</div>
					<div class="post-datetime">
						17 Mar 2018, 21:26					</div>
				</div>
				<div class="post-content content">
					<p>Hi! you need to get this image openwrt-brcm2708-bcm2708-rpi-ext4-sdcard.img, it works for me ... Rpi3 is brcm 2710 as it is 64bit. Flash it to sd card ... it will open at http:// 192.168.1.1</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p373956">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">iMiMx</div>
					<div class="post-datetime">
						18 Mar 2018, 13:07					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>arti107 wrote:</cite><blockquote><p>Hi! you need to get this image openwrt-brcm2708-bcm2708-rpi-ext4-sdcard.img, it works for me</p></blockquote></div><p>3B or the newly released (this week I think) 3B+?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p373973">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">arti107</div>
					<div class="post-datetime">
						18 Mar 2018, 16:50					</div>
				</div>
				<div class="post-content content">
					<p>b. not b + sorry its actually this image&nbsp; lede-17.01.2-brcm2708-bcm2710-rpi-3-ext4-sdcard.img</p>											<p class="post-edited">(Last edited by <strong>arti107</strong> on 18 Mar 2018, 22:57)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p373974">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">arti107</div>
					<div class="post-datetime">
						18 Mar 2018, 16:50					</div>
				</div>
				<div class="post-content content">
					<p><a href="https://downloads.lede-project.org/releases/17.01.2/targets/brcm2708/bcm2710/">https://downloads.lede-project.org/rele â€¦ 8/bcm2710/</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p373995">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">angrylemon</div>
					<div class="post-datetime">
						18 Mar 2018, 20:48					</div>
				</div>
				<div class="post-content content">
					<p>Hi, just to confirm this is the newly released B+ model, the bcm2710 release does boot when using start.elf and bootcode.bin from the latest B+ release of raspbian, but it still doesn&#039;t recognise the physical adapters.</p><p>Edit: I&#039;ve downloaded the firmware-nonfree/tree/master/brcm .bin as suggested above, I then copied this to /tmp/ on the device and ran sysupgrade -F /tmp/*.bin. The PI seemed to upgrade this and then restarted but still getting the same error:<br />Direct firmware load for brcm/brcmfmac43455-sdio.bin failed with error -2</p>											<p class="post-edited">(Last edited by <strong>angrylemon</strong> on 18 Mar 2018, 21:01)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p374043">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">iMiMx</div>
					<div class="post-datetime">
						19 Mar 2018, 14:17					</div>
				</div>
				<div class="post-content content">
					<p>What happens if you put it in /lib/firmware/brcm then restart?</p><p>EDIT: This gets me wlan0, but another UART based error, no eth0/ethernet/lan.</p>											<p class="post-edited">(Last edited by <strong>iMiMx</strong> on 19 Mar 2018, 14:41)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p374064">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">iMiMx</div>
					<div class="post-datetime">
						19 Mar 2018, 18:11					</div>
				</div>
				<div class="post-content content">
					<p>From the spec sheet, guess these are the next things to check/try to resolve/hack support for:</p><p>&quot;4 USB 2.0 ports (via LAN7515)<br />Gigabit Ethernet (via LAN7515, max speed 300Mbps)&quot;</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p374102">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">angrylemon</div>
					<div class="post-datetime">
						20 Mar 2018, 00:46					</div>
				</div>
				<div class="post-content content">
					<p>Hi ImiMx, </p><p>I tried putting the 43455 files into /lib/firmware/brcm/ this seemed to fix the boot errors, I confirmed this by checking the dmesg output, however &quot;iw list&quot; and &quot;iw wlan0&quot; both report no output and still no wireless here, did you do any additional steps? <br />I&#039;m using the lede-17.01.2-brcm2708-bcm2710-rpi-3-ext4-sdcard.img</p><p>Thanks</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p374111">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">iMiMx</div>
					<div class="post-datetime">
						20 Mar 2018, 10:16					</div>
				</div>
				<div class="post-content content">
					<p>I used the latest snapshot release, copied over the files you mentioned to /boot, I think I also copied the &#039;3_B_Plus&#039; DTB file (not researched what this is/was, just seemed like a good idea), from the github repo:</p><p>github.com raspberrypi/firmware/tree/master/boot</p><p>I didn&#039;t check &#039;iw&#039;, just &#039;ifconfig -a&#039; and saw that wlan0 had appeared.&nbsp; I suspect the UART/serial connection error, is the part that would need to be resolved the wireless to be configurable?&nbsp; Might be wildly off track though.</p><br /><p>The version quoted by arti, 17.01.2, is not even the latest stable (17.01.4) release.</p><p> downloads.lede-project.org snapshots/targets/brcm2708/bcm2710/</p><p>EDIT: I did also try building a custom image, with the firmware files overlaid to /lib/firmware/brcm/, along with all the USB option (kmod-usb-net, usbutils) included, nothing fully detected in lsusb -t sadly so no ethernet so far.</p>											<p class="post-edited">(Last edited by <strong>iMiMx</strong> on 20 Mar 2018, 10:19)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p376160">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">IGHOR</div>
					<div class="post-datetime">
						23 Apr 2018, 02:26					</div>
				</div>
				<div class="post-content content">
					<p>Flash snapshots/targets/brcm2708/bcm2710, copy start.elf and bootcode.bin from raspberry github.<br />I did same thing, but I&#039;m getting only rainbow screen on Raspberry Pi 3 B+.<br />Can you please tell maybe you did more steps?</p><div class="quotebox"><cite>iMiMx wrote:</cite><blockquote><p>I used the latest snapshot release, copied over the files you mentioned to /boot, I think I also copied the &#039;3_B_Plus&#039; DTB file (not researched what this is/was, just seemed like a good idea), from the github repo:</p><p>github.com raspberrypi/firmware/tree/master/boot</p><p>I didn&#039;t check &#039;iw&#039;, just &#039;ifconfig -a&#039; and saw that wlan0 had appeared.&nbsp; I suspect the UART/serial connection error, is the part that would need to be resolved the wireless to be configurable?&nbsp; Might be wildly off track though.</p><br /><p>The version quoted by arti, 17.01.2, is not even the latest stable (17.01.4) release.</p><p> downloads.lede-project.org snapshots/targets/brcm2708/bcm2710/</p><p>EDIT: I did also try building a custom image, with the firmware files overlaid to /lib/firmware/brcm/, along with all the USB option (kmod-usb-net, usbutils) included, nothing fully detected in lsusb -t sadly so no ethernet so far.</p></blockquote></div>											<p class="post-edited">(Last edited by <strong>IGHOR</strong> on 23 Apr 2018, 02:27)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p376255">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">pierz</div>
					<div class="post-datetime">
						24 Apr 2018, 12:24					</div>
				</div>
				<div class="post-content content">
					<p>Hi - I&#039;ve built a working image (eth0 &amp; wlan0 support) for the Pi 3B+ by checking out the latest firmware snapshot source code and adding kernel support for the <strong>lan78xx</strong> USB driver to support the Ethernet adapter (via make kernel_menuconfig). To support the WiFi adapter the firmware (brcmfmac43455-sdio.*) needs to be copied from the Raspbian distribution (from/to: /lib/firmware/brcm) - This firmware appears to be different from the one in the OpenWRT tree. To get the system to boot I replaced, in the vfat/msdos partition of the system .img file, start.elf and bootcode.bin from Raspbian as mentioned above. Whilst the Ethernet activity lights don&#039;t come on the adapter does work. The kernel is a 64-bit aarch64 but seems to only recognise one of the 4 CPU cores which is strange. However some folks at ROOter have built an aarch64 kernel that recognises all 4 cores - see: forums.whirlpool.net.au/archive/2689577#r56281400 (I had to remove the HyperText Transport Protocol prefix as I can&#039;t post links)</p><p>I also posted this in the LEDE forum (I wasn&#039;t sure which one to use - maybe they could be joined/merged at some point?) - forum.lede-project.org/t/raspberry-pi-3-b-openwrt-lede-image/13066/13</p>											<p class="post-edited">(Last edited by <strong>pierz</strong> on 24 Apr 2018, 21:32)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>