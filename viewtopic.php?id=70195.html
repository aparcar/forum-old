<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> PEAP-MSCHAPv2 client mode instability</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 24 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p354018">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">mbromio</div>
					<div class="post-datetime">
						12 Mar 2017, 14:17					</div>
				</div>
				<div class="post-content content">
					<p>Dear all,<br />I am posting here a small request related to the use of an OpenWrt device in client mode.<br />In my university, I have an old desktop computer with some softer still running but, unfortunately, he lacks the wi-fi connection.<br />To solve the issue I am using a router with OpenWrt in client mode, connecting to an Eduroam network.<br />Eduroam grounds on a PEAP-MSCHAPv2 authentication approach.</p><p>The trick works perfectly but has some stability issues.<br />Periodically, the router loses the connection with the wi-fi network.<br />Actually, the connection remains, i.e., it is still connected, but it does not have an IP address anymore and, obviously, no possibility to access the internet.</p><p>To solve the issue I need to reconnect the WWAN interface, sometimes a couple of times.<br />Sometimes I also need to change the mac address.</p><p>I would like to have a script that tries to manage these situations, to be sure that the computer does not get offline for long periods.</p><p>I did some investigations and this is the System Log I have:</p><p>Thu Mar&nbsp; 9 13:31:59 2017 daemon.notice netifd: wwan (5271): Sending renew...<br />Thu Mar&nbsp; 9 13:32:02 2017 daemon.notice netifd: wwan (5271): Sending renew...<br />Thu Mar&nbsp; 9 13:32:03 2017 daemon.notice netifd: wwan (5271): Sending renew...<br />Thu Mar&nbsp; 9 13:32:03 2017 daemon.notice netifd: wwan (5271): Lease lost, entering init state<br />Thu Mar&nbsp; 9 13:32:04 2017 daemon.notice netifd: Interface &#039;wwan&#039; has lost the connection<br />Thu Mar&nbsp; 9 13:32:04 2017 daemon.err miniupnpd[2385]: ioctl(s, SIOCGIFADDR, ...): Cannot assign requested address<br />Thu Mar&nbsp; 9 13:32:04 2017 daemon.err miniupnpd[2385]: Failed to get IP for interface wlan0<br />Thu Mar&nbsp; 9 13:32:04 2017 daemon.warn miniupnpd[2385]: SendNATPMPPublicAddressChangeNotification: cannot get public IP address, stopping<br />Thu Mar&nbsp; 9 13:32:04 2017 daemon.info dnsmasq[2014]: reading /tmp/resolv.conf.auto<br />Thu Mar&nbsp; 9 13:32:04 2017 daemon.info dnsmasq[2014]: using local addresses only for domain lan<br />Thu Mar&nbsp; 9 13:32:04 2017 daemon.info dnsmasq[2014]: using nameserver XX.YY.ZZ.101#53<br />Thu Mar&nbsp; 9 13:32:04 2017 daemon.notice netifd: wwan (5271): Sending discover...<br />Thu Mar&nbsp; 9 13:32:04 2017 user.notice mwan3: ifdown interface wwan (unknown)<br />Thu Mar&nbsp; 9 13:32:07 2017 daemon.notice netifd: wwan (5271): Sending discover…</p><br /><p>As it can be observed, the mwan3 is triggered to run the “ifdown” script and, after that moment, the connection is never up again...</p><p>Do you have a suggestions to help me write the proper script?</p><p>Thank you in advance.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>