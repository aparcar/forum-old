<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Asterisk 1.4 compile fail on kamikaze X86</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 3 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p45963">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">dome</div>
					<div class="post-datetime">
						6 Apr 2007, 22:06					</div>
				</div>
				<div class="post-content content">
					<p>Hi All,<br />I try to buid asterisk follow <a href="http://zandbelt.dyndns.org/asterisk.html">http://zandbelt.dyndns.org/asterisk.html</a><br />on kamikaze x86 found message below.&nbsp; how to fix it ?</p><p>Dome C.</p><p>utils.o: In function `ast_atomic_dec_and_test&#039;:<br />/home/oem/devel/asterisk/OpenWrt-SDK-x86-2.6-for-Linux-i686/build_i386/asterisk-1.4.1/include/asterisk/lock.h:741: undefined reference to `__sync_sub_and_fetch_4&#039;<br />utils.o: In function `ast_atomic_fetchadd_int&#039;:<br />/home/oem/devel/asterisk/OpenWrt-SDK-x86-2.6-for-Linux-i686/build_i386/asterisk-1.4.1/include/asterisk/lock.h:707: undefined reference to `__sync_fetch_and_add_4&#039;<br />collect2: ld returned 1 exit status</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p45968">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">zandbelt</div>
					<div class="post-datetime">
						7 Apr 2007, 00:29					</div>
				</div>
				<div class="post-content content">
					<p>Can you provide the config.log output in the build directory for the part where the sync_fetch_and_add check is done?</p><p>Hans.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p45991">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">dome</div>
					<div class="post-datetime">
						7 Apr 2007, 08:27					</div>
				</div>
				<div class="post-content content">
					<p>Hi Hans,<br />not found sync_fetch_and_add <br />oem@dome-desktop:~/devel/asterisk/OpenWrt-SDK-x86-2.6-for-Linux-i686/build_i386/asterisk-1.4.1$ cat config.guess&nbsp; |grep fetch<br />oem@dome-desktop:~/devel/asterisk/OpenWrt-SDK-x86-2.6-for-Linux-i686/build_i386/asterisk-1.4.1$ </p><p>and found some error</p><p>oem@dome-desktop:~/devel/asterisk/OpenWrt-SDK-x86-2.6-for-Linux-i686/build_i386/asterisk-1.4.1$ cat x<br />configure:15358: checking libkern/OSAtomic.h usability<br />configure:15375: i386-linux-uclibc-gcc -c -O2 -pipe -march=i486 -funit-at-a-time -I/home/oem/devel/asterisk/OpenWrt-SDK-x86-2.6-for-Linux-i686/staging_dir_i386/usr/include -I/home/oem/devel/asterisk/OpenWrt-SDK-x86-2.6-for-Linux-i686/staging_dir_i386/include -I/home/oem/devel/asterisk/OpenWrt-SDK-x86-2.6-for-Linux-i686/staging_dir_i386/usr/include/mysql -I/home/oem/devel/asterisk/OpenWrt-SDK-x86-2.6-for-Linux-i686/staging_dir_i386/usr/include/speex -I/home/oem/devel/asterisk/OpenWrt-SDK-x86-2.6-for-Linux-i686/staging_dir_i386/usr/include -I/home/oem/devel/asterisk/OpenWrt-SDK-x86-2.6-for-Linux-i686/staging_dir_i386/include -I/home/oem/devel/asterisk/OpenWrt-SDK-x86-2.6-for-Linux-i686/staging_dir_i386/usr/include -I/home/oem/devel/asterisk/OpenWrt-SDK-x86-2.6-for-Linux-i686/staging_dir_i386/include conftest.c &gt;&amp;5<br />conftest.c:166:30: error: libkern/OSAtomic.h: No such file or directory</p><br /><p>Dome C.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p46019">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">zandbelt</div>
					<div class="post-datetime">
						7 Apr 2007, 16:56					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>dome wrote:</cite><blockquote><p>oem@dome-desktop:~/devel/asterisk/OpenWrt-SDK-x86-2.6-for-Linux-i686/build_i386/asterisk-1.4.1$ cat config.guess&nbsp; |grep fetch</p></blockquote></div><p>Well, I meant the config.log, not the config.guess...<br />Anyway I managed to reproduce the issue and then I was able to fix it.<br /></p><div class="quotebox"><cite>dome wrote:</cite><blockquote><p>conftest.c:166:30: error: libkern/OSAtomic.h: No such file or directory</p></blockquote></div><p>That is not the problem; it&#039;s only relevant on OSX.</p><p>The problem is that the Asterisk main Makefile overrides the &quot;-march&quot; compiler flag setting from the toolchain (i486) by its own (i386).<br />I have produced a patch that removes explicit &quot;-march&quot; setting from the Asterisk Makefile, since the buildroot environment takes care of that.<br />The patch on the packages directory is at: <a href="http://zandbelt.dyndns.org/asterisk/openwrt-packages-asterisk-1.4.2-no_march.patch">http://zandbelt.dyndns.org/asterisk/ope … arch.patch</a> (the implied patch on Asterisk is for 1.4.2, but I guess it will also apply to 1.4.1, or else you can just manually put in the fix).</p><p>I&#039;ll include this one in the 1.4.2 patch that is pending for inclusion in the OpenWRT packages tree.</p><p>Hans.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p49947">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">savoy</div>
					<div class="post-datetime">
						7 Jun 2007, 17:32					</div>
				</div>
				<div class="post-content content">
					<p>Hans,</p><p>Have you by chance built 1.4.4 on the new Kamikaze SDK yet?&nbsp; </p><p>I tried your 1.4.4 on a WRTSL54GS with a fresh Kamikaze install, and it just complains <br />with (aborted)..&nbsp; No debug, out core dump, just aborts.</p><p>I&#039;m testing the 1.2.16 from the kamikaze packages, and it works fine as advertized,<br />but I hoping to stay on 1.4.4 with my move from a HP Celeron based switch..</p><p>Bill</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p49969">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">zandbelt</div>
					<div class="post-datetime">
						7 Jun 2007, 23:14					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>savoy wrote:</cite><blockquote><p>I tried your 1.4.4 on a WRTSL54GS with a fresh Kamikaze install, and it just complains <br />with (aborted)..&nbsp; No debug, out core dump, just aborts.</p></blockquote></div><p>The packages on the ipkg repository I provided so far are meant for whiterussian, which is also indicated in the name of the ipkg entry<br />Now I have also put up Asterisk 1.4.4 mipsel packages for Kamikaze at:</p><p>&nbsp; [ipkg entry] <a href="http://members.home.nl/hans.zandbelt/openwrt/kamikaze/packages/asterisk-1.4/">http://members.home.nl/hans.zandbelt/op … erisk-1.4/</a></p><p>Hans.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p49986">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">savoy</div>
					<div class="post-datetime">
						8 Jun 2007, 00:28					</div>
				</div>
				<div class="post-content content">
					<p>awesome.. Thanks Hans.. I&#039;ll give them a try tonight.&nbsp; &nbsp;</p><p>Bill</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p49988">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">savoy</div>
					<div class="post-datetime">
						8 Jun 2007, 00:43					</div>
				</div>
				<div class="post-content content">
					<p>Installs and starts.&nbsp; Will begin porting configs over.&nbsp; </p><p>Which directory does the voicemail app store the vm tree in?&nbsp; &nbsp;I need to move it to a USB flash filesystem and get it off the core flash..&nbsp; &nbsp;<br />I don&#039;t remember being an option in asterisk.conf to specify the location of the vm tree..</p><p>Bill</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p50012">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">zandbelt</div>
					<div class="post-datetime">
						8 Jun 2007, 09:46					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>savoy wrote:</cite><blockquote><p>Which directory does the voicemail app store the vm tree in?&nbsp; &nbsp;I need to move it to a USB flash filesystem and get it off the core flash..&nbsp; &nbsp;<br />I don&#039;t remember being an option in asterisk.conf to specify the location of the vm tree..</p></blockquote></div><p>Use the config entry:</p><p>&nbsp; &nbsp;astspooldir =&gt; &lt;dir&gt;</p><p>in your asterisk.conf; this is the root path used for the vm storage.</p><p>Hans.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p50724">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">cyberjunk</div>
					<div class="post-datetime">
						18 Jun 2007, 12:25					</div>
				</div>
				<div class="post-content content">
					<p>so I&#039;m a little confused now...</p><p>this packages belong to the mipsel architecture, while the origin topic said &quot;X86&quot;..<br />so is there any way to do the same for the x86 architecture?<br />or did this topic just mean compiling on x86 architecture, not for x86??</p><p>I&#039;m looking for asterisk on Kamikaze x86, but unfortunately I can&#039;t build it...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p50900">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">iam</div>
					<div class="post-datetime">
						20 Jun 2007, 16:18					</div>
				</div>
				<div class="post-content content">
					<p>Hello Hans and other fans of asterisk at OpenWrt!!!</p><p>I&#039;d like to install asterisk 1.4 on ASUS wl-500gp for production environement at my friend&#039;s office.<br />Since Kamikaze hits its first release, what&#039;s the best choice to go with to built internet gateway and micro asterisk server ... Whiterussian or Kamikaze.. ?<br />And which one of releases (Whiterussian or Kamikaze) will be used for future development of asterisk package?</p><p>Sincerely<br />Kirill</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p50937">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">jcgalvez</div>
					<div class="post-datetime">
						21 Jun 2007, 02:25					</div>
				</div>
				<div class="post-content content">
					<p>I am currently running Kamikaze 7.06 with Asterisk 1.2.16 and everything is working very good.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p51445">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">zandbelt</div>
					<div class="post-datetime">
						28 Jun 2007, 21:12					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>cyberjunk wrote:</cite><blockquote><p>this packages belong to the mipsel architecture, while the origin topic said &quot;X86&quot;..<br />so is there any way to do the same for the x86 architecture?<br />or did this topic just mean compiling on x86 architecture, not for x86??</p></blockquote></div><p>ehm, well no it didn&#039;t...</p><div class="quotebox"><cite>cyberjunk wrote:</cite><blockquote><p>I&#039;m looking for asterisk on Kamikaze x86, but unfortunately I can&#039;t build it...</p></blockquote></div><p>I&#039;ve added a repository for that as described at <a href="http://zandbelt.dyndns.org/asterisk.html">http://zandbelt.dyndns.org/asterisk.html</a></p><p>Hans.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p53154">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">Mattik</div>
					<div class="post-datetime">
						31 Jul 2007, 17:18					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>jcgalvez wrote:</cite><blockquote><p>I am currently running Kamikaze 7.06 with Asterisk 1.2.16 and everything is working very good.</p></blockquote></div><p>What Hardware do i need too? (USB to ISDN)<br />Except the ASUS WL500gp.</p>											<p class="post-edited">(Last edited by <strong>Mattik</strong> on 31 Jul 2007, 22:45)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p53695">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">cyberjunk</div>
					<div class="post-datetime">
						10 Aug 2007, 21:32					</div>
				</div>
				<div class="post-content content">
					<p>oeeehm.... correct me please if I&#039;m wrong- just trying to give a small overview:</p><br /><p>Mattik:<br />I think using asterisk with openwrt is still restricted to SIP connections only?<br />(other protocols that use network (tcp,udp,...) for transfering may also work - I&#039;m no expert in VoIP).<br />If you want to use a traditional phone-line or ISDN for example make sure you keep the following in mind:</p><p>1. The kernel needs drivers for your hardware<br />2. Asterisk needs to be able to talk to the hardware (CAPI...)</p><p>So, most 2.6 kernels shipped with full distributions like debian, ubuntu, suse for example contain a lot of ISDN card drivers (FritzCard for example),<br />you can then install a CAPI and use asterisk with chan_capi for example (I&#039;m currently running asterisk 1.4 on debian etch with a passive old PCI fritzcard&nbsp; (using avm capi) and it works fine..)</p><p>The Asus WL-500gP only has USB-ports, so you first have to make sure there are linux drivers for that USB-ISDN hardware, then you probably have to build your own OpenWRT kernel/image after you compiled that drivers for openwrt or create a &quot;kmod...&quot; package for them that others can also use... last but not least you may need a CAPI (I&#039;m using the AVM capi on my debian), which you also have to build for OpenWRT and the asterisk chan_capi support... you may run in a lot of trouble when compiling all this for openwrt, because openwrt uses a different C &quot;base-library&quot; (uclibc) instead of libc that is used on full-distributions... </p><br /><p>as you can see, there is much work to be done and I&#039;m not sure wether it is possible or not at all... may be there are already some USB-ISDN drivers available as packages - anyway, that was the point when I decided to use a debian-etch system instead of openwrt for that....</p><p>oh.. by the way, another solution would be to use PCI-express ISDN cards, which are also available ( expansive <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> ).. but the thing would be quite equal...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p53874">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">Mattik</div>
					<div class="post-datetime">
						14 Aug 2007, 13:29					</div>
				</div>
				<div class="post-content content">
					<p>@cyberjunk</p><p>Thank you for your completely answer.</p><p>Maybe, the better way for CAPI could be to use debian-etch on a notebook.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p54892">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">lschweiss</div>
					<div class="post-datetime">
						31 Aug 2007, 22:03					</div>
				</div>
				<div class="post-content content">
					<p>We really need to get this into Kamikaze trunk.&nbsp; Today, I&#039;m trying to build Asterisk 1.4.9 for brcm-2.6, but the Kamikaze versions of Zandbelt&#039;s builds are only in ipk format.&nbsp; No SDK Makefiles or patches have been published.&nbsp; &nbsp;Looks like I&#039;m stuck doing it from scratch.&nbsp; <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><p>Zandbelt submitted patches over 5 months ago, but they have never been touched.&nbsp; Now they are out of date as he has evolved the Asterisk build from 1.4.2 to 1.4.9.</p><p>It&#039;s really hard to contribute when the sources are controlled by one person.&nbsp; Oh yeah, thats what the GPL intended to prevent.</p>											<p class="post-edited">(Last edited by <strong>lschweiss</strong> on 3 Sep 2007, 16:04)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>