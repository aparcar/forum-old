<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> help needed with MAC/time-based access &amp; /etc/config/firewall</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 1 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p162119">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">SimonHF</div>
					<div class="post-datetime">
						26 Mar 2012, 01:18					</div>
				</div>
				<div class="post-content content">
					<p>I have kids and they have several devices each. I&#039;d like to block access to the WAN via MAC address. I read the following pages:<br /><a href="http://wiki.openwrt.org/doc/uci/firewall">http://wiki.openwrt.org/doc/uci/firewall</a><br /><a href="http://www.kammerath.net/internet-kindersicherung.html">http://www.kammerath.net/internet-kindersicherung.html</a></p><p>I played around with editing /etc/config/firewall and then running the command /etc/init.d/firewall restart. First I tried an experiment for a particular MAC address:</p><p>config rule<br />&nbsp; &nbsp; &nbsp; &nbsp; option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lan<br />&nbsp; &nbsp; &nbsp; &nbsp; option dest&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;wan<br />&nbsp; &nbsp; &nbsp; &nbsp; option src_mac&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 00:1f:f3:52:3f:f1<br />&nbsp; &nbsp; &nbsp; &nbsp; option target&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;REJECT</p><p>It kind of works but there seems to be a lengthy delay of same seconds -- not sure how long -- after /etc/init.d/firewall restart before the rule kicks. Why the delay? Is there another command which will cause the rules to take effect immediately?</p><p>I tried putting the rules at the start of /etc/config/firewall file and at the end. Only putting the rule at the start of the file had any result. Why?</p><p>My plan is to reject everything for a particular MAC and then enable at different times of the day, e.g. with the following additional rules:</p><p>config rule<br />&nbsp; &nbsp; &nbsp; &nbsp; option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lan<br />&nbsp; &nbsp; &nbsp; &nbsp; option dest&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;wan<br />&nbsp; &nbsp; &nbsp; &nbsp; option src_mac&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 00:1f:f3:52:3f:f1<br />&nbsp; &nbsp; &nbsp; &nbsp; option extra&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#039;-m time --weekdays Mon,Tue,Wed,Thu,Fri,Sat,Sun --timestart 14:20 --timestop 14:35&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option target&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ACCEPT</p><p>config rule<br />&nbsp; &nbsp; &nbsp; &nbsp; option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lan<br />&nbsp; &nbsp; &nbsp; &nbsp; option dest&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;wan<br />&nbsp; &nbsp; &nbsp; &nbsp; option src_mac&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 00:1f:f3:52:3f:f1<br />&nbsp; &nbsp; &nbsp; &nbsp; option extra&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#039;-m time --weekdays Mon,Tue,Wed,Thu,Fri,Sat,Sun --timestart 14:40 --timestop 14:45&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option target&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ACCEPT</p><p>The plan and additional rules never seems to work though :-( Is it possible to have accumulative rules like that? Is there a better why to do it? And is there a better way to do it than using the /etc/config/firewall file? Ideally I&#039;d like to allow access per MAC address for several unique time periods each day. Is it better to reject and then have multiple accept rules? Or is it better to have multiple reject rules?&nbsp; Thanks.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>