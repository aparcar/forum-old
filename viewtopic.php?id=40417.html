<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> ATH_USER_REGD not working, txpower still limited</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 18 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p182783">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">seanneko</div>
					<div class="post-datetime">
						9 Nov 2012, 11:26					</div>
				</div>
				<div class="post-content content">
					<p>I have an AWUS036NHA (AR9271 based, ath9k-htc driver). The EEPROM seems to have been set with the region set to GB which is limiting me to 20dBm txpower. The adapter supports up to 27dBm, which is also legal in my country.</p><p>I&#039;ve compiled the latest trunk with ATH_USER_REGD=y, however it doesn&#039;t seem to have had any effect. The GB regulations still seem to apply.</p><p>Output from iw reg get:</p><p>root@openwrt:~# iw reg get<br />country NZ:<br />&nbsp; &nbsp; &nbsp; &nbsp; (2402 - 2482 @ 40), (N/A, 30)<br />&nbsp; &nbsp; &nbsp; &nbsp; (5170 - 5250 @ 20), (3, 23)<br />&nbsp; &nbsp; &nbsp; &nbsp; (5250 - 5330 @ 20), (3, 23), DFS<br />&nbsp; &nbsp; &nbsp; &nbsp; (5735 - 5835 @ 20), (3, 30)<br />root@openwrt:~#</p><p>Trying to change the txpower:</p><p>root@openwrt:~# iwconfig wlan1 txpower 21<br />Error for wireless request &quot;Set Tx Power&quot; (8B26) :<br />&nbsp; &nbsp; SET failed on device wlan1 ; Invalid argument.<br />root@openwrt:~# iwconfig wlan1 txpower 20<br />root@openwrt:~#</p><p>Output from dmesg:</p><p>[&nbsp; &nbsp;33.600000] usbcore: registered new interface driver ath9k_htc<br />[&nbsp; &nbsp;33.630000] usb 1-1: ath9k_htc: Firmware htc_9271.fw requested<br />[&nbsp; &nbsp;33.980000] usb 1-1: ath9k_htc: Transferred FW: htc_9271.fw, size: 51272<br />[&nbsp; &nbsp;34.220000] ath9k_htc 1-1:1.0: ath9k_htc: HTC initialized with 33 credits<br />[&nbsp; &nbsp;34.430000] ath9k_htc 1-1:1.0: ath9k_htc: FW Version: 1.3<br />[&nbsp; &nbsp;34.440000] ath: EEPROM regdomain: 0x833a<br />[&nbsp; &nbsp;34.440000] ath: EEPROM indicates we should expect a country code<br />[&nbsp; &nbsp;34.440000] ath: doing EEPROM country-&gt;regdmn map search<br />[&nbsp; &nbsp;34.440000] ath: country maps to regdmn code: 0x37<br />[&nbsp; &nbsp;34.440000] ath: Country alpha2 being used: GB<br />[&nbsp; &nbsp;34.440000] ath: Regpair used: 0x37<br />[&nbsp; &nbsp;34.440000] ieee80211 phy1: Atheros AR9271 Rev:1<br />[&nbsp; &nbsp;34.450000] cfg80211: Calling CRDA for country: GB<br />[&nbsp; &nbsp;34.450000] cfg80211: Current regulatory domain intersected:<br />[&nbsp; &nbsp;34.460000] cfg80211:&nbsp; &nbsp;(start_freq - end_freq @ bandwidth), (max_antenna_gain, max_eirp)<br />[&nbsp; &nbsp;34.470000] cfg80211:&nbsp; &nbsp;(2402000 KHz - 2472000 KHz @ 40000 KHz), (N/A, 2000 mBm)<br />[&nbsp; &nbsp;34.470000] cfg80211:&nbsp; &nbsp;(5170000 KHz - 5250000 KHz @ 40000 KHz), (N/A, 1700 mBm)<br />[&nbsp; &nbsp;34.480000] cfg80211:&nbsp; &nbsp;(5250000 KHz - 5330000 KHz @ 40000 KHz), (N/A, 2000 mBm)<br />[&nbsp; &nbsp;34.490000] cfg80211:&nbsp; &nbsp;(5490000 KHz - 5600000 KHz @ 40000 KHz), (N/A, 2000 mBm)<br />[&nbsp; &nbsp;34.500000] cfg80211:&nbsp; &nbsp;(5650000 KHz - 5710000 KHz @ 40000 KHz), (N/A, 2000 mBm)<br />[&nbsp; &nbsp;34.510000] Registered led device: ath9k_htc-phy1<br />... other stuff ...<br />[&nbsp; &nbsp;45.050000] cfg80211: Calling CRDA for country: NZ<br />[&nbsp; &nbsp;45.050000] cfg80211: Regulatory domain changed to country: NZ<br />[&nbsp; &nbsp;45.060000] cfg80211:&nbsp; &nbsp;(start_freq - end_freq @ bandwidth), (max_antenna_gain, max_eirp)<br />[&nbsp; &nbsp;45.070000] cfg80211:&nbsp; &nbsp;(2402000 KHz - 2482000 KHz @ 40000 KHz), (N/A, 3000 mBm)<br />[&nbsp; &nbsp;45.070000] cfg80211:&nbsp; &nbsp;(5170000 KHz - 5250000 KHz @ 20000 KHz), (300 mBi, 2300 mBm)<br />[&nbsp; &nbsp;45.080000] cfg80211:&nbsp; &nbsp;(5250000 KHz - 5330000 KHz @ 20000 KHz), (300 mBi, 2300 mBm)<br />[&nbsp; &nbsp;45.090000] cfg80211:&nbsp; &nbsp;(5735000 KHz - 5835000 KHz @ 20000 KHz), (300 mBi, 3000 mBm)</p><p>Does anyone have any suggestions? Why isn&#039;t ATH_USER_REGD letting me change the txpower?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p182785">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">vkins</div>
					<div class="post-datetime">
						9 Nov 2012, 11:45					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m not 100% sure about the regulations and laws in your country but you could set your device to 00 (World); there shouldn&#039;t be any limitations afterwards and you can set the txpower accordingly.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p182786">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">phuque99</div>
					<div class="post-datetime">
						9 Nov 2012, 11:46					</div>
				</div>
				<div class="post-content content">
					<p>You can run &quot;iw phy0 info&quot; to check what&#039;s the max power the hardware can transmit. Being able to break country regulation does not mean you can exceed the hardware tx limit.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p182787">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">seanneko</div>
					<div class="post-datetime">
						9 Nov 2012, 11:49					</div>
				</div>
				<div class="post-content content">
					<p>Hmm, this is the output from iw phy1 info:</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; * 2412 MHz [1] (20.0 dBm)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; * 2417 MHz [2] (20.0 dBm)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; * 2422 MHz [3] (20.0 dBm)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; * 2427 MHz [4] (20.0 dBm)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; * 2432 MHz [5] (20.0 dBm)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; * 2437 MHz [6] (20.0 dBm)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; * 2442 MHz [7] (20.0 dBm)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; * 2447 MHz [8] (20.0 dBm)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; * 2452 MHz [9] (20.0 dBm)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; * 2457 MHz [10] (20.0 dBm)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; * 2462 MHz [11] (20.0 dBm)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; * 2467 MHz [12] (20.0 dBm)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; * 2472 MHz [13] (20.0 dBm)</p><p>So this means that the hardware literally won&#039;t support anything over 20dBm, regardless of regulations? Apparently it&#039;s meant to support up to 27dBm.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p182788">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">seanneko</div>
					<div class="post-datetime">
						9 Nov 2012, 11:55					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>vkins wrote:</cite><blockquote><p>I&#039;m not 100% sure about the regulations and laws in your country but you could set your device to 00 (World); there shouldn&#039;t be any limitations afterwards and you can set the txpower accordingly.</p></blockquote></div><p>How do I do that? I thought that the EEPROM being set to GB was hard-coded and there&#039;s no way I can change it within the device.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p182798">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">vkins</div>
					<div class="post-datetime">
						9 Nov 2012, 13:49					</div>
				</div>
				<div class="post-content content">
					<p>If I&#039;m not mistaken, your choice on the wifi settings page (can&#039;t remember the name, it&#039;s a country code selection) decides which settings are being used.</p><p>I don&#039;t know what your adapter is able to do, though. A quick google search didn&#039;t throw back any useful information. And it&#039;s entirely possible that your adapters maximal power is 20dBm...you would be out of luck, then.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p182813">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">phuque99</div>
					<div class="post-datetime">
						9 Nov 2012, 15:20					</div>
				</div>
				<div class="post-content content">
					<p>20dBm is your hardware max. All radio equipment must adhere to country specific regulation imposed by the telecommunication regulatory folks. If you bought your router in your country, 20dBm is what you&#039;ve been approved to transmit without breaking any laws.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p182857">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">seanneko</div>
					<div class="post-datetime">
						10 Nov 2012, 02:25					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>phuque99 wrote:</cite><blockquote><p>20dBm is your hardware max. All radio equipment must adhere to country specific regulation imposed by the telecommunication regulatory folks. If you bought your router in your country, 20dBm is what you&#039;ve been approved to transmit without breaking any laws.</p></blockquote></div><p>Well, not really. The reason this happens is because the hardware manufacturers (I think Atheros are one of the worst ones) are too cheap/lazy to make a different model for each country. They don&#039;t realise that most of the world is not the US or UK.</p><p>I don&#039;t live in the UK, and I didn&#039;t buy this hardware in the UK. Yet it&#039;s still imposing their laws on me. I can legally transmit more than 20dBm here.</p><p>The specs for the AWUS036NHA are:</p><p>Output Power<br />802.11b&nbsp; &nbsp; 29dBm ±2<br />802.11g&nbsp; &nbsp; 27dBm ±2<br />802.11n&nbsp; &nbsp; 27dBm ±2</p><p>So the adapter should be able to run at a higher txpower.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p333757">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">anarchy99</div>
					<div class="post-datetime">
						9 Aug 2016, 06:34					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>phuque99 wrote:</cite><blockquote><p>20dBm is your hardware max.</p></blockquote></div><p>no it&#039;s not.</p><p>check this thread for more details: <a href="https://forums.kali.org/showthread.php?28874-ALFA-AWUS036NHA-hacking-EEPROM-via-UART-JTAG">https://forums.kali.org/showthread.php? … -UART-JTAG</a></p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>