<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Boot fails on Netgear WGT634U</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 21 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p61917">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">moh_de</div>
					<div class="post-datetime">
						19 Jan 2008, 16:12					</div>
				</div>
				<div class="post-content content">
					<p>Hi,<br />I built some images (latest kamikaze revision) for my WGT634U using kernel 2.6, but when flashed it to the device (by serial connection) it doesn&#039;t work - it seems to fall into an endless reboot-loop.<br />This it what I was able to see with a serial connection:</p><div class="codebox"><pre><code>CFE version 1.0.34 for BCM95365R (32bit,SP,LE)
Build Date: Tue Feb 24 03:21:41 CST 2004 (root@jackylinux)
Copyright (C) 2000,2001,2002 Broadcom Corporation.

Add MAC client version(DNI).
Initializing Arena.
Initializing Devices.
et0: Broadcom BCM47xx 10/100 Mbps Ethernet Controller
CPU type 0x29007: 200MHz
Total memory: 0x2000000 bytes (32MB)

Total memory used by CFE:  0x81BB1280 - 0x82000000 (4517248)
Initialized Data:          0x81BB1280 - 0x81BB3E90 (11280)
BSS Area:                  0x81BB3E90 - 0x81BB45D0 (1856)
Local Heap:                0x81BB45D0 - 0x81FB45D0 (4194304)
Stack Area:                0x81FB45D0 - 0x81FB65D0 (8192)
Text (code) segment:       0x81FB65E0 - 0x81FFFFB0 (301520)
Boot area (physical):      0x01B70000 - 0x01BB0000
Relocation Factor:         I:E23B65E0 - D:01BB0280

configure vlans
*****************************************************************
*********************** VLAN Driver initial  ********************
*****************************************************************
Process LAN port(2-5) vlan Architecture...
SUCCESS: trying to create VLAN 0 for switch
SUCCESS: trying to add LAN port

Process WAN port(2-5) vlan Architecture...
SUCCESS: trying to create VLAN 0 for switch
SUCCESS: trying to add WAN port
SUCCESS: enable ports  success
configure vlans...done
Device eth0:  hwaddr 00-0F-B5-0D-AF-93, ipaddr 192.168.1.1, mask 255.255.255.0
        gateway not set, nameserver not set
Loader:elf Filesys:raw Dev:flash0.os File: Options:(null)
***************************
****  MAC Client V1.0  ****
***************************
et0macaddr value :flag =0 value=00-0f-b5-0d-af-93
et1macaddr value :flag =0 value=00-0f-b5-0d-af-94
MAC exist at least one
system ethernet mac exist and not default....
Skip mac client process.....
Loading: 0x80001000/3740 Entry at 0x80001000
Closing network.
et0: link down
Starting program at 0x80001000
**Exception 8: EPC=804000A4, Cause=0000000C, VAddr=00000D74
                RA=8000112C, PRID=00029007

        0  ($00) = 00000000     AT ($01) = 00000000
        v0 ($02) = B4874448     v1 ($03) = 80400000
        a0 ($04) = 81FB60F8     a1 ($05) = 00000000
        a2 ($06) = 80000010     a3 ($07) = 30524448
        t0 ($08) = 80400000     t1 ($09) = 81FB60F8
        t2 ($10) = 80400000     t3 ($11) = 00000000
        t4 ($12) = 00000000     t5 ($13) = 00000000
        t6 ($14) = 00000000     t7 ($15) = 00000000
        s0 ($16) = 3E992C82     s1 ($17) = 00000010
        s2 ($18) = 00001000     s3 ($19) = 00000010
        s4 ($20) = 00002000     s5 ($21) = 00000100
        s6 ($22) = 80000010     s7 ($23) = 80400000
        t8 ($24) = FFFFFFC8     t9 ($25) = 804005B8
        k0 ($26) = 81FF5630     k1 ($27) = 81FF579C
        gp ($28) = 81BB9280     sp ($29) = 81FB6158
        fp ($30) = FFFF7E4C     ra ($31) = 8000112C



CFE version 1.0.34 for BCM95365R (32bit,SP,LE)
Build Date: Tue Feb 24 03:21:41 CST 2004 (root@jackylinux)
Copyright (C) 2000,2001,2002 Broadcom Corporation.
...</code></pre></div><p>I really don&#039;t know what I&#039;m doing wrong - I tried it with default packages, all packages and individual settings when configuring with &#039;make menuconfig&#039;.</p><p>Any hints, tips, ideas?</p><p>Thanks &amp; regards,<br />moh</p>											<p class="post-edited">(Last edited by <strong>moh_de</strong> on 19 Jan 2008, 16:14)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p61938">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">moh_de</div>
					<div class="post-datetime">
						19 Jan 2008, 22:43					</div>
				</div>
				<div class="post-content content">
					<p>Hmmm....</p><p>The same behaviour when I try to flash the &#039;official&#039; Kamikaze 7.09 image. But AFAIR this worked for me some time ago.<br />Maybe I bricked my WGT?</p><p>Regards,<br />moh</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p61946">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">EvilDevil</div>
					<div class="post-datetime">
						20 Jan 2008, 09:50					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>exactly the same behaviour here. The unit was running fine with Kamikaze 7.09 and i wanted to replace the busybox &#039;mount&#039; with the util-linux &#039;mount&#039;, but somehow symlinked it vice-versa, so the busybox binary got overwritten :-(<br />I wanted to recover that by reflashing Kamikaze 7.09 (using serial + tftp) but it&#039;s the same result as yours (exception, registerdump, rebooting, ...)<br />I tried to load the firmware image into the RAM and execute it from there (using the CFE commands) but still no luck, I also used other offsets to load the firmware to RAM but no luck either. I guess that the RAM is defective.<br />Any other recommendations? Is it possible to erase the content of the Linux flash partition using CFE?</p><p>Regards,<br />Patrick</p>											<p class="post-edited">(Last edited by <strong>EvilDevil</strong> on 20 Jan 2008, 09:51)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p61983">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">EvilDevil</div>
					<div class="post-datetime">
						20 Jan 2008, 21:36					</div>
				</div>
				<div class="post-content content">
					<p>Okay, here&#039;s my serial console output: (I freshly flashed Kamikaze 7.09):<br /></p><div class="codebox"><pre><code>CFE version 1.0.34 for BCM95365R (32bit,SP,LE)
Build Date: Tue Feb 24 03:21:41 CST 2004 (root@jackylinux)
Copyright (C) 2000,2001,2002 Broadcom Corporation.

Add MAC client version(DNI).
Initializing Arena.
Initializing Devices.
et0: Broadcom BCM47xx 10/100 Mbps Ethernet Controller
CPU type 0x29007: 200MHz
Total memory: 0x2000000 bytes (32MB)

Total memory used by CFE:  0x81BB1280 - 0x82000000 (4517248)
Initialized Data:          0x81BB1280 - 0x81BB3E90 (11280)
BSS Area:                  0x81BB3E90 - 0x81BB45D0 (1856)
Local Heap:                0x81BB45D0 - 0x81FB45D0 (4194304)
Stack Area:                0x81FB45D0 - 0x81FB65D0 (8192)
Text (code) segment:       0x81FB65E0 - 0x81FFFFB0 (301520)
Boot area (physical):      0x01B70000 - 0x01BB0000
Relocation Factor:         I:E23B65E0 - D:01BB0280

configure vlans
*****************************************************************
*********************** VLAN Driver initial  ********************
*****************************************************************
Process LAN port(2-5) vlan Architecture...
SUCCESS: trying to create VLAN 0 for switch
SUCCESS: trying to add LAN port

Process WAN port(2-5) vlan Architecture...
SUCCESS: trying to create VLAN 0 for switch
SUCCESS: trying to add WAN port
SUCCESS: enable ports  success
configure vlans...done
Device eth0:  hwaddr 00-0F-B5-0E-65-C7, ipaddr 192.168.2.250, mask 255.255.255.0
        gateway 192.168.2.1, nameserver 192.168.2.1
Loader:elf Filesys:raw Dev:flash0.os File: Options:(null)
***************************
****  MAC Client V1.0  ****
***************************
et0macaddr value :flag =0 value=00-0f-b5-0e-65-c7
et1macaddr value :flag =0 value=00-0f-b5-0e-65-c8
MAC exist at least one
system ethernet mac exist and not default....
Skip mac client process.....
Loading: 0x80001000/3740 Entry at 0x80001000
Closing network.
et0: link down
Starting program at 0x80001000
**Exception 32: EPC=80007F3C, Cause=00000020, VAddr=00000000
                RA=8000112C, PRID=00029007

        0  ($00) = 00000000     AT ($01) = 00000000
        v0 ($02) = 00000FAB     v1 ($03) = 000015DA
        a0 ($04) = 81FB6180     a1 ($05) = 80239480
        a2 ($06) = 802393F0     a3 ($07) = 80300000
        t0 ($08) = 80300000     t1 ($09) = 81FB60F8
        t2 ($10) = 80300000     t3 ($11) = 00000000
        t4 ($12) = 00000000     t5 ($13) = 00000000
        t6 ($14) = 00000000     t7 ($15) = 00000000
        s0 ($16) = 3E992C82     s1 ($17) = 00000010
        s2 ($18) = 00001000     s3 ($19) = 00000010
        s4 ($20) = 00002000     s5 ($21) = 00000100
        s6 ($22) = 81FCE640     s7 ($23) = 81BB7420
        t8 ($24) = FFFFFFC8     t9 ($25) = 803005B8
        k0 ($26) = 001DB85B     k1 ($27) = 81FC73D4
        gp ($28) = 81BB9280     sp ($29) = 81FB61B0
        fp ($30) = FFFF7E4C     ra ($31) = 8000112C



....</code></pre></div><p>After reading through other posts and forums I started to believe that there&#039;s something wrong with CFE. Is it possible to reflash the CFE part of the Flashmemory using CFE? Could someone send me the CFE.bin or post a link to it?</p><p>TIA,</p><p>Regards,<br />Patrick</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p61985">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">moh_de</div>
					<div class="post-datetime">
						20 Jan 2008, 22:17					</div>
				</div>
				<div class="post-content content">
					<p>Hi,<br />I am afraid that the CFE boot loader has been damaged - but no clue how this could happen.<br />Unfortunately the only way to restore the CFE is flashing by JTAG - and the WGT634U AFAIK is not JTAG-capable. Is anyone able to confirm this?</p><p>mfg,<br />moh</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p61988">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">EvilDevil</div>
					<div class="post-datetime">
						20 Jan 2008, 22:32					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>It could still be possible to flash the CFE from CFE<br /></p><div class="codebox"><pre><code>CFE&gt; show devices
Device Name          Description
-------------------  ---------------------------------------------------------
uart0                NS16550 UART at 0x18000300
uart1                NS16550 UART at 0x18000400
flash0.boot          New CFI flash at 1C000000 offset 00000000 size 384KB
flash0.config        New CFI flash at 1C000000 offset 00060000 size 128KB
flash0.os            New CFI flash at 1C000000 offset 00080000 size 7672KB
flash0.nvram         New CFI flash at 1C000000 offset 007FE000 size 8KB
eth0                 BCM4710 Ethernet unit 0 (00-0F-B5-0E-65-C7)
*** command status = 0
CFE&gt; flash -noheader tftp-host:CFE.bin flash0.boot</code></pre></div><p>should do the trick(at least I hope so). Flashing still seems to work fine, so I would give it a try (if I had the matching CFE.bin)...<br />Is it possible to save the content of the Flashmemory to a TFTP-host using the CFE? <br />&quot;save&quot; looks like it can only dump the contents of the DRAM.</p><p>Regards,<br />Patrick</p>											<p class="post-edited">(Last edited by <strong>EvilDevil</strong> on 20 Jan 2008, 22:34)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p61990">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">EvilDevil</div>
					<div class="post-datetime">
						20 Jan 2008, 23:47					</div>
				</div>
				<div class="post-content content">
					<p>Once again...</p><p>I reflashed CFE.bin from another unit and reflashed Kamikaze 7.09 but the problem still persists. <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /><br />It&#039;s a hardware problem <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><p>Regards,<br />Patrick<br />PS: If you want the CFE.bin, just PM me.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p61997">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">EvilDevil</div>
					<div class="post-datetime">
						21 Jan 2008, 01:49					</div>
				</div>
				<div class="post-content content">
					<p>Hmm.. it could still be a OpenWRT problem...<br />I followed the instructions on <a href="http://people.zoy.org/~walken/wgt634u/HOWTO.html">http://people.zoy.org/~walken/wgt634u/HOWTO.html</a> and installed Debian on the WGT and it is booting *??*<br />At least as long it loads the kernel via TFTP from my server.<br />If I want to write the Kernel to /dev/mtd2 using </p><div class="codebox"><pre><code>flashcp /vmlinuz /dev/mtd2</code></pre></div><p>it tells me, that /dev/mtd2 is read-only:<br /></p><div class="codebox"><pre><code>wgt:~# flashcp -v /vmlinuz /dev/mtd2
Erasing blocks: 2/7 (28%)
While erasing blocks 0x00020000-0x00040000 on /dev/mtd2: Read-only file system

wgt:~# dd if=/dev/zero of=/dev/mtd2 bs=128k count=1
1+0 records in
1+0 records out
131072 bytes (131 kB) copied, 0.2156 seconds, 608 kB/s
wgt:~# dd if=/dev/zero of=/dev/mtd2 bs=128k count=2
dd: writing `/dev/mtd2&#039;: Read-only file system
2+0 records in
1+0 records out
131072 bytes (131 kB) copied, 0.146552 seconds, 894 kB/s</code></pre></div><p>Could the Flash be worn out? I can write to the first 128kBytes, but fail to write to the next 128k block.<br />Well, after some more investigation, I did <br /></p><div class="codebox"><pre><code>flash_erase /dev/mtd2
flashcp -v /vmlinuz /dev/mtd2
reboot</code></pre></div><p>and it&#039;s booting the kernel from internal Flash....<br />I&#039;ll stick with debian and live happily ever after... <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p><p>Regards,<br />Patrick</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p61998">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">EvilDevil</div>
					<div class="post-datetime">
						21 Jan 2008, 02:09					</div>
				</div>
				<div class="post-content content">
					<p>Last message so far:</p><p>I don&#039;t know what exactly put the unit back to life, but I gave OpenWrt a last try and flashed it again (CFE and TFTP) and it&#039;s working now.</p><p>Regards,<br />Patrick</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p62015">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">moh_de</div>
					<div class="post-datetime">
						21 Jan 2008, 13:19					</div>
				</div>
				<div class="post-content content">
					<p>@EvilDevil: PM sent.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p62039">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">moh_de</div>
					<div class="post-datetime">
						21 Jan 2008, 23:29					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for the CFE, EvilDevil.</p><p>I tried to reflash it - and after reflashing Kamikaze no more exceptions occured. Booting still fails the WGT just stops.<br />After that I tried flashing a debian (like mentioned above) - but no luck. The kernel boots correctly (by TFTP), but the USB-rootfs doesn&#039;t seem to be recognized:</p><div class="codebox"><pre><code>PCI: Fixing up device 0000:00:00.0
Time: MIPS clocksource has been installed.
NET: Registered protocol family 2
IP route cache hash table entries: 1024 (order: 0, 4096 bytes)
TCP established hash table entries: 1024 (order: 1, 8192 bytes)
TCP bind hash table entries: 1024 (order: 0, 4096 bytes)
TCP: Hash tables configured (established 1024 bind 1024)
TCP reno registered
io scheduler noop registered
io scheduler cfq registered (default)
Serial: 8250/16550 driver $Revision: 1.90 $ 2 ports, IRQ sharing disabled
serial8250: ttyS0 at MMIO 0x0 (irq = 3) is a 16550A
serial8250: ttyS1 at MMIO 0x0 (irq = 3) is a 16550A
b44.c:v1.01 (Jun 16, 2006)
eth0: Broadcom 10/100BaseT Ethernet 00:0f:b5:0d:af:93
flash init: 0x1c000000 0x02000000
Physically mapped flash: Found 1 x16 devices at 0x0 in 16-bit bank
 Intel/Sharp Extended Query Table at 0x0031
Using buffer write method
cfi_cmdset_0001: Erase suspend on write enabled
Flash device: 0x800000 at 0x1fc00000
Creating 4 MTD partitions on &quot;Physically mapped flash&quot;:
0x00000000-0x00060000 : &quot;cfe&quot;
0x00060000-0x00080000 : &quot;config&quot;
0x00080000-0x007e0000 : &quot;os&quot;
0x007e0000-0x00800000 : &quot;nvram&quot;
PCI: Enabling device 0000:00:02.2 (0000 -&gt; 0002)
PCI: Fixing up device 0000:00:02.2
ehci_hcd 0000:00:02.2: EHCI Host Controller
ehci_hcd 0000:00:02.2: new USB bus registered, assigned bus number 1
ehci_hcd 0000:00:02.2: irq 5, io mem 0x40000000
ehci_hcd 0000:00:02.2: USB 2.0 started, EHCI 1.00, driver 10 Dec 2004
usb usb1: configuration #1 chosen from 1 choice
hub 1-0:1.0: USB hub found
hub 1-0:1.0: 2 ports detected
Initializing USB Mass Storage driver...
usbcore: registered new interface driver usb-storage
USB Mass Storage support registered.
TCP cubic registered
NET: Registered protocol family 1
NET: Registered protocol family 17
802.1Q VLAN Support v1.8 Ben Greear &lt;greearb@candelatech.com&gt;
All bugs added by David S. Miller &lt;davem@redhat.com&gt;
Waiting 1sec before mounting root device...
usb 1-1: new high speed USB device using ehci_hcd and address 2
VFS: Cannot open root device &quot;sda1&quot; or unknown-block(0,0)
Please append a correct &quot;root=&quot; boot option; here are the available partitions:
Kernel panic - not syncing: VFS: Unable to mount root fs on unknown-block(0,0)</code></pre></div><p>So no login prompt. Hmpf.<br />I&#039;ll do further investigation tomorrow.</p><p>Regards,<br />moh</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p62054">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">EvilDevil</div>
					<div class="post-datetime">
						22 Jan 2008, 08:16					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>what kind of USB-device did you use for the rootfs? How did you partition it? I used a 512M No-Name USB-Stick, 2 primary partitions (first ext2 rootfs, untared the <a href="http://people.zoy.org/~walken/wgt634u/etch-base.tar.bz2">http://people.zoy.org/~walken/wgt634u/etch-base.tar.bz2</a> to it and changed the configs in /etc as described in the howto, second 12 MB swapspace). I put the Stick directly to the WGT634U&#039;s USB-port (without a hub).</p><p>Hope this helps <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Regards,<br />Patrick</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p62084">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">moh_de</div>
					<div class="post-datetime">
						22 Jan 2008, 20:54					</div>
				</div>
				<div class="post-content content">
					<p>Hi EvilDevil,<br />I also used a no-name 512Mb Stick. Partitioning was done by gparted, I created a 128Mb Swap partition at the end and used the remaining space for an ext2-partition. I followed the instructions mentioned above (extracting etch-base.tar.bz2, changing configs except fstab &lt;- could this be the prob? etc.) and plugged it directly into the router. </p><p>I&#039;ll give it another try afterwards.</p><p>Thanks &amp; regards,<br />moh</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p62086">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">moh_de</div>
					<div class="post-datetime">
						22 Jan 2008, 21:40					</div>
				</div>
				<div class="post-content content">
					<p>Ok,<br />let&#039;s summarize:</p><p>What I&#039;ve done before plugging the stick into the router is this:</p><div class="codebox"><pre><code>&lt;created an ext2 partition &#039;sdb1&#039; with gparted&gt;
cd /mnt
mkdir etch
mount /dev/sdb1 etch
tar xvjpf /home/moh/Downloads/etch-base.tar.bz2
&lt;changed some configuration files in /etc, only network settings&gt;
cd
sync
touch /mnt/etch/var/log/wtmp
umount /mnt/etch
rmdir /mnt/etch
&lt;created a swap partition &#039;sdb2&#039; with gparted&gt;</code></pre></div><p>After switching the router on, it still fails to boot:</p><div class="codebox"><pre><code>PCI: Enabling device 0000:00:02.2 (0000 -&gt; 0002)
PCI: Fixing up device 0000:00:02.2
ehci_hcd 0000:00:02.2: EHCI Host Controller
ehci_hcd 0000:00:02.2: new USB bus registered, assigned bus number 1
ehci_hcd 0000:00:02.2: irq 5, io mem 0x40000000
ehci_hcd 0000:00:02.2: USB 2.0 started, EHCI 1.00, driver 10 Dec 2004
usb usb1: configuration #1 chosen from 1 choice
hub 1-0:1.0: USB hub found
hub 1-0:1.0: 2 ports detected
Initializing USB Mass Storage driver...
usbcore: registered new interface driver usb-storage
USB Mass Storage support registered.
TCP cubic registered
NET: Registered protocol family 1
NET: Registered protocol family 17
802.1Q VLAN Support v1.8 Ben Greear &lt;greearb@candelatech.com&gt;
All bugs added by David S. Miller &lt;davem@redhat.com&gt;
Waiting 1sec before mounting root device...
usb 1-1: new high speed USB device using ehci_hcd and address 2
VFS: Cannot open root device &quot;sda1&quot; or unknown-block(0,0)
Please append a correct &quot;root=&quot; boot option; here are the available partitions:
Kernel panic - not syncing: VFS: Unable to mount root fs on unknown-block(0,0)</code></pre></div><p>It seems that the USB-stick is beeing recognized. Maybe the 1sec wait-period is too *short* - or in other words, I&#039;ve got a sedate stick? :-(</p><p>Regards,<br />moh</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p62111">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">EvilDevil</div>
					<div class="post-datetime">
						23 Jan 2008, 07:58					</div>
				</div>
				<div class="post-content content">
					<p>Hi moh,</p><p>the /etc/fstab can&#039;t be the problem as it gets read later in the boot-process. It looks like your USB-Stick is really too slow as the partition table is usually shown after full detection. You could try to change the kernel commandline using<br /> </p><div class="codebox"><pre><code>setenv -p kernel_args &quot;console=ttyS0,115200 root=/dev/sda1 usb_storage.delay_use=0 rootdelay=6&quot;</code></pre></div><p>This is the original commandline from <a href="http://people.zoy.org/~walken/wgt634u/kernel/config-2.6.22.2">http://people.zoy.org/~walken/wgt634u/k … g-2.6.22.2</a> :<br /></p><div class="quotebox"><blockquote><p>CONFIG_CMDLINE=&quot;console=ttyS0,115200 root=/dev/sda1 usb_storage.delay_use=0 rootdelay=1&quot;</p></blockquote></div><p>I&#039;m not sure if the Debian kernel reads kernel_args, but you could give it a try <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p><p>Anyway, if that does not work, I prepared a patched version of the debian kernel (gunzipped <a href="http://people.zoy.org/~walken/wgt634u/kernel/vmlinuz-2.6.22.2">http://people.zoy.org/~walken/wgt634u/k … z-2.6.22.2</a> , edited the kernel using hexedit (replaced rootdelay=1 with rootdelay=9) and gzipped it again.<br />You can grab it at <a href="http://gauntlet.unixag-zw.fh-kl.de/~pasc0010/wgt/">http://gauntlet.unixag-zw.fh-kl.de/~pasc0010/wgt/</a></p><p>Regards,<br />Patrick</p><p>PS: <br />I just discovered that Michel Lespinasse (the author of the Debian on WGT HowTo) faced a similar problem:<br /><a href="https://lists.one-eyed-alien.net/pipermail/usb-storage/2006-December/002735.html">https://lists.one-eyed-alien.net/piperm … 02735.html</a></p>											<p class="post-edited">(Last edited by <strong>EvilDevil</strong> on 23 Jan 2008, 08:56)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p62152">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">moh_de</div>
					<div class="post-datetime">
						23 Jan 2008, 21:38					</div>
				</div>
				<div class="post-content content">
					<p>Wow, thanks a lot, EvilDevil! Your patched kernel works like a charm:</p><div class="codebox"><pre><code>...
NET: Registered protocol family 1
NET: Registered protocol family 17
802.1Q VLAN Support v1.8 Ben Greear &lt;greearb@candelatech.com&gt;
All bugs added by David S. Miller &lt;davem@redhat.com&gt;
Waiting 9sec before mounting root device...
usb 1-1: new high speed USB device using ehci_hcd and address 2
usb 1-1: configuration #1 chosen from 1 choice
scsi0 : SCSI emulation for USB Mass Storage devices
scsi 0:0:0:0: Direct-Access              USB DRIVE        1.13 PQ: 0 ANSI: 0 CCS
sd 0:0:0:0: [sda] 1014784 512-byte hardware sectors (520 MB)
sd 0:0:0:0: [sda] Write Protect is off
sd 0:0:0:0: [sda] Assuming drive cache: write through
sd 0:0:0:0: [sda] 1014784 512-byte hardware sectors (520 MB)
sd 0:0:0:0: [sda] Write Protect is off
sd 0:0:0:0: [sda] Assuming drive cache: write through
 sda: sda1 sda2
sd 0:0:0:0: [sda] Attached SCSI removable disk
VFS: Mounted root (ext2 filesystem) readonly.
Freeing unused kernel memory: 96k freed
Algorithmics/MIPS FPU Emulator v1.5
INIT: version 2.86 booting
Starting the hotplug events dispatcher: udevdudevd[175]: main: the kernel does not support inotify, udevd can&#039;t monitor configuration file changes
.
Synthesizing the initial hotplug events...done.
Waiting for /dev to be fully populated...done.
Starting boot logger: bootlogd.
Set initial date: Tue Jan 22 19:26:19 UTC 2008.
Activating swap...Adding 128512k swap on /dev/sda2.  Priority:-1 extents:1 across:128512k
done.
Checking root file system...fsck 1.40-WIP (14-Nov-2006)
/dev/sda1: clean, 7645/94376 files, 113860/377496 blocks
done.
Setting the system clock..
Cannot access the Hardware Clock via any known method.
Use the --debug option to see the details of our search for an access method.
Cleaning up ifupdown....
Loading device-mapper support.
Checking file systems...fsck 1.40-WIP (14-Nov-2006)
done.
Setting kernel variables...done.
Mounting local filesystems...done.
Activating swapfile swap...done.
SIOCSIFADDR: No such device
eth0: ERROR while getting interface flags: No such device
SIOCETHTOOL: your ethernet module is either unsupported or outdated: No such device
SIOCGETCPHYRD: No such device
Setting up networking....
Configuring network interfaces...SIOCSIFADDR: No such device
eth0: ERROR while getting interface flags: No such device
SIOCSIFNETMASK: No such device
SIOCSIFBRDADDR: No such device
eth0: ERROR while getting interface flags: No such device
eth0: ERROR while getting interface flags: No such device
Failed to bring up eth0.
done.
Running ntpdate to synchronize clock...done.
INIT: Entering runlevel: 2
Starting system log daemon: syslogd.
Starting kernel log daemon: klogd.
* Not starting internet superserver: no services enabled.
Starting periodic command scheduler: crond.
Stopping boot logger: bootlogd.

Debian GNU/Linux 4.0 mymipsel ttyS0

mymipsel login:</code></pre></div><p>Ok, I&#039;ll continue now. Let&#039;s see if we can reawake Kamikaze on this unit... ;-)</p><p>Thanks &amp; Regards,<br />moh</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p62153">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">moh_de</div>
					<div class="post-datetime">
						23 Jan 2008, 21:48					</div>
				</div>
				<div class="post-content content">
					<p>Ok, next two problems:</p><p>a) eth0 doesn&#039;t come up<br />b) no idea where to find &#039;flashcp&#039; (maybe it&#039;s located in &#039;mtd-tools&#039;?)</p><p>So long,<br />moh</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p62182">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">EvilDevil</div>
					<div class="post-datetime">
						24 Jan 2008, 07:56					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>AFAIR you have to manually bring up eth0 <br /></p><div class="codebox"><pre><code>ifconfig -a</code></pre></div><p>should show it anyway. So, just give it an ip adress in your range:<br /></p><div class="codebox"><pre><code>ifconfig eth0 192.168.x.yy</code></pre></div><p>I&#039;m not sure which port eth0 is mapped to,&nbsp; but you can try to ping a local host on your network which is known to respond to ping and plug the cable in every port until ping is getting responses.<br />Check your DNS- and gateway settings, run apt-get update and apt-get install mtd-tools and you should be ready for flashcp <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Regards,<br />Patrick</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p62213">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">moh_de</div>
					<div class="post-datetime">
						24 Jan 2008, 22:24					</div>
				</div>
				<div class="post-content content">
					<p>Hi,<br />and thanks again EvilDevil. I had to bring up &#039;eth1&#039; instead of &#039;eth0&#039;, now I&#039;ve got full network services.</p><p>After that I tried flashing the kernel, but everytime I get a &#039;readonly file system&#039; error:</p><div class="codebox"><pre><code>mymipsel:~# flashcp /vmlinuz /dev/mtd2
While erasing blocks from 0x00000000-0x000e0000 on /dev/mtd2: Read-only file system
mymipsel:~# flashcp -v /vmlinuz /dev/mtd2
Erasing blocks: 2/7 (28%)
While erasing blocks 0x00020000-0x00040000 on /dev/mtd2: Read-only file system
mymipsel:~# dd if=/dev/zero of=/dev/mtd2 bs=128k count=1
1+0 records in
1+0 records out
131072 bytes (131 kB) copied, 0.251147 seconds, 522 kB/s
mymipsel:~# dd if=/dev/zero of=/dev/mtd2 bs=128k count=2
dd: writing `/dev/mtd2&#039;: Read-only file system
2+0 records in
1+0 records out
131072 bytes (131 kB) copied, 0.146266 seconds, 896 kB/s
mymipsel:~# flash_erase /dev/mtd2
Erase Total 1 Units
Performing Flash Erase of length 131072 at offset 0x0 done
mymipsel:~# flashcp -v /vmlinuz /dev/mtd2
Erasing blocks: 2/7 (28%)
While erasing blocks 0x00020000-0x00040000 on /dev/mtd2: Read-only file system
mymipsel:~#</code></pre></div><p>I just followed your steps above, but no luck. &#039;mtd2&#039; seems to be (partly) readonly. Any idea?</p><p>Thanks &amp; regards,<br />moh</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p62214">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">EvilDevil</div>
					<div class="post-datetime">
						24 Jan 2008, 22:37					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><div class="quotebox"><blockquote><p>mymipsel:~# flash_erase /dev/mtd2<br />Erase Total 1 Units<br />Performing Flash Erase of length 131072 at offset 0x0 done</p></blockquote></div><p>Strange thing is that it erases only 128kByte. I&#039;m not sure if I had the same results.<br />Could you post the output of flash_info /dev/mtd*&nbsp; &nbsp;? Or mtd_debug info /dev/mtd*</p><p>Regards,<br />Patrick</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p62215">
				<div class="post-metadata">
					<div class="post-num">Post #21</div>
					<div class="post-author">moh_de</div>
					<div class="post-datetime">
						24 Jan 2008, 22:40					</div>
				</div>
				<div class="post-content content">
					<p>Yep:</p><div class="codebox"><pre><code>mymipsel:~# mtd_debug info /dev/mtd4
open(): No such file or directory
mymipsel:~# flash_info /dev/mtd0
Device /dev/mtd0 has 0 erase regions
mymipsel:~# flash_info /dev/mtd1
Device /dev/mtd1 has 0 erase regions
mymipsel:~# flash_info /dev/mtd2
Device /dev/mtd2 has 0 erase regions
mymipsel:~# flash_info /dev/mtd3
Device /dev/mtd3 has 0 erase regions

mymipsel:~# mtd_debug info /dev/mtd0
mtd.type = MTD_NORFLASH
mtd.flags = MTD_BIT_WRITEABLE
mtd.size = 393216 (384K)
mtd.erasesize = 131072 (128K)
mtd.writesize = 1
mtd.oobsize = 0
mtd.ecctype = (unknown ECC type - new MTD API maybe?)
regions = 0

mymipsel:~# mtd_debug info /dev/mtd1
mtd.type = MTD_NORFLASH
mtd.flags = MTD_CAP_NORFLASH
mtd.size = 131072 (128K)
mtd.erasesize = 131072 (128K)
mtd.writesize = 1
mtd.oobsize = 0
mtd.ecctype = (unknown ECC type - new MTD API maybe?)
regions = 0

mymipsel:~# mtd_debug info /dev/mtd2
mtd.type = MTD_NORFLASH
mtd.flags = MTD_CAP_NORFLASH
mtd.size = 7733248 (7M)
mtd.erasesize = 131072 (128K)
mtd.writesize = 1
mtd.oobsize = 0
mtd.ecctype = (unknown ECC type - new MTD API maybe?)
regions = 0

mymipsel:~# mtd_debug info /dev/mtd3
mtd.type = MTD_NORFLASH
mtd.flags = MTD_CAP_NORFLASH
mtd.size = 131072 (128K)
mtd.erasesize = 131072 (128K)
mtd.writesize = 1
mtd.oobsize = 0
mtd.ecctype = (unknown ECC type - new MTD API maybe?)
regions = 0</code></pre></div><p>Regards,<br />moh</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p62217">
				<div class="post-metadata">
					<div class="post-num">Post #22</div>
					<div class="post-author">EvilDevil</div>
					<div class="post-datetime">
						24 Jan 2008, 22:55					</div>
				</div>
				<div class="post-content content">
					<p>Hmm.. I just was looking and poking around in some man-pages and online-documentation:<br /><a href="http://www.linux-mtd.infradead.org">http://www.linux-mtd.infradead.org</a><br />Some things that might be of use:<br />flash_unlock /dev/mtd2<br />flash_erase -j /dev/mtd2</p><p>Regards,<br />Patrick</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p62218">
				<div class="post-metadata">
					<div class="post-num">Post #23</div>
					<div class="post-author">moh_de</div>
					<div class="post-datetime">
						24 Jan 2008, 22:59					</div>
				</div>
				<div class="post-content content">
					<p>:-(</p><div class="codebox"><pre><code>mymipsel:~# flash_unlock /dev/mtd2
Physically mapped flash: block unlock error: (status timeout)
Could not unlock MTD device: /dev/mtd2

mymipsel:~# flash_erase -j /dev/mtd2
File open error</code></pre></div><p>Regards,<br />moh</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p62219">
				<div class="post-metadata">
					<div class="post-num">Post #24</div>
					<div class="post-author">moh_de</div>
					<div class="post-datetime">
						24 Jan 2008, 23:05					</div>
				</div>
				<div class="post-content content">
					<p>flash_eraseall -j /dev/mtd2 ?</p><p>testing...</p><p>&lt;edit&gt;</p><p>&nbsp; Yeeehaaa! <br /></p><div class="codebox"><pre><code>mymipsel:~# flash_eraseall -j /dev/mtd2
Erasing 128 Kibyte @ 740000 -- 98 % complete. Cleanmarker written at 740000.
mymipsel:~# flash-vmlinuz -v
Erasing blocks: 7/7 (100%)
Writing data: 878k/878k (100%)
Verifying data: 878k/878k (100%)
mymipsel:~#</code></pre></div><p>&lt;/edit&gt;</p>											<p class="post-edited">(Last edited by <strong>moh_de</strong> on 24 Jan 2008, 23:07)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p62247">
				<div class="post-metadata">
					<div class="post-num">Post #25</div>
					<div class="post-author">EvilDevil</div>
					<div class="post-datetime">
						25 Jan 2008, 15:12					</div>
				</div>
				<div class="post-content content">
					<p>Congratulations, this looks *quite* good <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> <br />Happy OpenWrt-ing <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p><p>Regards,<br />Patrick</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>