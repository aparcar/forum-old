<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> [SOLVED] Kernel Warning in Syslog</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 25 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p345239">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">sharbich</div>
					<div class="post-datetime">
						29 Nov 2016, 21:38					</div>
				</div>
				<div class="post-content content">
					<p>Hi all,<br />I see in the syslog the following warning:<br /></p><div class="codebox"><pre><code>Tue Nov 29 18:48:16 2016 kern.warn kernel: [ 6566.062858] WARNING: CPU: 0 PID: 3775 at net/netfilter/nf_conntrack_rtcache.c:199 0xffffffffa03cd365()
Tue Nov 29 18:48:16 2016 kern.warn kernel: [ 6566.072192] Modules linked in: pppoe ppp_async iptable_nat ath9k pppox ppp_generic nf_nat_ipv4 nf_conntrack_ipv6 nf_conntrack_ipv4 iwlmvm iwldvm ipt_REJECT ipt_MASQUERADE ath9k_htc ath9k_common xt_time xt_tcpudp xt_tcpmss xt_statistic xt_state xt_recent xt_nat xt_multiport xt_mark xt_mac xt_limit xt_length xt_id xt_hl xt_helper xt_ecn xt_dscp xt_conntrack xt_connmark xt_connlimit xt_connbytes xt_comment xt_TCPMSS xt_REDIRECT xt_LOG xt_HL xt_DSCP xt_CT xt_CLASSITue Nov 29 18:48:16 2016 kern.warn kernel: [ 6566.183335] CPU: 0 PID: 3775 Comm: mcproxy Tainted: G        W       4.4.14 #21
Tue Nov 29 18:48:16 2016 kern.warn kernel: [ 6566.190655] Hardware name: PC Engines APU/APU, BIOS 4.0 07/08/2014
Tue Nov 29 18:48:16 2016 kern.warn kernel: [ 6566.196843]  0000000000000000 ffffffff811faab2 0000000000000000 ffffffffa03cd520
Tue Nov 29 18:48:16 2016 kern.warn kernel: [ 6566.204355]  ffffffff810452b8 ffff8800d90c7c40 0000000000000002 ffff8800d8d01f00
Tue Nov 29 18:48:16 2016 kern.warn kernel: [ 6566.211867]  ffffffff81689298 ffff8800d93e9000 ffffffffa03cd365 ffff8800d90c7c40
Tue Nov 29 18:48:16 2016 kern.warn kernel: [ 6566.219381] Call Trace:
Tue Nov 29 18:48:16 2016 kern.warn kernel: [ 6566.221850]  [&lt;ffffffff811faab2&gt;] ? dump_stack+0x5c/0x7a
Tue Nov 29 18:48:16 2016 kern.warn kernel: [ 6566.227180]  [&lt;ffffffff810452b8&gt;] ? warn_slowpath_common+0x78/0xb0
Tue Nov 29 18:48:16 2016 kern.warn kernel: [ 6566.233376]  [&lt;ffffffffa03cd365&gt;] ? 0xffffffffa03cd365
Tue Nov 29 18:48:16 2016 kern.warn kernel: [ 6566.238532]  [&lt;ffffffff813c03a4&gt;] ? nf_iterate+0x54/0x60
Tue Nov 29 18:48:16 2016 kern.warn kernel: [ 6566.243852]  [&lt;ffffffff813c0408&gt;] ? nf_hook_slow+0x58/0xb0
Tue Nov 29 18:48:16 2016 kern.warn kernel: [ 6566.249348]  [&lt;ffffffff81407178&gt;] ? ipmr_queue_xmit.isra.4.constprop.13+0x248/0x4e0
Tue Nov 29 18:48:16 2016 kern.warn kernel: [ 6566.257015]  [&lt;ffffffff81405530&gt;] ? ipmr_cache_find_any+0xa0/0xa0
Tue Nov 29 18:48:16 2016 kern.warn kernel: [ 6566.263119]  [&lt;ffffffff81407d11&gt;] ? ip_mroute_setsockopt+0x631/0x6c0
Tue Nov 29 18:48:16 2016 kern.warn kernel: [ 6566.269481]  [&lt;ffffffff813cc88a&gt;] ? do_ip_setsockopt.isra.4+0xaa/0xd10
Tue Nov 29 18:48:16 2016 kern.warn kernel: [ 6566.276022]  [&lt;ffffffff81383e1d&gt;] ? skb_dequeue+0x4d/0x60
Tue Nov 29 18:48:16 2016 kern.warn kernel: [ 6566.281431]  [&lt;ffffffff813875d6&gt;] ? skb_queue_purge+0x16/0x20
Tue Nov 29 18:48:16 2016 kern.warn kernel: [ 6566.287187]  [&lt;ffffffff8112bbff&gt;] ? __inode_wait_for_writeback+0x5f/0xa0
Tue Nov 29 18:48:16 2016 kern.warn kernel: [ 6566.293902]  [&lt;ffffffff81073dd0&gt;] ? autoremove_wake_function+0x30/0x30
Tue Nov 29 18:48:16 2016 kern.warn kernel: [ 6566.300446]  [&lt;ffffffff8111a61f&gt;] ? __dentry_kill+0x12f/0x1d0
Tue Nov 29 18:48:16 2016 kern.warn kernel: [ 6566.306210]  [&lt;ffffffff813cd512&gt;] ? ip_setsockopt+0x22/0x90
Tue Nov 29 18:48:16 2016 kern.warn kernel: [ 6566.311799]  [&lt;ffffffff8137fd57&gt;] ? SyS_setsockopt+0x57/0xb0
Tue Nov 29 18:48:16 2016 kern.warn kernel: [ 6566.317476]  [&lt;ffffffff8146446e&gt;] ? entry_SYSCALL_64_fastpath+0x12/0x71
Tue Nov 29 18:48:16 2016 kern.warn kernel: [ 6566.324188] ---[ end trace 2d82855c338f9458 ]---
Tue Nov 29 18:48:16 2016 kern.warn kernel: [ 6566.328865] ------------[ cut here ]------------</code></pre></div><p>Firmware Version installed: </p><div class="codebox"><pre><code>OpenWrt Designated Driver 49871 / LuCI Master (git-16.211.48508-f9e5d11) </code></pre></div><p>Kernel-Version: </p><div class="codebox"><pre><code>4.4.14</code></pre></div><p>Is the warning message critical?</p><p>Kind regards, Stefan Harbich</p>											<p class="post-edited">(Last edited by <strong>sharbich</strong> on 20 Dec 2016, 01:27)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p345308">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">dl12345</div>
					<div class="post-datetime">
						30 Nov 2016, 14:51					</div>
				</div>
				<div class="post-content content">
					<p>Glancing at the code, I don&#039;t think it is critical. It&#039;s a warning message produced by the WARN_ON macro in the following code</p><div class="codebox"><pre><code>static unsigned int nf_rtcache_forward(u_int8_t pf,
                       struct sk_buff *skb,
                       const struct nf_hook_state *state)
{
    struct nf_conn_rtcache *rtc;
    enum ip_conntrack_info ctinfo;
    enum ip_conntrack_dir dir;
    struct nf_conn *ct;
    struct dst_entry *dst = skb_dst(skb);
    int iif;

    ct = nf_ct_get(skb, &amp;ctinfo);
    if (!ct)
        return NF_ACCEPT;

    if (dst &amp;&amp; dst_xfrm(dst))
        return NF_ACCEPT;

    if (!nf_ct_is_confirmed(ct)) {
        if (WARN_ON(nf_ct_rtcache_find(ct)))
            return NF_ACCEPT;
        nf_ct_rtcache_ext_add(ct);
        return NF_ACCEPT;
    }

    rtc = nf_ct_rtcache_find_usable(ct);
    if (!rtc)
        return NF_ACCEPT;

    dir = CTINFO2DIR(ctinfo);
    iif = nf_conn_rtcache_iif_get(rtc, dir);
    pr_debug(&quot;ct %p, skb %p, dir %d, iif %d, cached iif %d\n&quot;,
         ct, skb, dir, iif, state-&gt;in-&gt;ifindex);
    if (likely(state-&gt;in-&gt;ifindex == iif))
        return NF_ACCEPT;

    nf_conn_rtcache_dst_set(pf, rtc, skb_dst(skb), dir, state-&gt;in-&gt;ifindex);
    return NF_ACCEPT;
}


static inline
struct nf_conn_rtcache *nf_ct_rtcache_find(const struct nf_conn *ct)
{
#if IS_ENABLED(CONFIG_NF_CONNTRACK_RTCACHE)
    return nf_ct_ext_find(ct, NF_CT_EXT_RTCACHE);
#else
    return NULL;
#endif
}</code></pre></div><p>This code is added by the following patch: <a href="https://dev.openwrt.org/browser/trunk/target/linux/generic/patches-4.0/050-backport_netfilter_rtcache.patch?rev=44514">https://dev.openwrt.org/browser/trunk/t â€¦ ?rev=44514</a></p><p>The kernel isn&#039;t finding a cached route entry in the internal hash table and will just consult the FIB instead. The code caches routing information for each conntrack connection that is being forwarded to avoid having to do constant FIB lookups.</p><p>I note that you have nf_conntrack modules loaded but don&#039;t have the module nf_conntrack_rtcache.ko loaded, which would cause this.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p345341">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">sharbich</div>
					<div class="post-datetime">
						30 Nov 2016, 21:39					</div>
				</div>
				<div class="post-content content">
					<p>Hi dl12345,<br />however, an excerpt from lsmod shows the following message:<br /></p><div class="codebox"><pre><code>nf_conntrack           53961 14 nf_nat_ipv4,nf_conntrack_ipv6,nf_conntrack_ipv4,xt_state,xt_helper,xt_conntrack,xt_connmark,xt_connlimit,xt_connbytes,xt_CT,nf_nat_masquerade_ipv4,nf_nat,nf_conntrack_rtcache,act_connmark</code></pre></div><p>If I try to load the module I get the following error message:<br /></p><div class="codebox"><pre><code>insmod nf_conntrack_rtcache
module is already loaded - nf_conntrack_rtcache</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p345707">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">dl12345</div>
					<div class="post-datetime">
						4 Dec 2016, 18:44					</div>
				</div>
				<div class="post-content content">
					<p>Still don&#039;t think it&#039;s a serious problem....</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p345726">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">sharbich</div>
					<div class="post-datetime">
						4 Dec 2016, 22:17					</div>
				</div>
				<div class="post-content content">
					<p>Where do I have to look for the problem?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p345771">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">dl12345</div>
					<div class="post-datetime">
						5 Dec 2016, 12:59					</div>
				</div>
				<div class="post-content content">
					<p>I already explained what the problem is in my initial reply to your question</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p345830">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">sharbich</div>
					<div class="post-datetime">
						5 Dec 2016, 23:59					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>dl12345 wrote:</cite><blockquote><p>I already explained what the problem is in my initial reply to your question</p></blockquote></div><p>In my second Post you can see the Modul &quot;nf_conntrack_rtcache&quot; is loaded. <br />This does not seem to be the problem. Any Idea?</p>											<p class="post-edited">(Last edited by <strong>sharbich</strong> on 6 Dec 2016, 00:00)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p345838">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">dl12345</div>
					<div class="post-datetime">
						6 Dec 2016, 01:29					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>dl12345 wrote:</cite><blockquote><p>The kernel isn&#039;t finding a cached route entry in the internal hash table and will just consult the FIB instead. The code caches routing information for each conntrack connection that is being forwarded to avoid having to do constant FIB lookups.</p></blockquote></div><p>It&#039;s just a warning. Ignore it</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>