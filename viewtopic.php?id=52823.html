<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Help compile openwrt support 16MB flash for Dlink DIR 615 E4</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 7 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p247469">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">hoatienii</div>
					<div class="post-datetime">
						19 Sep 2014, 10:44					</div>
				</div>
				<div class="post-content content">
					<p>Please help me compile u-boot support 16MB flash for Dlink DIR 615 E4<br />I find DIR 615 E4 orginal source form here . <a href="https://www.dropbox.com/s/qu8gcm2uoq2lbau/DIR615E4_GPL512.tar.gz">https://www.dropbox.com/s/qu8gcm2uoq2lb … 512.tar.gz</a><br />Toolchain: <a href="https://www.dropbox.com/s/qsy5om9jj8mq278/DIR-615E4-toolchain.bz">https://www.dropbox.com/s/qsy5om9jj8mq2 … olchain.bz</a><br /><a href="http://texnikk.blogspot.com/2014/02/dir-615-e4-16m-flash-64m-ram-usb-mod.html">http://texnikk.blogspot.com/2014/02/dir … b-mod.html</a></p><p>Thanks in advance</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p247637">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">hoatienii</div>
					<div class="post-datetime">
						21 Sep 2014, 07:35					</div>
				</div>
				<div class="post-content content">
					<p>Help me please</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p247666">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">rambler</div>
					<div class="post-datetime">
						21 Sep 2014, 15:02					</div>
				</div>
				<div class="post-content content">
					<p>Why do you think you need custom u-boot? Normally, OpenWRT supports 16M flash out of the box. Have you tried it?</p><p>U-boot, however, will probably only &quot;see&quot; the default 4MB, so if you want to be able to write over 4MB <em>with u-boot</em>, then you need to modify it. But that should not be necessary to run OpenWRT.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p247688">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">hoatienii</div>
					<div class="post-datetime">
						21 Sep 2014, 20:10					</div>
				</div>
				<div class="post-content content">
					<p>I use flash programmer ch341a, i back up full 4MB flash, then i put in to 16MB, i type command df -h, it show not enough 16MB. Could you help me</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p247691">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">rambler</div>
					<div class="post-datetime">
						21 Sep 2014, 20:51					</div>
				</div>
				<div class="post-content content">
					<p>As far as I understand, you had OpenWRT on the 4M flash, you copied that flash contents to the beginning of the 16M flash, and soldered it in. Not ideal, but could work in the end. I hope you have the 4M flash backup somewhere, you need the ART partition (your router is Atheros, right?)</p><p>Would you post the output of<br />&nbsp; &nbsp; df -h<br />&nbsp; &nbsp; cat /proc/mtd<br />&nbsp; &nbsp; dmesg | grep &quot;0x00&quot;<br />or perhaps<br />&nbsp; &nbsp; dmesg | grep &quot;\&quot;&quot;</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p247716">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">hoatienii</div>
					<div class="post-datetime">
						22 Sep 2014, 04:31					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>rambler wrote:</cite><blockquote><p>As far as I understand, you had OpenWRT on the 4M flash, you copied that flash contents to the beginning of the 16M flash, and soldered it in. Not ideal, but could work in the end. I hope you have the 4M flash backup somewhere, you need the ART partition (your router is Atheros, right?)</p><p>Would you post the output of<br />&nbsp; &nbsp; df -h<br />&nbsp; &nbsp; cat /proc/mtd<br />&nbsp; &nbsp; dmesg | grep &quot;0x00&quot;<br />or perhaps<br />&nbsp; &nbsp; dmesg | grep &quot;\&quot;&quot;</p></blockquote></div><p>Thank you very much your answer. Yes, my router is atheros. I will post output on tuesday.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p247814">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">hoatienii</div>
					<div class="post-datetime">
						23 Sep 2014, 06:29					</div>
				</div>
				<div class="post-content content">
					<p>Hi rambler!<br />Output:<br /></p><div class="codebox"><pre><code>root@(none):/# df -h
Filesystem                Size      Used Available Use% Mounted on
rootfs                    2.3M      2.3M         0 100% /
/dev/root                 2.3M      2.3M         0 100% /
tmpfs                    14.3M     12.0K     14.3M   0% /tmp
tmpfs                   512.0K         0    512.0K   0% /dev
root@(none):/# cat /proc/mtd
dev:    size   erasesize  name
mtd0: 00030000 00010000 &quot;u-boot&quot;
mtd1: 00010000 00010000 &quot;nvram&quot;
mtd2: 000f0000 00010000 &quot;kernel&quot;
mtd3: 002b0000 00010000 &quot;rootfs&quot;
mtd4: 00090000 00010000 &quot;rootfs_data&quot;
mtd5: 00010000 00010000 &quot;mac&quot;
mtd6: 00010000 00010000 &quot;art&quot;
mtd7: 003a0000 00010000 &quot;firmware&quot;
root@(none):/# dmesg | grep &quot;0x00&quot;
[    0.000000]   Normal   0x00000000 -&gt; 0x00002000
[    0.000000]     0: 0x00000000 -&gt; 0x00002000
[    1.550000] pci_bus 0000:00: root bus resource [io  0x0000]
[    1.550000] pci 0000:00:00.0: [168c:002e] type 0 class 0x000280
[    1.560000] pci 0000:00:00.0: reg 10: [mem 0x00000000-0x0000ffff 64bit]
[    1.740000] 0x000000000000-0x000000030000 : &quot;u-boot&quot;
[    1.750000] 0x000000030000-0x000000040000 : &quot;nvram&quot;
[    1.750000] 0x000000040000-0x000000130000 : &quot;kernel&quot;
[    1.760000] 0x000000130000-0x0000003e0000 : &quot;rootfs&quot;
[    1.780000] 0x000000350000-0x0000003e0000 : &quot;rootfs_data&quot;
[    1.790000] 0x0000003e0000-0x0000003f0000 : &quot;mac&quot;
[    1.790000] 0x0000003f0000-0x000000400000 : &quot;art&quot;
[    1.800000] 0x000000040000-0x0000003e0000 : &quot;firmware&quot;
root@(none):/# dmesg | grep &quot;\&quot;&quot;
[    1.730000] Creating 7 MTD partitions on &quot;spi0.0&quot;:
[    1.740000] 0x000000000000-0x000000030000 : &quot;u-boot&quot;
[    1.750000] 0x000000030000-0x000000040000 : &quot;nvram&quot;
[    1.750000] 0x000000040000-0x000000130000 : &quot;kernel&quot;
[    1.760000] 0x000000130000-0x0000003e0000 : &quot;rootfs&quot;
[    1.770000] mtd: partition &quot;rootfs&quot; set to be root filesystem
[    1.770000] mtd: partition &quot;rootfs_data&quot; created automatically, ofs=350000, len=90000
[    1.780000] 0x000000350000-0x0000003e0000 : &quot;rootfs_data&quot;
[    1.790000] 0x0000003e0000-0x0000003f0000 : &quot;mac&quot;
[    1.790000] 0x0000003f0000-0x000000400000 : &quot;art&quot;
[    1.800000] 0x000000040000-0x0000003e0000 : &quot;firmware&quot;
root@(none):/#</code></pre></div><p>And serial boot log:</p><br /><div class="codebox"><pre><code>U-Boot 1.1.4 (Dec 29 2009 - 22:03:13)

AP99 (ar7240 - Python) U-boot
DRAM:
sri
#### TAP VALUE 1 = 0x8, 2 = 0x8 [0xff00ff20: 0xff00ff00]
32 MB
Top of RAM usable for U-Boot at: 82000000
Reserving 244k for U-Boot at: 81fc0000
Reserving 192k for malloc() at: 81f90000
Reserving 44 Bytes for Board Info at: 81f8ffd4
Reserving 36 Bytes for Global Data at: 81f8ffb0
Reserving 128k for boot params() at: 81f6ffb0
Stack Pointer at: 81f6ff98
Now running in RAM - U-Boot at: 81fc0000
id read 0x100000ff
flash size 4194304, sector count = 64
Flash:  4 MB
*** Warning - bad CRC, using default environment

In:    serial
Out:   serial
Err:   serial
Net:   ag7240_enet_initialize...
Fetching MAC Address from 0x81fe7340
: cfg1 0xf cfg2 0x7014
eth0: 00:18:e7:e0:01:f2
eth0 up
No valid address in Flash. Using fixed address
: cfg1 0xf cfg2 0x7214
eth1: 00:03:7f:09:0b:ad
ATHRS26: resetting s26
ATHRS26: s26 reset done
eth1 up
eth0, eth1
Hit any key to stop autoboot:  0
## Booting image at bf040000 ...
   Image Name:   MIPS OpenWrt Linux-3.3.8
   Created:      2014-08-19   9:13:29 UTC
   Image Type:   MIPS Linux Kernel Image (lzma  compressed)
   Data Size:    911546 Bytes = 890.2 kB
   Load Address: 80060000
   Entry Point:  80060000
   Verifying Checksum ... OK
   LZMA Umcompressing Kernel Image ...    Image loaded from 80060000-80302e80
 OK
No initrd
## Transferring control to Linux (at address 80060000) ...
## Giving linux memsize in bytes, 33554432

Starting kernel ...

[    0.000000] Linux version 3.3.8 () (gcc version 4.6.3 20120201 (prerelease) (Linaro GCC 4.6-2012.02) ) #2 Tue Aug 19 16:13:01 ICT 2014
[    0.000000] bootconsole [early0] enabled
[    0.000000] CPU revision is: 00019374 (MIPS 24Kc)
[    0.000000] SoC: Atheros AR7240 rev 2
[    0.000000] Clocks: CPU:400.000MHz, DDR:400.000MHz, AHB:200.000MHz, Ref:5.000MHz
[    0.000000] Determined physical RAM map:
[    0.000000]  memory: 02000000 @ 00000000 (usable)
[    0.000000] Initrd not found or empty - disabling initrd
[    0.000000] Zone PFN ranges:
[    0.000000]   Normal   0x00000000 -&gt; 0x00002000
[    0.000000] Movable zone start PFN for each node
[    0.000000] Early memory PFN ranges
[    0.000000]     0: 0x00000000 -&gt; 0x00002000
[    0.000000] Built 1 zonelists in Zone order, mobility grouping on.  Total pages: 8128
[    0.000000] Kernel command line:  board=DIR-600-A1 console=ttyS0,115200 mtdparts=spi0.0:192k(u-boot)ro,64k(nvram)ro,960k(kernel),2752k(rootfs),64k(mac)ro,64k

(art)ro,3712k@0x40000(firmware) rootfstype=squashfs,jffs2 noinitrd
[    0.000000] PID hash table entries: 128 (order: -3, 512 bytes)
[    0.000000] Dentry cache hash table entries: 4096 (order: 2, 16384 bytes)
[    0.000000] Inode-cache hash table entries: 2048 (order: 1, 8192 bytes)
[    0.000000] Primary instruction cache 64kB, VIPT, 4-way, linesize 32 bytes.
[    0.000000] Primary data cache 32kB, 4-way, VIPT, cache aliases, linesize 32 bytes
[    0.000000] Writing ErrCtl register=00000000
[    0.000000] Readback ErrCtl register=00000000
[    0.000000] Memory: 29148k/32768k available (2086k kernel code, 3620k reserved, 403k data, 208k init, 0k highmem)
[    0.000000] SLUB: Genslabs=9, HWalign=32, Order=0-3, MinObjects=0, CPUs=1, Nodes=1
[    0.000000] NR_IRQS:51
[    0.000000] Calibrating delay loop... 265.42 BogoMIPS (lpj=1327104)
[    0.080000] pid_max: default: 32768 minimum: 301
[    0.080000] Mount-cache hash table entries: 512
[    0.090000] NET: Registered protocol family 16
[    0.090000] gpiochip_add: registered GPIOs 0 to 17 on device: ath79
[    0.100000] MIPS: machine is D-Link DIR-600 rev. A1
[    1.520000] registering PCI controller with io_map_base unset
[    1.530000] bio: create slab &lt;bio-0&gt; at 0
[    1.540000] PCI host bridge to bus 0000:00
[    1.540000] pci_bus 0000:00: root bus resource [mem 0x10000000-0x13ffffff]
[    1.550000] pci_bus 0000:00: root bus resource [io  0x0000]
[    1.550000] pci 0000:00:00.0: fixup device configuration
[    1.560000] pci 0000:00:00.0: BAR 0: assigned [mem 0x10000000-0x1000ffff 64bit]
[    1.560000] pci 0000:00:00.0: using irq 40 for pin 1
[    1.570000] Switching to clocksource MIPS
[    1.570000] NET: Registered protocol family 2
[    1.580000] IP route cache hash table entries: 1024 (order: 0, 4096 bytes)
[    1.580000] TCP established hash table entries: 1024 (order: 1, 8192 bytes)
[    1.590000] TCP bind hash table entries: 1024 (order: 0, 4096 bytes)
[    1.590000] TCP: Hash tables configured (established 1024 bind 1024)
[    1.600000] TCP reno registered
[    1.600000] UDP hash table entries: 256 (order: 0, 4096 bytes)
[    1.610000] UDP-Lite hash table entries: 256 (order: 0, 4096 bytes)
[    1.620000] NET: Registered protocol family 1
[    1.640000] squashfs: version 4.0 (2009/01/31) Phillip Lougher
[    1.640000] JFFS2 version 2.2 (NAND) (SUMMARY) (LZMA) (RTIME) (CMODE_PRIORITY) (c) 2001-2006 Red Hat, Inc.
[    1.660000] msgmni has been set to 56
[    1.660000] io scheduler noop registered
[    1.660000] io scheduler deadline registered (default)
[    1.670000] Serial: 8250/16550 driver, 1 ports, IRQ sharing disabled
[    1.700000] serial8250.0: ttyS0 at MMIO 0x18020000 (irq = 11) is a 16550A
[    1.700000] console [ttyS0] enabled, bootconsole disabled
[    1.700000] console [ttyS0] enabled, bootconsole disabled
[    1.720000] m25p80 spi0.0: found mx25l3205d, expected m25p80
[    1.720000] m25p80 spi0.0: mx25l3205d (4096 Kbytes)
[    1.730000] 7 cmdlinepart partitions found on MTD device spi0.0
[    1.730000] Creating 7 MTD partitions on &quot;spi0.0&quot;:
[    1.740000] 0x000000000000-0x000000030000 : &quot;u-boot&quot;
[    1.750000] 0x000000030000-0x000000040000 : &quot;nvram&quot;
[    1.750000] 0x000000040000-0x000000130000 : &quot;kernel&quot;
[    1.760000] 0x000000130000-0x0000003e0000 : &quot;rootfs&quot;
[    1.770000] mtd: partition &quot;rootfs&quot; set to be root filesystem
[    1.770000] mtd: partition &quot;rootfs_data&quot; created automatically, ofs=350000, len=90000
[    1.780000] 0x000000350000-0x0000003e0000 : &quot;rootfs_data&quot;
[    1.790000] 0x0000003e0000-0x0000003f0000 : &quot;mac&quot;
[    1.790000] 0x0000003f0000-0x000000400000 : &quot;art&quot;
[    1.800000] 0x000000040000-0x0000003e0000 : &quot;firmware&quot;
[    1.910000] ag71xx_mdio: probed
[    1.920000] eth0: Atheros AG71xx at 0xba000000, irq 5
[    2.470000] eth0: Found an AR7240/AR9330 built-in switch
[    3.510000] eth1: Atheros AG71xx at 0xb9000000, irq 4
[    4.080000] ag71xx ag71xx.0: eth1: connected to PHY at ag71xx-mdio.0:04 [uid=004dd041, driver=Generic PHY]
[    4.090000] TCP cubic registered
[    4.090000] NET: Registered protocol family 17
[    4.090000] 8021q: 802.1Q VLAN Support v1.8
[    4.100000] VFS: Mounted root (squashfs filesystem) readonly on device 31:3.
[    4.110000] Freeing unused kernel memory: 208k freed
- preinit -
Press the [f] key and hit [enter] to enter failsafe mode</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p247832">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">rambler</div>
					<div class="post-datetime">
						23 Sep 2014, 15:06					</div>
				</div>
				<div class="post-content content">
					<p>Linux kernel identifies your flash chip as Macronix mx25l3205d, </p><div class="codebox"><pre><code>[    1.720000] m25p80 spi0.0: found mx25l3205d, expected m25p80</code></pre></div><p> which is indeed 4MiB (<a href="http://www.macronix.com/Lists/DataSheet/Attachments/1534/MX25L6405D,%203V,%2064Mb,%20v1.5.pdf">http://www.macronix.com/Lists/DataSheet … 20v1.5.pdf</a>).</p><p>What flash chip do you actually have?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p247846">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">hoatienii</div>
					<div class="post-datetime">
						23 Sep 2014, 18:49					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>rambler wrote:</cite><blockquote><p>Linux kernel identifies your flash chip as Macronix mx25l3205d, </p><div class="codebox"><pre><code>[    1.720000] m25p80 spi0.0: found mx25l3205d, expected m25p80</code></pre></div><p> which is indeed 4MiB (<a href="http://www.macronix.com/Lists/DataSheet/Attachments/1534/MX25L6405D,%203V,%2064Mb,%20v1.5.pdf">http://www.macronix.com/Lists/DataSheet … 20v1.5.pdf</a>).</p><p>What flash chip do you actually have?</p></blockquote></div><p>Yes, it true, my 4MB flash is mx25l3205d. I replace with winbond 16MB W25Q128FVSSIG, OS cannot detect enough 16MB, it still 4MB.</p>											<p class="post-edited">(Last edited by <strong>hoatienii</strong> on 23 Sep 2014, 18:49)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p247847">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">rambler</div>
					<div class="post-datetime">
						23 Sep 2014, 19:11					</div>
				</div>
				<div class="post-content content">
					<p>The kernel log that you posted -- was it with the original 4MB Macronix flash, or your new Winbond flash? If it was with the original flash, then post a log with the current Winbond flash.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p247886">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">hoatienii</div>
					<div class="post-datetime">
						24 Sep 2014, 03:27					</div>
				</div>
				<div class="post-content content">
					<p>yes the kernel log i posted was the original 4MB Macronix flash. <br />The winbond kernel log is here<br /></p><div class="codebox"><pre><code>U-Boot 1.1.4 (Dec 29 2009 - 22:03:13)

AP99 (ar7240 - Python) U-boot
DRAM:
sri
#### TAP VALUE 1 = 0x8, 2 = 0x8 [0xff00ff20: 0xff00ff00]
32 MB
Top of RAM usable for U-Boot at: 82000000
Reserving 244k for U-Boot at: 81fc0000
Reserving 192k for malloc() at: 81f90000
Reserving 44 Bytes for Board Info at: 81f8ffd4
Reserving 36 Bytes for Global Data at: 81f8ffb0
Reserving 128k for boot params() at: 81f6ffb0
Stack Pointer at: 81f6ff98
Now running in RAM - U-Boot at: 81fc0000
id read 0x100000ff
flash size 4194304, sector count = 64
Flash:  4 MB
*** Warning - bad CRC, using default environment

In:    serial
Out:   serial
Err:   serial
Net:   ag7240_enet_initialize...
Fetching MAC Address from 0x81fe7340
: cfg1 0xf cfg2 0x7014
eth0: 00:18:e7:e0:01:f2
eth0 up
No valid address in Flash. Using fixed address
: cfg1 0xf cfg2 0x7214
eth1: 00:03:7f:09:0b:ad
ATHRS26: resetting s26
ATHRS26: s26 reset done
eth1 up
eth0, eth1
Hit any key to stop autoboot:  0
## Booting image at bf040000 ...
   Image Name:   MIPS OpenWrt Linux-3.3.8
   Created:      2014-08-19   9:13:29 UTC
   Image Type:   MIPS Linux Kernel Image (lzma  compressed)
   Data Size:    911546 Bytes = 890.2 kB
   Load Address: 80060000
   Entry Point:  80060000
   Verifying Checksum ... OK
   LZMA Umcompressing Kernel Image ...    Image loaded from 80060000-80302e80
 OK
No initrd
## Transferring control to Linux (at address 80060000) ...
## Giving linux memsize in bytes, 33554432

Starting kernel ...

[    0.000000] Linux version 3.3.8 (dinhchuc@K52Jr) (gcc version 4.6.3 20120201 (prerelease) (Linaro GCC 4.6-2012.02) ) #2 Tue Aug 19 16:13:01 ICT 2014
[    0.000000] bootconsole [early0] enabled
[    0.000000] CPU revision is: 00019374 (MIPS 24Kc)
[    0.000000] SoC: Atheros AR7240 rev 2
[    0.000000] Clocks: CPU:400.000MHz, DDR:400.000MHz, AHB:200.000MHz, Ref:5.000MHz
[    0.000000] Determined physical RAM map:
[    0.000000]  memory: 02000000 @ 00000000 (usable)
[    0.000000] Initrd not found or empty - disabling initrd
[    0.000000] Zone PFN ranges:
[    0.000000]   Normal   0x00000000 -&gt; 0x00002000
[    0.000000] Movable zone start PFN for each node
[    0.000000] Early memory PFN ranges
[    0.000000]     0: 0x00000000 -&gt; 0x00002000
[    0.000000] Built 1 zonelists in Zone order, mobility grouping on.  Total pages: 8128
[    0.000000] Kernel command line:  board=DIR-600-A1 console=ttyS0,115200 mtdparts=spi0.0:192k(u-boot)ro,64k(nvram)ro,960k(kernel),2752k(rootfs),64k(mac)ro,64k(art)ro,3712k@0x40000(firmware) rootfstype=squashfs,jffs2 noinitrd
[    0.000000] PID hash table entries: 128 (order: -3, 512 bytes)
[    0.000000] Dentry cache hash table entries: 4096 (order: 2, 16384 bytes)
[    0.000000] Inode-cache hash table entries: 2048 (order: 1, 8192 bytes)
[    0.000000] Primary instruction cache 64kB, VIPT, 4-way, linesize 32 bytes.
[    0.000000] Primary data cache 32kB, 4-way, VIPT, cache aliases, linesize 32 bytes
[    0.000000] Writing ErrCtl register=00000000
[    0.000000] Readback ErrCtl register=00000000
[    0.000000] Memory: 29148k/32768k available (2086k kernel code, 3620k reserved, 403k data, 208k init, 0k highmem)
[    0.000000] SLUB: Genslabs=9, HWalign=32, Order=0-3, MinObjects=0, CPUs=1, Nodes=1
[    0.000000] NR_IRQS:51
[    0.000000] Calibrating delay loop... 265.42 BogoMIPS (lpj=1327104)
[    0.080000] pid_max: default: 32768 minimum: 301
[    0.080000] Mount-cache hash table entries: 512
[    0.090000] NET: Registered protocol family 16
[    0.090000] gpiochip_add: registered GPIOs 0 to 17 on device: ath79
[    0.100000] MIPS: machine is D-Link DIR-600 rev. A1
[    1.520000] registering PCI controller with io_map_base unset
[    1.530000] bio: create slab &lt;bio-0&gt; at 0
[    1.540000] PCI host bridge to bus 0000:00
[    1.540000] pci_bus 0000:00: root bus resource [mem 0x10000000-0x13ffffff]
[    1.550000] pci_bus 0000:00: root bus resource [io  0x0000]
[    1.550000] pci 0000:00:00.0: fixup device configuration
[    1.560000] pci 0000:00:00.0: BAR 0: assigned [mem 0x10000000-0x1000ffff 64bit]
[    1.560000] pci 0000:00:00.0: using irq 40 for pin 1
[    1.570000] Switching to clocksource MIPS
[    1.570000] NET: Registered protocol family 2
[    1.580000] IP route cache hash table entries: 1024 (order: 0, 4096 bytes)
[    1.580000] TCP established hash table entries: 1024 (order: 1, 8192 bytes)
[    1.590000] TCP bind hash table entries: 1024 (order: 0, 4096 bytes)
[    1.590000] TCP: Hash tables configured (established 1024 bind 1024)
[    1.600000] TCP reno registered
[    1.600000] UDP hash table entries: 256 (order: 0, 4096 bytes)
[    1.610000] UDP-Lite hash table entries: 256 (order: 0, 4096 bytes)
[    1.620000] NET: Registered protocol family 1
[    1.640000] squashfs: version 4.0 (2009/01/31) Phillip Lougher
[    1.640000] JFFS2 version 2.2 (NAND) (SUMMARY) (LZMA) (RTIME) (CMODE_PRIORITY) (c) 2001-2006 Red Hat, Inc.
[    1.660000] msgmni has been set to 56
[    1.660000] io scheduler noop registered
[    1.660000] io scheduler deadline registered (default)
[    1.670000] Serial: 8250/16550 driver, 1 ports, IRQ sharing disabled
[    1.700000] serial8250.0: ttyS0 at MMIO 0x18020000 (irq = 11) is a 16550A
[    1.700000] console [ttyS0] enabled, bootconsole disabled
[    1.700000] console [ttyS0] enabled, bootconsole disabled
[    1.720000] m25p80 spi0.0: found w25q128, expected m25p80
[    1.720000] m25p80 spi0.0: w25q128 (16384 Kbytes)
[    1.730000] 7 cmdlinepart partitions found on MTD device spi0.0
[    1.730000] Creating 7 MTD partitions on &quot;spi0.0&quot;:
[    1.740000] 0x000000000000-0x000000030000 : &quot;u-boot&quot;
[    1.750000] 0x000000030000-0x000000040000 : &quot;nvram&quot;
[    1.750000] 0x000000040000-0x000000130000 : &quot;kernel&quot;
[    1.760000] 0x000000130000-0x0000003e0000 : &quot;rootfs&quot;
[    1.770000] mtd: partition &quot;rootfs&quot; set to be root filesystem
[    1.770000] mtd: partition &quot;rootfs_data&quot; created automatically, ofs=350000, len=90000
[    1.780000] 0x000000350000-0x0000003e0000 : &quot;rootfs_data&quot;
[    1.790000] 0x0000003e0000-0x0000003f0000 : &quot;mac&quot;
[    1.790000] 0x0000003f0000-0x000000400000 : &quot;art&quot;
[    1.800000] 0x000000040000-0x0000003e0000 : &quot;firmware&quot;
[    1.910000] ag71xx_mdio: probed
[    1.920000] eth0: Atheros AG71xx at 0xba000000, irq 5
[    2.470000] eth0: Found an AR7240/AR9330 built-in switch
[    3.510000] eth1: Atheros AG71xx at 0xb9000000, irq 4
[    4.080000] ag71xx ag71xx.0: eth1: connected to PHY at ag71xx-mdio.0:04 [uid=004dd041, driver=Generic PHY]
[    4.090000] TCP cubic registered
[    4.090000] NET: Registered protocol family 17
[    4.090000] 8021q: 802.1Q VLAN Support v1.8
[    4.100000] VFS: Mounted root (squashfs filesystem) readonly on device 31:3.
[    4.110000] Freeing unused kernel memory: 208k freed
root@(none):/# df -h
Filesystem                Size      Used Available Use% Mounted on
rootfs                    2.3M      2.3M         0 100% /
/dev/root                 2.3M      2.3M         0 100% /
tmpfs                    14.3M     12.0K     14.3M   0% /tmp
tmpfs                   512.0K         0    512.0K   0% /dev
root@(none):/# dmesg | grep &quot;0x00&quot;
[    0.000000]   Normal   0x00000000 -&gt; 0x00002000
[    0.000000]     0: 0x00000000 -&gt; 0x00002000
[    1.550000] pci_bus 0000:00: root bus resource [io  0x0000]
[    1.550000] pci 0000:00:00.0: [168c:002e] type 0 class 0x000280
[    1.560000] pci 0000:00:00.0: reg 10: [mem 0x00000000-0x0000ffff 64bit]
[    1.740000] 0x000000000000-0x000000030000 : &quot;u-boot&quot;
[    1.750000] 0x000000030000-0x000000040000 : &quot;nvram&quot;
[    1.750000] 0x000000040000-0x000000130000 : &quot;kernel&quot;
[    1.760000] 0x000000130000-0x0000003e0000 : &quot;rootfs&quot;
[    1.780000] 0x000000350000-0x0000003e0000 : &quot;rootfs_data&quot;
[    1.790000] 0x0000003e0000-0x0000003f0000 : &quot;mac&quot;
[    1.790000] 0x0000003f0000-0x000000400000 : &quot;art&quot;
[    1.800000] 0x000000040000-0x0000003e0000 : &quot;firmware&quot;
root@(none):/# dmesg | grep &quot;\&quot;&quot;
[    1.730000] Creating 7 MTD partitions on &quot;spi0.0&quot;:
[    1.740000] 0x000000000000-0x000000030000 : &quot;u-boot&quot;
[    1.750000] 0x000000030000-0x000000040000 : &quot;nvram&quot;
[    1.750000] 0x000000040000-0x000000130000 : &quot;kernel&quot;
[    1.760000] 0x000000130000-0x0000003e0000 : &quot;rootfs&quot;
[    1.770000] mtd: partition &quot;rootfs&quot; set to be root filesystem
[    1.770000] mtd: partition &quot;rootfs_data&quot; created automatically, ofs=350000, len=90000
[    1.780000] 0x000000350000-0x0000003e0000 : &quot;rootfs_data&quot;
[    1.790000] 0x0000003e0000-0x0000003f0000 : &quot;mac&quot;
[    1.790000] 0x0000003f0000-0x000000400000 : &quot;art&quot;
[    1.800000] 0x000000040000-0x0000003e0000 : &quot;firmware&quot;</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p247947">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">rambler</div>
					<div class="post-datetime">
						24 Sep 2014, 20:04					</div>
				</div>
				<div class="post-content content">
					<p>I see. The kernel mounts flash partitions based on the command line it receives from u-boot:</p><div class="codebox"><pre><code>[    0.000000] Kernel command line:  board=DIR-600-A1 console=ttyS0,115200 mtdparts=spi0.0:192k(u-boot)ro,64k(nvram)ro,960k(kernel),2752k(rootfs),64k(mac)ro,64k(art)ro,3712k@0x40000(firmware) rootfstype=squashfs,jffs2 noinitrd
...
[    1.730000] 7 cmdlinepart partitions found on MTD device spi0.0
[    1.730000] Creating 7 MTD partitions on &quot;spi0.0&quot;:
[    1.740000] 0x000000000000-0x000000030000 : &quot;u-boot&quot;
[    1.750000] 0x000000030000-0x000000040000 : &quot;nvram&quot;
[    1.750000] 0x000000040000-0x000000130000 : &quot;kernel&quot;
[    1.760000] 0x000000130000-0x0000003e0000 : &quot;rootfs&quot;
...</code></pre></div><p>This is different from my tp-link atheros based devices, where the command line is simply ignored.</p><p>So indeed you need to modify u-boot. Cannot help you here, sorry. I don&#039;t have any such device. And the info on the (russian) site <a href="http://texnikk.blogspot.com/2014/02/dir-615-e4-16m-flash-64m-ram-usb-mod.html">http://texnikk.blogspot.com/2014/02/dir … b-mod.html</a> is, let&#039;s say, not particularly user friendly. (Yet the patches there still hint at what has to be changed in u-boot code.)</p><p>Incidentally, you seem to be using some custom OpenWRT build. Maybe stick with a standard build (AA or BB RC3 at the moment).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p248000">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">hoatienii</div>
					<div class="post-datetime">
						25 Sep 2014, 02:12					</div>
				</div>
				<div class="post-content content">
					<p>Thank you so much your reply. I will use usb for more storge</p>											<p class="post-edited">(Last edited by <strong>hoatienii</strong> on 25 Sep 2014, 02:15)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p248003">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">alphasparc</div>
					<div class="post-datetime">
						25 Sep 2014, 03:04					</div>
				</div>
				<div class="post-content content">
					<p>Isn&#039;t the link to the uboot available on the site?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p248006">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">hoatienii</div>
					<div class="post-datetime">
						25 Sep 2014, 03:26					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>alphasparc wrote:</cite><blockquote><p>Isn&#039;t the link to the uboot available on the site?</p></blockquote></div><p>yes, uboot have on the site, i flash on my 16MB flash, but can not boot. I use flash programmer.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p248009">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">alphasparc</div>
					<div class="post-datetime">
						25 Sep 2014, 04:05					</div>
				</div>
				<div class="post-content content">
					<p>I had a tp-link this is how I upgraded to 16MB without moding uboot.<br />Backup the art.<br />Copy the entire 4MB inage to disk.<br />Flash the inage to 16MB chip.<br />Compile a 16MB image unprotect art<br />Flash the sysupgrade using web interface.<br />The art will be missing.<br />mtd write the art to flash do not reboot.<br />flash the 16MB image with art protected.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p248011">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">hoatienii</div>
					<div class="post-datetime">
						25 Sep 2014, 04:53					</div>
				</div>
				<div class="post-content content">
					<p>I also have tp-link wr740n, I upgrade to 16MB flash very easy with CH341A programmer.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p248760">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">hoatienii</div>
					<div class="post-datetime">
						2 Oct 2014, 05:56					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>hoatienii wrote:</cite><blockquote><p>Please help me compile u-boot support 16MB flash for Dlink DIR 615 E4<br />I find DIR 615 E4 orginal source form here . <a href="https://www.dropbox.com/s/qu8gcm2uoq2lbau/DIR615E4_GPL512.tar.gz">https://www.dropbox.com/s/qu8gcm2uoq2lb … 512.tar.gz</a><br />Toolchain: <a href="https://www.dropbox.com/s/qsy5om9jj8mq278/DIR-615E4-toolchain.bz">https://www.dropbox.com/s/qsy5om9jj8mq2 … olchain.bz</a><br /><a href="http://texnikk.blogspot.com/2014/02/dir-615-e4-16m-flash-64m-ram-usb-mod.html">http://texnikk.blogspot.com/2014/02/dir … b-mod.html</a></p><p>Thanks in advance</p></blockquote></div><p>Help me please!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p249432">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">_DS_</div>
					<div class="post-datetime">
						6 Oct 2014, 21:28					</div>
				</div>
				<div class="post-content content">
					<p>Loader here: <a href="https://www.dropbox.com/s/lnn7jqueytwlxc0/ldr_16M-NOR_64M-RAM.bin">https://www.dropbox.com/s/lnn7jqueytwlx … 4M-RAM.bin</a><br />(from <a href="http://texnikk.blogspot.com">http://texnikk.blogspot.com</a>), flash it in u-boot partition.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p251260">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">hoatienii</div>
					<div class="post-datetime">
						20 Oct 2014, 12:52					</div>
				</div>
				<div class="post-content content">
					<p><a href="http://texnikk.blogspot.com/.">http://texnikk.blogspot.com/.</a><br />Thanks him so much! I successfull ugrade 16MB flash for Dlink DIR615 E4.<br />I flash loader using SPI flash programmer then:<br />1. Connect to router&#039;s UART through Windows Hyperterminal.<br />2. Then boot to &quot;ar7240&gt;&nbsp; &quot; prompt. Here you should type &quot;loady&quot; command.<br />3. Then in Hyperterminal menu you should choose &quot;Transfer,&quot; and then &quot;Send File.&quot; Choose openwrt image. Select Protocol = Y-Modem. Press &quot;Send&quot;.<br />4. Wait until file transfeer will be completed<br />5. In bootloader prompt issue &quot;erase 0xbf050000 +0xFA0000&quot;<br />6.&nbsp; In bootloader prompt issue &quot; cp.b 0x81000000 0xbf050000 &lt;size_of_firmware&gt;&quot;&nbsp; &nbsp; <br />7. Reboot</p>											<p class="post-edited">(Last edited by <strong>hoatienii</strong> on 20 Oct 2014, 12:53)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0.001 -->

</body>
</html>