<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> TP-LINK TL-1043ND - No webgui/Luci after flash - PART 2</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 31 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p176633">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">vouty</div>
					<div class="post-datetime">
						1 Sep 2012, 20:51					</div>
				</div>
				<div class="post-content content">
					<p>Hoping someone can help here. Where I’m at is this:</p><p>I can flash the stable version of Backfire 10.03.1 dated 21-Dec-2011 and get webgui/Luci. But despite all efforts so far:</p><p>I cannot get the WAN port to pass the internet connection from my Charter cable modem. It shows it’s physically connected, but can’t get DHCP from the cable modem. So no internet.&nbsp; </p><p>Also, I cannot get external USB drive to work. Don’t even get USB tab in webgui.&nbsp; </p><p>Read in a forum that the latest “snapshot” version dated 30-Aug-2012 solved these problems, but when I flash this version, this is when I cant get the webgui. I can however connect, get dhcp, and telent/ssh in. I can also get WAN/internet at this time, so I can &quot;wget&quot; different firmware versions at the command line in ssh.</p><p>I have also tried flashing Gargoyle, which gives me basic functions - webgui, internet, even USB, but lacks the ability to add other features such as a torrent daemon. So, basically, only marginally better than stock firmware. </p><p>Can someone please suggest a few things to try so I can get a working OpenWrt installation with WAN port and USB working on this router? Thanks. </p><p>My router:<br />TP-LINK TL-1043ND v1.8<br />U-Boot 1.1.4 (Apr 28 2011)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p176634">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						1 Sep 2012, 21:00					</div>
				</div>
				<div class="post-content content">
					<p>From within the console on the trunk snapshot simply run:</p><p>opkg update<br />opkg install luci<br />/etc/init.d/uhttpd enable<br />/etc/init.d/uhttpd start</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p176636">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">written_direcon</div>
					<div class="post-datetime">
						1 Sep 2012, 21:20					</div>
				</div>
				<div class="post-content content">
					<p>You can read it better by using code tags :-)<br /></p><div class="codebox"><pre><code>opkg update
opkg install luci
/etc/init.d/uhttpd enable
/etc/init.d/uhttpd start</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p176638">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">vouty</div>
					<div class="post-datetime">
						1 Sep 2012, 21:23					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>jow wrote:</cite><blockquote><p>From within the console on the trunk snapshot simply run:</p><p>opkg update<br />opkg install luci<br />/etc/init.d/uhttpd enable<br />/etc/init.d/uhttpd start</p></blockquote></div><p>Awesome! This worked and I now have a webgui and am in Luci! However I plugged in the external USB drive and still no USB settings tab, even after reboot. How do I get this working? Thanks!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p176639">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">vouty</div>
					<div class="post-datetime">
						1 Sep 2012, 21:36					</div>
				</div>
				<div class="post-content content">
					<p>Found this guide on USB setup: <a href="http://klseet.com/index.php/tl-wr1043nd-ver18/usb-a-swap-samba-ftp">http://klseet.com/index.php/tl-wr1043nd … -samba-ftp</a></p><p>Trying now.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p176640">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">vouty</div>
					<div class="post-datetime">
						1 Sep 2012, 22:09					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>vouty wrote:</cite><blockquote><p>Found this guide on USB setup: <a href="http://klseet.com/index.php/tl-wr1043nd-ver18/usb-a-swap-samba-ftp">http://klseet.com/index.php/tl-wr1043nd … -samba-ftp</a></p><p>Trying now.</p></blockquote></div><p>Okay, this worked and I now have a &quot;Mount Point&quot; tab for USB operations. Finally, things are humming along with OpenWrt goodness! Thanks again for the excellent community support. Hope to be a contributor soon once I&#039;m up to speed.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p176653">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">vouty</div>
					<div class="post-datetime">
						2 Sep 2012, 06:44					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>vouty wrote:</cite><blockquote><div class="quotebox"><cite>vouty wrote:</cite><blockquote><p>Found this guide on USB setup: <a href="http://klseet.com/index.php/tl-wr1043nd-ver18/usb-a-swap-samba-ftp">http://klseet.com/index.php/tl-wr1043nd … -samba-ftp</a></p><p>Trying now.</p></blockquote></div><p>Okay, this worked and I now have a &quot;Mount Point&quot; tab for USB operations. Finally, things are humming along with OpenWrt goodness! Thanks again for the excellent community support. Hope to be a contributor soon once I&#039;m up to speed.</p></blockquote></div><p>Good news/bad news! In following the above procedure, in the process of editing the /etc/password file via WinSCP, I think I screwed it up and deleted something in it. Now I can&#039;t log in to the router in ssh or WinSCP. They both just keep rejecting my root password. I can, however, log in to the Luci and everything there seems normal. Tried changing the root pw in Luci, but it didn&#039;t take it after reboot. My old root pw is still working. How can I fix this screw up? Thanks! again...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p176657">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">maurer</div>
					<div class="post-datetime">
						2 Sep 2012, 08:00					</div>
				</div>
				<div class="post-content content">
					<p>because you don&#039;t know what you&#039;ve messed up my advice is to issue a factory default command from gui and start from scratch.<br />this is how you learn it&nbsp; - doing it all over again <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p176659">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">vouty</div>
					<div class="post-datetime">
						2 Sep 2012, 08:32					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>maurer wrote:</cite><blockquote><p>because you don&#039;t know what you&#039;ve messed up my advice is to issue a factory default command from gui and start from scratch.<br />this is how you learn it&nbsp; - doing it all over again <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p></blockquote></div><p>Probably good advice, and I don&#039;t mind doing all over again, but would this actually fix the /etc/passwd file I messed up and ADD BACK the line I deleted? </p><p>I guess I could also re-flash the firmware file since this would rewrite all the files. Would be nice if I could just rewrite the /etc/passwd file I messed up.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p176668">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">uqbar</div>
					<div class="post-datetime">
						2 Sep 2012, 11:00					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>jow wrote:</cite><blockquote><p>From within the console on the trunk snapshot simply run:</p><p>opkg update<br />opkg install luci<br />/etc/init.d/uhttpd enable<br />/etc/init.d/uhttpd start</p></blockquote></div><p>Ehm! This requires the Internet connection to be kicking and alive. Which had been reported to be dead, instead!<br />Weird!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p176677">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">written_direcon</div>
					<div class="post-datetime">
						2 Sep 2012, 12:40					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>vouty wrote:</cite><blockquote><p>I guess I could also re-flash the firmware file since this would rewrite all the files. Would be nice if I could just rewrite the /etc/passwd file I messed up.</p></blockquote></div><p>You don&#039;t have to reflash the firmware. Just wipe all changes you have made after flashing with:<br /></p><div class="codebox"><pre><code>mtd -r erase rootfs_data</code></pre></div><p>Then wait a few minutes and login via telnet @ 192.168.1.1, set password (passwd) and relogin via SSH (ssh root@192.168.1.1). Now you can reconfigure the router from a clean state!!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p176691">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">vouty</div>
					<div class="post-datetime">
						2 Sep 2012, 18:22					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>written_direcon wrote:</cite><blockquote><div class="quotebox"><cite>vouty wrote:</cite><blockquote><p>I guess I could also re-flash the firmware file since this would rewrite all the files. Would be nice if I could just rewrite the /etc/passwd file I messed up.</p></blockquote></div><p>You don&#039;t have to reflash the firmware. Just wipe all changes you have made after flashing with:<br /></p><div class="codebox"><pre><code>mtd -r erase rootfs_data</code></pre></div><p>Then wait a few minutes and login via telnet @ 192.168.1.1, set password (passwd) and relogin via SSH (ssh root@192.168.1.1). Now you can reconfigure the router from a clean state!!</p></blockquote></div><p>Looks good but I currently can&#039;t get into SSH to run this command. Is there a way to run this command from inside Luci?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p176697">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">maurer</div>
					<div class="post-datetime">
						2 Sep 2012, 19:23					</div>
				</div>
				<div class="post-content content">
					<p>to reset to defaults from luci gui:<br />go to System -&gt; Backup/ Flash Firmware -&gt; Reset to defaults: click on &quot;Perform Reset&quot;<br />it&#039;s the same as:<br /></p><div class="codebox"><pre><code>mtd -r erase rootfs_data</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p176698">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">vouty</div>
					<div class="post-datetime">
						2 Sep 2012, 19:43					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>maurer wrote:</cite><blockquote><p>to reset to defaults from luci gui:<br />go to System -&gt; Backup/ Flash Firmware -&gt; Reset to defaults: click on &quot;Perform Reset&quot;<br />it&#039;s the same as:<br /></p><div class="codebox"><pre><code>mtd -r erase rootfs_data</code></pre></div></blockquote></div><p>Right, I understand that this is how it *normally* works. Doing this would &quot;reset&quot; everything back to defaults. But in this case, since I actually went into the /etc/passwd file and removed a line of original code, then re-saved it, would doing a &quot;reset&quot; somehow rewrite this file and put back the line I deleted? </p><p>What we need to know here is *how* the router stores our changes and how it actually removes them during a reset. Are the original files from the firmware flash stored in a &quot;read-only&quot; state and the changes we make are stored in a separate config file that is then erased or reset? My concern is that if I do a reset, I will brick the router because I won&#039;t be able to get into telnet, ssh, or Luci because I deleted code from the /etc/passwd file.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p176700">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">vouty</div>
					<div class="post-datetime">
						2 Sep 2012, 19:52					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>vouty wrote:</cite><blockquote><div class="quotebox"><cite>maurer wrote:</cite><blockquote><p>to reset to defaults from luci gui:<br />go to System -&gt; Backup/ Flash Firmware -&gt; Reset to defaults: click on &quot;Perform Reset&quot;<br />it&#039;s the same as:<br /></p><div class="codebox"><pre><code>mtd -r erase rootfs_data</code></pre></div></blockquote></div><p>Right, I understand that this is how it *normally* works. Doing this would &quot;reset&quot; everything back to defaults. But in this case, since I actually went into the /etc/passwd file and removed a line of original code, then re-saved it, would doing a &quot;reset&quot; somehow rewrite this file and put back the line I deleted? </p><p>What we need to know here is *how* the router stores our changes and how it actually removes them during a reset. Are the original files from the firmware flash stored in a &quot;read-only&quot; state and the changes we make are stored in a separate config file that is then erased or reset? My concern is that if I do a reset, I will brick the router because I won&#039;t be able to get into telnet, ssh, or Luci because I deleted code from the /etc/passwd file.</p></blockquote></div><p>Okay, I have an idea. I just made a backup of the router settings, backup-OpenWrt-2012-09-02.tar.gz. I then opened the backup in 7-zip and I am looking at the /etc/passwd file in Notepad. This is what I&#039;m seeing:</p><p>root:<br />daemon:*:1:1:daemon:/var:/bin/false<br />ftp:*:55:55:ftp:/home/ftp:/bin/false<br />network:*:101:101:network:/var:/bin/false<br />nobody:*:65534:65534:nobody:/var:/bin/false</p><p>I think I deleted the first line. Can someone tell me what is missing? Then I can re-save the file into the backup, then *restore* it in Luci. Might work.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p176703">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">vouty</div>
					<div class="post-datetime">
						2 Sep 2012, 20:42					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>vouty wrote:</cite><blockquote><div class="quotebox"><cite>vouty wrote:</cite><blockquote><div class="quotebox"><cite>maurer wrote:</cite><blockquote><p>to reset to defaults from luci gui:<br />go to System -&gt; Backup/ Flash Firmware -&gt; Reset to defaults: click on &quot;Perform Reset&quot;<br />it&#039;s the same as:<br /></p><div class="codebox"><pre><code>mtd -r erase rootfs_data</code></pre></div></blockquote></div><p>Right, I understand that this is how it *normally* works. Doing this would &quot;reset&quot; everything back to defaults. But in this case, since I actually went into the /etc/passwd file and removed a line of original code, then re-saved it, would doing a &quot;reset&quot; somehow rewrite this file and put back the line I deleted? </p><p>What we need to know here is *how* the router stores our changes and how it actually removes them during a reset. Are the original files from the firmware flash stored in a &quot;read-only&quot; state and the changes we make are stored in a separate config file that is then erased or reset? My concern is that if I do a reset, I will brick the router because I won&#039;t be able to get into telnet, ssh, or Luci because I deleted code from the /etc/passwd file.</p></blockquote></div><p>Okay, I have an idea. I just made a backup of the router settings, backup-OpenWrt-2012-09-02.tar.gz. I then opened the backup in 7-zip and I am looking at the /etc/passwd file in Notepad. This is what I&#039;m seeing:</p><p>root:<br />daemon:*:1:1:daemon:/var:/bin/false<br />ftp:*:55:55:ftp:/home/ftp:/bin/false<br />network:*:101:101:network:/var:/bin/false<br />nobody:*:65534:65534:nobody:/var:/bin/false</p><p>I think I deleted the first line. Can someone tell me what is missing? Then I can re-save the file into the backup, then *restore* it in Luci. Might work.</p></blockquote></div><p>Would this be the correct code for the *default* root password state after a flash:</p><p>root:!:0:0:root:/root:/bin/ash</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p176801">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">maurer</div>
					<div class="post-datetime">
						3 Sep 2012, 20:58					</div>
				</div>
				<div class="post-content content">
					<p>this is the default file content:<br /><a href="https://dev.openwrt.org/browser/trunk/package/base-files/files/etc/passwd">https://dev.openwrt.org/browser/trunk/p … etc/passwd</a><br />and :<br /></p><div class="codebox"><pre><code>root:x:0:0:root:/root:/bin/ash</code></pre></div>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>