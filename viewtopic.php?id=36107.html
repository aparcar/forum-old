<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> How to open IP Protocol 47 (GRE) in Luci?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 26 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p164096">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">ult_nrg</div>
					<div class="post-datetime">
						11 Apr 2012, 07:01					</div>
				</div>
				<div class="post-content content">
					<p>Hi All</p><p>I am running a WHS 2011 box behind a TP-Link WR2543ND router, which I have flashed to openWRT (with luci installed)</p><p>I have been searching the internet for a while and can&#039;t seem to find the answer I am looking for.</p><p>I have set up a VPN (just using network connections within Windows) on the WHS and would like to tunnel into it externally. </p><p>I have tried using a Windows 7 machine (external to the network) and the VPN works just as expected. However I am now trying it on an XP machine (also external to the WHS network, but on a different network to the 7 machine) and it is spitting out error 721...which I have googled and found it is a GRE issue.</p><p>The only thing I have done on the router end is open the PPTP Port for the WHS&#039;s IP address; I simply can&#039;t figure out how to enable / allow GRE.</p><p>Is there something staring me in the face that i&#039;m missing?</p><p>Cheers</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p164103">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">bugalugs</div>
					<div class="post-datetime">
						11 Apr 2012, 08:51					</div>
				</div>
				<div class="post-content content">
					<p>you need to configure your openwrt firewall to open up TCP port 1723 for pptp and IP protocol (not port) 47 for GRE.</p>											<p class="post-edited">(Last edited by <strong>bugalugs</strong> on 11 Apr 2012, 08:52)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p164125">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						11 Apr 2012, 11:48					</div>
				</div>
				<div class="post-content content">
					<p>Add a new port forward (traffic redirection) rule. Set source zone to wan, destination zone to lan, destination ip to your internal lan vpn client.<br />Set the protocol to &quot;-- custom --&quot; and then enter &quot;gre&quot; as value, hit save &amp; apply.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p164335">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">ult_nrg</div>
					<div class="post-datetime">
						13 Apr 2012, 08:01					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>jow wrote:</cite><blockquote><p>Add a new port forward (traffic redirection) rule. Set source zone to wan, destination zone to lan, destination ip to your internal lan vpn client.<br />Set the protocol to &quot;-- custom --&quot; and then enter &quot;gre&quot; as value, hit save &amp; apply.</p></blockquote></div><p>Hi Jow</p><p>Thanks for that, that&#039;s exactly what I was after!</p><p>Unfortunately however, it appears it has not solved the problem <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" />. I did some more testing and found that the reason Windows 7 was working was because it was using SSTP (not PPTP). Once I changed it to use PPTP (like XP) it spat out an error (and actually pointed out it was probably a GRE issue).</p><p>Anywho, here is a screenshot of my GRE config: </p><p><span class="postimg"><img src="http://img.techpowerup.org/120413/Firewallrules.jpg" alt="http://img.techpowerup.org/120413/Firewallrules.jpg" /></span></p><p>If I&#039;ve missed anything please let me know!</p><p>Thanks again!</p>											<p class="post-edited">(Last edited by <strong>ult_nrg</strong> on 13 Apr 2012, 08:09)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p203361">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">finnce</div>
					<div class="post-datetime">
						31 May 2013, 18:10					</div>
				</div>
				<div class="post-content content">
					<p>Same issue,<br />Thanks,</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p224211">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">xtr3m3</div>
					<div class="post-datetime">
						31 Jan 2014, 23:56					</div>
				</div>
				<div class="post-content content">
					<p>install this and will work <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>kmod-ipt-nathelper-extra<br />kmod-gre</p><p>and<br />Add a new port forward (traffic redirection) rule. Set source zone to wan, destination zone to lan, destination ip to your internal lan vpn client.<br />Set the protocol to &quot;-- custom --&quot; and then enter &quot;gre&quot; as value, hit save &amp; apply.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p224212">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">xtr3m3</div>
					<div class="post-datetime">
						31 Jan 2014, 23:57					</div>
				</div>
				<div class="post-content content">
					<p>and forwarding 1723 tcp and 1701 udp</p><p>working on 12.09-beta on tp-link1043</p>											<p class="post-edited">(Last edited by <strong>xtr3m3</strong> on 31 Jan 2014, 23:57)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p234589">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">birnbacs</div>
					<div class="post-datetime">
						26 May 2014, 12:12					</div>
				</div>
				<div class="post-content content">
					<p>I have the same issue on a related configuration. My client is on LAN and the VPN server on WAN. Opening the 1723 was straightforward and I see traffic on my client on port 1723 going in both directions. (Nothing on ports 50, 500 and 1701 or 4500, btw.) However, GRE packets only leave the client but nothing ever comes back.</p><p>Worse: I cannot install <br />kmod-gre (which should help me doing GRE forwards)<br />or<br />kmod-ipt-nathelper-extra (an enhancment for enabling more than one connection at a time).</p><p>Here is what happens:</p><br /><br /><br /><br /><p>root@Poseidon:~# opkg update<br />Downloading <a href="http://downloads.openwrt.org/attitude_adjustment/12.09-rc1/ar71xx/generic/packages//Packages.gz.">http://downloads.openwrt.org/attitude_a … ckages.gz.</a><br />Updated list of available packages in /var/opkg-lists/packages.</p><p>root@Poseidon:~# opkg install kmod-gre<br />Installing kmod-gre (3.3.8-1) to root...<br />Downloading <a href="http://downloads.openwrt.org/attitude_adjustment/12.09-rc1/ar71xx/generic/packages//kmod-gre_3.3.8-1_ar71xx.ipk.">http://downloads.openwrt.org/attitude_a … r71xx.ipk.</a><br />Collected errors:<br /> * satisfy_dependencies_for: Cannot satisfy the following dependencies for kmod-gre:<br /> * &nbsp; &nbsp; kernel (= 3.3.8-1-5440da3a2c45184a32da6bba25b8dd2a) * &nbsp; &nbsp; kernel (= 3.3.8-1-5440da3a2c45184a32da6bba25b8dd2a) * <br /> * opkg_install_cmd: Cannot install package kmod-gre.</p><p>root@Poseidon:~# opkg install kmod-ipt-nathelper-extra<br />Installing kmod-ipt-nathelper-extra (3.3.8-1) to root...<br />Downloading <a href="http://downloads.openwrt.org/attitude_adjustment/12.09-rc1/ar71xx/generic/packages//kmod-ipt-nathelper-extra_3.3.8-1_ar71xx.ipk.">http://downloads.openwrt.org/attitude_a … r71xx.ipk.</a><br />Collected errors:<br /> * satisfy_dependencies_for: Cannot satisfy the following dependencies for kmod-ipt-nathelper-extra:<br /> * &nbsp; &nbsp; kernel (= 3.3.8-1-5440da3a2c45184a32da6bba25b8dd2a) * &nbsp; &nbsp; kernel (= 3.3.8-1-5440da3a2c45184a32da6bba25b8dd2a) * <br /> * opkg_install_cmd: Cannot install package kmod-ipt-nathelper-extra.</p><p>root@Poseidon:~# uname -a<br />Linux Poseidon 3.3.8 #1 Sat Mar 23 16:49:30 UTC 2013 mips GNU/Linux</p><p>root@Poseidon:~# lsmod | grep -i gre | wc<br />&nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0</p><br /><br /><br /><p>So far I could not get myself to try a force install (--force-depends) for fear of ruining the system. <br />Any chance to get GRE passthrough working without those modules?</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>