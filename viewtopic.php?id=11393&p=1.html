<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Could not open mtd device: linux</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 13 Apr 2018 and 17 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 2</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=11393&amp;p=2.html">2</a></li></ul></nav></div>
			
		
		
			<article class="post" id="p51317">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">ggp81</div>
					<div class="post-datetime">
						26 Jun 2007, 18:46					</div>
				</div>
				<div class="post-content content">
					<p>Hello,<br />I&#039;m using a forked version of Kamikaze for my Compex WP54AG. I tried to upgrade my firmware (both via ssh and webif) and I got this error.</p><div class="quotebox"><blockquote><p>Upgrading firmware, please wait ... </p><p>Could not open mtd device: linux<br />Can&#039;t open device for writing!<br />done.</p></blockquote></div><p>I am not asking for support, because I think the problem to be due to the instability of this &quot;unofficial&quot; firmware.<br />I just would like to understand what this error means and in which cases it usually occurs. It looks like it&#039;s not possible to overwrite the firmware partitions for some unknown and mysterious reasons <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>											<p class="post-edited">(Last edited by <strong>ggp81</strong> on 26 Jun 2007, 18:57)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p51340">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">Imagix</div>
					<div class="post-datetime">
						27 Jun 2007, 01:03					</div>
				</div>
				<div class="post-content content">
					<p>Call this a &quot;me too&quot; post.&nbsp; I did however manage to get the SVN head of OpenWRT to run on the box (not the r7118 that Compex &quot;supports&quot;).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p51438">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">dai479</div>
					<div class="post-datetime">
						28 Jun 2007, 18:58					</div>
				</div>
				<div class="post-content content">
					<p>I am having this same error when trying to go back to my original firmware:</p><p>Could not open mtd device: linux<br />Can&#039;t open device for writing!<br />done.</p><p>Is the device name called something else in Kamikaze?</p><p>I get this error from the command line and from the Upgrade option via the web interface.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p51444">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">mbm</div>
					<div class="post-datetime">
						28 Jun 2007, 21:08					</div>
				</div>
				<div class="post-content content">
					<p>The &quot;linux&quot; in &quot;mtd -r write something linux&quot; refers to the mtd partition named &quot;linux&quot;.</p><p>See /proc/mtd.</p><p>I can&#039;t think of any OpenWrt releases that don&#039;t specify a linux partition; it&#039;s likely that you&#039;re using something other than what&#039;s provided on openwrt.org.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p51449">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">dai479</div>
					<div class="post-datetime">
						28 Jun 2007, 22:03					</div>
				</div>
				<div class="post-content content">
					<p>Yeah, I&#039;m trying to go back to the original firmware on a Powerstation 2 unit.</p><p>Yesterday I installed the latest OpenWRT on the unit and everything is working OK, but want to go back to the original Powersatation .bin firmware and the update option gives me that error and won&#039;t flash the firmware to the unit.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p51450">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">Imagix</div>
					<div class="post-datetime">
						28 Jun 2007, 22:07					</div>
				</div>
				<div class="post-content content">
					<p>Compex&#039;s fork of OpenWRT does use the following as a partition table:</p><p>0x00000000-0x00010000 : &quot;MyLoader&quot;<br />0x00010000-0x00020000 : &quot;Partition Table&quot;<br />0x00020000-0x00030000 : &quot;lzma loader&quot;<br />0x00030000-0x00100000 : &quot;kernel&quot;<br />0x00100000-0x00400000 : &quot;rootfs&quot;<br />0x002f0000-0x00400000 : &quot;rootfs_data&quot;</p><p>After the system is up and running, the mount table looks like:</p><p>Filesystem&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Size&nbsp; &nbsp; &nbsp; Used Available Use% Mounted on<br />none&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 6.6M&nbsp; &nbsp; &nbsp;16.0k&nbsp; &nbsp; &nbsp; 6.6M&nbsp; &nbsp;0% /tmp<br />tmpfs&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;512.0k&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; 512.0k&nbsp; &nbsp;0% /dev<br />/dev/mtdblock5&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1.1M&nbsp; &nbsp; 196.0k&nbsp; &nbsp; 892.0k&nbsp; 18% /jffs<br />/jffs&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1.9M&nbsp; &nbsp; &nbsp; 1.9M&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 100% /</p><br /><p>Given that layout, does anybody have any idea how one is supposed to reflash the box?&nbsp; Would it be something like using mtd to put the .trx onto &quot;rootfs&quot;, and erasing &quot;rootfs_data&quot; ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p51476">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">ggp81</div>
					<div class="post-datetime">
						29 Jun 2007, 10:45					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Imagix wrote:</cite><blockquote><p>Compex&#039;s fork of OpenWRT does use the following as a partition table:</p><p>0x00000000-0x00010000 : &quot;MyLoader&quot;<br />0x00010000-0x00020000 : &quot;Partition Table&quot;<br />0x00020000-0x00030000 : &quot;lzma loader&quot;<br />0x00030000-0x00100000 : &quot;kernel&quot;<br />0x00100000-0x00400000 : &quot;rootfs&quot;<br />0x002f0000-0x00400000 : &quot;rootfs_data&quot;</p></blockquote></div><p>Yes, that&#039;s the same for me.<br />This is the proc/mtd for an official OpenWrt</p><div class="codebox"><pre><code>root@OpenWrt:~# cat /proc/mtd
dev:    size   erasesize  name
mtd0: 00040000 00010000 &quot;cfe&quot;
mtd1: 003b0000 00010000 &quot;linux&quot;
mtd2: 001e1c00 00010000 &quot;rootfs&quot;
mtd3: 00010000 00010000 &quot;nvram&quot;
mtd4: 00150000 00010000 &quot;OpenWrt&quot;</code></pre></div><p>Maybe we just have to type: mtd -r write firmware.bin kernel</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p51546">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">ubergeek01</div>
					<div class="post-datetime">
						30 Jun 2007, 08:20					</div>
				</div>
				<div class="post-content content">
					<p>I am having the same issue getting the original firmware back on my powerstation 2... Any help would be appreciated.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p51863">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">ggp81</div>
					<div class="post-datetime">
						5 Jul 2007, 12:59					</div>
				</div>
				<div class="post-content content">
					<p>Here is the diff file between Compex drivers/mtd/myloader.c and the official one for adm5120.</p><div class="codebox"><pre><code>43,46d42
&lt; 
&lt; static char *myloader_partitions_name[MYLO_MAX_PARTITIONS] =
&lt; {&quot;lzma loader&quot;, &quot;kernel&quot;, &quot;rootfs&quot;, &quot;reserved0&quot;, &quot;reserved1&quot;, &quot;reserved2&quot;, &quot;reserved3&quot;, &quot;reserved4&quot;};
&lt; 
142c138
&lt;   sprintf(names, myloader_partitions_name[i]);
---
&gt;   sprintf(names, &quot;partition%d&quot;, i);</code></pre></div><p>At Compex they suggest me to merge &quot;lzma loader&quot;, &quot;kernel&quot; and &quot;rootfs&quot; partitions.</p>											<p class="post-edited">(Last edited by <strong>ggp81</strong> on 5 Jul 2007, 13:31)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p52065">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">ggp81</div>
					<div class="post-datetime">
						10 Jul 2007, 12:14					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>ggp81 wrote:</cite><blockquote><p>At Compex they suggest me to merge &quot;lzma loader&quot;, &quot;kernel&quot; and &quot;rootfs&quot; partitions.</p></blockquote></div><p>at now I have no idea about how to do that <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p52088">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">ubergeek01</div>
					<div class="post-datetime">
						10 Jul 2007, 18:00					</div>
				</div>
				<div class="post-content content">
					<p>Me neither... why cant anything be easy like it was in white russian?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p52125">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">ubergeek01</div>
					<div class="post-datetime">
						11 Jul 2007, 04:25					</div>
				</div>
				<div class="post-content content">
					<p>Great News! its actually a lot simpler than I thought and remember... if you are looking to go back to the PS firmware, all you need to do is open up the case on the back of the powerstation, so you can see the internal LED&#039;s. then pull the power for a few seconds, plug it back in, and then hold the reset button until the &quot;rdy&quot; LED lights up in the top right corner... then go over to your computer, make sure you can ping the PS, then use a tftp program to send the file to the PS. 7 mins later and no more kamikaze!</p><p>I used a program called tftp2.exe to do this. very simple.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p52140">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">ggp81</div>
					<div class="post-datetime">
						11 Jul 2007, 12:01					</div>
				</div>
				<div class="post-content content">
					<p>My aim now is changing the table of partitions to let mtd command (mtd -r write firmware.bin linux) work correctly. I studied some of the WP54 OpenWrt source code (which is same as the official one, except for some few lines of myloader.c). This is what I found.</p><p>Referring to trunk/target/linux/adm5120-2.6/files/drivers/mtd/myloader.c, these appear to be the lines dealing with partitions.</p><div class="codebox"><pre><code>static char *myloader_partitions_name[MYLO_MAX_PARTITIONS] =
{&quot;lzma loader&quot;, &quot;kernel&quot;, &quot;rootfs&quot;, &quot;reserved0&quot;, &quot;reserved1&quot;, &quot;reserved2&quot;, &quot;reserved3&quot;, &quot;reserved4&quot;};

int parse_myloader_partitions(struct mtd_info *master,
            struct mtd_partition **pparts,
            unsigned long origin)
{
    struct mylo_partition_table *tab;
    struct mylo_partition *part;
    struct mtd_partition *mtd_parts;
    struct mtd_partition *mtd_part;

[...]

    mtd_parts = kzalloc((num_parts*sizeof(*mtd_part) + num_parts*NAME_LEN_MAX),
             GFP_KERNEL);

    if (!mtd_parts) {
        ret = -ENOMEM;
        goto out_free_buf;
    }

    mtd_part = mtd_parts;
    names = (char *)&amp;mtd_parts[num_parts];

    strncpy(names, NAME_MYLOADER, NAME_LEN_MAX-1);
    mtd_part-&gt;name = names;
    mtd_part-&gt;offset = 0;
    mtd_part-&gt;size = blocklen;
    mtd_part++;
    names += NAME_LEN_MAX;

    strncpy(names, NAME_PARTITION_TABLE, NAME_LEN_MAX-1);
    mtd_part-&gt;name = names;
    mtd_part-&gt;offset = blocklen;
    mtd_part-&gt;size = blocklen;
    mtd_part++;
    names += NAME_LEN_MAX;

    for (i = 0; i &lt; MYLO_MAX_PARTITIONS; i++) {
        part = &amp;tab-&gt;partitions[i];

        if (le16_to_cpu(part-&gt;type) == PARTITION_TYPE_FREE)
            continue;

        sprintf(names, myloader_partitions_name[i]);
        mtd_part-&gt;name = names;
        mtd_part-&gt;offset = le32_to_cpu(part-&gt;addr);
        mtd_part-&gt;size = le32_to_cpu(part-&gt;size);
        mtd_part++;
        names += NAME_LEN_MAX;
    }</code></pre></div><p>mtd_part is a pointer to a mtd_partition class, which is defined in trunk/toolchain_build_mipsel/linux/include/linux/mtd/partitions.h</p><div class="codebox"><pre><code>struct mtd_partition {
    char *name;            /* identifier string */
    u_int32_t size;            /* partition size */
    u_int32_t offset;        /* offset within the master MTD space */
    u_int32_t mask_flags;        /* master MTD flags to mask out for this partition */
    struct nand_ecclayout *ecclayout;    /* out of band layout for this partition (NAND only)*/
    struct mtd_info **mtdp;        /* pointer to store the MTD object */
};</code></pre></div><p>To let mtd command (mtd -r write firmware.bin linux) work correctly, I think I would merge &quot;lzma loader&quot; and &quot;kernel&quot; partitions into a &quot;linux&quot; one.<br />So:</p><div class="codebox"><pre><code>static char *myloader_partitions_name[MYLO_MAX_PARTITIONS] =
{&quot;linux&quot;, &quot;rootfs&quot;, &quot;reserved0&quot;, &quot;reserved1&quot;, &quot;reserved2&quot;, &quot;reserved3&quot;, &quot;reserved4&quot;, &quot;reserved5&quot;};</code></pre></div><p>My only problem now is: how can I assign the right value of start point and size of the partitions?<br />I think the key is in those lines.</p><div class="codebox"><pre><code>        mtd_part-&gt;offset = le32_to_cpu(part-&gt;addr);
        mtd_part-&gt;size = le32_to_cpu(part-&gt;size);</code></pre></div><p>part is a pointer to a mylo_partition class, which is defined in trunk/target/linux/adm5120-2.6/files/include/asm-mips/mach-adm5120/myloader.h as following:</p><div class="codebox"><pre><code>struct mylo_partition {
    uint16_t    flags;    /* partition flags */
    uint16_t    type;    /* type of the partition */
    uint32_t    addr;    /* relative address of the partition from the
                   flash start */
    uint32_t    size;    /* size of the partition in bytes */
    uint32_t    param;    /* if this is the active partition, the
                   MyLoader load code to this address */
};</code></pre></div><p>And an array of this struct is included into a mylo_partition_table</p><div class="codebox"><pre><code>struct mylo_partition_table {
    uint32_t    magic;    /* must be MYLO_MAGIC_PARTITIONS */
    uint32_t    res0;    /* unknown/unused */
    uint32_t    res1;    /* unknown/unused */
    uint32_t     res2;    /* unknown/unused */
    struct mylo_partition partitions[MYLO_MAX_PARTITIONS];
};</code></pre></div><p>So my only question is how to correctly inizialize this structure with the right values of the partitions.<br />Since OpenWrt is an open source software, I hope someone to have the way, but above all the time to give me just a little hint to solve my problem.<br />Any help would be strongly appreciated.<br />Thank you in advance and sorry for the disturb.</p>											<p class="post-edited">(Last edited by <strong>ggp81</strong> on 11 Jul 2007, 12:11)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p52214">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">ggp81</div>
					<div class="post-datetime">
						12 Jul 2007, 11:32					</div>
				</div>
				<div class="post-content content">
					<p>According to trunk/target/linux/adm5120-2.6/files/drivers/mtd/maps/adm5120_mtd.c, partitions are created after bootloader and nvram sizes and offsets are checked.<br />This file works on standard OpenWrt table partition (cfe, linux, rootfs, nvram, rootfs-data). I just have to understand how can it be linked to the edited myloader.c, with the new table partition</p><div class="codebox"><pre><code>struct mtd_partition * __init
init_mtd_partitions(struct mtd_info *mtd, size_t size)
{
    int cfe_size;

    if ((cfe_size = find_cfe_size(mtd,size)) &lt; 0)
        return NULL;

    /* boot loader */
    adm5120_cfe_parts[0].offset = 0;
    adm5120_cfe_parts[0].size   = cfe_size;

    /* nvram */
    if (cfe_size != 384 * 1024) {
        adm5120_cfe_parts[3].offset = size - ROUNDUP(NVRAM_SPACE, mtd-&gt;erasesize);
        adm5120_cfe_parts[3].size   = ROUNDUP(NVRAM_SPACE, mtd-&gt;erasesize);
    } else {
        /* nvram (old 128kb config partition on netgear wgt634u) */
        adm5120_cfe_parts[3].offset = adm5120_cfe_parts[0].size;
        adm5120_cfe_parts[3].size   = ROUNDUP(NVRAM_SPACE, mtd-&gt;erasesize);
    }

    /* linux (kernel and rootfs) */
    if (cfe_size != 384 * 1024) {
        adm5120_cfe_parts[1].offset = adm5120_cfe_parts[0].size;
        adm5120_cfe_parts[1].size   = adm5120_cfe_parts[3].offset -
            adm5120_cfe_parts[1].offset;
    } else {
        /* do not count the elf loader, which is on one block */
        adm5120_cfe_parts[1].offset = adm5120_cfe_parts[0].size +
            adm5120_cfe_parts[3].size + mtd-&gt;erasesize;
        adm5120_cfe_parts[1].size   = size -
            adm5120_cfe_parts[0].size -
            (2*adm5120_cfe_parts[3].size) -
            mtd-&gt;erasesize;
    }

    /* find and size rootfs */
    if (find_root(mtd,size,&amp;adm5120_cfe_parts[2])==0) {
        adm5120_cfe_parts[2].size = size - adm5120_cfe_parts[2].offset -
                adm5120_cfe_parts[3].size;
    }

    return adm5120_cfe_parts;
}</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p52751">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">OuterSpace</div>
					<div class="post-datetime">
						25 Jul 2007, 03:05					</div>
				</div>
				<div class="post-content content">
					<p>ggp81 any update ?</p><p>im stuck on this same thing.</p><p>Regards</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p52803">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">Imagix</div>
					<div class="post-datetime">
						25 Jul 2007, 19:02					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m another person looking to rewrite the flash from within OpenWRT w/ mtd.&nbsp; Have you tried using the svn code yet?&nbsp; They&#039;re doing a bunch of work on the adm5120 platform.&nbsp; On the current code set, if I build the image according to Compex&#039;s system, it won&#039;t boot anymore... but the stock image built by OpenWRT will....</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p52842">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">ggp81</div>
					<div class="post-datetime">
						26 Jul 2007, 10:33					</div>
				</div>
				<div class="post-content content">
					<p>At now I don&#039;t need so much any more this function.<br />Imagix you are right! I think pre-7.07 to be totally compatible with WP54 (I didn&#039;t test it). Official 7.07 will be (according to Compex), so I am waiting for that stable release.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p95644">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">Rolybrau</div>
					<div class="post-datetime">
						9 Oct 2009, 19:53					</div>
				</div>
				<div class="post-content content">
					<p>I have Linksys WRT 160NL and OpenWRT trunk from <a href="http://downloads.openwrt.org/snapshots/trunk/ar71xx/openwrt-ar71xx-wrt160nl-squashfs.b">http://downloads.openwrt.org/snapshots/ … squashfs.b</a></p><p>Partitions are</p><p>root@OpenWrt:/# df -h<br />Filesystem&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Size&nbsp; &nbsp; &nbsp; Used Available Use% Mounted on<br />/dev/root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1.3M&nbsp; &nbsp; &nbsp; 1.3M&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 100% /rom<br />tmpfs&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 14.4M&nbsp; &nbsp; &nbsp; 3.0M&nbsp; &nbsp; &nbsp;11.4M&nbsp; 21% /tmp<br />tmpfs&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;512.0K&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; 512.0K&nbsp; &nbsp;0% /dev<br />/dev/mtdblock3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 5.2M&nbsp; &nbsp; 292.0K&nbsp; &nbsp; &nbsp; 4.9M&nbsp; &nbsp;5% /jffs<br />mini_fo:/jffs&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1.3M&nbsp; &nbsp; &nbsp; 1.3M&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 100% /</p><br /><p>root@OpenWrt:/# cat /proc/mtd<br />dev:&nbsp; &nbsp; size&nbsp; &nbsp;erasesize&nbsp; name<br />mtd0: 00040000 00010000 &quot;u-boot&quot;<br />mtd1: 00140000 00010000 &quot;kernel&quot;<br />mtd2: 00660000 00010000 &quot;rootfs&quot;<br />mtd3: 00530000 00010000 &quot;rootfs_data&quot;<br />mtd4: 00010000 00010000 &quot;nvram&quot;<br />mtd5: 00010000 00010000 &quot;art&quot;<br />mtd6: 007a0000 00010000 &quot;firmware&quot;</p><p>Have upload to Linksys /tmp and renamed</p><p>mv openwrt-ar71xx-wrt160nl-squashfs.bin openwrt-ar71xx-wrt160nl-squashfs.trx</p><br /><p>What is the right command for &quot;mtd&quot;, &quot;linux&quot; is not there</p><p>root@OpenWrt:/tmp# mtd write openwrt-ar71xx-wrt160nl-squashfs.trx linux<br />Could not open mtd device: linux<br />Can&#039;t open device for writing!</p><p>Then I write</p><p>root@OpenWrt:/tmp#mtd -r write openwrt-ar71xx-wrt160nl-squashfs.trx kernel<br />Unlocking kernel ...<br />Writing from openwrt-ar71xx-wrt160nl-squashfs.trx to kernel ...&nbsp; [e]Failed to erase block</p><p>What ist right command to successfully flash the Router?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p118588">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">johnsgeorge</div>
					<div class="post-datetime">
						6 Oct 2010, 16:08					</div>
				</div>
				<div class="post-content content">
					<p>So can you please tell the method to reflash the router. </p><p>When i tried &quot;mtd -r write openwrt-atheros-ubnt2-squashfs.trx linux&quot;, i am getting the following errors</p><p>&quot;Could not open mtd device: linux<br />Can&#039;t open device for writing!&quot;</p><br /><p>The cat /proc/mtd output is</p><p>dev:&nbsp; &nbsp; size&nbsp; &nbsp;erasesize&nbsp; name<br />mtd0: 00030000 00010000 &quot;RedBoot&quot;<br />mtd1: 000d0000 00010000 &quot;kernel&quot;<br />mtd2: 002e0000 00010000 &quot;rootfs&quot;<br />mtd3: 00130000 00010000 &quot;rootfs_data&quot;<br />mtd4: 0000f000 0000f000 &quot;FIS directory&quot;<br />mtd5: 00001000 00001000 &quot;RedBoot config&quot;<br />mtd6: 00010000 00010000 &quot;boardconfig&quot;</p><p>If i do&nbsp; mtd -r write Bullet2-v3.5.1.build4631.bin rootfs i am getting</p><p>Unlocking rootfs ...<br />Writing from Bullet2-v3.5.1.build4631.bin to rootfs ...&nbsp; [e]Failed to erase block</p><p>Could any of you help me to fix this problem of reflashing the bullet as i am stuck in this.</p><p>Thanks<br />Johns</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p118598">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						6 Oct 2010, 17:20					</div>
				</div>
				<div class="post-content content">
					<p>sysupgrade openwrt-atheros-combined-squashfs.bin</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p118663">
				<div class="post-metadata">
					<div class="post-num">Post #21</div>
					<div class="post-author">johnsgeorge</div>
					<div class="post-datetime">
						7 Oct 2010, 14:10					</div>
				</div>
				<div class="post-content content">
					<p>Thank you Jow, your reply helped me to find the solution</p><p>I got the solution for my problem and i have explained it below</p><p>When we make the binaries using the command &quot;make&quot; (or make V=99), <br />openwrt-atheros-combined.squashfs.img will be created in /bin/atheros/ along with other binaries.</p><p>copy this to the /tmp folder in the router, and execute the command <br />&quot;sysupgrade openwrt-atheros-combined.squashfs.img &quot;</p><p>I have attached the logs which i got after executing&nbsp; the command</p><p>root@OpenWrt:/tmp# /sbin/sysupgrade openwrt-atheros-combined.squashfs.img<br />Saving config files...<br />Switching to ramdisk...<br />mount: mounting mini_fo:/jffs on /mnt failed: Function not implemented<br />Performing system upgrade...<br />Unlocking kernel ...<br />Unlocking rootfs ...<br />Writing from &lt;stdin&gt; to kernel ...&nbsp; &nbsp; &nbsp;<br />Writing from &lt;stdin&gt; to rootfs ...&nbsp; &nbsp; &nbsp;<br />Appending jffs2 data from /tmp/sysupgrade.tgz to rootfs...<br />Updating FIS table... <br />Rebooting ...</p><p>Now once the router is up after the reboot, you will be able to connect to it using the ip you have configured or else with 192.168.1.1</p><p>You can also upgrade the firmware from the web browser <a href="http://192.168.1.100/cgi-bin/luci/;stok=.........................../admin/system/upgrade/">http://192.168.1.100/cgi-bin/luci/;stok … m/upgrade/</a><br />Just browse and select the openwrt-atheros-combined.squashfs.img file.<br />It will upgrade and reboot. If you have changed the ip address then use the new ip after upgrade</p><p>Thank you for all your help<br />Johns</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p119320">
				<div class="post-metadata">
					<div class="post-num">Post #22</div>
					<div class="post-author">maxidvd</div>
					<div class="post-datetime">
						19 Oct 2010, 17:23					</div>
				</div>
				<div class="post-content content">
					<p>i don&#039;t how can i flash my original .bin...<br />what is make command?<br />what is /sbin/sysupgrade openwrt-atheros-combined.squashfs.img???&nbsp; how do i get this???</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p119323">
				<div class="post-metadata">
					<div class="post-num">Post #23</div>
					<div class="post-author">johnsgeorge</div>
					<div class="post-datetime">
						19 Oct 2010, 17:38					</div>
				</div>
				<div class="post-content content">
					<p>You can flash the .bin file using tftp<br /><a href="http://www.ubnt.com/wiki/Installing_OpenWRT_on_NanoStations/Bullets">http://www.ubnt.com/wiki/Installing_Ope … ns/Bullets</a></p><p>make command is for compiling and generating the .bin file manually.<br />The .img file and .bin files will be generated once we execute the make command.</p><p>If you don&#039;t want to generate the files, you can get all the required files from the repository and flash it.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p119325">
				<div class="post-metadata">
					<div class="post-num">Post #24</div>
					<div class="post-author">maxidvd</div>
					<div class="post-datetime">
						19 Oct 2010, 17:45					</div>
				</div>
				<div class="post-content content">
					<p>i can only access through ssh... no telnet, no tftp, no web (luci)<br />that&#039;s i want to remove Openwrt... it worked well for only 6h:)</p><p>Thanks for helping!!!</p>											<p class="post-edited">(Last edited by <strong>maxidvd</strong> on 19 Oct 2010, 20:21)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p119462">
				<div class="post-metadata">
					<div class="post-num">Post #25</div>
					<div class="post-author">maxidvd</div>
					<div class="post-datetime">
						21 Oct 2010, 14:25					</div>
				</div>
				<div class="post-content content">
					<p>up, and...<br />how can i put the file into the router with scp?</p>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 1 of 2</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=11393&amp;p=2.html">2</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>