<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Installing OpenWrt in Xiaomi Wifi Mini</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 8 Feb 2018 and 5 May 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 6 of 21</div><nav><ul><li><a href="viewtopic.php%3Fid=54987&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=54987&amp;p=4.html">4</a></li><li><a href="viewtopic.php%3Fid=54987&amp;p=5.html">5</a></li><li class="pagination-current"><span>6</span></li><li><a href="viewtopic.php%3Fid=54987&amp;p=7.html">7</a></li><li><a href="viewtopic.php%3Fid=54987&amp;p=8.html">8</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=54987&amp;p=21.html">21</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p302545">
				<div class="post-metadata">
					<div class="post-num">Post #126</div>
					<div class="post-author">jjmmdanp</div>
					<div class="post-datetime">
						5 Dec 2015, 22:17					</div>
				</div>
				<div class="post-content content">
					<p>Hello</p><p>Can someone translate and try this ? <a href="http://admin-to-admin.info/blog/proshivka-xiaomi-mi-router-mini-na-padavan/">http://admin-to-admin.info/blog/proshiv … a-padavan/</a></p><p><a href="https://gitlab.com/Track/xrmwrt">https://gitlab.com/Track/xrmwrt</a></p><p>Edit:</p><p><a href="https://www.youtube.com/watch?v=Dv0gfVqFLYU">https://www.youtube.com/watch?v=Dv0gfVqFLYU</a></p><p><a href="https://yadi.sk/d/nEQ2JO6LiXFNm">https://yadi.sk/d/nEQ2JO6LiXFNm</a>&nbsp; Inside instructions in file .txt ( use google translate)</p><p>The last version (?) is this : <a href="http://routerclub.ru/upload/padavan/nightly/20151113/xrm_base/">http://routerclub.ru/upload/padavan/nig … /xrm_base/</a></p><p>Easy, follow the instructions on this site: <a href="http://wifika.ru/proshivka-routera-xiaomi-wifi-mini-ot-padavan-ili-asus.html">http://wifika.ru/proshivka-routera-xiao … -asus.html</a></p><p>Edit: </p><p>Wow, works greate. English language.&nbsp; &nbsp; &nbsp; &nbsp;<br />Operation Mode: AP-Client + AP</p><p><a href="http://imgur.com/BMKOpFF">http://imgur.com/BMKOpFF</a></p><p>JM</p><p>Portugal</p>											<p class="post-edited">(Last edited by <strong>jjmmdanp</strong> on 6 Dec 2015, 21:08)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p302659">
				<div class="post-metadata">
					<div class="post-num">Post #127</div>
					<div class="post-author">UbuntuInMacBook</div>
					<div class="post-datetime">
						6 Dec 2015, 23:24					</div>
				</div>
				<div class="post-content content">
					<p>I ordered Xiaomi mini router and nano (youth) routers from Aliexpress. Now ugraded OpenWrt to mini. I don&#039;t wan&#039;t to open nano, because I am not a HW guy.</p><p>I opened xiaomi nano firmware fs and seems that there is /bin/flash.sh file. Is that common OpenWrt file or specific Xiaomi file? Maybe this file is called from router settings page?<br />Maybe it would be possible to modify flash.sh script in a way that it accept PandoraBox-ralink-mt7628-xiaomi-r1cl-squashfs-sysupgrade-r1468-20151001.bin file.</p><p>flash.sh file:</p><p>#!/bin/sh<br />#</p><p>. /lib/upgrade/common.sh</p><p>klogger(){<br />&nbsp; &nbsp; local msg1=&quot;$1&quot;<br />&nbsp; &nbsp; local msg2=&quot;$2&quot;</p><p>&nbsp; &nbsp; if [ &quot;$msg1&quot; = &quot;-n&quot; ]; then<br />&nbsp; &nbsp; &nbsp; &nbsp; echo&nbsp; -n &quot;$msg2&quot; &gt;&gt; /dev/kmsg 2&gt;/dev/null<br />&nbsp; &nbsp; else<br />&nbsp; &nbsp; &nbsp; &nbsp; echo &quot;$msg1&quot; &gt;&gt; /dev/kmsg 2&gt;/dev/null<br />&nbsp; &nbsp; fi</p><p>&nbsp; &nbsp; return 0<br />}</p><p>hndmsg() {<br />&nbsp; &nbsp; if [ -n &quot;$msg&quot; ]; then<br />&nbsp; &nbsp; &nbsp; &nbsp; echo &quot;$msg&quot; &gt;&gt; /dev/kmsg 2&gt;/dev/null<br />&nbsp; &nbsp; &nbsp; &nbsp; if [ `pwd` = &quot;/tmp&quot; ]; then<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rm -rf $filename 2&gt;/dev/null<br />&nbsp; &nbsp; &nbsp; &nbsp; fi<br />&nbsp; &nbsp; &nbsp; &nbsp; exit 1<br />&nbsp; &nbsp; fi<br />}</p><p>upgrade_uboot() {<br />&nbsp; &nbsp; if [ -f uboot.bin ]; then<br />&nbsp; &nbsp; &nbsp; &nbsp; klogger -n &quot;Burning uboot...&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; mtd write uboot.bin Bootloader &gt;&amp; /dev/null<br />&nbsp; &nbsp; &nbsp; &nbsp; if [ $? -eq 0 ]; then<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; klogger &quot;Done&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; else<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; klogger &quot;Error&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; exit 1<br />&nbsp; &nbsp; &nbsp; &nbsp; fi<br />&nbsp; &nbsp; fi<br />}</p><p>upgrade_firmware() {<br />&nbsp; &nbsp; if [ -f firmware.bin ]; then<br />&nbsp; &nbsp; &nbsp; &nbsp; klogger -n &quot;Burning firmware...&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; mtd -r write firmware.bin OS1 &gt;&amp; /dev/null<br />&nbsp; &nbsp; &nbsp; &nbsp; if [ $? -eq 0 ]; then<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; klogger &quot;Done&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; else<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; klogger &quot;Error&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; exit 1<br />&nbsp; &nbsp; &nbsp; &nbsp; fi<br />&nbsp; &nbsp; fi<br />}</p><br /><p>if [ $# = 0 ] || [ $# -gt 2 ] ; then<br />&nbsp; &nbsp; klogger &quot;USAGE: $0 factory.bin 0(0:reboot, 1:don&#039;t reboot)&quot;<br />&nbsp; &nbsp; exit 1;<br />fi</p><p>#check pid exist<br />pid_file=&quot;/tmp/pid_xxxx&quot;<br />if [ -f $pid_file ]; then<br />&nbsp; &nbsp; exist_pid=`cat $pid_file`<br />&nbsp; &nbsp; if [ -n $exist_pid ]; then<br />&nbsp; &nbsp; &nbsp; &nbsp; kill -0 $exist_pid 2&gt;/dev/null<br />&nbsp; &nbsp; &nbsp; &nbsp; if [ $? -eq 0 ]; then<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; klogger &quot;Upgrading, exit... $?&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; exit 1<br />&nbsp; &nbsp; &nbsp; &nbsp; else<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo $$ &gt; $pid_file<br />&nbsp; &nbsp; &nbsp; &nbsp; fi<br />&nbsp; &nbsp; else<br />&nbsp; &nbsp; &nbsp; &nbsp; echo $$ &gt; $pid_file<br />&nbsp; &nbsp; fi<br />else<br />&nbsp; &nbsp; echo $$ &gt; $pid_file<br />fi</p><p>_ver=`cat /usr/share/xiaoqiang/xiaoqiang_version`<br />klogger &quot;Begin Ugrading..., current version: $_ver&quot;</p><p>echo 3 &gt; /proc/sys/vm/drop_caches<br />sync</p><p>[ -f $1 ] || msg=&quot;dir: $1 is not existed, upgrade failed&quot;<br />hndmsg</p><p>dir_name=`dirname $1`<br />klogger &quot;Change Dir to: $dir_name&quot;<br />cd $dir_name</p><p>filename=`basename $1`<br />[ -f $filename ] || msg=&quot;file: $filename is not existed, upgrade failed&quot;<br />hndmsg</p><p>klogger -n &quot;Verify Image: $filename...&quot;<br />mkxqimage -v $filename || msg=&quot;Check Failed!!!&quot;<br />hndmsg<br />klogger &quot;Checksum O.K.&quot;<br />echo 32 &gt; /proc/sys/vm/pagecache_limit_mb</p><p>wifi down<br />rmmod mt7628</p><br /><p>if [ -f &quot;/etc/init.d/sysapihttpd&quot; ] ;then<br />&nbsp; &nbsp; /etc/init.d/sysapihttpd stop 2&gt;/dev/null<br />fi</p><p>if [ $dir_name != &quot;/tmp&quot; ]; then<br />&nbsp; &nbsp; klogger &quot;Change Dir to /tmp&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; cp $1 /tmp<br />&nbsp; &nbsp; &nbsp; &nbsp; cd /tmp<br />fi</p><p># gently stop pppd, let it close pppoe session<br />ifdown wan<br />timeout=5<br />while [ $timeout -gt 0 ]; do<br />&nbsp; &nbsp; pidof pppd &gt;/dev/null || break<br />&nbsp; &nbsp; sleep 1<br />&nbsp; &nbsp; let timeout=timeout-1<br />done</p><p># clean up upgrading environment<br /># call shutdown scripts with some exceptions<br />wait_stat=0<br />klogger &quot;Calling shutdown scripts&quot;<br />for i in /etc/rc.d/K*; do<br />&nbsp; &nbsp; # filter out K01reboot-wdt and K99umount<br />&nbsp; &nbsp; echo &quot;$i&quot; | grep -q &#039;[0-9]\{1,100\}reboot-wdt$&#039;<br />&nbsp; &nbsp; if [ $? -eq 0 ]<br />&nbsp; &nbsp; then<br />&nbsp; &nbsp; &nbsp; &nbsp; klogger &quot;$i skipped&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; continue<br />&nbsp; &nbsp; fi<br />&nbsp; &nbsp; echo &quot;$i&quot; | grep -q &#039;[0-9]\{1,100\}umount$&#039;<br />&nbsp; &nbsp; if [ $? -eq 0 ]<br />&nbsp; &nbsp; then<br />&nbsp; &nbsp; &nbsp; &nbsp; klogger &quot;$i skipped&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; continue<br />&nbsp; &nbsp; fi</p><p>&nbsp; &nbsp; if [ ! -x &quot;$i&quot; ]<br />&nbsp; &nbsp; then<br />&nbsp; &nbsp; &nbsp; &nbsp; continue<br />&nbsp; &nbsp; fi</p><p>&nbsp; &nbsp; # wait for high-priority K* scripts to finish<br />&nbsp; &nbsp; echo &quot;$i&quot; | grep -qE &quot;K9&quot;<br />&nbsp; &nbsp; if [ $? -eq 0 ]<br />&nbsp; &nbsp; then<br />&nbsp; &nbsp; &nbsp; &nbsp; if [ $wait_stat -eq 0 ]<br />&nbsp; &nbsp; &nbsp; &nbsp; then<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wait<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sleep 2<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wait_stat=1<br />&nbsp; &nbsp; &nbsp; &nbsp; fi<br />&nbsp; &nbsp; &nbsp; &nbsp; $i shutdown 2&gt;&amp;1<br />&nbsp; &nbsp; else<br />&nbsp; &nbsp; &nbsp; &nbsp; $i shutdown 2&gt;&amp;1 &amp;<br />&nbsp; &nbsp; fi<br />done</p><p># try to kill all userspace processes<br /># at this point the process tree should look like<br /># init(1)---sh(***)---flash.sh(***)<br />for i in $(ps w | grep -v &quot;flash.sh&quot; | grep -v &quot;/bin/ash&quot; | grep -v &quot;PID&quot; | awk &#039;{print $1}&#039;); do<br />&nbsp; &nbsp; &nbsp; &nbsp; if [ $i -gt 100 ]; then<br />&nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;kill -9 $i 2&gt;/dev/null<br />&nbsp; &nbsp; &nbsp; &nbsp; fi<br />done</p><p>gpio 1 1<br />gpio 3 1<br />gpio l 44 2 2 1 0 4000 #led yellow flashing</p><p>#update nvram setting when upgrading<br />if [ &quot;$2&quot; = &quot;1&quot; ]; then<br />&nbsp; &nbsp; nvram set restore_defaults=1<br />&nbsp; &nbsp; klogger &quot;Restore defaults is set.&quot;<br />else<br />&nbsp; &nbsp; nvram set restore_defaults=2<br />fi<br />nvram set flag_flash_permission=0<br />nvram set flag_ota_reboot=1<br />nvram set flag_upgrade_push=1<br />nvram commit</p><p># tell server upgrade is finished<br />uci set /etc/config/messaging.deviceInfo.UPGRADE_STATUS_UPLOAD=0<br />uci commit<br />klogger &quot;messaging.deviceInfo.UPGRADE_STATUS_UPLOAD=`uci get /etc/config/messaging.deviceInfo.UPGRADE_STATUS_UPLOAD`&quot;<br />klogger &quot;/etc/config/messaging : `cat /etc/config/messaging`&quot;</p><p># prepare the minimum working environment<br />mount -o remount,size=100% /tmp<br />lib_list=&quot;/lib/ld-uClibc.so.0 /lib/libc.so.0 /lib/libdl.so.0 /lib/libm.so.0 \<br />/lib/libubox.so /lib/libcrypt.so.0 /lib/libgcc_s.so.1 /usr/lib/libcrypto.so.1.0.0&quot;<br />bin_list=&quot;/bin/busybox /bin/ash /bin/sh /bin/cat /bin/mount /bin/umount \<br />/bin/mkxqimage /sbin/reboot /usr/sbin/nvram&quot;</p><p>mkdir -p /tmp/update_environment/lib<br />mkdir -p /tmp/update_environment/bin<br />mkdir -p /tmp/update_environment/proc<br />mkdir -p /tmp/update_environment/dev<br />mkdir -p /tmp/update_environment/usr/share/xiaoqiang/<br />for lib in $lib_list<br />do<br />&nbsp; &nbsp; if [ -e $lib ]<br />&nbsp; &nbsp; then<br />&nbsp; &nbsp; &nbsp; &nbsp; cp -L $lib /tmp/update_environment/lib<br />&nbsp; &nbsp; else<br />&nbsp; &nbsp; &nbsp; &nbsp; # in case the lib_list is outdated, abort early<br />&nbsp; &nbsp; &nbsp; &nbsp; msg=&quot;Lib $lib not found&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; hndmsg<br />&nbsp; &nbsp; &nbsp; &nbsp; reboot -f<br />&nbsp; &nbsp; fi<br />done<br />for bin in $bin_list<br />do<br />&nbsp; &nbsp; if [ -e $bin ]<br />&nbsp; &nbsp; then<br />&nbsp; &nbsp; &nbsp; &nbsp; cp -P $bin /tmp/update_environment/bin<br />&nbsp; &nbsp; else<br />&nbsp; &nbsp; &nbsp; &nbsp; # in case the bin_list is outdated, abort early<br />&nbsp; &nbsp; &nbsp; &nbsp; msg=&quot;Bin $bin not found&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; hndmsg<br />&nbsp; &nbsp; &nbsp; &nbsp; reboot -f<br />&nbsp; &nbsp; fi<br />done<br />cp /usr/share/xiaoqiang/public.pem /tmp/update_environment/usr/share/xiaoqiang/<br />mv $filename /tmp/$filename<br />pivot /tmp/update_environment /old_root &amp;&amp; {<br />&nbsp; &nbsp; umount -l /old_root<br />&nbsp; &nbsp; klogger &quot;Switch to ram-based rootfs&quot;<br />}</p><p>klogger -n &quot;Begin Upgrading and Rebooting...&quot;<br />mkxqimage -w /tmp/$filename || msg=&quot;Upgrade Failed!!!&quot;<br />hndmsg</p>											<p class="post-edited">(Last edited by <strong>UbuntuInMacBook</strong> on 6 Dec 2015, 23:45)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p302661">
				<div class="post-metadata">
					<div class="post-num">Post #128</div>
					<div class="post-author">netomx</div>
					<div class="post-datetime">
						6 Dec 2015, 23:56					</div>
				</div>
				<div class="post-content content">
					<p>The problem is how to call that function</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p302664">
				<div class="post-metadata">
					<div class="post-num">Post #129</div>
					<div class="post-author">UbuntuInMacBook</div>
					<div class="post-datetime">
						7 Dec 2015, 00:13					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>netomx wrote:</cite><blockquote><p>The problem is how to call that function</p></blockquote></div><p>My assumption was that this function is called from configuration web page, but before that it verify file. Maybe verify function is also in this same script.<br />Now I got error &quot;Couldn&#039;t verify file&quot;.</p><p>If that is true, then just modify script in the binary file and update this first to router.</p>											<p class="post-edited">(Last edited by <strong>UbuntuInMacBook</strong> on 7 Dec 2015, 00:21)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p302667">
				<div class="post-metadata">
					<div class="post-num">Post #130</div>
					<div class="post-author">UbuntuInMacBook</div>
					<div class="post-datetime">
						7 Dec 2015, 00:37					</div>
				</div>
				<div class="post-content content">
					<p>Or just add crontab wich run wget and then flash binary... just easy <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /><br />1) cd /tmp<br />2) wget <a href="http://downloads.openwrt.org.cn/PandoraBox/Xiaomi_R1CL/firmware/testing/PandoraBox-ralink-mt7628-xiaomi-r1cl-squashfs-sysupgrade-r1468-20151001.bin">http://downloads.openwrt.org.cn/Pandora … 151001.bin</a><br />3) mtd -r write PandoraBox-ralink-mt7628-xiaomi-r1cl-squashfs-sysupgrade-r1468-20151001.bin OS1 </p><p>What do you think could it work?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p303042">
				<div class="post-metadata">
					<div class="post-num">Post #131</div>
					<div class="post-author">santamanno</div>
					<div class="post-datetime">
						9 Dec 2015, 15:49					</div>
				</div>
				<div class="post-content content">
					<p>I believe you&#039;ve been looking in the wrong place <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p><p>1. /usr/sbin/checkupgrade.lua<br />2. /usr/lib/lua/xiaoqiang/util/XQSysUtil.lua:verifyImage()<br />3. /usr/lib/lua/xiaoqiang/util/XQSysUtil.lua:getMiscHardwareInfo()</p><p>Which fetches</p><p>4. option verify &#039;cd /tmp;mkxqimage -v &#039;, from uci/misc config</p><p>And runs the &quot;mkxqimage -v&quot; file. &#039;-v&#039; for verify (or Vendetta!) I guess.</p><p>From that point on is easy, replace /bin/mkxqimage or disassemble <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p><p>[EDIT]<br />By the way &quot;nvram set ssh_en 1&quot; is the ssh enabling command.</p>											<p class="post-edited">(Last edited by <strong>santamanno</strong> on 9 Dec 2015, 16:11)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p303071">
				<div class="post-metadata">
					<div class="post-num">Post #132</div>
					<div class="post-author">StrangeOrange</div>
					<div class="post-datetime">
						9 Dec 2015, 20:35					</div>
				</div>
				<div class="post-content content">
					<p>I bought this router recently and immediately re-flashed it with the most recent stable (Chaos Calmer). At first glance all seemed to work with no errors appearing but I experienced the performance issues others had described before (weak signal, slow speeds, connection dying off when idle and requiring reconnect). While looking around to see what solutions are available I found this thread. Thanks to all the contributors for all the helpful bits of information.</p><p>To share my experience, while OpenWrt performance seems to be marginally better with the <a href="https://downloads.openwrt.org/snapshots/trunk/ramips/mt7620/openwrt-ramips-mt7620-miwifi-mini-squashfs-sysupgrade.bin">trunk branch</a> (Designated Driver), after <a href="https://dev.openwrt.org/ticket/20369">some patches were committed</a>, it&#039;s still a far cry from what the device should be capable of.</p><p>In a very unscientific way, I compared some of the firmwares circulating around. The results, in the order of decreasing performance, are as follows:<br /></p><ol class="decimal"><li><p><a href="http://downloads.openwrt.org.cn/PandoraBox/Xiaomi-Mini-R1CM/testing/PandoraBox-ralink-mt7620-xiaomi-mini-squashfs-sysupgrade-r1216-20150721.bin">PandoraBox r1216 (2015-07-21)</a> (<a href="https://github.com/luyujun/pandorabox">source</a>)</p></li><li><p><a href="http://rssn.cn/roms/openwrt-ramips-mt7620a-xiaomi-miwifi-mini-squashfs-sysupgrade.bin">OpenWrt w/RSSN Patch (2015-12-06)</a> (<a href="https://github.com/rssnsj/openwrt-xiaomi-mini">source</a>)</p></li><li><p><a href="https://routerclub.ru/upload/padavan/nightly/20151113/xrm_base/MI-MINI_3.4.3.9-097.trx">Padavan (2015-11-13)</a> (<a href="https://gitlab.com/Track/xrmwrt">source</a>)</p></li><li><p><a href="https://downloads.openwrt.org/snapshots/trunk/ramips/mt7620/openwrt-ramips-mt7620-miwifi-mini-squashfs-sysupgrade.bin">OpenWrt Designated Driver (2015-11-22)</a></p></li><li><p><a href="https://downloads.openwrt.org/chaos_calmer/15.05/ramips/mt7620/openwrt-15.05-ramips-mt7620-xiaomi-miwifi-mini-squashfs-sysupgrade.bin">OpenWrt Chaos Calmer 15.05 (2015-09-14)</a></p></li></ol><p>To quantify, OpenWrt&#039;s performance seems to be at around 33% to 50% of Pandora Box&#039;s in terms of speed. I understand this is due to MediaTek (RaLink)&#039;s disregard for the open source community. It would be really great if this gap is eventually bridged though.</p><p>As an aside, upgrading from stable to trunk I was cut off from SSH in a weird way, which didn&#039;t happen with another access point I was upgrading at the same time (TL-WR1043NDv1). Perhaps this was due to the <a href="https://dev.openwrt.org/changeset/46617/">device name change</a> and that I chose to preserve the settings but I didn&#039;t investigate the exact reason so it&#039;s just a rough guess.</p><p><span style="color: green"><strong>Edit / Question: Has anyone been able to successfully use failsafe mode to login over SSH (or Telnet) with this device?</strong> For me, it boots into failsafe mode correctly (confirmed by the rapid LED flashing) and the first UDP packet is received too but then it doesn&#039;t respond to pings nor does it accept any SSH connections (also checked Telnet just in case). I tried with each of the 3 Ethernet ports, starting from a separate boot, and also confirmed the failsafe mode works fine with another device I have access to (TL-WR1043NDv1) to exclude a problem with my setup as a potential cause. This happens with the latest trunk (r47548 of 2015-11-22), haven&#039;t checked other versions. Perhaps the cause is similar to <a href="https://dev.openwrt.org/ticket/6922">this resolved bug</a>, as this router has some ports not connected to any physical interface?</span></p>											<p class="post-edited">(Last edited by <strong>StrangeOrange</strong> on 10 Dec 2015, 09:57)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p303436">
				<div class="post-metadata">
					<div class="post-num">Post #133</div>
					<div class="post-author">stamasd</div>
					<div class="post-datetime">
						12 Dec 2015, 17:43					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>StrangeOrange wrote:</cite><blockquote><p><span style="color: green"><strong>Edit / Question: Has anyone been able to successfully use failsafe mode to login over SSH (or Telnet) with this device?</strong> For me, it boots into failsafe mode correctly (confirmed by the rapid LED flashing) and the first UDP packet is received too but then it doesn&#039;t respond to pings nor does it accept any SSH connections (also checked Telnet just in case).?</span></p></blockquote></div><p>I see this exact same behavior.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p303437">
				<div class="post-metadata">
					<div class="post-num">Post #134</div>
					<div class="post-author">santamanno</div>
					<div class="post-datetime">
						12 Dec 2015, 17:43					</div>
				</div>
				<div class="post-content content">
					<p>In case you want to skip all the Xiaomi download etc, here are some instructions to <strong>flash directly OpenWRT/PandoraBox on stock firmware</strong> via code injection bug.</p><p><strong>NOTE</strong><br />This method has been successfully tested on<br />-&gt; Xiaomi Mini - Stock firmware v2.6.17<br />-&gt; Xiaomi Lite aka &quot;Youth&quot; or &quot;Nano&quot; - Stock firmware v2.2.8</p><p><strong>STEPS</strong><br />1) Power on and setup the Xiaomi router until it reboots and gets IP address 192.168.31.1<br />2) Log-in into the router and grab the value of the <em>stok</em> URL parameter (for instance: &quot;9c2428de4d17e2db7e5a6a337e6f57a3&quot;)<br />3) Replace the <strong>&lt;STOK&gt;</strong> placeholder and load this URL in your browser or curl, this will start telnetd on the router:</p><p><a href="http://192.168.31.1/cgi-bin/luci/;stok=">http://192.168.31.1/cgi-bin/luci/;stok=</a><strong>&lt;STOK&gt;</strong>/api/xqnetwork/set_wifi_ap?ssid=whatever&amp;encryption=NONE&amp;enctype=NONE&amp;channel=1%3B%2Fusr%2Fsbin%2Ftelnetd</p><p>It should spit out some wifi error code, that is ok, don&#039;t worry.</p><p>4) Replace the &lt;STOK&gt; placeholder, the current password and the desired root password and load this URL in your browser or curl, this will set the router root password</p><p><a href="http://192.168.31.1/cgi-bin/luci/;stok=">http://192.168.31.1/cgi-bin/luci/;stok=</a><strong>&lt;STOK&gt;</strong>/api/xqsystem/set_name_password?oldPwd=<strong>&lt;CURRENTPASS&gt;</strong>&amp;newPwd=<strong>&lt;NEWPASS&gt;</strong></p><p>It should spit out: <em>{&quot;code&quot;:0}</em></p><p>5) Telnet to the router, enter user root and NEWPASS chosen above.</p><p>6) wget your favourite .bin and flash with mtd -r write firmware.bin OS1</p><p>7) Router reboots <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p><p>Hope it helps, just wanted to give back my two cents to the community.</p>											<p class="post-edited">(Last edited by <strong>santamanno</strong> on 13 Dec 2015, 22:09)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p303447">
				<div class="post-metadata">
					<div class="post-num">Post #135</div>
					<div class="post-author">anarchy99</div>
					<div class="post-datetime">
						12 Dec 2015, 20:22					</div>
				</div>
				<div class="post-content content">
					<p>very good, between 5 and 6 you can run: </p><p>nvram set uart_en=1<br />nvram commit</p><p> to enable serial console.</p>											<p class="post-edited">(Last edited by <strong>anarchy99</strong> on 12 Dec 2015, 20:25)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p303459">
				<div class="post-metadata">
					<div class="post-num">Post #136</div>
					<div class="post-author">Benik3</div>
					<div class="post-datetime">
						12 Dec 2015, 23:24					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>StrangeOrange wrote:</cite><blockquote><p><span style="color: green"><strong>Edit / Question: Has anyone been able to successfully use failsafe mode to login over SSH (or Telnet) with this device?</strong> For me, it boots into failsafe mode correctly (confirmed by the rapid LED flashing) and the first UDP packet is received too but then it doesn&#039;t respond to pings nor does it accept any SSH connections (also checked Telnet just in case). I tried with each of the 3 Ethernet ports, starting from a separate boot, and also confirmed the failsafe mode works fine with another device I have access to (TL-WR1043NDv1) to exclude a problem with my setup as a potential cause. This happens with the latest trunk (r47548 of 2015-11-22), haven&#039;t checked other versions. Perhaps the cause is similar to <a href="https://dev.openwrt.org/ticket/6922">this resolved bug</a>, as this router has some ports not connected to any physical interface?</span></p></blockquote></div><p>Don&#039;t you need also support in U-BOOT for this?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p303483">
				<div class="post-metadata">
					<div class="post-num">Post #137</div>
					<div class="post-author">zhuoyang</div>
					<div class="post-datetime">
						13 Dec 2015, 08:42					</div>
				</div>
				<div class="post-content content">
					<p>Is there anyway to enable vlan tagging up to 4096 ?<br />My ISP needs vlan 500 for connecting to internet</p>											<p class="post-edited">(Last edited by <strong>zhuoyang</strong> on 13 Dec 2015, 11:04)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p303496">
				<div class="post-metadata">
					<div class="post-num">Post #138</div>
					<div class="post-author">StrangeOrange</div>
					<div class="post-datetime">
						13 Dec 2015, 13:52					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>santamanno wrote:</cite><blockquote><p>...</p></blockquote></div><p> This is an amazing hack, wish I knew about it before, as I needed to unlock it the pedestrian way. If you could just specify the version it worked with, as I think they&#039;ll patch it up eventually.</p><div class="quotebox"><cite>Benik3 wrote:</cite><blockquote><div class="quotebox"><cite>StrangeOrange wrote:</cite><blockquote><p><span style="color: green"><strong>Edit / Question: Has anyone been able to successfully use failsafe mode to login over SSH (or Telnet) with this device?</strong> For me, it boots into failsafe mode correctly (confirmed by the rapid LED flashing) and the first UDP packet is received too but then it doesn&#039;t respond to pings nor does it accept any SSH connections (also checked Telnet just in case). I tried with each of the 3 Ethernet ports, starting from a separate boot, and also confirmed the failsafe mode works fine with another device I have access to (TL-WR1043NDv1) to exclude a problem with my setup as a potential cause. This happens with the latest trunk (r47548 of 2015-11-22), haven&#039;t checked other versions. Perhaps the cause is similar to <a href="https://dev.openwrt.org/ticket/6922">this resolved bug</a>, as this router has some ports not connected to any physical interface?</span></p></blockquote></div><p> Don&#039;t you need also support in U-BOOT for this?</p></blockquote></div><p>I don&#039;t see why that should be the case. Basically the bootloader just loads the kernel, which then takes full control. OpenWrt documentation does not mention such a precondition anywhere and my TL-WR1043NDv1 with stock bootloader can be accessed in failsafe mode without problems. Further, the bootloader cannot distinguish between failsafe and regular mode because which mode the device will boot into is determined by the press of a button after the bootloader has already completed, so if this were caused by the bootloader, the network would need to be down all the time, which is not the case. I might of course be wrong but based on what I know I find it hard to believe. Is there any reference to support it?</p><p><span class="bbu">Talking about bootloaders</span> I found a great one called <strong>Breed</strong> (<a href="http://breed.hackpascal.net/latest/breed-mt7620-xiaomi-mini.bin">download</a> - will always link to latest version, <a href="http://www.right.com.cn/forum/thread-161906-1-1.html">description</a> - in Chinese only). It can do a lot but the most basic way to use it is: flash it, power off, hold the reset button while powering back on, plug the Ethernet cable, you&#039;ll get a DHCP lease (so no need to set the IP address manually) and can then go to <a href="http://192.168.1.1/">http://192.168.1.1/</a> to flash any firmware. Apparently replacing the stock bootloader is recommended because flashing a firmware larger than 8 MiB has the potential to overwrite the serial number, and if that happens then if the stock firmware is reflashed there will be no access to SSH anymore (the above hack posted by <em>santamanno</em> excepted). Caveat: the interface is only in Chinese too.</p><p><span class="bbu">As for the failsafe issue</span>, the documentation does say that the WAN port must be disconnected for it to work, and since this device has a complicated port setup, another explanation might be that the device mistakenly treats one of the always-on ports as the WAN port and, thinking it&#039;s connected, cuts off all access. One thing I read on some Chinese forum (can&#039;t find the link now) hinted at something like that interfering with failsafe, mentioning to only ever use the middle port for it (LAN port #1) but that did not work for me either. (To be absolutely clear about all the circumstances, all my failsafe experiments were done with the stock bootloader, so a custom bootloader issue is not a factor either.)</p>											<p class="post-edited">(Last edited by <strong>StrangeOrange</strong> on 13 Dec 2015, 13:54)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p303497">
				<div class="post-metadata">
					<div class="post-num">Post #139</div>
					<div class="post-author">Benik3</div>
					<div class="post-datetime">
						13 Dec 2015, 14:15					</div>
				</div>
				<div class="post-content content">
					<p>It was just an idea, I know that the original bootloader is little cropped (e.g. it doesn&#039;t support serial in default). </p><p>Anyway thanks for the Breed! <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /><br />Another &quot;full&quot; bootloader could be also the one from WiTi (but it will probably need to build it specialy for MiWifi)<br /><a href="https://mqmaker.com/">https://mqmaker.com/</a><br /><a href="http://ftp.mqmaker.com/WiTi/">http://ftp.mqmaker.com/WiTi/</a><br /><a href="https://github.com/mqmaker/witi-uboot">https://github.com/mqmaker/witi-uboot</a></p>											<p class="post-edited">(Last edited by <strong>Benik3</strong> on 13 Dec 2015, 14:22)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p303541">
				<div class="post-metadata">
					<div class="post-num">Post #140</div>
					<div class="post-author">santamanno</div>
					<div class="post-datetime">
						13 Dec 2015, 22:07					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>StrangeOrange wrote:</cite><blockquote><div class="quotebox"><cite>santamanno wrote:</cite><blockquote><p>...</p></blockquote></div><p> This is an amazing hack, wish I knew about it before, as I needed to unlock it the pedestrian way. If you could just specify the version it worked with, as I think they&#039;ll patch it up eventually.</p></blockquote></div><p>Thank you.</p><p>The funny thing is that I actually found this on the Xiaomi Lite (aka Youth/Nano), because I did not want to crack it open right away for serial flashing.</p><p>For the sake of completeness, I&#039;ve just downloaded both latest stock firmwares and uncompressed them and they both still contain the bug:</p><p>Xiaomi Mini v2.6.17<br />Xiaomi Lite aka &quot;Youth&quot; or &quot;Nano&quot; v2.2.8</p><p>IMHO they need heavy patching, there are plenty of other &quot;backdoors&quot; as far as I can tell <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p303561">
				<div class="post-metadata">
					<div class="post-num">Post #141</div>
					<div class="post-author">StrangeOrange</div>
					<div class="post-datetime">
						14 Dec 2015, 03:14					</div>
				</div>
				<div class="post-content content">
					<p><em>Long post. Scroll down to the first heading to skip the non-technical part.</em></p><p>As much as I&#039;d love to use bleeding-edge OpenWrt proper on this router, I find the Wi-Fi performance too disappointing compared to Pandora Box, so I&#039;m reluctantly warming up towards the idea of staying with the latter for the time being.</p><p><a href="http://www.openwrt.org.cn/">Pandora Box</a> is a partly-relabeled, Chinese fork of an older OpenWrt release (Barrier Breaker 14.07) that apparently includes some changes to the Wi-Fi driver that make its performance better. To the extent that I know of, the source code has not been made available, so the driver changes cannot be ported back to OpenWrt proper.</p><p>Pandora Box also includes nearly 200 add-on packages not present in the default OpenWrt installation, some of which I have little use for and would not want clogging up the limited resources of the router (examples include stuff related to bypassing the Internet censorship in China, etc. or a driver for some specific Huawei hardware). I also feel every such package can become a potential security problem, especially as they come from on outdated fork that is not being updated often.</p><p>The packages can be &quot;uninstalled&quot; but that does not mean they actually disappear from the flashed firmware and free up the space, which is what I&#039;d ideally want to happen. What I&#039;m up to then is getting rid of them by editing the *.bin file before flashing it. </p><p>So far I haven&#039;t made any changes and I&#039;m not sure how much of the plan I&#039;ll be carrying out, as it is a time-consuming endeavor but I wanted to share the editing method that I have just confirmed to work:</p><br /><h5><span style="color: black">Making changes to OpenWrt read-only filesystem<br />by editing the sysupgrade .bin before flashing the firmware</span></h5><p>I&#039;m doing this to modify the closed-source <em>Pandora Box</em> binary firmware for <em>Xiaomi MiWiFi Mini</em> but this method can be easily adopted to other scenarios.</p><ul><li><p><span class="bbu">Download</span> the latest <em>Pandora Box</em> version for the <em>Xiaomi MiWiFi Mini</em>. At the moment it is:<br /><strong><a href="http://downloads.openwrt.org.cn/PandoraBox/Xiaomi-Mini-R1CM/testing/PandoraBox-ralink-mt7620-xiaomi-mini-squashfs-sysupgrade-r1216-20150721.bin">PandoraBox-ralink-mt7620-xiaomi-mini-squashfs-sysupgrade-r1216-20150721.bin</a></strong><br /><span style="color: #aaa">MD5 Sum: f65a34a40c29eddc04989ad95458c1f9</span></p></li><li><p>For brevity, <span class="bbu">rename</span> the file to <strong>fw.bin</strong>.</p></li><li><p>The structure of the file is as follows:<br /><span style="color: #aaa">To calculate the size, subtract each offset from the one that immediately follows it.<br />If you are working with a different file, you need to manually analyze it at this point with a hex editor.</span></p></li></ul><div class="codebox"><pre><code>Offset   Size     Object    Remarks
      0  1196846  Kernel
1196846  6509218  SquashFS  Begins with &quot;hsqs&quot;
7706064   158260  Padding   Consists of 0xFF with occasional 0xDEADC0DE
7864324           EOF</code></pre></div><ul><li><p><span class="bbu">Split</span> the file into parts. The syntax using dd(1):<br /><span style="color: #aaa">You could also try split(1), perhaps csplit(1), or an interactive hex editor.</span></p><br /><p><strong>dd if=fw.bin of=fw_kernel.bin bs=1 count=1196846<br />dd if=fw.bin of=fw_fs.bin bs=1 skip=1196846 count=6509218<br />dd if=fw.bin of=fw_padding.bin bs=1 skip=7706064 count=158260</strong></p><br /></li><li><p><em>Optional</em>: Check to make sure we got the numbers right:</p><br /><p><strong>cat fw_kernel.bin fw_fs.bin fw_padding.bin | cmp -l fw.bin</strong></p><br /></li><li><p><em>Optional</em>: Check the filesystem metadata (superblock) and save a list of all files alongside their permissions.</p><br /><p><strong>unsquashfs -s fw_fs.bin<br />unsquashfs -ll fw_fs.bin &gt;fw_fs_ls.txt</strong></p><br /></li><li><p><span class="bbu">Unpack</span> the filesystem:</p><br /><p><strong>unsquashfs -d fw_fs fw_fs.bin</strong></p><br /></li><li><p>The partition has been unpacked into the <strong>fw_fs</strong> directory. You can now remove, insert or edit any of the files there.</p><br /><p><strong>cd fw_fs<br /><em>[Add your customizations here]</em><br />cd ..</strong></p><br /></li><li><p><span class="bbu">Repack</span> the filesystem back into the archive:<br /><span style="color: #aaa">The part marked in </span><span style="color: green">green</span><span style="color: #aaa"> will generally not be necessary unless you unpacked the archive to a filesystem that cannot store device files. It is harmless to leave it though, as if the device files are already present it will only raise a warning.</span></p><br /><p><strong>mksquashfs fw_fs fw_fs_mod.bin -nopad -noappend -root-owned -comp xz <span style="color: blue">-Xpreset 9 -Xe -Xlc 0 -Xlp 2 -Xpb 2</span> -b 256k <span style="color: green">-p &#039;/dev d 755 0 0&#039; -p &#039;/dev/console c 600 0 0 5 1&#039;</span></strong></p><br /></li><li><p><em>Alternative</em>: The above command requires a patched version of <strong>mksquashfs</strong> (comes with the OpenWrt build environment). The regular version will not accept the compression settings highlighted in <span style="color: blue">blue</span>. If you only have this version like I did, omitting those parameters will still yield a working result although with a slightly larger file: (~100 KiB in my case).<br /><span style="color: #aaa">Open question: perhaps the dictionary size should be adjusted with <em>-Xdict-size</em>.</span></p><br /><p><strong>mksquashfs fw_fs fw_fs_mod.bin -nopad -noappend -root-owned -comp xz -b 256k <span style="color: green">-p &#039;/dev d 755 0 0&#039; -p &#039;/dev/console c 600 0 0 5 1&#039;</span></strong></p><br /></li><li><p><span class="bbu">Merge</span> everything back together into a single flashable file:<br /><span style="color: #aaa">Copying over the old padding is the lazy way of doing things, this part could be improved upon. For starters, according to a casual glance at the source code the only necessary thing that needs to be present is a single instance of <em>0xDEADC0DE</em> to mark the beginning of the jffs2 partition, other than that the padding is there only to workaround some bootloader problems, which might not even be present on this device. A new padding can also be generated with the padjffs2 tool from the OpenWrt build environment. It also appears that the partition size should not exceed 8 MiB, so if you add a lot of files, you might want to adjust the padding accordingly.</span></p><br /><p><strong>cat fw_kernel.bin fw_fs_mod.bin fw_padding.bin &gt; fw_mod.bin</strong></p><br /></li><li><p><span class="bbu">Reflash</span> the new firmware, <strong>fw_mod.bin</strong>. <br /><span style="color: #aaa">In my case, I needed to discard the old settings to make it boot properly.</span></p><br /><p><strong>sysupgrade -n fw_mod.bin</strong></p><br /></li></ul><p><em>Thanks for bearing with me. Hope someone finds the above useful. Note that while it works for me, all the usual disclaimers apply: do any of the above at your own peril.</em></p><p>I found the following resources very helpful in the course of figuring out what to do:<br /></p><ul><li><p><a href="http://www.minipwner.com/index.php/forum/4-community-edition-installation/898-how-to-modify-the-openwrt-squashfs-bin-file">How to modify the OpenWRT SquashFS binary file</a></p></li><li><p><a href="https://wiki.commotionwireless.net/doku.php/development_resources/router/modifying_.bin_files_by_hand">Modifying .bin files by hand</a></p></li><li><p><a href="http://habrahabr.ru/post/264843/">Исследуем OpenWRT: чем отличаются образы uImage и sysupgrade</a> (arguably the best of the three but in Russian)</p></li></ul>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p303583">
				<div class="post-metadata">
					<div class="post-num">Post #142</div>
					<div class="post-author">augustus_meyer</div>
					<div class="post-datetime">
						14 Dec 2015, 10:31					</div>
				</div>
				<div class="post-content content">
					<p>Great work. Agromne spocibo.</p>											<p class="post-edited">(Last edited by <strong>augustus_meyer</strong> on 14 Dec 2015, 10:32)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p303715">
				<div class="post-metadata">
					<div class="post-num">Post #143</div>
					<div class="post-author">irwan6179</div>
					<div class="post-datetime">
						15 Dec 2015, 11:02					</div>
				</div>
				<div class="post-content content">
					<p>This is awesome. Thanks!</p><div class="quotebox"><cite>santamanno wrote:</cite><blockquote><p>In case you want to skip all the Xiaomi download etc, here are some instructions to <strong>flash directly OpenWRT/PandoraBox on stock firmware</strong> via code injection bug.</p><p><strong>NOTE</strong><br />This method has been successfully tested on<br />-&gt; Xiaomi Mini - Stock firmware v2.6.17<br />-&gt; Xiaomi Lite aka &quot;Youth&quot; or &quot;Nano&quot; - Stock firmware v2.2.8</p><p><strong>STEPS</strong><br />1) Power on and setup the Xiaomi router until it reboots and gets IP address 192.168.31.1<br />2) Log-in into the router and grab the value of the <em>stok</em> URL parameter (for instance: &quot;9c2428de4d17e2db7e5a6a337e6f57a3&quot;)<br />3) Replace the <strong>&lt;STOK&gt;</strong> placeholder and load this URL in your browser or curl, this will start telnetd on the router:</p><p><a href="http://192.168.31.1/cgi-bin/luci/;stok=">http://192.168.31.1/cgi-bin/luci/;stok=</a><strong>&lt;STOK&gt;</strong>/api/xqnetwork/set_wifi_ap?ssid=whatever&amp;encryption=NONE&amp;enctype=NONE&amp;channel=1%3B%2Fusr%2Fsbin%2Ftelnetd</p><p>It should spit out some wifi error code, that is ok, don&#039;t worry.</p><p>4) Replace the &lt;STOK&gt; placeholder, the current password and the desired root password and load this URL in your browser or curl, this will set the router root password</p><p><a href="http://192.168.31.1/cgi-bin/luci/;stok=">http://192.168.31.1/cgi-bin/luci/;stok=</a><strong>&lt;STOK&gt;</strong>/api/xqsystem/set_name_password?oldPwd=<strong>&lt;CURRENTPASS&gt;</strong>&amp;newPwd=<strong>&lt;NEWPASS&gt;</strong></p><p>It should spit out: <em>{&quot;code&quot;:0}</em></p><p>5) Telnet to the router, enter user root and NEWPASS chosen above.</p><p>6) wget your favourite .bin and flash with mtd -r write firmware.bin OS1</p><p>7) Router reboots <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p><p>Hope it helps, just wanted to give back my two cents to the community.</p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p303916">
				<div class="post-metadata">
					<div class="post-num">Post #144</div>
					<div class="post-author">mikeoke</div>
					<div class="post-datetime">
						16 Dec 2015, 23:13					</div>
				</div>
				<div class="post-content content">
					<p>Excellent, this worked for me<br />Big thanks for you santamanno!!<br />don&#039;t know how you found this injection bug, it works for me&nbsp; <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><div class="quotebox"><cite>santamanno wrote:</cite><blockquote><p>In case you want to skip all the Xiaomi download etc, here are some instructions to <strong>flash directly OpenWRT/PandoraBox on stock firmware</strong> via code injection bug.</p><p><strong>NOTE</strong><br />This method has been successfully tested on<br />-&gt; Xiaomi Mini - Stock firmware v2.6.17<br />-&gt; Xiaomi Lite aka &quot;Youth&quot; or &quot;Nano&quot; - Stock firmware v2.2.8</p><p><strong>STEPS</strong><br />1) Power on and setup the Xiaomi router until it reboots and gets IP address 192.168.31.1<br />2) Log-in into the router and grab the value of the <em>stok</em> URL parameter (for instance: &quot;9c2428de4d17e2db7e5a6a337e6f57a3&quot;)<br />3) Replace the <strong>&lt;STOK&gt;</strong> placeholder and load this URL in your browser or curl, this will start telnetd on the router:</p><p><a href="http://192.168.31.1/cgi-bin/luci/;stok=">http://192.168.31.1/cgi-bin/luci/;stok=</a><strong>&lt;STOK&gt;</strong>/api/xqnetwork/set_wifi_ap?ssid=whatever&amp;encryption=NONE&amp;enctype=NONE&amp;channel=1%3B%2Fusr%2Fsbin%2Ftelnetd</p><p>It should spit out some wifi error code, that is ok, don&#039;t worry.</p><p>4) Replace the &lt;STOK&gt; placeholder, the current password and the desired root password and load this URL in your browser or curl, this will set the router root password</p><p><a href="http://192.168.31.1/cgi-bin/luci/;stok=">http://192.168.31.1/cgi-bin/luci/;stok=</a><strong>&lt;STOK&gt;</strong>/api/xqsystem/set_name_password?oldPwd=<strong>&lt;CURRENTPASS&gt;</strong>&amp;newPwd=<strong>&lt;NEWPASS&gt;</strong></p><p>It should spit out: <em>{&quot;code&quot;:0}</em></p><p>5) Telnet to the router, enter user root and NEWPASS chosen above.</p><p>6) wget your favourite .bin and flash with mtd -r write firmware.bin OS1</p><p>7) Router reboots <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p><p>Hope it helps, just wanted to give back my two cents to the community.</p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p303921">
				<div class="post-metadata">
					<div class="post-num">Post #145</div>
					<div class="post-author">santamanno</div>
					<div class="post-datetime">
						17 Dec 2015, 00:52					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>mikeoke wrote:</cite><blockquote><p>Excellent, this worked for me<br />Big thanks for you santamanno!!<br />don&#039;t know how you found this injection bug, it works for me&nbsp; <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p></blockquote></div><p>You&#039;re welcome! I had to unpack the firmware and look through the LUA code until I found a crack <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p304091">
				<div class="post-metadata">
					<div class="post-num">Post #146</div>
					<div class="post-author">xiaxia</div>
					<div class="post-datetime">
						18 Dec 2015, 09:35					</div>
				</div>
				<div class="post-content content">
					<p>hey there, i have a xiaomi mini router also, i post to let you know about a problem (about my ip cam (the Yi IP cam normal edition) and my PC) i&#039;ve encountered with openwrt 15.05/trunk</p><p><a href="https://forum.openwrt.org/viewtopic.php?id=61567">https://forum.openwrt.org/viewtopic.php?id=61567</a></p><p>if someone encounter the same issue maybe it can help.</p>											<p class="post-edited">(Last edited by <strong>xiaxia</strong> on 18 Dec 2015, 09:38)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p304452">
				<div class="post-metadata">
					<div class="post-num">Post #147</div>
					<div class="post-author">anarchy99</div>
					<div class="post-datetime">
						21 Dec 2015, 02:41					</div>
				</div>
				<div class="post-content content">
					<p>compiled r47929 and running without problems. switch detected as usual.</p><p>i tried original fw v2.6.17 and it looks like 5GHz signal strength is the same as with openwrt so they must screwed up something too because it was strong as the 2.4GHz with older firmwares.</p><p>another thing when flashing openwrt using santamanno&#039;s method you won&#039;t easily wget image if the router is not connected to the internet unless you run local server, so i figured you can simply scp image using ssh.</p>											<p class="post-edited">(Last edited by <strong>anarchy99</strong> on 21 Dec 2015, 02:49)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p304528">
				<div class="post-metadata">
					<div class="post-num">Post #148</div>
					<div class="post-author">roger_</div>
					<div class="post-datetime">
						21 Dec 2015, 20:31					</div>
				</div>
				<div class="post-content content">
					<p>Is the stock firmware u-boot locked, or can flash Breed directly?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p304566">
				<div class="post-metadata">
					<div class="post-num">Post #149</div>
					<div class="post-author">tmo26</div>
					<div class="post-datetime">
						22 Dec 2015, 00:47					</div>
				</div>
				<div class="post-content content">
					<p><a href="https://wiki.openwrt.org/toh/xiaomi/mini#bootloader">https://wiki.openwrt.org/toh/xiaomi/mini#bootloader</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p304873">
				<div class="post-metadata">
					<div class="post-num">Post #150</div>
					<div class="post-author">StrangeOrange</div>
					<div class="post-datetime">
						24 Dec 2015, 06:47					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>roger_ wrote:</cite><blockquote><p>Is the stock firmware u-boot locked, or can flash Breed directly?</p></blockquote></div><p>It can be flashed directly. From the <a href="http://www.right.com.cn/forum/thread-161906-1-1.html">original description</a>:<br /></p><div class="quotebox"><blockquote><p><strong>刷入方式</strong><br />跟 U-Boot 相同的刷入方法：</p><ul><li><p>从 PandoraBox U-Boot 中刷入</p></li><li><p>在固件中使用 mtd 命令刷入</p></li><li><p>在 U-Boot TTL 中刷入</p></li><li><p>用编程器刷入</p></li></ul></blockquote></div><p>In English:<br /></p><div class="quotebox"><blockquote><p><strong>Flashing Method</strong><br />The ways to flash are the same as for U-Boot:</p><ul><li><p>Flash from PandoraBox&#039;s U-Boot</p></li><li><p><span class="bbu">From inside the firmware, using the mtd command</span></p></li><li><p>Using TTL with U-Boot</p></li><li><p>Flash using a [hardware] programming device</p></li></ul></blockquote></div><p>PandoraBox U-Boot is another custom bootloader, <a href="http://downloads.openwrt.org.cn/PandoraBox/Xiaomi-Mini-R1CM/u-boot/uboot-xiaomi-mini-115200.bin">available here</a>, which would already need to be present first for this method to be available. The latter two methods require extra hardware. I used the <span class="bbu">second</span> way:<br /></p><ul><li><p><strong>cd /tmp</strong></p></li><li><p><strong>wget <a href="http://breed.hackpascal.net/latest/breed-mt7620-xiaomi-mini.bin">http://breed.hackpascal.net/latest/bree … i-mini.bin</a></strong></p></li><li><p><strong>wget <a href="http://breed.hackpascal.net/latest/md5sum.txt">http://breed.hackpascal.net/latest/md5sum.txt</a></strong></p></li><li><p><strong>cat md5sum.txt | fgrep xiaomi</strong></p></li><li><p><strong>md5sum breed-mt7620-xiaomi-mini.bin</strong><br />Manually compare the MD5 sums. Only proceed if they match. Otherwise, re-download.</p></li><li><p><strong>cat /proc/mtd</strong><br />Find out the bootloader partition. If flashing from the stock firmware, this will be <strong>mtd1</strong>, named &quot;Bootloader&quot;. If flashing from PandoraBox, it&#039;ll be <strong>mtd0</strong>, named &quot;u-boot&quot;. Other firmwares might have different variations.</p></li><li><p><strong>mtd write breed-mt7620-xiaomi-mini.bin mtd<span style="color: red">X</span></strong><br />Where <strong><span style="color: red">X</span></strong> is the partition number. Not using the <strong>-r</strong> (automatic reboot) switch gives you a chance to recover if something goes wrong, in which case do not reboot but reflash again, perhaps reverting to the stock bootloader (of which you might want to make a backup beforehand, not covered here).</p></li></ul><p><span class="bbu">Disclaimer</span>: Changing the bootloader has the potential to brick your device. While the procedure as described worked for me, it is possible that something might go wrong. Anything you decide to do, you are doing at your own risk.</p><p>Note that once you have Breed flashed in, you can flash any other bootloader from inside its Web-based interface.</p><p>A little more about Breed:<br /></p><ul><li><p>For people who don&#039;t like to hold the Reset switch, note that there is a utility that will trigger the bootloader console remotely: with the router powered off and connected to your computer through Ethernet, run the program, press the only button and then power on the router. The message in the program window will change once the bootloader console is active. Download <a href="http://pan.baidu.com/s/1c0izwJm">BreedEnter.exe</a> (hover over the file and click on the down arrow), requires the <a href="https://www.winpcap.org/install/bin/WinPcap_4_1_3.exe">WinPCap library</a>.</p></li><li><p>Apart from the web console, there is also a Telnet interface. <a href="http://www.right.com.cn/forum/forum.php?mod=viewthread&amp;tid=161906&amp;page=1#pid1011303">List of available commands</a> (in Chinese) or type <strong>help</strong>.<br /></p></li></ul><p><span style="color: green">On an unrelated note, using <a href="https://forum.openwrt.org/viewtopic.php?pid=303561#p303561">the method I described above</a> I made some changes to the filesystem inside PandoraBox binary image, making it basically like the vanilla OpenWrt (removing China-specific stuff, translations, not widely-used packages, reverting most of the interface changes to the OpenWrt defaults; basically making it more or less like the stock OpenWrt with their WiFi optimizations while keeping the more useful packages that were already installed). I can share the process, patch set and perhaps the result: if anyone is interested, let me know (otherwise I wouldn&#039;t want to clog up the forum).</span> </p><p><span style="color: green"><strong>Shared now, <a href="https://forum.openwrt.org/viewtopic.php?pid=306678#p306678">get it here</a> if interested.</strong></span></p>											<p class="post-edited">(Last edited by <strong>StrangeOrange</strong> on 8 Jan 2016, 15:44)</p>
									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 6 of 21</div><nav><ul><li><a href="viewtopic.php%3Fid=54987&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=54987&amp;p=4.html">4</a></li><li><a href="viewtopic.php%3Fid=54987&amp;p=5.html">5</a></li><li class="pagination-current"><span>6</span></li><li><a href="viewtopic.php%3Fid=54987&amp;p=7.html">7</a></li><li><a href="viewtopic.php%3Fid=54987&amp;p=8.html">8</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=54987&amp;p=21.html">21</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0.001 -->

</body>
</html>