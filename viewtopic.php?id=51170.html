<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> [TP-Link 150M TL-MR10U][solved] add USB port to extend disk space</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 1 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p237184">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">Jodaille</div>
					<div class="post-datetime">
						18 Jun 2014, 13:52					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>at first I would like to thank you all for your work !</p><p>I have installed OpenWrt on a TL-MR10U this week.</p><p>I have plugged an Arduino on the available USB port:</p><p>It works, I can see serial output, so happy :-)</p><p>I would like to add a web interface in order to display a water level,<br />put some html forms elements to be able to switch on/off some relays <br />managed by Arduino.</p><p>I seems that TL-MR10U miss some disk space, so I wonder if it could<br />be possible to add another USB port (first is used by Arduino) in order<br />to plug a USB stick ? <br />(and add extra disk space like some other hardware mods)</p>											<p class="post-edited">(Last edited by <strong>Jodaille</strong> on 28 Jun 2014, 13:27)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p237234">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">tmo26</div>
					<div class="post-datetime">
						18 Jun 2014, 20:09					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Jodaille wrote:</cite><blockquote><p>I seems that TL-MR10U miss some disk space, so I wonder if it could be possible to add another USB port</p></blockquote></div><p>Sure, that&#039;s called an &quot;USB hub&quot; ;-)</p><br /><div class="quotebox"><cite>Jodaille wrote:</cite><blockquote><p> (first is used by Arduino) in order to plug a USB stick ? <br />(and add extra disk space like some other hardware mods)</p></blockquote></div><p>see <a href="http://wiki.openwrt.org/doc/howto/extroot">http://wiki.openwrt.org/doc/howto/extroot</a> about how to increase storage space via USB stick.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p237313">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">Jodaille</div>
					<div class="post-datetime">
						19 Jun 2014, 09:20					</div>
				</div>
				<div class="post-content content">
					<p>Hello tmo26,</p><p>thank you for the tip and thank you for the link :-)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p238137">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">Jodaille</div>
					<div class="post-datetime">
						26 Jun 2014, 17:09					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>I have found an USB hub, well detected and works with Arduino plugged in it.</p><p>I have also plugged two differents USB sticks, they are detected (cf: dmesg output &quot;new device ...&quot;),<br />but kernel does not see them as mass storage devices nor partitions detected.</p><p>This sticks works on my Linux desktop.</p><p>I have followed your link about extroot and <a href="http://wiki.openwrt.org/doc/howto/usb.storage">http://wiki.openwrt.org/doc/howto/usb.storage</a><br />but no chance.</p><p>Is there another step I have missed ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p238145">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">tmo26</div>
					<div class="post-datetime">
						26 Jun 2014, 19:39					</div>
				</div>
				<div class="post-content content">
					<p>Post the output of</p><div class="codebox"><pre><code>dmesg | grep -E &#039;usb|scsi|SCSI|sd |sda|sdb|-fs&#039;</code></pre></div><p>and</p><div class="codebox"><pre><code>opkg list-installed kmod-fs*</code></pre></div><p>and</p><div class="codebox"><pre><code>uci show fstab</code></pre></div><p>and</p><div class="codebox"><pre><code>block info
or alternatively: block detect
or alternatively: blkid</code></pre></div>											<p class="post-edited">(Last edited by <strong>tmo26</strong> on 26 Jun 2014, 19:40)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p238150">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">Jodaille</div>
					<div class="post-datetime">
						26 Jun 2014, 20:39					</div>
				</div>
				<div class="post-content content">
					<p>Hello tmo26 and thank you,</p><div class="codebox"><pre><code>root@JoduinoOpenWrt:~# dmesg | grep -E &#039;usb|scsi|SCSI|sd |sda|sdb|-fs&#039;
[    3.990000] usbcore: registered new interface driver usbfs
[    4.000000] usbcore: registered new interface driver hub
[    4.000000] usbcore: registered new device driver usb
[    4.510000] usb 1-1: new high-speed USB device number 2 using ehci-platform
[    4.960000] usb 1-1.1: new full-speed USB device number 3 using ehci-platform
[    5.120000] usb 1-1.1: new high-speed USB device number 4 using ehci-platform
[   10.200000] usbcore: registered new interface driver cdc_acm
[   10.270000] usbcore: registered new interface driver usbserial
[   10.280000] usbcore: registered new interface driver usbserial_generic
[   10.280000] usbserial: USB Serial support registered for generic
[   10.410000] usbcore: registered new interface driver ftdi_sio
[   10.430000] usbserial: USB Serial support registered for FTDI USB Serial Device
[   27.840000] usb 1-1.3: new full-speed USB device number 5 using ehci-platform
[   28.370000] usb 1-1.3: Detected FT232RL
[   28.370000] usb 1-1.3: Number of endpoints 2
[   28.380000] usb 1-1.3: Endpoint 1 MaxPacketSize 16384
[   28.380000] usb 1-1.3: Endpoint 2 MaxPacketSize 16384
[   28.390000] usb 1-1.3: Setting MaxPacketSize 64
[   28.400000] usb 1-1.3: FTDI USB Serial Device converter now attached to ttyUSB0</code></pre></div><div class="codebox"><pre><code>root@JoduinoOpenWrt:~# opkg list-installed kmod-fs*</code></pre></div><p>(no results)</p><div class="codebox"><pre><code>root@JoduinoOpenWrt:~# uci show fstab
fstab.@global[0]=global
fstab.@global[0].anon_swap=0
fstab.@global[0].anon_mount=0
fstab.@global[0].auto_swap=1
fstab.@global[0].auto_mount=1
fstab.@global[0].delay_root=5
fstab.@global[0].check_fs=0</code></pre></div><div class="codebox"><pre><code>root@JoduinoOpenWrt:~# block info
/dev/mtdblock2: UUID=&quot;bb509645-ada24903-62d4f345-aa484640&quot; VERSION=&quot;4.0&quot; TYPE=&quot;squashfs&quot;
/dev/mtdblock3: TYPE=&quot;jffs2&quot;</code></pre></div><div class="codebox"><pre><code>root@JoduinoOpenWrt:~# block detect
config &#039;global&#039;
        option  anon_swap       &#039;0&#039;
        option  anon_mount      &#039;0&#039;
        option  auto_swap       &#039;1&#039;
        option  auto_mount      &#039;1&#039;
        option  delay_root      &#039;5&#039;
        option  check_fs        &#039;0&#039;</code></pre></div><div class="codebox"><pre><code>root@JoduinoOpenWrt:~# blkid
-ash: blkid: not found</code></pre></div><br /><p>I have no fs modules trying vfat :<br /> </p><div class="codebox"><pre><code>opkg install kmod-fs-vfat
Installing kmod-fs-vfat (3.10.36-1) to root...
Downloading http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/kmod-fs-vfat_3.10.36-1_ar71xx.ipk.
Collected errors:
 * satisfy_dependencies_for: Cannot satisfy the following dependencies for kmod-fs-vfat:
 *      kernel (= 3.10.36-1-427233cd53f4a891ecf66f4299844a5a) * 
 * opkg_install_cmd: Cannot install package kmod-fs-vfat.</code></pre></div><p>I have play a lot with and maybe too much : need to make some clean.</p><p>nice to be able to switch on and off the arduino :-) <br /> </p><div class="codebox"><pre><code>echo 0 &gt;  /sys/class/gpio/gpio18/value
echo 1 &gt;  /sys/class/gpio/gpio18/value
 </code></pre></div>											<p class="post-edited">(Last edited by <strong>Jodaille</strong> on 26 Jun 2014, 21:42)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p238161">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">tmo26</div>
					<div class="post-datetime">
						26 Jun 2014, 23:13					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Jodaille wrote:</cite><blockquote><p>Hello tmo26 and thank you,<br /></p><div class="codebox"><pre><code>root@JoduinoOpenWrt:~# opkg list-installed kmod-fs*</code></pre></div><p>(no results)</p></blockquote></div><p>You need to install some filesystem, but you already got that idea, as I can see below <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><div class="quotebox"><blockquote><p>I have no fs modules trying vfat :<br /> </p><div class="codebox"><pre><code>opkg install kmod-fs-vfat
Installing kmod-fs-vfat (3.10.36-1) to root...
Downloading http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/kmod-fs-vfat_3.10.36-1_ar71xx.ipk.
Collected errors:
 * satisfy_dependencies_for: Cannot satisfy the following dependencies for kmod-fs-vfat:
 *      kernel (= 3.10.36-1-427233cd53f4a891ecf66f4299844a5a) * 
 * opkg_install_cmd: Cannot install package kmod-fs-vfat.</code></pre></div></blockquote></div><p>The kernel changed in the meantime. Update your image.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p238285">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">Jodaille</div>
					<div class="post-datetime">
						27 Jun 2014, 21:10					</div>
				</div>
				<div class="post-content content">
					<p>Hello,<br />I have not kept the outputs but below are the commands I have done :<br /></p><div class="codebox"><pre><code>cd /tmp
wget http://downloads.openwrt.org/snapshots/trunk/ar71xx/openwrt-ar71xx-generic-tl-mr10u-v1-squashfs-sysupgrade.bin
wget http://downloads.openwrt.org/snapshots/trunk/ar71xx/md5sums
md5sum -c md5sums 2&gt; /dev/null | grep OK
sysupgrade -v openwrt-ar71xx-generic-tl-mr10u-v1-squashfs-sysupgrade.bin</code></pre></div><p>After this, led was blinking, screen stopped on a message like &quot;reboot&quot; :<br />I switch it off then on.</p><p>Plenty of new free space now :-)<br />I only have to edit my /etc/resolv.conf to access internet then&nbsp; :<br /></p><div class="codebox"><pre><code>   8 opkg update
   9 opkg install kmod-fs-vfat
  10 opkg list | grep kmod-fs
  11 opkg install kmod-fs-ext4
  31 opkg install kmod-usb-storage
  32 opkg install block-mount</code></pre></div><p>Insmod of ext4 report me an error but after a reboot &quot;tadam&quot; \o/ : <br /></p><div class="codebox"><pre><code>root@JoduinoOpenWrt:~#  dmesg | grep -E &#039;usb|scsi|SCSI|sd |sda|sdb|-fs&#039;
[    3.990000] usbcore: registered new interface driver usbfs
[    3.990000] usbcore: registered new interface driver hub
[    4.000000] usbcore: registered new device driver usb
[    4.430000] usb 1-1: new high-speed USB device number 2 using ehci-platform
[    4.870000] usb 1-1.1: new full-speed USB device number 3 using ehci-platform
[    5.030000] usb 1-1.1: new high-speed USB device number 4 using ehci-platform
[    5.220000] usb 1-1.2: new full-speed USB device number 5 using ehci-platform
[    5.410000] usb 1-1.3: new full-speed USB device number 6 using ehci-platform
[    8.720000] SCSI subsystem initialized
[    8.730000] usb-storage 1-1.1:1.0: USB Mass Storage device detected
[    8.740000] scsi0 : usb-storage 1-1.1:1.0
[    8.740000] usbcore: registered new interface driver usb-storage
[    9.740000] scsi 0:0:0:0: Direct-Access     General  USB Flash Disk   1.0  PQ: 0 ANSI: 2
[    9.750000] sd 0:0:0:0: [sda] 3913728 512-byte logical blocks: (2.00 GB/1.86 GiB)
[    9.760000] sd 0:0:0:0: [sda] Write Protect is off
[    9.760000] sd 0:0:0:0: [sda] Mode Sense: 03 00 00 00
[    9.760000] sd 0:0:0:0: [sda] No Caching mode page found
[    9.770000] sd 0:0:0:0: [sda] Assuming drive cache: write through
[    9.780000] sd 0:0:0:0: [sda] No Caching mode page found
[    9.780000] sd 0:0:0:0: [sda] Assuming drive cache: write through
[    9.800000]  sda: sda1
[    9.800000] sd 0:0:0:0: [sda] No Caching mode page found
[    9.810000] sd 0:0:0:0: [sda] Assuming drive cache: write through
[    9.810000] sd 0:0:0:0: [sda] Attached SCSI removable disk</code></pre></div><p>Now we can see sda and its sda1 vfat partition&nbsp; : <br /></p><div class="codebox"><pre><code>root@JoduinoOpenWrt:~# cat /proc/partitions 
major minor  #blocks  name

  31        0        128 mtdblock0
  31        1       1069 mtdblock1
  31        2       2834 mtdblock2
  31        3        960 mtdblock3
  31        4         64 mtdblock4
  31        5       3904 mtdblock5
   8        0    1956864 sda
   8        1    1956848 sda1</code></pre></div><p>Thank you tmo26 ! :-)</p><p>Next extroot.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p238288">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">tmo26</div>
					<div class="post-datetime">
						27 Jun 2014, 21:20					</div>
				</div>
				<div class="post-content content">
					<p>Glad I could help! <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p238290">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">Jodaille</div>
					<div class="post-datetime">
						27 Jun 2014, 21:27					</div>
				</div>
				<div class="post-content content">
					<p>I have missed something in the doc <a href="http://wiki.openwrt.org/doc/howto/usb.storage">http://wiki.openwrt.org/doc/howto/usb.storage</a><br /></p><div class="codebox"><pre><code>root@JoduinoOpenWrt:~# mkdir -p /mount/sda1
root@JoduinoOpenWrt:~# mount -t vfat /dev/sda1 /mount/sda1
mount: mounting /dev/sda1 on /mount/sda1 failed: Invalid argument</code></pre></div><p>The piece is : <br /></p><div class="codebox"><pre><code>opkg install kmod-usb-storage block-mount block-hotplug kmod-fs-ext4 kmod-fs-vfat kmod-nls-cp437 kmod-nls-iso8859-1</code></pre></div><p>It can mount vfat partition now.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p238314">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">Jodaille</div>
					<div class="post-datetime">
						28 Jun 2014, 00:28					</div>
				</div>
				<div class="post-content content">
					<p>Parition converted and format to ext4<br />extroot mode overlay works:<br /></p><div class="codebox"><pre><code>root@JoduinoOpenWrt:~# df -h
Filesystem                Size      Used Available Use% Mounted on
rootfs                    1.8G      4.5M      1.7G   0% /
/dev/root                 2.0M      2.0M         0 100% /rom
tmpfs                    14.1M     60.0K     14.0M   0% /tmp
/dev/sda1                 1.8G      4.5M      1.7G   0% /overlay
overlayfs:/overlay        1.8G      4.5M      1.7G   0% /
tmpfs                   512.0K         0    512.0K   0% /dev</code></pre></div><p>It seems to have only 2M for /rom, I have to read about mtd structure.</p><p>It now has 1.7G hourra ! :-)</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>