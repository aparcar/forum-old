<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Netgear WNR2000 OpenWRT (Atheros AP81, AR9103 chip, u-boot)</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 3 Apr 2018 and 3 May 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 4 of 15</div><nav><ul><li><a href="viewtopic.php%3Fid=18279&amp;p=1.html">1</a></li><li><a href="viewtopic.php%3Fid=18279&amp;p=2.html">2</a></li><li><a href="viewtopic.php%3Fid=18279&amp;p=3.html">3</a></li><li class="pagination-current"><span>4</span></li><li><a href="viewtopic.php%3Fid=18279&amp;p=5.html">5</a></li><li><a href="viewtopic.php%3Fid=18279&amp;p=6.html">6</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=18279&amp;p=15.html">15</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p122300">
				<div class="post-metadata">
					<div class="post-num">Post #76</div>
					<div class="post-author">mazade</div>
					<div class="post-datetime">
						30 Nov 2010, 19:50					</div>
				</div>
				<div class="post-content content">
					<p>well I have not attempted to TFTP anything to it yet, and telnet does not connect to it anymore, no login response or anything.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p122565">
				<div class="post-metadata">
					<div class="post-num">Post #77</div>
					<div class="post-author">Jarvid</div>
					<div class="post-datetime">
						3 Dec 2010, 23:17					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>it&#039;s me again. With help of the serial console I was finally able to see the reason the system wasn&#039;t booting the image:<br />&quot;Bad Magic Number&quot;</p><p>Any ideas? <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>--edit--<br />Well ok <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /><br />running &quot;imls&quot; in u-boot gave me the correct adress for bootm, now my uImage was loaded <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /><br />Maybe you should extend ur guide by this point fuhry?<br />Everthing else worked great, especially the patched u-boot, thanks a lot!</p>											<p class="post-edited">(Last edited by <strong>Jarvid</strong> on 4 Dec 2010, 17:25)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p122621">
				<div class="post-metadata">
					<div class="post-num">Post #78</div>
					<div class="post-author">mazade</div>
					<div class="post-datetime">
						4 Dec 2010, 23:55					</div>
				</div>
				<div class="post-content content">
					<p>Hi again... <br />Um, Jarvid, might you be able to expound upon this &quot;imls&quot; bit?<br />I opened the u-boot.bin file in hopes that I might be able to decipher something... and I drowned.<br />Perhaps it has something to do with my opening the .bin file with Notepad++... and not some better-suited prog...? er, yeah, not a code-competent person here, sorry.<br />I&#039;m glad to hear that your setup is functioning.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p122661">
				<div class="post-metadata">
					<div class="post-num">Post #79</div>
					<div class="post-author">mazade</div>
					<div class="post-datetime">
						5 Dec 2010, 18:25					</div>
				</div>
				<div class="post-content content">
					<p>Newegg Shell Shocker Deal going on right now, and for the next few hours.&nbsp; Either the WNR2000 V1 or V2 possibly as some people are claiming to have received.&nbsp; $20 + free ship<br /><a href="http://www.newegg.com/Product/Product.aspx?Item=33-122-275">http://www.newegg.com/Product/Product.a … 33-122-275</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p122702">
				<div class="post-metadata">
					<div class="post-num">Post #80</div>
					<div class="post-author">Jarvid</div>
					<div class="post-datetime">
						6 Dec 2010, 10:22					</div>
				</div>
				<div class="post-content content">
					<p>Hi mazade,</p><p>&quot;imls&quot; is an u-boot command which lists Kernel images found in the flash memory incl. adress.</p><p>Fuhrys uboot.env changed that start adress of the uImage containig the magic code.<br />I guess because he repartioned his memory. </p><p>This is easily fixed with a serial console.<br />Alone with the tftp recovery you could theoretically create an image filled up with zeros an starting with an offset that matches fuhrys start Adress. </p><p>But I don&#039;t Know if this is possible. </p><p>Jarvid</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p122997">
				<div class="post-metadata">
					<div class="post-num">Post #81</div>
					<div class="post-author">Blind55</div>
					<div class="post-datetime">
						10 Dec 2010, 17:28					</div>
				</div>
				<div class="post-content content">
					<p>Hi guys,</p><p>first off, thank you very much for all the information presented here.</p><p>I am happy to say I had some time the last few days to play with the router, and I have gotten it to work, thanks to in particular fuhry&#039;s work.</p><p>I can&#039;t say that it was a particular smooth path, and I now would state that without a serial console it is almost impossible to get there, but overall, I think the procedure lined out by fuhry, in combination with Jarvid&#039;s information to fix the u-boot environment, is detailed enough to get there.</p><p>Thanks everybody again.</p><p>Kind regards,<br />Blind</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p123020">
				<div class="post-metadata">
					<div class="post-num">Post #82</div>
					<div class="post-author">wrtvic</div>
					<div class="post-datetime">
						11 Dec 2010, 01:31					</div>
				</div>
				<div class="post-content content">
					<p>HI - So I have followed the steps in this post and have gotten my router to boot my compiled kernel and squash root image, but its hanging at this point below.&nbsp; Any ideas why its sits at &quot;Please be patient, while OpenWrt loads...&quot;?</p><p>(FYI - tftpboots work fine, but I want to get this thing booting OpenWrt standalone...)</p><p><strong>Update:</strong><br />So I could get a working image flashed after running &#039;make menuconfig&#039; instead of trying to use the config posted by Furly with manual updates.</p><p>I also now have a fully bootable Openwrt 10.3 WNR2000v1 with these steps.</p><p>1) Updated the uboot partition with Furly&#039;s u-boot.bin <a href="http://fuhry.co.cc/b/wnr2000/u-boot.bin">http://fuhry.co.cc/b/wnr2000/u-boot.bin</a>.&nbsp; Just enable Telnet access and transfer u-boot.bin to /tmp and flash with &#039;mtd -e mtd0 write u-boot.bin mtd0&#039;</p><p>2) Update the uboot enviroment from serial console (might be able to do this from Telnet access if you install the u-boot environment package in OpenWrt)&nbsp; <br />Serial console commands I ran:</p><p><strong>setenv bootcmd &#039;bootm 0xbf2a0000&#039;<br />setenv bootargs board=WNR2000<br />saveenv</strong></p><p>3) Transfer to /tmp (via scp/wget/tftp) and flash the root.sqfs and uImage to their flash partitions as listed by &#039;cat /proc/mtd&#039;. Make sure the root.sqfs image is &lt;2.3MB.&nbsp; Under 2MB is ideal so trim as many packages you don&#039;t need in the menuconfig.</p><p>My commands were:</p><p><strong>mtd -e mtd2 write root.sqfs mtd2<br />mtd -e mtd5 write uImage mtd5</strong></p><p>4) reboot the router</p><p>Last item on my list is trying to get a web admin UI compiled in a good sized root.sqfs image.&nbsp; Webif is easy to get included but its interface seems very out of date with newer features missing or not working.&nbsp; LUCI is being actively maintained but the image grows to 2-3MB which causes space issues.</p><div class="codebox"><pre><code>U-Boot 1.1.4.15 (Sep 14 2010 - 16:39:21)

AP81 (ar7100) U-boot
sri
32 MB
Top of RAM usable for U-Boot at: 82000000
Reserving 244k for U-Boot at: 81fc0000
Reserving 192k for malloc() at: 81f90000
Reserving 44 Bytes for Board Info at: 81f8ffd4
Reserving 36 Bytes for Global Data at: 81f8ffb0
Reserving 128k for boot params() at: 81f6ffb0
Stack Pointer at: 81f6ff98
Now running in RAM - U-Boot at: 81fc0000
id read 0x100000ff
flash size 4MB, sector count = 64
Flash: 4MB
In:    serial
Out:   serial
Err:   serial
Net:   ag7100_enet_initialize...
Fetching MAC Address from 0x81fea700
: cfg1 0xf cfg2 0x7114
eth0: 00:22:3f:a8:4c:54
dup 1 speed 100
eth0 up
eth0
### main_loop entered: bootdelay=4

### main_loop: bootcmd=&quot;bootm 0xbf2a0000&quot;
Hit any key to stop autoboot:  0
ar7100&gt; imls
Image at BF2A0000:
   Image Name:   MIPS OpenWrt Linux-2.6.32.25
   Created:      2010-12-10  22:39:53 UTC
   Image Type:   MIPS Linux Kernel Image (lzma compressed)
   Data Size:    858954 Bytes = 838.8 kB
   Load Address: 80060000
   Entry Point:  80060000
   Verifying Checksum ... OK
ar7100&gt; bootm 0xbf2a0000
## Booting image at bf2a0000 ...
   Image Name:   MIPS OpenWrt Linux-2.6.32.25
   Created:      2010-12-10  22:39:53 UTC
   Image Type:   MIPS Linux Kernel Image (lzma compressed)
   Data Size:    858954 Bytes = 838.8 kB
   Load Address: 80060000
   Entry Point:  80060000
   Verifying Checksum ... OK
   Uncompressing Kernel Image ...OK
No initrd
## Transferring control to Linux (at address 80060000) ...
## Giving linux memsize in bytes, 33554432

Starting kernel ...

Linux version 2.6.32.25 (victor@victor-fc) (gcc version 4.3.3 (GCC) ) #2 Fri Dec
 10 14:39:47 PST 2010
bootconsole [early0] enabled
CPU revision is: 00019374 (MIPS 24Kc)
Atheros AR9130 rev 2, CPU:400.000 MHz, AHB:200.000 MHz, DDR:400.000 MHz
Determined physical RAM map:
 memory: 02000000 @ 00000000 (usable)
User-defined physical RAM map:
 memory: 02000000 @ 00000000 (usable)
Initrd not found or empty - disabling initrd
Zone PFN ranges:
  Normal   0x00000000 -&gt; 0x00002000
Movable zone start PFN for each node
early_node_map[1] active PFN ranges
    0: 0x00000000 -&gt; 0x00002000
Built 1 zonelists in Zone order, mobility grouping on.  Total pages: 8128
Kernel command line: rootfstype=squashfs console=ttyS0,115200 board=WNR2000 pani
c=10 init=/etc/preinit rootdelay=2 -- console=ttyS0,115200 root=31:02 init=/sbin
/init mtdparts=ar7100-nor0:256k(u-boot),64k(u-boot-env),2304k(rootfs),64k(user-c
onfig),1152k(uImage),128k(language_table),64k(rootfs_checksum),64k(ART) mem=32M
PID hash table entries: 128 (order: -3, 512 bytes)
Dentry cache hash table entries: 4096 (order: 2, 16384 bytes)
Inode-cache hash table entries: 2048 (order: 1, 8192 bytes)
Primary instruction cache 64kB, VIPT, 4-way, linesize 32 bytes.
Primary data cache 32kB, 4-way, VIPT, cache aliases, linesize 32 bytes
Writing ErrCtl register=00000000
Readback ErrCtl register=00000000
Memory: 29400k/32768k available (2032k kernel code, 3368k reserved, 384k data, 1
52k init, 0k highmem)
SLUB: Genslabs=7, HWalign=32, Order=0-3, MinObjects=0, CPUs=1, Nodes=1
Hierarchical RCU implementation.
NR_IRQS:56
Calibrating delay loop... 266.24 BogoMIPS (lpj=1331200)
Mount-cache hash table entries: 512
NET: Registered protocol family 16
MIPS: machine is NETGEAR WNR2000
bio: create slab &lt;bio-0&gt; at 0
Switching to clocksource MIPS
NET: Registered protocol family 2
IP route cache hash table entries: 1024 (order: 0, 4096 bytes)
TCP established hash table entries: 1024 (order: 1, 8192 bytes)
TCP bind hash table entries: 1024 (order: 0, 4096 bytes)
TCP: Hash tables configured (established 1024 bind 1024)
TCP reno registered
NET: Registered protocol family 1
squashfs: version 4.0 (2009/01/31) Phillip Lougher
Registering mini_fo version $Id$
JFFS2 version 2.2. (NAND) (SUMMARY)  Â© 2001-2006 Red Hat, Inc.
yaffs Dec 10 2010 14:21:59 Installing.
msgmni has been set to 57
io scheduler noop registered
io scheduler deadline registered (default)
Serial: 8250/16550 driver, 1 ports, IRQ sharing disabled
serial8250.0: ttyS0 at MMIO 0x18020000 (irq = 11) is a 16550A
console [ttyS0] enabled, bootconsole disabled
console [ttyS0] enabled, bootconsole disabled
Atheros AR71xx SPI Controller driver version 0.2.4
m25p80 spi0.0: mx25l3205d (4096 Kbytes)
Searching for RedBoot partition table in spi0.0 at offset 0x3e0000
Searching for RedBoot partition table in spi0.0 at offset 0x3f0000
No RedBoot partition table detected in spi0.0
spi0.0: no WRT160NL signature found
Creating 8 MTD partitions on &quot;spi0.0&quot;:
0x000000000000-0x000000040000 : &quot;u-boot&quot;
0x000000040000-0x000000050000 : &quot;u-boot-env&quot;
0x000000050000-0x000000290000 : &quot;rootfs&quot;
mtd: partition &quot;rootfs&quot; set to be root filesystem
mtd: partition &quot;rootfs_data&quot; created automatically, ofs=190000, len=100000
0x000000190000-0x000000290000 : &quot;rootfs_data&quot;
0x000000290000-0x0000002a0000 : &quot;user-config&quot;
0x0000002a0000-0x0000003c0000 : &quot;uImage&quot;
0x0000003c0000-0x0000003e0000 : &quot;language_table&quot;
0x0000003e0000-0x0000003f0000 : &quot;rootfs_checksum&quot;
0x0000003f0000-0x000000400000 : &quot;art&quot;
ag71xx_mdio: probed
eth0: Atheros AG71xx at 0xb9000000, irq 4
eth1: Atheros AG71xx at 0xba000000, irq 5
Atheros AR71xx hardware watchdog driver version 0.1.0
TCP westwood registered
NET: Registered protocol family 17
802.1Q VLAN Support v1.8 Ben Greear &lt;greearb@candelatech.com&gt;
All bugs added by David S. Miller &lt;davem@redhat.com&gt;
Waiting 2sec before mounting root device...
VFS: Mounted root (squashfs filesystem) readonly on device 31:2.
Freeing unused kernel memory: 152k freed
Please be patient, while OpenWrt loads ...</code></pre></div>											<p class="post-edited">(Last edited by <strong>wrtvic</strong> on 15 Dec 2010, 20:21)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p123079">
				<div class="post-metadata">
					<div class="post-num">Post #83</div>
					<div class="post-author">mazade</div>
					<div class="post-datetime">
						12 Dec 2010, 05:15					</div>
				</div>
				<div class="post-content content">
					<p>well, ok... perhaps a question that will subsequently unveil my incompetence:&nbsp; outside of re-compiling things, can the default entry of &quot;bootm 0xbf310000&quot; be changed over to &#039;our&#039; 0xbf2a0000 ???&nbsp; &nbsp;er, well, OK - at the very least it would require editing &#039;some&#039; file and then re-flashing that particular file to its appropriate address...<br />After getting a second CA-42 cable(broke the first one, somehow, before I got a chance to use it) mine appears to start up fine, aside from manually entering in the proper bootm address.&nbsp; I&#039;m learning ^_^</p>											<p class="post-edited">(Last edited by <strong>mazade</strong> on 12 Dec 2010, 05:22)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p123083">
				<div class="post-metadata">
					<div class="post-num">Post #84</div>
					<div class="post-author">mazade</div>
					<div class="post-datetime">
						12 Dec 2010, 08:28					</div>
				</div>
				<div class="post-content content">
					<p>ohh yeah, even when i get openwrt &#039;loaded &amp; running&#039;, through manual boot commands, it still didn&#039;t dish out ip addresses... is this something i need to manually start too?<br />I don&#039;t recall seeing anything about &#039;dhcp server enabled&#039; either while watching it via serial console.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p123095">
				<div class="post-metadata">
					<div class="post-num">Post #85</div>
					<div class="post-author">Jarvid</div>
					<div class="post-datetime">
						12 Dec 2010, 13:59					</div>
				</div>
				<div class="post-content content">
					<p>Hello mazade,</p><p>yes, you can change the default bood adress as you now have access to u-boot <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /><br /></p><div class="codebox"><pre><code>setenv bootcmd &#039;bootm 0xbf2a0000&#039;
saveenv</code></pre></div><p>should do the trick <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>I guess you are using the Image built by fuhry.<br />I think he did some preinits in his kernel with static IP together with an external dns server.<br />So you will have to set this manuelly either with uci or the common linux commands(add a dafault gateway by route, ifconfig ur device&nbsp; and some editing in /etc/resolv.conf for your dns).</p><p>To all others:<br />The wlan performance in client mode is terrible. I&#039;m using kernel 2.6.32,is there any hope with a higher kernel version with newer ath9 module?</p>											<p class="post-edited">(Last edited by <strong>Jarvid</strong> on 12 Dec 2010, 14:01)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p123139">
				<div class="post-metadata">
					<div class="post-num">Post #86</div>
					<div class="post-author">mazade</div>
					<div class="post-datetime">
						13 Dec 2010, 06:06					</div>
				</div>
				<div class="post-content content">
					<p>FWIW, it kept rejecting my setenv command-string and/or messed things up until I typed it in as such</p><p>setenv bootcmd &quot;bootm 0XBF2A0000&quot;</p><p>*followed up by the saveenv command*</p><p>with the single-quotes ( &#039; ) it gave an &quot;invalid!&quot; error msg, and when i left the address portion in lower case it accepted things but set the bootm address to, instead, the tftp-mode address... weird.</p><p>this is just to help out the next person as clueless as me...<br />it&#039;s now booting into OpenWRT, but no dhcp(haven&#039;t tried wan or wlan connectivity yet) - still need to invest the time &amp; learning.&nbsp; ^_^</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p123186">
				<div class="post-metadata">
					<div class="post-num">Post #87</div>
					<div class="post-author">Blind55</div>
					<div class="post-datetime">
						13 Dec 2010, 20:26					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Jarvid wrote:</cite><blockquote><p>Hello mazade,</p><p>yes, you can change the default bood adress as you now have access to u-boot <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /><br /></p><div class="codebox"><pre><code>setenv bootcmd &#039;bootm 0xbf2a0000&#039;
saveenv</code></pre></div><p>should do the trick <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>I guess you are using the Image built by fuhry.<br />I think he did some preinits in his kernel with static IP together with an external dns server.<br />So you will have to set this manuelly either with uci or the common linux commands(add a dafault gateway by route, ifconfig ur device&nbsp; and some editing in /etc/resolv.conf for your dns).</p><p>To all others:<br />The wlan performance in client mode is terrible. I&#039;m using kernel 2.6.32,is there any hope with a higher kernel version with newer ath9 module?</p></blockquote></div><p>Jarvid,</p><p>there is a lot going on in the kernel these days with respect to ath9. If you look at the kernel 2.6.36.2 (latest) changelog, a big part is ath9. However, I have not been able to compile OpenWRT with a kernel different than .32. I am using a very recent SVN version of OpenWRT, but I have not found a configuration (&#039;make menuconfig&#039;) to set the kernel.</p><p>I am running in client mode - what are the performance issues that you incur? I have not noticed anything really bad yet, but maybe just because I haven&#039;t paid much attention...</p><p>Cheers,<br />Blind</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p123427">
				<div class="post-metadata">
					<div class="post-num">Post #88</div>
					<div class="post-author">wrtvic</div>
					<div class="post-datetime">
						17 Dec 2010, 23:54					</div>
				</div>
				<div class="post-content content">
					<p>Hi all,</p><p>Using the Backfire 10.03 Image builder, I was able to build a good sized (~1.8M root.sqfs) image to flash from telnet prompt that includes the full LUCI admin UI.&nbsp; Here is the make command.</p><p><strong>make image PROFILE=AP81 PACKAGES=&quot;luci-admin-full luci-web luci-theme-base luci-theme-openwrtlight uhttpd kmod-ath9k wpad-mini wireless-tools iw libuci libuci-lua libc libgcc lua&quot;</strong></p><p>For the trunk branch with updated kernel and ath9x driver I used the following builder command (root.sqfs = ~1.9M):</p><p>Updated to include a couple more required packages:</p><p><strong>make image PROFILE=AP81 PACKAGES=&quot;luci-mod-admin-full luci-lib-web luci-theme-base luci-theme-openwrt uhttpd kmod-ath9k wpad-mini wireless-tools iw libuci libuci-lua libc libgcc lua libiwinfo&quot;</strong></p><p>Also, to configure the latest stable kernel (2.6.36.2) edit the following file under the trunk branch and set the kernel version.</p><p><strong> vi target/linux/ar71xx/Makefile</strong></p>											<p class="post-edited">(Last edited by <strong>wrtvic</strong> on 23 Dec 2010, 20:50)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p123593">
				<div class="post-metadata">
					<div class="post-num">Post #89</div>
					<div class="post-author">CheBuzz</div>
					<div class="post-datetime">
						21 Dec 2010, 03:54					</div>
				</div>
				<div class="post-content content">
					<p>I just used the serial console, but that shouldn&#039;t be strictly necessary if you want to go the telnet route.&nbsp; You can find the LAN MAC under Maintenance ? Router status ? LAN port ? MAC Address of the web admin console.&nbsp; Then do:</p><p>On my Ubuntu box:<br /></p><div class="codebox"><pre><code>wget http://wiki.openwrt.org/_media/oldwiki/openwrtdocs/hardware/netgear/telnetenable.zip
unzip telnetenable.zip
cd telnetenable
gcc -o telnetenable telnetenable.c md5.c Blowfish.c
telnetenable 192.168.1.1 &lt;Router LAN MAC&gt; Gearguy Geardog &gt; modpkt.pkt
nc 192.168.1.1 23 &lt; modpkt.pkt
telnet 192.168.1.1</code></pre></div><p>Backup u-boot and ART.&nbsp; I used FTP, in which case you will need an FTP server running on your box.&nbsp; On ubuntu, I used ftpd.&nbsp; This is not strictly necessary, but a good idea.</p><p>On the WNR2000:<br /></p><div class="codebox"><pre><code>dd if=/dev/mtdblock0 of=/tmp/u-boot.orig.bin
dd if=/dev/mtdblock7 of=/tmp/ART.orig.bin
ftpput --user=&lt;username&gt; --password=&lt;password&gt; --verbose 192.168.1.2 . u-boot.orig.bin
ftpput --user=&lt;username&gt; --password=&lt;password&gt; --verbose 192.168.1.2 . ART.orig.bin</code></pre></div><p>I then flashed fuhry&#039;s u-boot to the router:</p><p>On my Ubuntu box (in my home directory):<br /></p><div class="codebox"><pre><code>wget http://fuhry.co.cc/b/wnr2000/u-boot.bin</code></pre></div><p>On the WNR2000:<br /></p><div class="codebox"><pre><code>ftpget --user=&lt;username&gt; --password=&lt;password&gt; --verbose 192.168.1.2 u-boot.bin u-boot.bin
mtd -e mtd0 write u-boot.bin mtd0</code></pre></div><p>You can now compile OpenWRT from source or use fuhry&#039;s supplied uImage and rootfs:</p><p>On my Ubuntu box (in my home directory):<br /></p><div class="codebox"><pre><code>wget http://fuhry.co.cc/b/wnr2000/uImage
wget http://fuhry.co.cc/b/wnr2000/root.sqfs</code></pre></div><p>On the WNR2000:<br /></p><div class="codebox"><pre><code>ftpget --user=&lt;username&gt; --password=&lt;password&gt; --verbose 192.168.1.2 uImage uImage
ftpget --user=&lt;username&gt; --password=&lt;password&gt; --verbose 192.168.1.2 root.sqfs root.sqfs
mtd -e mtd2 write root.sqfs mtd2
mtd -e mtd5 write uImage mtd5</code></pre></div><p>The only thing left after that was to change the bootargs:<br /></p><div class="codebox"><pre><code>setenv bootargs board=WNR2000
saveenv</code></pre></div><p>That got me a working OpenWRT image.&nbsp; I no longer had to change the bootcmd string, so it seems this is fixed in fuhry&#039;s u-boot.bin link.</p><p>I&#039;m now compiling from source to run a more tailored-to-me image.&nbsp; I may also post a more generic image.&nbsp; I am also interested in repartitioning the mtd since I won&#039;t be needing user-config (64k), language_table (128k), or rootfs_checksum (64k) that come by default.&nbsp; It would be nice to have that extra 500k.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p123988">
				<div class="post-metadata">
					<div class="post-num">Post #90</div>
					<div class="post-author">fuhry</div>
					<div class="post-datetime">
						27 Dec 2010, 08:02					</div>
				</div>
				<div class="post-content content">
					<p>Yikes. I just realized my ubootenv.img includes reconfigured partitions, so that&#039;s why you&#039;re having problems, Jarvid. I really do think we ought to get redboot partition table support in. In the mean time, you can fix your router with an RS232 level shifter (mine was $3 with free shipping) and an appropriate serial cable.</p><div class="quotebox"><cite>nabcore wrote:</cite><blockquote><p>2) If the OpenWrt specific kernel parameters can be supplied via CONFIG_CMDLINE, surely the best thing for backwards compatibility is to minimise the modifications u-boot; hence the CONFIG_BOOTARGS section of the u-boot patch perhaps should be omitted, so that the original kernel could be booted if the user so wanted?</p></blockquote></div><p>Unfortunately, no. I tried this and was sure it would work. The problem is that Linux uses the *first* init= parameter it finds, not the last, and CONFIG_CMDLINE appends as opposed to prepending. Since the U-Boot environment specifies init= one path and OpenWRT uses init= a different path, the only ways to fix it are ugly kernel hacks or changing the u-boot environment. If you don&#039;t do one of those two, OpenWRT will try to boot using the wrong init command.</p><p>I&#039;m away from my uni on break and unfortunately just had a bad encounter with failsafe mode and its lack of a working reboot command. Thus, I&#039;m locked out of my WNR2000 until I get back up there in a week and can physically reset it. At that point I should be able to work on this project a little bit more.</p>											<p class="post-edited">(Last edited by <strong>fuhry</strong> on 27 Dec 2010, 08:03)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p124422">
				<div class="post-metadata">
					<div class="post-num">Post #91</div>
					<div class="post-author">fuhry</div>
					<div class="post-datetime">
						3 Jan 2011, 19:10					</div>
				</div>
				<div class="post-content content">
					<p>Alright. Problem solved. Here we have the fixed (I think) U-Boot environment image:</p><p><a href="http://fuhry.com/b/wnr2000/ubootenv-stockpartitions.img">http://fuhry.com/b/wnr2000/ubootenv-stockpartitions.img</a></p><p>Here is the Perl script I wrote and subsequently used to modify U-Boot environment images:</p><p><a href="http://fuhry.com/b/wnr2000/ubootenv.pl">http://fuhry.com/b/wnr2000/ubootenv.pl</a></p><p><strong>You should now be able to flash your WNR2000 without a serial console. Rundown of the process:</strong></p><p>- telnetenable<br />- telnet into your router<br />- cd /tmp<br />- </p><div class="codebox"><pre><code>snarf http://fuhry.com/b/wnr2000/{ubootenv-stockpartitions.img,u-boot.bin,uImage,root.sqfs}</code></pre></div><p>- mtd -e mtd0 write u-boot.bin mtd0<br />- mtd -e mtd1 write ubootenv-stockpartitions.bin mtd1<br />- mtd -e mtd2 write root.sqfs mtd2<br />- mtd -e mtd4 write uImage mtd4<br />- reboot</p><p>Caveats:<br />- <strong>You cannot go back to the default firmware unless you load in a backup of the old u-boot environment.</strong><br />- <strong>If your router loses power while you are flashing mtd0, it will be bricked, forever, period.</strong><br />- If your router loses power while you are flashing mtd1, it will be bricked, until you can get a serial console.</p><p>For the record: you can generate a u-boot environment image for the old (stock) firmware using ubootenv.pl and setting bootargs to:</p><p>console=ttyS0,115200 root=31:02 init=/sbin/init mtdparts=ar7100-nor0:256k(u-boot),64k(u-boot-env),2304k(rootfs),64k(user-config),1152k(uImage),128k(language_table),64k(rootfs_checksum),64k(ART)</p><p>Quick rundown of ubootenv.pl:<br />It has two modes, interactive and script. Interactive mode will give you a prompt at which you can run commands. The commands are print, set, load and write.</p><p>print: print the current environment.<br />set &lt;key&gt; &lt;value&gt;: create or change any value within the environment. If there are spaces in the value, don&#039;t quote it or anything. Example: &quot;set foo bar baz&quot; will set foo to &quot;bar baz&quot;.<br />load &lt;file&gt;: Load up and parse an existing U-Boot environment image.<br />write &lt;file&gt;: Save the current environment to an image file you can flash.</p><p>If you launched ubootenv.pl with an environment file specified (&quot;./ubootenv.pl foo.img&quot;) that image will be automatically loaded and typing &quot;write&quot; without any filename after it will overwrite the image you specified. You can also use ubootenv.pl as part of a script if needed... just run it with -h to see documentation on that.</p><p>I&#039;m not responsible if you brick your router. This is an experimental release. Use it at your own risk. The u-boot environment I uploaded has been minimally tested - all I know is that the CRC check returns correct and the u-boot image hosted on my webserver flashes properly. I will try and get some more thorough testing done tonight.</p><p><strong>One more thing:</strong> I&#039;m going to try and come up with a way to repartition and go to OpenWRT without serial console access. It&#039;ll be haxxy though.</p><p>-fuhry</p>											<p class="post-edited">(Last edited by <strong>fuhry</strong> on 1 Jun 2013, 05:36)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p125124">
				<div class="post-metadata">
					<div class="post-num">Post #92</div>
					<div class="post-author">mazade</div>
					<div class="post-datetime">
						11 Jan 2011, 07:55					</div>
				</div>
				<div class="post-content content">
					<p>Hello again,<br />I&#039;ve had some trouble trying to find a few files/packages that WRTVIC mentions in his recent post, can anyone direct me to them?</p><p>luci-mod-admin-full<br />iw</p><p>I&#039;ve searched most of the 10.03 and beta/rc# folders trying to figure out if WRTVIC was referencing a particular folder that I wasn&#039;t looking in...<br />Still interested in getting this thing up and running but I&#039;ve been good and distracted with a number of other projects, including fighting with a dockstar that doesn&#039;t want to talk to my ftp server(s) so I can get OpenWRT on it too&nbsp; &nbsp;: / </p><p>Thanks for everything so far.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p125258">
				<div class="post-metadata">
					<div class="post-num">Post #93</div>
					<div class="post-author">wrtvic</div>
					<div class="post-datetime">
						12 Jan 2011, 23:20					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>mazade wrote:</cite><blockquote><p>Hello again,<br />I&#039;ve had some trouble trying to find a few files/packages that WRTVIC mentions in his recent post, can anyone direct me to them?</p><p>luci-mod-admin-full<br />iw</p><p>I&#039;ve searched most of the 10.03 and beta/rc# folders trying to figure out if WRTVIC was referencing a particular folder that I wasn&#039;t looking in...<br />Still interested in getting this thing up and running but I&#039;ve been good and distracted with a number of other projects, including fighting with a dockstar that doesn&#039;t want to talk to my ftp server(s) so I can get OpenWRT on it too&nbsp; &nbsp;: / </p><p>Thanks for everything so far.</p></blockquote></div><p>They are built via the config.</p><p>.config entries are,</p><p>#<br /># Modules<br />#<br />CONFIG_PACKAGE_luci-mod-admin-core=y<br /><strong>CONFIG_PACKAGE_luci-mod-admin-full=y<br />...<br />CONFIG_PACKAGE_iw=y</strong></p><p>if you built Openwrt, they should be under the packages directory at the top level of your build tree.</p><p>I have posted my rootfs and uImages with LUCI admin interfaces here:&nbsp; 7z file contains ones for 10.03 Backfire, trunk and trunk with latest stable kernel 2.6.36.2.</p><p><a href="http://hotfile.com/dl/96324592/e060162/Netgear-WNR2000-Openwrt.7z.html">http://hotfile.com/dl/96324592/e060162/ … rt.7z.html</a></p>											<p class="post-edited">(Last edited by <strong>wrtvic</strong> on 12 Jan 2011, 23:33)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p125380">
				<div class="post-metadata">
					<div class="post-num">Post #94</div>
					<div class="post-author">mazade</div>
					<div class="post-datetime">
						14 Jan 2011, 07:01					</div>
				</div>
				<div class="post-content content">
					<p>Wow, excellent.&nbsp; <br />On with more tarded-ness; I&#039;m, mentally, having difficulty figuring out how to flash these files(respective rootfs/uImage) that you posted, when within the already flashed &amp; booted-into u-boot environment.<br />specific commands &amp; &quot;0x&quot; addresses...</p><p>yes, being more of a bane to all who actually know what they&#039;re doing...</p><p>Thanks for all of the shared know-how thus so far.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p125385">
				<div class="post-metadata">
					<div class="post-num">Post #95</div>
					<div class="post-author">fuhry</div>
					<div class="post-datetime">
						14 Jan 2011, 08:54					</div>
				</div>
				<div class="post-content content">
					<p>[s]<strong>Update:</strong><br />I&#039;ve been working on the images today. For some reason, a lot of stuff seems broken (nothing pings). I&#039;ve pulled the images until I figure out what&#039;s going on and fix it.[/s]</p><p><strong>See next post</strong></p>											<p class="post-edited">(Last edited by <strong>fuhry</strong> on 14 Jan 2011, 15:21)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p125399">
				<div class="post-metadata">
					<div class="post-num">Post #96</div>
					<div class="post-author">inoremap</div>
					<div class="post-datetime">
						14 Jan 2011, 12:32					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>fuhry wrote:</cite><blockquote><p><strong>Update:</strong>For some reason, a lot of stuff seems broken (nothing pings)</p></blockquote></div><p>dnsmasq in the firmware from fuhry.co.cc/b/wnr2000/ can not be started due to error <a href="https://dev.openwrt.org/ticket/7590">https://dev.openwrt.org/ticket/7590</a> , this bug still present in revision r24965, after applying the patch <a href="http://freetz.org/attachment/ticket/1063/mklibs_libm.patch">http://freetz.org/attachment/ticket/106 … libm.patch</a> , I was able to successfully compile and install the firmware on my wnr2000, using your config-file. Many thanks for the fixed bootloader and installation instructions.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p125411">
				<div class="post-metadata">
					<div class="post-num">Post #97</div>
					<div class="post-author">fuhry</div>
					<div class="post-datetime">
						14 Jan 2011, 15:21					</div>
				</div>
				<div class="post-content content">
					<p><strong>Edit (2013-06-01): Links have been fixed. The co.cc service was canceled years ago, and all links work from fuhry.com or fuhry.us.</strong></p><p>I was experiencing an issue where all packets coming out of the WAN interface were being dropped. The bug seems to have disappeared from the current builds. It might be related to inoremap&#039;s issue (which I&#039;m not seeing in current builds)</p><p>Today&#039;s updates: (well, mostly yesterday&#039;s - I pulled an all nighter to get this done)</p><p>- Everything has been tested. Everything. I flashed my router back to all the defaults, then went back and forth between the stock firmware and OpenWRT.<br />- LuCI is now included in my builds.<br />- My builds now use the default IP address 192.168.1.1, instead of 10.1.11.1<br />- The u-boot image has been rebuilt with default settings that match those of the stock firmware. This means that if you get kicked into upgrade mode and your u-boot environment is corrupt, you can do a TFTP restore. This makes it possible to recover from a bad flash of the environment, but if the environment has the wrong settings and a valid CRC, you still have to use a serial console. Really, the only way to work around this is to build in some way to edit the environment over the network within U-Boot. If I&#039;m feeling adventurous, I might be able to code this. I&#039;m not writing a TCP stack for u-boot though <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p><p><strong>And, I also came up with a way you can repartition!</strong> (As warned, it is very haxxy... but it worked in my test)</p><p><strong><span class="bbu">INSTALLATION:</span></strong><br />Do these from the <strong>stock firmware, within telnetenable</strong>!</p><p><strong>No repartitioning - slightly safer:</strong><br /></p><div class="codebox"><pre><code>cd /tmp
for f in u-boot.bin ubootenv-stockpartitions.img root.sqfs uImage; do snarf http://fuhry.com/b/wnr2000/$f; done
mtd -e mtd0 write u-boot.bin mtd0
mtd -e mtd1 write ubootenv-stockpartitions.img mtd1
mtd -e mtd2 write root.sqfs mtd2
mtd -e mtd4 write uImage mtd4
reboot</code></pre></div><p><strong>Repartitioned install - gives you an additional ~500K of space:</strong> (I made a nice little script for this one)<br /></p><div class="codebox"><pre><code>snarf -q http://fuhry.com/b/wnr2000/install-repart.sh - | grep -v host: | /bin/sh -</code></pre></div><p>Notes on how repartitioning works are at: <a href="http://fuhry.com/b/wnr2000/repart-notes">http://fuhry.com/b/wnr2000/repart-notes</a></p><p><strong>Going back:</strong><br />At an OpenWRT shell:<br /></p><div class="codebox"><pre><code>mtd erase u-boot-env
mtd erase uImage
reboot</code></pre></div><p>You&#039;ll get kicked into TFTP recovery mode, at which point you can flash in the default firmware.</p><p><strong>Enjoy!</strong></p><p>-fuhry</p>											<p class="post-edited">(Last edited by <strong>fuhry</strong> on 1 Jun 2013, 05:34)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p125555">
				<div class="post-metadata">
					<div class="post-num">Post #98</div>
					<div class="post-author">fuhry</div>
					<div class="post-datetime">
						15 Jan 2011, 18:39					</div>
				</div>
				<div class="post-content content">
					<p>Builds have been updated to include libiwinfo.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p126052">
				<div class="post-metadata">
					<div class="post-num">Post #99</div>
					<div class="post-author">edude03</div>
					<div class="post-datetime">
						20 Jan 2011, 19:14					</div>
				</div>
				<div class="post-content content">
					<p>fuhry, you are amazing. This works amazingly well.</p><p>However, I do have one slight issue, after flashing DHCP doesn&#039;t work. Did I miss something?<br />EDIT: I also noticed that settings don&#039;t persist through a reboot, I&#039;m going to take a look into that tonight though.</p>											<p class="post-edited">(Last edited by <strong>edude03</strong> on 21 Jan 2011, 20:20)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p126232">
				<div class="post-metadata">
					<div class="post-num">Post #100</div>
					<div class="post-author">mazade</div>
					<div class="post-datetime">
						22 Jan 2011, 20:35					</div>
				</div>
				<div class="post-content content">
					<p>^_^ and I&#039;m on the opposite end of the spectrum from fuhry... somewhere past being a total tard.<br />&lt;whining&gt;<br />All that is functioning on my wnr2000 is the base u-boot environment.<br />How might I be able to flash, towards the direction of stock FW, or continuing on towards full OpenWRT that you gentlemen have so kindly provided.<br />I do have all of the images/files to move in either direction, but I don&#039;t have there wherewithal to figure out the commands and memory addresses to make it all happen.<br />&lt;/whining&gt;</p>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 4 of 15</div><nav><ul><li><a href="viewtopic.php%3Fid=18279&amp;p=1.html">1</a></li><li><a href="viewtopic.php%3Fid=18279&amp;p=2.html">2</a></li><li><a href="viewtopic.php%3Fid=18279&amp;p=3.html">3</a></li><li class="pagination-current"><span>4</span></li><li><a href="viewtopic.php%3Fid=18279&amp;p=5.html">5</a></li><li><a href="viewtopic.php%3Fid=18279&amp;p=6.html">6</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=18279&amp;p=15.html">15</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>