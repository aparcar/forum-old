<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> OpenVPN server - need to add local LAN addresses</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 30 Mar 2018 and 21 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 2</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=63341&amp;p=2.html">2</a></li></ul></nav></div>
			
		
		
			<article class="post" id="p314658">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">DonJuane</div>
					<div class="post-datetime">
						13 Mar 2016, 17:27					</div>
				</div>
				<div class="post-content content">
					<p>I am working toward the same basic setup as the previous poster here, when I connect, I want all traffic from my remote Windows laptop to go through my home OpenWRT/VPN server.&nbsp; &nbsp;Good news is that after 24 hours of my first OpenWRT OpenVPN installation, I have it working with the exception of allowing me to access other IP addresses on the local LAN of my home OpenWRT/VPN server. </p><p>What works:<br />- from remote locations I can use Windows OpenVPN to access my home OpenWRT server<br />- tracrt out from my remote Windows OpenVPN client, the path is as I desire, all traffic snakes out originatin from my remote client laptop and out via my home OpenVPN server<br />- whatsmyIP.com shows the IP of my OpenVPN server and not the hotel IP where I am located<br />- I can access my OpenWRT luci interface at 192.168.2.1</p><p>What I cannot do and wish to fix:<br />- to ping other servers on my network 192.168.2.2(and up) and not simply only the router (192.168.2.1) as is the case now.</p><p>My setup is exactly as configured here (non-bridged version): <a href="https://wiki.openwrt.org/doc/howto/vpn.openvpn">https://wiki.openwrt.org/doc/howto/vpn.openvpn</a> </p><p>The exception to the above reverenced (vpn.openvpn) guide was adding these items to my openvpn configuration file:</p><p>uci set openvpn.myvpn.keepalive=&#039;10 120&#039; <br />uci set openvpn.myvpn.status=&#039;/var/log/openvpn-status.log&#039; <br />uci add_list openvpn.myvpn.push=&#039;route 192.168.2.0 255.255.255.0&#039; <br />uci add_list openvpn.myvpn.push=&#039;dhcp-option DNS 192.168.2.1&#039;<br />uci add_list openvpn.myvpn.push=&#039;redirect-gateway def1&#039;<br />uci commit openvpn</p><p>Sounds like a firewall issue to me?&nbsp; &nbsp;Here is the result created from the uci based firewall adds from the URL of the guild I referenced:</p><p>config rule<br />&nbsp; &nbsp; option name &#039;Allow-OpenVPN-Inbound&#039;<br />&nbsp; &nbsp; option target &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option src &#039;*&#039;<br />&nbsp; &nbsp; option proto &#039;udp&#039;<br />&nbsp; &nbsp; option dest_port &#039;1194&#039;</p><p>config zone<br />&nbsp; &nbsp; option name &#039;vpn&#039;<br />&nbsp; &nbsp; option input &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option forward &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option output &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option network &#039;vpn0&#039;</p><p>config forwarding<br />&nbsp; &nbsp; option src &#039;vpn&#039;<br />&nbsp; &nbsp; option dest &#039;wan&#039;</p><br /><br /><br /><br /><p>Reference: I began with this guide: <a href="https://wiki.openwrt.org/doc/howto/vpn.openvpn">https://wiki.openwrt.org/doc/howto/vpn.openvpn</a> and to came up with the additional code I added from pieces found at <a href="https://wiki.openwrt.org/inbox/vpn.howto">https://wiki.openwrt.org/inbox/vpn.howto</a> <a href="https://wiki.openwrt.org/doc/howto/openvpn-streamlined-server-setup">https://wiki.openwrt.org/doc/howto/open … rver-setup</a> <a href="https://wiki.openwrt.org/doc/howto/vpn.server.openvpn.tap">https://wiki.openwrt.org/doc/howto/vpn. … penvpn.tap</a> <a href="https://wiki.openwrt.org/doc/howto/vpn.server.openvpn.tun">https://wiki.openwrt.org/doc/howto/vpn. … penvpn.tun</a> and <a href="https://wiki.openwrt.org/doc/howto/vpn.client.openvpn.tun">https://wiki.openwrt.org/doc/howto/vpn. … penvpn.tun</a></p><p>*** correct typo &quot;tunneled&quot;; change to &quot;bridged&quot;</p>											<p class="post-edited">(Last edited by <strong>DonJuane</strong> on 13 Mar 2016, 17:39)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p314660">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">DonJuane</div>
					<div class="post-datetime">
						13 Mar 2016, 17:43					</div>
				</div>
				<div class="post-content content">
					<p>Server openvpn conf:</p><br /><p>config openvpn &#039;myvpn&#039;<br />&nbsp; &nbsp; option enabled &#039;1&#039;<br />&nbsp; &nbsp; option verb &#039;3&#039;<br />&nbsp; &nbsp; option port &#039;1194&#039;<br />&nbsp; &nbsp; option proto &#039;udp&#039;<br />&nbsp; &nbsp; option dev &#039;tun&#039;<br />&nbsp; &nbsp; option server &#039;10.8.0.0 255.255.255.0&#039;<br />&nbsp; &nbsp; option ca &#039;/etc/openvpn/ca.crt&#039;<br />&nbsp; &nbsp; option cert &#039;/etc/openvpn/server.crt&#039;<br />&nbsp; &nbsp; option key &#039;/etc/openvpn/server.key&#039;<br />&nbsp; &nbsp; option dh &#039;/etc/openvpn/dh2048.pem&#039;<br />&nbsp; &nbsp; option keepalive &#039;10 120&#039;<br />&nbsp; &nbsp; option status &#039;/var/log/openvpn-status.log&#039;<br />&nbsp; &nbsp; list push &#039;route 192.168.2.0 255.255.255.0&#039;<br />&nbsp; &nbsp; list push &#039;redirect-gateway def1&#039;<br />&nbsp; &nbsp; list push &#039;dhcp-option DNS 192.168.2.1&#039;</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p314673">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">RangerZ</div>
					<div class="post-datetime">
						13 Mar 2016, 19:36					</div>
				</div>
				<div class="post-content content">
					<p>I do not have the links handy, but go to the OpenVpn site and search for tunneling and bridging.&nbsp; Short story they will tell you that if you want to access local resources to use TAP.&nbsp; That said I have been told you can also do this with TUN, but I have not gotten it to work.&nbsp; If you search the OpenWrt forum for VPN posts with my handle you should find some reference to the requirement to add some config (firewall rules if I recall) to support what you want to do.</p><p>If you find the post, please reference the link</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p314711">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">DonJuane</div>
					<div class="post-datetime">
						14 Mar 2016, 07:03					</div>
				</div>
				<div class="post-content content">
					<p>I found your comments in this area located here:<br /><a href="https://forum.openwrt.org/search.php?search_id=274350135&amp;p=2">https://forum.openwrt.org/search.php?se … 35&amp;p=2</a><br /><a href="https://forum.openwrt.org/viewtopic.php?pid=291961#p291961">https://forum.openwrt.org/viewtopic.php … 61#p291961</a><br /><a href="https://forum.openwrt.org/viewtopic.php?pid=291946#p291946">https://forum.openwrt.org/viewtopic.php … 46#p291946</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p314715">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">DonJuane</div>
					<div class="post-datetime">
						14 Mar 2016, 07:28					</div>
				</div>
				<div class="post-content content">
					<p>I had this working on a fairly recent version of dd-wrt by using the following firewall rules:</p><p>iptables -I FORWARD 1 --source 10.10.10.0/24 -j ACCEPT<br />iptables -t nat -A POSTROUTING -s 10.10.10.0/24 -o br0 -j MASQUERADE<br />iptables -t nat -A POSTROUTING -s 10.10.10.0/24 -j MASQUERADE<br />iptables -I FORWARD -i br0 -o tun2 -j ACCEPT<br />iptables -I FORWARD -i tun2 -o br0 -j ACCEPT<br />iptables -t nat -I POSTROUTING -o tun2 -j MASQUERADE</p><p>I don&#039;t really understand firewall rules but someone provided these commands for me to use and they worked on dd-wrt with openvpn server for nearly a year, well until I kept bricking the Buffalo every time I simply made a configuration change.&nbsp; &nbsp;The problem was my model Buffalo which was notorious for locking up on dd-wrt when anyone logged into the web interface, went to certain websites, downloaded a big file or changed anything in the configuration.&nbsp; &nbsp;Was requiring a reconfigure with every &quot;save&quot; so I finally gave up.&nbsp; &nbsp;Trying to get up to speed now as a new OpenWRT user.&nbsp; &nbsp;(Old Buffalo is now steady as a rock.)</p><p>If I can figure out what these commands are doing and apply to OpenWRT, maybe this would resolve my issue?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p314718">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">DonJuane</div>
					<div class="post-datetime">
						14 Mar 2016, 07:58					</div>
				</div>
				<div class="post-content content">
					<p>config forwarding<br />&nbsp; &nbsp; option src &#039;vpn&#039;<br />&nbsp; &nbsp; option dest &#039;wan&#039;</p><p>Changing option dest &#039;wan&#039;&nbsp; to a value of &#039;lan&#039; killed all the traffic except the ability to get to luci 192.168.2.1&nbsp; &nbsp;<br />With the value changed to &#039;lan&quot; I could not communicate with anyone but luci on the router itself.</p><p>C:\windows\system32&gt;tracert <a href="http://www.google.com">www.google.com</a></p><p>Tracing route to <a href="http://www.google.com">www.google.com</a> [216.58.192.68]<br />over a maximum of 30 hops:</p><p>&nbsp; 1&nbsp; &nbsp;103 ms&nbsp; &nbsp; 93 ms&nbsp; &nbsp; 67 ms&nbsp; 10.8.0.1<br />&nbsp; 2&nbsp; 10.8.0.1&nbsp; reports: Destination protocol unreachable.</p><p>Trace complete.</p><p>C:\windows\system32&gt;</p><p>So with the option set to &#039;lan&#039; I can only communicate with the OpenWRT/VPN server.<br />With the option set to &#039;wan&#039; I can only communicate with the external Internet, out from the OpenWRT server (in addition to ONLY the 192.168.2.1, the luci gateway on my home LAN - cannot communicate with other devices on the router LAN 192.168.2.2 - 253)</p>											<p class="post-edited">(Last edited by <strong>DonJuane</strong> on 14 Mar 2016, 08:00)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p314746">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">RangerZ</div>
					<div class="post-datetime">
						14 Mar 2016, 15:02					</div>
				</div>
				<div class="post-content content">
					<p>Beyond my skill set at this point.&nbsp; You probably need to post your related config files (Firewall, network, openvpn) for both sides.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p314768">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">cmsigler</div>
					<div class="post-datetime">
						14 Mar 2016, 17:50					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>I always use &quot;dev tap&quot; because my tunnel is secure on both ends, and I want to transport SMB and other non-IP protocols.&nbsp; So my experience with &quot;dev tun&quot; is very limited -- please take this FWIW:</p><p>- Have you enabled IPv4 forwarding on the OpenVPN server?<br />- Are iptables rules on the OpenVPN server correctly set up to do source NAT from your OpenVPN tunnel network (10.8.0.0/24) to the OpenVPN server&#039;s LAN (192.168.2.0/24)?<br />- Are there stray iptables rules on the OpenVPN server that are rejecting or dropping packets?&nbsp; &quot;-j LOG&quot; is your friend -- please read about how to use it if needed.</p><p>More likely, these may be your problems:</p><p>- On your laptop, have you added a route to the OpenVPN server LAN (192.168.2.0/24) via the IP address (e.g., 10.8.0.1) of the OpenVPN server end of the tunnel?<br />- Have you added a default route to the Internet through the OpenVPN server end of the tunnel?</p><p>I&#039;m not sure if this is the fix you need or not....&nbsp; If you have experience this will take a little time to grok and get right.&nbsp; If you don&#039;t have experience it may appear baffling <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p><p>Here are some resources I looked up for you:</p><p><a href="https://forums.openvpn.net/topic15879.html">https://forums.openvpn.net/topic15879.html</a><br /><a href="https://forums.openvpn.net/topic7722.html">https://forums.openvpn.net/topic7722.html</a><br /><a href="https://forums.openvpn.net/topic9465.html">https://forums.openvpn.net/topic9465.html</a></p><p><a href="https://community.openvpn.net/openvpn/wiki/BridgingAndRouting">https://community.openvpn.net/openvpn/w … AndRouting</a><br /><a href="https://openvpn.net/index.php/open-source/faq/79-client/255-qconnection-initiated-with-xxxxq-but-i-cannot-ping-the-server-through-the-vpn.html">https://openvpn.net/index.php/open-sour … e-vpn.html</a><br /><a href="https://openvpn.net/index.php/open-source/documentation/howto.html#scope">https://openvpn.net/index.php/open-sour … html#scope</a></p><p>Not all of these are identical to your desired config, but reading them may help explain some of the necessary configuration.</p><p>Clemmitt</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p314779">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">DonJuane</div>
					<div class="post-datetime">
						14 Mar 2016, 18:47					</div>
				</div>
				<div class="post-content content">
					<p>Server OpenVPN config file:<br /></p><div class="codebox"><pre><code>config openvpn &#039;myvpn&#039;
    option enabled &#039;1&#039;
    option verb &#039;3&#039;
    option port &#039;1194&#039;
    option proto &#039;udp&#039;
    option dev &#039;tun&#039;
    option server &#039;10.8.0.0 255.255.255.0&#039;
    option ca &#039;/etc/openvpn/ca.crt&#039;
    option cert &#039;/etc/openvpn/server.crt&#039;
    option key &#039;/etc/openvpn/server.key&#039;
    option dh &#039;/etc/openvpn/dh2048.pem&#039;
    option keepalive &#039;10 120&#039;
    option status &#039;/var/log/openvpn-status.log&#039;
    list push &#039;route 192.168.2.0 255.255.255.0&#039;
    list push &#039;redirect-gateway def1&#039;
    list push &#039;dhcp-option DNS 192.168.2.1</code></pre></div><p>Server Firewall:<br /></p><div class="codebox"><pre><code>config defaults
    option syn_flood &#039;1&#039;
    option input &#039;ACCEPT&#039;
    option output &#039;ACCEPT&#039;
    option forward &#039;REJECT&#039;

config zone
    option name &#039;lan&#039;
    list network &#039;lan&#039;
    option input &#039;ACCEPT&#039;
    option output &#039;ACCEPT&#039;
    option forward &#039;ACCEPT&#039;

config zone
    option name &#039;wan&#039;
    list network &#039;wan&#039;
    list network &#039;wan6&#039;
    option input &#039;REJECT&#039;
    option output &#039;ACCEPT&#039;
    option forward &#039;REJECT&#039;
    option masq &#039;1&#039;
    option mtu_fix &#039;1&#039;

config forwarding
    option src &#039;lan&#039;
    option dest &#039;wan&#039;

config rule
    option name &#039;Allow-DHCP-Renew&#039;
    option src &#039;wan&#039;
    option proto &#039;udp&#039;
    option dest_port &#039;68&#039;
    option target &#039;ACCEPT&#039;
    option family &#039;ipv4&#039;

config rule
    option name &#039;Allow-Ping&#039;
    option src &#039;wan&#039;
    option proto &#039;icmp&#039;
    option icmp_type &#039;echo-request&#039;
    option family &#039;ipv4&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-IGMP&#039;
    option src &#039;wan&#039;
    option proto &#039;igmp&#039;
    option family &#039;ipv4&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-DHCPv6&#039;
    option src &#039;wan&#039;
    option proto &#039;udp&#039;
    option src_ip &#039;fe80::/10&#039;
    option src_port &#039;547&#039;
    option dest_ip &#039;fe80::/10&#039;
    option dest_port &#039;546&#039;
    option family &#039;ipv6&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-MLD&#039;
    option src &#039;wan&#039;
    option proto &#039;icmp&#039;
    option src_ip &#039;fe80::/10&#039;
    list icmp_type &#039;130/0&#039;
    list icmp_type &#039;131/0&#039;
    list icmp_type &#039;132/0&#039;
    list icmp_type &#039;143/0&#039;
    option family &#039;ipv6&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-ICMPv6-Input&#039;
    option src &#039;wan&#039;
    option proto &#039;icmp&#039;
    list icmp_type &#039;echo-request&#039;
    list icmp_type &#039;echo-reply&#039;
    list icmp_type &#039;destination-unreachable&#039;
    list icmp_type &#039;packet-too-big&#039;
    list icmp_type &#039;time-exceeded&#039;
    list icmp_type &#039;bad-header&#039;
    list icmp_type &#039;unknown-header-type&#039;
    list icmp_type &#039;router-solicitation&#039;
    list icmp_type &#039;neighbour-solicitation&#039;
    list icmp_type &#039;router-advertisement&#039;
    list icmp_type &#039;neighbour-advertisement&#039;
    option limit &#039;1000/sec&#039;
    option family &#039;ipv6&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-ICMPv6-Forward&#039;
    option src &#039;wan&#039;
    option dest &#039;*&#039;
    option proto &#039;icmp&#039;
    list icmp_type &#039;echo-request&#039;
    list icmp_type &#039;echo-reply&#039;
    list icmp_type &#039;destination-unreachable&#039;
    list icmp_type &#039;packet-too-big&#039;
    list icmp_type &#039;time-exceeded&#039;
    list icmp_type &#039;bad-header&#039;
    list icmp_type &#039;unknown-header-type&#039;
    option limit &#039;1000/sec&#039;
    option family &#039;ipv6&#039;
    option target &#039;ACCEPT&#039;

config include
    option path &#039;/etc/firewall.user&#039;

config rule
    option src &#039;wan&#039;
    option dest &#039;lan&#039;
    option proto &#039;esp&#039;
    option target &#039;ACCEPT&#039;

config rule
    option src &#039;wan&#039;
    option dest &#039;lan&#039;
    option dest_port &#039;500&#039;
    option proto &#039;udp&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-OpenVPN-Inbound&#039;
    option target &#039;ACCEPT&#039;
    option src &#039;*&#039;
    option proto &#039;udp&#039;
    option dest_port &#039;1194&#039;

config zone
    option name &#039;vpn&#039;
    option input &#039;ACCEPT&#039;
    option forward &#039;ACCEPT&#039;
    option output &#039;ACCEPT&#039;
    option network &#039;vpn0&#039;

config forwarding
    option src &#039;vpn&#039;
    option dest &#039;wan&#039;</code></pre></div><p>Windows OpenVPN client config (latest release)<br /></p><div class="codebox"><pre><code>client
dev tun
proto udp

remote-cert-tls server
push &quot;redirect-gateway def1&quot;
push &quot;dhcp-option DNS 192.168.2.1&quot;

remote (my dynamic dns).com 1194

ca ca.crt
cert client1.crt
key client1.key

ns-cert-type server

verb 3

#note: (my dynamic dns) is actually the dynamicDNS of my OpenWRT router</code></pre></div>											<p class="post-edited">(Last edited by <strong>DonJuane</strong> on 14 Mar 2016, 18:50)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p314797">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">cmsigler</div>
					<div class="post-datetime">
						14 Mar 2016, 21:09					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>It looks to me like your OpenVPN server is set up correctly.&nbsp; On the client, I don&#039;t think you&#039;re supposed to use:</p><p>push &quot;redirect-gateway def1&quot;<br />push &quot;dhcp-option DNS 192.168.2.1&quot;</p><p>Aren&#039;t those server-only options?&nbsp; But the client probably just ignores these???&nbsp; Please get rid of them just in case.</p><p>Be careful with your OpenVPN server config, you&#039;ve dropped a closing quotation mark here:<br /></p><div class="codebox"><pre><code>list push &#039;dhcp-option DNS 192.168.2.1</code></pre></div><p>From what I understand, your OpenVPN server <span class="bbu">is</span> the publicly routable, upstream-connected Internet gateway for the office you&#039;re connecting to.&nbsp; Do you have in /etc/config/network:<br /></p><div class="codebox"><pre><code>config interface &#039;vpn0&#039;
    option ifname &#039;tun&#039;
    option proto &#039;none&#039;</code></pre></div><p>You use:<br /></p><div class="codebox"><pre><code>config zone
    option name &#039;wan&#039;
    list network &#039;wan&#039;
    list network &#039;wan6&#039;
    option input &#039;REJECT&#039;
    option output &#039;ACCEPT&#039;
    option forward &#039;REJECT&#039;
    option masq &#039;1&#039;
    option mtu_fix &#039;1&#039;

config zone
    option name &#039;vpn&#039;
    option input &#039;ACCEPT&#039;
    option forward &#039;ACCEPT&#039;
    option output &#039;ACCEPT&#039;
    option network &#039;vpn0&#039;

config forwarding
    option src &#039;vpn&#039;
    option dest &#039;wan&#039;</code></pre></div><p>Should &quot;list network&quot; instead be &quot;option network&quot; in the above?&nbsp; It may work fine, as it may just be an old nomenclature that hasn&#039;t been deprecated yet.</p><p>I don&#039;t think the above will get you connected from zone vpn to zone lan.&nbsp; Please see this for more info:</p><p><a href="https://wiki.openwrt.org/doc/uci/firewall#zone_declaration_for_semi_non-uci_interfaces_manually_listed_in_the_network_config_and_forwardings">https://wiki.openwrt.org/doc/uci/firewa … orwardings</a></p><p>For that you probably also need:<br /></p><div class="codebox"><pre><code>config forwarding
        option src &#039;vpn&#039;
        option dest &#039;lan&#039;

config forwarding
        option src &#039;lan&#039;
        option dest &#039;vpn&#039;</code></pre></div><p>The machines on your work LAN may not be able to connect to your OpenVPN client laptop -- but that may be a good thing.&nbsp; If you need them to connect, every machine will need a route in its routing table pointing to your laptop&#039;s tunnel IP address via the OpenWRT/OpenVPN server&#039;s IP address.&nbsp; HTH <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Clemmitt</p>											<p class="post-edited">(Last edited by <strong>cmsigler</strong> on 14 Mar 2016, 21:16)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p314864">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">DonJuane</div>
					<div class="post-datetime">
						15 Mar 2016, 07:23					</div>
				</div>
				<div class="post-content content">
					<p>Wow Clemmitt, you &quot;be tha man!&quot;.&nbsp; &nbsp;The last paragraph, adding those two clauses to my firrwall gave me exactly what I need!!!!!!!&nbsp; THANK YOU!!!!&nbsp; &nbsp; </p><div class="codebox"><pre><code>config forwarding
        option src &#039;vpn&#039;
        option dest &#039;lan&#039;

config forwarding
        option src &#039;lan&#039;
        option dest &#039;vpn&#039;</code></pre></div><p>NOTE: The missing end quote identified was due to my error copying; it was correct in the config; thanks.</p><p>I was able to VPN into my home OpenWRT router (running OpenVPN server) and my remote PC running OpenVPN client performed exactly as if I were at home.&nbsp; &nbsp;A whatismyip website showed my IP address as being on my home network and I was able to reach out to Google and other websites.&nbsp; &nbsp;I am currently testing while tethering to an Android hotspot created through my cell provider, so some shaky connections here but it worked, well all except for one thing and that may just be a timing issue, I&#039;ll check it tomorrow when I am on an actual wired remote location.</p><p>I can ping my home server and RealVNC into my home server but I could not get NetBIOS over IP to respond.&nbsp; &nbsp;(THis definitely worked with the old dd-wrt setup at various hotels around the globe, but I never remember testing NetBIOS over the tethered Andorid hotspot wi-fi link up in the past, so it just may be an issue with the cell data network, again, I&#039;ll check tomorrow..)</p><div class="codebox"><pre><code>C:\windows\system32&gt;ping 192.168.2.202

Pinging 192.168.2.202 with 32 bytes of data:
Reply from 192.168.2.202: bytes=32 time=141ms TTL=127
Reply from 192.168.2.202: bytes=32 time=86ms TTL=127
Reply from 192.168.2.202: bytes=32 time=98ms TTL=127
Reply from 192.168.2.202: bytes=32 time=97ms TTL=127

Ping statistics for 192.168.2.202:
    Packets: Sent = 4, Received = 4, Lost = 0 (0% loss),
Approximate round trip times in milli-seconds:
    Minimum = 86ms, Maximum = 141ms, Average = 105ms

C:\windows\system32&gt;net view \\192.168.2.202
System error 53 has occurred.

The network path was not found.


C:\windows\system32&gt;</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p314948">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">DonJuane</div>
					<div class="post-datetime">
						15 Mar 2016, 16:16					</div>
				</div>
				<div class="post-content content">
					<p>A short note here to others who may want to copy this setup.&nbsp; The 192.168.2.x reference is the subnet of the router&#039;s networked LAN at your home office location, so change accordingly.&nbsp; &nbsp;You need a router that supports OpenWRT with 8M of flash or more and the faster CPU speed, the better of course.&nbsp; I&#039;d shoot for over 400Mhz.&nbsp; &nbsp;Also note on my five years old 400Mhz router that the 2048 encryption selected by default from the key generation suggestion took over an hour to complete on my router.&nbsp; &nbsp;If you want to stick with 2048 bit, then I&#039;d suggest using the easy-rsa key generator installed optionally as part of your Windows OpenVPN client install and copy the needed keys to the router using WinSCP.&nbsp; &nbsp;Probably 1024 bit encryption is OK, considering most of us give away all our data on our smart phones anyway LOL.&nbsp; &nbsp;Be aware that you&#039;ll have to study the rsa tool on how to override defaults, as 2048 seems the&nbsp; default in the openvpn guide I used.&nbsp; &nbsp;I&#039;ll try to write up what all I did here soon as to the exact steps but for now this should serve those who may be &quot;heavy dabblers but by no means an expert&quot; like me.&nbsp; &nbsp;</p><p>I am going to label this &quot;traveling road warrior setup&quot;, with the common traveler in mind, someone who is traveling with the need to connect home for the purpose of security in public wi-fi locations, ability to RealVNC into family member&#039;s computers at home and provide a remote assist, access files or needed information on home servers, and restoring the ability to watch entertainment sources that lock travelers out once they obtain a non-US IP address.&nbsp; Netflix anyone?&nbsp; (Make sure you have a really spiffy router and a fast connection at home.&nbsp; And if you do, why not use it everywhere?&nbsp; Nothing better than that feeling when you HideYourOwnAss.com ;-) )</p><p>**** If you are setting this up for the first time, the first step you will want to take is to change the IP address of your home router to something higher than the 0 or 1 that is defaulted by nearly all home routers, for example, if your router at home sets up to default at 192.168.1.1, or 192.168.0.1 then change the third number to something higher, e.g. 3-200.&nbsp; &nbsp;I changed mine to 192.168.2.1.&nbsp; &nbsp;The reason for this is most mom &amp; pop hotels and B&amp;Bs and sometimes large conglomerates are using the 0 or 1 address and when you get to the hotel and want to e.g. link to your server, you&#039;ll want to have an address that doesn&#039;t conflict with something at your hotel.&nbsp; &nbsp;Note here if you have a long established home network, you may have printers and other peripherals that you have hard and soft coded their addressed in your Windows applications, so be aware that you&#039;ll have to research and change those appropriately when you convert to the new address scheme (subnet).&nbsp; &nbsp;For example, if your network printer was known to your Windows laptop as 192.168.1.35, it will need to have a new IP address of 192.168.2.x&nbsp; when you change your subnet scheme by swapping out your main gateway (router) address from 192.168.1.1 to 192.168.2.1.&nbsp; &nbsp;(Pardon the half correct nomenclature).&nbsp; &nbsp;Good luck and don&#039;t be discouraged, you can see the light as well, it just takes a little time.</p><p>Also note that changing the IP address of the router mostly requires all the network appliances be rebooted (unplug and plug back in any Enternet switches, printers, etc).&nbsp; &nbsp;With that you should be good to go except for any hard-coded IP addresses you may have created for printers, ATA (VOIP), scanners, etc.&nbsp; (Some network printers establish an IP address at first install and won&#039;t be too happy about your changing the subnet of your local network, so you&#039;ll have to either start from scratch, or poke around in the settings panels to change the address accordingly.)</p><p>****** Also note that the key generation can seem like the most difficult part of this, while it is often assumed being quite easy (when not) by some experts here.&nbsp; &nbsp;There is only one online guide that speaks in layman&#039;s terms I found and it describes what to respond to the prompts but speaks of easy-rsa many releases ago and since then there are lots of extra questions.&nbsp; &nbsp;Short story is accept the default by pressing Enter, including the request for passwords to access the passwords (keys).&nbsp; &nbsp;The exception to this is accepting the 2048 vs. 1024 bit encryption.&nbsp; &nbsp;More encryption requires a more powerful (faster) router.&nbsp; &nbsp;I have still not figured out why all the questions are asked about location during the easy-rsa key generation process.&nbsp; I am not sure what it is even used for other than stuffing the data into text files.&nbsp; &nbsp;To me this only serves to confuse new users who may not be familiar with the process.&nbsp; Well that&#039;s outside of opportunity to enter extra passwords of course.&nbsp; &nbsp;(For a very long time I couldn&#039;t get past key generation because I believed that the answers to most of these questions posed while creating the keys actually controlled something.)&nbsp; I selected no by simply pressing Enter with non data on the questions about passwords during keygen.&nbsp; &nbsp;Basically if you want the extra passwords to protect your keys, I&#039;d start with keys without the extra password requirement, get OpenVPN going and then replace the keys with ones that ask for passwords during the OpenVPN negotiation process.&nbsp; .</p>											<p class="post-edited">(Last edited by <strong>DonJuane</strong> on 15 Mar 2016, 16:57)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p314976">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">cmsigler</div>
					<div class="post-datetime">
						15 Mar 2016, 18:40					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>It took me a while to study your configs and figure out that most things seemed to be OK (I wasn&#039;t sure at first).&nbsp; Very glad things are working more-or-less correctly <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /></p><p>For NetBIOS over TCP/IP:</p><p><a href="https://technet.microsoft.com/en-us/library/cc940063.aspx">https://technet.microsoft.com/en-us/lib … 40063.aspx</a></p><p>which you probably already know -- any firewalls need to accept:</p><p>- <span class="bbu">UDP port 137</span> (name services)<br />- <span class="bbu">UDP port 138</span> (datagram services)<br />- <span class="bbu">TCP port 139</span> (session services)<br />- Direct hosting over TCP/IP uses <span class="bbu">TCP port 445</span> instead of the NetBIOS session TCP port 139</p><p>in both directions, between &quot;zone vpn&quot; and &quot;zone lan&quot; for example.</p><p>I&#039;m not sure why the revised UCI firewall config you&#039;re using isn&#039;t allowing NetBIOS over TCP/IP already *shrug*&nbsp; As I said in my post, I always use &quot;dev tap&quot; which transports SMB via layer 2.&nbsp; The other positive side-effect of layer 2 transport is you get IPv6 for free <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Clemmitt</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p315013">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">DonJuane</div>
					<div class="post-datetime">
						15 Mar 2016, 22:39					</div>
				</div>
				<div class="post-content content">
					<p>Well bad news is the order of the day on the NetBios front.&nbsp; &nbsp; I get the same error 53 from my wired remote location.&nbsp; &nbsp;I can ping my server, VNC to the server but I can&#039;t issue a net use x: \\192.168.2.202\drivers&nbsp; like I could with my old dd-wrt setup.&nbsp; :-(.&nbsp; &nbsp; </p><p>The only thing I changed on the PC side was installing the latest version of OpenVPN client for windows to clear up some errors I was seeing on the OpenVPN server and when I looked up those errors online, that&#039;s what was suggested (was previously a couple of releases back on the client).&nbsp; &nbsp;</p><p>I have made no firewall changes or updates of any kind on my Windows system other than this upgrade.&nbsp; &nbsp;The NetBIOS over IP loss will be a major one as this is how I have traditionally copied files in and out of my system.&nbsp; &nbsp; Granted, I could use FTP but the seamlessness of doing a share &quot;net use x: \\192.168.2.202\resource&quot; was very handy with Windows drag and drop and the works.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p315022">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">cmsigler</div>
					<div class="post-datetime">
						16 Mar 2016, 00:04					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>Solutions I can think of to try:</p><p>Easier: Turn off your Windows laptop firewall once you&#039;ve connected to the OpenVPN server.&nbsp; Try the &#039;net use ...&#039; command and see if it works.&nbsp; This will tell you if it&#039;s a problem with your laptop firewall.&nbsp; That&#039;s my bet, though I&#039;m not sure why it&#039;s happening if you didn&#039;t change any settings, but Windows is still &quot;mysterious&quot; to me....&nbsp; You can then re-enable the Windows firewall on your client and poke the necessary holes in it.</p><p>Harder: Install Wireshark on your Windows OpenVPN client laptop.&nbsp; Fire it up after it&#039;s connected with OpenVPN and snoop on your &quot;tun&quot; device only.&nbsp; See if there is weird traffic going (or not) over the OpenVPN tunnel.&nbsp; Then try your &#039;net use ...&#039; Windows command and watch carefully when you run that command to see if there are any packets going (or not) over the link and if there are any ICMP errors coming back.</p><p>(I wonder if there&#039;s a subtle minor bug in the UCI firewall implementation on the OpenWRT/VPN server?&nbsp; This might require some by-hand iptables firewall rules on the server box...?)&nbsp; HTH.</p><p>Clemmitt</p><p>P.S.: When did you last have &#039;net use ...&#039; via NetBIOS working?&nbsp; Was that over OpenVPN?&nbsp; Or only when you&#039;re on-site.&nbsp; Or was this working with stock firmware on the router?&nbsp; I&#039;m confused....&nbsp; I&#039;m wondering if prior VPN implementations were using &quot;dev tap&quot;....</p>											<p class="post-edited">(Last edited by <strong>cmsigler</strong> on 16 Mar 2016, 00:08)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p315053">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">DonJuane</div>
					<div class="post-datetime">
						16 Mar 2016, 05:25					</div>
				</div>
				<div class="post-content content">
					<p>Two weeks ago I had the dd-wrt OpenVPN version working on this same hardware (<a href="https://wiki.openwrt.org/toh/buffalo/wzr-hp-g300h">https://wiki.openwrt.org/toh/buffalo/wzr-hp-g300h</a>).&nbsp; &nbsp;Yes, I have been using the Windows netbios &quot;net use....&quot; directory mapping and share command while at hotels in and out of the country for a couple of years now.&nbsp; &nbsp;And the funny thing was on this same router with dd-wrt the OpenVPN server was solid as a rock.&nbsp; &nbsp;It was only silly things like working on the user interface that got me so frustrated with it.&nbsp; &nbsp;For example, making any change to the configuration of dd-wrt and hitting save would brick it.&nbsp; &nbsp;These are super easy to brick using dd-wrt and I just simply got tired of having to TFTP firmware to it, I had had enough, so I switched to OpenWRT.&nbsp; &nbsp; So yes it was working with the same hardware and exact same laptop but different firmware and a back level of OpenVPN for windows.&nbsp; &nbsp;The only changes were OvenVPN roll-out on OpenWRT as opposed to two weeks ago, OpenVPN on dd-wrt - same router.&nbsp; &nbsp;The other change was upgrading to the latest OpenVPN and removing some commands dealing with encryption choices that the later version of OpenVPN didn&#039;t like.</p><p>Anyway, there are other issues I discovered tonight.&nbsp; &nbsp;I worked for a couple of hours on the link (I&#039;m just 2 blocks from my home on another network) and the network is not throttling well at all (same 25M/25M fiber at home as before).&nbsp; &nbsp;It takes forever to open my Outlook mail and some websites won&#039;t respond properly, for example <a href="http://www.speedtest.net">www.speedtest.net</a> won&#039;t even load past the initial button that says &quot;try beta&quot;.&nbsp; It&#039;s not really usable in this condition to my disappointment.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p315058">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">DonJuane</div>
					<div class="post-datetime">
						16 Mar 2016, 05:50					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><blockquote><p>P.S.: When did you last have &#039;net use ...&#039; via NetBIOS working?&nbsp; Was that over OpenVPN?&nbsp; Or only when you&#039;re on-site.&nbsp; Or was this working with stock firmware on the router?&nbsp; I&#039;m confused....&nbsp; I&#039;m wondering if prior VPN implementations were using &quot;dev tap&quot;....</p></blockquote></div><p>I have always gone TUN and not even considered TAP because I quite often tether to my android device to gain access home via the Windows laptop with OpenVPN sent over my wifi hotspot tethering facilities connected via my cellular network provider (net effect, laptop VPNs back home over this link).&nbsp; &nbsp; I read many years ago when I first laid hopes of getting OpenVPN going on my router, that TUN was less of a load on a tunnel due to absence of the broadcasts over the network with TAP, so considering that I have 3 active workstations at home and 3 printers, plus 2 VOIP boxes hammering at the network, I thought this might be a concern for me with the expensive metered cell network I am often forced to use, so I never considered TAP, while like you say, it would be less trouble.&nbsp; &nbsp;Also when I discovered that netbios shares from windows worked quite well with OpenVPN server running on dd-wrt with TUN that meant that while TAP would be more seemless and convenient, TUN provided the same with just a shade of tediousness while having to speak IP addresses rather than NetBIOS names..&nbsp; &nbsp;Previously using TUN,&nbsp; as long as you used the IP address rather than the computer name Windows network shares worked fine.&nbsp; And because of this I felt there was no need to suffer the overhead going to TAP, because I could do everything I wanted to do using TUN.&nbsp; &nbsp; &nbsp; </p><p>So I am 100% positive that I had a perfect working environment using OpenVPN with the TUN option (using same Config profile for the client with a couple of encryption specifications dropped) on dd-wrt while using basically the same configurations at each end, the Windows client and OpenVPN server, before running on dd-wrt, today working not so&nbsp; well on OpenWRT.</p><p>Something is awry somewhere.&nbsp; &nbsp;What I plan to do next is try to extract my old keys out of my last dd-wrt memory dump and go back to those.&nbsp; &nbsp;The only other change I made with the conversion was increasing from 1024 to 2048 bit encryption, and I&#039;ll try eliminating that difference by capturing the old keys from the old setup to see if that has anything to do with it in the new.</p><p>***** P.S. searching &quot;-j log&quot; I find only film makers info and a very interesting urban dictionary entry LOL</p>											<p class="post-edited">(Last edited by <strong>DonJuane</strong> on 16 Mar 2016, 06:10)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p315061">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">cmsigler</div>
					<div class="post-datetime">
						16 Mar 2016, 06:14					</div>
				</div>
				<div class="post-content content">
					<p>Wow.&nbsp; I&#039;m sorry to hear of further problems.</p><p>- The firewall &quot;design&quot; (as it were) is different, dd-wrt from OpenWRT.&nbsp; That&#039;s one possible explanation for NetBIOS not working with OpenWRT.&nbsp; (One would need to spend time looking in detail at the firewall rules of both to see if there were any differences that cause the remote mounts to fail.)</p><p>- Sporadic, instantaneous reboots of dd-wrt are unusual in my experience (but not unheard of... I generally think of OpenWRT as a bit more stable all other things being equal).&nbsp; Wouldn&#039;t that be especially true for Buffalo routers, which partner directly with dd-wrt???&nbsp; Did the stock Buffalo firmware not give you OpenVPN and other options you needed?</p><p>- Is it possible the hardware is flaky?&nbsp; I know this is rarely the cause of problems.&nbsp; It&#039;s usually firmware.&nbsp; But acting bad under both dd-wrt and OpenWRT, a common cause could be the underlying hardware. (But likely it&#039;s not the hardware <img src="https://forum.openwrt.org/img/smilies/tongue.png" width="15" height="15" alt="tongue" /> )</p><p>- Any chance you could throw together a barely mid-powered x64 or x86 box with two Ethernet cards?&nbsp; You could put OpenWRT on that pretty quickly, set it up with an identical configuration (just restore a backup of your current UCI config!) and see if the problems go away.</p><p>Wish I had some brighter ideas to help.</p><p>Clemmitt</p><p>P.S.: <a href="http://www.netfilter.org/documentation/FAQ/netfilter-faq-3.html#ss3.14">http://www.netfilter.org/documentation/ … tml#ss3.14</a>&nbsp; <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>											<p class="post-edited">(Last edited by <strong>cmsigler</strong> on 16 Mar 2016, 06:18)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p315260">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">DonJuane</div>
					<div class="post-datetime">
						17 Mar 2016, 09:13					</div>
				</div>
				<div class="post-content content">
					<p>Out tonight in another city with totally different provider.&nbsp; Testing my router back at home again ....... The regular IP traffic is working well on this test, better than expected.&nbsp; &nbsp;Now speedtest.net works as I would expect and gives about 20% hit in performance when the OpenVPN session is open.&nbsp; &nbsp;There is no more sputtering or stalls, just smoothe peformance.&nbsp; &nbsp;My last night&#039;s problems could have been caused by Time Warner or Verizon, the two networks I was testing on.</p><p>However, NetBIOS over IP is still being blocked.&nbsp; &nbsp;I totally shut down my Windows Firewall (the only thing I am running outside of AVG anti-virus and still get the error 53 when attempting a netbios share.&nbsp; &nbsp;So I assume it has to be happening at the router, like you say.&nbsp; &nbsp;(Just disabled AVG and no help either.)</p><p>So, how does one obtain this level of support I am wondering, if one does not possess any speak-able skill in this area?&nbsp; &nbsp;I once sat down with a publication explaining the Linux firewall and the problem was at the end, the author still understood it and I still did not.&nbsp; &nbsp;(Old dog syndrome here.&nbsp; The young Turks who have flamed me in the past for being lazy and refusing to learn don&#039;t have this many miles behind themyet - they don&#039;t realize that their mother was fibbing to them when she said &quot;education is something no one can take from you&quot;.&nbsp; &nbsp;There&#039;s a place you reach in life where just finding your glasses or car keys is something to celebrate. ;-)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p315347">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">RangerZ</div>
					<div class="post-datetime">
						17 Mar 2016, 17:26					</div>
				</div>
				<div class="post-content content">
					<p>Very funny, and I fully agree and sympathize (as an old blind guy)</p><p>I think if you have not, should try the OpenVPN forum.&nbsp; Sometimes you will find someone with OpenWrt experience or just some more relevant experience with the issue that you can &quot;translate&quot; back.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p315350">
				<div class="post-metadata">
					<div class="post-num">Post #21</div>
					<div class="post-author">cmsigler</div>
					<div class="post-datetime">
						17 Mar 2016, 17:36					</div>
				</div>
				<div class="post-content content">
					<p>Hi,<br /></p><div class="quotebox"><cite>DonJuane wrote:</cite><blockquote><p>So, how does one obtain this level of support I am wondering, if one does not possess any speak-able skill in this area?&nbsp; &nbsp;I once sat down with a publication explaining the Linux firewall and the problem was at the end, the author still understood it and I still did not.</p></blockquote></div><p>If you can afford to pay some (smallish) amount for support, I would go to the OpenWRT buy/sell/trade board.&nbsp; It&#039;s normally for hardware but I don&#039;t think asking for support would be out-of-bounds since that&#039;s a commercially oriented board.</p><p>I&#039;m baffled as to why the iptables firewall is blocking this.&nbsp; It seems to me it shouldn&#039;t be.&nbsp; Let me take a cursory look, please.&nbsp; Are you able to connect to your router over ssh using PuTTY?&nbsp; Here is a guide from YouTube (not sure if this will help you):</p><p><a href="https://www.youtube.com/watch?v=C8DJSZLRFOg">https://www.youtube.com/watch?v=C8DJSZLRFOg</a></p><p>When logged in over ssh, run this command:</p><div class="codebox"><pre><code># iptables -nvL --line-numbers</code></pre></div><p>Copy the output and paste it in a reply here as a [ code ] [ /code ] block.&nbsp; I&#039;ll look it over -- maybe there&#039;s an obvious problem that can be fixed easily.</p><p>Clemmitt</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p315402">
				<div class="post-metadata">
					<div class="post-num">Post #22</div>
					<div class="post-author">cmsigler</div>
					<div class="post-datetime">
						17 Mar 2016, 21:36					</div>
				</div>
				<div class="post-content content">
					<p>Hi again,</p><p>I think my inexperience in using OpenWRT&#039;s UCI config system is getting the better of me.&nbsp; Let&#039;s try another way.</p><p>I know I read a different thread recently where the recommended solution was <span class="bbu">NOT</span> to have a separate &#039;zone vpn&#039;.&nbsp; Instead, in /etc/config/network have a &#039;config interface vpn&#039; but in /etc/config/firewall add this interface to the &#039;zone lan&#039; by &#039;list network vpn&#039; under &#039;config zone&#039; &#039;option name lan&#039;.</p><p>Does this make sense?&nbsp; I&#039;m sure you can use the LuCI GUI to configure it this way -- you might be able to figure out how by going through the network config tabs.&nbsp; I&#039;d say this is an alternative which might work.&nbsp; I&#039;m not sure if there&#039;s really any less security than setting up a separate vpn zone and forwarding back and forth between lan and vpn zones.&nbsp; Again, HTH <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Clemmitt</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p315521">
				<div class="post-metadata">
					<div class="post-num">Post #23</div>
					<div class="post-author">DonJuane</div>
					<div class="post-datetime">
						18 Mar 2016, 15:05					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for the offer to help.&nbsp; &nbsp;I appreciate the time very much.</p><div class="codebox"><pre><code> CHAOS CALMER (15.05, r46767)
 -----------------------------------------------------
  * 1 1/2 oz Gin            Shake with a glassful
  * 1/4 oz Triple Sec       of broken ice and pour
  * 3/4 oz Lime Juice       unstrained into a goblet.
  * 1 1/2 oz Orange Juice
  * 1 tsp. Grenadine Syrup
 -----------------------------------------------------
root@Buffie:~# iptables -nvL --line-numbers
Chain INPUT (policy ACCEPT 0 packets, 0 bytes)
num   pkts bytes target     prot opt in     out     source               destination
1     306K   45M delegate_input  all  --  *      *       0.0.0.0/0            0.0.0.0/0

Chain FORWARD (policy DROP 0 packets, 0 bytes)
num   pkts bytes target     prot opt in     out     source               destination
1    2408K 1607M delegate_forward  all  --  *      *       0.0.0.0/0            0.0.0.0/0

Chain OUTPUT (policy ACCEPT 0 packets, 0 bytes)
num   pkts bytes target     prot opt in     out     source               destination
1     329K  257M delegate_output  all  --  *      *       0.0.0.0/0            0.0.0.0/0

Chain delegate_forward (1 references)
num   pkts bytes target     prot opt in     out     source               destination
1    2408K 1607M forwarding_rule  all  --  *      *       0.0.0.0/0            0.0.0.0/0            /* user chain for forwarding */
2    2365K 1604M ACCEPT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            ctstate RELATED,ESTABLISHED
3    35618 2310K zone_lan_forward  all  --  br-lan *       0.0.0.0/0            0.0.0.0/0
4        0     0 zone_wan_forward  all  --  eth1   *       0.0.0.0/0            0.0.0.0/0
5     7730  932K zone_vpn_forward  all  --  tun0   *       0.0.0.0/0            0.0.0.0/0
6        0     0 reject     all  --  *      *       0.0.0.0/0            0.0.0.0/0

Chain delegate_input (1 references)
num   pkts bytes target     prot opt in     out     source               destination
1     2805  254K ACCEPT     all  --  lo     *       0.0.0.0/0            0.0.0.0/0
2     303K   44M input_rule  all  --  *      *       0.0.0.0/0            0.0.0.0/0            /* user chain for input */
3     227K   39M ACCEPT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            ctstate RELATED,ESTABLISHED
4      734 34896 syn_flood  tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            tcp flags:0x17/0x02
5        9   378 ACCEPT     udp  --  *      *       0.0.0.0/0            0.0.0.0/0            udp dpt:1194 /* Allow-OpenVPN-Inbound */
6    59580 4632K zone_lan_input  all  --  br-lan *       0.0.0.0/0            0.0.0.0/0
7     1252  110K zone_wan_input  all  --  eth1   *       0.0.0.0/0            0.0.0.0/0
8    15789 1045K zone_vpn_input  all  --  tun0   *       0.0.0.0/0            0.0.0.0/0

Chain delegate_output (1 references)
num   pkts bytes target     prot opt in     out     source               destination
1     2805  254K ACCEPT     all  --  *      lo      0.0.0.0/0            0.0.0.0/0
2     326K  257M output_rule  all  --  *      *       0.0.0.0/0            0.0.0.0/0            /* user chain for output */
3     299K  255M ACCEPT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            ctstate RELATED,ESTABLISHED
4      432  141K zone_lan_output  all  --  *      br-lan  0.0.0.0/0            0.0.0.0/0
5    27292 1818K zone_wan_output  all  --  *      eth1    0.0.0.0/0            0.0.0.0/0
6        0     0 zone_vpn_output  all  --  *      tun0    0.0.0.0/0            0.0.0.0/0

Chain forwarding_lan_rule (1 references)
num   pkts bytes target     prot opt in     out     source               destination

Chain forwarding_rule (1 references)
num   pkts bytes target     prot opt in     out     source               destination

Chain forwarding_vpn_rule (1 references)
num   pkts bytes target     prot opt in     out     source               destination

Chain forwarding_wan_rule (1 references)
num   pkts bytes target     prot opt in     out     source               destination

Chain input_lan_rule (1 references)
num   pkts bytes target     prot opt in     out     source               destination

Chain input_rule (1 references)
num   pkts bytes target     prot opt in     out     source               destination

Chain input_vpn_rule (1 references)
num   pkts bytes target     prot opt in     out     source               destination

Chain input_wan_rule (1 references)
num   pkts bytes target     prot opt in     out     source               destination

Chain output_lan_rule (1 references)
num   pkts bytes target     prot opt in     out     source               destination

Chain output_rule (1 references)
num   pkts bytes target     prot opt in     out     source               destination

Chain output_vpn_rule (1 references)
num   pkts bytes target     prot opt in     out     source               destination

Chain output_wan_rule (1 references)
num   pkts bytes target     prot opt in     out     source               destination

Chain reject (3 references)
num   pkts bytes target     prot opt in     out     source               destination
1      885 54867 REJECT     tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            reject-with tcp-reset
2      349 54198 REJECT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            reject-with icmp-port-unreachable

Chain syn_flood (1 references)
num   pkts bytes target     prot opt in     out     source               destination
1      734 34896 RETURN     tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            tcp flags:0x17/0x02 limit: avg 25/sec burst 50
2        0     0 DROP       all  --  *      *       0.0.0.0/0            0.0.0.0/0

Chain zone_lan_dest_ACCEPT (5 references)
num   pkts bytes target     prot opt in     out     source               destination
1     5121  891K ACCEPT     all  --  *      br-lan  0.0.0.0/0            0.0.0.0/0

Chain zone_lan_forward (1 references)
num   pkts bytes target     prot opt in     out     source               destination
1    35618 2310K forwarding_lan_rule  all  --  *      *       0.0.0.0/0            0.0.0.0/0            /* user chain for forwarding */
2    35618 2310K zone_wan_dest_ACCEPT  all  --  *      *       0.0.0.0/0            0.0.0.0/0            /* forwarding lan -&gt; wan */
3        3   234 zone_vpn_dest_ACCEPT  all  --  *      *       0.0.0.0/0            0.0.0.0/0            /* forwarding lan -&gt; vpn */
4        0     0 ACCEPT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            ctstate DNAT /* Accept port forwards */
5        0     0 zone_lan_dest_ACCEPT  all  --  *      *       0.0.0.0/0            0.0.0.0/0

Chain zone_lan_input (1 references)
num   pkts bytes target     prot opt in     out     source               destination
1    59580 4632K input_lan_rule  all  --  *      *       0.0.0.0/0            0.0.0.0/0            /* user chain for input */
2        0     0 ACCEPT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            ctstate DNAT /* Accept port redirections */
3    59580 4632K zone_lan_src_ACCEPT  all  --  *      *       0.0.0.0/0            0.0.0.0/0

Chain zone_lan_output (1 references)
num   pkts bytes target     prot opt in     out     source               destination
1      432  141K output_lan_rule  all  --  *      *       0.0.0.0/0            0.0.0.0/0            /* user chain for output */
2      432  141K zone_lan_dest_ACCEPT  all  --  *      *       0.0.0.0/0            0.0.0.0/0

Chain zone_lan_src_ACCEPT (1 references)
num   pkts bytes target     prot opt in     out     source               destination
1    59580 4632K ACCEPT     all  --  br-lan *       0.0.0.0/0            0.0.0.0/0

Chain zone_vpn_dest_ACCEPT (3 references)
num   pkts bytes target     prot opt in     out     source               destination
1       24  1528 ACCEPT     all  --  *      tun0    0.0.0.0/0            0.0.0.0/0

Chain zone_vpn_forward (1 references)
num   pkts bytes target     prot opt in     out     source               destination
1     7730  932K forwarding_vpn_rule  all  --  *      *       0.0.0.0/0            0.0.0.0/0            /* user chain for forwarding */
2     7730  932K zone_wan_dest_ACCEPT  all  --  *      *       0.0.0.0/0            0.0.0.0/0            /* forwarding vpn -&gt; wan */
3     4710  751K zone_lan_dest_ACCEPT  all  --  *      *       0.0.0.0/0            0.0.0.0/0            /* forwarding vpn -&gt; lan */
4        0     0 ACCEPT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            ctstate DNAT /* Accept port forwards */
5       21  1294 zone_vpn_dest_ACCEPT  all  --  *      *       0.0.0.0/0            0.0.0.0/0

Chain zone_vpn_input (1 references)
num   pkts bytes target     prot opt in     out     source               destination
1    15789 1045K input_vpn_rule  all  --  *      *       0.0.0.0/0            0.0.0.0/0            /* user chain for input */
2        0     0 ACCEPT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            ctstate DNAT /* Accept port redirections */
3    15789 1045K zone_vpn_src_ACCEPT  all  --  *      *       0.0.0.0/0            0.0.0.0/0

Chain zone_vpn_output (1 references)
num   pkts bytes target     prot opt in     out     source               destination
1        0     0 output_vpn_rule  all  --  *      *       0.0.0.0/0            0.0.0.0/0            /* user chain for output */
2        0     0 zone_vpn_dest_ACCEPT  all  --  *      *       0.0.0.0/0            0.0.0.0/0

Chain zone_vpn_src_ACCEPT (1 references)
num   pkts bytes target     prot opt in     out     source               destination
1    15789 1045K ACCEPT     all  --  tun0   *       0.0.0.0/0            0.0.0.0/0

Chain zone_wan_dest_ACCEPT (3 references)
num   pkts bytes target     prot opt in     out     source               destination
1    65927 4309K ACCEPT     all  --  *      eth1    0.0.0.0/0            0.0.0.0/0

Chain zone_wan_dest_REJECT (1 references)
num   pkts bytes target     prot opt in     out     source               destination
1        0     0 reject     all  --  *      eth1    0.0.0.0/0            0.0.0.0/0

Chain zone_wan_forward (1 references)
num   pkts bytes target     prot opt in     out     source               destination
1        0     0 forwarding_wan_rule  all  --  *      *       0.0.0.0/0            0.0.0.0/0            /* user chain for forwarding */
2        0     0 zone_lan_dest_ACCEPT  esp  --  *      *       0.0.0.0/0            0.0.0.0/0            /* @rule[7] */
3        0     0 zone_lan_dest_ACCEPT  udp  --  *      *       0.0.0.0/0            0.0.0.0/0            udp dpt:500 /* @rule[8] */
4        0     0 ACCEPT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            ctstate DNAT /* Accept port forwards */
5        0     0 zone_wan_dest_REJECT  all  --  *      *       0.0.0.0/0            0.0.0.0/0

Chain zone_wan_input (1 references)
num   pkts bytes target     prot opt in     out     source               destination
1     1252  110K input_wan_rule  all  --  *      *       0.0.0.0/0            0.0.0.0/0            /* user chain for input */
2        0     0 ACCEPT     udp  --  *      *       0.0.0.0/0            0.0.0.0/0            udp dpt:68 /* Allow-DHCP-Renew */
3       18   733 ACCEPT     icmp --  *      *       0.0.0.0/0            0.0.0.0/0            icmptype 8 /* Allow-Ping */
4        0     0 ACCEPT     2    --  *      *       0.0.0.0/0            0.0.0.0/0            /* Allow-IGMP */
5        0     0 ACCEPT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            ctstate DNAT /* Accept port redirections */
6     1234  109K zone_wan_src_REJECT  all  --  *      *       0.0.0.0/0            0.0.0.0/0

Chain zone_wan_output (1 references)
num   pkts bytes target     prot opt in     out     source               destination
1    27292 1818K output_wan_rule  all  --  *      *       0.0.0.0/0            0.0.0.0/0            /* user chain for output */
2    27292 1818K zone_wan_dest_ACCEPT  all  --  *      *       0.0.0.0/0            0.0.0.0/0

Chain zone_wan_src_REJECT (1 references)
num   pkts bytes target     prot opt in     out     source               destination
1     1234  109K reject     all  --  eth1   *       0.0.0.0/0            0.0.0.0/0
root@Buffie:~#</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p315526">
				<div class="post-metadata">
					<div class="post-num">Post #24</div>
					<div class="post-author">DonJuane</div>
					<div class="post-datetime">
						18 Mar 2016, 15:16					</div>
				</div>
				<div class="post-content content">
					<p>You did catch that this was what I had to add to dd-wrt to make my setup work ...</p><p>iptables -I FORWARD 1 --source 10.10.10.0/24 -j ACCEPT<br />iptables -t nat -A POSTROUTING -s 10.10.10.0/24 -o br0 -j MASQUERADE<br />iptables -t nat -A POSTROUTING -s 10.10.10.0/24 -j MASQUERADE<br />iptables -I FORWARD -i br0 -o tun2 -j ACCEPT<br />iptables -I FORWARD -i tun2 -o br0 -j ACCEPT<br />iptables -t nat -I POSTROUTING -o tun2 -j MASQUERADE</p><p>I have NO idea what this does and it could have opened my router to the world for all I know.&nbsp; &nbsp;Must not have been too bad because no one started uploading movies to it like they have in the past.</p><p>***** NOTE: The 10.10.10.x subnet was with dd-wrt, with my new OpenWRT implementation I am using 10.8.0.x</p><p> (I remember when I first started out with broadband in the late 90&#039;s and set up a FTP server, within a week it had been hacked and loaded down with first run movies and the hacker had made it publicly available.&nbsp; &nbsp;I couldn&#039;t figure out what happened to my bandwidth and I started getting messages my server was full.&nbsp; &nbsp;I ended up having to reload the whole Windows NT system and go with a third party software).</p>											<p class="post-edited">(Last edited by <strong>DonJuane</strong> on 18 Mar 2016, 15:17)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p315545">
				<div class="post-metadata">
					<div class="post-num">Post #25</div>
					<div class="post-author">cmsigler</div>
					<div class="post-datetime">
						18 Mar 2016, 16:37					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>Here is the post and thread I saw about putting interface vpn into zone lan:</p><p><a href="https://forum.openwrt.org/viewtopic.php?pid=315115#p315115">https://forum.openwrt.org/viewtopic.php … 15#p315115</a></p><p>This makes total sense to me as long as all remote clients connecting over VPN are trusted.&nbsp; It&#039;s like they&#039;re connected directly to the LAN while physically located in the office.&nbsp; (Except the VPN tunnel is running at the IP address level, not the Ethernet frame level.)</p><p>If you have time to play with it I&#039;d try that first.&nbsp; It may fix all your problems <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" />&nbsp; In the mean time, I&#039;ll look through the firewall rules and get back to you.</p><p>Clemmitt</p>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 1 of 2</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=63341&amp;p=2.html">2</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>