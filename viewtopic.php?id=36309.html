<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> routing on OpenVPN</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 11 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p165031">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">NoNeed</div>
					<div class="post-datetime">
						19 Apr 2012, 07:42					</div>
				</div>
				<div class="post-content content">
					<p>Hello. Can You help me?<br />I have 2 tp-link wr1043 and i want to make site-to-site vpn.<br />tunnel established, i can ping LAN GW of remote network from router, but not clients.<br />Original OpenVPN config have options:</p><p>push &quot;route 192.168.2.0 255.255.255.0&quot;<br />and<br />iroute 192.168.2.0 255.255.255.0 from file ccd/clientname</p><p>how to translate them to openwrt config?</p><p>Server config<br /></p><div class="codebox"><pre><code>wan ip: 192.168.1.21
lan: 192.168.2.0/24

root@OpenWrt:~# cat /etc/config/openvpn
config &#039;openvpn&#039; &#039;server_tun_ptp&#039;
        option &#039;dev&#039; &#039;tun&#039;
        option &#039;ifconfig&#039; &#039;10.0.0.1 10.0.0.2&#039;
        option &#039;ca&#039; &#039;/etc/openvpn/ca.crt&#039;
        option &#039;cert&#039; &#039;/etc/openvpn/server1.crt&#039;
        option &#039;key&#039; &#039;/etc/openvpn/server1.key&#039;
        option &#039;dh&#039; &#039;/etc/openvpn/dh1024.pem&#039;
        option &#039;management&#039; &#039;127.0.0.1 31194&#039;
        option &#039;mssfix&#039; &#039;1420&#039;
        option &#039;keepalive&#039; &#039;10 60&#039;
        option &#039;verb&#039; &#039;3&#039;
        option &#039;comp_lzo&#039; &#039;1&#039;
        option &#039;enable&#039; &#039;1&#039;
        option &#039;tls_server&#039; &#039;1&#039;
        option &#039;remote_cert_tls&#039; &#039;client&#039;
        option &#039;proto&#039; &#039;udp&#039;
        option &#039;dev_type&#039; &#039;tun&#039;

Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
10.0.0.2        *               255.255.255.255 UH    0      0        0 tun0
192.168.3.0     10.0.0.1        255.255.255.0   UG    0      0        0 tun0 #i am add this route
192.168.2.0     *               255.255.255.0   U     0      0        0 br-lan
192.168.1.0     *               255.255.255.0   U     0      0        0 eth0.2
default         192.168.1.1     0.0.0.0         UG    0      0        0 eth0.2

ping from router to 10.0.0.2 ok
ping from router to 192.168.3.1 ok
ping from lan pc to 10.0.0.2 no ping
ping from lan pc to 192.168.3.1 no ping</code></pre></div><p>Client config<br /></p><div class="codebox"><pre><code>wan ip: 192.168.1.31
lan: 192.168.3.0/24

root@OpenWrt:~# cat /etc/config/openvpn
config &#039;openvpn&#039; &#039;client_tun_ptp&#039;
        option &#039;dev&#039; &#039;tun&#039;
        option &#039;ifconfig&#039; &#039;10.0.0.2 10.0.0.1&#039;
        option &#039;management&#039; &#039;127.0.0.1 31194&#039;
        option &#039;nobind&#039; &#039;1&#039;
        option &#039;verb&#039; &#039;3&#039;
        option &#039;comp_lzo&#039; &#039;1&#039;
        option &#039;remote&#039; &#039;192.168.1.21 1194&#039;
        option &#039;pkcs12&#039; &#039;/lib/uci/upload/cbid.openvpn.client_tun_ptp.pkcs12&#039;
        option &#039;enable&#039; &#039;1&#039;
        option &#039;tls_client&#039; &#039;1&#039;
        option &#039;keepalive&#039; &#039;10 60&#039;
        option &#039;remote_cert_tls&#039; &#039;server&#039;
        option &#039;proto&#039; &#039;udp&#039;
        option &#039;dev_type&#039; &#039;tun&#039;

Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
10.0.0.1        *               255.255.255.255 UH    0      0        0 tun0
192.168.3.0     *               255.255.255.0   U     0      0        0 br-lan
192.168.2.0     10.0.0.2        255.255.255.0   UG    0      0        0 tun0 #i am add this route
192.168.1.0     *               255.255.255.0   U     0      0        0 eth0.2
default         192.168.1.1     0.0.0.0         UG    0      0        0 eth0.2
ping from router to 10.0.0.1 ok
ping from router to 192.168.2.1 ok
ping from lan pc to 10.0.0.1 no ping
ping from lan pc to 192.168.2.1 no ping</code></pre></div><p>iface tun0 asigned to interface VPN1<br />in firewall VPN1 assignedto LAN zone</p><p>What I&#039;m doing wrong? Thx!</p>											<p class="post-edited">(Last edited by <strong>NoNeed</strong> on 19 Apr 2012, 07:47)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p165034">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">darkwin</div>
					<div class="post-datetime">
						19 Apr 2012, 08:30					</div>
				</div>
				<div class="post-content content">
					<p>Hi, I had the same issue, it is missing something in the firewall. <br />compare my solution -&gt; <a href="http://wiki.openwrt.org/doc/howto/vpn.client.openvpn.tun">http://wiki.openwrt.org/doc/howto/vpn.c … penvpn.tun</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p165035">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">rpc</div>
					<div class="post-datetime">
						19 Apr 2012, 08:58					</div>
				</div>
				<div class="post-content content">
					<p>described here have two subnets on WR1043ND<br /><a href="http://translate.google.pl/translate?sl=pl&amp;tl=en&amp;js=n&amp;prev=_t&amp;hl=pl&amp;ie=UTF-8&amp;layout=2&amp;eotf=1&amp;u=http%3A%2F%2Frpc.one.pl%2Findex.php%2Flista-artykulow%2F34-openwrt%2F105-laczenie-dwoch-podsieci-za-pomoca-openvpn-w-openwrt">http://translate.google.pl/translate?sl … -w-openwrt</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p165158">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">NoNeed</div>
					<div class="post-datetime">
						20 Apr 2012, 01:18					</div>
				</div>
				<div class="post-content content">
					<p>smth wrong with my config...</p><br /><p>from 192.168.3.163 i can ping 10.0.1.1 and 192.168.2.1<br />but there is no ping to 192.168.2.155<br />Same on&nbsp; 192.168.2.155: i can ping 10.0.1.2 and 192.168.3.1, there is no ping to 192.168.3.163</p><p>in firewall i am allow everything, i think...</p><br /><p>Server:</p><p>/etc/config/openvpn<br /></p><div class="codebox"><pre><code>package openvpn
 
config openvpn server_conf
    option enable 1
    option port 1194
    option proto tcp-server
    option dev tun0
    option ca /etc/openvpn/ca.crt
    option cert /etc/openvpn/server1.crt
    option key /etc/openvpn/server1.key
    option dh /etc/openvpn/dh1024.pem
    option tls_server 1
    option tls_auth &quot;/etc/openvpn/ta.key 0&quot;
    option server &quot;10.0.1.0 255.255.255.0&quot;
    list route &quot;192.168.3.0 255.255.255.0&quot;
    list push &quot;route 10.0.1.0 255.255.255.0&quot;
    list push &quot;route 192.168.2.0 255.255.255.0&quot;
    list push &quot;route 192.168.3.0 255.255.255.0&quot;
    option client_to_client 1
    option client_config_dir /etc/openvpn/ccd
    option ccd_exclusive
    option persist_key 1
    option persist_tun 1
    option comp_lzo 1
    option verb 3
    option keepalive &quot;10 120&quot;
    option tun_mtu 1500
    option ifconfig_pool_persist /tmp/ipp.txt
    option inactive 3600</code></pre></div><p>/etc/openvpn/ccd/gs1<br /></p><div class="codebox"><pre><code>ifconfig-push 10.0.1.2 10.0.1.1
iroute 192.168.3.0 255.255.255.0</code></pre></div><div class="codebox"><pre><code>root@Server1:~# route
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
10.0.1.2        *               255.255.255.255 UH    0      0        0 tun0
192.168.3.0     10.0.1.2        255.255.255.0   UG    0      0        0 tun0
10.0.1.0        10.0.1.2        255.255.255.0   UG    0      0        0 tun0
192.168.2.0     *               255.255.255.0   U     0      0        0 br-lan
192.168.1.0     *               255.255.255.0   U     0      0        0 eth0.2
default         192.168.1.1     0.0.0.0         UG    0      0        0 eth0.2</code></pre></div><p>/etc/config/firewall<br /></p><div class="codebox"><pre><code>config &#039;defaults&#039;
    option &#039;syn_flood&#039; &#039;1&#039;
    option &#039;input&#039; &#039;ACCEPT&#039;
    option &#039;output&#039; &#039;ACCEPT&#039;
    option &#039;forward&#039; &#039;REJECT&#039;
    option &#039;drop_invalid&#039; &#039;1&#039;
 
config &#039;zone&#039;
    option &#039;name&#039; &#039;lan&#039;
    option &#039;input&#039; &#039;ACCEPT&#039;
    option &#039;output&#039; &#039;ACCEPT&#039;
    option &#039;forward&#039; &#039;REJECT&#039;
    option &#039;network&#039; &#039;lan&#039;
 
config &#039;zone&#039;
    option &#039;name&#039; &#039;wan&#039;
    option &#039;network&#039; &#039;wan&#039;
    option &#039;input&#039; &#039;REJECT&#039;
    option &#039;output&#039; &#039;ACCEPT&#039;
    option &#039;forward&#039; &#039;REJECT&#039;
    option &#039;masq&#039; &#039;1&#039;
    option &#039;mtu_fix&#039; &#039;1&#039;
 
config &#039;rule&#039;
    option &#039;name&#039; &#039;Allow-DHCP-Renew&#039;
    option &#039;src&#039; &#039;wan&#039;
    option &#039;proto&#039; &#039;udp&#039;
    option &#039;dest_port&#039; &#039;68&#039;
    option &#039;target&#039; &#039;ACCEPT&#039;
    option &#039;family&#039; &#039;ipv4&#039;
 
config &#039;rule&#039;
    option &#039;name&#039; &#039;Allow-Ping&#039;
    option &#039;src&#039; &#039;wan&#039;
    option &#039;proto&#039; &#039;icmp&#039;
    option &#039;icmp_type&#039; &#039;echo-request&#039;
    option &#039;family&#039; &#039;ipv4&#039;
    option &#039;target&#039; &#039;ACCEPT&#039;
 
config &#039;include&#039;
    option &#039;path&#039; &#039;/etc/firewall.user&#039;
 
config &#039;rule&#039;
    option &#039;target&#039; &#039;ACCEPT&#039;
    option &#039;src&#039; &#039;wan&#039;
    option &#039;proto&#039; &#039;tcp&#039;
    option &#039;family&#039; &#039;ipv4&#039;
    option &#039;dest_port&#039; &#039;22&#039;
 
config &#039;rule&#039;
    option &#039;target&#039; &#039;ACCEPT&#039;
    option &#039;src&#039; &#039;wan&#039;
    option &#039;proto&#039; &#039;tcp&#039;
    option &#039;family&#039; &#039;ipv4&#039;
    option &#039;dest_port&#039; &#039;80&#039;
 
config &#039;rule&#039;
    option &#039;target&#039; &#039;ACCEPT&#039;
    option &#039;_name&#039; &#039;openvpn&#039;
    option &#039;src&#039; &#039;wan&#039;
    option &#039;proto&#039; &#039;tcpudp&#039;
    option &#039;dest_port&#039; &#039;1194&#039;
    option &#039;family&#039; &#039;ipv4&#039;
 
config &#039;zone&#039;
    option &#039;name&#039; &#039;openvpn&#039;
    option &#039;output&#039; &#039;ACCEPT&#039;
    option &#039;family&#039; &#039;ipv4&#039;
    option &#039;input&#039; &#039;ACCEPT&#039;
    option &#039;network&#039; &#039;openvpn&#039;
    option &#039;forward&#039; &#039;ACCEPT&#039;
 
config &#039;rule&#039;
    option &#039;target&#039; &#039;ACCEPT&#039;
    option &#039;src&#039; &#039;openvpn&#039;
    option &#039;proto&#039; &#039;icmp&#039;
    option &#039;icmp_type&#039; &#039;echo-request&#039;
    option &#039;family&#039; &#039;ipv4&#039;
    option &#039;dest&#039; &#039;lan&#039;
 
config &#039;rule&#039;
    option &#039;target&#039; &#039;ACCEPT&#039;
    option &#039;src&#039; &#039;openvpn&#039;
    option &#039;proto&#039; &#039;all&#039;
 
config &#039;rule&#039;
    option &#039;target&#039; &#039;ACCEPT&#039;
    option &#039;src&#039; &#039;openvpn&#039;
    option &#039;dest&#039; &#039;lan&#039;
    option &#039;proto&#039; &#039;all&#039;
 
config &#039;rule&#039;
    option &#039;target&#039; &#039;ACCEPT&#039;
    option &#039;src&#039; &#039;lan&#039;
    option &#039;dest&#039; &#039;openvpn&#039;
    option &#039;proto&#039; &#039;all&#039;
 
config &#039;forwarding&#039;
    option &#039;dest&#039; &#039;wan&#039;
    option &#039;src&#039; &#039;lan&#039;
 
config &#039;forwarding&#039;
    option &#039;src&#039; &#039;openvpn&#039;
    option &#039;dest&#039; &#039;lan&#039;
 
config &#039;forwarding&#039;
    option &#039;dest&#039; &#039;openvpn&#039;
    option &#039;src&#039; &#039;lan&#039;</code></pre></div><p>/etc/config/network<br /></p><div class="codebox"><pre><code>config &#039;interface&#039; &#039;loopback&#039;
    option &#039;ifname&#039; &#039;lo&#039;
    option &#039;proto&#039; &#039;static&#039;
    option &#039;ipaddr&#039; &#039;127.0.0.1&#039;
    option &#039;netmask&#039; &#039;255.0.0.0&#039;
 
config &#039;interface&#039; &#039;lan&#039;
    option &#039;type&#039; &#039;bridge&#039;
    option &#039;proto&#039; &#039;static&#039;
    option &#039;netmask&#039; &#039;255.255.255.0&#039;
    option &#039;ipaddr&#039; &#039;192.168.2.1&#039;
    option &#039;_orig_ifname&#039; &#039;eth0.1 radio0.network1&#039;
    option &#039;_orig_bridge&#039; &#039;true&#039;
    option &#039;ifname&#039; &#039;eth0.1&#039;
 
config &#039;interface&#039; &#039;wan&#039;
    option &#039;ifname&#039; &#039;eth0.2&#039;
    option &#039;_orig_ifname&#039; &#039;eth0.2&#039;
    option &#039;_orig_bridge&#039; &#039;false&#039;
    option &#039;proto&#039; &#039;static&#039;
    option &#039;ipaddr&#039; &#039;192.168.1.21&#039;
    option &#039;netmask&#039; &#039;255.255.255.0&#039;
    option &#039;gateway&#039; &#039;192.168.1.1&#039;
    option &#039;dns&#039; &#039;192.168.1.1&#039;
 
config &#039;interface&#039; &#039;openvpn&#039;
    option &#039;ifname&#039; &#039;tun0&#039;
    option &#039;proto&#039; &#039;none&#039;
 
config &#039;switch&#039;
    option &#039;name&#039; &#039;rtl8366rb&#039;
    option &#039;reset&#039; &#039;1&#039;
    option &#039;enable_vlan&#039; &#039;1&#039;
 
config &#039;switch_vlan&#039;
    option &#039;device&#039; &#039;rtl8366rb&#039;
    option &#039;vlan&#039; &#039;1&#039;
    option &#039;ports&#039; &#039;1 2 3 4 5t&#039;
 
config &#039;switch_vlan&#039;
    option &#039;device&#039; &#039;rtl8366rb&#039;
    option &#039;vlan&#039; &#039;2&#039;
    option &#039;ports&#039; &#039;0 5t&#039;</code></pre></div><p>Client:<br />/etc/config/openvpn<br /></p><div class="codebox"><pre><code>package openvpn
 
config openvpn gs1
 
option enable 1
option port 1194
option proto tcp-client
option dev tun0
list remote &quot;192.168.1.21 1194&quot;
option pkcs12 /etc/openvpn/gs1.p12
option persist_key 1
option persist_tun 1
option comp_lzo 1
option verb 3
option tls_client 1
option tls-remote server1
option tls_auth &quot;/etc/openvpn/ta.key 1&quot;
option keepalive &quot;10 120&quot;
option tun_mtu 1500
option pool 1
option inactive 3600
option pull 1
option nobind 1
option connect_retry infinite
option resolv_retry infinite
option mute_replay_warnings 1
option auth_nocache 1</code></pre></div><div class="codebox"><pre><code>root@gs1:~# route
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
10.0.1.1        *               255.255.255.255 UH    0      0        0 tun0
192.168.3.0     *               255.255.255.0   U     0      0        0 br-lan
192.168.2.0     10.0.1.1        255.255.255.0   UG    0      0        0 tun0
10.0.1.0        10.0.1.1        255.255.255.0   UG    0      0        0 tun0
192.168.1.0     *               255.255.255.0   U     0      0        0 eth0.2
default         192.168.1.1     0.0.0.0         UG    0      0        0 eth0.2</code></pre></div>											<p class="post-edited">(Last edited by <strong>NoNeed</strong> on 20 Apr 2012, 01:22)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p165171">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">rpc</div>
					<div class="post-datetime">
						20 Apr 2012, 08:22					</div>
				</div>
				<div class="post-content content">
					<p>This happens as the area is not in chain forward. A is included only in the zone ACCEPT option forward and input.</p><p>I have just tested and it works for me for sure<br />You have a lot of unnecessary entries.<br />Should suffice only the following entries:</p><div class="codebox"><pre><code>config zone
        option name             &#039;openvpn&#039;
        option network          &#039;openvpn&#039;
        option input            ACCEPT
        option output           ACCEPT
        option forward          ACCEPT
        option mtu_fix          1

config forwarding
        option src              lan
        option dest             &#039;openvpn&#039;

config forwarding
        option src              &#039;openvpn&#039;
        option dest             &#039;lan&#039;</code></pre></div><p>the rest of your entries is unnecessary<br />I do not know what impact your other rules on the firewall.<br />Maybe you have a typo in the file configuracyjnym.<br />Check the command<br /></p><div class="codebox"><pre><code>uci show firewall</code></pre></div><p>ultimately show the result of the command<br /></p><div class="codebox"><pre><code>iptables -L -v</code></pre></div>											<p class="post-edited">(Last edited by <strong>rpc</strong> on 20 Apr 2012, 08:22)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p165177">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">NoNeed</div>
					<div class="post-datetime">
						20 Apr 2012, 09:30					</div>
				</div>
				<div class="post-content content">
					<p>I do not see anything unusual <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /><br />Perhaps the problem is hidden in my mind</p><p>Server:<br /></p><div class="codebox"><pre><code>root@Server1:~# uci show firewall
firewall.@defaults[0]=defaults
firewall.@defaults[0].syn_flood=1
firewall.@defaults[0].input=ACCEPT
firewall.@defaults[0].output=ACCEPT
firewall.@defaults[0].forward=REJECT
firewall.@defaults[0].drop_invalid=1
firewall.@zone[0]=zone
firewall.@zone[0].name=lan
firewall.@zone[0].input=ACCEPT
firewall.@zone[0].output=ACCEPT
firewall.@zone[0].forward=REJECT
firewall.@zone[0].network=lan
firewall.@zone[1]=zone
firewall.@zone[1].name=wan
firewall.@zone[1].network=wan
firewall.@zone[1].input=REJECT
firewall.@zone[1].output=ACCEPT
firewall.@zone[1].forward=REJECT
firewall.@zone[1].masq=1
firewall.@zone[1].mtu_fix=1
firewall.@rule[0]=rule
firewall.@rule[0].name=Allow-DHCP-Renew
firewall.@rule[0].src=wan
firewall.@rule[0].proto=udp
firewall.@rule[0].dest_port=68
firewall.@rule[0].target=ACCEPT
firewall.@rule[0].family=ipv4
firewall.@rule[1]=rule
firewall.@rule[1].name=Allow-Ping
firewall.@rule[1].src=wan
firewall.@rule[1].proto=icmp
firewall.@rule[1].icmp_type=echo-request
firewall.@rule[1].family=ipv4
firewall.@rule[1].target=ACCEPT
firewall.@include[0]=include
firewall.@include[0].path=/etc/firewall.user
firewall.@rule[2]=rule
firewall.@rule[2].target=ACCEPT
firewall.@rule[2].src=wan
firewall.@rule[2].proto=tcp
firewall.@rule[2].family=ipv4
firewall.@rule[2].dest_port=22
firewall.@rule[3]=rule
firewall.@rule[3].target=ACCEPT
firewall.@rule[3].src=wan
firewall.@rule[3].proto=tcp
firewall.@rule[3].family=ipv4
firewall.@rule[3].dest_port=80
firewall.@rule[4]=rule
firewall.@rule[4].target=ACCEPT
firewall.@rule[4]._name=openvpn
firewall.@rule[4].src=wan
firewall.@rule[4].proto=tcpudp
firewall.@rule[4].dest_port=1194
firewall.@rule[4].family=ipv4
firewall.@zone[2]=zone
firewall.@zone[2].name=openvpn
firewall.@zone[2].output=ACCEPT
firewall.@zone[2].family=ipv4
firewall.@zone[2].input=ACCEPT
firewall.@zone[2].network=openvpn
firewall.@zone[2].forward=ACCEPT
firewall.@zone[2].mtu_fix=1
firewall.@forwarding[0]=forwarding
firewall.@forwarding[0].dest=wan
firewall.@forwarding[0].src=lan
firewall.@forwarding[1]=forwarding
firewall.@forwarding[1].src=openvpn
firewall.@forwarding[1].dest=lan
firewall.@forwarding[2]=forwarding
firewall.@forwarding[2].dest=openvpn
firewall.@forwarding[2].src=lan</code></pre></div><div class="codebox"><pre><code>root@Server1:~# iptables -L -v
Chain INPUT (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination
    0     0 DROP       all  --  any    any     anywhere             anywhere            state INVALID
 1668  159K ACCEPT     all  --  any    any     anywhere             anywhere            state RELATED,ESTABLISHED
  131  8908 ACCEPT     all  --  lo     any     anywhere             anywhere
    2   104 syn_flood  tcp  --  any    any     anywhere             anywhere            tcp flags:FIN,SYN,RST,ACK/SYN
 2268  158K input_rule  all  --  any    any     anywhere             anywhere
 2268  158K input      all  --  any    any     anywhere             anywhere

Chain FORWARD (policy DROP 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination
    0     0 DROP       all  --  any    any     anywhere             anywhere            state INVALID
   24  2812 ACCEPT     all  --  any    any     anywhere             anywhere            state RELATED,ESTABLISHED
   95  8240 forwarding_rule  all  --  any    any     anywhere             anywhere
   95  8240 forward    all  --  any    any     anywhere             anywhere
    0     0 reject     all  --  any    any     anywhere             anywhere

Chain OUTPUT (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination
    0     0 DROP       all  --  any    any     anywhere             anywhere            state INVALID
 1685  184K ACCEPT     all  --  any    any     anywhere             anywhere            state RELATED,ESTABLISHED
  131  8908 ACCEPT     all  --  any    lo      anywhere             anywhere
 1881  124K output_rule  all  --  any    any     anywhere             anywhere
 1881  124K output     all  --  any    any     anywhere             anywhere

Chain forward (1 references)
 pkts bytes target     prot opt in     out     source               destination
   32  2734 zone_lan_forward  all  --  br-lan any     anywhere             anywhere
    0     0 zone_wan_forward  all  --  eth0.2 any     anywhere             anywhere
   63  5506 zone_openvpn_forward  all  --  tun0   any     anywhere             anywhere

Chain forwarding_lan (1 references)
 pkts bytes target     prot opt in     out     source               destination

Chain forwarding_openvpn (1 references)
 pkts bytes target     prot opt in     out     source               destination

Chain forwarding_rule (1 references)
 pkts bytes target     prot opt in     out     source               destination
   95  8240 nat_reflection_fwd  all  --  any    any     anywhere             anywhere

Chain forwarding_wan (1 references)
 pkts bytes target     prot opt in     out     source               destination

Chain input (1 references)
 pkts bytes target     prot opt in     out     source               destination
 2259  158K zone_lan   all  --  br-lan any     anywhere             anywhere
    3   196 zone_wan   all  --  eth0.2 any     anywhere             anywhere
    6   468 zone_openvpn  all  --  tun0   any     anywhere             anywhere

Chain input_lan (1 references)
 pkts bytes target     prot opt in     out     source               destination

Chain input_openvpn (1 references)
 pkts bytes target     prot opt in     out     source               destination

Chain input_rule (1 references)
 pkts bytes target     prot opt in     out     source               destination

Chain input_wan (1 references)
 pkts bytes target     prot opt in     out     source               destination

Chain nat_reflection_fwd (1 references)
 pkts bytes target     prot opt in     out     source               destination

Chain output (1 references)
 pkts bytes target     prot opt in     out     source               destination
 1881  124K zone_lan_ACCEPT  all  --  any    any     anywhere             anywhere
 1878  123K zone_wan_ACCEPT  all  --  any    any     anywhere             anywhere
    0     0 zone_openvpn_ACCEPT  all  --  any    any     anywhere             anywhere

Chain output_rule (1 references)
 pkts bytes target     prot opt in     out     source               destination

Chain reject (7 references)
 pkts bytes target     prot opt in     out     source               destination
    0     0 REJECT     tcp  --  any    any     anywhere             anywhere            reject-with tcp-reset
    0     0 REJECT     all  --  any    any     anywhere             anywhere            reject-with icmp-port-unreachable

Chain syn_flood (1 references)
 pkts bytes target     prot opt in     out     source               destination
    2   104 RETURN     tcp  --  any    any     anywhere             anywhere            tcp flags:FIN,SYN,RST,ACK/SYN limit: avg 25/sec burst 50
    0     0 DROP       all  --  any    any     anywhere             anywhere

Chain zone_lan (1 references)
 pkts bytes target     prot opt in     out     source               destination
 2259  158K input_lan  all  --  any    any     anywhere             anywhere
 2259  158K zone_lan_ACCEPT  all  --  any    any     anywhere             anywhere

Chain zone_lan_ACCEPT (3 references)
 pkts bytes target     prot opt in     out     source               destination
   66  6499 ACCEPT     all  --  any    br-lan  anywhere             anywhere
 2259  158K ACCEPT     all  --  br-lan any     anywhere             anywhere

Chain zone_lan_DROP (0 references)
 pkts bytes target     prot opt in     out     source               destination
    0     0 DROP       all  --  any    br-lan  anywhere             anywhere
    0     0 DROP       all  --  br-lan any     anywhere             anywhere

Chain zone_lan_REJECT (1 references)
 pkts bytes target     prot opt in     out     source               destination
    0     0 reject     all  --  any    br-lan  anywhere             anywhere
    0     0 reject     all  --  br-lan any     anywhere             anywhere

Chain zone_lan_forward (1 references)
 pkts bytes target     prot opt in     out     source               destination
   32  2734 zone_openvpn_ACCEPT  all  --  any    any     anywhere             anywhere
    0     0 zone_wan_ACCEPT  all  --  any    any     anywhere             anywhere
    0     0 forwarding_lan  all  --  any    any     anywhere             anywhere
    0     0 zone_lan_REJECT  all  --  any    any     anywhere             anywhere

Chain zone_openvpn (1 references)
 pkts bytes target     prot opt in     out     source               destination
    6   468 input_openvpn  all  --  any    any     anywhere             anywhere
    6   468 zone_openvpn_ACCEPT  all  --  any    any     anywhere             anywhere

Chain zone_openvpn_ACCEPT (4 references)
 pkts bytes target     prot opt in     out     source               destination
   32  2734 ACCEPT     all  --  any    tun0    anywhere             anywhere
    6   468 ACCEPT     all  --  tun0   any     anywhere             anywhere

Chain zone_openvpn_DROP (0 references)
 pkts bytes target     prot opt in     out     source               destination
    0     0 DROP       all  --  any    tun0    anywhere             anywhere
    0     0 DROP       all  --  tun0   any     anywhere             anywhere

Chain zone_openvpn_REJECT (0 references)
 pkts bytes target     prot opt in     out     source               destination
    0     0 reject     all  --  any    tun0    anywhere             anywhere
    0     0 reject     all  --  tun0   any     anywhere             anywhere

Chain zone_openvpn_forward (1 references)
 pkts bytes target     prot opt in     out     source               destination
   63  5506 zone_lan_ACCEPT  all  --  any    any     anywhere             anywhere
    0     0 forwarding_openvpn  all  --  any    any     anywhere             anywhere
    0     0 zone_openvpn_ACCEPT  all  --  any    any     anywhere             anywhere

Chain zone_wan (1 references)
 pkts bytes target     prot opt in     out     source               destination
    0     0 ACCEPT     udp  --  any    any     anywhere             anywhere            udp dpt:bootpc
    0     0 ACCEPT     icmp --  any    any     anywhere             anywhere            icmp echo-request
    2   144 ACCEPT     tcp  --  any    any     anywhere             anywhere            tcp dpt:ssh
    0     0 ACCEPT     tcp  --  any    any     anywhere             anywhere            tcp dpt:www
    1    52 ACCEPT     tcp  --  any    any     anywhere             anywhere            tcp dpt:openvpn
    0     0 ACCEPT     udp  --  any    any     anywhere             anywhere            udp dpt:openvpn
    0     0 input_wan  all  --  any    any     anywhere             anywhere
    0     0 zone_wan_REJECT  all  --  any    any     anywhere             anywhere

Chain zone_wan_ACCEPT (2 references)
 pkts bytes target     prot opt in     out     source               destination
 1878  123K ACCEPT     all  --  any    eth0.2  anywhere             anywhere
    0     0 ACCEPT     all  --  eth0.2 any     anywhere             anywhere

Chain zone_wan_DROP (0 references)
 pkts bytes target     prot opt in     out     source               destination
    0     0 DROP       all  --  any    eth0.2  anywhere             anywhere
    0     0 DROP       all  --  eth0.2 any     anywhere             anywhere

Chain zone_wan_REJECT (2 references)
 pkts bytes target     prot opt in     out     source               destination
    0     0 reject     all  --  any    eth0.2  anywhere             anywhere
    0     0 reject     all  --  eth0.2 any     anywhere             anywhere

Chain zone_wan_forward (1 references)
 pkts bytes target     prot opt in     out     source               destination
    0     0 forwarding_wan  all  --  any    any     anywhere             anywhere
    0     0 zone_wan_REJECT  all  --  any    any     anywhere             anywhere</code></pre></div><p>Client:<br /></p><div class="codebox"><pre><code>root@gs1:~# uci show firewall
firewall.@defaults[0]=defaults
firewall.@defaults[0].syn_flood=1
firewall.@defaults[0].input=ACCEPT
firewall.@defaults[0].output=ACCEPT
firewall.@defaults[0].forward=REJECT
firewall.@defaults[0].drop_invalid=1
firewall.@zone[0]=zone
firewall.@zone[0].name=lan
firewall.@zone[0].input=ACCEPT
firewall.@zone[0].output=ACCEPT
firewall.@zone[0].forward=REJECT
firewall.@zone[0].network=lan
firewall.@zone[1]=zone
firewall.@zone[1].name=wan
firewall.@zone[1].network=wan
firewall.@zone[1].input=REJECT
firewall.@zone[1].output=ACCEPT
firewall.@zone[1].forward=REJECT
firewall.@zone[1].masq=1
firewall.@zone[1].mtu_fix=1
firewall.@rule[0]=rule
firewall.@rule[0].name=Allow-DHCP-Renew
firewall.@rule[0].src=wan
firewall.@rule[0].proto=udp
firewall.@rule[0].dest_port=68
firewall.@rule[0].target=ACCEPT
firewall.@rule[0].family=ipv4
firewall.@rule[1]=rule
firewall.@rule[1].name=Allow-Ping
firewall.@rule[1].src=wan
firewall.@rule[1].proto=icmp
firewall.@rule[1].icmp_type=echo-request
firewall.@rule[1].family=ipv4
firewall.@rule[1].target=ACCEPT
firewall.@include[0]=include
firewall.@include[0].path=/etc/firewall.user
firewall.@rule[2]=rule
firewall.@rule[2].target=ACCEPT
firewall.@rule[2].src=wan
firewall.@rule[2].proto=tcp
firewall.@rule[2].family=ipv4
firewall.@rule[2].dest_port=22
firewall.@rule[3]=rule
firewall.@rule[3].target=ACCEPT
firewall.@rule[3].src=wan
firewall.@rule[3].proto=tcp
firewall.@rule[3].family=ipv4
firewall.@rule[3].dest_port=80
firewall.@rule[4]=rule
firewall.@rule[4].target=ACCEPT
firewall.@rule[4]._name=openvpn
firewall.@rule[4].src=wan
firewall.@rule[4].proto=tcpudp
firewall.@rule[4].dest_port=1194
firewall.@rule[4].family=ipv4
firewall.@zone[2]=zone
firewall.@zone[2].name=openvpn
firewall.@zone[2].output=ACCEPT
firewall.@zone[2].family=ipv4
firewall.@zone[2].input=ACCEPT
firewall.@zone[2].network=openvpn
firewall.@zone[2].forward=ACCEPT
firewall.@zone[2].mtu_fix=1
firewall.@forwarding[0]=forwarding
firewall.@forwarding[0].dest=wan
firewall.@forwarding[0].src=lan
firewall.@forwarding[1]=forwarding
firewall.@forwarding[1].src=openvpn
firewall.@forwarding[1].dest=lan
firewall.@forwarding[2]=forwarding
firewall.@forwarding[2].dest=openvpn
firewall.@forwarding[2].src=lan</code></pre></div><div class="codebox"><pre><code>root@gs1:~# iptables -L -v
Chain INPUT (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination
    0     0 DROP       all  --  any    any     anywhere             anywhere            state INVALID
  945 86703 ACCEPT     all  --  any    any     anywhere             anywhere            state RELATED,ESTABLISHED
  125  8500 ACCEPT     all  --  lo     any     anywhere             anywhere
    1    52 syn_flood  tcp  --  any    any     anywhere             anywhere            tcp flags:FIN,SYN,RST,ACK/SYN
  956 81855 input_rule  all  --  any    any     anywhere             anywhere
  956 81855 input      all  --  any    any     anywhere             anywhere

Chain FORWARD (policy DROP 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination
    0     0 DROP       all  --  any    any     anywhere             anywhere            state INVALID
  134 31145 ACCEPT     all  --  any    any     anywhere             anywhere            state RELATED,ESTABLISHED
 2000  123K forwarding_rule  all  --  any    any     anywhere             anywhere
 2000  123K forward    all  --  any    any     anywhere             anywhere
    0     0 reject     all  --  any    any     anywhere             anywhere

Chain OUTPUT (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination
    0     0 DROP       all  --  any    any     anywhere             anywhere            state INVALID
 1591  187K ACCEPT     all  --  any    any     anywhere             anywhere            state RELATED,ESTABLISHED
  125  8500 ACCEPT     all  --  any    lo      anywhere             anywhere
  673 50121 output_rule  all  --  any    any     anywhere             anywhere
  673 50121 output     all  --  any    any     anywhere             anywhere

Chain forward (1 references)
 pkts bytes target     prot opt in     out     source               destination
 1986  122K zone_lan_forward  all  --  br-lan any     anywhere             anywhere
    0     0 zone_wan_forward  all  --  eth0.2 any     anywhere             anywhere
   14  1246 zone_openvpn_forward  all  --  tun0   any     anywhere             anywhere

Chain forwarding_lan (1 references)
 pkts bytes target     prot opt in     out     source               destination

Chain forwarding_openvpn (1 references)
 pkts bytes target     prot opt in     out     source               destination

Chain forwarding_rule (1 references)
 pkts bytes target     prot opt in     out     source               destination
 2000  123K nat_reflection_fwd  all  --  any    any     anywhere             anywhere

Chain forwarding_wan (1 references)
 pkts bytes target     prot opt in     out     source               destination

Chain input (1 references)
 pkts bytes target     prot opt in     out     source               destination
  940 80556 zone_lan   all  --  br-lan any     anywhere             anywhere
    0     0 zone_wan   all  --  eth0.2 any     anywhere             anywhere
   12   936 zone_openvpn  all  --  tun0   any     anywhere             anywhere

Chain input_lan (1 references)
 pkts bytes target     prot opt in     out     source               destination

Chain input_openvpn (1 references)
 pkts bytes target     prot opt in     out     source               destination

Chain input_rule (1 references)
 pkts bytes target     prot opt in     out     source               destination

Chain input_wan (1 references)
 pkts bytes target     prot opt in     out     source               destination

Chain nat_reflection_fwd (1 references)
 pkts bytes target     prot opt in     out     source               destination

Chain output (1 references)
 pkts bytes target     prot opt in     out     source               destination
  673 50121 zone_lan_ACCEPT  all  --  any    any     anywhere             anywhere
  657 44837 zone_wan_ACCEPT  all  --  any    any     anywhere             anywhere
    0     0 zone_openvpn_ACCEPT  all  --  any    any     anywhere             anywhere

Chain output_rule (1 references)
 pkts bytes target     prot opt in     out     source               destination

Chain reject (7 references)
 pkts bytes target     prot opt in     out     source               destination
    0     0 REJECT     tcp  --  any    any     anywhere             anywhere            reject-with tcp-reset
    0     0 REJECT     all  --  any    any     anywhere             anywhere            reject-with icmp-port-unreachable

Chain syn_flood (1 references)
 pkts bytes target     prot opt in     out     source               destination
    1    52 RETURN     tcp  --  any    any     anywhere             anywhere            tcp flags:FIN,SYN,RST,ACK/SYN limit: avg 25/sec burst 50
    0     0 DROP       all  --  any    any     anywhere             anywhere

Chain zone_lan (1 references)
 pkts bytes target     prot opt in     out     source               destination
  940 80556 input_lan  all  --  any    any     anywhere             anywhere
  940 80556 zone_lan_ACCEPT  all  --  any    any     anywhere             anywhere

Chain zone_lan_ACCEPT (3 references)
 pkts bytes target     prot opt in     out     source               destination
   30  6530 ACCEPT     all  --  any    br-lan  anywhere             anywhere
  940 80556 ACCEPT     all  --  br-lan any     anywhere             anywhere

Chain zone_lan_DROP (0 references)
 pkts bytes target     prot opt in     out     source               destination
    0     0 DROP       all  --  any    br-lan  anywhere             anywhere
    0     0 DROP       all  --  br-lan any     anywhere             anywhere

Chain zone_lan_REJECT (1 references)
 pkts bytes target     prot opt in     out     source               destination
    0     0 reject     all  --  any    br-lan  anywhere             anywhere
    0     0 reject     all  --  br-lan any     anywhere             anywhere

Chain zone_lan_forward (1 references)
 pkts bytes target     prot opt in     out     source               destination
 1986  122K zone_openvpn_ACCEPT  all  --  any    any     anywhere             anywhere
 1925  117K zone_wan_ACCEPT  all  --  any    any     anywhere             anywhere
    0     0 forwarding_lan  all  --  any    any     anywhere             anywhere
    0     0 zone_lan_REJECT  all  --  any    any     anywhere             anywhere

Chain zone_openvpn (1 references)
 pkts bytes target     prot opt in     out     source               destination
   12   936 input_openvpn  all  --  any    any     anywhere             anywhere
   12   936 zone_openvpn_ACCEPT  all  --  any    any     anywhere             anywhere

Chain zone_openvpn_ACCEPT (4 references)
 pkts bytes target     prot opt in     out     source               destination
   61  5238 ACCEPT     all  --  any    tun0    anywhere             anywhere
   12   936 ACCEPT     all  --  tun0   any     anywhere             anywhere

Chain zone_openvpn_DROP (0 references)
 pkts bytes target     prot opt in     out     source               destination
    0     0 DROP       all  --  any    tun0    anywhere             anywhere
    0     0 DROP       all  --  tun0   any     anywhere             anywhere

Chain zone_openvpn_REJECT (0 references)
 pkts bytes target     prot opt in     out     source               destination
    0     0 reject     all  --  any    tun0    anywhere             anywhere
    0     0 reject     all  --  tun0   any     anywhere             anywhere

Chain zone_openvpn_forward (1 references)
 pkts bytes target     prot opt in     out     source               destination
   14  1246 zone_lan_ACCEPT  all  --  any    any     anywhere             anywhere
    0     0 forwarding_openvpn  all  --  any    any     anywhere             anywhere
    0     0 zone_openvpn_ACCEPT  all  --  any    any     anywhere             anywhere

Chain zone_wan (1 references)
 pkts bytes target     prot opt in     out     source               destination
    0     0 ACCEPT     udp  --  any    any     anywhere             anywhere            udp dpt:bootpc
    0     0 ACCEPT     icmp --  any    any     anywhere             anywhere            icmp echo-request
    0     0 ACCEPT     tcp  --  any    any     anywhere             anywhere            tcp dpt:ssh
    0     0 ACCEPT     tcp  --  any    any     anywhere             anywhere            tcp dpt:www
    0     0 ACCEPT     tcp  --  any    any     anywhere             anywhere            tcp dpt:openvpn
    0     0 ACCEPT     udp  --  any    any     anywhere             anywhere            udp dpt:openvpn
    0     0 input_wan  all  --  any    any     anywhere             anywhere
    0     0 zone_wan_REJECT  all  --  any    any     anywhere             anywhere

Chain zone_wan_ACCEPT (2 references)
 pkts bytes target     prot opt in     out     source               destination
 2582  161K ACCEPT     all  --  any    eth0.2  anywhere             anywhere
    0     0 ACCEPT     all  --  eth0.2 any     anywhere             anywhere

Chain zone_wan_DROP (0 references)
 pkts bytes target     prot opt in     out     source               destination
    0     0 DROP       all  --  any    eth0.2  anywhere             anywhere
    0     0 DROP       all  --  eth0.2 any     anywhere             anywhere

Chain zone_wan_REJECT (2 references)
 pkts bytes target     prot opt in     out     source               destination
    0     0 reject     all  --  any    eth0.2  anywhere             anywhere
    0     0 reject     all  --  eth0.2 any     anywhere             anywhere

Chain zone_wan_forward (1 references)
 pkts bytes target     prot opt in     out     source               destination
    0     0 forwarding_wan  all  --  any    any     anywhere             anywhere
    0     0 zone_wan_REJECT  all  --  any    any     anywhere             anywhere</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p165191">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">rpc</div>
					<div class="post-datetime">
						20 Apr 2012, 11:44					</div>
				</div>
				<div class="post-content content">
					<p>I was looking at the firewall on the clients.<br />The test off the firewalls on the computers 192.168.3.163 and 192.168.2.155. And see if that would work.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p165197">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">NoNeed</div>
					<div class="post-datetime">
						20 Apr 2012, 13:13					</div>
				</div>
				<div class="post-content content">
					<p>firewall on clients is off.<br />ping from 192.168.2.1 to 192.168.2.155 is ok<br />ping from 192.168.3.1 to 192.168.3.163 is ok</p><p>when i am connect PC 192.168.3.163 to other network with ipsec vpn on juniper - ping from different subnet is ok...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p165204">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">rpc</div>
					<div class="post-datetime">
						20 Apr 2012, 14:18					</div>
				</div>
				<div class="post-content content">
					<p>And ping from 192.168.3.163 to 192.168.2.155 and vice-versa is ok ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p165205">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">NoNeed</div>
					<div class="post-datetime">
						20 Apr 2012, 14:24					</div>
				</div>
				<div class="post-content content">
					<p>there is no ping from 192.168.3.163 to 192.168.2.155 and backward <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><p>i am try to monitoring traffic with wireshark. there is no packets from remote machines. only from router of remote network.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p165259">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">rpc</div>
					<div class="post-datetime">
						20 Apr 2012, 21:42					</div>
				</div>
				<div class="post-content content">
					<p>The test on the two routers, issue the console command:<br /></p><div class="codebox"><pre><code> 
iptables -I FORWARD -s 192.168.3.0/24 -d 192.168.2.0/24 -j ACCEPT
iptables -I FORWARD -s 192.168.2.0/24 -d 192.168.3.0/24 -j ACCEPT</code></pre></div><p>and then see the ping from 192.168.3.163 to 192.168.2.155 and vice versa</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p165264">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">NoNeed</div>
					<div class="post-datetime">
						20 Apr 2012, 22:17					</div>
				</div>
				<div class="post-content content">
					<p>no result <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><p>From 192.168.3.163:<br />C:\Users\User&gt;tracert 192.168.2.1<br />&nbsp; 1&nbsp; &nbsp; &lt;1 ??&nbsp; &nbsp; &lt;1 ??&nbsp; &nbsp; &lt;1 ??&nbsp; gs1.lan [192.168.3.1]<br />&nbsp; 2&nbsp; &nbsp; &nbsp;2 ms&nbsp; &nbsp; &nbsp;1 ms&nbsp; &nbsp; &nbsp;1 ms&nbsp; 192.168.2.1</p><p>C:\Users\User&gt;tracert 192.168.2.155<br />&nbsp; 1&nbsp; &nbsp; &lt;1 ??&nbsp; &nbsp; &lt;1 ??&nbsp; &nbsp; &lt;1 ??&nbsp; gs1.lan [192.168.3.1]<br />&nbsp; 2&nbsp; &nbsp; &nbsp;2 ms&nbsp; &nbsp; &nbsp;1 ms&nbsp; &nbsp; &nbsp;1 ms&nbsp; 10.0.1.1<br />&nbsp; 3&nbsp; &nbsp; &nbsp;*&nbsp; &nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp;timeout</p><br /><p>why my first traceroute to remote GW complete in a 2 hops?<br />it should be 3? 192.168.3.1 - 10.0.1.1 - 192.168.2.1?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p165267">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">rpc</div>
					<div class="post-datetime">
						20 Apr 2012, 23:38					</div>
				</div>
				<div class="post-content content">
					<p>U is about me is the same and it works.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p165268">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">rpc</div>
					<div class="post-datetime">
						20 Apr 2012, 23:49					</div>
				</div>
				<div class="post-content content">
					<p>Change the address in the ccd directory server to the client for those below<br /></p><div class="codebox"><pre><code> ifconfig-push 10.0.1.5 10.0.1.6</code></pre></div><p>restart openvpn server and client<br />see if the ping is now working properly</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p165326">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">NoNeed</div>
					<div class="post-datetime">
						21 Apr 2012, 14:57					</div>
				</div>
				<div class="post-content content">
					<p>No effect <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /><br />What means string in client log file..?</p><p>Apr 21 11:48:25 gs1 daemon.warn openvpn(gs1)[1113]: ERROR: Linux route add command failed: external program exited with error status: 1</p><p>Server logs:<br /></p><div class="codebox"><pre><code>Apr 21 05:15:20 Server1 daemon.notice openvpn(server_conf)[1033]: OpenVPN 2.1.4 mips-openwrt-linux [SSL] [LZO2] [EPOLL] built on Nov 14 2011
Apr 21 05:15:20 Server1 daemon.warn openvpn(server_conf)[1033]: NOTE: your local LAN uses the extremely common subnet address 192.168.0.x or 192.168.1.x.  Be aware that this might create routing conflicts if you connect to the VPN server from public locations such as int
Apr 21 05:15:20 Server1 daemon.warn openvpn(server_conf)[1033]: NOTE: OpenVPN 2.1 requires &#039;--script-security 2&#039; or higher to call user-defined scripts or executables
Apr 21 05:15:20 Server1 daemon.notice openvpn(server_conf)[1033]: Diffie-Hellman initialized with 1024 bit key
Apr 21 05:15:20 Server1 daemon.warn openvpn(server_conf)[1033]: WARNING: file &#039;/etc/openvpn/ta.key&#039; is group or others accessible
Apr 21 05:15:20 Server1 daemon.notice openvpn(server_conf)[1033]: Control Channel Authentication: using &#039;/etc/openvpn/ta.key&#039; as a OpenVPN static key file
Apr 21 05:15:20 Server1 daemon.notice openvpn(server_conf)[1033]: Outgoing Control Channel Authentication: Using 160 bit message hash &#039;SHA1&#039; for HMAC authentication
Apr 21 05:15:20 Server1 daemon.notice openvpn(server_conf)[1033]: Incoming Control Channel Authentication: Using 160 bit message hash &#039;SHA1&#039; for HMAC authentication
Apr 21 05:15:20 Server1 daemon.notice openvpn(server_conf)[1033]: TLS-Auth MTU parms [ L:1544 D:168 EF:68 EB:0 ET:0 EL:0 ]
Apr 21 05:15:20 Server1 daemon.notice openvpn(server_conf)[1033]: Socket Buffers: R=[87380-&gt;131072] S=[16384-&gt;131072]
Apr 21 05:15:20 Server1 daemon.notice openvpn(server_conf)[1033]: TUN/TAP device tun0 opened
Apr 21 05:15:20 Server1 daemon.notice openvpn(server_conf)[1033]: TUN/TAP TX queue length set to 100
Apr 21 05:15:20 Server1 daemon.notice openvpn(server_conf)[1033]: /sbin/ifconfig tun0 10.0.1.1 pointopoint 10.0.1.2 mtu 1500
Apr 21 05:15:20 Server1 daemon.notice openvpn(server_conf)[1033]: /sbin/route add -net 192.168.3.0 netmask 255.255.255.0 gw 10.0.1.2
Apr 21 05:15:20 Server1 daemon.notice openvpn(server_conf)[1033]: /sbin/route add -net 10.0.1.0 netmask 255.255.255.0 gw 10.0.1.2
Apr 21 05:15:20 Server1 daemon.notice openvpn(server_conf)[1033]: Data Channel MTU parms [ L:1544 D:1450 EF:44 EB:135 ET:0 EL:0 AF:3/1 ]
Apr 21 05:15:20 Server1 daemon.notice openvpn(server_conf)[1033]: Listening for incoming TCP connection on [undef]:1194
Apr 21 05:15:20 Server1 daemon.notice openvpn(server_conf)[1033]: TCPv4_SERVER link local (bound): [undef]:1194
Apr 21 05:15:20 Server1 daemon.notice openvpn(server_conf)[1033]: TCPv4_SERVER link remote: [undef]
Apr 21 05:15:20 Server1 daemon.notice openvpn(server_conf)[1033]: MULTI: multi_init called, r=256 v=256
Apr 21 05:15:20 Server1 daemon.notice openvpn(server_conf)[1033]: IFCONFIG POOL: base=10.0.1.4 size=62
Apr 21 05:15:20 Server1 daemon.notice openvpn(server_conf)[1033]: IFCONFIG POOL LIST
Apr 21 05:15:20 Server1 daemon.notice openvpn(server_conf)[1033]: MULTI: TCP INIT maxclients=1024 maxevents=1028
Apr 21 05:15:20 Server1 daemon.notice openvpn(server_conf)[1033]: Initialization Sequence Completed
Apr 21 05:15:20 Server1 user.notice ifup: Enabling Router Solicitations on openvpn (tun0)
Apr 21 05:15:21 Server1 user.info firewall: adding openvpn (tun0) to zone openvpn
Apr 21 05:15:23 Server1 daemon.info dnsmasq-dhcp[1024]: DHCPINFORM(br-lan) 192.168.2.155 00:16:76:ca:3e:9c 
Apr 21 05:15:23 Server1 daemon.info dnsmasq-dhcp[1024]: DHCPACK(br-lan) 192.168.2.155 00:16:76:ca:3e:9c Ksy
Apr 21 05:15:26 Server1 daemon.notice openvpn(server_conf)[1033]: MULTI: multi_create_instance called
Apr 21 05:15:26 Server1 daemon.notice openvpn(server_conf)[1033]: Re-using SSL/TLS context
Apr 21 05:15:26 Server1 daemon.notice openvpn(server_conf)[1033]: LZO compression initialized
Apr 21 05:15:26 Server1 daemon.notice openvpn(server_conf)[1033]: Control Channel MTU parms [ L:1544 D:168 EF:68 EB:0 ET:0 EL:0 ]
Apr 21 05:15:26 Server1 daemon.notice openvpn(server_conf)[1033]: Data Channel MTU parms [ L:1544 D:1450 EF:44 EB:135 ET:0 EL:0 AF:3/1 ]
Apr 21 05:15:26 Server1 daemon.notice openvpn(server_conf)[1033]: TCP connection established with 192.168.1.31:36903
Apr 21 05:15:26 Server1 daemon.notice openvpn(server_conf)[1033]: TCPv4_SERVER link local: [undef]
Apr 21 05:15:26 Server1 daemon.notice openvpn(server_conf)[1033]: TCPv4_SERVER link remote: 192.168.1.31:36903
Apr 21 05:15:27 Server1 daemon.notice openvpn(server_conf)[1033]: 192.168.1.31:36903 TLS: Initial packet from 192.168.1.31:36903, sid=549dc1e0 15951409
Apr 21 05:15:27 Server1 daemon.notice openvpn(server_conf)[1033]: 192.168.1.31:36903 VERIFY OK: depth=1, /C=RU/ST=Yral/L=Ekb/O=GS/CN=gs-ca/emailAddress=me@local
Apr 21 05:15:27 Server1 daemon.notice openvpn(server_conf)[1033]: 192.168.1.31:36903 VERIFY OK: depth=0, /C=RU/ST=Yral/L=Ekb/O=GS/CN=gs1/emailAddress=me@local
Apr 21 05:15:28 Server1 daemon.notice openvpn(server_conf)[1033]: 192.168.1.31:36903 Data Channel Encrypt: Cipher &#039;BF-CBC&#039; initialized with 128 bit key
Apr 21 05:15:28 Server1 daemon.notice openvpn(server_conf)[1033]: 192.168.1.31:36903 Data Channel Encrypt: Using 160 bit message hash &#039;SHA1&#039; for HMAC authentication
Apr 21 05:15:28 Server1 daemon.notice openvpn(server_conf)[1033]: 192.168.1.31:36903 Data Channel Decrypt: Cipher &#039;BF-CBC&#039; initialized with 128 bit key
Apr 21 05:15:28 Server1 daemon.notice openvpn(server_conf)[1033]: 192.168.1.31:36903 Data Channel Decrypt: Using 160 bit message hash &#039;SHA1&#039; for HMAC authentication
Apr 21 05:15:28 Server1 daemon.notice openvpn(server_conf)[1033]: 192.168.1.31:36903 Control Channel: TLSv1, cipher TLSv1/SSLv3 DHE-RSA-AES256-SHA, 1024 bit RSA
Apr 21 05:15:28 Server1 daemon.notice openvpn(server_conf)[1033]: 192.168.1.31:36903 [gs1] Peer Connection Initiated with 192.168.1.31:36903
Apr 21 05:15:28 Server1 daemon.notice openvpn(server_conf)[1033]: gs1/192.168.1.31:36903 OPTIONS IMPORT: reading client specific options from: /etc/openvpn/ccd/gs1
Apr 21 05:15:28 Server1 daemon.notice openvpn(server_conf)[1033]: gs1/192.168.1.31:36903 MULTI: Learn: 10.0.1.5 -&gt; gs1/192.168.1.31:36903
Apr 21 05:15:28 Server1 daemon.notice openvpn(server_conf)[1033]: gs1/192.168.1.31:36903 MULTI: primary virtual IP for gs1/192.168.1.31:36903: 10.0.1.5
Apr 21 05:15:28 Server1 daemon.notice openvpn(server_conf)[1033]: gs1/192.168.1.31:36903 MULTI: internal route 192.168.3.0/24 -&gt; gs1/192.168.1.31:36903
Apr 21 05:15:28 Server1 daemon.notice openvpn(server_conf)[1033]: gs1/192.168.1.31:36903 MULTI: Learn: 192.168.3.0/24 -&gt; gs1/192.168.1.31:36903
Apr 21 05:15:28 Server1 daemon.notice openvpn(server_conf)[1033]: gs1/192.168.1.31:36903 REMOVE PUSH ROUTE: &#039;route 192.168.3.0 255.255.255.0&#039;
Apr 21 05:15:30 Server1 daemon.notice openvpn(server_conf)[1033]: gs1/192.168.1.31:36903 PUSH: Received control message: &#039;PUSH_REQUEST&#039;
Apr 21 05:15:30 Server1 daemon.notice openvpn(server_conf)[1033]: gs1/192.168.1.31:36903 SENT CONTROL [gs1]: &#039;PUSH_REPLY,route 10.0.1.0 255.255.255.0,route 192.168.2.0 255.255.255.0,route 10.0.1.0 255.255.255.0,topology net30,ping 10,ping-restart 120,ifconfig 10.0.1.5 10.0
Apr 21 05:15:30 Server1 daemon.notice openvpn(server_conf)[1033]: MULTI: Learn: 192.168.3.1 -&gt; gs1/192.168.1.31:36903
Apr 21 05:15:31 Server1 daemon.notice openvpn(server_conf)[1033]: MULTI: Learn: 192.168.3.163 -&gt; gs1/192.168.1.31:36903</code></pre></div><p>Client logs:<br /></p><div class="codebox"><pre><code>Apr 21 11:48:21 gs1 daemon.notice openvpn(gs1)[1113]: OpenVPN 2.1.4 mips-openwrt-linux [SSL] [LZO2] [EPOLL] built on Nov 14 2011
Apr 21 11:48:21 gs1 daemon.warn openvpn(gs1)[1113]: WARNING: No server certificate verification method has been enabled.  See http://openvpn.net/howto.html#mitm for more info.
Apr 21 11:48:21 gs1 daemon.warn openvpn(gs1)[1113]: NOTE: OpenVPN 2.1 requires &#039;--script-security 2&#039; or higher to call user-defined scripts or executables
Apr 21 11:48:21 gs1 daemon.info dnsmasq-dhcp[1104]: DHCPREQUEST(br-lan) 192.168.3.163 90:e6:ba:f8:13:bf 
Apr 21 11:48:21 gs1 daemon.info dnsmasq-dhcp[1104]: DHCPACK(br-lan) 192.168.3.163 90:e6:ba:f8:13:bf OMG
Apr 21 11:48:21 gs1 daemon.warn openvpn(gs1)[1113]: WARNING: file &#039;/etc/openvpn/ta.key&#039; is group or others accessible
Apr 21 11:48:21 gs1 daemon.notice openvpn(gs1)[1113]: Control Channel Authentication: using &#039;/etc/openvpn/ta.key&#039; as a OpenVPN static key file
Apr 21 11:48:21 gs1 daemon.notice openvpn(gs1)[1113]: Outgoing Control Channel Authentication: Using 160 bit message hash &#039;SHA1&#039; for HMAC authentication
Apr 21 11:48:21 gs1 daemon.notice openvpn(gs1)[1113]: Incoming Control Channel Authentication: Using 160 bit message hash &#039;SHA1&#039; for HMAC authentication
Apr 21 11:48:21 gs1 daemon.notice openvpn(gs1)[1113]: LZO compression initialized
Apr 21 11:48:21 gs1 daemon.notice openvpn(gs1)[1113]: Control Channel MTU parms [ L:1544 D:168 EF:68 EB:0 ET:0 EL:0 ]
Apr 21 11:48:21 gs1 daemon.notice openvpn(gs1)[1113]: Socket Buffers: R=[87380-&gt;131072] S=[16384-&gt;131072]
Apr 21 11:48:21 gs1 daemon.notice openvpn(gs1)[1113]: Data Channel MTU parms [ L:1544 D:1450 EF:44 EB:135 ET:0 EL:0 AF:3/1 ]
Apr 21 11:48:21 gs1 daemon.notice openvpn(gs1)[1113]: Attempting to establish TCP connection with 192.168.1.21:1194 [nonblock]
Apr 21 11:48:22 gs1 daemon.notice openvpn(gs1)[1113]: TCP connection established with 192.168.1.21:1194
Apr 21 11:48:22 gs1 daemon.notice openvpn(gs1)[1113]: TCPv4_CLIENT link local: [undef]
Apr 21 11:48:22 gs1 daemon.notice openvpn(gs1)[1113]: TCPv4_CLIENT link remote: 192.168.1.21:1194
Apr 21 11:48:22 gs1 daemon.notice openvpn(gs1)[1113]: TLS: Initial packet from 192.168.1.21:1194, sid=19446267 899b42c2
Apr 21 11:48:23 gs1 daemon.notice openvpn(gs1)[1113]: VERIFY OK: depth=1, /C=RU/ST=Yral/L=Ekb/O=GS/CN=gs-ca/emailAddress=me@local
Apr 21 11:48:23 gs1 daemon.notice openvpn(gs1)[1113]: VERIFY OK: depth=0, /C=RU/ST=Yral/L=Ekb/O=GS/CN=server1/emailAddress=me@local
Apr 21 11:48:23 gs1 daemon.notice openvpn(gs1)[1113]: Data Channel Encrypt: Cipher &#039;BF-CBC&#039; initialized with 128 bit key
Apr 21 11:48:23 gs1 daemon.notice openvpn(gs1)[1113]: Data Channel Encrypt: Using 160 bit message hash &#039;SHA1&#039; for HMAC authentication
Apr 21 11:48:23 gs1 daemon.notice openvpn(gs1)[1113]: Data Channel Decrypt: Cipher &#039;BF-CBC&#039; initialized with 128 bit key
Apr 21 11:48:23 gs1 daemon.notice openvpn(gs1)[1113]: Data Channel Decrypt: Using 160 bit message hash &#039;SHA1&#039; for HMAC authentication
Apr 21 11:48:23 gs1 daemon.notice openvpn(gs1)[1113]: Control Channel: TLSv1, cipher TLSv1/SSLv3 DHE-RSA-AES256-SHA, 1024 bit RSA
Apr 21 11:48:23 gs1 daemon.notice openvpn(gs1)[1113]: [server1] Peer Connection Initiated with 192.168.1.21:1194
Apr 21 11:48:25 gs1 daemon.notice openvpn(gs1)[1113]: SENT CONTROL [server1]: &#039;PUSH_REQUEST&#039; (status=1)
Apr 21 11:48:25 gs1 daemon.notice openvpn(gs1)[1113]: PUSH: Received control message: &#039;PUSH_REPLY,route 10.0.1.0 255.255.255.0,route 192.168.2.0 255.255.255.0,route 10.0.1.0 255.255.255.0,topology net30,ping 10,ping-restart 120,ifconfig 10.0.1.5 10.0.1.6&#039;
Apr 21 11:48:25 gs1 daemon.notice openvpn(gs1)[1113]: OPTIONS IMPORT: timers and/or timeouts modified
Apr 21 11:48:25 gs1 daemon.notice openvpn(gs1)[1113]: OPTIONS IMPORT: --ifconfig/up options modified
Apr 21 11:48:25 gs1 daemon.notice openvpn(gs1)[1113]: OPTIONS IMPORT: route options modified
Apr 21 11:48:25 gs1 daemon.notice openvpn(gs1)[1113]: TUN/TAP device tun0 opened
Apr 21 11:48:25 gs1 daemon.notice openvpn(gs1)[1113]: TUN/TAP TX queue length set to 100
Apr 21 11:48:25 gs1 daemon.notice openvpn(gs1)[1113]: /sbin/ifconfig tun0 10.0.1.5 pointopoint 10.0.1.6 mtu 1500
Apr 21 11:48:25 gs1 daemon.notice openvpn(gs1)[1113]: /sbin/route add -net 10.0.1.0 netmask 255.255.255.0 gw 10.0.1.6
Apr 21 11:48:25 gs1 daemon.notice openvpn(gs1)[1113]: /sbin/route add -net 192.168.2.0 netmask 255.255.255.0 gw 10.0.1.6
Apr 21 11:48:25 gs1 daemon.notice openvpn(gs1)[1113]: /sbin/route add -net 10.0.1.0 netmask 255.255.255.0 gw 10.0.1.6
Apr 21 11:48:25 gs1 daemon.warn openvpn(gs1)[1113]: ERROR: Linux route add command failed: external program exited with error status: 1
Apr 21 11:48:25 gs1 daemon.notice openvpn(gs1)[1113]: Initialization Sequence Completed
Apr 21 11:48:25 gs1 daemon.info dnsmasq-dhcp[1104]: DHCPINFORM(br-lan) 192.168.3.163 90:e6:ba:f8:13:bf 
Apr 21 11:48:25 gs1 daemon.info dnsmasq-dhcp[1104]: DHCPACK(br-lan) 192.168.3.163 90:e6:ba:f8:13:bf OMG
Apr 21 11:48:26 gs1 user.notice ifup: Enabling Router Solicitations on openvpn (tun0)
Apr 21 11:48:26 gs1 user.info firewall: adding openvpn (tun0) to zone openvpn</code></pre></div>											<p class="post-edited">(Last edited by <strong>NoNeed</strong> on 21 Apr 2012, 14:58)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>