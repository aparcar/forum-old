<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Packaging a new build target in a feed [SOLVED]</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 4 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p336613">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">dl12345</div>
					<div class="post-datetime">
						31 Aug 2016, 04:37					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m trying to package a new build target into a feed.</p><p>Looking at the info in the top level of the feeds folder, a build target is successfully recognized and parsed by the build system as the target data correctly appears in the feeds/&lt;feed-name&gt;/&lt;feed-name.tmp&gt;/.targetinfo file. and there is a .kernel-&lt;TARGETNAME&gt; file.</p><p>No info pertaining to this target is to be found in tmp/.targetinfo and there is no corresponding .kernel-&lt;TARGETNAME&gt; in tmp</p><p>No matter what I do, I cannot seem to get the new target to show up in menuconfig (which it does if the folder is placed directly into target/linux).</p><p>Does anyone know if this is even possible - to package up a new platform build target in a feed and have it integrate seamlessly into build process? I&#039;m not sure if I&#039;m doing something wrong or if this is just not possible.</p><p>Thanks<br />/dl</p><p>EDIT: I cleaned out tmp multiple times...and touched the target/linux/Makefile</p>											<p class="post-edited">(Last edited by <strong>dl12345</strong> on 6 Sep 2016, 12:01)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p336785">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">elektroman</div>
					<div class="post-datetime">
						31 Aug 2016, 23:55					</div>
				</div>
				<div class="post-content content">
					<p>Tired of thinking ???</p><p>Three simple steps<br />OpenWRT(Mainpage)-&gt;Documentaion-&gt;DeveloperGuid-&gt;Feeds</p><p>Bonus:<br />what are purpuse of tmp and .* files/dirs ??</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p336857">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">dl12345</div>
					<div class="post-datetime">
						1 Sep 2016, 13:43					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>elektroman wrote:</cite><blockquote><p>Tired of thinking ???</p><p>Three simple steps<br />OpenWRT(Mainpage)-&gt;Documentaion-&gt;DeveloperGuid-&gt;Feeds</p><p>Bonus:<br />what are purpuse of tmp and .* files/dirs ??</p></blockquote></div><p>What is it about the anonymity of a forum that allows people like you to think they can insult others with impunity?</p><p>The developer documentation was the obvious place to start. I read this many years ago. I&#039;ve created many custom packages in a custom feed and I know how to use custom feeds.</p><p>However, nowhere does the documentation address creating a BUILD TARGET, not a user package. My point is that the build system, even though it seems to parse a Makefile for a build target, doesn&#039;t seem to include it in the menuconfig as a target. If you knew enough about the build system (which clearly you don&#039;t from your remark about tmp and files folders, you would know that this is where the metadata from the packages and feeds is stored.</p><p>I suggest you avoid replying to threads where you clearly don&#039;t have any information. Perhaps you&#039;re the one who is tired of thinking?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p336892">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">elektroman</div>
					<div class="post-datetime">
						1 Sep 2016, 19:01					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>dl12345 wrote:</cite><blockquote><p>What is it about the anonymity of a forum that allows people like you to think they can insult others with impunity?</p></blockquote></div><p>First of all I&#039;m not anonym, you maybe find my real name here.</p><p>Second, If you feel offended from my post it&#039;s your problem.<br />If I will insult people, I will call them bad names and other things.<br />And if you call me bad names, I don&#039;t care and think about my fault.<br />Because I&#039;ve done/ask some stupid action/question and I must have know it better. This thing is called learning by the hard way (tm).</p><p>Third you are messing up with feeds and &quot;base&quot; system.</p><p>feeds are *only* seen as add on to the base system, with the TARGET from the base system. <br />You can&#039;t switch the TARGET in feeds. The base system is responsible for creating the right toolchain for the TARGET.</p><p>I don&#039;t know/care if this is here documented or not<br />because if you do<br /></p><div class="codebox"><pre><code>ls target/linux/</code></pre></div><p>you see the targets in OpenWRT and this is *my* first place to look.<br />Obviously because of the name</p><div class="quotebox"><cite>dl12345 wrote:</cite><blockquote><p>If you knew enough about the build system (which clearly you don&#039;t from your remark about tmp and files folders, you would know that this is where the metadata from the packages and feeds is stored.</p></blockquote></div><p>I don&#039;t look into the tmp files this is a complete waste of time.<br />It&#039;s only needed for people messing around with the buildsystem <span class="bbu">itself</span>.<br />Not for creating a new TARGET.<br />If your TARGET doesn&#039;t shows up the problem is not in tmp</p><p>So if you want to create a new TARGET do this in <br />/target/linux<br />Use some TARGET with the same ARCH as your new TARGET as sample</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p336912">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">dl12345</div>
					<div class="post-datetime">
						1 Sep 2016, 22:49					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>elektroman wrote:</cite><blockquote><br /><p>Third you are messing up with feeds and &quot;base&quot; system.</p><p>feeds are *only* seen as add on to the base system, with the TARGET from the base system. <br />You can&#039;t switch the TARGET in feeds. The base system is responsible for creating the right toolchain for the TARGET.</p></blockquote></div><p>Incorrect. Targets in the feeds folder are &quot;seen&quot; by the build system. They are correctly parsed. An examination of the metadata in the feeds folder will show this to be the case. Hence my original question: if targets are not meant to be added via feeds, then why are they parsed out and metadata inserted into the feeds folder. This is a reasonable question.</p><div class="quotebox"><cite>elektroman wrote:</cite><blockquote><p>I don&#039;t look into the tmp files this is a complete waste of time.<br />It&#039;s only needed for people messing around with the buildsystem <span class="bbu">itself</span>.<br />Not for creating a new TARGET.<br />If your TARGET doesn&#039;t shows up the problem is not in tmp</p></blockquote></div><p>See above. My question is <strong><em>about the build system itself</em></strong>. This seems to have escaped you, since you pointed out that &quot;It&#039;s only needed for people messing around with the buildsystem <span class="bbu">itself</span>&quot;. Precisely.</p><div class="quotebox"><cite>elektroman wrote:</cite><blockquote><p>So if you want to create a new TARGET do this in <br />/target/linux<br />Use some TARGET with the same ARCH as your new TARGET as sample</p></blockquote></div><p>Obviously. But this is not very portable, especially if you want to package the target up for other people to use. For my own personal use, it&#039;s a no-brainer. I&#039;m trying to create a new build target for an unsupported platform that is easy for other people to use. Hence a desire to use a feed that integrates seamlessly.</p><p>Since you&#039;ve nothing to contribute beyond what I already know, thanks for your input and suggest you move on to another topic.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p337078">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">elektroman</div>
					<div class="post-datetime">
						3 Sep 2016, 17:24					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>dl12345 wrote:</cite><blockquote><p>Incorrect. Targets in the feeds folder are &quot;seen&quot; by the build system. They are correctly parsed. An examination of the metadata in the feeds folder will show this to be the case. Hence my original question: if targets are not meant to be added via feeds, then why are they parsed out and metadata inserted into the feeds folder. This is a reasonable question.</p></blockquote></div><p>Yes for the build of a package in feeds.<br />Think about crosscompile an external kernel module or another tools.<br />Some buildsystems export *all* data to the lower buildsystem hence feeds.<br />Maybe they need some symbols or other things here.<br />If you have done some crosscompile by hand you will know.<br />This is hard stuff, you have to cheat autoconf/automake </p><p>The *real* (technical) reason why you can&#039;t add a new target in feeds is crosscompile.<br />If you create a crosscompiler for $TARGET this one a only run on $TARGET. <br />So if you add $NEW_TARGET to feeds the build system will use the crosscompiler<br />from $TARGET to build a new one for $NEW_TARGET and will crash</p><p>For more deeper understanding this site may help<br /><a href="http://www.linuxfromscratch.org/">http://www.linuxfromscratch.org/</a><br />Look for crosscompile</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p337155">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">dl12345</div>
					<div class="post-datetime">
						4 Sep 2016, 18:09					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>elektroman wrote:</cite><blockquote><p>Yes for the build of a package in feeds.<br />Think about crosscompile an external kernel module or another tools.<br />Some buildsystems export *all* data to the lower buildsystem hence feeds.<br />Maybe they need some symbols or other things here.<br />If you have done some crosscompile by hand you will know.<br />This is hard stuff, you have to cheat autoconf/automake </p><p>The *real* (technical) reason why you can&#039;t add a new target in feeds is crosscompile.<br />If you create a crosscompiler for $TARGET this one a only run on $TARGET. <br />So if you add $NEW_TARGET to feeds the build system will use the crosscompiler<br />from $TARGET to build a new one for $NEW_TARGET and will crash</p><p>For more deeper understanding this site may help<br /><a href="http://www.linuxfromscratch.org/">http://www.linuxfromscratch.org/</a><br />Look for crosscompile</p></blockquote></div><p>I&#039;ve been using Linux and tinkering with kernel code since it first came out in 1991. I&#039;ve ported external kernel modules to openwrt and at one stage a number of years ago was an optware developer. I&#039;m sure your &quot;linuxfromscratch&quot; link will come in really handy for me.....</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p337344">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">dl12345</div>
					<div class="post-datetime">
						6 Sep 2016, 12:00					</div>
				</div>
				<div class="post-content content">
					<p>For anyone searching for information on this topic, the correct answer is is YES, you can add a new target via a feed.</p><p>The perl script &quot;scripts/feeds&quot; has a fair amount of code to allow for the adding of targets via a feed (hence the creation of the metadata referred to above), although it seems to be sensitive to existing metadata. If experiencing trouble with the addition of a new target, it&#039;s a good idea to uninstall all feeds first and clear the metadata contents of the openwrt tmp folder as follows...</p><div class="codebox"><pre><code>[openwrt@openwrt-host openwrt]$ scripts/feeds uninstall -a
[openwrt@openwrt-host openwrt]$ rm -fr tmp/*</code></pre></div><p>Once I did this I was able to install my target successfully using</p><div class="codebox"><pre><code>[openwrt@openwrt-host openwrt]$ scripts/feeds update &lt;feedname&gt;
[openwrt@openwrt-host openwrt]$ scripts/feeds install -p &lt;feedname&gt; -f &lt;targetname&gt;</code></pre></div><p>The target name then shows up in menuconfig after the feeds script creates a link in target/linux to the feeds folder containing the target definition. Targets in a feed will be prefixed with the word &quot;TARGET: &quot; when issuing a &quot;list&quot; command on the feed</p><div class="codebox"><pre><code>[openwrt@openwrt-host openwrt]$ scripts/feeds list -r &lt;feedname&gt;
TARGET: &lt;name&gt;                                        Target description</code></pre></div><p><a href="https://forum.openwrt.org/profile.php?id=137003">@elektroman</a> - suggest you go back to your linuxfromscratch and that you confine your forum comments to subjects that you actually know something about. In this case, you were not only wrong, but you also managed to be both patronising and offensive.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>