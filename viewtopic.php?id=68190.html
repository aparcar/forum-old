<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> [HELP] OpenVpn configuration</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 21 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p341787">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">vital21</div>
					<div class="post-datetime">
						22 Oct 2016, 13:30					</div>
				</div>
				<div class="post-content content">
					<p>Hi there,</p><p>I&#039;ve recently got a new hardware - ASUS RT-N66U running Chaos Calmer 15.05.1</p><p>I&#039;m not a pro in Networking and Routing, and after reading tons of guides, I&#039;m totally confused.</p><p>Thats why Im here, asking you for help. I will appreciate any piece of advice!</p><p>So, my current setup looks like:</p><br /><br /><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <strong>------------ISP------------</strong></p><p><strong>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</strong></p><p><strong>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;=========ASUS RT-N66U-=====</strong></p><p><strong>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</strong></p><p><strong>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; OpenVpn Client (default setup, which route all traffic)&nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</strong></p><p><strong>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TPLINK (for WiFi)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; client1(eth)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; client2(eth)</strong></p><p><strong>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;clients ( 3,4...)</strong></p><br /><br /><br /><br /><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br /><strong>Question#1: &quot;How could I setup target routing?&quot;</strong>&nbsp; <em> (for example: client1 to VPN, client2 to ISP )</em></p><p>unfortunately I need to say that I&#039;m totally noob in iptables...and i cant find any Openvpn GUI for Chaos Calmer...</p><p><strong>Question#2:&nbsp; &quot;How could I setup the SSH tunnel for specific client?&quot;</strong>&nbsp; &nbsp; <em>(something like Openssh&gt;&gt;socks&gt;&gt;route client to socks&gt;&gt;client appears at SSH server network&gt;&gt;&gt; profit )</em></p><br /><p>I really hope for your help, community!</p><p>My configs:</p><p>network<br /></p><div class="codebox"><pre><code>config switch &#039;eth0&#039;
        option name &#039;eth0&#039;
        option reset &#039;1&#039;
        option enable_vlan &#039;1&#039;

config switch_vlan
        option device &#039;eth0&#039;
        option vlan &#039;1&#039;
        option ports &#039;1 2 3 4 8t&#039;

config switch_vlan
        option device &#039;eth0&#039;
        option vlan &#039;2&#039;
        option ports &#039;0 8t&#039;

config interface &#039;loopback&#039;
        option ifname &#039;lo&#039;
        option proto &#039;static&#039;
        option ipaddr &#039;127.0.0.1&#039;
        option netmask &#039;255.0.0.0&#039;

config interface &#039;lan&#039;
        option force_link &#039;1&#039;
        option proto &#039;static&#039;
        option netmask &#039;255.255.255.0&#039;
        option ifname &#039;eth0.1&#039;
        option ipaddr &#039;192.168.21.1&#039;
        option delegate &#039;0&#039;
        option dns &#039;4.2.2.1 8.0.31.0&#039;

config interface &#039;wan&#039;
        option ifname &#039;eth0.2&#039;
        option proto &#039;pppoe&#039;
        option username &#039;XXXXXXXX&#039;
        option password &#039;XXXXXXXX&#039;
        option delegate &#039;0&#039;

config interface &#039;vpn0&#039;
        option ifname &#039;tun0&#039;
        option proto &#039;none&#039;
        option delegate &#039;0&#039;
        option auto &#039;1&#039;</code></pre></div><p>firewall<br /></p><div class="codebox"><pre><code>config defaults
        option syn_flood &#039;1&#039;
        option input &#039;ACCEPT&#039;
        option output &#039;ACCEPT&#039;
        option forward &#039;REJECT&#039;

config zone
        option name &#039;lan&#039;
        option input &#039;ACCEPT&#039;
        option output &#039;ACCEPT&#039;
        option network &#039;lan&#039;
        option forward &#039;REJECT&#039;

config zone
        option name &#039;wan&#039;
        option input &#039;REJECT&#039;
        option output &#039;ACCEPT&#039;
        option forward &#039;REJECT&#039;
        option masq &#039;1&#039;
        option mtu_fix &#039;1&#039;
        option network &#039;wan wan6 wwan&#039;

config rule
        option name &#039;Allow-DHCP-Renew&#039;
        option src &#039;wan&#039;
        option proto &#039;udp&#039;
        option dest_port &#039;68&#039;
        option target &#039;ACCEPT&#039;
        option family &#039;ipv4&#039;

config rule
        option name &#039;Allow-Ping&#039;
        option src &#039;wan&#039;
        option proto &#039;icmp&#039;
        option icmp_type &#039;echo-request&#039;
        option family &#039;ipv4&#039;
        option target &#039;ACCEPT&#039;

config rule
        option name &#039;Allow-IGMP&#039;
        option src &#039;wan&#039;
        option proto &#039;igmp&#039;
        option family &#039;ipv4&#039;
        option target &#039;ACCEPT&#039;

config include
        option path &#039;/etc/firewall.user&#039;

config rule
        option src &#039;wan&#039;
        option dest &#039;lan&#039;
        option proto &#039;esp&#039;
        option target &#039;ACCEPT&#039;

config rule
        option src &#039;wan&#039;
        option dest &#039;lan&#039;
        option dest_port &#039;500&#039;
        option proto &#039;udp&#039;
        option target &#039;ACCEPT&#039;

config forwarding
        option dest &#039;wan&#039;
        option src &#039;lan&#039;

config zone
        option input &#039;ACCEPT&#039;
        option output &#039;ACCEPT&#039;
        option forward &#039;ACCEPT&#039;
        option masq &#039;1&#039;
        option network &#039;vpn0&#039;
        option name &#039;openvpn&#039;

config forwarding
        option dest &#039;lan&#039;
        option src &#039;openvpn&#039;

config forwarding
        option dest &#039;openvpn&#039;
        option src &#039;lan&#039;</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p341805">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">mikma</div>
					<div class="post-datetime">
						22 Oct 2016, 17:53					</div>
				</div>
				<div class="post-content content">
					<p>#1: Using multiple wan links isn&#039;t trivial (VPN+ISP). Have a look at the mwan3 package (multi-wan policy routing).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p341819">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">bolvan</div>
					<div class="post-datetime">
						22 Oct 2016, 19:44					</div>
				</div>
				<div class="post-content content">
					<p>Q1: Either use multiwan package or configure your own policy routing (requires knowledge of iptables, multiple routing tables and ip rules). Policy routing can be configured in /etc/config/network, no need in explicit iptables commands.<br />Q2: Thread how to use ssh as vpn : <a href="https://forum.openwrt.org/viewtopic.php?id=67632">https://forum.openwrt.org/viewtopic.php?id=67632</a></p>											<p class="post-edited">(Last edited by <strong>bolvan</strong> on 22 Oct 2016, 19:50)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>