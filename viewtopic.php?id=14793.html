<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Locked-out after editing /etc/passwd (can&#039;t get into failsafe either)</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 9 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p64702">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">johnsmithdoe</div>
					<div class="post-datetime">
						6 Mar 2008, 16:24					</div>
				</div>
				<div class="post-content content">
					<p>Hello guys,</p><p>so I installed bash, and manually edited /etc/passwd to replace /bin/ash with /bin/bash, and, like an idiot, without testing with a new connection, hastily logged out and tried to log back in, and now dropbear won&#039;t let me back in, saying: &quot;Permission denied, please try again.&quot; sigh... :-(</p><p>I tried getting into failsafe just as suggested here: <a href="http://wiki.openwrt.org/OpenWrtDocs/Troubleshooting">http://wiki.openwrt.org/OpenWrtDocs/Troubleshooting</a> , but the reset button does not seem to have any effect. What else can I do to get back control of this box?</p><p>This is WRT54G v2 with Kamikaze 7.09</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p64706">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">TheCompWiz</div>
					<div class="post-datetime">
						6 Mar 2008, 16:43					</div>
				</div>
				<div class="post-content content">
					<p>no clue how you installed bash... but that aside... there&#039;s 2 possible problems you&#039;re running into.</p><p>#1 bash wasn&#039;t installed correctly and you&#039;re unable to get a shell to start.&nbsp; (could be anything.. missing libraries... incorrect file locations..&nbsp; incorrect file permissions)<br />#2 you skrewed something else in the passwd file...</p><p>Easiest fix... reflash.</p><p>semi-harder fix... not sure if scp will work... but get a passwd file that is correct... and scp it over to the wrt... and overwrite the existing one.&nbsp; I honestly don&#039;t remember if an scp session will start bash or not.</p>											<p class="post-edited">(Last edited by <strong>TheCompWiz</strong> on 6 Mar 2008, 16:47)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p64707">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">forum2008</div>
					<div class="post-datetime">
						6 Mar 2008, 16:47					</div>
				</div>
				<div class="post-content content">
					<p>Or enter <strong>failsafe mode</strong> and copy the passwd file from /rom/etc/passwd to /etc/passwd.</p><p>Another option is to reset all your changes you have made after reflashing. Do this by entering into failsafe mode and clean the JFFS2 partition with &#039;mtd -r erase rootfs_data&#039;.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p64711">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">Tex-Twil</div>
					<div class="post-datetime">
						6 Mar 2008, 17:34					</div>
				</div>
				<div class="post-content content">
					<p>Hi,<br />It&#039;s funny &#039;cos I did exactly the same &quot;mistake&quot; once. There is another possibility if you have webifÂ² installed. There is a web file editor in web if <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /> Hope it helps </p><p>cheers,<br />Tex</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p64727">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">johnsmithdoe</div>
					<div class="post-datetime">
						6 Mar 2008, 23:33					</div>
				</div>
				<div class="post-content content">
					<p>OK, problem solved! Apparently when they say IMMEDIATELY press the button, and for exactly 2 secs - they aren&#039;t kidding!!! :-)</p><p>I kept twiddling with the damn reset button until I finally got the timing right and lo and and behold - failsafe appeared! :-)</p><p>Thanks for your suggestions guys!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p64728">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">johnsmithdoe</div>
					<div class="post-datetime">
						6 Mar 2008, 23:45					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>TheCompWiz wrote:</cite><blockquote><p>no clue how you installed bash...</p></blockquote></div><p>fairly easy:<br /></p><div class="codebox"><pre><code>ipkg install bash</code></pre></div><p>:-)</p><div class="quotebox"><blockquote><p>#1 bash wasn&#039;t installed correctly and you&#039;re unable to get a shell to start.&nbsp; (could be anything.. missing libraries... incorrect file locations..&nbsp; incorrect file permissions)</p></blockquote></div><p>IDK, it starts and works just fine when I call it from ash... :-/</p><div class="quotebox"><blockquote><p>#2 you skrewed something else in the passwd file...</p></blockquote></div><p>The only thing I changed was added letter &quot;b&quot; in front of &quot;ash&quot;, so IDK... :-/</p><div class="quotebox"><blockquote><p>Easiest fix... reflash.</p></blockquote></div><p>Apparently my problem was inability to time the DMZ light accurately enough :-)</p><div class="quotebox"><blockquote><p>semi-harder fix... not sure if scp will work... but get a passwd file that is correct... and scp it over to the wrt... and overwrite the existing one.&nbsp; I honestly don&#039;t remember if an scp session will start bash or not.</p></blockquote></div><p>scp gave the same error as ssh</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p64729">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">johnsmithdoe</div>
					<div class="post-datetime">
						6 Mar 2008, 23:51					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>forum2008 wrote:</cite><blockquote><p>Or enter <strong>failsafe mode</strong> and copy the passwd file from /rom/etc/passwd to /etc/passwd.</p></blockquote></div><p>when I finally did get into failsafe I had to mount_root and then edit /jffs2/etc/passwd and take out that &quot;b&quot; in front &quot;ash&quot;</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p64730">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">johnsmithdoe</div>
					<div class="post-datetime">
						6 Mar 2008, 23:55					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Tex-Twil wrote:</cite><blockquote><p>Hi, It&#039;s funny &#039;cos I did exactly the same &quot;mistake&quot; once. There is another possibility if you have webifÂ² installed. There is a web file editor in web if <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /> Hope it helps</p></blockquote></div><p>No, no webif here, I don&#039;t think its available for Kamikaze yet... :-/<br />SSH is the only way in, but I finally got into failsafe, so its all cool now :-)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p64829">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">lcstyle</div>
					<div class="post-datetime">
						9 Mar 2008, 06:56					</div>
				</div>
				<div class="post-content content">
					<p>I did exactly the same thing, i followed the wl700g.homelinux.net install instructions so i had already installed the webif interface which allowed me to modify the passwd file and remove that pesky little b from in front of &quot;ash&quot;.&nbsp; Ironically enough, i DIDNT see that message at the bottom that said apply changes, so i went in and tried to login again and of course I couldnt.&nbsp; I finally resulted to just using the webif editor to DELETE BASH completely from /bin/ thinking that maybe the system would automagically default to /bin/ash ? or maybe just /bin/sh??? Well, i did delete it, and THEN did i realize that i could hit apply to save my changes, luckily, so i was able to log back in with SH. I am currently investigating why i added another user and cannot start /bin/bash by logging into that users account.<br />Be back in a bit.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p64830">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">lcstyle</div>
					<div class="post-datetime">
						9 Mar 2008, 06:57					</div>
				</div>
				<div class="post-content content">
					<p>So i just rebooted the router after having added /bin/bash to /etc/shells and additionally adding my new user to the /etc/groups file, i doubt any of those changes really made it work, i think I just need to reboot?</p><p>Still not sure what made it work.</p><p>Good luck! and remember always add another USER first <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /><br />gosh im lucky.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p64836">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">Wodin</div>
					<div class="post-datetime">
						9 Mar 2008, 12:24					</div>
				</div>
				<div class="post-content content">
					<p>Probably was the /etc/shells thing. All valid login shells are supposed to be in there on a normal unix system. Not sure about openwrt though. Strange that the bash package did not cause bash to be added automatically.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p64870">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">johnsmithdoe</div>
					<div class="post-datetime">
						10 Mar 2008, 01:18					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Wodin wrote:</cite><blockquote><p>Probably was the /etc/shells thing. All valid login shells are supposed to be in there on a normal unix system. Not sure about openwrt though.</p></blockquote></div><p>Ah ha! Words of of wisdom these are indeed! :-)</p><p>I just added a new user (what I should&#039;ve done in the first place...), added /bin/bash to /etc/bash, and now it works as the new user&#039;s login shell!</p><div class="quotebox"><blockquote><p>Strange that the bash package did not cause bash to be added automatically.</p></blockquote></div><p>Yeah... this is something I&#039;ve come to expect from a package manager (after some years with Debian), perhaps I should file a bug report about this?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p64887">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">Tex-Twil</div>
					<div class="post-datetime">
						10 Mar 2008, 09:22					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>johnsmithdoe wrote:</cite><blockquote><p>No, no webif here, I don&#039;t think its available for Kamikaze yet... :-/<br />SSH is the only way in, but I finally got into failsafe, so its all cool now :-)</p></blockquote></div><p>webifÂ² is available for Kamikaze.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>