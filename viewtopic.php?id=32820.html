<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Segfault/Illegal Instruction Executing Binaries from extern SD Card</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 30 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p147763">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">firemelon</div>
					<div class="post-datetime">
						6 Nov 2011, 18:44					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>openwrt has all the drivers that&#039;s needed for a mikrotik rb450g. awesome work.</p><p>Now I am putting the rootfs onto a microsd card in my rb450g. </p><p>I have already built the fs on the microsd and the kernel successfully boots from the nand in the board. (edited drivers/mtd/nand/rb4xx_nand.c to change parition size.) microsd mounts successfully as rootfs but init won&#039;t start and kernel panics.</p><p>It seems I am encountering the same issue as &quot;Packages on external media problem (DSL-G684T, maybe others)&quot; &lt;<a href="https://forum.openwrt.org/viewtopic.php?pid=127838">https://forum.openwrt.org/viewtopic.php?pid=127838</a>&gt;. It&#039;s an old thread and got highjacked so I am starting a new thread.</p><p>experiments and symptoms: boot into nfs root (which ran fine) and do this....<br />- mount microsd and repeatedly execute static binary that lives on the microsd: segfault/illegal instruction a few times then binary ran ok. subsequent runs all ok.<br />- umount and mount again: same thing happens - segfault/sigill a few times then run fine everytime after.<br />- umount and mount again, then md5sum entire static binary, then run: ok from first run</p><p>After the first static binary runs ok, running other static binaries also result in same segfault/illegal instruction symptoms.</p><p>This leads me to suspect that the kernel starts executing the binary before it finished loading the file off the microsd. md5sum reads the entire file and kernel caches it so the file is fully in mem if md5sum ran first.</p><p>Does anyone know the resolution to this? Kernel configs, patches?</p><p>The above is tested with openwrt trunk r28677. 2.6.39.4 and the binary is actually statically compiled busybox. rb450g&#039;s mmc interface is via spi. nand is also via spi, and putting the same rootfs on the nand as the microsd everything run ok.</p><p>Any help is appreciated. If you need me to do more experiments please let me know. Thank you.</p><p>/Leon</p><p>EDITED: Added fact that nand also is via spi, so shouldn&#039;t be spi&#039;s fault.</p>											<p class="post-edited">(Last edited by <strong>firemelon</strong> on 6 Nov 2011, 18:48)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>