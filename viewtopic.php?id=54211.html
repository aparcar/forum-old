<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Marvel Armada370: no Wireless iface or config at all</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 30 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p255490">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">selportion</div>
					<div class="post-datetime">
						25 Nov 2014, 12:33					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>I have an &quot;Marvel Armada 370 development board&quot; and I am using the firmware version &quot;OpenWrt Chaos Calmer r43101 / LuCI Trunk (git-14.299.62422-2826426)&quot;.<br />I am booting over the network, with the &quot;openwrt-mvebu-uImage-initramfs-armada-370-db&quot; image using NFS &quot;openwrt-mvebu-Evalboards-rootfs.tar.gz&quot;.</p><p>I am able to boot fine, bridge traffic between the two ethernet interfaces, but <strong>I cannot see any wireless interface or configuration. </strong><br />I connect a miniPCIe wireless card in the corresponding slot of the board and I want to configure it.<br />There is no /etc/config/wireless file at all, the command &#039;wifi up&#039; does not return any output and I see no wireless interface or options in LuCI.<br />However, there I verify the following packages installed:<br /></p><div class="codebox"><pre><code>Package name     Version
Remove     base-files     156-r43101
Remove     busybox     1.22.1-3
Remove     dnsmasq     2.72-1
Remove     dropbear     2014.65-2
Remove     firewall     2014-09-19
Remove     fstools     2014-10-27-d71297353dc45eaf8f7c252246490746708530f9
Remove     hostapd-common     2014-10-25-1
Remove     ip6tables     1.4.21-1
Remove     iptables     1.4.21-1
Remove     iw     3.15-1
Remove     jshn     2014-10-14-464e05e33b4c086be0bd932760a41ddcf9373187
Remove     jsonfilter     2014-06-19-cdc760c58077f44fc40adbbe41e1556a67c1b9a9
Remove     kernel     3.14.18-1-f17ea3412acb50fc3007ba6f8fde952a
Remove     kmod-ata-core     3.14.18-1
Remove     kmod-ata-marvell-sata     3.14.18-1
Remove     kmod-ath     3.14.18+2014-10-08-1
&gt;&gt;Remove     kmod-ath10k     3.14.18+2014-10-08-1
&gt;&gt;Remove     kmod-ath9k     3.14.18+2014-10-08-1
&gt;&gt;Remove     kmod-ath9k-common     3.14.18+2014-10-08-1
Remove     kmod-bridge     3.14.18-1
Remove     kmod-cfg80211     3.14.18+2014-10-08-1
Remove     kmod-crypto-aes     3.14.18-1
Remove     kmod-crypto-arc4     3.14.18-1
Remove     kmod-crypto-core     3.14.18-1
Remove     kmod-dnsresolver     3.14.18-1
Remove     kmod-fs-nfs     3.14.18-1
Remove     kmod-fs-nfs-common     3.14.18-1
Remove     kmod-fs-ntfs     3.14.18-1
Remove     kmod-fuse     3.14.18-1
Remove     kmod-gpio-button-hotplug     3.14.18-1
Remove     kmod-hwmon-core     3.14.18-1
Remove     kmod-hwmon-gpiofan     3.14.18-1
Remove     kmod-hwmon-tmp421     3.14.18-1
Remove     kmod-i2c-core     3.14.18-1
Remove     kmod-i2c-mv64xxx     3.14.18-1
Remove     kmod-ip6tables     3.14.18-1
Remove     kmod-ipt-conntrack     3.14.18-1
Remove     kmod-ipt-core     3.14.18-1
Remove     kmod-ipt-nat     3.14.18-1
Remove     kmod-ipv6     3.14.18-1
Remove     kmod-leds-tlc59116     3.14.18-1
Remove     kmod-ledtrig-usbdev     3.14.18-1
Remove     kmod-lib-crc-ccitt     3.14.18-1
Remove     kmod-lib80211     3.14.18+2014-10-08-1
Remove     kmod-llc     3.14.18-1
&gt;&gt;Remove     kmod-mac80211     3.14.18+2014-10-08-1
Remove     kmod-nand     3.14.18-1
Remove     kmod-nf-conntrack     3.14.18-1
Remove     kmod-nf-conntrack6     3.14.18-1
Remove     kmod-nf-ipt     3.14.18-1
Remove     kmod-nf-ipt6     3.14.18-1
Remove     kmod-nf-nat     3.14.18-1
Remove     kmod-nf-nathelper     3.14.18-1
Remove     kmod-nls-base     3.14.18-1
Remove     kmod-ppp     3.14.18-1
Remove     kmod-pppoe     3.14.18-1
Remove     kmod-pppox     3.14.18-1
Remove     kmod-rtc-marvell     3.14.18-1
&gt;&gt;Remove     kmod-rtl8192c-common     3.14.18+2014-10-08-1
&gt;&gt;Remove     kmod-rtl8192ce     3.14.18+2014-10-08-1
&gt;&gt;Remove     kmod-rtl8192cu     3.14.18+2014-10-08-1
&gt;&gt;Remove     kmod-rtl8192de     3.14.18+2014-10-08-1
&gt;&gt;Remove     kmod-rtl8192se     3.14.18+2014-10-08-1
&gt;&gt;Remove     kmod-rtlwifi     3.14.18+2014-10-08-1
Remove     kmod-rtlwifi-pci     3.14.18+2014-10-08-1
Remove     kmod-rtlwifi-usb     3.14.18+2014-10-08-1
Remove     kmod-scsi-core     3.14.18-1
Remove     kmod-slhc     3.14.18-1
Remove     kmod-stp     3.14.18-1
Remove     kmod-thermal     3.14.18-1
Remove     kmod-thermal-armada     3.14.18-1
Remove     kmod-usb-core     3.14.18-1
Remove     kmod-usb-storage     3.14.18-1
Remove     kmod-usb2     3.14.18-1
Remove     kmod-usb3     3.14.18-1
Remove     libblobmsg-json     2014-10-14-464e05e33b4c086be0bd932760a41ddcf9373187
Remove     libc     0.9.33.2-1
Remove     libgcc     4.8-linaro-1
Remove     libip4tc     1.4.21-1
Remove     libip6tc     1.4.21-1
Remove     libiwinfo     2014-10-27.1-d5dc3d0605f76fbbbad005d998497e53a236aeda
Remove     libiwinfo-lua     2014-10-27.1-d5dc3d0605f76fbbbad005d998497e53a236aeda
Remove     libjson-c     0.11-2
Remove     libjson-script     2014-10-14-464e05e33b4c086be0bd932760a41ddcf9373187
Remove     liblua     5.1.5-1
Remove     libnetsnmp     5.4.4-1
Remove     libnl-tiny     0.1-3
Remove     libpolarssl     1.3.8-2
Remove     libpthread     0.9.33.2-1
Remove     libubox     2014-10-14-464e05e33b4c086be0bd932760a41ddcf9373187
Remove     libubus     2014-09-17-4c4f35cf2230d70b9ddd87638ca911e8a563f2f3
Remove     libubus-lua     2014-09-17-4c4f35cf2230d70b9ddd87638ca911e8a563f2f3
Remove     libuci     2014-04-11.1-1
Remove     libuci-lua     2014-04-11.1-1
Remove     libustream-polarssl     2014-03-25-fc0b5ec804ee43c532978dd04ab0509c34baefb0
Remove     libxtables     1.4.21-1
Remove     lua     5.1.5-1
Remove     luci     git-14.299.62422-2826426-1
Remove     luci-app-commands     git-14.299.62422-2826426-1
Remove     luci-app-firewall     git-14.299.62422-2826426-1
Remove     luci-base     git-14.299.62422-2826426-1
Remove     luci-i18n-english     git-14.299.62422-2826426-1
Remove     luci-lib-nixio     git-14.299.62422-2826426-1
Remove     luci-mod-admin-full     git-14.299.62422-2826426-1
Remove     luci-proto-ppp     git-14.299.62422-2826426-1
Remove     luci-ssl     git-14.299.62422-2826426-1
Remove     luci-theme-bootstrap     git-14.299.62422-2826426-1
Remove     mtd     20
Remove     netifd     2014-10-24-b46a8f3b9794efed197ffd2f6f62eb946de5f235
Remove     ntfs-3g     2014.2.15-1-fuseint
Remove     odhcp6c     2014-10-25-940e2141ab13727af6323c4d30002f785e466318
Remove     odhcpd     2014-10-18-b461334ab277b6e8fd1622ab7c8a655363bd3f6c
Remove     opkg     9c97d5ecd795709c8584e972bfdf3aee3a5b846d-7
Remove     ppp     2.4.7-3
Remove     ppp-mod-pppoe     2.4.7-3
Remove     procd     2014-10-14-b9a389c841db8433bb3b02158b1512cf577dbff7
Remove     procd-nand     2014-10-14-b9a389c841db8433bb3b02158b1512cf577dbff7
Remove     px5g     1
Remove     snmp-utils     5.4.4-1
Remove     snmpd     5.4.4-1
Remove     snmpd-static     5.4.4-1
Remove     ubi-utils     1.5.1-2
Remove     uboot-envtools     2014.07-1
Remove     ubox     2014-10-06-0b274c16a3f9d235735a4b84215071e1e004caa9
Remove     ubus     2014-09-17-4c4f35cf2230d70b9ddd87638ca911e8a563f2f3
Remove     ubusd     2014-09-17-4c4f35cf2230d70b9ddd87638ca911e8a563f2f3
Remove     uci     2014-04-11.1-1
Remove     uhttpd     2014-10-27-fd8e5e379c23c5fbcec3e76894b839233df09067
Remove     uhttpd-mod-ubus     2014-10-27-fd8e5e379c23c5fbcec3e76894b839233df09067
&gt;&gt;Remove     wireless-tools     29-5
&gt;&gt;Remove     wpad-mini     2014-10-25- </code></pre></div><p>Any ideas on how I could install/enable it? Can I just create it manually?</p>											<p class="post-edited">(Last edited by <strong>selportion</strong> on 25 Nov 2014, 12:35)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p256111">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">selportion</div>
					<div class="post-datetime">
						1 Dec 2014, 10:39					</div>
				</div>
				<div class="post-content content">
					<p>While further debugging I see that no PCIe card is recognized on the board..</p><p>1) The card slot pins on board are properly powered</p><p>2) Plugging any card does not give any different message on boot<br />dmesg | grep pci<br />[&nbsp; &nbsp; 0.204549] mvebu-pcie pcie-controller.2: PCI host bridge to bus 0000:00<br />[&nbsp; &nbsp; 0.204567] pci_bus 0000:00: root bus resource [io&nbsp; 0x1000-0xfffff]<br />[&nbsp; &nbsp; 0.204576] pci_bus 0000:00: root bus resource [mem 0xe0000000-0xe8000000]<br />[&nbsp; &nbsp; 0.204587] pci_bus 0000:00: root bus resource [bus 00-ff]<br />[&nbsp; &nbsp; 0.204616] pci 0000:00:01.0: [11ab:6710] type 01 class 0x060400<br />[&nbsp; &nbsp; 0.204867] pci 0000:00:02.0: [11ab:6710] type 01 class 0x060400<br />[&nbsp; &nbsp; 0.205109] pci 0000:00:01.0: bridge configuration invalid ([bus 00-00]), reconfiguring<br />[&nbsp; &nbsp; 0.205120] pci 0000:00:02.0: bridge configuration invalid ([bus 00-00]), reconfiguring<br />[&nbsp; &nbsp; 0.205322] pci_bus 0000:01: busn_res: [bus 01-ff] end is updated to 01<br />[&nbsp; &nbsp; 0.205528] pci_bus 0000:02: busn_res: [bus 02-ff] end is updated to 02<br />[&nbsp; &nbsp; 0.205560] pci 0000:00:01.0: PCI bridge to [bus 01]<br />[&nbsp; &nbsp; 0.205575] pci 0000:00:02.0: PCI bridge to [bus 02]</p><p>3) The lspci command is not recognized. Could I have it installed in menuconfig?</p><p>Could it be that the /etc/config/wireless file is not generated at all for that reason?<br />Is that problem driver related or HW fault?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p257172">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">selportion</div>
					<div class="post-datetime">
						10 Dec 2014, 10:06					</div>
				</div>
				<div class="post-content content">
					<p>Partial solution:<br />1)2) <strong> Openwrt linux kernel does not support the pci interface for Marvel Armada 370 </strong>. Using external newer kernel fixes that issue.<br />3) This command is part of pci utils and can be installed any time.</p><p>Current status:<br />There is still no wireless configuration and &quot;wifi detect &gt; /etc/config/wireless&quot; produces only an empty file.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p257234">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">selportion</div>
					<div class="post-datetime">
						10 Dec 2014, 18:11					</div>
				</div>
				<div class="post-content content">
					<p>This must be because the kernel was pre-compiled and it did not have perhaps the drivers for the connected PCIe modules. I see that /proc/modules is empty and lsmod returns nothing.</p><p>I like how this thread is like my diary. At least maybe someone else will get here by searching and find sth useful..</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p257852">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">selportion</div>
					<div class="post-datetime">
						16 Dec 2014, 09:01					</div>
				</div>
				<div class="post-content content">
					<p>Yes. Compiling a newer kernel with the appropriate wireless drivers worked. Lsmod still returns nothing and /proc/modules is empty but &quot;wifi detect &gt; /etc/config/wireless&quot; created a proper configuration file and I can connect wirelessly.<br />Conclusion: The current OpenWRT kernel needs some patches from the main Linux line to support the PCIe interface of Marvel Armada</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p259555">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">lharmon</div>
					<div class="post-datetime">
						2 Jan 2015, 17:36					</div>
				</div>
				<div class="post-content content">
					<p>I have been using an Armada-370 with an 88w8764 wi-fi module running ArchlinuxARM.<br />Archlinux has many great features, but it is not ideal as a router distribution.</p><p>I had looked into openwrt a while back, but didn&#039;t have the time to spend on it.<br />Glad to see someone is working on it. <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>P.S. I had also communicated with Luka Perkov &lt;luka.perkov@sartura.hr&gt; , another openWrt member, about the Armada 370.</p><p>Hope you will continue to post any news you have on your project</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>