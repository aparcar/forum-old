<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> How to set &quot;MTU&quot;</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 4 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p276175">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">nicky9499</div>
					<div class="post-datetime">
						13 May 2015, 15:52					</div>
				</div>
				<div class="post-content content">
					<p>Dear all,</p><p>I am trying several things in an attempt to fix connection quality for one of my online games. In their not-so-helpful documentation, it is suggested I set my MTU to 1473. That&#039;s all.</p><p>I don&#039;t know what&#039;s an MTU and after 15 minutes of clicking all over the control panel, I don&#039;t know where it is either.</p><p>Can some helpful soul advise where I can find such a setting please? Thank you.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p276177">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">tapper</div>
					<div class="post-datetime">
						13 May 2015, 16:51					</div>
				</div>
				<div class="post-content content">
					<p>Hi standard is 1500. <br />Here is how to test.<br /><a href="https://www.dslreports.com/faq/5793">https://www.dslreports.com/faq/5793</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p276178">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">tapper</div>
					<div class="post-datetime">
						13 May 2015, 16:54					</div>
				</div>
				<div class="post-content content">
					<p>Here&#039;s some more Connection Diagnostics.<br /><a href="http://www.speedguide.net:8080/">http://www.speedguide.net:8080/</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p276187">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">nicky9499</div>
					<div class="post-datetime">
						13 May 2015, 18:35					</div>
				</div>
				<div class="post-content content">
					<p>Questions.</p><p>&quot;Additionally, if you have a network with more than one computer, all NICs and router(s) should have the the same MTU setting.&quot;</p><p>Why?</p><p>And how do I change the MTU on my Netgear WNDR3700v2 router running OpenWRT (which was kind of my original question)?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p276196">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">tapper</div>
					<div class="post-datetime">
						13 May 2015, 20:45					</div>
				</div>
				<div class="post-content content">
					<p>Hi i dont no how to change the MTU size in OpenWrt sorry.</p><p><a href="https://support.microsoft.com/en-us/kb/314496">https://support.microsoft.com/en-us/kb/314496</a></p><p>In simple terms, when you send information from one place on the internet (e.g. a web server) to another (e.g. your computer) the data is broken up in<br />to packets. The sender breaks the overall data in to small chunks, and sends them over the internet. The internet only handles packets. The packets arrive<br />at the other end, and they are put back together to make the whole of the original data. This could be a web page, email, image, or whatever. If a packet<br />gets dropped, the sender works this out and resends it. That way you don&#039;t get gaps in what you receive. The process is managed by a protocol called TCP<br />(Transmission Control Protocol). The packets get to the other by a protocol called IP (Internet Protocol). There are other protocols that work over the<br />internet but they all come down to sending packets.</p><p>How big is a packet?</p><p>The simple answer is 1,500 bytes. But it is more complex. The internet is actually a combination of routers and links. Each router has links to other routers.<br />Your packets go from one place to another by being passed along from one router to another over these links.</p><p>One of the main types of link is Ethernet which is used for Local Area Networks (LAN). You have probably encountered a LAN as they are used in offices<br />and homes, and connect things together. You probably use Ethernet to connect your broadband router to your computers in your house. Ethernet allows 1,500<br />byte packets to be carried. Internet providers use much faster links such as gigabit and 10 gigabit and these often allow bigger packets up to around 9,000<br />bytes. Some links on the internet are set up specially for certain traffic and have links that support packet sizes like 1,548 bytes.</p><p>The links, like Ethernet, limit the size of packets that can be sent. The size of packet that can get from one place to another without any difficulties<br />depends on the smallest link in the chain. On the internet as a whole this is generally 1,500 bytes. But this depends where the packet goes and what links<br />are used. The smallest link allowed is 576 bytes which used to be common for modems on dialup-internet.</p><p>The maximum size of packet you can send on a link is called the MTU (Maximum Transmission Unit). The maximum size you can receive is the MRU (Maximum Receive<br />Unit). The terms MRU and MTU often get used interchangeably for obvious reasons.</p><p>What happens if a packet is too big?</p><p>Consider a packet being sent that is 1,500 bytes. It is passed from router to router until one that has a link which is less than 1,500 bytes. This creates<br />a problem as it cannot send the packet on to the next router via that link. There are two options:-</p><p>list of 2 items<br />◦ (A) Don&#039;t send the packet and send an error message back saying it could not be sent<br />◦ (B) Break the packet up in to smaller bits (called fragments) which will fit, and send these on to the next router.<br />list end</p><p>The choice depends on the packet. For IPv6 packets you have to take option (A) and send an error. For IPv4 packets the packet has a flag called DF (Don&#039;t<br />Fragment). If that is set you have to take option (A) and send an error. If not, then you take option (B) and fragment the packet.</p><p>If an error is sent back then the sending computer can try again sending smaller packets this time. If the packet is broken in to fragments then they still<br />arrive at the destination and can be put back together by the receiving end. Either way the data gets through.</p><p>Is there another option?</p><p>In most cases links support 1,500 bytes, so there is not problem. However, where we know there is a specific issue there is another option, an option (C).<br />It is a bit of a bodge, but works. We have added this as a user-settable feature on the line so you can contol if you want us to work-around the issue<br />or not. This is mainly for where the link from us to you is restricted, typically to 1,492 bytes, for PPPoE.</p><p>It works by exploiting the fact that at the start of a TCP session each end tells the other the MTU it can handle (actually the MSS which is the TCP payload<br />but one is derived from the other). When we have have the fix enabled we check the initial TCP handshake packets and we change them if the MSS specified<br />would be too big. This means each end may say they handle 1,500 bytes, but the other hears that they handle, say, 1,492 bytes.</p><p>When do you get small links?</p><p>The internet as a whole generally works with 1,500 byte packets with no problem, but there are cases where smaller MTU links are used.</p><p>One is a VPN (Virtual Private Network). These create links that connect computers (routers) virtually. The link is not real but involves taking packets<br />and wrapping them up in another packet which is sent over the internet to the other end where it is unwrapped. Much like putting a letter in an envelope<br />and then putting it in another envelope - you need a bigger envelope on the outside. This means that if the outside envelope has to fit in 1,500 bytes,<br />the inner one can&#039;t be as big, and that makes a link with a small MTU.</p><p>The other main example is dialup and broadband links. In practice a broadband link works much like a dialup line as it uses a protocol called PPP (Point<br />to Point Protocol). Part of this is each end telling the other its MRU. I.e. how big a packet it can receive. There are a number of reasons a router might<br />decide to say it cannot handle the full 1,500 bytes:-</p><p>list of 6 items<br />◦ The router could be using PPPoE (PPP over Ethernet) bridging which requires an extra 8 byte header for PPP and then sends the packet over 1,500 byte<br />Ethernet, so the packets sent in the PPP layer can be at most 1,492 bytes.<br />◦ Some part of the link could require the use of a smaller MTU, typically because PPPoE is being used within a back-haul network (e.g. Be lines), so the<br />router has to be set to use 1,492.<br />◦ The router could simply have a default of 1,492 as PPPoE is common in many countries as the standard way to connect broadband lines. In the UK we usually<br />use PPPoA (PPP over ATM) which allows the full 1,500 bytes.<br />◦ The router could be stupid and not even allow you to change the default to the normal 1,500 bytes even though using PPPoA.<br />◦ The router could have been deliberately set to a lower MTU by the owner for reasons of their own.<br />◦ The router could be fine and BT could have messed up (see below)<br />list end</p><p>Having a lower MTU is not necessarily a problem - as we said, either way the data gets through. But as soon as you don&#039;t have the standard 1,500 byte MTU<br />you can run in to issues.</p><p>Why do things go wrong?</p><p>If everything worked as it should a smaller MTU would not be any problem, but there are reasons why it does not:-</p><p>list of 2 items<br />◦ Some people running web servers (notably some banks) set up their network so that they block the error message that is sent back when a packet is too<br />big. This would not be too bad if they did not also try and send 1,500 byte packets with the DF bit set. The result is the packet gets dropped when it<br />hits a sub 1,500 MTU link and has to retry. Eventually it may try a smaller packet size but this could be 20 seconds later. This is a stupid network setup<br />on the part of the person running the web server.<br />◦ Some people set up their firewalls to block any fragmented packets. This is because it is hard to tell what a fragmented packet is as you don&#039;t have<br />all of the data. However, it means that fragments don&#039;t work. Not everyone sends packets with DF to start with (a process called Path MTU discovery) so<br />fragmentation happens. If you have a broadband link with less than 1,500 MTU and a firewall (or even the router) blocking fragments you are likely to have<br />a problem with some places (notable MSN messenger).<br />list end</p><p>Fragments are bad</p><p>Fragments are bad anyway, which is why IPv6 insists you always take option (A) and send an error message. Fragments create extra overhead as each packet<br />has headers that have to be copied in to each fragment. They also work badly when a link is congested as dropping any fragment in a packet means the whole<br />packet is lost. They also take up CPU time creating the fragments and putting them back together. All in all it is better if the sending end creates the<br />smaller packets in the first place. This means Path MTU Discovery being used and the error message not being blocked! Fortunately IPv6 mandates this, so<br />the next generation of internet protocol should not have the same issues.</p><p>PPPoE problems (technical)</p><p>One of the main causes of a reduced MTU is PPPoE (PPP over Ethernet). This is because Ethernet allows 1,500 byte payloads, ideal for an IP packet, but<br />PPPoE has a header which takes a total of 8 bytes. This would make 1,508 bytes with a full 1,500 byte IP packet.</p><p>Unfortunately the specifications are not that helpful here. <br />RFC1661<br /> defines PPP and states If smaller packets are requested, an implementation MUST still be able to receive the full 1,500 octet information field. <br />RFC2516<br /> defines PPPoE The Maximum-Receive-Unit (MRU) option MUST NOT be negotiated to a larger size than 1,492. But they are not incompatible statements - negotiating<br />1,492 does not mean you don&#039;t have to accept 1,500 byte packets (as per RFC1661), but you can&#039;t send on if PPPoE bridging, for example, so logically you<br />would have to fragment the IP packet. Most routers do not do that! This is one of the reasons we get problems with MTU being smaller than 1,500 bytes.</p><p>There are also ways to do over sized PPPoE using baby jumbo frames on Ethernet. The Ethernet specification still says 1,500 bytes maximum even for gigabit<br />speeds, but it common for gigabit equipment to support jumbo frames - i.e. larger Ethernet packets typically up to around 9,000 bytes. This is more than<br />you need to do PPPoE with 1,500 bytes - you only need 1,508. However there are other wrapping and tunnelling cases where just a bit more is useful. Baby<br />jumbo support normally means a bit more than the usual 1,500.</p><p>As there is no real way to tell if baby jumbo frames are supported on an Ethernet, <br />RFC4638<br /> defines an extra option to negotiate this at the Ethernet level. Of course two ends could simply agree to handle slightly larger Ethernet frames by configuration<br />as well. Sadly this is not always the same level of operation or the same equipment that does the MRU negotiation at the PPP level, and if that knows PPPoE<br />is involved it will not negotiate more than 1,492 MRU as per RFC2516. So typically some configuration is needed.</p><p>The upshot of all this? It is possible to get BT FTTC (Fibre to the Cabinet) circuits (which use PPPoE) working on full 1,500 byte PPP by using modified<br />pppd on the customer end, a suitable network card that will handle 1,508 byte frames at 10/100Mb/s. We have done this! (Thanks to TonyHoyle and Simon,<br />customers on irc, for tweaking pppd and testing this for us). The new FireBrick does, of course, support PPPoE with baby jumbo frames to handle 1,500 byte<br />MTU and even bonds multiple lines. Using the right modem (and the DLINK 320B in bridge mode do this) you can negotiate and use 1508 bytes over ADSL as<br />well.</p><p><a href="http://aa.net.uk/kb-broadband-mtu.html">http://aa.net.uk/kb-broadband-mtu.html</a><br /><a href="http://www.erg.abdn.ac.uk/users/gorry/eg3567/inet-pages/mtu.html">http://www.erg.abdn.ac.uk/users/gorry/e … s/mtu.html</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p276197">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">tapper</div>
					<div class="post-datetime">
						13 May 2015, 20:47					</div>
				</div>
				<div class="post-content content">
					<p><a href="http://wiki.openwrt.org/doc/uci/network">http://wiki.openwrt.org/doc/uci/network</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p276247">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">atom</div>
					<div class="post-datetime">
						14 May 2015, 07:01					</div>
				</div>
				<div class="post-content content">
					<p>I suspect that value of 1473 confuses MTU (usually 1500) with TCP MSS (usually 1460.)&nbsp; From what I&#039;ve seen, it&#039;s generally inappropriate to change the MTU size on OpenWRT.</p><p>Most probably you&#039;re using a broadband connection with PPPoE, which has some overhead that typically reduces the MTU from 1500 to 1492, which might be where their suggestion comes from.&nbsp; On the router side, it is generally more effective to implement MSS clamping than to statically set MTU.&nbsp; This should be done on the firewall settings for the WAN interface in OpenWRT.&nbsp; I know that it is on by default for PPPoE connections in Chaos Calmer, it might or might not be for earlier releases.</p><p>Yes, you could statically set MTU on your PC, but the chances of that actually solving anything are rather slim.</p><p>nicky9499: mismatching MTU settings may cause a host with a smaller MTU to reject packets that exceed that MTU size.&nbsp; Best case, the sending host will fragment those packets and retransmit them (= reduced performance due to retransmission and increased header overheads), worst case a router in between may silently drop the larger packets, stalling the connection.</p><p><span class="postimg"><img src="http://s29.postimg.org/xxln7pqfr/MSS_Clamping.png" alt="MSS Clamping" /></span></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p276262">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">nicky9499</div>
					<div class="post-datetime">
						14 May 2015, 12:10					</div>
				</div>
				<div class="post-content content">
					<p>Hi guys, thanks for all the information, I prolly learned a thing or two that I never needed to know.</p><p>Anyway, the instructions (<a href="https://support.rockstargames.com/hc/en-us/articles/200525767">https://support.rockstargames.com/hc/en … /200525767</a>) right at the bottom simply said to set MTU to 1473 on the client.</p><p>Anyway, setting it to 1473 did jack all to resolve the problem so I&#039;ve put it back to 1500 to avoid potential problems in future. Thanks again to all who chipped in.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>