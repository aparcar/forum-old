<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Internet Traffic Shapping</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 4 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p331439">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">rafaeldnbr</div>
					<div class="post-datetime">
						13 Jul 2016, 20:19					</div>
				</div>
				<div class="post-content content">
					<p>Hello guys,</p><p>Is there any way to equally distribute internet speeds for various users in OpenWRT ?</p><p>The goal is :</p><p>10MB internet connection<br />1 User downloading = 10MB speeds<br />2 Users Downloading = 5MB speeds each<br />3 Users Downloading = 3.3MB speeds each<br />4 users Downloading = 2,5MB speeds for each</p><p>I use on Mikrotik with PCQ, and i want to use this to home users, is there possible ?</p><p>Regards</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p331441">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">gamesoft33</div>
					<div class="post-datetime">
						13 Jul 2016, 20:24					</div>
				</div>
				<div class="post-content content">
					<p>I also want to divide the BW evenly . when only one user can be full speed but if there are other users can directly be shared equally . and if the return is only one user , it could be full speed again</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p331453">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">rafaeldnbr</div>
					<div class="post-datetime">
						13 Jul 2016, 21:19					</div>
				</div>
				<div class="post-content content">
					<p>Will be awesome if this can be done.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p331580">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">richbhanover</div>
					<div class="post-datetime">
						14 Jul 2016, 19:13					</div>
				</div>
				<div class="post-content content">
					<p>The SQM-QoS package is designed to do exactly this. Any single user gets &quot;their fair share&quot; of the link. One user gets the full capacity, two users split it 50-50, three users get a third each, etc.</p><p>Read the SQM Howto at: <a href="https://wiki.openwrt.org/doc/howto/sqm">https://wiki.openwrt.org/doc/howto/sqm</a></p><p>Note - the Howto talks mostly about minimizing latency (so you don&#039;t lag out, or have your VoIP crippled when someone&#039;s downloading/uploading). But SQM-QoS also ensures fairness between all the connections through the bottleneck (usually your connection to your ISP).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p331587">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">rafaeldnbr</div>
					<div class="post-datetime">
						14 Jul 2016, 20:11					</div>
				</div>
				<div class="post-content content">
					<p>Rich, have you tested this ? </p><p>I Can donate for a person to do an exact script for me, usable on OpenWRT, if there is someone interested</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p331605">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">richbhanover</div>
					<div class="post-datetime">
						14 Jul 2016, 22:25					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>rafaeldnbr wrote:</cite><blockquote><p>Rich, have you tested this ? </p><p>I Can donate for a person to do an exact script for me, usable on OpenWRT, if there is someone interested</p></blockquote></div><p>Not only did I test this, but I wrote the Howto, and made a Youtube video for it :-)</p><p>The process (<a href="https://wiki.openwrt.org/doc/howto/sqm">https://wiki.openwrt.org/doc/howto/sqm</a>) only takes a few minutes.</p><p>If you already have OpenWrt installed, you can do this. Good luck (and ask questions here if you you have problems.)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p331610">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						14 Jul 2016, 23:49					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>richbhanover wrote:</cite><blockquote><div class="quotebox"><cite>rafaeldnbr wrote:</cite><blockquote><p>Rich, have you tested this ? </p><p>I Can donate for a person to do an exact script for me, usable on OpenWRT, if there is someone interested</p></blockquote></div><p>Not only did I test this, but I wrote the Howto, and made a Youtube video for it :-)</p><p>The process (<a href="https://wiki.openwrt.org/doc/howto/sqm">https://wiki.openwrt.org/doc/howto/sqm</a>) only takes a few minutes.</p><p>If you already have OpenWrt installed, you can do this. Good luck (and ask questions here if you you have problems.)</p></blockquote></div><p>Hi Rich,</p><p>I think your advise is pretty good, and should be tried first. Though I believe what the OP wants is not the per-flow fairness that sqm-scripts offer so well, but per internal-IP address fairness. <br />&nbsp; &nbsp; &nbsp; &nbsp;That is something that the new and experimental cake qdisc promises (which can be used as part of sqm-scripts), but which is still experimental and might not work out at all. But to figure out whether it works, and to try to fix things we need actual testers...<br />&nbsp; &nbsp; &nbsp; &nbsp; People interested in testing this probably should install the latest LEDE snapshot (which allows to install a recent enough kmod_cake) and should also install the sqm-scripts-extra package from the openwrt packages repository to actually test the per-IP fairness modes.</p><p>Let me repeat a few words about kmod_cake here:</p><p>Why is cake not the default?<br />&nbsp; &nbsp; &nbsp; &nbsp; Cake is not per-se &quot;better&quot; than htb+fq_codel and cake is still under (more or less) active development so it certainly is not yet ready for becoming the default. Simple.qos with its combination of HTB and fq_codel still is the recommended default, so unless you want to participate in active debugging and development please stick to simple.qos or simplest.qos.</p><p>Why cake is not included?<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Cake just became available as an easy to install kernel module in LEDE to allow wider testing. But since it is not (yet) recommended as default it also is not installed by default (people might be unhappy if sqm-scripts would install unnecessary modules wasting their space).</p><p>Does cake use less CPU than HTB+fq_codel?<br />&nbsp; &nbsp; &nbsp; &nbsp; Some time last year tests with an earlier version of cake indicated that in a CPU limited situation cake might allow a higher overall shaper bandwidth than the default HTB+fq_codel combination. More recent tests are not that conclusive. Especially it was shown that HTB behaves differently from HFSC and cake in CPU limited mode: HTB will keep the added latency low, sacrificing more bandwidth (sometimes considerably more bandwidth) while the other two shaper sacrifice less bandwidth but will also increase the latency under load (or show more bufferbloat).</p><p>What about the sqm-scripts-extra scripts?<br />&nbsp; &nbsp; &nbsp; &nbsp; The sqm-scripts-extra scripts are really just for wider testing, please do not relay on them being available for longer times.</p><p>[OT] SQM-scripts-exts: What is the difference between the _LAN_ and _WAN_ variants?<br />Cake promises much better isolation of internal host IPs versus each other than the other qdiscs. But to be able to implement per-internal-host-IP fairness cake needs to see the internal IPs, in the typical home situation sqm gets instantiated on the WAN interface that typically also performs NAT for IPv4. Cake will only be able to see one internal IPv4 address if instantiated there (the IP address assigned by the ISP), making per-internal-IP isolation degrade into the default per-flow isolation. To allow to test whether cake&#039;s two relevant isolation options (triple and dual) actually work in the real world the _LAN_ scripts are prepared to be instantiated on internal LAN interfaces of a home router, since on the LAN ports the internal IPs are still visible. Please note that typically the bridged WLAN interfaces will not be covered by the shaping, making the LAN variant scripts not generally recommended solutions, but pure testing devices. The ideal test would be to hook upp another switch/dumbAP behind the shaped LAN port and try to mix traffic from different host and see if for example heavy bit-torrenting still badly affects the connections of other internal hosts. If anybody actually tests this, please report any results as issues under <a href="https://github.com/tohojo/sqm-scripts">https://github.com/tohojo/sqm-scripts</a> thanks in advance</p><p>Let me rephrase, use the WAN variants on interfaces that are directed towards the internet and the LAN variants for interfaces directed towards the internal (home) network. The scripts are modified so that in the GUI one still just enters the internet download and upload shaper bandwidth, and the scripts flip these internally to account for the directionality difference, but I digress.<br />[/OT]</p><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p331617">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">richbhanover</div>
					<div class="post-datetime">
						15 Jul 2016, 01:30					</div>
				</div>
				<div class="post-content content">
					<p>@rafaeldnbr - I stand corrected. SQM-QoS may do what you want in certain circumstances. It&#039;s worth the five minutes that it takes to set up, and it will never hurt. </p><p>@moeller0 - As you note, SQM-QoS won&#039;t prevent someone who&#039;s torrenting from using the lion&#039;s share of the bandwidth. That&#039;s why the Cake qdisc will be better when it&#039;s stable and ready to recommend to everyone.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p331705">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">rafaeldnbr</div>
					<div class="post-datetime">
						15 Jul 2016, 15:32					</div>
				</div>
				<div class="post-content content">
					<p>@richbhanover - you right ! i´ll be testing today then share the results here.</p><p>@moeller0 - thank´s for all hints here.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>