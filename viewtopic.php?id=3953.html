<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Proposal - patch for dynamically generated hosts file</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 9 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p18318">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">danversj</div>
					<div class="post-datetime">
						5 Jan 2006, 05:38					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m considering writing a patch that would cause a hosts file to be created containing the ip addressess, ifnames and hostnames of all network interfaces.</p><p>For example, consider an OpenWRT box with these NVRAM values set:<br /></p><div class="codebox"><pre><code>wan_hostname=MyRouter
wan_proto=dhcp
wan_ifname=vlan1
lan_hostname=MyLanRouter
lan_proto=static
lan_ifname=br0
lan_ipaddr=192.168.201.1
dmz_hostname=DMZGateway
dmz proto=static
dmz_ifname=vlan2
dmz_ipaddr=192.168.222.1
ifnames=dmz</code></pre></div><p>Note that the &quot;ifnames&quot; NVRAM variable is new in Kamikaze.&nbsp; It tells the network hotplug script which non-default interfaces to initialise.&nbsp; lan, wan and wifi are initialised by default, according to their &quot;&lt;name&gt;_proto=&quot; variable.</p><p>The hotplug script would use a little awk routine to get the actual IP address of an interface so that interfaces configured via DHCP could also have their DHCP-assigned IP address in the hosts file.</p><p>If people want to add their own entries to their hosts file, they add them to /etc/hosts.static.&nbsp; The contents of this file are appended to /tmp/hosts.localhost when it is created or updated.</p><p>/etc/hosts would be symlinked to /tmp/hosts.localhost.&nbsp; After initialisation, /tmp/hosts.localhost would look like this:<br /></p><div class="codebox"><pre><code>#/tmp/hosts.localhost
#this file is dynamically generated by OpenWRT - don&#039;t bother editing it!
127.0.0.1         localhost
144.129.30.62     wan        MyRouter
192.168.201.1     lan        MyLanRouter
192.168.222.1     dmz        DMZGateway
#contents of /etc/hosts.static are automatically added below this line</code></pre></div><p>Having a default configuration where the names &quot;wan&quot; and &quot;lan&quot; always point at the correct IP address would be very handy.&nbsp; Many programs allow hostnames instead of ip addresses in their config files.&nbsp; Being able to substitue &quot;lan&quot; instead of &quot;192.168.1.1&quot; or &quot;br0&quot; in a config file makes it possible to package programs with default settings that can withstand a wide range of hardware and custom network configs.</p><p>By default, dnsmasq reads the contents of /etc/hosts and makes the contents available for name resolution via it&#039;s dns server.&nbsp; However, we would not want it to serve the contents of /tmp/hosts.localhost because the interface names (wan, lan, dmz) would not be appropriate for other dns clients on our network.&nbsp; To solve this, the network initialisation script also genrates a file called /tmp/hosts.dnsmasq that looks like this:<br /></p><div class="codebox"><pre><code>#/tmp/hosts.dnsmasq
#this file is dynamically generated by OpenWRT - don&#039;t bother editing it!
144.129.30.62     MyRouter
192.168.201.1     MyLanRouter
192.168.222.1     DMZGateway</code></pre></div><p>We would configure dnsmasq to read /tmp/hosts.dnsmasq and /etc/hosts.static but not /etc/hosts (the symlink to /tmp/hosts.localhost).</p><p>Of course a scheme like this won&#039;t be useful in every circumstance, but I think it&#039;d make using openwrt a lot nicer and it opens the door for further configs based on hostname rather than interface name or IP address.</p><p>Before I spend time writing the patch, I&#039;d like some feedback on the idea - from developers and users.&nbsp; Cheers!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p18346">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">mbm</div>
					<div class="post-datetime">
						5 Jan 2006, 20:46					</div>
				</div>
				<div class="post-content content">
					<p>Many programs only resolve the hostname to an ip address and then use the ip address from that point on, ignoring any changes to the host file.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p18358">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">danversj</div>
					<div class="post-datetime">
						6 Jan 2006, 02:01					</div>
				</div>
				<div class="post-content content">
					<p>Yes, in that respect I suppose you&#039;d be better off supplying an interface name (eth1, vlan0, etc).&nbsp; But not all programs accept interface names, they want a hard-coded IP address.&nbsp; So for those programs, a hostname might be an acceptable substitute.&nbsp; A program that reads a hardcoded IP address from a config file is in no better position than if it had read a hostname - and in fact, the IP address in the config file would need to be updated if the interface it refers to changes it&#039;s IP address, whereas a hostname that is automatically updated has a better chance of being correct without needing to edit the config file - at the time of program execution, anyway.</p><p>It might be better if I released the patch as a package so people can try it without being forced to use it.</p><p>As ad-hoc mesh networks become more popular, I believe automatic naming will become more important - IP addressess will become more dynamic so people will need a static, non-IP way of referring to a particular node.&nbsp; Using centralised DNS servers with manually updated hosts files will become impractical in large mesh networks.&nbsp; A patch/package like this one hopefully will help enable dynamic IP addressing on a larger scale.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p18538">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">danversj</div>
					<div class="post-datetime">
						9 Jan 2006, 05:58					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ve been following the development of Kamikaze - mainly by watching the timeline - <a href="https://dev.openwrt.org/timeline">https://dev.openwrt.org/timeline</a>.&nbsp; It&#039;s interesting to watch the developent - and I notice that the networking and hotplug scripts are still being perfected.&nbsp; I might wait until things settle down before I have a go at the dynamic hosts file package.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>