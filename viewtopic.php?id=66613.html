<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> UCI script to disable sta mode -- How to write?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 17 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p333523">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">rdragonrydr</div>
					<div class="post-datetime">
						7 Aug 2016, 06:34					</div>
				</div>
				<div class="post-content content">
					<p>Hello.</p><p>I have a router with two connections on one radio. One is sta mode, and the other is ap mode. I would like to find a way to disable any and all sta mode connections via a UCI command, which I will trigger by checking to see if that sta mode connection is connected, if possible. </p><p>I need to do this as the ap mode will drop if the sta mode loses signal (It&#039;s a sort of longstanding bug).</p><p>In pseudocode, since I can&#039;t seem to find the syntax for exactly what I need:</p><p>do while true<br />&nbsp; do for all sta in interfaces:<br />&nbsp; &nbsp; if not sta_connected<br />&nbsp; &nbsp; then sta disable=1<br />&nbsp; &nbsp; endif<br />&nbsp; end<br />&nbsp; sleep 120<br />end</p><p>Preferably, I would disable the sta mode interfaces so as not to save it in flash (also to make it last longer), so that when I go somewhere else and turn the router on it brings up the sta interfaces and, after they have had a chance to connect, disables the disconnected one(s).</p><p>Perhaps I could also add a script activated by a button to manually bring up all the sta mode connections for if the router is still on.</p><p>button --&gt; do for all sta in interfaces<br />&nbsp; sta_disable=0<br />end</p><p>I feel as if this could be useful to a lot of people, as this keeps coming up and seems to be a wontfix, but I have not found a solution that does not involve multiple copies of config files.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p333570">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">nenekofi</div>
					<div class="post-datetime">
						7 Aug 2016, 19:10					</div>
				</div>
				<div class="post-content content">
					<p>I don&#039;t know about UCI script, but if you are conversant with shell, check out this post:<br /><a href="https://forum.openwrt.org/viewtopic.php?id=64507">https://forum.openwrt.org/viewtopic.php?id=64507</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p333580">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">rdragonrydr</div>
					<div class="post-datetime">
						7 Aug 2016, 20:56					</div>
				</div>
				<div class="post-content content">
					<p>Thank you, nenekofi. That looks like exactly what I was trying to find. I will test it out immediately!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p333752">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">rdragonrydr</div>
					<div class="post-datetime">
						9 Aug 2016, 04:41					</div>
				</div>
				<div class="post-content content">
					<p>Crud. That did not quite work. It is saving the disabled state in flash, so it never connects again. I know that could be fixed by enabling it every boot, but I would prefer to save wear on the flash.</p><p>Do you have a command to disable it that persists in RAM only?</p><p>I can work out the rest of the script now, but I need a selective disable for sta ifaces that does not save to flash. Is that possible?</p><p>Thanks very much, though!</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>