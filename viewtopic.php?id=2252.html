<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> LAN Ok, Wifi don&#039;t give IP</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 21 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p10544">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">TslH</div>
					<div class="post-datetime">
						9 Aug 2005, 18:48					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>I have a situation that look like this: <a href="http://openwrt.org/forum/viewtopic.php?id=2243">http://openwrt.org/forum/viewtopic.php?id=2243</a> but it seems that&#039;s not my answer <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><p>I run WhiteRussian RC2 on a WRT54G V2.2. I just want in the first time to reproduce what I had with the standard Linksys firmware: wired LAN and Wifi bridged together.</p><p>The situation: I wired ports work perfectly (dhcp answer correctly), wifi is detectable but don&#039;t give IP. The log has no trace of a dhcp request from the wifi.</p><p>Here my nvram content for lan:<br /></p><div class="codebox"><pre><code>root@OpenWrt:/rom/etc# nvram show 2&gt;/dev/null | sort | grep ^lan
lan_domain=
lan_hwaddr=00:13:10:0A:F6:CA
lan_hwnames=
lan_ifname=br0
lan_ifnames=vlan0 eth1 eth2 eth3
lan_ipaddr=192.168.1.1
lan_lease=86400
lan_netmask=255.255.255.0
lan_proto=static
lan_stp=0
lan_wins=</code></pre></div><p>wan:<br /></p><div class="codebox"><pre><code>root@OpenWrt:/rom/etc# nvram show 2&gt;/dev/null | sort | grep ^wan
wan_dns=
wan_domain=
wan_gateway=82.232.58.254
wan_gateway_buf=0.0.0.0
wan_get_dns=212.27.54.252 212.27.39.135
wan_get_domain=
wan_hostname=
wan_hwaddr=00:13:10:0A:F6:CB
wan_hwname=
wan_iface=vlan1
wan_ifname=vlan1
wan_ifnames=vlan1
wan_ipaddr=82.232.58.132
wan_lease=604800
wan_mtu=1500
wan_netmask=255.255.255.0
wan_primary=1
wan_proto=dhcp
wan_run_mtu=1500
wan_unit=0
wan_wins=0.0.0.0</code></pre></div><p>Please, ask if you need other informations to help me resolve my problem.<br />Thanks for your help <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p10575">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">TslH</div>
					<div class="post-datetime">
						10 Aug 2005, 11:28					</div>
				</div>
				<div class="post-content content">
					<p>So, it seems nobody have hint about this problem.</p><p>I think I wil flash my router with the original Linksys firmware in order to check if nvram is still correct, then re-flash with openWRT without modifying the nvram.</p><p>Do you think this could solve my problem?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p10581">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">hjernemadsen</div>
					<div class="post-datetime">
						10 Aug 2005, 13:30					</div>
				</div>
				<div class="post-content content">
					<p>Are you sure that the WiFi connection actually works? If you assign a static IP-address to the PC you are trying to connect, can you then ping the accesspoint?</p><p>I was using WEP, and there where some problems with the keys, which caused the same problem as you are describing.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p10584">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">TslH</div>
					<div class="post-datetime">
						10 Aug 2005, 14:28					</div>
				</div>
				<div class="post-content content">
					<p>Hi, hjernemadsen</p><p>Effectively, I&#039;m using WEP encryption (due to restriction on WiFi clients).</p><p>If I assign to a client a static IP I can&#039;t ping the AP. So this could be the encryption problem you are talking about?<br />How do you solve your problem?</p><p>Here are nvram variables about WEP:</p><div class="codebox"><pre><code>root@OpenWrt:~# nvram show 2&gt;/dev/null | grep wep
wl0_wep_buf=
wl0_wep_last=
security_mode=wep
wl_wep_bit=64
wl0_wep=enabled
wl0_wep_bit=64
wl_wep_last=
wl_wep=enabled
wl_wep_gen=home42sharedp:2C7F41FA43:BC4115E05F:300033626F:AA463BF04A:1
wl0_wep_gen=
wl_wep_buf=home42sharedp:0987654321:BC4115E05F:300033626F:AA463BF04A:1</code></pre></div><p>And here the variables relatives to &quot;key&quot;:</p><div class="codebox"><pre><code>root@OpenWrt:~# nvram show 2&gt;/dev/null | grep key
eou_key_index=1
wl0_key1=0987654321
wl0_key2=BC4115E05F
wl0_key3=300033626F
wl0_key4=AA463BF04A
wl_wpa_gtk_rekey=3600
wl_key1=0987654321
wl_key2=BC4115E05F
wl_key3=300033626F
wl_key4=AA463BF04A
wl_radius_key=
eou_private_key=20e05d155850e109b77b494cba163fd9b8dfab401a3c6c30dff9889d4c189df24c7c7f29e925a49554450e559faee9b6d831d34cd21f414a72582920e1d385c10e87f73d6427169f2b774f02e669a676707bdb58da47ba36da4920e148a3620413efdede8439eaa6df37a90e2fbba3ee1d16d5914e87001ed061a875c8ae1af9
wl0_wpa_gtk_rekey=3600
wl0_key=1
wl0_radius_key=
wl_key=1
eou_public_key=ba4cba239f1fa5e1ba654a081e7e147c6cf37515ea010fbf9fdb5b7b59e0d45d06c17b42d3d54f4e32dca68fde3481b6c91a5808a6b11ca5dd48e90faa594b47b32bdbbcd51b3239b9a8a766dab968a662af6824eda3a369d9b1aed11903ef1e5b01c2a6eb06f32b1e62458f2610138a73f63f577ead6d805a8ddafd5c10255b11</code></pre></div><p>Hoping this could help.</p><p>Thanks by advance.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p10586">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">hjernemadsen</div>
					<div class="post-datetime">
						10 Aug 2005, 14:43					</div>
				</div>
				<div class="post-content content">
					<p>Yes. That is exactly the problem I have experienced. </p><p>The problem is that the wifi tool, does not choose the correct key, when configuring the WEP encryption on the access-point. If you take a look at the output of iwconfig, the encryption key used by the access point is wl0_key4 instead of wl0_key1. </p><p>The easiest way to fix this, is to insert the following command into /etc/init.d/S40etwork, just after it calls wifi up:</p><div class="codebox"><pre><code>iwconfig eth1 key [1] `nvram get wl0_key1`</code></pre></div><p>I have a patch for the wifi-tool, which you can use instead, if you recompile it on your own. It is available here:</p><p><a href="http://forum.openwrt.org/viewtopic.php?id=2153">http://forum.openwrt.org/viewtopic.php?id=2153</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p10591">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">TslH</div>
					<div class="post-datetime">
						10 Aug 2005, 15:51					</div>
				</div>
				<div class="post-content content">
					<p>The line correct truly the WEP key, but it seems that I still can&#039;t get IP from Wifi.</p><p>I&#039;ll try your patch in the next hours, just the time to learn how to compile the firmware with the modification.<br />In this time, there&#039;s just a line or two (with the arrow in front of line) in my log that I think could be strange:</p><div class="codebox"><pre><code>Jan  1 00:00:09 (none) kern.warn kernel: vlan0: Setting MAC address to  00 13 10 0a f6 ca.
Jan  1 00:00:09 (none) kern.warn kernel: VLAN (vlan0):  Underlying device (eth0) has same MAC, not checking promiscious mode.
Jan  1 00:00:09 (none) kern.debug kernel: vlan0: add 01:00:5e:00:00:01 mcast address to master interface
Jan  1 00:00:09 (none) kern.info kernel: device eth1 entered promiscuous mode
Jan  1 00:00:09 (none) kern.info kernel: eth1: attempt to add interface with same source address.
Jan  1 00:00:09 (none) kern.info kernel: br0: port 2(eth1) entering learning state
Jan  1 00:00:09 (none) kern.info kernel: br0: port 1(vlan0) entering learning state
Jan  1 00:00:09 (none) kern.info kernel: br0: port 2(eth1) entering forwarding state
Jan  1 00:00:09 (none) kern.info kernel: br0: topology change detected, propagating
Jan  1 00:00:09 (none) kern.info kernel: br0: port 1(vlan0) entering forwarding state
Jan  1 00:00:09 (none) kern.info kernel: br0: topology change detected, propagating
Jan  1 00:00:11 (none) kern.warn kernel: vlan1: Setting MAC address to  00 13 10 0a f6 cb.
Jan  1 00:00:11 (none) user.info : info, udhcpc (v0.9.9-pre) started
Jan  1 00:00:11 (none) kern.debug kernel: vlan1: add 01:00:5e:00:00:01 mcast address to master interface

[...]

Jan  1 00:00:12 (none) user.info : deleting routers
--&gt; Jan  1 00:00:12 (none) user.info : route: SIOC[ADD|DEL]RT: No such process

[...]

Jan  1 00:00:13 (none) kern.info kernel: br0: port 2(eth1) entering disabled state
Jan  1 00:00:27 (none) kern.info dnsmasq[640]: started, version 2.22 cachesize 150
Jan  1 00:00:27 (none) kern.info dnsmasq[640]: DHCP, IP range 192.168.1.100 -- 192.168.1.115, lease time 12h
Jan  1 00:00:27 (none) kern.info dnsmasq[640]: DHCP, IP range 192.168.1.100 -- 192.168.1.115, lease time 12h
Jan  1 00:00:27 (none) kern.info dnsmasq[640]: using local addresses only for domain lan
Jan  1 00:00:27 (none) kern.info dnsmasq[640]: read /etc/hosts - 2 addresses
--&gt; Jan  1 00:00:27 (none) kern.err dnsmasq[640]: failed to read /etc/ethers:No such file or directory</code></pre></div><p>Are these lines normal?</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>