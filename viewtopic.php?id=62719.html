<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Can&#039;t Flash TL-WR1043ND V3.0</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 22 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p311276">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">kradec</div>
					<div class="post-datetime">
						13 Feb 2016, 23:44					</div>
				</div>
				<div class="post-content content">
					<p>Hopefully someone can help me.&nbsp; I am having issues flashing with trunk / designated driver.&nbsp; I keep getting &quot;error code 18005 -&nbsp; upgrade unsuccessful because the version of the upgraded file was incorrect. Please check the file name.&quot;&nbsp; I have changed the file name to a tp-link firmware name and even shortened the name; but no luck.&nbsp; The really strange thing is that I have flashed this router before using the tp-link firmware upgrade function.&nbsp; I can&#039;t even flash the tp-link&#039;s firmware on it.&nbsp; The router says my version is 151021 yet on the tp-link website for this router, the most current version is 150514 and version 151021 does not even exist.</p><p>I am not sure where to turn at this point.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p311282">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">anomeome</div>
					<div class="post-datetime">
						14 Feb 2016, 00:13					</div>
				</div>
				<div class="post-content content">
					<p><a href="https://forum.openwrt.org/viewtopic.php?pid=302819#p302819">https://forum.openwrt.org/viewtopic.php â€¦ 19#p302819</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p311283">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">kradec</div>
					<div class="post-datetime">
						14 Feb 2016, 00:29					</div>
				</div>
				<div class="post-content content">
					<p>I read that thread but that is referring to the Archer C7 not the 1043ND v3?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p311285">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">anomeome</div>
					<div class="post-datetime">
						14 Feb 2016, 00:42					</div>
				</div>
				<div class="post-content content">
					<p>It&#039;s the same issue though. tp-link, for whatever reason, has decided to get a jump on the FCC. About a week back someone on <em>irc #openwrt</em> channel walked an owner of a tp-link device through replacing the first 157? bytes of the stock firmware to fix the issue. I am unable to find the site where it was described. If you try up there someone may be on-line that can help.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p311288">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">kradec</div>
					<div class="post-datetime">
						14 Feb 2016, 00:55					</div>
				</div>
				<div class="post-content content">
					<p>Ok thanks.&nbsp; The issue is very aggravating.&nbsp; I had read some earlier threads about patching the file with some Chinese utility that reads in the current tp-link firmware then allows you to change the openwrt version so it will flash.&nbsp; I cannot find the utility though.&nbsp; I did manage to find the wr1043nd 151021 version that my router currently has.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p311351">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">danymarc</div>
					<div class="post-datetime">
						14 Feb 2016, 15:59					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>kradec wrote:</cite><blockquote><p>I cannot find the utility</p></blockquote></div><p>Post your mail, I&#039;ll sent it to you</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p311373">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">kradec</div>
					<div class="post-datetime">
						14 Feb 2016, 18:57					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>danymarc wrote:</cite><blockquote><div class="quotebox"><cite>kradec wrote:</cite><blockquote><p>I cannot find the utility</p></blockquote></div><p>Post your mail, I&#039;ll sent it to you</p></blockquote></div><p>Thanks. I finally did find the utility but when I use it, the header of the current tp-link firmware is the same as the header on the openwrt firmware.&nbsp; So using this utility is not going to make a difference. </p><p>What i really need to do is somehow patch an earlier version of tp-link firmware so it looks like the current version.&nbsp; I could then load the older version of the firmware that does not have the code it in that circumvents the loading of third party firmware.&nbsp; However, I just don&#039;t know how to patch the file to do this.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p311456">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">kradec</div>
					<div class="post-datetime">
						15 Feb 2016, 06:23					</div>
				</div>
				<div class="post-content content">
					<p>I figured it out.</p><p>Here is what I did.&nbsp; You only need to do this if you end up with a newer version of the tp-link firmware or 151021 (or later) which was the version my router shipped with.</p><p>1) I acquired an older version of the firmware or 150514, which is the most current one on the tp-link site for this router (as of this post date).&nbsp; 150414 appears to be the last version of the wr1043nd firmware that doesn&#039;t have the logic in it to prevent loading 3rd party firmwares like openwrt.</p><p>2) I patched the 150414 bin file to remove the boot portion of the image:&nbsp; dd if=&lt;150514 bin file name.bin&gt; of=&lt;output file name.bin&gt; skip=257 bs=512&nbsp; Note that I had to do this command under a Linux NAS box I am running then move the file back to windows.</p><p>3) Setup a tftp server in windows bound to a static address of 192.168.0.66.&nbsp; I used Ttfpd32.</p><p>4) Placed the patched file (output file name.bin) in the Ttfpd32 directory and renamed it wr1043v3_tp_recovery.bin</p><p>5) Started up the tftp server.</p><p>6) Started up the router by plugging it in and pressing the reset button for about 10 seconds or so and then it flashes wr1043v3_tp_recovery.bin to the router. I was watching the log so I knew when to release the reset button.</p><p>7) Now I have the older firmware or 150514 successfully on the router and I now could flash the correct openwrt version to the router using the tp-link gui.</p><p>This worked for me and no promises this procedure will not brick your router - just sharing what I did.&nbsp; I ended up piecing this together by reading different posts as the wiki is not up to date.&nbsp; I am sure that there are other and better ways to do this.</p>											<p class="post-edited">(Last edited by <strong>kradec</strong> on 15 Feb 2016, 06:33)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>