<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Connecting two TP-Link WDR3600 with WDS - routers become unresponsive</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 6 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p216876">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">victorhooi</div>
					<div class="post-datetime">
						6 Nov 2013, 15:05					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>We have two TP-Link WDR3600 routers we&#039;re trying to connect with WDS.</p><p>However, as soon as we power up the WDS client - both the WDS AP and WDS client become unresponsive (via either web interface or ssh). Once we disable the second router, the first router becomes responsive again.</p><p>Router 1 is setup with a LAN IP of 192.168.1.5, and DHCP is <strong>enabled</strong> on that interface.</p><p>Router 1 is on WDR3600 hardware revision 1.3.</p><p>Router 2 is setup with a LAN IP of 192.168.1.6, and DHCP is <strong>disabled</strong> on that interface.</p><p>Router 2 is on WDR3600 hardware revision 1.2.</p><p>On the wifi side:<br /></p><ul><li><p>ESSID for the 2.4 Ghz radio is set to the same name (e.g. &quot;my_network&quot; for both routers), and for the 5 Ghz is set to the same name (e.g. &quot;my_network_5g&quot; for both routers).</p></li><li><p>Channels are the same on both (channel 1 for 2.4 Ghz, channel 36 for 5 Ghz)</p></li><li><p>Router 1 is set to Access Point (WDS) for both radios, Router 2 is set to Client (WDS) for both radios</p></li><li><p>BSSID for router 2 is set to the MAC addresses of the two radios on router 1. Router 1 does not have any BSSID settings when you set it to Access Point (WDS)</p></li><li><p>Encryption is set to WPA2-PSK on both routers for both radios, key is the same across all</p></li><li><p>HD mode is set to 40Mhz 2nd channel above for everything</p></li><li><p>Country code is set to AU - Australia for everything</p></li></ul><p>I&#039;ve uploaded Gists of the syslog (<a href="https://gist.github.com/victorhooi/7335677">https://gist.github.com/victorhooi/7335677</a>) and kernel log (<a href="https://gist.github.com/victorhooi/7335689">https://gist.github.com/victorhooi/7335689</a>) for the first router.</p><p>I noticed that there were a lot of errors of the form:</p><div class="codebox"><pre><code>br-lan: received packet on wlan0.sta1 with own address as source address</code></pre></div><p>I&#039;m not sure if this is the cause of the issue, or possibly the discrepancies in the hardware revisions?</p><p>One strange thing I did notice was that on router 2 (hardware revision 1.2) - the tab menu at the top to select radios is missing.</p><p>You can see them here on router 1 (hardware revision 1.3):</p><p><span class="postimg"><img src="http://i.imgur.com/u7kXmhv.png" alt="http://i.imgur.com/u7kXmhv.png" /></span></p><p>However, on router 2 (hardware revision 1.2), it&#039;s completely missing.</p><p>Any thoughts on what to check?</p><p>Cheers,<br />Victor</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216877">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">rAndy</div>
					<div class="post-datetime">
						6 Nov 2013, 15:27					</div>
				</div>
				<div class="post-content content">
					<p>Did you btw configured both routers&#039; wifis with same MAC address?<br />dhcp enabled on router 1 implies no dnsmasq running (at least not on the interface expecting an ip address via dhcp)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216880">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						6 Nov 2013, 15:47					</div>
				</div>
				<div class="post-content content">
					<p>I used WDS on my dual-band WNDR3700 and set only one of the radios to WDS mode.<br />Have you tried that?</p><p><a href="https://forum.openwrt.org/viewtopic.php?pid=186067#p186067">https://forum.openwrt.org/viewtopic.php … 67#p186067</a></p><p>EDIT: and also read this thread:<br /><a href="https://forum.openwrt.org/viewtopic.php?pid=213408#p213408">https://forum.openwrt.org/viewtopic.php … 08#p213408</a></p>											<p class="post-edited">(Last edited by <strong>hnyman</strong> on 6 Nov 2013, 15:58)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216886">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">victorhooi</div>
					<div class="post-datetime">
						6 Nov 2013, 16:24					</div>
				</div>
				<div class="post-content content">
					<p>HI,</p><p>@rAndy - Hmm, what do you mean by configuring both routers with the same MAC address?</p><p>If you mean for the WDS - when you set it to &quot;Access Point (WDS)&quot;, it doesn&#039;t give you a BSSID field.</p><p><span class="postimg"><img src="http://i.imgur.com/zRXraOp.png" alt="http://i.imgur.com/zRXraOp.png" /></span></p><p>However, if you set it to &quot;Client (WDS)&quot;, it does give you a BSSID field. Router 2 is the Cliend (WDS), and we set the BSSID to the wireless MAC addresses of router 1:</p><p><span class="postimg"><img src="http://i.imgur.com/HdUJe5I.png" alt="http://i.imgur.com/HdUJe5I.png" /></span></p><p>What did you mean by the second part? DHCP is enabled on LAN for router 1 - I&#039;ve left the box at it&#039;s default (unchecked):</p><p><span class="postimg"><img src="http://i.imgur.com/uLMQgsX.png" alt="http://i.imgur.com/uLMQgsX.png" /></span></p><p>However, on router 2 - this box is checked, so DNS is disabled for the LAN.</p><p>What do you mean by DNSMasq isn&#039;t running? I thought it was a DNS and DHCP service together? So DNSMasq is running on router 1, but disabled on router 2, right?</p><p>@hnyman</p><p>STP is disabled (default) on LAN:</p><p><span class="postimg"><img src="http://i.imgur.com/F6qtF9w.png" alt="http://i.imgur.com/F6qtF9w.png" /></span></p><p>The advice from the second link you pasted seems to be that we shouldn&#039;t enable STP, right?</p><p>Also - so you&#039;re saying that I should only set one of the radio pairs to enable WDS?</p><p>So for example, I would set radio0 on both router 1 and router 2 just to normal &quot;Access Point&quot; (no WDS).</p><p>And I would then set radio1 on router 1 to &quot;Access Point (WDS)&quot; and router 2 to &quot;Client (WDS). </p><p>That makes sense, so I only need to use one band to make the link between the two - I suppose it doesn&#039;t matter whether I use the 2.4Ghz radio or the 5Ghz one? Wouldn&#039;t the 2.4 Ghz have more penetrating power? But the 5 Ghz might get less congestion?</p><p>Also, does anybody know anything about what the:</p><div class="codebox"><pre><code>br-lan: received packet on wlan0.sta1 with own address as source address</code></pre></div><p>messages might mean?</p><p>Cheers,<br />Victor</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216890">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">rAndy</div>
					<div class="post-datetime">
						6 Nov 2013, 16:53					</div>
				</div>
				<div class="post-content content">
					<p>i mean, if you &#039;ifconfig wlan0&#039; (or whatever interface you have as wireless) on each router you get two different mac addresses; in other words you didn&#039;t force the same address, did you? Maybe this is it with BSSID tweaking.</p><p>Try leaving BSSID unset / at the value it present as default</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p217037">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">victorhooi</div>
					<div class="post-datetime">
						8 Nov 2013, 12:27					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>Nope, they have different addresses.</p><p>I believe if you leave the BSSID blank, the WDS doesn&#039;t work?</p><p>Cheers,<br />Victor</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p217038">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">rAndy</div>
					<div class="post-datetime">
						8 Nov 2013, 13:06					</div>
				</div>
				<div class="post-content content">
					<p>but did you try it?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p217108">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">nebbia88</div>
					<div class="post-datetime">
						9 Nov 2013, 11:22					</div>
				</div>
				<div class="post-content content">
					<p>what are you trying to accomplish by enabling wds on BOTH radios? you have a beautiful network loop.. it&#039;s like you connected TWO routers,&nbsp; both configured as client bridge, to the same switch. packets will be broadcasted again and again!</p><p>test if you get more throughput with 2.4g or 5g, and enable the client interface only on one band.</p><p>if you want to have 2 links you need something like multiwan to do link aggregation.. but I never used it and cannot help.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p217269">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">victorhooi</div>
					<div class="post-datetime">
						11 Nov 2013, 14:50					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>Aha, fair enough - so you&#039;re saying that I should only ever have WDS enabled on one band?</p><p>I&#039;d assumed that by using WDS on both, I&#039;d get better reliability (since there are two redundant links), and better throughput.</p><p>However, you&#039;re saying I&#039;d need to explicitly enable link aggregation, or similar, in order to achieve that? Has anybody achieved this over WDS?</p><p>Cheers,<br />Victor</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>