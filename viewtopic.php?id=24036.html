<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> dhcp issue on wan</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 29 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p105341">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">ginlorax</div>
					<div class="post-datetime">
						27 Mar 2010, 01:02					</div>
				</div>
				<div class="post-content content">
					<p>I bought a new wrt54gl and installed kamikaze-brcm2.4 on it.&nbsp; I configured ssh and wireless.&nbsp; I then reset my cable modem and connected it to my new router.&nbsp; No wan connectivity.&nbsp; I flashed the linksys firmware to make sure it was not an issue with the router.&nbsp; It connected.&nbsp; I then re-flashed with backfire.&nbsp; Same problem.</p><p>In LuCi:</p><p>* There is a ? in the addresses field for the wan entry on the interfaces page.</p><p>* On the active connections screen, I see 2 (what I think are) non-lan ips to 96.179.232.1.&nbsp; One is of protocol TCP and its to the router (192.168.1.1) and the other is protocol UNKNOWN and to 224.0.0.1.</p><p>When I ssh into the router:</p><div class="codebox"><pre><code>root@OpenWrt:~# ifconfig
br-lan    Link encap:Ethernet  HWaddr 00:25:9C:BF:53:22  
          inet addr:192.168.1.1  Bcast:192.168.1.255  Mask:255.255.255.0
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:13254 errors:0 dropped:0 overruns:0 frame:0
          TX packets:12831 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:743747 (726.3 KiB)  TX bytes:1098275 (1.0 MiB)

eth0      Link encap:Ethernet  HWaddr 00:25:9C:BF:53:22  
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:22700 errors:0 dropped:0 overruns:0 frame:0
          TX packets:13046 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:1692545 (1.6 MiB)  TX bytes:1291329 (1.2 MiB)
          Interrupt:4 

eth0.0    Link encap:Ethernet  HWaddr 00:25:9C:BF:53:22  
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:13254 errors:0 dropped:0 overruns:0 frame:0
          TX packets:12831 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:796763 (778.0 KiB)  TX bytes:1149599 (1.0 MiB)

eth0.1    Link encap:Ethernet  HWaddr 00:25:9C:BF:53:22  
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:9296 errors:0 dropped:0 overruns:0 frame:0
          TX packets:216 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:480356 (469.0 KiB)  TX bytes:87912 (85.8 KiB)

lo        Link encap:Local Loopback  
          inet addr:127.0.0.1  Mask:255.0.0.0
          UP LOOPBACK RUNNING  MTU:16436  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)

...

root@OpenWrt:~# ifdown wan
root@OpenWrt:~# ifup wan
udhcpc (v1.15.3) started
root@OpenWrt:~# Sending discover...
Sending discover...
Sending discover...</code></pre></div><p>and then it just seems to &#039;hang&#039;.&nbsp; I think this is a problem with the DHCP negotiation with the wan.&nbsp; Any suggestions?</p><p>Thanks,</p><p>gin</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p105353">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">crow</div>
					<div class="post-datetime">
						27 Mar 2010, 08:50					</div>
				</div>
				<div class="post-content content">
					<p>Can you try to power cycle cabel modem when there is no connection to internet? I have some weird stuff with wan and dhcp (also cabel isp), if i reboot router it cant get IP and i cant ping anything outside, if I just reboot isp modem and wait fev sec router connect itself to modem and internet is working..<br />I am on trunk with kernel 2.6 (my signature).</p>											<p class="post-edited">(Last edited by <strong>crow</strong> on 27 Mar 2010, 09:08)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p106539">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">ginlorax</div>
					<div class="post-datetime">
						10 Apr 2010, 15:53					</div>
				</div>
				<div class="post-content content">
					<p>I unplugged my cable modem for about an hour.&nbsp; Plugged it back in.&nbsp; Rebooted the router.&nbsp; Everything just worked.</p><p>sigh.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p106541">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">Dogge</div>
					<div class="post-datetime">
						10 Apr 2010, 16:16					</div>
				</div>
				<div class="post-content content">
					<p>That&#039;s normal.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p171728">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">valuequest</div>
					<div class="post-datetime">
						6 Jul 2012, 18:18					</div>
				</div>
				<div class="post-content content">
					<p>I am trying to troubleshoot why my Backfire 10.03.1 r29592 (x86) installation seems to malfunction around the times that the DHCP lease on the cable modem connected to the WAN port expires. Although OpenWRT does not crash and the LAN DHCP seems to continue working I have observed that right around the time that a WAN DHCP expiration and renew should occur it (1) appears to lose a route to the cable modem connected to the WAN port and (2) also appears to lose the ability to execute commands like &#039;reboot&#039; and &#039;poweroff&#039;.</p><p>A few other posts here in the forum lead me to the &#039;logread&#039; command which displays the following entries timestamped right around the exact time that the last WAN DHCP lease should have expired (and OpenWRT was not doing anything else at all at that time). Can anyone help me figure out if these entries are related to the problems I describe above and, if so, how to fix the OpenWRT installation? Note: My /etc/config/network defines only one WAN section as eth3 with protocol DHCP.</p><div class="codebox"><pre><code>Jul  6 03:07:22 journeyco user.warn kernel: ------------[ cut here ]-----------
-
Jul  6 03:07:22 journeyco user.warn kernel: WARNING: at net/sched/sch_generic.c
:261 0xc11c4d91()
Jul  6 03:07:22 journeyco user.info kernel: NETDEV WATCHDOG: eth3 (e100): trans
mit queue 0 timed out
Jul  6 03:07:22 journeyco user.warn kernel: Modules linked in: sc520_wdt e100 n
f_nat_tftp nf_conntrack_tftp nf_nat_irc nf_conntrack_irc nf_nat_ftp nf_conntrac
k_ftp ipt_MASQUERADE iptable_nat nf_nat xt_NOTRACK iptable_raw xt_state nf_conn
track_ipv4 nf_defrag_ipv4 nf_connt
Jul  6 03:07:22 journeyco user.warn kernel: Pid: 0, comm: swapper Tainted: G
     W  2.6.32.27 #5
Jul  6 03:07:22 journeyco user.warn kernel: Call Trace:
Jul  6 03:07:22 journeyco user.warn kernel:  [&lt;c11c4d91&gt;] ? 0xc11c4d91
Jul  6 03:07:22 journeyco user.warn kernel:  [&lt;c102276f&gt;] ? 0xc102276f
Jul  6 03:07:22 journeyco user.warn kernel:  [&lt;c11c4d91&gt;] ? 0xc11c4d91
Jul  6 03:07:22 journeyco user.warn kernel:  [&lt;c10227eb&gt;] ? 0xc10227eb
Jul  6 03:07:22 journeyco user.warn kernel:  [&lt;c11c4d91&gt;] ? 0xc11c4d91
Jul  6 03:07:22 journeyco user.warn kernel:  [&lt;c11f6b00&gt;] ? 0xc11f6b00
Jul  6 03:07:22 journeyco user.warn kernel:  [&lt;c11c4c90&gt;] ? 0xc11c4c90
Jul  6 03:07:22 journeyco user.warn kernel:  [&lt;c102a471&gt;] ? 0xc102a471
Jul  6 03:07:22 journeyco user.warn kernel:  [&lt;c1046da7&gt;] ? 0xc1046da7
Jul  6 03:07:22 journeyco user.warn kernel:  [&lt;c1026b89&gt;] ? 0xc1026b89
Jul  6 03:07:22 journeyco user.warn kernel:  [&lt;c1026b20&gt;] ? 0xc1026b20
Jul  6 03:07:22 journeyco user.warn kernel:  &lt;IRQ&gt;  [&lt;c1004a55&gt;] ? 0xc1004a55
Jul  6 03:07:22 journeyco user.warn kernel:  [&lt;c10030e9&gt;] ? 0xc10030e9
Jul  6 03:07:22 journeyco user.warn kernel: ---[ end trace a7919e7f17c0a727 ]--
-</code></pre></div>											<p class="post-edited">(Last edited by <strong>valuequest</strong> on 6 Jul 2012, 21:18)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>