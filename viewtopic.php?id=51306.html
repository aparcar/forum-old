<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Virtualize router with several NICs</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 7 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p238208">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">kpv</div>
					<div class="post-datetime">
						27 Jun 2014, 03:57					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>Has anyone successfully virtualized an OpenWRT router with many (4+) NICs under KVM/Xen/VMware ?</p><p>Instead of buying a purpose-built system with multiple NICs (e.g. some Mikrotik box or a x86 system like the <a href="http://www.lannerinc.com/products/x86-network-appliances/desktop/fw-7541">Lanner FW7541</a>) I was thinking about building a virtual multi-WAN OpenWRT router.</p><p>E.g. using KVM under a Ubuntu 14.04 host and pass all WAN traffic (suitably VLAN-tagged) through a single NIC of the VM host machine to the Ethernet switch.</p><p>Thanks in advance for any feedback.</p><p>PS: Edited for clarity.</p>											<p class="post-edited">(Last edited by <strong>kpv</strong> on 27 Jun 2014, 17:03)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p238212">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">qasdfdsaq</div>
					<div class="post-datetime">
						27 Jun 2014, 04:33					</div>
				</div>
				<div class="post-content content">
					<p>That&#039;s not virtualizing a router, that&#039;s just a basic, standard multi-WAN or VLAN setup.</p><p>Unless you mean you want to run Openwrt in a virtual machine under Ubuntu... At which point what you&#039;re trying to do isn&#039;t actually clear. Running Openwrt in a VM is easy enough, there&#039;s even prebuilt packages for it.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p238267">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">kpv</div>
					<div class="post-datetime">
						27 Jun 2014, 17:15					</div>
				</div>
				<div class="post-content content">
					<p>Indeed, I was referring to setting up a multi-WAN OpenWRT router under KVM/Xen/VMware (note: I edited the original post for clarity).</p><p>I&#039;m already running OpenWRT in VM (under VirtualBox), but I was thinking about moving to a more capable VM host system, like the ones mentioned above.</p><p>But I&#039;m still unclear about several aspects: How would the PPPoE work? Can we pass VLAN-tagged traffic (very often used by ISPs for VDSL data/voice/iptv traffic) through a single physical GbE NIC of the VM host ? Wouldn&#039;t it need Q-in-Q aka IEEE 802.1ad ? (Btw I noticed there&#039;s a 802.1ad patch for OpenWRT <a href="http://patchwork.openwrt.org/patch/5546/">http://patchwork.openwrt.org/patch/5546/</a> which is currently under review).</p>											<p class="post-edited">(Last edited by <strong>kpv</strong> on 27 Jun 2014, 17:17)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p238278">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">qasdfdsaq</div>
					<div class="post-datetime">
						27 Jun 2014, 20:29					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>kpv wrote:</cite><blockquote><p>I&#039;m already running OpenWRT in VM (under VirtualBox), but I was thinking about moving to a more capable VM host system, like the ones mentioned above.</p></blockquote></div><p>Not much different. Probably actually easier in those &quot;more advanced&quot; hypervisors.</p><div class="quotebox"><blockquote><p>But I&#039;m still unclear about several aspects: How would the PPPoE work?</p></blockquote></div><p>Normally?</p><div class="quotebox"><blockquote><p>Can we pass VLAN-tagged traffic (very often used by ISPs for VDSL data/voice/iptv traffic) through a single physical GbE NIC of the VM host ?</p></blockquote></div><p>I don&#039;t see why not, unless your host network card doesn&#039;t support 802.1q which is pretty rare these days...</p><div class="quotebox"><blockquote><p>Wouldn&#039;t it need Q-in-Q aka IEEE 802.1ad ? (Btw I noticed there&#039;s a 802.1ad patch for OpenWRT <a href="http://patchwork.openwrt.org/patch/5546/">http://patchwork.openwrt.org/patch/5546/</a> which is currently under review).</p></blockquote></div><p>I don&#039;t see why it would. Unless you specifically want to re-tag it for some reason, instead of just passing it through directly with the original tag intact.</p>											<p class="post-edited">(Last edited by <strong>qasdfdsaq</strong> on 27 Jun 2014, 20:30)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p238291">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">kpv</div>
					<div class="post-datetime">
						27 Jun 2014, 21:29					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>qasdfdsaq wrote:</cite><blockquote><div class="quotebox"><cite>kpv wrote:</cite><blockquote><p>Wouldn&#039;t it need Q-in-Q aka IEEE 802.1ad ? (Btw I noticed there&#039;s a 802.1ad patch for OpenWRT <a href="http://patchwork.openwrt.org/patch/5546/">http://patchwork.openwrt.org/patch/5546/</a> which is currently under review).</p></blockquote></div><p>I don&#039;t see why it would. Unless you specifically want to re-tag it for some reason, instead of just passing it through directly with the original tag intact.</p></blockquote></div><p>Let&#039;s suppose we want to use a virtualized OpenWRT router to connect three (3) VDSL lines (using PPPoE with VLANs as is typically the case):</p><p>If all 3 VDSL lines are from the same ISP, chances are they&#039;ll require the same VLAN id for the data packets e.g. VID 835 on all 3 WANs.</p><p>So, it seems to me that in this particular scenario one has the following options:<br />1) use Q-in-Q open the OpenWRT router<br />2) get a managed switch that can do VLAN ID translation/mapping, on which the 3 VDSL modems (in bridged mode) are connected to.<br />3) strip the VLAN id on the VDSL modem (not sure if this is possible with all brands/firmware)</p><p>Or am I missing something?</p>											<p class="post-edited">(Last edited by <strong>kpv</strong> on 27 Jun 2014, 22:09)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p238298">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">qasdfdsaq</div>
					<div class="post-datetime">
						27 Jun 2014, 22:17					</div>
				</div>
				<div class="post-content content">
					<p>I don&#039;t know where they typically use VLANs with VDSL but none of the internet providers in this country do it.</p><p>But anyway - you could indeed use QinQ for such a scenario, or just have your edge device retag it with whatever VLAN ID you choose yourself, which is probably easier, faster, and more compatible.</p><p>Either way all 3 options you propose are going to need a managed switch regardless. If you want to connect four VDSL lines to a single upstream port via a switch you will have to apply your own VLAN tag in any case, so any tag used by the ISP is inconsequential.</p><p>I still don&#039;t see any reason to actually want to use QinQ though, or to preserve both tags, since the ISP tags are meaningless and ignored on your LAN anyway. Since you already have to connect your VDSL modems to a managed switch to apply your own tags, you might as well have it do it both ways.</p>											<p class="post-edited">(Last edited by <strong>qasdfdsaq</strong> on 27 Jun 2014, 22:21)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p238305">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">kpv</div>
					<div class="post-datetime">
						27 Jun 2014, 22:54					</div>
				</div>
				<div class="post-content content">
					<p>Indeed, all 3 options are going to need a managed switch regardless.</p><p>The reason I&#039;m considering QinQ is cost: It seems that QinQ is supported by some cheap managed switches (at least according to a quick Internet search), whereas I could only find references to VLAN ID translation/mapping in &quot;enterprise&quot; switches by Cisco/Juniper which cost 10x more.</p><div class="quotebox"><cite>qasdfdsaq wrote:</cite><blockquote><p>I don&#039;t know where they typically use VLANs with VDSL but none of the internet providers in this country do it..</p></blockquote></div><p>Well, in most European countries they do, to differentiate services (data, voip, iptv).</p><p>Thanks for your feedback.</p>											<p class="post-edited">(Last edited by <strong>kpv</strong> on 27 Jun 2014, 23:16)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>