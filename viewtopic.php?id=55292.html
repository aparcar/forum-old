<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> [UBUS] Send a msg with Ubus invoke generating Timeout</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 21 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p262449">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">Traker</div>
					<div class="post-datetime">
						22 Jan 2015, 14:57					</div>
				</div>
				<div class="post-content content">
					<p>Hello together,</p><p>im new to this forum and have a question regarding a strange UBUS Timeout we have currently.</p><p>We are developing a small C application for OpenWRT 12.09 AA. The UBUS build is from 2013/18/08. <br />Im using the C librarys (Ubus.h, blobmsg_json.h, libubus.h ) to build the msg and send it to the UBUS.</p><p><strong>Scenario:</strong><br />Send a ubus msg from application A&nbsp; to application B. Get the ret value of ubus_invoke to check if the msg was received successfully.<br />Sometimes the ret value is 7 (timeout), sometimes it is 0 (Success). <br />The strange thing is the recipent did recive the msg everytime independent from the returning value from the ubus_invoke! So i cant trust the return value of ubus_invoke at all. Is there a problem with my code or is this a bug? I need a meaningful answer from ubus the decide if i need send the msg again...</p><p><strong>Ubus Code app A broadcaster:</strong><br /></p><div class="codebox"><pre><code>  int ubus_send(struct ubus_context *ctx, struct blob_buf *buf, uint32_t *id) {
  int ret;

  ret = ubus_invoke(ctx, id, &quot;interface&quot;, buf-&gt;head, NULL, 0, 1000);

  if (ret)
      //doin checkin ... send again etc.

return 0;
}</code></pre></div><p><strong>Ubus code app B recipent:</strong><br /></p><div class="codebox"><pre><code>static int ubus_receive (struct ubus_context *ctx, struct ubus_object *obj,
  struct ubus_request_data *req, const char *method, struct blob_attr *msg){
  struct blob_attr * tb[__RM_MAX];
  struct blob_attr * cur, *curt;
  int rem, n, type;

  blobmsg_parse( ubus_receive_policy, __RM_MAX, tb, blob_data(msg), blob_len(msg));
  if(tb[INTERFACELIST]==NULL){
    return 1;
  }

  //doin more work ...
 
  return 0;
}</code></pre></div><p>Thank you very much!<br />kind regards,<br />Tom</p><p>PS: sorry for my bad english</p>											<p class="post-edited">(Last edited by <strong>Traker</strong> on 22 Jan 2015, 15:05)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>