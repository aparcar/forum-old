<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Netgear WNR2000v4</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 26 Apr 2018 and 6 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 3</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=50478&amp;p=2.html">2</a></li><li><a href="viewtopic.php%3Fid=50478&amp;p=3.html">3</a></li></ul></nav></div>
			
		
		
			<article class="post" id="p232451">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">franz.flasch</div>
					<div class="post-datetime">
						5 May 2014, 14:55					</div>
				</div>
				<div class="post-content content">
					<p>Hi!</p><p>Altough there is already a general WNR2000 topic I decided to create a new one for the WNR2000v4, as the hardware of this device is quite different.</p><p>I tried to get openwrt running by applying this patch here: <a href="http://patchwork.openwrt.org/patch/4652/">http://patchwork.openwrt.org/patch/4652/</a><br />I also followed the last 2 pages of this topic (concerning the wnr2000v4): <a href="https://forum.openwrt.org/viewtopic.php?id=18279&amp;p=9">https://forum.openwrt.org/viewtopic.php … 79&amp;p=9</a></p><p>The above patch works just fine, however only the initramfs works. I cannot apply the squashfs-sysupgrade image. I get the following error when trying to boot:</p><div class="quotebox"><blockquote><p>## Booting image at 9f040000 ...&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp;Image Name:&nbsp; &nbsp;MIPS OpenWrt Linux-3.10.36&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp;Created:&nbsp; &nbsp; &nbsp; 2014-05-04&nbsp; 20:22:17 UTC&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp;Image Type:&nbsp; &nbsp;MIPS Linux Unknown Image (uncompressed)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp;Data Size:&nbsp; &nbsp; 1041408 Bytes = 1017 kB&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp;Load Address: bf070000&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp;Entry Point:&nbsp; bf070000&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp;Verifying Checksum ... OK&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />Wrong Image Type for bootm command&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />Trying eth1</p></blockquote></div><p>Bukington and rpsoft (openwrt forum members) both provided a sysupgrade image that works just fine:<br />You can get it here if you want: <a href="https://dl.dropboxusercontent.com/u/14981672/openwrt-ar71xx-generic-wnr2000v4-squashfs-sysupgrade.bin">https://dl.dropboxusercontent.com/u/149 … pgrade.bin</a></p><div class="quotebox"><blockquote><p>## Booting image at 9f040000 ...&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp;Image Name:&nbsp; &nbsp;MIPS OpenWrt Linux-3.10.21&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp;Created:&nbsp; &nbsp; &nbsp; 2013-12-26&nbsp; &nbsp;2:00:03 UTC&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp;Image Type:&nbsp; &nbsp;MIPS Linux Kernel Image (lzma compressed)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp;Data Size:&nbsp; &nbsp; 1024623 Bytes = 1000.6 kB&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp;Load Address: 80060000&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp;Entry Point:&nbsp; 80060000&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp;Verifying Checksum ... OK&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp;Uncompressing Kernel Image ... OK&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />No initrd&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />## Transferring control to Linux (at address 80060000) ...&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />## Giving linux memsize in bytes, 33554432</p></blockquote></div><p>I think the problem is the image generation. I think this here does not apply to the wnr2000v4 (target/linux/ar71xx/image/Makefile):</p><div class="quotebox"><blockquote><p>define Image/Build/Netgear/buildkernel<br />&nbsp; &nbsp; &nbsp; &nbsp; $(call MkuImageLzma,$(2),$(3) $(4),-d20,,-M $(5))<br />&nbsp; &nbsp; &nbsp; &nbsp; -rm -rf $(KDIR_TMP)/$(2)<br />&nbsp; &nbsp; &nbsp; &nbsp; mkdir -p $(KDIR_TMP)/$(2)/image<br />&nbsp; &nbsp; &nbsp; &nbsp; cat $(KDIR_TMP)/vmlinux-$(2).uImage &gt; $(KDIR_TMP)/$(2)/image/uImage<br />&nbsp; &nbsp; &nbsp; &nbsp; $(STAGING_DIR_HOST)/bin/mksquashfs-lzma \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $(KDIR_TMP)/$(2) $(KDIR_TMP)/vmlinux-$(2).uImage.squashfs.tmp1 \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -noappend -root-owned -be -b 65536<br />&nbsp; &nbsp; &nbsp; &nbsp; ( \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cat $(KDIR_TMP)/vmlinux-$(2).uImage.squashfs.tmp1; \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dd if=/dev/zero bs=1k count=1 \<br />&nbsp; &nbsp; &nbsp; &nbsp; ) &gt; $(KDIR_TMP)/vmlinux-$(2).uImage.squashfs.tmp2<br />&nbsp; &nbsp; &nbsp; &nbsp; mkimage -A mips -O linux -T filesystem -C none -M $(5) \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -a 0xbf070000 -e 0xbf070000 \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -n &#039;MIPS OpenWrt Linux-$(LINUX_VERSION)&#039; \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -d $(KDIR_TMP)/vmlinux-$(2).uImage.squashfs.tmp2 \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $(KDIR_TMP)/vmlinux-$(2).uImage.squashfs<br />endef</p></blockquote></div><p>I am wondering how bukington and respectively rpsoft managed to generate the correct squashfs file. <br />Does anyone know how this could be done?</p><p>Thanks in advance,<br />Franz</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p236682">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">Growell</div>
					<div class="post-datetime">
						13 Jun 2014, 19:21					</div>
				</div>
				<div class="post-content content">
					<p>Hi franz,<br />I to am trying to get openwrt running on my wnr2000v4. How exactly did you apply the patch that you linked to?<br />When i copy OpenWrt-Devel-ar71xx-Add-platform-machine-support-for-the-WNR2000v4.patch into /openwrt/trunk/ and run </p><div class="codebox"><pre><code>git apply OpenWrt-Devel-ar71xx-Add-platform-machine-support-for-the-WNR2000v4.patch</code></pre></div><p> i recieve this error message:</p><div class="codebox"><pre><code>OpenWrt-Devel-ar71xx-Add-platform-machine-support-for-the-WNR2000v4.patch:55: trailing whitespace.
 *  under the terms of the GNU General Public License version 2 as 
OpenWrt-Devel-ar71xx-Add-platform-machine-support-for-the-WNR2000v4.patch:150: trailing whitespace.
    
OpenWrt-Devel-ar71xx-Add-platform-machine-support-for-the-WNR2000v4.patch:152: trailing whitespace.
    
fatal: corrupt patch at line 206</code></pre></div>											<p class="post-edited">(Last edited by <strong>Growell</strong> on 13 Jun 2014, 19:44)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p237189">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">franz.flasch</div>
					<div class="post-datetime">
						18 Jun 2014, 14:50					</div>
				</div>
				<div class="post-content content">
					<p>Hi Growell!</p><p>Sorry for the late response. The patch above is buggy, I couldn&#039;t apply it either I just edited the changes manually to get it to work. However the patch is not complete it doesn&#039;t work only with these changes. There were several additional changes necessary to get the device to work. I can provide a full patch if you want, I will try to upload it here in the evening (when I get away from work).</p><p>Regards,<br />Franz</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p237201">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">Growell</div>
					<div class="post-datetime">
						18 Jun 2014, 16:14					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for responding Franz,</p><p>It would be much appreciated if you post that patch as manually applying the changes was my next move. Once that is applied can you successfully connect to the internet? Right now I am able to flash only sysupdgrade.bin files, whether it is one that I generate or the one you linked to and find the following relevant lines during bootup (using serial):<br /></p><div class="codebox"><pre><code>[   11.990000] ath: Invalid EEPROM contents
[   11.990000] ath9k ar934x_wmac: failed to initialize device
[   12.000000] ath9k: probe of ar934x_wmac failed with error -22
[   17.720000] IPv6: ADDRCONF(NETDEV_UP): eth0: link is not ready
[   17.720000] device eth0 entered promiscuous mode
[   17.740000] IPv6: ADDRCONF(NETDEV_UP): br-lan: link is not ready
[   17.780000] IPv6: ADDRCONF(NETDEV_UP): eth1: link is not ready
[   18.320000] eth0: link up (1000Mbps/Full duplex)
[   18.320000] br-lan: port 1(eth0) entered forwarding state
[   18.330000] br-lan: port 1(eth0) entered forwarding state
[   18.330000] IPv6: ADDRCONF(NETDEV_CHANGE): eth0: link becomes ready
[   18.440000] IPv6: ADDRCONF(NETDEV_CHANGE): br-lan: link becomes ready
[   20.150000] eth1: link up (100Mbps/Full duplex)
[   20.150000] IPv6: ADDRCONF(NETDEV_CHANGE): eth1: link becomes ready
[   20.330000] br-lan: port 1(eth0) entered forwarding state

[  180.820000] eth0: link down
[  180.820000] br-lan: port 1(eth0) entered disabled state</code></pre></div><p>Also are you using <a href="https://forum.openwrt.org/viewtopic.php?pid=124422#p124422/">fuhry&#039;s u-boot environment</a>? I had no luck applying that, but was able to change the environment variables with <br /></p><div class="codebox"><pre><code>setenv bootcmd bootn 0x9f040000
saveenv</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p237224">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">franz.flasch</div>
					<div class="post-datetime">
						18 Jun 2014, 18:35					</div>
				</div>
				<div class="post-content content">
					<p>Hi Growell!</p><p>Until now I only tested the ethernet connection which is working just fine. I am sure wifi is working as well, however it might be necessary to install some wifi related packages to make it fully work.</p><p>Concerning the sysupgrade: Did you already manage to generate your own sysupgrade file? If yes, how did you do that? My changeset is a pretty ugly hack and at the moment I only generated the ramfs and the sysupgrade files.</p><p>I do not use fuhry&#039;s u-boot environment, as you already mentioned this cmd is adequate to disable the netgear firmware check.</p><div class="codebox"><pre><code>setenv bootcmd bootm 0x9f040000
saveenv</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p237226">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">Growell</div>
					<div class="post-datetime">
						18 Jun 2014, 18:51					</div>
				</div>
				<div class="post-content content">
					<p>At the moment I cannot even communicate with the router via ethernet unless I boot into failsafe and even then all I can do is telnet in. As for generating a sysupgrade&nbsp; file I followed the instructions on <a href="http://wiki.openwrt.org/doc/howto/buildroot.exigence#svn">this</a> page to set up a buildroot environment. Summed up:<br /></p><div class="codebox"><pre><code>mkdir ~/openwrt
svn co svn://svn.openwrt.org/openwrt/trunk/
cd ~/openwrt/trunk
./scripts/feeds update -a
./scripts/feeds install -a
make menuconfig
#Configure the package that you want installed now#
make</code></pre></div><p>then your generated sysupgrade file would be located at for example:<br /></p><div class="codebox"><pre><code> ~/openwrt/trunk/bin/ar71xx/openwrt-ar71xx-generic-ap81-squashfs-sysupgrade.bin</code></pre></div><p>However I might add that I haven&#039;t gotten a functional one working yet as I am very new to this whole process.</p>											<p class="post-edited">(Last edited by <strong>Growell</strong> on 18 Jun 2014, 18:52)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p237239">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">franz.flasch</div>
					<div class="post-datetime">
						18 Jun 2014, 20:51					</div>
				</div>
				<div class="post-content content">
					<p>OK. It&#039;s clear that this doesn&#039;t work. You cannot just take any sysupgrade file which was created. The sysupgrade must match your device. As the WNR2000v4 is not supported at the moment you&#039;ll not find a suitable sysupgrade for your device.</p><p>You can try with this patch:</p><p><a href="http://www.filedropper.com/wnr2000v4">http://www.filedropper.com/wnr2000v4</a></p><p>You can apply it like this (from the root of openwrt)</p><div class="codebox"><pre><code>patch -p1 &lt; wnr2000v4.patch</code></pre></div><p>Now you have to run make menuconfig and choose the new device NETGEAR WNR2000v4 (under Target Profile)<br />Then just run:<br />make V=s</p><p>You&#039;ll find the sysupgrade image within the bin folder - it is called &quot;testfile&quot; - sorry for that <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> I was testing it and did not rename it to the right name.</p><p>With this changes the WNR2000v4 should work with the newest openwrt, however my changes are quite ugly maybe someone can beautify this and put it to mainline - Unfortunately I&#039;ve no time for this now...</p><p>Regards,<br />Franz</p>											<p class="post-edited">(Last edited by <strong>franz.flasch</strong> on 18 Jun 2014, 20:54)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p237242">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">Growell</div>
					<div class="post-datetime">
						18 Jun 2014, 21:19					</div>
				</div>
				<div class="post-content content">
					<p>Yeah i figured that out...&nbsp; I just tried this on the trunk build and the patch appeared to apply but when I run </p><div class="codebox"><pre><code>make menuconfig</code></pre></div><p> &quot;NETGEAR WNR2000v4&quot; does not appear. Any ideas? </p><p>thanks for the patch!</p><p>**Scratch that i got it to show**<br />for the record it will not show up if you use the ./scripts/feeds line that i posted above</p>											<p class="post-edited">(Last edited by <strong>Growell</strong> on 18 Jun 2014, 21:33)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p237945">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">Growell</div>
					<div class="post-datetime">
						24 Jun 2014, 23:57					</div>
				</div>
				<div class="post-content content">
					<p>So I currently am able to create custom images and flash them onto the WNR2000v4. The process below is the method that I am using. However this is still very much experimental so follow at your own risk. To my knowledge the only way to get this to work is by using a serial cable (Somebody feel free to prove me wrong). I am <strong><span class="bbu">NOT!</span></strong> responsible if you manage to brick your router by following this.</p><p>The process is as follows:</p><ol class="decimal"><li><p>Remove Firmware Check</p></li><li><p>Setup Buildroot and Create a Custom Image</p></li><li><p>Flash Custom Image</p></li><li><p>Basic Setup</p></li></ol><h5>Remove Firmware Check</h5><p>From the serial console during boot up you should see:</p><div class="codebox"><pre><code>Hit any key to stop autoboot:  1</code></pre></div><p>So press any button...<br />You know you made it in time when you see:</p><div class="codebox"><pre><code>ar7240&gt;</code></pre></div><p>Next enter</p><div class="codebox"><pre><code>setenv bootcmd bootm 0x9f040000
saveenv</code></pre></div><h5>Setup Buildroot and Create a Custom Image</h5><p>I followed <a href="http://wiki.openwrt.org/doc/howto/buildroot.exigence">this</a> wiki page but to sum it up:</p><div class="codebox"><pre><code>mkdir ~/openwrt
cd ~/openwrt
svn co svn://svn.openwrt.org/openwrt/trunk/
cd trunk</code></pre></div><p>Next I apply the patch that Franz so kindly provided <a href="http://www.filedropper.com/wnr2000v4">here</a>.<br />Here&#039;s another <a href="https://www.dropbox.com/s/t8u8asc15nnhgi9/wnr2000v4.patch">link</a> to the same patch except it creates a more descriptive image name.</p><div class="codebox"><pre><code>patch -p1 &lt; ~/Downloads/wnr2000v4.patch</code></pre></div><p>After the patch is applied then we can install feeds (optional)</p><div class="codebox"><pre><code>./scripts/feeds update -a
./scripts/feeds install -a</code></pre></div><p>Now configure the packages that you want installed and sit back and wait for it to compile</p><div class="codebox"><pre><code>make menuconfig
make V=s</code></pre></div><h5>Flash Custom Image</h5><p>Once its done compiling you will find your image at ~/openwrt/trunk/bin/openwrt-ar71xx-wnr2000v4-sysupgrade.bin<br /><strong><span class="bbu">Note!!!</span></strong> if you you use the patch that Franz provided the file will be called <strong>testfile</strong></p><p>If you don&#039;t want to setup a Buildroot you can use <a href="http://%20https://www.dropbox.com/s/4eb1pqlpgy397fd/openwrt-ar71xx-wnr2000v4-sysupgrade.bin">this</a> basic image I&#039;ve created. </p><p>In order to get the image onto the router I set up a <a href="http://askubuntu.com/questions/201505/how-do-i-install-and-run-a-tftp-server">tftp server</a> although you could use a different approach. I will skip setting up the tftp server.</p><div class="codebox"><pre><code>mv ~/openwrt/trunk/bin/openwrt-ar71xx-wnr2000v4-sysupgrade.bin /tftpboot</code></pre></div><p>From the serial console or telnet (follow <a href="http://wiki.openwrt.org/toh/netgear/telnet.console">link</a> to enable telnet access)<br />I assume your computers ip address is 192.168.1.2 and your tftp server is setup on port 69.<br /><strong>WARNING!</strong> unplugging your router while it is flashing the firmware is like playing with fire. Unless you are prepared to get burned (ie brick your router) <strong>Don&#039;t unplug it!!!</strong> </p><div class="codebox"><pre><code>cd /tmp
tftp -g -r openwrt-ar71xx-wnr2000v4-sysupgrade.bin 192.168.1.2 69
mtd -r -f write openwrt-ar71xx-wnr2000v4-sysupgrade.bin firmware</code></pre></div><h5>Basic Setup</h5><p>Ethernet should work out of the box but wireless needs to be enabled by editing /etc/config/wireless<br />By default the contents of /etc/config/wireless are:<br /></p><div class="codebox"><pre><code>config wifi-device  radio0
        option type     mac80211
        option channel  11
        option hwmode   11g
        option path     &#039;platform/ar934x_wmac&#039;
        option htmode   HT20
        # REMOVE THIS LINE TO ENABLE WIFI:
        option disabled 1

config wifi-iface
        option device   radio0
        option network  lan
        option mode     ap
        option ssid     OpenWrt
        option encryption none</code></pre></div><p>To enable wireless change to:<br /></p><div class="codebox"><pre><code>config wifi-device  radio0
        option type     mac80211
        option channel  11
        option hwmode   11g
        option path     &#039;platform/ar934x_wmac&#039;
        option htmode   HT20
        # REMOVE THIS LINE TO ENABLE WIFI:
        option disabled 0

config wifi-iface
        option device   radio0
        option network  lan
        option mode     ap
        option ssid     OpenWrt
        option encryption none</code></pre></div><p>Hopefully this helps someone out!</p>											<p class="post-edited">(Last edited by <strong>Growell</strong> on 24 Jun 2014, 23:58)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p237984">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">franz.flasch</div>
					<div class="post-datetime">
						25 Jun 2014, 12:16					</div>
				</div>
				<div class="post-content content">
					<p>Hi Growell!</p><p>Thanks for the nice tutorial! I only fear that this patch won&#039;t apply anymore in the future if there are many changes on these files. I hope someone takes pity on the WNR2000v4 and puts this on mainline, otherwise we have to re-modify the sources again and again to keep the WNR2000v4 up to date.</p><p>Anyway, thank you for this tutorial!</p><p>Regards,<br />Franz</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p252985">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">bukington</div>
					<div class="post-datetime">
						3 Nov 2014, 19:47					</div>
				</div>
				<div class="post-content content">
					<p>Hi !</p><p>I&#039;ve (finally) upload my patch on github (<a href="https://github.com/bukington/openwrt/commit/8a9444bd2af83fe648c9ce14683b11866e11b072">https://github.com/bukington/openwrt/co … 866e11b072</a>) and also start the process to upstream it : <a href="https://lists.openwrt.org/pipermail/openwrt-devel/2014-November/029094.html">https://lists.openwrt.org/pipermail/ope … 29094.html</a><br />I hope I&#039;ll manage to get it merged.</p><p>I&#039;m running this setup since a while now (almost a year) without any issues. It still requires physical serial access for the first flash. In theory it should be possible to build a bootstrap image flashable from official firmware but I didn&#039;t manage to make a 3.10 kernel image lighter than 832kb (needed for stock uboot to boot the image).... Maybe I&#039;ll try to do something with Netgear opensource package.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p253262">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">bukington</div>
					<div class="post-datetime">
						6 Nov 2014, 00:18					</div>
				</div>
				<div class="post-content content">
					<p>Good news, patch has been merged.</p><p>Not sure I ever mentionned it, but I managed to get USB working as it&#039;s supported by AR9341.<br />I power it with 3,3v which seems to be enough for an USB key (currently experimenting extroot on it).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p255214">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">franz.flasch</div>
					<div class="post-datetime">
						22 Nov 2014, 17:53					</div>
				</div>
				<div class="post-content content">
					<p>Hi bukington!</p><p>I recently tested it with the latest version of openwrt. Works perfectly, thanks!</p><p>How do you connect your USB key? Are there any solderpads which can be used for the USB port?</p><p>Thanks, <br />Franz</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p255217">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">franz.flasch</div>
					<div class="post-datetime">
						22 Nov 2014, 18:51					</div>
				</div>
				<div class="post-content content">
					<p>Just realized that it doesn&#039;t work that perfectly... Please check the lan ports - none of them works, also the leds are wrong configured. With the patch which I&#039;ve provided above everything seems to work just fine. It seems we have to compare the mach-files and check what is wrong.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p255937">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">bukington</div>
					<div class="post-datetime">
						29 Nov 2014, 15:14					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>franz.flasch wrote:</cite><blockquote><p>Just realized that it doesn&#039;t work that perfectly... Please check the lan ports - none of them works, also the leds are wrong configured. With the patch which I&#039;ve provided above everything seems to work just fine. It seems we have to compare the mach-files and check what is wrong.</p></blockquote></div><p>Hi Franz,</p><p>I&#039;m surprised you have such issues.... Seems to me that leds are OK.... Same for LAN ports.<br />I&#039;ll try to do some testing just to be sure.</p><p>Maybe what you&#039;re experiencing is related to some issues I see since some weeks in trunk (not related to<br />my changes I guess), which leads to some incorrect behavior (sometimes lan ports stop to work), and I see some<br />kernel message error:<br />[224041.010000] eth1: tx timeout<br />[224041.010000] eth1: link down</p><p>Regarding USB, data pins needs to be soldered on Motherboard:<br /><span class="postimg"><img src="http://i.imgur.com/Isg85T1.jpg" alt="AR9341 pins" /></span></p><p>By chance on our routeur they&#039;re easily accessible as TP29-TP30. For GND and +5 I&#039;v used GND and +3.3 from serial<br />port.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p256409">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">franz.flasch</div>
					<div class="post-datetime">
						3 Dec 2014, 14:11					</div>
				</div>
				<div class="post-content content">
					<p>Hi bukington!</p><p>Thanks for the answer! I expierenced issues with the leds of the lan ports. Example: When I plugin the ethernet cable to the lanport 1 the orange led of another lanport was turned on - not sure which lan port it was, I can retest it if you want. Furthermore none of the lanports actually worked I am not sure but it could be that the errors you mentioned above appeared.</p><p>I replaced the mach file with the mach file which I&#039;ve provided in the patch above - and now the lan ports work perfectly. Only some of the leds are not configured properly.</p><p>If I&#039;ve got the time I will retest your solution and check what&#039;s the problem with the machfile. </p><p>Regards,<br />Franz</p><p>PS: Thanks for the hint with the USB pins - That&#039;s great, with this mod I can extend the memory which is very limited on this device! <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>											<p class="post-edited">(Last edited by <strong>franz.flasch</strong> on 3 Dec 2014, 14:12)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p256412">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">bukington</div>
					<div class="post-datetime">
						3 Dec 2014, 14:41					</div>
				</div>
				<div class="post-content content">
					<p>Franz,</p><p>Extroot is working fine for me on USB key, that&#039;s a good news given the space available on board <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /><br />Thanks if you can patch the leds... should be some confusion is my mach file.<br />I saw that we used different gpio for leds (green vs ambers).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p259683">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">detector42</div>
					<div class="post-datetime">
						3 Jan 2015, 17:03					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>bukington wrote:</cite><blockquote><p>Franz,</p><p>Extroot is working fine for me on USB key, that&#039;s a good news given the space available on board <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /><br />Thanks if you can patch the leds... should be some confusion is my mach file.<br />I saw that we used different gpio for leds (green vs ambers).</p></blockquote></div><p>I am installing OpenWrt for the first time and having some problems. I first tried the build linked in #9, but I couldn&#039;t get the new package system to work with it. Everything else seemed to work though. When I tried to compile my own it first failed when i used svn, and franz&#039;s patch didn&#039;t work with either svn or git. I managed to get a booting build when I used git, but there was no working networking whatsoever.<br />Could you upload a working compiled build?</p>											<p class="post-edited">(Last edited by <strong>detector42</strong> on 3 Jan 2015, 17:04)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p260861">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">franz.flasch</div>
					<div class="post-datetime">
						10 Jan 2015, 20:13					</div>
				</div>
				<div class="post-content content">
					<p>Hi detector42!</p><p>It seems we ran into the same problems with the &quot;official&quot; WNR2000v4 support. The network didn&#039;t work either when I tested it. However if you exchange the file mach-wnr2000v4 with the one I provided in my patch the networking support is working fine. You can try it if you want.</p><p>Regards,<br />Franz</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p263631">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">bukington</div>
					<div class="post-datetime">
						31 Jan 2015, 16:30					</div>
				</div>
				<div class="post-content content">
					<p>That&#039;s really weird, I need to find some time to dig this but I&#039;m not sure to be able to reproduce the issue.....</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p270818">
				<div class="post-metadata">
					<div class="post-num">Post #21</div>
					<div class="post-author">lcy92</div>
					<div class="post-datetime">
						1 Apr 2015, 14:27					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>franz.flasch wrote:</cite><blockquote><p>Hi detector42!</p><p>It seems we ran into the same problems with the &quot;official&quot; WNR2000v4 support. The network didn&#039;t work either when I tested it. However if you exchange the file mach-wnr2000v4 with the one I provided in my patch the networking support is working fine. You can try it if you want.</p><p>Regards,<br />Franz</p></blockquote></div><p>Hi Franz,</p><p><strong>(Sorry for my poor English since I am not a native English speaker.)</strong></p><p>I&#039;m a newbie in openwrt. I&#039;ve just purchased a wnr2000v4 and want to replace its original firmware with openwrt so that it could pass the 802.1x authentication of our school&#039;s network. I&#039;ve met some problems posted below. I&#039;m wondering if you may help.....</p><p>I&#039;ve met the EXACTLY same problem with your post #16 while my first try following Growell&#039;s guide except that I used a compiled image provided<a href="https://downloads.openwrt.org/snapshots/trunk/ar71xx/generic/openwrt-ar71xx-generic-wnr2000v4-squashfs-sysupgrade.bin"> here</a>. </p><p>In my second try, I replaced the firmware with the basic image provided by Growell in #9. The lan ports worked fine. In short, I think I&#039;ve met the same problem with you in opposite way. Are there two versions of wnr2000v4 that their lan ports does not share the same address? What&#039;s the difference between the two patches?</p><p>Another problem is that during my second try using Growell&#039;s image, my router got reset whenever I reboot it. Every time I reboot it, changes I made and modules I installed disappeared as though I have never done so. Why this happened? Were there anything missed in Growell&#039;s guide?</p><p>Thanks for help!</p>											<p class="post-edited">(Last edited by <strong>lcy92</strong> on 1 Apr 2015, 14:30)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p272213">
				<div class="post-metadata">
					<div class="post-num">Post #22</div>
					<div class="post-author">bazz</div>
					<div class="post-datetime">
						12 Apr 2015, 23:37					</div>
				</div>
				<div class="post-content content">
					<p><strong>important discoveries</strong> </p><p>1. Go into U-Boot prompt and update the env variable AFTER you flash the device.. not before. use the &#039;boot&#039; cmd to proceed forward.</p><p>2. In order to subvert the device not saving its settings after reboot, run the command &#039;mtd erase rootfs_data&#039; then reboot. Afterwards, settings should save. like they do for me. </p><p>All of my experience was based on Growell&#039;s &quot;basic&quot; image. My wireless and ethernet works as directed in Growell&#039;s tutorial.</p><p>3. I later got ambitious and tried flashing the WNR200v4 image hosted at <a href="http://downloads.openwrt.org/snapshots/trunk/ar71xx/generic/">http://downloads.openwrt.org/snapshots/ … x/generic/</a> I flashed in the same way as flashing the basic image.. but this image, the LEDs were messed up.. Wrong led on ethernet and wrong colors, and the ethernet jacks did not function, so I could not repair.. I will have to re-install stock firmware via FACTORY reset.</p><p>4. Netgear 1.0.0.58 is the only firmware I can use to gain rootshell via UDP telnetenable hack.. I modified the python telnetenable.. I am writing my own wiki with details.. Coming soon</p><p>5. growell&#039;s Basic Open-wrt image cannot be flashed via FACTORY RESET mode [by holding factory reset until serial shows the factory reset message, continue holding button down as you send image via TFTP, release button after TFTP transfers start ACKing] because of Checksum failures.. So the image must be flashed via root shell in stock netgear firmware. HOW to make a firmware that passes the checksum??</p><p>6. Accessing U-boot &#039;terminal&#039; by stopping auto-boot functions fine, but when using the serial terminal to access both the stock netgear firmware or new open-wrt firmware&#039;s root linux console, there are issues with the input. At first I thought it was my fault, but like I said, U-Boot functions perfectly with its keyboard input, but the open-wrt is mangling my input, making it EXTREMELY difficult to enter commands without them failing, because it is inserting weird characters...<br /><strong>Questions</strong><br />I have a lot of questions. I&#039;m new to open-wrt + compiling kernel manually. </p><p>1. for the D+ D- USB lines, do any resistors need to be connected? How is the 3.3V working for VCC, must it not be 5V?</p><p>2. In make menuconfig, do you include the bootloader U-Boot, or is this bootloader automatically already present in the Router. </p><p>3. I am right now compiling a kernel with U-boot attached and Luci, because I want the web interface.. I set filesystem to JFFS2 like the basic image was... I hope it will work.. I think the image has to be &lt; 4MB because of flash limitation.. Anything else? If Growell is reading this, could you please detail your setup of the basic image, so I can repeat the setup and include Luci in my own configuration.</p><p>4. The compilation was successful but I do not see a sysupgrade image anywhere, and I can&#039;t figure out how to generate one...</p><p><strong>VLAN</strong><br />I want to ask more questions, about VLAN.. In Open-WRT VLAN documentation, there are port numbers, usually 0-5, and 4 is unused [says the documentation]. However in WNR200v4, the ports in the switch /etc/config/network are 0 1 2 3 4.&nbsp; I am trying to figure how they correspond to actual router port numbers as displayed, and also the mythical CPU port. </p><p>From my dabbling with swconfig, the port 0 is the CPU port, because it is always listed as connected even when no ports are connected on the router.. port 1-4 seem to be the ethernet switch, and the WAN port does not seem to be included. It may be Port 5.. And why is this not included in the Switch configuration?? In the open-wrt docs, port 5 is often included... Please correct me, I am new to ALL of this.. </p><p><strong>Compiling kernel</strong><br />if I change options in make menuconfig, can I just do a make after that, or must I make clean first?? Perhaps another option?</p><p><strong>RAMDISK boot</strong><br />Anyone have advice how to do this properly in WNR2000v4? I imagine it would make testing changes to the kernel easier / faster.. A sort of possible solution has been offered at <a href="http://wiki.openwrt.org/doc/howto/generic.flashing">http://wiki.openwrt.org/doc/howto/generic.flashing</a> ,</p><br /><p><strong>My Desired Network Configuration</strong><br />The purpose I am doing this is because I want a special network. <br />1 ethernet must be segmented from the other 3 ethernet + wlan. I want to use VLAN to avoid IP spoofing subnet hacks, rather than subnetting and firewall trafficking. I hope someone understands and can guide me.. I&#039;m very new and I have broken my networking many times already LOL.</p>											<p class="post-edited">(Last edited by <strong>bazz</strong> on 13 Apr 2015, 17:39)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p272488">
				<div class="post-metadata">
					<div class="post-num">Post #23</div>
					<div class="post-author">lcy92</div>
					<div class="post-datetime">
						14 Apr 2015, 17:03					</div>
				</div>
				<div class="post-content content">
					<p>Bazz: <br />Thanks for your discoveries! It seems we are in the same trouble flashing the &quot;newest&quot; image. Could you please tell me how can I recover my changes on U-boot env?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p272560">
				<div class="post-metadata">
					<div class="post-num">Post #24</div>
					<div class="post-author">bazz</div>
					<div class="post-datetime">
						15 Apr 2015, 04:28					</div>
				</div>
				<div class="post-content content">
					<p><span class="postimg"><img src="https://scontent-lga.xx.fbcdn.net/hphotos-xtp1/v/t1.0-9/11040403_10152719696587624_8010448282179710264_n.jpg?oh=bd370d655bb6f0729c34a688ccdd5c3d&amp;oe=55D9076D" alt="https://scontent-lga.xx.fbcdn.net/hphotos-xtp1/v/t1.0-9/11040403_10152719696587624_8010448282179710264_n.jpg?oh=bd370d655bb6f0729c34a688ccdd5c3d&amp;amp;oe=55D9076D" /></span></p><p>Welcome to my longest post yet. Shoutz to Bukington for the USB pic, Growell and Franz for their great contributions.</p><p>For the most part I&#039;m going to be shining light on things, but I am still a n00b and need help sometimes, so please consider reading about my questions if you are an expert. My questions will be at the bottom of the article in its own section.</p><p>Long story short I&#039;ve figured out a lot and I&#039;m working on compiling the information on my wiki, and later disseminating it to this thread.<br />Here are some things I&#039;ve accomplished since: <br /></p><ul><li><p>How To Compile a Latest, Working Image</p></li><li><p>How to Fix the LED issue</p></li><li><p>How to Achieve my Desire VLAN Setup</p></li><li><p>How to Successully mod with USB flash drive ExtRoot</p></li></ul><p>Bare in mind, I am a novice so I am all-encompassing all the knowledge.<br />I realize I may be iterating some information that can be found All over the web, wiki, and forums, so I have brought it to you here in one format.</p><h5>New Firmware Images <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></h5><p><strong>Update</strong><br />It just dawned on me, there&#039;s no reason to use these images over Growell&#039;s basic image. At first, I thought to produce images so that you could use opkg.. but the thing is that the snapshot git moves so fast, that they can easily become incompatible again.. So the best way is to compile yourself, and then add as modules &lt;M&gt; any new packages you want later in make menuconfig.. those will get compiled as IPK when you make.. and you can send them to router for opkg install..<br />&lt;/update&gt;</p><p>So first off, the impression that was made upon this thread is that the latest trunk is mangled (bad LEDS, ethernet broken), and that by applyng franz&#039;s patch it will be fixed again. Since I&#039;ve done all this and more, let me elaborate. </p><p>Since a month or more had passed since the last post, I decided to try the trunk image, or trunk compile stock, and see if progress had been made. both still behaved badly, same issues as talked about. Bad ethernet, bad LEDS. </p><p>So I patched the mach-file with franz&#039;s patch.<br />Not only should the mach-file be patched, but also since ./target/linux/ar71xx/base-files/etc/uci-defaults/01_leds has been changed to use wnr2000v4 led prefix, his patch must also reflect that, or vice-versa. So I&#039;ve done all of that, I&#039;m learning how to create a patchfile, will update.</p><p><strong>Non-USB image that is already outdated hehe</strong><br />Yes it&#039;s not as good as USB image but still great -- if I could find some help on the green LEDS you will see me talking about later, I need help on that. </p><p>This image is outdated because I made the USB mod, and have done a lot of work with the USB mod I don&#039;t look back.. Also there are discoveries I made after USB that&#039;s why only the USB has the new discoveries present and not this older-compiled image.. I hope it still serves your purposes well. We are cutting-edge after all <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>If you do not want to read my long tutorial, please consider downloading this no-USB version of the latest openwrt, however it lacks the latest bugfixes I have found <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" />. <a href="https://drive.google.com/file/d/0B7VI0K9knyDiaGE5SmxPWHR2YkU/view?usp=sharing">openwrt-ar71xx-generic-wnr2000v4-squashfs-sysupgrade.bin.nousb</a> </p><p>Your WLAN LED will not work for instance, Power LED doesn&#039;t work, and not all buttons supported.. Consider this temporary that you decide to use it. although I have fixed this issue privately. I can still help you patch at least the LEDS yourself. Buttons will require kernel patching, or when I release new image whatever. Please follow my instructions exactly, trust me. If you don&#039;t trust me it isn&#039;t going to work <img src="https://forum.openwrt.org/img/smilies/tongue.png" width="15" height="15" alt="tongue" />. <br />Edit /etc/config/system -- change all sysfs entries that say &#039;wnr2000-v4&#039; to say &#039;netgear&#039; instead&#039;. Save the file and do /etc/init.d/leds reload should work, if not, try reboot. </p><p><strong>USB enabled image that is brand-spanking new</strong><br />Only use this image if you are planning on doing USB mod, because it includes all the kernel modules required for it, and hence takes up more space. It also includes my latest patches. All buttons should be supported [untested] and all LEDS can be controlled/triggered except green LAN/WAN ones cannot yet be controlled [working on it, not sure if it&#039;s possible].. The thing about the green LEDS is that they seem to be controlled externally somehow. So they automatically blink on activity even tho they are not configured in the BSP (board support package).<br /><a href="https://drive.google.com/file/d/0B7VI0K9knyDicGhRTlBmSWhkYnM/view?usp=sharing">openwrt-ar71xx-generic-wnr2000v4-squashfs-sysupgrade.bin.usb</a></p><p>Note: I could not add usbutils to this image [lsusb], because it made the image too big such that JFFS2 would not save.. It must be able to save in order to save an EXTROOT configuration.</p><p><strong>Note on Flashing my images</strong><br />If you flash these images from Stock Netgear 1.0.0.58 [other versions untested], you may have to use the -f flag in mtd command.. otherwise it complains &quot;image verification failed&quot; or something.. but the image is legit and it flashes successfully when forced.<br /></p><div class="codebox"><pre><code>mtd -f -r write bazz_img.bin firmware</code></pre></div><p><strong>Note about sysupgrade image being SquashFS</strong><br />-- If you are n00b like me, do not be scared of SquashFS, it doesn&#039;t mean that your Linux installation is read-only, its just the firmware image, it will later use JFFS2 automatically.</p><p>If you want a USB-enabled image, with all LEDS working, you are in luck. It is my latest image so has all the bug fixes.</p><br /><br /><h5>How to Unbrick</h5><p>I am not talking about any brick.. I mean if you flashed the firmware, not the bootloader, like from Growell&#039;s tutorial:<br /></p><div class="codebox"><pre><code>mtd -r write blabla.img firmware</code></pre></div><p>In case you have bricked your router this way, there is one way I am familiar with to restore it -- Restore factory image. It is the last solution I post. First are some untested solutions I assume you will skip but I am interested in.</p><p>Of course, you could use the serial terminal shell right? But mine did not function properly, so I could not :[. So these are the other solutions you can try. </p><p><strong>Untested: Boot into FailSafe mode</strong><br />You do this over serial line when it asks you to press keys at bootup. We want to see if we can get ethernet working.</p><p><strong>Untested: Boot from RamDisk</strong><br />I have not yet learned this, but if a small,reliable,checksum passing RamDisk unbrick image could be made, it is a faster recovery than the next method, which is the only method I know. </p><p><strong>Tested: Restore Factory image capable of Telnet Root</strong><br />From my experience, I can only get telnetenable working with <a href="http://kb.netgear.com/app/answers/detail/a_id/26592/~/wnr2000v4-firmware-version-1.0.0.58">NetGear firmware 1.0.0.58</a>. Download the img. </p><p>Must have tftp client. ie. sudo apt-get install tftp</p><p>You can try doing this without serial terminal, just wait a long time <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /> holding the button down. But it&#039;s advocated that you work towards getting your serial hooked up if you don&#039;t want headaches down the road.</p><p>This is not a script, I want you to open TFTP and execute the following commands. lines starting with # are just comments from me to you, do not write them in.<br /></p><div class="codebox"><pre><code># execute following commands in tftp
binary
rexmt 1
trace
connect 192.168.1.1
# no connection has been made yet. ;)

# Now, holding down the factory reset button on wnr2000v4, turn it on, watch serial console, 
# you will see eventually it start flashing &quot;Factory Reset&quot; -- keep the button held still! 
# wait until you see it say a different thing and it will also say the TFTPD has started listening.
# now you can run this next command
put bla-bla-insurance-person-come-help.bin
# you put the netgear firmware</code></pre></div><p>Now that&#039;s done, you should see a bunch of ACK messages and data transfers. <br />NOTE: this method cannot be used to transfer openWrt images because they fail a Checksum check thing. </p><p>The image will be flashed and we will have stock firmware.. Now we must use UDP telnetenable. <br />Here is the one I use: <br />EXPERT NOTE: this is a mod of the TCP version and I did not modify the extended password parameter of UDP version.. but the stock router password is &#039;password&#039; which fits in the new model anyways..<br /><strong>UDPtelnetenable.py</strong><br /></p><div class="codebox"><pre><code>import sys
import socket
import array
from optparse import OptionParser
from Crypto.Cipher import Blowfish
from Crypto.Hash import MD5

TELNET_PORT = 23

# The version of Blowfish supplied for the telenetenable.c implementation
# assumes Big-Endian data, but the code does nothing to convert the
# little-endian stuff it&#039;s getting on intel to Big-Endian
#
# So, since Crypto.Cipher.Blowfish seems to assume native endianness, we need
# to byteswap our buffer before and after encrypting it
#
# This helper does the byteswapping on the string buffer
def ByteSwap(data):
  a = array.array(&#039;i&#039;)
  if(a.itemsize &lt; 4):
    a = array.array(&#039;L&#039;)
  
  if(a.itemsize != 4):
    print &quot;Need a type that is 4 bytes on your platform so we can fix the data!&quot;
    exit(1)

  a.fromstring(data)
  a.byteswap()
  return a.tostring()

def GeneratePayload(mac, username, password=&quot;&quot;):
  # Pad the input correctly
  assert(len(mac) &lt; 0x10)
  just_mac = mac.ljust(0x10, &quot;\x00&quot;)

  assert(len(username) &lt;= 0x10)
  just_username = username.ljust(0x10, &quot;\x00&quot;)
  
  assert(len(password) &lt;= 0x10)
  just_password = password.ljust(0x10, &quot;\x00&quot;)

  cleartext = (just_mac + just_username + just_password).ljust(0x70, &#039;\x00&#039;)
  md5_key = MD5.new(cleartext).digest()

  payload = ByteSwap((md5_key + cleartext).ljust(0x80, &quot;\x00&quot;))
  
  secret_key = &quot;AMBIT_TELNET_ENABLE+&quot; + password

  return ByteSwap(Blowfish.new(secret_key, 1).encrypt(payload))


def SendPayload(ip, payload):
  for res in socket.getaddrinfo(ip, TELNET_PORT, socket.AF_INET, socket.SOCK_DGRAM, socket.IPPROTO_IP):
    af, socktype, proto, canonname, sa = res
    try:
      s = socket.socket(af, socktype, proto)
    except socket.error, msg:
      s = None
      continue

    try:
      s.connect(sa)
    except socket.error, msg:
      s.close()
      s= None
      continue
    break

  if s is None:
    print &quot;Could not connect to &#039;%s:%d&#039;&quot; % (ip, TELNET_PORT)
  else:
    s.send(payload)
    s.close()
    print &quot;Sent telnet enable payload to &#039;%s:%d&#039;&quot; % (ip, TELNET_PORT)
  
def main():
  args = sys.argv[1:]
  if len(args) &lt; 3 or len(args) &gt; 4:
    print &quot;usage: python telnetenable.py &lt;ip&gt; &lt;mac&gt; &lt;username&gt; [&lt;password&gt;]&quot;

  ip = args[0]
  mac = args[1]
  username = args[2]

  password = &quot;&quot;
  if len(args) == 4:
    password = args[3]

  payload = GeneratePayload(mac, username, password)
  SendPayload(ip, payload)

main()</code></pre></div><p>Now, with router on, and ethernet cable plugged from this computer, recommended ethernet port 1, shouldn&#039;t matter tho.. we run the following: <br /></p><div class="codebox"><pre><code>python UDPtelnetenable.py 192.168.1.1 [Router MAC] admin password</code></pre></div><p>Replace [ROUTER MAC] with your router&#039;s MAC address. This can easily be found over <a href="http://192.168.1.1">http://192.168.1.1</a> in your router&#039;s main Advanced Configuration page. The MAC must all uppercase and you MUST remove the &#039;:&#039; ie. 12:12:12:AA:BB:CC becomes 121212AABBCC</p><p>Next, try telnet 192.168.1.1 - and you should be inside an OpenWrt root shell.. You can resume your image flashing procedure now <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> Same as before, which we hosted a TFTP server on our machine as given in Growell&#039;s tutorial on page 1 of this thread. </p><h5> Getting by with Growell&#039;s Basic Img </h5><p>What happened with using Growell&#039;s image, and what might happen with mine as they age, is that opkg packages from internet became too different to be compatible.. This section is an archival purpose demonstrating pitfalls I ran into trying to get opkg to work on Growell&#039;s image, and you might face these problems with mine if you try to use mine in the coming months after posting.. When in doubt learn to build the source yourself. Fortunately I show you how now.</p><p>Even if you adapt your /etc/opkg.conf to point to the new repositories.. Here&#039;s how that would have looked [I do NOT recommend trying this, this is for archival purpose only: <br /></p><div class="codebox"><pre><code>src/gz base http://downloads.openwrt.org/snapshots/trunk/ar71xx/generic/packages/base
src/gz luci http://downloads.openwrt.org/snapshots/trunk/ar71xx/generic/packages/luci
src/gz management http://downloads.openwrt.org/snapshots/trunk/ar71xx/generic/packages/management
src/gz packages http://downloads.openwrt.org/snapshots/trunk/ar71xx/generic/packages/packages
src/gz routing http://downloads.openwrt.org/snapshots/trunk/ar71xx/generic/packages/routing
src/gz telephony http://downloads.openwrt.org/snapshots/trunk/ar71xx/generic/packages/telephonyroot</code></pre></div><p>But although this will enable opkg update to work, I cannot tell you how new packages will install well with it.. Because I initially decided to upgrade my installed packages, which is a BIG NONO on OpenWrt..&nbsp; It bricked my router effectively.. You can find more info about Why on wiki, but opkg is risky when doing remote installaton of new packages, due to possible mismatch in kernel properties or LibC stuff. Can someone shed light on proper way to rely on opkg?</p><p>Anyways, due to the problems I ran into with opkg, and because I want to learn about compiling kernels and modifying BSP (board support package), I opted to do some kernel hacking. Also, I figured opkg would work with a new compile [which it does, I effectively installed Luci and usbutils, granted I needed USB mod to have the memory <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> ]</p><h5>Current Trunk Shortcomings</h5><p>We&#039;ve already identified how the current trunk image [or even self-compiled from trunk image] is faulty. For me and at least one other, the result is ethernet does not work, and the LEDs are incorrect. Since ethernet is not working and firmware starts with no wireless, the device is effectively bricked, unless maybe your serial terminal root shell works, unlike me, then maybe you can save it without modifying kernel. But that&#039;s not curing the root problem anyways, a bug in the source code, yeah?</p><p>The last place this thread left off, was that franz.flasch mentioned the cure, that we can the router working again if we replace the current trunk&#039;s mach file with his old patch (hosted in Growell&#039;s tutorial) .. So what I did was take out just the mach file from the patch and made a machfile from it. This can be done because the patch for the mach file, is really the creation of a machfile.. Once I replaced the trunk mach file, my router was working again, but with caveats. [I figured out the fix too <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" />]</p><p>The problems you will see is that LEDs function properly, IIRC, except the WLAN will never light up.. IIRC sometimes power light is off as well.. Anyways the biggest issue was the WLAN.. But also, Franz&#039;s mach file doesn&#039;t have USB registration, and it also lacks full button support. </p><p>I will later identify how I combine the best of both worlds to create my own mach file comprised of both the trunk and Franz&#039;s mach files, so that I get the best mach file to date. WARNING: I have now modded my router to have USB port, and I am no longer sure if USB registration function in mach file firmware init causes issues with non-USB-router / kernel.</p><p>OK SO let&#039;s begin first by identifying, how can we build our own sysupgrade image from openwrt source?</p><h5>How To Compile a Latest, Working Image</h5><p>First off, Barrier Breaker is too old, there is no wnr2000v4 code in the release. So we must go from current trunk.</p><p>I will not explain any more on patchin the mach file. I will give important locations. <br />If you want to edit the mach file before attempting compilation, it will be at<br /></p><div class="codebox"><pre><code>target/linux/ar71xx/files/arch/mips/ath79/</code></pre></div><p>if you want to modify after you&#039;ve compiled once, you must change instead the<br /></p><div class="codebox"><pre><code>build_dir/target-mips_34kc_uClibc-0.9.33.2/linux-ar71xx_generic/linux-3.18.11/arch/mips/ath79/</code></pre></div><p> Take into account how your version numbers may be different. Also, I have buildroot take care of everything. I am not using external toolchain, take care the possibility that the paths might be different.</p><p>Next step is the Feeds, although Growell listed this as optional. I always do it -- it enables me to see all packages in make menuconfig. It does not actually install anything to kernel. Do the feeds like in Growell&#039;s tutorial.<br />I noticed a lot of <br /></p><div class="codebox"><pre><code>WARNING: No feed for package &#039;libyaml&#039; found, maybe it&#039;s already part of the standard packages?
WARNING: No feed for package &#039;libedit&#039; found, maybe it&#039;s already part of the standard packages?
WARNING: No feed for package &#039;sctp&#039; found, maybe it&#039;s already part of the standard packages?</code></pre></div><p> </p><p>But I never had any problems...</p><br /><p>then,</p><div class="codebox"><pre><code>make menuconfig</code></pre></div><p>Make sure Target SYstem is Atheros 7XXX/9XXX<br />Subtarget: Generic<br />Target Profile: Netgear WNR2000V4<br />Target Images: SquashFS</p><p>I don&#039;t recall changing anything else, but you&#039;re free to have a gander <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p><strong>Warning</strong>: the filesize of the image is very important.. If it&#039;s too big, JFFS2 won&#039;t be able to save on reboot, which will be bad... I had a case where 3407876 bytes was too big but 3604484 fit and kept JFFS2 functioning.. Mind you I used that image to mount a USB stick 4GB so <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" />... So if you just didn&#039;t change anything the image should be about 3145732 bytes, which is fine size.</p><p>When it&#039;s done successfully navigate to bin/ar71xx and that&#039;s where the sysupgrade image will be, among others.. I don&#039;t know how to use the other images, although I&#039;d love to learn what&#039;s the point of making a JFFS2 image if it already works with the Squash one.. anyways, you only need the sysupgrade image <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /> </p><p>You should be able to do the rest with all of the material laid out in this thread. [not post] see Growell&#039;s tutorial page 1</p><h5>How to Fix the LED issue</h5><p>For all the people wondering why is the LEDs messed up, and why do they work in franz patch? It took a lot of work and I cannot explain everything -- please understand I&#039;ve only been working with OpenWrt for 4 days.</p><p>There are 2 different LED issues I&#039;ve identified<br /></p><ul><li><p>Incorrect Amber LAN LEDS [Fixed] <br /> See Wiki [TBA]</p></li><li><p>Mysterious External control of Green segment of the LAN / WAN LEDS </p></li></ul><p>I&#039;ve discovered that all of the green LEDS on the board besides the WPS and POWER, seem to be controlled outside of /etc/config/system -- but from where??</p><p>They are not controlled in /etc/config/system, and they are no longer part of gpio_led structure. I cannot identify how they are controlled, but whomever submitted latest trunk knows this because they removed the green LEDS from the code as well.. However their LAN1-4 code is buggy and I fixed. The issue lies in incorrect port settings in /etc/config/system. I am still not sure why latest official code has no ethernet working out-of-box. But when I use Franz&#039;s mach, and correct the LED settings. I am golden.</p><p>I want to make patches and submit to official. How to do this? </p><h5>How to Achieve my Desired VLAN Setup</h5><p><strong>Warning</strong> I&#039;m super n00b at this. I hope someone can guide me.</p><p>I have an almost perfect setup, made possible with the graphical assistance of Luci. But I have further questions on it, so I am aiming to make a new thread asking for help. I can speak about what I&#039;ve done so far conceptually. </p><p>let me see here. I have it so Ethernet 1-3 and WLAN is on its own &#039;network&#039; for lack of better terms, and Ethernet 4 is on its own VLAN. I wonder if IP spoofing makes it possible to transcend the network boundaries, but I cannot answer myself.. </p><p>The initial VLAN configuration on wnr2000v4 openWrt is Vlan1 and ports 0-4 are all present and untagged.<br />port 0 is the elusive CPU port which I don&#039;t fully understand, but must be present on all VLANs, I think... (I don&#039;t actually know this). Ports 1-4 are respectively the real ethernet jack ports 1-4.<br />So I made another VLAN and since it has CPU port on more than one VLAN, cpu must now be tagged on both VLANS. <br />now, VLAN 1 is 0t 1 2 3<br />VLAN2 is 0t 4</p><p>Initial Net&nbsp; config is &#039;lan&#039; that WLAN0 and bridged with ETH1 (the ethernet switch). Eth0 is WAN FYI. <br />What I do is instead, bridge WLAN0 with ETH1.1.<br />I make a new network I call &#039;elan&#039; stands for ethernetLAN. This network is on a different subnet, so IP is 192.168.2.1 as an example. Whereas the <br />&#039;lan&#039; IP is 192.168.1.1<br />I set physical interface to eth1.2<br />any other settings are inspired from &#039;lan&#039; like netmask 255.255.255.0</p><p>I create a new firewall zone &quot;elan&quot; and set covered network to &quot;elan&quot; -- not sure what I&#039;m doing, for instance if I should have one zone cover both the elan and lan.. but probably not I speculate. Allow forward to WAN, but not the other way around.. [why does this work?] doesn&#039;t wan traffic need to come into these interfaces?? I&#039;m n00b..</p><p>In the circumstance my Ethernet 4 unit gets hacked.. I do not want to to be able to reach Luci or SSH of the router.. I also do not want gateways to respond to ping.. <br />So I add rules to reject traffic on TCP from ELAN to any router, <br />I also reject ICMP from ELAN to any router.</p><p>Question -- what is the difference between Device (input) and Any Zone (forward)</p><p>At this point, my configuration does seem to work. I&#039;ve tested with multiple computers, over wireless and ethernet. All results I am aiming for succeed. For example,<br />Ethernet computers and wireless are on same subnet. <br />Ethernet4 is on its own subnet.. <br />Communication appears impossible between ELAN and LAN. Not sure how to extensively test this or further test against hacking attempts.<br />Ping from ELAN to any gateway IP returns unreachable, as desired. <br />SSH from ELAN to openWrt is refused, either gateway address.</p><p>Good good, but I do have an issue.. In the System Log, I am getting this message a lot, and haven&#039;t found online a solution to it. I barely understand it [not network guru]<br /></p><div class="codebox"><pre><code>Wed Apr 15 00:39:49 2015 daemon.warn odhcpd[822]: A default route is present but there is no public prefix on eth1.2 thus we don&#039;t announce a default route!
Wed Apr 15 00:39:49 2015 daemon.warn odhcpd[822]: A default route is present but there is no public prefix on br-lan thus we don&#039;t announce a default route!</code></pre></div><p><strong>Update</strong> <br />Actually the messages shown above display pretty frequently even on a fresh openwrt installation... Wonder what&#039;s that all about?</p><h5>How to Successully mod with USB flash drive ExtRoot</h5><p>Earlier posts in this thread provided good pics and explanations. I can say a little more now that I&#039;ve successfully implemented this mod.. </p><p><strong>Physical</strong><br />As mentioned earlier in this thread, 3.3V is ok for the flash drive, and since I already have pin headers installed on the serial, I instead grabbed the 3.3V from a via located right beneat the PWR LED. you&#039;ll see 2 vias they both supply 3.3V.<br />For GND, I just use the shield framing. I suggest using pin headers so you can switch D+ and D- incase you screw up. <br />Also, keep D+ and D- as short as possible. My wires are about 3 inches to get right about the ethernet jacks where I&#039;ve mounted the USB socket with hot glue. I used to have longer wires and it wouldn&#039;t work. </p><p>Really great article here: <a href="https://forum.openwrt.org/viewtopic.php?id=37368">https://forum.openwrt.org/viewtopic.php?id=37368</a></p><p>Despite the article, I am doing OK without a filter capacitor and without resistors.. </p><p><strong>Kernel Modules Required</strong><br />kernel modules to enable in the kernel. I recommend compiling them in rather then relying on opkg [personal preference]. You can do a google search for openwrt mass storage usb to get an idea of the kernel modules.. but since I already figured it out I might as well try to see what exactly was necessary.. </p><p>make menuconfig</p><p>In menuconfig, navigate to kernel modules<br />block devices -&gt; kmod-scsi-core<br />filesystems -&gt; kmob-fs-ext4 -- because my USB is formatted ext4 [any advice on better filesystem?]<br />USB support -&gt; <br /></p><div class="codebox"><pre><code>kmod-usb-core
kmod-usb-storage
kmod-usb2</code></pre></div><p>Don&#039;t expect to format your drive on OpenWrt, don&#039;t install utilities to do that, there&#039;s no space right now! We barely have enough to keep JFFS2 operable. Instead, pre-format your drive on the computer.</p><p>Be sure not to install ANYTHING else, as merely be enabling the aforementioned kernels, there is barely enough space for JFFS2 to allow you to save config, which is required to update /etc/config/fstab in order to perform EXTROOT at boot. I tried installing usbutils atop these packages, but it was too big.</p><p>If you want to learn how to perform EXTROOT, there a couple ways to do it (pivot overlay vs. pivot root). Pivot Root is for whatever reason not recommended on ChaosCalmer, but I did it anyways {oops}, but I&#039;m having a fine time. So if you want to do that you can learn @ <a href="https://samhobbs.co.uk/2013/11/more-space-for-packages-with-extroot-on-your-openwrt-router">https://samhobbs.co.uk/2013/11/more-spa … wrt-router</a></p><p>Also OpenWrt Wiki has good knowledge on how to do it too <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> . Google is usually best for finding openwrt wiki pages <img src="https://forum.openwrt.org/img/smilies/tongue.png" width="15" height="15" alt="tongue" /> </p><br /><h5> Icy92 </h5><p>@Icy92 -- Recover your changes on U-boot env? Too vague man, I can&#039;t help you.. But from my experience, I only alter the bootcmd env variable from U-boot via serial, it has to be done over serial at bootup, and there&#039;s nothing to recover lol.. Have you destroyed your set of env variables? I have no problem recording my set to see if that helps..<br /></p><div class="codebox"><pre><code>ar7240&gt; printenv   
bootargs=console=ttyS0,115200 root=31:02 rootfstype=jffs2 init=/sbin/init mtdparts=ath-nor0:256k(u-boot),64k(u-boot-env),6336k(rootfs),1408k(uImage),64k(mib0),64k(ART)
bootdelay=1
baudrate=115200
ethaddr=0x00:0xaa:0xbb:0xcc:0xdd:0xee
ipaddr=192.168.1.1
serverip=192.168.1.10
dir=
lu=tftp 0x80060000 ${dir}u-boot.bin&amp;&amp;erase 0x9f000000 +$filesize;cp.b $fileaddr 0x9f000000 $filesize
lf=tftp 0x80060000 ${dir}db12x${bc}-jffs2&amp;&amp;erase 0x9f050000 +0x630000;cp.b $fileaddr 0x9f050000 $filesize
lk=tftp 0x80060000 ${dir}vmlinux${bc}.lzma.uImage&amp;&amp;erase 0x9f680000 +$filesize;cp.b $fileaddr 0x9f680000 $filesize
ethact=eth0
bootcmd=bootm 0x9f040000
stdin=serial
stdout=serial
stderr=serial
 
Environment size: 680/65532 bytes
ar7240&gt; </code></pre></div><br /><h5> Summary </h5><p> </p><p>I want to submit my patches with comments on what I&#039;ve done. We already know that several people can&#039;t get ethernet working on the official trunk and the LEDS are broken.. I have fixed both in my version.. Although not perfectly. Green LEDS, how are they being handled outside of /etc/config/system? Need the answers so that we can control them too.. </p><h5> Questions / Observations </h5><p><strong> Green LAN/WAN Leds</strong><br />I&#039;ve been trying hard to understand the Green LAN / WAN LEDS. These LEDS are not controlled thru /etc/config/system like the rest of the LEDS are. Because these LEDS are externally controlled (somewhere in CPU code? or maybe another peripheral?), adding them as LEDS in the gpio_led, and trying to turn them on / off in /sys/class/leds does not work.. Also the value of brightness does never even reflect the true on/off of the LED. HOWEVER, the gpio number is correct, as when the LED is not registered as gpio_led, we can watch it in /sys/class/gpio, and watch its logic change.. Also, if we set the gpio to input-only, the external control is disabled...</p><p>So if we can figure out where is this external control coming from, we can learn how to put the green LAN/WAN led control back to /etc/config/system for greater user-level control. Right now, the current control is mysterious but it does do a job at lighting up based on LAN/WAN activity..</p><p>Does anybody have ideas where these green LEDS are getting controlled from, even when they are not registered in the led_gpio structure?</p><p><strong> Why Ethernet does not work in Trunk </strong><br />So I&#039;ve figured out aforementioned why the Trunk&#039;s LEDS are broken, but why does its ethernet not function correctly. Should we bother to diagnose why, or should we simply implement the version I created which works in total? I am investigating how to create the kernel patchfile.</p><p><strong> Why is ath9k-phy0 listed as an LED </strong><br />What is this all about?? See it /sys/class/leds or in Luci as well.. What is it?? I don&#039;t see any light <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /></p><p><strong> Why does WLAN button not work? </strong><br />Just like the Green LEDs it does not respond to GPIO toggling.. anybody?</p>											<p class="post-edited">(Last edited by <strong>bazz</strong> on 16 Apr 2015, 07:41)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p272615">
				<div class="post-metadata">
					<div class="post-num">Post #25</div>
					<div class="post-author">lcy92</div>
					<div class="post-datetime">
						15 Apr 2015, 15:21					</div>
				</div>
				<div class="post-content content">
					<p>Bazz:</p><p>Thanks for your guide, I have no more questions on uboot, but after flashing your image several times, my <strong>mac address disappeared</strong> and thus I cannot roll back to the factory image(to work). Could you please help me recover it?</p><p>At first I flashed your non-usb version image from the factory version 1.0.0.30(and erased rootfs_data), and tried to install luci until it told me that there were not enough space. I thought I could make more space through uninstall something, so I removed some part of the image and rebooted. To my surprised, the system got reset, so I erased rootfs_data and reboot again. </p><p>After I found that it was impossible to install luci, I tried to just open its wireless function, at which time I found no &quot;wireless&quot; file in /etc/config . I thought I must have missed something, so I flashed it again. And again. And again, until I thought there might be some mistakes in this image so I turned to the usb version you offered.</p><p>Following your guide, I noticed that you installed luci,(Oh yes I forgot the &quot;wireless&quot; file and your&#039;re modeling your router with a usb storage), so I install luci again and failed again(and certainly, no &quot;wireless&quot; file). So I turned back to growell&#039;s basic image, until I found that &quot;wireless&quot; seems to have disappeared forever. What&#039;s more, my board_hw_id and mac address have disappeared too at that time.(<strong>hw id =&quot;&quot;, mac address = FF:FF:FF:FF:FF:FF in U-boot</strong>)</p><p>Meanwhile I was told by my tftp software that the factory images are no longer available in Upgrade mode,so I set my hw id back in U-boot to flash the factory image. I succeed in flashing the image but&nbsp; it still didn&#039;t work due to &quot;Kernel panic - not syncing: Fatal exception in interrupt&quot;.</p><p>I can&#039;t flash any image except the factory versions using TFTP under upgrade mode, and the factory version seems not to work. What should I do now?</p><p>p.s, I have a backup version of u-boot; u-boot-env; and ART (in .bin format), will these files help?</p>											<p class="post-edited">(Last edited by <strong>lcy92</strong> on 15 Apr 2015, 15:25)</p>
									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 1 of 3</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=50478&amp;p=2.html">2</a></li><li><a href="viewtopic.php%3Fid=50478&amp;p=3.html">3</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0.001 -->

</body>
</html>