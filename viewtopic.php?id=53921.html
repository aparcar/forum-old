<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Unusual IPv6 addresses and bad AAAA entries being served</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 13 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p253888">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">jwm</div>
					<div class="post-datetime">
						11 Nov 2014, 04:35					</div>
				</div>
				<div class="post-content content">
					<p>Hi all, I am noticing some odd behavior that I am trying to track down, I<br />have an IPv6 network given a /64 prefix by my ISP. stateless<br />autoconfiguration is working great but something in openwrt is serving me up<br />bogus additional IP addresses and serving them via AAAA dns entries. My<br />relevant systems behind the openwrt box are all ubuntu based linux boxen and my<br />openwrt version is r43224</p><p>So, a typical complete set of IPv6 addresses I am given are</p><p>HWaddr f0:de:f1:cf:b2:ce<br />#global and site local stateless entries, private and mac based. all good.<br />&nbsp; &nbsp; &nbsp; &nbsp; inet6 addr: 2605:e000:1313:26a:f2de:f1ff:fecf:b2ce/64 Scope:Global<br />&nbsp; &nbsp; &nbsp; &nbsp; inet6 addr: 2605:e000:1313:26a:f5ea:d497:b3dd:dbb5/64 Scope:Global<br />&nbsp; &nbsp; &nbsp; &nbsp; inet6 addr: fd74:cd4f:be19:0:f5ea:d497:b3dd:dbb5/64 Scope:Global<br />&nbsp; &nbsp; &nbsp; &nbsp; inet6 addr: fd74:cd4f:be19:0:f2de:f1ff:fecf:b2ce/64 Scope:Global<br />#link local. all good.<br />&nbsp; &nbsp; &nbsp; &nbsp; inet6 addr: fe80::f2de:f1ff:fecf:b2ce/64 Scope:Link</p><p># !! but where does this one come from ??<br />&nbsp; &nbsp; &nbsp; &nbsp; inet6 addr: fd74:cd4f:be19::72e/128 Scope:Global</p><p>That last one is the one causing trouble and I can&#039;t figure out where it is<br />coming from or why. The trouble it is causing is that whatever mechanism is<br />adding it seems to be poluting the entries returned for AAAA queries against<br />the host name, here is an example of a dig query results on the host.</p><p>lexx.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; IN&nbsp; &nbsp; AAAA&nbsp; &nbsp;&nbsp; fd74:cd4f:be19::72e<br />lexx.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; IN&nbsp; &nbsp; AAAA&nbsp; &nbsp;&nbsp; 2605:e000:1313:26a::9b4<br />lexx.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; IN&nbsp; &nbsp; AAAA&nbsp; &nbsp;&nbsp; fd74:cd4f:be19::9b4<br />lexx.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; IN&nbsp; &nbsp; AAAA 2605:e000:1313:26a::72e<br />lexx.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; IN&nbsp; &nbsp; AAAA&nbsp; &nbsp;&nbsp; fd74:cd4f:be19:0:f2de:f1ff:fecf:b2ce</p><p>The last one was manually added by me to try to override the problem but it<br />didn&#039;t work, the rest are generated by openwrt somehow. However, they include global<br />addresses with the same suffix that are not actually assigned to my host at<br />all (2605:e000:1313:261::72e) and they include<br />completly bogus entries like the &#039;9b4&#039; ones. which perhaps were given out to<br />the host previously and somehow are sticking around in openwrts dns tables but I am unsure.<br />meaning 3 out of 5 times the host is unreachable as the dns results<br />circulate.</p><p>Any ideas on what is going on here or how to fix things? The only<br />configuration I did was add some explicit host entries for static IPs like<br />follows in /etc/config/dhcp</p><p>config domain<br />&nbsp; &nbsp; &nbsp; &nbsp; option name &#039;lexx&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ip &#039;192.168.1.202&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ip &#039;fd74:cd4f:be19:0:f2de:f1ff:fecf:b2ce&#039;</p><br /><p>&nbsp; &nbsp; &nbsp; &nbsp; John</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p253890">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">rhester72</div>
					<div class="post-datetime">
						11 Nov 2014, 05:11					</div>
				</div>
				<div class="post-content content">
					<p>I don&#039;t have a solution, but I saw the same thing - when I added an address to br-lan, odhcpd noticed and gleefully started adding that network to router advertisements, and I could find no way to cause it to ignore it.&nbsp; It seems it will RA any global, no matter what, and as you observed, even other interfaces on the router itself will start picking up SLAAC addresses from it.&nbsp; (To make matters more interesting, I&#039;ve also had a network show up on all my Windows clients that doesn&#039;t even exist on any router or server in the fd3f:: network...beats me!)</p><p>However, I&#039;m not seeing the DNS pollution that you&#039;re seeing, so that perplexes me a bit.&nbsp; Can we get a look at &quot;ifconfig&quot;, &quot;ip addr&quot;, and &quot;ifstatus lan&quot;?</p><p>Rodney</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p253904">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						11 Nov 2014, 09:39					</div>
				</div>
				<div class="post-content content">
					<p>fd74:cd4f:be19::72e looks like stateful ULA address given out by odhcpd managed dhcpv6.</p><p>You might try disabling the ula_prefix option in /etc/config/network, &quot;globals&quot; section.<br />Deleting ula_prefix from there should remove all the fd74:: addresses.<br /><a href="http://wiki.openwrt.org/doc/uci/network#global.settings">http://wiki.openwrt.org/doc/uci/network#global.settings</a><br /><a href="http://wiki.openwrt.org/doc/uci/network6#downstream.configuration.for.lan-interfaces">http://wiki.openwrt.org/doc/uci/network â€¦ interfaces</a><br /><a href="http://en.wikipedia.org/wiki/Unique_local_address">http://en.wikipedia.org/wiki/Unique_local_address</a></p>											<p class="post-edited">(Last edited by <strong>hnyman</strong> on 11 Nov 2014, 09:40)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p253908">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">CyrusFF</div>
					<div class="post-datetime">
						11 Nov 2014, 10:20					</div>
				</div>
				<div class="post-content content">
					<p>The addresses with the 3 chars as host-id come from stateful DHCPv6 which is required to auto-learn hostnames of clients to feed them to the DNS. Why it retains old values (both 9b4 and 7e2) is a bit of a mistery to me atm, nevertheless your client seems to be buggy as well since it doesn&#039;t pick up all addresses from stateful DHCPv6 (only the fd74:... not the 2605:...). This is some sort of a known issue with some ISC-DHCP / network-manager combinations IIRC but I can&#039;t find the link to the ticket right now.</p><p>Aside clearing the dhcpv6 hosts-file in /tmp/hosts/ and restarting odhcpd you could also disable stateful addressing by setting<br />option ra_management 0<br />in the lan-section in /etc/config/dhcp this will indicate to the clients that stateful addressing is not available (the client might nevertheless try).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p253960">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">jwm</div>
					<div class="post-datetime">
						11 Nov 2014, 20:25					</div>
				</div>
				<div class="post-content content">
					<p>Some digging around showed that the bad AAAA entries were coming from the file /tmp/hosts/odhcpd, it had all of the bad entries that were being served. I manually deleted the file but I don&#039;t know why it was accumulating the extra entries.</p><p>It looks like setting ra_management 0 and dhcpv6 &#039;disabled&#039; has solved the issue. Is there anything I am missing out on with this setup? I examined the DHCPv6 responses and there doesn&#039;t appear to be anything that isn&#039;t in the ICMPv6 router advertisements. </p><p>Any reason fully stateless isn&#039;t the default out of box setup? it seems like it would be more likely to &quot;just work&quot;.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>