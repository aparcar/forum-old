<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Adding support for RTL8812AE on x86 (64), Chaos Calmer RC2</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 10 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p283674">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">gilb_4</div>
					<div class="post-datetime">
						15 Jul 2015, 23:03					</div>
				</div>
				<div class="post-content content">
					<p>Hello guys:<br />I built an openwrt box, using an x86 64 bit processor, and I bought a rtl8812ae wireless card. However I noticed there is no driver for this chip in the x86 Chaos Calmer RC2.</p><p>I know there is a driver for this chip on the <a href="https://github.com/openwrt/bcm63xx-next/tree/master/drivers/staging/rtl8821ae/rtl8821ae">https://github.com/openwrt/bcm63xx-next â€¦ /rtl8821ae</a> code repository, and for sure this chipset is supported on the vanilla x86 kernel.</p><p>Any help on how to create/add this package. I tried to follow this but I did not work well.<br /><a href="http://wiki.openwrt.org/doc/devel/packages">http://wiki.openwrt.org/doc/devel/packages</a></p><p>Thanks in advance.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p283770">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">elektroman</div>
					<div class="post-datetime">
						16 Jul 2015, 22:19					</div>
				</div>
				<div class="post-content content">
					<p>Hi</p><p>a of commit 0c81733 the driver is already in vanilla kernel, around v3.17 I think.</p><p>You need only to modify the Makefile for building the kernel modules in openwrt</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p283795">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">gilb_4</div>
					<div class="post-datetime">
						17 Jul 2015, 02:43					</div>
				</div>
				<div class="post-content content">
					<p>I am working to get this done, however I managed to create an empty package, and some how it seems that ALL the packages with source on SourceForge are failing (did SF change its url processing scheme???), I will post when I have more news or I am about to quit</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p283932">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">gilb_4</div>
					<div class="post-datetime">
						18 Jul 2015, 07:04					</div>
				</div>
				<div class="post-content content">
					<p>News:<br />Managed to add driver via mac80211. yeah yeah <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> <img src="https://forum.openwrt.org/img/smilies/cool.png" width="15" height="15" alt="cool" /></p><p>I still need to deploy my image and see if it really works.</p><p>Btw, how can I submit code and/or have a code review for this <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p284000">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">gilb_4</div>
					<div class="post-datetime">
						19 Jul 2015, 01:04					</div>
				</div>
				<div class="post-content content">
					<p>Ran into this :&#039;(</p><p>[&nbsp; 118.896233] IPv6: ADDRCONF(NETDEV_UP): wlan0: link is not read<br />[&nbsp; 119.053655] CPU: 0 PID: 2811 Comm: hostapd Not tainted 3.18.18 #4<br />[&nbsp; 119.053938] task: ffff8801198d4a40 ti: ffff8800d435c000 task.ti: ffff8800d435c000<br />[&nbsp; 119.054299] RIP: 0010:[&lt;ffffffffa030c83c&gt;]&nbsp; [&lt;ffffffffa030c83c&gt;] rtl_get_tcb_desc+0x7c/0x630 [rtlwifi]<br />[&nbsp; 119.054767] RSP: 0018:ffff8800d435f788&nbsp; EFLAGS: 00010086<br />[&nbsp; 119.055020] RAX: 0000000000000004 RBX: 0000000000000000 RCX: 0000000000000000<br />[&nbsp; 119.055329] RDX: ffff8800d61325f8 RSI: ffff8800d67ab028 RDI: ffff8800d6130d40<br />[&nbsp; 119.055639] RBP: ffff8800d6130d40 R08: 0000000000000000 R09: 0000000000000000<br />[&nbsp; 119.055948] R10: ffff8800d67ab030 R11: 0000000000000004 R12: ffff8800d67ab028<br />[&nbsp; 119.056257] R13: 0000000000000000 R14: ffff8800d41920e0 R15: 0000000000000080<br />[&nbsp; 119.056567] FS:&nbsp; 00007f12c7bad6a0(0000) GS:ffff88011ec00000(0000) knlGS:0000000000000000<br />[&nbsp; 119.056949] CS:&nbsp; 0010 DS: 0000 ES: 0000 CR0: 0000000080050033<br />[&nbsp; 119.057215] CR2: 0000000000000006 CR3: 00000000d4300000 CR4: 00000000000407f0<br />[&nbsp; 119.057524] Stack:<br />[&nbsp; 119.057673]&nbsp; 0000000000000080 ffff8800d6132140 0000000000000c00 ffff8800d678d000<br />[&nbsp; 119.058202]&nbsp; ffff8800d67ab000 0000000000000000 ffff8800d6132140 ffff8800d41920e0<br />[&nbsp; 119.058730]&nbsp; ffff8800d6130d40 ffffffffa0348212 ffff8800d41920e0 ffff8800d65348c0<br />[&nbsp; 119.059258] Call Trace:<br />[&nbsp; 119.059429]&nbsp; [&lt;ffffffffa0348212&gt;] ? rtl8821ae_tx_fill_desc+0xa2/0x930 [rtl8821ae]<br />[&nbsp; 119.059795]&nbsp; [&lt;ffffffffa032d1ba&gt;] ? rtl_pci_reset_trx_ring+0x20ea/0x2500 [rtl_pci]<br />[&nbsp; 119.060162]&nbsp; [&lt;ffffffffa030ffbf&gt;] ? rtl_cmd_send_packet+0xdbf/0x1920 [rtlwifi]<br />[&nbsp; 119.060524]&nbsp; [&lt;ffffffffa0297b01&gt;] ? ieee80211_csa_finish+0x38f1/0x3f40 [mac80211]<br />[&nbsp; 119.060891]&nbsp; [&lt;ffffffffa024fa1f&gt;] ? cfg80211_ch_switch_notify+0x243f/0x2520 [cfg80211]<br />[&nbsp; 119.061271]&nbsp; [&lt;ffffffff8137116d&gt;] ? genl_family_rcv_msg+0x27d/0x2f0<br />[&nbsp; 119.061553]&nbsp; [&lt;ffffffff8137124d&gt;] ? genl_rcv_msg+0x6d/0xa0<br />[&nbsp; 119.061811]&nbsp; [&lt;ffffffff813711e0&gt;] ? genl_family_rcv_msg+0x2f0/0x2f0<br />[&nbsp; 119.062092]&nbsp; [&lt;ffffffff8137055d&gt;] ? netlink_rcv_skb+0x3d/0x90<br />[&nbsp; 119.062357]&nbsp; [&lt;ffffffff81370edf&gt;] ? genl_rcv+0x1f/0x30<br />[&nbsp; 119.062603]&nbsp; [&lt;ffffffff8136fe79&gt;] ? netlink_unicast+0x109/0x1e0<br />[&nbsp; 119.062874]&nbsp; [&lt;ffffffff81370347&gt;] ? netlink_sendmsg+0x357/0x3d0<br />[&nbsp; 119.063147]&nbsp; [&lt;ffffffff813320c3&gt;] ? sock_sendmsg+0x63/0x80<br />[&nbsp; 119.063406]&nbsp; [&lt;ffffffff810e2fa4&gt;] ? terminate_walk+0x14/0x40<br />[&nbsp; 119.063670]&nbsp; [&lt;ffffffff813f871f&gt;] ? schedule_timeout+0x2f/0x190<br />[&nbsp; 119.063946]&nbsp; [&lt;ffffffff81333df2&gt;] ? move_addr_to_kernel+0x22/0x40<br />[&nbsp; 119.064223]&nbsp; [&lt;ffffffff8133ff38&gt;] ? verify_iovec+0x58/0xb0<br />[&nbsp; 119.064482]&nbsp; [&lt;ffffffff8133394f&gt;] ? ___sys_sendmsg.part.34+0x21f/0x270<br />[&nbsp; 119.064773]&nbsp; [&lt;ffffffff811d1219&gt;] ? rhashtable_insert+0x59/0xa0<br />[&nbsp; 119.065046]&nbsp; [&lt;ffffffff81066013&gt;] ? __wake_up+0x43/0x70<br />[&nbsp; 119.065296]&nbsp; [&lt;ffffffff8136f7df&gt;] ? netlink_bind+0x1df/0x220<br />[&nbsp; 119.065562]&nbsp; [&lt;ffffffff81334118&gt;] ? SyS_bind+0x68/0xb0<br />[&nbsp; 119.065811]&nbsp; [&lt;ffffffff81334b11&gt;] ? __sys_sendmsg+0x51/0x80<br />[&nbsp; 119.066074]&nbsp; [&lt;ffffffff813f9849&gt;] ? system_call_fastpath+0x12/0x17<br />[&nbsp; 119.066352] Code: 9a a3 00 00 00 75 27 be cf 07 00 00 48 c7 c7 28 58 31 a0 e8 f7 17 d3 e0 c6 05 80 a3 00 00 01 eb 0d 66 0f 1f 44 00 00 0f b7 40 06 &lt;88&gt; 43 06 44 89 f8 83 e0 0c 66 83 f8 08 0f 85 19 05 00 00 41 80<br />[&nbsp; 119.069919] RIP&nbsp; [&lt;ffffffffa030c83c&gt;] rtl_get_tcb_desc+0x7c/0x630 [rtlwifi]<br />[&nbsp; 119.070266]&nbsp; RSP &lt;ffff8800d435f788&gt;<br />[&nbsp; 119.070460] CR2: 0000000000000006<br />[&nbsp; 119.070651] ---[ end trace 951d6ff7b966a04d ]---<br />[&nbsp; 179.029097] INFO: rcu_sched detected stalls on CPUs/tasks: { 3} (detected by 2, t=6002 jiffies, g=2092, c=2091, q=4590)<br />[&nbsp; 179.029874] Task dump for CPU 3:<br />[&nbsp; 179.030100] swapper/3&nbsp; &nbsp; &nbsp; &nbsp;R&nbsp; running task&nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; 1 0x00000008<br />[&nbsp; 179.030563]&nbsp; ffff880119a85a00 ffffffff813f6396 0000000000010280 ffff88011a0fbfd8<br />[&nbsp; 179.031187]&nbsp; 0000000000010280 ffff88011a0aca40 0000000000000000 0000000000000000<br />[&nbsp; 179.031810]&nbsp; ffff88011a2cd000 0000000000000000 0000000000000058 0000000000000010<br />[&nbsp; 179.032433] Call Trace:<br />[&nbsp; 179.032644]&nbsp; [&lt;ffffffff813f6396&gt;] ? __schedule+0x4a6/0x620<br />[&nbsp; 179.032958]&nbsp; [&lt;ffffffff81322599&gt;] ? cpuidle_enter_state+0x59/0xe0<br />[&nbsp; 179.033287]&nbsp; [&lt;ffffffff81322592&gt;] ? cpuidle_enter_state+0x52/0xe0<br />[&nbsp; 179.033620]&nbsp; [&lt;ffffffff810669ed&gt;] ? cpu_startup_entry+0x1cd/0x2b0</p><p>Box gets zombie after that</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p284085">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">elektroman</div>
					<div class="post-datetime">
						19 Jul 2015, 23:06					</div>
				</div>
				<div class="post-content content">
					<p>For submitting patches read this<br /><a href="https://dev.openwrt.org/wiki/SubmittingPatches">https://dev.openwrt.org/wiki/SubmittingPatches</a></p><p>Did you load/append the needed firmware files ??</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p284111">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">gilb_4</div>
					<div class="post-datetime">
						20 Jul 2015, 05:07					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>elektroman wrote:</cite><blockquote><p>For submitting patches read this<br /><a href="https://dev.openwrt.org/wiki/SubmittingPatches">https://dev.openwrt.org/wiki/SubmittingPatches</a></p><p>Did you load/append the needed firmware files ??</p></blockquote></div><br /><p>Yes, I did appended the firmware. It seems the card works fine on client mode, but things go haywire with hostapd. It seems this is kinda common in RTL wifi cards tho ... (<a href="https://github.com/jekader/hostapd-rtl">https://github.com/jekader/hostapd-rtl</a>) (<a href="https://bugzilla.redhat.com/show_bug.cgi?id=797709">https://bugzilla.redhat.com/show_bug.cgi?id=797709</a>)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p284402">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">elektroman</div>
					<div class="post-datetime">
						21 Jul 2015, 22:47					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>gilb_4 wrote:</cite><blockquote><p>Yes, I did appended the firmware. It seems the card works fine on client mode, but things go haywire with hostapd. It seems this is kinda common in RTL wifi cards tho ... (<a href="https://github.com/jekader/hostapd-rtl">https://github.com/jekader/hostapd-rtl</a>) (<a href="https://bugzilla.redhat.com/show_bug.cgi?id=797709">https://bugzilla.redhat.com/show_bug.cgi?id=797709</a>)</p></blockquote></div><p>[&lt;ffffffffa0348212&gt;] ? rtl8821ae_tx_fill_desc+0xa2/0x930 [rtl8821ae]</p><p>Looks like some NULL Pointer dereference here.<br />Is this only in AP mode ??</p><p>To my knowledge AP will work, but can&#039;t test this without ripping the card out of my testrouter</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p285001">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">gilb_4</div>
					<div class="post-datetime">
						26 Jul 2015, 02:43					</div>
				</div>
				<div class="post-content content">
					<p>Yes, it is only on AP mode... it seems I need a patched version of hostapd... or patch the driver (that scares me...)</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>