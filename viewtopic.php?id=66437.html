<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Router not detecting USB! (TP-Link MR3020)</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 17 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p332603">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">isaiahmil90</div>
					<div class="post-datetime">
						26 Jul 2016, 00:33					</div>
				</div>
				<div class="post-content content">
					<p>Hey guys, first I will start with what I have confirmed/tried.</p><p>I flashed my TP-Link MR3020 router to Openwrt with the images provided at the link below:</p><p><a href="https://wiki.openwrt.org/toh/tp-link/tl-mr3020">https://wiki.openwrt.org/toh/tp-link/tl-mr3020</a></p><p>There are only two image links that are the exact same version from what I can tell.</p><br /><p>The goal is to use my usb as an overlaying file system for the router since it has limited memory space. My usb is formatted to ext4. (I have also tried formatting it to Fat32). With a usb pin reader I was able to confirm that the usb port is functional and not faulty.</p><p>I was also sure to install the package below once upgrading the firmware to openwrt:</p><p>root@OpenWrt:~# opkg update<br />root@OpenWrt:~# opkg install block-mount kmod-fs-ext4 </p><br /><br /><p>Whenever I &#039;ls /dev&#039; no &quot;sda&quot; are listed. Has anyone else experienced this issue? Does anyone have anymore ideas? Please help!</p><p>Below is the project I was attempting to accomplish:</p><p><a href="http://edwardkeeble.com/2014/02/passive-wifi-tracking/">http://edwardkeeble.com/2014/02/passive-wifi-tracking/</a></p><br /><p>Thanks!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p332612">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">remlei</div>
					<div class="post-datetime">
						26 Jul 2016, 02:47					</div>
				</div>
				<div class="post-content content">
					<p>I wonder what packages installed on your router.</p><p>execute this on terminal and reply the output here</p><div class="codebox"><pre><code>opkg list-installed</code></pre></div><p>I suspect that kernel modules for usb is not installed.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p332617">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">isaiahmil90</div>
					<div class="post-datetime">
						26 Jul 2016, 03:56					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>remlei wrote:</cite><blockquote><p>I wonder what packages installed on your router.</p><p>execute this on terminal and reply the output here</p><div class="codebox"><pre><code>opkg list-installed</code></pre></div><p>I suspect that kernel modules for usb is not installed.</p></blockquote></div><br /><p>Here is the opkg installed dump:</p><p>root@OpenWrt:~# opkg list-installed<br />base-files - 157-r46767<br />block-mount - 2015-05-24-09027fc86babc3986027a0e677aca1b6999a9e14<br />busybox - 1.23.2-1<br />dnsmasq - 2.73-1<br />dropbear - 2015.67-1<br />firewall - 2015-07-27<br />fstools - 2015-05-24-09027fc86babc3986027a0e677aca1b6999a9e14<br />hostapd-common - 2015-03-25-1<br />ip6tables - 1.4.21-1<br />iptables - 1.4.21-1<br />iw - 3.17-1<br />jshn - 2015-06-14-d1c66ef1131d14f0ed197b368d03f71b964e45f8<br />jsonfilter - 2014-06-19-cdc760c58077f44fc40adbbe41e1556a67c1b9a9<br />kernel - 3.18.20-1-7bed08fa9c06eb8089e82c200340ec66<br />kmod-ath - 3.18.20+2015-03-09-3<br />kmod-ath9k - 3.18.20+2015-03-09-3<br />kmod-ath9k-common - 3.18.20+2015-03-09-3<br />kmod-cfg80211 - 3.18.20+2015-03-09-3<br />kmod-crypto-aes - 3.18.20-1<br />kmod-crypto-arc4 - 3.18.20-1<br />kmod-crypto-core - 3.18.20-1<br />kmod-crypto-hash - 3.18.20-1<br />kmod-fs-ext4 - 3.18.20-1<br />kmod-gpio-button-hotplug - 3.18.20-1<br />kmod-ip6tables - 3.18.20-1<br />kmod-ipt-conntrack - 3.18.20-1<br />kmod-ipt-core - 3.18.20-1<br />kmod-ipt-nat - 3.18.20-1<br />kmod-ipv6 - 3.18.20-1<br />kmod-ledtrig-usbdev - 3.18.20-1<br />kmod-lib-crc-ccitt - 3.18.20-1<br />kmod-lib-crc16 - 3.18.20-1<br />kmod-mac80211 - 3.18.20+2015-03-09-3<br />kmod-nf-conntrack - 3.18.20-1<br />kmod-nf-conntrack6 - 3.18.20-1<br />kmod-nf-ipt - 3.18.20-1<br />kmod-nf-ipt6 - 3.18.20-1<br />kmod-nf-nat - 3.18.20-1<br />kmod-nf-nathelper - 3.18.20-1<br />kmod-nls-base - 3.18.20-1<br />kmod-ppp - 3.18.20-1<br />kmod-pppoe - 3.18.20-1<br />kmod-pppox - 3.18.20-1<br />kmod-slhc - 3.18.20-1<br />kmod-usb-core - 3.18.20-1<br />kmod-usb-uhci - 3.18.20-1<br />kmod-usb2 - 3.18.20-1<br />libblobmsg-json - 2015-06-14-d1c66ef1131d14f0ed197b368d03f71b964e45f8<br />libc - 0.9.33.2-1<br />libgcc - 4.8-linaro-1<br />libip4tc - 1.4.21-1<br />libip6tc - 1.4.21-1<br />libiwinfo - 2015-06-01-ade8b1b299cbd5748db1acf80dd3e9f567938371<br />libiwinfo-lua - 2015-06-01-ade8b1b299cbd5748db1acf80dd3e9f567938371<br />libjson-c - 0.12-1<br />libjson-script - 2015-06-14-d1c66ef1131d14f0ed197b368d03f71b964e45f8<br />liblua - 5.1.5-1<br />libnl-tiny - 0.1-4<br />libubox - 2015-06-14-d1c66ef1131d14f0ed197b368d03f71b964e45f8<br />libubus - 2015-05-25-f361bfa5fcb2daadf3b160583ce665024f8d108e<br />libubus-lua - 2015-05-25-f361bfa5fcb2daadf3b160583ce665024f8d108e<br />libuci - 2015-04-09.1-1<br />libuci-lua - 2015-04-09.1-1<br />libxtables - 1.4.21-1<br />lua - 5.1.5-1<br />luci - git-15.248.30277-3836b45-1<br />luci-app-firewall - git-15.248.30277-3836b45-1<br />luci-base - git-15.248.30277-3836b45-1<br />luci-lib-ip - git-15.248.30277-3836b45-1<br />luci-lib-nixio - git-15.248.30277-3836b45-1<br />luci-mod-admin-full - git-15.248.30277-3836b45-1<br />luci-proto-ipv6 - git-15.248.30277-3836b45-1<br />luci-proto-ppp - git-15.248.30277-3836b45-1<br />luci-theme-bootstrap - git-15.248.30277-3836b45-1<br />mtd - 21<br />netifd - 2015-06-08-8795f9ef89626cd658f615c78c6a17e990c0dcaa<br />odhcp6c - 2015-07-13-024525798c5f6aba3af9b2ef7b3af2f3c14f1db8<br />odhcpd - 2015-05-21-2ebf6c8216287983779c8ec6597d30893b914a7c<br />opkg - 9c97d5ecd795709c8584e972bfdf3aee3a5b846d-7<br />ppp - 2.4.7-6<br />ppp-mod-pppoe - 2.4.7-6<br />procd - 2015-08-16-0da5bf2ff222d1a499172a6e09507388676b5a08<br />rpcd - 2015-05-17-3d655417ab44d93aad56a6d4a668daf24b127b84<br />swconfig - 10<br />uboot-envtools - 2014.10-2<br />ubox - 2015-07-14-907d046c8929fb74e5a3502a9498198695e62ad8<br />ubus - 2015-05-25-f361bfa5fcb2daadf3b160583ce665024f8d108e<br />ubusd - 2015-05-25-f361bfa5fcb2daadf3b160583ce665024f8d108e<br />uci - 2015-04-09.1-1<br />uhttpd - 2015-08-17-f91788b809d9726126e9cf4384fedbbb0c5b8a73<br />uhttpd-mod-ubus - 2015-08-17-f91788b809d9726126e9cf4384fedbbb0c5b8a73<br />usign - 2015-05-08-cf8dcdb8a4e874c77f3e9a8e9b643e8c17b19131<br />wpad-mini - 2015-03-25-1</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p332630">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">remlei</div>
					<div class="post-datetime">
						26 Jul 2016, 07:42					</div>
				</div>
				<div class="post-content content">
					<p>as expected I guess</p><p>youre missing kmod-usb-storage package</p><p>follow this steps instead for setting up extroot</p><p><a href="https://wiki.openwrt.org/doc/howto/extroot">https://wiki.openwrt.org/doc/howto/extroot</a></p>											<p class="post-edited">(Last edited by <strong>remlei</strong> on 26 Jul 2016, 07:42)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p332745">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">isaiahmil90</div>
					<div class="post-datetime">
						27 Jul 2016, 02:29					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>remlei wrote:</cite><blockquote><p>as expected I guess</p><p>youre missing kmod-usb-storage package</p><p>follow this steps instead for setting up extroot</p><p><a href="https://wiki.openwrt.org/doc/howto/extroot">https://wiki.openwrt.org/doc/howto/extroot</a></p></blockquote></div><p>Thanks! It appears I don&#039;t have enough space to install this package.&#039;</p><p>root@OpenWrt:~# opkg install kmod-usb-storage<br />Installing kmod-usb-storage (3.18.20-1) to root...<br />Downloading <a href="http://downloads.openwrt.org/chaos_calmer/15.05/ar71xx/generic/packages/base/kmod-usb-storage_3.18.20-1_ar71xx.ipk.">http://downloads.openwrt.org/chaos_calm â€¦ r71xx.ipk.</a><br />Installing kmod-scsi-core (3.18.20-1) to root...<br />Collected errors:<br /> * verify_pkg_installable: Only have 60kb available on filesystem /overlay, pkg kmod-scsi-core needs 76<br /> * opkg_install_cmd: Cannot install package kmod-usb-storage.</p><p>I have uninstalled the two usb module packages that I had installed and still don&#039;t have room. What other packages can I remove without breaking any core/useful services??</p><br /><br /><p>root@OpenWrt:~# opkg list-installed<br />base-files - 157-r46767<br />block-mount - 2015-05-24-09027fc86babc3986027a0e677aca1b6999a9e14<br />busybox - 1.23.2-1<br />dnsmasq - 2.73-1<br />dropbear - 2015.67-1<br />firewall - 2015-07-27<br />fstools - 2015-05-24-09027fc86babc3986027a0e677aca1b6999a9e14<br />hostapd-common - 2015-03-25-1<br />ip6tables - 1.4.21-1<br />iptables - 1.4.21-1<br />iw - 3.17-1<br />jshn - 2015-06-14-d1c66ef1131d14f0ed197b368d03f71b964e45f8<br />jsonfilter - 2014-06-19-cdc760c58077f44fc40adbbe41e1556a67c1b9a9<br />kernel - 3.18.20-1-7bed08fa9c06eb8089e82c200340ec66<br />kmod-ath - 3.18.20+2015-03-09-3<br />kmod-ath9k - 3.18.20+2015-03-09-3<br />kmod-ath9k-common - 3.18.20+2015-03-09-3<br />kmod-cfg80211 - 3.18.20+2015-03-09-3<br />kmod-crypto-aes - 3.18.20-1<br />kmod-crypto-arc4 - 3.18.20-1<br />kmod-crypto-core - 3.18.20-1<br />kmod-crypto-hash - 3.18.20-1<br />kmod-fs-ext4 - 3.18.20-1<br />kmod-gpio-button-hotplug - 3.18.20-1<br />kmod-ip6tables - 3.18.20-1<br />kmod-ipt-conntrack - 3.18.20-1<br />kmod-ipt-core - 3.18.20-1<br />kmod-ipt-nat - 3.18.20-1<br />kmod-ipv6 - 3.18.20-1<br />kmod-ledtrig-usbdev - 3.18.20-1<br />kmod-lib-crc-ccitt - 3.18.20-1<br />kmod-lib-crc16 - 3.18.20-1<br />kmod-mac80211 - 3.18.20+2015-03-09-3<br />kmod-nf-conntrack - 3.18.20-1<br />kmod-nf-conntrack6 - 3.18.20-1<br />kmod-nf-ipt - 3.18.20-1<br />kmod-nf-ipt6 - 3.18.20-1<br />kmod-nf-nat - 3.18.20-1<br />kmod-nf-nathelper - 3.18.20-1<br />kmod-nls-base - 3.18.20-1<br />kmod-ppp - 3.18.20-1<br />kmod-pppoe - 3.18.20-1<br />kmod-pppox - 3.18.20-1<br />kmod-slhc - 3.18.20-1<br />kmod-usb-core - 3.18.20-1<br />libblobmsg-json - 2015-06-14-d1c66ef1131d14f0ed197b368d03f71b964e45f8<br />libc - 0.9.33.2-1<br />libgcc - 4.8-linaro-1<br />libip4tc - 1.4.21-1<br />libip6tc - 1.4.21-1<br />libiwinfo - 2015-06-01-ade8b1b299cbd5748db1acf80dd3e9f567938371<br />libiwinfo-lua - 2015-06-01-ade8b1b299cbd5748db1acf80dd3e9f567938371<br />libjson-c - 0.12-1<br />libjson-script - 2015-06-14-d1c66ef1131d14f0ed197b368d03f71b964e45f8<br />liblua - 5.1.5-1<br />libnl-tiny - 0.1-4<br />libubox - 2015-06-14-d1c66ef1131d14f0ed197b368d03f71b964e45f8<br />libubus - 2015-05-25-f361bfa5fcb2daadf3b160583ce665024f8d108e<br />libubus-lua - 2015-05-25-f361bfa5fcb2daadf3b160583ce665024f8d108e<br />libuci - 2015-04-09.1-1<br />libuci-lua - 2015-04-09.1-1<br />libxtables - 1.4.21-1<br />lua - 5.1.5-1<br />luci - git-15.248.30277-3836b45-1<br />luci-app-firewall - git-15.248.30277-3836b45-1<br />luci-base - git-15.248.30277-3836b45-1<br />luci-lib-ip - git-15.248.30277-3836b45-1<br />luci-lib-nixio - git-15.248.30277-3836b45-1<br />luci-mod-admin-full - git-15.248.30277-3836b45-1<br />luci-proto-ipv6 - git-15.248.30277-3836b45-1<br />luci-proto-ppp - git-15.248.30277-3836b45-1<br />luci-theme-bootstrap - git-15.248.30277-3836b45-1<br />mtd - 21<br />netifd - 2015-06-08-8795f9ef89626cd658f615c78c6a17e990c0dcaa<br />odhcp6c - 2015-07-13-024525798c5f6aba3af9b2ef7b3af2f3c14f1db8<br />odhcpd - 2015-05-21-2ebf6c8216287983779c8ec6597d30893b914a7c<br />opkg - 9c97d5ecd795709c8584e972bfdf3aee3a5b846d-7<br />ppp - 2.4.7-6<br />ppp-mod-pppoe - 2.4.7-6<br />procd - 2015-08-16-0da5bf2ff222d1a499172a6e09507388676b5a08<br />rpcd - 2015-05-17-3d655417ab44d93aad56a6d4a668daf24b127b84<br />swconfig - 10<br />uboot-envtools - 2014.10-2<br />ubox - 2015-07-14-907d046c8929fb74e5a3502a9498198695e62ad8<br />ubus - 2015-05-25-f361bfa5fcb2daadf3b160583ce665024f8d108e<br />ubusd - 2015-05-25-f361bfa5fcb2daadf3b160583ce665024f8d108e<br />uci - 2015-04-09.1-1<br />uhttpd - 2015-08-17-f91788b809d9726126e9cf4384fedbbb0c5b8a73<br />uhttpd-mod-ubus - 2015-08-17-f91788b809d9726126e9cf4384fedbbb0c5b8a73<br />usign - 2015-05-08-cf8dcdb8a4e874c77f3e9a8e9b643e8c17b19131<br />wpad-mini - 2015-03-25-1</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p332747">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">isaiahmil90</div>
					<div class="post-datetime">
						27 Jul 2016, 03:16					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>remlei wrote:</cite><blockquote><p>as expected I guess</p><p>youre missing kmod-usb-storage package</p><p>follow this steps instead for setting up extroot</p><p><a href="https://wiki.openwrt.org/doc/howto/extroot">https://wiki.openwrt.org/doc/howto/extroot</a></p></blockquote></div><p>I uninstalled the Luci package to make more room which allowed me to download the mentioned package. However, I still think I need to clear up more space as there was no memory left for the installation to complete.</p><p>Collected errors:<br /> * wfopen: /lib/modules/3.18.20/sd_mod.ko: No space left on device.<br /> * extract_archive: Cannot create symlink from ./etc/modules-boot.d/40-scsi-core to &#039;../modules.d/40-scsi-core&#039;: No space left on device.<br /> * wfopen: /etc/modules.d/40-scsi-core: No space left on device.<br /> * pkg_write_filelist: Failed to open //usr/lib/opkg/info/kmod-scsi-core.list: No space left on device.<br /> * opkg_install_pkg: Failed to extract data files for kmod-scsi-core. Package debris may remain!<br /> * opkg_install_cmd: Cannot install package kmod-usb-storage.<br /> * opkg_conf_write_status_files: Can&#039;t open status file //usr/lib/opkg/status: No space left on device.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p332760">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">remlei</div>
					<div class="post-datetime">
						27 Jul 2016, 08:19					</div>
				</div>
				<div class="post-content content">
					<p>you have to remove some packages, although in my case I used mr 3220 v2 I literally removed wifi drivers, luci, kmod-ppp (everything, ppp, pppoe and pppx). Then include the packages necessary for extroot.</p><p>You have to do this using a image builder.</p><p>after that, all I do is configure extroot as per openwrt wiki says, then install back the removed packages to get the pppoe wifi and luci working, with that install the rest of the packages you want to install.</p>											<p class="post-edited">(Last edited by <strong>remlei</strong> on 27 Jul 2016, 08:19)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>