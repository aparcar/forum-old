<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Relay Control - home automation project</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 2 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p329262">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">nedoskiv</div>
					<div class="post-datetime">
						21 Jun 2016, 10:13					</div>
				</div>
				<div class="post-content content">
					<p>Hello,<br />I have decided to let my creation be used by everyone who wanted it.<br />Idea is very simple - using device leds (gpio) to control relays. I&#039;m not very good with hardware but manage to do a simple schema to be able using arduino low level triggered relays (can be ordered from aliexpress).<br />I have do that on TPLINK router 740N v4/5</p><p><span class="postimg"><img src="http://urlstat.eu/rc8_bb.jpg" alt="http://urlstat.eu/rc8_bb.jpg" /></span></p><p>It is writen in my language, so here is the translation:<br />Screw terminals 2 are equal to 1, total of 12 (drawing software limitation)<br />GND and voltage + are taken directly from the power plug.</p><p>LTV 827 is used becаuse on 2 of the leds GND is used for breaking circus</p><p>As I said&nbsp; - I&#039;m not very good with hardware, but so far this schema work without any issue.<br />For me most challenging part is software behind all that, it makes possible to schedule relays ON/OFF in any way.<br />Also a simple proximity monitor, to do action when you come home and your phone connect to WIFI.<br />There is much more to be told about it, but first I need to prepare english version of the image and make it available for downloading.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p329299">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">lizby</div>
					<div class="post-datetime">
						21 Jun 2016, 16:03					</div>
				</div>
				<div class="post-content content">
					<p>Nice project. I look forward to seeing more details. </p><p>Any reason for using the WR740N instead of, for instance, the more gpio-friendly GL-iNet devices?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p329433">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">nedoskiv</div>
					<div class="post-datetime">
						22 Jun 2016, 12:16					</div>
				</div>
				<div class="post-content content">
					<p>Well,&nbsp; I point my attention on that device, becаuse it is cheap - 10-15$ and work very stable with openwrt.</p><p>English version of the image is available now for downloading, there is a option in menu to switch between English and Bulgarian.</p><p>You can download images and uboot from here:<br /><a href="http://urlstat.eu/RC">http://urlstat.eu/RC</a></p><p>After routers is updated it gonna respond to 192.168.7.1<br />default login for SSH/MACTELNET/LUCI are root with password &quot;88888888&quot;<br />Luci can be accessed on port 88 - <a href="http://192.168.7.1:88">http://192.168.7.1:88</a><br />on port 80 is RC interface, default logins are &quot;admin&quot; &quot;88888888&quot;</p><p>After flashing with the proper image you need to update u-boot as well, that is neccessary to prevent routers leds from blinking during boot process (thanks to Pepe2k)</p><p>mtd write /tmp/uboot740v4_5.bin u-boot</p><p>The images above contains my home configuration. Documentation into RC interface may be useful (keep in mind I may be a little bit behind with it and need to translate in in English) Ask any quesitions I will answer them.</p><p>Also I need to make clear one more thing. I share my work for non profit purposes only, if anyone want to make bussiness with it, must deal with me.</p>											<p class="post-edited">(Last edited by <strong>nedoskiv</strong> on 22 Jun 2016, 12:53)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p329735">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">hoatienii</div>
					<div class="post-datetime">
						25 Jun 2016, 06:46					</div>
				</div>
				<div class="post-content content">
					<p>Thanks your uboot</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p329902">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">hoatienii</div>
					<div class="post-datetime">
						27 Jun 2016, 04:49					</div>
				</div>
				<div class="post-content content">
					<p>my tplink 740n v4 control relay</p><p><span class="postimg"><img src="http://lh3.googleusercontent.com/-9FArGfEPObw/V3CAFg2nB8I/AAAAAAAAPoA/d7wUwTHM5aUHK4jOVQQNEFpJLXsQ378BwCCo/s512/IMG_20160626_132626.jpg" alt="http://lh3.googleusercontent.com/-9FArGfEPObw/V3CAFg2nB8I/AAAAAAAAPoA/d7wUwTHM5aUHK4jOVQQNEFpJLXsQ378BwCCo/s512/IMG_20160626_132626.jpg" /></span></p><p><span class="postimg"><img src="http://lh3.googleusercontent.com/-nuFIJsWVM7U/V3CAJHOoZYI/AAAAAAAAPoA/GJxPmZ_MnTkn_FQUR1Z8CTCh9MKBmN8UwCCo/s512/IMG_20160626_132509.jpg" alt="http://lh3.googleusercontent.com/-nuFIJsWVM7U/V3CAJHOoZYI/AAAAAAAAPoA/GJxPmZ_MnTkn_FQUR1Z8CTCh9MKBmN8UwCCo/s512/IMG_20160626_132509.jpg" /></span></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p330116">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">nedoskiv</div>
					<div class="post-datetime">
						29 Jun 2016, 12:46					</div>
				</div>
				<div class="post-content content">
					<p><span class="postimg"><img src="http://urlstat.eu/mine.jpg" alt="http://urlstat.eu/mine.jpg" /></span></p><p>On screw terminals you can use arduino low level triggered relays that can be placed far away from the router,&nbsp; 50-100m is not a problem.</p><br /><p>I will try to upload better photo</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p337423">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">pilovis</div>
					<div class="post-datetime">
						6 Sep 2016, 22:37					</div>
				</div>
				<div class="post-content content">
					<p>In case you won&#039;t or can&#039;t reprogram a router, you might use a Netgear DGND3700V1 that 11 LEDs of wich 9 of them can be used to control 9 relays, fortunately these 9 LEDs do not turn on or do not start blinking during startup process <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>The downside of this router is that the internal PCI WiFi module is bad supported on OpenWRT, as a workaround you can use a different WiFI PCI board or connect an external USB WiFi dongle to the router (or use an ethernet cable).</p><p>This router is very powerful: it has 2x400 Mhz CPUs, 2xUSB2 ports, 2 integrated Switch buttons (plus reset) both usable directly by triggerhappy, 1 WAN and 4 LAN ethernet connectors, 128 Mbytes of RAM plus 64 Mbytes of Swap (NAND) and 32 Mbytes of Flash (NOR).</p><p>Here are the commands to switch ON the 9 LEDs (to switch them off use &quot;echo 0 &gt; ...&quot;):</p><p>/bin/echo 1 &gt; /sys/devices/platform/leds-gpio.0/leds/DGND3700v1_3800B:blue:wifi5g/brightness<br />/bin/echo 1 &gt; /sys/devices/platform/leds-gpio.0/leds/DGND3700v1_3800B:green:dsl/brightness<br />/bin/echo 1 &gt; /sys/devices/platform/leds-gpio.0/leds/DGND3700v1_3800B:green:inet/brightness<br />/bin/echo 1 &gt; /sys/devices/platform/leds-gpio.0/leds/DGND3700v1_3800B:green:usb-back/brightness<br />/bin/echo 1 &gt; /sys/devices/platform/leds-gpio.0/leds/DGND3700v1_3800B:green:usb-front/brightness<br />/bin/echo 1 &gt; /sys/devices/platform/leds-gpio.0/leds/DGND3700v1_3800B:green:wifi2g/brightness<br />/bin/echo 1 &gt; /sys/devices/platform/leds-gpio.0/leds/DGND3700v1_3800B:green:wps/brightness<br />/bin/echo 1 &gt; /sys/devices/platform/leds-gpio.0/leds/DGND3700v1_3800B:red:inet/brightness<br />/bin/echo 1 &gt; /sys/devices/platform/leds-gpio.0/leds/DGND3700v1_3800B:green:lan/brightness</p><p>LED name, Color, GPIO, #note<br />power, red, 22, # it turns on at bootup<br />power, green, 24, # it turns on and starts blinking at bootup<br />lan, green, 23, # usable<br />usb-back, green, 14, # usable<br />wifi2g, green, 26, # usable<br />wifi5g, blue, 27, # usable<br />dsl, green, 2, # usable<br />inet, red, 4, # usable<br />inet, green, 5, # usable<br />usb-front, green, 13, # usable<br />wps, green, 11, # usable</p><p>Board switches as seen by triggerhappy:</p><p>root@OpenWrt:~# thd --dump /dev/input/event*<br />EV_KEY&nbsp; &nbsp; KEY_WPS_BUTTON&nbsp; &nbsp; 1&nbsp; &nbsp; /dev/input/event0<br /># KEY_WPS_BUTTON&nbsp; &nbsp; 1&nbsp; &nbsp; command<br />EV_KEY&nbsp; &nbsp; KEY_WPS_BUTTON&nbsp; &nbsp; 0&nbsp; &nbsp; /dev/input/event0<br /># KEY_WPS_BUTTON&nbsp; &nbsp; 0&nbsp; &nbsp; command<br />EV_KEY&nbsp; &nbsp; KEY_WLAN&nbsp; &nbsp; 1&nbsp; &nbsp; /dev/input/event0<br /># KEY_WLAN&nbsp; &nbsp; 1&nbsp; &nbsp; command<br />EV_KEY&nbsp; &nbsp; KEY_WLAN&nbsp; &nbsp; 0&nbsp; &nbsp; /dev/input/event0<br /># KEY_WLAN&nbsp; &nbsp; 0&nbsp; &nbsp; command</p><p>KEY_WLAN = gpio-10<br />KEY_WPS_BUTTON =&nbsp; gpio-35</p><p>Usable GPIOs:</p><p>root@OpenWrt:~# cat /sys/kernel/debug/gpio<br />GPIOs 0-37, bcm63xx-gpio:<br />gpio-2&nbsp; &nbsp;(DGND3700v1_3800B:gre) out hi<br />gpio-4&nbsp; &nbsp;(DGND3700v1_3800B:red) out hi<br />gpio-5&nbsp; &nbsp;(DGND3700v1_3800B:gre) out hi<br />gpio-10&nbsp; (wlan&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ) in&nbsp; hi<br />gpio-11&nbsp; (DGND3700v1_3800B:gre) out hi<br />gpio-12&nbsp; (reset&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;) in&nbsp; hi<br />gpio-13&nbsp; (DGND3700v1_3800B:gre) out hi<br />gpio-14&nbsp; (DGND3700v1_3800B:gre) out hi<br />gpio-22&nbsp; (DGND3700v1_3800B:red) out hi<br />gpio-23&nbsp; (DGND3700v1_3800B:gre) out hi<br />gpio-24&nbsp; (DGND3700v1_3800B:gre) out lo<br />gpio-26&nbsp; (DGND3700v1_3800B:gre) out lo<br />gpio-27&nbsp; (DGND3700v1_3800B:blu) out lo<br />gpio-35&nbsp; (wps&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;) in&nbsp; hi</p>											<p class="post-edited">(Last edited by <strong>pilovis</strong> on 6 Sep 2016, 23:34)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p337487">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">nedoskiv</div>
					<div class="post-datetime">
						7 Sep 2016, 10:26					</div>
				</div>
				<div class="post-content content">
					<p>I like TP-LINK routers, they work very stable and are cheap. I hope to have time soon to adapt my software to works on Orange PI, they have a lot of GPIOs and price is about 15- 50$</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p338282">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">pilovis</div>
					<div class="post-datetime">
						14 Sep 2016, 22:16					</div>
				</div>
				<div class="post-content content">
					<p><span class="postimg"><img src="http://www.lovisolo.com/asterisk/software/openwrt/netgear-DGND2700-home-automation/20160911_183045.jpg" alt="http://www.lovisolo.com/asterisk/software/openwrt/netgear-DGND2700-home-automation/20160911_183045.jpg" /></span><br /><span class="postimg"><img src="http://www.lovisolo.com/asterisk/software/openwrt/netgear-DGND2700-home-automation/20160911_183100.jpg" alt="http://www.lovisolo.com/asterisk/software/openwrt/netgear-DGND2700-home-automation/20160911_183100.jpg" /></span><br /><span class="postimg"><img src="http://www.lovisolo.com/asterisk/software/openwrt/netgear-DGND2700-home-automation/20160911_183320.jpg" alt="http://www.lovisolo.com/asterisk/software/openwrt/netgear-DGND2700-home-automation/20160911_183320.jpg" /></span><br /><span class="postimg"><img src="http://www.lovisolo.com/asterisk/software/openwrt/netgear-DGND2700-home-automation/20160911_180049.jpg" alt="http://www.lovisolo.com/asterisk/software/openwrt/netgear-DGND2700-home-automation/20160911_180049.jpg" /></span></p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>