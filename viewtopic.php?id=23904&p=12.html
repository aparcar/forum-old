<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Multi-WAN Load Balancing</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 29 Mar 2018 and 3 May 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 12 of 14</div><nav><ul><li><a href="viewtopic.php%3Fid=23904&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=23904&amp;p=10.html">10</a></li><li><a href="viewtopic.php%3Fid=23904&amp;p=11.html">11</a></li><li class="pagination-current"><span>12</span></li><li><a href="viewtopic.php%3Fid=23904&amp;p=13.html">13</a></li><li><a href="viewtopic.php%3Fid=23904&amp;p=14.html">14</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p130893">
				<div class="post-metadata">
					<div class="post-num">Post #276</div>
					<div class="post-author">skerit</div>
					<div class="post-datetime">
						16 Mar 2011, 18:42					</div>
				</div>
				<div class="post-content content">
					<p>Oh that&#039;s awesome. What about luci-app-multiwan?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p130895">
				<div class="post-metadata">
					<div class="post-num">Post #277</div>
					<div class="post-author">sur4die</div>
					<div class="post-datetime">
						16 Mar 2011, 18:46					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>skerit wrote:</cite><blockquote><p>Oh that&#039;s awesome. What about luci-app-multiwan?</p></blockquote></div><p>yup, same place.&nbsp; If you just install 10.03.1-rc4 on your device both applications should be available through the opkg package manager by default.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p130897">
				<div class="post-metadata">
					<div class="post-num">Post #278</div>
					<div class="post-author">skerit</div>
					<div class="post-datetime">
						16 Mar 2011, 19:04					</div>
				</div>
				<div class="post-content content">
					<p>I installed multiwan, but somehow luci-app-multiwan is not in there.<br />I also can&#039;t find it in <a href="http://downloads.openwrt.org/backfire/10.03.1-rc4/brcm-2.4/packages/">http://downloads.openwrt.org/backfire/1 … /packages/</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p130899">
				<div class="post-metadata">
					<div class="post-num">Post #279</div>
					<div class="post-author">sur4die</div>
					<div class="post-datetime">
						16 Mar 2011, 19:25					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>skerit wrote:</cite><blockquote><p>I installed multiwan, but somehow luci-app-multiwan is not in there.<br />I also can&#039;t find it in <a href="http://downloads.openwrt.org/backfire/10.03.1-rc4/brcm-2.4/packages/">http://downloads.openwrt.org/backfire/1 … /packages/</a></p></blockquote></div><p>I thought it was in there looks like you might have to build it for yourself.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p131863">
				<div class="post-metadata">
					<div class="post-num">Post #280</div>
					<div class="post-author">josephus</div>
					<div class="post-datetime">
						29 Mar 2011, 16:18					</div>
				</div>
				<div class="post-content content">
					<p>How do I setup multiwan when the second wan link is actually a vpn established over the first wan link. Namely a tap tunnel with openvpn.<br />During boot the tap device is nonexistent (I configure the address with an &quot;up&quot; script), so I cant really define &#039;wan2&#039; in config/network.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p133434">
				<div class="post-metadata">
					<div class="post-num">Post #281</div>
					<div class="post-author">rosswakelin</div>
					<div class="post-datetime">
						19 Apr 2011, 08:55					</div>
				</div>
				<div class="post-content content">
					<p>Hi</p><p>I have a new openwrt build (trunk) with one lan connection, one ethernet wan connection and two possible 3g connections, depending<br />on what USB dongle is inserted in the router.<br />I have configured multiwan with all three interfaces, with wan failing over to 3g-1 failing over to 3g-2 failing over to wan.<br />When the system starts, none of the connections are active.<br />If I plug in one of the 3g cards, the link comes up fine, and the route appears in the routing table, but multiwan never sees it<br />come up.&nbsp; <br />Any hints?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p133765">
				<div class="post-metadata">
					<div class="post-num">Post #282</div>
					<div class="post-author">hamvil</div>
					<div class="post-datetime">
						22 Apr 2011, 14:53					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>i&#039;m trying to configure multiwan with a package for wireless mesh networking (wing). Wing creates a new section in /etc/config/network that looks like:</p><p>config &#039;interface&#039; &#039;mesh&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;proto&#039; &#039;wing&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;profile&#039; &#039;bulk&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;rc&#039; &#039;minstrel&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ls&#039; &#039;fcfs&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;metric&#039; &#039;wcett&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;prefix&#039; &#039;6&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;period&#039; &#039;10000&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;tau&#039; &#039;100000&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;debug&#039; &#039;false&#039;</p><p>The multiwan config that I&#039;m using is:</p><p>config &#039;multiwan&#039; &#039;config&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;default_route&#039; &#039;wan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;debug&#039; &#039;1&#039;</p><p>config &#039;interface&#039; &#039;wan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;weight&#039; &#039;10&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;health_interval&#039; &#039;10&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;icmp_hosts&#039; &#039;dns&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;icmp_count&#039; &#039;3&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;timeout&#039; &#039;3&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;health_fail_retries&#039; &#039;3&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;health_recovery_retries&#039; &#039;5&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;failover_to&#039; &#039;mesh&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;dns&#039; &#039;auto&#039;</p><p>config &#039;interface&#039; &#039;mesh&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;weight&#039; &#039;10&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;health_interval&#039; &#039;10&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;icmp_hosts&#039; &#039;127.0.0.1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;timeout&#039; &#039;3&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;health_fail_retries&#039; &#039;3&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;health_recovery_retries&#039; &#039;5&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;dns&#039; &#039;208.67.222.222 208.67.220.220&#039;</p><p>basically I would like to fallback to the mesh interface when the wan fails. However in the logs I get:</p><p>Jan&nbsp; 1 19:43:33 Wing user.notice multiwan: mesh has failed and is currently offline.</p><p>Which requirements shall an interface satisfy in order to be marker as available by multiwan?</p><p>R.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p133777">
				<div class="post-metadata">
					<div class="post-num">Post #283</div>
					<div class="post-author">sur4die</div>
					<div class="post-datetime">
						22 Apr 2011, 17:17					</div>
				</div>
				<div class="post-content content">
					<p>can you $&gt;ping -I mesh 127.0.0.1</p><p>instead of using icmp_hosts 127.0.0.1 use icmp_hosts disabled</p><p>that&#039;s all i got...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p133787">
				<div class="post-metadata">
					<div class="post-num">Post #284</div>
					<div class="post-author">hamvil</div>
					<div class="post-datetime">
						22 Apr 2011, 20:10					</div>
				</div>
				<div class="post-content content">
					<p>same result with icmp_hosts set to disabled:</p><p>config &#039;interface&#039; &#039;mesh&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;weight&#039; &#039;10&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;health_interval&#039; &#039;10&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;icmp_hosts&#039; &#039;disabled&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;timeout&#039; &#039;3&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;health_fail_retries&#039; &#039;3&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;health_recovery_retries&#039; &#039;5&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;dns&#039; &#039;208.67.222.222 208.67.220.220&#039;</p><p>In the log I still get:</p><p>Apr 22 17:04:11 Wing user.notice multiwan: Succesfully Initialized on Fri, 22 Apr 2011 17:04:11 +0000.<br />Apr 22 17:04:12 Wing user.notice multiwan: mesh has failed and is currently offline.</p><p>I do not know if this can help:</p><p>root@Wing:/tmp/state# uci -p /var/state/ show network.mesh<br />network.mesh=interface<br />network.mesh.proto=wing<br />network.mesh.profile=bulk<br />network.mesh.rc=minstrel<br />network.mesh.ls=fcfs<br />network.mesh.metric=wcett<br />network.mesh.prefix=6<br />network.mesh.period=10000<br />network.mesh.tau=100000<br />network.mesh.debug=false<br />network.mesh.ifname=wing-mesh<br />network.mesh.device=wing-mesh</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p134039">
				<div class="post-metadata">
					<div class="post-num">Post #285</div>
					<div class="post-author">hamvil</div>
					<div class="post-datetime">
						26 Apr 2011, 10:31					</div>
				</div>
				<div class="post-content content">
					<p>Shall the DNSes specified in the multiwan configuration be reachable over a certain interface in order to have that interface marked as available by multiwan?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p134251">
				<div class="post-metadata">
					<div class="post-num">Post #286</div>
					<div class="post-author">speedy</div>
					<div class="post-datetime">
						28 Apr 2011, 16:55					</div>
				</div>
				<div class="post-content content">
					<p>Is there any way to use a 3G stick as backup connection? I have two DSL connections. In the case both are not working I want so switch to 3G/ UMTS stick. Cause of connection cost I don&#039;t want the 3G to be active all the time. It should only be enabled on demand.</p><p>Thanks,<br />Gunnar</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p134253">
				<div class="post-metadata">
					<div class="post-num">Post #287</div>
					<div class="post-author">sur4die</div>
					<div class="post-datetime">
						28 Apr 2011, 17:23					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>hamvil wrote:</cite><blockquote><p>Shall the DNSes specified in the multiwan configuration be reachable over a certain interface in order to have that interface marked as available by multiwan?</p></blockquote></div><p>I believe that the DNS addresses that you list are the ones that are used (for DNS) when that connection is active, be it for load balancing or in the failover chain.<br />I also believe that they can be used for viability testing if the icmp_host is set to DNS for the interface.&nbsp; icmp_host can be either gateway, dns, disable, or explicit ip address.</p><p>I have no experience with mesh, so I&#039;m not entirely sure what the problem coule be.&nbsp; If you search through the multiwan script (<a href="https://dev.openwrt.org/browser/packages/net/multiwan/files/usr/bin/multiwan">/usr/bin/multiwan</a>) you can find that the viability checking is done using this function</p><br /><div class="codebox"><pre><code>ping_test() {
            echo &quot;$icmp_hosts&quot; | while read icmp_test_host; do
                    ping -c &quot;$icmp_count&quot; -W $timeout -I $ifname $icmp_test_host 2&gt;&amp;1 | grep -o &quot;round-trip&quot;
                done
            }</code></pre></div><p>So if you can &gt;ping -I mesh &lt;ping_destination&gt; then the interface should not be turning up as offline.</p><br /><br /><p>... Actually now that I look at it I think the grep in this function might be wrong.&nbsp; If you change it to grep -o &quot;ttl=&quot; you might get a better result.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p134254">
				<div class="post-metadata">
					<div class="post-num">Post #288</div>
					<div class="post-author">hamvil</div>
					<div class="post-datetime">
						28 Apr 2011, 17:27					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>sur4die wrote:</cite><blockquote><p>I also believe that they can be used for viability testing if the icmp_host is set to DNS for the interface.&nbsp; icmp_host can be either gateway, dns, disable, or explicit ip address.</p></blockquote></div><p>I&#039;ve set icmp_host to disabled, so the script should not try to ping anything, right?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p134256">
				<div class="post-metadata">
					<div class="post-num">Post #289</div>
					<div class="post-author">sur4die</div>
					<div class="post-datetime">
						28 Apr 2011, 17:31					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>hamvil wrote:</cite><blockquote><div class="quotebox"><cite>sur4die wrote:</cite><blockquote><p>I also believe that they can be used for viability testing if the icmp_host is set to DNS for the interface.&nbsp; icmp_host can be either gateway, dns, disable, or explicit ip address.</p></blockquote></div><p>I&#039;ve set icmp_host to disabled, so the script should not try to ping anything, right?</p></blockquote></div><p>actually, my bad.&nbsp; health_interval must equal 0 or &quot;disable&quot; to turn of the viability test.</p>											<p class="post-edited">(Last edited by <strong>sur4die</strong> on 28 Apr 2011, 17:35)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p134259">
				<div class="post-metadata">
					<div class="post-num">Post #290</div>
					<div class="post-author">hamvil</div>
					<div class="post-datetime">
						28 Apr 2011, 17:42					</div>
				</div>
				<div class="post-content content">
					<p>Actually it seems to me that the scripts requires that the gateway field is set for a certain interface:</p><p>uci -P /var/state/ show network.wan.gateway<br />network.wan.gateway=192.168.9.254</p><p>But for my mesh interface I have:</p><p>uci -P /var/state/ show network.mesh.gateway<br />uci: Entry not found</p><p>Could this be the problem? </p><p>(the mesh does not have a gateway in that the best gateway is choosen dinamically by the routing daemon. I could set it to a static value, for example the interface address. Would this be compatible with the logic of the script.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p134632">
				<div class="post-metadata">
					<div class="post-num">Post #291</div>
					<div class="post-author">Sorbe</div>
					<div class="post-datetime">
						4 May 2011, 11:15					</div>
				</div>
				<div class="post-content content">
					<p>Installing the multiwan package from the FTP site(ftp://ftp.netlab7.com/multiwan_1.0.18.ipk) works on the arokh version (r26801) build for the WNDR3700.&nbsp; Installing the luci package (<a href="ftp://ftp.netlab7.com/luci-app-multiwan_1.0.16.ipk">ftp://ftp.netlab7.com/luci-app-multiwan_1.0.16.ipk</a>) however gives:</p><div class="codebox"><pre><code>/usr/lib/lua/luci/template.lua:102: Error in template admin_system/packages: /usr/lib/lua/luci/ccache.lua:81: error loading module &#039;luci.tools.webadmin&#039; from file &#039;/usr/lib/lua/luci/tools/webadmin.lua&#039;:
    /usr/lib/lua/luci/tools/webadmin.lua: bad header in precompiled chunk
stack traceback:
    [C]: in function &#039;error&#039;
    /usr/lib/lua/luci/template.lua:102: in function &lt;/usr/lib/lua/luci/template.lua:90&gt;
    (tail call): ?
    /usr/lib/lua/luci/controller/admin/system.lua:100: in function &lt;/usr/lib/lua/luci/controller/admin/system.lua:45&gt;
    (tail call): ?
    /usr/lib/lua/luci/dispatcher.lua:384: in function &#039;dispatch&#039;
    /usr/lib/lua/luci/dispatcher.lua:146: in function &lt;/usr/lib/lua/luci/dispatcher.lua:145&gt;</code></pre></div><p>Once you do this, your router is semi-bricked.&nbsp; I had to TFTP flash the router back to the factory image and then up again to the AA&nbsp; (r26801) build.</p>											<p class="post-edited">(Last edited by <strong>Sorbe</strong> on 4 May 2011, 11:22)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p134633">
				<div class="post-metadata">
					<div class="post-num">Post #292</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						4 May 2011, 11:23					</div>
				</div>
				<div class="post-content content">
					<p>Sorbe, the luci component is long outdated and has a now incompatible binary format. Just use the official ones:<br /><a href="http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/luci-app-multiwan_0.10+svn7010-1_ar71xx.ipk">http://downloads.openwrt.org/snapshots/ … ar71xx.ipk</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p134838">
				<div class="post-metadata">
					<div class="post-num">Post #293</div>
					<div class="post-author">skerit</div>
					<div class="post-datetime">
						7 May 2011, 11:27					</div>
				</div>
				<div class="post-content content">
					<p>But that&#039;s the arm package, not one for broadcom 2.4, which doesn&#039;t have a luci-app-multiwan package in the repos.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p135353">
				<div class="post-metadata">
					<div class="post-num">Post #294</div>
					<div class="post-author">hamvil</div>
					<div class="post-datetime">
						16 May 2011, 10:37					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>sur4die wrote:</cite><blockquote><div class="quotebox"><cite>hamvil wrote:</cite><blockquote><div class="quotebox"><cite>sur4die wrote:</cite><blockquote><p>I also believe that they can be used for viability testing if the icmp_host is set to DNS for the interface.&nbsp; icmp_host can be either gateway, dns, disable, or explicit ip address.</p></blockquote></div><p>I&#039;ve set icmp_host to disabled, so the script should not try to ping anything, right?</p></blockquote></div><p>actually, my bad.&nbsp; health_interval must equal 0 or &quot;disable&quot; to turn of the viability test.</p></blockquote></div><p>Nope, even with this param set to 0 I still get:</p><p>mesh has failed and is currently offline.</p><p>I&#039;ve modified the mesh daemon in such a way to set the gateway to 0.0.0.0:</p><p>network.mesh.gateway=0.0.0.0</p><p>BTW the script that brings up the mesh routing daemon runs the following command after initializing the daemon:</p><p>route add default dev wing-mesh</p><p>where &quot;wing-mesh&quot; is the name of the device.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p135388">
				<div class="post-metadata">
					<div class="post-num">Post #295</div>
					<div class="post-author">sergei18</div>
					<div class="post-datetime">
						16 May 2011, 17:49					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>I have a problem setting up MultiWan script and VPNC. <br />The story:</p><p>I have 2 ISPs connected to my router ASUS Wl500gpV2, running Backfire 10.03<br />Installed multiwan script 1.0.18, works like a magic - I only set up 2 ISP interfaces in /etc/config/network and used standard /etc/config/multiwan - just added few rules for specific networks.</p><p>Now I&#039;m trying to make outgoing VPNC connection running. Took my old good VPNC config file and run vpnc /etc/vpnc/myconfig.conf.<br />VPNC reported that it started in background and I see new route in &quot;route&quot; command output.<br />But actually new VPNC connection doesn&#039;t work, servers nehind the vpn are not reachable.</p><p>If I disable multiwan script and reboot - VPNC works perfectly. If I start it before multiwan - it works too, until it has to be restarted by timeout. Then it stops working.</p><p>The same situation happens with OpenVPN. It connects OK, create new routes via tunnel interface, but that&#039;s all - i cannot access computers behind any VPN connection.</p><p>Could anybody point me into right direction is solving my problem? I admit it should be something easy to fix, yes?</p>											<p class="post-edited">(Last edited by <strong>sergei18</strong> on 17 May 2011, 03:17)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p136905">
				<div class="post-metadata">
					<div class="post-num">Post #296</div>
					<div class="post-author">Immanuel</div>
					<div class="post-datetime">
						11 Jun 2011, 18:05					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>sergei18 wrote:</cite><blockquote><p>Hello,</p><p>I have a problem setting up MultiWan script and VPNC. <br />The story:</p><p>I have 2 ISPs connected to my router ASUS Wl500gpV2, running Backfire 10.03<br />Installed multiwan script 1.0.18, works like a magic - I only set up 2 ISP interfaces in /etc/config/network and used standard /etc/config/multiwan - just added few rules for specific networks.</p><p>Now I&#039;m trying to make outgoing VPNC connection running. Took my old good VPNC config file and run vpnc /etc/vpnc/myconfig.conf.<br />VPNC reported that it started in background and I see new route in &quot;route&quot; command output.<br />But actually new VPNC connection doesn&#039;t work, servers nehind the vpn are not reachable.</p><p>If I disable multiwan script and reboot - VPNC works perfectly. If I start it before multiwan - it works too, until it has to be restarted by timeout. Then it stops working.</p><p>The same situation happens with OpenVPN. It connects OK, create new routes via tunnel interface, but that&#039;s all - i cannot access computers behind any VPN connection.</p><p>Could anybody point me into right direction is solving my problem? I admit it should be something easy to fix, yes?</p></blockquote></div><p>I&#039;m having a similar issue with tincd+olsrd.<br />I tried with a custom script, first starts tincd+olsrd from one wan, then i have to wait for routes.<br />Only when routes are loaded i start multiwan and seems to work.<br />If i try to put this in a script in rc.d (start tinc, start olsr, wait for ~30 secs and the start multiwan) it partially works..some routes are still redirected to one wan, but the others are ok.</p><br /><div class="codebox"><pre><code> 
#!/bin/sh /etc/rc.common
START=99
EXTRA_COMMANDS=&quot;single&quot;
#to restore: ln -s /etc/init.d/multiwan /etc/rc.d/S99multiwan
start () {
        #if not available, add route to 192.168.13.1 (wan gw)
        route add default gw 192.168.13.1
        #start tincd
        /etc/init.d/tinc start &amp;
        #start olsrd
        /etc/init.d/olsrd start &amp;
        #now wait for routes and then start multiwan
        sleep 35        
    /usr/bin/multiwan agent &amp;
        }
                   
stop () {
         sh /usr/bin/multiwan stop
        }
                     
restart () {
             /usr/bin/multiwan restart &amp;
           }
                       
single () {
             /usr/bin/multiwan single &amp;
          }</code></pre></div><p>Try to replace tincd and olsrd with your vpn, here works partially <img src="https://forum.openwrt.org/img/smilies/hmm.png" width="15" height="15" alt="hmm" /><br />I have another issue: most traffic is redirected through wan2 (wan== eth0.1 on my wrt54gs, wan2 == wifi on my wrt54gs used and configured as wan).<br />What exactly means weight?</p><div class="codebox"><pre><code>config &#039;multiwan&#039; &#039;config&#039;
    option &#039;default_route&#039; &#039;balancer&#039;
#    option &#039;resolv_conf&#039; &#039;/tmp/resolv.conf.auto&#039;
    option &#039;health_monitor&#039; &#039;serial&#039;
#    option &#039;debug&#039; &#039;1&#039;

# wan (eth0.1)
config &#039;interface&#039; &#039;wan&#039;
    option &#039;health_interval&#039; &#039;10&#039;
    option &#039;icmp_hosts&#039; &#039;8.8.8.8&#039;
    option &#039;timeout&#039; &#039;5&#039;
    option &#039;icmp_count&#039; &#039;3&#039;
    option &#039;health_fail_retries&#039; &#039;3&#039;
    option &#039;health_recovery_retries&#039; &#039;5&#039;
    option &#039;failover_to&#039; &#039;wan2&#039;
    option &#039;dns&#039; &#039;auto&#039;
    option &#039;weight&#039; &#039;1&#039;

# wrt54gs wifi
config &#039;interface&#039; &#039;wan2&#039;
    option &#039;health_interval&#039; &#039;10&#039;
    option &#039;icmp_hosts&#039; &#039;8.8.8.8&#039;
    option &#039;icmp_count&#039; &#039;3&#039;
    option &#039;timeout&#039; &#039;7&#039;
    option &#039;health_fail_retries&#039; &#039;7&#039;
    option &#039;health_recovery_retries&#039; &#039;5&#039;
    option &#039;failover_to&#039; &#039;wan&#039;
    option &#039;dns&#039; &#039;auto&#039;
    option &#039;weight&#039; &#039;1&#039;

config &#039;mwanfw&#039;
    option &#039;dst&#039; &#039;www.whatismyip.com&#039;
    option &#039;wanrule&#039; &#039;wan2&#039;</code></pre></div><p>Maybe somthing is wrong here..i tried with various weight, i simply want to balance traffic..both wans are &quot;equal&quot;.<br />I have also qos-script enabled but nothing changes if i turn it off.<br />I&#039;m running openwrt trunk r27153.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p137762">
				<div class="post-metadata">
					<div class="post-num">Post #297</div>
					<div class="post-author">speedy</div>
					<div class="post-datetime">
						24 Jun 2011, 11:41					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>I use Multi-WAN for failover. So in the case wan1 fails it switches over to wan2. But in the case wan1 is working I can&#039;t reach any hosts in the subnet of wan2.<br />Wan1: 11.22.33.44 / 255.255.255.0<br />Wan2: 22.33.44.55 / 255.255.255.0</p><p>Ping to 22.33.44.60 from a computer behind the router: host not reachable</p><p>I can ssh to the router and ping the host successfully. But I want to reach the hosts in network 22.33.44.0 from my computers in the lan.</p><p>Somebody with an idea to solve that problem? </p><p>Regards,<br />Gunnar</p>											<p class="post-edited">(Last edited by <strong>speedy</strong> on 24 Jun 2011, 11:46)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p137996">
				<div class="post-metadata">
					<div class="post-num">Post #298</div>
					<div class="post-author">Double</div>
					<div class="post-datetime">
						27 Jun 2011, 20:57					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>When i try to run multiwan i&#039;ve got a strange output:</p><p>/usr/bin/multiwan: eval: line 1: uci_get_state: not found<br />/usr/bin/multiwan: eval: line 1: uci_get_state: not found<br />/usr/bin/multiwan: eval: line 1: uci_get_state: not found<br />/usr/bin/multiwan: eval: line 1: uci_get_state: not found<br />/usr/bin/multiwan: eval: line 1: uci_get_state: not found<br />/usr/bin/multiwan: eval: line 1: uci_get_state: not found</p><p>i&#039;ve backfire/10.03/brcm47xx/ installed. </p><p>Can it be because of manual installation? i don&#039;t find pakage in backfire/10.03/brcm47xx/packages, so i&#039;ve downloaded it from snapshots/backfire/10.03.1-RC5-testing/brcm47xx/packages/<br />Is there any other or right way to install multiwan on 10.03/brcm47xx ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p140828">
				<div class="post-metadata">
					<div class="post-num">Post #299</div>
					<div class="post-author">-micro-</div>
					<div class="post-datetime">
						8 Aug 2011, 18:27					</div>
				</div>
				<div class="post-content content">
					<p>Hi everybody!<br />Can somebody pleaseeee help me about multiwan?</p><p>I have installed Backfire 10.03.1-rc4 on MikroTik RB433AH. When I installed and set-up multiwan it was not working! I think, but I&#039;m not sure, that I have a problem with my mangle table. I read all posts on this topic, but I can&#039;t see that people had problems with that. I don&#039;t know how to solve this problem, so please help me. Below, you can find my config files:</p><p>routing tables:<br /></p><div class="codebox"><pre><code>root@OpenWrt:/# cat /etc/iproute2/rt_tables
#
# reserved values
#
255     local
254     main
253     default
0       unspec
#
# local
#
#1      inr.ruhep
#
170 LoadBalancer
171 MWAN1
172 MWAN2
root@OpenWrt:/#</code></pre></div><p>MWAN1 routing table:<br /></p><div class="codebox"><pre><code>root@OpenWrt:/# ip route show table MWAN1
192.168.1.0/24 dev ath1  proto kernel  scope link  src 192.168.1.101
192.168.0.0/24 dev ath2  proto kernel  scope link  src 192.168.0.2
192.168.10.0/24 dev br-lan  proto kernel  scope link  src 192.168.10.1
default via 192.168.1.1 dev ath1  proto static  src 192.168.1.101
root@OpenWrt:/#</code></pre></div><p>MWAN2:<br /></p><div class="codebox"><pre><code>root@OpenWrt:/# ip route show table MWAN2
192.168.1.0/24 dev ath1  proto kernel  scope link  src 192.168.1.101
192.168.0.0/24 dev ath2  proto kernel  scope link  src 192.168.0.2
192.168.10.0/24 dev br-lan  proto kernel  scope link  src 192.168.10.1
default via 192.168.0.1 dev ath2  proto static  src 192.168.0.2
root@OpenWrt:/#</code></pre></div><p>LoadBalancing table:<br /></p><div class="codebox"><pre><code>root@OpenWrt:/# ip route show table LoadBalancer
192.168.1.0/24 dev ath1  proto kernel  scope link  src 192.168.1.101
192.168.0.0/24 dev ath2  proto kernel  scope link  src 192.168.0.2
192.168.10.0/24 dev br-lan  proto kernel  scope link  src 192.168.10.1
default  proto static
        nexthop via 192.168.1.1  dev ath1 weight 10
        nexthop via 192.168.0.1  dev ath2 weight 10
root@OpenWrt:/#</code></pre></div><p>RPDB:<br /></p><div class="codebox"><pre><code>root@OpenWrt:/# ip rule show
0:      from all lookup local
9:      from all fwmark 0x1 lookup LoadBalancer
10:     from 192.168.1.101 lookup MWAN1
11:     from all fwmark 0x10 lookup MWAN1
20:     from 192.168.0.2 lookup MWAN2
21:     from all fwmark 0x20 lookup MWAN2
32766:  from all lookup main
32767:  from all lookup default
root@OpenWrt:/#</code></pre></div><p>mangle table:<br /></p><div class="codebox"><pre><code>root@OpenWrt:/# iptables -t mangle -L
Chain PREROUTING (policy ACCEPT)
target     prot opt source               destination
MultiWan   all  --  anywhere             anywhere

Chain INPUT (policy ACCEPT)
target     prot opt source               destination

Chain FORWARD (policy ACCEPT)
target     prot opt source               destination
MultiWan   all  --  anywhere             anywhere

Chain OUTPUT (policy ACCEPT)
target     prot opt source               destination
MultiWan   all  --  anywhere             anywhere

Chain POSTROUTING (policy ACCEPT)
target     prot opt source               destination
MultiWan   all  --  anywhere             anywhere

Chain FW1MARK (5 references)
target     prot opt source               destination

Chain FW2MARK (3 references)
target     prot opt source               destination

Chain FastBalancer (0 references)
target     prot opt source               destination

Chain LoadBalancer (0 references)
target     prot opt source               destination

Chain MultiWan (4 references)
target     prot opt source               destination
MultiWanPreHandler  all  --  anywhere             anywhere
MultiWanRules  all  --  anywhere             anywhere
MultiWanLoadBalancer  all  --  anywhere             anywhere
MultiWanDNS  all  --  anywhere             anywhere
MultiWanPostHandler  all  --  anywhere             anywhere

Chain MultiWanDNS (1 references)
target     prot opt source               destination
FW1MARK    tcp  --  anywhere             dns6.sbb.rs         tcp dpt:53
FW1MARK    udp  --  anywhere             dns6.sbb.rs         udp dpt:53
FW1MARK    tcp  --  anywhere             dns7.sbb.rs         tcp dpt:53
FW1MARK    udp  --  anywhere             dns7.sbb.rs         udp dpt:53
FW2MARK    tcp  --  anywhere             192.168.0.1         tcp dpt:53
FW2MARK    udp  --  anywhere             192.168.0.1         udp dpt:53

Chain MultiWanLoadBalancer (1 references)
target     prot opt source               destination

Chain MultiWanPostHandler (1 references)
target     prot opt source               destination

Chain MultiWanPreHandler (1 references)
target     prot opt source               destination
FW1MARK    all  --  anywhere             anywhere            state NEW
FW2MARK    all  --  anywhere             anywhere            state NEW

Chain MultiWanRules (1 references)
target     prot opt source               destination
root@OpenWrt:/#</code></pre></div><p>firewall:<br /></p><div class="codebox"><pre><code>root@OpenWrt:/# cat /etc/config/firewall

config &#039;defaults&#039;
        option &#039;syn_flood&#039; &#039;1&#039;
        option &#039;input&#039; &#039;ACCEPT&#039;
        option &#039;output&#039; &#039;ACCEPT&#039;
        option &#039;forward&#039; &#039;ACCEPT&#039;
        option &#039;drop_invalid&#039; &#039;1&#039;

config &#039;zone&#039;
        option &#039;name&#039; &#039;lan&#039;
        option &#039;input&#039; &#039;ACCEPT&#039;
        option &#039;output&#039; &#039;ACCEPT&#039;
        option &#039;forward&#039; &#039;REJECT&#039;
        option &#039;network&#039; &#039;lan&#039;

config &#039;zone&#039;
        option &#039;name&#039; &#039;wan&#039;
        option &#039;masq&#039; &#039;1&#039;
        option &#039;input&#039; &#039;ACCEPT&#039;
        option &#039;output&#039; &#039;ACCEPT&#039;
        option &#039;forward&#039; &#039;ACCEPT&#039;
        option &#039;mtu_fix&#039; &#039;1&#039;
        option &#039;network&#039; &#039;wan wan2&#039;

config &#039;forwarding&#039;
        option &#039;src&#039; &#039;lan&#039;
        option &#039;dest&#039; &#039;wan&#039;

config &#039;forwarding&#039;
        option &#039;src&#039; &#039;wan&#039;
        option &#039;dest&#039; &#039;lan&#039;

config &#039;rule&#039;
        option &#039;src&#039; &#039;wan&#039;
        option &#039;proto&#039; &#039;udp&#039;
        option &#039;dest_port&#039; &#039;68&#039;
        option &#039;target&#039; &#039;ACCEPT&#039;

config &#039;rule&#039;
        option &#039;src&#039; &#039;wan&#039;
        option &#039;proto&#039; &#039;icmp&#039;
        option &#039;icmp_type&#039; &#039;echo-request&#039;
        option &#039;target&#039; &#039;ACCEPT&#039;

config &#039;include&#039;
        option &#039;path&#039; &#039;/etc/firewall.user&#039;

root@OpenWrt:/#</code></pre></div><p>multiwan:<br /></p><div class="codebox"><pre><code>root@OpenWrt:/# cat /etc/config/multiwan

config &#039;multiwan&#039; &#039;config&#039;
        option &#039;default_route&#039; &#039;balancer&#039;

config &#039;interface&#039; &#039;wan&#039;
        option &#039;weight&#039; &#039;10&#039;
        option &#039;health_interval&#039; &#039;10&#039;
        option &#039;icmp_hosts&#039; &#039;dns&#039;
        option &#039;timeout&#039; &#039;3&#039;
        option &#039;health_fail_retries&#039; &#039;3&#039;
        option &#039;health_recovery_retries&#039; &#039;5&#039;
        option &#039;failover_to&#039; &#039;balancer&#039;
        option &#039;dns&#039; &#039;auto&#039;

config &#039;interface&#039; &#039;wan2&#039;
        option &#039;weight&#039; &#039;10&#039;
        option &#039;health_interval&#039; &#039;10&#039;
        option &#039;icmp_hosts&#039; &#039;dns&#039;
        option &#039;timeout&#039; &#039;3&#039;
        option &#039;health_fail_retries&#039; &#039;3&#039;
        option &#039;health_recovery_retries&#039; &#039;5&#039;
        option &#039;failover_to&#039; &#039;balancer&#039;
        option &#039;dns&#039; &#039;auto&#039;

config &#039;mwanfw&#039;
        option &#039;dst&#039; &#039;www.whatismyip.com&#039;
        option &#039;wanrule&#039; &#039;fastbalancer&#039;
root@OpenWrt:/#</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p145393">
				<div class="post-metadata">
					<div class="post-num">Post #300</div>
					<div class="post-author">janptak</div>
					<div class="post-datetime">
						8 Oct 2011, 18:15					</div>
				</div>
				<div class="post-content content">
					<p>Id like to share with You result of a day of my researching dual 3G dongle loadbalancing connection.<br />After having two working 3G modem setup You need to:<br />1. Set 2 zones in firewall - each for one modem. It seems one zone isnt enough for multiwan.<br />2. Check if interfaces are configured to have <br /> </p><div class="codebox"><pre><code>option &#039;peerdns&#039; &#039;0&#039;
    option &#039;defaultroute&#039; &#039;0&#039;</code></pre></div><p><em>This is the option which render loadbalancing finally start to work properly on both interfaces</em></p><p>3. set performance loadbalancer. Compatibility mode didnt worked for me.</p><p>Heres my configs:<br />Network:<br /> </p><div class="codebox"><pre><code>config &#039;interface&#039; &#039;loopback&#039;
    option &#039;ifname&#039; &#039;lo&#039;
    option &#039;proto&#039; &#039;static&#039;
    option &#039;ipaddr&#039; &#039;127.0.0.1&#039;
    option &#039;netmask&#039; &#039;255.0.0.0&#039;

config &#039;interface&#039; &#039;lan&#039;
    option &#039;ifname&#039; &#039;eth0.1&#039;
    option &#039;type&#039; &#039;bridge&#039;
    option &#039;proto&#039; &#039;static&#039;
    option &#039;ipaddr&#039; &#039;192.168.1.1&#039;
    option &#039;netmask&#039; &#039;255.255.255.0&#039;

config &#039;interface&#039; &#039;wan&#039;
    option &#039;proto&#039; &#039;3g&#039;
    option &#039;service&#039; &#039;umts&#039;
    option &#039;device&#039; &#039;/dev/ttyUSB0&#039;
    option &#039;apn&#039; &#039;vpn&#039;
    option &#039;pincode&#039; &#039;5165&#039;
    option &#039;username&#039; &#039;vpn&#039;
    option &#039;password&#039; &#039;vpn&#039;
    option &#039;maxwait&#039; &#039;20&#039;
    option &#039;peerdns&#039; &#039;0&#039;
    option &#039;defaultroute&#039; &#039;0&#039;

config &#039;interface&#039; &#039;wan2&#039;
    option &#039;proto&#039; &#039;3g&#039;
    option &#039;service&#039; &#039;umts&#039;
    option &#039;device&#039; &#039;/dev/ttyUSB3&#039;
    option &#039;apn&#039; &#039;erainternet&#039;
    option &#039;pincode&#039; &#039;6093&#039;
    option &#039;username&#039; &#039;erainternet&#039;
    option &#039;password&#039; &#039;erainternet&#039;
    option &#039;maxwait&#039; &#039;10&#039;
    option &#039;peerdns&#039; &#039;0&#039;
    option &#039;defaultroute&#039; &#039;0&#039;

config &#039;switch&#039;
    option &#039;name&#039; &#039;rtl8366s&#039;
    option &#039;reset&#039; &#039;1&#039;
    option &#039;enable_vlan&#039; &#039;1&#039;
    option &#039;blinkrate&#039; &#039;2&#039;

config &#039;switch_vlan&#039;
    option &#039;device&#039; &#039;rtl8366s&#039;
    option &#039;vlan&#039; &#039;1&#039;
    option &#039;ports&#039; &#039;0 1 2 3 5t&#039;

config &#039;switch_port&#039;
    option &#039;device&#039; &#039;rtl8366s&#039;
    option &#039;port&#039; &#039;1&#039;
    option &#039;led&#039; &#039;6&#039;

config &#039;switch_port&#039;
    option &#039;device&#039; &#039;rtl8366s&#039;
    option &#039;port&#039; &#039;2&#039;
    option &#039;led&#039; &#039;9&#039;

config &#039;switch_port&#039;
    option &#039;device&#039; &#039;rtl8366s&#039;
    option &#039;port&#039; &#039;5&#039;
    option &#039;led&#039; &#039;2&#039;</code></pre></div><p>Firewall:<br /> </p><div class="codebox"><pre><code>config &#039;defaults&#039;
    option &#039;syn_flood&#039; &#039;1&#039;
    option &#039;input&#039; &#039;ACCEPT&#039;
    option &#039;output&#039; &#039;ACCEPT&#039;
    option &#039;forward&#039; &#039;REJECT&#039;
    option &#039;drop_invalid&#039; &#039;1&#039;

config &#039;zone&#039;
    option &#039;name&#039; &#039;lan&#039;
    option &#039;network&#039; &#039;lan&#039;
    option &#039;input&#039; &#039;ACCEPT&#039;
    option &#039;output&#039; &#039;ACCEPT&#039;
    option &#039;forward&#039; &#039;REJECT&#039;

config &#039;zone&#039;
    option &#039;name&#039; &#039;wan&#039;
    option &#039;input&#039; &#039;REJECT&#039;
    option &#039;output&#039; &#039;ACCEPT&#039;
    option &#039;forward&#039; &#039;REJECT&#039;
    option &#039;masq&#039; &#039;1&#039;
    option &#039;mtu_fix&#039; &#039;1&#039;
    option &#039;network&#039; &#039;wan&#039;

config &#039;rule&#039;
    option &#039;src&#039; &#039;wan&#039;
    option &#039;proto&#039; &#039;udp&#039;
    option &#039;dest_port&#039; &#039;68&#039;
    option &#039;target&#039; &#039;ACCEPT&#039;
    option &#039;family&#039; &#039;ipv4&#039;

config &#039;rule&#039;
    option &#039;src&#039; &#039;wan&#039;
    option &#039;proto&#039; &#039;icmp&#039;
    option &#039;icmp_type&#039; &#039;echo-request&#039;
    option &#039;family&#039; &#039;ipv4&#039;
    option &#039;target&#039; &#039;ACCEPT&#039;

config &#039;rule&#039;
    option &#039;src&#039; &#039;wan&#039;
    option &#039;proto&#039; &#039;icmp&#039;
    list &#039;icmp_type&#039; &#039;echo-request&#039;
    list &#039;icmp_type&#039; &#039;destination-unreachable&#039;
    list &#039;icmp_type&#039; &#039;packet-too-big&#039;
    list &#039;icmp_type&#039; &#039;time-exceeded&#039;
    list &#039;icmp_type&#039; &#039;bad-header&#039;
    list &#039;icmp_type&#039; &#039;unknown-header-type&#039;
    list &#039;icmp_type&#039; &#039;router-solicitation&#039;
    list &#039;icmp_type&#039; &#039;neighbour-solicitation&#039;
    option &#039;limit&#039; &#039;1000/sec&#039;
    option &#039;family&#039; &#039;ipv6&#039;
    option &#039;target&#039; &#039;ACCEPT&#039;

config &#039;rule&#039;
    option &#039;src&#039; &#039;wan&#039;
    option &#039;dest&#039; &#039;*&#039;
    option &#039;proto&#039; &#039;icmp&#039;
    list &#039;icmp_type&#039; &#039;echo-request&#039;
    list &#039;icmp_type&#039; &#039;destination-unreachable&#039;
    list &#039;icmp_type&#039; &#039;packet-too-big&#039;
    list &#039;icmp_type&#039; &#039;time-exceeded&#039;
    list &#039;icmp_type&#039; &#039;bad-header&#039;
    list &#039;icmp_type&#039; &#039;unknown-header-type&#039;
    option &#039;limit&#039; &#039;1000/sec&#039;
    option &#039;family&#039; &#039;ipv6&#039;
    option &#039;target&#039; &#039;ACCEPT&#039;

config &#039;include&#039;
    option &#039;path&#039; &#039;/etc/firewall.user&#039;

config &#039;forwarding&#039;
    option &#039;dest&#039; &#039;wan&#039;
    option &#039;src&#039; &#039;lan&#039;

config &#039;rule&#039;
    option &#039;target&#039; &#039;ACCEPT&#039;

config &#039;zone&#039;
    option &#039;name&#039; &#039;wan2&#039;
    option &#039;forward&#039; &#039;REJECT&#039;
    option &#039;output&#039; &#039;ACCEPT&#039;
    option &#039;network&#039; &#039;wan2&#039;
    option &#039;input&#039; &#039;REJECT&#039;
    option &#039;masq&#039; &#039;1&#039;
    option &#039;mtu_fix&#039; &#039;1&#039;

config &#039;forwarding&#039;
    option &#039;dest&#039; &#039;wan2&#039;
    option &#039;src&#039; &#039;lan&#039;</code></pre></div><p>Multiwan:<br /> </p><div class="codebox"><pre><code>config &#039;multiwan&#039; &#039;config&#039;
    option &#039;default_route&#039; &#039;fastbalancer&#039;
    option &#039;debug&#039; &#039;1&#039;

config &#039;interface&#039; &#039;wan&#039;
    option &#039;health_interval&#039; &#039;10&#039;
    option &#039;timeout&#039; &#039;3&#039;
    option &#039;health_fail_retries&#039; &#039;3&#039;
    option &#039;health_recovery_retries&#039; &#039;5&#039;
    option &#039;failover_to&#039; &#039;fastbalancer&#039;
    option &#039;dns&#039; &#039;8.8.8.8 8.8.4.4&#039;
    option &#039;weight&#039; &#039;5&#039;
    option &#039;icmp_hosts&#039; &#039;gateway&#039;

config &#039;interface&#039; &#039;wan2&#039;
    option &#039;health_interval&#039; &#039;10&#039;
    option &#039;timeout&#039; &#039;3&#039;
    option &#039;health_fail_retries&#039; &#039;3&#039;
    option &#039;health_recovery_retries&#039; &#039;5&#039;
    option &#039;weight&#039; &#039;5&#039;
    option &#039;failover_to&#039; &#039;fastbalancer&#039;
    option &#039;dns&#039; &#039;208.67.222.222 208.67.220.220&#039;
    option &#039;icmp_hosts&#039; &#039;dns&#039;

config &#039;mwanfw&#039;
    option &#039;wanrule&#039; &#039;fastbalancer&#039;</code></pre></div><p>Still I have problems with &quot;Health Monitor&quot; - simply, it dont work at all. At reboot one modem is up automatically but second needs manual start. Anybody have any idea what to do to make it work?</p>									</div>
			</article>

			
		
						<div class="notice">
				<p>Sorry, posts 301 to 300 are missing from our archive.</p>
			</div>
		
		
	
	<div class="pagination"><div class="pagination-number">Page 12 of 14</div><nav><ul><li><a href="viewtopic.php%3Fid=23904&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=23904&amp;p=10.html">10</a></li><li><a href="viewtopic.php%3Fid=23904&amp;p=11.html">11</a></li><li class="pagination-current"><span>12</span></li><li><a href="viewtopic.php%3Fid=23904&amp;p=13.html">13</a></li><li><a href="viewtopic.php%3Fid=23904&amp;p=14.html">14</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0.001 -->

</body>
</html>