<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Asterisk on OpenWRT</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 31 Mar 2018 and 1 Apr 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 3 of 3</div><nav><ul><li><a href="viewtopic.php%3Fid=1419&amp;p=1.html">1</a></li><li><a href="viewtopic.php%3Fid=1419&amp;p=2.html">2</a></li><li class="pagination-current"><span>3</span></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p16882">
				<div class="post-metadata">
					<div class="post-num">Post #51</div>
					<div class="post-author">enzo</div>
					<div class="post-datetime">
						9 Dec 2005, 10:03					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Cletus wrote:</cite><blockquote><p>Enzo,</p><p>Intermittent but frequent segfaults when a remote DUNDi peer performs a query or lookup to the OpenWRT-Asterisk box.</p><p>For example:<br />dundi query &lt;EID&gt;@&lt;dundi-context&gt;<br />or <br />dundi lookup 12145551212@&lt;dundi-context&gt;</p><p>occasionaly I will get a response, but for the most part it just segfaults.&nbsp; </p><p>This is on OpenWRT RC3 using Asterisk from Brian Capouch repository.&nbsp; Specifically<br /><a href="http://12.176.248.4/ipkg/asterisk-cvs_1.0.36_mipsel.ipk">http://12.176.248.4/ipkg/asterisk-cvs_1.0.36_mipsel.ipk</a></p><p>cletus</p></blockquote></div><p>I couldn&#039;t say: at the moment mine (that I got from <a href="http://tracker.openwrt.org/packages/show.php?id=3849">http://tracker.openwrt.org/packages/show.php?id=3849</a> ) is loaded but doesn&#039;t do anything because I haven&#039;t configured it.&nbsp; However, is appears to be alive:</p><div class="codebox"><pre><code>OpenWrt*CLI&gt; dundi show trans
Remote                 Src   Dst   Tx  Rx  Ack
64.215.96.114   : 4520 07391 00000 001 000 000
OpenWrt*CLI&gt; dundi lookup 12145551212
DUNDi lookup returned no results.
DUNDi lookup completed in 8 ms
OpenWrt*CLI&gt;</code></pre></div><p>Enzo</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p16941">
				<div class="post-metadata">
					<div class="post-num">Post #52</div>
					<div class="post-author">Cletus</div>
					<div class="post-datetime">
						9 Dec 2005, 23:25					</div>
				</div>
				<div class="post-content content">
					<p>Enzo,<br />Yeah, the module (pbx_dundi.so) starts fine and will sync with other DUNDi peers defined in dundi.conf, but asterisk segfaults if one of the peers performs a DUNDi query to it.</p><div class="codebox"><pre><code>frink*CLI&gt; dundi show peers 
EID                  Host                Model      AvgTime  Status         
00:12:1f:34:da:23    11.111.101.12   (S) Symmetric  Unavail  OK (35 ms)     
00:23:27:c5:5f:16    22.22.222.122   (S) Symmetric  Unavail  Unmonitored    
2 dundi peers [1 online, 0 offline, 1 unmonitored]</code></pre></div><p>I tried it on a couple of x86 boxes this afternoon and am not seeing the problem..</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p17184">
				<div class="post-metadata">
					<div class="post-num">Post #53</div>
					<div class="post-author">nrg</div>
					<div class="post-datetime">
						14 Dec 2005, 12:05					</div>
				</div>
				<div class="post-content content">
					<p>I someone of you great developers is trying to port asterisk 1.2?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p17400">
				<div class="post-metadata">
					<div class="post-num">Post #54</div>
					<div class="post-author">Wallace78</div>
					<div class="post-datetime">
						18 Dec 2005, 05:07					</div>
				</div>
				<div class="post-content content">
					<p>EDIT: I wrote a long message asking for advices. I&#039;m deleting it beacouse I noticed only now that it was in the developer forum.</p><p>Cheers</p>											<p class="post-edited">(Last edited by <strong>Wallace78</strong> on 18 Dec 2005, 12:38)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p17430">
				<div class="post-metadata">
					<div class="post-num">Post #55</div>
					<div class="post-author">Wallace78</div>
					<div class="post-datetime">
						18 Dec 2005, 22:51					</div>
				</div>
				<div class="post-content content">
					<p>I have a strange problem that I don&#039;t know how to debug.</p><p>My small little cuties are RC4+Freifunk+DiffServ+Asterisk (I&#039;m building a complete package to share it; I&#039;m shy of my rude code...just willing to beautify it); everything works fine excepted one thing.<br />Asterisk at boot starts but outbound proxies are not registered.<br />If I remove the startup script and I start it manually, it works fine; also, if I restart it after boot, it works fine.<br />When half-working, users can register and can call each other; only peers can&#039;t be registered and If I issue a &quot;sip show registry&quot; in the CLI, I get Unregistered state for every proxy.<br />In the CLI appear messages about peers registration timing out.</p><p>Same behaviour for 1.0.7 in experimental repository and 1.0.9 in Nico&#039;s test repository (I&#039;m using last one beacouse of some SIP bugs that 1.0.7 used to have); I couldn&#039;t test the latest from the french guy (1.0.36...) beacouse I couldn&#039;t find the proper libssl for it...</p><p>Other weirdness is the &quot;restart&quot; command in the CLI: it completeley hangs asterisk! CLI doesn&#039;t disconnect but the server doesen&#039;t answer to any command any more; If I exit the CLI, then I cannot reconnect and even a stop doesn&#039;t work (I&#039;ve to kill it and restart again).</p><p>All these bugs are fully replicable. Any clue?</p><p>Regards</p><p>Wallace</p><p>EDIT: I also tried to add some sleeps around the scripts, but nothing changed. I even don&#039;t know where to look at to dig in the hole and find the bug.</p><p>EDIT2: Delaying for more than 60 secs it start properly at boot. It seems that the problem appear if asterisk starts (and try to register on internet proxies) before the &quot;mesh handshaking time&quot; (propagating default route) has finished...</p>											<p class="post-edited">(Last edited by <strong>Wallace78</strong> on 19 Dec 2005, 00:18)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p17433">
				<div class="post-metadata">
					<div class="post-num">Post #56</div>
					<div class="post-author">nicheware</div>
					<div class="post-datetime">
						19 Dec 2005, 00:20					</div>
				</div>
				<div class="post-content content">
					<p>Hi Wallace,</p><p>I have a possible work-around on the registry problem, although it is also a bit messy.&nbsp; I have problems with IAX registrations and sudden death of Asterisk when call-waiting occurrs.&nbsp; I restart asterisk with the following script called by cron- which runs every 5 minutes.&nbsp; It leaves behind a file in the /tmp dir which shows me when stuff has died, or wasn&#039;t registered properly.&nbsp; Change the &quot;IAX show registry&quot; below, to sip show registry, or whatever works at the command line.&nbsp; </p><div class="codebox"><pre><code>#!/bin/ash
mypeername=&quot;peername&quot;  #peer you want to maintain registraiton to
for peername in $mypeername
do
otpt=`/usr/sbin/asterisk -rx &#039;iax2 show registry&#039; |/bin/grep $mypeername |/bin/grep Registered`
sleep 3
if [ -n &quot;$otpt&quot; ]; then
#echo $otpt | mail -s &quot;Asterisk peer: \&quot;`echo -n $peername `\&quot; isnt registered.&quot; &quot;email@yourdomain.com&quot;
     echo  $otpt &gt;/tmp/asteriskstatus
#     echo -n &#039; Peer &#039;
#     echo -n $mypeername
#     echo &#039; is registered!&#039;
else
     /bin/date &gt;&gt;/tmp/asteriskdown
#     echo &quot;$mypeername is NOT registered&quot;
#     echo &quot;KILLING ASTERISK&quot;
        /usr/bin/killall -9 asterisk
#       echo &quot;Sleeping 5 Seconds&quot;
        sleep 5
#       echo &quot;restarting asterisk&quot;
        /etc/init.d/S60asterisk start
fi
#echo -n $peername
#echo &#039; done&#039;

done</code></pre></div><p>note: you can take out comments as appropriate for testing this from the command line before installing it...</p><p>I would be very interested if you have a smaller build of asterisk with no voicemail and extra features in your own ipk file with call-waiting working.&nbsp; Have you tested call waiting yet?</p><p>Tom</p><p>PS: the problem itself sounds like a bug in the sip channel...</p>											<p class="post-edited">(Last edited by <strong>nicheware</strong> on 20 Dec 2005, 07:16)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p17478">
				<div class="post-metadata">
					<div class="post-num">Post #57</div>
					<div class="post-author">Wallace78</div>
					<div class="post-datetime">
						19 Dec 2005, 18:05					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>nicheware wrote:</cite><blockquote><p>I have a possible work-around on the registry problem, although it is also a bit messy.</p></blockquote></div><p>Thanks Tom! The work-around is fine, but surely is not the definitive solution beacouse it restart asterisk if only one proxy is not registered.<br />What does it happen if, for example, the proxy doesn&#039;t register for a voip service failure lasting a few hours? The pbx would restart every X minutes making any telephone call bumping every X minutes...<br />I just added this check every 10 minutes (togheter with the update of the external IP that already does); but I want to investigate further...</p><div class="quotebox"><cite>nicheware wrote:</cite><blockquote><p>I would be very interested if you have a smaller build of asterisk with no voicemail and extra features in your own ipk file with call-waiting working.&nbsp; Have you tested call waiting yet?</p></blockquote></div><p>I&#039;m packaging everything inside the dir custom files dir of the ImageBuilder (RC4); I didn&#039;t build any package yet; only firmware binary images.<br />And I&#039;m mixing everything up in that dir, binaries and configs: modded freifunk (1.0.7) packages&#039; files, qos based on diffserv (ingress+htb+red+gred+sfq) and finally Asterisk.<br />About Asterisk, starting from 1.0.9 in Nico&#039;s repository, I just did a &quot;show modules&quot; from CLI, deleted all the modules not loaded by default and taken the needed ones; to have minimal working installation. That&#039;s all.<br />I&#039;m working on the dial plan now, to add the needed app_*.so modules; I also removed app_sayunixtime and app_milliwatt (are they needed???). Do you want an ipkg with this minimal installation?</p><div class="quotebox"><cite>nicheware wrote:</cite><blockquote><p>PS: the problem itself sounds like a bug in the sip channel...</p></blockquote></div><p>I&#039;m not sure of it; do have you the same problem on iax or you use the script for other reasons?<br />Beacouse if you have the problem, it is not a sip channel bug; if not, it could be!<br />It seems that, if the first registration goes bad, it never register again and start complaining in the CLI for registration time outs...</p><p>ciao</p><p>Michele</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p17492">
				<div class="post-metadata">
					<div class="post-num">Post #58</div>
					<div class="post-author">nicheware</div>
					<div class="post-datetime">
						19 Dec 2005, 19:47					</div>
				</div>
				<div class="post-content content">
					<p>Michele,</p><p>You can modify the script to do a reload instead of a full kill of asterisk... replace that part with:</p><p>dummy=`/usr/sbin/asterisk -rx &#039;sip reload&#039; ` #&lt;take out whitespace before backquote<br />or</p><p>dummy=`/usr/sbin/asterisk -rx &#039;reload&#039;`</p><p>That would be a bit less drastic than starting asterisk entirely.&nbsp; </p><p>EDIT: Other questions...<br /></p><div class="quotebox"><cite>Wallace78 wrote:</cite><blockquote><p>I&#039;m working on the dial plan now, to add the needed app_*.so modules; I also removed app_sayunixtime and app_milliwatt (are they needed???). <br />Do you want an ipkg with this minimal installation?</p></blockquote></div><p>Depending on what codecs you want to use, if you want voicemail, and stripping out other features it is possible to get an asterisk build running with only the following modules loaded by force in modules.conf...&nbsp; here is one of mine:</p><div class="codebox"><pre><code>[modules]
autoload=no

load=res_features.so ; Call Parking Resource
load=chan_iax2.so ; Inter Asterisk eXchange (Ver 2)
load=chan_local.so ; Local Proxy Channel
load=chan_sip.so ; Session Initiation Protocol (SIP)
load=codec_gsm.so ; GSM/PCM16 (signed linear) Codec Translat
load=codec_ulaw.so ; Mu-law Coder/Decoder
load=format_gsm.so ; Raw GSM data
load=format_pcm.so ; Raw uLaw 8khz Audio support (PCM)
load=format_wav.so ; Microsoft WAV format (8000hz Signed Line
load=format_wav_gsm.so ; Microsoft WAV format (Proprietary GSM)
load=app_dial.so ; Dialing Application
load=app_echo.so ; Simple Echo Application
load=app_macro.so ; Extension Macros
load=app_milliwatt.so ; Digital Milliwatt (mu-law) Test Applicat
load=app_playback.so ; Trivial Playback Application
load=app_sayunixtime.so ; Say time
load=app_transfer.so ; Transfer
load=app_verbose.so ; Send verbose output
load=pbx_config.so ; Text Extension Configuration
[global]</code></pre></div><p>I believe some of those may be unneeded for your installation.&nbsp; Milliwat I believe is required if you&#039;re using the ULAW codec- not sure on that.&nbsp; I use it across the lan, but then send everying IAX to the outside world.<br /></p><div class="quotebox"><cite>Wallace78 wrote:</cite><blockquote><p>I&#039;m not sure of it; do have you the same problem on iax or you use the script for other reasons?<br />Beacouse if you have the problem, it is not a sip channel bug; if not, it could be!<br />It seems that, if the first registration goes bad, it never register again and start complaining in the CLI for registration time outs...</p></blockquote></div><p>I have clients that hang when a call waiting beep comes in.&nbsp; Most clients stay registered but due to occasional IP address changes on the clients sometimes they become dissassociated with their iax registry.&nbsp; I&#039;ve experienced the same issue you&#039;re having at the cli prompt with restart gracefully or restart now not working - thus the killall approach in the original script.&nbsp; Sometimes there have been threads hanging there when I tried to start asterisk after a crash.&nbsp; It&#039;s simply not a stable application yet.&nbsp; I&#039;ve tried it on approximately a dozen routers now - 6 WRT54G and 6 Motorola WR850G.&nbsp; Same problems on all of them.</p><p>I&#039;ve been using asterisk for more than 3 years now, but, mostly on full X86 machines running usually as dedicated firewalls for my customers.&nbsp; Adding these WRT boxes to my network would put me in a nice position to be able to offer a VOIP solution that utilizes existing infrastructure and adds the wireless feature.&nbsp; I handle voicemail for about 30 users extensions on a dedicated machine in the US anyway- so my main goal is to get as tiny and stable as possible build with the bugs worked out.&nbsp; People here are working in the wrong direction in my opinion- greatly complicating things with asterisk.&nbsp; It needs to be minimal- with the features hosted on a machine with more horsepower, floating point, and storage on a hard drive.&nbsp; Whay rewrite voicemail messages in three formats onto either volatile memory or flash?&nbsp; (most people don&#039;t know about the three formats - even if you select only one the message is still written in three files)&nbsp; &nbsp; I&#039;m using ULAW on my phones and sending GSM out over IAX- so I&#039;ve removed a lot of files having to do with unused codecs.&nbsp; </p><p>Tom</p>											<p class="post-edited">(Last edited by <strong>nicheware</strong> on 20 Dec 2005, 07:08)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p17619">
				<div class="post-metadata">
					<div class="post-num">Post #59</div>
					<div class="post-author">lschweiss</div>
					<div class="post-datetime">
						21 Dec 2005, 18:00					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>nicheware wrote:</cite><blockquote><p>People here are working in the wrong direction in my opinion- greatly complicating things with asterisk.&nbsp; It needs to be minimal- with the features hosted on a machine with more horsepower, floating point, and storage on a hard drive.&nbsp; Whay rewrite voicemail messages in three formats onto either volatile memory or flash?&nbsp; (most people don&#039;t know about the three formats - even if you select only one the message is still written in three files)&nbsp; &nbsp; I&#039;m using ULAW on my phones and sending GSM out over IAX- so I&#039;ve removed a lot of files having to do with unused codecs.</p></blockquote></div><p>I couldn&#039;t agree with you more.&nbsp; The core of Asterisk on WRT needs to be stable first.&nbsp; With the exception of using an ASUS 500dlx and an USB hard disk, voice mail really doesn&#039;t belong on an small flash/memory WRT.&nbsp; Use NFS or SMB to put voice mail on a hard disk based storage.&nbsp; </p><p>You can reduce the number of formats Asterisk writes with the format option in voicemail.conf.&nbsp; I keep all my voice mail stored in gsm only since all outside connections are gsm over IAX2.&nbsp; I can&#039;t say about Asterisk v. 1.0.7 as in White Russian RC4, but in 1.2.1 on my production boxes only gsm is getting written to the HD.&nbsp; </p><p>The other big concern are the files that Asterisk writes to very frequently.&nbsp; ast.db in particular.&nbsp; Keeping that on the flash system is bound to cause problems with the flash after a relatively short life in production.&nbsp; A cron job to copy this file from the ram disk to flash on a semi-regular basis (maybe once or twice a day) is definitely something to consider.&nbsp; &nbsp;</p><p>I have Asterisk running in production on one WRT54GS now for several months with White Russian RC2.&nbsp; All it is doing is routing calls from a sip phone (ulaw) to IAX2 (gsm).&nbsp; This has been very stable.&nbsp; But I&#039;m not using many features of Asterisk at all on this router.&nbsp; The big benefit of this installation is the added jitterbuffer and gsm compression that the SIP phone connecting to an Internet based asterisk box would not accomplish.&nbsp; Sound quality with Asterisk on the WRT was greatly improved over connecting the SIP phone directly to the Asterisk box on the net.</p><p>Another insteresting implementation of Asterisk on a relatively in-expensive device.&nbsp; Is on the gumstix:</p><p><a href="http://the-edge.blogspot.com/2005/10/worldss-smallest-ip-pbx-at-astricon.html">http://the-edge.blogspot.com/2005/10/wo … ricon.html</a></p><p><a href="http://www.gumstix.org">http://www.gumstix.org</a></p><p><a href="http://www.gumstix.com">http://www.gumstix.com</a></p><p>Chip</p>											<p class="post-edited">(Last edited by <strong>lschweiss</strong> on 21 Dec 2005, 18:01)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p17727">
				<div class="post-metadata">
					<div class="post-num">Post #60</div>
					<div class="post-author">enzo</div>
					<div class="post-datetime">
						23 Dec 2005, 15:10					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>lschweiss wrote:</cite><blockquote><p>The other big concern are the files that Asterisk writes to very frequently.&nbsp; ast.db in particular.&nbsp; Keeping that on the flash system is bound to cause problems with the flash after a relatively short life in production.&nbsp; A cron job to copy this file from the ram disk to flash on a semi-regular basis (maybe once or twice a day) is definitely something to consider.</p></blockquote></div><p>You may try my startup script, which replaces the default /etc/init.d/asterisk (symlinked by /etc/init.d/S60asterisk ).&nbsp; Besides relocating astdb to RAM, and back to flash at &quot;stop&quot; time, it runs asterisk as non-root for additional security. I&#039;m attaching its latest version, as older incarnations suffered from bugs:<br /></p><div class="codebox"><pre><code>#!/bin/sh

#DEFAULT=/etc/default/asterisk
#OPTIONS=&quot;&quot;
OPTIONS=&quot;-U asterisk -G asterisk&quot;
#[ -f $DEFAULT ] &amp;&amp; . $DEFAULT
#[ &quot;$ENABLE_ASTERISK&quot; = &quot;yes&quot; ] || exit 0

echolog() {
  echo &quot;$@&quot;
  logger -p user.info &quot;$@&quot;
}

# do a &quot;chown -R&quot; only if some file in the dir is owned by root
cond_chown_r() { # user file-or-dir
  MATCHLIST=$(ls -ld $2 | grep &#039;root&#039;)
  MATCHLIST=$MATCHLIST$(ls -lR $2 | grep &#039;root&#039;)
  if [ ! -z &quot;$MATCHLIST&quot; ] ; then
    chown -R $1 $2
    echo chown -R $1 $2
  fi
}

# replace symlinks to /rom/... with actual copies
deromize() {
  if [ -L $1 ] ; then
    POINTEDFILE=&quot;$(ls -l /etc/group |  cut -d &#039;&gt;&#039; -f 2-)&quot;
    rm $1
    cp $POINTEDFILE $1
  fi
}



start() {

  PIDLIST=$(pidof asterisk)
  if [ ! -z &quot;$PIDLIST&quot; -a &quot;$PIDLIST&quot; != &quot;$$&quot; ] ; then
   echolog &quot;Asterisk is already running!&quot;
   return 1
  fi

  [ -d /var/run ] || mkdir -p /var/run
  [ -d /var/log/asterisk ] || mkdir -p /var/log/asterisk
  [ -d /var/log/asterisk/cdr-csv ] || mkdir -p /var/log/asterisk/cdr-csv
  [ -f /var/log/asterisk/cdr-csv/Master.csv ] || touch /var/log/asterisk/cdr-csv/Master.csv
  [ -d /var/log/asterisk/cdr-custom ] || mkdir -p /var/log/asterisk/cdr-custom
  [ -f /var/log/asterisk/cdr-custom/Master.csv ] || touch /var/log/asterisk/cdr-custom/Master.csv
  [ -d /var/spool/asterisk ] || mkdir -p /var/spool/asterisk
  [ -d /var/spool/asterisk/voicemail ] || mkdir -p /var/spool/asterisk/voicemail

  deromize /etc/group
  # create the group &quot;asterisk&quot;, unless already there
  if [ -z &quot;$(grep &#039;^asterisk:&#039; /etc/group)&quot; ] ; then
    MATCHING=&quot;$(grep &#039;:5060:&#039; /etc/group)&quot;
    if [ -z &quot;$MATCHING&quot; ] ; then
      echo &quot;asterisk:x:5060:&quot; &gt;&gt; /etc/group
    else
      echo &quot;** error in ${0} - GID 5060 already in use by others:&quot;
      echo $MATCHING
      exit 1
    fi
  fi

  deromize /etc/passwd
  # create the user &quot;asterisk&quot;, unless already there
  if [ -z &quot;$(grep &#039;^asterisk:&#039; /etc/passwd)&quot; ] ; then
    MATCHING=&quot;$(grep &#039;:5060:&#039; /etc/passwd)&quot;
    if [ -z &quot;$MATCHING&quot; ] ; then
      echo &quot;asterisk:*:5060:5060:asterisk:/tmp:/bin/ash&quot; &gt;&gt; /etc/passwd
    else
      echo &quot;** error in ${0} - UID 5060 already in use by others:&quot;
      echo $MATCHING
      exit 1
    fi
  fi
  # change ownership of all relevant directories
  chmod 711 /var/spool
  cond_chown_r asterisk.asterisk /var/log/asterisk/cdr-csv
  cond_chown_r asterisk.asterisk /var/log/asterisk
  cond_chown_r asterisk.asterisk /var/spool/asterisk
  cond_chown_r asterisk.asterisk /etc/asterisk
  cond_chown_r asterisk.asterisk /usr/lib/asterisk
  #obsolete: use OPTIONS=&quot;-U asterisk -G asterisk&quot;
  # cond_chown_r asterisk.asterisk /usr/sbin/asterisk
  #
  # the following hack will stay until autodial.ctl and
  # asterisk.ctl will be moved to a directory writable
  # by Asterisk (such as /var/spool/asterisk)
  chgrp asterisk /var/run
  chmod 775 /var/run
  [ -e /var/run/autodial.ctl ] || chown asterisk.asterisk /var/run/autodial.ctl
  [ -e /var/run/asterisk.ctl ] || chown asterisk.asterisk /var/run/asterisk.ctl
  #
  # make the binary suid, so it won&#039;t run as root
  #obsolete: use OPTIONS=&quot;-U asterisk -G asterisk&quot;
  #chmod +s /usr/sbin/asterisk

  while [ -z &quot;$(route | grep &#039;0\.0\.0\.0&#039;)&quot; ] ; do
    echolog &quot;waiting for default route to exist...&quot;
    sleep 2
  done

  # if astdb n /usr/.... is not a symlink...
  if [ ! -L /usr/lib/asterisk/astdb ] ; then
    # if it exists and it&#039;s a file, move it to /var/....
    if [ -f /usr/lib/asterisk/astdb ] ; then
      mv /usr/lib/asterisk/astdb /var/spool/asterisk/astdb
    fi
    # ...and anyway, put here a symlink to /var/....
    ln -s /var/spool/asterisk/astdb /usr/lib/asterisk/astdb
  fi

  /usr/sbin/asterisk $OPTIONS
  logger -p user.info &quot;Asterisk started...&quot;

}

stop() {

  PIDLIST=$(pidof asterisk)
  if [ -z &quot;$PIDLIST&quot; -o &quot;$PIDLIST&quot; = &quot;$$&quot; ] ; then
   echolog &quot;Asterisk is already stopped!&quot;
   return 1
  fi

  [ -f /var/run/asterisk.pid ] &amp;&amp; kill $(cat /var/run/asterisk.pid) &gt;/dev/null 2&gt;&amp;1

  ICNT=0
  for ICNT in 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15; do
    # for max 15 s, see if some process is still alive
    PIDLIST=$(pidof asterisk)
    if [ -z &quot;$PIDLIST&quot; -o &quot;$PIDLIST&quot; = &quot;$$&quot; ] ; then
      break
    fi
    sleep 1
  done
  # if still alive after more than 5 s, use &quot;kill -9&quot;
  if [ ! -z &quot;$PIDLIST&quot; -a &quot;$PIDLIST&quot; != &quot;$$&quot; ] ; then
    echolog &quot;killing stubborn processes $PIDLIST&quot;
    for GONER in $PIDLIST; do kill -9 $GONER; done
  fi
  # save astdb to a flash-mapped directory
  if [ -L /usr/lib/asterisk/astdb ] ; then
    rm /usr/lib/asterisk/astdb
  fi
  if [ -f /var/spool/asterisk/astdb ] ; then
    mv -f /var/spool/asterisk/astdb /usr/lib/asterisk/astdb
  fi
  logger -p user.info &quot;Asterisk stopped...&quot;

}


case $1 in
 start)
  start
  ;;
 stop)
  stop
  ;;
 restart)
  stop
  start
  ;;
 *)
  echo &quot;usage: $0 (start|stop|restart)&quot;
  exit 1
esac

exit $?</code></pre></div><p>Enzo</p>											<p class="post-edited">(Last edited by <strong>enzo</strong> on 26 Jun 2006, 10:12)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p18040">
				<div class="post-metadata">
					<div class="post-num">Post #61</div>
					<div class="post-author">Wallace78</div>
					<div class="post-datetime">
						31 Dec 2005, 17:19					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>enzo wrote:</cite><blockquote><p>You may try my startup script, which replaces the default /etc/init.d/asterisk (symlinked by /etc/init.d/S60asterisk ).&nbsp; Besides relocating astdb to RAM, and back to flash at &quot;stop&quot; time, it runs asterisk as non-root for additional security. I&#039;m attaching its latest version, as older incarnations suffered from bugs:<br />Enzo</p></blockquote></div><p>I took your good script and integrated into mine (astdb trick; delayed startup, etc); I use a SIP-only stripped down 1.0.7 asterisk installation; configuration files are created at boot time in /var/etc/asterisk so that I can get configuration (extensions, SIP phone lines, etc) from nvram (that is then updated by web interface) and build custom conf...<br />In this environment I made a link once:<br /></p><div class="codebox"><pre><code>ln -s /usr/lib/asterisk/astdb /var/etc/asterisk/astdb</code></pre></div><p>...so that there&#039;s no need to copy astdb and put it back in place.</p><p>I&#039;m building a wireless mesh network with voice capabilities in my small town; as soon as I reach my ver. 1.0.0, I&#039;ll release my code... as while I am writing, the scripts/code are soo messy that I&#039;m even having troubles to remember what I did... that&#039;s hemp fault...</p><p>ciao</p><p>Wallace</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p18063">
				<div class="post-metadata">
					<div class="post-num">Post #62</div>
					<div class="post-author">enzo</div>
					<div class="post-datetime">
						1 Jan 2006, 04:11					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Wallace78 wrote:</cite><blockquote><p>In this environment I made a link once:<br /></p><div class="codebox"><pre><code>ln -s /usr/lib/asterisk/astdb /var/etc/asterisk/astdb</code></pre></div><p>...so that there&#039;s no need to copy astdb and put it back in place.</p></blockquote></div><p>But in that case if you power off the device the content of astdb is lost. Normally that&#039;s no big deal, because by default Asterisk puts there only registration information, but sometimes other apps could save there important data (e.g., call forwarding extensions) intended to be persistent. <br /></p><div class="quotebox"><cite>Wallace78 wrote:</cite><blockquote><p>I&#039;m building a wireless mesh network with voice capabilities in my small town; as soon as I reach my ver. 1.0.0, I&#039;ll release my code... as while I am writing, the scripts/code are soo messy that I&#039;m even having troubles to remember what I did... that&#039;s hemp fault...</p></blockquote></div><p>Have you tried Freifunk, or some other similar system ported to OpenWRT?</p><p>Happy New Year,</p><p>Enzo</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p18299">
				<div class="post-metadata">
					<div class="post-num">Post #63</div>
					<div class="post-author">doerner</div>
					<div class="post-datetime">
						4 Jan 2006, 18:16					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>I just finished 2 little PDF-How-Tos ( a 3rd will follow soon):<br />The first is about setting the caller-id based on a flat-file database (basically a simple shell AGI-script), the second is about a little SOAP-cgi-script to initiate calls. They are linked from the site <br /><a href="http://www.voiscout.de/howto.html">http://www.voiscout.de/howto.html</a> (although the site is in German, the How-Tos are in English).</p><p>The 3rd How-To will be about transforming the cdr-file into a .ics-calendar file. This is the format of the Mozilla calendar and Apples iCal. So you can subscribe to your calls ....</p><p>Please let me know, how to improve these how-tos.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p18300">
				<div class="post-metadata">
					<div class="post-num">Post #64</div>
					<div class="post-author">zoo</div>
					<div class="post-datetime">
						4 Jan 2006, 18:38					</div>
				</div>
				<div class="post-content content">
					<p>doerner: You should enter this in the wiki at voip-info.org as click-to-dial solution...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p18401">
				<div class="post-metadata">
					<div class="post-num">Post #65</div>
					<div class="post-author">Wallace78</div>
					<div class="post-datetime">
						6 Jan 2006, 16:59					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>enzo wrote:</cite><blockquote><p>But in that case if you power off the device the content of astdb is lost. Normally that&#039;s no big deal, because by default Asterisk puts there only registration information, but sometimes other apps could save there important data (e.g., call forwarding extensions) intended to be persistent.</p></blockquote></div><p>At the moment the dialplan consist in replicating the mesh IP numbering plan for &quot;P2P telephony&quot; (from node to node) and outbound proxy registration (voip phone lines); it is very simple and uses only dial and playback applications... so... I still didn&#039;t find any problem in loosing astdb. Moreover WRTs have an average of 7 days uptime, so the astdb file doesn&#039;t get lost very often... surely it is not a big deal, but works for me <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /><br />A new entry in our group it is going to develop the voip further; I simply hadn&#039;t time to work on it properly.</p><div class="quotebox"><cite>enzo wrote:</cite><blockquote><p>Have you tried Freifunk, or some other similar system ported to OpenWRT?</p></blockquote></div><p>I tried Freifunk but it used to have two problems: a) performance problems (packet loss,low troughput); b) it couldn&#039;t run software from current OpenWrt distribution.<br />So I got binaries (olsrd, its modules, rdate, etc), webif and startup scripts from Freifunk ipkgs; then placed them on RC4 and debugged them. Then added a DiffServ domain for QoS purposes, Asterisk (nat traversal &quot;private cable network&lt;--&gt;mesh&quot;), Siproxd on edge routers (nat traversal &quot;mesh&lt;--&gt;internet&quot;) and a few pages to configure/check QoS and VOIP confs/infos.<br />The result is a rock solid mesh counting 11 nodes (and more) with 1280/640 kbit/s on every link with voice capabilities. And everything in the mesh works as intended to be; the only problem is on the internet side as we don&#039;t have enough internet bandwidth (upstream is 256kbit/s) so telephone calls outside the mesh aren&#039;t always 100% clear. Moreover to make VOIP work, I had to setup a very low ceil on qdiscs limiting bw to 1280/640; but I&#039;m thinking about a dynamic ceil based on iptraf hourly tests... let&#039;s see...</p><p>At the moment I&#039;m planning to do it from scratch to get rid of Freifunk webif and use the OpenWrt one... the Freifunk web interface is very nice and has a lot of smart features, but I think it is better to merge its features to the OpenWrt one, now that one exists.</p><p>I&#039;m also thinking on going from ad-hoc to WDS mode; a sort of &quot;dynamic WDS&quot;. I already did it a few months ago but the other guys were unhappy of performances (about 8mbit/s on every link; but at that time we used to have a bridged WDS that had 18-20mbit/s on every link... before &quot;hidden node&quot; appeared).<br />This beacouse of two main problems we have now: a) not enough bandwidth, b) no encryption (only mac filters with iptables to avoid unknown users).</p><p>ciao</p><p>Wallace</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p22963">
				<div class="post-metadata">
					<div class="post-num">Post #66</div>
					<div class="post-author">enzo</div>
					<div class="post-datetime">
						16 Mar 2006, 12:23					</div>
				</div>
				<div class="post-content content">
					<p>New AGI-less replacement for LCDial.sh!</p><p>As I have recently posted to <a href="http://www.voip-info.org/wiki/index.php?page=LCDial.sh%20AGI%20script">http://www.voip-info.org/wiki/index.php … I%20script</a> , the &quot;Least Cost Dial&quot; AGI script LCDial.sh has now a replacement that only uses dialplan features (no AGI anymore). Needless to say, it&#039;s much faster... LCDC, the &quot;Least Cost Dialplan Compiler&quot;, is a shell script that produces a fragment of dialplan that can be #include&#039;d in extensions.conf and used by invoking a macro rather than AGI(LCDial.sh....). IPKG package and code/doc for a quick inspection are available from link on the wiki page mentioned above.</p><p>Enzo</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p23569">
				<div class="post-metadata">
					<div class="post-num">Post #67</div>
					<div class="post-author">antony</div>
					<div class="post-datetime">
						25 Mar 2006, 04:21					</div>
				</div>
				<div class="post-content content">
					<p>Hi. I have an ASUS WL-HDD 2.5 running OpenWRT WhiteRussian RC4 and asterisk 1.0.7 (from the latest stable package) for some time now. After a lot of fuss (<a href="http://forum.openwrt.org/viewtopic.php?pid=23566">http://forum.openwrt.org/viewtopic.php?pid=23566</a>) I got the ASUS to talk to a USB ISDN adapter, so I am now happily routing calls from ISDN to my 2 Linksys PAP2-NA&#039;s (4 SIP lines). I&#039;d like to share my findings here and ask for some advice from the asterisk gurus...</p><p>First of all, I use a very small modules.conf:</p><div class="codebox"><pre><code>  [modules]
  autoload = no
  load =&gt; res_features.so ; Call Parking Resource
  load =&gt; res_musiconhold.so ; Music On Hold Resource
  load =&gt; chan_sip.so ; Session Initiation Protocol (SIP)
  load =&gt; chan_modem.so
  load =&gt; codec_a_mu.so ; A-law and Mulaw direct Coder/Decoder
  load =&gt; codec_alaw.so ; A-law Coder/Decoder
  load =&gt; codec_ulaw.so ; Mu-law Coder/Decoder
  load =&gt; format_pcm.so ; Raw uLaw 8khz Audio support (PCM)
  load =&gt; format_pcm_alaw.so ; Raw aLaw 8khz PCM Audio support
  load =&gt; format_sln.so ; Raw Signed Linear Audio support (SLN)
  load =&gt; app_dial.so ; Dialing Application
  load =&gt; app_echo.so ; Simple Echo Application
  load =&gt; app_macro.so ; Extension Macros
  load =&gt; app_playback.so ; Trivial Playback Application
  load =&gt; app_transfer.so ; Transfer
  load =&gt; pbx_config.so ; Text Extension Configuration
  [global]                                               
  chan_modem.so=yes</code></pre></div><p>In order to use chan_modem I had to disable any dtmf detection. If asterisk does the dtmf detection the system is rendered unusable and if i4l does the dtmf detection I hear tones when someone speaks too loud on the phone. So, I just set dtmfmode=none in modem.conf.</p><p>The WL-HDD has a hard disk, so I installed everything related to asterisk there. Also, because I want the system to stay quiet at nights, I made a package with hdparm and shut down the disk after it&#039;s idle for 5 minutes. The only thing that remains in memory is /var/spool/asterisk. For some wierd reason even if I link a subfolder of /var/spool/asterisk (like /var/spool/asterisk/voicemail) to a folder on the disk, asterisk will not let the disk to spin down - the disk will immediately restart. So, at least for now, I just don&#039;t use voicemail.</p><p>To implement MOH, I converted my mp3&#039;s to raw and use a &quot;rawplayer&quot; binary:</p><div class="codebox"><pre><code>#!/bin/sh

while [ 1 ]; do
        for name in $@; do
                cat $name || exit;
        done
done</code></pre></div><p>My first dissapointment is that the system can not handle the loading of res_indications.so. I need that module, because when I transfer a line the caller can not hear the extension ringing. There is silence until the new callee picks up the phone. <strong>Is there any other way to implement this?</strong> If I load the module, the caller can hear the line ring, but the sound quality is awful - unacceptable.</p><p>What&#039;s more important is that after some hours of usage, I have no outgoing sound on incoming calls. When somebody calls, asterisk rings the phones ok, I can pickup the line and listen, but they can not hear me... Restarting asterisk does not seem to help, so I believe that maybe this has to do with the USB ISDN driver. Restarting the system solves the problem. <strong>Could this be related to asterisk?</strong></p><p>I wish I could run linux 2.6 on this thing and use the mISDN driver... <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Antony</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p23571">
				<div class="post-metadata">
					<div class="post-num">Post #68</div>
					<div class="post-author">enzo</div>
					<div class="post-datetime">
						25 Mar 2006, 04:56					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>antony wrote:</cite><blockquote><p>[...]<br />In order to use chan_modem I had to disable any dtmf detection. If asterisk does the dtmf detection the system is rendered unusable and if i4l does the dtmf detection I hear tones when someone speaks too loud on the phone. So, I just set dtmfmode=none in modem.conf.</p></blockquote></div><p>I suspect that this has the same cause as the inability to use &quot;dtmfmode=inband&quot; in sip.conf, and that both depend of insufficient CPU horsepower to run the DSP code in dsp.c . When I enable &quot;dtmfmode=inband&quot; in sip.conf, the speech becomes sl-o-ow a-and stu-u-tte-ri-ing....<br /></p><div class="quotebox"><cite>antony wrote:</cite><blockquote><p>The WL-HDD has a hard disk, so I installed everything related to asterisk there. Also, because I want the system to stay quiet at nights, I made a package with hdparm and shut down the disk after it&#039;s idle for 5 minutes. The only thing that remains in memory is /var/spool/asterisk. For some wierd reason even if I link a subfolder of /var/spool/asterisk (like /var/spool/asterisk/voicemail) to a folder on the disk, asterisk will not let the disk to spin down - the disk will immediately restart. So, at least for now, I just don&#039;t use voicemail.</p></blockquote></div><p>Perhaps Asterisk consults the directory periodically. This for sure happens with /var/spool/asterisk/outgoing/ (to see if there are new callfiles).</p><p>Have you considered using a USB flashdisk in place of the HDD? A while ago I thought about buying a WL-HDD and attach an USB hub to get both comfortable disk space and Bluetooth I/O, but I was unsure if it would have worked.<br /></p><div class="quotebox"><cite>antony wrote:</cite><blockquote><p>[...]<br />My first dissapointment is that the system can not handle the loading of res_indications.so. I need that module, because when I transfer a line the caller can not hear the extension ringing. There is silence until the new callee picks up the phone. <strong>Is there any other way to implement this?</strong> If I load the module, the caller can hear the line ring, but the sound quality is awful - unacceptable.</p></blockquote></div><p>Low and stuttering, right? Perhaps, again an issue of weakness in DSP code. <br /></p><div class="quotebox"><cite>antony wrote:</cite><blockquote><p>What&#039;s more important is that after some hours of usage, I have no outgoing sound on incoming calls. When somebody calls, asterisk rings the phones ok, I can pickup the line and listen, but they can not hear me... Restarting asterisk does not seem to help, so I believe that maybe this has to do with the USB ISDN driver. Restarting the system solves the problem. <strong>Could this be related to asterisk?</strong></p></blockquote></div><p>I&#039;ve never noticed this in my non-ISDN setup (only SIP + IAX). Could it perhaps due to some NAT issues? </p><p>Enzo</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p23596">
				<div class="post-metadata">
					<div class="post-num">Post #69</div>
					<div class="post-author">antony</div>
					<div class="post-datetime">
						25 Mar 2006, 13:03					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>enzo wrote:</cite><blockquote><p>I suspect that this has the same cause as the inability to use &quot;dtmfmode=inband&quot; in sip.conf, and that both depend of insufficient CPU horsepower to run the DSP code in dsp.c . When I enable &quot;dtmfmode=inband&quot; in sip.conf, the speech becomes sl-o-ow a-and stu-u-tte-ri-ing....</p></blockquote></div><p>That&#039;s exactly the case with chan_modem too. You couldn&#039;t have described it better... Poor CPU horsepower leads to stuttering sound.</p><div class="quotebox"><cite>enzo wrote:</cite><blockquote><p>Perhaps Asterisk consults the directory periodically. This for sure happens with /var/spool/asterisk/outgoing/ (to see if there are new callfiles).</p></blockquote></div><p>The wierd thing is that the problem persists even when *only* /var/spool/asterisk/voicemail is on the disk (/var/spool/asterisk is in /tmp - RAM) and with the voicemail modules not loaded! I guess I should do an strace on that and try to find out what really happens.</p><div class="quotebox"><cite>enzo wrote:</cite><blockquote><p>Have you considered using a USB flashdisk in place of the HDD? A while ago I thought about buying a WL-HDD and attach an USB hub to get both comfortable disk space and Bluetooth I/O, but I was unsure if it would have worked.</p></blockquote></div><p>My initial setup was an ASUS WL-500g with a USB hub, a USB flash stick and the USB ISDN modem. I bought the WL-HDD so I could have it all in one nice little package (I also had an old 2.5&quot; disk laying around).</p><div class="quotebox"><cite>enzo wrote:</cite><blockquote><p>I&#039;ve never noticed this in my non-ISDN setup (only SIP + IAX). Could it perhaps due to some NAT issues?</p></blockquote></div><p>I don&#039;t use NAT anywhere. I just have two phone lines coming in from chan_modem and 4 SIP lines on 2 ATA&#039;s. I&#039;m using ISDN to receive and place calls directly - not as a means to connect to the Internet and route calls to another provider. Imagine this as a stand-alone asterisk setup.</p><p>I guess the bottom-line here is that the devices currently supported by OpenWRT just haven&#039;t enough horsepower to support the needs of a complete asterisk server. There is a need for more CPU cycles per second, in order to run dtmf detection code and be able to load the indications module, and better expansion options (like a PCI slot <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" />), in order to connect a proper modem. Another important thing is also Linux 2.6 support, as ISDN software has radically changed for new kernel versions and the latest asterisk revisions do not even support older ISDN code. I just hope new devices will come (there are already some 300MHz versions out there) and OpenWRT developers will keep up the good work.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p23603">
				<div class="post-metadata">
					<div class="post-num">Post #70</div>
					<div class="post-author">enzo</div>
					<div class="post-datetime">
						25 Mar 2006, 16:31					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>antony wrote:</cite><blockquote><p>I guess the bottom-line here is that the devices currently supported by OpenWRT just haven&#039;t enough horsepower to support the needs of a complete asterisk server. There is a need for more CPU cycles per second, in order to run dtmf detection code and be able to load the indications module,</p></blockquote></div><p>From what I coould see with the various codecs (&quot;show translation&quot;), the CPU is not too bad, but the lack of hardware FPU and the consequent software emulation of floating-point operations absolutely kills the performances. Modems like GSM 06.10 perform quite well, but Speex, iLBC or even the relatively lightweight LPC-10 are totally unusable. So, perhaps the trick could be re-writing lpc.c to use only fixed point operations. Not a trivial undertaking... Often, codecs have freeware floating-point implementations and paid fixed-point ones: that&#039;s the case with iLBC, and also with my own little OpenLPC, of which Hawk Software at one point developed a commercial, interoperable fixed-point version.<br /></p><div class="quotebox"><cite>antony wrote:</cite><blockquote><p>and better expansion options (like a PCI slot <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" />), in order to connect a proper modem. Another important thing is also Linux 2.6 support, as ISDN software has radically changed for new kernel versions and the latest asterisk revisions do not even support older ISDN code. I just hope new devices will come (there are already some 300MHz versions out there) and OpenWRT developers will keep up the good work.</p></blockquote></div><p>Well, incremental steps in that direction could be represented by Gumstix boards (http://www.gumstix.com/products.html ), Soekris boards (http://www.soekris.com/products.htm ) and fan-less EPIA boards (http://www.google.com.hk/search?q=epia+fanless ), for all of which there are versions of Astlinux. Unfortunately, Astlinux&#039; support for ISDN at present is not very good, due to the fact that both its lead developer and most of its users are based outside Europe, where ISDN is not that popular.</p><p>Cheers --</p><p>Enzo</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p26899">
				<div class="post-metadata">
					<div class="post-num">Post #71</div>
					<div class="post-author">spblinux</div>
					<div class="post-datetime">
						10 May 2006, 19:48					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>enzo wrote:</cite><blockquote><p>Unfortunately, Astlinux&#039; support for ISDN at present is not very good, due to the fact that both its lead developer and most of its users are based outside Europe, where ISDN is not that popular.</p></blockquote></div><p>openwrt HEAD contains support for ar7 based devices (TI mipsel cpu) like AVM Fritz!Box.&nbsp; - Asterisk 1.2.1 can be run on Fritz!Box 7050 or 7170; both have 32 MB RAM and two builtin isdn adapters (one in nt mode and one in te mode). Openwrt is not yet ready for the fritzbox, but asterix can be run in a chrooted environment. What you get is isdn with working dtmf detection (in the closed source avm kernel module); isdn is linked to asterisk by chan_capi-cm.</p><p>The results are at <a href="http://www.spblinux.de/fbox/openwrt/">spblinux.de/fbox/openwrt</a>. (You have to add capi4kutils and chan_capi-cm to openwrt; and some patches have to be added to openwrt).</p><p>I am posting here because some readers of this list might be interested in embedded asterisk with isdn; (german readers can find more information at <a href="http://www.ip-phone-forum.de/showthread.php?t=101903">ip-phone-forum.de</a>.</p><p>spblinux</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p26927">
				<div class="post-metadata">
					<div class="post-num">Post #72</div>
					<div class="post-author">enzo</div>
					<div class="post-datetime">
						11 May 2006, 02:28					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>spblinux wrote:</cite><blockquote><p>[...]<br />openwrt HEAD contains support for ar7 based devices (TI mipsel cpu) like AVM Fritz!Box.&nbsp; - Asterisk 1.2.1 can be run on Fritz!Box 7050 or 7170; both have 32 MB RAM and two builtin isdn adapters (one in nt mode and one in te mode). Openwrt is not yet ready for the fritzbox, but asterix can be run in a chrooted environment. What you get is isdn with working dtmf detection (in the closed source avm kernel module); isdn is linked to asterisk by chan_capi-cm.</p><p>The results are at <a href="http://www.spblinux.de/fbox/openwrt/">spblinux.de/fbox/openwrt</a>. (You have to add capi4kutils and chan_capi-cm to openwrt; and some patches have to be added to openwrt).</p><p>I am posting here because some readers of this list might be interested in embedded asterisk with isdn; (german readers can find more information at <a href="http://www.ip-phone-forum.de/showthread.php?t=101903">ip-phone-forum.de</a>.</p><p>spblinux</p></blockquote></div><p>Thanks. For non-German readers, <a href="http://translate.google.com/translate?u=http%3A//www.ip-phone-forum.de/showthread.php%3Ft%3D101903">http://translate.google.com/translate?u … t%3D101903</a> provides an English translation (sort of :-) )</p><p>Enzo</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p36613">
				<div class="post-metadata">
					<div class="post-num">Post #73</div>
					<div class="post-author">rakiii</div>
					<div class="post-datetime">
						5 Nov 2006, 16:36					</div>
				</div>
				<div class="post-content content">
					<p>Will this startup-script work if I have asterisk installed on a sd-card mounted on /mnt/sd ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p36616">
				<div class="post-metadata">
					<div class="post-num">Post #74</div>
					<div class="post-author">enzo</div>
					<div class="post-datetime">
						5 Nov 2006, 17:20					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>rakiii wrote:</cite><blockquote><p>Will this startup-script work if I have asterisk installed on a sd-card mounted on /mnt/sd ?</p></blockquote></div><p>I&nbsp; suppose it will, as long as files on that partition can be read, written, executed etc. just like any other file...<br />Anyway, jut give it a try: it shouldn&#039;t take much work.</p><p>Enzo</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p36619">
				<div class="post-metadata">
					<div class="post-num">Post #75</div>
					<div class="post-author">rakiii</div>
					<div class="post-datetime">
						5 Nov 2006, 17:55					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>enzo wrote:</cite><blockquote><div class="quotebox"><cite>rakiii wrote:</cite><blockquote><p>Will this startup-script work if I have asterisk installed on a sd-card mounted on /mnt/sd ?</p></blockquote></div><p>I&nbsp; suppose it will, as long as files on that partition can be read, written, executed etc. just like any other file...<br />Anyway, jut give it a try: it shouldn&#039;t take much work.</p><p>Enzo</p></blockquote></div><p>Do I have do edit all directories in the script so they point to /mnt/sd..... ?</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 3 of 3</div><nav><ul><li><a href="viewtopic.php%3Fid=1419&amp;p=1.html">1</a></li><li><a href="viewtopic.php%3Fid=1419&amp;p=2.html">2</a></li><li class="pagination-current"><span>3</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>