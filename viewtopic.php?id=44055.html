<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> BCM6348 - DLink 2460B - B2 CFE or Full Flash</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 25 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p201072">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">gmtandi</div>
					<div class="post-datetime">
						7 May 2013, 20:30					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>I need a dump from the flash memory for this modem. I&#039;ll re-flash in a flash programmer outside the board. if anyone can send me the dump would be great <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p><p>thanks and best regards,</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p201090">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">danitool</div>
					<div class="post-datetime">
						8 May 2013, 00:41					</div>
				</div>
				<div class="post-content content">
					<p>You can get the CFE from the OEM sourcecode</p><p><a href="http://pudeev.livejournal.com/33449.html">http://pudeev.livejournal.com/33449.html</a></p><p>Not sure if you&#039;ll need to reverse the endianess before flashing.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p201114">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">gmtandi</div>
					<div class="post-datetime">
						8 May 2013, 05:19					</div>
				</div>
				<div class="post-content content">
					<p>Thanks <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p><p>maybe it&#039;s only the endian my problem, i tried to flash about 5 times, soldered the memory on the board, and removed, flashed again... <img src="https://forum.openwrt.org/img/smilies/hmm.png" width="15" height="15" alt="hmm" /></p><p>well, i&#039;ll try again tomorrow with reverse endian </p><p>-- any hint in how to reverse the endian? maybe dd?</p><p>thanks</p><p>-- edit-- </p><p>found a tool to convert to little endian in the link-&gt; <a href="http://wiki.openwrt.org/toh/davolink/dv-2020">http://wiki.openwrt.org/toh/davolink/dv-2020</a></p>											<p class="post-edited">(Last edited by <strong>gmtandi</strong> on 8 May 2013, 06:16)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p201150">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">danitool</div>
					<div class="post-datetime">
						8 May 2013, 12:35					</div>
				</div>
				<div class="post-content content">
					<p>Another one I used succesfully some time ago is <strong>redim.</strong></p><p><a href="http://files.myopera.com/danitool/livebox/redboot03_jtag.zip">http://files.myopera.com/danitool/liveb â€¦ 3_jtag.zip</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p201152">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">gmtandi</div>
					<div class="post-datetime">
						8 May 2013, 13:45					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m trying with the original firmware from d-link, i think it does have a full flash, it is: CFE, FS, and Kernel... just the begin of the flash that is making me go crazy, it&#039;s different,</p><p>the firmware i dumped from the memory before writing is:</p><p>0000000 1000 0279 0000 0000 0000 0000 0000 0000<br />0000020 0000 0000 0000 0000 0000 0000 0000 0000</p><br /><p>the one from dlink firmware:<br />0000000 0036 0000 7242 616f 6364 6d6f 4320 726f<br />0000020 6f70 6172 6974 006f 6576 2e72 3220 302e<br />(a lot of things here...)<br />0000400 0010 7902 0000 0000 0000 0000 0000 0000</p><p>maybe i must to cut that header and make it little endian?</p><p>-- i&#039;m trying to re-flash because there is no data from serial port, i think CFE is not working anymore, it occurred after flashing with wrong firmware(for BCM6338, the device is BCM6348), the&nbsp; modem had frozen in the upgrade process i think the power supply was damaged, a few capacitor inside, that i replaced --</p><p>thanks</p>											<p class="post-edited">(Last edited by <strong>gmtandi</strong> on 8 May 2013, 13:47)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p201154">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">danitool</div>
					<div class="post-datetime">
						8 May 2013, 14:00					</div>
				</div>
				<div class="post-content content">
					<p>Yes, you need to cut the header to get CFE from the OEM firmware, probably at offset 0x100. The size of CFE in these boards usually is 64KB. Then it&#039;s easy to extract.</p><p>About the endianess it depends on how you&#039;ll write the CFE on the flash. With hairydairy, it maybe needed some flag in the command for flashing, or byte reordering before flashing. With Urjtag there is no need to do byte reordering if you issue &quot;endian big&quot; in the Urjtag CLI. And with a flash programmer no idea about endianness.</p><p>Is your flash 4 or 8MB size?. if 8MB size the bootloader should be flashed in the offset at the middle of the flash.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p201165">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">gmtandi</div>
					<div class="post-datetime">
						8 May 2013, 15:18					</div>
				</div>
				<div class="post-content content">
					<p>the flash size is 4MB (29lv320cbtc-90g), it&#039;s being a little hard to calculate te right position for the CFE begin,&nbsp; i&#039;m reading the address on the flash programmer software, and with hexdump / od, the values are different(od/hexdump address are each 0x0, 0x10, 0x20, 0x30, and in the flash programmer software is 0x0, 0x08, 0x10, 0x18, 0x20; comparing the positions 0x10 = 0x08; 0x20 = 0x10)...&nbsp; &nbsp;i&#039;ll keep trying</p><p>OEM Firmware:</p><br /><p># od -A x -x GE_DSL-2640B_306041G00_cfe_fs_kernel&nbsp; | head -n 10<br />000000 0036 0000 7242 616f 6364 6d6f 4320 726f<br />000010 6f70 6172 6974 006f 6576 2e72 3220 302e<br />000020 0000 0000 0000 3336 3834 0000 2d44 5034<br />000030 572d 0000 0000 0000 0000 0000 0031 3133<br />000040 3339 3536 0031 0000 3233 3731 3330 3131</p><p>od -A x -x GE_DSL-2640B_306041G00_cfe_fs_kernel&nbsp; | grep &quot;0010 7902&quot;<br />000100 0010 7902 0000 0000 0000 0000 0000 0000</p><p>Dumped from the flash before writing:</p><p># od -A x -x modemdump2.BIN&nbsp; | head -n 10<br />000000 1000 0279 0000 0000 0000 0000 0000 0000<br />000010 0000 0000 0000 0000 0000 0000 0000 0000<br />*<br />000200 1000 0361 0000 0000 0000 0000 0000 0000<br />000210 0000 0000 0000 0000 0000 0000 0000 0000<br />*<br />000280 1000 034c 241a 0010 0000 0000 0000 0000<br />000290 0000 0000 0000 0000 0000 0000 0000 0000</p><br /><p># od -A x -x modemdump2.BIN&nbsp; | grep &quot;3600 0000&quot;<br />010000 3600 0000 4453 4c2d 3236 3430 4200 0000</p><br /><p>(remember: oem: big endian, dump: little endian)</p><p>so in the OEM the CFE is after the (kernel?) i must to re-order all, or just burn the CFE and flash via jtag? in the past i tried to flash via jtag with no success, the jtag could&#039;nt write to the bcm, maybe due to the CFE corrupted?</p><br /><p>// edit //</p><p>i&#039;ll flash just the CFE and then try to load the firmware by serial/jtag <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /> it&#039;ll be easier</p>											<p class="post-edited">(Last edited by <strong>gmtandi</strong> on 8 May 2013, 15:46)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p201179">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">danitool</div>
					<div class="post-datetime">
						8 May 2013, 16:30					</div>
				</div>
				<div class="post-content content">
					<p>A bad CFE may lock the CPU causing a non working JTAG. If this is the case you first need to erase the bootloader, which can ve very difficult using JTAG because you need to catch the CPU before swalowing the bytes causing the lock, maybe miliseconds after powering on the board..</p><p>If you flash a bad CFE with endianess mismatch, it won&#039;t cause this lock for sure, allowing you to use JTAG later for flashing a sane one.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p201185">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">gmtandi</div>
					<div class="post-datetime">
						8 May 2013, 16:48					</div>
				</div>
				<div class="post-content content">
					<p>great <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /> so i&#039;m in the right way... i removed the flash from the board, and i&#039;m programming directly to the memory... just the CFE(64KB from the OEM firmware, begining with &quot;0279 1000&quot;</p><p>that is?</p><p>thanks</p>											<p class="post-edited">(Last edited by <strong>gmtandi</strong> on 8 May 2013, 16:48)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p201187">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">danitool</div>
					<div class="post-datetime">
						8 May 2013, 17:02					</div>
				</div>
				<div class="post-content content">
					<p>Well most bcm6348 CFEs, extracted from OEM firmwares, without any change:<br /></p><div class="codebox"><pre><code>10 00 02 79</code></pre></div><p>And If I do the byte reordering with redim tool (this is for straight flashing with HairyDairyMaid without any endian flag)<br /></p><div class="codebox"><pre><code>00 10 79 02</code></pre></div><p>With a flash programmer, as I said before, no idea about if any byte reordering is needed.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p201190">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">gmtandi</div>
					<div class="post-datetime">
						8 May 2013, 17:10					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>well, i think i got a good result, before, without a flash memory on the board or with an corrupted data in the memory, the ethernet leds only blinks and the red light stays;</p><p>now with the CFE(64 Kbytes), all the ethernet leds stays on,&nbsp; but no data is received on the rs232 port...</p><br /><p>//// found that the &quot;switchend&quot; was switching 4 bytes, i think that this bcm is only 2 bytes, the dump from the memory was 1000 0279, switchend was doing 0279 1000, so i modified the source of switchend, now programming again and let&#039;s test ;D</p><p>now i got the cfe from the gpl firmware</p><p>/// edit</p><p>It&#039;s being impossible to get it running, the flash is fully erased&nbsp; with only the CFE begining at the start of the memory... it&#039;s not running :\ maybe i need a full dump of the flash, now i&#039;ll close the modem and try to find someone who have one like this one damaged to dump the flash and try again :\</p><p>thanks</p>											<p class="post-edited">(Last edited by <strong>gmtandi</strong> on 8 May 2013, 20:02)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>