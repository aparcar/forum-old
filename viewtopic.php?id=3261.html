<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Static NAT ?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 28 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p15348">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">bx</div>
					<div class="post-datetime">
						14 Nov 2005, 03:33					</div>
				</div>
				<div class="post-content content">
					<p>i was wondering.. is there any way through IPTABLES to build &quot;Static NAT&quot; that will look like this:</p><p><span class="postimg"><img src="http://www.firewall.cx/pictures/nat-static-part1-1.gif" alt="http://www.firewall.cx/pictures/nat-static-part1-1.gif" /></span></p><p>and i want to make my network use this &quot;Static NAT&quot; option</p><p><span class="postimg"><img src="http://www.firewall.cx/pictures/nat-static-part1-2.gif" alt="http://www.firewall.cx/pictures/nat-static-part1-2.gif" /></span></p><p>So i&#039;ve been reading lots of HOW-TO&#039;s but nowhere have &quot;commands&quot; how-to-make it work?<br />What do i have to set in my router so this Static NAT works?<br />Do i have to set my router in &quot;STATIC IP&quot; mode, or DHCP, or something..</p><p>I have one &quot;ethernet lan cable&quot; from my wireless that i plug it in my &quot;Internet&quot; PIN at &quot;WRT54G&quot; installed OpenWRT WHITE RUSSIAN (pre-RC4), and i got 1 other lan cable that i plug it into my switch and when i set it into &quot;Static IP&quot; it works only with one ip address, but i got from my isp 16 ip addresses, that i want to use in computers.</p><p>I hope someone will understand what i want, and will explain at least &quot;what r the steps to fix it&quot;</p><p>thanks in advance.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p15387">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">KampfCaspar</div>
					<div class="post-datetime">
						14 Nov 2005, 19:35					</div>
				</div>
				<div class="post-content content">
					<p><a href="http://iptables-tutorial.frozentux.net/iptables-tutorial.html#SNATTARGET">http://iptables-tutorial.frozentux.net/ … SNATTARGET</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p15419">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">bx</div>
					<div class="post-datetime">
						15 Nov 2005, 05:39					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>KampfCaspar wrote:</cite><blockquote><p><a href="http://iptables-tutorial.frozentux.net/iptables-tutorial.html#SNATTARGET">http://iptables-tutorial.frozentux.net/ … SNATTARGET</a></p></blockquote></div><p>yea i have readed that, but i dont understand it?!<br />no one knows how to &quot;explain&quot; a command??????</p><p>like: iptables -d or -f or something?????</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p15421">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">Nico</div>
					<div class="post-datetime">
						15 Nov 2005, 06:13					</div>
				</div>
				<div class="post-content content">
					<p>All the commands you need to NAT are &quot;explained&quot; in the link posted.<br />What did you expect, that someone would explain the tutorial ? and provide real working commands without you clearly explaining your setup ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p15423">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">dl</div>
					<div class="post-datetime">
						15 Nov 2005, 07:26					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>bx wrote:</cite><blockquote><p>What do i have to set in my router so this Static NAT works?</p></blockquote></div><p>See <a href="http://wiki.openwrt.org/OpenWrtDocs/dnsmasq">the section on static NAT (1.1.3) in the Wiki.</a> Note that you still may need to open some firewall rules in which case see the iptables reference already mentioned.</p><p>- DL</p>											<p class="post-edited">(Last edited by <strong>dl</strong> on 15 Nov 2005, 07:27)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p15434">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">KampfCaspar</div>
					<div class="post-datetime">
						15 Nov 2005, 12:36					</div>
				</div>
				<div class="post-content content">
					<p>Sorry dl, but you seem to be mixing static ADDRESSES with static NAT...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p15437">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">dl</div>
					<div class="post-datetime">
						15 Nov 2005, 12:52					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>KampfCaspar wrote:</cite><blockquote><p>Sorry dl, but you seem to be mixing static ADDRESSES with static NAT...</p></blockquote></div><p>Oh, you&#039;re right. But in that case wouldn&#039;t the simplest solution be to assign one of the 16 assigned addresses to the lan (with appropriate subnet mask) and then you wouldn&#039;t have to mess with iptables at all, at least for basic purposes. And in any case doesn&#039;t pre-assigning a public address via DHCP work? I don&#039;t know - I haven&#039;t tried it.</p><p>- DL</p>											<p class="post-edited">(Last edited by <strong>dl</strong> on 15 Nov 2005, 12:56)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p15447">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">Nico</div>
					<div class="post-datetime">
						15 Nov 2005, 15:59					</div>
				</div>
				<div class="post-content content">
					<p>This is why I would like to have a detailled setup of what this guy wants...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p15454">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">bx</div>
					<div class="post-datetime">
						15 Nov 2005, 19:26					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Nico wrote:</cite><blockquote><p>This is why I would like to have a detailled setup of what this guy wants...</p></blockquote></div><p>I have posted it with &quot;pictures&quot;</p><p>DNSMAQ is not the preffered solution for this, i been told that it&#039;s &quot;the best&quot; to do it with iptables which it would look like this:</p><p>iptables -A PREROUTING -nat -j DNAT -d 212.114.14.78 --to-destination 192.168.1.5<br />iptables -A POSTROUTING -t nat -j SNAT -s 192.168.1.5 --to 212.110.14.78</p><p>that works on FreeBSD, but i&#039;ve tested with the same commands in wrt54g, the iptables r all ok i mean when i type them but after sometime when i do iptables -L (LIST) they r not listed i was wondering why?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p15455">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">e_</div>
					<div class="post-datetime">
						15 Nov 2005, 19:28					</div>
				</div>
				<div class="post-content content">
					<p>use iptables -L -n -v</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p15456">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">bx</div>
					<div class="post-datetime">
						15 Nov 2005, 19:34					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>e_ wrote:</cite><blockquote><p>use iptables -L -n -v</p></blockquote></div><div class="codebox"><pre><code>root@openwrt:~# iptables -L -n -v
Chain INPUT (policy DROP 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination 
    0     0 DROP       all  --  *      *       0.0.0.0/0            0.0.0.0/0           state INVALID
  886 77467 ACCEPT     all  --  *      *       0.0.0.0/0            0.0.0.0/0           state RELATED,ESTABLISHED
    0     0 DROP       tcp  --  *      *       0.0.0.0/0            0.0.0.0/0           tcp option=!2 flags:0x02/0x02
 1556  240K input_rule  all  --  *      *       0.0.0.0/0            0.0.0.0/0  
  213 19360 ACCEPT     all  --  !vlan1 *       0.0.0.0/0            0.0.0.0/0   
    0     0 ACCEPT     icmp --  *      *       0.0.0.0/0            0.0.0.0/0   
    0     0 ACCEPT     47   --  *      *       0.0.0.0/0            0.0.0.0/0   
   74  3484 REJECT     tcp  --  *      *       0.0.0.0/0            0.0.0.0/0           reject-with tcp-reset
 1269  217K REJECT     all  --  *      *       0.0.0.0/0            0.0.0.0/0           reject-with icmp-port-unreachable

Chain FORWARD (policy DROP 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination 
    0     0 DROP       all  --  *      *       0.0.0.0/0            0.0.0.0/0           state INVALID
 2799  133K TCPMSS     tcp  --  *      *       0.0.0.0/0            0.0.0.0/0           tcp flags:0x06/0x02 TCPMSS clamp to PMTU
14906 5619K ACCEPT     all  --  *      *       0.0.0.0/0            0.0.0.0/0           state RELATED,ESTABLISHED
 1420 68144 forwarding_rule  all  --  *      *       0.0.0.0/0            0.0.0.0/0
    0     0 ACCEPT     all  --  br0    br0     0.0.0.0/0            0.0.0.0/0   
 1420 68144 ACCEPT     all  --  br0    vlan1   0.0.0.0/0            0.0.0.0/0   

Chain OUTPUT (policy DROP 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination 
    0     0 DROP       all  --  *      *       0.0.0.0/0            0.0.0.0/0           state INVALID
  907  106K ACCEPT     all  --  *      *       0.0.0.0/0            0.0.0.0/0           state RELATED,ESTABLISHED
   26  1593 output_rule  all  --  *      *       0.0.0.0/0            0.0.0.0/0 
   26  1593 ACCEPT     all  --  *      *       0.0.0.0/0            0.0.0.0/0   
    0     0 REJECT     tcp  --  *      *       0.0.0.0/0            0.0.0.0/0           reject-with tcp-reset
    0     0 REJECT     all  --  *      *       0.0.0.0/0            0.0.0.0/0           reject-with icmp-port-unreachable

Chain forwarding_rule (1 references)
 pkts bytes target     prot opt in     out     source               destination 

Chain input_rule (1 references)
 pkts bytes target     prot opt in     out     source               destination 

Chain output_rule (1 references)
 pkts bytes target     prot opt in     out     source               destination 
root@openwrt:~#</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p15458">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">Void Main</div>
					<div class="post-datetime">
						15 Nov 2005, 20:17					</div>
				</div>
				<div class="post-content content">
					<p># iptables -L -t nat</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p15459">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">nicheware</div>
					<div class="post-datetime">
						15 Nov 2005, 21:01					</div>
				</div>
				<div class="post-content content">
					<p>Doesn&#039;t this require arp proxying?&nbsp; Ipchains was able to do what he wants with eth0, eth0:0, eth0:1, ... eth0:n, but iptables no - no?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p15503">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">bx</div>
					<div class="post-datetime">
						16 Nov 2005, 02:07					</div>
				</div>
				<div class="post-content content">
					<p>im working on it 1 fucking month cant figure it out <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p15506">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">bx</div>
					<div class="post-datetime">
						16 Nov 2005, 02:51					</div>
				</div>
				<div class="post-content content">
					<p>ok guys, i think i found this &quot;way&quot; i could call and i&#039;d preffer to the OpenWrt coders to include some &quot;iptables&quot; stuff that can be controled via httpd/web</p><div class="codebox"><pre><code>${IPTABLES} -t nat -A PREROUTING -d ${host} -j DNAT --to-destination ${destip}
${IPTABLES} -t nat -A POSTROUTING -s ${destip} -j SNAT --to-source ${host}</code></pre></div><p>Like this would look a classical static nat one example:<br /></p><div class="codebox"><pre><code>iptables -t nat -A PREROUTING -d 192.168.1.5 -j DNAT --to-destination 212.114.65.19
iptables -t nat -A POSTROUTING -s 212.114.65.19 -j SNAT --to-source 192.168.1.5</code></pre></div><p>this would look like:</p><div class="codebox"><pre><code>root@openwrt:~# iptables -t nat -A PREROUTING -d 192.168.1.5 -j DNAT --to-destination 212.130.74.189
root@openwrt:~# iptables -t nat -A POSTROUTING -s 212.130.74.189 -j SNAT --to-source 192.168.1.5
root@openwrt:~# nvram commit
root@openwrt:~# iptables -L -t nat
Chain PREROUTING (policy ACCEPT)
target     prot opt source               destination
prerouting_rule  all  --  anywhere             anywhere
DNAT       all  --  anywhere             192.168.1.5         to:212.130.74.189

Chain POSTROUTING (policy ACCEPT)
target     prot opt source               destination
postrouting_rule  all  --  anywhere             anywhere
MASQUERADE  all  --  anywhere             anywhere
SNAT       all  --  212.130.74.189       anywhere            to:192.168.1.5

Chain OUTPUT (policy ACCEPT)
target     prot opt source               destination

Chain postrouting_rule (1 references)
target     prot opt source               destination

Chain prerouting_rule (1 references)
target     prot opt source               destination
root@openwrt:~#</code></pre></div><p>im sure 100% that this thing will work, now my point is how do i have to setup my router in what mode coz i got options &quot;Static IP&quot; &quot;DHCP&quot; &quot;PPPOE&quot; and &quot;NONE&quot; so this will work?</p><p>I have 1 LAN Cable from my wireless Antenna, and i plug it into my &quot;Internet&quot; port on my WRT54G, so from that i get internet and 1 cable from my other 4 ports into switch anyone have an idea &quot;how-would-this-work&quot; ?</p>											<p class="post-edited">(Last edited by <strong>bx</strong> on 16 Nov 2005, 02:56)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p15515">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">Void Main</div>
					<div class="post-datetime">
						16 Nov 2005, 03:59					</div>
				</div>
				<div class="post-content content">
					<p>One thing for sure is you&#039;ll need to add the other external IP addresses to your $WAN interface. You then SNAT/DNAT via those addresses. Say you already have your $WAN configured with &quot;212.114.14.1&quot; and you have .2, .3 and .4 you want to 1-1 nat. Also assume these are 24 bit subnet mask (for ease of example). You need to set up the alias addresses something like this:</p><p># ip addr add 212.114.14.2/24 brd 212.114.14.255 dev vlan1<br /># ip addr add 212.114.14.3/24 brd 212.114.14.255 dev vlan1<br /># ip addr add 212.114.14.4/24 brd 212.114.14.255 dev vlan1</p><p>This assumes vlan1 is your $WAN interface (or just use $WAN). Now you should be able to set up your DNAT/SNAT rules to each of those IP addresses to map to the internal address. I don&#039;t believe I saw you set up the aliases, if you did ignore this. Oh, you&#039;ll need the &quot;ip&quot; ipkg installed.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p15526">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">bx</div>
					<div class="post-datetime">
						16 Nov 2005, 05:24					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Void Main wrote:</cite><blockquote><p>One thing for sure is you&#039;ll need to add the other external IP addresses to your $WAN interface. You then SNAT/DNAT via those addresses. Say you already have your $WAN configured with &quot;212.114.14.1&quot; and you have .2, .3 and .4 you want to 1-1 nat. Also assume these are 24 bit subnet mask (for ease of example). You need to set up the alias addresses something like this:</p><p># ip addr add 212.114.14.2/24 brd 212.114.14.255 dev vlan1<br /># ip addr add 212.114.14.3/24 brd 212.114.14.255 dev vlan1<br /># ip addr add 212.114.14.4/24 brd 212.114.14.255 dev vlan1</p><p>This assumes vlan1 is your $WAN interface (or just use $WAN). Now you should be able to set up your DNAT/SNAT rules to each of those IP addresses to map to the internal address. I don&#039;t believe I saw you set up the aliases, if you did ignore this. Oh, you&#039;ll need the &quot;ip&quot; ipkg installed.</p></blockquote></div><p>still, im asking for &quot;router mode&quot; DHCP/STATIC IP/PPPOE/NONE?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p15527">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">Void Main</div>
					<div class="post-datetime">
						16 Nov 2005, 05:36					</div>
				</div>
				<div class="post-content content">
					<p>Is &quot;router mode&quot; a new term you just made up? Are you asking what your &quot;wan_proto&quot; variable should be set to? I assume you have subnet of IP addresses from your provider or you wouldn&#039;t even be here asking these questions. You would set your &quot;wan_proto&quot; variable to &quot;static&quot; and configure your &quot;wan_ipaddr&quot;, &quot;wan_gateway&quot;, &quot;wan_netmask&quot; with one of your addresses and other ip information for your subnet provided to you by your provider. Of course you would control this range of addresses so it is up to you whether you would want to use DHCP. Wouldn&#039;t make much sense for what you are doing though. You would then have to add all of the other addresses that you want to use in your 1-1 nat in a script. That&#039;s the commands I listed in the previous message. Or you could configure it manually every time you reboot but I&#039;m sure that would get old.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p15585">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">bx</div>
					<div class="post-datetime">
						16 Nov 2005, 21:17					</div>
				</div>
				<div class="post-content content">
					<p>yes, im asking about wan_proto <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p17771">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">bx</div>
					<div class="post-datetime">
						24 Dec 2005, 16:10					</div>
				</div>
				<div class="post-content content">
					<p>umm.. so?!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p18233">
				<div class="post-metadata">
					<div class="post-num">Post #21</div>
					<div class="post-author">florian_</div>
					<div class="post-datetime">
						3 Jan 2006, 17:11					</div>
				</div>
				<div class="post-content content">
					<p>wan_proto=static maybe ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p18301">
				<div class="post-metadata">
					<div class="post-num">Post #22</div>
					<div class="post-author">bx</div>
					<div class="post-datetime">
						4 Jan 2006, 19:19					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>RItalMan wrote:</cite><blockquote><p>wan_proto=static maybe ?</p></blockquote></div><p>heh thanks dude, but wan_proto=static seems to dont work as i noticed wrt does not support this feature</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>