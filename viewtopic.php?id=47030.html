<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> What&#039;s the reason?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 28 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p215957">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">taxidriver</div>
					<div class="post-datetime">
						29 Oct 2013, 00:42					</div>
				</div>
				<div class="post-content content">
					<p>I just collected my first experiences in terms of building my own images, but whenever I try to boot the system I end up like this:</p><div class="codebox"><pre><code>## Booting image at 9f300000 ...
   Image Name:   MIPS OpenWrt Linux-3.10.17
   Created:      2013-10-28  21:16:06 UTC
   Image Type:   MIPS Linux Kernel Image (lzma compressed)
   Data Size:    1019431 Bytes = 995.5 kB
   Load Address: 80060000
   Entry Point:  80060000
   Verifying Checksum at 0x9f300040 ...OK
   Uncompressing Kernel Image ... OK
No initrd
## Transferring control to Linux (at address 80060000) ...
## Giving linux memsize in bytes, 33554432

Starting kernel ...

[    0.000000] Linux version 3.10.17 (terminator@laptop.mydomain) (gcc version 4.6.4 (OpenWrt/Linaro GCC 4.6-2013.05 r38428) ) #2 Mon Oct 28 22:15:31 CET 2013
[    0.000000] bootconsole [early0] enabled
[    0.000000] CPU revision is: 0001974c (MIPS 74Kc)
[    0.000000] SoC: Atheros AR9341 rev 1
[    0.000000] Clocks: CPU:535.000MHz, DDR:400.000MHz, AHB:200.000MHz, Ref:25.000MHz
[    0.000000] Determined physical RAM map:
[    0.000000]  memory: 02000000 @ 00000000 (usable)
[    0.000000] User-defined physical RAM map:
[    0.000000]  memory: 02000000 @ 00000000 (usable)
[    0.000000] Initrd not found or empty - disabling initrd
[    0.000000] Zone ranges:
[    0.000000]   Normal   [mem 0x00000000-0x01ffffff]
[    0.000000] Movable zone start for each node
[    0.000000] Early memory node ranges
[    0.000000]   node   0: [mem 0x00000000-0x01ffffff]
[    0.000000] Primary instruction cache 64kB, VIPT, 4-way, linesize 32 bytes.
[    0.000000] Primary data cache 32kB, 4-way, VIPT, cache aliases, linesize 32 bytes
[    0.000000] Built 1 zonelists in Zone order, mobility grouping on.  Total pages: 8128
[    0.000000] Kernel command line:  console=ttyS0,115200 root=31:02 rootfstype=jffs2 init=/sbin/init mtdparts=ath-nor0:32k(u-boot1),32k(u-boot2),3008k(rootfs),896k(uImage),64k(mib0),64k(ART) mem=32M rootfstype=squashfs,jffs2 noinitrd
[    0.000000] PID hash table entries: 128 (order: -3, 512 bytes)
[    0.000000] Dentry cache hash table entries: 4096 (order: 2, 16384 bytes)
[    0.000000] Inode-cache hash table entries: 2048 (order: 1, 8192 bytes)
[    0.000000] Writing ErrCtl register=00000000
[    0.000000] Readback ErrCtl register=00000000
[    0.000000] Memory: 28848k/32768k available (2198k kernel code, 3920k reserved, 594k data, 212k init, 0k highmem)
[    0.000000] SLUB: HWalign=32, Order=0-3, MinObjects=0, CPUs=1, Nodes=1
[    0.000000] NR_IRQS:51
[    0.000000] Calibrating delay loop... 266.64 BogoMIPS (lpj=1333248)
[    0.080000] pid_max: default: 32768 minimum: 301
[    0.080000] Mount-cache hash table entries: 512
[    0.090000] NET: Registered protocol family 16
[    0.090000] MIPS: machine is Generic AR71XX/AR724X/AR913X based board
[    0.100000] bio: create slab &lt;bio-0&gt; at 0
[    0.110000] Switching to clocksource MIPS
[    0.120000] NET: Registered protocol family 2
[    0.120000] TCP established hash table entries: 512 (order: 0, 4096 bytes)
[    0.120000] TCP bind hash table entries: 512 (order: -1, 2048 bytes)
[    0.130000] TCP: Hash tables configured (established 512 bind 512)
[    0.130000] TCP: reno registered
[    0.130000] UDP hash table entries: 256 (order: 0, 4096 bytes)
[    0.140000] UDP-Lite hash table entries: 256 (order: 0, 4096 bytes)
[    0.150000] NET: Registered protocol family 1
[    0.170000] squashfs: version 4.0 (2009/01/31) Phillip Lougher
[    0.170000] jffs2: version 2.2 (NAND) (SUMMARY) (LZMA) (RTIME) (CMODE_PRIORITY) (c) 2001-2006 Red Hat, Inc.
[    0.180000] msgmni has been set to 56
[    0.190000] io scheduler noop registered
[    0.190000] io scheduler deadline registered (default)
[    0.200000] Serial: 8250/16550 driver, 1 ports, IRQ sharing disabled
[    0.200000] serial8250.0: ttyS0 at MMIO 0rq = 11) is a 16550A
[    0.230000] console [ttyS0] enabled, bootconsole disabled
[    0.230000] console [ttyS0] enabled, bootconsole disabled
[    0.250000] TCP: cubic registered
[    0.250000] NET: Registered protocol family 17
[    0.260000] 8021q: 802.1Q VLAN Support v1.8
[    0.260000] VFS: Cannot open root device &quot;31:02&quot; or unknown-block(31,2): error -6
[    0.270000] Please append a correct &quot;root=&quot; boot option; here are the available partitions:
[    0.280000] Kernel panic - not syncing: VFS: Unable to mount root fs on unknown-block(31,2) </code></pre></div><p>What am I doing wrong? Anyone who can give me a hint, please?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216012">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">Samweis</div>
					<div class="post-datetime">
						29 Oct 2013, 11:39					</div>
				</div>
				<div class="post-content content">
					<p>Where I would expect it to initialize the flash and allocate the partitons on it, it continues with TCP and NET.<br />Missing driver for the flash?</p><p>It might help if you would let us know <br />- which router<br />- version of OpenWrt<br />- what image (when you say you built yourself, does that mean imagebuilder, or did you configure and&nbsp; compile it yourself? Which file did you use?)<br />- if self-compiled: your config (maybe posted at pastee.org)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216019">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">neryba</div>
					<div class="post-datetime">
						29 Oct 2013, 12:12					</div>
				</div>
				<div class="post-content content">
					<div class="codebox"><pre><code>[    0.000000] Kernel command line:  console=ttyS0,115200 root=31:02 rootfstype=jffs2 init=/sbin/init mtdparts=ath-nor0:32k(u-boot1),32k(u-boot2),3008k(rootfs),896k(uImage),64k(mib0),64k(ART) mem=32M rootfstype=squashfs,jffs2 noinitrd</code></pre></div><p> is missing board name</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216047">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">taxidriver</div>
					<div class="post-datetime">
						29 Oct 2013, 16:53					</div>
				</div>
				<div class="post-content content">
					<p>You seem to be right, Samweis...</p><p>looking at the relevant file I noticed that it only has a few entries for Macronix flash chips:<br /></p><div class="codebox"><pre><code>    /* Macronix */
    { &quot;mx25l2005a&quot;,  INFO(0xc22012, 0, 64 * 1024,   4, SECT_4K) },
    { &quot;mx25l4005a&quot;,  INFO(0xc22013, 0, 64 * 1024,   8, SECT_4K) },
    { &quot;mx25l8005&quot;,   INFO(0xc22014, 0, 64 * 1024,  16, 0) },
    { &quot;mx25l1606e&quot;,  INFO(0xc22015, 0, 64 * 1024,  32, SECT_4K) },
    { &quot;mx25l3205d&quot;,  INFO(0xc22016, 0, 64 * 1024,  64, 0) },
    { &quot;mx25l6405d&quot;,  INFO(0xc22017, 0, 64 * 1024, 128, 0) },
    { &quot;mx25l12805d&quot;, INFO(0xc22018, 0, 64 * 1024, 256, 0) },
    { &quot;mx25l12855e&quot;, INFO(0xc22618, 0, 64 * 1024, 256, 0) },
    { &quot;mx25l25635e&quot;, INFO(0xc22019, 0, 64 * 1024, 512, 0) },
    { &quot;mx25l25655e&quot;, INFO(0xc22619, 0, 64 * 1024, 512, 0) },
    { &quot;mx66l51235l&quot;, INFO(0xc2201a, 0, 64 * 1024, 1024, 0) },</code></pre></div><p>The Flash chip from my board is not on that list. On the other hand I discovered this link here<br /><a href="https://lkml.org/lkml/2012/10/10/801">https://lkml.org/lkml/2012/10/10/801</a><br />which has a more complete list that also has the chip on my board.</p><p>Well, looks like I need a patch here, but I don&#039;t know how to procede from here.<br />Can you or any of the others give me a hint maybe?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216048">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">Samweis</div>
					<div class="post-datetime">
						29 Oct 2013, 17:19					</div>
				</div>
				<div class="post-content content">
					<p>If this is all that&#039;s missing it would be easy enough.<br />Check <a href="http://wiki.openwrt.org/doc/devel/patches"> Wiki: working with patches</a>.<br /></p><div class="codebox"><pre><code>make target/linux/{clean,prepare} V=s QUILT=1</code></pre></div><p>Then apply the patch to drivers/mtd/devices/m25p80.c in the Linux kernel tree.<br />If it dooes not apply cleanly (e.g. because the line numbers don&#039;t match), copy&amp;paste it manually.<br />Use quilt as described in the wiki, so that you have control of the patch.</p><p>If it works, submit it to OpenWrt.</p><p>(Still it would not hurt to tell us which board.... <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /> )</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216176">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">taxidriver</div>
					<div class="post-datetime">
						30 Oct 2013, 12:47					</div>
				</div>
				<div class="post-content content">
					<p>As to your recent remark:</p><div class="quotebox"><blockquote><p>If this is all that&#039;s missing it would be easy enough.</p></blockquote></div><p>Not as easy as I thought it might be...<br />Tried to apply the patch as you said, but it didn&#039;t work, so I chose to do the &#039;cut-and-paste business&#039; :-)</p><p>After applying all the changes mentioned within the patch file I end up in a new driver.c file and then I don&#039;t know how to go on. How do I get these arrangements into the kernel image that I want to upload to flash? If I recompiled I&#039;d be getting the old driver.c file back and all the work would be useless. Shouldn&#039;t I be making changes to some driver source file and then recompile? But where would that driver source file be?</p><p>Thanks for any attempts to widen my horizon in terms of kernel matters.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216206">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">Samweis</div>
					<div class="post-datetime">
						30 Oct 2013, 15:55					</div>
				</div>
				<div class="post-content content">
					<div class="codebox"><pre><code>make target/linux/{clean,prepare} V=s QUILT=1</code></pre></div><p>then go to to trunk/build_dir/target-mips_34kc+dsp_uClibc-0.9.33.2/linux-*/linux-3.10.17<br />Add a new patch &quot;0210-flash-driver-for-my-board&quot; as described in the wiki.<br />Add drivers/mtd/devices/m25p80.c to your patch.<br />Edit m25p80.c and cut&amp;paste the changes into it.<br />Save.<br />Now you still have m25p80.c (not driver.c). And it is still in the same place as before. <br />Refresh quilt as described in the wiki. <br />Then use the following command to move the patch over to the buildroot, so that your patch is not overwritten when you recompile:<br /></p><div class="codebox"><pre><code>make target/linux/refresh V=s</code></pre></div><p> Or was it make target/linux/update V=s? Just try. You should see your patch appear in trunk/target/linux/[your_arch]/patches-3.x. <br />If it does, then build the image as you always do.<br />If it does not, you did something wrong <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p>											<p class="post-edited">(Last edited by <strong>Samweis</strong> on 30 Oct 2013, 15:57)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216342">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">taxidriver</div>
					<div class="post-datetime">
						31 Oct 2013, 16:10					</div>
				</div>
				<div class="post-content content">
					<p>Hello again,</p><div class="quotebox"><blockquote><p>If it does not, you did something wrong</p></blockquote></div><p>actually I must have done a number of things wrong already as many steps of the &quot;Working with patches-Wiki&quot; did not have the expected results. Many people who compose &#039;wikis&#039; similar to the latter seem to lack the ability to explain things like they were &#039;newbies&#039; as well. <br />Fact is: I seem to be getting most of the PATH names wrong, or: What must I do whilst being in which directory?<br />Funny enough it started with the command <strong>quilt</strong>, which I tried in a number of directories in vain before I noticed that I had to do an &#039;apt-get quilt&#039; before that.</p><p>Really got&nbsp; stuck when I discovered a huge list of patches in some directory when I was fondling with the number to start my patch name with. Without further info I&#039;ll be lost, I think. Can you try again being as precise as possible this time, maybe?&nbsp; &nbsp;</p><p>Like </p><div class="quotebox"><blockquote><p>make package/example/{clean,prepare} V=s QUILT=1</p></blockquote></div><p> versus </p><div class="quotebox"><blockquote><p>make target/linux/{clean,prepare} V=s QUILT=1</p></blockquote></div><p>or even </p><div class="quotebox"><blockquote><p>make package/example/host/{clean,prepare} V=s QUILT=1</p></blockquote></div><p>Never know when these are proper directory names and when they are sort of variables. So I must have given that command in directories where it either makes no sense or where it even might corrupt something, which I hate. Not that I intend to propagate that &#039;learning by doing it&#039; wasn&#039;t ok, but I definitely hate to quirk my computer to some extent.</p><p>Thanks in advance for more info on that topic.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216352">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">Samweis</div>
					<div class="post-datetime">
						31 Oct 2013, 17:23					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>taxidriver wrote:</cite><blockquote><p>Many people who compose &#039;wikis&#039; similar to the latter seem to lack the ability to explain things like they were &#039;newbies&#039; as well.</p></blockquote></div><p> Hey, had I written the wiki, I would feel offended now <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p><p>OK<br />- install quilt<br />- create a ~/.quiltrc with the contents shown in the wiki. &quot;~&quot; means your home directory. (Don&#039;t beat me now because you knew that and you have done it already - you asked for it <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /> )<br />- Go to the top level of your source tree. That&#039;s where you normally type &quot;make clean; make menuconfig; make V=s&quot;.<br />- type: </p><div class="codebox"><pre><code>make target/linux/{clean,prepare} V=s QUILT=1</code></pre></div><p> literally, exactly, no variables. Forget &quot;package&quot; - you are not working on a package but on the kernel.<br />- then: </p><div class="codebox"><pre><code>cd build_dir/target-*/linux-*/linux-3.*</code></pre></div><p> Since you are still keeping secrets from me and refuse to tell me the architecture of your board, I cannot be any more specific. <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /> But it should work for all archs. Look for the highest number in build_dir/target-*/linux-*/linux-3.*/patches/platform. Let&#039;s assume it is 210, so your patch will be 220.<br /></p><div class="codebox"><pre><code>quilt push -a
quilt new platform/220-flash-driver-for-my-board.patch
quilt edit drivers/mtd/devices/m25p80.c 
 </code></pre></div><p> Do it. (Edit I mean.)<br /></p><div class="codebox"><pre><code>quilt refresh</code></pre></div><p>Go back up to the top level of your source tree. That&#039;s where... (remember?) <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /><br /></p><div class="codebox"><pre><code>make target/linux/update package/index V=s</code></pre></div><p> Again, quite literally. <br />I may be wrong and it is <br /></p><div class="codebox"><pre><code>make target/linux/refresh V=s</code></pre></div><p> I mix them up all the time - but it does not matter. Try the first. Check whether your patch was updated to <br />trunk/target/linux/(YOUR_SECRET_ARCH)/patches-3.*/220-flash-driver-for-my-board.patch. <br />If it is not, try the other.<br />(YOUR_SECRET_ARCH) is a wildcard for your board&#039;s architecture that you did not want the public to know <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /><br />If it is there continue as usual: &quot;make clean; make menuconfig; make V=s&quot;</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216635">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">taxidriver</div>
					<div class="post-datetime">
						3 Nov 2013, 23:56					</div>
				</div>
				<div class="post-content content">
					<p>Many thanks for all that!</p><p>Yet, after having carried out all these steps the flash chip still rejects a desirable cooperative behavior...:-(</p><p>After comparing the original bootlogs with the logging data after installing openwrt I could see that I must have got something completely wrong somewhere. The original MAC address (and maybe further data bytes) have been overwritten by some inexplicable reason, and as I didn&#039;t know how to back up the original flash data before I started the process that data is lost now. Maybe it also included a jump address for some initialisation of the flash chip or whatever....</p><p>Due to the fact that I had no idea how to bring that means back into life I simply uttered a &#039;Darn!&#039; and tossed it into the bin...<br />That thing didn&#039;t deserve all that effort.</p><p>Will be going for another attempt with a different model next week, I think.</p><p>Thanks again and bye for now!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216639">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">Samweis</div>
					<div class="post-datetime">
						4 Nov 2013, 01:03					</div>
				</div>
				<div class="post-content content">
					<p>On my ARV752DPW and ARV752DPW22 the MAC address ist not read correctly by u-boot and OpenWrt either - but the interface still works. I configured the correct MAC in /etc/config/network.<br />What I want to say is this: the fact that the MAC address does not show up does not necessarily mean that essential data has been overwritten.<br />Has the bootlog changed in any way with the patched OpenWrt?</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>