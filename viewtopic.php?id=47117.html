<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> xl2tpd as server (lns) not work</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 29 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p216513">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">atioioio</div>
					<div class="post-datetime">
						2 Nov 2013, 12:08					</div>
				</div>
				<div class="post-content content">
					<p>12.09/ar71xx,&nbsp; xl2tpd can&#039;t work, what wrong with it ?</p><p>google a lot, with no luck;&nbsp; <br />use fedora19 xl2tpd as server is ok.&nbsp; <br />but openwrt not work</p><p>#config:</p><p>root@OpenWrt:/etc/xl2tpd# cat xl2tpd.conf <br />[global]<br />port = 1701<br />auth file = /etc/xl2tpd/xl2tp-secrets<br />access control = no<br />debug network = yes<br />debug avp = yes<br />debug packet = yes<br />debug state = yes</p><p>[lns default]<br />ip range = 192.168.254.202-192.168.254.210<br />local ip = 192.168.254.200<br />hidden bit = no<br />length bit = yes<br />ppp debug = yes<br />pppoptfile = /etc/ppp/options.xl2tpd</p><p>root@OpenWrt:/etc/xl2tpd# cat /etc/ppp/options.xl2tpd <br />lock<br />debug<br />dump<br />logfd 2<br />logfile /var/log/xl2tpd.log<br />noccp<br />novj<br />novjccomp<br />nopcomp<br />noaccomp<br />root@OpenWrt:/etc/xl2tpd# cat /etc/ppp/chap-secrets <br />#USERNAME&nbsp; PROVIDER&nbsp; PASSWORD&nbsp; IPADDRESS<br />test * test *<br />root@OpenWrt:/etc/xl2tpd# </p><br /><p>error ifo: </p><p>root@OpenWrt:/etc/xl2tpd# ls<br />xl2tp-secrets&nbsp; xl2tpd.conf<br />root@OpenWrt:/etc/xl2tpd# xl2tpd -D<br />xl2tpd[5118]: setsockopt recvref[30]: Protocol not available<br />xl2tpd[5118]: Using l2tp kernel support.<br />xl2tpd[5118]: xl2tpd version xl2tpd-1.3.1 started on OpenWrt PID:5118<br />xl2tpd[5118]: Written by Mark Spencer, Copyright (C) 1998, Adtran, Inc.<br />xl2tpd[5118]: Forked by Scott Balmos and David Stipp, (C) 2001<br />xl2tpd[5118]: Inherited by Jeff McAdams, (C) 2002<br />xl2tpd[5118]: Forked again by Xelerance (<a href="http://www.xelerance.com">www.xelerance.com</a>) (C) 2006<br />xl2tpd[5118]: Listening on IP address 0.0.0.0, port 1701<br />xl2tpd[5118]: network_thread: recv packet from 192.168.1.184, size = 108, tunnel = 0, call = 0 ref=0 refhim=0<br />packet dump: <br />HEX: { C8 02 00 6C 00 00 00 00 00 00 00 00 80 08 00 00 00 00 00 01 80 08 00 00 00 02 01 00 80 0A 00 00 00 03 00 00 00 01 80 0A 00 00 00 04 00 00 00 00 00 08 00 00 00 06 05 00 80 15 00 00 00 07 6C 65 6E 6F 76 6F 2D 39 63 38 62 32 64 63 32 00 0F 00 00 00 08 4D 69 63 72 6F 73 6F 66 74 80 08 00 00 00 09 00 1D 80 08 00 00 00 0A 00 08 }<br />ASCII: {&nbsp; &nbsp; l&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lenovo-9c8b2dc2&nbsp; &nbsp; &nbsp; Microsoft&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />xl2tpd[5118]: handle_avps: handling avp&#039;s for tunnel 5428, call 0<br />xl2tpd[5118]: message_type_avp: message type 1 (Start-Control-Connection-Request)<br />xl2tpd[5118]: protocol_version_avp: peer is using version 1, revision 0.<br />xl2tpd[5118]: framing_caps_avp: supported peer frames: sync<br />xl2tpd[5118]: bearer_caps_avp: supported peer bearers:<br />xl2tpd[5118]: firmware_rev_avp: peer reports firmware version 1280 (0x0500)<br />xl2tpd[5118]: hostname_avp: peer reports hostname &#039;lenovo-9c8b2dc2&#039;<br />xl2tpd[5118]: vendor_avp: peer reports vendor &#039;Microsoft&#039;<br />xl2tpd[5118]: assigned_tunnel_avp: using peer&#039;s tunnel 29<br />xl2tpd[5118]: receive_window_size_avp: peer wants RWS of 8.&nbsp; Will use flow control.<br />xl2tpd[5118]: control_finish: message type is Start-Control-Connection-Request(1).&nbsp; Tunnel is 29, call is 0.<br />packet dump: <br />HEX: { C8 02 00 68 00 1D 00 00 00 00 00 01 80 08 00 00 00 00 00 02 80 08 00 00 00 02 01 00 80 0A 00 00 00 03 00 00 00 03 80 0A 00 00 00 04 00 00 00 00 80 08 00 00 00 06 06 90 80 0D 00 00 00 07 4F 70 65 6E 57 72 74 80 13 00 00 00 08 78 65 6C 65 72 61 6E 63 65 2E 63 6F 6D 80 08 00 00 00 09 15 34 80 08 00 00 00 0A 00 04 }<br />ASCII: {&nbsp; &nbsp; h&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; OpenWrt&nbsp; &nbsp; &nbsp; xelerance.com&nbsp; &nbsp; &nbsp; &nbsp;4&nbsp; &nbsp; &nbsp; &nbsp; }<br />xl2tpd[5118]: control_finish: sending SCCRP<br />xl2tpd[5118]: network_thread: recv packet from 192.168.1.184, size = 108, tunnel = 0, call = 0 ref=0 refhim=0<br />packet dump: <br />HEX: { C8 02 00 6C 00 00 00 00 00 00 00 00 80 08 00 00 00 00 00 01 80 08 00 00 00 02 01 00 80 0A 00 00 00 03 00 00 00 01 80 0A 00 00 00 04 00 00 00 00 00 08 00 00 00 06 05 00 80 15 00 00 00 07 6C 65 6E 6F 76 6F 2D 39 63 38 62 32 64 63 32 00 0F 00 00 00 08 4D 69 63 72 6F 73 6F 66 74 80 08 00 00 00 09 00 1D 80 08 00 00 00 0A 00 08 }<br />ASCII: {&nbsp; &nbsp; l&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lenovo-9c8b2dc2&nbsp; &nbsp; &nbsp; Microsoft&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />xl2tpd[5118]: handle_avps: handling avp&#039;s for tunnel 8669, call 0<br />xl2tpd[5118]: message_type_avp: message type 1 (Start-Control-Connection-Request)<br />xl2tpd[5118]: protocol_version_avp: peer is using version 1, revision 0.<br />xl2tpd[5118]: framing_caps_avp: supported peer frames: sync<br />xl2tpd[5118]: bearer_caps_avp: supported peer bearers:<br />xl2tpd[5118]: firmware_rev_avp: peer reports firmware version 1280 (0x0500)<br />xl2tpd[5118]: hostname_avp: peer reports hostname &#039;lenovo-9c8b2dc2&#039;<br />xl2tpd[5118]: vendor_avp: peer reports vendor &#039;Microsoft&#039;<br />xl2tpd[5118]: assigned_tunnel_avp: using peer&#039;s tunnel 29<br />xl2tpd[5118]: receive_window_size_avp: peer wants RWS of 8.&nbsp; Will use flow control.<br />xl2tpd[5118]: control_finish: message type is Start-Control-Connection-Request(1).&nbsp; Tunnel is 29, call is 0.<br />xl2tpd[5118]: control_finish: Peer requested tunnel 29 twice, ignoring second one.<br />xl2tpd[5118]: network_thread: recv packet from 192.168.1.184, size = 20, tunnel = 5428, call = 0 ref=0 refhim=0<br />packet dump: <br />HEX: { C8 02 00 14 15 34 00 00 00 01 00 01 80 08 00 00 00 00 00 03 }<br />ASCII: {&nbsp; &nbsp; &nbsp; 4&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />xl2tpd[5118]: handle_avps: handling avp&#039;s for tunnel 5428, call 0<br />xl2tpd[5118]: message_type_avp: message type 3 (Start-Control-Connection-Connected)<br />xl2tpd[5118]: control_finish: message type is Start-Control-Connection-Connected(3).&nbsp; Tunnel is 29, call is 0.<br />xl2tpd[5118]: Connection established to 192.168.1.184, 1701.&nbsp; Local: 5428, Remote: 29 (ref=0/0).&nbsp; LNS session is &#039;default&#039;<br />xl2tpd[5118]: network_thread: recv packet from 192.168.1.184, size = 48, tunnel = 5428, call = 0 ref=0 refhim=0<br />packet dump: <br />HEX: { C8 02 00 30 15 34 00 00 00 02 00 01 80 08 00 00 00 00 00 0A 80 08 00 00 00 0E 00 01 80 0A 00 00 00 0F 00 00 00 00 80 0A 00 00 00 12 00 00 00 02 }<br />ASCII: {&nbsp; &nbsp; 0 4&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />xl2tpd[5118]: handle_avps: handling avp&#039;s for tunnel 5428, call 0<br />xl2tpd[5118]: message_type_avp: message type 10 (Incoming-Call-Request)<br />xl2tpd[5118]: message_type_avp: new incoming call<br />xl2tpd[5118]: assigned_call_avp: using peer&#039;s call 1<br />xl2tpd[5118]: call_serno_avp: serial number is 0<br />xl2tpd[5118]: bearer_type_avp: peer bears: analog<br />xl2tpd[5118]: control_finish: message type is Incoming-Call-Request(10).&nbsp; Tunnel is 29, call is 0.<br />packet dump: <br />HEX: { C8 02 00 1C 00 1D 00 01 00 01 00 03 80 08 00 00 00 00 00 0B 80 08 00 00 00 0E B0 92 }<br />ASCII: {&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br />xl2tpd[5118]: control_finish: Sending ICRP<br />xl2tpd[5118]: network_thread: recv packet from 192.168.1.184, size = 48, tunnel = 5428, call = 45202 ref=0 refhim=0<br />packet dump: <br />HEX: { C8 02 00 30 15 34 B0 92 00 03 00 02 80 08 00 00 00 00 00 0C 80 0A 00 00 00 18 03 37 F9 80 80 0A 00 00 00 13 00 00 00 01 00 08 00 00 00 1D 00 04 }<br />ASCII: {&nbsp; &nbsp; 0 4&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;7&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />xl2tpd[5118]: handle_avps: handling avp&#039;s for tunnel 5428, call 45202<br />xl2tpd[5118]: message_type_avp: message type 12 (Incoming-Call-Connected)<br />xl2tpd[5118]: tx_speed_avp: transmit baud rate is 54000000<br />xl2tpd[5118]: frame_type_avp: peer uses:sync frames<br />xl2tpd[5118]: ignore_avp : Ignoring AVP<br />xl2tpd[5118]: control_finish: message type is Incoming-Call-Connected(12).&nbsp; Tunnel is 29, call is 1.<br />xl2tpd[5118]: start_pppd: I&#039;m running: <br />xl2tpd[5118]: &quot;/usr/sbin/pppd&quot; <br />xl2tpd[5118]: &quot;passive&quot; <br />xl2tpd[5118]: &quot;nodetach&quot; <br />xl2tpd[5118]: &quot;192.168.254.200:192.168.254.202&quot; <br />xl2tpd[5118]: &quot;debug&quot; <br />xl2tpd[5118]: &quot;file&quot; <br />xl2tpd[5118]: &quot;/etc/ppp/options.xl2tpd&quot; <br />xl2tpd[5118]: &quot;ipparam&quot; <br />xl2tpd[5118]: &quot;192.168.1.184&quot; <br />xl2tpd[5118]: &quot;plugin&quot; <br />xl2tpd[5118]: &quot;pppol2tp.so&quot; <br />xl2tpd[5118]: &quot;pppol2tp&quot; <br />xl2tpd[5118]: &quot;7&quot; <br />xl2tpd[5118]: Call established with 192.168.1.184, Local: 45202, Remote: 1, Serial: 0<br />xl2tpd[5118]: network_thread: select returned error 4 (Interrupted system call)<br />xl2tpd[5118]: child_handler : pppd terminated for call 1 by signal 11<br />packet dump: <br />HEX: { C8 02 00 26 00 1D 00 01 00 02 00 04 80 08 00 00 00 00 00 0E 80 0A 00 00 00 01 00 01 00 00 80 08 00 00 00 0E B0 92 }<br />ASCII: {&nbsp; &nbsp; &amp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />xl2tpd[5118]: call_close: Call 45202 to 192.168.1.184 disconnected<br />xl2tpd[5118]: network_thread: recv packet from 192.168.1.184, size = 12, tunnel = 5428, call = 0 ref=0 refhim=0<br />packet dump: <br />HEX: { C8 02 00 0C 15 34 00 00 00 04 00 03 }<br />ASCII: {&nbsp; &nbsp; &nbsp; 4&nbsp; &nbsp; &nbsp; }<br />xl2tpd[5118]: network_thread: recv packet from 192.168.1.184, size = 38, tunnel = 5428, call = 0 ref=0 refhim=0<br />packet dump: <br />HEX: { C8 02 00 26 15 34 00 00 00 04 00 03 80 08 00 00 00 00 00 04 80 08 00 00 00 09 00 1D 80 0A 00 00 00 01 00 06 00 00 }<br />ASCII: {&nbsp; &nbsp; &amp; 4&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />xl2tpd[5118]: handle_avps: handling avp&#039;s for tunnel 5428, call 0<br />xl2tpd[5118]: message_type_avp: message type 4 (Stop-Control-Connection-Notification)<br />xl2tpd[5118]: assigned_tunnel_avp: using peer&#039;s tunnel 29<br />xl2tpd[5118]: result_code_avp: peer closing for reason 6 (Requester is being shut down), error = 0 ()<br />xl2tpd[5118]: control_finish: message type is Stop-Control-Connection-Notification(4).&nbsp; Tunnel is 29, call is 0.<br />xl2tpd[5118]: control_finish: Connection closed to 192.168.1.184, port 1701 (), Local: 5428, Remote: 29<br />xl2tpd[5118]: Terminating pppd: sending TERM signal to pid 5119<br />xl2tpd[5118]: network_thread: select returned error 9 (Bad file descriptor)</p><br /><p>^Cxl2tpd[5118]: network_thread: select returned error 4 (Interrupted system call)<br />xl2tpd[5118]: death_handler: Fatal signal 2 received<br />root@OpenWrt:/etc/xl2tpd#</p>											<p class="post-edited">(Last edited by <strong>atioioio</strong> on 2 Nov 2013, 12:43)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216550">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">bolvan</div>
					<div class="post-datetime">
						2 Nov 2013, 17:58					</div>
				</div>
				<div class="post-content content">
					<p>remove</p><div class="codebox"><pre><code>novj
novjccomp</code></pre></div><p>I had lots of pain because of those.</p><p>my sample working options.pppd (for client)</p><div class="codebox"><pre><code>usepeerdns
nodefaultroute
ipparam &quot;testvpn&quot;
ifname &quot;ppp0&quot;
lcp-max-terminate 10
lcp-echo-interval 3
lcp-echo-failure 8
noauth
noccp
nodeflate
nobsdcomp</code></pre></div><p>pppd options (server)</p><div class="codebox"><pre><code>mtu 1410
mru 1410
lcp-echo-interval 3
lcp-echo-failure 8
noproxyarp
lock
noauth
noccp
nodeflate
nobsdcomp
ms-dns 192.168.2.1
ms-dns 192.168.2.2</code></pre></div>											<p class="post-edited">(Last edited by <strong>bolvan</strong> on 2 Nov 2013, 18:13)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216588">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">atioioio</div>
					<div class="post-datetime">
						3 Nov 2013, 07:03					</div>
				</div>
				<div class="post-content content">
					<p>thank you very much.<br />i get it worked with your pppd options.<br />and i do a few more test, it&#039;s the &quot;<span style="color: #FF0000">dump</span>&quot; option in my config who cause the problem.</p><br /><p>it looks that the dump do the dryrun job:<br /><a href="http://ppp.samba.org/pppd.html">http://ppp.samba.org/pppd.html</a><br /><strong>dryrun</strong><br />&nbsp; &nbsp; With the dryrun option, pppd will print out all the option values which have been set and then exit, after parsing the command line and options files and checking the option values, but before initiating the link. The option values are logged at level info, and also printed to standard output unless the device on standard output is the device that pppd would be using to communicate with the peer. <br /><strong>dump</strong><br />&nbsp; &nbsp; With the dump option, pppd will print out all the option values which have been set. This option is like the dryrun option except that pppd proceeds as normal rather than exiting.</p>											<p class="post-edited">(Last edited by <strong>atioioio</strong> on 3 Nov 2013, 07:09)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>