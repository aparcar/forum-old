<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> FXS support</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 23 Apr 2018 and 4 May 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 4 of 4</div><nav><ul><li><a href="viewtopic.php%3Fid=62696&amp;p=1.html">1</a></li><li><a href="viewtopic.php%3Fid=62696&amp;p=2.html">2</a></li><li><a href="viewtopic.php%3Fid=62696&amp;p=3.html">3</a></li><li class="pagination-current"><span>4</span></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p367817">
				<div class="post-metadata">
					<div class="post-num">Post #76</div>
					<div class="post-author">Plonk34</div>
					<div class="post-datetime">
						3 Nov 2017, 21:43					</div>
				</div>
				<div class="post-content content">
					<p>you must add some bootargs like:<br /></p><div class="codebox"><pre><code>bootargs = &quot;console=ttyLTQ0,115200 mem=116M phym=128M vpe1_load_addr=0x87e00000 vpe1_mem=2M maxvpes=1 maxtcs=1 nosmp&quot;;</code></pre></div><p>one VPE of two will reserved for the VMMC firmware, and 2MB RAM<br />The result is no SMP are working</p><p>@JEFFreal @Aeronaut84<br />you can use my scripts, but read the description.txt first<br /><a href="https://yadi.sk/d/Zzhfu3vq3PPmH6">add-VMMC.tar.gz</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p367832">
				<div class="post-metadata">
					<div class="post-num">Post #77</div>
					<div class="post-author">Aeronaut84</div>
					<div class="post-datetime">
						4 Nov 2017, 08:55					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for that, I will have a look on it Monday. Is there a way to test function of the GPIO&#039;s?</p><p>OFFTOPIC: Do I understand right, that in TP Link FW WLAN firmware gets loaded by kernel module mtlk.ko?<br />Some of you are near Stuttgart?</p>											<p class="post-edited">(Last edited by <strong>Aeronaut84</strong> on 4 Nov 2017, 09:25)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p367919">
				<div class="post-metadata">
					<div class="post-num">Post #78</div>
					<div class="post-author">Aeronaut84</div>
					<div class="post-datetime">
						7 Nov 2017, 10:20					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Plonk34 wrote:</cite><blockquote><p>you must add some bootargs like:<br /></p><div class="codebox"><pre><code>bootargs = &quot;console=ttyLTQ0,115200 mem=116M phym=128M vpe1_load_addr=0x87e00000 vpe1_mem=2M maxvpes=1 maxtcs=1 nosmp&quot;;</code></pre></div><p>one VPE of two will reserved for the VMMC firmware, and 2MB RAM<br />The result is no SMP are working</p></blockquote></div><p>So its ok if just one of the two CPU cores come up, right?<br />$ cat /proc/cpuinfo<br /></p><div class="codebox"><pre><code>system type             : xRX200 rev 1.2
machine                 : VR200v - TP-LINK Archer VR200v
processor               : 0
cpu model               : MIPS 34Kc V5.6
BogoMIPS                : 332.54
wait instruction        : yes
microsecond timers      : yes
tlb_entries             : 16
extra interrupt vector  : yes
hardware watchpoint     : yes, count: 4, address/irw mask: [0x0ffc, 0x0ffc, 0x0ffb, 0x0ffb]
isa                     : mips1 mips2 mips32r1 mips32r2
ASEs implemented        : mips16 dsp mt
shadow register sets    : 1
kscratch registers      : 0
package                 : 0
core                    : 0
VPE                     : 0
VCED exceptions         : not available
VCEI exceptions         : not available</code></pre></div><p>Super, both FXS now working on VR200v and system seems to be stable (up with new firmware since ~24h)<br />More or less insignificant but FXS1 maps to context [lantiq2] and FXS2 to [lantiq1].</p><p>Changes I have done on git.lede-project.org/source.git:<br />Feed asterisk-chan-lantiq from Openwrt source<br /></p><div class="codebox"><pre><code>diff --git a/target/linux/lantiq/dts/VR200v.dts b/target/linux/lantiq/dts/VR200v.dts
index 11930ba..09ed5ba 100644
--- a/target/linux/lantiq/dts/VR200v.dts
+++ b/target/linux/lantiq/dts/VR200v.dts
@@ -8,7 +8,16 @@
        model = &quot;VR200v - TP-LINK Archer VR200v&quot;;
 
        chosen {
-               bootargs = &quot;console=ttyLTQ0,115200&quot;;
+               bootargs = &quot;console=ttyLTQ0,115200 mem=116M phym=128M vpe1_load_addr=0x87e00000 vpe1_mem=2M maxvpes=1 maxtcs=1&quot;;
+       };
+
+       sram@1F000000 {
+               vmmc@107000 {
+                       status = &quot;okay&quot;;
+                       gpios = &lt;&amp;gpio 30 GPIO_ACTIVE_HIGH  //fxs relay
+                                        &amp;gpio 31 GPIO_ACTIVE_HIGH  //still unknown
+                                        &amp;gpio 3  GPIO_ACTIVE_HIGH&gt;; //reset_slic?
+               };
        };
 
        aliases {</code></pre></div><p>Thank you all for your Help on that!</p>											<p class="post-edited">(Last edited by <strong>Aeronaut84</strong> on 7 Nov 2017, 10:24)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p367945">
				<div class="post-metadata">
					<div class="post-num">Post #79</div>
					<div class="post-author">Plonk34</div>
					<div class="post-datetime">
						7 Nov 2017, 21:59					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><blockquote><p>Is there a way to test function of the GPIO&#039;s?</p></blockquote></div><p>No idea, I would like to know that too.<br />And i would to like know what the GPIOs doin inside the Voicemaschine-driver.<br />And more i would to like know from where the developer get this information.</p><div class="quotebox"><blockquote><p>OFFTOPIC: Do I understand right, that in TP Link FW WLAN firmware gets loaded by kernel module mtlk.ko?</p></blockquote></div><p>No idea the VR200v is not my favorite device, does the WLAN works now ?</p><div class="quotebox"><blockquote><p>Some of you are near Stuttgart?</p></blockquote></div><p>No i am in Nord Germany</p><div class="quotebox"><blockquote><p>So its ok if just one of the two CPU cores come up, right?</p></blockquote></div><p>Unfortunately right, SMP and VMMC support together are not possible.<br />The discussion about the FXS support are here: <a href="http://lists.infradead.org/pipermail/lede-dev/2017-February/006219.html">http://lists.infradead.org/pipermail/le … 06219.html</a><br />The result is a relativ slow Router with ca max 80 MBit VDSL speed.<br />I guess that AVM have an other solution there Fritzboxes 7360 and 7490 with the equal VR9 processors are faster.</p><p>I am very interessinting on any Linux sourcecode for VR9 devices, did everbody know links ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p369065">
				<div class="post-metadata">
					<div class="post-num">Post #80</div>
					<div class="post-author">Zapp!</div>
					<div class="post-datetime">
						30 Nov 2017, 17:20					</div>
				</div>
				<div class="post-content content">
					<p>chan_lantiq seems to work fine, however during incoming calls the log gets flooded by this repeated message:<br /></p><div class="codebox"><pre><code>[Nov 30 15:02:49] ERROR[2642]: chan_lantiq.c:844 lantiq_map_rtptype_to_format: unsupported rtptype received is 0xd, forcing ulaw</code></pre></div><p>The call itself seems to be working fine, it just lags a bit - I guess because of codec translation. It&#039;s a call from a German mobile provider to my Lede box (using PJSIP and a Vodafone Germany SIP Account).<br />I also got these messages for outgoing calls when trying to edit codec allow/disallow lines in lantiq.conf, when using the default config, outgoing calls don&#039;t show this error.</p><p>Does anyone know what exactly is causing this?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p369108">
				<div class="post-metadata">
					<div class="post-num">Post #81</div>
					<div class="post-author">Zapp!</div>
					<div class="post-datetime">
						1 Dec 2017, 16:50					</div>
				</div>
				<div class="post-content content">
					<p>after setting &quot;rtp set debug on&quot; in asterisk console I can see the whole rtp traffic. It seems that most of the time it uses alaw as desired, but only sometimes chan_lantiq throws an error. This seems to happen more often during incoming calls.<br /></p><div class="codebox"><pre><code>Got  RTP packet from    88.79.152.251:10448 (type 08, seq 000091, ts 050400, len 000160)
Got  RTP packet from    88.79.152.251:10448 (type 08, seq 000092, ts 050560, len 000160)
Got  RTP packet from    88.79.152.251:10448 (type 08, seq 000093, ts 050720, len 000160)
Got  RTP packet from    88.79.152.251:10448 (type 08, seq 000094, ts 050880, len 000160)
Got  RTP packet from    88.79.152.251:10448 (type 08, seq 000095, ts 051040, len 000160)
[Dec  1 14:33:11] ERROR[1368]: chan_lantiq.c:844 lantiq_map_rtptype_to_format: unsupported rtptype received is 0xd, forcing ulaw
Sent RTP packet to      88.79.152.251:10448 (type 08, seq 017743, ts 011176, len 000001)
Got  RTP packet from    88.79.152.251:10448 (type 08, seq 000096, ts 051200, len 000160)
Got  RTP packet from    88.79.152.251:10448 (type 08, seq 000097, ts 051360, len 000160)
[Dec  1 14:33:11] ERROR[1368]: chan_lantiq.c:844 lantiq_map_rtptype_to_format: unsupported rtptype received is 0xd, forcing ulaw
Sent RTP packet to      88.79.152.251:10448 (type 08, seq 017744, ts 011177, len 000001)
Got  RTP packet from    88.79.152.251:10448 (type 08, seq 000098, ts 051520, len 000160)
[Dec  1 14:33:11] ERROR[1368]: chan_lantiq.c:844 lantiq_map_rtptype_to_format: unsupported rtptype received is 0xd, forcing ulaw
Sent RTP packet to      88.79.152.251:10448 (type 08, seq 017745, ts 011178, len 000001)
Got  RTP packet from    88.79.152.251:10448 (type 08, seq 000099, ts 051680, len 000160)
Sent RTP packet to      88.79.152.251:10448 (type 08, seq 017746, ts 011338, len 000160)
Got  RTP packet from    88.79.152.251:10448 (type 08, seq 000100, ts 051840, len 000160)
Sent RTP packet to      88.79.152.251:10448 (type 08, seq 017747, ts 011498, len 000160)
Got  RTP packet from    88.79.152.251:10448 (type 08, seq 000101, ts 052000, len 000160)
Sent RTP packet to      88.79.152.251:10448 (type 08, seq 017748, ts 011658, len 000160)</code></pre></div><p>I still think it&#039;s weird that rtp reports packet &quot;type 08&quot; (alaw) and in chan_lantiq it ends up as &quot;0xd&quot;.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p369216">
				<div class="post-metadata">
					<div class="post-num">Post #82</div>
					<div class="post-author">Plonk34</div>
					<div class="post-datetime">
						4 Dec 2017, 23:27					</div>
				</div>
				<div class="post-content content">
					<p>Asterisk-13.18.3 + chan-lantiq<br />against LEDE-SDK-17.01.4<br /><a href="https://yadi.sk/d/FwCt0N1C3QKLGa">privatpkg-lede17.01.4-asterisk-13.18.3.tar.gz</a><br />sha256: f4f997248341ea82ff7f0aaccae42a9538b0a7cd0cfa1778d11c72a58cb42aee</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p369217">
				<div class="post-metadata">
					<div class="post-num">Post #83</div>
					<div class="post-author">Plonk34</div>
					<div class="post-datetime">
						4 Dec 2017, 23:33					</div>
				</div>
				<div class="post-content content">
					<p>@Zapp!</p><p>Sorry i think it is better too ask an Voodoopriest.<br />I have an comparable problem. A call from a Friend ( O2 ---&gt; Sipgate ---&gt; me ) call sounds very incomprehensible.<br />For this reason i try to understand how the order are organized, i know on chan-sip (i have no idea about chan-pjsip) normally the server are the boss, but it can be configured inside sip.conf<br />But i have no idea what happen when sip-server and client agreed, what happen next concerning chan-lantiq.<br />The second huge mystery on my config: It seem that sipgate outgoing peer define the order, but this makes no sense. (it should be the inside the [general] menu)<br /></p><div class="quotebox"><blockquote><p>unsupported rtptype received is 0xd</p></blockquote></div><p>I think rtptype 0xd here is not the rtp type inside chan_lantiq.c, or better it exist different numbers for the same codec.</p><p>To make the messages vissible you should set inside /etc/asterisk/logger.conf<br /></p><div class="codebox"><pre><code>console =&gt; notice,warning,error,debug,verbose,dtmf,fax</code></pre></div><br /><br /><p>A littlebit (ca &lt; 1 sec) lack are always normal.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p369235">
				<div class="post-metadata">
					<div class="post-num">Post #84</div>
					<div class="post-author">Zapp!</div>
					<div class="post-datetime">
						5 Dec 2017, 15:32					</div>
				</div>
				<div class="post-content content">
					<p>@Plonk34</p><p>Thanks for your response.</p><p>Yeah, there&#039;s definitely some Voodoo involved with asterisk. All I can say so far is that the codec priority settings in pjsip.conf and lantiq.conf don&#039;t seem to work as expected (at least not as I expect). I&#039;ll investigate a bit more and write what I found out.</p><p>And thanks for your prebuild packages! They got me started with asterisk, but meanwhile I switched to my own build.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p369655">
				<div class="post-metadata">
					<div class="post-num">Post #85</div>
					<div class="post-author">Zapp!</div>
					<div class="post-datetime">
						15 Dec 2017, 20:14					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Plonk34 wrote:</cite><blockquote><p>I think rtptype 0xd here is not the rtp type inside chan_lantiq.c, or better it exist different numbers for the same codec.</p></blockquote></div><p>I finally found out what was causing the RTP errors.<br />I had &#039;voiceactivitydetection = on&#039; in my lantiq.conf, which leads to separate comfort noise packages being sent, which chan_lantiq apparently can’t handle correctly (yet?). The Payload type of these is 13 (&#039;d&#039; in hex), so the debug messages were correct. I don&#039;t know why they weren&#039;t shown in the RTP debug log though.</p><p>Either not setting voiceactivitydetection at all or setting it to &#039;sc&#039; (silence compression only) gets rid of this error.</p><p>If anyone is interested, I shared my PJSIP configuration here:<br /><a href="https://forum.lede-project.org/t/voip-configuration-for-asterisk13-pjsip-chan-lantiq-and-vodafone-germany/9470">https://forum.lede-project.org/t/voip-c … rmany/9470</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p370677">
				<div class="post-metadata">
					<div class="post-num">Post #86</div>
					<div class="post-author">Aeronaut84</div>
					<div class="post-datetime">
						9 Jan 2018, 14:42					</div>
				</div>
				<div class="post-content content">
					<p>Hello again!<br />I experienced an issue, but im not sure, if its my Phone, asterisk config or driver related:<br />My Phone only shows up the last Call in its Call-List... Also if I try to Call-back this Number, it does not Dial... I get the dial tone, but the number doesn&#039;t dial... Since I live in Germany (EU) i tried<br /></p><div class="codebox"><pre><code>calleridtype = etsifsk</code></pre></div><p>in lantiq.conf, but this doesn&#039;t change anything...<br />Answering calls and dial a number over the dialpad works without problems...</p><p>I don&#039;t know if this is related, but my /var/log/cdr-csv/Master.csv logs:<br /></p><div class="codebox"><pre><code>&quot;&quot;,&quot;+49xxxxxxx&quot;,&quot;49xxxxxxxx&quot;,&quot;tel3_in&quot;,&quot;&quot;&quot;+49xxxxxxxxxxx&quot;&quot; &lt;+49xxxxxxxxxx&gt;&quot;,&quot;SIP/xxxxxx-00000006&quot;,&quot;TAPI/2&quot;,&quot;Dial&quot;,&quot;TAPI/2,,t&quot;,&quot;2018-01-08 19:34:22&quot;,&quot;2018-01-08 19:34:30&quot;,&quot;2018-01-08 19:35:01&quot;,38,31,&quot;ANSWERED&quot;,&quot;DOCUMENTATION&quot;,&quot;1515440062.12&quot;,&quot;&quot;</code></pre></div><p>Strange to me seems the CallerID-Number (&quot;&quot;&quot;+49xxxxxxxxxxx&quot;&quot; &lt;+49xxxxxxxxxx&gt;&quot;) which is double quote marked... Maybe this makes the issue on the Phone?</p><p>Also I registered, that VR200v.dts got not update in LEDE Git... What are the requirements to patch it in LEDE git?<br />I compiled against asterisk15... But had the same issue on asterisk13...</p>											<p class="post-edited">(Last edited by <strong>Aeronaut84</strong> on 9 Jan 2018, 14:50)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p370679">
				<div class="post-metadata">
					<div class="post-num">Post #87</div>
					<div class="post-author">Aeronaut84</div>
					<div class="post-datetime">
						9 Jan 2018, 15:11					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Plonk34 wrote:</cite><blockquote><p>No idea the VR200v is not my favorite device, does the WLAN works now ?</p></blockquote></div><p>Sorry for the late answer, didn&#039;t recognize until now... No, but I found a thread related to it: <br /><a href="https://forum.openwrt.org/viewtopic.php?id=45047">https://forum.openwrt.org/viewtopic.php?id=45047</a></p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 4 of 4</div><nav><ul><li><a href="viewtopic.php%3Fid=62696&amp;p=1.html">1</a></li><li><a href="viewtopic.php%3Fid=62696&amp;p=2.html">2</a></li><li><a href="viewtopic.php%3Fid=62696&amp;p=3.html">3</a></li><li class="pagination-current"><span>4</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>