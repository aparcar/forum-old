<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Problems with CoovaChilli + OpenWrt Backfire 10.03.1</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 14 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p213062">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">ggp81</div>
					<div class="post-datetime">
						24 Sep 2013, 11:56					</div>
				</div>
				<div class="post-content content">
					<p>Hello,<br />I have some problems to make CoovaChilli on my Linksys WRT54GL with Backfire 10.03.1. The client correctly gets the IP address, but I am not able to reach the welcome page. My configuration follows. Any idea?<br />What does this alert mean?<br /></p><div class="quotebox"><blockquote><p>dhcp.c: 2076: 0 (Debug) !!! dhcp server :&nbsp; !!!</p></blockquote></div><p>DHCP on WAN interface looks to be disabled.</p><p>Thanks a lot.<br />Gabriele</p><p>root@OpenWrt:/etc/config# ifconfig<br /></p><div class="quotebox"><blockquote><p>br-lan&nbsp; &nbsp; Link encap:Ethernet&nbsp; HWaddr XX:XX:XX:XX:XX:XX&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:192.168.1.1&nbsp; Bcast:192.168.1.255&nbsp; Mask:255.255.255.0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:2187 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:169 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:828865 (809.4 KiB)&nbsp; TX bytes:92143 (89.9 KiB)</p><p>eth0&nbsp; &nbsp; &nbsp; Link encap:Ethernet&nbsp; HWaddr XX:XX:XX:XX:XX:XX<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:17194 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:746 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:1000 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:2452845 (2.3 MiB)&nbsp; TX bytes:161231 (157.4 KiB)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Interrupt:4 </p><p>eth0.0&nbsp; &nbsp; Link encap:Ethernet&nbsp; HWaddr XX:XX:XX:XX:XX:XX<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:2187 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:169 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:837613 (817.9 KiB)&nbsp; TX bytes:92819 (90.6 KiB)</p><p>eth0.1&nbsp; &nbsp; Link encap:Ethernet&nbsp; HWaddr XX:XX:XX:XX:XX:XX<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:172.16.1.97&nbsp; Bcast:172.16.255.255&nbsp; Mask:255.255.0.0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:14924 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:574 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:1295322 (1.2 MiB)&nbsp; TX bytes:57917 (56.5 KiB)</p><p>lo&nbsp; &nbsp; &nbsp; &nbsp; Link encap:Local Loopback&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:127.0.0.1&nbsp; Mask:255.0.0.0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP LOOPBACK RUNNING&nbsp; MTU:16436&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:16 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:16 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:1648 (1.6 KiB)&nbsp; TX bytes:1648 (1.6 KiB)</p><p>mon.wlan0 Link encap:UNSPEC&nbsp; HWaddr XX-XX-XX-XX-XX-XX-00-00-00-00-00-00-00-00-00-00&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:3458 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:0 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:32 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:294860 (287.9 KiB)&nbsp; TX bytes:0 (0.0 B)</p><p>wlan0&nbsp; &nbsp; &nbsp;Link encap:Ethernet&nbsp; HWaddr XX:XX:XX:XX:XX:XX<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:267 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:267 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:32 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:88963 (86.8 KiB)&nbsp; TX bytes:93769 (91.5 KiB)</p></blockquote></div><p>root@OpenWrt:/etc/config# brctl show<br /></p><div class="quotebox"><blockquote><p>bridge name&nbsp; &nbsp; bridge id&nbsp; &nbsp; &nbsp; &nbsp; STP enabled&nbsp; &nbsp; interfaces<br />br-lan&nbsp; &nbsp; &nbsp; &nbsp; 8000.0014bfd26d60&nbsp; &nbsp; no&nbsp; &nbsp; &nbsp; &nbsp; eth0.0</p></blockquote></div><p>This is my /etc/config/network<br /></p><div class="quotebox"><blockquote><p>config &#039;switch&#039; &#039;eth0&#039;<br />&nbsp; &nbsp; option &#039;enable&#039; &#039;1&#039;</p><p>config &#039;switch_vlan&#039; &#039;eth0_0&#039;<br />&nbsp; &nbsp; option &#039;device&#039; &#039;eth0&#039;<br />&nbsp; &nbsp; option &#039;vlan&#039; &#039;0&#039;<br />&nbsp; &nbsp; option &#039;ports&#039; &#039;0 1 2 3 5&#039;</p><p>config &#039;switch_vlan&#039; &#039;eth0_1&#039;<br />&nbsp; &nbsp; option &#039;device&#039; &#039;eth0&#039;<br />&nbsp; &nbsp; option &#039;vlan&#039; &#039;1&#039;<br />&nbsp; &nbsp; option &#039;ports&#039; &#039;4 5&#039;</p><p>config &#039;interface&#039; &#039;loopback&#039;<br />&nbsp; &nbsp; option &#039;ifname&#039; &#039;lo&#039;<br />&nbsp; &nbsp; option &#039;proto&#039; &#039;static&#039;<br />&nbsp; &nbsp; option &#039;ipaddr&#039; &#039;127.0.0.1&#039;<br />&nbsp; &nbsp; option &#039;netmask&#039; &#039;255.0.0.0&#039;</p><p>config &#039;interface&#039; &#039;lan&#039;<br />&nbsp; &nbsp; option &#039;type&#039; &#039;bridge&#039;<br />&nbsp; &nbsp; option &#039;ifname&#039; &#039;eth0.0&#039;<br />&nbsp; &nbsp; option &#039;proto&#039; &#039;static&#039;<br />&nbsp; &nbsp; option &#039;ipaddr&#039; &#039;192.168.1.1&#039;<br />&nbsp; &nbsp; option &#039;netmask&#039; &#039;255.255.255.0&#039;<br />&nbsp; &nbsp; option &#039;dns&#039; &#039;8.8.8.8&#039;</p><p>config &#039;interface&#039; &#039;wan&#039;<br />&nbsp; &nbsp; option &#039;ifname&#039; &#039;eth0.1&#039;<br />&nbsp; &nbsp; option &#039;proto&#039; &#039;dhcp&#039;</p></blockquote></div><br /><p>This is my /etc/config/wireless<br /></p><div class="quotebox"><blockquote><p>config &#039;wifi-device&#039; &#039;radio0&#039;<br />&nbsp; &nbsp; option &#039;type&#039; &#039;mac80211&#039;<br />&nbsp; &nbsp; option &#039;channel&#039; &#039;11&#039;<br />&nbsp; &nbsp; option &#039;macaddr&#039; XX:XX:XX:XX:XX:XX&#039;<br />&nbsp; &nbsp; option &#039;hwmode&#039; &#039;11g&#039;<br />&nbsp; &nbsp; option &#039;country&#039; &#039;00&#039;<br />&nbsp; &nbsp; option &#039;txpower&#039; &#039;4&#039;</p><p>config &#039;wifi-iface&#039;<br />&nbsp; &nbsp; option &#039;device&#039; &#039;radio0&#039;<br />&nbsp; &nbsp; option &#039;mode&#039; &#039;ap&#039;<br />&nbsp; &nbsp; option &#039;ssid&#039; &#039;OpenWrt&#039;<br />&nbsp; &nbsp; option &#039;encryption&#039; &#039;none&#039;</p></blockquote></div><br /><p>This is my /etc/config/dnsmasq<br /></p><div class="quotebox"><blockquote><p>config &#039;dnsmasq&#039;<br />&nbsp; &nbsp; option &#039;domainneeded&#039; &#039;1&#039;<br />&nbsp; &nbsp; option &#039;boguspriv&#039; &#039;1&#039;<br />&nbsp; &nbsp; option &#039;filterwin2k&#039; &#039;0&#039;<br />&nbsp; &nbsp; option &#039;localise_queries&#039; &#039;1&#039;<br />&nbsp; &nbsp; option &#039;rebind_protection&#039; &#039;1&#039;<br />&nbsp; &nbsp; option &#039;rebind_localhost&#039; &#039;1&#039;<br />&nbsp; &nbsp; option &#039;local&#039; &#039;/lan/&#039;<br />&nbsp; &nbsp; option &#039;domain&#039; &#039;lan&#039;<br />&nbsp; &nbsp; option &#039;expandhosts&#039; &#039;1&#039;<br />&nbsp; &nbsp; option &#039;nonegcache&#039; &#039;0&#039;<br />&nbsp; &nbsp; option &#039;authoritative&#039; &#039;1&#039;<br />&nbsp; &nbsp; option &#039;readethers&#039; &#039;1&#039;<br />&nbsp; &nbsp; option &#039;leasefile&#039; &#039;/tmp/dhcp.leases&#039;<br />&nbsp; &nbsp; option &#039;resolvfile&#039; &#039;/tmp/resolv.conf.auto&#039;</p><p>config &#039;dhcp&#039; &#039;lan&#039;<br />&nbsp; &nbsp; option &#039;interface&#039; &#039;lan&#039;<br />&nbsp; &nbsp; option &#039;ignore&#039; &#039;1&#039;</p><p>config &#039;dhcp&#039; &#039;wan&#039;<br />&nbsp; &nbsp; option &#039;interface&#039; &#039;wan&#039;<br />&nbsp; &nbsp; option &#039;ignore&#039; &#039;1&#039;</p></blockquote></div><p>root@OpenWrt:~# pwd<br /></p><div class="quotebox"><blockquote><p>/root</p></blockquote></div><p>root@OpenWrt:~# cat chilli-custom.conf&nbsp; <br /></p><div class="quotebox"><blockquote><p>net 192.168.182.0/24<br />dns1 8.8.8.8<br />dns2 8.8.4.4<br />domain [MYDOMAIN]<br />radiusserver1 [MYRADIUSSERVER]<br />radiusserver2 [MYRADIUSSERVER]<br />radiusauthport 1812<br />radiusacctport 1813<br />radiusnasid openwrt<br />radiuslocationid isocc=it,cc=0039,ac=0039,network=ACMEWISP_NewarkAirport<br />radiuslocationname ACMEWISP,Gate14_Terminal_C_of_Newark_Airport<br />radiussecret [MYRADIUSSECRET]<br />dhcpif wlan0<br />uamserver [MYUAMSERVER]<br />uamallowed [MYUAMALLOWED]</p></blockquote></div><p>root@OpenWrt:~# cat firewall-custom.sh <br /></p><div class="quotebox"><blockquote><p>iptables -F<br />iptables -t nat -F<br />iptables -t mangle -F<br />iptables -P INPUT ACCEPT<br />iptables -P OUTPUT ACCEPT<br />iptables -P FORWARD ACCEPT<br />iptables -t nat -A POSTROUTING -s 192.168.1.0/24 -o wlan0 -j MASQUERADE<br />iptables -A INPUT -i eth0 -p icmp -j ACCEPT<br />echo 1 &gt; /proc/sys/net/ipv4/ip_forward</p></blockquote></div><p>root@OpenWrt:~# ./firewall-custom.sh <br />root@OpenWrt:~# ps -ef | grep chilli<br /></p><div class="quotebox"><blockquote><p>1435 root&nbsp; &nbsp; &nbsp; 1372 S&nbsp; &nbsp; grep chilli</p></blockquote></div><p>root@OpenWrt:~# chilli -c /root/chilli.conf -f -d<br /></p><div class="quotebox"><blockquote><p>main-opt.c: 403: 0 (Debug) DHCP Listen: 192.168.182.1<br />main-opt.c: 404: 0 (Debug) UAM Listen: 192.168.182.1<br />garden.c: 62: 0 (Debug) Uamallowed [MYUAMALLOWED]<br />garden.c: 44: 0 (Debug) Uamallowed IP address #0:128: proto=0 host=[IP_ADDRESS] port=0<br />options.c: 367: 0 (Debug) PID 1439 saving options to /var/run/chilli.1438.cfg.bin<br />options.c: 544: 0 (Debug) PID 1438 reloaded binary options file<br />chilli.c: 4848: 0 (Debug) clock realtime sec 1380009690 nsec 716914912<br />chilli.c: 4853: 0 (Debug) clock monotonic sec 1680 nsec 404709750<br />tun.c: 520: 0 (Debug) TX queue length set to 100<br />ippool.c: 322: 0 (Debug) Hashlog 8 253 256</p><p>net.c: 1028: 0 (Debug) Net SNDBUF 32767<br />net.c: 1031: 0 (Debug) Net RCVBUF 32767<br />net.c: 1083: 0 (Debug) device wlan0 ifindex 7<br />dhcp.c: 208: 0 (Debug) GARP: Replying to broadcast<br />chilli.c: 5084: 0 (Debug) Waiting for client request...<br />radius.c: 1423: 0 (Debug) RADIUS to [MYRADIUSSERVER]:1813<br />dhcp.c: 3420: 0 (Debug) dhcp_decaps: src=00:14:bf:d2:6d:60 dst=00:23:ae:65:e4:a0 prot=0800 2048 len=182<br />dhcp.c: 2795: 0 (Debug) Not for our MAC or broadcast: 00-23-AE-65-E4-A0<br />dhcp.c: 3420: 0 (Debug) dhcp_decaps: src=00:14:bf:d2:6d:60 dst=00:23:ae:65:e4:a0 prot=0800 2048 len=186<br />dhcp.c: 2795: 0 (Debug) Not for our MAC or broadcast: 00-23-AE-65-E4-A0<br />dhcp.c: 3420: 0 (Debug) dhcp_decaps: src=00:23:ae:65:e4:a0 dst=00:14:bf:d2:6d:60 prot=0800 2048 len=64<br />dhcp.c: 2795: 0 (Debug) Not for our MAC or broadcast: 00-14-BF-D2-6D-60<br />dhcp.c: 3420: 0 (Debug) dhcp_decaps: src=00:23:ae:65:e4:a0 dst=00:14:bf:d2:6d:60 prot=0800 2048 len=60<br />dhcp.c: 2795: 0 (Debug) Not for our MAC or broadcast: 00-14-BF-D2-6D-60<br />dhcp.c: 3420: 0 (Debug) dhcp_decaps: src=00:0c:42:04:ad:48 dst=ff:ff:ff:ff:ff:ff prot=0806 2054 len=64<br />dhcp.c: 3855: 0 (Debug) ARP: Address not found: 10.0.0.1<br />dhcp.c: 571: 0 (Debug) DHCP newconn: 00:0c:42:04:ad:48<br />chilli.c: 3721: 0 (Debug) New DHCP request from MAC=00-0C-42-04-AD-48<br />chilli.c: 3724: 0 (Debug) New DHCP connection established<br />dhcp.c: 3877: 0 (Debug) ARP: 00-0C-42-04-AD-48 asking about 10.0.0.18<br />dhcp.c: 3917: 0 (Debug) ARP: request did not come from known client<br />dhcp.c: 3420: 0 (Debug) dhcp_decaps: src=00:0c:42:04:ad:48 dst=ff:ff:ff:ff:ff:ff prot=0806 2054 len=60<br />dhcp.c: 3877: 0 (Debug) ARP: 00-0C-42-04-AD-48 asking about 10.0.0.18<br />dhcp.c: 3917: 0 (Debug) ARP: request did not come from known client<br />dhcp.c: 3420: 0 (Debug) dhcp_decaps: src=00:14:bf:d2:6d:60 dst=00:23:ae:65:e4:a0 prot=0800 2048 len=182<br />dhcp.c: 2795: 0 (Debug) Not for our MAC or broadcast: 00-23-AE-65-E4-A0<br />dhcp.c: 3420: 0 (Debug) dhcp_decaps: src=00:14:bf:d2:6d:60 dst=00:23:ae:65:e4:a0 prot=0800 2048 len=186<br />dhcp.c: 2795: 0 (Debug) Not for our MAC or broadcast: 00-23-AE-65-E4-A0<br />tun.c: 705: 0 (Debug) tun_decaps(idx=0, len=356)<br />chilli.c: 1986: 0 (Debug) dropping packet with unknown destination: 192.168.182.3<br />dhcp.c: 3420: 0 (Debug) dhcp_decaps: src=00:23:ae:65:e4:a0 dst=00:14:bf:d2:6d:60 prot=0800 2048 len=64<br />dhcp.c: 2795: 0 (Debug) Not for our MAC or broadcast: 00-14-BF-D2-6D-60<br />dhcp.c: 3420: 0 (Debug) dhcp_decaps: src=00:23:ae:65:e4:a0 dst=00:14:bf:d2:6d:60 prot=0800 2048 len=60<br />dhcp.c: 2795: 0 (Debug) Not for our MAC or broadcast: 00-14-BF-D2-6D-60<br />dhcp.c: 3420: 0 (Debug) dhcp_decaps: src=00:1b:77:70:e3:9b dst=00:14:bf:d2:6d:62 prot=0800 2048 len=342<br />dhcp.c: 2810: 0 (Debug) dhcp/bootps request being processed<br />dhcp.c: 571: 0 (Debug) DHCP newconn: 00:1b:77:70:e3:9b<br />chilli.c: 3721: 0 (Debug) New DHCP request from MAC=00-1B-77-70-E3-9B<br />chilli.c: 3724: 0 (Debug) New DHCP connection established<br />chilli.c: 3567: 0 (Debug) DHCP request for IP address<br />ippool.c: 438: 0 (Debug) Requesting new static ip: 192.168.182.3<br />ippool.c: 461: 0 (Debug) Static IP address not allowed<br />ippool.c: 438: 0 (Debug) Requesting new dynamic ip: 192.168.182.3<br />chilli.c: 3676: 0 (Debug) Client MAC=00-1B-77-70-E3-9B assigned IP 192.168.182.3<br />dhcp.c: 2076: 0 (Debug) !!! dhcp server :&nbsp; !!!<br />dhcp.c: 3420: 0 (Debug) dhcp_decaps: src=00:1b:77:70:e3:9b dst=01:00:5e:7f:ff:fa prot=0800 2048 len=452<br />dhcp.c: 2795: 0 (Debug) Not for our MAC or broadcast: 01-00-5E-7F-FF-FA<br />dhcp.c: 3420: 0 (Debug) dhcp_decaps: src=00:1b:77:70:e3:9b dst=01:00:5e:7f:ff:fa prot=0800 2048 len=452<br />dhcp.c: 2795: 0 (Debug) Not for our MAC or broadcast: 01-00-5E-7F-FF-FA<br />dhcp.c: 3420: 0 (Debug) dhcp_decaps: src=00:1b:77:70:e3:9b dst=01:00:5e:7f:ff:fa prot=0800 2048 len=458<br />dhcp.c: 2795: 0 (Debug) Not for our MAC or broadcast: 01-00-5E-7F-FF-FA<br />dhcp.c: 3420: 0 (Debug) dhcp_decaps: src=00:1b:77:70:e3:9b dst=01:00:5e:7f:ff:fa prot=0800 2048 len=458<br />dhcp.c: 2795: 0 (Debug) Not for our MAC or broadcast: 01-00-5E-7F-FF-FA</p></blockquote></div><p>***EDIT***</p><p>This are logs after a request to <a href="http://www.openwrt.org">www.openwrt.org</a>. I expect the client to redirect me to the welcome page, but unfortunately this does not happen (I got a &quot;page not found&quot; error)</p><div class="quotebox"><blockquote><p>dhcp.c: 3420: 0 (Debug) dhcp_decaps: src=00:1b:77:70:e3:9b dst=[XX:XX:XX:XX:XX:XX] prot=0800 2048 len=71<br />dhcp.c: 1385: 0 (Debug) dhcp_dns plen=71 dlen=17 olen=17<br />dhcp.c: 1387: 0 (Debug) DNS ID:&nbsp; &nbsp; 55084<br />dhcp.c: 1388: 0 (Debug) DNS Flags: 256<br />dhcp.c: 1410: 0 (Debug) qd: 1<br />dns.c: 182: 0 (Debug) dns_copy_res(left=17 olen=17 qsize=512)<br />dns.c: 205: 0 (Debug) It was a dns record type: 1 class: 1<br />dns.c: 39: 0 (Debug) dlen=512 reslen=17 olen=17 lvl=0<br />dns.c: 73: 0 (Debug) part[openwrt] reslen=16 l=7 dlen=512<br />dns.c: 73: 0 (Debug) part[org] reslen=8 l=3 dlen=504<br />dns.c: 234: 0 (Debug) Q: openwrt.org<br />dhcp.c: 1411: 0 (Debug) an: 0<br />dhcp.c: 1412: 0 (Debug) ns: 0<br />dhcp.c: 1413: 0 (Debug) ar: 0<br />dhcp.c: 1415: 0 (Debug) left (should be zero): 0<br />dhcp.c: 3420: 0 (Debug) dhcp_decaps: src=00:1b:77:70:e3:9b dst=[XX:XX:XX:XX:XX:XX] prot=0800 2048 len=71<br />dhcp.c: 1385: 0 (Debug) dhcp_dns plen=71 dlen=17 olen=17<br />dhcp.c: 1387: 0 (Debug) DNS ID:&nbsp; &nbsp; 55084<br />dhcp.c: 1388: 0 (Debug) DNS Flags: 256<br />dhcp.c: 1410: 0 (Debug) qd: 1<br />dns.c: 182: 0 (Debug) dns_copy_res(left=17 olen=17 qsize=512)<br />dns.c: 205: 0 (Debug) It was a dns record type: 1 class: 1<br />dns.c: 39: 0 (Debug) dlen=512 reslen=17 olen=17 lvl=0<br />dns.c: 73: 0 (Debug) part[openwrt] reslen=16 l=7 dlen=512<br />dns.c: 73: 0 (Debug) part[org] reslen=8 l=3 dlen=504<br />dns.c: 234: 0 (Debug) Q: openwrt.org<br />dhcp.c: 1411: 0 (Debug) an: 0<br />dhcp.c: 1412: 0 (Debug) ns: 0<br />dhcp.c: 1413: 0 (Debug) ar: 0<br />dhcp.c: 1415: 0 (Debug) left (should be zero): 0<br />dhcp.c: 3420: 0 (Debug) dhcp_decaps: src=00:1b:77:70:e3:9b dst=[XX:XX:XX:XX:XX:XX] prot=0800 2048 len=71<br />dhcp.c: 1385: 0 (Debug) dhcp_dns plen=71 dlen=17 olen=17<br />dhcp.c: 1387: 0 (Debug) DNS ID:&nbsp; &nbsp; 55084<br />dhcp.c: 1388: 0 (Debug) DNS Flags: 256<br />dhcp.c: 1410: 0 (Debug) qd: 1<br />dns.c: 182: 0 (Debug) dns_copy_res(left=17 olen=17 qsize=512)<br />dns.c: 205: 0 (Debug) It was a dns record type: 1 class: 1<br />dns.c: 39: 0 (Debug) dlen=512 reslen=17 olen=17 lvl=0<br />dns.c: 73: 0 (Debug) part[openwrt] reslen=16 l=7 dlen=512<br />dns.c: 73: 0 (Debug) part[org] reslen=8 l=3 dlen=504<br />dns.c: 234: 0 (Debug) Q: openwrt.org<br />dhcp.c: 1411: 0 (Debug) an: 0<br />dhcp.c: 1412: 0 (Debug) ns: 0<br />dhcp.c: 1413: 0 (Debug) ar: 0<br />dhcp.c: 1415: 0 (Debug) left (should be zero): 0<br />dhcp.c: 3420: 0 (Debug) dhcp_decaps: src=00:1b:77:70:e3:9b dst=[XX:XX:XX:XX:XX:XX] prot=0800 2048 len=71<br />dhcp.c: 1385: 0 (Debug) dhcp_dns plen=71 dlen=17 olen=17<br />dhcp.c: 1387: 0 (Debug) DNS ID:&nbsp; &nbsp; 55084<br />dhcp.c: 1388: 0 (Debug) DNS Flags: 256<br />dhcp.c: 1410: 0 (Debug) qd: 1<br />dns.c: 182: 0 (Debug) dns_copy_res(left=17 olen=17 qsize=512)<br />dns.c: 205: 0 (Debug) It was a dns record type: 1 class: 1<br />dns.c: 39: 0 (Debug) dlen=512 reslen=17 olen=17 lvl=0<br />dns.c: 73: 0 (Debug) part[openwrt] reslen=16 l=7 dlen=512<br />dns.c: 73: 0 (Debug) part[org] reslen=8 l=3 dlen=504<br />dns.c: 234: 0 (Debug) Q: openwrt.org<br />dhcp.c: 1411: 0 (Debug) an: 0<br />dhcp.c: 1412: 0 (Debug) ns: 0<br />dhcp.c: 1413: 0 (Debug) ar: 0<br />dhcp.c: 1415: 0 (Debug) left (should be zero): 0<br />dhcp.c: 3420: 0 (Debug) dhcp_decaps: src=00:1b:77:70:e3:9b dst=[XX:XX:XX:XX:XX:XX] prot=0800 2048 len=71<br />dhcp.c: 1385: 0 (Debug) dhcp_dns plen=71 dlen=17 olen=17<br />dhcp.c: 1387: 0 (Debug) DNS ID:&nbsp; &nbsp; 55084<br />dhcp.c: 1388: 0 (Debug) DNS Flags: 256<br />dhcp.c: 1410: 0 (Debug) qd: 1<br />dns.c: 182: 0 (Debug) dns_copy_res(left=17 olen=17 qsize=512)<br />dns.c: 205: 0 (Debug) It was a dns record type: 1 class: 1<br />dns.c: 39: 0 (Debug) dlen=512 reslen=17 olen=17 lvl=0<br />dns.c: 73: 0 (Debug) part[openwrt] reslen=16 l=7 dlen=512<br />dns.c: 73: 0 (Debug) part[org] reslen=8 l=3 dlen=504<br />dns.c: 234: 0 (Debug) Q: openwrt.org<br />dhcp.c: 1411: 0 (Debug) an: 0<br />dhcp.c: 1412: 0 (Debug) ns: 0<br />dhcp.c: 1413: 0 (Debug) ar: 0<br />dhcp.c: 1415: 0 (Debug) left (should be zero): 0<br />dhcp.c: 3420: 0 (Debug) dhcp_decaps: src=00:1b:77:70:e3:9b dst=[XX:XX:XX:XX:XX:XX] prot=0800 2048 len=71<br />dhcp.c: 1385: 0 (Debug) dhcp_dns plen=71 dlen=17 olen=17<br />dhcp.c: 1387: 0 (Debug) DNS ID:&nbsp; &nbsp; 55084<br />dhcp.c: 1388: 0 (Debug) DNS Flags: 256<br />dhcp.c: 1410: 0 (Debug) qd: 1<br />dns.c: 182: 0 (Debug) dns_copy_res(left=17 olen=17 qsize=512)<br />dns.c: 205: 0 (Debug) It was a dns record type: 1 class: 1<br />dns.c: 39: 0 (Debug) dlen=512 reslen=17 olen=17 lvl=0<br />dns.c: 73: 0 (Debug) part[openwrt] reslen=16 l=7 dlen=512<br />dns.c: 73: 0 (Debug) part[org] reslen=8 l=3 dlen=504<br />dns.c: 234: 0 (Debug) Q: openwrt.org<br />dhcp.c: 1411: 0 (Debug) an: 0<br />dhcp.c: 1412: 0 (Debug) ns: 0<br />dhcp.c: 1413: 0 (Debug) ar: 0<br />dhcp.c: 1415: 0 (Debug) left (should be zero): 0<br />dhcp.c: 3420: 0 (Debug) dhcp_decaps: src=00:1b:77:70:e3:9b dst=[XX:XX:XX:XX:XX:XX] prot=0800 2048 len=71<br />dhcp.c: 1385: 0 (Debug) dhcp_dns plen=71 dlen=17 olen=17<br />dhcp.c: 1387: 0 (Debug) DNS ID:&nbsp; &nbsp; 55084<br />dhcp.c: 1388: 0 (Debug) DNS Flags: 256<br />dhcp.c: 1410: 0 (Debug) qd: 1<br />dns.c: 182: 0 (Debug) dns_copy_res(left=17 olen=17 qsize=512)<br />dns.c: 205: 0 (Debug) It was a dns record type: 1 class: 1<br />dns.c: 39: 0 (Debug) dlen=512 reslen=17 olen=17 lvl=0<br />dns.c: 73: 0 (Debug) part[openwrt] reslen=16 l=7 dlen=512<br />dns.c: 73: 0 (Debug) part[org] reslen=8 l=3 dlen=504<br />dns.c: 234: 0 (Debug) Q: openwrt.org<br />dhcp.c: 1411: 0 (Debug) an: 0<br />dhcp.c: 1412: 0 (Debug) ns: 0<br />dhcp.c: 1413: 0 (Debug) ar: 0<br />dhcp.c: 1415: 0 (Debug) left (should be zero): 0</p></blockquote></div>											<p class="post-edited">(Last edited by <strong>ggp81</strong> on 24 Sep 2013, 13:00)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p213068">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">ggp81</div>
					<div class="post-datetime">
						24 Sep 2013, 13:11					</div>
				</div>
				<div class="post-content content">
					<p>It looks like I succeeded to do the job.</p><p>These are the correct iptables rules. I hope this will help someone.<br /></p><div class="quotebox"><blockquote><p>iptables -F<br />iptables -t nat -F<br />iptables -t mangle -F<br />iptables -P INPUT ACCEPT<br />iptables -P OUTPUT ACCEPT<br />iptables -P FORWARD ACCEPT<br />iptables -t nat -A POSTROUTING -o eth0.1 -j MASQUERADE<br />iptables -A INPUT -i wlan0 -p icmp -j ACCEPT<br />echo 1 &gt; /proc/sys/net/ipv4/ip_forward</p></blockquote></div><p>Gabriele</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p213117">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">FriedZombie</div>
					<div class="post-datetime">
						25 Sep 2013, 01:33					</div>
				</div>
				<div class="post-content content">
					<p>Well that is one way to completely disable a firewall, I wouldn&#039;t recommend it though.<br />But if this works, check what proper settings you have to make. (sorry haven&#039;t done much with captive portals, wish I could be more helpful).</p>											<p class="post-edited">(Last edited by <strong>FriedZombie</strong> on 25 Sep 2013, 01:35)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p213134">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">ggp81</div>
					<div class="post-datetime">
						25 Sep 2013, 11:54					</div>
				</div>
				<div class="post-content content">
					<p>Yes, of course it is not safe accepting all the traffic, but actually my first goal was to make the hotspot work, and I succeeded.<br />Now I am able to adjust my iptables according to my specific needs and to my network.</p><p>Thanks for your kindness anyway <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p249666">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">sam992</div>
					<div class="post-datetime">
						8 Oct 2014, 06:28					</div>
				</div>
				<div class="post-content content">
					<p>I have a very similar setup and exactly the same problem. I use br-lan as my subscriber network for coova-chilli. The only difference is that your eth0.0 is my eth0.1 and your eth0.1 is my eth0.2. I tried to use that custom iptables script but it did not work. I wrote it under Custom Rules (Firewall) in the UI of OpenWRT. When I use eth0.1 or wlan0 as my subscriber network coova-chilli works and redirects to the login page. But it does not work with br-lan (bridge over eth0.1 &amp; wlan0). Can somebody help?</p><div class="codebox"><pre><code>br-lan    Link encap:Ethernet  HWaddr 10:BF:48:E6:F3:07  
          inet addr:192.168.1.1  Bcast:192.168.1.255  Mask:255.255.255.0
          inet6 addr: fd64:e207:3b28::1/60 Scope:Global
          inet6 addr: fe80::12bf:48ff:fee6:f307/64 Scope:Link
          UP BROADCAST RUNNING PROMISC MULTICAST  MTU:1500  Metric:1
          RX packets:12943 errors:0 dropped:0 overruns:0 frame:0
          TX packets:11654 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:1226862 (1.1 MiB)  TX bytes:4555967 (4.3 MiB)

eth0      Link encap:Ethernet  HWaddr 10:BF:48:E6:F3:07  
          inet6 addr: fe80::12bf:48ff:fee6:f307/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:4 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)
          Interrupt:4 

eth0.1    Link encap:Ethernet  HWaddr 10:BF:48:E6:F3:07  
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:12833 errors:0 dropped:0 overruns:0 frame:0
          TX packets:11147 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:1177763 (1.1 MiB)  TX bytes:4425931 (4.2 MiB)

eth0.2    Link encap:Ethernet  HWaddr 10:BF:48:E6:F3:07  
          inet addr:192.168.182.21  Bcast:192.168.182.255  Mask:255.255.255.0
          inet6 addr: fe80::12bf:48ff:fee6:f307/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:16271 errors:0 dropped:0 overruns:0 frame:0
          TX packets:4281 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:4323728 (4.1 MiB)  TX bytes:553680 (540.7 KiB)

lo        Link encap:Local Loopback  
          inet addr:127.0.0.1  Mask:255.0.0.0
          inet6 addr: ::1/128 Scope:Host
          UP LOOPBACK RUNNING  MTU:65536  Metric:1
          RX packets:100 errors:0 dropped:0 overruns:0 frame:0
          TX packets:100 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:7249 (7.0 KiB)  TX bytes:7249 (7.0 KiB)

tun0      Link encap:UNSPEC  HWaddr 00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00  
          inet addr:10.1.0.1  P-t-P:10.1.0.1  Mask:255.255.255.0
          UP POINTOPOINT RUNNING  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:100 
          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)

wlan0     Link encap:Ethernet  HWaddr 10:BF:48:E6:F3:07  
          inet6 addr: fe80::12bf:48ff:fee6:f307/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:730 errors:0 dropped:0 overruns:0 frame:0
          TX packets:1247 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:107022 (104.5 KiB)  TX bytes:234667 (229.1 KiB)</code></pre></div><p>And the defaults file (part of it)<br /></p><div class="codebox"><pre><code># -*- mode: shell-script; -*-                                      
#                                                                                                         
#   Coova-Chilli Default Configurations.                               
#   To customize, copy this file to /etc/chilli/config                                                        
#   and edit to your liking. This is included in shell scripts
#   that configure chilli and related programs before file &#039;config&#039;.                                      
                                                                                                       
                                                                                                              
###                                                                
#   Local Network Configurations                                    
#                                                                                                      
                                                                       
HS_WANIF=eth1            # WAN Interface toward the Internet                     
HS_LANIF=br-lan            # Subscriber Interface for client devices 
HS_NETWORK=10.1.0.0        # HotSpot Network (must include HS_UAMLISTEN)                       
HS_NETMASK=255.255.255.0   # HotSpot Network Netmask                   
HS_UAMLISTEN=10.1.0.1      # HotSpot IP Address (on subscriber network)           
HS_UAMPORT=3990            # HotSpot UAM Port (on subscriber network)
HS_UAMUIPORT=4990          # HotSpot UAM &quot;UI&quot; Port (on subscriber network, for embedded portal)
                                                                
# HS_DYNIP=                                                                       
# HS_DYNIP_MASK=255.255.255.0                              
# HS_STATIP=                                                                
# HS_STATIP_MASK=255.255.255.0                                        
# HS_DNS_DOMAIN=                                                             
                                                              
# OpenDNS Servers                                                           
HS_DNS1=208.67.222.222                                                       
HS_DNS2=208.67.220.220                                                              
                                                                  
###                                                                                                           
#   HotSpot settings for simple Captive Portal                                                 
#                                                                                                         
HS_NASID=sudowifi                                                                                      
HS_RADIUS=192.168.1.2                                                                                         
HS_RADIUS2=192.168.1.2                                                                         
HS_UAMALLOW=&quot;192.168.1.2 192.168.1.1 www.sudowifi.net&quot;                                         
HS_RADSECRET=*password*    # Set to be your RADIUS shared secret                                     
HS_UAMSECRET=*password*     # Set to be your UAM secret                                      
HS_UAMALIASNAME=chilli                                                                         
                            

#   Use HS_UAMFORMAT to define the actual captive portal url.                     
#   Shell variable replacement takes place when evaluated, so here     
#   HS_UAMSERVER is escaped and later replaced by the pre-defined           
#   HS_UAMSERVER to form the actual &quot;--uamserver&quot; option in chilli.    
HS_UAMFORMAT=https://myexternaldomain/login.php                    
                                                                       
#   Same principal goes for HS_UAMHOMEPAGE.                                 
HS_UAMHOMEPAGE=http://\$HS_UAMLISTEN:\$HS_UAMPORT/www/coova.html             
                                                                           </code></pre></div><p>Network file<br /></p><div class="codebox"><pre><code>config switch &#039;eth0&#039;
        option name &#039;eth0&#039;
        option reset &#039;1&#039;
        option enable_vlan &#039;1&#039;

config switch_vlan
        option device &#039;eth0&#039;
        option vlan &#039;1&#039;
        option ports &#039;1 2 3 4 8t&#039;

config switch_vlan
        option device &#039;eth0&#039;
        option vlan &#039;2&#039;
        option ports &#039;0 8t&#039;

config interface &#039;loopback&#039;
        option ifname &#039;lo&#039;
        option proto &#039;static&#039;
        option ipaddr &#039;127.0.0.1&#039;
        option netmask &#039;255.0.0.0&#039;

config globals &#039;globals&#039;
        option ula_prefix &#039;fd64:e207:3b28::/48&#039;

config interface &#039;lan&#039;
        option ifname &#039;eth0.1&#039;
        option force_link &#039;1&#039;
        option type &#039;bridge&#039;
        option proto &#039;static&#039;
        option ipaddr &#039;192.168.1.1&#039;
        option netmask &#039;255.255.255.0&#039;
        option ip6assign &#039;60&#039;

config interface &#039;wan&#039;
        option ifname &#039;eth0.2&#039;
        option proto &#039;dhcp&#039;

config interface &#039;wan6&#039;      
        option ifname &#039;@wan&#039; 
        option proto &#039;dhcpv6&#039;
                              </code></pre></div><p>My Custom Rules for the Firewall</p><div class="codebox"><pre><code>iptables -F
iptables -t nat -F
iptables -t mangle -F
iptables -P INPUT ACCEPT
iptables -P OUTPUT ACCEPT
iptables -P FORWARD ACCEPT
iptables -t nat -A POSTROUTING -o eth0.2 -j MASQUERADE
iptables -A INPUT -i wlan0 -p icmp -j ACCEPT
echo 1 &gt; /proc/sys/net/ipv4/ip_forward</code></pre></div><p>Any help? I have been trying for 2 days now.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>