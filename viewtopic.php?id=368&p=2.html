<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Patches against CVS available for review</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 11 Apr 2018 and 19 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 2 of 2</div><nav><ul><li><a href="viewtopic.php%3Fid=368&amp;p=1.html">1</a></li><li class="pagination-current"><span>2</span></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p1837">
				<div class="post-metadata">
					<div class="post-num">Post #26</div>
					<div class="post-author">twolife</div>
					<div class="post-datetime">
						27 Aug 2004, 16:43					</div>
				</div>
				<div class="post-content content">
					<p>strace ipkg + update to the latest version</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p1848">
				<div class="post-metadata">
					<div class="post-num">Post #27</div>
					<div class="post-author">Nico</div>
					<div class="post-datetime">
						28 Aug 2004, 18:22					</div>
				</div>
				<div class="post-content content">
					<p>tcp_wrappers (libwrap)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p1849">
				<div class="post-metadata">
					<div class="post-num">Post #28</div>
					<div class="post-author">Nico</div>
					<div class="post-datetime">
						28 Aug 2004, 18:24					</div>
				</div>
				<div class="post-content content">
					<p>portmap</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p1851">
				<div class="post-metadata">
					<div class="post-num">Post #29</div>
					<div class="post-author">Nico</div>
					<div class="post-datetime">
						28 Aug 2004, 19:29					</div>
				</div>
				<div class="post-content content">
					<p><a href="http://www.swox.com/gmp/">gmp</a> v4.1.3 (libgmp)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p1852">
				<div class="post-metadata">
					<div class="post-num">Post #30</div>
					<div class="post-author">Nico</div>
					<div class="post-datetime">
						28 Aug 2004, 21:34					</div>
				</div>
				<div class="post-content content">
					<p><a href="http://www.net-snmp.org/">net-snmp</a> v5.1.1</p><p>will provide the following packages:<strong> Â· </strong> libsnmp<br /><strong> Â· </strong> snmp-agent<br /><strong> Â· </strong> snmp-utils</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p1853">
				<div class="post-metadata">
					<div class="post-num">Post #31</div>
					<div class="post-author">Nico</div>
					<div class="post-datetime">
						28 Aug 2004, 22:53					</div>
				</div>
				<div class="post-content content">
					<p>mawk v1.3.3</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p1854">
				<div class="post-metadata">
					<div class="post-num">Post #32</div>
					<div class="post-author">LetoAms</div>
					<div class="post-datetime">
						29 Aug 2004, 00:34					</div>
				</div>
				<div class="post-content content">
					<p>It works for me:</p><p># tar jxf usr/src/linux-2.4.26.tar.bz2<br /># wget <a href="http://openwrt.org/forum/download.php?id=61\">http://openwrt.org/forum/download.php?id=61&quot;</a> -O patch<br />--23:33:13--&nbsp; <a href="http://openwrt.org:80/forum/download.php?id=61">http://openwrt.org:80/forum/download.php?id=61</a><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;=&gt; `patch&#039;<br />Connecting to openwrt.org:80... connected!<br />HTTP request sent, fetching headers... done.<br />Length: 3,145 [application/octet-stream]</p><p>&nbsp; &nbsp; 0K -&gt; ...</p><p>23:33:14 (341.25 KB/s) - `patch&#039; saved [3145/3145]</p><p># cd linux-2.4.26/<br /># cat ../patch | patch -p1 -s<br />#</p><p>But I have also put the seperate patch files that are part of this patch at <a href="http://www.xtdnet.nl/paul/natt/">http://www.xtdnet.nl/paul/natt/</a></p><p>Let me know if these also do not work.</p><p>Paul</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p1856">
				<div class="post-metadata">
					<div class="post-num">Post #33</div>
					<div class="post-author">Nico</div>
					<div class="post-datetime">
						29 Aug 2004, 01:50					</div>
				</div>
				<div class="post-content content">
					<p>Paul,</p><p>i guess your patches should integrate more seemlessly in the build process to get accepted</p><p>try looking at other patches in ./sources/openwrt/kernel/patches<br />and make a diff</p><p>--<br />Nico</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p1857">
				<div class="post-metadata">
					<div class="post-num">Post #34</div>
					<div class="post-author">Nico</div>
					<div class="post-datetime">
						29 Aug 2004, 05:35					</div>
				</div>
				<div class="post-content content">
					<p>ncurses v5.2 (libncurses)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p1858">
				<div class="post-metadata">
					<div class="post-num">Post #35</div>
					<div class="post-author">Nico</div>
					<div class="post-datetime">
						29 Aug 2004, 06:49					</div>
				</div>
				<div class="post-content content">
					<p><a href="http://www.mysql.org/">MySQL</a> v4.0.20</p><p>will provide the following packages:<br /><strong> Â· </strong> libmysql, the mysql client library<br /><strong> Â· </strong> mysql-utils, some mysql client utilities (mysqladmin and mysqlshow)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p1866">
				<div class="post-metadata">
					<div class="post-num">Post #36</div>
					<div class="post-author">LetoAms</div>
					<div class="post-datetime">
						29 Aug 2004, 18:07					</div>
				</div>
				<div class="post-content content">
					<p>Nico, thank you for your answer, but I am still confused.</p><p>The patches you point me to as an example are all patches to package an additional package (eg a binary or kernel module). My patch does not stand on its own like that, because it patches the linux kernel itself. It does not create its own new files, nor is it part of an ikpg. It needs to happen at a specific point. After the kernel downloaded and untarred, and before it is being built. This means adding the patch operation to the openwrt.mk file.</p><p>So this is not a patch you can put in as an external package &#039;patch&#039;.</p><p>So, I *think* that what you guys want is a single patch that:<br />1a downloads this patch from somewhere and put it in&nbsp; $(DL_DIR)&nbsp; &nbsp; or <br />1b Will it be part of openwrt.tar.gz, such as the patch file being in sources? Or do you want it in sources/kernel-patches (a directory that contains nothing yet, so i am not sure if it is actually used)<br />2 patches openwrt.mk to run the patch command that actually patches the kernel.<br />This last step I am not sure about either, because the kernel-patches directory assumes if you put patches there, they will get applied at the right time, but openwrt.mk doesn&#039;t seem to do any kernel patching at all, hence my idea of adding the patchline in openwrt.mk.....</p><p>So, I am still rather confused.</p><p>If someone can tell me how I should give the kernel patch, or confirm one of the above methods is indeed what is needed, then I will create it and post it to the forum.</p><p>Paul</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p1868">
				<div class="post-metadata">
					<div class="post-num">Post #37</div>
					<div class="post-author">Nico</div>
					<div class="post-datetime">
						29 Aug 2004, 22:13					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><blockquote><p>The patches you point me to as an example are all patches to package an additional package (eg a binary or kernel module). My patch does not stand on its own like that, because it patches the linux kernel itself. It does not create its own new files, nor is it part of an ikpg. It needs to happen at a specific point. After the kernel downloaded and untarred, and before it is being built. This means adding the patch operation to the openwrt.mk file.</p></blockquote></div><p>This is exactly the purpose of the ./sources/openwrt/kernel/patches directory. All files in it are patches against the linux kernel sources and are applied successively (hence the number in their names) after the kernel has been unpacked but before it is configured (look at openwrt.mk for details).</p><p>You should provide a diff in unified format and verify that it can be applied without conflicts.</p><p>--<br />Nico</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p1873">
				<div class="post-metadata">
					<div class="post-num">Post #38</div>
					<div class="post-author">LetoAms</div>
					<div class="post-datetime">
						30 Aug 2004, 09:00					</div>
				</div>
				<div class="post-content content">
					<p>Nico,</p><p>The patch has been generated with diff -u. This can be seen in the &quot;nattpatch&quot; make target of openswan-2/Makefile, which uses openswan-2/packaging/utils/nattpatch</p><p>When I move the openswan patch into kernel/patches directory as you say,it works fine for me:</p><p>[...]<br />Applying /usr/local/openwrt/buildroot/sources/openwrt/kernel/patches/160-expr.patch using plaintext:<br />patching file Makefile</p><p>Applying /usr/local/openwrt/buildroot/sources/openwrt/kernel/patches/170-ip6tables-alignment.patch using plaintext:<br />patching file net/ipv6/netfilter/ip6_tables.c<br />Hunk #1 succeeded at 95 (offset -3 lines).<br />Hunk #2 succeeded at 1427 (offset 4 lines).</p><p>Applying /usr/local/openwrt/buildroot/sources/openwrt/kernel/patches/180-openswan-natt.patch using plaintext:<br />patching file include/net/sock.h<br />Hunk #1 succeeded at 249 (offset 4 lines).<br />Hunk #2 succeeded at 593 with fuzz 1 (offset 3 lines).<br />patching file net/Config.in<br />Hunk #1 succeeded at 106 (offset 18 lines).<br />patching file net/ipv4/udp.c</p><p>Applying /usr/local/openwrt/buildroot/sources/openwrt/kernel/patches/CVS using plaintext:<br />cat: /usr/local/openwrt/buildroot/sources/openwrt/kernel/patches/CVS: Is a directory<br /># use replacement diag module code<br />cp -f /usr/local/openwrt/buildroot/sources/openwrt/kernel/diag.c /usr/local/openwrt/buildroot/build_mipsel/WRT54GS/release/src/linux/linux/drivers/net/diag/diag_led.c<br />cp -f /usr/local/openwrt/buildroot/sources/openwrt/kernel/linux.config /usr/local/openwrt/buildroot/build_mipsel/WRT54GS/release/src/linux/linux/.config<br />(cd /usr/local/openwrt/buildroot/build_mipsel; ln -sf /usr/local/openwrt/buildroot/build_mipsel/WRT54GS/release/src/linux/linux linux)<br />(cd /usr/local/openwrt/buildroot/build_mipsel/WRT54GS/release/src/linux/linux/arch/mips/brcm-boards/bcm947xx/; <br />rm -rf compressed; <br />tar jxvf /usr/local/openwrt/buildroot/sources/openwrt/kernel/compressed-20040531.tar.bz2; <br />)<br />[...]</p><p>The only thing that also needs to happen is that NAT-T needs to be enabled in the .config file, so in this case, ./sources/openwrt/kernel/linux.config needs an extra line saying:</p><p>CONFIG_IPSEC_NAT_TRAVERSAL=y</p><p>Should I make a patch against linux.config? If so, it should be a seperate patch from the natt-patch. Or do you want a patch against openwrt that patches in both the new patch file and fixes that line in linux.config?</p><p>Also, what confused me was the existence of both<br />./sources/openwrt/kernel/patches</p><p>and </p><p>./sources/kernel-patches</p><p>I guess the latter is obsolete and should probably be removed.</p><p>Also, to avoid those errors above about trying to patch CVS, you might want to change:</p><p>$(SOURCE_DIR)/patch-kernel.sh $(LINUX_DIR) $(SOURCE_DIR)/openwrt/kernel/patches</p><p>to:</p><p>$(SOURCE_DIR)/patch-kernel.sh $(LINUX_DIR) $(SOURCE_DIR)/openwrt/kernel/patches/*patch</p><p>in source/make/openwrt.mk</p><p>Paul</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p1874">
				<div class="post-metadata">
					<div class="post-num">Post #39</div>
					<div class="post-author">Nico</div>
					<div class="post-datetime">
						30 Aug 2004, 09:49					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><blockquote><p>The only thing that also needs to happen is that NAT-T needs to be enabled in the .config file, so in this case, ./sources/openwrt/kernel/linux.config needs an extra line saying:</p><p>CONFIG_IPSEC_NAT_TRAVERSAL=y</p><p>Should I make a patch against linux.config? If so, it should be a seperate patch from the natt-patch. Or do you want a patch against openwrt that patches in both the new patch file and fixes that line in linux.config?</p></blockquote></div><p>I guess you should provide a patch against the latest CVS buildroot that will add the patch and fix the kernel config too...</p><div class="quotebox"><blockquote><p>Also, what confused me was the existence of both<br />./sources/openwrt/kernel/patches</p><p>and</p><p>./sources/kernel-patches</p><p>I guess the latter is obsolete and should probably be removed.</p></blockquote></div><p>The later is empty and should be pruned when checking out</p><p>--<br />Nico</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p1875">
				<div class="post-metadata">
					<div class="post-num">Post #40</div>
					<div class="post-author">Nico</div>
					<div class="post-datetime">
						30 Aug 2004, 09:53					</div>
				</div>
				<div class="post-content content">
					<p><a href="http://www.ba.cnr.it/~paolo/pmacct/">pmacct</a> v0.7.2p1</p><p>will provide the following packages:<strong> Â· </strong> pmacctd: IP accounting daemon<br /><strong> Â· </strong> nfacctd: NetFlow accounting daemon</p><p>they were not tested at all, any feedback is welcome</p><p>--<br />Nico</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p1876">
				<div class="post-metadata">
					<div class="post-num">Post #41</div>
					<div class="post-author">LetoAms</div>
					<div class="post-datetime">
						30 Aug 2004, 12:37					</div>
				</div>
				<div class="post-content content">
					<p>Hi Nico,</p><p>thanks for your answer. A single new patch against openwrt cvs from today has been added to this post.<br />It adds NAT-traversal support, as needed for Openswan.<br />It adds the kernel patch file and the option to linux.config.</p><p>It does not change the busybox configuration, which is another thing that is needed for Openswan to function correctly, since that is a slightly different topic, and I was not sure if adding the 4 or 5 binaries from busybox would otherwise might this patch rejected.</p><p>I will post a new posting with the busybox information.</p><p>Regards,</p><p>Paul</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p1877">
				<div class="post-metadata">
					<div class="post-num">Post #42</div>
					<div class="post-author">sateh</div>
					<div class="post-datetime">
						30 Aug 2004, 13:37					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><blockquote><p>Hi Nico,</p><p>thanks for your answer. A single new patch against openwrt cvs from today has been added to this post.<br />It adds NAT-traversal support, as needed for Openswan.<br />It adds the kernel patch file and the option to linux.config.</p><p>It does not change the busybox configuration, which is another thing that is needed for Openswan to function correctly, since that is a slightly different topic, and I was not sure if adding the 4 or 5 binaries from busybox would otherwise might this patch rejected.</p><p>I will post a new posting with the busybox information.</p><p>Regards,</p><p>Paul</p></blockquote></div><p>Ah great! This patch add the one thing that was missing in IPsec, compatibility with setups where your IPsec endpoint is behind NAT.</p><p>I succesfully applied the patch on my last openwrt checkout and it works fine, hope to see this in the regular distribution soon <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p> Stefan</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p1926">
				<div class="post-metadata">
					<div class="post-num">Post #43</div>
					<div class="post-author">twolife</div>
					<div class="post-datetime">
						3 Sep 2004, 21:37					</div>
				</div>
				<div class="post-content content">
					<p>bwm 1.1.0</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p1932">
				<div class="post-metadata">
					<div class="post-num">Post #44</div>
					<div class="post-author">Tornado</div>
					<div class="post-datetime">
						4 Sep 2004, 10:24					</div>
				</div>
				<div class="post-content content">
					<p>netstat-nat v1.4.3</p><p>A tool for displaying NAT connections</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p2446">
				<div class="post-metadata">
					<div class="post-num">Post #45</div>
					<div class="post-author">Nico</div>
					<div class="post-datetime">
						6 Oct 2004, 02:07					</div>
				</div>
				<div class="post-content content">
					<p>Hi all,</p><p>back with the patches <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /> </p><p>theese ones will add <a href="http://l7-filter.sourceforge.net/">Application Layer Packet Classifier</a> support to Netfilter (kernel and iptables).</p><p>It received minimal testing: I was able to classify http traffic -- great</p><p>The iptables patch is not currently integrated in the build process, mainly because its extensions are embedded in the firware, so you&#039;ll have to wait for a modular iptables package or build your own...</p><p>--<br />Nico</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p2916">
				<div class="post-metadata">
					<div class="post-num">Post #46</div>
					<div class="post-author">neil</div>
					<div class="post-datetime">
						9 Nov 2004, 07:10					</div>
				</div>
				<div class="post-content content">
					<p>Patch to build pciutils-2.1.11 under buildroot when &quot;pciutils&quot; is an optionally included build target in openwrt.mk.</p><p>This is my first patch submission. I hope I&#039;m close to following the right process. Feedback appreciated.</p><p>What happens next, how do patches transition into CVS?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p3028">
				<div class="post-metadata">
					<div class="post-num">Post #47</div>
					<div class="post-author">thyeh</div>
					<div class="post-datetime">
						18 Nov 2004, 13:10					</div>
				</div>
				<div class="post-content content">
					<p>IMQ from <a href="http://www.linuximq.net">http://www.linuximq.net</a>/</p><p>It is modified from iptables-1.2.9-imq1.diff and linux-2.4.26-imq.diff.</p><p>Worked for me for more than a week. <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p3043">
				<div class="post-metadata">
					<div class="post-num">Post #48</div>
					<div class="post-author">Genoa</div>
					<div class="post-datetime">
						20 Nov 2004, 22:57					</div>
				</div>
				<div class="post-content content">
					<p>Hi all,<br />This is little patch to activate failsafe mode with buffalo wbr-g54 hardware.</p><p>Genoa</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 2 of 2</div><nav><ul><li><a href="viewtopic.php%3Fid=368&amp;p=1.html">1</a></li><li class="pagination-current"><span>2</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>