<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Kernel 2.6 poor usb performance?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 18 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p67022">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">madwolf</div>
					<div class="post-datetime">
						17 Apr 2008, 07:58					</div>
				</div>
				<div class="post-content content">
					<p>Hi,<br />I use asus wl-500gp and recently I&#039;ve changed the wifi to Atheros to make transfers to my usb hdd stable (wl500gp freezes with the original broadcom). I&#039;ve compiled kamikaze trunk 2.6, all went well, but the transfers through samba/ftp are at about 1.3-1.5megabyte/sec while on 2.4 with broadcom I had stable 2.2megabyte/sec (until it froze after few hundred megabytes).<br />I thought that newer kernel/newer code would have comparable or better performance than the old one? or am I doing something wrong?</p><p>Right now I&#039;m compiling 2.4 with madwifi to test it...</p>											<p class="post-edited">(Last edited by <strong>madwolf</strong> on 17 Apr 2008, 07:59)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p67036">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">loodp</div>
					<div class="post-datetime">
						17 Apr 2008, 13:18					</div>
				</div>
				<div class="post-content content">
					<p>on my NFS server (wl500gP, kamikaze 7.09 2.4), i&#039;m getting about 6-10 MB/sec when writing (drops to about 1MB/sec after 100MB), and around 1-2MB/sec when reading. haven&#039;t tried samba yet.</p><p>have you tried adding swap space to improve disc performance? i have, but it didn&#039;t change anything (as documented here in this thread that nobody replies to: <a href="http://forum.openwrt.org/viewtopic.php?id=15307)">http://forum.openwrt.org/viewtopic.php?id=15307)</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p67041">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">madwolf</div>
					<div class="post-datetime">
						17 Apr 2008, 17:00					</div>
				</div>
				<div class="post-content content">
					<p>I think that those are the limits of the processor so swap doesn&#039;t do any difference. 2.4 is much better than 2.6.<br />Now I have 2.2-2.3megabytes/sec over wifi.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p67052">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">loodp</div>
					<div class="post-datetime">
						17 Apr 2008, 21:07					</div>
				</div>
				<div class="post-content content">
					<p>so 2.6 is even worse in this regard?</p><p>i don&#039;t know about the processor -- system load doesn&#039;t go beyond 0.60 during those transfers. but RAM is filled up almost instantly. i think that&#039;s why getting a swap partition is recommended for improving through-put so often.</p><p>i&#039;ve seen a tutorial over at oleg&#039;s forum on how to solder more ram (up to 128MB) right onto the board -- maybe that&#039;s the way to go if swap isn&#039;t working..</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p67053">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">forum2008</div>
					<div class="post-datetime">
						17 Apr 2008, 21:09					</div>
				</div>
				<div class="post-content content">
					<p>Buy a better router...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p67057">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">madwolf</div>
					<div class="post-datetime">
						17 Apr 2008, 22:18					</div>
				</div>
				<div class="post-content content">
					<p>Hm, I&#039;ve got 100% load on the processor while transferring with speed over 2megabytes/sec.</p><p>forum2008:<br />yep. that&#039;s the simplest solution :-) If I had known what problems will I have with this I would buy some pico/nano itx board with 1ghz processor for not much more money... but since I&#039;ve got wl-500gp I&#039;m trying to make the most of it :-)<br />Actually I&#039;m looking right now at mini itx (17cmx17cm) with 800mhz proc, pci, 4xusb, wifi, lan, ide controller etc. for less than 100euros</p>											<p class="post-edited">(Last edited by <strong>madwolf</strong> on 17 Apr 2008, 22:23)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p67058">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">loodp</div>
					<div class="post-datetime">
						17 Apr 2008, 22:35					</div>
				</div>
				<div class="post-content content">
					<p>as for the 60% max load, i was talking transfers on NFS -- can&#039;t tell what samba would have looked like.</p><p>any comments on the swap issue, forum2008?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p67091">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">madwolf</div>
					<div class="post-datetime">
						18 Apr 2008, 14:42					</div>
				</div>
				<div class="post-content content">
					<p>root@R-Net:/# free<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; total&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;used&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;free&nbsp; &nbsp; &nbsp; &nbsp;shared&nbsp; &nbsp; &nbsp; buffers<br />&nbsp; Mem:&nbsp; &nbsp; &nbsp; &nbsp; 30504&nbsp; &nbsp; &nbsp; &nbsp; 22592&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;7912&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1704<br /> Swap:&nbsp; &nbsp; &nbsp; &nbsp;248996&nbsp; &nbsp; &nbsp; &nbsp; 11740&nbsp; &nbsp; &nbsp; &nbsp;237256<br />Total:&nbsp; &nbsp; &nbsp; &nbsp;279500&nbsp; &nbsp; &nbsp; &nbsp; 34332&nbsp; &nbsp; &nbsp; &nbsp;245168</p><p>Looks like swap is working for me, over 11 megabytes in swap. However, I&#039;ve got postgresql server running, lighttpd + php5, samba, pure-ftpd so they take up some memory. With samba alone swap is neraly not used at all, probably samba just doesn&#039;t need more memory. Heavy swap usage started when I&#039;ve installed the postgresql server.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p67092">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">forum2008</div>
					<div class="post-datetime">
						18 Apr 2008, 14:44					</div>
				</div>
				<div class="post-content content">
					<p>Do you make use of /etc/config/fstab to configure swap?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p67093">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">madwolf</div>
					<div class="post-datetime">
						18 Apr 2008, 14:57					</div>
				</div>
				<div class="post-content content">
					<p>should I? I made a script in /etc/init.d which mounts my partitions and does swapon</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p67094">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">forum2008</div>
					<div class="post-datetime">
						18 Apr 2008, 14:58					</div>
				</div>
				<div class="post-content content">
					<p>Yes, you should.</p><p>There is already a init script (/etc/init.d/fstab) which reads /etc/config/fstab <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p67095">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">madwolf</div>
					<div class="post-datetime">
						18 Apr 2008, 15:07					</div>
				</div>
				<div class="post-content content">
					<p>Ah, I see. Well, it works both ways :-)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p67096">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">forum2008</div>
					<div class="post-datetime">
						18 Apr 2008, 15:12					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>madwolf wrote:</cite><blockquote><p>Ah, I see. Well, it works both ways :-)</p></blockquote></div><p>Yes, but</p><p>1. /etc/config/fstab and /etc/init.d/fstab is the official way<br />2. you don&#039;t have to reinvent the wheel over and over again</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p67097">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">loodp</div>
					<div class="post-datetime">
						18 Apr 2008, 16:10					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><blockquote><p>root@R-Net:/# free<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; total&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;used&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;free&nbsp; &nbsp; &nbsp; &nbsp;shared&nbsp; &nbsp; &nbsp; buffers<br />&nbsp; Mem:&nbsp; &nbsp; &nbsp; &nbsp; 30504&nbsp; &nbsp; &nbsp; &nbsp; 22592&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;7912&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1704<br />Swap:&nbsp; &nbsp; &nbsp; &nbsp;248996&nbsp; &nbsp; &nbsp; &nbsp; 11740&nbsp; &nbsp; &nbsp; &nbsp;237256<br />Total:&nbsp; &nbsp; &nbsp; &nbsp;279500&nbsp; &nbsp; &nbsp; &nbsp; 34332&nbsp; &nbsp; &nbsp; &nbsp;245168</p><p>Looks like swap is working for me, over 11 megabytes in swap. However, I&#039;ve got postgresql server running, lighttpd + php5, samba, pure-ftpd so they take up some memory. With samba alone swap is neraly not used at all, probably samba just doesn&#039;t need more memory. Heavy swap usage started when I&#039;ve installed the postgresql server.</p></blockquote></div><p>have you looked at memory/swap usage while you&#039;re actually transferring files to USB with samba? on my box with nfs, i noticed that after i started a transfer, RAM usage quickly went up from around 50% to 99% (which seemed to be the point where transfer rates dropped), but swap usage only went from 0 to 36kb.</p><div class="quotebox"><blockquote><p>1. /etc/config/fstab and /etc/init.d/fstab is the official way</p></blockquote></div><p>/etc/config/fstab isn&#039;t recognized here, but /etc/fstab works (for manually mounting).</p><p>what does /etc/init.d/fstab have to look like to have the stuff mounted on startup? my /etc/fstab looks like this:</p><br /><div class="quotebox"><blockquote><p>/dev/discs/disc0/part1&nbsp; /mnt&nbsp; &nbsp; ext3&nbsp; &nbsp; defaults&nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp;0</p><p>/dev/discs/disc0/part2&nbsp; none&nbsp; &nbsp; swap&nbsp; &nbsp; sw&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp;0</p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p69404">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">youth4ever</div>
					<div class="post-datetime">
						10 Jun 2008, 16:27					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>madwolf wrote:</cite><blockquote><p>root@R-Net:/# free<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; total&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;used&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;free&nbsp; &nbsp; &nbsp; &nbsp;shared&nbsp; &nbsp; &nbsp; buffers<br />&nbsp; Mem:&nbsp; &nbsp; &nbsp; &nbsp; 30504&nbsp; &nbsp; &nbsp; &nbsp; 22592&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;7912&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1704<br /> Swap:&nbsp; &nbsp; &nbsp; &nbsp;248996&nbsp; &nbsp; &nbsp; &nbsp; 11740&nbsp; &nbsp; &nbsp; &nbsp;237256<br />Total:&nbsp; &nbsp; &nbsp; &nbsp;279500&nbsp; &nbsp; &nbsp; &nbsp; 34332&nbsp; &nbsp; &nbsp; &nbsp;245168</p><p>Looks like swap is working for me, over 11 megabytes in swap. However, I&#039;ve got postgresql server running, lighttpd + php5, samba, pure-ftpd so they take up some memory. With samba alone swap is neraly not used at all, probably samba just doesn&#039;t need more memory. Heavy swap usage started when I&#039;ve installed the postgresql server.</p></blockquote></div><p>Yes. You have right. Database daemon take lots of space memory.<br />You say that PostresSQL is running fine. There is also MySQL for openwrt? I prefer MySQL because I have some php application which require mysql and I want to put on the router and I didn&#039;t found anywhere in the packages.</p><p>Thank you.</p>											<p class="post-edited">(Last edited by <strong>youth4ever</strong> on 10 Jun 2008, 19:53)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>