<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Broken WAN port after storm, how to change LAN port into WAN</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 28 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p314820">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">mogyi23</div>
					<div class="post-datetime">
						14 Mar 2016, 23:57					</div>
				</div>
				<div class="post-content content">
					<p>Hi all</p><p>Please help me. Dont know what need i do if my wan port is broken.<br />I installed openwrt<br />What need i change?</p><p>thanks who help me</p>											<p class="post-edited">(Last edited by <strong>mogyi23</strong> on 15 Mar 2016, 00:49)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p314823">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">mogyi23</div>
					<div class="post-datetime">
						15 Mar 2016, 00:11					</div>
				</div>
				<div class="post-content content">
					<p>config interface &#039;loopback&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname &#039;lo&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;static&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr &#039;127.0.0.1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask &#039;255.0.0.0&#039;</p><p>config globals &#039;globals&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ula_prefix &#039;fd21:da5e:ace3::/48&#039;</p><p>config interface &#039;lan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname &#039;eth0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option force_link &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option type &#039;bridge&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;static&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask &#039;255.255.255.0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ip6assign &#039;60&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr &#039;192.168.2.1&#039;</p><p>config interface &#039;wan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname &#039;eth1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;dhcp&#039;</p><p>config interface &#039;wan6&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname &#039;eth1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;dhcpv6&#039;</p><p>config switch<br />&nbsp; &nbsp; &nbsp; &nbsp; option name &#039;switch0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option reset &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option enable_vlan &#039;1&#039;</p><p>config switch_vlan<br />&nbsp; &nbsp; &nbsp; &nbsp; option device &#039;switch0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option vlan &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option vid &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ports &#039;0 1 2 3 4&#039;</p><p>~<br />~<br />~<br />~<br />- /etc/config/network 1/38 2%</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p314825">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">adam2104</div>
					<div class="post-datetime">
						15 Mar 2016, 00:39					</div>
				</div>
				<div class="post-content content">
					<p>What router do you have?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p314828">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">mogyi23</div>
					<div class="post-datetime">
						15 Mar 2016, 00:48					</div>
				</div>
				<div class="post-content content">
					<p>tp-link tl-wr841n</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p314835">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">makro</div>
					<div class="post-datetime">
						15 Mar 2016, 01:20					</div>
				</div>
				<div class="post-content content">
					<p>Warning: Learn how to get into failsafe first, because if something goes wrong you might not be able to connect to your device until you fix the configuration. Read general information about failsafe at <a href="https://wiki.openwrt.org/doc/howto/generic.failsafe">doc/howto/generic.failsafe</a> and specific information for your device at <a href="https://wiki.openwrt.org/toh/tp-link/tl-wr841nd#failsafe_mode">toh/tp-link/tl-wr841nd#failsafe_mode</a>.</p><div class="quotebox"><cite>mogyi23 wrote:</cite><blockquote><p>config switch_vlan<br />&nbsp; &nbsp; &nbsp; &nbsp; option device &#039;switch0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option vlan &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option vid &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ports &#039;0 1 2 3 4&#039;</p></blockquote></div><p>Change the option ports line in this section to:<br /></p><div class="codebox"><pre><code>option ports &#039;0t 1 2 3&#039;</code></pre></div><p>Add a second VLAN section using port 4:<br /></p><div class="codebox"><pre><code>config switch_vlan
        option device &#039;switch0&#039;
        option vlan &#039;4&#039;
        option vid &#039;4&#039;
        option ports &#039;0t 4&#039;</code></pre></div><p>Change the WAN interface to use the new VLAN:<br /></p><div class="codebox"><pre><code>config interface &#039;wan&#039;
        ...
        option ifname &#039;eth0.4&#039;
        ...</code></pre></div><p>Change the LAN interface to use the VLAN interface:<br /></p><div class="codebox"><pre><code>config interface &#039;lan&#039;
        ...
        option ifname &#039;eth0.1&#039;
        ...</code></pre></div><p>Now, port 4 should work like a WAN port (you&#039;ll need to run /etc/init.d/network restart, or just reboot the router). Beware though, the logical port 4 (configured in the software) might not be labeled port 4 on the case. Apparently your device can have a number of different mappings, see <a href="https://wiki.openwrt.org/toh/tp-link/tl-wr841nd#switch_configuration">toh/tp-link/tl-wr841nd#switch_configuration</a> for some hints. If you&#039;re unsure, find a port that works as LAN, log in, and try connecting WAN to the other ports and see which one works.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p314867">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">mogyi23</div>
					<div class="post-datetime">
						15 Mar 2016, 07:57					</div>
				</div>
				<div class="post-content content">
					<p>config interface &#039;loopback&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname &#039;lo&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;static&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr &#039;127.0.0.1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask &#039;255.0.0.0&#039;</p><p>config globals &#039;globals&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ula_prefix &#039;fd21:da5e:ace3::/48&#039;</p><p>config interface &#039;lan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname &#039;eth0.1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option force_link &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option type &#039;bridge&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;static&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask &#039;255.255.255.0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ip6assign &#039;60&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr &#039;192.168.2.1&#039;</p><p>config interface &#039;wan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname &#039;eth0.4&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;dhcp&#039;</p><p>config interface &#039;wan6&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname &#039;eth1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;dhcpv6&#039;</p><p>config switch<br />&nbsp; &nbsp; &nbsp; &nbsp; option name &#039;switch0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option reset &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option enable_vlan &#039;1&#039;</p><p>config switch_vlan<br />&nbsp; &nbsp; &nbsp; &nbsp; option device &#039;switch0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option vlan &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option vid &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ports &#039;0t 1 2 3&#039;</p><p>config switch_vlan<br />&nbsp; &nbsp; &nbsp; &nbsp; option device &#039;switch0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option vlan &#039;4&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option vid &#039;4&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ports &#039;0t 4&#039;</p><p>Thanks a lot! Port 4 is the wan. i write all right?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p314869">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">dktn</div>
					<div class="post-datetime">
						15 Mar 2016, 08:35					</div>
				</div>
				<div class="post-content content">
					<p>I think<br />config interface &#039;wan6&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname &#039;eth1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;dhcpv6&#039;<br />should be</p><p>config interface &#039;wan6&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname &#039;<strong>eth0.4&#039;</strong><br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;dhcpv6&#039;<br />or delete all.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p314870">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">makro</div>
					<div class="post-datetime">
						15 Mar 2016, 08:35					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>mogyi23 wrote:</cite><blockquote><p>Thanks a lot! Port 4 is the wan. i write all right?</p></blockquote></div><p>Yes, it looks like you made the correct changes. I missed one section:<br /></p><div class="codebox"><pre><code>config interface &#039;wan6&#039;
        option ifname &#039;eth1&#039;
        option proto &#039;dhcpv6&#039;</code></pre></div><p>ifname here should also be eth0.4, like the interface &#039;wan&#039; section. If your ISP doesn&#039;t support IPv6 this doesn&#039;t matter, but you might want to change it so it works when your ISP enables IPv6 support.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p314871">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">mogyi23</div>
					<div class="post-datetime">
						15 Mar 2016, 08:37					</div>
				</div>
				<div class="post-content content">
					<p>thanks a lot</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p314987">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">mogyi23</div>
					<div class="post-datetime">
						15 Mar 2016, 19:26					</div>
				</div>
				<div class="post-content content">
					<p>i done the network modifie<br />put the utp cabel and have no link <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /><br />whats the problem? dont know...</p><p>sorry my abd english <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><p><span class="postimg"><img src="http://kepfeltoltes.hu/160315/01_www.kepfeltoltes.hu_.png" alt="http://kepfeltoltes.hu/160315/01_www.kepfeltoltes.hu_.png" /></span></p><p><span class="postimg"><img src="http://kepfeltoltes.hu/160315/02_www.kepfeltoltes.hu_.png" alt="http://kepfeltoltes.hu/160315/02_www.kepfeltoltes.hu_.png" /></span></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p315001">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">mogyi23</div>
					<div class="post-datetime">
						15 Mar 2016, 20:10					</div>
				</div>
				<div class="post-content content">
					<p>If i put the utp cabel to port 1 than on the second picture i have link on port4 and the first picture same</p><p><strong><span style="color: red">Fine i try it and working but the wan port is now port1!!!<br />Thanks a lot</span></strong></p>											<p class="post-edited">(Last edited by <strong>mogyi23</strong> on 15 Mar 2016, 20:25)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p315060">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">dktn</div>
					<div class="post-datetime">
						16 Mar 2016, 06:12					</div>
				</div>
				<div class="post-content content">
					<p>Port showed on luci that did not match as number port you set.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>