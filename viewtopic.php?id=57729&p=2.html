<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> SQM Throttling Speeds To Much</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 10 Apr 2018 and 19 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 2 of 2</div><nav><ul><li><a href="viewtopic.php%3Fid=57729&amp;p=1.html">1</a></li><li class="pagination-current"><span>2</span></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p281840">
				<div class="post-metadata">
					<div class="post-num">Post #26</div>
					<div class="post-author">Panny P</div>
					<div class="post-datetime">
						30 Jun 2015, 03:49					</div>
				</div>
				<div class="post-content content">
					<p>Damn, I was worried about what you might say after those tests. But oh well.</p><p>As far as the MTU value tests, I am not sure what to make of it. anything 1473 and above state that they need to be fragmented, but anything 1472 and lower and the requests get timed out.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p282890">
				<div class="post-metadata">
					<div class="post-num">Post #27</div>
					<div class="post-author">Panny P</div>
					<div class="post-datetime">
						9 Jul 2015, 06:34					</div>
				</div>
				<div class="post-content content">
					<p>I noticed there hasn&#039;t been a reply in a while and was wondering if there is anything that the MTU value could be affecting. Or if there is anything else I could possibly try.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p282910">
				<div class="post-metadata">
					<div class="post-num">Post #28</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						9 Jul 2015, 10:52					</div>
				</div>
				<div class="post-content content">
					<p>Hi Panny P,</p><div class="quotebox"><cite>Panny P wrote:</cite><blockquote><p>I noticed there hasn&#039;t been a reply in a while and was wondering if there is anything that the MTU value could be affecting. Or if there is anything else I could possibly try.</p></blockquote></div><p>If the MTU would have been set to a too large value your router might have been forced to fragment some packets, thereby taking up more air-time/bandwidth than sqm would assume; and that in turn could have explained the lower bandwidth to some degree and the fact that you need to reduce the shaper bandwidths quite a lot. Unfortunately this should also affect the performance without SQM which seems to be consistently better (bandwidth wise, latency-wise the no-SQM configuration is an unmitigated disaster on your link...). But an ICMP header is 8 Byte, the preceding IP header is 20 Bytes and you see fragmentation for MTUs &gt;1472; since 1472 + 20 + 8 = 1500 it looks like this is not the issue (unless your ISP would do fragmentation defragmentation along its PPPoE connection silently and transparently, which is highly unlikely but could be the result of a badly configured firewall). You could try to clamp the MTU on your router to 1472 to see whether this changes the lost bandwidth you see; this is a long shot though.<br />&nbsp; &nbsp; &nbsp; &nbsp; I am officially out of ideas to test, and fear you will have to decide between full bandwidth with abysmal latency under load behavior or a much snappier link bought for a noticeable bandwidth sacrifice.</p><br /><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p282992">
				<div class="post-metadata">
					<div class="post-num">Post #29</div>
					<div class="post-author">Panny P</div>
					<div class="post-datetime">
						10 Jul 2015, 01:50					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ll probably just try to get my hands on another router and maybe try different firmware. Also annoy the hell out of my ISP in the meantime.</p><p>Might as well say thank you for all the help. It may have been unable to yield a solution, but I learned a fair share.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p293310">
				<div class="post-metadata">
					<div class="post-num">Post #30</div>
					<div class="post-author">richbhanover</div>
					<div class="post-datetime">
						24 Sep 2015, 17:55					</div>
				</div>
				<div class="post-content content">
					<p>@Panny P - Any news on this? Did you try a new router? I would be interested to hear what the current state of play is:</p><p>- What&#039;s your ISP? Cable? DSL? Other?<br />- What router have you tried?<br />- What firmware are you using?<br />- What results do you see from <a href="http://www.dslreports.com/speedtest">www.dslreports.com/speedtest</a> before and after SQM QoS?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p293362">
				<div class="post-metadata">
					<div class="post-num">Post #31</div>
					<div class="post-author">Panny P</div>
					<div class="post-datetime">
						25 Sep 2015, 00:38					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for replying,</p><p>the story so far. I think my ISP has upgraded the tower to support the village&#039;s bandwidth. Since my speeds are a lot more constant. But can&#039;t say for sure since they never got back to me about it. And they said the internet would go out for a while which it never did.</p><p>to answer your questions:</p><p>1. My ISP is Wisper, which is WISP type.</p><p>2. I currently use the NETGEAR WNDR4300. And have tried the Asus N 600 Router (RT-N56U). Even with different routers the same problem occured.</p><p>3. I use the OpenWrt Barrier Breaker 14.07 / LuCI Trunk (0.12+svn-r10530)&nbsp; firmware. And have used DDRT on the Asus one. Same problems.</p><p>4. Here are the results as of now. Which honestly seem very good.&nbsp; <br />Without QoS: <a href="http://www.dslreports.com/speedtest/1446963">http://www.dslreports.com/speedtest/1446963</a><br />With QoS: <a href="http://www.dslreports.com/speedtest/1447073">http://www.dslreports.com/speedtest/1447073</a></p><p>To be honest, I am not sure what to say. Last night when I e-mailed you the problem was occurring. Turned off SQM and whilst the ping was atrocious, the speeds were mostly fine.&nbsp; When the family was on netflix my ping was terrible. Now it seems to be working perfectly for the first time ever; Ping is good even on netflix and the speeds are being throttled properly for once. I&#039;ll keep doing DSL tests and try to catch QoS not working.</p><p>UPDATE: It seems to be doing it again. But this time not as severe. I have down throttled to 13.5 mbs and up to 2.5 mbs. It isn&#039;t as bad, but it is still 2-3 mbs off the mark.</p><p>QoS off: <a href="http://www.dslreports.com/speedtest/1449934">http://www.dslreports.com/speedtest/1449934</a></p><p>QoS on: <a href="http://www.dslreports.com/speedtest/1449912">http://www.dslreports.com/speedtest/1449912</a></p>											<p class="post-edited">(Last edited by <strong>Panny</strong> on 25 Sep 2015, 07:56)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p293380">
				<div class="post-metadata">
					<div class="post-num">Post #32</div>
					<div class="post-author">richbhanover</div>
					<div class="post-datetime">
						25 Sep 2015, 06:10					</div>
				</div>
				<div class="post-content content">
					<p>This is quite confusing: it seems related to time of day. </p><p>- Last night, it seemed bad. </p><p>- This afternoon (~4:00pm local time) your speeds seemed fine: 12.19/12.43 down (faster with fq_codel (!)), and 2.91/2.17 upload (~75% of max) without/with SQM QoS </p><p>- This evening (8:50pm) speeds were 13.93/10.93 down (79% of max) and 2.92/1.83 (63% of max)</p><p>What&#039;s weird is that these things don&#039;t seem to correlate well. Tonight&#039;s download without SQM is *faster* than the afternoon&#039;s download. Upload is about the same without SQM. But turning on SQM makes really makes things terrible. </p><p>If you wanted to spend more time with this (and if you were comfortable in the command line), I might encourage you to use the betterspeedtest.sh script of OpenWrtScripts <a href="https://github.com/richb-hanover/OpenWrtScripts">https://github.com/richb-hanover/OpenWrtScripts</a> You can use git to retrieve the files (as described in the github page) or simply curl this file from <a href="https://github.com/richb-hanover/OpenWrtScripts/archive/master.zip">https://github.com/richb-hanover/OpenWr â€¦ master.zip</a></p><p>I would be tempted to run the script for 60 (or even 120) seconds to see if there was any difference. To do this, get the files onto your router, then enter:</p><p>sh betterspeedtest.sh -t 60</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p293840">
				<div class="post-metadata">
					<div class="post-num">Post #33</div>
					<div class="post-author">Panny P</div>
					<div class="post-datetime">
						28 Sep 2015, 23:53					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>richbhanover wrote:</cite><blockquote><p>This is quite confusing: it seems related to time of day. </p><p>- Last night, it seemed bad. </p><p>- This afternoon (~4:00pm local time) your speeds seemed fine: 12.19/12.43 down (faster with fq_codel (!)), and 2.91/2.17 upload (~75% of max) without/with SQM QoS </p><p>- This evening (8:50pm) speeds were 13.93/10.93 down (79% of max) and 2.92/1.83 (63% of max)</p></blockquote></div><p>Going to have to debunk that theory. Here are my recent DSL speedtests at roughly 3:45 PM.</p><p>SQM ON</p><p><a href="http://www.dslreports.com/speedtest/1486682">http://www.dslreports.com/speedtest/1486682</a></p><p>SQM OFF</p><p><a href="http://www.dslreports.com/speedtest/1486706">http://www.dslreports.com/speedtest/1486706</a></p><br /><p>Here is my SSH speedtests shortly after I did the DSL reports one. I ran it for 60 seconds each.</p><p>SQM ON</p><div class="codebox"><pre><code> Download:  10.36 Mbps
  Latency: (in msec, 61 pings, 0.00% packet loss)
      Min: 20.561
    10pct: 26.076
   Median: 39.848
      Avg: 43.148
    90pct: 57.999
      Max: 145.834
.............................................................
   Upload:  2.22 Mbps
  Latency: (in msec, 60 pings, 0.00% packet loss)
      Min: 21.329
    10pct: 23.704
   Median: 29.004
      Avg: 31.967
    90pct: 44.652
      Max: 55.054</code></pre></div><p>SQM OFF</p><div class="codebox"><pre><code> Download:  13.97 Mbps
  Latency: (in msec, 62 pings, 0.00% packet loss)
      Min: 58.055
    10pct: 624.170
   Median: 1024.593
      Avg: 964.624
    90pct: 1229.924
      Max: 1318.379
....................................................................
   Upload:  2.84 Mbps
  Latency: (in msec, 67 pings, 0.00% packet loss)
      Min: 24.169
    10pct: 244.431
   Median: 3904.348
      Avg: 3471.576
    90pct: 5368.247
      Max: 5757.428</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p293863">
				<div class="post-metadata">
					<div class="post-num">Post #34</div>
					<div class="post-author">richbhanover</div>
					<div class="post-datetime">
						29 Sep 2015, 03:01					</div>
				</div>
				<div class="post-content content">
					<p>I should have asked one more question... What are the download and upload speeds that you have set in the SQM QoS page when you saw those recent results?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p293865">
				<div class="post-metadata">
					<div class="post-num">Post #35</div>
					<div class="post-author">Panny P</div>
					<div class="post-datetime">
						29 Sep 2015, 03:07					</div>
				</div>
				<div class="post-content content">
					<p>Oh, I set the down to 13500 and up to 2500. I also have ethernet with overhead plus an eight packet overhead.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 2 of 2</div><nav><ul><li><a href="viewtopic.php%3Fid=57729&amp;p=1.html">1</a></li><li class="pagination-current"><span>2</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>