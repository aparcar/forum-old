<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> WRT1900 openwrt strange dns issue</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 8 Apr 2018 and 16 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 2</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=67757&amp;p=2.html">2</a></li></ul></nav></div>
			
		
		
			<article class="post" id="p339295">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">alirz</div>
					<div class="post-datetime">
						27 Sep 2016, 03:31					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>Im hoping someone can help solve a puzzling situation.<br />I use changeip.org as my DDNS provider. There is a script that runs on the wrt1900ac router (outside of the router gui etc, script is at the OS level of the router). This script is running fine. No issue with that.</p><p>I had to restore an old router backup for some reason and that has brought up a strange situation.</p><p>On the router if i do a nslookup on my ddns host name, the router returns an old WAN IP address that i used to have a year ago. This is when the router itself is set as the name server in /etc/resolve.conf.<br />If i change that nameserver to be google&#039;s dns then the nslookup returns my correct IP address as it is currently registered with my DDND provider.</p><p>So obviously somewhere in the router my old IP is stored in some file/cache etc. I&#039;ve done a find and grep on every single file in my router but i do no see that old IP.</p><p>Im 100% that its related to DNS on the router itself. im puzzled where this could be coming from.<br />Would really appreciate any tips.</p><p>Thanks</p>											<p class="post-edited">(Last edited by <strong>alirz</strong> on 27 Sep 2016, 03:33)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p339298">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">northbound</div>
					<div class="post-datetime">
						27 Sep 2016, 04:23					</div>
				</div>
				<div class="post-content content">
					<p>When I do a backup it only includes /etc Unless you did something different it should come from there.<br />Still looking but my setup is much simpler than yours.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p339299">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">alirz</div>
					<div class="post-datetime">
						27 Sep 2016, 04:30					</div>
				</div>
				<div class="post-content content">
					<p>Well yes I do backup a lot more files,folders. However I searched in ever file on the router and the old iP is no where.</p><p>Is there a way to trace nslookup lol ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p339300">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">northbound</div>
					<div class="post-datetime">
						27 Sep 2016, 04:33					</div>
				</div>
				<div class="post-content content">
					<p>You might try strace nslookup if strace is installed</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p339301">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">northbound</div>
					<div class="post-datetime">
						27 Sep 2016, 04:55					</div>
				</div>
				<div class="post-content content">
					<p>If you still have problems. I would try IRC all the gurus are there and active in the early morning. At least what is early morning to us. <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p339303">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">davidc502</div>
					<div class="post-datetime">
						27 Sep 2016, 05:03					</div>
				</div>
				<div class="post-content content">
					<p>@alirz</p><p>Are you running OpenWrt or LEDE?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p339309">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">nitroshift</div>
					<div class="post-datetime">
						27 Sep 2016, 07:34					</div>
				</div>
				<div class="post-content content">
					<p>@alirz</p><p>Why don&#039;t you use OpenWRT DDNS package?</p><p>nitroshift</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p339334">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">kirkgbr</div>
					<div class="post-datetime">
						27 Sep 2016, 14:37					</div>
				</div>
				<div class="post-content content">
					<p>Since the name resolves wrong when using the router as DNS, My first guess is it has something to do with dnsmasq.&nbsp; Although, I can&#039;t say for sure since it is one of the first things I turn off.&nbsp; You might try disabling it temporarily only to find out if that is what&#039;s causing the issue.&nbsp; &nbsp;However, I would not suggest leaving it disabled since it might provide you other services that you rely on.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p339393">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">alirz</div>
					<div class="post-datetime">
						27 Sep 2016, 22:43					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>davidc502 wrote:</cite><blockquote><p>@alirz</p><p>Are you running OpenWrt or LEDE?</p></blockquote></div><p>Openwrt</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p339394">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">alirz</div>
					<div class="post-datetime">
						27 Sep 2016, 22:44					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>nitroshift wrote:</cite><blockquote><p>@alirz</p><p>Why don&#039;t you use OpenWRT DDNS package?</p><p>nitroshift</p></blockquote></div><p>I could, but its the same script that the openwrt ddns package would run.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p339397">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">alirz</div>
					<div class="post-datetime">
						27 Sep 2016, 22:51					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>kirkgbr wrote:</cite><blockquote><p>Since the name resolves wrong when using the router as DNS, My first guess is it has something to do with dnsmasq.&nbsp; Although, I can&#039;t say for sure since it is one of the first things I turn off.&nbsp; You might try disabling it temporarily only to find out if that is what&#039;s causing the issue.&nbsp; &nbsp;However, I would not suggest leaving it disabled since it might provide you other services that you rely on.</p></blockquote></div><p>you are correct. The issue is indeed with DNS.</p><p>my first question...<br />* why does /etc/resolv get overwritten with &quot;nameserver 127.0.0.1&quot; when i restart dnsmasq ? I think that might be my problem.</p><p>/tmp/resolv.conf.auto contains my ISP DNS servers that the router pickups from the WAN.</p>											<p class="post-edited">(Last edited by <strong>alirz</strong> on 27 Sep 2016, 22:56)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p339398">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">sera</div>
					<div class="post-datetime">
						27 Sep 2016, 22:55					</div>
				</div>
				<div class="post-content content">
					<p>If resolv.conf has only local host listed who is listening on the dns queries, dnsmasq? What does /etc/config/dhcp respectively /etc/dnsmasq.conf say where to fetch IPs for a given name?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p339399">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">alirz</div>
					<div class="post-datetime">
						27 Sep 2016, 22:59					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>sera wrote:</cite><blockquote><p>If resolv.conf has only local host listed who is listening on the dns queries, dnsmasq? What does /etc/config/dhcp respectively /etc/dnsmasq.conf say where to fetch IPs for a given name?</p></blockquote></div><br /><p>**/etc/config/dhcp*&nbsp; below, that looks fine to me.<br /></p><div class="codebox"><pre><code>config dnsmasq
        option boguspriv &#039;1&#039;
        option localise_queries &#039;1&#039;
        option rebind_protection &#039;1&#039;
        option expandhosts &#039;1&#039;
        option readethers &#039;1&#039;
        option leasefile &#039;/tmp/dhcp.leases&#039;
        option authoritative &#039;1&#039;
        option nonwildcard &#039;0&#039;
        option domainneeded &#039;1&#039;
        option rebind_localhost &#039;1&#039;
        option localservice &#039;1&#039;
        option resolvfile &#039;/etc/resolv.conf&#039;</code></pre></div><br /><p>**/etc/dnsmaq.conf** I dont see any reference to a dns server in there</p><div class="codebox"><pre><code># Change the following lines if you want dnsmasq to serve SRV
# records.
# You may add multiple srv-host lines.
# The fields are &lt;name&gt;,&lt;target&gt;,&lt;port&gt;,&lt;priority&gt;,&lt;weight&gt;

# A SRV record sending LDAP for the example.com domain to
# ldapserver.example.com port 289
#srv-host=_ldap._tcp.example.com,ldapserver.example.com,389

# Two SRV records for LDAP, each with different priorities
#srv-host=_ldap._tcp.example.com,ldapserver.example.com,389,1
#srv-host=_ldap._tcp.example.com,ldapserver.example.com,389,2

# A SRV record indicating that there is no LDAP server for the domain
# example.com
#srv-host=_ldap._tcp.example.com

# The following line shows how to make dnsmasq serve an arbitrary PTR
# record. This is useful for DNS-SD.
# The fields are &lt;name&gt;,&lt;target&gt;
#ptr-record=_http._tcp.dns-sd-services,&quot;New Employee Page._http._tcp.dns-sd-services&quot;

# Change the following lines to enable dnsmasq to serve TXT records.
# These are used for things like SPF and zeroconf.
# The fields are &lt;name&gt;,&lt;text&gt;,&lt;text&gt;...

#Example SPF.
#txt-record=example.com,&quot;v=spf1 a -all&quot;

#Example zeroconf
#txt-record=_http._tcp.example.com,name=value,paper=A4

# Provide an alias for a &quot;local&quot; DNS name. Note that this _only_ works
# for targets which are names from DHCP or /etc/hosts. Give host
# &quot;bert&quot; another name, bertrand
# The fields are &lt;cname&gt;,&lt;target&gt;
#cname=bertand,bert


dhcp-option=252,&quot;\n&quot;

#addn-hosts = /mnt/sda1/scripts/hosts.block
addn-hosts = /etc/hosts.block</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p339400">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">alirz</div>
					<div class="post-datetime">
						27 Sep 2016, 23:06					</div>
				</div>
				<div class="post-content content">
					<p>I also notice that /etc/resolv.conf is symlink to /tmp/resolv.conf </p><p>Perhaps it should be symlinked to /tmp/resolv.conf.auto ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p339402">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">sera</div>
					<div class="post-datetime">
						27 Sep 2016, 23:23					</div>
				</div>
				<div class="post-content content">
					<div class="codebox"><pre><code>option resolvfile       &#039;/tmp/resolv.conf.auto&#039;</code></pre></div><p>would be the distribution default.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p339407">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">alirz</div>
					<div class="post-datetime">
						28 Sep 2016, 00:34					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>sera wrote:</cite><blockquote><div class="codebox"><pre><code>option resolvfile       &#039;/tmp/resolv.conf.auto&#039;</code></pre></div><p>would be the distribution default.</p></blockquote></div><p>could be my fault. Perhaps a bad backup that i restored.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p339417">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">davidc502</div>
					<div class="post-datetime">
						28 Sep 2016, 01:09					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>alirz wrote:</cite><blockquote><div class="quotebox"><cite>davidc502 wrote:</cite><blockquote><p>@alirz</p><p>Are you running OpenWrt or LEDE?</p></blockquote></div><p>Openwrt</p></blockquote></div><p>Currently LEDE has a issue with nslookup that affects Dynamic DNS, but I don&#039;t believe OpenWrt has that same issue, but lets check really quick.</p><br /><p>Please run&nbsp; &nbsp; #nslookup dev.openwrt.org&nbsp; from the router command line or Luci gui, and copy everything please like below.</p><p>root@lede:~# nslookup dev.openwrt.org<br />Server:&nbsp; &nbsp; 127.0.0.1<br />Address 1: 127.0.0.1 localhost</p><p>Name:&nbsp; &nbsp; &nbsp; dev.openwrt.org<br />Address 1: 217.115.15.26 dev.openwrt.nanl.de<br />Address 2: 2a00:1328:e000:452::26</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p339424">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">alirz</div>
					<div class="post-datetime">
						28 Sep 2016, 01:24					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>davidc502 wrote:</cite><blockquote><div class="quotebox"><cite>alirz wrote:</cite><blockquote><div class="quotebox"><cite>davidc502 wrote:</cite><blockquote><p>@alirz</p><p>Are you running OpenWrt or LEDE?</p></blockquote></div><p>Openwrt</p></blockquote></div><p>Currently LEDE has a issue with nslookup that affects Dynamic DNS, but I don&#039;t believe OpenWrt has that same issue, but lets check really quick.</p><br /><p>Please run&nbsp; &nbsp; #nslookup dev.openwrt.org&nbsp; from the router command line or Luci gui, and copy everything please like below.</p><p>root@lede:~# nslookup dev.openwrt.org<br />Server:&nbsp; &nbsp; 127.0.0.1<br />Address 1: 127.0.0.1 localhost</p><p>Name:&nbsp; &nbsp; &nbsp; dev.openwrt.org<br />Address 1: 217.115.15.26 dev.openwrt.nanl.de<br />Address 2: 2a00:1328:e000:452::26</p></blockquote></div><p>I would love to get that for you but i just flashed a new build of openwrt, luci keeps telling me that no password is it. I keep trying to set but it just keeps looping between the same pages... there i dont have ssh access right now.<br />This is getting so frustrated. Such basic stuff is failing.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p339425">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">davidc502</div>
					<div class="post-datetime">
						28 Sep 2016, 01:42					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>alirz wrote:</cite><blockquote><div class="quotebox"><cite>davidc502 wrote:</cite><blockquote><div class="quotebox"><cite>alirz wrote:</cite><blockquote><p>Openwrt</p></blockquote></div><p>Currently LEDE has a issue with nslookup that affects Dynamic DNS, but I don&#039;t believe OpenWrt has that same issue, but lets check really quick.</p><br /><p>Please run&nbsp; &nbsp; #nslookup dev.openwrt.org&nbsp; from the router command line or Luci gui, and copy everything please like below.</p><p>root@lede:~# nslookup dev.openwrt.org<br />Server:&nbsp; &nbsp; 127.0.0.1<br />Address 1: 127.0.0.1 localhost</p><p>Name:&nbsp; &nbsp; &nbsp; dev.openwrt.org<br />Address 1: 217.115.15.26 dev.openwrt.nanl.de<br />Address 2: 2a00:1328:e000:452::26</p></blockquote></div><p>I would love to get that for you but i just flashed a new build of openwrt, luci keeps telling me that no password is it. I keep trying to set but it just keeps looping between the same pages... there i dont have ssh access right now.<br />This is getting so frustrated. Such basic stuff is failing.</p></blockquote></div><p>Clear all of the browser cache.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p339427">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">alirz</div>
					<div class="post-datetime">
						28 Sep 2016, 01:51					</div>
				</div>
				<div class="post-content content">
					<p>That was the first thing i tried but i get this error</p><p><a href="https://www.dropbox.com/s/98grdfwelni78mb/password.PNG">https://www.dropbox.com/s/98grdfwelni78mb/password.PNG</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p339428">
				<div class="post-metadata">
					<div class="post-num">Post #21</div>
					<div class="post-author">davidc502</div>
					<div class="post-datetime">
						28 Sep 2016, 02:01					</div>
				</div>
				<div class="post-content content">
					<p>and you&#039;ve rebooted a couple of times?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p339429">
				<div class="post-metadata">
					<div class="post-num">Post #22</div>
					<div class="post-author">kirkgbr</div>
					<div class="post-datetime">
						28 Sep 2016, 02:23					</div>
				</div>
				<div class="post-content content">
					<p>After entering your new password twice, you are hitting the &quot;save and apply&quot; button right?&nbsp; And not just hitting the return/enter key.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p339430">
				<div class="post-metadata">
					<div class="post-num">Post #23</div>
					<div class="post-author">alirz</div>
					<div class="post-datetime">
						28 Sep 2016, 02:27					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>davidc502 wrote:</cite><blockquote><p>and you&#039;ve rebooted a couple of times?</p></blockquote></div><p>no, but will try that now</p><p>UPDATE: tried it same problem</p>											<p class="post-edited">(Last edited by <strong>alirz</strong> on 28 Sep 2016, 02:28)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p339431">
				<div class="post-metadata">
					<div class="post-num">Post #24</div>
					<div class="post-author">alirz</div>
					<div class="post-datetime">
						28 Sep 2016, 02:29					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>kirkgbr wrote:</cite><blockquote><p>After entering your new password twice, you are hitting the &quot;save and apply&quot; button right?&nbsp; And not just hitting the return/enter key.</p></blockquote></div><p>yup</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p339433">
				<div class="post-metadata">
					<div class="post-num">Post #25</div>
					<div class="post-author">davidc502</div>
					<div class="post-datetime">
						28 Sep 2016, 02:55					</div>
				</div>
				<div class="post-content content">
					<p>If you could ssh into the router, run the following command</p><p>#passwd root</p><p>Then make a new password.</p>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 1 of 2</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=67757&amp;p=2.html">2</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>