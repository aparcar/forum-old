<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> [SOLVED] Cannot flash Ubiquiti Airrouter anymore</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 18 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p320616">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">Kurgan</div>
					<div class="post-datetime">
						21 Apr 2016, 02:33					</div>
				</div>
				<div class="post-content content">
					<p>I have already used about 10 or more Ubiquiti Airrouter with OpenWRT 14.07. </p><p>I have bought two new units, tried to flash them as usual, using the same openwrt image, and I bricked both units. </p><p>By booting in recovery mode I was able to reflash original FW, but it seems that the router cannot boot anymore even with the original FW. </p><p>I will open the router and connect a serial cable tomorrow. </p><p>What happened to the Airrouter? Are the last units (November 2015)&nbsp; different from the older ones? (May 2015)</p>											<p class="post-edited">(Last edited by <strong>Kurgan</strong> on 22 Apr 2016, 19:14)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p320620">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">npkamen</div>
					<div class="post-datetime">
						21 Apr 2016, 03:27					</div>
				</div>
				<div class="post-content content">
					<p>Sorry I can&#039;t help with your issue but I&#039;m just curious as to why you use those particular units?</p><p>There are other devices that are faster or cheaper (or both) and have proven OpenWRT vanilla track records.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p320628">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">webtron</div>
					<div class="post-datetime">
						21 Apr 2016, 05:42					</div>
				</div>
				<div class="post-content content">
					<p>Ubiquiti updated uboot in the later firmware which stops some of their devices from booting with Openwrt. Get the 5.5.11 and 5.6 version airos firmware from the ubnt site hook up a serial connector to the AP then flash back to 5.11 via urescue. Then use urescue to flash to 5.6 and then you should be able to access the gui to flash back to 5.11. After that flash all future Ubiquiti routers back to 5.11 before flashing with openwrt.</p><p>press any key when prompted to stop boot</p><p>urescue -f -e<br />tftp v 5.5.11 to 192.168.1.20</p><p>reboot</p><p>urescue -f -e</p><p>tftp v 5.6.xxx to 192.168.1.20</p><p>reboot</p><p>gui flash back to 5.5.11</p>											<p class="post-edited">(Last edited by <strong>webtron</strong> on 21 Apr 2016, 05:43)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p320644">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">Kurgan</div>
					<div class="post-datetime">
						21 Apr 2016, 10:31					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for the prompt and complete answer. I will test this setup soon. This is crazy, anyway. I will not buy Ubiquiti anymore.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p320645">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">Kurgan</div>
					<div class="post-datetime">
						21 Apr 2016, 10:33					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>npkamen wrote:</cite><blockquote><p>Sorry I can&#039;t help with your issue but I&#039;m just curious as to why you use those particular units?</p><p>There are other devices that are faster or cheaper (or both) and have proven OpenWRT vanilla track records.</p></blockquote></div><p>Because they where easy to find here in Italy. </p><p>I&#039;m more than willing to use different units, if I can find them. Please tell me what do you use.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p320658">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">Kurgan</div>
					<div class="post-datetime">
						21 Apr 2016, 11:50					</div>
				</div>
				<div class="post-content content">
					<p>Thanks Webtron, it worked. I have installed 14.07 because AFAIK 15.05 does not work on this device.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p320660">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">webtron</div>
					<div class="post-datetime">
						21 Apr 2016, 11:55					</div>
				</div>
				<div class="post-content content">
					<p>15.05 should work it does for me.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p321578">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">JohnV</div>
					<div class="post-datetime">
						28 Apr 2016, 04:22					</div>
				</div>
				<div class="post-content content">
					<p>We have tried the steps outlined here, but are not having any luck.</p><p>Both firmwares go on fine via urescue and tftp, but the BulletM2 does not boot.&nbsp; It just stays at &quot;Booting...&quot;</p><br /><div class="codebox"><pre><code>U-Boot 1.1.4.2-s956 (Jun 10 2015 - 10:54:50)

DRAM:  32 MB
Flash:  8 MB
PCIe WLAN Module found (#1).
Net:   eth0, eth1
Board: Ubiquiti Networks XM board (rev 1.0 e2d2)
Hit any key to stop autoboot:  0
ar7240&gt; urescue -f -e
Using environment IP
Boot loader overwrite mode
Starting TFTP server...
Using eth0 (192.168.1.20), address: 0x81000000
Waiting for connection: -
Receiving file from 192.168.1.254:57747
Received 6896662 bytes
Firmware Version: XM.ar7240.v5.5.11.28002.150723.1344
Setting U-Boot environment variables
Un-Protected 1 sectors
Erasing Flash.... done
Erased 1 sectors
Writing to Flash... done
Protected 1 sectors
Copying partition &#039;u-boot&#039; to flash memory:

First 0x0 last 0x3 sector size 0x10000
.... done
write addr: 9f000000
Copying partition &#039;kernel&#039; to flash memory:

First 0x5 last 0x14 sector size 0x10000
................ done
write addr: 9f050000
Copying partition &#039;rootfs&#039; to flash memory:

First 0x15 last 0x7a sector size 0x10000
...................................................................................................... done
write addr: 9f150000

Firmware update complete.

Resetting...

U-Boot 1.1.4.2-s594 (Dec  5 2012 - 15:23:07)

Board: Ubiquiti Networks XM board (rev 1.0 e2d2)
DRAM:  32 MB
Flash:  8 MB
PCIe WLAN Module found (#1).
Net:   eth0, eth1
Hit any key to stop autoboot:  0
## Booting image at 9f050000 ...
   Image Name:   MIPS Ubiquiti Linux-2.6.32.54
   Created:      2015-07-23  10:45:21 UTC
   Image Type:   MIPS Linux Kernel Image (lzma compressed)
   Data Size:    1047481 Bytes = 1022.9 kB
   Load Address: 80002000
   Entry Point:  80002000
   Verifying Checksum ... OK
   Uncompressing Kernel Image ... OK

Starting kernel ...

Booting...


U-Boot 1.1.4.2-s594 (Dec  5 2012 - 15:23:07)

Board: Ubiquiti Networks XM board (rev 1.0 e2d2)
DRAM:  32 MB
Flash:  8 MB
PCIe WLAN Module found (#1).
Net:   eth0, eth1
Hit any key to stop autoboot:  0
ar7240&gt; urescue -f -e
Using environment IP
Boot loader overwrite mode
Starting TFTP server...
Using eth0 (192.168.1.20), address: 0x81000000
Waiting for connection: /
Receiving file from 192.168.1.254:54037
Received 7537129 bytes
Firmware Version: XM.ar7240.v5.6.4.28924.160331.1253
Setting U-Boot environment variables
Un-Protected 1 sectors
Erasing Flash.... done
Erased 1 sectors
Writing to Flash... done
Protected 1 sectors
Copying partition &#039;u-boot&#039; to flash memory:
        erasing range 0x9F000000..0x9F03FFFF: .... done
Erased 4 sectors
        writing to address 0x9f000000, length 0x00040000 ...
Copying partition &#039;kernel&#039; to flash memory:
        erasing range 0x9F050000..0x9F14FFFF: ................ done
Erased 16 sectors
        writing to address 0x9f050000, length 0x00100000 ...
Copying partition &#039;rootfs&#039; to flash memory:
        erasing range 0x9F150000..0x9F74FFFF: ................................................................................................ done
Erased 96 sectors
        writing to address 0x9f150000, length 0x00600000 ...

Firmware update complete.

Resetting...

U-Boot 1.1.4.2-s956 (Jun 10 2015 - 10:54:50)

DRAM:  32 MB
Flash:  8 MB
PCIe WLAN Module found (#1).
Net:   eth0, eth1
Board: Ubiquiti Networks XM board (rev 1.0 e2d2)
Hit any key to stop autoboot:  0
## Booting image at 9f050000 ...
   Image Name:   MIPS Ubiquiti Linux-2.6.32.68
   Created:      2016-03-31   9:54:32 UTC
   Image Type:   MIPS Linux Kernel Image (lzma compressed)
   Data Size:    1008243 Bytes = 984.6 kB
   Load Address: 80002000
   Entry Point:  80002000
   Verifying Checksum ... OK
   Uncompressing Kernel Image ... OK

Starting kernel ...

Booting...</code></pre></div><br /><p>Anything else we can try.....?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p321579">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">webtron</div>
					<div class="post-datetime">
						28 Apr 2016, 04:31					</div>
				</div>
				<div class="post-content content">
					<p>You should be able to access the gui on 192.168.1.20</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p321643">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">JohnV</div>
					<div class="post-datetime">
						28 Apr 2016, 15:22					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>webtron wrote:</cite><blockquote><p>You should be able to access the gui on 192.168.1.20</p></blockquote></div><p>We cannot ping nor access the GUI at 192.168.1.20.&nbsp; The firmware does not appear to startup.&nbsp; No LED activity, and the console just sits there.</p><p>However, we have tried another set of commands on the BulletM2 and have successfully gotten OpenWrt installed with the correct u-boot and all is working.</p><p>We will try on a few more Bullets to confirm our process works, and then post the results on here as well as perhaps different devices need slightly different methods.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p321716">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">JohnV</div>
					<div class="post-datetime">
						28 Apr 2016, 23:22					</div>
				</div>
				<div class="post-content content">
					<p>I managed to get OpenWrt installed and working.&nbsp; This is what I did.</p><p>press any key when prompted to stop boot</p><p>urescue -f -e<br />tftp v 5.5.11 to 192.168.1.20<br />reboot</p><p>urescue<br />tftp openwrt-factory.bin to 192.168.1.20<br />reboot</p><p>Router then booted correctly, and OpenWRT worked correctly.</p><p>My understanding is the -f -e options will force u-boot to be re-written with the one from 5.5, which is the one we want.&nbsp; Then using urescue without options simply replaced the firmware.&nbsp; And all seems well. </p><p>Hope this helps someone save some devices.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p328743">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">JohnV</div>
					<div class="post-datetime">
						16 Jun 2016, 15:54					</div>
				</div>
				<div class="post-content content">
					<p>Just FYI, a patch has been created that solves compatibility with the new U-boot version so OpenWRT installs correctly without having to first load 5.5.X.&nbsp; I have tested on Bullet M2&#039;s and it works fine with both old and new U-Boot.&nbsp; Mathias has tested on other UBNT hardware.</p><p><a href="https://dev.openwrt.org/ticket/20982#comment:38">https://dev.openwrt.org/ticket/20982#comment:38</a></p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>