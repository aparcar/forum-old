<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> OpenVPN - No connection.</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 9 Apr 2018 and 16 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 2 of 2</div><nav><ul><li><a href="viewtopic.php%3Fid=63862&amp;p=1.html">1</a></li><li class="pagination-current"><span>2</span></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p318126">
				<div class="post-metadata">
					<div class="post-num">Post #26</div>
					<div class="post-author">Syncopate</div>
					<div class="post-datetime">
						4 Apr 2016, 16:41					</div>
				</div>
				<div class="post-content content">
					<p>Update: so apparently the password situation described above was the cause of my iOS problems. Now I connect just fine, and the only re amning question I have as how I force dns traffic through my vpn server.</p><p>PS: thanks rangerz and riodoro for your help along the way!</p>											<p class="post-edited">(Last edited by <strong>Syncopate</strong> on 4 Apr 2016, 16:42)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p318132">
				<div class="post-metadata">
					<div class="post-num">Post #27</div>
					<div class="post-author">RangerZ</div>
					<div class="post-datetime">
						4 Apr 2016, 18:22					</div>
				</div>
				<div class="post-content content">
					<p>Try taking the word local out of this:</p><p>&nbsp; &nbsp; list push&nbsp; &nbsp; &#039;redirect-gateway def1 local&#039;</p><p><a href="https://openvpn.net/index.php/open-source/documentation/howto.html">https://openvpn.net/index.php/open-sour … howto.html</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p318177">
				<div class="post-metadata">
					<div class="post-num">Post #28</div>
					<div class="post-author">Syncopate</div>
					<div class="post-datetime">
						5 Apr 2016, 00:42					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>RangerZ wrote:</cite><blockquote><p>Try taking the word local out of this:</p><p>&nbsp; &nbsp; list push&nbsp; &nbsp; &#039;redirect-gateway def1 local&#039;</p><p><a href="https://openvpn.net/index.php/open-source/documentation/howto.html">https://openvpn.net/index.php/open-sour … howto.html</a></p></blockquote></div><p>Didnt help. Where would you suggest I look? Is it a firewall setting conflict perhaps?</p>											<p class="post-edited">(Last edited by <strong>Syncopate</strong> on 5 Apr 2016, 00:42)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p318185">
				<div class="post-metadata">
					<div class="post-num">Post #29</div>
					<div class="post-author">RangerZ</div>
					<div class="post-datetime">
						5 Apr 2016, 01:52					</div>
				</div>
				<div class="post-content content">
					<p>Lets step back and understand EXACTLY where you are</p><p>The server works<br />The linux connects<br />the ios connects<br />post the log files for each (from the tmp folder)<br />Once you connect what can you do or not do<br />Reach the internet (on the local LAN as opposed to the through the VPN)<br />Can you ping or reach the router =&gt; try opening luci from the linux box.<br />Etc.</p><p>This is the toughest part.&nbsp; You may need to dig into understanding or at least trying to what each element in the openvpn config is doing and making some reasonable decisions.&nbsp; If it&#039;s not an essential parameter (like mtu and buffers) you may need to put it aside.&nbsp; </p><p>My best guess is if you can connect and not get to the internet through the tunnel, then it is something related to the redirect-gateway statement.&nbsp; </p><p>Also post your current firewall.&nbsp; Me thinks you did not have all the needed forwards on the LAN side.</p><p>BTW, I run proto TAP so my config is different.&nbsp; I did not use tunnel as I wanted to access local resources and it&#039;s easier with TAP.</p><p>I still think that the tuno parameter needs or at least should be the same on both sides.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p318284">
				<div class="post-metadata">
					<div class="post-num">Post #30</div>
					<div class="post-author">Syncopate</div>
					<div class="post-datetime">
						5 Apr 2016, 18:48					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>RangerZ wrote:</cite><blockquote><p>The server works<br />The linux connects<br />the ios connects</p></blockquote></div><p>Yup.<br /><strong><br />Log files:</strong></p><p><em>Server (full):</em><br /><a href="http://pastebin.com/PnADxZQm">http://pastebin.com/PnADxZQm</a></p><p><em>Client:</em><br />Coming once I get it working..</p><p>I can reach LAN (LuCi through VPN too). Can&#039;t ping 8.8.8.8 or connect anyhow. I also set an IPTABLES rule thanks to your HOWTO link which was not included in the streamlined guide. The server log does mention something about the MTU as an error message.</p><p><strong>Firewall:</strong><br /></p><div class="codebox"><pre><code>config rule
    option target &#039;ACCEPT&#039;
    option proto &#039;tcp udp&#039;
    option family &#039;ipv4&#039;
    option src &#039;*&#039;
    option dest_port &#039;1194&#039;
    option name &#039;Allow Inbound VPN0&#039;

config rule
    option target &#039;ACCEPT&#039;
    option proto &#039;tcp udp&#039;
    option family &#039;ipv4&#039;
    option src &#039;*&#039;
    option dest_port &#039;443&#039;
    option name &#039;Allow Inbound VPN0 443&#039;

config rule
    option target &#039;ACCEPT&#039;
    option proto &#039;tcp udp&#039;
    option family &#039;ipv4&#039;
    option src &#039;*&#039;
    option src_ip &#039;10.1.1.0/24&#039;
    option dest_ip &#039;192.168.1.0/26&#039;
    option name &#039;Allow Inbound VPN0 Traffic to LAN&#039;

config rule
    option target &#039;ACCEPT&#039;
    option proto &#039;tcp udp&#039;
    option family &#039;ipv4&#039;
    option src &#039;*&#039;
    option src_ip &#039;10.1.1.0/24&#039;
    option dest &#039;*&#039;
    option dest_ip &#039;192.168.1.0/26&#039;
    option name &#039;Allow Forwarded VPN0 Traffic to LAN&#039;

config rule
    option target &#039;ACCEPT&#039;
    option proto &#039;icmp&#039;
    option src_ip &#039;10.1.1.0/24&#039;
    option src &#039;*&#039;
    option dest &#039;lan&#039;
    option name &#039;Allow Inbound ICMP Traffic from VPN0 to LAN&#039;

config rule
    option target &#039;ACCEPT&#039;
    option proto &#039;icmp&#039;
    option src &#039;*&#039;
    option src_ip &#039;10.1.1.0/24&#039;
    option dest &#039;wan&#039;
    option name &#039;Allow Outbound ICMP Echo Request (8) from VPN0&#039;
    list icmp_type &#039;echo-request&#039;

config defaults
    option syn_flood &#039;1&#039;
    option input &#039;ACCEPT&#039;
    option output &#039;ACCEPT&#039;
    option forward &#039;ACCEPT&#039;

config zone
    option name &#039;lan&#039;
    option input &#039;ACCEPT&#039;
    option output &#039;ACCEPT&#039;
    option forward &#039;ACCEPT&#039;
    option network &#039; &#039;

config zone
    option name &#039;wan&#039;
    option output &#039;ACCEPT&#039;
    option masq &#039;1&#039;
    option mtu_fix &#039;1&#039;
    option network &#039;wan6&#039;
    option forward &#039;ACCEPT&#039;
    option input &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-DHCP-Renew&#039;
    option src &#039;wan&#039;
    option proto &#039;udp&#039;
    option dest_port &#039;68&#039;
    option target &#039;ACCEPT&#039;
    option family &#039;ipv4&#039;

config rule
    option name &#039;Allow-Ping&#039;
    option src &#039;wan&#039;
    option proto &#039;icmp&#039;
    option icmp_type &#039;echo-request&#039;
    option family &#039;ipv4&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-DHCPv6&#039;
    option src &#039;wan&#039;
    option proto &#039;udp&#039;
    option src_ip &#039;fe80::/10&#039;
    option src_port &#039;547&#039;
    option dest_ip &#039;fe80::/10&#039;
    option dest_port &#039;546&#039;
    option family &#039;ipv6&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-ICMPv6-Input&#039;
    option src &#039;wan&#039;
    option proto &#039;icmp&#039;
    list icmp_type &#039;echo-request&#039;
    list icmp_type &#039;echo-reply&#039;
    list icmp_type &#039;destination-unreachable&#039;
    list icmp_type &#039;packet-too-big&#039;
    list icmp_type &#039;time-exceeded&#039;
    list icmp_type &#039;bad-header&#039;
    list icmp_type &#039;unknown-header-type&#039;
    list icmp_type &#039;router-solicitation&#039;
    list icmp_type &#039;neighbour-solicitation&#039;
    list icmp_type &#039;router-advertisement&#039;
    list icmp_type &#039;neighbour-advertisement&#039;
    option limit &#039;1000/sec&#039;
    option family &#039;ipv6&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-ICMPv6-Forward&#039;
    option src &#039;wan&#039;
    option dest &#039;*&#039;
    option proto &#039;icmp&#039;
    list icmp_type &#039;echo-request&#039;
    list icmp_type &#039;echo-reply&#039;
    list icmp_type &#039;destination-unreachable&#039;
    list icmp_type &#039;packet-too-big&#039;
    list icmp_type &#039;time-exceeded&#039;
    list icmp_type &#039;bad-header&#039;
    list icmp_type &#039;unknown-header-type&#039;
    option limit &#039;1000/sec&#039;
    option family &#039;ipv6&#039;
    option target &#039;ACCEPT&#039;

config zone
    option name &#039;newzone2&#039;
    option input &#039;ACCEPT&#039;
    option output &#039;ACCEPT&#039;
    option forward &#039;ACCEPT&#039;
    option network &#039;lan wan&#039;

config forwarding
    option dest &#039;newzone2&#039;
    option src &#039;wan&#039;

config zone
    option name &#039;vpn&#039;
    option input &#039;ACCEPT&#039;
    option forward &#039;ACCEPT&#039;
    option output &#039;ACCEPT&#039;
    option network &#039;vpn0&#039;
    option family &#039;ipv4&#039;

config include
    option path &#039;/etc/firewall.user&#039;

config zone
    option name &#039;vpn&#039;
    option input &#039;ACCEPT&#039;
    option forward &#039;ACCEPT&#039;
    option output &#039;ACCEPT&#039;
    option network &#039;vpn0&#039;

config zone
    option name &#039;lan&#039;
    option input &#039;ACCEPT&#039;
    option output &#039;ACCEPT&#039;
    option network &#039;lan&#039;
    option forward &#039;DROP&#039;
    option masq &#039;1&#039;

config forwarding
    option dest &#039;lan&#039;
    option src &#039;newzone2&#039;

config forwarding
    option dest &#039;newzone2&#039;
    option src &#039;lan&#039;

config forwarding
    option dest &#039;wan&#039;
    option src &#039;lan&#039;

config forwarding
    option dest &#039;lan&#039;
    option src &#039;vpn&#039;

config forwarding
    option dest &#039;newzone2&#039;
    option src &#039;vpn&#039;

config forwarding
    option dest &#039;wan&#039;
    option src &#039;vpn&#039;

config forwarding
    option dest &#039;vpn&#039;
    option src &#039;lan&#039;

config redirect
    option target &#039;SNAT&#039;
    option src &#039;vpn&#039;
    option dest &#039;newzone2&#039;
    option proto &#039;all&#039;
    option name &#039;VPNNAT&#039;
    option src_ip &#039;10.1.1.0/24&#039;
    option dest_ip &#039;**PublicIP**&#039;
    option src_dip &#039;**PublicIP**&#039;</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p318311">
				<div class="post-metadata">
					<div class="post-num">Post #31</div>
					<div class="post-author">RangerZ</div>
					<div class="post-datetime">
						5 Apr 2016, 21:53					</div>
				</div>
				<div class="post-content content">
					<p>I am probably at a point where I can not help you much more.&nbsp; </p><p>I do not understand all what is in your logs.&nbsp; There are hundreds of lines that I do not see in my logs</p><div class="codebox"><pre><code>Tue Apr  5 15:14:49 2016 us=485747 **CLIENT-IP**:34083 UDPv4 READ [50] from [AF_INET]**CLIENT-IP**:34083: P_ACK_V1 kid=0 pid=[ #11 ] [ 5 ]</code></pre></div><p>&nbsp; Is your log level still at 3?</p><p>There seems to be a couple occurrences of this </p><div class="codebox"><pre><code>new connection by client &#039;Test&#039; will cause previous active sessions by this client to be dropped</code></pre></div><p> which seems to indicate the connection is terminating, though it does not say so.</p><p>I also do not see a line on the server that says </p><div class="codebox"><pre><code>Initialization Sequence Completed</code></pre></div><p> which mine does once the server is started.</p><p>I would start to google some of what you see in the logs and search OpenVPN forum/wiki in particular.</p><p>You also have a lot of Zones and Rules&nbsp; that I am concerned are extra.&nbsp; You should have I think only three Interfaces (zones), LAN, WAN and VPN.&nbsp; I can not help you here at all.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 2 of 2</div><nav><ul><li><a href="viewtopic.php%3Fid=63862&amp;p=1.html">1</a></li><li class="pagination-current"><span>2</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>