<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> MPD server on OpenWRT</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 26 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p111576">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">Microman171</div>
					<div class="post-datetime">
						20 Jun 2010, 05:20					</div>
				</div>
				<div class="post-content content">
					<p>Hey,</p><p>I have an MPD server running happily on OpenWRT with a USB sound card.&nbsp; The music is stored on a USB stick.&nbsp; It all works well.</p><p>I have an application on my iPod Touch that connected to the router&#039;s MPD server to change songs etc.&nbsp; As long as I have the OpenWRT router in sta mode and connected to my existing network, it works fine.</p><p>The idea is for this system (a WiFi music player) to be portable.&nbsp; This means the OpenWRT router will need to host a network that the iPod can connect to.&nbsp; It is fine for this network to be separate to my existing one.&nbsp; It does not need an internet connection (or any wired connection for that matter).&nbsp; I just want it to host the MPD server, and allow me to connect over WiFi.</p><p>How can I do this?&nbsp; It is suggested that I need to use ap mode with a dhcp server (for the ipod).&nbsp; I also need to set a static IP for the router.&nbsp; I am an OpenWRT newbie, and have no idea how to go about this.&nbsp; A lot of the documentation on the internet is quite old, and speaks of NVRAM which I know is the old way of doing things.</p><p>I am using an Asus wl520gU which has a broadcom chip in it.&nbsp; It is running Kamikaze 8.09.</p><br /><p>Thanks,</p><p>MM</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p111577">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">ecc</div>
					<div class="post-datetime">
						20 Jun 2010, 05:42					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Microman171 wrote:</cite><blockquote><p>It is suggested that I need to use ap mode with a dhcp server (for the ipod).&nbsp; I also need to set a static IP for the router.</p></blockquote></div><p>You should be able to do all this via the web interface, by default at <a href="http://192.168.1.1">http://192.168.1.1</a>/.&nbsp; After logging in (initially there&#039;s no password), click on Administration, then use the Network &gt; Interfaces menu to set the IP address and WiFi mode you want, and the Network &gt; DHCP menu to enable DHCP service for your clients.&nbsp; Good luck, it sounds like a fun project.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p111578">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">Microman171</div>
					<div class="post-datetime">
						20 Jun 2010, 08:20					</div>
				</div>
				<div class="post-content content">
					<p>Hey,</p><p>The web interface is not installed on my firmware.&nbsp; Is there a way of doing this with the config files?</p><br /><p>Thanks,</p><p>MM</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p111579">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">LinkZ</div>
					<div class="post-datetime">
						20 Jun 2010, 08:38					</div>
				</div>
				<div class="post-content content">
					<p>Use UCI.&nbsp; Here&#039;s the wiki:<br /><a href="http://wiki.openwrt.org/doc/uci">http://wiki.openwrt.org/doc/uci</a></p><p>Most of your configuration will be in the /etc/config/network file:<br /><a href="http://wiki.openwrt.org/doc/uci/network">http://wiki.openwrt.org/doc/uci/network</a></p>											<p class="post-edited">(Last edited by <strong>LinkZ</strong> on 20 Jun 2010, 08:40)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p111581">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">Microman171</div>
					<div class="post-datetime">
						20 Jun 2010, 09:25					</div>
				</div>
				<div class="post-content content">
					<p>By the looks of things, I need to connect the WiFi as an access point to an interface that the MPD server uses?&nbsp; As far as I know, the MPD server is using the lan device, so I&#039;m pretty sure I have everything right.</p><p>I have had a look at configuring the dhcp server, and it all seems right.</p><p>With my configuration, my iPod still doesn&#039;t get assigned an IP...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p111582">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">LinkZ</div>
					<div class="post-datetime">
						20 Jun 2010, 09:41					</div>
				</div>
				<div class="post-content content">
					<p>Let&#039;s see your config files:<br />/etc/config/network<br />/etc/config/dhcp<br />/etc/config/wireless</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p111586">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">Microman171</div>
					<div class="post-datetime">
						20 Jun 2010, 09:59					</div>
				</div>
				<div class="post-content content">
					<p>/etc/config/network<br /></p><div class="codebox"><pre><code>#### VLAN configuration             
config switch eth0                  
        option vlan0    &quot;1 2 3 4 5*&quot;
        option vlan1    &quot;0 5&quot;
                           
                            
#### Loopback configuration   
config interface loopback        
        option ifname   &quot;lo&quot;     
        option proto    static   
        option ipaddr   127.0.0.1
        option netmask  255.0.0.0
                      
                              
#### LAN configuration          
config interface lan            
        option type     bridge     
        option ifname   &quot;eth0.0&quot;     
        option proto    dhcp         
        #option ipaddr  192.168.1.1  
        #option netmask 255.255.255.0

                                     
#### WAN configuration               
config interface        wan          
        option ifname   &quot;eth0.1&quot;
        option proto    dhcp</code></pre></div><p>/etc/config/wireless<br /></p><div class="codebox"><pre><code>config wifi-device  wl0
        option type     broadcom
        option channel  5

        # REMOVE THIS LINE TO ENABLE WIFI:
        #option disabled 1

config wifi-iface
        option device   wl0
        option network  lan
        option mode     ap
        option ssid     dansradio
        option encryption psk2
        option key dantheman171</code></pre></div><p>/etc/config/dhcp<br /></p><div class="codebox"><pre><code>config dnsmasq
        option domainneeded     1
        option boguspriv        1
        option filterwin2k      &#039;0&#039;  #enable for dial on demand
        option localise_queries 1
        option local    &#039;/lan/&#039;
        option domain   &#039;lan&#039;
        option expandhosts      1
        option nonegcache       0
        option authoritative    1
        option readethers       1
        option leasefile        &#039;/tmp/dhcp.leases&#039;
        option resolvfile       &#039;/tmp/resolv.conf.auto&#039;

config dhcp lan
        option interface        lan
        option start    100
        option limit    150
        option leasetime        12h

config dhcp wan
        option interface        wan
        option ignore   1</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p111621">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">ecc</div>
					<div class="post-datetime">
						20 Jun 2010, 21:00					</div>
				</div>
				<div class="post-content content">
					<p>Some suggestions:</p><p>I notice that the wifi interface wl0 is not listed in the &quot;option ifname&quot; list for the lan bridge. (I don&#039;t bridge my wifi, so I don&#039;t know if this is set up automatically.)&nbsp; You can check by doing &quot;brctl show&quot;&nbsp; from the command line.&nbsp; It should list both eth0.0 and wl0 in the bridge group.</p><p>You can use the &quot;logread&quot; command to see what&#039;s happening when your ipod is trying to get an IP address.&nbsp; Dnsmasq should log the DHCP requests and responses.</p><p>Also, if you&#039;ve connected your wan interface to the outside internet, you should be able to do<br /></p><div class="codebox"><pre><code>opkg update
opkg install luci</code></pre></div><p>to get the web admin interface.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p111643">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">LinkZ</div>
					<div class="post-datetime">
						21 Jun 2010, 09:24					</div>
				</div>
				<div class="post-content content">
					<p>Try setting your LAN configuration to static.&nbsp; Change /etc/config/network as follows (just change the &quot;config interface lan&quot; section, leave the other sections as is):</p><div class="codebox"><pre><code>#### LAN configuration          
config interface lan            
        option type      bridge     
        option ifname    &quot;eth0.0&quot;     
        option proto     static         
        option ipaddr    192.168.1.1  
        option netmask   255.255.255.0</code></pre></div><p>Everything else looks good.&nbsp; Your router should have a static IP address of 192.168.1.1 and act as a DHCP server for your iPod, assigning it an address of 192.168.1.100.&nbsp; Your iPod will have to be configured to connect with the correct wifi encryption of course (WPA2 in this case).</p>											<p class="post-edited">(Last edited by <strong>LinkZ</strong> on 21 Jun 2010, 09:30)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p111650">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">Microman171</div>
					<div class="post-datetime">
						21 Jun 2010, 11:56					</div>
				</div>
				<div class="post-content content">
					<p>Hey,</p><p>I am still unable to connect to my server on 192.168.1.1.&nbsp; I think the problem still has to do with DHCO handing out the wrong IP and subnet.</p><p>In AP mode, my iPod connects to the network with the IP address of 169.254.36.191 and a subnet of 255.255.0.&nbsp; This is not an IP I have ever seen before...</p><br /><p>Cheers,</p><p>MM</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p111679">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">LinkZ</div>
					<div class="post-datetime">
						21 Jun 2010, 18:43					</div>
				</div>
				<div class="post-content content">
					<p>Your iPod isn&#039;t connecting to the network.&nbsp; That IP address is self generated after it failed to connect to the host.&nbsp; There&#039;s a few things you can do to troubleshoot:</p><p>1) Open up a telnet or SSH to your router (192.168.1.1) and type &quot;wifi&quot;.&nbsp; Note any errors and fix them.<br />2) Confirm your wireless interface is up with &quot;iwconfig&quot;, which should show the status of your wifi interfaces.<br />3) If everything looks good, try turning off wifi encryption temporarily (encryption = none) and try to connect that way.<br />4) If you can connect with no encryption, re-enable encryption (WPA2) and make sure your iPod is set according to your host.<br />5) Check your kernel and system logs for wifi or connection related errors that may be of use (&quot;dmesg&quot;, &quot;logread&quot;).</p>											<p class="post-edited">(Last edited by <strong>LinkZ</strong> on 21 Jun 2010, 18:45)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p111944">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">Microman171</div>
					<div class="post-datetime">
						26 Jun 2010, 06:39					</div>
				</div>
				<div class="post-content content">
					<p>Sorry I didn&#039;t reply sooner.&nbsp; Haven&#039;t had time to have a good crack at this.&nbsp; A reboot (rather than restarting the network) seems to have completely fixed the problem.&nbsp; My iPod is able to connect to the MPD server running on the router without my existing network as a host.</p><p>Thanks for you help guys, I&#039;ll have to make another post to say how the whole project goes...</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>