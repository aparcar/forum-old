<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> 3g modem problem</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 24 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p136896">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">bigboban</div>
					<div class="post-datetime">
						11 Jun 2011, 14:00					</div>
				</div>
				<div class="post-content content">
					<p>I have common huawei 3g modem. But modem doesn&#039; work and i don&#039;t know why. I use this instructions:</p><p><a href="http://josefsson.org/openwrt/dongle.html">http://josefsson.org/openwrt/dongle.html</a></p><p>This is output of Status-USB in webif:</p><div class="codebox"><pre><code>Bus    Device    Product    Manufacturer    VendorID:ProdID    USB version    Speed
04    1    UHCI Host Controller    Linux 2.6.32.10 uhci_hcd    1d6b:0001    1.10    12 Mbps
03    1    UHCI Host Controller    Linux 2.6.32.10 uhci_hcd    1d6b:0001    1.10    12 Mbps
02    1    SSB OHCI Controller    Linux 2.6.32.10 ssb-usb-ohci    1d6b:0001    1.10    12 Mbps
01    1    EHCI Host Controller    Linux 2.6.32.10 ehci_hcd    1d6b:0002    2.00    480 Mbps
01    2    HUAWEI Mobile    HUAWEI Technology    12d1:1446    2.00    480 Mbps</code></pre></div><p>So i think usb is set up correctly.</p><p>This is fragment of /proc/bus/usb/devices:</p><div class="codebox"><pre><code>T:  Bus=01 Lev=01 Prnt=01 Port=01 Cnt=01 Dev#=  2 Spd=480 MxCh= 0
D:  Ver= 2.00 Cls=00(&gt;ifc ) Sub=00 Prot=00 MxPS=64 #Cfgs=  1
P:  Vendor=12d1 ProdID=1446 Rev= 0.00
S:  Manufacturer=HUAWEI Technology
S:  Product=HUAWEI Mobile
C:* #Ifs= 2 Cfg#= 1 Atr=e0 MxPwr=500mA
I:* If#= 0 Alt= 0 #EPs= 2 Cls=08(stor.) Sub=06 Prot=50 Driver=usbserial_generic
E:  Ad=81(I) Atr=02(Bulk) MxPS= 512 Ivl=0ms
E:  Ad=01(O) Atr=02(Bulk) MxPS= 512 Ivl=0ms
I:* If#= 1 Alt= 0 #EPs= 2 Cls=08(stor.) Sub=06 Prot=50 Driver=usbserial_generic
E:  Ad=02(O) Atr=02(Bulk) MxPS= 512 Ivl=0ms
E:  Ad=82(I) Atr=02(Bulk) MxPS= 512 Ivl=0ms</code></pre></div><p>This is fragment of DMESG output:</p><div class="codebox"><pre><code>usbcore: registered new interface driver usbserial
USB Serial support registered for generic
usbserial_generic 1-2:1.0: generic converter detected
usb 1-2: generic converter now attached to ttyUSB0
usbserial_generic 1-2:1.1: generic converter detected
usb 1-2: generic converter now attached to ttyUSB1
usbcore: registered new interface driver usbserial_generic
usbserial: USB Serial Driver core
USB Serial support registered for GSM modem (1-port)
usbcore: registered new interface driver option
option: v0.7.2:USB Driver for GSM modems</code></pre></div><p>In /etc/modules.d/60-usb-serial i have this:</p><div class="codebox"><pre><code>usbserial vendor=0x12d1 product=0x1446 maxSize=4096</code></pre></div><p>But next steps from instrictions doesn&#039;t work:</p><p>1) webif Status-UMTS output is: UMTS / GPRS device not found.<br />2) output of huaweiAktBbo is: Searching modem...No supported modem found<br />3) comgt -info .. crashes<br />3)&nbsp; ifup wan crashes</p><p>Is it possible i have not supported modem? I think it is Huawei E1750 model..</p><p><strong>Please help me what to do to set up 3g modem connection?</strong></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p136928">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">renoir</div>
					<div class="post-datetime">
						12 Jun 2011, 00:32					</div>
				</div>
				<div class="post-content content">
					<p>huaweiaktbbo is old...</p><p>I suggest you start over and follow the instructions given by our wiki: <a href="http://wiki.openwrt.org/doc/recipes/3gdongle">http://wiki.openwrt.org/doc/recipes/3gdongle</a><br />I have set up a lot of 3g modems successfully using that method, including an E1750.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p136937">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">tomlase</div>
					<div class="post-datetime">
						12 Jun 2011, 04:27					</div>
				</div>
				<div class="post-content content">
					<p>My zte mf627 was also not detected on the original firmware of my TL-MR3420, so the only way for it to go was by turning off the zerocd detection. And ever since I never found any problem on OpenWRT to detect this modem.</p><p>If you would like this way as I did, have a try.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p136943">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">bigboban</div>
					<div class="post-datetime">
						12 Jun 2011, 10:23					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>renoir wrote:</cite><blockquote><p>huaweiaktbbo is old...</p><p>I suggest you start over and follow the instructions given by our wiki: <a href="http://wiki.openwrt.org/doc/recipes/3gdongle">http://wiki.openwrt.org/doc/recipes/3gdongle</a><br />I have set up a lot of 3g modems successfully using that method, including an E1750.</p></blockquote></div><p>I forget to say i use also this instructions. I think both instructions are almost same.</p><p>I don&#039;t know where is problem. I see ttyUSB0 and ttyUSB1 on /dev but i am not able to communite with modem using GCOM. I think it should return some output if i try &quot;cat /dev/ttyUSBx&quot;. But it also doesn&#039;t work.</p><p>Is there some other way to detect modem&nbsp; or find out where is problem?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p136997">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">renoir</div>
					<div class="post-datetime">
						13 Jun 2011, 00:35					</div>
				</div>
				<div class="post-content content">
					<p>The instructions are not the same! Don&#039;t mix them up! Hence my suggestion to start over by only following the wiki&#039;s instructions. but anyway...</p><p>Did you install kmod-usb-serial-option? Really strange that you only see ttyUSB0 and ttyUSB1. You should see ttyUSB2 as well. On my E1750, 0 is the modem port and 2 the diagnose port. Can you run gcom -d /dev/ttyUSB0 or gcom -d /dev/ttyUSB1? The diagnose output of an E1750 is a little chatty, so output might yield in some strange result.</p><p>If you have installed usb_modeswitch, you can also try usb_modeswitch -c /etc/usb_modeswitch.d/12d1:1446 to force your huawei into modem mode. Again, output might not give you a success message, so make sure to check if the third port shows up in logread.</p><p>btw I hope you installed a 2.6 kernel...</p>											<p class="post-edited">(Last edited by <strong>renoir</strong> on 13 Jun 2011, 00:42)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p137008">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">bigboban</div>
					<div class="post-datetime">
						13 Jun 2011, 07:57					</div>
				</div>
				<div class="post-content content">
					<p><strong>My problem is solved</strong>!</p><p>Problem was (i think) in bad modem &quot;mode&quot;. I found some other instructions about switching this &quot;mode&quot; using usb_modeswitch.</p><p><strong>As i wrote before my modem reports 1446 product ID. But now i know this is wrong (for me)!</strong></p><p>I use /etc/usb_modeswitch.conf file and reconfigure product id 1446 (default) to 1406 (target).</p><p>After running usb_modeswitch i see (after reboot) my modem as &quot;HUAWEI Technology&nbsp; &nbsp; 12d1:<strong>1406</strong>&quot;.</p><p>And now - modem works! It&#039;s a miracle! A am able to connect to modem with GCOM info -d /dev/ttyUSB0. <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>That&#039;s a pitty none of these &quot;well known&quot; instructions:</p><p><a href="http://wiki.openwrt.org/doc/recipes/3gdongle">http://wiki.openwrt.org/doc/recipes/3gdongle</a><br /><a href="http://josefsson.org/openwrt/dongle.html">http://josefsson.org/openwrt/dongle.html</a></p><p>say nothing exact about usb_modeswitching of modem! But in my case only this was the whole problem!</p><br /><p>------------------------------------------------------<br />Some hours after..</p><p>After i solved problem myself i found these instructions (i think in estonian, google will translate for you):</p><p><a href="http://lauri.vosandi.eu/blog/?p=670">http://lauri.vosandi.eu/blog/?p=670</a></p><p>That guy has exact the same router and exact the same 3g modem as me and - how interesting - exact the same problem - and of course - exact the same solution. <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>											<p class="post-edited">(Last edited by <strong>bigboban</strong> on 13 Jun 2011, 08:49)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p137076">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						13 Jun 2011, 20:05					</div>
				</div>
				<div class="post-content content">
					<p>Yeah its sad but futile to document those quirks as they differ with _each_ model and there are hundreds of them.<br />The best source of information regarding mode switching is <a href="http://www.draisberghof.de/usb_modeswitch/">http://www.draisberghof.de/usb_modeswitch/</a> , the upstream site of usb-modeswitch.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p137827">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">tomlase</div>
					<div class="post-datetime">
						25 Jun 2011, 09:56					</div>
				</div>
				<div class="post-content content">
					<p>I bought a new Huawei HSDPA modem and I got some problem to connect to internet. Here&#039;s dmesg on my Ubuntu:</p><div class="codebox"><pre><code>[ 3625.148073] usb 4-1: new full speed USB device using ohci_hcd and address 5
[ 3625.377686] option 4-1:1.0: GSM modem (1-port) converter detected
[ 3625.377959] usb 4-1: GSM modem (1-port) converter now attached to ttyUSB0
[ 3625.386379] option 4-1:1.1: GSM modem (1-port) converter detected
[ 3625.386647] usb 4-1: GSM modem (1-port) converter now attached to ttyUSB1
[ 3625.415693] scsi14 : usb-storage 4-1:1.2
[ 3626.439214] scsi 14:0:0:0: CD-ROM            HUAWEI   Mass Storage     2.31 PQ: 0 ANSI: 2
[ 3626.481114] sr1: scsi-1 drive
[ 3626.481438] sr 14:0:0:0: Attached scsi CD-ROM sr1
[ 3626.481616] sr 14:0:0:0: Attached scsi generic sg3 type 5</code></pre></div><p>And here&#039;s the dmesg on the router:</p><div class="codebox"><pre><code>usb 1-1.4: new full speed USB device using ar71xx-ehci and address 11
option 1-1.4:1.0: GSM modem (1-port) converter detected
usb 1-1.4: GSM modem (1-port) converter now attached to ttyUSB0
option 1-1.4:1.1: GSM modem (1-port) converter detected
usb 1-1.4: GSM modem (1-port) converter now attached to ttyUSB1
scsi16 : usb-storage 1-1.4:1.2
scsi 16:0:0:0: CD-ROM            HUAWEI   Mass Storage     2.31 PQ: 0 ANSI: 2</code></pre></div><p>the real problem is it can not lock signal...</p><div class="codebox"><pre><code>Jun 20 12:07:03 MyOpenWRT local2.info chat[2068]: send (AT+CGDCONT=1,&quot;IP&quot;,&quot;internet&quot;^M)
Jun 20 12:07:03 MyOpenWRT local2.info chat[2068]: timeout set to 30 seconds
Jun 20 12:07:03 MyOpenWRT local2.info chat[2068]: expect (OK)
Jun 20 12:07:03 MyOpenWRT local2.info chat[2068]: ^M
Jun 20 12:07:03 MyOpenWRT local2.info chat[2068]: AT+CGDCONT=1,&quot;IP&quot;,&quot;internet&quot;^M^M
Jun 20 12:07:03 MyOpenWRT local2.info chat[2068]: OK
Jun 20 12:07:03 MyOpenWRT local2.info chat[2068]:  -- got it
Jun 20 12:07:03 MyOpenWRT local2.info chat[2068]: send (ATD*99***1#^M)
Jun 20 12:07:03 MyOpenWRT local2.info chat[2068]: expect (CONNECT)
Jun 20 12:07:03 MyOpenWRT local2.info chat[2068]: ^M
Jun 20 12:07:03 MyOpenWRT local2.info chat[2068]: ATD*99***1#^M^M
Jun 20 12:07:03 MyOpenWRT local2.info chat[2068]: NO CARRIER
Jun 20 12:07:03 MyOpenWRT local2.info chat[2068]:  -- failed
Jun 20 12:07:03 MyOpenWRT local2.info chat[2068]: Failed (NO CARRIER)
Jun 20 12:07:03 MyOpenWRT daemon.err pppd[2063]: Connect script failed
root@MyOpenWRT:~#</code></pre></div><p>Please help...</p>											<p class="post-edited">(Last edited by <strong>tomlase</strong> on 25 Jun 2011, 12:26)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>