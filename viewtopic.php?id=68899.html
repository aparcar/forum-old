<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Favorite Poweruser Tweaks/Packages?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 5 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p346306">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">ExaltedVanguard</div>
					<div class="post-datetime">
						11 Dec 2016, 05:45					</div>
				</div>
				<div class="post-content content">
					<p>What&#039;s everyone&#039;s favorite packages and tweaks to improve performance or usability on a small home network?</p><p>So far I&#039;ve installed adblock and increased my dnsmasq cache size to 1500. Between those two changes my internet has been a bit snappier thanks to greater DNS caching and no need to lookup a ton of ad domains. And of course the end-user benefits of adblock.</p><p>In terms of usability, I set up a VPN server to connect to my home network with while on the road. And the DDNS client to go with it of course.</p><p>I also set up a connection to a private VPN server and can tunnel client traffic through it on a case-by-case basis. To be honest, I don&#039;t have much use for this anymore. It also, but I still have the VPN service so why not? My previous ISP throttled my connection if torrent traffic was detected. It was also throttling youtube(!!!) traffic. VPN solved both issues.</p><p>I also set up a samba server with an attached USB drive. I don&#039;t have a better NAS solution at the moment, so it does what I need it to do for now.</p><p>---</p><p>What other packages or tweaks are other users using to squeeze the most out of their networks?</p><p>I&#039;ve looked a little bit into squid-cache, but from what I could tell it probably wouldn&#039;t provide much benefit for a small home network. Thoughts on this?</p>											<p class="post-edited">(Last edited by <strong>ExaltedVanguard</strong> on 11 Dec 2016, 05:48)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p346403">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">N0man</div>
					<div class="post-datetime">
						12 Dec 2016, 00:23					</div>
				</div>
				<div class="post-content content">
					<p>luci-app-sqm and kmod-sched-cake are, in my opinion, the best packages for LEDE/OpenWRT.</p><p>CAKE now has an option to automatically give equal bandwidth to all devices in your network, regardless of how many connections they have open.</p><p>For example, If 1 client had 10 downloads going at once, and another had 1 download going, both would get 50%.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p346410">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">tapper</div>
					<div class="post-datetime">
						12 Dec 2016, 01:10					</div>
				</div>
				<div class="post-content content">
					<p>hi mate can you tel me how you increased yor dnsmasq cache size? I can find a lot of stuff on google but non for openwrt. thanks</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p346411">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">tapper</div>
					<div class="post-datetime">
						12 Dec 2016, 01:14					</div>
				</div>
				<div class="post-content content">
					<p>Or just paste your /etc/dnsmasq.conf If that&#039;s the rite file. <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p346412">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">tapper</div>
					<div class="post-datetime">
						12 Dec 2016, 01:21					</div>
				</div>
				<div class="post-content content">
					<p>addblock SQM and + I use opendns with dnscrypt</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p346428">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">tapper</div>
					<div class="post-datetime">
						12 Dec 2016, 07:04					</div>
				</div>
				<div class="post-content content">
					<p>I figured it out. What you do is edit the file /etc/dnsmasq.conf and add:</p><p># Set the size of the dnsmasq cache. The default is to keep 150 hostnames<br />cache-size=2048</p>											<p class="post-edited">(Last edited by <strong>tapper</strong> on 12 Dec 2016, 07:05)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p346465">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">mk24</div>
					<div class="post-datetime">
						12 Dec 2016, 15:57					</div>
				</div>
				<div class="post-content content">
					<p>SQM is really effective when users are running torrents or Dropbox or anything that sets out to max the upload bandwidth.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p346473">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">endvour</div>
					<div class="post-datetime">
						12 Dec 2016, 17:06					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>ExaltedVanguard wrote:</cite><blockquote><p>I&#039;ve looked a little bit into squid-cache, but from what I could tell it probably wouldn&#039;t provide much benefit for a small home network. Thoughts on this?</p></blockquote></div><p>I&#039;ve been experimenting with squid in the past weeks. I use it on a small network and I haven&#039;t noticed great improvements in performance, but I haven&#039;t done a lot of tweaking as far as caching is concerned. I personally love it for its great flexibility and power when it comes to filtering. E.g. the sslbump feature allows you to filter HTTPS too: you can do full traffic decryption (browsers need to trust your CA of course) or just do a little &quot;peek&quot; in order to get say the destination domain and do filtering based on whatever domain blacklist/whitelist you want. You can also do header filtering and who knows what else.<br />But if you&#039;re just interested in ad-blocking and improving performance on a small network it might be overkill.</p>											<p class="post-edited">(Last edited by <strong>endvour</strong> on 12 Dec 2016, 17:07)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p346522">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">RangerZ</div>
					<div class="post-datetime">
						13 Dec 2016, 00:04					</div>
				</div>
				<div class="post-content content">
					<p>If you are using a &quot;NAS&quot; you may want to add mini-DLNA</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p346533">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">ExaltedVanguard</div>
					<div class="post-datetime">
						13 Dec 2016, 01:38					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>tapper wrote:</cite><blockquote><p>hi mate can you tel me how you increased yor dnsmasq cache size? I can find a lot of stuff on google but non for openwrt. thanks</p></blockquote></div><p>For future reference, the &quot;proper&quot; way to do this on OpenWrt is editing the file /etc/config/dhcp and adding the following to the dnsmasq config section:<br /></p><div class="codebox"><pre><code>option cachesize &#039;1500&#039;</code></pre></div><p>1500 is overkill for a small network, but whatever. At 82 bytes/entry, a little extra cache isn&#039;t going to eat up any noticeable amount of RAM.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p346538">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">AndreL</div>
					<div class="post-datetime">
						13 Dec 2016, 02:42					</div>
				</div>
				<div class="post-content content">
					<p>If you&#039;re not the only one doing P2P in your house: luci-app-upnp</p><p>If your printer does&#039;t have built in WiFi: luci-app-p910nd</p><p>If your ISP changes IPv6 prefix very often: luci-app-radvd and some tricks.</p><p>If you want lag free connectivity (like everybody else): luci-app-sqm</p><p>If you want to start your PC remotely for remote access: luci-app-wol</p><p>If you want VPN: openvpn-polarssl</p><p>If you want to access your router/PC/VPN remotely but ISP has locked you behind CG-NAT: miredo-client</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p347608">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">ExaltedVanguard</div>
					<div class="post-datetime">
						24 Dec 2016, 21:40					</div>
				</div>
				<div class="post-content content">
					<p>I added sqm! Great suggestion!</p><p>I&#039;m also experimenting with the following:<br />I&#039;ve set dnsmasq to use a minimum 15 minute (well, 14m55s) cache time on DNS requests. This shouldn&#039;t have meaningful negative impacts on my small home network. I&#039;ve then created a list of commonly visited domains, including personal favorite and ubiquitous ones like Google domains. Every 15 minutes all these domains will be called with nslookup to keep them available in cache.</p><p>I chose 15 minutes so I wasn&#039;t spamming DNS servers every 5 minutes.</p><p>End result should be an internet that feels snapper all the time, rather than only after you get started. I at should be because I left town for the holidays right after I finished getting this set up.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p347609">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">augustus_meyer</div>
					<div class="post-datetime">
						24 Dec 2016, 22:01					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>ExaltedVanguard wrote:</cite><blockquote><p>I&#039;ve set dnsmasq to use a minimum 15 minute (well, 14m55s) cache time on DNS requests. This shouldn&#039;t have meaningful negative impacts on my small home network.</p></blockquote></div><p>Depends on. There are quite a few sites, like FB or goggle, which rotate their IPs quite fast, for load balancing. <br />Interfering with this by modding the TTL. as you effectively did, is not a good idea. Will be even worse, in case you did not make shure, that all clients really use you dnsmasq.</p><p>squid: Effect of squid on the router for a single user is neglectable because of browsers cache.<br />However, in case other members of your family visit cnn.com, after you dd in the morning, they will feel a snappier web access, indeed.</p>											<p class="post-edited">(Last edited by <strong>augustus_meyer</strong> on 24 Dec 2016, 22:10)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p357702">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">bernd.wechner</div>
					<div class="post-datetime">
						3 May 2017, 15:33					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>N0man wrote:</cite><blockquote><p>luci-app-sqm and kmod-sched-cake are, in my opinion, the best packages for LEDE/OpenWRT.</p><p>CAKE now has an option to automatically give equal bandwidth to all devices in your network, regardless of how many connections they have open.</p><p>For example, If 1 client had 10 downloads going at once, and another had 1 download going, both would get 50%.</p></blockquote></div><p>Cake sounds awesome. I searched on-line though and found nothing simple to explain just how to use it after installing&nbsp; kmod-sched-cake. Can you point us to a simple run down of HOW you achieve such a great results as you&#039;re describing? Would be even better if it could differentially allocate bandwidth, favouring some LAN IPs over others ...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p357708">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">makarel</div>
					<div class="post-datetime">
						3 May 2017, 16:34					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>ExaltedVanguard wrote:</cite><blockquote><p>...So far I&#039;ve installed adblock...</p></blockquote></div><p>can you point on howto?</p><p>these days i focus on connected user log(intrusion), wifi on/off schedule, wifi, network restart, mostly cli scripts<br />i already have ftp on usb... vsftp; samba is 2 big</p>											<p class="post-edited">(Last edited by <strong>makarel</strong> on 3 May 2017, 16:34)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p357723">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						3 May 2017, 19:37					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>bernd.wechner wrote:</cite><blockquote><div class="quotebox"><cite>N0man wrote:</cite><blockquote><p>luci-app-sqm and kmod-sched-cake are, in my opinion, the best packages for LEDE/OpenWRT.</p><p>CAKE now has an option to automatically give equal bandwidth to all devices in your network, regardless of how many connections they have open.</p><p>For example, If 1 client had 10 downloads going at once, and another had 1 download going, both would get 50%.</p></blockquote></div><p>Cake sounds awesome. I searched on-line though and found nothing simple to explain just how to use it after installing&nbsp; kmod-sched-cake. Can you point us to a simple run down of HOW you achieve such a great results as you&#039;re describing? Would be even better if it could differentially allocate bandwidth, favouring some LAN IPs over others ...</p></blockquote></div><p>for egress on eth1 quite simple:<br />tc qdisc add root cake bandwidth 1000Kbit</p><p>here is the output of &quot;tc qdisc add root cake help&quot; to explain a few of the options<br />Usage: ... cake [ bandwidth RATE | unlimited* | autorate_ingress ]<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [ rtt TIME | datacentre | lan | metro | regional |<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; internet* | oceanic | satellite | interplanetary ]<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [ besteffort | diffserv8 | diffserv4 | diffserv-llt |<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; diffserv3* ]<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [ flowblind | srchost | dsthost | hosts | flows |<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dual-srchost | dual-dsthost | triple-isolate* ]<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [ nat | nonat* ]<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [ wash | nowash * ]<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [ memlimit LIMIT ]<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [ ptm | atm | noatm* ] [ overhead N | conservative | raw* ]<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [ mpu N ]</p><p>for ingress you first need to create an IFB device:</p><p>&nbsp; &nbsp; tc qdisc del dev eth1 handle ffff: ingress 2&gt; /dev/null<br />&nbsp; &nbsp; tc qdisc add dev eth1 handle ffff: ingress</p><p>&nbsp; &nbsp; tc qdisc del dev ifb4eth1 root&nbsp; 2&gt; /dev/null</p><p>&nbsp; &nbsp; tc qdisc add dev ifb4eth1 root&nbsp; cake&nbsp; bandwidth 10000Kbit<br />&nbsp; &nbsp; $IP link set dev $DEV up</p><p>&nbsp; &nbsp; tc filter add dev eth1 parent ffff: protocol all prio 10 u32&nbsp; match u32 0 0 flowid 1:1 action mirred egress redirect dev ifb4eth1</p><p>But have a look at /usr/lib/sqm/piece_of_cake.qos (make sure to install sqm-scripts first).</p><div class="quotebox"><cite>bernd.wechner wrote:</cite><blockquote><p>Would be even better if it could differentially allocate bandwidth, favouring some LAN IPs over others ...</p></blockquote></div><p>This is outside of cake&#039;s scope as far as I can tell, so don&#039;t hold your breath waiting for that.<br />Hope that helps</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>