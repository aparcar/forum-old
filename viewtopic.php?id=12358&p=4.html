<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Support for Marvell 88F5xx81 based routers</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 18 Jan 2014 and 6 May 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 4 of 46</div><nav><ul><li><a href="viewtopic.php%3Fid=12358&amp;p=1.html">1</a></li><li><a href="viewtopic.php%3Fid=12358&amp;p=2.html">2</a></li><li><a href="viewtopic.php%3Fid=12358&amp;p=3.html">3</a></li><li class="pagination-current"><span>4</span></li><li><a href="viewtopic.php%3Fid=12358&amp;p=5.html">5</a></li><li><a href="viewtopic.php%3Fid=12358&amp;p=6.html">6</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=12358&amp;p=46.html">46</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p67855">
				<div class="post-metadata">
					<div class="post-num">Post #76</div>
					<div class="post-author">dirkNL</div>
					<div class="post-datetime">
						5 May 2008, 15:43					</div>
				</div>
				<div class="post-content content">
					<p>This weekend we did some more work on the WRT350N. Sadly not much progress...</p><p>First of all, to make things clear, We used the eabi toolchain from codesourcery to build the kernels this time. Because I read about it in this thread.<br />What have we tried this time:</p><p>-Vanilla sources 2.6.25.1, with the imported setup.c file from Davidkra&#039;s git repository. <br />---- Result:&nbsp; Kernel decompresses and nothing more after that</p><p>-Davidkra&#039;s repository (29-3-2008) clone.<br />---- Result: Can&#039;t build the kernel because of 1600 conflicts in the repository, could build an earlier version of the repos</p><p>-Davidkra&#039;s uploaded uImage in his git repository<br />---- Result: Again the same, just the decompress nothing more</p><p>-The 2.6.25 version of this: <a href="http://downloads.foonas.org/foonas-em/0.1.0-r2/lspro/uImage_2.6.25.1">http://downloads.foonas.org/foonas-em/0 … e_2.6.25.1</a> kernel<br />---- Result: Kernel decompresses and when done booting the system asks for login (the hydrog3n password)</p><p>So no luck this time, we wanted the .config file from the foonas image but we can&#039;t seem to find it (is it anywhere to be found?).<br />If we could use that config as base, we think we may be getting somewhere.</p>											<p class="post-edited">(Last edited by <strong>dirkNL</strong> on 5 May 2008, 15:49)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p67890">
				<div class="post-metadata">
					<div class="post-num">Post #77</div>
					<div class="post-author">mindbender</div>
					<div class="post-datetime">
						6 May 2008, 16:56					</div>
				</div>
				<div class="post-content content">
					<p>no problem i think. everythings available via the svn viewer or if you checkout the svn repository directly.</p><p>the defconfig + patches can be seen here (scroll down until you read &quot;linux orion&quot;):<br /><a href="http://svn.foonas.org/listing.php?repname=foonas&amp;path=%2Ffoonas%2Ftrunk%2Fopenembedded%2Fpackages%2Flinux%2Flinux-orion%2F#_foonas_trunk_openembedded_packages_linux_linux-orion_">http://svn.foonas.org/listing.php?repna … nux-orion_</a></p><p>defconfig:<br /><a href="http://svn.foonas.org/filedetails.php?repname=foonas&amp;path=%2Ffoonas%2Ftrunk%2Fopenembedded%2Fpackages%2Flinux%2Flinux-orion%2Fdefconfig-2.6.25.1">http://svn.foonas.org/filedetails.php?r … g-2.6.25.1</a></p><p>what is the actually console log? i think we had this problem before ...i think this could be related to the wrong mach-id that is used in your uboot bootloader (yes you read right <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" />, marvell is to blame for that)....can you please post the console output?</p>											<p class="post-edited">(Last edited by <strong>mindbender</strong> on 10 May 2008, 18:58)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p67897">
				<div class="post-metadata">
					<div class="post-num">Post #78</div>
					<div class="post-author">dirkNL</div>
					<div class="post-datetime">
						6 May 2008, 21:33					</div>
				</div>
				<div class="post-content content">
					<p>Here are my WRT350N v2.1 logs:</p><p>Boot part:<br /></p><div class="codebox"><pre><code>         __  __                      _ _
        |  \/  | __ _ _ ____   _____| | |
        | |\/| |/ _` | &#039;__\ \ / / _ \ | |
        | |  | | (_| | |   \ V /  __/ | |
        |_|  |_|\__,_|_|    \_/ \___|_|_|
 _   _     ____              _
| | | |   | __ )  ___   ___ | |_
| | | |___|  _ \ / _ \ / _ \| __|
| |_| |___| |_) | (_) | (_) | |_
 \___/    |____/ \___/ \___/ \__|  ** LOADER **
 ** MARVELL BOARD: RD-88F5181L-VOIP-GE LE

U-Boot 1.1.1 (Dec 12 2006 - 16:12:22) Marvell version: 1.7.3

DRAM CS[0] base 0x00000000   size  32MB
DRAM Total size  32MB
Flash: mvFlashInit base 0xff800000 devW 1 busW 1
Flash: flashStructGet manu 0xec id 0xe0
Flash: flashStructGet flash is supported.
FLASH: initFlashSecs TOP Sector Type
Flash: flashSecsInit main sector loop 0 - 127
[8192kB@ff800000] Flash:  8 MB
Addresses 20M - 0M are saved for the U-Boot usage.
Mem malloc Initialization (20M - 16M): Done
*** Warning - bad CRC, using default environment


Soc: MV88F5181 Rev 9
CPU: ARM926 (Rev 0) running @ 500Mhz
SysClock = 166Mhz , TClock = 166Mhz


USB 0: host mode
PCI 0: PCI Express Root Complex Interface
PCI 1: Conventional PCI, speed = 33000000
Net:   mvEgigaLoad: egiga0 load ok
egiga0 [PRIME]

***************DRIVER INFO*****************

DRIVER BUILD DATA: Jan  9 2007 at 18:25:44
DRIVER VERSION 1.06

*******************************************
dbSign is:65:52:63:4f:6d:4d
mac address in flash is:00:1d:7e:ad:cc:08
have eRcOmM
Hit ENTER to stop autoboot:  0
copy kernel from 0xff800000 to 0x400000 with size 0x200000
## Booting image at 00400000 ...
   Image Name:   Linux-2.6.12-arm1
   Image Type:   ARM Linux Kernel Image (uncompressed)
   Data Size:    1509616 Bytes =  1.4 MB
   Load Address: 00008000
   Entry Point:  00008000
   Verifying Checksum ... OK
OK

Starting kernel ...

Uncompressing Linux................................................................................................... done, booting the kernel.
Linux version 2.6.12-arm1 (root@localhost.localdomain) (gcc version 3.4.4 (release) (CodeSourcery ARM 2005q3-2)) #1 Fri Sep 28 12:56:43 CST 2007
CPU: ARM926EJ-Sid(wb) [41069260] revision 0 (ARMv5TEJ)
CPU0: D VIVT write-back cache
CPU0: I cache: 32768 bytes, associativity 1, 32 byte lines, 1024 sets
CPU0: D cache: 32768 bytes, associativity 1, 32 byte lines, 1024 sets
Machine: MV-88fxx81
Using UBoot passing parameters structure
Sys Clk = 166000000, Tclk = 166000000
Memory policy: ECC disabled, Data cache writeback
Built 1 zonelists
Kernel command line: console=ttyS0,115200 root=/dev/mtdblock1 rw
PID hash table entries: 256 (order: 8, 4096 bytes)
Console: colour dummy device 80x30
Dentry cache hash table entries: 8192 (order: 3, 32768 bytes)
Inode-cache hash table entries: 4096 (order: 2, 16384 bytes)
Memory: 32MB 0MB 0MB 0MB = 32MB total
Memory: 28928KB available (2496K code, 877K data, 100K init)
Mount-cache hash table entries: 512
CPU: Testing write buffer coherency: ok
NET: Registered protocol family 16
Flash bankwidth 1, base f4000000, size 800000

  Marvell Development Board (LSP Version 1.8.5)-- RD-88F5181L-VOIP-GE

 Detected Tclk 166000000 and SysClk 166000000
Marvell USB EHCI Host controller #0: c03fbb00
pexBarOverlapDetect: winNum 2 overlap current 0
mvPexInit:Warning :Bar 2 size is illigal
it will be disabled
please check Pex and CPU windows configuration
PCI: bus0: Fast back to back transfers enabled
PCI: bus1: Fast back to back transfers enabled
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
pci access ctrl reg 0x31e00&#039;s value = 0x00000a01
pci access ctrl size reg 0x31e08&#039;s value = 0x07fff000
SCSI subsystem initialized
Linux Kernel Card Services
  options:  [pci]
usbcore: registered new driver usbfs
usbcore: registered new driver hub
TWSI: twsiAddr7BitSet ERROR - Addr (7 Bit) int TimeOut.
TWSI: mvTwsiStopBitSet ERROR - status 0 after Stop Bit.
TWSI: mvTwsiStartBitSet ERROR - start bit didn&#039;t went down
TWSI: mvTwsiStopBitSet ERROR - status 0 after Stop Bit.
TWSI: mvTwsiStartBitSet ERROR - start bit didn&#039;t went down
TWSI: mvTwsiStopBitSet ERROR - status 0 after Stop Bit.
TWSI: mvTwsiStartBitSet ERROR - start bit didn&#039;t went down
TWSI: mvTwsiStopBitSet ERROR - status 0 after Stop Bit.
TWSI: mvTwsiStartBitSet ERROR - start bit didn&#039;t went down
TWSI: mvTwsiStopBitSet ERROR - status 0 after Stop Bit.
TWSI: mvTwsiStartBitSet ERROR - start bit didn&#039;t went down
TWSI: mvTwsiStopBitSet ERROR - status 0 after Stop Bit.
TWSI: mvTwsiStartBitSet ERROR - start bit didn&#039;t went down
TWSI: mvTwsiStopBitSet ERROR - status 0 after Stop Bit.
use IDMA acceleration in copy to/from user buffers. used channels 2 and 3
Done.
Fast Floating Point Emulator V0.9 (c) Peter Teichmann.
squashfs: version 3.0 (2006/03/15) Phillip Lougher
JFFS2 version 2.2. (C) 2001-2003 Red Hat, Inc.
Initializing Cryptographic API
HDLC line discipline: version $Revision: 1.1.1.1 $, maxframe=4096
N_HDLC line discipline registered.
Serial: 8250/16550 driver $Revision: 1.1.1.1 $ 4 ports, IRQ sharing disabled
ttyS0 at MMIO 0x0 (irq = 3) is a 16550A
io scheduler noop registered
io scheduler anticipatory registered
io scheduler deadline registered
io scheduler cfq registered
loop: loaded (max 8 devices)
Loading Marvell Gatway Driver:
multi queue enabled
prioritizing ToS 0xA0
eth0: 00:00:00:00:51:81, group-id 0x100, group-members are port-CPU port-1 port-2 port-3 port-4
eth1: 00:00:00:00:51:82, group-id 0x200, group-members are port-CPU port-0
init switch layer... gcosSetPortDefaultTc failed (port 8)
gcosSetPortDefaultTc failed (port 8)
gcosSetPortDefaultTc failed (port 8)
gcosSetPortDefaultTc failed (port 8)
gcosSetPortDefaultTc failed (port 8)
gcosSetPortDefaultTc failed (port 8)
gcosSetPortDefaultTc failed (port 8)
gcosSetPortDefaultTc failed (port 8)
done
init gigabit layer... done
loading network interfaces: eth0 eth1
PPP generic driver version 2.4.2
PPP Deflate Compression module registered
PPP BSD Compression module registered
NET: Registered protocol family 24
SLIP: version 0.8.4-NET3.019-NEWTTY (dynamic channels, max=256).
STRIP: Version 1.3A-STUART.CHESHIRE (unlimited channels)
physmap flash device: 800000 at f4000000
phys_mapped_flash: Found 1 x16 devices at 0x0 in 8-bit bank
 Amd/Fujitsu Extended Query Table at 0x0040
phys_mapped_flash: Swapping erase regions for broken CFI table.
number of CFI chips: 1
cfi_cmdset_0002: Disabling erase-suspend-program due to code brokenness.
Using physmap partition definition
Creating 5 MTD partitions on &quot;phys_mapped_flash&quot;:
0x00000000-0x00760000 : &quot;kernel&quot;
0x001a0000-0x00760000 : &quot;rootfs&quot;
0x00760000-0x007a0000 : &quot;lang&quot;
0x007a0000-0x007c0000 : &quot;nvram&quot;
0x007c0000-0x00800000 : &quot;u-boot&quot;
ehci_platform ehci_platform.4523: EHCI Host Controller
ehci_platform ehci_platform.4523: new USB bus registered, assigned bus number 1
ehci_platform ehci_platform.4523: irq 17, io mem 0x00000000
ehci_platform ehci_platform.4523: park 0
ehci_platform ehci_platform.4523: USB 0.0 initialized, EHCI 1.00, driver 10 Dec 2004
hub 1-0:1.0: USB hub found
hub 1-0:1.0: 1 port detected
USB Universal Host Controller Interface driver v2.2
Initializing USB Mass Storage driver...
usbcore: registered new driver usb-storage
USB Mass Storage support registered.
mice: PS/2 mouse device common for all mice
u32 classifier
    OLD policer on
NET: Registered protocol family 2
IP: routing cache hash table of 512 buckets, 4Kbytes
/proc/eth1_tm created
TCP established hash table entries: 2048 (order: 2, 16384 bytes)
TCP bind hash table entries: 2048 (order: 1, 8192 bytes)
TCP: Hash tables configured (established 2048 bind 2048)
ip_conntrack version 2.1 (256 buckets, 2048 max) - 268 bytes per conntrack
ip_conntrack_rtsp v0.6.21 loading
ip_nat_rtsp v0.6.21 loading
ip_tables: (C) 2000-2002 Netfilter core team
netfilter PSD loaded - (c) astaro AG
ipt_random match loaded
ip_conntrack_pptp version 3.0 loaded
ip_nat_pptp version 3.0 loaded
NET: Registered protocol family 1
NET: Registered protocol family 17
802.1Q VLAN Support v1.8 Ben Greear &lt;greearb@candelatech.com&gt;
All bugs added by David S. Miller &lt;davem@redhat.com&gt;
VFS: Mounted root (squashfs filesystem) readonly.
Freeing init memory: 100K
init started:  BusyBox v1.1.0 (2007.09.28-05:12+0000) multi-call binary
init started:  BusyBox v1.1.0 (2007.09.28-05:12+0000) multi-call binary
Starting pid 202, console /dev/console: &#039;/etc/rcS&#039;
ipt_webstr: module license &#039;unspecified&#039; taints kernel.
ufsd: driver loaded
UFSD version 5.28 (Nov  8 2006, 21:54:59)
NTFS read/write support included

ufsd: address 0xbf030538
mv_gateway: starting eth0
mv_gateway: starting eth1
V2.00.17
device eth0 entered promiscuous mode
ap_name=(null),action=start
rc_start: ap-&gt;name = lan
br0: port 1(eth0) entering learning state
br0: topology change detected, propagating
br0: port 1(eth0) entering forwarding state
rc_start: ap-&gt;name = printk
start printk...
rc_start: ap-&gt;name = wlan
start wifi
/sbin/brctl addif br0 ath0
ath0
Interface doesn&#039;t accept private ioctl...
maccmd (8BE0): Invalid argument
wlan up!!
rc_start: ap-&gt;name = syslogd
start syslog...
syslog_cmd=-R 192.168.1.100:514
rc_start: ap-&gt;name = httpd
start httpd...
tar: Short read
rc_start: ap-&gt;name = dhcpd
start dhcpd...
rc_start: ap-&gt;name = ntp
rc_start: ap-&gt;name = route
rc_start: ap-&gt;name = ripd
rc_start: ap-&gt;name = ftpd
killall: bftpd: no process killed
open /proc/wps_button
mac = NOT NULL
mac = 001d7eadcc08
mac = NOT NULL
mac = 001d7eadcc08
ap_name=firewall,action=stop
rc_stop: ap-&gt;name = firewall
/usr/sbin/fw-scripts/firewall: .: 19: Can&#039;t open /tmp/firewall.conf
killall: reaim: no process killed
mac = NOT NULL
mac = 001d7eadcc08

        00 1D 7E AD CC 08
mac = NOT NULL
mac = 001d7eadcc08
killall: IGMPProxy: no process killed
Configuration file: /tmp/madwifi.conf
Configure bridge br0 for EAPOL traffic.
madwifi_set_iface_flags: dev_up=0
Using interface ath0 with hwaddr 00:1d:7e:ad:cc:08 and ssid &#039;zaphod&#039;
madwifi_set_ieee8021x: enabled=1
madwifi_configure_wpa: group key cipher=1
madwifi_configure_wpa: pairwise key ciphers=0x2
madwifi_configure_wpa: key management algorithms=0x2
madwifi_configure_wpa: rsn capabilities=0x0
madwifi_configure_wpa: enable WPA= 0x1
madwifi_set_iface_flags: dev_up=1
madwifi_set_privacy: enabled=1
wpa_write_wpa_ie 203 wsc_enable = 1
wpa_write_wpa_ie 204 hapd-&gt;conf-&gt;wpa_key_mgmt = 2
WPA: group state machine entering state GTK_INIT
GMK - hexdump(len=32): 93 cf 07 ad 8d 0f 64 f0 1b a2 37 24 fa c8 fb 5d d0 3c 2a 0c 9f e3 f9 8c 81 e3 ea f6 01 21 2c 33
GTK - hexdump(len=32): 59 d8 c1 47 f2 27 8a c2 36 41 f9 bf cf 9f 69 ab 4d c7 ca 3a 36 2b 7d c5 cd 29 2f 89 a6 2d f5 0b
WPA: group state machine entering state SETKEYSDONE
madwifi_set_key: alg=TKIP addr=00:00:00:00:00:00 key_idx=1
Flushing old station entries
Deauthenticate all stations
RTNETLINK answers: No such file or directory
RTNETLINK answers: No such file or directory
ap_name=dhcpd,action=create
rc_create: ap-&gt;name = dhcpd
ap_name=(null),action=restart
rc_stop: ap-&gt;name = wan_basic
rc_stop: ap-&gt;name = firewall
ap_name=ripd,action=restart
/usr/sbin/fw-scripts/firewall: .: 19: Can&#039;t open /tmp/firewall.conf
rc_stop: ap-&gt;name = ripd
killall: reaim: no process killed
killall: routed: no process killed
rc_start: ap-&gt;name = ripd
killall: IGMPProxy: no process killed
/etc/rcS: /etc/rcS: 83: cannot create /proc/sys/vm/pagetable_cache: Directory nonexistent
RTNETLINK answers: No such file or directory
RTNETLINK answers: No such file or directory
rc_start: ap-&gt;name = wan_basic
rc_start: ap-&gt;name = firewall
rmmod: ip_nat_ftp.ko: No such file or directory
rmmod: ip_conntrack_ftp.ko: No such file or directory
Starting firewalliptables: No chain/target/match by that name
iptables: No chain/target/match by that name
ap_name=mediaserver,action=start
rc_start: ap-&gt;name = mediaserver
proxy:1
rc_start: ap-&gt;name = static_route
rc_start: ap-&gt;name = ddns
ap_name=wscupnp,action=start
rc_start: ap-&gt;name = wscupnp
[cmd_agent1]iptables -I FORWARD -i eth1 -d 224.0.1.60 -j ACCEPT
The interface br0 exist !
The interface ath0 exist !
mac = NOT NULL
mac = 001d7eadcc08
wsc_uuid=e7fe1b91-8cd5-0310-98dd-001d7eadcc08
ap_name=upnp,action=start
rc_start: ap-&gt;name = upnp
killall: upnpd: no process killed
route: SIOC[ADD|DEL]RT: File exists

Please press Enter to activate this console. UPnP Initialized
Intialized UPnP
        with fullurl=http://192.168.0.1:49153/gateway.xml
                     ipaddress=192.168.0.1 port=49153
             web_dir_path=/usr/upnp/
             desc_doc_url=http://192.168.0.1:49153
Specifying the webserver root directory -- /usr/upnp/
Registering the RootDevice
RootDevice Registered
Initializing State Table
fullurl http://192.168.0.1:49153/gateway.xml
Advertisements Sent</code></pre></div><p>/proc etc part:<br /></p><div class="codebox"><pre><code>~ # cat /proc/version
Linux version 2.6.12-arm1 (root@localhost.localdomain) (gcc version 3.4.4 (release) (CodeSourcery ARM 2005q3-2)) #1 Fri Sep 28 12:56:43 CST 2007
~ # cat /proc/cpuinfo
c/iomem
ifconfig
dmesgProcessor  : ARM926EJ-Sid(wb) rev 0 (v5l)
BogoMIPS        : 331.77
Features        : swp half thumb fastmult edsp java
CPU implementer : 0x41
CPU architecture: 5TEJ
CPU variant     : 0x0
CPU part        : 0x926
CPU revision    : 0
Cache type      : write-back
Cache clean     : cp15 c7 ops
Cache lockdown  : format C
Cache format    : Harvard
I size          : 32768
I assoc         : 1
I line length   : 32
I sets          : 1024
D size          : 32768
D assoc         : 1
D line length   : 32
D sets          : 1024

Hardware        : MV-88fxx81
Revision        : 0000
Serial          : 0000000000000000
~ # cat /proc/mtd
dev:    size   erasesize  name
mtd0: 00760000 00010000 &quot;kernel&quot;
mtd1: 005c0000 00010000 &quot;rootfs&quot;
mtd2: 00040000 00010000 &quot;lang&quot;
mtd3: 00020000 00010000 &quot;nvram&quot;
mtd4: 00040000 00010000 &quot;u-boot&quot;
~ # cat /proc/modules
ip_nat_ftp 2912 0 - Live 0xbf107000
ip_conntrack_ftp 71968 1 ip_nat_ftp, Live 0xbf0f4000
wsc_daemon 2208 0 - Live 0xbf0f2000
wlan_tkip 12160 2 - Live 0xbf0ee000
wlan_xauth 1120 0 - Live 0xbf0ec000
ath_pci 138064 0 - Live 0xbf0c9000
ath_dfs 25772 1 ath_pci, Live 0xbf0c1000
ath_rate_atheros 28612 1 ath_pci, Live 0xbf0b9000
wlan 207016 5 wlan_tkip,wlan_xauth,ath_pci,ath_rate_atheros, Live 0xbf085000
ath_hal 183152 3 ath_pci,ath_rate_atheros, Live 0xbf057000
kwsc_mod 24456 2 wsc_daemon,wlan, Live 0xbf050000
ufsd 292976 0 - Live 0xbf007000
ipt_webstr 3712 0 - Live 0xbf005000
pb 3876 2 - Live 0xbf003000
led 5044 0 - Live 0xbf000000
~ # cat /proc/devices
Character devices:
  1 mem
  2 pty
  3 ttyp
  4 /dev/vc/0
  4 tty
  4 ttyS
  5 /dev/tty
  5 /dev/console
  5 /dev/ptmx
  7 vcs
 10 misc
 13 input
 90 mtd
108 ppp
128 ptm
136 pts
180 usb
254 pcmcia

Block devices:
  7 loop
  8 sd
 31 mtdblock
 65 sd
 66 sd
 67 sd
 68 sd
 69 sd
 70 sd
 71 sd
128 sd
129 sd
130 sd
131 sd
132 sd
133 sd
134 sd
135 sd
~ # cat /proc/meminfo
MemTotal:        29036 kB
MemFree:          9200 kB
Buffers:          1540 kB
Cached:           8284 kB
SwapCached:          0 kB
Active:           5148 kB
Inactive:         6484 kB
HighTotal:           0 kB
HighFree:            0 kB
LowTotal:        29036 kB
LowFree:          9200 kB
SwapTotal:           0 kB
SwapFree:            0 kB
Dirty:               0 kB
Writeback:           0 kB
Mapped:           3064 kB
Slab:             5328 kB
CommitLimit:     14516 kB
Committed_AS:     4512 kB
PageTables:        316 kB
VmallocTotal:   483328 kB
VmallocUsed:      8692 kB
VmallocChunk:   474568 kB
~ # cat /proc/iomem
00000000-01ffffff : System RAM
  00021000-002911ef : Kernel text
  00292000-0036d41b : Kernel data
e0000000-e7ffffff : PCI Memory Primary
e8000000-efffffff : PCI Memory Primary
  e8000000-e800ffff : 0000:01:07.0
    e8000000-e800ffff : ath
f4000000-f47fffff : flashMap
~ # ifconfig
ath0      Link encap:Ethernet  HWaddr 00:1D:7E:AD:CC:08
          UP BROADCAST RUNNING MULTICAST  MTU:2290  Metric:1
          RX packets:1156 errors:0 dropped:0 overruns:0 frame:0
          TX packets:269 errors:0 dropped:75 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:31365 (30.6 KiB)  TX bytes:58800 (57.4 KiB)

br0       Link encap:Ethernet  HWaddr 00:1D:7E:AD:CC:08
          inet addr:192.168.0.1  Bcast:192.168.0.255  Mask:255.255.255.0
          UP BROADCAST RUNNING PROMISC ALLMULTI MULTICAST  MTU:1500  Metric:1
          RX packets:1537 errors:0 dropped:0 overruns:0 frame:0
          TX packets:343 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:76100 (74.3 KiB)  TX bytes:100018 (97.6 KiB)

eth0      Link encap:Ethernet  HWaddr 00:1D:7E:AD:CC:08
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:386 errors:0 dropped:0 overruns:0 frame:0
          TX packets:302 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:70453 (68.8 KiB)  TX bytes:70204 (68.5 KiB)
          Interrupt:21

eth1      Link encap:Ethernet  HWaddr 00:1D:7E:AD:CC:09
          inet addr:145.99.241.243  Bcast:145.99.255.255  Mask:255.255.255.248
          UP BROADCAST RUNNING PROMISC ALLMULTI MULTICAST  MTU:1500  Metric:1
          RX packets:208 errors:0 dropped:0 overruns:0 frame:0
          TX packets:231 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:512
          RX bytes:54911 (53.6 KiB)  TX bytes:45697 (44.6 KiB)
          Interrupt:21

lo        Link encap:Local Loopback
          inet addr:127.0.0.1  Mask:255.0.0.0
          UP LOOPBACK RUNNING  MTU:16436  Metric:1
          RX packets:70 errors:0 dropped:0 overruns:0 frame:0
          TX packets:70 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:17676 (17.2 KiB)  TX bytes:17676 (17.2 KiB)

wifi0     Link encap:Ethernet  HWaddr 00:1D:7E:AD:CC:08
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:1163 errors:0 dropped:0 overruns:0 frame:0
          TX packets:276 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:52510 (51.2 KiB)  TX bytes:71099 (69.4 KiB)
          Interrupt:36 Memory:c2860000-c2870000

~ # dmesg
ufsd: address 0xbf030538
mv_gateway: starting eth0
mv_gateway: starting eth1
device eth0 entered promiscuous mode
br0: port 1(eth0) entering learning state
br0: topology change detected, propagating
br0: port 1(eth0) entering forwarding state
lock init
create wsc_cfb entry
create wsc_cfb entry
create wsc_iechange entry
create wsc_userset entry
ath_hal: 0.9.14.25 (AR5416, DEBUG)
wlan: 0.8.4.2 (Atheros/multi-bss)
ath_rate_atheros: Version 2.0.1
Copyright (c) 2001-2004 Atheros Communications, Inc, All Rights Reserved
ath_dfs: Version 2.0.0
Copyright (c) 2005-2006 Atheros Communications, Inc. All Rights Reserved
ath_pci: 0.9.4.5 (Atheros/multi-bss)
Chan  Freq  RegPwr  HT   CTL CTL_U CTL_L DFS
   1  2412n     27  HT20  1    0    1     N
   1  2412n     20  HT40  1    0    1     N
   2  2417n     20  HT40  1    0    1     N
   3  2422n     20  HT40  1    1    1     N
   4  2427n     20  HT40  1    1    1     N
   5  2432n     20  HT40  1    1    1     N
   6  2437n     20  HT40  1    1    1     N
   7  2442n     20  HT40  1    1    1     N
   8  2447n     20  HT40  1    1    1     N
   9  2452n     20  HT40  1    1    1     N
  10  2457n     20  HT40  1    1    1     N
  11  2462n     20  HT40  1    1    1     N
  12  2467n     20  HT40  1    1    0     N
  13  2472n     20  HT40  1    1    0     N
register_simple_config_callback called
wifi0: 11ng rates: 1Mbps 2Mbps 5.5Mbps 11Mbps 6Mbps 9Mbps 12Mbps 18Mbps 24Mbps 36Mbps 48Mbps 54Mbps
wifi0: 11ng MCS:  0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15
wifi0: mac 13.2 phy 8.1 radio 13.0
wifi0: Use hw queue 1 for WME_AC_BE traffic
wifi0: Use hw queue 0 for WME_AC_BK traffic
wifi0: Use hw queue 2 for WME_AC_VI traffic
wifi0: Use hw queue 3 for WME_AC_VO traffic
wifi0: Use hw queue 8 for CAB traffic
wifi0: Use hw queue 9 for beacons
wifi0: Atheros 5416 PCI: mem=0xe8000000, irq=36 hw_base=0xc2860000
ar5416SetPowerPerRateTable() syn 2412 ctl 2412 ext 2412 is40 0
  6mb OFDM  15.0 dBm |  9mb OFDM  15.0 dBm | 12mb OFDM  15.0 dBm | 18mb OFDM  15.0 dBm
 24mb OFDM  15.0 dBm | 36mb OFDM  15.0 dBm | 48mb OFDM  15.0 dBm | 54mb OFDM  15.0 dBm
 1L   CCK   17.0 dBm | 2L   CCK   17.0 dBm | 2S   CCK   17.0 dBm | 5.5L CCK   17.0 dBm
 5.5S CCK   17.0 dBm | 11L  CCK   17.0 dBm | 11S  CCK   17.0 dBm | XR         15.0 dBm
 HT20mcs 0  14.0 dBm | HT20mcs 1  14.0 dBm | HT20mcs 2  14.0 dBm | HT20mcs 3  14.0 dBm
 HT20mcs 4  14.0 dBm | HT20mcs 5  14.0 dBm | HT20mcs 6  13.0 dBm | HT20mcs 7  11.0 dBm
 HT40mcs 0   0.0 dBm | HT40mcs 1   0.0 dBm | HT40mcs 2   0.0 dBm | HT40mcs 3   0.0 dBm
 HT40mcs 4   0.0 dBm | HT40mcs 5   0.0 dBm | HT40mcs 6   0.0 dBm | HT40mcs 7   0.0 dBm
 Dup CCK     0.0 dBm | Dup OFDM    0.0 dBm | Ext CCK     0.0 dBm | Ext OFDM    0.0 dBm
2xAntennaReduction: 6, 2xMaxRegulatory: 54, 2xPowerLimit: 60
2xMaxPowerLevel: 28 (HT20)
TPC Enabled 1 1 0
ar5416SetPowerPerRateTable() syn 2412 ctl 2412 ext 2412 is40 0
  6mb OFDM  15.0 dBm |  9mb OFDM  15.0 dBm | 12mb OFDM  15.0 dBm | 18mb OFDM  15.0 dBm
 24mb OFDM  15.0 dBm | 36mb OFDM  15.0 dBm | 48mb OFDM  15.0 dBm | 54mb OFDM  15.0 dBm
 1L   CCK   17.0 dBm | 2L   CCK   17.0 dBm | 2S   CCK   17.0 dBm | 5.5L CCK   17.0 dBm
 5.5S CCK   17.0 dBm | 11L  CCK   17.0 dBm | 11S  CCK   17.0 dBm | XR         15.0 dBm
 HT20mcs 0  14.0 dBm | HT20mcs 1  14.0 dBm | HT20mcs 2  14.0 dBm | HT20mcs 3  14.0 dBm
 HT20mcs 4  14.0 dBm | HT20mcs 5  14.0 dBm | HT20mcs 6  13.0 dBm | HT20mcs 7  11.0 dBm
 HT40mcs 0   0.0 dBm | HT40mcs 1   0.0 dBm | HT40mcs 2   0.0 dBm | HT40mcs 3   0.0 dBm
 HT40mcs 4   0.0 dBm | HT40mcs 5   0.0 dBm | HT40mcs 6   0.0 dBm | HT40mcs 7   0.0 dBm
 Dup CCK     0.0 dBm | Dup OFDM    0.0 dBm | Ext CCK     0.0 dBm | Ext OFDM    0.0 dBm
2xAntennaReduction: 6, 2xMaxRegulatory: 54, 2xPowerLimit: 60
2xMaxPowerLevel: 30 (LEG)
device ath0 entered promiscuous mode
 wsc_daemon_init
create wsc_pushbutton entry
lock_write_proc: count = 260 sizeof(wsc_cfb)=260
 wsc_enable=1
 wsc_context=1
 wsc_version=0x10
 wsc_devcfstat=1
 wsc_admin.role=0
 wsc_admin.pwdMode=1
 wsc_admin.wsc_pin=00000000
 wsc_admin.seesionTimeout=120
 wsc_admin.retransmitTimeout=15
 wsc_admin.retryLimit=300
 wsc_admin.messageTimeout=0
 wsc_admin.configured=0
 wsc_admin.pbcIsRunning=0
 wsc_admin.selectedReg=0
 wsc_admin.selectedRegTime=0
 wsc_admin.selectRegConfigMethod=0
 wsc_admin.selectRegDevPwdId=0
 wsc_admin.selfPbcPressed=0
 wsc_admin.selfPbcPressedTime=0
 wsc_mac=00:1d:7e:ad:cc:08
 wsc_manfa=LINKSYS
 wsc_ssid=zaphod
 wsc_modelname=WRT350Nv2
 wsc_modelnumber=WSC0001
 wsc_serialnumber=0001000004E044
 wsc_devicename=LINKSYS-WRT350Nv2
 wsc_encrytype=4
lock_write_proc: count = 28 sizeof(wsc_cfb)=28
 role=0
 pwdMode=0
 wsc_context=1
 wsc_iechanged=0
 configured=1
 selectedReg=0
 selectRegConfigMethod=0x00
 selectRegDevPwdId=0x00
 wsc_admin.wsc_pin=00000000
ar5416SetPowerPerRateTable() syn 2412 ctl 2412 ext 2412 is40 0
  6mb OFDM  15.0 dBm |  9mb OFDM  15.0 dBm | 12mb OFDM  15.0 dBm | 18mb OFDM  15.0 dBm
 24mb OFDM  15.0 dBm | 36mb OFDM  15.0 dBm | 48mb OFDM  15.0 dBm | 54mb OFDM  15.0 dBm
 1L   CCK   17.0 dBm | 2L   CCK   17.0 dBm | 2S   CCK   17.0 dBm | 5.5L CCK   17.0 dBm
 5.5S CCK   17.0 dBm | 11L  CCK   17.0 dBm | 11S  CCK   17.0 dBm | XR         15.0 dBm
 HT20mcs 0  14.0 dBm | HT20mcs 1  14.0 dBm | HT20mcs 2  14.0 dBm | HT20mcs 3  14.0 dBm
 HT20mcs 4  14.0 dBm | HT20mcs 5  14.0 dBm | HT20mcs 6  13.0 dBm | HT20mcs 7  11.0 dBm
 HT40mcs 0   0.0 dBm | HT40mcs 1   0.0 dBm | HT40mcs 2   0.0 dBm | HT40mcs 3   0.0 dBm
 HT40mcs 4   0.0 dBm | HT40mcs 5   0.0 dBm | HT40mcs 6   0.0 dBm | HT40mcs 7   0.0 dBm
 Dup CCK     0.0 dBm | Dup OFDM    0.0 dBm | Ext CCK     0.0 dBm | Ext OFDM    0.0 dBm
2xAntennaReduction: 6, 2xMaxRegulatory: 54, 2xPowerLimit: 60
2xMaxPowerLevel: 28 (HT20)
TPC Enabled 1 1 0
Force rf_pwd_icsyndiv to 1 on 2412 (1 2)
ath_newstate: Resetting VAP dfswait_run
ath_newstate: Resetting VAP dfswait_run
ar5416SetPowerPerRateTable() syn 2437 ctl 2427 ext 2447 is40 1
  6mb OFDM  17.0 dBm |  9mb OFDM  17.0 dBm | 12mb OFDM  17.0 dBm | 18mb OFDM  17.0 dBm
 24mb OFDM  17.0 dBm | 36mb OFDM  17.0 dBm | 48mb OFDM  16.0 dBm | 54mb OFDM  15.0 dBm
 1L   CCK   19.0 dBm | 2L   CCK   19.0 dBm | 2S   CCK   19.0 dBm | 5.5L CCK   19.0 dBm
 5.5S CCK   19.0 dBm | 11L  CCK   19.0 dBm | 11S  CCK   19.0 dBm | XR         17.0 dBm
 HT20mcs 0  18.0 dBm | HT20mcs 1  18.0 dBm | HT20mcs 2  18.0 dBm | HT20mcs 3  18.0 dBm
 HT20mcs 4  18.0 dBm | HT20mcs 5  17.0 dBm | HT20mcs 6  13.0 dBm | HT20mcs 7  11.0 dBm
 HT40mcs 0  12.5 dBm | HT40mcs 1  12.5 dBm | HT40mcs 2  12.5 dBm | HT40mcs 3  12.5 dBm
 HT40mcs 4  12.5 dBm | HT40mcs 5  12.5 dBm | HT40mcs 6  12.5 dBm | HT40mcs 7  11.0 dBm
 Dup CCK    12.5 dBm | Dup OFDM   12.5 dBm | Ext CCK    19.0 dBm | Ext OFDM   17.0 dBm
2xAntennaReduction: 0, 2xMaxRegulatory: 40, 2xPowerLimit: 60
2xMaxPowerLevel: 25 (HT40)
TPC Enabled 1 1 0
Force rf_pwd_icsyndiv to 2 on 2437 (1 2)
ath_chan_set: Changing to channel 2427, Flags 30080, PF 0
br0: topology change detected, propagating
br0: port 2(ath0) entering forwarding state
download uses obsolete (PF_INET,SOCK_PACKET)
device eth1 entered promiscuous mode
device br0 entered promiscuous mode
~ #</code></pre></div>											<p class="post-edited">(Last edited by <strong>dirkNL</strong> on 6 May 2008, 21:40)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p67932">
				<div class="post-metadata">
					<div class="post-num">Post #79</div>
					<div class="post-author">mindbender</div>
					<div class="post-datetime">
						7 May 2008, 21:05					</div>
				</div>
				<div class="post-content content">
					<p>i mean the console log with a non working kernel.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p67933">
				<div class="post-metadata">
					<div class="post-num">Post #80</div>
					<div class="post-author">dirkNL</div>
					<div class="post-datetime">
						7 May 2008, 21:07					</div>
				</div>
				<div class="post-content content">
					<p>As I stated in my post with test results, the kernel boots but hangs after decompression, no error or whatsoever just the dots showing the decompress progress</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p67935">
				<div class="post-metadata">
					<div class="post-num">Post #81</div>
					<div class="post-author">mindbender</div>
					<div class="post-datetime">
						7 May 2008, 21:38					</div>
				</div>
				<div class="post-content content">
					<p>erm. no wonder that foonas-em kernel gives you a prompt.</p><p>actually foonas-em by design has its own initramfs inside. it was designed to be a recovery kernel so it is possible to access the hdd when the hdd-distro does not boot anymore. telnet is enabled...</p><p>the vanilla kernel probably has problems to boot to the rootfs which sits in flash. you are sure it boots to the right device?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p67937">
				<div class="post-metadata">
					<div class="post-num">Post #82</div>
					<div class="post-author">dirkNL</div>
					<div class="post-datetime">
						7 May 2008, 21:53					</div>
				</div>
				<div class="post-content content">
					<p>That just might be it. </p><p>When I have time to test on the device itself I will post again.</p>											<p class="post-edited">(Last edited by <strong>dirkNL</strong> on 7 May 2008, 21:54)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p68408">
				<div class="post-metadata">
					<div class="post-num">Post #83</div>
					<div class="post-author">mindbender</div>
					<div class="post-datetime">
						19 May 2008, 13:59					</div>
				</div>
				<div class="post-content content">
					<p>any update?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p68424">
				<div class="post-metadata">
					<div class="post-num">Post #84</div>
					<div class="post-author">Davidkra</div>
					<div class="post-datetime">
						19 May 2008, 23:37					</div>
				</div>
				<div class="post-content content">
					<p>Nope, I haven&#039;t got enough time to continue working on it. Exams and such stuff...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p68447">
				<div class="post-metadata">
					<div class="post-num">Post #85</div>
					<div class="post-author">mindbender</div>
					<div class="post-datetime">
						20 May 2008, 12:03					</div>
				</div>
				<div class="post-content content">
					<p>thats ok of course, i myself have to finish my studies <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>take a look here:<br /><a href="http://thread.gmane.org/gmane.linux.ports.arm.kernel/41638">http://thread.gmane.org/gmane.linux.por … rnel/41638</a><br />or directly here:<br /><a href="http://www.marvell.com/products/media/index.jsp">http://www.marvell.com/products/media/index.jsp</a></p><p>marvell has released extremely detailed docs about this SoC`s....now after the basic support is inside the mainline kernel they still do quite much for the opensource linux community. </p><p>i for my side support what they do because of that.....</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p68667">
				<div class="post-metadata">
					<div class="post-num">Post #86</div>
					<div class="post-author">dirkNL</div>
					<div class="post-datetime">
						25 May 2008, 02:47					</div>
				</div>
				<div class="post-content content">
					<p>That&#039;s some good news, my progress however isn&#039;t...</p><p>I&#039;ve been trying to boot a &quot;vanillla&quot; kernel with wrt350n patches from david&#039;s repository with three different toolchains now. <br />Codesourcery&#039;s EABI<br />Codesourcery&#039;s uclinux<br />and the Stock toolchain from Linksys</p><p>With both the EABI and the Stock toolchain the kernel uncompresses, and stalls after telling me it&#039;s booting the kernel.<br />The uclinux toolchain shows even less.</p><p>I&#039;ve tried a lot of different configs but haven&#039;t been able to get one going. As I said before I also can&#039;t boot the precompiled kernel from david.</p><p>I think I&#039;m missing something very stupid, but I don&#039;t seem to get my head around it.</p><p>Just a thought; could it be I need to alter some offset values in the wrt350_setup.c file? And if so, where would I be able to trace back which values to use? Maybe david can help me out with that.</p>											<p class="post-edited">(Last edited by <strong>dirkNL</strong> on 27 May 2008, 00:17)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p68682">
				<div class="post-metadata">
					<div class="post-num">Post #87</div>
					<div class="post-author">mindbender</div>
					<div class="post-datetime">
						25 May 2008, 13:27					</div>
				</div>
				<div class="post-content content">
					<p>this toolchain is the one used to compile foonas-em:<br /><a href="http://buffalo.nas-central.org/download/LSPro_ARM9/DevelopmentTools/CrossToolchains/CodeSourcery/arm-2005q3-2-arm-none-linux-gnueabi-i686-pc-linux-gnu.tar.bz2">http://buffalo.nas-central.org/download … nu.tar.bz2</a></p><p>mkimage x86 binary:<br /><a href="http://buffalo.nas-central.org/download/LSPro_ARM9/DevelopmentTools/CrossToolchains/mkimage">http://buffalo.nas-central.org/download … ns/mkimage</a></p><p>did you apply the mach id patch?<br /><a href="http://buffalo.nas-central.org/download/Users/bbradley/orion-kernel/kuroboxpro_lspro/force_mach-type.patch">http://buffalo.nas-central.org/download … type.patch</a><br />?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p68688">
				<div class="post-metadata">
					<div class="post-num">Post #88</div>
					<div class="post-author">dirkNL</div>
					<div class="post-datetime">
						25 May 2008, 18:19					</div>
				</div>
				<div class="post-content content">
					<p>Thanks alot for the quick response. I think I tried the mach patch at some point, but now I&#039;m not even sure how or when and on which sources.</p><p>I&#039;ll try these tonight and will post back asap.</p><br /><p>** update **</p><p>Finally some results!!, I think the patch did the trick, silly me <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /><br />But still, to make sure it doesn&#039;t depend on anything else I&#039;ll keep using this toolchain and mkimage for my future adventures...</p><p>The kernel boots but shows me some errors about the flash memory and inevitably panics with no root filesystem message. I&#039;m now going to get started (finally) with the real work.</p><p>Keep you posted!</p><br /><p>** update 2 **</p><p>I&#039;ve been using the setup.c file from david as my starting point, but somehow none of the images built with it were able to boot. I switched to the setup.c file from the kurobox_pro which is in the stock kernel sources, this boots properly. I&#039;m not going to dig for a solution for this problem just yet as I now just copied the values from david&#039;s file into the kurobox file and that &quot;works&quot;.</p><p>When I say &quot;works&quot;, this is what I get:<br /></p><div class="codebox"><pre><code>Linux version 2.6.25.4 (root@skvalpe) (gcc version 3.4.4 (release) (CodeSourcery ARM 2005q3-2)) #25 Mon May 26 05:28:07 CEST 2008
CPU: Feroceon [41069260] revision 0 (ARMv5TEJ), cr=a0053177
Machine: WRT350N - EXPERIMENTAL
Clearing invalid memory bank 0KB@0xffffffff
Clearing invalid memory bank 0KB@0xffffffff
Clearing invalid memory bank 0KB@0xffffffff
Ignoring unrecognised tag 0x00000000
Ignoring unrecognised tag 0x00000000
Ignoring unrecognised tag 0x00000000
Ignoring unrecognised tag 0x41000403
Memory policy: ECC disabled, Data cache writeback
CPU0: D VIVT write-back cache
CPU0: I cache: 32768 bytes, associativity 1, 32 byte lines, 1024 sets
CPU0: D cache: 32768 bytes, associativity 1, 32 byte lines, 1024 sets
Built 1 zonelists in Zone order, mobility grouping on.  Total pages: 8128
Kernel command line: console=ttyS0,115200 root=/dev/mtdblock1 rw
PID hash table entries: 128 (order: 7, 512 bytes)
Console: colour dummy device 80x30
Dentry cache hash table entries: 4096 (order: 2, 16384 bytes)
Inode-cache hash table entries: 2048 (order: 1, 8192 bytes)
Memory: 32MB = 32MB total
Memory: 28656KB available (3160K code, 510K data, 116K init)
SLUB: Genslabs=12, HWalign=32, Order=0-1, MinObjects=4, CPUs=1, Nodes=1
Mount-cache hash table entries: 512
CPU: Testing write buffer coherency: ok
net_namespace: 540 bytes
NET: Registered protocol family 16
Orion ID: MV88F5181-Rev-Unsupported. TCLK=166666667.
SCSI subsystem initialized
usbcore: registered new interface driver usbfs
usbcore: registered new interface driver hub
usbcore: registered new device driver usb
NET: Registered protocol family 2
IP route cache hash table entries: 1024 (order: 0, 4096 bytes)
TCP established hash table entries: 1024 (order: 1, 8192 bytes)
TCP bind hash table entries: 1024 (order: 0, 4096 bytes)
TCP: Hash tables configured (established 1024 bind 1024)
TCP reno registered
JFFS2 version 2.2. (NAND) Ã‚Â© 2001-2006 Red Hat, Inc.
io scheduler noop registered
io scheduler anticipatory registered (default)
io scheduler deadline registered
io scheduler cfq registered
HDLC line discipline: version $Revision: 4.8 $, maxframe=4096
N_HDLC line discipline registered.
Serial: 8250/16550 driver $Revision: 1.90 $ 4 ports, IRQ sharing disabled
serial8250.0: ttyS0 at MMIO 0xf1012000 (irq = 3) is a 16550A
console [ttyS0] enabled
serial8250.0: ttyS1 at MMIO 0xf1012100 (irq = 4) is a 16550A
loop: module loaded
PPP generic driver version 2.4.2
PPP Deflate Compression module registered
PPP BSD Compression module registered
NET: Registered protocol family 24
SLIP: version 0.8.4-NET3.019-NEWTTY (dynamic channels, max=256).
console [netcon0] enabled
netconsole: network logging started
Driver &#039;sd&#039; needs updating - please use bus_type methods
physmap platform flash device: 00800000 at f4000000
physmap-flash.0: Found 1 x16 devices at 0x0 in 8-bit bank
 Amd/Fujitsu Extended Query Table at 0x0040
  Unknown Amd/Fujitsu Extended Query version 0.0.
gen_probe: No supported Vendor Command Set found
physmap-flash physmap-flash.0: map_probe failed
sysfs: duplicate filename &#039;physmap-flash.0&#039; can not be created
------------[ cut here ]------------
WARNING: at fs/sysfs/dir.c:424 sysfs_add_one+0xbc/0xe0()
Modules linked in:
[&lt;c0029dac&gt;] (dump_stack+0x0/0x14) from [&lt;c0037748&gt;] (warn_on_slowpath+0x4c/0x60)
[&lt;c00376fc&gt;] (warn_on_slowpath+0x0/0x60) from [&lt;c00c38a4&gt;] (sysfs_add_one+0xbc/0xe0)
 r7:c034f5a8 r6:c1ced1e0 r4:c1c100f0
[&lt;c00c37e8&gt;] (sysfs_add_one+0x0/0xe0) from [&lt;c00c39ac&gt;] (create_dir+0x60/0xb8)
 r6:c1c19e38 r5:c1ced1e0 r4:c1c100f0
[&lt;c00c394c&gt;] (create_dir+0x0/0xb8) from [&lt;c00c3a5c&gt;] (sysfs_create_dir+0x38/0x64)
 r8:00000000 r7:c034e458 r6:c034e458 r5:00000000 r4:c034f5a8
[&lt;c00c3a24&gt;] (sysfs_create_dir+0x0/0x64) from [&lt;c0123810&gt;] (kobject_add_internal+0x78/0x1b4)
 r4:c034f5a8
[&lt;c0123798&gt;] (kobject_add_internal+0x0/0x1b4) from [&lt;c0123998&gt;] (kobject_add_varg+0x4c/0x54)
 r7:c034f5cc r6:c034e458 r5:00000000 r4:c034f5a8
[&lt;c012394c&gt;] (kobject_add_varg+0x0/0x54) from [&lt;c0123a1c&gt;] (kobject_add+0x40/0x64)
 r6:c034f538 r5:00000001 r4:c034f540
[&lt;c01239dc&gt;] (kobject_add+0x0/0x64) from [&lt;c015ad50&gt;] (device_add+0x84/0x49c)
 r3:c034f5cc r2:c0310e00
[&lt;c015accc&gt;] (device_add+0x0/0x49c) from [&lt;c015f7b8&gt;] (platform_device_add+0x148/0x18c)
[&lt;c015f670&gt;] (platform_device_add+0x0/0x18c) from [&lt;c015f820&gt;] (platform_device_register+0x24/0x28)
 r7:c0020684 r6:00000000 r5:c034f538 r4:00000000
[&lt;c015f7fc&gt;] (platform_device_register+0x0/0x28) from [&lt;c001942c&gt;] (physmap_init+0x34/0x44)
 r5:00000000
[&lt;c00193f8&gt;] (physmap_init+0x0/0x44) from [&lt;c0008a94&gt;] (kernel_init+0x94/0x2ac)
 r4:00000000
[&lt;c0008a00&gt;] (kernel_init+0x0/0x2ac) from [&lt;c003a05c&gt;] (do_exit+0x0/0x688)
---[ end trace afebe5dee4559e24 ]---
kobject_add_internal failed for physmap-flash.0 with -EEXIST, don&#039;t try to register things with the same name in the same directory.
[&lt;c0029dac&gt;] (dump_stack+0x0/0x14) from [&lt;c0123924&gt;] (kobject_add_internal+0x18c/0x1b4)
[&lt;c0123798&gt;] (kobject_add_internal+0x0/0x1b4) from [&lt;c0123998&gt;] (kobject_add_varg+0x4c/0x54)
 r7:c034f5cc r6:c034e458 r5:00000000 r4:c034f5a8
[&lt;c012394c&gt;] (kobject_add_varg+0x0/0x54) from [&lt;c0123a1c&gt;] (kobject_add+0x40/0x64)
 r6:c034f538 r5:00000001 r4:c034f540
[&lt;c01239dc&gt;] (kobject_add+0x0/0x64) from [&lt;c015ad50&gt;] (device_add+0x84/0x49c)
 r3:c034f5cc r2:c0310e00
[&lt;c015accc&gt;] (device_add+0x0/0x49c) from [&lt;c015f7b8&gt;] (platform_device_add+0x148/0x18c)
[&lt;c015f670&gt;] (platform_device_add+0x0/0x18c) from [&lt;c015f820&gt;] (platform_device_register+0x24/0x28)
 r7:c0020684 r6:00000000 r5:c034f538 r4:00000000
[&lt;c015f7fc&gt;] (platform_device_register+0x0/0x28) from [&lt;c001942c&gt;] (physmap_init+0x34/0x44)
 r5:00000000
[&lt;c00193f8&gt;] (physmap_init+0x0/0x44) from [&lt;c0008a94&gt;] (kernel_init+0x94/0x2ac)
 r4:00000000
[&lt;c0008a00&gt;] (kernel_init+0x0/0x2ac) from [&lt;c003a05c&gt;] (do_exit+0x0/0x688)
orion-ehci orion-ehci.0: Marvell Orion EHCI
orion-ehci orion-ehci.0: new USB bus registered, assigned bus number 1
orion-ehci orion-ehci.0: irq 17, io mem 0xf1050000
orion-ehci orion-ehci.0: USB 2.0 started, EHCI 1.00, driver 10 Dec 2004
usb usb1: configuration #1 chosen from 1 choice
hub 1-0:1.0: USB hub found
hub 1-0:1.0: 1 port detected
USB Universal Host Controller Interface driver v3.0
Initializing USB Mass Storage driver...
usbcore: registered new interface driver usb-storage
USB Mass Storage support registered.
mice: PS/2 mouse device common for all mice
TCP cubic registered
NET: Registered protocol family 1
NET: Registered protocol family 10
IPv6 over IPv4 tunneling driver
NET: Registered protocol family 17
RPC: Registered udp transport module.
RPC: Registered tcp transport module.
Root-NFS: No NFS server available, giving up.
VFS: Unable to mount root fs via NFS, trying floppy.
VFS: Cannot open root device &quot;mtdblock1&quot; or unknown-block(2,0)
Please append a correct &quot;root=&quot; boot option; here are the available partitions:
Kernel panic - not syncing: VFS: Unable to mount root fs on unknown-block(2,0)</code></pre></div><p>As you can see it&#039;s failing to map it&#039;s NOR flash to create the root filesystem. <br />My setup.c is located <a href="http://hosting.upexia.nl/kurobox_pro-setup.c">here</a> so you can see which values are used for all mappings.</p><p>I&#039;m a little worried for getting this message &quot;Unknown Amd/Fujitsu Extended Query version 0.0.&quot; which you can see in the log above. I&#039;ve read in this thread whatta got the same message when booting another kernel from foonas. Is it really just some mapping which is missing, or is it something like a not yet supported feature?</p><p>The messages at the beginning of the log just confirm my guess it&#039;s just some mapping problem I think<br /></p><div class="codebox"><pre><code>Clearing invalid memory bank 0KB@0xffffffff
Clearing invalid memory bank 0KB@0xffffffff
Clearing invalid memory bank 0KB@0xffffffff
Ignoring unrecognised tag 0x00000000
Ignoring unrecognised tag 0x00000000
Ignoring unrecognised tag 0x00000000
Ignoring unrecognised tag 0x41000403</code></pre></div><p>Any suggestion is welcome <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>											<p class="post-edited">(Last edited by <strong>dirkNL</strong> on 26 May 2008, 05:38)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p68798">
				<div class="post-metadata">
					<div class="post-num">Post #89</div>
					<div class="post-author">Davidkra</div>
					<div class="post-datetime">
						27 May 2008, 20:10					</div>
				</div>
				<div class="post-content content">
					<p>That&#039;s quite possible.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p68820">
				<div class="post-metadata">
					<div class="post-num">Post #90</div>
					<div class="post-author">mindbender</div>
					<div class="post-datetime">
						28 May 2008, 04:45					</div>
				</div>
				<div class="post-content content">
					<p><a href="http://git.kernel.org/?p=linux/kernel/git/nico/orion.git;a=summary">lennert buytenhek</a> told me that he will look at helping you a little from upstream guys.</p>											<p class="post-edited">(Last edited by <strong>mindbender</strong> on 28 May 2008, 04:46)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p68877">
				<div class="post-metadata">
					<div class="post-num">Post #91</div>
					<div class="post-author">dirkNL</div>
					<div class="post-datetime">
						29 May 2008, 04:29					</div>
				</div>
				<div class="post-content content">
					<p>That&#039;s good to know, any help is welcome</p><p>StrikerNL (also member of this forum and a friend of mine) had a very good tip today:</p><p>use the file cfi_cmdset_0002.c from the WRT sources to get support for the flashchip/mtd. Now we&#039;re making progress, because now even the root filesystem can be mounted. That is however, if you have squashfs support in the kernel... </p><p>I took the squashfs patch for my vanilla kernel from a gentoo bug tracker: <a href="http://bugs.gentoo.org/show_bug.cgi?id=218169">http://bugs.gentoo.org/show_bug.cgi?id=218169</a><br />It doesn&#039;t work out of the box, but I was able to solve the rejects. All very small ones actually.</p><p>Another important change; I changed the physmap id from 0 to 1 in my modified setup.c file. I think the 0 is created elsewhere in the orion sources, but I haven&#039;t bothered to look for this yet.</p><p>Here&#039;s my new log output; this is it for today. I will be back once I have some spare time again.</p><div class="codebox"><pre><code>Linux version 2.6.25.4 (root@skvalpe) (gcc version 3.4.4 (release) (CodeSourcery ARM 2005q3-2)) #28 Thu May 29 05:13:33 CEST 2008
CPU: Feroceon [41069260] revision 0 (ARMv5TEJ), cr=a0053177
Machine: WRT350N - EXPERIMENTAL
Clearing invalid memory bank 0KB@0xffffffff
Clearing invalid memory bank 0KB@0xffffffff
Clearing invalid memory bank 0KB@0xffffffff
Ignoring unrecognised tag 0x00000000
Ignoring unrecognised tag 0x00000000
Ignoring unrecognised tag 0x00000000
Ignoring unrecognised tag 0x41000403
Memory policy: ECC disabled, Data cache writeback
CPU0: D VIVT write-back cache
CPU0: I cache: 32768 bytes, associativity 1, 32 byte lines, 1024 sets
CPU0: D cache: 32768 bytes, associativity 1, 32 byte lines, 1024 sets
Built 1 zonelists in Zone order, mobility grouping on.  Total pages: 8128
Kernel command line: console=ttyS0,115200 root=/dev/mtdblock1 rw
PID hash table entries: 128 (order: 7, 512 bytes)
Console: colour dummy device 80x30
Dentry cache hash table entries: 4096 (order: 2, 16384 bytes)
Inode-cache hash table entries: 2048 (order: 1, 8192 bytes)
Memory: 32MB = 32MB total
Memory: 28616KB available (3204K code, 511K data, 116K init)
SLUB: Genslabs=12, HWalign=32, Order=0-1, MinObjects=4, CPUs=1, Nodes=1
Mount-cache hash table entries: 512
CPU: Testing write buffer coherency: ok
net_namespace: 540 bytes
NET: Registered protocol family 16
Orion ID: MV88F5181-Rev-Unsupported. TCLK=166666667.
SCSI subsystem initialized
usbcore: registered new interface driver usbfs
usbcore: registered new interface driver hub
usbcore: registered new device driver usb
NET: Registered protocol family 2
IP route cache hash table entries: 1024 (order: 0, 4096 bytes)
TCP established hash table entries: 1024 (order: 1, 8192 bytes)
TCP bind hash table entries: 1024 (order: 0, 4096 bytes)
TCP: Hash tables configured (established 1024 bind 1024)
TCP reno registered
squashfs: version 3.3 (2007/10/31) Phillip Lougher
JFFS2 version 2.2. (NAND) Ã‚Â© 2001-2006 Red Hat, Inc.
io scheduler noop registered
io scheduler anticipatory registered (default)
io scheduler deadline registered
io scheduler cfq registered
HDLC line discipline: version $Revision: 4.8 $, maxframe=4096
N_HDLC line discipline registered.
Serial: 8250/16550 driver $Revision: 1.90 $ 4 ports, IRQ sharing disabled
serial8250.0: ttyS0 at MMIO 0xf1012000 (irq = 3) is a 16550A
console [ttyS0] enabled
serial8250.0: ttyS1 at MMIO 0xf1012100 (irq = 4) is a 16550A
loop: module loaded
PPP generic driver version 2.4.2
PPP Deflate Compression module registered
PPP BSD Compression module registered
NET: Registered protocol family 24
SLIP: version 0.8.4-NET3.019-NEWTTY (dynamic channels, max=256).
console [netcon0] enabled
netconsole: network logging started
Driver &#039;sd&#039; needs updating - please use bus_type methods
physmap platform flash device: 00800000 at f4000000
physmap-flash.1: Found 1 x16 devices at 0x0 in 8-bit bank
 Amd/Fujitsu Extended Query Table at 0x0040
physmap-flash.1: Swapping erase regions for broken CFI table.
number of CFI chips: 1
cfi_cmdset_0002: Disabling erase-suspend-program due to code brokenness.
RedBoot partition parsing not available
Using physmap partition information
Creating 5 MTD partitions on &quot;physmap-flash.1&quot;:
0x00000000-0x00760000 : &quot;kernel&quot;
0x001a0000-0x00760000 : &quot;rootfs&quot;
0x00760000-0x007a0000 : &quot;lang&quot;
0x007a0000-0x007c0000 : &quot;nvram&quot;
0x007c0000-0x00800000 : &quot;u-boot&quot;
physmap platform flash device: 01000000 at f0000000
physmap-flash physmap-flash.0: map_probe failed
orion-ehci orion-ehci.0: Marvell Orion EHCI
orion-ehci orion-ehci.0: new USB bus registered, assigned bus number 1
orion-ehci orion-ehci.0: irq 17, io mem 0xf1050000
orion-ehci orion-ehci.0: USB 2.0 started, EHCI 1.00, driver 10 Dec 2004
usb usb1: configuration #1 chosen from 1 choice
hub 1-0:1.0: USB hub found
hub 1-0:1.0: 1 port detected
USB Universal Host Controller Interface driver v3.0
Initializing USB Mass Storage driver...
usbcore: registered new interface driver usb-storage
USB Mass Storage support registered.
mice: PS/2 mouse device common for all mice
TCP cubic registered
NET: Registered protocol family 1
NET: Registered protocol family 10
IPv6 over IPv4 tunneling driver
NET: Registered protocol family 17
RPC: Registered udp transport module.
RPC: Registered tcp transport module.
VFS: Mounted root (squashfs filesystem) readonly.
Freeing init memory: 116K
SQUASHFS error: zlib_inflate returned unexpected result 0xfffffffd, srclength 65536, avail_in 903, avail_out 65536
SQUASHFS error: sb_bread failed reading block 0x1b
SQUASHFS error: Unable to read page, block 77, size 6ed3
SQUASHFS error: zlib_inflate returned unexpected result 0xfffffffd, srclength 65536, avail_in 903, avail_out 65536
SQUASHFS error: sb_bread failed reading block 0x1b
SQUASHFS error: Unable to read page, block 77, size 6ed3
SQUASHFS error: zlib_inflate returned unexpected result 0xfffffffd, srclength 65536, avail_in 903, avail_out 65536
SQUASHFS error: sb_bread failed reading block 0x1b
SQUASHFS error: Unable to read page, block 77, size 6ed3
SQUASHFS error: zlib_inflate returned unexpected result 0xfffffffd, srclength 65536, avail_in 903, avail_out 65536
SQUASHFS error: sb_bread failed reading block 0x1b
SQUASHFS error: Unable to read page, block 77, size 6ed3
SQUASHFS error: zlib_inflate returned unexpected result 0xfffffffd, srclength 65536, avail_in 903, avail_out 65536
SQUASHFS error: sb_bread failed reading block 0x1b
SQUASHFS error: Unable to read page, block 77, size 6ed3
SQUASHFS error: zlib_inflate returned unexpected result 0xfffffffd, srclength 65536, avail_in 903, avail_out 65536
SQUASHFS error: sb_bread failed reading block 0x1b
SQUASHFS error: Unable to read page, block 77, size 6ed3
Kernel panic - not syncing: No init found.  Try passing init= option to kernel.</code></pre></div><p>** update **</p><p>Just found out the default WRT kernel uses LZMA compression for squashfs, the patch I used doesn&#039;t... <br />going to have a look here <a href="http://www.squashfs-lzma.org">http://www.squashfs-lzma.org</a>/ now, I&#039;ll let you know if something happens.</p>											<p class="post-edited">(Last edited by <strong>dirkNL</strong> on 29 May 2008, 04:43)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p68883">
				<div class="post-metadata">
					<div class="post-num">Post #92</div>
					<div class="post-author">StrikerNL</div>
					<div class="post-datetime">
						29 May 2008, 10:12					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>dirkNL wrote:</cite><blockquote><p>use the file cfi_cmdset_0002.c from the WRT sources to get support for the flashchip/mtd.</p></blockquote></div><p>Not entirely true; I took the cfi_cmdset_0002.c from the vanilla kernel sources and made a small change. It&#039;s only one line. [s]I&#039;d paste it but I&#039;m at work so I don&#039;t have it handy[/s] I forgot I can use SSH. What it comes down to, a check was added in the vanilla kernel sources for the major/minor version of the AMD/Fujitsu chipset. This check was not present in the linksys sources. This check only seems to allow versions from 1.0 to 1.4 (I believe). Any other version raises kernel panic. The WRT350N reports 0.0, so I added a rule to allow that version as well. It&#039;s a hack but since there was no check at all in the past I figured it may just work. It should probably just allow 0.0, not 0.0 through 0.4 as well. However that would still be a hack.</p><p>Here&#039;s the change:</p><div class="codebox"><pre><code>if (extp-&gt;MajorVersion != &#039;1&#039; ||
   (extp-&gt;MinorVersion &lt; &#039;0&#039; || extp-&gt;MinorVersion &gt; &#039;4&#039;)) {</code></pre></div><p>-&gt;<br /></p><div class="codebox"><pre><code>/* WRT350N is MajorVersion 0 */
if ((extp-&gt;MajorVersion != &#039;1&#039; &amp;&amp; extp-&gt;MajorVersion != &#039;0&#039;) ||
    (extp-&gt;MinorVersion &lt; &#039;0&#039; || extp-&gt;MinorVersion &gt; &#039;4&#039;)) {</code></pre></div>											<p class="post-edited">(Last edited by <strong>StrikerNL</strong> on 29 May 2008, 10:38)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p68902">
				<div class="post-metadata">
					<div class="post-num">Post #93</div>
					<div class="post-author">Davidkra</div>
					<div class="post-datetime">
						29 May 2008, 19:23					</div>
				</div>
				<div class="post-content content">
					<p>Hmm... you did more than I... I&#039;ll clean up my repo and give you write access to it. Maybe I&#039;ll host it on another server.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p68981">
				<div class="post-metadata">
					<div class="post-num">Post #94</div>
					<div class="post-author">StrikerNL</div>
					<div class="post-datetime">
						31 May 2008, 18:34					</div>
				</div>
				<div class="post-content content">
					<p>Alright, good news, and also, a lot of it.</p><p>First off, I would like to extend a lot of thanks to Lennert Buytenhek. He worked with me and Dirk for hours to get the WRT350n working. What marvellous support from Marvell! <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p><p>With a lot of help from Lennert, we have been able to get, well, everything working on the WRT350n. I currently have 2.6.26-rc4 running on it. We think it&#039;s ready to run openwrt, as soon as we figure out how create an image that can be flashed via the standard interface.</p><p>According to Lennert, the work he did to create a working wrt350n_setup.c, will be included in the next major mainline kernel, probably 2.6.27. Until then, you will need to get the kernel from the marvell GIT repository. This is of course very good news, because for a large part the wrt350n will work out of the box with a generic kernel in the not too distant future!</p><p>What works: Almost everything, it seems. LAN, WiFi, USB, writing new rootfs/kernel to flash, booting from Squash-LZMA filesystem in flash. Also Lennert has mapped the GPIO&#039;s (leds and buttons) for future use.<br />What doesn&#039;t: n-mode for WiFi, booting the SquashFS-LZMA rootfs that normally comes with the wrt350n, because SquashFS 3.3 seems to be backwards incompatible with 3.0, which is what was used to create the stock rootfs. Since the rootfs can easily be overwritten, this doesn&#039;t really matter.</p><p>First I&#039;ll just sum up the steps that were taken to get everything work, then I&#039;ll elaborate on the important ones more in-depth.</p><p>1. Get the latest GIT checkout from the <a href="http://git.marvell.com/?p=orion.git;a=summary">marvell GIT repository</a><br />2. <a href="http://ddcrew.com/wrt350n/cfi_cmdset_0002.patch">Download patch for cfi_cmdset_0002.c</a> and apply it to the kernel<br />3. Patch 2.6.26-rc4 to have <a href="http://www.squashfs-lzma.org/">SquashFS-LZMA</a> (needs patching to make it 2.6.26 compatible)<br />4. Build the kernel<br />5. Get the latest <a href="http://madwifi.org/">madwifi</a>, point it to the new kernel and build it (needs a few patches as well)<br />6. Patch the zImage with the correct machine type id and build the uImage<br />7. Boot the uImage through the Marvell bootloader.<br />8. Load the madwifi modules</p><p>Now for the more detailed explanations:</p><p><strong>The cfi_cmdset_0002.c patch</strong><br />Somewhere along the line between 2.6.12 (linksys sources) and now, a check was added for the version of the CFI chip. This check enforces that the version can only be between 1.0 and 1.4. This presents a problem, because the WRT350N reports version 0.0. This patch modifies the check to allow 0.0 as well as 1.0 to 1.4. With this patch applied, the flash can be mapped just fine.</p><p><strong>Patching 2.6.26-rc4 with SquashFS-LZMA</strong><br />Patching a kernel newer than 2.6.24.3 presents a problem, because there are only patches up to this version as of the time of writing. 2.6.25 and later need you to manually patch the kernel. I will outline this process here. When SquashFS-LZMA gets ported to the newer kernel by the author, this section will be obsoleted.</p><p>Following the instructions at <a href="http://www.squashfs-lzma.org/">http://www.squashfs-lzma.org/</a>, get all the files in the menu on the left (except for the kernel, obviously). <strong>Note: I didn&#039;t apply the &#039;cvsfix&#039; patches</strong>.</p><p>Then follow the guide here: <a href="http://www.squashfs-lzma.org/dl/sqlzma.txt">http://www.squashfs-lzma.org/dl/sqlzma.txt</a>.<br /><strong>Note: use the 2.6.24 patch to patch the kernel</strong><br /><strong>Note 2: you don&#039;t need to do the Makefile stuff or actually run make</strong></p><p>Now do the following things:<br />1. From where you unpacked sqlzmaXXX-XXX.tar.bz2, copy sqlzma.h to &lt;kernelsrc&gt;/fs/squashfs<br />2. From where you unpacked sqlzmaXXX-XXX.tar.bz2, copy sqmagic.h to &lt;kernelsrc&gt;/fs/squashfs<br />3. From where you unpacked lzmaXXX.tar.bz2, copy C/Compress/LZMA/uncomp.c to &lt;kernelsrc&gt;/fs/squashfs<br />4. From where you unpacked lzmaXXX.tar.bz2, copy C/Compress/LZMA/LzmaDecode.c to &lt;kernelsrc&gt;/fs/squashfs<br />5. From where you unpacked lzmaXXX.tar.bz2, copy C/Compress/LZMA/LzmaDecode.h to &lt;kernelsrc&gt;/fs/squashfs<br />6. From where you unpacked lzmaXXX.tar.bz2, copy C/Compress/LZMA/LzmaTypes.h to &lt;kernelsrc&gt;/fs/squashfs<br />7. From where you unpacked lzmaXXX.tar.bz2, copy C/Compress/LZMA/kmod/module.c to &lt;kernelsrc&gt;/fs/squashfs<br />8. Apply <a href="http://ddcrew.com/wrt350n/inode.c.patch">this patch</a> to &lt;kernelsrc&gt;/fs/squashfs/inode.c<br />9. Apply <a href="http://ddcrew.com/wrt350n/Makefile.patch">this patch</a> to &lt;kernelsrc&gt;/fs/squashfs/Makefile<br />10. Edit &lt;kernelsrc&gt;/fs/squashfs/module.c, change &quot;<em>#include &quot;<span style="color: #ff0000"><strong>../</strong></span>LzmaDecode.c</em>&quot; to &quot;<em>#include &quot;LzmaDecode.c&quot;</em></p><p>Now enable SquashFS in the kernel (file systems, miscellaneous, squashfs, builtin). Now the kernel has SquashFS-LZMA support.</p><p><strong>Compiling madwifi modules</strong><br />Get the latest madwifi SVN version from <a href="http://svn.madwifi.org/madwifi/trunk">http://svn.madwifi.org/madwifi/trunk</a>. To build madwifi, I had to apply some hacks to the source. Your mileage may vary. Anyway, this is what I did. Since this is SVN, there&#039;s probably not a lot of use in creating patches for it, so I&#039;ll just walk through it step by step.</p><p><strong>NOTE!</strong> For compiling this, I used <a href="http://buffalo.nas-central.org/download/LSPro_ARM9/DevelopmentTools/CrossToolchains/CodeSourcery/arm-2005q3-2-arm-none-linux-gnueabi-i686-pc-linux-gnu.tar.bz2">this toolchain</a>. I used a newer one for the kernel but that one completely failed to compile madwifi.</p><p>1. From where you checked out madwifi, edit hal/public/armv4-le-elf.inc. All the way at the bottom, where it says &quot;<em>COPTS+= -march=<span style="color: #ff0000"><strong>armv4</strong></span> -mlittle-endian \</em>&quot;, change this to &quot;<em>COPTS+= -march=<span style="color: #ff0000"><strong>armv5te</strong></span> -mlittle-endian \</em>&quot;<br />2. Try to compile madwifi, it may just work. If you get errors about functions iowrite32be/ioread32be like I did, continue.<br />3. From where you checked out madwifi, edit ath_hal/ah_os.h.<br />4. Find the comment about &quot;<em>The register accesses are done using target-specific</em>&quot; (for me, line 195).<br />5. Go down a bit to where it says the following:</p><div class="codebox"><pre><code>#define _OS_REG_WRITE(_ah, _reg, _val) do {                     \
         is_reg_le(_reg) ?                                      \
         iowrite32((_val), (_ah)-&gt;ah_sh + (_reg)) :             \
         iowrite32be((_val), (_ah)-&gt;ah_sh + (_reg));            \
        } while (0)</code></pre></div><p>6. Change this to/replace this with:</p><div class="codebox"><pre><code>#define _OS_REG_WRITE(_ah, _reg, _val) do {                     \
         iowrite32((_val), (_ah)-&gt;ah_sh + (_reg));              \
        } while (0)</code></pre></div><p>7. Right below that, there should be this:</p><div class="codebox"><pre><code>#define _OS_REG_READ(_ah, _reg)                                 \
        (is_reg_le(_reg) ?                                      \
         ioread32((_ah)-&gt;ah_sh + (_reg)) :                      \
         ioread32be((_ah)-&gt;ah_sh + (_reg)))</code></pre></div><p>8. Change this to/replace this with:</p><div class="codebox"><pre><code>#define _OS_REG_READ(_ah, _reg)                                 \
        ioread32((_ah)-&gt;ah_sh + (_reg))</code></pre></div><p>9. Now compile madwifi. It should now work.<br />10. Install the modules somewhere where your WRT350N will be able to access them (in your rootfs, /lib/modules somewhere).</p><p><strong>Patching the zImage with the correct machine type id</strong><br />You can either do this manually every time you build a kernel or have it be done for you. I&#039;m going to assume you prefer the latter.</p><p>Apply <a href="http://ddcrew.com/wrt350n/wrt350n_machineid.patch">this patch</a> to your kernel. This changes the arch/arm/boot/Makefile so it puts the machine id in the zImage before it creates the uImage. Many thanks to mindbender and Lennert for this one.</p><p>These are, I think, all the steps needed to create an image with the very latest kernel that will boot on wrt350n. You will have support for everything. Just for the sake of completeness, I will include here <a href="http://ddcrew.com/wrt350n/config-wrt350n">the config that was used build a working kernel</a> after these steps.</p><p><strong>What&#039;s left to do?</strong><br />The next thing will be to figure out how to create an image which can be used to flash a new firmware to the wrt350n without needing the serial console.</p>											<p class="post-edited">(Last edited by <strong>StrikerNL</strong> on 31 May 2008, 19:08)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p68987">
				<div class="post-metadata">
					<div class="post-num">Post #95</div>
					<div class="post-author">Kaloz</div>
					<div class="post-datetime">
						31 May 2008, 21:33					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ll look into this tomorrow and get it working in openwrt with some luck... Do we have support for the switch, or we end up with an AP only for now? (eg do we have wan and lan?)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p68988">
				<div class="post-metadata">
					<div class="post-num">Post #96</div>
					<div class="post-author">StrikerNL</div>
					<div class="post-datetime">
						31 May 2008, 21:39					</div>
				</div>
				<div class="post-content content">
					<p>Unfortunately no switch yet, no. All traffic goes through eth0, of the WAN port and all 4 LAN ports. Lennert may try to get this working in the next couple of weeks, if his time allows him to.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p68991">
				<div class="post-metadata">
					<div class="post-num">Post #97</div>
					<div class="post-author">Davidkra</div>
					<div class="post-datetime">
						31 May 2008, 23:04					</div>
				</div>
				<div class="post-content content">
					<p>Great you managed to get it working. So well, do you need an repo?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p69170">
				<div class="post-metadata">
					<div class="post-num">Post #98</div>
					<div class="post-author">Kaloz</div>
					<div class="post-datetime">
						4 Jun 2008, 16:52					</div>
				</div>
				<div class="post-content content">
					<p>Transmitting file data ........................<br />Committed revision 11352.</p><p><img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p69173">
				<div class="post-metadata">
					<div class="post-num">Post #99</div>
					<div class="post-author">dirkNL</div>
					<div class="post-datetime">
						4 Jun 2008, 17:45					</div>
				</div>
				<div class="post-content content">
					<p>@Davidkra. No thanks as almost everything will be in the mainline git-repos very soon it won&#039;t be necessary, thanks anyway.</p><p>@Kaloz. Superb, we&#039;ll try it as soon as possible</p>											<p class="post-edited">(Last edited by <strong>dirkNL</strong> on 4 Jun 2008, 17:45)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p69439">
				<div class="post-metadata">
					<div class="post-num">Post #100</div>
					<div class="post-author">StrikerNL</div>
					<div class="post-datetime">
						11 Jun 2008, 13:24					</div>
				</div>
				<div class="post-content content">
					<p>Just posting some updates.</p><p>- We have created a working image/firmware builder that can and will be used to make images that can be flashed from the stock wrt350n firmware (so you don&#039;t need to use the serial console to flash, which is good, as you need a special cable for that)<br />- We have gotten an SVN checkout and tried to build a working openwrt rootfs. No success there, yet. Due to lack of time, we haven&#039;t been able to do a lot of tests. We&#039;ll get there though.</p>											<p class="post-edited">(Last edited by <strong>StrikerNL</strong> on 11 Jun 2008, 13:38)</p>
									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 4 of 46</div><nav><ul><li><a href="viewtopic.php%3Fid=12358&amp;p=1.html">1</a></li><li><a href="viewtopic.php%3Fid=12358&amp;p=2.html">2</a></li><li><a href="viewtopic.php%3Fid=12358&amp;p=3.html">3</a></li><li class="pagination-current"><span>4</span></li><li><a href="viewtopic.php%3Fid=12358&amp;p=5.html">5</a></li><li><a href="viewtopic.php%3Fid=12358&amp;p=6.html">6</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=12358&amp;p=46.html">46</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0.001 -->

</body>
</html>