<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> IPv6 dual stack won&#039;t connect</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 22 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p336353">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">corrideat</div>
					<div class="post-datetime">
						29 Aug 2016, 14:32					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>I&#039;m running OpenWRT Chaos Calmer (15.05.1, r48532) on a Nexx WT1520 and I&#039;m trying to get IPv6 to work. My provider gives me dual stack (IPv4 + IPv6), but right now I can only ever get IPv4 connectivity. IPv6 is working upstream, as I can connect any computer and IPv6 &quot;just works&quot; (using DHCPv6).</p><p>This is my /etc/config/network:</p><div class="codebox"><pre><code>config interface &#039;loopback&#039;
    option ifname &#039;lo&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;127.0.0.1&#039;
    option netmask &#039;255.0.0.0&#039;

config globals &#039;globals&#039;
    option ula_prefix &#039;fd6f:cbc7:693e::/48&#039;

config interface &#039;lan&#039;
    option ifname &#039;eth0.1&#039;
    option force_link &#039;1&#039;
    option macaddr &#039;XX:XX:XX:XX:XX:XX&#039;
    option type &#039;bridge&#039;
    option proto &#039;static&#039;
    option netmask &#039;255.255.255.0&#039;
    option ip6assign &#039;60&#039;
    option ipaddr &#039;192.168.8.1&#039;

config interface &#039;wan&#039;
    option ifname &#039;eth0.2&#039;
    option force_link &#039;1&#039;
    option macaddr &#039;XX:XX:XX:XX:XX:XX&#039;
    option proto &#039;dhcp&#039;
    option type &#039;bridge&#039;

config interface &#039;wan6&#039;
    option ifname &#039;eth0.2&#039;
    option macaddr &#039;XX:XX:XX:XX:XX:XX&#039;
    option proto &#039;dhcpv6&#039;
    option type &#039;bridge&#039;
    option reqaddress &#039;force&#039; # I&#039;ve tried adding this to see if it would help; it didn&#039;t
    option reqprefix &#039;64&#039; # I&#039;ve tried adding this to see if it would help; it didn&#039;t

config switch
    option name &#039;switch0&#039;
    option reset &#039;1&#039;
    option enable_vlan &#039;1&#039;

config switch_vlan
    option device &#039;switch0&#039;
    option vlan &#039;1&#039;
    option ports &#039;0 1 2 3 6t&#039;

config switch_vlan
    option device &#039;switch0&#039;
    option vlan &#039;2&#039;
    option ports &#039;4 6t&#039;</code></pre></div><p>And, this is my /etc/config/dhcp:</p><div class="codebox"><pre><code>config dnsmasq
    option domainneeded &#039;1&#039;
    option boguspriv &#039;1&#039;
    option filterwin2k &#039;0&#039;
    option localise_queries &#039;1&#039;
    option rebind_protection &#039;1&#039;
    option rebind_localhost &#039;1&#039;
    option local &#039;/lan/&#039;
    option domain &#039;lan&#039;
    option expandhosts &#039;1&#039;
    option nonegcache &#039;0&#039;
    option authoritative &#039;1&#039;
    option readethers &#039;1&#039;
    option leasefile &#039;/tmp/dhcp.leases&#039;
    option resolvfile &#039;/tmp/resolv.conf.auto&#039;
    option localservice &#039;1&#039;

config dhcp &#039;lan&#039;
    option interface &#039;lan&#039;
    option start &#039;100&#039;
    option limit &#039;150&#039;
    option leasetime &#039;12h&#039;
    option dhcpv6 &#039;server&#039;
    option ra &#039;server&#039;
    option ra_management &#039;1&#039;

config dhcp &#039;wan&#039;
    option interface &#039;wan&#039;
    option ignore &#039;1&#039;

config odhcpd &#039;odhcpd&#039;
    option maindhcp &#039;0&#039;
    option leasefile &#039;/tmp/hosts/odhcpd&#039;
    option leasetrigger &#039;/usr/sbin/odhcpd-update&#039;</code></pre></div><p>A few pointers: odhcp6c doesn&#039;t seem to even get started when my device is powered on. See:</p><div class="codebox"><pre><code># ps | grep dhcp
  743 root      1192 S    /usr/sbin/odhcpd
  921 root      1484 S    udhcpc -p /var/run/udhcpc-br-wan.pid -s /lib/netifd/dhcp.script -f -t 0 -i br-wan -C</code></pre></div><p>I&#039;ve also tried manually running odhcp6c (e.g., odhcp6c -v -e wan6). It just hangs there and never receives an address.</p><p>Unfortunately, I haven&#039;t been able to find much information on how to do a successful IPv6 setup. I was hoping that you may be able to help me troubleshoot these issues and enjoy my IPv6 connectivity.</p><p>Thanks!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p336482">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">cvmiller</div>
					<div class="post-datetime">
						30 Aug 2016, 02:54					</div>
				</div>
				<div class="post-content content">
					<p>You need a wan6 stanza. The Network6 page is quite helpful.<br /><a href="https://wiki.openwrt.org/doc/uci/network6">https://wiki.openwrt.org/doc/uci/network6</a></p><p>Give it a read, and if you are still having problems, feel free to ask.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p336583">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">corrideat</div>
					<div class="post-datetime">
						30 Aug 2016, 21:32					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>I&#039;ve read the IPv6 networking wiki page (again), but I can&#039;t seem to get it to work.</p><p>I believe that what I had posted originally should&#039;ve worked. Just in case, I tried the &quot;relaying&quot; DHCP configuration:</p><div class="codebox"><pre><code>config dnsmasq
    option domainneeded &#039;1&#039;
    option boguspriv &#039;1&#039;
    option filterwin2k &#039;0&#039;
    option localise_queries &#039;1&#039;
    option rebind_protection &#039;1&#039;
    option rebind_localhost &#039;1&#039;
    option local &#039;/lan/&#039;
    option domain &#039;lan&#039;
    option expandhosts &#039;1&#039;
    option nonegcache &#039;0&#039;
    option authoritative &#039;1&#039;
    option readethers &#039;1&#039;
    option leasefile &#039;/tmp/dhcp.leases&#039;
    option resolvfile &#039;/tmp/resolv.conf.auto&#039;
    option localservice &#039;1&#039;

config dhcp &#039;lan&#039;
    option interface &#039;lan&#039;
    option start &#039;100&#039;
    option limit &#039;150&#039;
    option leasetime &#039;12h&#039;
    #option dhcpv6 &#039;server&#039;
    option dhcpv6 &#039;relay&#039;
    #option ra &#039;server&#039;
    option ra &#039;relay&#039;
    option ra_management &#039;1&#039;
    option ndp &#039;relay&#039;

config dhcp &#039;wan&#039;
    option interface &#039;wan&#039;
    option ignore &#039;1&#039;

config dhcp &#039;wan6&#039;
    option dhcpv6 relay
    option ra relay
    option ndp relay
    option master 1

config odhcpd &#039;odhcpd&#039;
    option maindhcp &#039;0&#039;
    option leasefile &#039;/tmp/hosts/odhcpd&#039;
    option leasetrigger &#039;/usr/sbin/odhcpd-update&#039;</code></pre></div><p>Like I&#039;ve mentioned, the logs show no IPv6 information at all, so I am wondering there might be something wrong with my setup.</p><p>This is my system log:</p><div class="codebox"><pre><code>Tue Aug 30 18:16:51 2016 kern.info kernel: [    0.480000] bootconsole [early0] disabled
Tue Aug 30 18:16:51 2016 kern.debug kernel: [    0.500000] pinctrl core: add 1 pinmux maps
Tue Aug 30 18:16:51 2016 kern.debug kernel: [    0.500000] pinctrl core: add 1 pinmux maps
Tue Aug 30 18:16:51 2016 kern.debug kernel: [    0.500000] rt2880-pinmux pinctrl: found group selector 1 for spi
Tue Aug 30 18:16:51 2016 kern.debug kernel: [    0.500000] rt2880-pinmux pinctrl: found group selector 6 for spi_cs1
Tue Aug 30 18:16:51 2016 kern.debug kernel: [    0.500000] rt2880-pinmux pinctrl: request pin 3 (io3) for 10000b00.spi
Tue Aug 30 18:16:51 2016 kern.debug kernel: [    0.500000] rt2880-pinmux pinctrl: request pin 4 (io4) for 10000b00.spi
Tue Aug 30 18:16:51 2016 kern.debug kernel: [    0.500000] rt2880-pinmux pinctrl: request pin 5 (io5) for 10000b00.spi
Tue Aug 30 18:16:51 2016 kern.debug kernel: [    0.500000] rt2880-pinmux pinctrl: request pin 6 (io6) for 10000b00.spi
Tue Aug 30 18:16:51 2016 kern.debug kernel: [    0.500000] rt2880-pinmux pinctrl: request pin 27 (io27) for 10000b00.spi
Tue Aug 30 18:16:51 2016 kern.warn kernel: [    0.530000] m25p80 spi32766.0: found en25q64, expected w25q64
Tue Aug 30 18:16:51 2016 kern.info kernel: [    0.540000] m25p80 spi32766.0: en25q64 (8192 Kbytes)
Tue Aug 30 18:16:51 2016 kern.notice kernel: [    0.550000] 4 ofpart partitions found on MTD device spi32766.0
Tue Aug 30 18:16:51 2016 kern.notice kernel: [    0.560000] Creating 4 MTD partitions on &quot;spi32766.0&quot;:
Tue Aug 30 18:16:51 2016 kern.notice kernel: [    0.570000] 0x000000000000-0x000000030000 : &quot;u-boot&quot;
Tue Aug 30 18:16:51 2016 kern.notice kernel: [    0.580000] 0x000000030000-0x000000040000 : &quot;u-boot-env&quot;
Tue Aug 30 18:16:51 2016 kern.notice kernel: [    0.590000] 0x000000040000-0x000000050000 : &quot;factory&quot;
Tue Aug 30 18:16:51 2016 kern.notice kernel: [    0.610000] 0x000000050000-0x000000800000 : &quot;firmware&quot;
Tue Aug 30 18:16:51 2016 kern.notice kernel: [    0.680000] 2 uimage-fw partitions found on MTD device firmware
Tue Aug 30 18:16:51 2016 kern.notice kernel: [    0.700000] 0x000000050000-0x000000162a2b : &quot;kernel&quot;
Tue Aug 30 18:16:51 2016 kern.notice kernel: [    0.710000] 0x000000162a2b-0x000000800000 : &quot;rootfs&quot;
Tue Aug 30 18:16:51 2016 kern.notice kernel: [    0.720000] mtd: device 5 (rootfs) set to be root filesystem
Tue Aug 30 18:16:51 2016 kern.notice kernel: [    0.730000] 1 squashfs-split partitions found on MTD device rootfs
Tue Aug 30 18:16:51 2016 kern.notice kernel: [    0.740000] 0x000000390000-0x000000800000 : &quot;rootfs_data&quot;
Tue Aug 30 18:16:51 2016 kern.info kernel: [    0.760000] ralink_soc_eth 10100000.ethernet eth0: ralink at 0xb0100000, irq 5
Tue Aug 30 18:16:51 2016 kern.info kernel: [    0.780000] rt2880_wdt 10000120.watchdog: Initialized
Tue Aug 30 18:16:51 2016 kern.info kernel: [    0.790000] TCP: cubic registered
Tue Aug 30 18:16:51 2016 kern.info kernel: [    0.800000] NET: Registered protocol family 17
Tue Aug 30 18:16:51 2016 kern.info kernel: [    0.810000] bridge: automatic filtering via arp/ip/ip6tables has been deprecated. Update your scripts to load br_netfilter if you need this.
Tue Aug 30 18:16:51 2016 kern.notice kernel: [    0.830000] Bridge firewalling registered
Tue Aug 30 18:16:51 2016 kern.info kernel: [    0.840000] 8021q: 802.1Q VLAN Support v1.8
Tue Aug 30 18:16:51 2016 kern.info kernel: [    0.890000] VFS: Mounted root (squashfs filesystem) readonly on device 31:5.
Tue Aug 30 18:16:51 2016 kern.info kernel: [    0.900000] Freeing unused kernel memory: 136K (8030e000 - 80330000)
Tue Aug 30 18:16:51 2016 user.info kernel: [    3.910000] init: Console is alive
Tue Aug 30 18:16:51 2016 user.info kernel: [    3.920000] init: - watchdog -
Tue Aug 30 18:16:51 2016 kern.info kernel: [    6.890000] usbcore: registered new interface driver usbfs
Tue Aug 30 18:16:51 2016 kern.info kernel: [    6.900000] usbcore: registered new interface driver hub
Tue Aug 30 18:16:51 2016 kern.info kernel: [    6.910000] usbcore: registered new device driver usb
Tue Aug 30 18:16:51 2016 kern.info kernel: [    6.930000] ehci_hcd: USB 2.0 &#039;Enhanced&#039; Host Controller (EHCI) Driver
Tue Aug 30 18:16:51 2016 kern.info kernel: [    6.940000] ehci-platform: EHCI generic platform driver
Tue Aug 30 18:16:51 2016 kern.info kernel: [    7.150000] phy phy-usbphy.0: remote usb device wakeup disabled
Tue Aug 30 18:16:51 2016 kern.info kernel: [    7.160000] phy phy-usbphy.0: UTMI 16bit 30MHz
Tue Aug 30 18:16:51 2016 kern.info kernel: [    7.170000] ehci-platform 101c0000.ehci: EHCI Host Controller
Tue Aug 30 18:16:51 2016 kern.info kernel: [    7.190000] ehci-platform 101c0000.ehci: new USB bus registered, assigned bus number 1
Tue Aug 30 18:16:51 2016 kern.info kernel: [    7.200000] ehci-platform 101c0000.ehci: irq 26, io mem 0x101c0000
Tue Aug 30 18:16:51 2016 kern.info kernel: [    7.230000] ehci-platform 101c0000.ehci: USB 2.0 started, EHCI 1.00
Tue Aug 30 18:16:51 2016 kern.debug kernel: [    7.240000] usb usb1: no of_node; not parsing pinctrl DT
Tue Aug 30 18:16:51 2016 kern.debug kernel: [    7.240000] hub 1-0:1.0: no of_node; not parsing pinctrl DT
Tue Aug 30 18:16:51 2016 kern.info kernel: [    7.240000] hub 1-0:1.0: USB hub found
Tue Aug 30 18:16:51 2016 kern.info kernel: [    7.250000] hub 1-0:1.0: 1 port detected
Tue Aug 30 18:16:51 2016 user.info kernel: [    8.210000] init: - preinit -
Tue Aug 30 18:16:51 2016 kern.info kernel: [    9.800000] rt305x-esw 10110000.esw: link changed 0x00
Tue Aug 30 18:16:51 2016 kern.notice kernel: [   10.130000] random: mktemp urandom read with 15 bits of entropy available
Tue Aug 30 18:16:51 2016 kern.info kernel: [   11.420000] rt305x-esw 10110000.esw: link changed 0x01
Tue Aug 30 18:16:51 2016 kern.notice kernel: [   13.790000] jffs2: notice: (305) jffs2_build_xattr_subsystem: complete building xattr subsystem, 0 of xdatum (0 unchecked, 0 orphan) and 0 of xref (0 dead, 0 orphan) found.
Tue Aug 30 18:16:51 2016 user.info kernel: [   13.830000] mount_root: switching to jffs2 overlay
Tue Aug 30 18:16:51 2016 user.info kernel: [   13.910000] procd: - early -
Tue Aug 30 18:16:51 2016 user.info kernel: [   13.910000] procd: - watchdog -
Tue Aug 30 18:16:51 2016 user.info kernel: [   14.860000] procd: - ubus -
Tue Aug 30 18:16:51 2016 user.info kernel: [   15.890000] procd: - init -
Tue Aug 30 18:16:51 2016 kern.info kernel: [   17.700000] NET: Registered protocol family 10
Tue Aug 30 18:16:51 2016 kern.info kernel: [   17.720000] ip6_tables: (C) 2000-2006 Netfilter Core Team
Tue Aug 30 18:16:51 2016 kern.info kernel: [   17.760000] Loading modules backported from Linux version master-2015-03-09-0-g141f155
Tue Aug 30 18:16:51 2016 kern.info kernel: [   17.770000] Backport generated by backports.git backports-20150129-0-gdd4a670
Tue Aug 30 18:16:51 2016 kern.info kernel: [   17.800000] ip_tables: (C) 2000-2006 Netfilter Core Team
Tue Aug 30 18:16:51 2016 kern.info kernel: [   17.820000] nf_conntrack version 0.5.0 (454 buckets, 1816 max)
Tue Aug 30 18:16:51 2016 kern.info kernel: [   17.920000] xt_time: kernel timezone is -0000
Tue Aug 30 18:16:51 2016 kern.info kernel: [   17.990000] cfg80211: Calling CRDA to update world regulatory domain
Tue Aug 30 18:16:51 2016 kern.info kernel: [   18.020000] cfg80211: World regulatory domain updated:
Tue Aug 30 18:16:51 2016 kern.info kernel: [   18.030000] cfg80211:  DFS Master region: unset
Tue Aug 30 18:16:51 2016 kern.info kernel: [   18.030000] cfg80211:   (start_freq - end_freq @ bandwidth), (max_antenna_gain, max_eirp), (dfs_cac_time)
Tue Aug 30 18:16:51 2016 kern.info kernel: [   18.050000] cfg80211:   (2402000 KHz - 2472000 KHz @ 40000 KHz), (N/A, 2000 mBm), (N/A)
Tue Aug 30 18:16:51 2016 kern.info kernel: [   18.070000] cfg80211:   (2457000 KHz - 2482000 KHz @ 20000 KHz, 92000 KHz AUTO), (N/A, 2000 mBm), (N/A)
Tue Aug 30 18:16:51 2016 kern.info kernel: [   18.090000] cfg80211:   (2474000 KHz - 2494000 KHz @ 20000 KHz), (N/A, 2000 mBm), (N/A)
Tue Aug 30 18:16:51 2016 kern.info kernel: [   18.100000] cfg80211:   (5170000 KHz - 5250000 KHz @ 80000 KHz, 160000 KHz AUTO), (N/A, 2000 mBm), (N/A)
Tue Aug 30 18:16:51 2016 kern.info kernel: [   18.120000] cfg80211:   (5250000 KHz - 5330000 KHz @ 80000 KHz, 160000 KHz AUTO), (N/A, 2000 mBm), (0 s)
Tue Aug 30 18:16:51 2016 kern.info kernel: [   18.140000] cfg80211:   (5490000 KHz - 5730000 KHz @ 160000 KHz), (N/A, 2000 mBm), (0 s)
Tue Aug 30 18:16:51 2016 kern.info kernel: [   18.160000] cfg80211:   (5735000 KHz - 5835000 KHz @ 80000 KHz), (N/A, 2000 mBm), (N/A)
Tue Aug 30 18:16:51 2016 kern.info kernel: [   18.170000] cfg80211:   (57240000 KHz - 63720000 KHz @ 2160000 KHz), (N/A, 0 mBm), (N/A)
Tue Aug 30 18:16:51 2016 kern.info kernel: [   18.310000] PPP generic driver version 2.4.2
Tue Aug 30 18:16:51 2016 kern.info kernel: [   18.320000] NET: Registered protocol family 24
Tue Aug 30 18:16:51 2016 kern.info kernel: [   18.380000] ieee80211 phy0: rt2x00_set_rt: Info - RT chipset 5350, rev 0500 detected
Tue Aug 30 18:16:51 2016 kern.info kernel: [   18.400000] ieee80211 phy0: rt2x00_set_rf: Info - RF chipset 5350 detected
Tue Aug 30 18:16:51 2016 kern.debug kernel: [   18.410000] ieee80211 phy0: Selected rate control algorithm &#039;minstrel_ht&#039;
Tue Aug 30 18:16:52 2016 kern.info kernel: [   23.210000] rt305x-esw 10110000.esw: link changed 0x00
Tue Aug 30 18:16:54 2016 kern.info kernel: [   24.830000] rt305x-esw 10110000.esw: link changed 0x01
Tue Aug 30 18:16:54 2016 kern.info kernel: [   24.850000] rt305x-esw 10110000.esw: link changed 0x11
Tue Aug 30 18:16:56 2016 authpriv.info dropbear[779]: Not backgrounding
Tue Aug 30 18:16:59 2016 daemon.info procd: - init complete -
Tue Aug 30 18:17:00 2016 kern.info kernel: [   30.560000] device eth0.1 entered promiscuous mode
Tue Aug 30 18:17:00 2016 kern.info kernel: [   30.570000] device eth0 entered promiscuous mode
Tue Aug 30 18:17:00 2016 kern.info kernel: [   30.590000] br-lan: port 1(eth0.1) entered forwarding state
Tue Aug 30 18:17:00 2016 kern.info kernel: [   30.600000] br-lan: port 1(eth0.1) entered forwarding state
Tue Aug 30 18:17:00 2016 daemon.notice netifd: Interface &#039;lan&#039; is enabled
Tue Aug 30 18:17:00 2016 daemon.notice netifd: Interface &#039;lan&#039; is setting up now
Tue Aug 30 18:17:00 2016 daemon.notice netifd: Interface &#039;lan&#039; is now up
Tue Aug 30 18:17:00 2016 kern.info kernel: [   30.710000] device eth0.2 entered promiscuous mode
Tue Aug 30 18:17:00 2016 kern.info kernel: [   30.750000] br-wan: port 1(eth0.2) entered forwarding state
Tue Aug 30 18:17:00 2016 kern.info kernel: [   30.760000] br-wan: port 1(eth0.2) entered forwarding state
Tue Aug 30 18:17:00 2016 daemon.notice netifd: Interface &#039;wan&#039; is enabled
Tue Aug 30 18:17:00 2016 daemon.notice netifd: Interface &#039;wan&#039; is setting up now
Tue Aug 30 18:17:00 2016 daemon.notice netifd: Interface &#039;loopback&#039; is enabled
Tue Aug 30 18:17:00 2016 daemon.notice netifd: Interface &#039;loopback&#039; is setting up now
Tue Aug 30 18:17:00 2016 daemon.notice netifd: Interface &#039;loopback&#039; is now up
Tue Aug 30 18:17:00 2016 daemon.notice netifd: Network device &#039;eth0&#039; link is up
Tue Aug 30 18:17:00 2016 daemon.notice netifd: Bridge &#039;br-lan&#039; link is up
Tue Aug 30 18:17:00 2016 daemon.notice netifd: Interface &#039;lan&#039; has link connectivity 
Tue Aug 30 18:17:00 2016 daemon.notice netifd: VLAN &#039;eth0.1&#039; link is up
Tue Aug 30 18:17:00 2016 daemon.notice netifd: Bridge &#039;br-wan&#039; link is up
Tue Aug 30 18:17:00 2016 daemon.notice netifd: Interface &#039;wan&#039; has link connectivity 
Tue Aug 30 18:17:00 2016 daemon.notice netifd: VLAN &#039;eth0.2&#039; link is up
Tue Aug 30 18:17:00 2016 daemon.notice netifd: Network device &#039;lo&#039; link is up
Tue Aug 30 18:17:00 2016 daemon.notice netifd: Interface &#039;loopback&#039; has link connectivity 
Tue Aug 30 18:17:01 2016 daemon.notice netifd: wan (917): udhcpc (v1.23.2) started
Tue Aug 30 18:17:01 2016 daemon.notice netifd: wan (917): Sending discover...
Tue Aug 30 18:17:01 2016 daemon.notice netifd: wan (917): Performing a DHCP renew
Tue Aug 30 18:17:01 2016 daemon.notice netifd: wan (917): Sending discover...
Tue Aug 30 18:17:02 2016 user.notice firewall: Reloading firewall due to ifup of lan (br-lan)
Tue Aug 30 18:17:02 2016 kern.info kernel: [   32.600000] br-lan: port 1(eth0.1) entered forwarding state
Tue Aug 30 18:17:02 2016 kern.info kernel: [   32.760000] br-wan: port 1(eth0.2) entered forwarding state
Tue Aug 30 18:17:03 2016 daemon.notice netifd: radio0 (892): Configuration file: /var/run/hostapd-phy0.conf
Tue Aug 30 18:17:04 2016 daemon.notice netifd: wan (917): Sending discover...
Tue Aug 30 18:17:04 2016 daemon.notice netifd: wan (917): Sending select for 1.2.3.10...
Tue Aug 30 18:17:04 2016 daemon.notice netifd: wan (917): Lease of 1.2.3.10 obtained, lease time 172800
Tue Aug 30 18:17:04 2016 kern.info kernel: [   34.570000] IPv6: ADDRCONF(NETDEV_UP): wlan0: link is not ready
Tue Aug 30 18:17:04 2016 daemon.notice netifd: radio0 (892): wlan0: interface state UNINITIALIZED-&gt;COUNTRY_UPDATE
Tue Aug 30 18:17:04 2016 kern.info kernel: [   34.590000] device wlan0 entered promiscuous mode
Tue Aug 30 18:17:04 2016 daemon.notice netifd: radio0 (892): Using interface wlan0 with hwaddr [redacted] and ssid &quot;OpenWRT&quot;
Tue Aug 30 18:17:04 2016 daemon.notice netifd: Interface &#039;wan&#039; is now up
Tue Aug 30 18:17:04 2016 kern.info kernel: [   35.340000] br-lan: port 2(wlan0) entered forwarding state
Tue Aug 30 18:17:04 2016 kern.info kernel: [   35.350000] br-lan: port 2(wlan0) entered forwarding state
Tue Aug 30 18:17:04 2016 kern.info kernel: [   35.360000] IPv6: ADDRCONF(NETDEV_CHANGE): wlan0: link becomes ready
Tue Aug 30 18:17:04 2016 daemon.notice netifd: radio0 (892): wlan0: interface state COUNTRY_UPDATE-&gt;ENABLED
Tue Aug 30 18:17:04 2016 daemon.notice netifd: radio0 (892): wlan0: AP-ENABLED 
Tue Aug 30 18:17:05 2016 daemon.notice netifd: Network device &#039;wlan0&#039; link is up
Tue Aug 30 18:17:06 2016 kern.info kernel: [   37.350000] br-lan: port 2(wlan0) entered forwarding state
Tue Aug 30 18:17:08 2016 daemon.info dnsmasq[1070]: started, version 2.73 cachesize 150
Tue Aug 30 18:17:08 2016 daemon.info dnsmasq[1070]: compile time options: IPv6 GNU-getopt no-DBus no-i18n no-IDN DHCP no-DHCPv6 no-Lua TFTP no-conntrack no-ipset no-auth no-DNSSEC loop-detect inotify
Tue Aug 30 18:17:08 2016 daemon.info dnsmasq[1070]: DNS service limited to local subnets
Tue Aug 30 18:17:08 2016 daemon.info dnsmasq-dhcp[1070]: DHCP, IP range 192.168.0.100 -- 192.168.0.249, lease time 12h
Tue Aug 30 18:17:08 2016 daemon.info dnsmasq[1070]: using local addresses only for domain lan
Tue Aug 30 18:17:08 2016 daemon.info dnsmasq[1070]: reading /tmp/resolv.conf.auto
Tue Aug 30 18:17:08 2016 daemon.info dnsmasq[1070]: using local addresses only for domain lan
Tue Aug 30 18:17:08 2016 daemon.info dnsmasq[1070]: using nameserver 1.2.3.4#53
Tue Aug 30 18:17:08 2016 daemon.info dnsmasq[1070]: using nameserver 1.2.3.5#53
Tue Aug 30 18:17:08 2016 daemon.info dnsmasq[1070]: read /etc/hosts - 1 addresses
Tue Aug 30 18:17:08 2016 daemon.info dnsmasq[1070]: read /tmp/hosts/dhcp - 1 addresses
Tue Aug 30 18:17:08 2016 daemon.info dnsmasq-dhcp[1070]: read /etc/ethers - 0 addresses
Tue Aug 30 18:17:09 2016 daemon.info dnsmasq[1070]: exiting on receipt of SIGTERM
Tue Aug 30 18:17:09 2016 daemon.info dnsmasq[1127]: started, version 2.73 cachesize 150
Tue Aug 30 18:17:09 2016 daemon.info dnsmasq[1127]: compile time options: IPv6 GNU-getopt no-DBus no-i18n no-IDN DHCP no-DHCPv6 no-Lua TFTP no-conntrack no-ipset no-auth no-DNSSEC loop-detect inotify
Tue Aug 30 18:17:09 2016 daemon.info dnsmasq[1127]: DNS service limited to local subnets
Tue Aug 30 18:17:09 2016 daemon.info dnsmasq-dhcp[1127]: DHCP, IP range 192.168.0.100 -- 192.168.0.249, lease time 12h
Tue Aug 30 18:17:09 2016 daemon.info dnsmasq[1127]: using local addresses only for domain lan
Tue Aug 30 18:17:09 2016 daemon.info dnsmasq[1127]: reading /tmp/resolv.conf.auto
Tue Aug 30 18:17:10 2016 daemon.info dnsmasq[1127]: using local addresses only for domain lan
Tue Aug 30 18:17:10 2016 daemon.info dnsmasq[1127]: using nameserver 1.2.3.4#53
Tue Aug 30 18:17:10 2016 daemon.info dnsmasq[1127]: using nameserver 1.2.3.5#53
Tue Aug 30 18:17:10 2016 daemon.info dnsmasq[1127]: read /etc/hosts - 1 addresses
Tue Aug 30 18:17:10 2016 daemon.info dnsmasq[1127]: read /tmp/hosts/dhcp - 1 addresses
Tue Aug 30 18:17:10 2016 daemon.info dnsmasq-dhcp[1127]: read /etc/ethers - 0 addresses
Tue Aug 30 18:17:10 2016 user.notice firewall: Reloading firewall due to ifup of wan (br-wan)
Tue Aug 30 18:17:16 2016 daemon.info dnsmasq-dhcp[1127]: DHCPDISCOVER(br-lan) [redacted] 
Tue Aug 30 18:17:16 2016 daemon.info dnsmasq-dhcp[1127]: DHCPOFFER(br-lan) 192.168.0.126 [redacted] 
Tue Aug 30 18:17:16 2016 daemon.info hostapd: wlan0: STA [redacted] IEEE 802.11: authenticated
Tue Aug 30 18:17:16 2016 daemon.info hostapd: wlan0: STA [redacted] IEEE 802.11: associated (aid 1)
Tue Aug 30 18:17:16 2016 daemon.info hostapd: wlan0: STA [redacted] WPA: pairwise key handshake completed (RSN)
Tue Aug 30 18:17:17 2016 daemon.info dnsmasq-dhcp[1127]: DHCPREQUEST(br-lan) 192.168.0.126 [redacted] 
Tue Aug 30 18:17:17 2016 daemon.info dnsmasq-dhcp[1127]: DHCPACK(br-lan) 192.168.0.126 [redacted] laptop
Tue Aug 30 18:17:18 2016 daemon.info dnsmasq-dhcp[1127]: DHCPREQUEST(br-lan) 192.168.0.118 [redacted] 
Tue Aug 30 18:17:18 2016 daemon.info dnsmasq-dhcp[1127]: DHCPACK(br-lan) 192.168.0.118 [redacted] laptop
Tue Aug 30 18:17:19 2016 kern.notice kernel: [   49.970000] random: nonblocking pool is initialized
Tue Aug 30 18:17:29 2016 daemon.info hostapd: wlan0: STA [redacted] IEEE 802.11: authenticated
Tue Aug 30 18:17:29 2016 daemon.info hostapd: wlan0: STA [redacted] IEEE 802.11: associated (aid 2)
Tue Aug 30 18:17:29 2016 daemon.info hostapd: wlan0: STA [redacted] WPA: pairwise key handshake completed (RSN)
Tue Aug 30 18:17:29 2016 daemon.info dnsmasq-dhcp[1127]: DHCPREQUEST(br-lan) 192.168.0.163 [redacted] 
Tue Aug 30 18:17:29 2016 daemon.info dnsmasq-dhcp[1127]: DHCPACK(br-lan) 192.168.0.163 [redacted] iPad
Tue Aug 30 18:19:21 2016 daemon.info hostapd: wlan0: STA [redacted] IEEE 802.11: authenticated
Tue Aug 30 18:19:21 2016 daemon.info hostapd: wlan0: STA [redacted] IEEE 802.11: associated (aid 3)
Tue Aug 30 18:19:21 2016 daemon.info hostapd: wlan0: STA [redacted] WPA: pairwise key handshake completed (RSN)
Tue Aug 30 18:19:22 2016 daemon.info dnsmasq-dhcp[1127]: DHCPREQUEST(br-lan) 192.168.0.183 [redacted] 
Tue Aug 30 18:19:22 2016 daemon.info dnsmasq-dhcp[1127]: DHCPACK(br-lan) 192.168.0.183 [redacted] iPhone
Tue Aug 30 18:21:29 2016 authpriv.info dropbear[1195]: Child connection from 192.168.0.126:53067
Tue Aug 30 18:21:37 2016 authpriv.notice dropbear[1195]: Password auth succeeded for &#039;root&#039; from 192.168.0.126:53067</code></pre></div><p>Note the line &quot;IPv6: ADDRCONF(NETDEV_UP): wlan0: link is not ready&quot;: might I be onto something here?</p><p>Thanks,</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p336909">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">cvmiller</div>
					<div class="post-datetime">
						1 Sep 2016, 20:50					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>I think the wlan0 not ready is a red herring. It become ready 1 second later.</p><p>Depending on your ISP, there may be an issue with DHCPv6 and requesting both an address (IA-NA) and a Prefix (IA-PD). RFC 7550 has been written to address this issue, but odhcpd does not yet conform.</p><p>Have you sniffed the DHCPv6 request/response from the router? This will tell you if you are getting a NoAddrsAvail error back, which could be causing the problem.</p><p>You can try putting this in your WAN6 stanza of your /etc/config/network file:<br /></p><div class="codebox"><pre><code>option reqaddress &#039;none&#039;</code></pre></div><p>And see if that works. That will cause on the PD request without the IA-NA request.</p><p>HTH</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p336981">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">corrideat</div>
					<div class="post-datetime">
						2 Sep 2016, 14:45					</div>
				</div>
				<div class="post-content content">
					<p>Thanks cvmiller!</p><p>I tried adding the reqaddress option to no avail. I also followed up on your idea of capturing traffic (not from to the router but to my computer), and it seems like my provider doesn&#039;t use DHCPv6 but SLAAC. (DHCPv6 requests get ignored but I get a bunch of ICMPv6 neighbour advertisements.)</p><p>Based on this, I changed my network/DHCP configuration to use SLAAC only and I&#039;ve made little progress. The good news is that my LAN devices now get IPv6 addresses (yay!). The bad news is that these are non-routable addresses, and that I&#039;m still not getting any addresses from my provider.</p><p>These are the relevant stanzas from /etc/config/network and /etc/config/dhcp, respectively:<br /></p><div class="codebox"><pre><code>config interface &#039;lan&#039;
    option ifname &#039;eth0.1&#039;
    option force_link &#039;1&#039;
    option macaddr &#039;[redacted]&#039;
    option type &#039;bridge&#039;
    option proto &#039;static&#039;
    option netmask &#039;255.255.255.0&#039;
    option ip6assign &#039;64&#039;
    option ipaddr &#039;192.168.1.1&#039;

config interface &#039;wan&#039;
    option ifname &#039;eth0.2&#039;
    option force_link &#039;1&#039;
    option macaddr &#039;[redacted]&#039;
    option proto &#039;dhcp&#039;
    option type &#039;bridge&#039;

config interface &#039;wan6&#039;
    option ifname &#039;eth0.2&#039;
    option type &#039;bridge&#039;
    option proto &#039;dhcpv6&#039;
    option macaddr &#039;[redacted]&#039;
    option reqaddress &#039;none&#039;</code></pre></div><div class="codebox"><pre><code>config dhcp &#039;lan&#039;
    option interface &#039;lan&#039;
    option start &#039;100&#039;
    option limit &#039;150&#039;
    option leasetime &#039;12h&#039;
    option dhcpv6 &#039;disabled&#039;
    option ra &#039;server&#039;
    #option ra_management &#039;1&#039;
    #option ndp &#039;relay&#039;

config dhcp &#039;wan&#039;
    option interface &#039;wan&#039;
    option ignore &#039;1&#039;

## Note I removed &#039;wan6&#039; from here as per the SLAAC config shown in the IPv6 wiki</code></pre></div><p>I thought my ifconfig output might be useful (br-wan6 is down):</p><div class="codebox"><pre><code>br-lan    Link encap:Ethernet  HWaddr [redacted]  
          inet addr:192.168.1.1  Bcast:192.168.1.255  Mask:255.255.255.0
          inet6 addr: fd6f:[redacted]::1/64 Scope:Global
          inet6 addr: fe80::[redacted]/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:36607 errors:0 dropped:0 overruns:0 frame:0
          TX packets:31885 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:3517478 (3.3 MiB)  TX bytes:15039366 (14.3 MiB)

br-wan    Link encap:Ethernet  HWaddr [redacted]  
          inet addr:129.241.[redacted]  Bcast:129.241.XXX.255  Mask:255.255.254.0
          inet6 addr: fe80::[redacted]/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:52722 errors:0 dropped:299 overruns:0 frame:0
          TX packets:31325 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:16478635 (15.7 MiB)  TX bytes:3449714 (3.2 MiB)

br-wan6   Link encap:Ethernet  HWaddr [redacted]  
          BROADCAST MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)

eth0      Link encap:Ethernet  HWaddr [redacted]  
          inet6 addr: fe80::[redacted]/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:91300 errors:0 dropped:2 overruns:0 frame:0
          TX packets:61984 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:21609780 (20.6 MiB)  TX bytes:17908829 (17.0 MiB)
          Interrupt:5 

eth0.1    Link encap:Ethernet  HWaddr [redacted]  
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:35121 errors:0 dropped:0 overruns:0 frame:0
          TX packets:30631 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:3304949 (3.1 MiB)  TX bytes:14208575 (13.5 MiB)

eth0.2    Link encap:Ethernet  HWaddr [redacted]  
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:52799 errors:0 dropped:49 overruns:0 frame:0
          TX packets:31338 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:16490116 (15.7 MiB)  TX bytes:3450792 (3.2 MiB)

lo        Link encap:Local Loopback  
          inet addr:127.0.0.1  Mask:255.0.0.0
          inet6 addr: ::1/128 Scope:Host
          UP LOOPBACK RUNNING  MTU:65536  Metric:1
          RX packets:32 errors:0 dropped:0 overruns:0 frame:0
          TX packets:32 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:3104 (3.0 KiB)  TX bytes:3104 (3.0 KiB)

wlan0     Link encap:Ethernet  HWaddr [redacted]  
          inet6 addr: fe80::[redacted]/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:1832 errors:0 dropped:0 overruns:0 frame:0
          TX packets:1679 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:283047 (276.4 KiB)  TX bytes:905918 (884.6 KiB)</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p337007">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">cvmiller</div>
					<div class="post-datetime">
						2 Sep 2016, 19:28					</div>
				</div>
				<div class="post-content content">
					<p>Hmm,</p><p>SLAAC-only is going to be a problem, as in &quot;normal&quot; IPv6 routing, you would need a different prefix for your LAN, which is usually handed out via DHCPv6-PD (prefix delegation).</p><p>But that said, there are 2 solutions for your problem where the provider doesn&#039;t provide you with a second /64 to use on your LAN. <br />1) set up odhcpd in &quot;relay&quot; mode. Actually, you need to set NDP, RA, to relay mode<br />2) use v6Brouter script . v6Brouter is more complex than using odhcpd in relay mode, but it allows you to have &quot;services&quot; from your LAN. &quot;relay mode&quot; blocks all external access to the LAN.<br /><a href="https://github.com/cvmiller/v6brouter">https://github.com/cvmiller/v6brouter</a></p><p>HTH</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p337009">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">corrideat</div>
					<div class="post-datetime">
						2 Sep 2016, 20:14					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>I think I&#039;ve solved the issue by taking a different approach. I bridged all the network interfaces together and disabled DHCP (i.e., made my device a dumb switch + AP). Now, I seem to get public IPv4 and IPv6 addresses on my devices (well, actually, I&#039;m not so sure about getting IPv6 on wireless, but it might be a limitation of my laptop).</p><p>Thanks,</p><p>EDIT 20160903T231000Z: I&#039;ve had some extra time to verify my new setup. I really like the fact that I don&#039;t need to do NAT anymore and that my IPv6 connectivity has improved (from nonexistent to available on wired connections). However, I have two issues:</p><ul><li><p>Perhaps just a nuisance, &#039;dumbing down&#039; my router to make it a switch means that local DNS resolution won&#039;t work anymore. I imagine this can&#039;t be solved without much work to intercept (and account for) DHCP(v6) packages, among other things.</p></li><li><p>More importantly (and more on topic), it would seem that the lack of WLAN IPv6 connectivity isn&#039;t specific to the laptop I was testing with. I connected a different Linux laptop, ran dhcpcd manually both on wired and wireless interfaces and it worked for wired but not for wireless. Strange as the WLAN should be bridged to VLAN 1 which is also bridged to the LAN port.</p></li></ul><p>Might you have any suggestions as to what may be disrupting IPv6 on wireless?</p><p>Thanks again,</p>											<p class="post-edited">(Last edited by <strong>corrideat</strong> on 3 Sep 2016, 02:09)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p337053">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">cvmiller</div>
					<div class="post-datetime">
						3 Sep 2016, 07:15					</div>
				</div>
				<div class="post-content content">
					<p>Good you have it working (sort of). I am concerned that you now lack a firewall of any sort. That is why I thought the &quot;relay-mode&quot; or v6brouter, might work for you.</p><p>Bridging to a wireless interface doesn&#039;t really work the way you would think. 802.11 (wireless) uses a different header format than 802.3 (eithernet). So you can&#039;t just shove the frame across the wireless, because you would have to encapsulate the ethernet header in an 802.11 header, and then the receiving side would have to be smart enough to de-encapsulate it. This is much more than bridging. WDS does this, but WDS is sketchy on what supports it, since there isn&#039;t a single standard everyone adheres to.</p><p>Why does IPv4 work? Because there are hacks to make it work, but those hacks don&#039;t exist for IPv6 <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><p>HTH</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p337061">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">corrideat</div>
					<div class="post-datetime">
						3 Sep 2016, 12:43					</div>
				</div>
				<div class="post-content content">
					<p>Thanks again!</p><p>Unfortunately, using the brouter script requires ebtables, which OpenWRT doesn&#039;t have any more. (I could compile manually, but at the moment I&#039;m wondering whether it would be worth the effort, especially because, if I understand correctly, it would suffer from the same pitfalls as my current setup, namely that IPv6 wireless won&#039;t work.)</p><p>As for firewalling, you&#039;re right. Right now, I have no firewall between my devices and the Internet; I reckon this could be fixed by using the physdev iptables module.</p><p>I am currently testing my new setup. Although things look good, I&#039;m starting to experience some weird connectivity/DHCP failures that I hadn&#039;t had before. So, I&#039;m going to test the current (dumb switch) configuration for a couple of days and report back. I may appear, though, that, as evil as NAT is, it might be my only choice both for IPv4 and IPv6. (It&#039;s funny my provider is happy to give me as many publicly routable addresses as I need but no prefixes, isn&#039;t it? <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" />)</p><p>Let&#039;s see how this end up!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p337092">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">cvmiller</div>
					<div class="post-datetime">
						3 Sep 2016, 19:06					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><blockquote><p>Unfortunately, using the brouter script requires ebtables, which OpenWRT doesn&#039;t have any more</p></blockquote></div><p>I am surprised at your statement, as it is in the repo for 15.05.1 for my router (a linksys). Perhaps there are some architectures which they didn&#039;t build it.</p><p>Give a look at doing the &quot;relay-mode&quot; with odhcpd. It works pretty well, and gives you protection from inbound connections.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>