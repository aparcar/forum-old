<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> How to get the 88E6161 driver work</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 7 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p299137">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">wacke</div>
					<div class="post-datetime">
						9 Nov 2015, 17:43					</div>
				</div>
				<div class="post-content content">
					<p>info of my device:</p><p>CPU:1.2 GHz ARM Marvell 88F6281<br />Memory:64M NAND Flash,512M DDR2 800<br />Storage:SDx1,SATAx1,USB 2.0x2<br />Network:88E6161 Switch chip with 5 gigabit port(include 1 aux port),88E1116 with 1 gigabit&nbsp; port </p><p>The hardware is most likely sheevaplug,I modifed the sheevaplug dts file to compile trunk.</p><p>below is the kernel boot log:<br /></p><div class="codebox"><pre><code>Starting kernel ...

[    0.000000] Booting Linux on physical CPU 0x0
[    0.000000] Linux version 4.3.0 (Wacke@HOME-Server) (gcc version 5.2.0 (OpenWrt GCC 5.2.0 r47397) ) #2 Mon Nov 9 22:57:43 CST 2015
[    0.000000] CPU: Feroceon 88FR131 [56251311] revision 1 (ARMv5TE), cr=0005397f
[    0.000000] CPU: VIVT data cache, VIVT instruction cache
[    0.000000] Machine model: QiZhiTong 501M V2
[    0.000000] Memory policy: Data cache writeback
[    0.000000] Built 1 zonelists in Zone order, mobility grouping on.  Total pages: 130048
[    0.000000] Kernel command line: rootdelay=1 root=/dev/mmcblk0p1 noinitrd console=ttyS0,9600
[    0.000000] PID hash table entries: 2048 (order: 1, 8192 bytes)
[    0.000000] Dentry cache hash table entries: 65536 (order: 6, 262144 bytes)
[    0.000000] Inode-cache hash table entries: 32768 (order: 5, 131072 bytes)
[    0.000000] Memory: 514232K/524288K available (3882K kernel code, 130K rwdata, 1076K rodata, 160K init, 192K bss, 10056K reserved, 0K cma-reserved)
[    0.000000] Virtual kernel memory layout:
[    0.000000]     vector  : 0xffff0000 - 0xffff1000   (   4 kB)
[    0.000000]     fixmap  : 0xffc00000 - 0xfff00000   (3072 kB)
[    0.000000]     vmalloc : 0xe0800000 - 0xff000000   ( 488 MB)
[    0.000000]     lowmem  : 0xc0000000 - 0xe0000000   ( 512 MB)
[    0.000000]     modules : 0xbf000000 - 0xc0000000   (  16 MB)
[    0.000000]       .text : 0xc0008000 - 0xc04dfdc4   (4960 kB)
[    0.000000]       .init : 0xc04e0000 - 0xc0508000   ( 160 kB)
[    0.000000]       .data : 0xc0508000 - 0xc0528a90   ( 131 kB)
[    0.000000]        .bss : 0xc0528a90 - 0xc0558d1c   ( 193 kB)
[    0.000000] NR_IRQS:16 nr_irqs:16 16
[    0.000000] clocksource: orion_clocksource: mask: 0xffffffff max_cycles: 0xffffffff, max_idle_ns: 9556302233 ns
[    0.000008] sched_clock: 32 bits at 200MHz, resolution 5ns, wraps every 10737418237ns
[    0.000140] Calibrating delay loop... 1191.11 BogoMIPS (lpj=5955584)
[    0.090082] pid_max: default: 32768 minimum: 301
[    0.090203] Mount-cache hash table entries: 1024 (order: 0, 4096 bytes)
[    0.090220] Mountpoint-cache hash table entries: 1024 (order: 0, 4096 bytes)
[    0.090710] CPU: Testing write buffer coherency: ok
[    0.091022] Setting up static identity map for 0x81e0 - 0x821c
[    0.091278] mvebu-soc-id: MVEBU SoC ID=0x6281, Rev=0x3
[    0.095701] clocksource: jiffies: mask: 0xffffffff max_cycles: 0xffffffff, max_idle_ns: 19112604462750000 ns
[    0.095823] pinctrl core: initialized pinctrl subsystem
[    0.096837] NET: Registered protocol family 16
[    0.097192] DMA: preallocated 256 KiB pool for atomic coherent allocations
[    0.098004] cpuidle: using governor ladder
[    0.098338] Feroceon L2: Enabling L2
[    0.098378] Feroceon L2: Cache support initialised.
[    0.098634] [Firmware Info]: /ocp@f1000000/ethernet-controller@72000/ethernet0-port@0: local-mac-address is not set
[    0.098727] [Firmware Info]: /ocp@f1000000/ethernet-controller@76000/ethernet1-port@0: local-mac-address is not set
[    0.114959] SCSI subsystem initialized
[    0.115278] usbcore: registered new interface driver usbfs
[    0.115361] usbcore: registered new interface driver hub
[    0.115429] usbcore: registered new device driver usb
[    0.116302] clocksource: Switched to clocksource orion_clocksource
[    0.117249] NET: Registered protocol family 2
[    0.117770] TCP established hash table entries: 4096 (order: 2, 16384 bytes)
[    0.117826] TCP bind hash table entries: 4096 (order: 2, 16384 bytes)
[    0.117876] TCP: Hash tables configured (established 4096 bind 4096)
[    0.117929] UDP hash table entries: 256 (order: 0, 4096 bytes)
[    0.117950] UDP-Lite hash table entries: 256 (order: 0, 4096 bytes)
[    0.118101] NET: Registered protocol family 1
[    0.118927] futex hash table entries: 256 (order: -1, 3072 bytes)
[    0.122369] squashfs: version 4.0 (2009/01/31) Phillip Lougher
[    0.122389] jffs2: version 2.2 (NAND) (SUMMARY) (LZMA) (RTIME) (CMODE_PRIORITY) (c) 2001-2006 Red Hat, Inc.
[    0.123405] io scheduler noop registered
[    0.123422] io scheduler deadline registered (default)
[    0.124519] kirkwood-pinctrl f1010000.pin-controller: registered pinctrl driver
[    0.125068] irq: Cannot allocate irq_descs @ IRQ34, assuming pre-allocated
[    0.125401] irq: Cannot allocate irq_descs @ IRQ66, assuming pre-allocated
[    0.125948] mvebu-pcie mbus:pcie-controller: PCI host bridge to bus 0000:00
[    0.125965] pci_bus 0000:00: root bus resource [io  0x1000-0xfffff]
[    0.125977] pci_bus 0000:00: root bus resource [mem 0xe0000000-0xefffffff]
[    0.125989] pci_bus 0000:00: root bus resource [bus 00-ff]
[    0.126230] PCI: bus0: Fast back to back transfers disabled
[    0.126245] pci 0000:00:01.0: bridge configuration invalid ([bus 00-00]), reconfiguring
[    0.126400] PCI: bus1: Fast back to back transfers enabled
[    0.126444] pci 0000:00:01.0: PCI bridge to [bus 01]
[    0.158256] Serial: 8250/16550 driver, 2 ports, IRQ sharing disabled
[    0.159224] console [ttyS0] disabled
[    0.159290] f1012000.serial: ttyS0 at MMIO 0xf1012000 (irq = 26, base_baud = 12500000) is a 16550A
[    5.563377] console [ttyS0] enabled
[    5.606231] nand: device found, Manufacturer ID: 0x20, Chip ID: 0x76
[    5.682341] nand: ST Micro NAND 64MiB 3,3V 8-bit
[    5.737638] nand: 64 MiB, SLC, erase size: 16 KiB, page size: 512, OOB size: 16
[    5.825239] Scanning device for bad blocks
[    6.090351] 3 ofpart partitions found on MTD device orion_nand
[    6.160213] Creating 3 MTD partitions on &quot;orion_nand&quot;:
[    6.221775] 0x000000000000-0x000000100000 : &quot;u-boot&quot;
[    6.318822] 0x000000100000-0x000000300000 : &quot;uImage&quot;
[    6.379367] 0x000000300000-0x000000800000 : &quot;rootfs&quot;
[    6.439985] mtd: device 2 (rootfs) set to be root filesystem
[    6.507901] mtdsplit: no squashfs found in &quot;rootfs&quot;
[    6.566902] libphy: orion_mdio_bus: probed
[    6.616836] mv643xx_eth: MV-643xx 10/100/1000 ethernet driver version 1.4
[    6.699507] mv643xx_eth_port mv643xx_eth_port.0 eth0: port 0 with MAC address 00:90:0b:1d:38:44
[    6.805109] mv643xx_eth_port mv643xx_eth_port.1 eth1: port 0 with MAC address 00:90:0b:1d:38:45
[    6.909577] sky2: driver version 1.30
[    6.953461] ehci_hcd: USB 2.0 &#039;Enhanced&#039; Host Controller (EHCI) Driver
[    7.031625] ehci-pci: EHCI PCI platform driver
[    7.084903] ehci-platform: EHCI generic platform driver
[    7.147578] ehci-orion: EHCI orion driver
[    7.195722] orion-ehci f1050000.ehci: EHCI Host Controller
[    7.261424] orion-ehci f1050000.ehci: new USB bus registered, assigned bus number 1
[    7.353279] orion-ehci f1050000.ehci: irq 29, io mem 0xf1050000
[    7.436320] orion-ehci f1050000.ehci: USB 2.0 started, EHCI 1.00
[    7.508859] hub 1-0:1.0: USB hub found
[    7.553956] hub 1-0:1.0: 1 port detected
[    7.601256] usbcore: registered new interface driver usb-storage
[    7.673748] mvsdio f1090000.mvsdio: Got CD GPIO
[    7.766961] NET: Registered protocol family 10
[    7.821441] NET: Registered protocol family 17
[    7.874746] bridge: automatic filtering via arp/ip/ip6tables has been deprecated. Update your scripts to load br_netfilter if you need this.
[    8.025961] Distributed Switch Architecture driver version 0.1
[    8.097056] mv643xx_eth_port mv643xx_eth_port.0 eth0: [0]: could not detect attached switch
[    8.197189] mv643xx_eth_port mv643xx_eth_port.0 eth0: [0]: couldn&#039;t create dsa switch instance (error -22)
[    8.312966] 8021q: 802.1Q VLAN Support v1.8
[    8.366790] mv643xx_eth_port mv643xx_eth_port.0 eth0: [0]: could not detect attached switch
[    8.466861] mv643xx_eth_port mv643xx_eth_port.0 eth0: [0]: couldn&#039;t create dsa switch instance (error -22)
[    8.582597] usb 1-1: new high-speed USB device number 2 using orion-ehci
[    8.663114] hctosys: unable to open rtc device (rtc0)
[    8.725039] Waiting 1 sec before mounting root device...
[    8.812957] mmc0: host does not support reading read-only switch, assuming write-enable
[    8.908983] mmc0: new SD card at address a9b7
[    8.961695] mmcblk0: mmc0:a9b7 SU02G 1.89 GiB 
[    9.016147]  mmcblk0: p1
[    9.047204] mv643xx_eth_port mv643xx_eth_port.0 eth0: [0]: could not detect attached switch
[    9.147349] mv643xx_eth_port mv643xx_eth_port.0 eth0: [0]: couldn&#039;t create dsa switch instance (error -22)
[    9.263720] hub 1-1:1.0: USB hub found
[    9.308715] hub 1-1:1.0: 2 ports detected
[    9.357520] mv643xx_eth_port mv643xx_eth_port.0 eth0: [0]: could not detect attached switch
[    9.457630] mv643xx_eth_port mv643xx_eth_port.0 eth0: [0]: couldn&#039;t create dsa switch instance (error -22)
[    9.796370] UBIFS error (pid: 1): cannot open &quot;ubi0:rootfs&quot;, error -19
[    9.873128] EXT4-fs (mmcblk0p1): couldn&#039;t mount as ext3 due to feature incompatibilities
[    9.972893] EXT4-fs (mmcblk0p1): mounting ext2 file system using the ext4 subsystem
[   10.079499] EXT4-fs (mmcblk0p1): mounted filesystem without journal. Opts: (null)
[   10.169168] VFS: Mounted root (ext2 filesystem) readonly on device 179:1.
[   10.250945] Freeing unused kernel memory: 160K (c04e0000 - c0508000)
[   10.594175] init: Console is alive
[   11.635399] init: - preinit -
Press the [f] key and hit [enter] to enter failsafe mode
Press the [1], [2], [3] or [4] key and hit [enter] to select the debug level
[   14.797953] mount_root: mounting /dev/root
[   14.847202] EXT4-fs (mmcblk0p1): warning: mounting unchecked fs, running e2fsck is recommended
[   14.951522] EXT4-fs (mmcblk0p1): re-mounted. Opts: (null)
[   15.021820] procd: - early -
[   16.017142] procd: - ubus -
[   17.055507] random: ubusd urandom read with 21 bits of entropy available
[   18.151217] procd: - init -
Please press Enter to activate this console.
[   19.594137] ip6_tables: (C) 2000-2006 Netfilter Core Team
[   19.756455] Netfilter messages via NETLINK v0.30.
[   19.865886] ip_set: protocol 6
[   19.981921] i2c /dev entries driver
[   20.038557] ip_tables: (C) 2000-2006 Netfilter Core Team
[   20.107883] nf_conntrack version 0.5.0 (8037 buckets, 32148 max)
[   20.200778] xt_time: kernel timezone is -0000
[   20.260213] PPP generic driver version 2.4.2
[   20.312983] NET: Registered protocol family 24
[   22.825176] mv643xx_eth_port mv643xx_eth_port.0 eth0: link up, 1000 Mb/s, full duplex, flow control disabled
[   23.101708] device eth0 entered promiscuous mode
[   23.174619] IPv6: ADDRCONF(NETDEV_UP): br-lan: link is not ready
[   23.816421] br-lan: port 1(eth0) entered forwarding state
[   23.881109] br-lan: port 1(eth0) entered forwarding state
[   23.979089] IPv6: ADDRCONF(NETDEV_CHANGE): br-lan: link becomes ready
[   25.876308] br-lan: port 1(eth0) entered forwarding state
[   78.796330] random: nonblocking pool is initialized</code></pre></div><p>the uboot output:<br /></p><div class="codebox"><pre><code>         __  __                      _ _
        |  \/  | __ _ _ ____   _____| | |
        | |\/| |/ _` | &#039;__\ \ / / _ \ | |
        | |  | | (_| | |   \ V /  __/ | |
        |_|  |_|\__,_|_|    \_/ \___|_|_|
 _   _     ____              _
| | | |   | __ )  ___   ___ | |_ 
| | | |___|  _ \ / _ \ / _ \| __| 
| |_| |___| |_) | (_) | (_) | |_ 
 \___/    |____/ \___/ \___/ \__| 
 ** MARVELL BOARD: MB-302 v1.0

U-Boot 1.1.4 (Nov 11 2010 - 16:09:33) Marvell version: 3.4.27 T06

U-Boot code: 00600000 -&gt; 0067FFF0  BSS: -&gt; 006CFAC0

Soc: 88F6281 A1 (DDR2)
CPU running @ 1200Mhz L2 running @ 400Mhz
SysClock = 400Mhz , TClock = 200Mhz 

DRAM CAS Latency = 5 tRP = 5 tRAS = 18 tRCD=6
DRAM CS[0] base 0x00000000   size 256MB 
DRAM CS[1] base 0x10000000   size 256MB 
DRAM Total size 512MB  16bit width
Addresses 8M - 0M are saved for the U-Boot usage.
Mem malloc Initialization (8M - 7M): Done
NAND:64 MB
Flash:  0 kB

CPU : Marvell Feroceon (Rev 1)

Streaming disabled 
Write allocate disabled

Module 0 is RGMII

USB 0: host mode
PEX 0: interface detected no Link.
Net:   egiga0 [PRIME], egiga1
Hit &#039;Tab&#039; key to switch the boot entry:  0</code></pre></div><p>modifed dts file:<br /></p><div class="codebox"><pre><code>/dts-v1/;
#include &quot;kirkwood-rd88f6281.dtsi&quot;

/ {
    model = &quot;QiZhiTong 501M V2&quot;;
    compatible = &quot;marvell,rd88f6281-a&quot;,&quot;marvell,kirkwood-88f6281&quot;,&quot;marvell,kirkwood&quot;;
    
    
    mbus {
        pcie-controller {
            status = &quot;okay&quot;;

            pcie@1,0 {
                status = &quot;okay&quot;;
            };
        };
    };    

    ocp@f1000000 {
        pinctrl: pin-controller@10000 {
            compatible = &quot;marvell,88f6281-pinctrl&quot;;

            pmx_sata0: pmx-sata0 {
                marvell,pins = &quot;mpp5&quot;, &quot;mpp21&quot;, &quot;mpp23&quot;;
                marvell,function = &quot;sata0&quot;;
            };

            pmx_sdio: pmx-sdio {
                marvell,pins = &quot;mpp12&quot;, &quot;mpp13&quot;, &quot;mpp14&quot;,
                           &quot;mpp15&quot;, &quot;mpp16&quot;, &quot;mpp17&quot;;
                marvell,function = &quot;sdio&quot;;
            };
        };    
    };    
    
    mvsw61xx {
        compatible = &quot;marvell,88e6161&quot;;
        status = &quot;okay&quot;;
        reg = &lt;0x10&gt;;

        mii-bus = &lt;&amp;mdio&gt;;
        cpu-port-0 = &lt;5&gt;;
        is-indirect;
    };
    
        dsa@0 {
        compatible = &quot;marvell,dsa&quot;;
        #address-cells = &lt;2&gt;;
        #size-cells = &lt;0&gt;;

        dsa,ethernet = &lt;&amp;eth0port&gt;;
        dsa,mii-bus = &lt;&amp;mdio&gt;;

        switch@0 {
            #address-cells = &lt;1&gt;;
            #size-cells = &lt;0&gt;;
            reg = &lt;0 0&gt;;    /* MDIO address 0, switch 0 in tree */

            port@0 {
                reg = &lt;0&gt;;
                label = &quot;lan1&quot;;
            };

            port@1 {
                   reg = &lt;1&gt;;
                   label = &quot;lan2&quot;;
            };

            port@2 {
                   reg = &lt;2&gt;;
                   label = &quot;lan3&quot;;
            };

            port@3 {
                   reg = &lt;3&gt;;
                   label = &quot;lan4&quot;;
            };

            port@4 {
                reg = &lt;4&gt;;
                label = &quot;aux&quot;;
            };

            port@5 {
                   reg = &lt;5&gt;;
                   label = &quot;cpu&quot;;
            };
        };
    };
};




&amp;mdio {
    status = &quot;okay&quot;;
    ethphy1: ethernet-phy@1 {
        reg = &lt;1&gt;;
    };
};


&amp;eth1 {
    status = &quot;okay&quot;;

    ethernet1-port@0 {
         phy-handle = &lt;&amp;ethphy1&gt;;
         speed = &lt;1000&gt;;
         duplex = &lt;1&gt;;
    };
};</code></pre></div><p>It seems that the 88E6161 switch driver don&#039;t work.<br />Is there anybody knows why?And how to get the 88E6161 switch chip work?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p299565">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">wacke</div>
					<div class="post-datetime">
						12 Nov 2015, 18:11					</div>
				</div>
				<div class="post-content content">
					<p>Is there any one can help this? Thanks.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p356078">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">youxiaojie</div>
					<div class="post-datetime">
						12 Apr 2017, 06:02					</div>
				</div>
				<div class="post-content content">
					<p>did you get Qizhitong 501m V2 ready? <br />企智通搞好了吗?</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>