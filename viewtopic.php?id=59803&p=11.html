<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> adblock package, release 2.x</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 22 Mar 2018 and 4 May 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 11 of 17</div><nav><ul><li><a href="viewtopic.php%3Fid=59803&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=59803&amp;p=9.html">9</a></li><li><a href="viewtopic.php%3Fid=59803&amp;p=10.html">10</a></li><li class="pagination-current"><span>11</span></li><li><a href="viewtopic.php%3Fid=59803&amp;p=12.html">12</a></li><li><a href="viewtopic.php%3Fid=59803&amp;p=13.html">13</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=59803&amp;p=17.html">17</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p329376">
				<div class="post-metadata">
					<div class="post-num">Post #251</div>
					<div class="post-author">dape</div>
					<div class="post-datetime">
						21 Jun 2016, 22:41					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>dibdot wrote:</cite><blockquote><p>Wait for 1.2.7 ... <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p></blockquote></div><p>You&#039;re awesome, i&#039;m still on 1.2.6 on the builds i do for people in Romania.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p329513">
				<div class="post-metadata">
					<div class="post-num">Post #252</div>
					<div class="post-author">shm0</div>
					<div class="post-datetime">
						23 Jun 2016, 03:37					</div>
				</div>
				<div class="post-content content">
					<p>hi</p><p>thank you for the great addon!</p><p>when i open a blocked domain domain through https chrome tells me the connection got closed.<br />How can i fix this?</p>											<p class="post-edited">(Last edited by <strong>shm0</strong> on 23 Jun 2016, 05:01)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p329522">
				<div class="post-metadata">
					<div class="post-num">Post #253</div>
					<div class="post-author">dibdot</div>
					<div class="post-datetime">
						23 Jun 2016, 05:55					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>shm0 wrote:</cite><blockquote><p>hi</p><p>thank you for the great addon!</p><p>when i open a blocked domain domain through https chrome tells me the connection got closed.<br />How can i fix this?</p></blockquote></div><p>this is the normal behaviour for ad related ssl connections, they can&#039;t be redirected to a pixel server cause a https connections requires a valid certificate (i.e. from doubleclick.net). In times of ssl pinning I&#039;m not willing to fake certificates on the fly ... it&#039;s evil stuff in my opinion.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p329585">
				<div class="post-metadata">
					<div class="post-num">Post #254</div>
					<div class="post-author">shm0</div>
					<div class="post-datetime">
						23 Jun 2016, 17:06					</div>
				</div>
				<div class="post-content content">
					<p>So the uhttp instance on port 65535/443 is unnecessary?<br />Why does <a href="http://a.admob.com:443/">http://a.admob.com:443/</a> give an empty respsonse?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p329586">
				<div class="post-metadata">
					<div class="post-num">Post #255</div>
					<div class="post-author">dibdot</div>
					<div class="post-datetime">
						23 Jun 2016, 17:10					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>shm0 wrote:</cite><blockquote><p>So the uhttp instance on port 65535/443 is unnecessary?<br />Why does <a href="http://a.admob.com:443/">http://a.admob.com:443/</a> give an empty respsonse?</p></blockquote></div><p>No, this &quot;ssl&quot; instance has a network timeout of &quot;0&quot; ... so connection will be instantly closed. This is the fastest way to bring down a ssl connection on client side.</p>											<p class="post-edited">(Last edited by <strong>dibdot</strong> on 23 Jun 2016, 17:10)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p329597">
				<div class="post-metadata">
					<div class="post-num">Post #256</div>
					<div class="post-author">shm0</div>
					<div class="post-datetime">
						23 Jun 2016, 18:37					</div>
				</div>
				<div class="post-content content">
					<p>Thank you. </p><p>Another question :&lt;</p><p>Can this work with multiple lan interfaces? (Two networks 192.168.0.X 192.168.1.X)<br />Especially the &quot;Redirect all DNS queries to the local resolver&quot; option.<br />One of the networks is only allowed to connect to the internet and to dhcp/dns on the router (but to any router address).</p><p>Is this adblock package in anything different then the adblock package included in openwrt?</p>											<p class="post-edited">(Last edited by <strong>shm0</strong> on 23 Jun 2016, 19:19)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p329609">
				<div class="post-metadata">
					<div class="post-num">Post #257</div>
					<div class="post-author">dibdot</div>
					<div class="post-datetime">
						23 Jun 2016, 22:57					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>shm0 wrote:</cite><blockquote><p>Thank you. </p><p>Another question :&lt;</p><p>Can this work with multiple lan interfaces? (Two networks 192.168.0.X 192.168.1.X)<br />Especially the &quot;Redirect all DNS queries to the local resolver&quot; option.<br />One of the networks is only allowed to connect to the internet and to dhcp/dns on the router (but to any router address).</p><p>Is this adblock package in anything different then the adblock package included in openwrt?</p></blockquote></div><p>I don&#039;t know. Both networks have to use the same dns resolver and the router(uhttpd ip must be reachable from both networks. The force_dns rule is limited to one lan device/interface - if you need more, then disable this in the adblock config and put your own rules in firewall.user.</p>											<p class="post-edited">(Last edited by <strong>dibdot</strong> on 24 Jun 2016, 17:21)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p329860">
				<div class="post-metadata">
					<div class="post-num">Post #258</div>
					<div class="post-author">Polochamps</div>
					<div class="post-datetime">
						26 Jun 2016, 17:58					</div>
				</div>
				<div class="post-content content">
					<p>Is this compatible with Attitude Adjustment? Thanks</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p330154">
				<div class="post-metadata">
					<div class="post-num">Post #259</div>
					<div class="post-author">WildByDesign</div>
					<div class="post-datetime">
						29 Jun 2016, 21:09					</div>
				</div>
				<div class="post-content content">
					<p>@dibdot, 1.3.0 seems to consistently fail for me when downloading source lists.&nbsp; I have tried restarting the service and also rebooting the device.</p><div class="codebox"><pre><code>Wed Jun 29 18:05:22 2016 user.notice adblock[1368] info : adblock service started due to &#039;ifup&#039; of &#039;wan&#039; interface
Wed Jun 29 18:05:22 2016 user.notice adblock[1457] info : domain adblock processing started (1.3.0, r706, 29.06.2016 18:05:22)
Wed Jun 29 18:05:22 2016 user.notice adblock[1457] info : backup/restore will be disabled
Wed Jun 29 18:05:23 2016 user.notice adblock[1457] info : created volatile firewall rulesets
Wed Jun 29 18:05:23 2016 user.notice adblock[1457] info : created volatile uhttpd instances
Wed Jun 29 18:05:23 2016 user.notice adblock[1457] info : =&gt; processing source &#039;adaway&#039;
Wed Jun 29 18:05:23 2016 user.notice adblock[1457] info :    no online timestamp
Wed Jun 29 18:05:23 2016 user.notice adblock[1457] info :    source download failed, skipped
Wed Jun 29 18:05:23 2016 user.notice adblock[1457] info : =&gt; processing source &#039;disconnect&#039;
Wed Jun 29 18:05:23 2016 user.notice adblock[1457] info :    no online timestamp
Wed Jun 29 18:05:23 2016 user.notice adblock[1457] info :    source download failed, skipped
Wed Jun 29 18:05:23 2016 user.notice adblock[1457] info : =&gt; processing source &#039;yoyo&#039;
Wed Jun 29 18:05:23 2016 user.notice adblock[1457] info :    no online timestamp
Wed Jun 29 18:05:23 2016 user.notice adblock[1457] info :    source download failed, skipped
Wed Jun 29 18:05:23 2016 user.notice adblock[1457] info : block lists with overall 0 domains are still valid, no update required
Wed Jun 29 18:05:23 2016 user.notice adblock[1457] info : firewall statistics (IPv4/IPv6): 0%/0% of all packets in prerouting chain are ad related &amp; blocked
Wed Jun 29 18:05:23 2016 user.notice adblock[1457] info : domain adblock processing finished successfully (1.3.0, r706, 29.06.2016 18:05:23)</code></pre></div><p>Are there any other details that I can provide to help diagnose this issue?</p><p>The upgrade from 1.2.8 to 1.3.0 mentioned removing wget, but otherwise no errors with configuration or anything like that.&nbsp; I always use the option with each new release to start with a fresh configuration file based on each new release.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p330155">
				<div class="post-metadata">
					<div class="post-num">Post #260</div>
					<div class="post-author">dape</div>
					<div class="post-datetime">
						29 Jun 2016, 21:13					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>WildByDesign wrote:</cite><blockquote><p>@dibdot, 1.3.0 seems to consistently fail for me when downloading source lists.</p></blockquote></div><p>Hi, works for me without problems on a tp-link wdr4900 with adblock 1.3.0 and LEDE r817 ..</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p330200">
				<div class="post-metadata">
					<div class="post-num">Post #261</div>
					<div class="post-author">dibdot</div>
					<div class="post-datetime">
						30 Jun 2016, 15:46					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>WildByDesign wrote:</cite><blockquote><p>@dibdot, 1.3.0 seems to consistently fail for me when downloading source lists.&nbsp; I have tried restarting the service and also rebooting the device.</p></blockquote></div><p>Did you remove wget in your build? There was a gap in the uclient-fetch detection, that was fixed in 1.3.1. Please retest with that version ... at least you should get an error message with missing wget/uclient-fetch.</p><p>br<br />dirk</p><p>P.S. If you still receive download errors with 1.3.1, please set &quot;adb_debug&quot; in /etc/init.d/adblock to &quot;1&quot; and restart adblock processing and send me the output to my email - thanks.</p>											<p class="post-edited">(Last edited by <strong>dibdot</strong> on 30 Jun 2016, 15:49)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p330204">
				<div class="post-metadata">
					<div class="post-num">Post #262</div>
					<div class="post-author">WildByDesign</div>
					<div class="post-datetime">
						30 Jun 2016, 17:21					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>dibdot wrote:</cite><blockquote><div class="quotebox"><cite>WildByDesign wrote:</cite><blockquote><p>@dibdot, 1.3.0 seems to consistently fail for me when downloading source lists.&nbsp; I have tried restarting the service and also rebooting the device.</p></blockquote></div><p>Did you remove wget in your build? There was a gap in the uclient-fetch detection, that was fixed in 1.3.1. Please retest with that version ... at least you should get an error message with missing wget/uclient-fetch.</p><p>br<br />dirk</p><p>P.S. If you still receive download errors with 1.3.1, please set &quot;adb_debug&quot; in /etc/init.d/adblock to &quot;1&quot; and restart adblock processing and send me the output to my email - thanks.</p></blockquote></div><p>Thank you for the suggestions.&nbsp; I am running 1.3.1 now for testing.&nbsp; The wget package was removed by installing 1.3.0, the install had mentioned the removal of wget.</p><p>So I assume the failure initially was that there was no uclient-fetch or wget to download the source lists.&nbsp; So I installed uclient-fetch now after installing 1.3.1 because I assume that 1.3.0 removed wget for a reason.</p><p>Unfortunately, uclient-fetch on my system is not working correctly.&nbsp; I keep getting &quot;runtime error, please check the log!&quot;.&nbsp; I tried a few reboots and still failures.</p><p>So I decided to install wget, and successfully downloaded the source lists and adblock was working. One time anyway, it was successful.</p><p>Then I realized that since it was not working with uclient-fetch but it was working with wget, I&#039;d remove uclient-fetch since I no longer needed it.</p><p>I simply removed uclient-fetch from System - Software section and for whatever reason, removing uclient-fetch has borked things quite a bit.&nbsp; opkg is no longer working.&nbsp; adblock is no longer working.&nbsp; Within LuCI, the System - Software page is completely missing even after reboot.</p><p>So at the moment I just have to either re-install LEDE (either re-flash or probably try restore defaults first) and then I will go back to 1.3.1 and I will just stick with wget for now. I&#039;ll let you know how it&#039;s going once I get this problem sorted out.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p330207">
				<div class="post-metadata">
					<div class="post-num">Post #263</div>
					<div class="post-author">dibdot</div>
					<div class="post-datetime">
						30 Jun 2016, 17:43					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>WildByDesign wrote:</cite><blockquote><p>So at the moment I just have to either re-install LEDE (either re-flash or probably try restore defaults first) and then I will go back to 1.3.1 and I will just stick with wget for now. I&#039;ll let you know how it&#039;s going once I get this problem sorted out.</p></blockquote></div><p>Sorry for that. The default uclient-fetch installation (with libustream-polarssl) is not supported, cause polarssl didn&#039;t support certain https sites. You need to switch the underlying libustream-library for this to work (check latest documentation on how to do that). For normal use cases &#039;wget&#039; is still the best selection.</p><p>Again, sorry for the troubles!<br />dirk</p><p>P.S. The mentioned debug output is only visible via logread -e &quot;adblock&quot;, not in LuCI.</p>											<p class="post-edited">(Last edited by <strong>dibdot</strong> on 30 Jun 2016, 17:45)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p330233">
				<div class="post-metadata">
					<div class="post-num">Post #264</div>
					<div class="post-author">WildByDesign</div>
					<div class="post-datetime">
						1 Jul 2016, 01:11					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>dibdot wrote:</cite><blockquote><p>Sorry for that. The default uclient-fetch installation (with libustream-polarssl) is not supported, cause polarssl didn&#039;t support certain https sites. You need to switch the underlying libustream-library for this to work (check latest documentation on how to do that). For normal use cases &#039;wget&#039; is still the best selection.</p><p>Again, sorry for the troubles!<br />dirk</p><p>P.S. The mentioned debug output is only visible via logread -e &quot;adblock&quot;, not in LuCI.</p></blockquote></div><p>No worries, you never need to apologize, Dirk.&nbsp; Thank you for the extra details.&nbsp; Also, I wanted to mention that your documentation is always top-notch, very much appreciated.</p><p>Sometimes the best way for me to learn is to make mistakes and learn the hard way, so I always try to turn everything into a learning moment.&nbsp; I have now flashed with the latest trunk of LEDE from today along with adblock 1.3.1 and the latest relevant packages.&nbsp; I will continue to use wget for now because it requires a bit less understanding for me and as long as you continue to support wget as well.</p><p>Anyway, everything is working flawlessly as per usual.&nbsp; Keep up the great work!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p330623">
				<div class="post-metadata">
					<div class="post-num">Post #265</div>
					<div class="post-author">dape</div>
					<div class="post-datetime">
						6 Jul 2016, 12:15					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>dibdot wrote:</cite><blockquote><p> The default uclient-fetch installation (with libustream-polarssl) is not supported, cause polarssl didn&#039;t support certain https sites. You need to switch the underlying libustream-library for this to work (check latest documentation on how to do that). For normal use cases &#039;wget&#039; is still the best selection.</p></blockquote></div><p>For whom was successfully in switching &quot;the underlying libustream-library&quot; - how is that better in space saving compared to the regular wget (+libpcre) installation? Thanks!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p330660">
				<div class="post-metadata">
					<div class="post-num">Post #266</div>
					<div class="post-author">stangri</div>
					<div class="post-datetime">
						6 Jul 2016, 20:32					</div>
				</div>
				<div class="post-content content">
					<p>libopenssl (which is required by wget to handle https links) is approx 740Kb, libmbedtls and its libustream (one of the options for ufetch-client) are only 166Kb combined.</p><p>Replying to the post below -- it&#039;s still &#039;cheaper&#039; to use libpolarssl for VPN in addition to libmbedtls.</p>											<p class="post-edited">(Last edited by <strong>stangri</strong> on 7 Jul 2016, 03:31)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p330687">
				<div class="post-metadata">
					<div class="post-num">Post #267</div>
					<div class="post-author">slh</div>
					<div class="post-datetime">
						7 Jul 2016, 01:18					</div>
				</div>
				<div class="post-content content">
					<p>Likewise libopenssl may come &#039;for free&#039;, if you already need it for other purposes (such as VPN).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p330752">
				<div class="post-metadata">
					<div class="post-num">Post #268</div>
					<div class="post-author">dape</div>
					<div class="post-datetime">
						7 Jul 2016, 18:09					</div>
				</div>
				<div class="post-content content">
					<p>If i already need libopenssl on a 8 MB flash firmware then how do i switch from libpolarssl to only libopenssl to save space? Thanks!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p330758">
				<div class="post-metadata">
					<div class="post-num">Post #269</div>
					<div class="post-author">stangri</div>
					<div class="post-datetime">
						7 Jul 2016, 19:29					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>dape wrote:</cite><blockquote><p>If i already need libopenssl on a 8 MB flash firmware then how do i switch from libpolarssl to only libopenssl to save space? Thanks!</p></blockquote></div><p>You need to elaborate on your current setup/requirements and may be better off starting a separate thread on that.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p331067">
				<div class="post-metadata">
					<div class="post-num">Post #270</div>
					<div class="post-author">Irken Skoodge</div>
					<div class="post-datetime">
						10 Jul 2016, 19:47					</div>
				</div>
				<div class="post-content content">
					<p>Thanks dibdot for this ad blocking solution. I have been using this for the past couple of weeks and its the best router ad blocking solution. Thanks so much</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p331619">
				<div class="post-metadata">
					<div class="post-num">Post #271</div>
					<div class="post-author">marcin1j</div>
					<div class="post-datetime">
						15 Jul 2016, 01:46					</div>
				</div>
				<div class="post-content content">
					<p>Hi dibdot</p><p>First of all, thank you for writing this package. The recent releases solved many issues (eg. mwan3 compatibility and the need to use wget with heavy openssl libraries) and now it seems like an almost perfect solution.<br />I have a couple of ideas for better procd/hotplug integration. I can contribute by writing some patches, but before doing that, I&#039;d like to discuss it.</p><p>The most urgent issue is running adblock-update from init.d script. It&#039;s not as great as it may look at first glance. Since network connections are managed asynchronously in background, fetching files during boot is unreliable. In my case, network comes up when update script is already executing, so I end up with partially successful fetch. Also, pid file lock prevents running update via hotplug, when WAN interface actually comes up. Moreover, update script delays system boot sequence.<br />What I suggest is to separate setup logic (creating uhttpd instance and adding iptables rules, which belong to init.d)&nbsp; from actual update script (which should be triggered by hotplug events). Ideally, init.d script would clean up dynamic uhttpd instance and iptables rules on stop (but it&#039;s not that important). There might be a point in restoring backup on boot sequence but it&#039;s a bit iffy because boot scripts should be fast and lightweight.</p><p>There&#039;s a minor issue in hotplug triggered update. It should be possible to disable it via config option. Moreover, I&#039;d add an option to override auto-detected wan interface by providing a config-defined list of interfaces (remember mwan3 setup).</p><p>kr</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p331655">
				<div class="post-metadata">
					<div class="post-num">Post #272</div>
					<div class="post-author">dibdot</div>
					<div class="post-datetime">
						15 Jul 2016, 09:31					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>marcin1j wrote:</cite><blockquote><p>Hi dibdot</p><p>First of all, thank you for writing this package. The recent releases solved many issues (eg. mwan3 compatibility and the need to use wget with heavy openssl libraries) and now it seems like an almost perfect solution.<br />I have a couple of ideas for better procd/hotplug integration.</p></blockquote></div><p>Hi, thanks for your feedback. </p><p>PROCD support is already on my todo list, but at this stage it&#039;s poorly documented and I see no benefit for scripts like adblock which didn&#039;t daemonize.</p><p>The adblock update process is <strong>only</strong> triggered by hotplug event (whenever a WAN interface comes up), not by init.d (empty boot function in adblock.init). It&#039;s definitely needless to put an additional &quot;/etc/init.d/adblock start&quot; in rc.local or any other startup script.</p><p>The pid file check/lock only avoids multiple/concurrent starts of the same script - nothing more.</p><p>A split of &#039;setup&#039; and &#039;update&#039; logic makes no sense, cause all system changes made by adblock are volatile and need to be checked during runtime. </p><div class="quotebox"><cite>marcin1j wrote:</cite><blockquote><p>Ideally, init.d script would clean up dynamic uhttpd instance and iptables rules on stop (but it&#039;s not that important). There might be a point in restoring backup on boot sequence but it&#039;s a bit iffy because boot scripts should be fast and lightweight.</p></blockquote></div><p>That&#039;s already implemented.</p><div class="quotebox"><cite>marcin1j wrote:</cite><blockquote><p> Moreover, I&#039;d add an option to override auto-detected wan interface by providing a config-defined list of interfaces</p></blockquote></div><p>Interesting point, I&#039;ll put it on my todo list.<br />I&#039;ve released 1.4.0 yesterday and it should quite stable now ... more to come after my holidays - have a good time!</p>											<p class="post-edited">(Last edited by <strong>dibdot</strong> on 15 Jul 2016, 09:40)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p331735">
				<div class="post-metadata">
					<div class="post-num">Post #273</div>
					<div class="post-author">marcin1j</div>
					<div class="post-datetime">
						15 Jul 2016, 18:03					</div>
				</div>
				<div class="post-content content">
					<p>Dilbot</p><p>I&#039;m afraid you misunderstood me.</p><p>I didn&#039;t mention there&#039;s a need to run init.d script from rc.local. Obviously init script is started automatically.</p><p>The problem is that init script runs adblock-update during boot sequence (which involves running init.d scripts with start parameter). Update script tries to fetch blacklists from network (not only restore from backup, as you suggested) regardless of wan interface status and that&#039;s unreliable because network interfaces are started asynchronously.</p><p>Due to pid file lock, update script is not started by a hotplug event when wan interface actually comes up because there&#039;s another instance already running (started from init.d). This doesn&#039;t mean that local file is a bad thing. The point is that running update from init.d leads to a race condition.</p><p>So to recap:<br /></p><ol class="decimal"><li><p>Fetching blacklists from init.d scripts is unreliable, leads to a race condition and should be avoided,</p></li><li><p>Update script should be triggered by a hotplug event only. There should be an option to override automatic wan interface detection and to disable this trigger altogether,</p></li><li><p>You are right that all changes made by adblock are volatile. However, uhttpd and iptables setup is executed only once. Therefore it doesn&#039;t belong to update/helper script and it makes sense to separate it. You benefit from a cleaner code and moving ubus stuff away. And there&#039;s no harm in starting volatile uhttpd instance before dnsmasq rules are generated,</p></li><li><p>Likewise, the wan interface detection logic makes sense only in hotplug script,</p></li><li><p>You&#039;re wrong thinking that procd has no benefit <em>for scripts like adblock which didn&#039;t daemonize.</em> Look at the wiki page <a href="https://wiki.openwrt.org/inbox/procd-init-scripts#procd_triggers_on_config_filenetwork_interface_changes">https://wiki.openwrt.org/inbox/procd-in … ce_changes</a>. That&#039;s another reason to move ubus-related code to init.d script.</p></li></ol><p>I didn&#039;t mean to criticize anything because this is a really awesome solution and can be made even better (hence my first post). Still, there&#039;s at least one issue which can&#039;t be ignored and needs addressing.<br />I agree that procd is poorly documented and that&#039;s one of the reasons I offered my help.</p><p>kr</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p331745">
				<div class="post-metadata">
					<div class="post-num">Post #274</div>
					<div class="post-author">dibdot</div>
					<div class="post-datetime">
						15 Jul 2016, 20:26					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>marcin1j wrote:</cite><blockquote><p>Due to pid file lock, update script is not started by a hotplug event when wan interface actually comes up because there&#039;s another instance already running (started from init.d). This doesn&#039;t mean that local file is a bad thing. The point is that running update from init.d leads to a race condition.</p></blockquote></div><p>Again, please check the real package sources <a href="https://github.com/openwrt/packages/blob/master/net/adblock/files">here</a> ...<br />The init script (adblock.init) makes nothing on boot:<br /></p><div class="codebox"><pre><code>[...]
boot()
{
    return 0
}
[...]</code></pre></div><p>Maybe you&#039;ve installed another script or a mixture of different scripts ...the adblock package described here is only triggered by hotplug!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p333195">
				<div class="post-metadata">
					<div class="post-num">Post #275</div>
					<div class="post-author">shm0</div>
					<div class="post-datetime">
						4 Aug 2016, 01:40					</div>
				</div>
				<div class="post-content content">
					<p>Hi<br />My custom blacklist seems broken:</p><p>Here my list:<br /></p><div class="codebox"><pre><code>choice.microsoft.com
choice.microsoft.com.nsatc.net
df.telemetry.microsoft.com
diagnostics.support.microsoft.com
feedback.microsoft-hohm.com
feedback.search.microsoft.com
feedback.windows.com
oca.telemetry.microsoft.com
oca.telemetry.microsoft.com.nsatc.net
onesettings-bn2.metron.live.com.nsatc.net
onesettings-cy2.metron.live.com.nsatc.net
onesettings-db5.metron.live.com.nsatc.net
onesettings-hk2.metron.live.com.nsatc.net
reports.wes.df.telemetry.microsoft.com
services.wes.df.telemetry.microsoft.com
settings-sandbox.data.microsoft.com
settings-win.data.microsoft.com
settings.data.glbdns2.microsoft.com
sqm.df.telemetry.microsoft.com
sqm.telemetry.microsoft.com
sqm.telemetry.microsoft.com.nsatc.net
statsfe1.ws.microsoft.com
statsfe2.update.microsoft.com.akadns.net
statsfe2.ws.microsoft.com
survey.watson.microsoft.com
telecommand.telemetry.microsoft.com
telecommand.telemetry.microsoft.com.nsatc.net
telemetry.appex.bing.net
telemetry.microsoft.com
telemetry.urs.microsoft.com
v10.vortex-win.data.metron.live.com.nsatc.net
v10.vortex-win.data.microsoft.com
vortex-bn2.metron.live.com.nsatc.net
vortex-cy2.metron.live.com.nsatc.net
vortex-db5.metron.live.com.nsatc.net
vortex-hk2.metron.live.com.nsatc.net
vortex-sandbox.data.microsoft.com
vortex-win.data.metron.live.com.nsatc.net
vortex-win.data.microsoft.com
vortex.data.glbdns2.microsoft.com
vortex.data.metron.live.com.nsatc.net
vortex.data.microsoft.com
watson.live.com
watson.microsoft.com
watson.ppe.telemetry.microsoft.com
watson.telemetry.microsoft.com
watson.telemetry.microsoft.com.nsatc.net
wes.df.telemetry.microsoft.comnet
telemetry.battle.net</code></pre></div><p>This is the generated output:<br /></p><div class="codebox"><pre><code>address=/Binary file /tmp/tmp.pKocpG matches/198.18.0.1
address=/choice.microsoft.com.nsatc.net/198.18.0.1
address=/choice.microsoft.com/198.18.0.1
address=/df.telemetry.microsoft.com/198.18.0.1
address=/diagnostics.support.microsoft.com/198.18.0.1
address=/feedback.microsoft-hohm.com/198.18.0.1
address=/feedback.search.microsoft.com/198.18.0.1
address=/feedback.windows.com/198.18.0.1
address=/oca.telemetry.microsoft.com.nsatc.net/198.18.0.1
address=/oca.telemetry.microsoft.com/198.18.0.1
address=/onesettings-bn2.metron.live.com.nsatc.net/198.18.0.1
address=/onesettings-cy2.metron.live.com.nsatc.net/198.18.0.1
address=/onesettings-db5.metron.live.com.nsatc.net/198.18.0.1
address=/onesettings-hk2.metron.live.com.nsatc.net/198.18.0.1
address=/reports.wes.df.telemetry.microsoft.com/198.18.0.1
address=/services.wes.df.telemetry.microsoft.com/198.18.0.1
address=/settings-sandbox.data.microsoft.com/198.18.0.1
address=/settings-win.data.microsoft.com/198.18.0.1
address=/settings.data.glbdns2.microsoft.com/198.18.0.1
address=/sqm.df.telemetry.microsoft.com/198.18.0.1
address=/sqm.telemetry.microsoft.com.nsatc.net/198.18.0.1
address=/sqm.telemetry.microsoft.com/198.18.0.1
address=/statsfe1.ws.microsoft.com/198.18.0.1
address=/statsfe2.update.microsoft.com.akadns.net/198.18.0.1
address=/statsfe2.ws.microsoft.com/198.18.0.1
address=/survey.watson.microsoft.com/198.18.0.1
address=/telecommand.telemetry.microsoft.com/198.18.0.1</code></pre></div><p>thank you.</p><p>//Edit<br />Sorry. There was some weird encoding in my source list.</p>											<p class="post-edited">(Last edited by <strong>shm0</strong> on 4 Aug 2016, 02:08)</p>
									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 11 of 17</div><nav><ul><li><a href="viewtopic.php%3Fid=59803&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=59803&amp;p=9.html">9</a></li><li><a href="viewtopic.php%3Fid=59803&amp;p=10.html">10</a></li><li class="pagination-current"><span>11</span></li><li><a href="viewtopic.php%3Fid=59803&amp;p=12.html">12</a></li><li><a href="viewtopic.php%3Fid=59803&amp;p=13.html">13</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=59803&amp;p=17.html">17</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0.001 -->

</body>
</html>