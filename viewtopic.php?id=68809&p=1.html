<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> TP-Link TL-WR841N(D) Extended Build [all versions] LEDE Reboot</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 29 Mar 2018 and 15 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 2</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=68809&amp;p=2.html">2</a></li></ul></nav></div>
			
		
		
			<article class="post" id="p345702">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">amq</div>
					<div class="post-datetime">
						4 Dec 2016, 18:28					</div>
				</div>
				<div class="post-content content">
					<p><span class="postimg"><img src="http://i.imgur.com/3xdOmT1.png" alt="http://i.imgur.com/3xdOmT1.png" /></span></p><p>Sharing a custom build I&#039;ve created for my own use:<br /></p><ul><li><p>LEDE Reboot</p></li><li><p>LuCI with https</p></li><li><p>IPv6 and PPPoE</p></li><li><p>MiniUPnP</p></li><li><p>OpenVPN with mbed TLS</p></li><li><p>QoS</p></li><li><p>DDNS</p></li><li><p>Wget with https</p></li><li><p>Reghack (WiFi channels 12 and 13)</p></li><li><p>Minified LuCI&#039;s CSS and JS</p></li><li><p>Compiled with GCC 6.3</p></li><li><p>Removed kernel debugging</p></li><li><p>Nothing else has been touched. Basically, it is a &#039;make defconfig&#039; + profile + the mentioned above</p></li><li><p>Free ROM: 76 KB</p></li><li><p>OpenVPN AES-128-CBC speed: 12Mbs/12Mbs (measured on v8 downloading ubuntu via a torrent)</p></li></ul><p><strong>Download firmware:</strong><br /><a href="https://www.dropbox.com/sh/w91lnen1g9ikuf3/AACyMjOACC0-WVFzi1Lb1O0da?dl=0">dropbox</a></p><p><strong>Build script:</strong><br /><a href="https://gist.github.com/amq/f3895b208850ab07c5e2e855fa5fcab9">github</a></p><p><strong>Supported devices:</strong><br />tl-wr841n-v1.5<br />tl-wr841n-v3<br />tl-wr841n-v5<br />tl-wr841n-v7<br />tl-wr841n-v8<br />tl-wr841n-v9<br />tl-wr841n-v10<br />tl-wr841n-v11</p><p><strong>Changelog:</strong></p><p><span class="bbu">2017-02-25</span><br />- r3218-bf53a83 (17.01 branch)<br />- Added https for LuCI</p><p><span class="bbu">2017-01-31</span><br />- r3198-74ea99b<br />- Added DDNS<br />- Added libustream-mbedtls (https support for wget)</p><p><span class="bbu">2016-12-25</span><br />- r2672-9998bc5<br />- Added QoS<br />- Upgraded mbed TLS from 1.x to 2.x<br />- Compiled with GCC 6.3 instead of 5.4<br />- Increased squashfs4 block size from 256 to 1024<br />- Disabled debugfs<br />- Enabled sstrip to further reduce the size</p><p><span class="bbu">2016-12-04</span><br />- r2400-abedd71<br />- Initial release</p><p><strong>How to achieve the same build with the &#039;menu makeconfig&#039; interface</strong></p><div class="codebox"><pre><code>1. rm .config .config.old
2. make defconfig
3. make menuconfig
(use space to select, make sure you see a star after a selection, not an M; use esc to go back)

_Target Profile - TP-LINK TL-WR841N/ND

Enable:
_LuCI - Collections - luci
_LuCI - Applications - luci-app-upnp
_LuCI - Applications - luci-app-openvpn
_LuCI - Applications - luci-app-qos
_Network - VPN - openvpn-mbedtls
_Advanced configuration options (for developers) - Toolchain options - GCC compiler Version - gcc 6.x
_Global build settings - Strip unnecessary exports from the kernel image, Strip unnecessary functions from libraries

Disable:
_Global build settings - Enable support for printk, Crash logging, Support for paging of anonymous memory (swap), Compile the kernel with debug filesystem enabled, Compile the kernel with symbol tables information, Compile the kernel with debug information, Compile the kernel with SysRq support, Enable printk timestamps
_Kernel modules - Wireless Drivers - kmod-ath9k - Support for Ubiquiti Unify Outdoor+
_Kernel modules - Wireless Drivers - kmod-mac80211 - Export mac80211 internals in DebugFS
_Kernel modules - Wireless Drivers - kmod-ath - Force Atheros drivers to respect the user&#039;s regdomain settings</code></pre></div><p><strong>OpenVPN setup guides:</strong><br /><a href="https://blog.ipredator.se/howto/openwrt/configuring-openvpn-on-openwrt.html">https://blog.ipredator.se/howto/openwrt … enwrt.html</a><br /><a href="https://www.robertkehoe.com/2015/08/setup-openvpn-using-openwrt/">https://www.robertkehoe.com/2015/08/set … g-openwrt/</a></p>											<p class="post-edited">(Last edited by <strong>amq</strong> on 25 Feb 2017, 03:21)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p345715">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">marco_silva85</div>
					<div class="post-datetime">
						4 Dec 2016, 19:34					</div>
				</div>
				<div class="post-content content">
					<p>Stable? Which are the main differences from the OpenWRT build?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p345716">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">amq</div>
					<div class="post-datetime">
						4 Dec 2016, 20:00					</div>
				</div>
				<div class="post-content content">
					<p>marco_silva85, the only functional difference compared to my latest OpenWRT build is the removed DNSCrypt package (not enough space).</p><p>Everything else is the same, you can even upgrade while keeping your settings.</p><p>So far it is completely stable for me.</p>											<p class="post-edited">(Last edited by <strong>amq</strong> on 4 Dec 2016, 20:02)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p345735">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">stangri</div>
					<div class="post-datetime">
						4 Dec 2016, 23:57					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>amq wrote:</cite><blockquote><p>Sharing a custom build I&#039;ve created for my own use:<br /></p><ul><li><p>OpenVPN with mbed TLS</p></li></ul></blockquote></div><p>How did you achieve this? I&#039;ve been interested in OpenVPN-mbedtls for a while.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p345789">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">amq</div>
					<div class="post-datetime">
						5 Dec 2016, 17:18					</div>
				</div>
				<div class="post-content content">
					<p>OpenVPN with mbed TLS = openvpn-polarssl</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p345820">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">stangri</div>
					<div class="post-datetime">
						5 Dec 2016, 23:12					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>amq wrote:</cite><blockquote><p>OpenVPN with mbed TLS = openvpn-polarssl</p></blockquote></div><p>Uhm, no. There&#039;s a difference between mbedtls and polarssl.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p345829">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">slh</div>
					<div class="post-datetime">
						5 Dec 2016, 23:58					</div>
				</div>
				<div class="post-content content">
					<p>mbedtls is the successor (== a newer (major-) version) of polarssl, as such polarssl needs to be phased out naturally, due to API changes, this will take a while until completion.</p>											<p class="post-edited">(Last edited by <strong>slh</strong> on 5 Dec 2016, 23:59)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p345846">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">stangri</div>
					<div class="post-datetime">
						6 Dec 2016, 03:59					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>slh wrote:</cite><blockquote><p>mbedtls is the successor (== a newer (major-) version) of polarssl</p></blockquote></div><p>I&#039;m perfectly aware of that. That&#039;s why I said mbedtls != polarssl. You should correct your original post.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p345875">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">amq</div>
					<div class="post-datetime">
						6 Dec 2016, 12:35					</div>
				</div>
				<div class="post-content content">
					<div class="codebox"><pre><code>PKG_NAME:=polarssl
SRC_PKG_NAME:=mbedtls
PKG_VERSION:=1.3.18</code></pre></div><p><a href="https://github.com/lede-project/source/blob/master/package/libs/polarssl/Makefile">https://github.com/lede-project/source/ … l/Makefile</a></p><p>So it *is* mbed TLS, just a previous branch (1.x vs the latest 2.x). There is no such thing as PolarSSL anymore.</p><p>OpenVPN seems to support 2.x already, so a package in OpenWRT / LEDE is probably not far away.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p346076">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">julianocs</div>
					<div class="post-datetime">
						8 Dec 2016, 12:29					</div>
				</div>
				<div class="post-content content">
					<p>Thanks a lot, amq.</p><p>Installed yesterday on all my routers and everything is working.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p346089">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">julianocs</div>
					<div class="post-datetime">
						8 Dec 2016, 16:21					</div>
				</div>
				<div class="post-content content">
					<p>Hi amq.</p><p>It´s possible include SQM on your release? <br />Or there isn´t enough space on the router?</p><p>Thanks.</p>											<p class="post-edited">(Last edited by <strong>julianocs</strong> on 8 Dec 2016, 16:22)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p346261">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">amq</div>
					<div class="post-datetime">
						10 Dec 2016, 17:52					</div>
				</div>
				<div class="post-content content">
					<p>julianocs, there is not enough space for sqm or qos.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p346385">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">julianocs</div>
					<div class="post-datetime">
						11 Dec 2016, 22:03					</div>
				</div>
				<div class="post-content content">
					<p>Hum, ok amq...</p><p>Another question: Do you know if i uninstall VPN, there will be enough space to install SQM or QoS?<br />Or it will be necessary to recompile a new &quot;clean&quot; build?</p><p>Thanks.<br />Juliano</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p346449">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">amq</div>
					<div class="post-datetime">
						12 Dec 2016, 13:34					</div>
				</div>
				<div class="post-content content">
					<p>You need to recompile the image to remove packages.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p347220">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">deuteragenie</div>
					<div class="post-datetime">
						20 Dec 2016, 17:21					</div>
				</div>
				<div class="post-content content">
					<p>Very nice!</p><p>Maybe you could have a look at the GCC initify plugin.<br />Also, GCC - Os might be helpful, as well as switching to GCC 6.x</p><p>I am not sure what parameters are used for squashfs.<br />lzma2 with block size of 1024 kb appear to be giving the best compression ratio.<br />Edit: I checked the LEDE source code and it recently switched to lzma2 - the patch seems to be trivial to apply.</p><p>Would love to see QoS back <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>											<p class="post-edited">(Last edited by <strong>deuteragenie</strong> on 22 Dec 2016, 13:27)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p347523">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">KREAT0R</div>
					<div class="post-datetime">
						23 Dec 2016, 20:29					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>deuteragenie wrote:</cite><blockquote><p>Would love to see QoS back <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p></blockquote></div><p>+1</p><p>vpn is useless for me.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p347669">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">amq</div>
					<div class="post-datetime">
						25 Dec 2016, 18:27					</div>
				</div>
				<div class="post-content content">
					<p>New build is up, includes QoS <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p347700">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">julianocs</div>
					<div class="post-datetime">
						26 Dec 2016, 08:21					</div>
				</div>
				<div class="post-content content">
					<p>Thanks a lot amq !</p><p>Installed now and everything is working 100% !<br />Can you tell me if it is possible to include or install luci ddns client in your build?</p><p>Regards.</p>											<p class="post-edited">(Last edited by <strong>julianocs</strong> on 26 Dec 2016, 08:21)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p347739">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">julianocs</div>
					<div class="post-datetime">
						26 Dec 2016, 19:14					</div>
				</div>
				<div class="post-content content">
					<p>Hi. </p><p>Tried to install now using luci, not enough space. <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><p>Amq, I&#039;m being much boring if i request to you include ddns in your next build? <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> Or help-me how to install?&nbsp; </p><p>Regards.</p>											<p class="post-edited">(Last edited by <strong>julianocs</strong> on 26 Dec 2016, 22:54)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p351150">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">evgeneys</div>
					<div class="post-datetime">
						5 Feb 2017, 17:07					</div>
				</div>
				<div class="post-content content">
					<p>Hi guys. You will see the firmware version of the 841 to change the memory up to 8 mb? Preferably with USB support? Maybe someone will make it? Thanks.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p352913">
				<div class="post-metadata">
					<div class="post-num">Post #21</div>
					<div class="post-author">amq</div>
					<div class="post-datetime">
						25 Feb 2017, 03:21					</div>
				</div>
				<div class="post-content content">
					<p>New build is up. 17.01 stable branch + https for LuCI</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p352936">
				<div class="post-metadata">
					<div class="post-num">Post #22</div>
					<div class="post-author">evgeneys</div>
					<div class="post-datetime">
						25 Feb 2017, 14:48					</div>
				</div>
				<div class="post-content content">
					<p>OPKG dont work? In the original version LEDE, at tl-841 v5, opkg do not install the packages.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p352983">
				<div class="post-metadata">
					<div class="post-num">Post #23</div>
					<div class="post-author">KREAT0R</div>
					<div class="post-datetime">
						26 Feb 2017, 14:02					</div>
				</div>
				<div class="post-content content">
					<p>My 841nd v5 bricked with 2017-02-25 (sysupgrade) from 2017-01-31 (without &quot;Keep settings&quot;)</p><p>=(</p><p>EDIT: unbricked via Serial console with RS232 TTL</p><p>i.imgur.com/Qpg70LP.png</p><p>EDIT2: im use 2017-02-25 factory.bin (from TPLINK firmware) and all ok.</p>											<p class="post-edited">(Last edited by <strong>KREAT0R</strong> on 27 Feb 2017, 23:56)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p354525">
				<div class="post-metadata">
					<div class="post-num">Post #24</div>
					<div class="post-author">isaak.78</div>
					<div class="post-datetime">
						19 Mar 2017, 02:52					</div>
				</div>
				<div class="post-content content">
					<p>841nd v9 bricked on sysupgrade with &quot;Keep settings&quot;<br />unbricked via firmware transfer in TFTP</p><p>upgrade r3218 squashfs-factory and all ok.</p><p>Thanks</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p361797">
				<div class="post-metadata">
					<div class="post-num">Post #25</div>
					<div class="post-author">jpricacho27</div>
					<div class="post-datetime">
						11 Jul 2017, 15:33					</div>
				</div>
				<div class="post-content content">
					<p>May I know how did you manage to add ht tp-proxy-option EXT1 in OpenVPN config? Other OpenVPN packages i&#039;ve used does not support that option I am getting a Bad ht tp-proxy-option or missing parameter error. Thank you</p>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 1 of 2</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=68809&amp;p=2.html">2</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>