<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> MR3020-14.07-no 3g (missing ttyUSBx)</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 22 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p252897">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">sohoto</div>
					<div class="post-datetime">
						2 Nov 2014, 23:11					</div>
				</div>
				<div class="post-content content">
					<p>hi,<br />with the attitude 12.09 and some extra packages my 3g stick works.<br />with the 14.07 however, i have no luck (yet)<br />i do not seem to get any dev/ttyUSBx device which i believe is the reason it does not work<br />any suggestion is appreciated. <br />i spent hours yet trying to get that device working....</p><p>(updated 3nov)</p><br /><p>the firmware i use is barrier_breaker14.07-ar71xx-generic<br />the usb stick is some e1552/e1800 huawei clone<br />this is confirmed by the usbutils package but because they take alot of space so i had to remove them</p><p>root@OpenWrt:~# dmesg |grep usb&nbsp; (after reboot)</p><p>[&nbsp; &nbsp; 4.080000] usbcore: registered new interface driver usbfs<br />[&nbsp; &nbsp; 4.090000] usbcore: registered new interface driver hub<br />[&nbsp; &nbsp; 4.090000] usbcore: registered new device driver usb<br />[&nbsp; &nbsp;10.990000] usbcore: registered new interface driver cdc_acm<br />[&nbsp; &nbsp;11.090000] usbcore: registered new interface driver usbserial<br />[&nbsp; &nbsp;11.110000] usbcore: registered new interface driver usbserial_generic<br />[&nbsp; &nbsp;11.110000] usbserial: USB Serial support registered for generic<br />[&nbsp; &nbsp;11.480000] usbcore: registered new interface driver option<br />[&nbsp; &nbsp;11.500000] usbserial: USB Serial support registered for GSM modem (1-port)<br />[&nbsp; &nbsp;66.490000] usb 1-1: new full-speed USB device number 2 using ehci-platform</p><br /><br /><p>some more info:<br />root@OpenWrt:~# opkg list-installed | grep usb<br />kmod-ledtrig-usbdev - 3.10.49-1<br />kmod-usb-acm - 3.10.49-1<br />kmod-usb-core - 3.10.49-1<br />kmod-usb-ohci - 3.10.49-1<br />kmod-usb-serial - 3.10.49-1<br />kmod-usb-serial-option - 3.10.49-1<br />kmod-usb-serial-wwan - 3.10.49-1<br />kmod-usb2 - 3.10.49-1<br />libusb-1.0 - 1.0.9-1<br />libusb-compat - 0.1.4-1</p><br /><p>root@OpenWrt:~# ls /sys/bus/usb-serial/drivers/generic<br />bind&nbsp; &nbsp; module&nbsp; new_id&nbsp; uevent&nbsp; unbind</p><p>root@OpenWrt:~# ls /proc/bus<br />pci</p><p>root@OpenWrt:~# ls /etc/modules.d<br />09-crypto-arc4&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 50-usb-ohci&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ppp<br />20-ipv6&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ath9k&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;pppoe<br />20-usb-core&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ipt-conntrack&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;usb-acm<br />30-gpio-button-hotplug&nbsp; ipt-core&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; usb-serial<br />40-usb2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ipt-nat&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;usb-serial-option<br />42-ip6tables&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ipt-nathelper&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;usb-serial-wwan<br />50-ledtrig-usbdev&nbsp; &nbsp; &nbsp; &nbsp;lib-crc-ccitt</p><p>root@OpenWrt:/dev# cat /sys/kernel/debug/usb/devices</p><p>T:&nbsp; Bus=01 Lev=00 Prnt=00 Port=00 Cnt=00 Dev#=&nbsp; 1 Spd=480&nbsp; MxCh= 1<br />B:&nbsp; Alloc=&nbsp; 0/800 us ( 0%), #Int=&nbsp; 0, #Iso=&nbsp; 0<br />D:&nbsp; Ver= 2.00 Cls=09(hub&nbsp; ) Sub=00 Prot=01 MxPS=64 #Cfgs=&nbsp; 1<br />P:&nbsp; Vendor=1d6b ProdID=0002 Rev= 3.10<br />S:&nbsp; Manufacturer=Linux 3.10.49 ehci_hcd<br />S:&nbsp; Product=EHCI Host Controller<br />S:&nbsp; SerialNumber=ehci-platform<br />C:* #Ifs= 1 Cfg#= 1 Atr=e0 MxPwr=&nbsp; 0mA<br />I:* If#= 0 Alt= 0 #EPs= 1 Cls=09(hub&nbsp; ) Sub=00 Prot=00 Driver=hub<br />E:&nbsp; Ad=81(I) Atr=03(Int.) MxPS=&nbsp; &nbsp;4 Ivl=256ms</p><p>T:&nbsp; Bus=01 Lev=01 Prnt=01 Port=00 Cnt=01 Dev#=&nbsp; 4 Spd=12&nbsp; &nbsp;MxCh= 0<br />D:&nbsp; Ver= 1.10 Cls=00(&gt;ifc ) Sub=00 Prot=00 MxPS=64 #Cfgs=&nbsp; 1<br />P:&nbsp; Vendor=12d1 ProdID=1446 Rev= 0.00<br />S:&nbsp; Manufacturer=Qualcomm, Incorporated<br />S:&nbsp; Product=USB MMC Storage<br />S:&nbsp; SerialNumber=ÿÿÿÿÿÿÿÿÿÿÿÿ<br />C:* #Ifs= 1 Cfg#= 1 Atr=a0 MxPwr=500mA<br />I:* If#= 0 Alt= 0 #EPs= 2 Cls=08(stor.) Sub=06 Prot=50 Driver=(<span class="bbu">none</span>)<br />E:&nbsp; Ad=85(I) Atr=02(Bulk) MxPS=&nbsp; 64 Ivl=0ms<br />E:&nbsp; Ad=05(O) Atr=02(Bulk) MxPS=&nbsp; 64 Ivl=0ms</p><br /><p>root@OpenWrt:/sys/bus/usb-serial/drivers# ls<br />generic&nbsp; option1</p>											<p class="post-edited">(Last edited by <strong>sohoto</strong> on 3 Nov 2014, 19:48)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p253014">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">sohoto</div>
					<div class="post-datetime">
						3 Nov 2014, 23:50					</div>
				</div>
				<div class="post-content content">
					<p>ok seems the modedswitch was needed after all<br />currently only needed extra packages:<br />luci-proto-3g&nbsp; usb-modeswitch&nbsp; kmod-usb-serial kmod-usb-serial-wwan kmod-usb-serial-option<br />still having issues as i seem the switch not always does a switch automatically...&nbsp; also <br />still discs with &quot;No response to 5 echo-requests&quot; but i&#039;ll sort that out and update this if i can</p><p>update 5-11:<br />been reinstalling and testing and going on with r42625 and i strangely no longer have &quot;no response to&quot; issues...<br />however i got another issue coming up.<br />after a certain time (can be 1h....5 minutes,...) my wan connection drops with a strange message. <br />after that i have to reboot to get it back up.</p><p>the message does not make sense....<br />it does not seem to be a power ussue since i&#039;m using the regular power usb cable and although<br />wifi is active its at low power output while nothing else is connected on that interface<br />(even without wifi i get this issue)<br />will look further...</p><br /><p>with debug 4 logging:<br />...<br />procd: watchdog_timeout_cb(37): Ping<br />procd: watchdog_timeout_cb(37): Ping<br />[&nbsp; 274.330000] usb 1-1: USB disconnect, device number 2<br />[&nbsp; 274.330000] option1 ttyUSB0: option_instat_callback: error -143<br />[&nbsp; 274.340000] option1 ttyUSB0: usb_wwan_indat_callback: resubmit read urb failed. (-19)</p>											<p class="post-edited">(Last edited by <strong>sohoto</strong> on 5 Nov 2014, 21:27)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p253261">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">sohoto</div>
					<div class="post-datetime">
						6 Nov 2014, 00:12					</div>
				</div>
				<div class="post-content content">
					<p>ok... i restored the original TP firmware just to be sure.<br />seems i also have those usb disconnects here.<br />now it is either the usb stick worth jack sh1t or the 3020.<br />the default power adaptor is 5V/1A which should be ok.<br />this is really pissing me off...</p>											<p class="post-edited">(Last edited by <strong>sohoto</strong> on 6 Nov 2014, 00:26)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p253373">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">123serge123</div>
					<div class="post-datetime">
						6 Nov 2014, 14:03					</div>
				</div>
				<div class="post-content content">
					<p>Install usbmodeswitch-data package. It contain real command for modem swtching</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p253390">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">sohoto</div>
					<div class="post-datetime">
						6 Nov 2014, 16:36					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>123serge123 wrote:</cite><blockquote><p>Install usbmodeswitch-data package. It contain real command for modem swtching</p></blockquote></div><p>with 12.09 yes but this is already included by default in v14</p><p>&quot;&quot;as of r36812, usb-modeswitch package had been under major overhaul from ordinary draisberghof usb_modeswitch found in many linux distributions. usb-modeswitch-data is included in the package, with the new json format. &quot;&quot;</p><p>my current issue seems to be an usb issue (usb stick disconnects) , <br />i will test with a powered hub if i can get one soon to rule that out or run it a computer USB port directly</p><p>update: <br />tried with a powered hub...works even less....<br />45 1st day 00:20:17 3G/4G INFO sw3GMobileCmdReq 449 mobileFormatCmd error<br />44 1st day 00:20:15 3G/4G NOTICE Reset the 3G modem, please wait.<br />43 1st day 00:19:49 3G/4G INFO Run 3G dial cmd: pppd 3g 1 /dev/ttyUSB0 115200 connect &quot;chat -s -v -f /etc/ppp/c<br />42 1st day 00:19:49 3G/4G NOTICE 3G/4G start connecting...<br />41 1st day 00:19:36 3G/4G INFO sw3GMobileCmdReq 449 mobileFormatCmd error<br />40 1st day 00:19:36 3G/4G WARNING 3G Modem connecting error, please check the dial number and APN.<br />39 1st day 00:19:09 3G/4G INFO Run 3G dial cmd: pppd 3g 1 /dev/ttyUSB0 115200 connect</p>											<p class="post-edited">(Last edited by <strong>sohoto</strong> on 6 Nov 2014, 22:48)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>