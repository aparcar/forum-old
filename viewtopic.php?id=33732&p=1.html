<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> help for install Hg556a</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 29 Mar 2018 and 2 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 2</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=33732&amp;p=2.html">2</a></li></ul></nav></div>
			
		
		
			<article class="post" id="p152213">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">hope11</div>
					<div class="post-datetime">
						28 Dec 2011, 02:30					</div>
				</div>
				<div class="post-content content">
					<p>It stop at&nbsp; [&nbsp; &nbsp; 0.552000] Kernel panic - not syncing: VFS: Unable to mount root fs on unknown-block(31,2)</p><p>info:</p><br /><p>Finished flashing image.<br />Resetting board...<br />CFE version cfe.d081.5003 for BCM96358 (32bit,SP,BE)<br />Build Date: Wed Nov 11 10:36:35 CST 2009 (Lihua_68693)<br />Copyright (C) 2006 Huawei Technologies Co. Ltd.<br />Boot Address 0xbe000000<br />Initializing Arena.<br />Initializing Devices.<br />@w45260: Flash Manufacture id :c2<br />@w45260Flash Device id :227a<br />@w45260flipCFIGeometry:0<br />Parallel flash device: name MX29LV128DB, id 0x227a, size 16384KB<br />*** GetHG556aBoardVersion = &lt;0&gt; ***<br />CPU type 0x2A010: 300MHz, Bus: 133MHz, Ref: 64MHz<br />Total memory: 67108864 bytes (64MB)<br />Total memory used by CFE:&nbsp; 0x80401000 - 0x8052A510 (1217808)<br />Initialized Data:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x8041F3C0 - 0x80421B60 (10144)<br />BSS Area:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x80421B60 - 0x80428510 (27056)<br />Local Heap:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x80428510 - 0x80528510 (1048576)<br />Stack Area:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x80528510 - 0x8052A510 (8192)<br />Text (code) segment:&nbsp; &nbsp; &nbsp; &nbsp;0x80401000 - 0x8041F3B4 (123828)<br />Boot area (physical):&nbsp; &nbsp; &nbsp; 0x0052B000 - 0x0056B000<br />Relocation Factor:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;I:00000000 - D:00000000<br />*** GetHG556aBoardVersion = &lt;0&gt; ***<br />Board IP address&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : 192.168.1.1&nbsp; <br />Host IP address&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: 192.168.1.100&nbsp; <br />Gateway IP address&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; :&nbsp; &nbsp;<br />Run from flash/host (f/h)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: f&nbsp; <br />Default host run file name&nbsp; &nbsp; &nbsp; &nbsp; : vmlinux&nbsp; <br />Default host flash file name&nbsp; &nbsp; &nbsp; : bcm963xx_fs_kernel&nbsp; <br />Boot delay (0-9 seconds)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : 1&nbsp; <br />Board Id Name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: HW556&nbsp; <br />Psi size in KB&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : 64<br />Number of MAC Addresses (1-32)&nbsp; &nbsp; : 10&nbsp; <br />Base MAC Address&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : 64:16:f0:58:8b:8d&nbsp; <br />Ethernet PHY Type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: Internal<br />Memory size in MB&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: 64<br />CMT Thread Number&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: 1<br />*** Press any key to stop auto run (1 seconds) ***<br />Auto run second count down: 0<br />boot kernel from be020100<br />Code Address: 0x80010000, Entry Address: 0x80010000<br />Decompression OK!<br />Entry at 0x80010000<br />Closing network.<br />Starting program at 0x80010000<br />[&nbsp; &nbsp; 0.000000] Linux version 2.6.39.4 (dani@tool) (gcc version 4.5.4 20110808 (prerelease) (Linaro GCC 4.5-2011.08) ) #46 Thu Dec 22 12:14:33 CET 2011<br />[&nbsp; &nbsp; 0.000000] Detected Broadcom 0x6358 CPU revision a1<br />[&nbsp; &nbsp; 0.000000] CPU frequency is 300 MHz<br />[&nbsp; &nbsp; 0.000000] 64MB of RAM installed<br />[&nbsp; &nbsp; 0.000000] registering 40 GPIOs<br />[&nbsp; &nbsp; 0.000000] board_bcm963xx: Boot address 0xbe000000<br />[&nbsp; &nbsp; 0.000000] board_bcm963xx: CFE version: 100.48.56-49.46<br />[&nbsp; &nbsp; 0.000000] bootconsole [early0] enabled<br />[&nbsp; &nbsp; 0.000000] CPU revision is: 0002a010 (Broadcom BMIPS4350)<br />[&nbsp; &nbsp; 0.000000] board_bcm963xx: board name: HW556<br />[&nbsp; &nbsp; 0.000000] Determined physical RAM map:<br />[&nbsp; &nbsp; 0.000000]&nbsp; memory: 04000000 @ 00000000 (usable)<br />[&nbsp; &nbsp; 0.000000] Initrd not found or empty - disabling initrd<br />[&nbsp; &nbsp; 0.000000] Zone PFN ranges:<br />[&nbsp; &nbsp; 0.000000]&nbsp; &nbsp;Normal&nbsp; &nbsp;0x00000000 -&gt; 0x00004000<br />[&nbsp; &nbsp; 0.000000] Movable zone start PFN for each node<br />[&nbsp; &nbsp; 0.000000] early_node_map[1] active PFN ranges<br />[&nbsp; &nbsp; 0.000000]&nbsp; &nbsp; &nbsp;0: 0x00000000 -&gt; 0x00004000<br />[&nbsp; &nbsp; 0.000000] Built 1 zonelists in Zone order, mobility grouping on.&nbsp; Total pages: 16256<br />[&nbsp; &nbsp; 0.000000] Kernel command line:&nbsp; root=/dev/mtdblock2 rootfstype=squashfs,jffs2 noinitrd console=ttyS0,115200<br />[&nbsp; &nbsp; 0.000000] PID hash table entries: 256 (order: -2, 1024 bytes)<br />[&nbsp; &nbsp; 0.000000] Dentry cache hash table entries: 8192 (order: 3, 32768 bytes)<br />[&nbsp; &nbsp; 0.000000] Inode-cache hash table entries: 4096 (order: 2, 16384 bytes)<br />[&nbsp; &nbsp; 0.000000] Primary instruction cache 16kB, VIPT, 2-way, linesize 16 bytes.<br />[&nbsp; &nbsp; 0.000000] Primary data cache 16kB, 2-way, VIPT, cache aliases, linesize 16 bytes<br />[&nbsp; &nbsp; 0.000000] Memory: 62080k/65536k available (2092k kernel code, 3456k reserved, 357k data, 160k init, 0k highmem)<br />[&nbsp; &nbsp; 0.000000] NR_IRQS:128<br />[&nbsp; &nbsp; 0.000000] Calibrating delay loop... 299.26 BogoMIPS (lpj=598528)<br />[&nbsp; &nbsp; 0.036000] pid_max: default: 32768 minimum: 301<br />[&nbsp; &nbsp; 0.040000] Mount-cache hash table entries: 512<br />[&nbsp; &nbsp; 0.052000] NET: Registered protocol family 16<br />[&nbsp; &nbsp; 0.068000] changed ath9k regdomain to 0xff<br />[&nbsp; &nbsp; 0.072000] registering PCI controller with io_map_base unset<br />[&nbsp; &nbsp; 0.084000] bio: create slab &lt;bio-0&gt; at 0<br />[&nbsp; &nbsp; 0.092000] pci 0000:00:01.0: invalid calibration data<br />[&nbsp; &nbsp; 0.108000] pci 0000:00:01.0: BAR 0: assigned [mem 0x30000000-0x3000ffff]<br />[&nbsp; &nbsp; 0.112000] pci 0000:00:01.0: BAR 0: set to [mem 0x30000000-0x3000ffff] (PCI address [0x30000000-0x3000ffff])<br />[&nbsp; &nbsp; 0.116000] Switching to clocksource MIPS<br />[&nbsp; &nbsp; 0.128000] NET: Registered protocol family 2<br />[&nbsp; &nbsp; 0.132000] IP route cache hash table entries: 1024 (order: 0, 4096 bytes)<br />[&nbsp; &nbsp; 0.140000] TCP established hash table entries: 2048 (order: 2, 16384 bytes)<br />[&nbsp; &nbsp; 0.148000] TCP bind hash table entries: 2048 (order: 1, 8192 bytes)<br />[&nbsp; &nbsp; 0.156000] TCP: Hash tables configured (established 2048 bind 2048)<br />[&nbsp; &nbsp; 0.160000] TCP reno registered<br />[&nbsp; &nbsp; 0.164000] UDP hash table entries: 256 (order: 0, 4096 bytes)<br />[&nbsp; &nbsp; 0.172000] UDP-Lite hash table entries: 256 (order: 0, 4096 bytes)<br />[&nbsp; &nbsp; 0.180000] NET: Registered protocol family 1<br />[&nbsp; &nbsp; 0.184000] audit: initializing netlink socket (disabled)<br />[&nbsp; &nbsp; 0.192000] type=2000 audit(0.192:1): initialized<br />[&nbsp; &nbsp; 0.196000] squashfs: version 4.0 (2009/01/31) Phillip Lougher<br />[&nbsp; &nbsp; 0.204000] JFFS2 version 2.2 (NAND) (SUMMARY) (LZMA) (RTIME) (CMODE_PRIORITY) (c) 2001-2006 Red Hat, Inc.<br />[&nbsp; &nbsp; 0.216000] msgmni has been set to 121<br />[&nbsp; &nbsp; 0.220000] io scheduler noop registered<br />[&nbsp; &nbsp; 0.224000] io scheduler deadline registered (default)<br />[&nbsp; &nbsp; 0.228000] bcm63xx_uart.0: ttyS0 at MMIO 0xfffe0100 (irq = 10) is a bcm63xx_uart<br />[&nbsp; &nbsp; 0.236000] console [ttyS0] enabled, bootconsole disabled<br />[&nbsp; &nbsp; 0.236000] console [ttyS0] enabled, bootconsole disabled<br />[&nbsp; &nbsp; 0.252000] bcm963xx-flash bcm963xx-flash.0: 0x01000000 at 0x1e000000<br />[&nbsp; &nbsp; 0.260000] bcm963xx: Found 1 x16 devices at 0x0 in 16-bit bank. Manufacturer ID 0x0000c2 Chip ID 0x00227a<br />[&nbsp; &nbsp; 0.272000] Amd/Fujitsu Extended Query Table at 0x0040<br />[&nbsp; &nbsp; 0.276000]&nbsp; &nbsp;Amd/Fujitsu Extended Query version 1.3.<br />[&nbsp; &nbsp; 0.280000] number of CFI chips: 1<br />[&nbsp; &nbsp; 0.284000] bcm963xx_flash: Read Signature value of CFE1CFE1<br />[&nbsp; &nbsp; 0.288000] bcm963xx-flash bcm963xx-flash.0: CFE bootloader detected<br />[&nbsp; &nbsp; 0.296000] bcm963xx_flash: CFE boot tag found with version @ and board type <br />[&nbsp; &nbsp; 0.304000] bcm963xx_flash: Partition 0 is CFE offset 0 and length 10000<br />[&nbsp; &nbsp; 0.312000] bcm963xx_flash: Partition 1 is kernel offset 40400000 and length 834052c0<br />[&nbsp; &nbsp; 0.320000] bcm963xx_flash: Partition 2 is rootfs offset c38052c0 and length 3d5fad40<br />[&nbsp; &nbsp; 0.328000] bcm963xx_flash: Partition 3 is ath_data offset e00000 and length 1f0000<br />[&nbsp; &nbsp; 0.336000] bcm963xx_flash: Partition 4 is nvram offset ff0000 and length 10000<br />[&nbsp; &nbsp; 0.344000] bcm963xx_flash: Partition 5 is linux offset 10000 and length df0000<br />[&nbsp; &nbsp; 0.352000] bcm963xx_flash: Spare partition is 71c752c0 offset and length 8f18ad40<br />[&nbsp; &nbsp; 0.360000] Creating 6 MTD partitions on &quot;bcm963xx&quot;:<br />[&nbsp; &nbsp; 0.364000] 0x000000000000-0x000000010000 : &quot;CFE&quot;<br />[&nbsp; &nbsp; 0.372000] 0x000040400000-0x0000c38052c0 : &quot;kernel&quot;<br />[&nbsp; &nbsp; 0.376000] mtd: partition &quot;kernel&quot; is out of reach -- disabled<br />[&nbsp; &nbsp; 0.388000] 0x0000c38052c0-0x000200e00000 : &quot;rootfs&quot;<br />[&nbsp; &nbsp; 0.392000] mtd: partition &quot;rootfs&quot; is out of reach -- disabled<br />[&nbsp; &nbsp; 0.400000] mtd: partition &quot;rootfs&quot; set to be root filesystem<br />[&nbsp; &nbsp; 0.408000] split_squashfs: no squashfs found in &quot;bcm963xx&quot;<br />[&nbsp; &nbsp; 0.412000] 0x000000e00000-0x000000ff0000 : &quot;ath_data&quot;<br />[&nbsp; &nbsp; 0.424000] 0x000000ff0000-0x000001000000 : &quot;nvram&quot;<br />[&nbsp; &nbsp; 0.432000] 0x000000010000-0x000000e00000 : &quot;linux&quot;<br />[&nbsp; &nbsp; 0.448000] bcm63xx_enet MII bus: probed<br />[&nbsp; &nbsp; 0.456000] bcm63xx-wdt bcm63xx-wdt.0:&nbsp; started, timer margin: 30 sec<br />[&nbsp; &nbsp; 0.468000] TCP westwood registered<br />[&nbsp; &nbsp; 0.472000] NET: Registered protocol family 17<br />[&nbsp; &nbsp; 0.476000] 802.1Q VLAN Support v1.8 Ben Greear &lt;greearb@candelatech.com&gt;<br />[&nbsp; &nbsp; 0.484000] All bugs added by David S. Miller &lt;davem@redhat.com&gt;<br />[&nbsp; &nbsp; 0.492000] end_request: I/O error, dev mtdblock2, sector 0<br />[&nbsp; &nbsp; 0.500000] SQUASHFS error: squashfs_read_data failed to read block 0x0<br />[&nbsp; &nbsp; 0.508000] SQUASHFS error: unable to read squashfs_super_block<br />[&nbsp; &nbsp; 0.516000] VFS: Cannot open root device &quot;mtdblock2&quot; or unknown-block(31,2)<br />[&nbsp; &nbsp; 0.520000] Please append a correct &quot;root=&quot; boot option; here are the available partitions:<br />[&nbsp; &nbsp; 0.528000] 1f00&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 64 mtdblock0&nbsp; (driver?)<br />[&nbsp; &nbsp; 0.536000] 1f03&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1984 mtdblock3&nbsp; (driver?)<br />[&nbsp; &nbsp; 0.540000] 1f04&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 64 mtdblock4&nbsp; (driver?)<br />[&nbsp; &nbsp; 0.544000] 1f05&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;14272 mtdblock5&nbsp; (driver?)<br />[&nbsp; &nbsp; 0.552000] Kernel panic - not syncing: VFS: Unable to mount root fs on unknown-block(31,2)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p152468">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">danitool</div>
					<div class="post-datetime">
						30 Dec 2011, 18:20					</div>
				</div>
				<div class="post-content content">
					<p>This part returned by your CFE bootloader is interesting:<br /></p><div class="codebox"><pre><code>@w45260: Flash Manufacture id :c2
@w45260Flash Device id :227a
@w45260flipCFIGeometry:0
Parallel flash device: name MX29LV128DB, id 0x227a, size 16384KB</code></pre></div><p>Whereas in my CFE bootloader with a different flash memory chip and Openwrt workin fine, I have this<br /></p><div class="codebox"><pre><code>@w45260: Flash Manufacture id :c2
@w45260Flash Device id :2201
@w45260flipCFIGeometry:1
Parallel flash device: name , id 0x2201, size 16384KB</code></pre></div><p>Note this<br /><strong>@w45260flipCFIGeometry: 0</strong></p><p>Is this the responsible of the incorrect mapping?</p>											<p class="post-edited">(Last edited by <strong>danitool</strong> on 30 Dec 2011, 18:20)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p152491">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">Isaac702</div>
					<div class="post-datetime">
						31 Dec 2011, 03:43					</div>
				</div>
				<div class="post-content content">
					<p>I have the same flash device as the original poster in my HG556a and would be interested in seeing if it could run Openwrt.</p><p>The following links are a backup copy of the flash and a copy of the boot log for the original firmware.</p><p>I can&#039;t see many differences in the flash backup between mine and the one that danitool posted previously however it may be useful.<br />The ath_data section of the flash does appear to be at a different location on this flash chip however. In my flash backup it starts at 0x00F7E000 instead of 0x00EFE000 as quoted elsewhere.</p><p>Boot Log.<br /><a href="http://www.redbrick.dcu.ie/~isaac702/hg556a_boot.log">http://www.redbrick.dcu.ie/~isaac702/hg556a_boot.log</a></p><p>Flash Backup.<br /><a href="http://www.redbrick.dcu.ie/~isaac702/hg556a_dump.dat.zip">http://www.redbrick.dcu.ie/~isaac702/hg … mp.dat.zip</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p152740">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">danitool</div>
					<div class="post-datetime">
						2 Jan 2012, 17:04					</div>
				</div>
				<div class="post-content content">
					<p>The geometry of these two flash chips is different<br /></p><div class="quotebox"><blockquote><p><strong>MX29LV128DB</strong><br />263 sectors<br />bottom boot: first 8 sectors with 8KB size (0x2000)<br />remaining sectors with 64KB size (0x10000)</p></blockquote></div><div class="quotebox"><blockquote><p><strong>MX29GL128EH</strong><br />128 sectors<br />sector size = 128KB (0x20000)<br />uniform geometry</p></blockquote></div><p>Ok now let&#039;s see the part where the bootlog informs the location of the calibration data:</p><p><strong>MX29GL128EH</strong><br /></p><div class="quotebox"><blockquote><p>Total Flash size: 16384K with 128 sectors<br />Board id is set HW556, ucHardwareType 0<br />fInfo.flash_wlanparam_start_blk = 119<br />fInfo.flash_wlanparam_number_blk = 1<br />fInfo.flash_wlanparam_length = 0x2000<br />fInfo.flash_wlanparam_blk_offset = 0x1e000</p></blockquote></div><p>Accordingly to the geometry let&#039;s calculate the offset:</p><p><em>(fInfo.flash_wlanparam_start_blk) * (sector_size) + (fInfo.flash_wlanparam_blk_offset) = offset</em><br /><strong>119*0x20000+0x1e000 = 0xEFE000</strong></p><p>Correct, as we saw without calculation it&#039;s located at this offset</p><p>But for the other flash-chip, it&#039;s a little complex:<br /><strong>MX29LV128DB</strong><br /></p><div class="quotebox"><blockquote><p>Total Flash size: 16384K with 263 sectors<br />Board id is set HW556, ucHardwareType 0<br />fInfo.flash_wlanparam_start_blk = 254<br />fInfo.flash_wlanparam_number_blk = 1<br />fInfo.flash_wlanparam_length = 0x2000<br />fInfo.flash_wlanparam_blk_offset = 0xe000</p></blockquote></div><p>Accordingly to the geometry let&#039;s calculate the offset</p><p><em>(first 8 sectors size) * (number of sectors) + (fInfo.flash_wlanparam_start_blk - first_8_sectors) * (sector size) + (fInfo.flash_wlanparam_blk_offset) = offset </em><br /><strong>0x2000*8+(254-8)*0x10000+0xe000 = 0xF7E000 </strong></p><p>Ok now we know how to interpret this data.</p><p>The question now is: are the fInfo.flash values hardcoded into the kernel, or do it live somewhere at the flash?</p><p>And I don&#039;t know if this non-uniform geometry is causing the wrong mapping with the MX29LV128DB flash chips</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p152984">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">hope11</div>
					<div class="post-datetime">
						4 Jan 2012, 10:22					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Isaac702 wrote:</cite><blockquote><p>I have the same flash device as the original poster in my HG556a and would be interested in seeing if it could run Openwrt.</p><p>The following links are a backup copy of the flash and a copy of the boot log for the original firmware.</p><p>I can&#039;t see many differences in the flash backup between mine and the one that danitool posted previously however it may be useful.<br />The ath_data section of the flash does appear to be at a different location on this flash chip however. In my flash backup it starts at 0x00F7E000 instead of 0x00EFE000 as quoted elsewhere.</p><p>Boot Log.<br /><a href="http://www.redbrick.dcu.ie/~isaac702/hg556a_boot.log">http://www.redbrick.dcu.ie/~isaac702/hg556a_boot.log</a></p><p>Flash Backup.<br /><a href="http://www.redbrick.dcu.ie/~isaac702/hg556a_dump.dat.zip">http://www.redbrick.dcu.ie/~isaac702/hg … mp.dat.zip</a></p></blockquote></div><p>Can i use ttl to install firmware with your &#039;flash backup&#039;, to change the file&#039;s name, just like &#039;backup.bin&#039; ;</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p152985">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">hope11</div>
					<div class="post-datetime">
						4 Jan 2012, 10:24					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>danitool wrote:</cite><blockquote><p>The geometry of these two flash chips is different<br /></p><div class="quotebox"><blockquote><p><strong>MX29LV128DB</strong><br />263 sectors<br />bottom boot: first 8 sectors with 8KB size (0x2000)<br />remaining sectors with 64KB size (0x10000)</p></blockquote></div><div class="quotebox"><blockquote><p><strong>MX29GL128EH</strong><br />128 sectors<br />sector size = 128KB (0x20000)<br />uniform geometry</p></blockquote></div><p>Ok now let&#039;s see the part where the bootlog informs the location of the calibration data:</p><p><strong>MX29GL128EH</strong><br /></p><div class="quotebox"><blockquote><p>Total Flash size: 16384K with 128 sectors<br />Board id is set HW556, ucHardwareType 0<br />fInfo.flash_wlanparam_start_blk = 119<br />fInfo.flash_wlanparam_number_blk = 1<br />fInfo.flash_wlanparam_length = 0x2000<br />fInfo.flash_wlanparam_blk_offset = 0x1e000</p></blockquote></div><p>Accordingly to the geometry let&#039;s calculate the offset:</p><p><em>(fInfo.flash_wlanparam_start_blk) * (sector_size) + (fInfo.flash_wlanparam_blk_offset) = offset</em><br /><strong>119*0x20000+0x1e000 = 0xEFE000</strong></p><p>Correct, as we saw without calculation it&#039;s located at this offset</p><p>But for the other flash-chip, it&#039;s a little complex:<br /><strong>MX29LV128DB</strong><br /></p><div class="quotebox"><blockquote><p>Total Flash size: 16384K with 263 sectors<br />Board id is set HW556, ucHardwareType 0<br />fInfo.flash_wlanparam_start_blk = 254<br />fInfo.flash_wlanparam_number_blk = 1<br />fInfo.flash_wlanparam_length = 0x2000<br />fInfo.flash_wlanparam_blk_offset = 0xe000</p></blockquote></div><p>Accordingly to the geometry let&#039;s calculate the offset</p><p><em>(first 8 sectors size) * (number of sectors) + (fInfo.flash_wlanparam_start_blk - first_8_sectors) * (sector size) + (fInfo.flash_wlanparam_blk_offset) = offset </em><br /><strong>0x2000*8+(254-8)*0x10000+0xe000 = 0xF7E000 </strong></p><p>Ok now we know how to interpret this data.</p><p>The question now is: are the fInfo.flash values hardcoded into the kernel, or do it live somewhere at the flash?</p><p>And I don&#039;t know if this non-uniform geometry is causing the wrong mapping with the MX29LV128DB flash chips</p></blockquote></div><p>Very complex......</p><p>How to do the next step...</p><p>Look forward to</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p153052">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">danitool</div>
					<div class="post-datetime">
						4 Jan 2012, 17:27					</div>
				</div>
				<div class="post-content content">
					<p>The problem is with the CFE length, badly detected<br /></p><div class="quotebox"><blockquote><p>[&nbsp; &nbsp; 0.384000] bcm963xx_flash: CFE boot tag found with version @ and board type <br />[&nbsp; &nbsp; 0.392000] bcm963xx_flash: Partition 0 is CFE offset 0 and length 10000<br />[&nbsp; &nbsp; 0.396000] bcm963xx_flash: Partition 1 is kernel offset 40400000 and length 834079d0<br />[&nbsp; &nbsp; 0.408000] bcm963xx_flash: Partition 2 is rootfs offset c38079d0 and length 3d5f8630<br />[&nbsp; &nbsp; 0.416000] bcm963xx_flash: Partition 3 is ath_data offset e00000 and length 1f0000<br />[&nbsp; &nbsp; 0.424000] bcm963xx_flash: Partition 4 is nvram offset ff0000 and length 10000<br />[&nbsp; &nbsp; 0.428000] bcm963xx_flash: Partition 5 is linux offset 10000 and length df0000<br />[&nbsp; &nbsp; 0.436000] bcm963xx_flash: Spare partition is 71c779d0 offset and length 8f188630</p></blockquote></div><p>It should be 0x20000 not 0x10000, that&#039;s because then it detects the @ tag instead 8, no board ID name, and then wrong partition adresses.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p153054">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">Orca</div>
					<div class="post-datetime">
						4 Jan 2012, 17:33					</div>
				</div>
				<div class="post-content content">
					<p><a href="http://wiki.openwrt.org/doc/techref/bootloader/cfe">http://wiki.openwrt.org/doc/techref/bootloader/cfe</a></p><p>If it doesn&#039;t help, maybe make it help in the future...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p153125">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">jerje</div>
					<div class="post-datetime">
						5 Jan 2012, 00:17					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>danitool wrote:</cite><blockquote><p>The question now is: are the fInfo.flash values hardcoded into the kernel, or do it live somewhere at the flash?</p><p>And I don&#039;t know if this non-uniform geometry is causing the wrong mapping with the MX29LV128DB flash chips</p></blockquote></div><p>I need to go back and look at this box again but AFAIR I extracted the kernel image and found these values embedded in the kernel.</p><p>You would think this would make the manufacturing/build process quite complex for Huawei...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p153126">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">danitool</div>
					<div class="post-datetime">
						5 Jan 2012, 00:28					</div>
				</div>
				<div class="post-content content">
					<p>Does it mean there are different firmwares depending on the flash-chip?</p><p>I don&#039;t think so, since it would also make more complex to update the device for the ISPs.</p><p>I rather think the kernel has the values embedded, but for both flash chips, that would explain why it checks the chip ID at early startup.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p153249">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">danitool</div>
					<div class="post-datetime">
						5 Jan 2012, 21:48					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ve built two firmwares, since I&#039;m not able to make the conditional to choose the offset calibration data depending on the flash chip ID:</p><p>hg556a with <strong>MX29GL128EH</strong> flash memory<br /><a href="http://files.myopera.com/danitool/linux/openwrt-HW556-squashfs-cfe_r29606.zip">http://files.myopera.com/danitool/linux … r29606.zip</a></p><p>hg556a with <strong>MX29LV128DB</strong> flash memory<br /><a href="http://files.myopera.com/danitool/linux/openwrt-HG556a_MX29LV128DB-squashfs-cfe.bin.zip">http://files.myopera.com/danitool/linux … fe.bin.zip</a></p><p>Both are tested with wifi working. Btw use them at your own risk.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p153299">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">hope11</div>
					<div class="post-datetime">
						6 Jan 2012, 10:38					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>danitool wrote:</cite><blockquote><p>hg556a with <strong>MX29LV128DB</strong> flash memory<br /><a href="http://files.myopera.com/danitool/linux/openwrt-HG556a_MX29LV128DB-squashfs-cfe.bin.zip">http://files.myopera.com/danitool/linux … fe.bin.zip</a></p><p>Both are tested with wifi working. Btw use them at your own risk.</p></blockquote></div><p>Try this one ,wifi dosen&#039;t work too;</p><p>invalid calibration data...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p153321">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">danitool</div>
					<div class="post-datetime">
						6 Jan 2012, 13:38					</div>
				</div>
				<div class="post-content content">
					<p>hope11 since you wiped out your calibration data and now you are using my calibration data&nbsp; (for MX29GL128EH flash chip) the HG556a_MX29LV128DB-squashfs-cfe.bin firmware won&#039;t work. You must flash again the calibration data for the <strong>MX29LV128DB</strong> flash chip. Extract the ath_data partition from the Isaac702 firmware backup using the offset 0xe00000 and copy it into your router.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p153339">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">Isaac702</div>
					<div class="post-datetime">
						6 Jan 2012, 16:03					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for the firmware it works great.</p><p>Any chance you could recompile the kernel with ipv6 support? Would be a nice improvement.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p153424">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">hope11</div>
					<div class="post-datetime">
						7 Jan 2012, 01:40					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Isaac702 wrote:</cite><blockquote><p>Thanks for the firmware it works great.</p><p>Any chance you could recompile the kernel with ipv6 support? Would be a nice improvement.</p></blockquote></div><p>could you please , send me your ath_data, use this command &#039;dd if=/dev/mtd4 of=/tmp/ath_data.bin&#039;;</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p153426">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">Isaac702</div>
					<div class="post-datetime">
						7 Jan 2012, 02:02					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>hope11 wrote:</cite><blockquote><p>could you please , send me your ath_data, use this command &#039;dd if=/dev/mtd4 of=/tmp/ath_data.bin&#039;;</p></blockquote></div><p>Here is a copy of the ath_data from my system.<br /><a href="http://www.redbrick.dcu.ie/~isaac702/openwrt/ath_data.bin">http://www.redbrick.dcu.ie/~isaac702/op … h_data.bin</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p153429">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">hope11</div>
					<div class="post-datetime">
						7 Jan 2012, 02:14					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Isaac702 wrote:</cite><blockquote><div class="quotebox"><cite>hope11 wrote:</cite><blockquote><p>could you please , send me your ath_data, use this command &#039;dd if=/dev/mtd4 of=/tmp/ath_data.bin&#039;;</p></blockquote></div><p>Here is a copy of the ath_data from my system.<br /><a href="http://www.redbrick.dcu.ie/~isaac702/openwrt/ath_data.bin">http://www.redbrick.dcu.ie/~isaac702/op … h_data.bin</a></p></blockquote></div><p>Thank you very much......</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p153433">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">hope11</div>
					<div class="post-datetime">
						7 Jan 2012, 03:09					</div>
				</div>
				<div class="post-content content">
					<p>My router works great, too.</p><p>Thank you for danitool and Isaac702;</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p153542">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">hope11</div>
					<div class="post-datetime">
						8 Jan 2012, 03:12					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>danitool wrote:</cite><blockquote><p>hope11 since you wiped out your calibration data and now you are using my calibration data&nbsp; (for MX29GL128EH flash chip) the HG556a_MX29LV128DB-squashfs-cfe.bin firmware won&#039;t work. You must flash again the calibration data for the <strong>MX29LV128DB</strong> flash chip. Extract the ath_data partition from the Isaac702 firmware backup using the offset 0xe00000 and copy it into your router.</p></blockquote></div><p>Another problem, I use macvlan to Virtual a vth1(wan1), it can&#039;t work(set pppoe username passwd, it didn&#039; connect);</p><p>The Kernel didn&#039;t Support?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p153587">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">fyi</div>
					<div class="post-datetime">
						8 Jan 2012, 16:54					</div>
				</div>
				<div class="post-content content">
					<p>Try veth.</p><p><a href="http://wiki.openvz.org/Virtual_Ethernet_device">Virtual Ethernet device - OpenVZ Linux Containers Wiki</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p153749">
				<div class="post-metadata">
					<div class="post-num">Post #21</div>
					<div class="post-author">hope11</div>
					<div class="post-datetime">
						10 Jan 2012, 09:06					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>fyi wrote:</cite><blockquote><p>Try veth.</p><p><a href="http://wiki.openvz.org/Virtual_Ethernet_device">Virtual Ethernet device - OpenVZ Linux Containers Wiki</a></p></blockquote></div><p>I had tryed it ...</p><p>&#039;vethd -v veth1 -e eth0.1 -m 00:11:22:xx:xx:xx:xx&#039;</p><p>Use this command the router will reboot, then router start completed, to use command&#039;ifconfig&#039;, the veth1 is none, ip link set veth up : veth is none;</p><br /><p>how to set it, does my openwrt&#039; kernel didn&#039;t support; </p><p>And how to support it(i can&#039;t make a firmware)......</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p154016">
				<div class="post-metadata">
					<div class="post-num">Post #22</div>
					<div class="post-author">fyi</div>
					<div class="post-datetime">
						13 Jan 2012, 00:35					</div>
				</div>
				<div class="post-content content">
					<p><a href="https://forum.openwrt.org/viewtopic.php?pid=153996#p153996">OpenWrt / SSID with multip VLAN&#039;s</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p154021">
				<div class="post-metadata">
					<div class="post-num">Post #23</div>
					<div class="post-author">hope11</div>
					<div class="post-datetime">
						13 Jan 2012, 02:14					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>fyi wrote:</cite><blockquote><p><a href="https://forum.openwrt.org/viewtopic.php?pid=153996#p153996">OpenWrt / SSID with multip VLAN&#039;s</a></p></blockquote></div><p>I mean that i use &#039;vethd-command&#039;, the router auto to restart&nbsp; at the time...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p154439">
				<div class="post-metadata">
					<div class="post-num">Post #24</div>
					<div class="post-author">dotaer</div>
					<div class="post-datetime">
						17 Jan 2012, 01:08					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>danitool wrote:</cite><blockquote><p>hope11 since you wiped out your calibration data and now you are using my calibration data&nbsp; (for MX29GL128EH flash chip) the HG556a_MX29LV128DB-squashfs-cfe.bin firmware won&#039;t work. You must flash again the calibration data for the <strong>MX29LV128DB</strong> flash chip. Extract the ath_data partition from the Isaac702 firmware backup using the offset 0xe00000 and copy it into your router.</p></blockquote></div><p>Hello to all,</p><p>I have a on questions that how to use the patch(https://dev.openwrt.org/ticket/10741)?</p><p>I have used this command: patch -p1 &lt; bcm63XX_hg556a.patch</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; info&nbsp; &nbsp;: can&#039;t find file to patch at input line3<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;perhaps you used the wrong -p or --strip option?</p><p>What is the right commands?</p><p>Olny to use this patch?</p><p>Thanks in advanced!<br />Regards to all</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p166107">
				<div class="post-metadata">
					<div class="post-num">Post #25</div>
					<div class="post-author">faithy</div>
					<div class="post-datetime">
						30 Apr 2012, 03:40					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>I lost my ath data as well. How can I restore that please? Thank you in advance!</p><p>Done already. Thanks!</p>											<p class="post-edited">(Last edited by <strong>faithy</strong> on 1 May 2012, 00:29)</p>
									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 1 of 2</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=33732&amp;p=2.html">2</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>