<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Samba: Does not seem to be running using default instructions</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 14 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p78398">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">TheoMurpse</div>
					<div class="post-datetime">
						20 Dec 2008, 02:11					</div>
				</div>
				<div class="post-content content">
					<p>I have 8.09 on a Linksys NSLU2. I have only made one change to the default install, and that is to install ntfs-3g and add a startup script mounting an NTFS drive.</p><p>Now, I followed the instructions at <a href="http://wiki.openwrt.org/SambaHowto">http://wiki.openwrt.org/SambaHowto</a> to the T. I did not install samba-client, only samba-server.</p><p>When I run &quot;/etc/init.d/samba start&quot; like in the instructions, nothing happens and I just get the prompt again: user@server:directory#</p><p>When I run &quot;ps&quot;, smbd is not listed. Nor is nmbd. Looking in the samba script in init.d, in the start() function, it contains </p><p>nmbd -D $NMBD_OPTIONS<br />smbd -D $SMBD_OPTIONS</p><p>Now, first of all, nowhere in the samba script are $NMBD_OPTIONS and $SMBD_OPTIONS defined. Second, I was told by someone on IRC that nmbd is not included in the OpenWRT release of samba. So, first of all, why is nmbd even being run in the script if it&#039;s not included?</p><p>I&#039;ve also tried running &quot;nmbd -D&quot; and &quot;smbd -D&quot; and both times the same thing happens as I mentioned above: no output, just a new blank prompt.</p><p>So why might the default installation of samba not work? And why don&#039;t the exact instructions in the aforementioned link not cause me to arrive at a functioning samba installation?</p><p>Thanks!</p><p>Here&#039;s the output of &quot;ps&quot; after &quot;samba start&quot;:<br /></p><div class="quotebox"><blockquote><p>PID USER&nbsp; &nbsp; &nbsp; &nbsp;VSZ STAT COMMAND<br />&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp; 1108 S&nbsp; &nbsp; init&nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; 2 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&lt;&nbsp; [kthreadd]<br />&nbsp; &nbsp; 3 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&lt;&nbsp; [ksoftirqd/0]<br />&nbsp; &nbsp; 4 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&lt;&nbsp; [events/0]<br />&nbsp; &nbsp; 5 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&lt;&nbsp; [khelper]<br />&nbsp; &nbsp;39 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&lt;&nbsp; [kblockd/0]<br />&nbsp; &nbsp;67 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&nbsp; &nbsp;[pdflush]<br />&nbsp; &nbsp;68 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&nbsp; &nbsp;[pdflush]<br />&nbsp; &nbsp;69 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&lt;&nbsp; [kswapd0]<br />&nbsp; &nbsp;70 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&lt;&nbsp; [aio/0]<br />&nbsp; 601 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&lt;&nbsp; [mtdblockd]<br /> 1873 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SWN&nbsp; [jffs2_gcd_mtd5]<br /> 1887 root&nbsp; &nbsp; &nbsp; 1108 S&nbsp; &nbsp; logger -s -p 6 -t&nbsp; <br /> 1888 root&nbsp; &nbsp; &nbsp; 1108 S&nbsp; &nbsp; init&nbsp; &nbsp; &nbsp; &nbsp;<br /> 1897 root&nbsp; &nbsp; &nbsp; 1120 S&nbsp; &nbsp; syslogd -C16 <br /> 1899 root&nbsp; &nbsp; &nbsp; 1104 S&nbsp; &nbsp; klogd <br /> 1911 root&nbsp; &nbsp; &nbsp; &nbsp;588 S&nbsp; &nbsp; /sbin/hotplug2 --override --persistent --max-children<br /> 2006 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&lt;&nbsp; [khubd]<br /> 2150 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&lt;&nbsp; [scsi_eh_0]<br /> 2151 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&lt;&nbsp; [usb-storage]<br /> 2352 root&nbsp; &nbsp; &nbsp; &nbsp;888 S&nbsp; &nbsp; /usr/sbin/dropbear -p 22 <br /> 2357 root&nbsp; &nbsp; &nbsp; 1104 S&nbsp; &nbsp; /usr/sbin/httpd -p 80 -h /www -r rational <br /> 2390 nobody&nbsp; &nbsp; &nbsp;704 S&nbsp; &nbsp; /usr/sbin/dnsmasq -K -D -y -Z -b -E -s lan -S /lan/ -<br /> 2402 root&nbsp; &nbsp; &nbsp; 1508 S&nbsp; &nbsp; ntfs-3g /dev/sda1 /mnt/sda1 <br /> 2406 root&nbsp; &nbsp; &nbsp; 1100 S&nbsp; &nbsp; watchdog -t 5 /dev/watchdog <br /> 2463 root&nbsp; &nbsp; &nbsp; &nbsp;944 R&nbsp; &nbsp; /usr/sbin/dropbear -p 22 <br /> 2464 root&nbsp; &nbsp; &nbsp; 1116 S&nbsp; &nbsp; -ash <br /> 2575 root&nbsp; &nbsp; &nbsp; 1108 R&nbsp; &nbsp; ps</p></blockquote></div><p>Here are the contents of the samba script:</p><div class="quotebox"><blockquote><p>root@rational:/etc/init.d# cat samba<br />#!/bin/sh /etc/rc.common<br /># Copyright (C) 2006 OpenWrt.org<br />START=50</p><p>DEFAULT=/etc/default/samba<br />RUN_D=/var/run/samba<br />NMBD_PID_F=$RUN_D/nmbd.pid<br />SMBD_PID_F=$RUN_D/smbd.pid</p><p>config_cb() {<br />&nbsp; &nbsp; &nbsp; &nbsp; local cfg=&quot;$CONFIG_SECTION&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; local cfgtype<br />&nbsp; &nbsp; &nbsp; &nbsp; config_get cfgtype &quot;$cfg&quot; TYPE</p><p>&nbsp; &nbsp; &nbsp; &nbsp; case &quot;$cfgtype&quot; in<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; timezone)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; config_get posixtz&nbsp; &nbsp; &nbsp; $cfg posixtz<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; config_get zoneinfo&nbsp; &nbsp; &nbsp;$cfg zoneinfo<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo &quot;$posixtz&quot; &gt; /etc/TZ<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ;;<br />&nbsp; &nbsp; &nbsp; &nbsp; esac<br />}</p><br /><p>start() {<br />&nbsp; &nbsp; &nbsp; &nbsp; [ -f $DEFAULT ] &amp;&amp; . $DEFAULT<br />&nbsp; &nbsp; &nbsp; &nbsp; config_load timezone&amp;<br />&nbsp; &nbsp; &nbsp; &nbsp; mkdir -p $RUN_D<br />&nbsp; &nbsp; &nbsp; &nbsp; nmbd -D $NMBD_OPTIONS<br />&nbsp; &nbsp; &nbsp; &nbsp; smbd -D $SMBD_OPTIONS<br />}<br />stop() {<br />&nbsp; &nbsp; &nbsp; &nbsp; [ -f $SMBD_PID_F ] &amp;&amp; kill $(cat $SMBD_PID_F)<br />&nbsp; &nbsp; &nbsp; &nbsp; [ -f $NMBD_PID_F ] &amp;&amp; kill $(cat $NMBD_PID_F)<br />}</p><p>root@rational:/etc/init.d#</p></blockquote></div>											<p class="post-edited">(Last edited by <strong>TheoMurpse</strong> on 20 Dec 2008, 02:14)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p78413">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">Yanira</div>
					<div class="post-datetime">
						20 Dec 2008, 11:38					</div>
				</div>
				<div class="post-content content">
					<p>Nice howto...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p78430">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">TheoMurpse</div>
					<div class="post-datetime">
						21 Dec 2008, 05:26					</div>
				</div>
				<div class="post-content content">
					<p>What? I wasn&#039;t how-toing anything. I&#039;m absolutely exasperated that I can&#039;t get samba working despite the fact that I&#039;m character-for-character copying out of TFM.</p><p>I&#039;m sure I&#039;m missing some sarcasm in your post, but I don&#039;t know what the intention was...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p78431">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">Arch13</div>
					<div class="post-datetime">
						21 Dec 2008, 07:33					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>TheoMurpse wrote:</cite><blockquote><p>What? I wasn&#039;t how-toing anything. I&#039;m absolutely exasperated that I can&#039;t get samba working despite the fact that I&#039;m character-for-character copying out of TFM.</p><p>I&#039;m sure I&#039;m missing some sarcasm in your post, but I don&#039;t know what the intention was...</p></blockquote></div><p>His sarcasm was that this was posted in the How-To sub-forum instead of the Kamikaze Sub-forum. Please PM a MOD to move this thread.<br />(Please do continue to post as you find more information and post if you find a solution by the way)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p78443">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">belrpr</div>
					<div class="post-datetime">
						21 Dec 2008, 16:40					</div>
				</div>
				<div class="post-content content">
					<p>Solution to this problem is defining a hostname.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p78784">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">raibach</div>
					<div class="post-datetime">
						30 Dec 2008, 00:53					</div>
				</div>
				<div class="post-content content">
					<p>ok-&nbsp; this post is out off topic, but the fact ist: <br />I have the same problem with the latest trunk-Version (ver12989) and nlsu2<br />defining hostname for the gateway and the local ethernet device in&quot; /etc/hosts&quot; does not solve the problem !</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p102389">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">c0d3x42</div>
					<div class="post-datetime">
						7 Feb 2010, 20:34					</div>
				</div>
				<div class="post-content content">
					<p>hi there,<br />i&#039;ve also had this problem with the the current trunk version of openwrt installed on an NSLU2.<br />I opkg installed strace and had a look to see what was going on and found it attempting to do a DNS lookup for the name OPENWRT.<br />I&#039;d guess that this is either the WORKGROUP name in smb.conf or the systems hostname.&nbsp; either way I didn&#039;nt have a valid entry for it in /etc/hosts.</p><p>so i&#039;d suggest you stick an entry in /etc/hosts for the openwrt (assuming you haven&#039;t changed the hostname) and assign it to the lan&#039;s IP adderess, such as:</p><p>root@OpenWrt:/etc/samba# cat /etc/hosts<br />127.0.0.1 localhost.<br />192.168.2.2 slug.meadow.rd OPENWRT</p><p>then restart dnsmasq and samba and see if that helps.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>