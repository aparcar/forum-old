<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Ubiquiti Nanobeam OpenWrt support</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 2 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p226705">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">valentt</div>
					<div class="post-datetime">
						3 Mar 2014, 14:07					</div>
				</div>
				<div class="post-content content">
					<p>Did anybody get their hands on Ubiquiti Nanobeam equipment? Nanobeam is very similar to Nanobridge but it has improved radio and antenna design, and faster cpu.</p><p>Guys on the Ubiquiti forums are really stoked about how great they work:<br /><a href="http://community.ubnt.com/t5/Installation-Troubleshooting/NanoBeam-vs-NanoBridge/td-p/687967">http://community.ubnt.com/t5/Installati … d-p/687967</a></p><p>If anybody has started working on supporting OpenWrt on these devices please let me know and if I can help in any way.</p>											<p class="post-edited">(Last edited by <strong>valentt</strong> on 3 Mar 2014, 14:07)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p229755">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">Giepie</div>
					<div class="post-datetime">
						10 Apr 2014, 00:39					</div>
				</div>
				<div class="post-content content">
					<p>I was wondering the exact same thing!</p><p>It would be awesome if we could get OpenWRT support on them NanoBeams</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p231170">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">glahue</div>
					<div class="post-datetime">
						24 Apr 2014, 11:12					</div>
				</div>
				<div class="post-content content">
					<p>We just ordered one piece for testing, will keep you updated!</p><p><a href="http://www.unwired.at">www.unwired.at</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p236114">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">ilario</div>
					<div class="post-datetime">
						9 Jun 2014, 18:21					</div>
				</div>
				<div class="post-content content">
					<p>Any news?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p236793">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">glahue</div>
					<div class="post-datetime">
						14 Jun 2014, 20:06					</div>
				</div>
				<div class="post-content content">
					<p>I was able to open the device and access the serial port.<br />This is the output of the bootloader:<br /></p><div class="codebox"><pre><code>U-Boot 1.1.4-s751 (Aug 21 2013 - 12:06:27)

Board: Ubiquiti Networks AR9342 board (e4e5-24.1122.0030)
Reset: Normal
DRAM:  64 MB
Flash:  8 MB (0xc2, 0x20, 0x17)
Net:   AR8035
eth0
Radio: 0777:e4e5
Hit any key to stop autoboot:  0 
## Booting image at 9f050000 ...
   Image Name:   MIPS Ubiquiti Linux-2.6.32.60
   Created:      2013-08-30  13:24:09 UTC
   Image Type:   MIPS Linux Kernel Image (lzma compressed)
   Data Size:    1000716 Bytes = 977.3 kB
   Load Address: 80002000
   Entry Point:  80002000
   Verifying Checksum at 0x9f050040 ...OK
   Uncompressing Kernel Image ... OK

Starting kernel ...

Booting Atheros AR934x</code></pre></div><p>From there on the screen stays blank.<br />Where to go from here?</p><p>Best, G.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p236798">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">qasdfdsaq</div>
					<div class="post-datetime">
						14 Jun 2014, 20:23					</div>
				</div>
				<div class="post-content content">
					<p>Is there any network traffic at that point? You&#039;ll probably have to set your card to promiscuous and sniff all UDP traffic. Either way it looks like it may have console redirection set up.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p236804">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">glahue</div>
					<div class="post-datetime">
						14 Jun 2014, 20:49					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><div class="quotebox"><cite>qasdfdsaq wrote:</cite><blockquote><p>Is there any network traffic at that point? You&#039;ll probably have to set your card to promiscuous and sniff all UDP traffic. Either way it looks like it may have console redirection set up.</p></blockquote></div><p>this is still with the original firmware, which of course boots and i can also login via ssh.</p><p>Next i tried to flash UAP-Pro image since this UBNT device also has AR9342 chipset. But the bootloader complains:</p><div class="codebox"><pre><code>Setting default IP 192.168.1.20
Starting TFTP server...
Using eth0 (192.168.1.20), address: 0x81000000
Will reset device configuration (Reset button active after 10 seconds).
find_mtd_part
Clearing partition &#039;cfg&#039;:
        erasing range 0x9F7B0000..0x9F7EFFFF: .... done
Erased 4 sectors
Waiting for connection: /
Receiving file from 192.168.1.19:49531
Received 7274844 bytes
Firmware Version: BZ.ar934x.v6.0.0-OpenWrt-r40422
Setting U-Boot environment variables
Un-Protected 1 sectors
Erasing Flash.... done
Erased 1 sectors
Writing to Flash... write addr: 9f040000
done
Protected 1 sectors
Warning: partition jffs2 not found on flash memory! Skipped.

Firmware update complete.

Resetting...</code></pre></div><p>After this the device reboots with the original firmware still on it. </p><p>This is the flash layout according to u-boot:</p><div class="codebox"><pre><code>ar7240&gt; mtdparts

device nor0 &lt;ath-nor0&gt;, # parts = 6
 #: name                        size            offset          mask_flags
 0: u-boot                      0x00040000      0x00000000      0
 1: u-boot-env                  0x00010000      0x00040000      0
 2: kernel                      0x00100000      0x00050000      0
 3: rootfs                      0x00660000      0x00150000      0
 4: cfg                         0x00040000      0x007b0000      0
 5: EEPROM                      0x00010000      0x007f0000      0

active partition: nor0,0 - (u-boot) 0x00040000 @ 0x00000000

defaults:
mtdids  : nor0=ath-nor0
mtdparts: mtdparts=ath-nor0:256k(u-boot),64k(u-boot-env),1024k(kernel),6528k(rootfs),256k(cfg),64k(EEPROM)</code></pre></div><p>Currently i´m looking around in my buildroot to find the correct place to put necessary information, any help is appriciated.</p><p>Best, G.</p><p>Edit: and that´s why the UAP Pro Image doesn´t fit:</p><div class="codebox"><pre><code>BZ.v3.1.6# cat /proc/mtd
dev:    size   erasesize  name
mtd0: 00040000 00010000 &quot;u-boot&quot;
mtd1: 00010000 00010000 &quot;u-boot-env&quot;
mtd2: 00f60000 00010000 &quot;jffs2&quot;
mtd3: 00040000 00010000 &quot;cfg&quot;
mtd4: 00010000 00010000 &quot;EEPROM&quot; </code></pre></div><p>So the NanoBeam uses the same mtd Layout as other AirOS devices, but with the new SoC like the UAP Pro...</p>											<p class="post-edited">(Last edited by <strong>glahue</strong> on 15 Jun 2014, 13:17)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p238114">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">valentt</div>
					<div class="post-datetime">
						26 Jun 2014, 15:03					</div>
				</div>
				<div class="post-content content">
					<p>There is an open ticket here: <a href="https://dev.openwrt.org/ticket/16796">https://dev.openwrt.org/ticket/16796</a></p><p>And there are few devices on Wiki that have AR9342, so support is not impossible to do. What needs to be done?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p239725">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">cmlara</div>
					<div class="post-datetime">
						9 Jul 2014, 10:06					</div>
				</div>
				<div class="post-content content">
					<p>Question: how is the cap retained? Clips or is it glued ? Did you manage to get it open without damaging the case?</p><p>I&#039;ve got my hands on an M5 NanoBeam at the moment that I was looking to pop open (trying not to damage the case if it can be avoided.</p><p>I figure any firmware has to have the right magic bit (XW) to be loaded by the boot loader.</p><p>if these are like the other Ubiquiti devices<br />I belive you could TFTP a kernel image over and run from there for testing, if not should be able to build an image with the XW magic bit to get a starter OS loaded .&nbsp; From there device specific testing (LED gpio&#039;s for one) can be figured and a profile made into kernel and then toolchain.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p240051">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">glahue</div>
					<div class="post-datetime">
						12 Jul 2014, 11:29					</div>
				</div>
				<div class="post-content content">
					<p>Hi,<br /></p><div class="quotebox"><cite>cmlara wrote:</cite><blockquote><p>Question: how is the cap retained? Clips or is it glued ? Did you manage to get it open without damaging the case?</p><p>I&#039;ve got my hands on an M5 NanoBeam at the moment that I was looking to pop open (trying not to damage the case if it can be avoided.</p><p>I figure any firmware has to have the right magic bit (XW) to be loaded by the boot loader.</p><p>if these are like the other Ubiquiti devices<br />I belive you could TFTP a kernel image over and run from there for testing, if not should be able to build an image with the XW magic bit to get a starter OS loaded .&nbsp; From there device specific testing (LED gpio&#039;s for one) can be figured and a profile made into kernel and then toolchain.</p></blockquote></div><p>the cap is glued. If you are very careful you can remove it with a blade without *totally* damaging it, but you might need some extra work to get the parts flat again to be able to glue them together again.<br />As you can see from my post above, the magic bit is not the problem, but the flash layout.<br /></p><div class="quotebox"><cite>valentt wrote:</cite><blockquote><p>There is an open ticket here: <a href="https://dev.openwrt.org/ticket/16796">https://dev.openwrt.org/ticket/16796</a></p><p>And there are few devices on Wiki that have AR9342, so support is not impossible to do. What needs to be done?</p></blockquote></div><p>I know, this ticket is by me ;-)<br />And i also wrote what needs to be done: A new device has to be created in the toolchain with the correct flash layout. Sadly i don´t know where all the bits are that need consideration inside the toolchain.</p><p>Best, Gregor</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p240053">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">cmlara</div>
					<div class="post-datetime">
						12 Jul 2014, 11:57					</div>
				</div>
				<div class="post-content content">
					<p>Thank you for the feedback on the cap.</p><p>As for your question of MTD layout I would start with target/linux/ar71xx/image/Makefile</p><p>This is the file that (to my knowledge) controls the image generations including mtd layouts. Magic bit, binary formatting, and kernel parameter command line rewriting is also in this file.</p><p><a href="https://dev.openwrt.org/browser/trunk/target/linux/ar71xx/image/Makefile">https://dev.openwrt.org/browser/trunk/t … e/Makefile</a></p><p>I still suspect some kernel code will be needed too (I&#039;ve see a file in past but can&#039;t&nbsp; recall where, I will look in the morning, related to the other UBNT devices&nbsp; ).&nbsp; This is partly why the board= parameter is added to the kernel line&nbsp; if I read the code correctly before.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p240064">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">valentt</div>
					<div class="post-datetime">
						12 Jul 2014, 15:39					</div>
				</div>
				<div class="post-content content">
					<p>Ubiquiti has renamed NanoBeam line to PowerBeam line and added few new devices, most powerful model is PBE-5AC-500, radio chip is 801.11ac and antenna is 27dBi.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p240567">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">cmlara</div>
					<div class="post-datetime">
						17 Jul 2014, 19:12					</div>
				</div>
				<div class="post-content content">
					<p><a href="https://www.mail-archive.com/openwrt-devel@lists.openwrt.org/msg24924.html">https://www.mail-archive.com/openwrt-de … 24924.html</a> should be relevant as a starter as well.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p243642">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">vova</div>
					<div class="post-datetime">
						12 Aug 2014, 18:55					</div>
				</div>
				<div class="post-content content">
					<p>Is there any progress?</p><p>I&#039;am able to run openwrt-ar71xx-generic-ubnt-nano-m-xw-initramfs-uImage.bin from today trrunk on nanobeam m2 400 through tftp. </p><p>With default config for network with 2 interfaces I see on my side traffic with 802.1q tags 1 and 2. Switch config seems not work, &quot;switchcfg list&quot; shows nothing. Is there switch on this device or only network card?</p><p>I think mtd layout is the same as in other ubnt, just kernel not separated from rootfs partition.<br />But if I flash openwrt-ar71xx-generic-ubnt-nano-m-xw-squashfs-factory.bin it can&#039;t mount root on 31,8.<br />I notice that in original firmware mtd on ath-nor0, in openwrt trunk for this target it&#039;s spi0. I tried modify mentioned early Makefile to boot from ath-nor0, but no success. </p><p>Unfortunately I have to cut down a cap with a hacksaw and I don&#039;t understand how it can be opened with blade, I think plastic is soldered at the factory.</p>											<p class="post-edited">(Last edited by <strong>vova</strong> on 12 Aug 2014, 18:57)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p243644">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">cmlara</div>
					<div class="post-datetime">
						12 Aug 2014, 19:16					</div>
				</div>
				<div class="post-content content">
					<p>I haven&#039;t had time to test yet,&nbsp; I&#039;ve had a few other items come up first.</p><p>I gave up on trying to open and just went for the dremel.&nbsp; The bottom and top&nbsp; would be the hardest to open (this is where a couple of slip tabs appear to be) as you can&#039;t actually slide all the way under.&nbsp; The sides may have better luck but I went for the dremel. </p><p>If you dremel it straight off (watch your depth I knicked the reflector) if you take it smoothly you can get a good fit back later and just add a bit of sealent if you want to reuse it.</p><p>ath-nor0 vs spi0 shouldn&#039;t matter as I recall its just a name, all the UBNT I have seen use ath-nor0 in the stock UBNT build but the OpenWRT builds call it spi0 instead.</p><p>It is a single port device, I don&#039;t recall seeing a switch module when I opened it (unless its inside the SOC which I doubt) </p><br /><p>The NanoStation is a dual port device so it makes sense it has a switch I don&#039;t expect one on the NanoBeam.</p><p>I&#039;m away from my device for the week so I can&#039;t look until Saturday but I suspect it would only be small tweaks to the patch already sent.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p243734">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">vova</div>
					<div class="post-datetime">
						13 Aug 2014, 15:00					</div>
				</div>
				<div class="post-content content">
					<p>With spi0 it finally works, but rootfs not on 31:8, I temporarly modified /target/linux/ar71xx/generic/config-default for root=31:04 and it&#039;s work.</p><p>Wifi works too, but I need tagged traffic through wlan0. <br />I tried&nbsp; it with ip link and vconfig:</p><p>vconfig add wlan0 97<br />OR<br />ip link add link wlan0 wlan0.97 type vlan proto 802.1q id 97</p><p>ifconfig wlan0.97 up<br />brctl addif br-lan3 wlan0.97</p><p>AP not see tagged Client traffic<br />24:A4:3C:FA:80:31 - Client<br />24:a4:3c:fb:80:3e - AP</p><p>Client sends ARP (tcpdump -n -i wlan0):<br />06:10:58.046528 24:a4:3c:fb:80:31 &gt; ff:ff:ff:ff:ff:ff, ethertype 802.1Q (0x8100), length 46: vlan 97, p 0, ethertype ARP, Request who-has 192.168.2.1 tell 192.168.2.2, length 28<br />But AP not see it, rx counter on wlan0 not increased, tcpdump not see anything, firewall disabled.</p><p>But Client sees AP tagged traffic:<br />12:57:01.536914 24:a4:3c:fb:80:3e &gt; ff:ff:ff:ff:ff:ff, ethertype 802.1Q (0x8100), length 46: vlan 97, p 0, ethertype ARP, Request who-has 192.168.2.2 tell 192.168.2.1, length 28<br />12:57:01.537044 24:a4:3c:fb:80:31 &gt; 24:a4:3c:fb:80:3e, ethertype 802.1Q (0x8100), length 46: vlan 97, p 0, ethertype ARP, Reply 192.168.2.2 is-at 24:a4:3c:fb:80:31, length 28</p><p>What&#039;s wrong?</p>											<p class="post-edited">(Last edited by <strong>vova</strong> on 13 Aug 2014, 19:19)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p245118">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">cmlara</div>
					<div class="post-datetime">
						28 Aug 2014, 01:43					</div>
				</div>
				<div class="post-content content">
					<p>I didn&#039;t need to add any root= parameter to get the unit to boot (using the trunk and RC3 image) but I do not have an Ethernet interface (AR8035 type) on the node.</p><p>Did you have to do any modifications to bring the eth0 into existence?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p245265">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">vova</div>
					<div class="post-datetime">
						29 Aug 2014, 07:50					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>cmlara wrote:</cite><blockquote><p>I didn&#039;t need to add any root= parameter to get the unit to boot (using the trunk and RC3 image) but I do not have an Ethernet interface (AR8035 type) on the node.</p><p>Did you have to do any modifications to bring the eth0 into existence?</p></blockquote></div><p>No. If needed I can give dmesg output. I gave NanoBeam M2-400, not M5. In M5 - gigabit ethernet, in M2 - 100mbit.<br />But I really stuck with vlan passthrough <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p245267">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">cmlara</div>
					<div class="post-datetime">
						29 Aug 2014, 08:16					</div>
				</div>
				<div class="post-content content">
					<p>Ok thank makes sense. I am fighting gigabit driver support as an additional since I have an M5.</p><p>Now I know where to go on that.</p><p>I really don&#039;t know much on VLAN over WIFI.... The limited knowledge I find by google seems to imply that vlan tagging over. 802.11 isn&#039;t doable (2008) and that you have to broadcast multiple SSID.</p> <br /><p>I really don&#039;t know enough in that area however to be informative other than to ask does this work on another ath9k device ? (Like a bullet m2 or something)</p><p>Reference Material:</p><p>IEEE:<br /><a href="https://mentor.ieee.org/802.11/dcn/07/11-07-2161-01-0wng-segregated-data-services-in-802-11.ppt">https://mentor.ieee.org/802.11/dcn/07/1 … 802-11.ppt</a></p><p>Cisco:<br /><a href="http://www.cisco.com/c/en/us/td/docs/wireless/access_point/1300/12-3_7_JA/configuration/guide/brsc1237/b37vlan.pdf">http://www.cisco.com/c/en/us/td/docs/wi … 37vlan.pdf</a></p><p>OpenWrt Forum<br /><a href="https://forum.openwrt.org/viewtopic.php?id=33248">https://forum.openwrt.org/viewtopic.php?id=33248</a><br /><a href="https://forum.openwrt.org/viewtopic.php?id=33225">https://forum.openwrt.org/viewtopic.php?id=33225</a></p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>