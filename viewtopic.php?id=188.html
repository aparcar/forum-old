<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> WBR G54 + Firstboot Problem</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 29 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p884">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">Genoa</div>
					<div class="post-datetime">
						27 Jun 2004, 23:44					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>I try to run <strong>OpenWrt</strong> on <strong>Buffalo WBRG54</strong>.<br />i successfully flashed the ap but <strong>i can&#039;t create the jffs filesystem</strong>.<br />When i run <span class="bbu">/bin/firstboot</span>,&nbsp; nothing occurs.</p><p>I suspect an mtd/partition problem.<br />I use CVS version of OpenWrt.<br />I try Sweasoft Firmware, it works normaly.</p><p><span class="bbu">Here is my dmesg logs :</span><br /></p><div class="quotebox"><blockquote><p>@(none):/# <br />@(none):/# /bin/firstboot<br />Erasing OpenWrt<br />@(none):/#</p></blockquote></div><br /><div class="quotebox"><blockquote><p>@(none):/# dmesg <br />scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00070004: 0x9c79 instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00070008: 0x9305 instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x0007000c: 0xb6f4 instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00070010: 0xad6e instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00070014: 0x6190 instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00070018: 0x27c0 instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x0007001c: 0xb649 instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00070020: 0x3ca2 instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00070024: 0xb3d7 instead<br />Further such events for this erase block will not be printed<br />Old JFFS2 bitmask found at 0x000791a8<br />You cannot use older JFFS2 filesystems with newer kernels<br />JFFS2: Erase block at 0x00070000 is not formatted. It will be erased<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00080000: 0xdf0f instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00080004: 0x8857 instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00080008: 0xc1f6 instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x0008000c: 0x8037 instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00080010: 0xe563 instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00080014: 0x7987 instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00080018: 0xe5ea instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x0008001c: 0x7b9f instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00080020: 0xffa8 instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00080024: 0xc0b7 instead<br />Further such events for this erase block will not be printed<br />JFFS2: Erase block at 0x00080000 is not formatted. It will be erased<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00090000: 0x87ae instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00090004: 0xda51 instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00090008: 0x9a39 instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x0009000c: 0xe260 instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00090010: 0x7bb7 instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00090014: 0xe489 instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00090018: 0x53df instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x0009001c: 0x39de instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00090020: 0x6575 instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00090024: 0x3a39 instead<br />Further such events for this erase block will not be printed<br />JFFS2: Erase block at 0x00090000 is not formatted. It will be erased<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x000a0000: 0xc507 instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x000a0004: 0xcfaa instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x000a0008: 0xf4a7 instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x000a000c: 0xb07f instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x000a0010: 0x488f instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x000a0014: 0x3bad instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x000a0018: 0xbb68 instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x000a001c: 0x251b instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x000a0020: 0xdc41 instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x000a0024: 0x1eef instead<br />Further such events for this erase block will not be printed<br />JFFS2: Erase block at 0x000a0000 is not formatted. It will be erased<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x000b0000: 0xa648 instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x000b0004: 0xd5d5 instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x000b0008: 0x1ce9 instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x000b000c: 0x2169 instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x000b0010: 0xf363 instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x000b0014: 0x18e6 instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x000b0018: 0x2651 instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x000b001c: 0xfa3d instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x000b0020: 0x9a2f instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x000b0024: 0x6a67 instead<br />Further such events for this erase block will not be printed<br />JFFS2: Erase block at 0x000b0000 is not formatted. It will be erased<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x000c0000: 0x8566 instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x000c0004: 0x4285 instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x000c0008: 0x2983 instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x000c000c: 0x3fc0 instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x000c0010: 0xe59a instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x000c0014: 0x60ff instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x000c0018: 0x287b instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x000c001c: 0xc83d instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x000c0020: 0x9cb0 instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x000c0024: 0x188d instead<br />Further such events for this erase block will not be printed<br />JFFS2: Erase block at 0x000c0000 is not formatted. It will be erased<br />Cowardly refusing to erase blocks on filesystem with no valid JFFS2 nodes<br />VFS: Mounted root (squashfs filesystem) readonly.<br />Mounted devfs on /dev<br />Freeing unused kernel memory: 68k freed<br />Warning: unable to open an initial console.<br />Algorithmics/MIPS FPU Emulator v1.5<br />eth0: Broadcom BCM47xx 10/100 Mbps Ethernet Controller 3.50.21.10<br />eth1: Broadcom BCM47xx 10/100 Mbps Ethernet Controller 3.50.21.10<br />PCI: Enabling device 01:01.0 (0004 -&gt; 0006)<br />eth2: Broadcom BCM43XX 802.11 Wireless Controller&nbsp; 3.50.21.10 (Compiled in . at 20:53:00 on Jan 21 2004)<br />device eth0 entered promiscuous mode<br />device eth2 entered promiscuous mode<br />br0: port 2(eth2) entering learning state<br />br0: port 1(eth0) entering learning state<br />br0: port 2(eth2) entering forwarding state<br />br0: topology change detected, propagating<br />br0: port 1(eth0) entering forwarding state<br />br0: topology change detected, propagating<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00228000: 0x4c46 instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00228004: 0x3184 instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00228008: 0x01eb instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00228014: 0x6e69 instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00228018: 0x656e instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x0022801c: 0x7361 instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00228020: 0x3532 instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00228024: 0x3532 instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00228028: 0x3532 instead<br />jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x0022802c: 0x0030 instead<br />Further such events for this erase block will not be printed<br />JFFS2: Erase block at 0x00220000 is not formatted. It will be erased<br />Cowardly refusing to erase blocks on filesystem with no valid JFFS2 nodes<br />@(none):/#</p></blockquote></div><p>Thanks,<br />Genoa</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p895">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">mbm</div>
					<div class="post-datetime">
						28 Jun 2004, 17:54					</div>
				</div>
				<div class="post-content content">
					<p>Check what the following output is:</p><div class="codebox"><pre><code>mtd unlock OpenWrt
mtd erase OpenWrt
mount -t jffs2 /dev/mtdblock/4 /jffs</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p898">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">Genoa</div>
					<div class="post-datetime">
						28 Jun 2004, 19:36					</div>
				</div>
				<div class="post-content content">
					<p>Here is a result of the cmd :</p><p>@(none)# mtd unlock OpenWrt<br />Unlocking OpenWrt<br />OpenWrt: No such file or directory</p><p>@(none)# mount -t jffs2 /dev/mtdblock/4 /jffs<br />mount: Mounting /dev/mtdblock/4 on /jffs failed: Invalid argument</p><p>Any clue???<br />Genoa</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p933">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">Genoa</div>
					<div class="post-datetime">
						30 Jun 2004, 22:52					</div>
				</div>
				<div class="post-content content">
					<p>Finaly i <strong>solved problem</strong> with my WBR-G54.</p><p>I just changed the <strong>kernel_args</strong> :</p><p>from :<br /></p><div class="codebox"><pre><code>kernel_args=noinitrd console=ttyS0,115200 root=/dev/mtdblock2 panic=1</code></pre></div><p>to:<br /></p><div class="codebox"><pre><code>kernel_args=root=/dev/mtdblock2 rootfstype=squashfs init=/etc/preinit noinitrd console=ttyS0,115200 panic=1</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p5382">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">trigger</div>
					<div class="post-datetime">
						17 Mar 2005, 13:10					</div>
				</div>
				<div class="post-content content">
					<p>I just had exactly the same problem, thanks a lot for the info! Also to help out any super n00bs (like myself), to change the kernel_args, you just need to change the setting in nvram like this:</p><div class="codebox"><pre><code>nvram set kernel_args=&quot;root=/dev/mtdblock2 rootfstype=squashfs init=/etc/preinit noinitrd console=ttyS0,115200 panic=1&quot;</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p9293">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">pervert</div>
					<div class="post-datetime">
						10 Jul 2005, 20:52					</div>
				</div>
				<div class="post-content content">
					<p>Thanks a lot, this helped me too. For us super-newbies, don&#039;t forget to <strong>nvram commit</strong> and reboot as well... <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p><p>The only other problem I encountered with my WBR-G54 was that wlconf isn&#039;t there anymore. I suppose this is documented somewhere, but after the wl0_* variables are set, <strong>wifi eth2 down &amp;&amp; wifi eth2 up</strong> does the trick. Remember to enter wl0_key1 in hex (search google for a calculator if necessary). iwconfig behaved somewhat strangely, iwconfig eth2 enc s:key (passing key in ASCII) didn&#039;t seem to be acceptable.</p><p>Windows 2000&#039;s tftp command was enough to pass the TRX image to the AP. After plugging power, wait half a sec so that the diag led turns off before hitting enter on the put command. I used openwrt-brcm-2.4-squashfs.trx since White Russian&#039;s readme file recommends squashfs.</p><p>Should I be bold enough to update the Wiki page? <a href="http://openwrt.org/OpenWrtDocs/Hardware/Buffalo/WBR-G54">http://openwrt.org/OpenWrtDocs/Hardware/Buffalo/WBR-G54</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p9302">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">mbm</div>
					<div class="post-datetime">
						11 Jul 2005, 01:26					</div>
				</div>
				<div class="post-content content">
					<p>There really shouldn&#039;t be any need to set kernel_args since the defaults are compiled into the kernel. If you set kernel_args and we change them then it&#039;ll just use the old value from kernel_args, which is perhaps the problem in the first place.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p9310">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">pervert</div>
					<div class="post-datetime">
						11 Jul 2005, 13:47					</div>
				</div>
				<div class="post-content content">
					<p>mbm, not sure what you mean. After I had done the tftp transfer and some waiting, I logged on to the WBR-G54 and the log resembled Genoa&#039;s quite closely. Nothing seemed to be mounted and even /proc was at least partially missing. After setting the kernel parameters above, remembering to &#039;nvram commit&#039; and rebooting the WBR-G54 was fine.</p><p>Just now, White Russian seems to have segfaulted. I was doing a backup via the WLAN interface and simultaneously downloading w2ksp4 on the LAN. The transfers are still on, but trying to log on to the device will result in multiple &#039;Aiee, segfault, perhaps you should report this to a developer&#039; error messages. Unsure on how to report the exact problem though - I have ample time during the following few days and can gladly help in debugging, if necessary. I&#039;ve got two WBR-G54&#039;s over here.</p><p>(After a bit of waiting while writing this post, the problem seems to have disappeared. The following SSH login still yielded a &#039;segmentation fault&#039; message, but now everything seems to work fine again. Nothing about the incident in the log, and all processes seem to be running fine. Uptime normal.)</p>											<p class="post-edited">(Last edited by <strong>pervert</strong> on 11 Jul 2005, 13:49)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>