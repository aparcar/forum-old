<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> LuCI &quot;Flash Firmware&quot; doesn&#039;t work (Chaos Calmer 0.2.0, r46120)</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 6 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p287537">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">CSTaylorJr</div>
					<div class="post-datetime">
						14 Aug 2015, 04:22					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ve been trying to get the LuCI flash firmware function to work for the last two weeks, and I&#039;m stumped.</p><p>I can go into the LuCI &quot;Flash Firmware&quot; menu, and upload the image.&nbsp; Through a serial terminal, I can see the file is uploaded to /tmp/firmware.img.&nbsp; However, when I click on the &quot;proceed&quot; button, the system reboots, but doesn&#039;t flash the firmware (see below for the boot messages).</p><p>I thought maybe I was out of memory or something, but here&#039;s the thing--if I go to /tmp through the serial terminal, and type the following on the command line:</p><p>&nbsp; &nbsp; &nbsp; &nbsp;sysupgrade -v -n firmware.img</p><p>...the system flashes the image!&nbsp; That means that the image is fine, the download is working, and the ability to do flash update is there...</p><p>...so is there a bug in LuCI &quot;Flash Firmware?&quot;</p><p>I&#039;d appreciate any suggestions from the experts out there!</p><p>Here&#039;s the console output when I try to flash the firmware with LuCI (unsuccessfully)--</p><p>root@Alignarray:/# br-lan: port 1(eth0.1) entered disabled state<br />device eth0.1 left promiscuous mode<br />device eth0 left promiscuous mode<br />br-lan: port 1(eth0.1) entered disabled state<br />reboot: Restarting system</p><br /><p>U-Boot 1.1.3 (Nov 12 2012 - 20:10:03)</p><p>Board: Ralink APSoC DRAM:&nbsp; 32 MB<br />relocate_code Pointer at: 81fb4000<br />******************************<br />Software System Reset Occurred<br />******************************<br />spi_wait_nsec: 42<br />spi device id: c2 20 16 c2 20 (2016c220)<br />find flash: MX25L3205D<br />raspi_read: from:30000 len:1000<br />.raspi_read: from:30000 len:1000<br />.============================================<br />Ralink UBoot Version: 4.1.0.0<br />--------------------------------------------<br />ASIC 5350_MP (Port5&lt;-&gt;None)<br />DRAM_CONF_FROM: Boot-Strapping<br />DRAM_TYPE: SDRAM<br />DRAM_SIZE: 256 Mbits<br />DRAM_WIDTH: 16 bits<br />DRAM_TOTAL_WIDTH: 16 bits<br />TOTAL_MEMORY_SIZE: 32 MBytes<br />Flash component: SPI Flash<br />Date:Nov 12 2012&nbsp; Time:20:10:03<br />============================================<br />icache: sets:256, ways:4, linesz:32 ,total:32768<br />dcache: sets:128, ways:4, linesz:32 ,total:16384</p><p> ##### The CPU freq = 360 MHZ ####<br /> estimate memory size =32 Mbytes</p><p>Please choose the operation:<br />&nbsp; &nbsp;1: Load system code to SDRAM via TFTP.<br />&nbsp; &nbsp;2: Load system code then write to Flash via TFTP.<br />&nbsp; &nbsp;3: Boot system code via Flash (default).<br />&nbsp; &nbsp;4: Entr boot command line interface.<br />&nbsp; &nbsp;7: Load Boot Loader code then write to Flash via Serial.<br />&nbsp; &nbsp;9: Load Boot Loader code then write to Flash via TFTP.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</p><p>3: System Boot system code via Flash.<br />## Booting image at bc050000 ...<br />raspi_read: from:50000 len:40<br />.&nbsp; &nbsp;Image Name:&nbsp; &nbsp;MIPS OpenWrt Linux-3.18.16<br />&nbsp; &nbsp;Image Type:&nbsp; &nbsp;MIPS Linux Kernel Image (lzma compressed)<br />&nbsp; &nbsp;Data Size:&nbsp; &nbsp; 894392 Bytes = 873.4 kB<br />&nbsp; &nbsp;Load Address: 80000000<br />&nbsp; &nbsp;Entry Point:&nbsp; 80000000<br />raspi_read: from:50040 len:da5b8<br />..............&nbsp; &nbsp;Verifying Checksum ... OK<br />&nbsp; &nbsp;Uncompressing Kernel Image ... OK<br />No initrd<br />## Transferring control to Linux (at address 80000000) ...<br />## Giving linux memsize in MB, 32</p><p>Starting kernel ...</p><p>Linux version 3.18.16 (taylorc@buildbot) (gcc version 4.8.3 (OpenWrt/Linaro GCC 4.8-2014.04 r46120) ) #52 Thu Aug 13 17:22:49 PDT 2015<br />SoC Type: Ralink RT5350 id:1 rev:3<br />bootconsole [early0] enabled<br />CPU0 revision is: 0001964c (MIPS 24KEc)<br />MIPS: machine is AsiaRF AWM002 EVB<br />Determined physical RAM map:<br /> memory: 02000000 @ 00000000 (usable)<br />Initrd not found or empty - disabling initrd<br />Zone ranges:<br />&nbsp; Normal&nbsp; &nbsp;[mem 0x00000000-0x01ffffff]<br />Movable zone start for each node<br />Early memory node ranges<br />&nbsp; node&nbsp; &nbsp;0: [mem 0x00000000-0x01ffffff]<br />Initmem setup node 0 [mem 0x00000000-0x01ffffff]<br />Primary instruction cache 32kB, VIPT, 4-way, linesize 32 bytes.<br />Primary data cache 16kB, 4-way, VIPT, no aliases, linesize 32 bytes<br />Built 1 zonelists in Zone order, mobility grouping on.&nbsp; Total pages: 8128<br />Kernel command line: console=ttyS0,57600 rootfstype=squashfs,jffs2<br />PID hash table entries: 128 (order: -3, 512 bytes)<br />Dentry cache hash table entries: 4096 (order: 2, 16384 bytes)<br />Inode-cache hash table entries: 2048 (order: 1, 8192 bytes)<br />Writing ErrCtl register=00079340<br />Readback ErrCtl register=00079340<br />Memory: 29548K/32768K available (2177K kernel code, 117K rwdata, 204K rodata, 180K init, 177K bss, 3220K reserved)<br />SLUB: HWalign=32, Order=0-3, MinObjects=0, CPUs=1, Nodes=1<br />NR_IRQS:256<br />CPU Clock: 360MHz<br />systick: running - mult: 214748, shift: 32<br />Calibrating delay loop... 239.61 BogoMIPS (lpj=1198080)<br />pid_max: default: 32768 minimum: 301<br />Mount-cache hash table entries: 1024 (order: 0, 4096 bytes)<br />Mountpoint-cache hash table entries: 1024 (order: 0, 4096 bytes)<br />pinctrl core: initialized pinctrl subsystem<br />NET: Registered protocol family 16<br />rt2880_gpio 10000600.gpio: registering 22 gpios<br />rt2880_gpio 10000600.gpio: registering 22 irq handlers<br />Switched to clocksource systick<br />NET: Registered protocol family 2<br />TCP established hash table entries: 1024 (order: 0, 4096 bytes)<br />TCP bind hash table entries: 1024 (order: 0, 4096 bytes)<br />TCP: Hash tables configured (established 1024 bind 1024)<br />TCP: reno registered<br />UDP hash table entries: 256 (order: 0, 4096 bytes)<br />UDP-Lite hash table entries: 256 (order: 0, 4096 bytes)<br />NET: Registered protocol family 1<br />rt-timer 10000100.timer: maximum frequency is 7324Hz<br />futex hash table entries: 256 (order: -1, 3072 bytes)<br />squashfs: version 4.0 (2009/01/31) Phillip Lougher<br />jffs2: version 2.2 (NAND) (SUMMARY) (LZMA) (RTIME) (CMODE_PRIORITY) (c) 2001-2006 Red Hat, Inc.<br />msgmni has been set to 57<br />io scheduler noop registered<br />io scheduler deadline registered (default)<br />drivers/phy/phy-ralink-usb.c:ralink_usb_phy_probe[147]<br />drivers/phy/phy-ralink-usb.c:ralink_usb_phy_probe[161]<br />Serial: 8250/16550 driver, 2 ports, IRQ sharing disabled<br />console [ttyS0] disabled<br />10000c00.uartlite: ttyS0 at MMIO 0x10000c00 (irq = 20, base_baud = 2500000) is a 16550A<br />console [ttyS0] enabled<br />console [ttyS0] enabled<br />bootconsole [early0] disabled<br />bootconsole [early0] disabled<br />m25p80 spi32766.0: mx25l3205d (4096 Kbytes)<br />4 ofpart partitions found on MTD device spi32766.0<br />Creating 4 MTD partitions on &quot;spi32766.0&quot;:<br />0x000000000000-0x000000030000 : &quot;u-boot&quot;<br />0x000000030000-0x000000040000 : &quot;u-boot-env&quot;<br />0x000000040000-0x000000050000 : &quot;factory&quot;<br />0x000000050000-0x000002000000 : &quot;firmware&quot;<br />mtd: partition &quot;firmware&quot; extends beyond the end of device &quot;spi32766.0&quot; -- size truncated to 0x3b0000<br />2 uimage-fw partitions found on MTD device firmware<br />0x000000050000-0x00000012a5f8 : &quot;kernel&quot;<br />0x00000012a5f8-0x000000400000 : &quot;rootfs&quot;<br />mtd: device 5 (rootfs) set to be root filesystem<br />1 squashfs-split partitions found on MTD device rootfs<br />0x0000003a0000-0x000000400000 : &quot;rootfs_data&quot;<br />ralink_soc_eth 10100000.ethernet eth0: ralink at 0xb0100000, irq 5<br />rt2880_wdt 10000120.watchdog: Initialized<br />TCP: cubic registered<br />NET: Registered protocol family 17<br />bridge: automatic filtering via arp/ip/ip6tables has been deprecated. Update your scripts to load br_netfilter if you need this.<br />8021q: 802.1Q VLAN Support v1.8<br />VFS: Mounted root (squashfs filesystem) readonly on device 31:5.<br />Freeing unused kernel memory: 180K (80273000 - 802a0000)<br />init: Console is alive<br />init: - watchdog -<br />init: - preinit -<br />rt305x-esw 10110000.esw: link changed 0x00<br />random: procd urandom read with 10 bits of entropy available<br />Press the [f] key and hit [enter] to enter failsafe mode<br />Press the [1], [2], [3] or [4] key and hit [enter] to select the debug level<br />rt305x-esw 10110000.esw: link changed 0x02<br />jffs2: notice: (274) jffs2_build_xattr_subsystem: complete building xattr subsystem, 0 of xdatum (0 unchecked, 0 orphan) and 0 of xref (0 dead, 0 orphan) found.<br />mount_root: switching to jffs2 overlay<br />procd: - early -<br />procd: - watchdog -<br />procd: - ubus -<br />procd: - init -<br />Please press Enter to activate this console.<br />nf_conntrack version 0.5.0 (464 buckets, 1856 max)<br />xt_time: kernel timezone is -0000<br />ip_tables: (C) 2000-2006 Netfilter Core Team<br />rt305x-esw 10110000.esw: link changed 0x00<br />device eth0.1 entered promiscuous mode<br />device eth0 entered promiscuous mode<br />br-lan: port 1(eth0.1) entered forwarding state<br />br-lan: port 1(eth0.1) entered forwarding state<br />rt305x-esw 10110000.esw: link changed 0x02<br />br-lan: port 1(eth0.1) entered forwarding state<br />random: nonblocking pool is initialized</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>