<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Firewall issue with OpenVPN</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 7 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p252675">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">jeffboyce</div>
					<div class="post-datetime">
						31 Oct 2014, 21:20					</div>
				</div>
				<div class="post-content content">
					<p>Greetings -</p><p>I am having an issue connecting to the OpenVPN server running on my OpenWRT router.&nbsp; I posted some information here about this problem back in May, and am finally getting back to looking at it again.&nbsp; A connection attempt from a remote client (Win Vista) ends with the following line in the client log file.&nbsp; There is nothing in the server log files from these failed connections; neither in messages or the openvpn.log file.</p><p>read UDPv4: Connection reset by peer (WSAECONNRESET) (code=10054)</p><p>I have probably read 50+ google search results regarding this issue, and have corresponded with the OpenVPN community.&nbsp; The conclusion is that 90+ percent of the time a failed connection with this message is a result of a misconfigured firewall on the server side.&nbsp; I have followed many dead ends and wild goose chases looking at the other 10 percent of the possibilities without any solution to my problem.&nbsp; So I am coming back here to request the assistance of an expert.</p><p>I am not new to OpenVPN, having setup OpenVPN on my office CentOS server with a dozen client configs.&nbsp; The server and client configs I am using in this instance are very similar to the ones I am using for my office configuration; and based on the connection error message the configs do not appear to be a problem.&nbsp; However, I an not as experienced in working with firewall rules, and especially OpenWRT&#039;s expression of those rules.&nbsp; I would like someone that knows a thing or two about firewalls to review my configuration and tell me what stupid mistake I have made, or identify some additional debugging that I could do to get some additional information.</p><p>I have read and followed the guides in the OpenWRT wiki for setting up OpenVPN and the firewall, and have recently double checked it; so I think I have everything configured properly.&nbsp; But something must be wrong if I am unable to connect.&nbsp; Below is the current firewall configuration that leads to the failed connection attempt error listed above.&nbsp; I have sanitized it so as not to post my public IP information.&nbsp; I could also post a sanitized iptables list from the command line (or any other network or configuration information) if necessary.&nbsp; Thanks for the assistance any experts can provide.</p><p>Jeff</p><br /><p>/etc/config/firewall<br />config rule<br />&nbsp; &nbsp; option name &#039;Allow-DHCP-Renew&#039;<br />&nbsp; &nbsp; option proto &#039;udp&#039;<br />&nbsp; &nbsp; option dest_port &#039;68&#039;<br />&nbsp; &nbsp; option target &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option family &#039;ipv4&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;</p><p>config rule<br />&nbsp; &nbsp; option name &#039;Allow-Ping&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option proto &#039;icmp&#039;<br />&nbsp; &nbsp; option icmp_type &#039;echo-request&#039;<br />&nbsp; &nbsp; option family &#039;ipv4&#039;<br />&nbsp; &nbsp; option target &#039;ACCEPT&#039;</p><p>config rule<br />&nbsp; &nbsp; option name &#039;Allow-DHCPv6&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option proto &#039;udp&#039;<br />&nbsp; &nbsp; option src_ip &#039;fe80::/10&#039;<br />&nbsp; &nbsp; option src_port &#039;547&#039;<br />&nbsp; &nbsp; option dest_ip &#039;fe80::/10&#039;<br />&nbsp; &nbsp; option dest_port &#039;546&#039;<br />&nbsp; &nbsp; option family &#039;ipv6&#039;<br />&nbsp; &nbsp; option target &#039;ACCEPT&#039;</p><p>config rule<br />&nbsp; &nbsp; option name &#039;Allow-ICMPv6-Input&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option proto &#039;icmp&#039;<br />&nbsp; &nbsp; list icmp_type &#039;echo-request&#039;<br />&nbsp; &nbsp; list icmp_type &#039;echo-reply&#039;<br />&nbsp; &nbsp; list icmp_type &#039;destination-unreachable&#039;<br />&nbsp; &nbsp; list icmp_type &#039;packet-too-big&#039;<br />&nbsp; &nbsp; list icmp_type &#039;time-exceeded&#039;<br />&nbsp; &nbsp; list icmp_type &#039;bad-header&#039;<br />&nbsp; &nbsp; list icmp_type &#039;unknown-header-type&#039;<br />&nbsp; &nbsp; list icmp_type &#039;router-solicitation&#039;<br />&nbsp; &nbsp; list icmp_type &#039;neighbour-solicitation&#039;<br />&nbsp; &nbsp; list icmp_type &#039;router-advertisement&#039;<br />&nbsp; &nbsp; list icmp_type &#039;neighbour-advertisement&#039;<br />&nbsp; &nbsp; option limit &#039;1000/sec&#039;<br />&nbsp; &nbsp; option family &#039;ipv6&#039;<br />&nbsp; &nbsp; option target &#039;ACCEPT&#039;</p><p>config rule<br />&nbsp; &nbsp; option name &#039;Allow-ICMPv6-Forward&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option dest &#039;*&#039;<br />&nbsp; &nbsp; option proto &#039;icmp&#039;<br />&nbsp; &nbsp; list icmp_type &#039;echo-request&#039;<br />&nbsp; &nbsp; list icmp_type &#039;echo-reply&#039;<br />&nbsp; &nbsp; list icmp_type &#039;destination-unreachable&#039;<br />&nbsp; &nbsp; list icmp_type &#039;packet-too-big&#039;<br />&nbsp; &nbsp; list icmp_type &#039;time-exceeded&#039;<br />&nbsp; &nbsp; list icmp_type &#039;bad-header&#039;<br />&nbsp; &nbsp; list icmp_type &#039;unknown-header-type&#039;<br />&nbsp; &nbsp; option limit &#039;1000/sec&#039;<br />&nbsp; &nbsp; option family &#039;ipv6&#039;<br />&nbsp; &nbsp; option target &#039;ACCEPT&#039;</p><p>config rule<br />&nbsp; &nbsp; option name &#039;Allow inbound OpenVPN&#039;<br />&nbsp; &nbsp; option family &#039;ipv4&#039;<br />&nbsp; &nbsp; option target &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option proto &#039;udp&#039;<br />&nbsp; &nbsp; option dest_port &#039;1194&#039;</p><p>config rule<br />&nbsp; &nbsp; option name &#039;Allow ssh from WAN (work IP address)&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option proto &#039;tcp&#039;<br />&nbsp; &nbsp; option src_ip &#039;&lt;workIP&gt;&#039;<br />&nbsp; &nbsp; option dest_port &#039;22&#039;<br />&nbsp; &nbsp; option target &#039;ACCEPT&#039;</p><p>config rule<br />&nbsp; &nbsp; option name &#039;Allow SSH from Phone MAC&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option proto &#039;tcp&#039;<br />&nbsp; &nbsp; option src_mac &#039;&lt;phoneMAC&gt;&#039;<br />&nbsp; &nbsp; option dest_port &#039;22&#039;<br />&nbsp; &nbsp; option target &#039;ACCEPT&#039;</p><p>config rule<br />&nbsp; &nbsp; option name &#039;Reject all other input to Port 22&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option proto &#039;tcp&#039;<br />&nbsp; &nbsp; option dest_port &#039;22&#039;<br />&nbsp; &nbsp; option target &#039;REJECT&#039;</p><p>config rule<br />&nbsp; &nbsp; option name &#039;Allow Luci from WAN (work IP address)&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option proto &#039;tcp&#039;<br />&nbsp; &nbsp; option src_ip &#039;&lt;workIP&gt;&#039;<br />&nbsp; &nbsp; option dest_port &#039;80&#039;<br />&nbsp; &nbsp; option target &#039;ACCEPT&#039;</p><p>config rule<br />&nbsp; &nbsp; option name &#039;Allow Luci from Phone MAC&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option proto &#039;tcp&#039;<br />&nbsp; &nbsp; option src_mac &#039;&lt;phoneMAC&gt;&#039;<br />&nbsp; &nbsp; option dest_port &#039;80&#039;<br />&nbsp; &nbsp; option target &#039;ACCEPT&#039;</p><p>config defaults<br />&nbsp; &nbsp; option syn_flood &#039;1&#039;<br />&nbsp; &nbsp; option input &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option output &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option forward &#039;REJECT&#039;</p><p>config zone<br />&nbsp; &nbsp; option name &#039;lan&#039;<br />&nbsp; &nbsp; option network &#039;lan&#039;<br />&nbsp; &nbsp; option input &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option output &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option forward &#039;REJECT&#039;</p><p>config zone<br />&nbsp; &nbsp; option name &#039;vpn&#039;<br />&nbsp; &nbsp; option network &#039;vpn&#039;<br />&nbsp; &nbsp; option input &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option output &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option forward &#039;REJECT&#039;</p><p>config zone<br />&nbsp; &nbsp; option name &#039;wan&#039;<br />&nbsp; &nbsp; option network &#039;wan&#039;<br />&nbsp; &nbsp; option output &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option masq &#039;1&#039;<br />&nbsp; &nbsp; option mtu_fix &#039;1&#039;<br />&nbsp; &nbsp; option input &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option forward &#039;REJECT&#039;</p><p>config forwarding<br />&nbsp; &nbsp; option src &#039;lan&#039;<br />&nbsp; &nbsp; option dest &#039;wan&#039;</p><p>config include<br />&nbsp; &nbsp; option path &#039;/etc/firewall.user&#039;</p><p>config forwarding<br />&nbsp; &nbsp; option dest &#039;lan&#039;<br />&nbsp; &nbsp; option src &#039;vpn&#039;</p><p>config forwarding<br />&nbsp; &nbsp; option dest &#039;wan&#039;<br />&nbsp; &nbsp; option src &#039;vpn&#039;</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p252681">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">dem</div>
					<div class="post-datetime">
						31 Oct 2014, 21:42					</div>
				</div>
				<div class="post-content content">
					<p>Here is an example of the firewall rules I use for port redirection to Internal LAN services<br />https redirection :</p><p>config redirect<br />&nbsp; &nbsp; &nbsp; &nbsp; option src wan<br />&nbsp; &nbsp; &nbsp; &nbsp; option src_dport 443<br />&nbsp; &nbsp; &nbsp; &nbsp; option dest lan<br />&nbsp; &nbsp; &nbsp; &nbsp; option dest_ip 192.168.25.2<br />&nbsp; &nbsp; &nbsp; &nbsp; option dest_port 443<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto tcp</p><br /><p>make sure you restart your firewall with &quot;/etc/init.d/firewall restart&quot; after altering rules</p><p>Before messing about with any OpenVPN configuration first confirm your firewall port redirection and NAT are working correctly by using a nmap port scan of UDP port 1194 on a remote computer.&nbsp; Nmap should confirm UDP port 1194 open if it&#039;s working correctly.</p><p>Also I don&#039;t see how your MAC based firewall rules are going to work eg :<br />config rule<br />&nbsp; &nbsp; option name &#039;Allow SSH from Phone MAC&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option proto &#039;tcp&#039;<br />&nbsp; &nbsp; option src_mac &#039;&lt;phoneMAC&gt;&#039;<br />&nbsp; &nbsp; option dest_port &#039;22&#039;<br />&nbsp; &nbsp; option target &#039;ACCEPT&#039;</p><p>A MAC is a physical address and the router firewall will only be able to see this MAC address if you phone is connected to a LAN that your router&#039;s external WAN device is connected to.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p252682">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">nebbia88</div>
					<div class="post-datetime">
						31 Oct 2014, 22:06					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>dem wrote:</cite><blockquote><p>Before messing about with any OpenVPN configuration first confirm your firewall port redirection and NAT are working correctly by using a nmap port scan of UDP port 1194 on a remote computer.&nbsp; Nmap should confirm UDP port 1194 open if it&#039;s working correctly.</p></blockquote></div><p>I guess he has openvpn on the router itself, not on a lan host, so no redirection needed, just an &quot;accept&quot;.</p><p>@jeff your config seems fine to me.</p><p>can you post output of </p><p>iptables -L</p><p>?</p><p>maybe on pastebin since it&#039;s huge..</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p252691">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">jeffboyce</div>
					<div class="post-datetime">
						31 Oct 2014, 23:57					</div>
				</div>
				<div class="post-content content">
					<p>@nebbia88&nbsp; -&nbsp; I believe you are correct in the assumption you are making, I probably could have been clearer in describing my network configuration.&nbsp; My OpenWRT router is my WAN to LAN access point on my network.&nbsp; The DSL line coming into my house first goes to a TP-Link Modem which is setup in a bridged mode.&nbsp; Therefore the external public IP that I receive from my provider is received on the WAN side of my OpenWRT box (which is a Buffalo WZR-HP-AG300H).&nbsp; Since the OpenVPN service is running on the OpenWRT router, I don&#039;t think I have to be doing any forwarding to access the router itself.&nbsp; Once I have this connection working, I plan on extending it to access a Windows desktop box on the LAN behind the router.</p><p>The firewall rules that are in the configuration that allow my WorkIP address and the MAC address of my phone do work properly and I am able to SSH into the router from both of those devices, and also able to access the LUCI GUI from both of those devices.&nbsp; Hence why I can&#039;t understand why my OpenVPN connection is not working properly.</p><p>Thanks for looking at this.&nbsp; Let me know if there is anything else I should try.<br />Jeff</p><br /><p>Below is some additional information with sanitized IPs.<br />&nbsp; &nbsp;OpenWRT WAN IP = 11.22.33.44<br />1.&nbsp; NMAP from a remote location<br />2.&nbsp; NETSTAT of the OpenWRT box<br />3.&nbsp; IPTABLES of the OpenWRT box</p><p>NMAP scan for specific OpenVPN port 1194</p><p>[root@disect ~]# nmap -sU -p 1194 11.22.33.44<br />Starting Nmap 5.51 ( <a href="http://nmap.org">http://nmap.org</a> ) at 2014-10-31 13:49 PDT<br />Nmap scan report for 1-22-33-44.dyn.centurytel.net (11.22.33.44)<br />Host is up (0.16s latency).<br />PORT&nbsp; &nbsp; &nbsp;STATE&nbsp; SERVICE<br />1194/udp closed openvpn<br />Nmap done: 1 IP address (1 host up) scanned in 0.48 seconds</p><p>Although reading these results show the port state is &quot;closed&quot;, the NMAP reference guide sayst that &quot;Closed ports have no application listening on them, though they could open up at any time&quot;.&nbsp; Does the second half of this sentence mean that the port may be currently closed, but listening for a connection and could be opened at any time.&nbsp; Therefore &quot;closed&quot; doesn&#039;t necessarily mean that it is not listening for a connection?&nbsp; The NETSTAT query listed below seems to indicate that OpenVPN is listening on that port.&nbsp; So I am confused with these two outputs.</p><br /><p>NMAP scan for all ports.</p><p>[root@disect ~]# nmap -sU 11.22.33.44<br />Starting Nmap 5.51 ( <a href="http://nmap.org">http://nmap.org</a> ) at 2014-10-31 13:50 PDT<br />Nmap scan report for 11-22-33-44.dyn.centurytel.net (11.22.33.44)<br />Host is up (0.17s latency).<br />Not shown: 997 closed ports<br />PORT&nbsp; &nbsp; STATE&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;SERVICE<br />53/udp&nbsp; open&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; domain<br />67/udp&nbsp; open|filtered dhcps<br />514/udp open|filtered syslog<br />Nmap done: 1 IP address (1 host up) scanned in 1081.29 seconds</p><br /><p>root@gateway:~# netstat -an<br />Active Internet connections (servers and established)<br />Proto Recv-Q Send-Q Local Address&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Foreign Address&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;State<br />tcp&nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0 0.0.0.0:80&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0:*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;LISTEN<br />tcp&nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0 11.22.33.44:80&nbsp; &nbsp; &nbsp; &nbsp;66.171.190.18:64627&nbsp; &nbsp; &nbsp;SYN_RECV<br />tcp&nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0 0.0.0.0:53&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0:*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;LISTEN<br />tcp&nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0 0.0.0.0:22&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0:*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;LISTEN<br />tcp&nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0 11.22.33.44:80&nbsp; &nbsp; &nbsp; &nbsp;66.171.190.18:6698&nbsp; &nbsp; &nbsp; TIME_WAIT<br />tcp&nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0 11.22.33.44:22&nbsp; &nbsp; &nbsp; &nbsp;66.171.190.18:64394&nbsp; &nbsp; &nbsp;ESTABLISHED<br />tcp&nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0 11.22.33.44:22&nbsp; &nbsp; &nbsp; &nbsp;66.171.190.18:37535&nbsp; &nbsp; &nbsp;ESTABLISHED<br />tcp&nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0 11.22.33.44:80&nbsp; &nbsp; &nbsp; &nbsp;66.171.190.18:4095&nbsp; &nbsp; &nbsp; TIME_WAIT<br />netstat: /proc/net/tcp6: No such file or directory<br />udp&nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0 0.0.0.0:514&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0:*<br />udp&nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0 0.0.0.0:53&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0:*<br />udp&nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0 0.0.0.0:67&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0:*<br />udp&nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0 192.168.123.2:1194&nbsp; &nbsp; &nbsp; 0.0.0.0:*<br />&lt;...snip other irrelevant lines...&gt;<br />root@gateway:~#</p><br /><br /><p>root@gateway:~# iptables -nvL<br />Chain INPUT (policy ACCEPT 5920 packets, 168K bytes)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination<br />26137 2581K ACCEPT&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ctstate RELATED,ESTABLISHED<br />&nbsp; 663 39157 ACCEPT&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; lo&nbsp; &nbsp; &nbsp;*&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0<br /> 2519&nbsp; 130K syn_flood&nbsp; tcp&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;tcp flags:0x17/0x02<br />17751 1099K input_rule&nbsp; all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0<br />17751 1099K input&nbsp; &nbsp; &nbsp; all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0</p><p>Chain FORWARD (policy DROP 0 packets, 0 bytes)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination<br />66607&nbsp; &nbsp;39M ACCEPT&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ctstate RELATED,ESTABLISHED<br /> 2963&nbsp; 215K forwarding_rule&nbsp; all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0<br /> 2963&nbsp; 215K forward&nbsp; &nbsp; all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 reject&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0</p><p>Chain OUTPUT (policy ACCEPT 0 packets, 0 bytes)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination<br />37214&nbsp; &nbsp;31M ACCEPT&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ctstate RELATED,ESTABLISHED<br />&nbsp; 663 39157 ACCEPT&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; lo&nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0<br /> 2855&nbsp; 230K output_rule&nbsp; all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0<br /> 2855&nbsp; 230K output&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0</p><p>Chain forward (1 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination<br /> 2963&nbsp; 215K zone_lan_forward&nbsp; all&nbsp; --&nbsp; br-lan *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 zone_wan_forward&nbsp; all&nbsp; --&nbsp; pppoe-wan *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 zone_vpn_forward&nbsp; all&nbsp; --&nbsp; tun0&nbsp; &nbsp;*&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0</p><p>Chain forwarding_lan (1 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination</p><p>Chain forwarding_rule (1 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination</p><p>Chain forwarding_vpn (1 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination</p><p>Chain forwarding_wan (1 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination</p><p>Chain input (1 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination<br /> 8443&nbsp; 759K zone_lan&nbsp; &nbsp;all&nbsp; --&nbsp; br-lan *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0<br /> 3386&nbsp; 172K zone_wan&nbsp; &nbsp;all&nbsp; --&nbsp; pppoe-wan *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 zone_vpn&nbsp; &nbsp;all&nbsp; --&nbsp; tun0&nbsp; &nbsp;*&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0</p><p>Chain input_lan (1 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination</p><p>Chain input_rule (1 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination</p><p>Chain input_vpn (1 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination</p><p>Chain input_wan (1 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination</p><p>Chain output (1 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination<br /> 2855&nbsp; 230K zone_lan_ACCEPT&nbsp; all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0<br /> 2712&nbsp; 182K zone_vpn_ACCEPT&nbsp; all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0<br /> 2712&nbsp; 182K zone_wan_ACCEPT&nbsp; all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0</p><p>Chain output_rule (1 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination</p><p>Chain reject (7 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 REJECT&nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;reject-with tcp-reset<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 REJECT&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;reject-with icmp-port-unreachable</p><p>Chain syn_flood (1 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination<br /> 2519&nbsp; 130K RETURN&nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;tcp flags:0x17/0x02 limit: avg 25/sec burst 50<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 DROP&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0</p><p>Chain zone_lan (1 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination<br /> 8443&nbsp; 759K input_lan&nbsp; all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0<br /> 8443&nbsp; 759K zone_lan_ACCEPT&nbsp; all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0</p><p>Chain zone_lan_ACCEPT (3 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination<br />&nbsp; 143 48226 ACCEPT&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; br-lan&nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0<br /> 8443&nbsp; 759K ACCEPT&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; br-lan *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0</p><p>Chain zone_lan_DROP (0 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 DROP&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; br-lan&nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 DROP&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; br-lan *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0</p><p>Chain zone_lan_REJECT (1 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 reject&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; br-lan&nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 reject&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; br-lan *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0</p><p>Chain zone_lan_forward (1 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination<br /> 2963&nbsp; 215K zone_wan_ACCEPT&nbsp; all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 forwarding_lan&nbsp; all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 zone_lan_REJECT&nbsp; all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0</p><p>Chain zone_vpn (1 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 input_vpn&nbsp; all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 zone_vpn_ACCEPT&nbsp; all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0</p><p>Chain zone_vpn_ACCEPT (2 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 ACCEPT&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; tun0&nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 ACCEPT&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; tun0&nbsp; &nbsp;*&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0</p><p>Chain zone_vpn_DROP (0 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 DROP&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; tun0&nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 DROP&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; tun0&nbsp; &nbsp;*&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0</p><p>Chain zone_vpn_REJECT (1 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 reject&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; tun0&nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 reject&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; tun0&nbsp; &nbsp;*&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0</p><p>Chain zone_vpn_forward (1 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 zone_wan_ACCEPT&nbsp; all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 zone_lan_ACCEPT&nbsp; all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 forwarding_vpn&nbsp; all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 zone_vpn_REJECT&nbsp; all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0</p><p>Chain zone_wan (1 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 ACCEPT&nbsp; &nbsp; &nbsp;udp&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;udp dpt:68<br />&nbsp; &nbsp; 4&nbsp; &nbsp;180 ACCEPT&nbsp; &nbsp; &nbsp;icmp --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;icmp type 8<br />&nbsp; &nbsp; 4&nbsp; &nbsp;154 ACCEPT&nbsp; &nbsp; &nbsp;udp&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;udp dpt:1194<br />&nbsp; &nbsp; 9&nbsp; 3124 ACCEPT&nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;&lt;workIP&gt;&nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;tcp dpt:22<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 ACCEPT&nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;tcp dpt:22 MAC &lt;phoneMAC&gt;<br />&nbsp; &nbsp;24&nbsp; 1068 REJECT&nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;tcp dpt:22 reject-with icmp-port-unreachable<br /> 2391&nbsp; 124K ACCEPT&nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;&lt;workIP&gt;&nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;tcp dpt:80<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 ACCEPT&nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;tcp dpt:80 MAC &lt;phoneMAC&gt;<br />&nbsp; 954 43069 input_wan&nbsp; all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0<br />&nbsp; 954 43069 zone_wan_ACCEPT&nbsp; all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0</p><p>Chain zone_wan_ACCEPT (4 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination<br /> 5675&nbsp; 397K ACCEPT&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; pppoe-wan&nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0<br />&nbsp; 954 43069 ACCEPT&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; pppoe-wan *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0</p><p>Chain zone_wan_DROP (0 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 DROP&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; pppoe-wan&nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 DROP&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; pppoe-wan *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0</p><p>Chain zone_wan_REJECT (1 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 reject&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; pppoe-wan&nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 reject&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; pppoe-wan *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0</p><p>Chain zone_wan_forward (1 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 forwarding_wan&nbsp; all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 zone_wan_REJECT&nbsp; all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0<br />root@gateway:~#</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p252693">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">dem</div>
					<div class="post-datetime">
						1 Nov 2014, 01:34					</div>
				</div>
				<div class="post-content content">
					<p>Okay so looking at your netstat output it looks like Openvpn is only listening on the LAN Interface.</p><p>If that is correct that would mean you need to use the original firewall redirect rule I suggested.<br />Using the LAN IP address shown it should look like this :</p><br /><p>config redirect<br />&nbsp; &nbsp; &nbsp; &nbsp; option src wan<br />&nbsp; &nbsp; &nbsp; &nbsp; option src_dport 1194<br />&nbsp; &nbsp; &nbsp; &nbsp; option dest lan<br />&nbsp; &nbsp; &nbsp; &nbsp; option dest_ip 192.168.123.2<br />&nbsp; &nbsp; &nbsp; &nbsp; option dest_port 1194<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto udp</p><br /><p>run &quot;/etc/init.d/firewall restart&quot;&nbsp; to reload the rules and test UDP port 1194 with a port scan again</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p252709">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">nebbia88</div>
					<div class="post-datetime">
						1 Nov 2014, 07:01					</div>
				</div>
				<div class="post-content content">
					<p>In fact seems you have openvpn &quot;listen&quot; option on lan only. <br />Uci or .conf? Can you post it?</p><p>BTW you have default &quot;Input&quot; accept on firewall wan zone.. maybe reject it&#039;s safer..</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p252991">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">jeffboyce</div>
					<div class="post-datetime">
						3 Nov 2014, 20:33					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for looking at this.</p><p>Well I didn&#039;t intentionally set the OpenVPN server to listen only on the LAN interface.&nbsp; The config file is listed below.&nbsp; As I mentioned before, this config is very similar to the one that is working in two of my office servers and they are listening on their external interface.</p><p>In doing some additional research the last couple of days, I have a hypothesis that I am just starting to look into now.&nbsp; I believe that when OpenVPN is starting, it is not reading my config file.&nbsp; Comparing the log file showing a restart of my home server to one of my office servers, and the home server log doesn&#039;t list all the current parameter settings from the config file when it starts.&nbsp; I suspect that when it starts it is not seeing my config file because of wrong permissions, wrong file locations, or something.&nbsp; I am just starting to look into that option now.</p><p>Jeff</p><br /><p>/etc/openvpn/GatewayVPNServer.conf<br />local 192.168.123.2<br />port 1194<br />proto udp<br />dev tun<br />tls-server<br />ca /etc/easy-rsa/keys/ca.crt<br />cert /etc/easy-rsa/keys/GatewayVPNServer.crt<br />key /etc/easy-rsa/keys/GatewayVPNServer.key<br />dh /etc/easy-rsa/keys/dh2048.pem<br />server 10.4.0.0 255.255.255.0<br />float<br />ifconfig-pool-persist /etc/openvpn/ipp.txt 120<br />push &quot;route 192.168.123.0 255.255.255.0&quot;<br />keepalive 10 120<br />comp-lzo<br />persist-key<br />persist-tun<br />status /etc/openvpn-status.log<br />log-append&nbsp; /home/openvpn.log<br />verb 4</p><p>/home/openvpn.log<br />Mon Nov&nbsp; 3 09:59:08 2014 us=775890 event_wait : Interrupted system call (code=4)<br />Mon Nov&nbsp; 3 09:59:08 2014 us=799730 TCP/UDP: Closing socket<br />Mon Nov&nbsp; 3 09:59:08 2014 us=839092 /sbin/route del -net 10.4.0.0 netmask 255.255.255.0<br />Mon Nov&nbsp; 3 09:59:08 2014 us=882400 Closing TUN/TAP interface<br />Mon Nov&nbsp; 3 09:59:08 2014 us=923777 /sbin/ifconfig tun0 0.0.0.0<br />Mon Nov&nbsp; 3 09:59:08 2014 us=968387 SIGTERM[hard,] received, process exiting<br />Mon Nov&nbsp; 3 09:59:09 2014 us=927183 OpenVPN 2.2.2 mips-openwrt-linux [SSL] [LZO2] [EPOLL] built on Mar 14 2013<br />Mon Nov&nbsp; 3 09:59:09 2014 us=939989 NOTE: OpenVPN 2.1 requires &#039;--script-security 2&#039; or higher to call user-defined scripts or executables<br />Mon Nov&nbsp; 3 09:59:11 2014 us=20748 Diffie-Hellman initialized with 2048 bit key<br />Mon Nov&nbsp; 3 09:59:11 2014 us=68887 TLS-Auth MTU parms [ L:1542 D:138 EF:38 EB:0 ET:0 EL:0 ]<br />Mon Nov&nbsp; 3 09:59:11 2014 us=110826 Socket Buffers: R=[163840-&gt;131072] S=[163840-&gt;131072]<br />Mon Nov&nbsp; 3 09:59:11 2014 us=153828 TUN/TAP device tun0 opened<br />Mon Nov&nbsp; 3 09:59:11 2014 us=196973 TUN/TAP TX queue length set to 100<br />Mon Nov&nbsp; 3 09:59:11 2014 us=248364 /sbin/ifconfig tun0 10.4.0.1 pointopoint 10.4.0.2 mtu 1500<br />Mon Nov&nbsp; 3 09:59:11 2014 us=303290 /sbin/route add -net 10.4.0.0 netmask 255.255.255.0 gw 10.4.0.2<br />Mon Nov&nbsp; 3 09:59:11 2014 us=371715 Data Channel MTU parms [ L:1542 D:1450 EF:42 EB:135 ET:0 EL:0 AF:3/1 ]<br />Mon Nov&nbsp; 3 09:59:11 2014 us=428428 UDPv4 link local (bound): 192.168.123.2:1194<br />Mon Nov&nbsp; 3 09:59:11 2014 us=489956 UDPv4 link remote: [undef]<br />Mon Nov&nbsp; 3 09:59:11 2014 us=551855 MULTI: multi_init called, r=256 v=256<br />Mon Nov&nbsp; 3 09:59:11 2014 us=598645 IFCONFIG POOL: base=10.4.0.4 size=62<br />Mon Nov&nbsp; 3 09:59:11 2014 us=640263 IFCONFIG POOL LIST<br />Mon Nov&nbsp; 3 09:59:11 2014 us=729367 Initialization Sequence Completed</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p253009">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">dem</div>
					<div class="post-datetime">
						3 Nov 2014, 23:27					</div>
				</div>
				<div class="post-content content">
					<p>So have you added the UDP port 1194 redirect rule, restarted the firewall and tested again?</p><p>Another port scan would be good.</p><p>I ran an openVPN VPN between Australia and UK for 3 years and once configured it was very reliable.</p><p>Whilst you&#039;re still having connection issues I would increase openVPN verbosity to 5 or 6 (verb 5 option in config).</p><p>Your openVPN config file looks okay.<br />Have you checked that the Certificate(s) haven&#039;t expired?</p><br /><p>After testing with port scan and increasing verbosity post your new log files and your client config if you&#039;re still having problems.</p><br /><p>I recommend that when everything is working you increase security by also using static keys (tls-auth option) and specifying a strong cipher (cipher option)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p253113">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">jeffboyce</div>
					<div class="post-datetime">
						4 Nov 2014, 20:22					</div>
				</div>
				<div class="post-content content">
					<p>Ok, the UDP port 1194 redirect rule seems to have worked.&nbsp; Although it was weird that an initial test of it showed now difference.&nbsp; I had actually rebooted the router and was checking something else when I noticed that I could connect.</p><p>I am a little uncertain on why this redirect is needed, since I thought OpenVPN is by default listening on the external interface (maybe this is my bad assumption).&nbsp; I don&#039;t recall having setup anything like this redirect on the two CentOS boxes in the office that I have OpenVPN running on.&nbsp; Can you explain to me further the purpose of the redirect and why it is needed.&nbsp; I also find it interesting that this redirect is not mentioned anywhere on the OpenWRT OpenVPN wiki, otherwise I would have implemented it earlier.&nbsp; Thanks.</p><p>Now off to tweak the install a little bit and get access to the Win Vista box behind the router.</p><p>Thanks.<br />Jeff</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p253127">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">dem</div>
					<div class="post-datetime">
						5 Nov 2014, 00:15					</div>
				</div>
				<div class="post-content content">
					<p>Good to hear Jeff.</p><p>You only need the redirect firewall rule because OpenVPN is only listening on your LAN interface.&nbsp; Just comment out the &quot;local&quot; option and Openvpn will bind to all interfaces.&nbsp; You can then delete the firewall redirect rule and use your existing UDP port 1194 WAN firewall rule.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p253130">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">jeffboyce</div>
					<div class="post-datetime">
						5 Nov 2014, 00:40					</div>
				</div>
				<div class="post-content content">
					<p>Thanks.&nbsp; Now that is starting to make sense relative to my CentOS boxes with OpenVPN installed.&nbsp; The CentOS boxes are behind a pfSense firewall that is doing the port forwarding.&nbsp; While the home router is my WAN/LAN access point where the firewall and the OpenVPN server are on the same box running OpenWRT.</p><p>Do you have any opinion on which option would be better security-wise, or are they both essentially the same (I would assume they are essentially the same).<br />1.&nbsp; Keep the Local option and the firewall redirect rule, or<br />2.&nbsp; Comment out the Local option, and delete the firewall redirect rule (keeping my original UDP port 1194 Wan firewall rule).</p><p>Now I think I just need to add a persistent route on my home Vista box so that it knows a route back to the VPN tunnel, so that I can access the box remotely.</p><p>Jeff</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p253132">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">dem</div>
					<div class="post-datetime">
						5 Nov 2014, 01:06					</div>
				</div>
				<div class="post-content content">
					<p>I would switch to WAN binding as it should improve performance as it uses less resources without the NAT redirection.<br />The cipher used can also make a difference to performance.</p><p>If your OpenVPN clients have static IP addresses you could increase security by limiting port 1194 access to only those IPs.</p>											<p class="post-edited">(Last edited by <strong>dem</strong> on 5 Nov 2014, 02:34)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p253137">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">jeffboyce</div>
					<div class="post-datetime">
						5 Nov 2014, 01:22					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for your assistance dem.&nbsp; I will consider this thread solved and closed.</p><p>Jeff</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>