<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Experiences with D-Link DSL-2640B (ADSL2+ Router) (new to OpenWRT)</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 5 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p149458">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">spadkins</div>
					<div class="post-datetime">
						24 Nov 2011, 09:09					</div>
				</div>
				<div class="post-content content">
					<p>Hi,<br />Here are my experiences with a new D-Link DSL-2640B that I purchased for OpenWRT hacking.<br />I am new to OpenWRT.<br />Stephen<br />_______________________________________________________________________________</p><p>I started with the D-Link DSL-2640B &quot;hardware page&quot; as my guide, referring to the generic guide for background.</p><p>&nbsp; &nbsp; <a href="http://wiki.openwrt.org/toh/d-link/dsl-2640u">http://wiki.openwrt.org/toh/d-link/dsl-2640u</a><br />&nbsp; &nbsp; <a href="http://wiki.openwrt.org/doc/howto/generic.flashing">http://wiki.openwrt.org/doc/howto/generic.flashing</a></p><p>1. POWER ADAPTER</p><p>I received my D-Link DSL-2640B and opened it up.<br />The first thing I noticed was that I had accidentally ordered the model with the power adapter that fits European outlets (2 thin cylindrical pegs).<br />I read somewhere that this model is popular in Brazil. Perhaps the power adapter fits Brazilian power outlets.<br />Luckily I had an adapter around and I was able to proceed. (You can get these from your local AAA store or anywhere that sells travel adapters.)<br />I&#039;m not sure how to avoid this if I order it again. Nothing on the web-based ordering warned me about this.<br />I guess I will order from some place which has a telephone so I can call and make sure I am getting the US model.</p><p>2. SOFTWARE</p><p>I am using a Windows 7 laptop to do the configuration.<br />There are two pieces of software I needed to download before I flash the image.</p><p>&nbsp; &nbsp; Putty - a free Window ssh client (Free Software) (it is also a terminal emulator useful for accessing a serial port console via RS-232, i.e. COM1:)<br />&nbsp; &nbsp; <a href="http://www.chiark.greenend.org.uk/~sgtatham/putty/">http://www.chiark.greenend.org.uk/~sgtatham/putty/</a></p><p>&nbsp; &nbsp; tftpd32 - tftp client and server software for Windows (Free Software)<br />&nbsp; &nbsp; <a href="http://tftpd32.jounin.net">http://tftpd32.jounin.net</a>/<br />&nbsp; &nbsp; <a href="http://tftpd32.jounin.net/tftpd32_download.html">http://tftpd32.jounin.net/tftpd32_download.html</a><br />&nbsp; &nbsp; <a href="http://tftpd32.jounin.net/download/Tftpd64-4.00-setup.exe">http://tftpd32.jounin.net/download/Tftp … -setup.exe</a>&nbsp; (this is the 64-bit version, which I am choosing)</p><p>3. OPENWRT IMAGE SELECTION</p><p>I needed to download an OpenWRT image to flash to the device.<br />I followed the following URL&#039;s.</p><p>&nbsp; &nbsp; <a href="http://downloads.openwrt.org">http://downloads.openwrt.org</a>/<br />&nbsp; &nbsp; <a href="http://downloads.openwrt.org/backfire/">http://downloads.openwrt.org/backfire/</a><br />&nbsp; &nbsp; <a href="http://downloads.openwrt.org/backfire/10.03/">http://downloads.openwrt.org/backfire/10.03/</a><br />&nbsp; &nbsp; <a href="http://downloads.openwrt.org/backfire/10.03/brcm63xx/">http://downloads.openwrt.org/backfire/10.03/brcm63xx/</a></p><p>&quot;backfire&quot; seems to be the name of the latest stable release of OpenWRT.<br />The latest stable release number is 10.03.<br />The hardware page said the CPU on this device is a Broadcom 6348 CPU (a MIPS instruction set CPU) so I chose the &quot;brcm63xx&quot; branch.<br />(Perhaps this is a missprint. Elsewhere on the page it says Broadcom 6338.)</p><p>The hardware page said I should use an image named &quot;openwrt-DSL2640B-squashfs-cfe.bin&quot;.<br />This is verified in the following source code page.</p><p>&nbsp; &nbsp; <a href="https://dev.openwrt.org/browser/trunk/target/linux/brcm63xx/image/README.images-bcm63xx">https://dev.openwrt.org/browser/trunk/t … es-bcm63xx</a></p><p>(An older version of the README.images-bcm63xx indicates that the &quot;openwrt-D-4P-W-&lt;fs&gt;-bc310-cfe.bin&quot; images are the right ones to use for DSL-2640B.)<br />I downloaded the following available images, thinking that one of them might work.</p><p>&nbsp; &nbsp; openwrt-DSL2640B-squashfs-cfe.bin&nbsp; &nbsp; &nbsp; (I&#039;ll start with this one because that is the one the hardware page identifies.)<br />&nbsp; &nbsp; openwrt-DSL2640B-jffs2-128k-cfe.bin&nbsp; &nbsp; (I think I&#039;ll want to use this one eventually.)<br />&nbsp; &nbsp; openwrt-DSL2640B-jffs2-64k-cfe.bin</p><p>Along the way I learned that CFE stands for Common Firmware Environment.<br />Common Firmware Environment (CFE) is a firmware interface and bootloader developed by Broadcom for 32-bit and 64-bit system-on-a-chip (SOC) systems. It is roughly analogous to the BIOS on the IBM PC platform.</p><p>&nbsp; &nbsp; <a href="http://en.wikipedia.org/wiki/Common_Firmware_Environment">http://en.wikipedia.org/wiki/Common_Fir … nvironment</a></p><p>4. ROUTER ADMINISTRATION</p><p>Next I plugged the network cable that came with the router into my laptop port and one of the ports on the back of the router.<br />Usually these routers have a tiny web server built in and you use a web browser to administer them.<br />Since I actually had the manual, I consulted it and verified this.<br />It said to type the following address into my browser (which I did).</p><p>&nbsp; &nbsp; <a href="http://10.1.1.1">http://10.1.1.1</a></p><p>Then I got a login screen from the router. I supplied the standard username of &quot;admin&quot; with password of &quot;admin&quot;.<br />I was in and talking to the administration screen of the router.<br />I explored all of the screens to understand the features available with the initial firmware.<br />The screens of note were:</p><p>&nbsp; &nbsp; Management &gt; Access Control &gt; Services&nbsp; &nbsp;(Enable tftp under LAN. Click &quot;Save/Apply&quot;.)<br />&nbsp; &nbsp; Management &gt; Update Software&nbsp; &nbsp;(This is the official way to reflash the firmware. More on this later.)<br />&nbsp; &nbsp; Management &gt; Save/Reboot&nbsp; &nbsp; (Click the &quot;Save/Reboot&quot;)</p><p>5. FLASHING USING &quot;Management &gt; Update Software&quot; FAILS</p><p>The &quot;hardware page&quot; describes that there are two ways to flash the OpenWRT firmware onto this D-Link device.<br />The first is to use the built-in administration page called &quot;Management &gt; Update Software&quot;.<br />It says that this will fail because there is some ID in the firmware file and that you have to modify the original firmware to get this to work.<br />I wanted to try it anyway and see what happens.<br />I went to the &quot;Management &gt; Update Software&quot; screen.<br />I selected one of my firmware images (&quot;openwrt-DSL2640B-squashfs-cfe.bin&quot;) I had downloaded to my PC with the &quot;Choose File&quot; button, then hit &quot;Update Software&quot;.<br />I got the following error.</p><p>&nbsp; &nbsp; DSL Router Update<br />&nbsp; &nbsp; Fatal error during image uploading. </p><p>The hardware page describes how you can recompile the original source code and flash that.<br />Then it will not check to see whether any new firmware is &quot;official.&quot;<br />I decided not to go this route (yet).</p><p>6. FLASHING USING CONSOLE (NOT!!!)</p><p>The hardware page says that the other way you can flash new firmware onto the OpenWRT is by using the serial port console which talks directly to the CFE.<br />Unfortunately, the serial port on this version of the device is not exposed at the back of the device.<br />I opened up the case to see if it was obvious inside somewhere.<br />(Turn box over. Remove rubber feet. Unscrew screws hidden under rubber feet. Pry open.)<br />I found a 4-pin connector in the middle of the circuit board and wondered if that was the serial port.</p><p>(Later I found a document that claimed that this was in fact the serial port. It also details the pinout.)</p><p>&nbsp; &nbsp; <a href="https://forum.openwrt.org/viewtopic.php?id=26632">https://forum.openwrt.org/viewtopic.php?id=26632</a><br />&nbsp; &nbsp; J3 is the console. <br />&nbsp; &nbsp; DSL-2640B H/W T1 ( Mostly found in Brazil )<br />&nbsp; &nbsp; The pinout is : 2-GND 3-TX 4-RX ( pin 1 is marked with a dot )<br />&nbsp; &nbsp; Baudrate 115200 8N1<br />&nbsp; &nbsp; The serial port is ttl level. You need an converter or use an old celular data cable. ( I use an old cable from a Siemens C63 )</p><p>However, I have no cable-making equipment and no soldering iron, so I was not going to do the serial port console thing (unless I had to).<br />Details on appropriate cabling seems to be described here.<br />(Note that TTL voltage levels on the board go from 0V to 3.3V or 5V while the voltage levels for a standard RS-232 comms link go from -12V to +12V.)<br />(So a converter is required, not just a cable of wires.)</p><p>&nbsp; &nbsp; <a href="http://wiki.openwrt.org/doc/hardware/port.serial">http://wiki.openwrt.org/doc/hardware/port.serial</a></p><p>I searched around for an appropriate cable in the internet and bought this one.</p><p>&nbsp; &nbsp; <a href="http://www.superdroidrobots.com/shop/item.aspx?itemid=335">http://www.superdroidrobots.com/shop/it … itemid=335</a></p><p>Meanwhile, the fact that the serial port was removed from the back of the case prompted me to wonder if there were network access to the console.</p><p>7. EXPLORING THE INTERNAL COMMAND SHELL</p><p>&quot;Putty&quot; is my ssh client on Windows. I tried:</p><p>&nbsp; &nbsp; putty 10.1.1.1</p><p>and sure enough I got a login prompt.<br />(The hardware page has a cryptic reference to &quot;log in using telnet&quot; and I think this is what they were referring to. Both telnet and ssh seem to work similarly using Putty.)</p><p>I logged in with admin/admin and received a command prompt.<br />I am hoping this is comparable to the serial port access to the CFE command prompt.<br />(Although the CFE prompt is a lower level interface than a command shell of an already booted Linux operating system.)<br />If it does work, I won&#039;t have to open up the box or mess with cables and soldering.</p><p>Typing &quot;help&quot; reveals the commands I can use.<br />The following seemed interesting in my poking around.</p><p>help<br />echo /*<br />cat &lt;file&gt;<br />df<br />ifconfig<br />swversion show<br />ps<br />sysinfo<br />ping 10.1.1.2<br />tftp help</p><p>It is a very odd little shell.<br />There is no &quot;ls&quot; command in this shell to list files and there is no &quot;cd&quot; to change directory.<br />However, &quot;echo /*&quot; does much the same thing.</p><p>&gt; echo /*<br />&gt; echo /etc/*</p><p>I discovered that there are a number of executables (like &quot;ls&quot;) which do not seem to be directly runnable from the shell.</p><p>&gt; echo /bin/*<br />&gt; echo /usr/bin/*<br />&gt; echo /sbin/*</p><p>However, they can be run using the following.</p><p>&gt; sh -c &quot;ls -l&quot;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# long listing of files in current directory (&quot;/&quot;)<br />&gt; sh -c &quot;ls /bin&quot;&nbsp; &nbsp; &nbsp;# lists the files in /bin<br />&gt; sh -c date&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # shows the current date/time<br />&gt; sh -c dmesg&nbsp; &nbsp; &nbsp; &nbsp;# shows boot and other kernel-level log messages (lots of hardware info in here)<br />&gt; echo $PATH</p><p>Other commands in /bin, /usr/bin, and /sbin that look interesting are &quot;cp&quot;, &quot;rm&quot;, &quot;mount&quot;, &quot;top&quot;, &quot;ftpget&quot;.<br />For instance, consider the following. (I want to explore where we have write access and where we don&#039;t.)</p><p>&gt; df -k<br />Filesystem&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1k-blocks&nbsp; &nbsp; &nbsp; Used Available Use% Mounted on<br />/dev/mtdblock0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 3072&nbsp; &nbsp; &nbsp; 3072&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 100% /<br />none&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 7088&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; 7088&nbsp; &nbsp;0% /mnt<br />tmpfs&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 960&nbsp; &nbsp; &nbsp; &nbsp;124&nbsp; &nbsp; &nbsp; &nbsp;836&nbsp; 13% /var</p><p>This would seem to indicate that we have 7088 1K blocks on /mnt and 960 1K blocks on /var (close to 8MB).</p><p>&gt; sh -c mount<br />/dev/mtdblock0 on / type squashfs (ro)<br />/proc on /proc type proc (rw,nodiratime)<br />none on /mnt type tmpfs (rw)<br />tmpfs on /var type tmpfs (rw)</p><p>&gt; cat /etc/fstab<br />proc&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /proc&nbsp; &nbsp;proc&nbsp; &nbsp; defaults&nbsp; &nbsp; 0&nbsp; &nbsp;0<br />none&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /mnt&nbsp; &nbsp; tmpfs&nbsp; &nbsp;defaults&nbsp; &nbsp;0&nbsp; &nbsp; 0<br />tmpfs&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/var&nbsp; &nbsp; tmpfs&nbsp; &nbsp;size=960k&nbsp; &nbsp; 0&nbsp; &nbsp;0</p><p>Not sure what &quot;none&quot; means, but both /mnt and /var are &quot;tmpfs&quot; file systems and behave similarly as read-write areas.<br />1MB is for /var.<br />7MB is for /mnt and is empty.</p><p>The following tests show the read-only (ro) and read-write (rw) characteristics of the various file systems.</p><p># /etc is read-only<br />&gt; sh -c &quot;cp /etc/services /etc/new_file&quot;<br />cp: unable to open `/etc/new_file&#039;: Read-only file system</p><p># /var is read-write<br />&gt; sh -c &quot;cp /etc/services /var/new_file&quot;<br />&gt; sh -c &quot;ls -l /var/new_file&quot;<br />-rwxr-xr-x&nbsp; &nbsp; 1 admin&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5647 Jan&nbsp; 1 01:28 /var/new_file<br />&gt; sh -c &quot;rm /var/new_file&quot;<br />&gt; sh -c &quot;ls -l /var/new_file&quot;<br />ls: /var/new_file: No such file or directory</p><p># /mnt is read-write<br />&gt; sh -c &quot;cp /etc/services /mnt/new_file&quot;<br />&gt; sh -c &quot;ls -l /mnt/new_file&quot;<br />-rwxr-xr-x&nbsp; &nbsp; 1 admin&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5647 Jan&nbsp; 1 01:29 /mnt/new_file<br />&gt; sh -c &quot;rm /mnt/new_file&quot;<br />&gt; sh -c &quot;ls -l /mnt/new_file&quot;<br />ls: /mnt/new_file: No such file or directory</p><p>So if we look at the /etc directory, normally a place for config files, we see that all of the editable files are actually symbolic links to files in /var.</p><p>&gt; sh -c &quot;ls -l /etc&quot;</p><p>Those and other modifyable files are in /var.</p><p>&gt; sh -c &quot;ls -l /var&quot;</p><p>8. OPENING UP THE NETWORK BETWEEN THE ROUTER AND MY PC (WINDOWS FIREWALL)</p><p>I found that trying to use tftp was just hanging, getting me nowhere.<br />So I just tried &quot;ping&quot; to test the networking connection.</p><p>I found that the &quot;ping 10.1.1.2&quot; command was timing out.<br />It turns out that Windows Firewall was blocking this.<br />I turned off Windows Firewall (&quot;Control Panel &gt; System and Security &gt; Windows Firewall&quot;), and the ping command started working.<br />This &quot;ping&quot; command is the basic test of whether we can communicate with another system.<br />Since 10.1.1.1 is the router, 10.1.1.2 is my PC.<br />ping should return something like this.</p><p>&gt; ping 10.1.1.2<br />PING 10.1.1.2 (10.1.1.2): 56 data bytes<br />56 bytes from 10.1.1.2: icmp_seq=0 ttl=128 time=5.0 ms<br />56 bytes from 10.1.1.2: icmp_seq=1 ttl=128 time=0.0 ms<br />56 bytes from 10.1.1.2: icmp_seq=2 ttl=128 time=0.0 ms<br />56 bytes from 10.1.1.2: icmp_seq=3 ttl=128 time=0.0 ms</p><p>--- 10.1.1.2 ping statistics ---<br />4 packets transmitted, 4 packets received, 0% packet loss<br />round-trip min/avg/max = 0.0/1.2/5.0 ms</p><p>9. FLASHING USING TFTP</p><p>From the on-board command prompt.</p><p>&quot;tftp help&quot; got me the following.</p><p>&nbsp; &nbsp; BusyBox v1.00 (2009.08.10-02:17+0000) multi-call binary</p><p>&nbsp; &nbsp; Usage: tftp [OPTION]... tftp_server_ip</p><p>&nbsp; &nbsp; Update firmware image and configuration data from OR backup configuration<br />&nbsp; &nbsp; data to a tftp server.</p><p>&nbsp; &nbsp; Options:<br />&nbsp; &nbsp; -g&nbsp; &nbsp; &nbsp; Get file. (Update image/configuration data)<br />&nbsp; &nbsp; -p&nbsp; &nbsp; &nbsp; Put file. (backup configuration data)<br />&nbsp; &nbsp; -f&nbsp; &nbsp; &nbsp; remote file name.<br />&nbsp; &nbsp; -t&nbsp; &nbsp; &nbsp; i for image and c for configuration data.</p><p>So I moved the downloaded OpenWRT firmware images to a directory called C:\install.<br />I started up the Windows tftp server and configured C:\install as the &quot;Current Directory&quot;.<br />I then typed the following and got the following output.</p><p>&gt; tftp -g -f openwrt-DSL2640B-squashfs-cfe.bin -t i 10.1.1.2<br />&gt; tftp -g -f openwrt-DSL2640B-squashfs-cfe.bin -t i 10.1.1.2<br />bcmUploadPrepare ... curPid[513] ifPid[0] ifName[br0]</p><p>Number of processes: 27<br /> 12:04am&nbsp; up 4 min,<br />load average: 1 min:0.06, 5 min:0.12, 15 min:0.06<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; total&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;used&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;free&nbsp; &nbsp; &nbsp; &nbsp;shared&nbsp; &nbsp; &nbsp; buffers<br />&nbsp; Mem:&nbsp; &nbsp; &nbsp; &nbsp; 14180&nbsp; &nbsp; &nbsp; &nbsp; 13756&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 424&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1132<br /> Swap:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0<br />Total:&nbsp; &nbsp; &nbsp; &nbsp; 14180&nbsp; &nbsp; &nbsp; &nbsp; 13756&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 424<br />&nbsp; PID&nbsp; Uid&nbsp; &nbsp; &nbsp;VmSize Stat Command<br />&nbsp; &nbsp; 1 admin&nbsp; &nbsp; &nbsp; &nbsp;280 S&nbsp; &nbsp;init<br />&nbsp; &nbsp; 2 admin&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;SWN [ksoftirqd/0]<br />&nbsp; &nbsp; 3 admin&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;SW&lt; [events/0]<br />&nbsp; &nbsp; 4 admin&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;SW&lt; [khelper]<br />&nbsp; &nbsp; 5 admin&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;SW&lt; [kblockd/0]<br />&nbsp; &nbsp;15 admin&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;SW&nbsp; [pdflush]<br />&nbsp; &nbsp;16 admin&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;SW&nbsp; [pdflush]<br />&nbsp; &nbsp;17 admin&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;SW&nbsp; [kswapd0]<br />&nbsp; &nbsp;18 admin&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;SW&lt; [aio/0]<br />&nbsp; &nbsp;23 admin&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;SW&nbsp; [mtdblockd]<br />&nbsp; &nbsp;34 admin&nbsp; &nbsp; &nbsp; &nbsp;324 S&nbsp; &nbsp;-sh<br />&nbsp; &nbsp;74 admin&nbsp; &nbsp; &nbsp; 1600 S&nbsp; &nbsp;cfm<br />&nbsp; 272 admin&nbsp; &nbsp; &nbsp; &nbsp;216 S&nbsp; &nbsp;pvc2684d<br />&nbsp; 361 admin&nbsp; &nbsp; &nbsp; &nbsp;176 S&nbsp; &nbsp;wps_btn<br />&nbsp; 387 admin&nbsp; &nbsp; &nbsp; &nbsp;304 S&nbsp; &nbsp;dhcpd<br />&nbsp; 391 admin&nbsp; &nbsp; &nbsp; &nbsp;280 S&nbsp; &nbsp;dhcpd<br />&nbsp; 427 admin&nbsp; &nbsp; &nbsp; &nbsp;816 S&nbsp; &nbsp;snmp<br />&nbsp; 438 admin&nbsp; &nbsp; &nbsp; 1704 S&nbsp; &nbsp;tr64<br />&nbsp; 459 admin&nbsp; &nbsp; &nbsp; 1728 S&nbsp; &nbsp;httpd<br />&nbsp; 460 admin&nbsp; &nbsp; &nbsp; 1600 S&nbsp; &nbsp;cfm<br />&nbsp; 466 admin&nbsp; &nbsp; &nbsp; &nbsp;364 S&nbsp; &nbsp;pppd -c 0.0.35.1 -i nas_0_0_35 -u -f 0 -M 1492<br />&nbsp; 501 admin&nbsp; &nbsp; &nbsp; 1612 S&nbsp; &nbsp;telnetd<br />&nbsp; 502 admin&nbsp; &nbsp; &nbsp; 1648 S&nbsp; &nbsp;telnetd<br />&nbsp; 512 admin&nbsp; &nbsp; &nbsp; &nbsp;288 S&nbsp; &nbsp;sh -c tftp -g -f openwrt-DSL2640B-squashfs-cfe.bin -t<br />&nbsp; 513 admin&nbsp; &nbsp; &nbsp; &nbsp;284 S&nbsp; &nbsp;tftp -g -f openwrt-DSL2640B-squashfs-cfe.bin -t i 10.<br />&nbsp; 516 admin&nbsp; &nbsp; &nbsp; &nbsp;288 S&nbsp; &nbsp;sh -c ps &gt; /var/psList<br />&nbsp; 517 admin&nbsp; &nbsp; &nbsp; &nbsp;284 R&nbsp; &nbsp;ps<br />kill process [pid: 361] [wps_btn]...<br />kill process [pid: 387] [dhcpd]...<br />kill process [pid: 391] [dhcpd]...<br />kill process [pid: 427] [snmp]...<br />kill process [pid: 438] [tr64]...<br />kill process [pid: 466] [pppd]...<br />kill process [pid: 512] [sh]...<br />&gt; kill process [pid: 460]...</p><p>Remaining modules:<br />ip_conntrack_httpfilter 17424 0 - Live 0xc00e3000<br />ipt_state 544 0 - Live 0xc00e2000<br />iptable_raw 544 0 - Live 0xc00e0000<br />ipt_NOTRACK 672 0 - Live 0xc00df000<br />ipt_dscp 448 0 - Live 0xc00de000<br />ip_nat_sip 10704 0 - Live 0xc00d7000<br />ip_queue 10592 0 - Live 0xc00ca000<br />ip_conntrack_sip 10336 1 ip_nat_sip, Live 0xc00cf000<br />iptable_nat 15632 2 ip_nat_sip,ip_queue, Live 0xc0053000<br />ip_conntrack 30464 6 ipt_state,ipt_NOTRACK,ip_nat_sip,ip_queue,ip_conntrack_sip,iptable_nat, Live 0xc0018000<br />ip_tables 14848 6 ipt_state,iptable_raw,ipt_NOTRACK,ipt_dscp,ip_queue,iptable_nat, Live 0xc0006000<br />wl 515824 0 - Live 0xc013b000<br />bcm_enet 29744 0 - Live 0xc0043000<br />bcmprocfs 14624 0 - Live 0xc000c000<br />br2684 69440 0 - Live 0xc0032000<br />blaa_dd 7104 0 - Live 0xc000a000<br />adsldd 141408 0 - Live 0xc0062000<br />atmapi 64896 4 bcm_enet,br2684,blaa_dd,adsldd, Live 0xc0022000</p><p>Memory info:<br />Number of processes: 20<br /> 12:04am&nbsp; up 4 min,<br />load average: 1 min:0.22, 5 min:0.15, 15 min:0.07<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; total&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;used&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;free&nbsp; &nbsp; &nbsp; &nbsp;shared&nbsp; &nbsp; &nbsp; buffers<br />&nbsp; Mem:&nbsp; &nbsp; &nbsp; &nbsp; 14180&nbsp; &nbsp; &nbsp; &nbsp; 12496&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1684&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1132<br /> Swap:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0<br />Total:&nbsp; &nbsp; &nbsp; &nbsp; 14180&nbsp; &nbsp; &nbsp; &nbsp; 12496&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1684<br />... done bcmUploadPrepare</p><p>The power light on the D-Link turns red and the LAN link light flashes for about 40 seconds.<br />Then I get disconnected.<br />When I reconnect, nothing is changed.<br />I wonder if the same check inherent in the web-based firmware upgrade is stopping my tftp from going through.<br />...<br />So I have tried tftp of an image to the device (&quot;put&quot;) and tftp of image from the device (&quot;get&quot;) and neither seem to work.<br />Nor can I find any traces of these files that were transferred down and failed the check.<br />Nor can I find any log messages about this action.</p><p>I looked again at the hardware page.</p><p>&nbsp; &nbsp; <a href="http://wiki.openwrt.org/toh/d-link/dsl-2640u#broadcom.tag">http://wiki.openwrt.org/toh/d-link/dsl- … oadcom.tag</a></p><p>This would indicate that the unmodified tftp service will not be useful in reflashing an OpenWRT image onto the device the first time even from the ssh command line.<br />(I was hoping that the &quot;ssh&quot; command prompt would be equivalent to the serial-port console in functionality.)<br />I tried one more desperate attempt to use the serial port without a serial cable and terminal emulator software.</p><p>&gt; sh -c &quot;echo &#039;flashimage 10.1.1.2:openwrt-DSL2640B-squashfs-cfe.bin&#039; &gt;&gt; /dev/console&quot;</p><p>Nothing happened.<br />Since I want other people to be able to do this without hardware hacking (and cable-making), the next easiest thing to try is the modified official image.<br />I&#039;ll try that next.</p><p>10. DOWNLOADING STANDARD IMAGES FROM D-LINK</p><p>After searching, I found the following useful links from D-Link.</p><p>&nbsp; &nbsp; <a href="http://www.dlink.com/support/products/default.aspx">http://www.dlink.com/support/products/default.aspx</a>&nbsp; &nbsp; (the DSL-2640B is under the Broadband section. This page assures me that the 2640B is not at &quot;end-of-life&quot;.)<br />&nbsp; &nbsp; <a href="http://www.dlink.com/products/?pid=DSL-2640B">http://www.dlink.com/products/?pid=DSL-2640B</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (This is the general product page for the device. Click on &quot;Support Resources&quot;.)<br />&nbsp; &nbsp; <a href="ftp://ftp.dlink.com/Broadband/dsl2640B/Firmware/dsl2640B_firmware_306041.zip">ftp://ftp.dlink.com/Broadband/dsl2640B/ … 306041.zip</a>&nbsp; &nbsp;(Under &quot;Firmware&quot;, this link is from the &quot;Download Now&quot; button.)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; This page warns that this firmware is only for North American versions of the product and gives a link for non-US D-Link sites. (I&#039;m in the US.)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; The page says this firmware is Version 306041 from 5/22/2008 but the file itself indicates it hasn&#039;t been modified since 11/14/2006.<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; So, while this device is not at &quot;end-of-life&quot;, it is clearly no longer being developed by D-Link.<br />&nbsp; &nbsp; <a href="http://forums.dlink.com">http://forums.dlink.com</a>/&nbsp; &nbsp; (seems to pertain to recent products more than older products like the DSL-2640B.)</p><p>I downloaded the firmware and tried flashing it using the standard method.<br />This should establish a baseline for me for what a &quot;normal flashing session&quot; should look like.</p><p>I went to the &quot;Management &gt; Update Software&quot; screen of the on-device web-based administration console.<br />I selected the standard North America (3.10) firmware image (&quot;GE_DSL-2640B_306041G00_cfe_fs_kernel&quot;) I had downloaded to my PC with the &quot;Choose File&quot; button, then hit &quot;Update Software&quot;.<br />I got the same error I did before.</p><p>&nbsp; &nbsp; DSL Router Update<br />&nbsp; &nbsp; Fatal error during image uploading. </p><p>This makes me wonder whether there is something more general that I am doing wrong.</p><p>I ought to actually call D-Link customer support for this because this should be a supported activity.</p><p>11. DOWNLOADING THE GPL SOURCES FROM D-LINK</p><p>I return to the matter of trying to get the source code to rebuild a modified vendor firmware image. per the hardware page...<br />We follow the Live Journal entry cited.</p><p>&nbsp; &nbsp; <a href="http://pudeev.livejournal.com/33449.html">http://pudeev.livejournal.com/33449.html</a></p><p>However, this is all for the RU and EU versions of source code.</p><p>&nbsp; &nbsp; D-Link DSL-2640U Hardware version: B2 <br />&nbsp; &nbsp; GPL Source Code for firmware version RU_V3.06 <br />&nbsp; &nbsp; <a href="http://ftp.dlink.ru/pub/ADSL/GPL_source_code/RU_DSL-2640U/RU_DSL-2640U_3-06-04-3C_GPL.tar.gz">http://ftp.dlink.ru/pub/ADSL/GPL_source … GPL.tar.gz</a> </p><p>&nbsp; &nbsp; D-Link DSL-2640U Hardware version: D1 <br />&nbsp; &nbsp; GPL Source Code for firmware version RU_1.10 <br />&nbsp; &nbsp; <a href="http://tsd.dlink.com.tw/temp/download/3074/DLink_DSL-2640U_RU_1.10_GPL.tar.gz">http://tsd.dlink.com.tw/temp/download/3 … GPL.tar.gz</a> </p><p>&nbsp; &nbsp; D-Link DSL-2640B Hardware version: B2 <br />&nbsp; &nbsp; GPL Source Code for firmware V4.00 <br />&nbsp; &nbsp; <a href="ftp://ftp.dlink.fr/DSL/DSL-2640B/GPL/EU_DSL-2640B_EU_4.00_3-10-02-29_GPL.tar.gz">ftp://ftp.dlink.fr/DSL/DSL-2640B/GPL/EU … GPL.tar.gz</a><br />&nbsp; &nbsp; GPL Source Code for firmware V3.07 <br />&nbsp; &nbsp; <a href="http://tsd.dlink.com.tw/temp/download/3069/EU_DSL-2640B_EU_3.07_3-06-06-4A_GPL.tar.gz">http://tsd.dlink.com.tw/temp/download/3 … GPL.tar.gz</a> <br />&nbsp; &nbsp; GPL Source Code for firmware V3.06 <br />&nbsp; &nbsp; <a href="http://tsd.dlink.com.tw/temp/download/2891/EU_DSL-2640B_3-06-06-46_GPL.tar.gz">http://tsd.dlink.com.tw/temp/download/2 … GPL.tar.gz</a></p><p>&nbsp; &nbsp; D-Link DSL-2640B Hardware version: B3 <br />&nbsp; &nbsp; GPL Source Code for firmware V5.00 <br />&nbsp; &nbsp; <a href="ftp://ftp.dlink.pl/dsl/dsl-2640b/driver_software/DSL-2640B_gpl_revB3_5-0-0_eu_en_20100420.tar.gz">ftp://ftp.dlink.pl/dsl/dsl-2640b/driver … 420.tar.gz</a></p><p>We search on for more links that might reveal the US version of code.</p><p>&nbsp; &nbsp; <a href="ftp://tsd.dlink.com.tw/GPL/index.html">ftp://tsd.dlink.com.tw/GPL/index.html</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (lots of D-Link GPL source code, but only an EU version of the 2640B.)<br />&nbsp; &nbsp; <a href="ftp://ftp.dlink.ru/pub/ADSL/GPL_source_code/">ftp://ftp.dlink.ru/pub/ADSL/GPL_source_code/</a>&nbsp; &nbsp;(a bit higher up on the URL given above shows lots of source code for Russian D-Link models.)</p><p>&nbsp; &nbsp; <a href="ftp://ftp.dlink.com">ftp://ftp.dlink.com</a>/<br />&nbsp; &nbsp; <a href="ftp://ftp.dlink.com/Broadband/">ftp://ftp.dlink.com/Broadband/</a><br />&nbsp; &nbsp; <a href="ftp://ftp.dlink.com/Broadband/dsl2640B/">ftp://ftp.dlink.com/Broadband/dsl2640B/</a>&nbsp; &nbsp; &nbsp;(no source code here. just the supported binary firmware file for US devices.)</p><p>The following is a fantastic link that has all kinds of source code for all kinds of D-Link devices.</p><p>&nbsp; &nbsp; <a href="http://tsd.dlink.com.tw/downloads2008list.asp?OS=GPL">http://tsd.dlink.com.tw/downloads2008list.asp?OS=GPL</a>&nbsp; &nbsp; &nbsp;(This link looks interesting. It even has an email contact link to request GPL sources not found on the site.)</p><p>Search for DSL-2640B, follow the link and you get 6 files. One of them appears to be the sources for the North America 3.10 version (latest).</p><p>&nbsp; &nbsp; GPL: DSL-2640B T1 F/W BCM-3.10L.NA.20100623</p><p>I downloaded it (as &quot;out.tar.gz&quot;) and renamed it to &quot;GPL_DSL-2640B_T1_FW_BCM-3.10L.NA.20100623.tar.gz&quot;.</p><p>I happened to have a RedHat Linux server accessible to me (to which I had root access).<br />I followed the instructions in the enclosed README file to rebuild the image.<br />The whole process went smoothly and produced an image file.<br />However, burning this image fared no better than the official binary image I had downloaded.</p><p>12. MODIFYING THE GPL SOURCES FROM D-LINK</p><p>The hardware page says that you should rebuild the standard image while disabling the check that inhibits OpenWRT from replacing it.<br />The instructions for modifying the source code are here:</p><p>&nbsp; &nbsp; <a href="https://dev.openwrt.org/ticket/5472">https://dev.openwrt.org/ticket/5472</a></p><p>I&#039;ll get to that after I can burn a standard image.</p><p>So that&#039;s how far I&#039;ve gotten.<br />I still have not succeeded in putting OpenWRT software onto my D-Link device.<br />I keep trying however, and I update this page as I discover things.</p><p>-- Stephen Adkins</p><p>What is below is a bunch of output from the ssh-accessible command line that may be interesting for people.</p><p>-----------------------------------------------------------------------------------------------------------------------------------------<br />LOW-LEVEL DEVICE INFORMATION<br />-----------------------------------------------------------------------------------------------------------------------------------------<br />This information was all derived from the command prompt accessible by ssh or telnet.</p><p>&gt; swversion show<br />3.10L.02.A2pB022g.d20h</p><p>&gt; df -k<br />Filesystem&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1k-blocks&nbsp; &nbsp; &nbsp; Used Available Use% Mounted on<br />/dev/mtdblock0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 3072&nbsp; &nbsp; &nbsp; 3072&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 100% /<br />none&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 7088&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; 7088&nbsp; &nbsp;0% /mnt<br />tmpfs&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 960&nbsp; &nbsp; &nbsp; &nbsp;120&nbsp; &nbsp; &nbsp; &nbsp;840&nbsp; 13% /var</p><p>&gt; sysinfo<br />Number of processes: 25<br /> 12:07am&nbsp; up 7 min,<br />load average: 1 min:0.00, 5 min:0.06, 15 min:0.05<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; total&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;used&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;free&nbsp; &nbsp; &nbsp; &nbsp;shared&nbsp; &nbsp; &nbsp; buffers<br />&nbsp; Mem:&nbsp; &nbsp; &nbsp; &nbsp; 14180&nbsp; &nbsp; &nbsp; &nbsp; 13864&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 316&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1136<br /> Swap:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0<br />Total:&nbsp; &nbsp; &nbsp; &nbsp; 14180&nbsp; &nbsp; &nbsp; &nbsp; 13864&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 316</p><p>&gt; cat /proc/cpuinfo<br />system type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: 96333W<br />processor&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: 0<br />cpu model&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: BCM6338 V1.0<br />BogoMIPS&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : 239.20<br />wait instruction&nbsp; &nbsp; &nbsp; &nbsp; : no<br />microsecond timers&nbsp; &nbsp; &nbsp; : yes<br />tlb_entries&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: 32<br />extra interrupt vector&nbsp; : yes<br />hardware watchpoint&nbsp; &nbsp; &nbsp;: no<br />unaligned access&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : 49288<br />VCED exceptions&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: not available<br />VCEI exceptions&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: not available</p><p>&gt; ifconfig -a<br />atm0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Link encap:UNSPEC&nbsp; HWaddr 71-40-00-00-00-40-00-42-00-00-00-00-00-00-00-00<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [NO FLAGS]&nbsp; MTU:0&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:0 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:0 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:0 (0.0 B)&nbsp; TX bytes:0 (0.0 B)</p><p>br0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Link encap:Ethernet&nbsp; HWaddr 14:D6:4D:F9:F8:42<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:10.1.1.1&nbsp; Bcast:10.255.255.255&nbsp; Mask:255.0.0.0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:2088 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:1065 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:194080 (189.5 KiB)&nbsp; TX bytes:175472 (171.3 KiB)</p><p>cpcs0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Link encap:UNSPEC&nbsp; HWaddr 05-60-FF-00-00-00-00-00-00-00-00-00-00-00-00-00<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [NO FLAGS]&nbsp; MTU:65535&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:0 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:0 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:0 (0.0 B)&nbsp; TX bytes:0 (0.0 B)</p><p>dsl0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Link encap:UNSPEC&nbsp; HWaddr 05-60-00-00-00-00-00-00-00-00-00-00-00-00-00-00<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [NO FLAGS]&nbsp; MTU:0&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:0 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:0 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:0 (0.0 B)&nbsp; TX bytes:0 (0.0 B)</p><p>eth0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Link encap:Ethernet&nbsp; HWaddr 14:D6:4D:F9:F8:42<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:2088 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:1065 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:1000<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:231664 (226.2 KiB)&nbsp; TX bytes:180616 (176.3 KiB)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Interrupt:23 Base address:0x2800</p><p>lo&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Link encap:Local Loopback<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:127.0.0.1&nbsp; Mask:255.0.0.0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP LOOPBACK RUNNING&nbsp; MTU:16436&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:60 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:60 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:2944 (2.8 KiB)&nbsp; TX bytes:2944 (2.8 KiB)</p><p>nas_0_0_35&nbsp; &nbsp; &nbsp; Link encap:Ethernet&nbsp; HWaddr 14:D6:4D:F9:F8:44<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:0 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:0 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:1000<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:0 (0.0 B)&nbsp; TX bytes:0 (0.0 B)</p><p>wl0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Link encap:Ethernet&nbsp; HWaddr 14:D6:4D:F9:F8:43<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; BROADCAST MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:0 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:0 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:0 (0.0 B)&nbsp; TX bytes:0 (0.0 B)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Interrupt:25</p><p>&gt; sh -c dmesg<br />Linux version 2.6.8.1 (root@localhost.localdomain) (gcc version 3.4.2) #1 Mon Aug 10 10:12:04 CST 2009<br />Serial flash device: name EN25P32, id 0x1c15, size 4096KB<br />96333W prom init<br />CPU revision is: 00029010<br />Determined physical RAM map:<br /> memory: 00fa0000 @ 00000000 (usable)<br />On node 0 totalpages: 4000<br />&nbsp; DMA zone: 4000 pages, LIFO batch:1<br />&nbsp; Normal zone: 0 pages, LIFO batch:1<br />&nbsp; HighMem zone: 0 pages, LIFO batch:1<br />Built 1 zonelists<br />Kernel command line: root=31:0 ro noinitrd console=ttyS0,115200<br />brcm mips: enabling icache and dcache...<br />Primary instruction cache 16kB, physically tagged, 2-way, linesize 16 bytes.<br />Primary data cache 8kB 2-way, linesize 16 bytes.<br />PID hash table entries: 64 (order 6: 512 bytes)<br />Using 120.000 MHz high precision timer.<br />Dentry cache hash table entries: 4096 (order: 2, 16384 bytes)<br />Inode-cache hash table entries: 2048 (order: 1, 8192 bytes)<br />Memory: 14096k/16000k available (1319k kernel code, 1884k reserved, 196k data, 64k init, 0k highmem)<br />Calibrating delay loop... 239.20 BogoMIPS<br />Mount-cache hash table entries: 512 (order: 0, 4096 bytes)<br />Checking for &#039;wait&#039; instruction...&nbsp; unavailable.<br />NET: Registered protocol family 16<br />Total Flash size: 4096K with 64 sectors<br />File system address: 0xbfc10100<br />Can&#039;t analyze prologue code at 80158764<br />PPP generic driver version 2.4.2<br />NET: Registered protocol family 24<br />Using noop io scheduler<br />bcm963xx_mtd driver v1.0<br />brcmboard: brcm_board_init entry<br />SES: Button Interrupt 0x0 is enabled<br />XXXXXXX: wifiBtn_mapIntr Enter<br />XXXXXX: WIFI: Button Interrupt 0xffff is not enabled<br />Serial: BCM63XX driver $Revision: 3.00 $<br />ttyS0 at MMIO 0xfffe0300 (irq = 10) is a BCM63XX<br />NET: Registered protocol family 2<br />IP: routing cache hash table of 512 buckets, 4Kbytes<br />TCP: Hash tables configured (established 512 bind 1024)<br />NET: Registered protocol family 1<br />NET: Registered protocol family 17<br />Ebtables v2.0 registered<br />NET: Registered protocol family 8<br />NET: Registered protocol family 20<br />802.1Q VLAN Support v1.8 Ben Greear &lt;greearb@candelatech.com&gt;<br />All bugs added by David S. Miller &lt;davem@redhat.com&gt;<br />VFS: Mounted root (squashfs filesystem) readonly.<br />Freeing unused kernel memory: 64k freed<br />Algorithmics/MIPS FPU Emulator v1.5<br />atmapi: module license &#039;Proprietary&#039; taints kernel.<br />adsl: adsl_init entry<br />blaadd: blaa_detect entry<br /> BCMPROCFS v1.0 initialized<br />BCM6338A2 Ethernet Network Device v0.3 Aug 10 2009 10:10:23<br />Config Internal PHY Plus Switch Through GPIO2MDIO<br />Link up, time=0(ms)<br />BCM63xx_ENET: 100 MB Full-Duplex (auto-neg)<br />switch type = BCM5325E.<br />dgasp: kerSysRegisterDyingGaspHandler: eth0 registered<br />eth0: MAC Address: 14:D6:4D:F9:F8:42<br />eth0 Link UP.<br />SDIOH mode switch from 1 to 2<br />available commands: sdio sdioh</p><p>---SDIO init SUCCEEDED--- blockmode capable</p><p>chipid 0x4014312<br />chip is bcm4312, use 512 bytes blksize<br />bcmsdh_attach, sdioh_attach successful, bcmsdh-&gt;sdioh 0x80f80c00<br />wl: srom not detected, using main memory mapped srom info (wombo board)<br />wl0: wlc_attach: use mac addr from the system pool by id: 0x776c0000<br />wl0: MAC Address: 14:D6:4D:F9:F8:43<br />wl0: Broadcom BCM4318 802.11 Wireless Controller 4.174.64.19.cpe1.0sd-s1<br />dgasp: kerSysRegisterDyingGaspHandler: wl0 registered<br />Trying to free free IRQ25<br />BcmAdsl_Initialize=0xC00633D8, g_pFnNotifyCallback=0xC007C294<br />AnnexCParam=0x7FFF7EA8 AnnexAParam=0x00000980 adsl2=0x00000000<br />pSdramPHY=0xA0FFFFF8, 0x0 0x1040<br />AdslCoreHwReset: AdslOemDataAddr = 0xA0FFD3D4<br />AnnexCParam=0x7FFF7EA8 AnnexAParam=0x00000980 adsl2=0x00000000<br />dgasp: kerSysRegisterDyingGaspHandler: dsl0 registered<br />ATM proc init !!!<br />ip_tables: (C) 2000-2002 Netfilter core team<br />ip_conntrack version 2.1 (125 buckets, 0 max) - 376 bytes per conntrack<br />ip_conntrack_pptp version 2.1 loaded<br />ip_nat_pptp version 2.0 loaded<br />ip_ct_h323: init success<br />ip_nat_h323: init success<br />ip_conntrack_rtsp v0.01 loading<br />##################<br />ip_url_filter_ops: load success<br />ip_nat_rtsp v0.01 loading<br />device eth0 entered promiscuous mode<br />br0: port 1(eth0) entering learning state<br />br0: topology change detected, propagating<br />br0: port 1(eth0) entering forwarding state<br />device nas_0_0_35 entered promiscuous mode<br />br0: port 2(nas_0_0_35) entering learning state<br />br0: topology change detected, propagating<br />br0: port 2(nas_0_0_35) entering forwarding state<br />device eth0 left promiscuous mode<br />br0: port 1(eth0) entering disabled state<br />device eth0 entered promiscuous mode<br />br0: port 1(eth0) entering learning state<br />br0: topology change detected, propagating<br />br0: port 1(eth0) entering forwarding state<br />ip_url_filter_ops: unload success<br />##################<br />ip_url_filter_ops: load success</p>											<p class="post-edited">(Last edited by <strong>spadkins</strong> on 29 Dec 2011, 18:13)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p149464">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">MBS</div>
					<div class="post-datetime">
						24 Nov 2011, 10:52					</div>
				</div>
				<div class="post-content content">
					<p>from the wiki (<a href="http://wiki.openwrt.org/toh/d-link/dsl-2640u#flashing.via.serial.cable">http://wiki.openwrt.org/toh/d-link/dsl- … rial.cable</a>):<br />Set up tftpd on your machine, then access router&#039;s CFE, and run<br /></p><div class="codebox"><pre><code>cfe&gt; flashimage ip_of_tftpd:openwrt-DSL2640B-squashfs-cfe.bin</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p179131">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">lute</div>
					<div class="post-datetime">
						23 Sep 2012, 19:32					</div>
				</div>
				<div class="post-content content">
					<p>Spadkins, i had spended one morning downloading GPL Dlink source code, modifying that for &quot;firmware not name recognizing&quot; and then compiling it .</p><p>The result was a firmware image , ready to flash from ( in theory)&nbsp; any original firmware of DSL-2640B&nbsp; and after that, your router will be ready to flash OPENWRT image from TFTP server via TELNET as described on the OPENWRT WIKI PAGE.</p><p>** ON MY CASE **</p><p>1- First i downloaded DSL-2640B B2 FW UK_4.00 for UK&nbsp; from <a href="http://tsd.dlink.com.tw/downloads2008detailgo.asp">http://tsd.dlink.com.tw/downloads2008detailgo.asp</a></p><p>2- Then i flash it , and then , i flash the &quot;source code modified and compiled&quot; you can get the firmware image that i had&nbsp; build here :</p><p><a href="http://www.hagotuweb.com/EU_DSL-2640B_EU_3.07_306064600_cfe_fs_kernel_3.06L.06">http://www.hagotuweb.com/EU_DSL-2640B_E … l_3.06L.06</a></p><p>3- then i did a telnet and flash the OPENWRT IMAGE via tftp.</p><p>NICE!! IT WORKS.</p>											<p class="post-edited">(Last edited by <strong>lute</strong> on 23 Sep 2012, 19:37)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p179675">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">elwylly</div>
					<div class="post-datetime">
						28 Sep 2012, 22:50					</div>
				</div>
				<div class="post-content content">
					<p>Hi Lute,</p><p>I followed your procedure but I wasn&#039;t very lucky. Well, I probably did something wrong.</p><p>Actually, I got the firmware v3.06 correctly uploaded. Then, I connected through telnet to the DLINK and executed in there the command tftp -g -f openwrt-DSL2640B-squashfs-cfe.bin 192.168.1.2</p><p>I got the messages from the tftp image get process, got disconnected and then nothing. Power and status leds are green but I have no DHCP and if I try to connect to 192.168.1.1 I get no reply. Any idea what it might be the problem? I guess now the only way to connect is through console serial, right?</p><p>Thanks!!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p185605">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">pbat</div>
					<div class="post-datetime">
						9 Dec 2012, 12:37					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>lute wrote:</cite><blockquote><p>1- First i downloaded DSL-2640B B2 FW UK_4.00 for UK&nbsp; from <a href="http://tsd.dlink.com.tw/downloads2008detailgo.asp">http://tsd.dlink.com.tw/downloads2008detailgo.asp</a></p></blockquote></div><p>It&#039;s probably obvious to you, but for the sake of readers (I for sure got confused at first): you have a different hardware revision (B2) than spadkins (B3). Your modified firmware won&#039;t work with B3 (I tried on mine, it is not accepted). Notice B2 was already known to run openwrt (but still, thanks for the details you reported on the &quot;software only&quot; method): <a href="http://wiki.openwrt.org/toh/d-link/dsl-2640u">http://wiki.openwrt.org/toh/d-link/dsl-2640u</a></p><p>That clearly doesn&#039;t mean your procedure could not work for B3, I will try when I have time... but it would be probably interesting to know if you did something particular in the &quot;source code modified and compiled&quot; step.</p><p>elwylly: you have a B2 (no external serial port) right?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p185741">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">Joeyxl</div>
					<div class="post-datetime">
						11 Dec 2012, 06:33					</div>
				</div>
				<div class="post-content content">
					<p>does anyone know if this method will work on a dsl-2740B F1? im having issues flashing as well</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p185996">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">pbat</div>
					<div class="post-datetime">
						14 Dec 2012, 08:23					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Joeyxl wrote:</cite><blockquote><p>does anyone know if this method will work on a dsl-2740B F1? im having issues flashing as well</p></blockquote></div><p>Don&#039;t know... never heard about this rev, and there seem to be no GPL sources for its firmware on tsd.dlink.com. There are some with no rev. number specified, though, and they could possibly be general ones. You could check if they do have a &quot;EU_DSL-2640B_F1&quot; folder inside the &quot;targets&quot; dir, inside the &quot;EU_DSL-2640B_*_consumer.tar.gz&quot; (replace &quot;*&quot; with anything) archive, inside the main archive you download (at least, that was the structure in the one I downloaded for B3.</p><p>For B3, I just was able to recompile an image with the firmware check disabled, I will test it soon (at the moment, I don&#039;t have my DSL-2540B at hand).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p195443">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">pbat</div>
					<div class="post-datetime">
						20 Mar 2013, 00:29					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>pbat wrote:</cite><blockquote><p>For B3, I just was able to recompile an image with the firmware check disabled, I will test it soon (at the moment, I don&#039;t have my DSL-2540B at hand).</p></blockquote></div><p>WARNING: this post is _only_ about rev. B3.</p><p>I finally tried my recompiled image. It was loaded simply fine through the http interface (message &quot;Uploading is in progress. The DSL Router will reboot upon completion. Please wait... &quot;), but it doesn&#039;t solve the problem - I still get an error (&quot;Fatal error during image uploading.&quot;) if I try to load an openwrt firmware via the http interface, and if I try with tftp, the router simply reboots back in its previous state.<br />But the craziest part is that I get a &quot;fatal error&quot; if I try to upload a firmware from d-link (downloaded from the product support page: <a href="http://www.dlink.com.my/support/support_detail.asp?idProduct=414">http://www.dlink.com.my/support/support … roduct=414</a> ). The upload functionality is not simply broken, though: I&#039;m still able to reupload my modified image.</p><p>For the moment, I&#039;m giving up. If anyone wants to try, here:<br /><a href="http://pietrobattiston.it/t/EU_DSL-2640B_B3_EU_5.0.0_312011R00_cfe_fs_kernel_3.12L.01.">http://pietrobattiston.it/t/EU_DSL-2640 … _3.12L.01.</a><br />is the firmware image compiled from source after applying the modification described in <a href="https://dev.openwrt.org/ticket/5472#comment:4">https://dev.openwrt.org/ticket/5472#comment:4</a> .</p><p>But (before trying it) I would ask someone to simply try to upload to the router the image (even just through the http interface) from the official website:<br /><a href="http://www.dlink.com.my/support/Support_download.asp?idsupport=964">http://www.dlink.com.my/support/Support … upport=964</a><br />and report if it is accepted.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p195446">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">pbat</div>
					<div class="post-datetime">
						20 Mar 2013, 00:37					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>pbat wrote:</cite><blockquote><p>For the moment, I&#039;m giving up. If anyone wants to try, here:<br /><a href="http://pietrobattiston.it/t/EU_DSL-2640B_B3_EU_5.0.0_312011R00_cfe_fs_kernel_3.12L.01.">http://pietrobattiston.it/t/EU_DSL-2640 … _3.12L.01.</a><br />is the firmware image compiled from source after applying the modification described in <a href="https://dev.openwrt.org/ticket/5472#comment:4">https://dev.openwrt.org/ticket/5472#comment:4</a> .</p></blockquote></div><p>By the way: setting up the system for the compilation was pretty annoying, but now it&#039;s ready, if somebody has some clever idea of how to modify the sources and sends me a patch, I can compile them and upload the resulting image.<br />(though if one wants to do many different tests, I&#039;ll rather share my Virtualbox image in which to run the compilation)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p215322">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">saraj</div>
					<div class="post-datetime">
						21 Oct 2013, 16:17					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>lute wrote:</cite><blockquote><p>Spadkins, i had spended one morning downloading GPL Dlink source code, modifying that for &quot;firmware not name recognizing&quot; and then compiling it .</p><p>The result was a firmware image , ready to flash from ( in theory)&nbsp; any original firmware of DSL-2640B&nbsp; and after that, your router will be ready to flash OPENWRT image from TFTP server via TELNET as described on the OPENWRT WIKI PAGE.</p><p>** ON MY CASE **</p><p>1- First i downloaded DSL-2640B B2 FW UK_4.00 for UK&nbsp; from <a href="http://tsd.dlink.com.tw/downloads2008detailgo.asp">http://tsd.dlink.com.tw/downloads2008detailgo.asp</a></p><p>2- Then i flash it , and then , i flash the &quot;source code modified and compiled&quot; you can get the firmware image that i had&nbsp; build here :</p><p><a href="http://www.hagotuweb.com/EU_DSL-2640B_EU_3.07_306064600_cfe_fs_kernel_3.06L.06">http://www.hagotuweb.com/EU_DSL-2640B_E … l_3.06L.06</a></p><p>3- then i did a telnet and flash the OPENWRT IMAGE via tftp.</p><p>NICE!! IT WORKS.</p></blockquote></div><br /><p>Link from hagotuweb.co not valid. Plese REPOST.</p>											<p class="post-edited">(Last edited by <strong>saraj</strong> on 21 Oct 2013, 16:18)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p225422">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">jjx</div>
					<div class="post-datetime">
						16 Feb 2014, 00:15					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>I&#039;m write the wiki about DSL-2640B H/W T1 hardware:</p><p><a href="http://wiki.openwrt.org/toh/d-link/dsl-2640b">http://wiki.openwrt.org/toh/d-link/dsl-2640b</a></p><p>thanks</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p230866">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">pbat</div>
					<div class="post-datetime">
						21 Apr 2014, 02:08					</div>
				</div>
				<div class="post-content content">
					<p>Hello jjx,</p><p>sorry for not answering before, but... is this _really_ a different hardware, requiring a new wiki page?!</p><p>I can&#039;t find any &quot;DSL-2640B H/W T1&quot; on the D-Link website, neither in the ftp firmwares repositories:<br /><a href="ftp://ftp.dlink.eu/Products/dsl/">ftp://ftp.dlink.eu/Products/dsl/</a><br /><a href="ftp://ftp.dlink.eu/Products/dsl/dsl-2640b/driver_software/">ftp://ftp.dlink.eu/Products/dsl/dsl-264 … _software/</a></p><p>So maybe the two wiki pages should&nbsp; be merged... what do you think?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p230890">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">pbat</div>
					<div class="post-datetime">
						21 Apr 2014, 13:03					</div>
				</div>
				<div class="post-content content">
					<p>Quick update: (based on the D-Link sources for the two boards) rev. B3 seems to have major differences from rev. B2. In particular:</p><ul><li><p>SoC: 6338 rather than 6348</p></li><li><p>wireless: 4312 instead than 4318</p></li><li><p>a &quot;psi_size&quot; of 48 - but I have no idea of what this means</p></li></ul><p>In short: do not try to flash the current B2 firmware on a B3 - id doesn&#039;t work, luckily (I guess if it did, it would brick your device).</p>											<p class="post-edited">(Last edited by <strong>pbat</strong> on 21 Apr 2014, 13:05)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p231734">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">gaucho</div>
					<div class="post-datetime">
						29 Apr 2014, 19:02					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>elwylly wrote:</cite><blockquote><p>Hi Lute,</p><p>I followed your procedure but I wasn&#039;t very lucky. Well, I probably did something wrong.</p><p>Actually, I got the firmware v3.06 correctly uploaded. Then, I connected through telnet to the DLINK and executed in there the command tftp -g -f openwrt-DSL2640B-squashfs-cfe.bin 192.168.1.2</p><p>I got the messages from the tftp image get process, got disconnected and then nothing. Power and status leds are green but I have no DHCP and if I try to connect to 192.168.1.1 I get no reply. Any idea what it might be the problem? I guess now the only way to connect is through console serial, right?</p><p>Thanks!!</p></blockquote></div><p>you don&#039;t need the serial cable. if you press the reset button for 30 seconds, and then open the browser on 192.168.1.1, you fill find a simple html page where you can select the original DLINK firmware and flash it.</p>											<p class="post-edited">(Last edited by <strong>gaucho</strong> on 29 Apr 2014, 19:02)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p231738">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">gaucho</div>
					<div class="post-datetime">
						29 Apr 2014, 19:23					</div>
				</div>
				<div class="post-content content">
					<p>i have the B2 revision of the DSL-2640B.<br />I downloaded the openwrt firmware from <a href="http://downloads.openwrt.org/backfire/10.03.1/brcm63xx/">http://downloads.openwrt.org/backfire/10.03.1/brcm63xx/</a><br />( <a href="http://downloads.openwrt.org/backfire/10.03.1/brcm63xx/openwrt-DSL2640B-squashfs-cfe.bin">http://downloads.openwrt.org/backfire/1 … fs-cfe.bin</a>)</p><p>I downloaded the modified dlink firmware (created as described on the wiki page of openwrt <a href="http://wiki.openwrt.org/toh/d-link/dsl-2640u">http://wiki.openwrt.org/toh/d-link/dsl-2640u</a> ) from <a href="http://ul.to/3ygyfth0">http://ul.to/3ygyfth0</a><br />since this link is banned in my country, i re-uploaded here: <a href="http://www.speedyshare.com/ZeDBc/EU-DSL-2640B-EU-4.00-310022900.zip">http://www.speedyshare.com/ZeDBc/EU-DSL … 022900.zip</a></p><p>I downloaded tftpd from here: <a href="http://tftpd32.jounin.net/">http://tftpd32.jounin.net/</a></p><p>I setted up my pc on the static ip 192.168.1.10, and i connected via ethernet cable the dlink router.</p><p>Once uploaded the modified dlink firmware using the router webpage, i started the tftpd on the computer and i copied the openwrt firmware on the tftp folder, then i logged via telnet, and i used tftp as reported on the wikipage.<br />this is the log of my actions via telnet, where you can read the command that i hitted:</p><div class="codebox"><pre><code>BCM96348 ADSL Router
Login: admin
Password:
&gt; tftp
BusyBox v1.00 (2012.01.11-13:34+0000) multi-call binary

Usage: tftp [OPTION]... tftp_server_ip

Update firmware image and configuration data from OR backup configuration
data to a tftp server.

Options:
-g      Get file. (Update image/configuration data)
-p      Put file. (backup configuration data)
-f      remote file name.
-t      i for image and c for configuration data.


&gt; tftp -ti -g -f openwrt-DSL2640B-squashfs-cfe.bin 192.168.1.10
bcmUploadPrepare ... curPid[340] ifPid[0] ifName[br0]

Number of processes: 23
 12:01am  up 1 min,
load average: 1 min:0.06, 5 min:0.03, 15 min:0.00
              total         used         free       shared      buffers
  Mem:        14004        13056          948            0         1860
 Swap:            0            0            0
Total:        14004        13056          948
  PID  Uid     VmSize Stat Command
    1 admin       264 S   init
    2 admin           SWN [ksoftirqd/0]
    3 admin           SW&lt; [events/0]
    4 admin           SW&lt; [khelper]
    5 admin           SW&lt; [kblockd/0]
   17 admin           SW  [pdflush]
   18 admin           SW  [pdflush]
   19 admin           SW  [kswapd0]
   20 admin           SW&lt; [aio/0]
   25 admin           SW  [mtdblockd]
   34 admin       300 S   -sh
   70 admin      1624 S   cfm
  106 admin       152 S   pvc2684d
  210 admin       268 S   dhcpd
  220 admin       180 S   sntp -s ntp.dlink.com.tw -s None -t Greenwich Mean Ti
  251 admin      1852 S   httpd
  252 admin      1620 S   cfm
  335 admin      1640 S   telnetd
  336 admin      1660 S   telnetd
  339 admin       260 S   sh -c tftp -ti -g -f openwrt-DSL2640B-squashfs-cfe.bi
  340 admin       252 S   tftp -ti -g -f openwrt-DSL2640B-squashfs-cfe.bin 192.
  343 admin       260 S   sh -c ps &gt; /var/psList
  344 admin       252 R   ps
kill process [pid: 210] [dhcpd]...
kill process [pid: 220] [sntp]...
kill process [pid: 339] [sh]...
&gt; iptables v1.2.11: can&#039;t initialize iptables table `filter&#039;: iptables who? (do
you need to insmod?)
Perhaps iptables or your kernel needs to be upgraded.

Remaining modules:
wl 928896 0 - Live 0xc01aa000
bcm_enet 24320 0 - Live 0xc003f000
bcmprocfs 14656 0 - Live 0xc000c000
br2684 65984 0 - Live 0xc002e000
blaa_dd 7104 0 - Live 0xc000a000
adsldd 143024 0 - Live 0xc005f000
atmapi 59296 3 br2684,blaa_dd,adsldd, Live 0xc001f000

Memory info:
Number of processes: 21
 12:01am  up 1 min,
load average: 1 min:0.06, 5 min:0.03, 15 min:0.00
              total         used         free       shared      buffers
  Mem:        14004        12988         1016            0         1892
 Swap:            0            0            0
Total:        14004        12988         1016
... done bcmUploadPrepare

Allocating 2752524 bytes for broadcom image.
Memory allocated
Total image size: 2752516
Skip check model name</code></pre></div><p>after this i had to wait few minutes, then the router started to answer to ping and to respond to <a href="http://192.168.1.1">http://192.168.1.1</a>.</p><p>it works! even if i lost 1 entire day to find the right files. and the precise commands to use.</p><br /><p>note: if do you need the ordiginal dlink FW version you can find them here: <a href="http://tsd.dlink.com.tw/downloads2008.asp">http://tsd.dlink.com.tw/downloads2008.asp</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p351890">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">axf</div>
					<div class="post-datetime">
						14 Feb 2017, 09:51					</div>
				</div>
				<div class="post-content content">
					<p>In case anyone is still interested in this device, here are compiled firmware images of 3C GPL firmware for DSL-2640U, h/w B2: archive.org/download/DSL-2640U_3-06-04-3C_GPL_firmware (direct link to modified firmware that skips model name check: archive.org/download/DSL-2640U_3-06-04-3C_GPL_firmware/RU_DSL-2640U_3-06-04-3C_GPL_no_check.BIN . </p><p>Here are brief instructions on how to do it from scratch (if you are going to use compiled firmware, the compilation stage can be obviously skipped):</p><p>Hardware: D-Link DSL-2640U (P/N ISL2640UBRU0.B2G, H/W version B2, original F/W version RU_3-06-04-1C00)<br />GPL firmware version: RU_DSL-2640U_3-06-04-3C_GPL (file name RU_DSL-2640U_3-06-04-3C_GPL.tar.gz, size 103781274 bytes, md5 hash&nbsp; 989762a64aec9554c71ace3b7c1d9a7d)</p><p>*) Install Red Hat 9.0, unpack firmware, install sources and tools as specified in instructions.</p><p>*) Remove model name check in firmware. File RU_DSL-2640U_3-06-04-3C_src/userapps/opensource/ftpd/fwsyscall.c, line 300:<br />replace if(result==0) with if(1).</p><p>patch:<br /></p><div class="codebox"><pre><code>--- RU_DSL-2640U_3-06-04-3C_original/userapps/opensource/ftpd/fwsyscall.c    2006-09-16 06:21:03.000000000 +0400
+++ RU_DSL-2640U_3-06-04-3C_no_check/userapps/opensource/ftpd/fwsyscall.c    2017-02-05 01:19:41.906250000 +0300
@@ -297,7 +297,7 @@ UPLOAD_RESULT verifyTag(PFILE_TAG pTag,
 
     //If new firmware model name is &quot;cj86gji4adsl1234cj86gji4adsl1234&quot; then we skip check model name
     result=memcmp(((char*)pTag + TAG_LEN + totalImageSize-32), &quot;cj86gji4adsl1234cj86gji4adsl1234&quot;,32);
-    if(result==0)//skip check model name
+    if(1)//skip check model name
     {
         printf(&quot;Skip check model name\n&quot;);     
     }</code></pre></div><p>*) Compile firmware.</p><p>*) Set up tftpd server and run it.</p><p>*) Flash patched gpl firmware using telnet (web interface is somewhat buggy).<br />#telnet router_ip<br />#tftp -g -t i -f patched_fw_name client_ip</p><p>*) Flash OpenWRT firmware using telnet.<br />Same as above.<br />NB: For this router (h/w version B2) last OpenWRT version in 10.03.1: file name openwrt-DSL2640B-squashfs-cfe.bin, size 2752516 bytes, md5 hash c610f83f714db8abdd85b74aac53ff31).</p><p>Debricking:<br />*) Set up client computer ip to 192.168.1.2.<br />*) Press and hold &quot;reset&quot; button.<br />*) Turn on router.<br />*) Keep holding &quot;reset&quot; button for 10 seconds. Power indicator should be red, status green, connected lan port - green and blinking.<br />*) Connect to 192.168.1.1 with web browser. A minimalistic firmware flash page will open.<br />*) Flash firmware: pre-compiled binary, compiled from source or patched. OpenWRT won&#039;t be accepted at this stage.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>