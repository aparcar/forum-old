<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Unable to detect USB Stick Attached to My Router?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 19 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p283611">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">Ghanem</div>
					<div class="post-datetime">
						15 Jul 2015, 10:58					</div>
				</div>
				<div class="post-content content">
					<p>Hi, </p><p>There are two problems that I&#039;d like to share with you guys and hopefully fix:</p><p>1. There&#039;s a very small lamp in my USB stick that, once attached to any electronic device, it lights up. However, when I attach it to my router, it stays off. Does this mean the two ports of my router aren&#039;t working? </p><br /><p>2. I have installed:</p><p>kmod-scsi-core <br />kmod-usb-storage<br />kmod-usb-storage-extras<br />block-mount (here it says: * resolve_conffiles: Existing conffile /etc/config/fstab is different from the conffile in the new package. The new conffile will be placed at /etc/config/fstab-opkg.)</p><p>Here&#039;s the output of ls /dev:<br /><span class="postimg"><img src="http://s27.postimg.org/ib8kvjy4z/mips1.png" alt="http://s27.postimg.org/ib8kvjy4z/mips1.png" /></span></p><p>And here&#039;s the output of dmesg:<br /></p><div class="codebox"><pre><code>Linux version 2.6.37.1 (rimeh@rimeh-X555LD) (gcc version 4.5.2 (Linaro GCC 4.5-2011.02-0) ) #1 Sat Jun 6 14:35:57 CET 2015
prom: fw_arg0=00000001, fw_arg1=87f46fb0, fw_arg2=07f473b0, fw_arg3=00000000
env[0]: memsize=128
env[1]: initrd_start=0x00000000
env[2]: initrd_size=0x0
env[3]: flash_start=0x00000000
env[4]: flash_size=0x2000000
env[0]: memsize=128
env[1]: initrd_start=0x00000000
env[2]: initrd_size=0x0
env[3]: flash_start=0x00000000
env[4]: flash_size=0x2000000
CPU revision is: 0001974c (MIPS 74Kc)
Ralink RT3883   ver:1 eco:5 running at 500.00 MHz
Determined physical RAM map:
 memory: 08000000 @ 00000000 (usable)
Initrd not found or empty - disabling initrd
Zone PFN ranges:
  Normal   0x00000000 -&gt; 0x00008000
Movable zone start PFN for each node
early_node_map[1] active PFN ranges
    0: 0x00000000 -&gt; 0x00008000
On node 0 totalpages: 32768
free_area_init_node: node 0, pgdat 80216e00, node_mem_map 81000000
  Normal zone: 256 pages used for memmap
  Normal zone: 0 pages reserved
  Normal zone: 32512 pages, LIFO batch:7
pcpu-alloc: s0 r0 d32768 u32768 alloc=1*32768
pcpu-alloc: [0] 0 
Built 1 zonelists in Zone order, mobility grouping on.  Total pages: 32512
Kernel command line:  console=ttyS1,57600 board=NA900 mtdparts=nand:512k(u-boot)ro,128k(config)ro,64k(factory)ro,128k(config_default)ro,128k(user_storage),4096k(kernel),8192k(rootfs),11264k(rootfs_data),8192k(user_data),64k(pid)ro rootfstype=squashfs,jffs2
PID hash table entries: 512 (order: -1, 2048 bytes)
Dentry cache hash table entries: 16384 (order: 4, 65536 bytes)
Inode-cache hash table entries: 8192 (order: 3, 32768 bytes)
Primary instruction cache 64kB, VIPT, 4-way, linesize 32 bytes.
Primary data cache 32kB, 4-way, PIPT, no aliases, linesize 32 bytes
Writing ErrCtl register=00000000
Readback ErrCtl register=00000000
Memory: 127504k/131072k available (1823k kernel code, 3568k reserved, 317k data, 152k init, 0k highmem)
SLUB: Genslabs=9, HWalign=32, Order=0-3, MinObjects=0, CPUs=1, Nodes=1
NR_IRQS:48
console [ttyS1] enabled
Calibrating delay loop... 249.85 BogoMIPS (lpj=1249280)
pid_max: default: 32768 minimum: 301
Mount-cache hash table entries: 512
NET: Registered protocol family 16
MIPS: machine is Sercomm NA900
bio: create slab &lt;bio-0&gt; at 0
i2c-gpio i2c-gpio: using pins 1 (SDA) and 2 (SCL)
Switching to clocksource MIPS
NET: Registered protocol family 2
IP route cache hash table entries: 1024 (order: 0, 4096 bytes)
TCP established hash table entries: 4096 (order: 3, 32768 bytes)
TCP bind hash table entries: 4096 (order: 2, 16384 bytes)
TCP: Hash tables configured (established 4096 bind 4096)
TCP reno registered
UDP hash table entries: 256 (order: 0, 4096 bytes)
UDP-Lite hash table entries: 256 (order: 0, 4096 bytes)
NET: Registered protocol family 1
squashfs: version 4.0 (2009/01/31) Phillip Lougher
JFFS2 version 2.2 (NAND) (ZLIB) (RTIME) (CMODE_PRIORITY) (c) 2001-2006 Red Hat, Inc.
msgmni has been set to 249
io scheduler noop registered
io scheduler deadline registered (default)
Serial: 8250/16550 driver, 2 ports, IRQ sharing disabled
serial8250: ttyS0 at MMIO 0x10000500 (irq = 13) is a 16550A
serial8250: ttyS1 at MMIO 0x10000c00 (irq = 20) is a 16550A
ra_nand_probe: alloc 800, at 87841000 , btt(87841600, 200), mtd:87841000
10 cmdlinepart partitions found on MTD device nand
Creating 10 MTD partitions on &quot;nand&quot;:
0x000000000000-0x000000080000 : &quot;u-boot&quot;
0x000000080000-0x0000000a0000 : &quot;config&quot;
0x0000000a0000-0x0000000b0000 : &quot;factory&quot;
0x0000000b0000-0x0000000d0000 : &quot;config_default&quot;
0x0000000d0000-0x0000000f0000 : &quot;user_storage&quot;
0x0000000f0000-0x0000004f0000 : &quot;kernel&quot;
ra_nand_block_checkbad: offs:1f8000 tag: BAD 
0x0000004f0000-0x000000cf0000 : &quot;rootfs&quot;
mtd: partition &quot;rootfs&quot; set to be root filesystem
0x000000cf0000-0x0000017f0000 : &quot;rootfs_data&quot;
0x0000017f0000-0x000001ff0000 : &quot;user_data&quot;
0x000001ff0000-0x000002000000 : &quot;pid&quot;
ramips_mdio: probed
eth0: AR8236 switch driver attached.
rtc-s35390a 0-0030: rtc core: registered rtc-s35390a as rtc0
TCP westwood registered
NET: Registered protocol family 17
802.1Q VLAN Support v1.8 Ben Greear &lt;greearb@candelatech.com&gt;
All bugs added by David S. Miller &lt;davem@redhat.com&gt;
rtc-s35390a 0-0030: setting system clock to 2015-07-15 15:18:34 UTC (1436973514)
VFS: Mounted root (squashfs filesystem) readonly on device 31:6.
Freeing unused kernel memory: 152k freed
input: gpio-buttons as /devices/platform/gpio-buttons/input/input0
Button Hotplug driver version 0.4.3
Registered led device: na9xx:red:power
Registered led device: na9xx:green:wan
Registered led device: na9xx:red:wifi
Registered led device: na9xx:green:wifi
Registered led device: na9xx:green:service
Registered led device: na9xx:green:lan
Registered led device: na9xx:green:zwave
Registered led device: na9xx:green:usb1
Registered led device: na9xx:green:usb2
eth0: link up (100Mbps/Full duplex)
Empty flash at 0x000e0254 ends at 0x000e0400
Empty flash at 0x000e2c30 ends at 0x000e2e00
Empty flash at 0x003de484 ends at 0x003de600
Empty flash at 0x003e1f54 ends at 0x003e2000
jffs2_scan_inode_node(): CRC failed on node at 0x00438bd0: Read 0xffffffff, calculated 0x6093f262
Empty flash at 0x00438c14 ends at 0x00438e00
Empty flash at 0x0054fc44 ends at 0x0054fe00
Empty flash at 0x005a0578 ends at 0x005a0600
JFFS2 notice: (484) jffs2_build_xattr_subsystem: complete building xattr subsystem, 1 of xdatum (0 unchecked, 0 orphan) and 4 of xref (0 dead, 0 orphan) found.
Compat-wireless backport release: compat-wireless-2011-05-23
Backport based on wireless-testing.git master-2011-05-27
device eth0.1 entered promiscuous mode
device eth0 entered promiscuous mode
br-lan: port 1(eth0.1) entering forwarding state
br-lan: port 1(eth0.1) entering forwarding state
cfg80211: Calling CRDA to update world regulatory domain
SCSI subsystem initialized
usbcore: registered new interface driver usbfs
usbcore: registered new interface driver hub
usbcore: registered new device driver usb
ieee80211 phy0: Selected rate control algorithm &#039;minstrel_ht&#039;
Registered led device: rt2800pci-phy0::radio
Registered led device: rt2800pci-phy0::assoc
Registered led device: rt2800pci-phy0::quality
PPP generic driver version 2.4.2
br-lan: port 1(eth0.1) entering forwarding state
br-lan: port 1(eth0.1) entering forwarding state
br-lan: port 1(eth0.1) entering forwarding state
ip_tables: (C) 2000-2006 Netfilter Core Team
NET: Registered protocol family 24
ehci_hcd: USB 2.0 &#039;Enhanced&#039; Host Controller (EHCI) Driver
rt3883-ehci rt3883-ehci: Ralink RT3883 built-in EHCI controller
rt3883-ehci rt3883-ehci: new USB bus registered, assigned bus number 1
cfg80211: World regulatory domain updated:
cfg80211:     (start_freq - end_freq @ bandwidth), (max_antenna_gain, max_eirp)
cfg80211:     (2402000 KHz - 2472000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)
cfg80211:     (2457000 KHz - 2482000 KHz @ 20000 KHz), (300 mBi, 2000 mBm)
cfg80211:     (2474000 KHz - 2494000 KHz @ 20000 KHz), (300 mBi, 2000 mBm)
cfg80211:     (5170000 KHz - 5250000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)
cfg80211:     (5735000 KHz - 5835000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)
rt3883-ehci rt3883-ehci: irq 26, io mem 0x101c0000
rt3883-ehci rt3883-ehci: USB 2.0 started, EHCI 1.00
hub 1-0:1.0: USB hub found
hub 1-0:1.0: 2 ports detected
nf_conntrack version 0.5.0 (1994 buckets, 7976 max)
ohci_hcd: USB 1.1 &#039;Open&#039; Host Controller (OHCI) Driver
rt3883-ohci rt3883-ohci: Ralink RT3883 built-in OHCI controller
rt3883-ohci rt3883-ohci: new USB bus registered, assigned bus number 2
rt3883-ohci rt3883-ohci: irq 26, io mem 0x101c1000
hub 2-0:1.0: USB hub found
hub 2-0:1.0: 2 ports detected
Initializing USB Mass Storage driver...
usbcore: registered new interface driver usb-storage
USB Mass Storage support registered.
ramips-wdt: timeout value 60 must be 0 &lt; timeout &lt; 25
JFFS2 notice: (485) check_node_data: wrong data CRC in data node at 0x003e1bd8: read 0xd472de5f, calculated 0xd312c2aa.
JFFS2 notice: (485) check_node_data: wrong data CRC in data node at 0x002fb69c: read 0xc5de6627, calculated 0x51a98627.
JFFS2 notice: (485) check_node_data: wrong data CRC in data node at 0x005a0000: read 0xfa68ef76, calculated 0x86bbb84d.
usbcore: registered new interface driver ums-alauda
usbcore: registered new interface driver ums-cypress
usbcore: registered new interface driver ums-datafab
usbcore: registered new interface driver ums-freecom
usbcore: registered new interface driver ums-isd200
usbcore: registered new interface driver ums-jumpshot
usbcore: registered new interface driver ums-karma
usbcore: registered new interface driver ums-sddr09
usbcore: registered new interface driver ums-sddr55
usbcore: registered new interface driver ums-usbat</code></pre></div><p>And here&#039;s the output of fdisk -l:<br /></p><div class="codebox"><pre><code>Disk /dev/mtdblock0: 0 MB, 524288 bytes
255 heads, 63 sectors/track, 0 cylinders
Units = cylinders of 16065 * 512 = 8225280 bytes
Disk identifier: 0x100001a8

Disk /dev/mtdblock0 doesn&#039;t contain a valid partition table

Disk /dev/mtdblock1: 0 MB, 131072 bytes
255 heads, 63 sectors/track, 0 cylinders
Units = cylinders of 16065 * 512 = 8225280 bytes
Disk identifier: 0x30303034

Disk /dev/mtdblock1 doesn&#039;t contain a valid partition table

Disk /dev/mtdblock2: 0 MB, 65536 bytes
255 heads, 63 sectors/track, 0 cylinders
Units = cylinders of 16065 * 512 = 8225280 bytes
Disk identifier: 0xffffffff

Disk /dev/mtdblock2 doesn&#039;t contain a valid partition table

Disk /dev/mtdblock3: 0 MB, 131072 bytes
255 heads, 63 sectors/track, 0 cylinders
Units = cylinders of 16065 * 512 = 8225280 bytes
Disk identifier: 0x00000000

Disk /dev/mtdblock3 doesn&#039;t contain a valid partition table

Disk /dev/mtdblock4: 0 MB, 131072 bytes
255 heads, 63 sectors/track, 0 cylinders
Units = cylinders of 16065 * 512 = 8225280 bytes
Disk identifier: 0xffffffff

Disk /dev/mtdblock4 doesn&#039;t contain a valid partition table

Disk /dev/mtdblock5: 4 MB, 4194304 bytes
255 heads, 63 sectors/track, 0 cylinders
Units = cylinders of 16065 * 512 = 8225280 bytes
Disk identifier: 0x96c950b4

Disk /dev/mtdblock5 doesn&#039;t contain a valid partition table

Disk /dev/mtdblock6: 8 MB, 8388608 bytes
255 heads, 63 sectors/track, 1 cylinders
Units = cylinders of 16065 * 512 = 8225280 bytes
Disk identifier: 0xb6838f38

Disk /dev/mtdblock6 doesn&#039;t contain a valid partition table

Disk /dev/mtdblock7: 11 MB, 11534336 bytes
255 heads, 63 sectors/track, 1 cylinders
Units = cylinders of 16065 * 512 = 8225280 bytes
Disk identifier: 0x3e309558

Disk /dev/mtdblock7 doesn&#039;t contain a valid partition table

Disk /dev/mtdblock8: 8 MB, 8388608 bytes
255 heads, 63 sectors/track, 1 cylinders
Units = cylinders of 16065 * 512 = 8225280 bytes
Disk identifier: 0xffffffff

Disk /dev/mtdblock8 doesn&#039;t contain a valid partition table

Disk /dev/mtdblock9: 0 MB, 65536 bytes
255 heads, 63 sectors/track, 0 cylinders
Units = cylinders of 16065 * 512 = 8225280 bytes
Disk identifier: 0xffffffff

Disk /dev/mtdblock9 doesn&#039;t contain a valid partition table</code></pre></div><p>And here&#039;s the output of mount:<br /></p><div class="codebox"><pre><code>rootfs on / type rootfs (rw)
/dev/root on /rom type squashfs (ro,relatime)
proc on /proc type proc (rw,noatime)
sysfs on /sys type sysfs (rw,noatime)
tmpfs on /tmp type tmpfs (rw,nosuid,nodev,noatime)
tmpfs on /dev type tmpfs (rw,noatime,size=512k,mode=755)
devpts on /dev/pts type devpts (rw,noatime,mode=600)
/dev/mtdblock7 on /overlay type jffs2 (rw,noatime)
overlayfs:/overlay on / type overlayfs (rw,noatime,lowerdir=/,upperdir=/overlay)
debugfs on /sys/kernel/debug type debugfs (rw,relatime)
none on /proc/bus/usb type usbfs (rw,relatime)</code></pre></div><p>Could anybody help me understand why my router isn&#039;t detecting my USB stick? Is it because the USB ports of the router aren&#039;t working or is it something else entirely? </p><p>Thank you.</p>											<p class="post-edited">(Last edited by <strong>Ghanem</strong> on 15 Jul 2015, 11:04)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p283641">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">neryba</div>
					<div class="post-datetime">
						15 Jul 2015, 15:15					</div>
				</div>
				<div class="post-content content">
					<p>Hi, didn&#039;t find yours board dts file in OpenWRT, looks like you have selfmade image.</p><p>Try enable and disable one by one all free gpios, maybe one of them response for power on USB interface.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p283724">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">ckm</div>
					<div class="post-datetime">
						16 Jul 2015, 12:01					</div>
				</div>
				<div class="post-content content">
					<p><a href="https://forum.openwrt.org/viewtopic.php?id=58419">https://forum.openwrt.org/viewtopic.php?id=58419</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p284295">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">Ghanem</div>
					<div class="post-datetime">
						21 Jul 2015, 12:11					</div>
				</div>
				<div class="post-content content">
					<p>First of all, thank you guys for your answers. Unfortunately, my router is still unable to detect the presence of usb device stuck to its port.</p><p>I went over to kernel_menuconfig--&gt;device drivers--&gt;usb support and found out that &quot;support for host-side usb&quot; wasn&#039;t included so I included it and relaunched make again. But still my router is unable to detect the usb stick. </p><p>I&#039;m still trying...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p284430">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">frietpan</div>
					<div class="post-datetime">
						22 Jul 2015, 00:42					</div>
				</div>
				<div class="post-content content">
					<p>What codepage packages do you have installed?</p><p>I had a symilair issue and it turned out to be that I didn&#039;t install the correct codepage.</p><p>Is the Stick Fat, ext4, or another filesystem? And did you install the packages to support that?<br />And also the iso and utf8 packages</p><p><a href="http://wiki.openwrt.org/doc/howto/usb.storage">http://wiki.openwrt.org/doc/howto/usb.storage</a><br />and<br /><a href="https://forum.openwrt.org/viewtopic.php?id=58568">https://forum.openwrt.org/viewtopic.php?id=58568</a></p><p>I hope is also works for you.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p284499">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">Ghanem</div>
					<div class="post-datetime">
						22 Jul 2015, 13:14					</div>
				</div>
				<div class="post-content content">
					<p>I really don&#039;t understand why the usb stick is still undetected:</p><p>I have installed:</p><p>kmod-usb-core - 2.6.37.1-1<br />kmod-usb-storage - 2.6.37.1-1<br />kmod-fs-ext4 - 2.6.37.1-1<br />libusb - 0.1.12-1<br />usbutils - 0.86-2<br />block-extroot - 0.0.1-2<br />block-hotplug - 0.1.0-2<br />block-mount - 0.1.0-2</p><p>Went over to kernel_menuconfig:</p><div class="codebox"><pre><code>Device Drivers  ---&gt;
  SCSI device support  ---&gt;
---   SCSI support type (disk, tape, CD-ROM)
&lt;*&gt;   SCSI disk support
  

USB support  ---&gt;
  
&lt;*&gt; Support for Host-side USB
  
--- USB Host Controller Drivers
&lt;*&gt; EHCI HCD (USB 2.0) support
&lt;* &gt; OHCI HCD support
&lt;*&gt; UHCI HCD (most Intel and VIA) support
  

&lt; &gt; USB Modem (CDC ACM) support
&lt;*&gt; USB Printer support
&lt;*&gt; USB Mass Storage support
  
USB Network Adapters  ---&gt;
    &lt;*&gt; USB RTL8150 based ethernet device support (EXPERIMENTAL)

USB Serial Converter support  ---&gt;
    &lt;*&gt; USB Serial Converter support
    &lt;*&gt; USB Prolific 2303 Single Port Serial Driver (NEW)</code></pre></div><p>lsusb doesn&#039;t show my usb stick:</p><p>Bus 003 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub<br />Bus 002 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub<br />Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub</p><p>Neither does dmesg. And lspci command returns this:</p><p>pcilib: Cannot open /proc/bus/pci<br />lspci: Cannot find any working access method.</p><p>I think it&#039;s safe to assume that I&#039;m stuck here. Still, I&#039;ll keep on digging. It&#039;s not like I have a choice or something lol</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p284809">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">Ghanem</div>
					<div class="post-datetime">
						24 Jul 2015, 11:37					</div>
				</div>
				<div class="post-content content">
					<p>During compilation I noticed these lines:<br /></p><div class="codebox"><pre><code>WARNING: kmod-scsi-core is not available in the kernel config
WARNING: kmod-scsi-generic is not available in the kernel config
WARNING: kmod-usb-core is not available in the kernel config
WARNING: kmod-usb-uhci is not available in the kernel config
WARNING: kmod-usb-ohci is not available in the kernel config
WARNING: kmod-usb2 is not available in the kernel config</code></pre></div><p>I&#039;m pretty sure I have selected them in menu config, but for some reason, kmod-usb-core and kmod-usb-storage turned from having (*) beside them to (---).</p><p>Also in /bin there are the packages of all these kernel modules. I don&#039;t understand why it&#039;s telling me that they are not available in the kernel config?</p><p>Also, I tried to send the packages manually after compilation to my router and install them there, but after installation, the router is still unable to detect my usb stick? Someone can help me out please?</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>