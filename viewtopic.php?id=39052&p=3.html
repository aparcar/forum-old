<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> mwan3; multi-wan policy routing (general topic)</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 22 May 2013 and 6 May 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 3 of 65</div><nav><ul><li><a href="viewtopic.php%3Fid=39052&amp;p=1.html">1</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=2.html">2</a></li><li class="pagination-current"><span>3</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=4.html">4</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=5.html">5</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=65.html">65</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p183760">
				<div class="post-metadata">
					<div class="post-num">Post #51</div>
					<div class="post-author">mikma</div>
					<div class="post-datetime">
						20 Nov 2012, 13:56					</div>
				</div>
				<div class="post-content content">
					<p>I have problems with static routes. I think they should be added to mwan3_default the same way as local interfaces.</p><p>Is it possible to stop mwan3 without rebooting openwrt? I.e. how do I remove the route tables and iptables rules it adds?</p>											<p class="post-edited">(Last edited by <strong>mikma</strong> on 20 Nov 2012, 14:08)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p183764">
				<div class="post-metadata">
					<div class="post-num">Post #52</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						20 Nov 2012, 14:37					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>th3marco wrote:</cite><blockquote><p>Internet is now thanks for the help but the speed :-(</p><p>I reach only 6 Mbit / s</p></blockquote></div><p>Hi Th3marco,</p><br/><p>This is correct. Your download speed will never exceed the max of one interface the download is currently using. So in your scenario it would be a max of 10Mb.</p><p>If you want to have higher downloads, you should use more sessions.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p183765">
				<div class="post-metadata">
					<div class="post-num">Post #53</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						20 Nov 2012, 14:40					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>mikma wrote:</cite><blockquote><p>I have problems with static routes. I think they should be added to mwan3_default the same way as local interfaces.</p></blockquote></div><p>If you want to use static routes, you should also add a mwan3 policy rule. For example if you have setup a static route for 192.168.0.0, you need to add the following policy rule:</p><div class="codebox"><pre><code>config &#039;rule&#039;
    option &#039;dest_ip&#039; &#039;192.168.0.0/16&#039;
    option &#039;use_policy&#039; &#039;default&#039;</code></pre></div><div class="quotebox"><cite>mikma wrote:</cite><blockquote><p>Is it possible to stop mwan3 without rebooting openwrt? I.e. how do I remove the route tables and iptables rules it adds?</p></blockquote></div><p>Kinda, just remove all the ip rules that mwan3 has set. I will make a note of this and maybe in next release you could do a &quot;/etc/init.d/mwan3 stop&quot; to clear all rules.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p183826">
				<div class="post-metadata">
					<div class="post-num">Post #54</div>
					<div class="post-author">henrique.h12</div>
					<div class="post-datetime">
						21 Nov 2012, 07:07					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><blockquote><p>This is correct. Your download speed will never exceed the max of one interface the download is currently using. So in your scenario it would be a max of 10Mb.</p><p>If you want to have higher downloads, you should use more sessions.</p></blockquote></div><p>More sessions? If i have <br/>wan1= 2mb<br/>wan2= 2mb<br/>wan3= 10mb</p><p>should i have 14mb?<br/>Thanks for your work!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p183970">
				<div class="post-metadata">
					<div class="post-num">Post #55</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						22 Nov 2012, 10:41					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>henrique.h12 wrote:</cite><blockquote><div class="quotebox"><blockquote><p>This is correct. Your download speed will never exceed the max of one interface the download is currently using. So in your scenario it would be a max of 10Mb.</p><p>If you want to have higher downloads, you should use more sessions.</p></blockquote></div><p>More sessions? If i have <br/>wan1= 2mb<br/>wan2= 2mb<br/>wan3= 10mb</p><p>should i have 14mb?</p></blockquote></div><p>More or less... If you have for example a usenet download running with lets say 15 threads load-balanced, you should in theory reach a download speed of 14Mb.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p183993">
				<div class="post-metadata">
					<div class="post-num">Post #56</div>
					<div class="post-author">Gregoire</div>
					<div class="post-datetime">
						22 Nov 2012, 16:20					</div>
				</div>
				<div class="post-content content">
					<p>I tried :<br/></p><div class="codebox"><pre><code>opkg install mwan3_1.1-6_ar71xx.ipk luci-app-mwan3_0.1-1_ar71xx.ipk 
Installing mwan3 (1.1-6) to root...
Installing luci-app-mwan3 (0.1-1) to root...
Installing mwan3 (1.1-6) to root...
Configuring mwan3.
Configuring luci-app-mwan3.
Collected errors:
 * satisfy_dependencies_for: Cannot satisfy the following dependencies for mwan3:
 *      iptables-mod-conntrack-extra *  iptables-mod-ipopt * 
 * opkg_install_cmd: Cannot install package mwan3.</code></pre></div><p>Any idea on what I could do to try it ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p184186">
				<div class="post-metadata">
					<div class="post-num">Post #57</div>
					<div class="post-author">henrique.h12</div>
					<div class="post-datetime">
						24 Nov 2012, 17:19					</div>
				</div>
				<div class="post-content content">
					<p>Will be asking to much an video tutorial like this one? <br/>&gt; <a href="http://www.youtube.com/watch?v=oNLss7btnP4">http://www.youtube.com/watch?v=oNLss7btnP4</a><br/>Thanks!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p186086">
				<div class="post-metadata">
					<div class="post-num">Post #58</div>
					<div class="post-author">dir2cas</div>
					<div class="post-datetime">
						15 Dec 2012, 00:39					</div>
				</div>
				<div class="post-content content">
					<p>Hello Adze, once again - thanks for all your efforts thrown in the mwan* architecture, it is really useful.</p><p>Yesterday I set up my network as a real dual wan environment, as I connected second ISP. As I am currently in a process of testing I am thinking about an option to be added to mwan3 that will be really handy - a rule that ensures that a request that come on a partucular interface will be answered by the same interface, despite the preferred default route in the main routing table. </p><p>This will be mostly a benefit in cases when you are running a server on the router or on another machine in the LAN that has a port fw set.<br/>Such policy will affect mainly the uplink direction.</p><p>Let&#039;s say you have a service running on the second WAN real IP address, but the router&#039;s default route (main routing table) is pointing&nbsp; to the GW of the first WAN. In such setup, the client will try to establish a session witht the service listening on WAN2 ,but will be answered with src IP address of WAN1. In most cases it will not allow a session to be established. There is no need to mention cases when the host has rp_filter enabled option in the kernel. A simple ping can prove it.</p><p>The idea is to check the incomming traffic on an interface for a new session (unmarked traffic as well to rule out traffic that is already caught by another policy) and mark it with the MARK label dedicated to the WANх only policy.</p><p>The option could be applied per interfece (in the interface statement in the mwan3 config)<br/>ex.)<br/>config &#039;interface&#039; &#039;wan2&#039;<br/>&nbsp; &nbsp; option &#039;enabled&#039; &#039;1&#039;<br/>&nbsp; &nbsp; option &#039;persist_interface&#039; &#039;1&#039;<br/>.......</p><p>this way we may place rules like this:<br/>.....<br/>iptables -A mwan3_pre -i {WAN2} -t mangle -m mark --mark 0 -j CONNMARK --restore-mark<br/>iptables -A mwan3_pre -i {WAN2} -m mark --mark 0 -m conntrack --ctstate NEW -j MARK --set-mark ${MARK_policy_WAN2}<br/>....<br/>etc.</p><p>This is only a suggestion, I do not claim to be accurate in the example as I have not studied mwan3 in details. We simply need to check if the option is enabled on the particular interface and if it is, a custom chain could be created where to place the marking for the new umarked sessions. </p><p>If you find this useful I may try to help, doing various tests, etc.</p><p>ps. Basically something like <a href="http://kindlund.wordpress.com/2007/11/19/configuring-multiple-default-routes-in-linux/">this</a> is needed</p>											<p class="post-edited">(Last edited by <strong>dir2cas</strong> on 21 Dec 2012, 01:51)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p186762">
				<div class="post-metadata">
					<div class="post-num">Post #59</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						22 Dec 2012, 23:20					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>dir2cas wrote:</cite><blockquote><p>I am thinking about an option to be added to mwan3 that will be really handy - a rule that ensures that a request that come on a partucular interface will be answered by the same interface, despite the preferred default route in the main routing table.</p></blockquote></div><p>This is already default behaviour, no need for extra option.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p186929">
				<div class="post-metadata">
					<div class="post-num">Post #60</div>
					<div class="post-author">david_s5</div>
					<div class="post-datetime">
						24 Dec 2012, 18:40					</div>
				</div>
				<div class="post-content content">
					<p>Adze, Thank you this is great!</p><p>I am trying to use it simply for when my ISP goes down to use my 4g tethered phone.</p><p>I was having an issue in testing. When I unplugged the Ethernet cable to the router I did not see the switchover. </p><p>When I tacked it down I found mwan3_add_iptables_rule() was dying because ifvalue was null.<br/>ticking Equalize changed the behavior.</p><p>My setup looks like: <br/>1) Am I doing something wrong?<br/>2) Is this the correct way to do what I want?</p><div class="codebox"><pre><code>config interface &#039;wan&#039;
        list track_ip &#039;8.8.4.4&#039;
        list track_ip &#039;8.8.8.8&#039;
        list track_ip &#039;208.67.222.222&#039;
        list track_ip &#039;208.67.220.220&#039;
        option count &#039;1&#039;
        option timeout &#039;2&#039;
        option interval &#039;5&#039;
        option down &#039;3&#039;
        option up &#039;8&#039;
        option enabled &#039;1&#039;
        option reliability &#039;1&#039;

config interface &#039;wan4G&#039;
        option reliability &#039;1&#039;
        option count &#039;1&#039;
        option timeout &#039;2&#039;
        option interval &#039;5&#039;
        option down &#039;3&#039;
        option up &#039;8&#039;
        list track_ip &#039;8.8.8.8&#039;
        list track_ip &#039;208.67.220.220&#039;
        list track_ip &#039;8.8.4.4&#039;
        list track_ip &#039;208.67.222.222&#039;
        option enabled &#039;1&#039;

config member &#039;wan_m1_w1&#039;
        option metric &#039;1&#039;
        option interface &#039;wan&#039;
        option weight &#039;500&#039;

config member &#039;wan4g_m1_w1&#039;
        option metric &#039;1&#039;
        option interface &#039;wan4G&#039;
        option weight &#039;500&#039;

config policy &#039;wan_only&#039;
        list use_member &#039;wan_m1_w1&#039;

config policy &#039;wan4g_only&#039;
        list use_member &#039;wan4g_m1_w1&#039;

config policy &#039;wan_wan4g_loadbalanced&#039;
        list use_member &#039;wan_m1_w1&#039;
        list use_member &#039;wan4g_m1_w1&#039;

config rule &#039;all_traffic&#039;
        option use_policy &#039;wan1_wan2_loadbalanced&#039;
        option proto &#039;all&#039;</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p187135">
				<div class="post-metadata">
					<div class="post-num">Post #61</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						27 Dec 2012, 11:49					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>david_s5 wrote:</cite><blockquote><p>My setup looks like: <br/>1) Am I doing something wrong?</p></blockquote></div><p>You have got an error in your config.</p><p>Replace<br/></p><div class="codebox"><pre><code>config rule &#039;all_traffic&#039;
        option use_policy &#039;wan1_wan2_loadbalanced&#039;
        option proto &#039;all&#039;</code></pre></div><p>With:<br/></p><div class="codebox"><pre><code>config rule &#039;all_traffic&#039;
        option dest_ip &#039;0.0.0.0/0&#039;
        option use_policy &#039;wan_wan4g_loadbalanced&#039;
        option proto &#039;all&#039;</code></pre></div><br/><div class="quotebox"><cite>david_s5 wrote:</cite><blockquote><p>2) Is this the correct way to do what I want?</p></blockquote></div><p>With your setup you have a load-balanced internet connection, where both interfaces are active.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p187172">
				<div class="post-metadata">
					<div class="post-num">Post #62</div>
					<div class="post-author">david_s5</div>
					<div class="post-datetime">
						27 Dec 2012, 18:56					</div>
				</div>
				<div class="post-content content">
					<p>What it the right setup to just switch to 4G when the ISP on the wan is down?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p187516">
				<div class="post-metadata">
					<div class="post-num">Post #63</div>
					<div class="post-author">yanggis</div>
					<div class="post-datetime">
						1 Jan 2013, 00:53					</div>
				</div>
				<div class="post-content content">
					<p>Hi Adze. thanks for your mwan3, it is realy amazing when I first use it.<br/>I just changed some settings. But I&#039;m not sure what the problem is.<br/>Now, when I download a big file from the Internet. Almost data only via wan1 rather than both wan1 and wan2. </p><p>WAN1<br/>eth0.2<br/>RX: 649.45 MB (774047 Pkts.)<br/>TX: 52.77 MB (458188 Pkts.)<br/>IPv4: 172.24.211.202/23<br/>&nbsp; &nbsp; &nbsp; <br/>WAN2<br/>eth2<br/>Uptime: 0h 23m 27s<br/>MAC-Address: 0:11:22:33:44:5E<br/>RX: 1.27 MB (9763 Pkts.)<br/>TX: 45.54 KB (1060 Pkts.)<br/>IPv4: 172.24.211.20/23</p><p>Here are my config files:<br/></p><div class="codebox"><pre><code>/etc/config/network

config interface &#039;loopback&#039;
    option ifname &#039;lo&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;127.0.0.1&#039;
    option netmask &#039;255.0.0.0&#039;

config interface &#039;lan&#039;
    option ifname &#039;eth0.1&#039;
    option type &#039;bridge&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;192.168.1.1&#039;
    option netmask &#039;255.255.255.0&#039;
    option macaddr &#039;c8:60:00:95:56:93&#039;

config interface &#039;wan1&#039;
    option ifname &#039;eth0.2&#039;
    option proto &#039;dhcp&#039;
    option macaddr &#039;c8:60:00:95:56:92&#039;
    option metric &#039;10&#039;

config interface &#039;wan2&#039;
    option proto &#039;dhcp&#039;
    option ifname &#039;eth2&#039;
    option peerdns &#039;0&#039;
    option dns &#039;8.8.8.8 8.8.4.4&#039;
    option metric &#039;10&#039;

config switch
    option name &#039;switch0&#039;
    option reset &#039;1&#039;
    option enable_vlan &#039;1&#039;

config switch_vlan
    option device &#039;switch0&#039;
    option vlan &#039;1&#039;
    option ports &#039;0 1 2 3 8t&#039;

config switch_vlan
    option device &#039;switch0&#039;
    option vlan &#039;2&#039;
    option ports &#039;4 8t&#039;</code></pre></div><p>Another for firewall:</p><div class="codebox"><pre><code>/etc/config/firewall


config defaults
    option syn_flood &#039;1&#039;
    option output &#039;ACCEPT&#039;
    option forward &#039;REJECT&#039;
    option input &#039;ACCEPT&#039;

config zone
    option name &#039;lan&#039;
    option network &#039;lan&#039;
    option input &#039;ACCEPT&#039;
    option output &#039;ACCEPT&#039;
    option forward &#039;REJECT&#039;

config zone
    option name &#039;wan&#039;
    option input &#039;REJECT&#039;
    option output &#039;ACCEPT&#039;
    option forward &#039;REJECT&#039;
    option masq &#039;1&#039;
    option mtu_fix &#039;1&#039;
    option network &#039;wan1&#039;

config rule
    option name &#039;Allow-DHCP-Renew&#039;
    option src &#039;wan&#039;
    option proto &#039;udp&#039;
    option dest_port &#039;68&#039;
    option target &#039;ACCEPT&#039;
    option family &#039;ipv4&#039;

config rule
    option name &#039;Allow-Ping&#039;
    option src &#039;wan&#039;
    option proto &#039;icmp&#039;
    option icmp_type &#039;echo-request&#039;
    option family &#039;ipv4&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-DHCPv6&#039;
    option src &#039;wan&#039;
    option proto &#039;udp&#039;
    option src_ip &#039;fe80::/10&#039;
    option src_port &#039;547&#039;
    option dest_ip &#039;fe80::/10&#039;
    option dest_port &#039;546&#039;
    option family &#039;ipv6&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-ICMPv6-Input&#039;
    option src &#039;wan&#039;
    option proto &#039;icmp&#039;
    list icmp_type &#039;echo-request&#039;
    list icmp_type &#039;echo-reply&#039;
    list icmp_type &#039;destination-unreachable&#039;
    list icmp_type &#039;packet-too-big&#039;
    list icmp_type &#039;time-exceeded&#039;
    list icmp_type &#039;bad-header&#039;
    list icmp_type &#039;unknown-header-type&#039;
    list icmp_type &#039;router-solicitation&#039;
    list icmp_type &#039;neighbour-solicitation&#039;
    list icmp_type &#039;router-advertisement&#039;
    list icmp_type &#039;neighbour-advertisement&#039;
    option limit &#039;1000/sec&#039;
    option family &#039;ipv6&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-ICMPv6-Forward&#039;
    option src &#039;wan&#039;
    option dest &#039;*&#039;
    option proto &#039;icmp&#039;
    list icmp_type &#039;echo-request&#039;
    list icmp_type &#039;echo-reply&#039;
    list icmp_type &#039;destination-unreachable&#039;
    list icmp_type &#039;packet-too-big&#039;
    list icmp_type &#039;time-exceeded&#039;
    list icmp_type &#039;bad-header&#039;
    list icmp_type &#039;unknown-header-type&#039;
    option limit &#039;1000/sec&#039;
    option family &#039;ipv6&#039;
    option target &#039;ACCEPT&#039;

config include
    option path &#039;/etc/firewall.user&#039;

config zone
    option name &#039;wan2&#039;
    option forward &#039;REJECT&#039;
    option output &#039;ACCEPT&#039;
    option network &#039;wan2&#039;
    option input &#039;REJECT&#039;
    option masq &#039;1&#039;
    option mtu_fix &#039;1&#039;

config forwarding
    option dest &#039;wan&#039;
    option src &#039;lan&#039;

config forwarding
    option dest &#039;wan2&#039;
    option src &#039;lan&#039;</code></pre></div><p>And config for mwan3:</p><div class="codebox"><pre><code>/etc/config/mwan3


config interface &#039;wan1&#039;
    option enabled &#039;1&#039;
    option reliability &#039;2&#039;
    option count &#039;1&#039;
    option timeout &#039;2&#039;
    option interval &#039;5&#039;
    option down &#039;3&#039;
    option up &#039;8&#039;
    list track_ip &#039;8.8.4.4&#039;
    list track_ip &#039;8.8.8.8&#039;

config member &#039;wan1_m1_w1&#039;
    option interface &#039;wan1&#039;
    option metric &#039;1&#039;
    option weight &#039;500&#039;

config member &#039;wan2_m1_w1&#039;
    option interface &#039;wan2&#039;
    option metric &#039;1&#039;
    option weight &#039;500&#039;

config policy &#039;wan1_only&#039;
        list use_member &#039;wan1_m1_w1&#039;

config policy &#039;wan2_only&#039;
        list use_member &#039;wan2_m1_w1&#039;

config policy &#039;wan1_wan2_loadbalanced&#039;
    list use_member &#039;wan1_m1_w1&#039;
    list use_member &#039;wan2_m1_w1&#039;

config rule &#039;all_traffic&#039;
        option dest_ip &#039;0.0.0.0/0&#039;
        option use_policy &#039;wan1_wan2_loadbalanced&#039;
        option proto &#039;all&#039;

config interface &#039;wan2&#039;
    option enabled &#039;1&#039;
    list track_ip &#039;8.8.8.8&#039;
    list track_ip &#039;8.8.4.4&#039;
    option reliability &#039;2&#039;
    option count &#039;1&#039;
    option timeout &#039;2&#039;
    option interval &#039;5&#039;
    option down &#039;3&#039;
    option up &#039;8&#039;</code></pre></div><p>Does my config have any problem?<br/>Or it is because wan2 and wan1 have the same gateway, which make mwan3 not work?</p><p>Can you give me any hints? Thanks in advance.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p187628">
				<div class="post-metadata">
					<div class="post-num">Post #64</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						2 Jan 2013, 10:27					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>yanggis wrote:</cite><blockquote><p>Does my config have any problem?.</p></blockquote></div><p>Yes, both your wan interfaces have the same metric value in /etc/config/network. But changing this won&#039;t help you because of your next question..</p><div class="quotebox"><cite>yanggis wrote:</cite><blockquote><p>Or it is because wan2 and wan1 have the same gateway, which make mwan3 not work?</p></blockquote></div><p>Yes, mwan3 does not work with multiple same subnet wan interfaces.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p187705">
				<div class="post-metadata">
					<div class="post-num">Post #65</div>
					<div class="post-author">david_s5</div>
					<div class="post-datetime">
						3 Jan 2013, 00:00					</div>
				</div>
				<div class="post-content content">
					<p>How would one configure mwan3 for simple fail over to 4G when the wan is down? </p><p>So No load balancing and not using the 4G when the wan is up at all.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p187730">
				<div class="post-metadata">
					<div class="post-num">Post #66</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						3 Jan 2013, 10:25					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>david_s5 wrote:</cite><blockquote><p>How would one configure mwan3 for simple fail over to 4G when the wan is down? </p><p>So No load balancing and not using the 4G when the wan is up at all.</p></blockquote></div><p>Play with the metric and weight settings in mwan3 config. Interfaces with a lower metric have precedence over interfaces with a higher metric. If multiple online interfaces have the same lowest metric value, the load will be distributed based on the weight value. An example config for you could be:</p><br/><div class="codebox"><pre><code>config interface &#039;wan&#039;
        list track_ip &#039;8.8.4.4&#039;
        list track_ip &#039;8.8.8.8&#039;
        list track_ip &#039;208.67.222.222&#039;
        list track_ip &#039;208.67.220.220&#039;
        option count &#039;1&#039;
        option timeout &#039;2&#039;
        option interval &#039;5&#039;
        option down &#039;3&#039;
        option up &#039;8&#039;
        option enabled &#039;1&#039;
        option reliability &#039;1&#039;

config interface &#039;wan4G&#039;
        option reliability &#039;1&#039;
        option count &#039;1&#039;
        option timeout &#039;4&#039;
        option interval &#039;30&#039;
        option down &#039;4&#039;
        option up &#039;8&#039;
        list track_ip &#039;8.8.8.8&#039;
        list track_ip &#039;208.67.220.220&#039;
        list track_ip &#039;8.8.4.4&#039;
        list track_ip &#039;208.67.222.222&#039;
        option enabled &#039;1&#039;

config member &#039;wan_m1_w1&#039;
        option metric &#039;1&#039;
        option interface &#039;wan&#039;
        option weight &#039;1&#039;

config member &#039;wan4g_m1_w1&#039;
        option metric &#039;2&#039;
        option interface &#039;wan4G&#039;
        option weight &#039;1&#039;

config policy &#039;wan_only&#039;
        list use_member &#039;wan_m1_w1&#039;

config policy &#039;wan4g_only&#039;
        list use_member &#039;wan4g_m1_w1&#039;

config policy &#039;wan_wan4g_loadbalanced&#039;
        list use_member &#039;wan_m1_w1&#039;
        list use_member &#039;wan4g_m1_w1&#039;

config rule &#039;all_traffic&#039;
        option use_policy &#039;wan_wan4g_loadbalanced&#039;
        option proto &#039;all&#039;
        option dest_ip &#039;0.0.0.0/0&#039;</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p187931">
				<div class="post-metadata">
					<div class="post-num">Post #67</div>
					<div class="post-author">yanggis</div>
					<div class="post-datetime">
						5 Jan 2013, 11:20					</div>
				</div>
				<div class="post-content content">
					<p>Dear Adze, <br/>Sorry to bother you again.<br/>After using mwan3 for a few days, I got another problem.<br/>When I power on my router, the cpu load is very low, such as Load: 0.57 0.19 0.07.<br/>However, after the router running some days, for example, one week, the&nbsp; cpu load becomes very high, such as Load: 3.27 2.45 3.76.<br/>I also tried Multi-wan software, when I used that software, this case did not happen.<br/>Once I use mwan3, this case happened again.<br/>Here are my config files:</p><p>/etc/config/network</p><br/><br/><p>config interface &#039;loopback&#039;<br/>&nbsp; &nbsp; option ifname &#039;lo&#039;<br/>&nbsp; &nbsp; option proto &#039;static&#039;<br/>&nbsp; &nbsp; option ipaddr &#039;127.0.0.1&#039;<br/>&nbsp; &nbsp; option netmask &#039;255.0.0.0&#039;</p><p>config interface &#039;lan&#039;<br/>&nbsp; &nbsp; option ifname &#039;eth0.1&#039;<br/>&nbsp; &nbsp; option type &#039;bridge&#039;<br/>&nbsp; &nbsp; option proto &#039;static&#039;<br/>&nbsp; &nbsp; option ipaddr &#039;192.168.1.1&#039;<br/>&nbsp; &nbsp; option netmask &#039;255.255.255.0&#039;<br/>&nbsp; &nbsp; option macaddr &#039;c8:60:00:95:56:93&#039;</p><p>config interface &#039;wan1&#039;<br/>&nbsp; &nbsp; option ifname &#039;eth0.2&#039;<br/>&nbsp; &nbsp; option proto &#039;dhcp&#039;<br/>&nbsp; &nbsp; option macaddr &#039;c8:60:00:95:56:92&#039;<br/>&nbsp; &nbsp; option metric &#039;10&#039;</p><p>config interface &#039;wan2&#039;<br/>&nbsp; &nbsp; option ifname &#039;eth2&#039;<br/>&nbsp; &nbsp; option proto &#039;dhcp&#039;<br/>&nbsp; &nbsp; option macaddr &#039;C0:11:22:33:44:5E&#039;<br/>&nbsp; &nbsp; option metric &#039;9&#039;</p><p>config switch<br/>&nbsp; &nbsp; option name &#039;switch0&#039;<br/>&nbsp; &nbsp; option reset &#039;1&#039;<br/>&nbsp; &nbsp; option enable_vlan &#039;1&#039;</p><p>config switch_vlan<br/>&nbsp; &nbsp; option device &#039;switch0&#039;<br/>&nbsp; &nbsp; option vlan &#039;1&#039;<br/>&nbsp; &nbsp; option ports &#039;0 1 2 3 8t&#039;</p><p>config switch_vlan<br/>&nbsp; &nbsp; option device &#039;switch0&#039;<br/>&nbsp; &nbsp; option vlan &#039;2&#039;<br/>&nbsp; &nbsp; option ports &#039;4 8t&#039;</p><br/><p>---------------------------------------------------------------------------------------------------------------</p><p>/etc/config/mwan3</p><br/><p>config rule<br/>&nbsp; &nbsp; option dest_ip &#039;0.0.0.0/0&#039;<br/>&nbsp; &nbsp; option use_policy &#039;wan1_wan2_loadbalanced&#039;<br/>&nbsp; &nbsp; option proto &#039;all&#039;<br/>&nbsp; &nbsp; option equalize &#039;1&#039;</p><p>config rule<br/>&nbsp; &nbsp; option src_ip &#039;192.168.21.0/24&#039;<br/>&nbsp; &nbsp; option proto &#039;tcp&#039;<br/>&nbsp; &nbsp; option dest_port &#039;563&#039;<br/>&nbsp; &nbsp; option use_policy &#039;wan2_only&#039;</p><p>config rule<br/>&nbsp; &nbsp; option src_ip &#039;192.168.21.0/24&#039;<br/>&nbsp; &nbsp; option proto &#039;tcp&#039;<br/>&nbsp; &nbsp; option dest_port &#039;995&#039;<br/>&nbsp; &nbsp; option use_policy &#039;wan1_only&#039;</p><p>config rule<br/>&nbsp; &nbsp; option dest_ip &#039;88.154.0.0/16&#039;<br/>&nbsp; &nbsp; option proto &#039;tcp&#039;<br/>&nbsp; &nbsp; option dest_port &#039;1024:65535&#039;<br/>&nbsp; &nbsp; option equalize &#039;1&#039;<br/>&nbsp; &nbsp; option use_policy &#039;wan1_wan2_loadbalanced&#039;</p><p>config rule<br/>&nbsp; &nbsp; option dest_ip &#039;77.11.41.0/24&#039;<br/>&nbsp; &nbsp; option proto &#039;tcp&#039;<br/>&nbsp; &nbsp; option dest_port &#039;1024:65535&#039;<br/>&nbsp; &nbsp; option use_policy &#039;wan1_pri_wan2_sec&#039;</p><p>config rule<br/>&nbsp; &nbsp; option dest_ip &#039;112.136.0.0/16&#039;<br/>&nbsp; &nbsp; option proto &#039;udp&#039;<br/>&nbsp; &nbsp; option dest_port &#039;5352&#039;<br/>&nbsp; &nbsp; option use_policy &#039;wan2_pri_wan1_sec&#039;</p><p>config interface &#039;wan1&#039;<br/>&nbsp; &nbsp; option enabled &#039;1&#039;<br/>&nbsp; &nbsp; list track_ip &#039;8.8.4.4&#039;<br/>&nbsp; &nbsp; list track_ip &#039;8.8.8.8&#039;<br/>&nbsp; &nbsp; list track_ip &#039;208.67.222.222&#039;<br/>&nbsp; &nbsp; list track_ip &#039;208.67.220.220&#039;<br/>&nbsp; &nbsp; option reliability &#039;2&#039;<br/>&nbsp; &nbsp; option count &#039;1&#039;<br/>&nbsp; &nbsp; option timeout &#039;2&#039;<br/>&nbsp; &nbsp; option interval &#039;5&#039;<br/>&nbsp; &nbsp; option down &#039;3&#039;<br/>&nbsp; &nbsp; option up &#039;8&#039;</p><p>config interface &#039;wan2&#039;<br/>&nbsp; &nbsp; option enabled &#039;1&#039;<br/>&nbsp; &nbsp; list track_ip &#039;8.8.8.8&#039;<br/>&nbsp; &nbsp; list track_ip &#039;208.67.220.220&#039;<br/>&nbsp; &nbsp; option reliability &#039;1&#039;<br/>&nbsp; &nbsp; option count &#039;1&#039;<br/>&nbsp; &nbsp; option timeout &#039;2&#039;<br/>&nbsp; &nbsp; option interval &#039;5&#039;<br/>&nbsp; &nbsp; option down &#039;3&#039;<br/>&nbsp; &nbsp; option up &#039;8&#039;</p><p>config member &#039;wan1_m1_w3&#039;<br/>&nbsp; &nbsp; option interface &#039;wan1&#039;<br/>&nbsp; &nbsp; option metric &#039;1&#039;<br/>&nbsp; &nbsp; option weight &#039;3&#039;</p><p>config member &#039;wan1_m2_w3&#039;<br/>&nbsp; &nbsp; option interface &#039;wan1&#039;<br/>&nbsp; &nbsp; option metric &#039;2&#039;<br/>&nbsp; &nbsp; option weight &#039;3&#039;</p><p>config member &#039;wan2_m1_w2&#039;<br/>&nbsp; &nbsp; option interface &#039;wan2&#039;<br/>&nbsp; &nbsp; option metric &#039;1&#039;<br/>&nbsp; &nbsp; option weight &#039;2&#039;</p><p>config member &#039;wan2_m2_w2&#039;<br/>&nbsp; &nbsp; option interface &#039;wan2&#039;<br/>&nbsp; &nbsp; option metric &#039;2&#039;<br/>&nbsp; &nbsp; option weight &#039;2&#039;</p><p>config policy &#039;wan1_only&#039;<br/>&nbsp; &nbsp; list use_member &#039;wan1_m1_w3&#039;</p><p>config policy &#039;wan2_only&#039;<br/>&nbsp; &nbsp; list use_member &#039;wan2_m1_w2&#039;</p><p>config policy &#039;wan1_wan2_loadbalanced&#039;<br/>&nbsp; &nbsp; list use_member &#039;wan1_m1_w3&#039;<br/>&nbsp; &nbsp; list use_member &#039;wan2_m1_w2&#039;</p><p>config policy &#039;wan1_pri_wan2_sec&#039;<br/>&nbsp; &nbsp; list use_member &#039;wan1_m1_w3&#039;<br/>&nbsp; &nbsp; list use_member &#039;wan2_m2_w2&#039;</p><p>config policy &#039;wan2_pri_wan1_sec&#039;<br/>&nbsp; &nbsp; list use_member &#039;wan1_m2_w3&#039;<br/>&nbsp; &nbsp; list use_member &#039;wan2_m1_w2&#039;</p><p>-------------------------------------------------------------------------------------</p><p>/etc/config/firewall</p><br/><p>config defaults<br/>&nbsp; &nbsp; option syn_flood &#039;1&#039;<br/>&nbsp; &nbsp; option input &#039;ACCEPT&#039;<br/>&nbsp; &nbsp; option output &#039;ACCEPT&#039;<br/>&nbsp; &nbsp; option forward &#039;REJECT&#039;</p><p>config zone<br/>&nbsp; &nbsp; option name &#039;lan&#039;<br/>&nbsp; &nbsp; option network &#039;lan&#039;<br/>&nbsp; &nbsp; option input &#039;ACCEPT&#039;<br/>&nbsp; &nbsp; option output &#039;ACCEPT&#039;<br/>&nbsp; &nbsp; option forward &#039;REJECT&#039;</p><p>config include<br/>&nbsp; &nbsp; option path &#039;/etc/firewall.user&#039;</p><p>config zone<br/>&nbsp; &nbsp; option name &#039;wan1&#039;<br/>&nbsp; &nbsp; option input &#039;ACCEPT&#039;<br/>&nbsp; &nbsp; option forward &#039;REJECT&#039;<br/>&nbsp; &nbsp; option output &#039;ACCEPT&#039;<br/>&nbsp; &nbsp; option network &#039;wan1&#039;<br/>&nbsp; &nbsp; option masq &#039;1&#039;<br/>&nbsp; &nbsp; option mtu_fix &#039;1&#039;</p><p>config zone<br/>&nbsp; &nbsp; option name &#039;wan2&#039;<br/>&nbsp; &nbsp; option input &#039;ACCEPT&#039;<br/>&nbsp; &nbsp; option forward &#039;REJECT&#039;<br/>&nbsp; &nbsp; option output &#039;ACCEPT&#039;<br/>&nbsp; &nbsp; option network &#039;wan2&#039;<br/>&nbsp; &nbsp; option masq &#039;1&#039;<br/>&nbsp; &nbsp; option mtu_fix &#039;1&#039;</p><p>config forwarding<br/>&nbsp; &nbsp; option dest &#039;wan1&#039;<br/>&nbsp; &nbsp; option src &#039;lan&#039;</p><p>config forwarding<br/>&nbsp; &nbsp; option dest &#039;wan2&#039;<br/>&nbsp; &nbsp; option src &#039;lan&#039;</p><p>config redirect<br/>&nbsp; &nbsp; option target &#039;DNAT&#039;<br/>&nbsp; &nbsp; option src &#039;wan&#039;<br/>&nbsp; &nbsp; option dest &#039;lan&#039;<br/>&nbsp; &nbsp; option proto &#039;tcp&#039;<br/>&nbsp; &nbsp; option src_dport &#039;3389&#039;<br/>&nbsp; &nbsp; option dest_ip &#039;192.168.1.223&#039;<br/>&nbsp; &nbsp; option dest_port &#039;3389&#039;<br/>&nbsp; &nbsp; option name &#039;remote control&#039;</p><p>config redirect<br/>&nbsp; &nbsp; option target &#039;DNAT&#039;<br/>&nbsp; &nbsp; option src &#039;wan&#039;<br/>&nbsp; &nbsp; option dest &#039;lan&#039;<br/>&nbsp; &nbsp; option proto &#039;tcp udp&#039;<br/>&nbsp; &nbsp; option src_dport &#039;38862&#039;<br/>&nbsp; &nbsp; option dest_ip &#039;192.168.1.223&#039;<br/>&nbsp; &nbsp; option dest_port &#039;38862&#039;<br/>&nbsp; &nbsp; option name &#039;Utorrent&#039;</p><p>-------------------------------------------------------------------------------------------------<br/>Can you kindly give me a hint, what is the problem?<br/>Thanks in advance.</p>											<p class="post-edited">(Last edited by <strong>yanggis</strong> on 5 Jan 2013, 11:26)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p188049">
				<div class="post-metadata">
					<div class="post-num">Post #68</div>
					<div class="post-author">natasia13</div>
					<div class="post-datetime">
						6 Jan 2013, 14:55					</div>
				</div>
				<div class="post-content content">
					<p>Dear Adze, </p><p>I am using OpenWRT trunk r34778.&nbsp; I have two physical wans, both are using dhcp mode, but I can see only one Gateway on the routing table after &quot;route -n&quot;, normally it should be two to get MWAN working, isn&#039;t it? </p><div class="codebox"><pre><code>/root$ route -n
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
0.0.0.0         192.168.20.20   0.0.0.0         UG    0      0        0 eth0.2
192.168.3.0     0.0.0.0         255.255.255.0   U     0      0        0 br-lan
192.168.10.0    0.0.0.0         255.255.255.0   U     0      0        0 eth0.1
192.168.20.0    0.0.0.0         255.255.255.0   U     0      0        0 eth0.2 </code></pre></div><p>You can see that eth0.1 is my wan1 and eth0.2 is my wan2. </p><p>and then I tried to ping <a href="http://www.google.com/">www.google.com</a> :</p><p>ping -c 1 -I eth0.1 <a href="http://www.google.com/">www.google.com</a>&nbsp; not successful&nbsp; &nbsp; (but in fact both eth0.1 &amp; eth0.2 work fine when I&#039;m trying NWAN)</p><p>ping -c 1 -I eth0.2 <a href="http://www.google.com/">www.google.com</a>&nbsp; &nbsp;successful</p><p>From you post, I knew that to get mwan3 working, it should be:<br/></p><div class="codebox"><pre><code>/root$ route -n
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
0.0.0.0         192.168.10.10   0.0.0.0         UG    0      0        0 eth0.1
0.0.0.0         192.168.20.20   0.0.0.0         UG    0      0        0 eth0.2
192.168.3.0     0.0.0.0         255.255.255.0   U     0      0        0 br-lan
192.168.10.0    0.0.0.0         255.255.255.0   U     0      0        0 eth0.1
192.168.20.0    0.0.0.0         255.255.255.0   U     0      0        0 eth0.2 </code></pre></div><p>I don&#039;t know why my eth0.1&#039;s Gateway was not showing on the routing table, does it have something to do with version of firmware? </p><div class="codebox"><pre><code>/$ ip route
default 
    nexthop via 192.168.10.10  dev eth0.1 weight 1
    nexthop via 192.168.20.20  dev eth0.2 weight 1
192.168.3.0/24 dev br-lan  proto kernel  scope link  src 192.168.3.1 
192.168.10.0/24 dev eth0.1  proto kernel  scope link  src 192.168.10.13 
192.168.20.0/24 dev eth0.2  proto kernel  scope link  src 192.168.20.105 </code></pre></div><p> <br/></p><div class="codebox"><pre><code>/$ ip rule show
0:    from all lookup local 
32762:    from all fwmark 0x1e lookup wan2_rt 
32763:    from 192.168.20.105 lookup wan2_rt 
32764:    from all fwmark 0x14 lookup wan1_rt 
32765:    from 192.168.10.13 lookup wan1_rt 
32766:    from all lookup main 
32767:    from all lookup default </code></pre></div><p>Thanks in advance. </p><p>Regards,<br/>Natasia</p>											<p class="post-edited">(Last edited by <strong>natasia13</strong> on 6 Jan 2013, 15:11)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p188170">
				<div class="post-metadata">
					<div class="post-num">Post #69</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						7 Jan 2013, 12:49					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>natasia13 wrote:</cite><blockquote><p>I have two physical wans, both are using dhcp mode, but I can see only one Gateway on the routing table after &quot;route -n&quot;, normally it should be two to get MWAN working, isn&#039;t it?</p></blockquote></div><p>Yes, i believe you did not set different metric values in your network config, as described in OP.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p188308">
				<div class="post-metadata">
					<div class="post-num">Post #70</div>
					<div class="post-author">laggflor</div>
					<div class="post-datetime">
						8 Jan 2013, 17:35					</div>
				</div>
				<div class="post-content content">
					<p>Is this Multi-Wan or an other package?<br/>I try to route thru different wan&#039;s based on source network, which is not chooseable with Multi-WAN.<br/>Please see <a href="https://forum.openwrt.org/viewtopic.php?id=41518">https://forum.openwrt.org/viewtopic.php?id=41518</a></p><p>Thanks in advance,<br/>regards Florian.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p188377">
				<div class="post-metadata">
					<div class="post-num">Post #71</div>
					<div class="post-author">natasia13</div>
					<div class="post-datetime">
						9 Jan 2013, 09:41					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><div class="quotebox"><cite>natasia13 wrote:</cite><blockquote><p>I have two physical wans, both are using dhcp mode, but I can see only one Gateway on the routing table after &quot;route -n&quot;, normally it should be two to get MWAN working, isn&#039;t it?</p></blockquote></div><p>Yes, i believe you did not set different metric values in your network config, as described in OP.</p></blockquote></div><p>Hello Adze, as you can see, already set wan1 metric value 1 &amp; wan2 metric value 2. </p><div class="codebox"><pre><code>/$ route -n
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
0.0.0.0         192.168.10.10   0.0.0.0         UG    0      0        0 eth0.1
192.168.3.0     0.0.0.0         255.255.255.0   U     0      0        0 br-lan
192.168.10.0    0.0.0.0         255.255.255.0   U     1      0        0 eth0.1
192.168.20.0    0.0.0.0         255.255.255.0   U     2      0        0 eth0.2</code></pre></div><div class="codebox"><pre><code>config interface &#039;wan1&#039;
    option _orig_bridge &#039;false&#039;
    option ifname &#039;eth0.1&#039;
    option _orig_ifname &#039;eth0.1&#039;
    option proto &#039;dhcp&#039;
    option metric &#039;1&#039;

config interface &#039;wan2&#039;
    option ifname &#039;eth0.2&#039;
    option _orig_bridge &#039;false&#039;
    option _orig_ifname &#039;eth0.2&#039;
    option proto &#039;dhcp&#039;
    option metric &#039;2&#039;</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p188381">
				<div class="post-metadata">
					<div class="post-num">Post #72</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						9 Jan 2013, 10:34					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>natasia13 wrote:</cite><blockquote><p>Hello Adze, as you can see, already set wan1 metric value 1 &amp; wan2 metric value 2.</p></blockquote></div><p>Hmmm... The outcome of &quot;route -n&quot; does not reflect your network config.. Could you try and remove the lines &quot;option _orig_bridge &#039;false&#039;&quot; and &quot;option _orig_ifname &#039;eth0.x&#039;&quot; please?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p188385">
				<div class="post-metadata">
					<div class="post-num">Post #73</div>
					<div class="post-author">natasia13</div>
					<div class="post-datetime">
						9 Jan 2013, 11:47					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><div class="quotebox"><cite>natasia13 wrote:</cite><blockquote><p>Hello Adze, as you can see, already set wan1 metric value 1 &amp; wan2 metric value 2.</p></blockquote></div><p>Hmmm... The outcome of &quot;route -n&quot; does not reflect your network config.. Could you try and remove the lines &quot;option _orig_bridge &#039;false&#039;&quot; and &quot;option _orig_ifname &#039;eth0.x&#039;&quot; please?</p></blockquote></div><br/><p>Hello Adze, thanks so much for the prompt response.&nbsp; &nbsp;The outcome&#039;s still the same after removing those two lines.<br/></p><div class="codebox"><pre><code>/etc/config$ route -n
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
0.0.0.0         192.168.10.10   0.0.0.0         UG    0      0        0 eth0.1
192.168.3.0     0.0.0.0         255.255.255.0   U     0      0        0 br-lan
192.168.10.0    0.0.0.0         255.255.255.0   U     1      0        0 eth0.1
192.168.20.0    0.0.0.0         255.255.255.0   U     2      0        0 eth0.2</code></pre></div><p>my network config as below:<br/></p><div class="codebox"><pre><code>config interface &#039;loopback&#039;
    option ifname &#039;lo&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;127.0.0.1&#039;
    option netmask &#039;255.0.0.0&#039;

config interface &#039;lan&#039;
    option type &#039;bridge&#039;
    option proto &#039;static&#039;
    option netmask &#039;255.255.255.0&#039;
    option ipaddr &#039;192.168.3.1&#039;
    option _orig_ifname &#039;wlan0 wlan1&#039;
    option _orig_bridge &#039;true&#039;
    option ifname &#039;eth0.3&#039;

config interface &#039;wan1&#039;
    option ifname &#039;eth0.1&#039;
    option proto &#039;dhcp&#039;
    option metric &#039;1&#039;

config interface &#039;wan2&#039;
    option ifname &#039;eth0.2&#039;
    option proto &#039;dhcp&#039;
    option metric &#039;2&#039;

config switch
    option name &#039;eth0&#039;
    option reset &#039;1&#039;
    option enable_vlan &#039;1&#039;

config switch_vlan
    option device &#039;eth0&#039;
    option vlan &#039;1&#039;
    option vid &#039;1&#039;
    option ports &#039;0t 1&#039;

config switch_vlan
    option device &#039;eth0&#039;
    option vlan &#039;2&#039;
    option vid &#039;2&#039;
    option ports &#039;0t 2&#039;

config switch_vlan
    option device &#039;eth0&#039;
    option vlan &#039;3&#039;
    option vid &#039;3&#039;
    option ports &#039;0t 3 4 5&#039;</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p188775">
				<div class="post-metadata">
					<div class="post-num">Post #74</div>
					<div class="post-author">sagitar</div>
					<div class="post-datetime">
						13 Jan 2013, 15:50					</div>
				</div>
				<div class="post-content content">
					<p>Hi,Adze.<br/>The mwan3 is very usefull for me, I have used it for several months. Thank you very much.<br/>However,I met some troubles on it today.</p><p>I found the IP rules can be created if an interface up,however ,it can NOT be deleted when the interface down.&nbsp; Could you please check the configure for me ? </p><p>(update: I updated a new firmware for my router and re-configured the mwan3 then found the issue.)</p><br/><p>root@OpenWrt:~# ip rule show<br/>0:&nbsp; &nbsp; &nbsp; from all lookup local<br/>1001:&nbsp; &nbsp;from 192.168.119.145 fwmark 0x0/0x8000 lookup 1001<br/>1002:&nbsp; &nbsp;from 192.168.111.245 fwmark 0x0/0x8000 lookup 1002<br/>1003:&nbsp; &nbsp;from 192.168.120.245 fwmark 0x0/0x8000 lookup 1003<br/>1004:&nbsp; &nbsp;from 192.168.122.145 fwmark 0x0/0x8000 lookup 1004<br/>1008:&nbsp; &nbsp;from all fwmark 0x100/0xff00 lookup 1001<br/>1009:&nbsp; &nbsp;from all fwmark 0x200/0xff00 lookup 1002<br/>1010:&nbsp; &nbsp;from all fwmark 0x300/0xff00 lookup 1003<br/>1011:&nbsp; &nbsp;from all fwmark 0x400/0xff00 lookup 1004<br/>1016:&nbsp; &nbsp;from all fwmark 0x1000/0xff00 lookup 1016<br/>1017:&nbsp; &nbsp;from all fwmark 0x1100/0xff00 lookup 1017<br/>1018:&nbsp; &nbsp;from all fwmark 0x1200/0xff00 lookup 1018<br/>1019:&nbsp; &nbsp;from all fwmark 0x1300/0xff00 lookup 1019<br/>1020:&nbsp; &nbsp;from all fwmark 0x1400/0xff00 lookup 1020<br/>32766:&nbsp; from all lookup main<br/>32767:&nbsp; from all lookup default<br/>root@OpenWrt:~# logread|grep mwan3<br/>Jan 13 19:56:36 OpenWrt user.notice root: mwan3: ifup interface wan4 (eth0.4)<br/>Jan 13 19:56:59 OpenWrt user.notice root: mwan3: No gateway found for interface wan (eth0.1)<br/>Jan 13 19:57:18 OpenWrt user.notice root: mwan3: No gateway found for interface wan2 (eth0.2)<br/>Jan 13 19:57:35 OpenWrt user.notice root: mwan3: No gateway found for interface wan3 (eth0.3)<br/>Jan 13 19:57:41 OpenWrt user.notice root: mwan3: ifup interface wan4 (eth0.4)<br/>Jan 13 20:03:14 OpenWrt user.notice root: mwan3: ifdown interface wan4 (eth0.4)<br/>Jan 13 20:03:52 OpenWrt user.notice root: mwan3: ifup interface wan4 (eth0.4)<br/>Jan 13 20:05:28 OpenWrt user.notice root: mwan3: Lost 1 ping(s) on interface wan4 (eth0.4)<br/>Jan 13 20:32:39 OpenWrt user.notice root: mwan3: Lost 1 ping(s) on interface wan4 (eth0.4)<br/>Jan 13 21:21:18 OpenWrt user.notice root: mwan3: Lost 1 ping(s) on interface wan4 (eth0.4)<br/>Jan 13 21:32:03 OpenWrt user.notice root: mwan3: ifup interface wan (eth0.1)<br/>Jan 13 21:32:23 OpenWrt user.notice root: mwan3: ifup interface wan2 (eth0.2)<br/>Jan 13 21:32:34 OpenWrt user.notice root: mwan3: ifup interface wan3 (eth0.3)<br/>Jan 13 21:32:40 OpenWrt user.notice root: mwan3: Interface wan (eth0.1) is offline<br/>Jan 13 21:32:42 OpenWrt user.notice root: mwan3: ifdown interface wan (eth0.1)<br/>Jan 13 21:32:59 OpenWrt user.notice root: mwan3: Interface wan2 (eth0.2) is offline<br/>Jan 13 21:32:59 OpenWrt user.notice root: mwan3: ifdown interface wan2 (eth0.2)<br/>Jan 13 21:33:11 OpenWrt user.notice root: mwan3: Interface wan3 (eth0.3) is offline<br/>Jan 13 21:33:11 OpenWrt user.notice root: mwan3: ifdown interface wan3 (eth0.3)<br/>root@OpenWrt:~#</p><p>/etc/config/network </p><br/><p>root@OpenWrt:~# cat /etc/config/network<br/>#### VLAN configuration<br/>config switch eth0<br/>&nbsp; &nbsp; &nbsp; &nbsp; option enable&nbsp; &nbsp;1</p><p>config switch_vlan eth0_0<br/>&nbsp; &nbsp; &nbsp; &nbsp; option device&nbsp; &nbsp;&quot;eth0&quot;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option vlan&nbsp; &nbsp; &nbsp;0<br/>&nbsp; &nbsp; &nbsp; &nbsp; option ports&nbsp; &nbsp; &quot;4 8*&quot;</p><p>config switch_vlan eth0_1<br/>&nbsp; &nbsp; &nbsp; &nbsp; option device&nbsp; &nbsp;&quot;eth0&quot;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option vlan&nbsp; &nbsp; &nbsp;1<br/>&nbsp; &nbsp; &nbsp; &nbsp; option ports&nbsp; &nbsp; &quot;0 8&quot;</p><p>config switch_vlan eth0_2<br/>&nbsp; &nbsp; &nbsp; &nbsp; option device&nbsp; &nbsp;&quot;eth0&quot;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option vlan&nbsp; &nbsp; &nbsp;2<br/>&nbsp; &nbsp; &nbsp; &nbsp; option ports&nbsp; &nbsp; &quot;1 8&quot;</p><p>config switch_vlan eth0_3<br/>&nbsp; &nbsp; &nbsp; &nbsp; option device&nbsp; &nbsp;&quot;eth0&quot;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option vlan&nbsp; &nbsp; &nbsp;3<br/>&nbsp; &nbsp; &nbsp; &nbsp; option ports&nbsp; &nbsp; &quot;2 8&quot;</p><p>config switch_vlan eth0_4<br/>&nbsp; &nbsp; &nbsp; &nbsp; option device&nbsp; &nbsp;&quot;eth0&quot;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option vlan&nbsp; &nbsp; &nbsp;4<br/>&nbsp; &nbsp; &nbsp; &nbsp; option ports&nbsp; &nbsp; &quot;3 8&quot;</p><p>#### Loopback configuration<br/>config interface loopback<br/>&nbsp; &nbsp; &nbsp; &nbsp; option ifname&nbsp; &nbsp;&quot;lo&quot;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; static<br/>&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr&nbsp; &nbsp;127.0.0.1<br/>&nbsp; &nbsp; &nbsp; &nbsp; option netmask&nbsp; 255.0.0.0</p><br/><p>#### LAN configuration<br/>config interface lan<br/>&nbsp; &nbsp; &nbsp; &nbsp; option type&nbsp; &nbsp; &nbsp;bridge<br/>&nbsp; &nbsp; &nbsp; &nbsp; option ifname&nbsp; &nbsp;&quot;eth0.0&quot;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; static<br/>&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr&nbsp; &nbsp;192.168.115.100<br/>&nbsp; &nbsp; &nbsp; &nbsp; option netmask&nbsp; 255.255.255.0</p><br/><p>#### WAN configuration<br/>config interface&nbsp; &nbsp; &nbsp; &nbsp; wan<br/>&nbsp; &nbsp; &nbsp; &nbsp; option ifname&nbsp; &nbsp;&quot;eth0.1&quot;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; dhcp<br/>&nbsp; &nbsp; &nbsp; &nbsp; option metric 40<br/>&nbsp; &nbsp; &nbsp; &nbsp; option accept_ra 1</p><p>config interface&nbsp; &nbsp; &nbsp; &nbsp; wan2<br/>&nbsp; &nbsp; &nbsp; &nbsp; option ifname&nbsp; &nbsp;&quot;eth0.2&quot;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; dhcp<br/>&nbsp; &nbsp; &nbsp; &nbsp; option metric 30<br/>&nbsp; &nbsp; &nbsp; &nbsp; option accept_ra 1</p><p>config interface&nbsp; &nbsp; &nbsp; &nbsp; wan3<br/>&nbsp; &nbsp; &nbsp; &nbsp; option ifname&nbsp; &nbsp;&quot;eth0.3&quot;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; dhcp<br/>&nbsp; &nbsp; &nbsp; &nbsp; option metric 20<br/>&nbsp; &nbsp; &nbsp; &nbsp; option accept_ra 1</p><p>config interface&nbsp; &nbsp; &nbsp; &nbsp; wan4<br/>&nbsp; &nbsp; &nbsp; &nbsp; option ifname&nbsp; &nbsp;&quot;eth0.4&quot;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; dhcp<br/>&nbsp; &nbsp; &nbsp; &nbsp; option metric 10<br/>&nbsp; &nbsp; &nbsp; &nbsp; option accept_ra 1<br/>root@OpenWrt:~#</p><p>/etc/config/firware </p><br/><p>root@OpenWrt:~# cat /etc/config/firewall<br/>config defaults<br/>&nbsp; &nbsp; &nbsp; &nbsp; option syn_flood&nbsp; &nbsp; &nbsp; &nbsp; 1<br/>&nbsp; &nbsp; &nbsp; &nbsp; option input&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DROP<br/>&nbsp; &nbsp; &nbsp; &nbsp; option output&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ACCEPT<br/>&nbsp; &nbsp; &nbsp; &nbsp; option forward&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; REJECT<br/># Uncomment this line to disable ipv6 rules<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option disable_ipv6&nbsp; &nbsp; &nbsp;1</p><p>config zone<br/>&nbsp; &nbsp; &nbsp; &nbsp; option name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lan<br/>&nbsp; &nbsp; &nbsp; &nbsp; option network&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#039;lan&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option input&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ACCEPT<br/>&nbsp; &nbsp; &nbsp; &nbsp; option output&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ACCEPT<br/>&nbsp; &nbsp; &nbsp; &nbsp; option forward&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; REJECT</p><p>config zone<br/>&nbsp; &nbsp; &nbsp; &nbsp; option name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;wan<br/>&nbsp; &nbsp; &nbsp; &nbsp; option network&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#039;wan wan2 wan3 wan4&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option input&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; REJECT<br/>&nbsp; &nbsp; &nbsp; &nbsp; option output&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ACCEPT<br/>&nbsp; &nbsp; &nbsp; &nbsp; option forward&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; REJECT<br/>&nbsp; &nbsp; &nbsp; &nbsp; option masq&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1<br/>&nbsp; &nbsp; &nbsp; &nbsp; option mtu_fix&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1</p><p>config forwarding<br/>&nbsp; &nbsp; &nbsp; &nbsp; option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lan<br/>&nbsp; &nbsp; &nbsp; &nbsp; option dest&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;wan</p><p># We need to accept udp packets on port 68,<br/># see <a href="https://dev.openwrt.org/ticket/4108">https://dev.openwrt.org/ticket/4108</a><br/>config rule<br/>&nbsp; &nbsp; &nbsp; &nbsp; option name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Allow-DHCP-Renew<br/>&nbsp; &nbsp; &nbsp; &nbsp; option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wan<br/>&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; udp<br/>&nbsp; &nbsp; &nbsp; &nbsp; option dest_port&nbsp; &nbsp; &nbsp; &nbsp; 68<br/>&nbsp; &nbsp; &nbsp; &nbsp; option target&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ACCEPT<br/>&nbsp; &nbsp; &nbsp; &nbsp; option family&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ipv4</p><p># Allow IPv4 ping<br/>config rule<br/>&nbsp; &nbsp; &nbsp; &nbsp; option name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Allow-Ping<br/>&nbsp; &nbsp; &nbsp; &nbsp; option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wan<br/>&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; icmp<br/>&nbsp; &nbsp; &nbsp; &nbsp; option icmp_type&nbsp; &nbsp; &nbsp; &nbsp; echo-request<br/>&nbsp; &nbsp; &nbsp; &nbsp; option family&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ipv4<br/>&nbsp; &nbsp; &nbsp; &nbsp; option target&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ACCEPT</p><p># Allow DHCPv6 replies<br/># see <a href="https://dev.openwrt.org/ticket/10381">https://dev.openwrt.org/ticket/10381</a><br/>config rule<br/>&nbsp; &nbsp; &nbsp; &nbsp; option name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Allow-DHCPv6<br/>&nbsp; &nbsp; &nbsp; &nbsp; option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wan<br/>&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; udp<br/>&nbsp; &nbsp; &nbsp; &nbsp; option src_ip&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;fe80::/10<br/>&nbsp; &nbsp; &nbsp; &nbsp; option src_port&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;547<br/>&nbsp; &nbsp; &nbsp; &nbsp; option dest_ip&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fe80::/10<br/>&nbsp; &nbsp; &nbsp; &nbsp; option dest_port&nbsp; &nbsp; &nbsp; &nbsp; 546<br/>&nbsp; &nbsp; &nbsp; &nbsp; option family&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ipv6<br/>&nbsp; &nbsp; &nbsp; &nbsp; option target&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ACCEPT</p><p># Allow essential incoming IPv6 ICMP traffic<br/>config rule<br/>&nbsp; &nbsp; &nbsp; &nbsp; option name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Allow-ICMPv6-Input<br/>&nbsp; &nbsp; &nbsp; &nbsp; option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wan<br/>&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; icmp<br/>&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo-request<br/>&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo-reply<br/>&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; destination-unreachable<br/>&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; packet-too-big<br/>&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; time-exceeded<br/>&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bad-header<br/>&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; unknown-header-type<br/>&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; router-solicitation<br/>&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; neighbour-solicitation<br/>&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; router-advertisement<br/>&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; neighbour-advertisement<br/>&nbsp; &nbsp; &nbsp; &nbsp; option limit&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1000/sec<br/>&nbsp; &nbsp; &nbsp; &nbsp; option family&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ipv6<br/>&nbsp; &nbsp; &nbsp; &nbsp; option target&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ACCEPT</p><p># Allow essential forwarded IPv6 ICMP traffic<br/>config rule<br/>&nbsp; &nbsp; &nbsp; &nbsp; option name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Allow-ICMPv6-Forward<br/>&nbsp; &nbsp; &nbsp; &nbsp; option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wan<br/>&nbsp; &nbsp; &nbsp; &nbsp; option dest&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*<br/>&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; icmp<br/>&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo-request<br/>&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo-reply<br/>&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; destination-unreachable<br/>&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; packet-too-big<br/>&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; time-exceeded<br/>&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bad-header<br/>&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; unknown-header-type<br/>&nbsp; &nbsp; &nbsp; &nbsp; option limit&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1000/sec<br/>&nbsp; &nbsp; &nbsp; &nbsp; option family&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ipv6<br/>&nbsp; &nbsp; &nbsp; &nbsp; option target&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ACCEPT</p><p># include a file with users custom iptables rules<br/>config include<br/>&nbsp; &nbsp; &nbsp; &nbsp; option path /etc/firewall.user</p><br/><p>### EXAMPLE CONFIG SECTIONS<br/># do not allow a specific ip to access wan<br/>#config rule<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lan<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option src_ip&nbsp; &nbsp;192.168.45.2<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option dest&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;wan<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option proto&nbsp; &nbsp; tcp<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option target&nbsp; &nbsp;REJECT</p><p># block a specific mac on wan<br/>#config rule<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option dest&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;wan<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option src_mac&nbsp; 00:11:22:33:44:66<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option target&nbsp; &nbsp;REJECT</p><p># block incoming ICMP traffic on a zone<br/>#config rule<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lan<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option proto&nbsp; &nbsp; ICMP<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option target&nbsp; &nbsp;DROP</p><p># port redirect port coming in on wan to lan<br/>#config redirect<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wan<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option src_dport&nbsp; &nbsp; &nbsp; &nbsp; 80<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option dest&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lan<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option dest_ip&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 192.168.16.235<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option dest_port&nbsp; &nbsp; &nbsp; &nbsp; 80<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option proto&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tcp</p><p># port redirect of remapped ssh port (22001) on wan<br/>#config redirect<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wan<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option src_dport&nbsp; &nbsp; &nbsp; &nbsp; 22001<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option dest&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lan<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option dest_port&nbsp; &nbsp; &nbsp; &nbsp; 22<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option proto&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tcp</p><p># allow IPsec/ESP and ISAKMP passthrough<br/>#config rule<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wan<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option dest&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lan<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option protocol&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;esp<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option target&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ACCEPT</p><p>#config rule<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wan<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option dest&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lan<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option src_port&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;500<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option dest_port&nbsp; &nbsp; &nbsp; &nbsp; 500<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option proto&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; udp<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option target&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ACCEPT</p><p>### FULL CONFIG SECTIONS<br/>#config rule<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lan<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option src_ip&nbsp; &nbsp;192.168.45.2<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option src_mac&nbsp; 00:11:22:33:44:55<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option src_port 80<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option dest&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;wan<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option dest_ip&nbsp; 194.25.2.129<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option dest_port&nbsp; &nbsp; &nbsp; &nbsp; 120<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option proto&nbsp; &nbsp; tcp<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option target&nbsp; &nbsp;REJECT</p><p>#config redirect<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lan<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option src_ip&nbsp; &nbsp;192.168.45.2<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option src_mac&nbsp; 00:11:22:33:44:55<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option src_port&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1024<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option src_dport&nbsp; &nbsp; &nbsp; &nbsp; 80<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option dest_ip&nbsp; 194.25.2.129<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option dest_port&nbsp; &nbsp; &nbsp; &nbsp; 120<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option proto&nbsp; &nbsp; tcp<br/>root@OpenWrt:~#</p><p>/etc/config/mwan3</p><br/><p>root@OpenWrt:~# cat /etc/config/mwan3</p><p>config member &#039;wan_m2_w3&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option weight &#039;3&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option interface &#039;wan&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option metric &#039;2&#039;</p><p>config member &#039;wan2_m2_w3&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option interface &#039;wan2&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option metric &#039;2&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option weight &#039;3&#039;</p><p>config member &#039;wan3_m2_w3&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option interface &#039;wan3&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option metric &#039;2&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option weight &#039;3&#039;</p><p>config member &#039;wan4_m2_w3&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option interface &#039;wan4&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option metric &#039;2&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option weight &#039;3&#039;</p><p>config policy &#039;wan1_only&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; list use_member &#039;wan1_m1_w3&#039;</p><p>config policy &#039;wan2_only&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; list use_member &#039;wan2_m1_w2&#039;</p><p>config policy &#039;wan_wan2_wan3_wan4_loadbalanced&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; list use_member &#039;wan_m2_w3&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; list use_member &#039;wan2_m2_w3&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; list use_member &#039;wan3_m2_w3&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; list use_member &#039;wan4_m2_w3&#039;</p><p>config policy &#039;wan1_pri_wan2_sec&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; list use_member &#039;wan1_m1_w3&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; list use_member &#039;wan2_m2_w2&#039;</p><p>config policy &#039;wan2_pri_wan1_sec&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; list use_member &#039;wan1_m2_w3&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; list use_member &#039;wan2_m1_w2&#039;</p><p>config rule<br/>&nbsp; &nbsp; &nbsp; &nbsp; option dest_ip &#039;0.0.0.0/0&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;all&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option use_policy &#039;wan_wan2_wan3_wan4_loadbalanced&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option equalize &#039;1&#039;</p><p>config interface &#039;wan&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option enabled &#039;1&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option count &#039;1&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option timeout &#039;2&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option interval &#039;5&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option down &#039;3&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option reliability &#039;2&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; list track_ip &#039;61.135.169.125&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; list track_ip &#039;202.108.33.70&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; list track_ip &#039;61.135.181.167&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; list track_ip &#039;103.8.222.23&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option up &#039;8&#039;</p><p>config interface &#039;wan2&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option enabled &#039;1&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; list track_ip &#039;61.135.169.125&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; list track_ip &#039;202.108.33.70&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; list track_ip &#039;61.135.181.167&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; list track_ip &#039;103.8.222.23&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option reliability &#039;2&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option count &#039;1&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option timeout &#039;2&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option interval &#039;5&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option down &#039;3&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option up &#039;8&#039;</p><p>config interface &#039;wan3&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option enabled &#039;1&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; list track_ip &#039;61.135.169.125&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; list track_ip &#039;202.108.33.70&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; list track_ip &#039;61.135.181.167&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; list track_ip &#039;103.8.222.23&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option reliability &#039;2&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option count &#039;1&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option timeout &#039;2&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option interval &#039;5&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option down &#039;3&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option up &#039;8&#039;</p><p>config interface &#039;wan4&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option enabled &#039;1&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; list track_ip &#039;61.135.169.125&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; list track_ip &#039;202.108.33.70&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; list track_ip &#039;61.135.181.167&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; list track_ip &#039;103.8.222.23&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option reliability &#039;2&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option count &#039;1&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option timeout &#039;2&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option interval &#039;5&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option down &#039;3&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option up &#039;8&#039;</p><p>root@OpenWrt:~#</p><p>route -n </p><br/><p>root@OpenWrt:~# route -n<br/>Kernel IP routing table<br/>Destination&nbsp; &nbsp; &nbsp;Gateway&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Genmask&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Flags Metric Ref&nbsp; &nbsp; Use Iface<br/>0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;127.0.0.1&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;UG&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 lo<br/>0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;192.168.122.1&nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;UG&nbsp; &nbsp; 10&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp; 0 eth0.4<br/>0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;192.168.120.1&nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;UG&nbsp; &nbsp; 20&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp; 0 eth0.3<br/>0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;192.168.111.1&nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;UG&nbsp; &nbsp; 30&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp; 0 eth0.2<br/>0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;192.168.119.1&nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;UG&nbsp; &nbsp; 40&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp; 0 eth0.1<br/>192.168.111.0&nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.255.255.0&nbsp; &nbsp;U&nbsp; &nbsp; &nbsp;30&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp; 0 eth0.2<br/>192.168.115.0&nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.255.255.0&nbsp; &nbsp;U&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 br-lan<br/>192.168.119.0&nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.255.255.0&nbsp; &nbsp;U&nbsp; &nbsp; &nbsp;40&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp; 0 eth0.1<br/>192.168.120.0&nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.255.255.0&nbsp; &nbsp;U&nbsp; &nbsp; &nbsp;20&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp; 0 eth0.3<br/>192.168.122.0&nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.255.255.0&nbsp; &nbsp;U&nbsp; &nbsp; &nbsp;10&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp; 0 eth0.4<br/>root@OpenWrt:~#</p><br/><p>Thank you in advance.</p>											<p class="post-edited">(Last edited by <strong>sagitar</strong> on 14 Jan 2013, 06:27)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p189490">
				<div class="post-metadata">
					<div class="post-num">Post #75</div>
					<div class="post-author">sagitar</div>
					<div class="post-datetime">
						21 Jan 2013, 05:43					</div>
				</div>
				<div class="post-content content">
					<p>I uninstalled the mwan3 and re-installed it using the package in r33446, the mwan3 works very well. so, maybe it&nbsp; is a mwan3 issue in r34640.</p><br/><div class="quotebox"><cite>sagitar wrote:</cite><blockquote><p>Hi,Adze.<br/>The mwan3 is very usefull for me, I have used it for several months. Thank you very much.<br/>However,I met some troubles on it today.</p><p>I found the IP rules can be created if an interface up,however ,it can NOT be deleted when the interface down.&nbsp; Could you please check the configure for me ? </p><p>(update: I updated a new firmware for my router and re-configured the mwan3 then found the issue.)</p><br/><p>root@OpenWrt:~# ip rule show<br/>0:&nbsp; &nbsp; &nbsp; from all lookup local<br/>1001:&nbsp; &nbsp;from 192.168.119.145 fwmark 0x0/0x8000 lookup 1001<br/>1002:&nbsp; &nbsp;from 192.168.111.245 fwmark 0x0/0x8000 lookup 1002<br/>1003:&nbsp; &nbsp;from 192.168.120.245 fwmark 0x0/0x8000 lookup 1003<br/>1004:&nbsp; &nbsp;from 192.168.122.145 fwmark 0x0/0x8000 lookup 1004<br/>1008:&nbsp; &nbsp;from all fwmark 0x100/0xff00 lookup 1001<br/>1009:&nbsp; &nbsp;from all fwmark 0x200/0xff00 lookup 1002<br/>1010:&nbsp; &nbsp;from all fwmark 0x300/0xff00 lookup 1003<br/>1011:&nbsp; &nbsp;from all fwmark 0x400/0xff00 lookup 1004<br/>1016:&nbsp; &nbsp;from all fwmark 0x1000/0xff00 lookup 1016<br/>1017:&nbsp; &nbsp;from all fwmark 0x1100/0xff00 lookup 1017<br/>1018:&nbsp; &nbsp;from all fwmark 0x1200/0xff00 lookup 1018<br/>1019:&nbsp; &nbsp;from all fwmark 0x1300/0xff00 lookup 1019<br/>1020:&nbsp; &nbsp;from all fwmark 0x1400/0xff00 lookup 1020<br/>32766:&nbsp; from all lookup main<br/>32767:&nbsp; from all lookup default<br/>root@OpenWrt:~# logread|grep mwan3<br/>Jan 13 19:56:36 OpenWrt user.notice root: mwan3: ifup interface wan4 (eth0.4)<br/>Jan 13 19:56:59 OpenWrt user.notice root: mwan3: No gateway found for interface wan (eth0.1)<br/>Jan 13 19:57:18 OpenWrt user.notice root: mwan3: No gateway found for interface wan2 (eth0.2)<br/>Jan 13 19:57:35 OpenWrt user.notice root: mwan3: No gateway found for interface wan3 (eth0.3)<br/>Jan 13 19:57:41 OpenWrt user.notice root: mwan3: ifup interface wan4 (eth0.4)<br/>Jan 13 20:03:14 OpenWrt user.notice root: mwan3: ifdown interface wan4 (eth0.4)<br/>Jan 13 20:03:52 OpenWrt user.notice root: mwan3: ifup interface wan4 (eth0.4)<br/>Jan 13 20:05:28 OpenWrt user.notice root: mwan3: Lost 1 ping(s) on interface wan4 (eth0.4)<br/>Jan 13 20:32:39 OpenWrt user.notice root: mwan3: Lost 1 ping(s) on interface wan4 (eth0.4)<br/>Jan 13 21:21:18 OpenWrt user.notice root: mwan3: Lost 1 ping(s) on interface wan4 (eth0.4)<br/>Jan 13 21:32:03 OpenWrt user.notice root: mwan3: ifup interface wan (eth0.1)<br/>Jan 13 21:32:23 OpenWrt user.notice root: mwan3: ifup interface wan2 (eth0.2)<br/>Jan 13 21:32:34 OpenWrt user.notice root: mwan3: ifup interface wan3 (eth0.3)<br/>Jan 13 21:32:40 OpenWrt user.notice root: mwan3: Interface wan (eth0.1) is offline<br/>Jan 13 21:32:42 OpenWrt user.notice root: mwan3: ifdown interface wan (eth0.1)<br/>Jan 13 21:32:59 OpenWrt user.notice root: mwan3: Interface wan2 (eth0.2) is offline<br/>Jan 13 21:32:59 OpenWrt user.notice root: mwan3: ifdown interface wan2 (eth0.2)<br/>Jan 13 21:33:11 OpenWrt user.notice root: mwan3: Interface wan3 (eth0.3) is offline<br/>Jan 13 21:33:11 OpenWrt user.notice root: mwan3: ifdown interface wan3 (eth0.3)<br/>root@OpenWrt:~#</p><p>/etc/config/network </p><br/><p>root@OpenWrt:~# cat /etc/config/network<br/>#### VLAN configuration<br/>config switch eth0<br/>&nbsp; &nbsp; &nbsp; &nbsp; option enable&nbsp; &nbsp;1</p><p>config switch_vlan eth0_0<br/>&nbsp; &nbsp; &nbsp; &nbsp; option device&nbsp; &nbsp;&quot;eth0&quot;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option vlan&nbsp; &nbsp; &nbsp;0<br/>&nbsp; &nbsp; &nbsp; &nbsp; option ports&nbsp; &nbsp; &quot;4 8*&quot;</p><p>config switch_vlan eth0_1<br/>&nbsp; &nbsp; &nbsp; &nbsp; option device&nbsp; &nbsp;&quot;eth0&quot;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option vlan&nbsp; &nbsp; &nbsp;1<br/>&nbsp; &nbsp; &nbsp; &nbsp; option ports&nbsp; &nbsp; &quot;0 8&quot;</p><p>config switch_vlan eth0_2<br/>&nbsp; &nbsp; &nbsp; &nbsp; option device&nbsp; &nbsp;&quot;eth0&quot;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option vlan&nbsp; &nbsp; &nbsp;2<br/>&nbsp; &nbsp; &nbsp; &nbsp; option ports&nbsp; &nbsp; &quot;1 8&quot;</p><p>config switch_vlan eth0_3<br/>&nbsp; &nbsp; &nbsp; &nbsp; option device&nbsp; &nbsp;&quot;eth0&quot;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option vlan&nbsp; &nbsp; &nbsp;3<br/>&nbsp; &nbsp; &nbsp; &nbsp; option ports&nbsp; &nbsp; &quot;2 8&quot;</p><p>config switch_vlan eth0_4<br/>&nbsp; &nbsp; &nbsp; &nbsp; option device&nbsp; &nbsp;&quot;eth0&quot;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option vlan&nbsp; &nbsp; &nbsp;4<br/>&nbsp; &nbsp; &nbsp; &nbsp; option ports&nbsp; &nbsp; &quot;3 8&quot;</p><p>#### Loopback configuration<br/>config interface loopback<br/>&nbsp; &nbsp; &nbsp; &nbsp; option ifname&nbsp; &nbsp;&quot;lo&quot;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; static<br/>&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr&nbsp; &nbsp;127.0.0.1<br/>&nbsp; &nbsp; &nbsp; &nbsp; option netmask&nbsp; 255.0.0.0</p><br/><p>#### LAN configuration<br/>config interface lan<br/>&nbsp; &nbsp; &nbsp; &nbsp; option type&nbsp; &nbsp; &nbsp;bridge<br/>&nbsp; &nbsp; &nbsp; &nbsp; option ifname&nbsp; &nbsp;&quot;eth0.0&quot;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; static<br/>&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr&nbsp; &nbsp;192.168.115.100<br/>&nbsp; &nbsp; &nbsp; &nbsp; option netmask&nbsp; 255.255.255.0</p><br/><p>#### WAN configuration<br/>config interface&nbsp; &nbsp; &nbsp; &nbsp; wan<br/>&nbsp; &nbsp; &nbsp; &nbsp; option ifname&nbsp; &nbsp;&quot;eth0.1&quot;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; dhcp<br/>&nbsp; &nbsp; &nbsp; &nbsp; option metric 40<br/>&nbsp; &nbsp; &nbsp; &nbsp; option accept_ra 1</p><p>config interface&nbsp; &nbsp; &nbsp; &nbsp; wan2<br/>&nbsp; &nbsp; &nbsp; &nbsp; option ifname&nbsp; &nbsp;&quot;eth0.2&quot;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; dhcp<br/>&nbsp; &nbsp; &nbsp; &nbsp; option metric 30<br/>&nbsp; &nbsp; &nbsp; &nbsp; option accept_ra 1</p><p>config interface&nbsp; &nbsp; &nbsp; &nbsp; wan3<br/>&nbsp; &nbsp; &nbsp; &nbsp; option ifname&nbsp; &nbsp;&quot;eth0.3&quot;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; dhcp<br/>&nbsp; &nbsp; &nbsp; &nbsp; option metric 20<br/>&nbsp; &nbsp; &nbsp; &nbsp; option accept_ra 1</p><p>config interface&nbsp; &nbsp; &nbsp; &nbsp; wan4<br/>&nbsp; &nbsp; &nbsp; &nbsp; option ifname&nbsp; &nbsp;&quot;eth0.4&quot;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; dhcp<br/>&nbsp; &nbsp; &nbsp; &nbsp; option metric 10<br/>&nbsp; &nbsp; &nbsp; &nbsp; option accept_ra 1<br/>root@OpenWrt:~#</p><p>/etc/config/firware </p><br/><p>root@OpenWrt:~# cat /etc/config/firewall<br/>config defaults<br/>&nbsp; &nbsp; &nbsp; &nbsp; option syn_flood&nbsp; &nbsp; &nbsp; &nbsp; 1<br/>&nbsp; &nbsp; &nbsp; &nbsp; option input&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DROP<br/>&nbsp; &nbsp; &nbsp; &nbsp; option output&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ACCEPT<br/>&nbsp; &nbsp; &nbsp; &nbsp; option forward&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; REJECT<br/># Uncomment this line to disable ipv6 rules<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option disable_ipv6&nbsp; &nbsp; &nbsp;1</p><p>config zone<br/>&nbsp; &nbsp; &nbsp; &nbsp; option name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lan<br/>&nbsp; &nbsp; &nbsp; &nbsp; option network&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#039;lan&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option input&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ACCEPT<br/>&nbsp; &nbsp; &nbsp; &nbsp; option output&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ACCEPT<br/>&nbsp; &nbsp; &nbsp; &nbsp; option forward&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; REJECT</p><p>config zone<br/>&nbsp; &nbsp; &nbsp; &nbsp; option name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;wan<br/>&nbsp; &nbsp; &nbsp; &nbsp; option network&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#039;wan wan2 wan3 wan4&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option input&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; REJECT<br/>&nbsp; &nbsp; &nbsp; &nbsp; option output&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ACCEPT<br/>&nbsp; &nbsp; &nbsp; &nbsp; option forward&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; REJECT<br/>&nbsp; &nbsp; &nbsp; &nbsp; option masq&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1<br/>&nbsp; &nbsp; &nbsp; &nbsp; option mtu_fix&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1</p><p>config forwarding<br/>&nbsp; &nbsp; &nbsp; &nbsp; option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lan<br/>&nbsp; &nbsp; &nbsp; &nbsp; option dest&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;wan</p><p># We need to accept udp packets on port 68,<br/># see <a href="https://dev.openwrt.org/ticket/4108">https://dev.openwrt.org/ticket/4108</a><br/>config rule<br/>&nbsp; &nbsp; &nbsp; &nbsp; option name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Allow-DHCP-Renew<br/>&nbsp; &nbsp; &nbsp; &nbsp; option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wan<br/>&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; udp<br/>&nbsp; &nbsp; &nbsp; &nbsp; option dest_port&nbsp; &nbsp; &nbsp; &nbsp; 68<br/>&nbsp; &nbsp; &nbsp; &nbsp; option target&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ACCEPT<br/>&nbsp; &nbsp; &nbsp; &nbsp; option family&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ipv4</p><p># Allow IPv4 ping<br/>config rule<br/>&nbsp; &nbsp; &nbsp; &nbsp; option name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Allow-Ping<br/>&nbsp; &nbsp; &nbsp; &nbsp; option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wan<br/>&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; icmp<br/>&nbsp; &nbsp; &nbsp; &nbsp; option icmp_type&nbsp; &nbsp; &nbsp; &nbsp; echo-request<br/>&nbsp; &nbsp; &nbsp; &nbsp; option family&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ipv4<br/>&nbsp; &nbsp; &nbsp; &nbsp; option target&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ACCEPT</p><p># Allow DHCPv6 replies<br/># see <a href="https://dev.openwrt.org/ticket/10381">https://dev.openwrt.org/ticket/10381</a><br/>config rule<br/>&nbsp; &nbsp; &nbsp; &nbsp; option name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Allow-DHCPv6<br/>&nbsp; &nbsp; &nbsp; &nbsp; option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wan<br/>&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; udp<br/>&nbsp; &nbsp; &nbsp; &nbsp; option src_ip&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;fe80::/10<br/>&nbsp; &nbsp; &nbsp; &nbsp; option src_port&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;547<br/>&nbsp; &nbsp; &nbsp; &nbsp; option dest_ip&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fe80::/10<br/>&nbsp; &nbsp; &nbsp; &nbsp; option dest_port&nbsp; &nbsp; &nbsp; &nbsp; 546<br/>&nbsp; &nbsp; &nbsp; &nbsp; option family&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ipv6<br/>&nbsp; &nbsp; &nbsp; &nbsp; option target&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ACCEPT</p><p># Allow essential incoming IPv6 ICMP traffic<br/>config rule<br/>&nbsp; &nbsp; &nbsp; &nbsp; option name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Allow-ICMPv6-Input<br/>&nbsp; &nbsp; &nbsp; &nbsp; option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wan<br/>&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; icmp<br/>&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo-request<br/>&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo-reply<br/>&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; destination-unreachable<br/>&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; packet-too-big<br/>&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; time-exceeded<br/>&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bad-header<br/>&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; unknown-header-type<br/>&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; router-solicitation<br/>&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; neighbour-solicitation<br/>&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; router-advertisement<br/>&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; neighbour-advertisement<br/>&nbsp; &nbsp; &nbsp; &nbsp; option limit&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1000/sec<br/>&nbsp; &nbsp; &nbsp; &nbsp; option family&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ipv6<br/>&nbsp; &nbsp; &nbsp; &nbsp; option target&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ACCEPT</p><p># Allow essential forwarded IPv6 ICMP traffic<br/>config rule<br/>&nbsp; &nbsp; &nbsp; &nbsp; option name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Allow-ICMPv6-Forward<br/>&nbsp; &nbsp; &nbsp; &nbsp; option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wan<br/>&nbsp; &nbsp; &nbsp; &nbsp; option dest&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*<br/>&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; icmp<br/>&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo-request<br/>&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo-reply<br/>&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; destination-unreachable<br/>&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; packet-too-big<br/>&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; time-exceeded<br/>&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bad-header<br/>&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; unknown-header-type<br/>&nbsp; &nbsp; &nbsp; &nbsp; option limit&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1000/sec<br/>&nbsp; &nbsp; &nbsp; &nbsp; option family&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ipv6<br/>&nbsp; &nbsp; &nbsp; &nbsp; option target&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ACCEPT</p><p># include a file with users custom iptables rules<br/>config include<br/>&nbsp; &nbsp; &nbsp; &nbsp; option path /etc/firewall.user</p><br/><p>### EXAMPLE CONFIG SECTIONS<br/># do not allow a specific ip to access wan<br/>#config rule<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lan<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option src_ip&nbsp; &nbsp;192.168.45.2<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option dest&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;wan<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option proto&nbsp; &nbsp; tcp<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option target&nbsp; &nbsp;REJECT</p><p># block a specific mac on wan<br/>#config rule<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option dest&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;wan<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option src_mac&nbsp; 00:11:22:33:44:66<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option target&nbsp; &nbsp;REJECT</p><p># block incoming ICMP traffic on a zone<br/>#config rule<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lan<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option proto&nbsp; &nbsp; ICMP<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option target&nbsp; &nbsp;DROP</p><p># port redirect port coming in on wan to lan<br/>#config redirect<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wan<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option src_dport&nbsp; &nbsp; &nbsp; &nbsp; 80<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option dest&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lan<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option dest_ip&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 192.168.16.235<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option dest_port&nbsp; &nbsp; &nbsp; &nbsp; 80<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option proto&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tcp</p><p># port redirect of remapped ssh port (22001) on wan<br/>#config redirect<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wan<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option src_dport&nbsp; &nbsp; &nbsp; &nbsp; 22001<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option dest&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lan<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option dest_port&nbsp; &nbsp; &nbsp; &nbsp; 22<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option proto&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tcp</p><p># allow IPsec/ESP and ISAKMP passthrough<br/>#config rule<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wan<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option dest&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lan<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option protocol&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;esp<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option target&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ACCEPT</p><p>#config rule<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wan<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option dest&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lan<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option src_port&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;500<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option dest_port&nbsp; &nbsp; &nbsp; &nbsp; 500<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option proto&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; udp<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option target&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ACCEPT</p><p>### FULL CONFIG SECTIONS<br/>#config rule<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lan<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option src_ip&nbsp; &nbsp;192.168.45.2<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option src_mac&nbsp; 00:11:22:33:44:55<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option src_port 80<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option dest&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;wan<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option dest_ip&nbsp; 194.25.2.129<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option dest_port&nbsp; &nbsp; &nbsp; &nbsp; 120<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option proto&nbsp; &nbsp; tcp<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option target&nbsp; &nbsp;REJECT</p><p>#config redirect<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lan<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option src_ip&nbsp; &nbsp;192.168.45.2<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option src_mac&nbsp; 00:11:22:33:44:55<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option src_port&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1024<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option src_dport&nbsp; &nbsp; &nbsp; &nbsp; 80<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option dest_ip&nbsp; 194.25.2.129<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option dest_port&nbsp; &nbsp; &nbsp; &nbsp; 120<br/>#&nbsp; &nbsp; &nbsp; &nbsp;option proto&nbsp; &nbsp; tcp<br/>root@OpenWrt:~#</p><p>/etc/config/mwan3</p><br/><p>root@OpenWrt:~# cat /etc/config/mwan3</p><p>config member &#039;wan_m2_w3&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option weight &#039;3&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option interface &#039;wan&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option metric &#039;2&#039;</p><p>config member &#039;wan2_m2_w3&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option interface &#039;wan2&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option metric &#039;2&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option weight &#039;3&#039;</p><p>config member &#039;wan3_m2_w3&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option interface &#039;wan3&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option metric &#039;2&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option weight &#039;3&#039;</p><p>config member &#039;wan4_m2_w3&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option interface &#039;wan4&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option metric &#039;2&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option weight &#039;3&#039;</p><p>config policy &#039;wan1_only&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; list use_member &#039;wan1_m1_w3&#039;</p><p>config policy &#039;wan2_only&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; list use_member &#039;wan2_m1_w2&#039;</p><p>config policy &#039;wan_wan2_wan3_wan4_loadbalanced&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; list use_member &#039;wan_m2_w3&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; list use_member &#039;wan2_m2_w3&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; list use_member &#039;wan3_m2_w3&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; list use_member &#039;wan4_m2_w3&#039;</p><p>config policy &#039;wan1_pri_wan2_sec&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; list use_member &#039;wan1_m1_w3&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; list use_member &#039;wan2_m2_w2&#039;</p><p>config policy &#039;wan2_pri_wan1_sec&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; list use_member &#039;wan1_m2_w3&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; list use_member &#039;wan2_m1_w2&#039;</p><p>config rule<br/>&nbsp; &nbsp; &nbsp; &nbsp; option dest_ip &#039;0.0.0.0/0&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;all&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option use_policy &#039;wan_wan2_wan3_wan4_loadbalanced&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option equalize &#039;1&#039;</p><p>config interface &#039;wan&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option enabled &#039;1&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option count &#039;1&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option timeout &#039;2&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option interval &#039;5&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option down &#039;3&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option reliability &#039;2&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; list track_ip &#039;61.135.169.125&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; list track_ip &#039;202.108.33.70&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; list track_ip &#039;61.135.181.167&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; list track_ip &#039;103.8.222.23&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option up &#039;8&#039;</p><p>config interface &#039;wan2&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option enabled &#039;1&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; list track_ip &#039;61.135.169.125&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; list track_ip &#039;202.108.33.70&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; list track_ip &#039;61.135.181.167&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; list track_ip &#039;103.8.222.23&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option reliability &#039;2&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option count &#039;1&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option timeout &#039;2&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option interval &#039;5&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option down &#039;3&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option up &#039;8&#039;</p><p>config interface &#039;wan3&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option enabled &#039;1&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; list track_ip &#039;61.135.169.125&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; list track_ip &#039;202.108.33.70&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; list track_ip &#039;61.135.181.167&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; list track_ip &#039;103.8.222.23&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option reliability &#039;2&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option count &#039;1&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option timeout &#039;2&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option interval &#039;5&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option down &#039;3&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option up &#039;8&#039;</p><p>config interface &#039;wan4&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option enabled &#039;1&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; list track_ip &#039;61.135.169.125&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; list track_ip &#039;202.108.33.70&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; list track_ip &#039;61.135.181.167&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; list track_ip &#039;103.8.222.23&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option reliability &#039;2&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option count &#039;1&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option timeout &#039;2&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option interval &#039;5&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option down &#039;3&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option up &#039;8&#039;</p><p>root@OpenWrt:~#</p><p>route -n </p><br/><p>root@OpenWrt:~# route -n<br/>Kernel IP routing table<br/>Destination&nbsp; &nbsp; &nbsp;Gateway&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Genmask&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Flags Metric Ref&nbsp; &nbsp; Use Iface<br/>0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;127.0.0.1&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;UG&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 lo<br/>0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;192.168.122.1&nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;UG&nbsp; &nbsp; 10&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp; 0 eth0.4<br/>0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;192.168.120.1&nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;UG&nbsp; &nbsp; 20&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp; 0 eth0.3<br/>0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;192.168.111.1&nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;UG&nbsp; &nbsp; 30&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp; 0 eth0.2<br/>0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;192.168.119.1&nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;UG&nbsp; &nbsp; 40&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp; 0 eth0.1<br/>192.168.111.0&nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.255.255.0&nbsp; &nbsp;U&nbsp; &nbsp; &nbsp;30&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp; 0 eth0.2<br/>192.168.115.0&nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.255.255.0&nbsp; &nbsp;U&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 br-lan<br/>192.168.119.0&nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.255.255.0&nbsp; &nbsp;U&nbsp; &nbsp; &nbsp;40&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp; 0 eth0.1<br/>192.168.120.0&nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.255.255.0&nbsp; &nbsp;U&nbsp; &nbsp; &nbsp;20&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp; 0 eth0.3<br/>192.168.122.0&nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.255.255.0&nbsp; &nbsp;U&nbsp; &nbsp; &nbsp;10&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp; 0 eth0.4<br/>root@OpenWrt:~#</p><br/><p>Thank you in advance.</p></blockquote></div>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 3 of 65</div><nav><ul><li><a href="viewtopic.php%3Fid=39052&amp;p=1.html">1</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=2.html">2</a></li><li class="pagination-current"><span>3</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=4.html">4</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=5.html">5</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=65.html">65</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0.001 -->

</body>
</html>