<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Trying to get Netgear/Sierra AirCard 340U AT&amp;T BEAM USB Modem working</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 5 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p223381">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">cititechs</div>
					<div class="post-datetime">
						21 Jan 2014, 19:55					</div>
				</div>
				<div class="post-content content">
					<p>Hi all I am trying to get the 340U&nbsp; modem working on attitude adjustment or&nbsp; barrier breaker. </p><p>I was informed in another thread that I am to use QMI. However I seem to be finding limited information on that .</p><p><a href="https://forum.openwrt.org/viewtopic.php?id=47796">https://forum.openwrt.org/viewtopic.php?id=47796</a></p><p>Any additional details or assistances would be highly appreciated. </p><p>* Such as should I be using barrier breaker or attitude adjustment. <br />* How should my /etc/config/network look like. <br />* Which packages I should be using. </p><p>Here is a little environmental I&#039;ve been testing with where I couldn&#039;t get it working. <br />Hardware</p><p>Modem&nbsp; Netgear/Sierra AirCard 340U AT&amp;T BEAM USB Modem</p><p>Modem Firmware - _SWI9X15C_01.05.11.52_00_ATT_002.004_000&nbsp; - Downloaded from Netgear site labeled 340U for Linux</p><div class="codebox"><pre><code> Buffalo WZR-HP-G300NH2 </code></pre></div><p>Version <br /></p><div class="codebox"><pre><code> ATTITUDE ADJUSTMENT (12.09, r36088) </code></pre></div><p>Output of lsusb<br /></p><div class="codebox"><pre><code>root@OpenWrt:~# lsusb
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
Bus 001 Device 005: ID 1199:9051 Sierra Wireless, Inc.</code></pre></div><p>Output of /dev/ttyUSB<br /></p><div class="codebox"><pre><code>root@OpenWrt:~# /dev/ttyUSB
ttyUSB0  ttyUSB1  ttyUSB2  ttyUSB3  ttyUSB4</code></pre></div><p>Output of /etc/config/network<br /></p><div class="codebox"><pre><code>3G
config interface &#039;wan2&#039;
        option _orig_ifname &#039;wwan0&#039;
        option _orig_bridge &#039;false&#039;
        option proto &#039;3g&#039;
        option apn &#039;broadband&#039;
        option metric &#039;20&#039;
        option service &#039;umts&#039;
        option device &#039;/dev/ttyUSB2&#039;</code></pre></div><p>Out of /etc/modules.d/60-usb-serial</p><div class="codebox"><pre><code>root@OpenWrt:~# cat /etc/modules.d/60-usb-serial
usbserial vendor=0x1199 product=0x9051</code></pre></div><p>Out of logread when modem is plugged into USB<br /></p><div class="codebox"><pre><code>kern.info kernel: [10888.260000] usb 1-1: new high-speed USB device number 5 using ehci-platform
kern.warn kernel: [10888.410000] usb 1-1: config 1 has an invalid interface number: 8 but max is 4
kern.warn kernel: [10888.410000] usb 1-1: config 1 has an invalid interface number: 9 but max is 4
kern.warn kernel: [10888.420000] usb 1-1: config 1 has no interface number 1
kern.warn kernel: [10888.430000] usb 1-1: config 1 has no interface number 4
kern.info kernel: [10888.440000] usbserial_generic 1-1:1.0: generic converter detected
kern.info kernel: [10888.440000] usb 1-1: generic converter now attached to ttyUSB0
kern.info kernel: [10888.450000] usbserial_generic 1-1:1.2: generic converter detected
kern.info kernel: [10888.460000] usb 1-1: generic converter now attached to ttyUSB1
kern.info kernel: [10888.460000] usbserial_generic 1-1:1.3: generic converter detected
kern.info kernel: [10888.470000] usb 1-1: generic converter now attached to ttyUSB2
kern.info kernel: [10888.480000] usbserial_generic 1-1:1.8: generic converter detected
kern.info kernel: [10888.480000] usb 1-1: generic converter now attached to ttyUSB3
kern.info kernel: [10888.500000] usbserial_generic 1-1:1.9: generic converter detected
kern.info kernel: [10888.500000] usb 1-1: generic converter now attached to ttyUSB4
user.notice usb-modeswitch: 1-1:1.0: Manufacturer=Sierra_Wireless,_Incorporated Product=AirCard_340U 
user.notice usb-modeswitch: 1-1:1.2: Manufacturer=Sierra_Wireless,_Incorporated Product=AirCard_340U 
user.notice usb-modeswitch: 1-1:1.3: Manufacturer=Sierra_Wireless,_Incorporated Product=AirCard_340U 
user.notice usb-modeswitch: 1-1:1.8: Manufacturer=Sierra_Wireless,_Incorporated Product=AirCard_340U 
user.notice usb-modeswitch: 1-1:1.9: Manufacturer=Sierra_Wireless,_Incorporated Product=AirCard_340U </code></pre></div>											<p class="post-edited">(Last edited by <strong>cititechs</strong> on 21 Jan 2014, 19:55)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p223425">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">neryba</div>
					<div class="post-datetime">
						22 Jan 2014, 08:17					</div>
				</div>
				<div class="post-content content">
					<p>what is gcom respond? </p><div class="codebox"><pre><code>gcom -d /dev/ttyUSB2</code></pre></div><p> test also all another interfaces.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p223497">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">cititechs</div>
					<div class="post-datetime">
						22 Jan 2014, 20:59					</div>
				</div>
				<div class="post-content content">
					<p>Hi Neryba,</p><p>Thanks for a prompt response. gcom doesn&#039;t respond to any of the interfaces that appear. Below is the output.<br /></p><div class="codebox"><pre><code>root@OpenWrt:~# gcom -d /dev/ttyUSB
ttyUSB0  ttyUSB1  ttyUSB2  ttyUSB3  ttyUSB4
root@OpenWrt:~# gcom -d /dev/ttyUSB0
 ***SIM ERROR***
Check device port configuration.
Check SIM is inserted
Test SIM in a mobile phone?
root@OpenWrt:~# gcom -d /dev/ttyUSB1
 ***SIM ERROR***
Check device port configuration.
Check SIM is inserted
Test SIM in a mobile phone?
root@OpenWrt:~# gcom -d /dev/ttyUSB2
 ***SIM ERROR***
Check device port configuration.
Check SIM is inserted
Test SIM in a mobile phone?
root@OpenWrt:~# gcom -d /dev/ttyUSB3
 ***SIM ERROR***
Check device port configuration.
Check SIM is inserted
Test SIM in a mobile phone?
root@OpenWrt:~# gcom -d /dev/ttyUSB4
 ***SIM ERROR***
Check device port configuration.
Check SIM is inserted
Test SIM in a mobile phone?
root@OpenWrt:~#</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p223540">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">neryba</div>
					<div class="post-datetime">
						23 Jan 2014, 11:00					</div>
				</div>
				<div class="post-content content">
					<p>Hmm, here 3 possible problems:<br />1. Yours SIM not respond - Check this USB on another PC or use &quot;gcom info -d /dev/ttyUSB2&quot; for all interfaces, if device respond correctly, that means SIM not connected propertly.<br />2. install another driver - install kmod-usb-serial-option the comment or remove line &quot;usbserial vendor=0x1199 product=0x9051&quot; on /etc/modules.d/60-usb-serial and run </p><div class="codebox"><pre><code>echo &quot;1199 9051&quot; &gt; / sys/bus/usb-serial/drivers/option1/new_id</code></pre></div><p> and test connection again on all ports.<br />3. maybe you need install QMI driver.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p223549">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">JonnyM</div>
					<div class="post-datetime">
						23 Jan 2014, 15:47					</div>
				</div>
				<div class="post-content content">
					<p>There is currently no driver support at all in linux for 1199:9051, I guess the dongle is just too new and no one has been able to test and add driver support for it. You can probably use it in ppp serial modem mode and /dev/ttyUSB2 is the most likely modem device. </p><p>The higher interface numbers (8 and 9) which the serial driver has created ttyUSB3 and ttyUSB4 from are direct net interfaces, sierra_net and qmi_wwan are likely driver candidates for them but they do currently not support 1199:9051.<br />There is anyway no use in trying to get a response from these two interfaces with gcom.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p223594">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">cititechs</div>
					<div class="post-datetime">
						24 Jan 2014, 06:23					</div>
				</div>
				<div class="post-content content">
					<p>nerbya, </p><p>I was able to get the modem going with your suggestion. Removing it from /etc/modules.d/60-usb-serial and loading it manually after rebooting the router seemed to be the trick. There seems to be a timing issue when this device is plugged as upon reboot. The tty are detected but don&#039;t work. But if you reboot and load manually seems to work. </p><p>The timing issue on this card is mentioned in this thread. <br /><a href="https://forum.openwrt.org/viewtopic.php?id=47796">https://forum.openwrt.org/viewtopic.php?id=47796</a></p><p>Then Proxicast states purchasing there USBHub helps with the know timing issue.&nbsp; See Note 2 towards bottom in red.<br /><a href="http://www.proxicast.com/AbsoluteFM/afmmain.aspx?faqid=268">http://www.proxicast.com/AbsoluteFM/afm … ?faqid=268</a></p><p>As JonnyM stated I was able to get it to connect in ppp serial modem mode using ttyUSB2. However when I connect that way the LCD no longer reports the current usage which was the whole point I wanted this modem. It seems once I connect via PPP the usage disappears. </p><p>If I test the modem in my Windows 7 PC with the Driver loaded. It works and the usage continues to display correctly as it&#039;s actively being used. </p><p>I know there are firmware such as Rooters that track usage via anything that flows out that device. I would almost prefer an AT command I could send to get actual usage.&nbsp; But the LCD on the modem&nbsp; is what I really want to get going. I guess who or how do we request a driver ?&nbsp; Is this an Openwrt community thing or Sierra as it seems others having it working on Ubuntu . </p><p><a href="http://ubuntuforums.org/showthread.php?t=2188883">http://ubuntuforums.org/showthread.php?t=2188883</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p223613">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">JonnyM</div>
					<div class="post-datetime">
						24 Jan 2014, 13:16					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>cititechs wrote:</cite><blockquote><p>I know there are firmware such as Rooters that track usage via anything that flows out that device. I would almost prefer an AT command I could send to get actual usage.&nbsp; But the LCD on the modem&nbsp; is what I really want to get going. I guess who or how do we request a driver ?&nbsp; Is this an Openwrt community thing or Sierra as it seems others having it working on Ubuntu . </p><p><a href="http://ubuntuforums.org/showthread.php?t=2188883">http://ubuntuforums.org/showthread.php?t=2188883</a></p></blockquote></div><p>In the ubuntuforums post the usb id of his AC340U is not the same as yours and he has got additional high numbered interfaces (12 and 13), interfaces which are not on yours and this is probably due to the flashing you did with the linux firmware for the dongle. His dongle is handled by the mbim driver which is a MS Win8 standard but I think Netgear made it easy for themselves with the Linux firmware and removed the mbim function.</p><p>Linux has recently got a cdc_mbim driver but mbim support is afaik not yet available in OpenWRT, the communication libraries and command line application (the ubuntuforums guy uses&nbsp; mbim-network) has to be re-written, they are huge and would occupy too much of a routers flash.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p224532">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">bmork</div>
					<div class="post-datetime">
						4 Feb 2014, 13:40					</div>
				</div>
				<div class="post-content content">
					<p>If #8 is typically a QMI function on Sierra devices. I&#039;ll add 1199:9051 to the qmi_wwan and qcserial drivers in mainline.&nbsp; It will take some time before this flows back to OpenWRT though....</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p277250">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">HalLogan</div>
					<div class="post-datetime">
						23 May 2015, 01:28					</div>
				</div>
				<div class="post-content content">
					<p>Hi Cititechs, I&#039;m trying to retrace your steps in Attitude Adjustment and thus far I&#039;m not getting any /dev/ttyUSB devices. I can see the same output as yours for lsusb but that&#039;s where my luck runs out. Do you happen to recall what set of packages you were using and any specific configs you did? I&#039;m working on getting a 340U to work under MBIM with Chaos Calmer (which is awesome) and I expect that will work without too much difficulty. However it would be extremely useful if I could get it working under Attitude Adjustment as well, any help you or anyone else can offer is much appreciated. Cheers!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p277252">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">cititechs</div>
					<div class="post-datetime">
						23 May 2015, 01:48					</div>
				</div>
				<div class="post-content content">
					<p>Hi HalLogan, </p><p>Sounds like your missing a package that creates the ttyUSB I cant recall the exact one you need but it has to do with serial modems. You can try installing the&nbsp; one below&nbsp; but am not a 100% sure if this is the one I used .&nbsp; Use opkg to install it.</p><p>kmod-usb-serial-sierrawireless</p><p>Also the article below has some other packages that you may have to install. To make it appear. </p><p><a href="http://wiki.openwrt.org/doc/howtobuild/wireless-router-with-a-3g-dongle">http://wiki.openwrt.org/doc/howtobuild/ … -3g-dongle</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p283185">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">HalLogan</div>
					<div class="post-datetime">
						12 Jul 2015, 06:54					</div>
				</div>
				<div class="post-content content">
					<p>Thanks Cititechs. This eventually worked for me under AA. For me the /dev/ttyUSBx device didn&#039;t show until I did the echo command in neryba&#039;s comment. After that a service network restart had me in business. Cheers!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p288746">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">cititechs</div>
					<div class="post-datetime">
						22 Aug 2015, 04:19					</div>
				</div>
				<div class="post-content content">
					<p>Continuing down the thread of messing with the AirCard 340U. I&#039;ve been trying to get it to work now with QMI . <br />Following the directions posted on the wiki . <a href="http://wiki.openwrt.org/doc/recipes/ltedongle">http://wiki.openwrt.org/doc/recipes/ltedongle</a></p><p>It almost works it gets connected but it doesn&#039;t receive an IP . <br />I saw this thread between neryba and bmork that states the device needs to use&nbsp; 802.3<br /><a href="https://forum.openwrt.org/viewtopic.php?id=54233">https://forum.openwrt.org/viewtopic.php?id=54233</a></p><p>However whenever I try to put the device 802.3 mode using the uqmi command of </p><p>uqmi -s -d &quot;$device&quot; --wda-set-data-format 802.3 . <br />It doesn&#039;t set during my active session nor during reboot .</p><p>Here are some log entries I also noticed. </p><p>qmi_wwan 1-1.2:1.8: wdm_int_callback - 0 bytes<br />qmi_wwan 1-1.2:1.8: nonzero urb status received: -71</p><p>Any guidance on how to get it to set on 802.3 mode would be appreciated. Router I am using is the TP-LINK N750 AKA 4300. Tried with BB and with CHAOS.</p>											<p class="post-edited">(Last edited by <strong>cititechs</strong> on 22 Aug 2015, 04:21)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p291209">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">cititechs</div>
					<div class="post-datetime">
						11 Sep 2015, 04:48					</div>
				</div>
				<div class="post-content content">
					<p>I could still use help on this. Is it possible to find libqmi 1.10 I believe it works with that version but its not in the package repo.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p309000">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">cititechs</div>
					<div class="post-datetime">
						25 Jan 2016, 19:04					</div>
				</div>
				<div class="post-content content">
					<p>So finally got the modem to connect but I cant get an IP from DHCP.</p><br /><p>ifconfig</p><p>wwan0&nbsp; &nbsp; &nbsp;Link encap:Ethernet&nbsp; HWaddr A6:6F:F7:60:00:44<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:0 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:20 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:1000<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:0 (0.0 B)&nbsp; TX bytes:6840 (6.6 KiB)</p><br /><p>root@OpenWrt:~# uqmi -d /dev/cdc-wdm0 --get-data-status<br />&quot;connected&quot;</p><br /><p>root@OpenWrt:~# udhcpc<br />udhcpc (v1.24.1) started<br />Sending discover...<br />Sending discover...<br />Sending discover...</p><p>Logread</p><p>Mon Jan 25 12:40:20 2016 daemon.notice netifd: Interface &#039;WAN3&#039; is enabled<br />Mon Jan 25 12:40:20 2016 daemon.notice netifd: Network device &#039;wwan0&#039; link is up<br />Mon Jan 25 12:40:20 2016 daemon.notice netifd: Interface &#039;WAN3&#039; has link connectivity<br />Mon Jan 25 12:40:20 2016 daemon.notice netifd: Interface &#039;WAN3&#039; is setting up now<br />Mon Jan 25 12:40:20 2016 daemon.notice netifd: WAN3 (10998): udhcpc (v1.24.1) started<br />Mon Jan 25 12:40:20 2016 daemon.notice netifd: WAN3 (10998): Sending discover...<br />Mon Jan 25 12:40:23 2016 daemon.notice netifd: WAN3 (10998): Sending discover...<br />Mon Jan 25 12:40:26 2016 daemon.notice netifd: WAN3 (10998): Sending discover...<br />root@OpenWrt:~#</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p334344">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">ken.seitz</div>
					<div class="post-datetime">
						13 Aug 2016, 18:52					</div>
				</div>
				<div class="post-content content">
					<p>I did manage to get this working thanks to a large degree to this post. The key is setting the data format to 802.3 vs. raw-IP.</p><p>Here is the script that I use in the /etc/hotplug.d/usb/misc folder to do this at boot:<br />#!/bin/sh<br />device=&quot;/dev/cdc-wdm0&quot;</p><p># Disconnect<br />uqmi -s -d &quot;$device&quot; --stop-network 0xffffffff&nbsp; &nbsp; --autoconnect &gt; /dev/null</p><p># Configure and Bring Up<br />sleep 5<br />uqmi -s -d &quot;$device&quot; --wda-set-data-format 802.3<br />uqmi -s -d &quot;$device&quot; --start-network &quot;broadband&quot; --autoconnect &gt; /dev/null</p><br /><p>I&#039;m running on the 01.13.12.13 firmware as I couldn&#039;t get the 01.13.12.14 update to take.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>