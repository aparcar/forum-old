<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Stability issues with high USB I/O</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 21 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p138290">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">stevo</div>
					<div class="post-datetime">
						1 Jul 2011, 11:22					</div>
				</div>
				<div class="post-content content">
					<p>Hi,<br />I am having issues with my Netgear WNDR3700 under load. It is used as a small NAS and Media Server with afpd, minidlna and mpd running. Via an usb hub I connected a usb stick for /overlay, a usb soundcard and a 1TB 2,5&quot; drive. The hdd has 2 partitions, one formatted ext3 for Time Machine backups and one NTFS for music/data. </p><p>This is working fine most of the time, however when copying files to the data partition while running a TM backup, the router sometimes virtually throws out the usb drive (/dev/sdb) and then recognizes it again as /dev/sdc. </p><p>The drive works fine attached to a pc. I have the impression this might be a memory management issue?</p><p>Do you have any ideas? Thanks in advance!</p><br /><br /><p>Here is the dmesg output:</p><p>[...]<br />usb 1-1.3.2: reset high speed USB device using ar71xx-ehci and address 5<br />sd 1:0:0:0: [sdb] Unhandled error code<br />sd 1:0:0:0: [sdb]&nbsp; Result: hostbyte=0x07 driverbyte=0x00<br />sd 1:0:0:0: [sdb] CDB: cdb[0]=0x28: 28 00 3e 33 4f 77 00 00 f0 00<br />end_request: I/O error, dev sdb, sector 1043550071<br />Buffer I/O error on device sdb1, logical block 130443751<br />Buffer I/O error on device sdb1, logical block 130443752<br />Buffer I/O error on device sdb1, logical block 130443753<br />Buffer I/O error on device sdb1, logical block 130443754<br />Buffer I/O error on device sdb1, logical block 130443755<br />Buffer I/O error on device sdb1, logical block 130443756<br />Buffer I/O error on device sdb1, logical block 130443757<br />Buffer I/O error on device sdb1, logical block 130443758<br />Buffer I/O error on device sdb1, logical block 130443759<br />Buffer I/O error on device sdb1, logical block 130443760<br />sd 1:0:0:0: [sdb] Unhandled error code<br />sd 1:0:0:0: [sdb]&nbsp; Result: hostbyte=0x07 driverbyte=0x00<br />sd 1:0:0:0: [sdb] CDB: cdb[0]=0x28: 28 00 3e 33 50 67 00 00 10 00<br />end_request: I/O error, dev sdb, sector 1043550311<br />sd 1:0:0:0: [sdb] Unhandled error code<br />sd 1:0:0:0: [sdb]&nbsp; Result: hostbyte=0x07 driverbyte=0x00<br />sd 1:0:0:0: [sdb] CDB: cdb[0]=0x2a: 2a 00 4c 7f 23 7f 00 00 20 00<br />end_request: I/O error, dev sdb, sector 1283400575<br />sd 1:0:0:0: [sdb] Unhandled error code<br />sd 1:0:0:0: [sdb]&nbsp; Result: hostbyte=0x07 driverbyte=0x00<br />sd 1:0:0:0: [sdb] CDB: cdb[0]=0x2a: 2a 00 4c 7f 23 cf 00 00 10 00<br />end_request: I/O error, dev sdb, sector 1283400655<br />sd 1:0:0:0: [sdb] Unhandled error code<br />sd 1:0:0:0: [sdb]&nbsp; Result: hostbyte=0x07 driverbyte=0x00<br />sd 1:0:0:0: [sdb] CDB: cdb[0]=0x2a: 2a 00 4c 7f 7b 7f 00 00 08 00<br />end_request: I/O error, dev sdb, sector 1283423103<br />sd 1:0:0:0: [sdb] Unhandled error code<br />sd 1:0:0:0: [sdb]&nbsp; Result: hostbyte=0x07 driverbyte=0x00<br />sd 1:0:0:0: [sdb] CDB: cdb[0]=0x2a: 2a 00 4c 7f 7b cf 00 00 08 00<br />end_request: I/O error, dev sdb, sector 1283423183<br />sd 1:0:0:0: [sdb] Unhandled error code<br />sd 1:0:0:0: [sdb]&nbsp; Result: hostbyte=0x07 driverbyte=0x00<br />sd 1:0:0:0: [sdb] CDB: cdb[0]=0x2a: 2a 00 4c 7d 21 b7 00 00 08 00<br />end_request: I/O error, dev sdb, sector 1283269047<br />sd 1:0:0:0: [sdb] Unhandled error code<br />sd 1:0:0:0: [sdb]&nbsp; Result: hostbyte=0x07 driverbyte=0x00<br />sd 1:0:0:0: [sdb] CDB: cdb[0]=0x2a: 2a 00 4c 7d 2b bf 00 00 08 00<br />end_request: I/O error, dev sdb, sector 1283271615<br />sd 1:0:0:0: [sdb] Unhandled error code<br />sd 1:0:0:0: [sdb]&nbsp; Result: hostbyte=0x07 driverbyte=0x00<br />sd 1:0:0:0: [sdb] CDB: cdb[0]=0x2a: 2a 00 4c 7d 2b df 00 00 08 00<br />end_request: I/O error, dev sdb, sector 1283271647<br />sd 1:0:0:0: [sdb] Unhandled error code<br />sd 1:0:0:0: [sdb]&nbsp; Result: hostbyte=0x07 driverbyte=0x00<br />sd 1:0:0:0: [sdb] CDB: cdb[0]=0x2a: 2a 00 4c 7d 2b ef 00 00 08 00<br />end_request: I/O error, dev sdb, sector 1283271663<br />sd 1:0:0:0: [sdb] Unhandled error code<br />sd 1:0:0:0: [sdb]&nbsp; Result: hostbyte=0x07 driverbyte=0x00<br />sd 1:0:0:0: [sdb] CDB: cdb[0]=0x2a: 2a 00 4c 7d 38 97 00 00 08 00<br />end_request: I/O error, dev sdb, sector 1283274903<br />usb 1-1.3.2: USB disconnect, address 5<br />sd 1:0:0:0: [sdb] Unhandled error code<br />sd 1:0:0:0: [sdb]&nbsp; Result: hostbyte=0x01 driverbyte=0x00<br />sd 1:0:0:0: [sdb] CDB: cdb[0]=0x2a: 2a 00 4c 7d 4b 7f 00 00 08 00<br />end_request: I/O error, dev sdb, sector 1283279743<br />sd 1:0:0:0: [sdb] Unhandled error code<br />sd 1:0:0:0: [sdb]&nbsp; Result: hostbyte=0x01 driverbyte=0x00<br />sd 1:0:0:0: [sdb] CDB: cdb[0]=0x2a: 2a 00 4c 7d 76 f7 00 00 08 00<br />end_request: I/O error, dev sdb, sector 1283290871<br />JBD2: Detected IO errors while flushing file data on sdb3-8<br />Aborting journal on device sdb3-8.<br />JBD2: I/O error detected when updating journal superblock for sdb3-8.<br />journal commit I/O error<br />EXT4-fs error (device sdb3): ext4_find_entry:933: inode #2: comm afpd: reading directory lblock 0<br />EXT4-fs (sdb3): previous I/O error to superblock detected<br />EXT4-fs error (device sdb3): ext4_journal_start_sb:260: Detected aborted journal<br />EXT4-fs (sdb3): Remounting filesystem read-only<br />EXT4-fs (sdb3): previous I/O error to superblock detected<br />EXT4-fs (sdb3): previous I/O error to superblock detected<br />EXT4-fs error (device sdb3): ext4_put_super:728: Couldn&#039;t clean up the journal<br />usb 1-1.3.2: new high speed USB device using ar71xx-ehci and address 7<br />scsi2 : usb-storage 1-1.3.2:1.0<br />scsi 2:0:0:0: Direct-Access&nbsp; &nbsp; &nbsp;PI-239&nbsp; &nbsp;USB 2.0 Drive&nbsp; &nbsp; 1.08 PQ: 0 ANSI: 4<br />sd 2:0:0:0: [sdc] 1953525168 512-byte logical blocks: (1.00 TB/931 GiB) ## this is the drive reappearing<br />sd 2:0:0:0: [sdc] Write Protect is off<br />sd 2:0:0:0: [sdc] Mode Sense: 23 00 00 00<br />sd 2:0:0:0: [sdc] Assuming drive cache: write through<br />sd 2:0:0:0: [sdc] Assuming drive cache: write through<br /> sdc: sdc1 sdc2 sdc3<br />sd 2:0:0:0: [sdc] Assuming drive cache: write through<br />sd 2:0:0:0: [sdc] Attached SCSI disk<br />usb 1-1.3.2: USB disconnect, address 7</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p140810">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">stevo</div>
					<div class="post-datetime">
						8 Aug 2011, 11:21					</div>
				</div>
				<div class="post-content content">
					<p>It seems to me that the issue might be caused by inotify. I tried the same config now without it and the router no longer gets stuck when using netatalk/timemachine. Is there a way to disable inotify for certain partitions, e.g. with a special mount parameter?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p146588">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">pitris</div>
					<div class="post-datetime">
						25 Oct 2011, 01:40					</div>
				</div>
				<div class="post-content content">
					<p>Hello,<br />I&#039;m experiencing the same issue here, with openwrt 10.03.1-rc5 running on routerstation. The connected HDD is a usb2.0 640GB with ext4 and swap partitions on it, with an external power supply.<br />Have you found any solution to this problem?<br /></p><div class="codebox"><pre><code>sd 1:0:0:0: [sda] Unhandled error code
sd 1:0:0:0: [sda] Result: hostbyte=0x07 driverbyte=0x00
sd 1:0:0:0: [sda] CDB: cdb[0]=0x2a: 2a 00 25 45 37 b8 00 00 10 00
end_request: I/O error, dev sda, sector 625293240
Aborting journal on device sda1-8.
EXT4-fs error (device sda1): ext4_journal_start_sb: Detected aborted journal
EXT4-fs (sda1): Remounting filesystem read-only</code></pre></div><div class="codebox"><pre><code>sd 1:0:0:0: [sda] Unhandled error code
sd 1:0:0:0: [sda] Result: hostbyte=0x07 driverbyte=0x00
sd 1:0:0:0: [sda] CDB: cdb[0]=0x2a: 2a 00 25 44 08 00 00 00 08 00
end_request: I/O error, dev sda, sector 625215488
Buffer I/O error on device sda1, logical block 78151680
lost page write due to I/O error on sda1
JBD2: I/O error detected when updating journal superblock for sda1-8.
sd 1:0:0:0: [sda] Unhandled error code
sd 1:0:0:0: [sda] Result: hostbyte=0x07 driverbyte=0x00
sd 1:0:0:0: [sda] CDB: cdb[0]=0x2a: 2a 00 00 00 08 00 00 00 08 00
end_request: I/O error, dev sda, sector 2048
Buffer I/O error on device sda1, logical block 0
lost page write due to I/O error on sda1
EXT4-fs error (device sda1): ext4_put_super: Couldn&#039;t clean up the journal</code></pre></div><p>Thanks!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p146783">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">pitris</div>
					<div class="post-datetime">
						26 Oct 2011, 23:11					</div>
				</div>
				<div class="post-content content">
					<p>again... <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /><br /></p><div class="codebox"><pre><code>sd 1:0:0:0: [sda] Unhandled error code
sd 1:0:0:0: [sda] Result: hostbyte=0x07 driverbyte=0x00
sd 1:0:0:0: [sda] CDB: cdb[0]=0x2a: 2a 00 10 b7 13 10 00 00 f0 00
end_request: I/O error, dev sda, sector 280433424
Buffer I/O error on device sda1, logical block 35053922
lost page write due to I/O error on sda1
Buffer I/O error on device sda1, logical block 35053923
lost page write due to I/O error on sda1
Buffer I/O error on device sda1, logical block 35053924
lost page write due to I/O error on sda1
Buffer I/O error on device sda1, logical block 35053925
lost page write due to I/O error on sda1
Buffer I/O error on device sda1, logical block 35053926
lost page write due to I/O error on sda1
Buffer I/O error on device sda1, logical block 35053927
lost page write due to I/O error on sda1
Buffer I/O error on device sda1, logical block 35053928
lost page write due to I/O error on sda1
Buffer I/O error on device sda1, logical block 35053929
lost page write due to I/O error on sda1
Buffer I/O error on device sda1, logical block 35053930
lost page write due to I/O error on sda1
Buffer I/O error on device sda1, logical block 35053931
lost page write due to I/O error on sda1
sd 1:0:0:0: [sda] Unhandled error code
sd 1:0:0:0: [sda] Result: hostbyte=0x07 driverbyte=0x00
sd 1:0:0:0: [sda] CDB: cdb[0]=0x2a: 2a 00 10 b7 14 00 00 00 f0 00
end_request: I/O error, dev sda, sector 280433664
sd 1:0:0:0: [sda] Unhandled error code
sd 1:0:0:0: [sda] Result: hostbyte=0x07 driverbyte=0x00
sd 1:0:0:0: [sda] CDB: cdb[0]=0x2a: 2a 00 10 b7 14 f0 00 00 f0 00
end_request: I/O error, dev sda, sector 280433904
sd 1:0:0:0: [sda] Unhandled error code
sd 1:0:0:0: [sda] Result: hostbyte=0x07 driverbyte=0x00
sd 1:0:0:0: [sda] CDB: cdb[0]=0x2a: 2a 00 10 b7 15 e0 00 00 f0 00
end_request: I/O error, dev sda, sector 280434144
sd 1:0:0:0: [sda] Unhandled error code
sd 1:0:0:0: [sda] Result: hostbyte=0x07 driverbyte=0x00
sd 1:0:0:0: [sda] CDB: cdb[0]=0x2a: 2a 00 10 b7 16 d0 00 00 b8 00
end_request: I/O error, dev sda, sector 280434384
JBD2: Detected IO errors while flushing file data on sda1-8
sd 1:0:0:0: [sda] Unhandled error code
sd 1:0:0:0: [sda] Result: hostbyte=0x07 driverbyte=0x00
sd 1:0:0:0: [sda] CDB: cdb[0]=0x2a: 2a 00 25 45 df 88 00 00 30 00
end_request: I/O error, dev sda, sector 625336200
Aborting journal on device sda1-8.
sd 1:0:0:0: [sda] Unhandled error code
sd 1:0:0:0: [sda] Result: hostbyte=0x07 driverbyte=0x00
sd 1:0:0:0: [sda] CDB: cdb[0]=0x2a: 2a 00 25 44 08 00 00 00 08 00
end_request: I/O error, dev sda, sector 625215488
JBD2: I/O error detected when updating journal superblock for sda1-8.
EXT4-fs error (device sda1): ext4_journal_start_sb: Detected aborted journal
EXT4-fs (sda1): Remounting filesystem read-only</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p147727">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">pitris</div>
					<div class="post-datetime">
						6 Nov 2011, 10:53					</div>
				</div>
				<div class="post-content content">
					<p>OK, the trick was in an unshielded usb cable (if anyone gets in the same trouble as I did)...</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>