<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> undefined reference to `__ctype_b_loc&#039;</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 30 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p26880">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">cptdondo</div>
					<div class="post-datetime">
						10 May 2006, 04:11					</div>
				</div>
				<div class="post-content content">
					<p>I have been trying, so far unsuccessfully, to compile gphoto2.&nbsp; I have all of the glitches chased down and fixed, and all of the deps compiling and building, except for gphoto2 itself.</p><p>The compile fails in the last link with undefined reference to `__ctype_b_loc&#039;.&nbsp; A bit of googling shows thi sto be a libc/glibc feature (?)...</p><p>I am not at all familiar with uClib so I hope someone has run across this before....&nbsp; The only useful link I can find is this:</p><p><a href="http://sourceforge.net/tracker/index.php?func=detail&amp;aid=628692&amp;group_id=1107&amp;atid=101107">http://sourceforge.net/tracker/index.ph … tid=101107</a></p><p>which points to a glibc issue....</p><p>Error dump follows...</p><p>Thanks for any assistance,</p><p>--Yan</p><br /><br /><p>/home/nfs/yan/whiterussian/OpenWrt-SDK-Linux-i686-1/staging_dir_mipsel/bin/mipsel-linux-uclibc-gcc -Os -pipe -mips32 -mtune=mips32 -funit-at-a-time -I/home/nfs/yan/whiterussian/OpenWrt-SDK-Linux-i686-1/build_mipsel/libusb-0.1.12 -Wall -g -o .libs/gphoto2 gphoto2-actions.o gphoto2-foreach.o gphoto2-gp-params.o gphoto2-main.o gphoto2-version.o gphoto2-range.o gphoto2-shell.o&nbsp; -L/home/nfs/yan/whiterussian/OpenWrt-SDK-Linux-i686-1/build_mipsel/libusb-0.1.12/.libs -L/home/nfs/yan/whiterussian/OpenWrt-SDK-Linux-i686-1/build_mipsel/libexif-0.6.13/libexif/.libs -L/home/nfs/yan/whiterussian/OpenWrt-SDK-Linux-i686-1/build_mipsel/libgphoto2-2.1.99/libgphoto2/.libs -L/home/nfs/yan/whiterussian/OpenWrt-SDK-Linux-i686-1/staging_dir_mipsel/usr/lib -L/home/nfs/yan/whiterussian/OpenWrt-SDK-Linux-i686-1/staging_dir_mipsel/lib -lltdl -lpthread -L/home/nfs/yan/whiterussian/OpenWrt-SDK-Linux-i686-1/build_mipsel/libexif-0.6.13/libexif/.libs/ /home/nfs/yan/whiterussian/OpenWrt-SDK-Linux-i686-1/build_mipsel/libexif-0.6.13/libexif/.libs/libexif.so -L/home/nfs/yan/whiterussian/OpenWrt-SDK-Linux-i686-1/build_mipsel/libgphoto2-2.1.99/libgphoto2/.libs/ -L/home/nfs/yan/whiterussian/OpenWrt-SDK-Linux-i686-1/build_mipsel/libgphoto2-2.1.99/libgphoto2_port/libgphoto2_port/.libs/ /home/nfs/yan/whiterussian/OpenWrt-SDK-Linux-i686-1/build_mipsel/libgphoto2-2.1.99/libgphoto2/.libs/libgphoto2.so /home/nfs/yan/whiterussian/OpenWrt-SDK-Linux-i686-1/build_mipsel/libgphoto2-2.1.99/libgphoto2_port/libgphoto2_port/.libs//libgphoto2_port.so -L/usr/ -lpopt -Wl,--rpath -Wl,/home/nfs/yan/whiterussian/OpenWrt-SDK-Linux-i686-1/build_mipsel/libexif-0.6.13/ipkg-install/usr/lib -Wl,--rpath -Wl,/home/nfs/yan/whiterussian/OpenWrt-SDK-Linux-i686-1/build_mipsel/libgphoto2-2.1.99/ipkg-install/usr/lib<br />gphoto2-main.o: In function `get_path_for_file&#039;:<br />/home/nfs/yan/whiterussian/OpenWrt-SDK-Linux-i686-1/build_mipsel/gphoto2-2.1.99/gphoto2/main.c:589: undefined reference to `__ctype_b_loc&#039;<br />gphoto2-shell.o: In function `shell_arg_count&#039;:<br />/home/nfs/yan/whiterussian/OpenWrt-SDK-Linux-i686-1/build_mipsel/gphoto2-2.1.99/gphoto2/shell.c:140: undefined reference to `__ctype_b_loc&#039;<br />/home/nfs/yan/whiterussian/OpenWrt-SDK-Linux-i686-1/build_mipsel/gphoto2-2.1.99/gphoto2/shell.c:146: undefined reference to `__ctype_b_loc&#039;<br />gphoto2-shell.o: In function `shell_arg&#039;:<br />/home/nfs/yan/whiterussian/OpenWrt-SDK-Linux-i686-1/build_mipsel/gphoto2-2.1.99/gphoto2/shell.c:202: undefined reference to `__ctype_b_loc&#039;<br />/home/nfs/yan/whiterussian/OpenWrt-SDK-Linux-i686-1/build_mipsel/gphoto2-2.1.99/gphoto2/shell.c:215: undefined reference to `__ctype_b_loc&#039;<br />collect2: ld returned 1 exit status<br />make[4]: *** [gphoto2] Error 1<br />make[4]: Leaving directory `/home/nfs/yan/whiterussian/OpenWrt-SDK-Linux-i686-1/build_mipsel/gphoto2-2.1.99/gphoto2&#039;<br />make[3]: *** [all-recursive] Error 1<br />make[3]: Leaving directory `/home/nfs/yan/whiterussian/OpenWrt-SDK-Linux-i686-1/build_mipsel/gphoto2-2.1.99&#039;<br />make[2]: *** [all] Error 2<br />make[2]: Leaving directory `/home/nfs/yan/whiterussian/OpenWrt-SDK-Linux-i686-1/build_mipsel/gphoto2-2.1.99&#039;<br />make[1]: *** [/home/nfs/yan/whiterussian/OpenWrt-SDK-Linux-i686-1/build_mipsel/gphoto2-2.1.99/.built] Error 2<br />make[1]: Leaving directory `/home/nfs/yan/whiterussian/OpenWrt-SDK-Linux-i686-1/package/200-gphoto2&#039;<br />make: *** [200-gphoto2-compile] Error 2</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p26895">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">cptdondo</div>
					<div class="post-datetime">
						10 May 2006, 18:36					</div>
				</div>
				<div class="post-content content">
					<p>OK, I&#039;ve tracked this down to an issue with the way .h files are included....&nbsp; It appears that the OpenWrt SDK will include .h files from /usr/include when used with the Makefiles from the BuildingPackagesHowTo, which seems to be causing the problem.....</p><p>But using -nostdinc causes all sorts of problems with missing definitions and .h files not found....</p><p>Even specifying -I$(STAGING_DIR)/include (and every other dir in the toolchain that includes .h files) doesn&#039;t clear that up....</p><p>So.... Has anyone successfully used -nostdinc?&nbsp; If so, what -I options did you have to provide?</p><p>At the moment it can&#039;t find stdarg.h....&nbsp; But I&#039;m sure there are others....</p><p>I can provide voluminous log files but I am convinced this is something very simple that I just can&#039;t get </p><p>Thanks,</p><p>--Yan</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p26897">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">cptdondo</div>
					<div class="post-datetime">
						10 May 2006, 19:37					</div>
				</div>
				<div class="post-content content">
					<p>OK got it figured out....</p><p>The OpenWrt SDK has two different versions of stddef.h.</p><p>./staging_dir_mipsel/lib/gcc/mipsel-linux-uclibc/3.4.4/include/stddef.h<br />./staging_dir_mipsel/include/linux/stddef.h</p><p>The stdef.h in the include/linux dir is apparently non-functional; it appears to be a stub.&nbsp; The &quot;real&quot; stddef.h is in lib/gcc/mipsel-linux-uclibc/3.4.4/include.</p><p>The makefile has to include the dirs in the right order:</p><p>CFLAGS=&quot;$(TARGET_CFLAGS) -I. -I$(STAGING_DIR)/lib/gcc/mipsel-linux-uclibc/3.4.4/include/ -I$(STAGING_DIR)/include -I$(STAGING_DIR)/usr/include -I$(STAGING_DIR)/include/linux/ -nostdinc &quot;</p><p>and then everything will work.....</p><p>I do not know if this is by intent or if this is a bug in the SDK build process.&nbsp; If it is by intent please let me know and I will make the appropriate entry in the wiki.</p><p>--Yan</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p26908">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">florian_</div>
					<div class="post-datetime">
						10 May 2006, 23:03					</div>
				</div>
				<div class="post-content content">
					<p>This is a problem I already encountered, I fixed this using a ctype substitute found here :</p><p><a href="http://www-zeuthen.desy.de/computing/projects/linux/SL3/ctype.c">http://www-zeuthen.desy.de/computing/pr … L3/ctype.c</a></p><p>I hope it will help you</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p26911">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">cptdondo</div>
					<div class="post-datetime">
						10 May 2006, 23:13					</div>
				</div>
				<div class="post-content content">
					<p>Actually, if you use the includes in the order I gave, the problem goes away...&nbsp; With no code needed.&nbsp; For some reason the toolchain sticks the needed std*.h files into a location that is completely hidden.&nbsp; There is even a nice README in that lib/gcc/mipsel-linux-uclibc/3.4.4/include/ directory that tells you what those files are for....</p><p>Once I test the code I built to make sure it works I will document this in the wiki....</p><p>--Yan</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p26913">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">florian_</div>
					<div class="post-datetime">
						10 May 2006, 23:23					</div>
				</div>
				<div class="post-content content">
					<p>Thanks, this is a really good idea.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>