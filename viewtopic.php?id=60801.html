<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Luci - internet access schedule</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 24 Apr 2018 and 2 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 2</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=60801&amp;p=2.html">2</a></li></ul></nav></div>
			
		
		
			<article class="post" id="p299091">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">k.szuster1</div>
					<div class="post-datetime">
						9 Nov 2015, 11:48					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ve made a Luci module, which allows to restrict the access to the internet for specific hosts. </p><p><a href="http://k-szuster.github.io/luci-access-control/">http://k-szuster.github.io/luci-access-control/</a></p><p>You can block internet access for any single host. The hosts are&nbsp; chosen<br />by MAC found on a simple&nbsp; pop-up list.<br />Every host may be blocked permanently or have it&#039;s own&quot;From time&quot; - &quot;To time&quot; rule. You cam switch on/off each&nbsp; individual rule or the whole filter by single click..</p><p>The existing solutions were not satisfactory for me (although inspiring):<br /> - wifischedule blocks all wifi, bot specific hosts, and not wired LAN ethernet connection<br />- Mom&#039;s Internet Access is close to my needs, but too complicated to build for non-hackers and not integrated with Luci.<br />- Gargoyle has got sophisticated filtering, but... too sophisticated for every mummy. After all, not every platform supports Gargoyle (mine not).<br />- Manual editing of iptables&#039; ruless - not for everyday use.</p><p>Simple installation: don&#039;t build ipk if you don&#039;t wish to, just copy a few files to your router. No scripts and&nbsp; daemons to be cross-compiled. It just makes use of the standard OpenWrt firewall.</p><p>Enjoy</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p299366">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">simono_pl</div>
					<div class="post-datetime">
						11 Nov 2015, 13:45					</div>
				</div>
				<div class="post-content content">
					<p>Good job. Can You add option for day of the week?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p300243">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">dnk</div>
					<div class="post-datetime">
						18 Nov 2015, 01:53					</div>
				</div>
				<div class="post-content content">
					<p>How can the whole module &quot;luci-access-control&quot; be switced on/off by schedule? (enabled/disabled)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p300286">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">oscarstve</div>
					<div class="post-datetime">
						18 Nov 2015, 13:41					</div>
				</div>
				<div class="post-content content">
					<p>It&#039;d be very nice to have the same, but specificating the day of the week.</p><p>Thank you in advance,</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p300382">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">k.szuster1</div>
					<div class="post-datetime">
						19 Nov 2015, 10:06					</div>
				</div>
				<div class="post-content content">
					<p>There is a global switch for the module. <br />You can reach your goal by simply modifying existing schedules. There is no schedule to control other schedules :-) I prefer to keep things simple.</p><p>Anyway, thanks for all comments. I&#039;m going to add filtering by the days of week. <br />I can add week days into rules, or alternatively:l make a separate table for schedules and allow selecting a schedule for each rule.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p300390">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">oscarstve</div>
					<div class="post-datetime">
						19 Nov 2015, 12:00					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for adding days of week. Simply tickboxes, or similar, with the days if week would be perfect <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p300394">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">dnk</div>
					<div class="post-datetime">
						19 Nov 2015, 12:31					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>k.szuster1 wrote:</cite><blockquote><p>There is a global switch for the module. <br />....</p></blockquote></div><p>Hi, can You specify how can i change the global switch with a script, please ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p300543">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">k.szuster1</div>
					<div class="post-datetime">
						20 Nov 2015, 11:26					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>dnk wrote:</cite><blockquote><div class="quotebox"><cite>k.szuster1 wrote:</cite><blockquote><p>There is a global switch for the module. <br />....</p></blockquote></div><p>Hi, can You specify how can i change the global switch with a script, please ?</p></blockquote></div><p>Not that simple, because all logic is in lua script. You need to do the same in a script. Make a script containing the following:<br /></p><div class="codebox"><pre><code>#!/bin/sh
VAL=$1
if [ &quot;$VAL&quot; != 0 ] &amp;&amp; [ &quot;$VAL&quot; != 1 ] ; then
    echo Supply argument: 0 or 1
    exit 1
fi

CNT=0

uci set access_control.general.enabled=$VAL
while uci get firewall.@rule[$CNT] &gt;/dev/null 2&gt;&amp;1 ; do
    ON=`uci get firewall.@rule[$CNT].ac_enabled 2&gt;/dev/null`
    if [ $? == 0 ] ; then 
        if [ $ON == 1 ] ; then
            ON=$VAL
        else
            ON=0
        fi
        uci set firewall.@rule[$CNT].enabled=$ON
    fi
    CNT=$((CNT+1))
done
uci commit
/etc/init.d/firewall restart</code></pre></div><p>Invoke it with argument 0 or 1.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p300650">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">jz2000</div>
					<div class="post-datetime">
						21 Nov 2015, 14:56					</div>
				</div>
				<div class="post-content content">
					<p>Hi,<br />my name is Joerg and I am new here. I am trying to config my TL Wdr 3600. Until now I have installed CC 15.05.</p><p>I tried to run this nice Luci module. There for I copied all the files to the router and made a reboot. I can see in Luci the Access Control under Network. When I try to open it with IE or chrome, a failure appears. Website not available. What could be the reason there for?</p><p>Chrome gives me the following response:</p><p>/usr/lib/lua/luci/dispatcher.lua:433: Failed to execute cbi dispatcher target for entry &#039;/admin/network/access_control&#039;.<br />The called action terminated with an exception:<br />/usr/lib/lua/luci/cbi.lua:311: Unable to read UCI data: access_control<br />stack traceback:<br />&nbsp; &nbsp; [C]: in function &#039;assert&#039;<br />&nbsp; &nbsp; /usr/lib/lua/luci/dispatcher.lua:433: in function &#039;dispatch&#039;<br />&nbsp; &nbsp; /usr/lib/lua/luci/dispatcher.lua:168: in function &lt;/usr/lib/lua/luci/dispatcher.lua:167&gt;</p>											<p class="post-edited">(Last edited by <strong>jz2000</strong> on 21 Nov 2015, 15:09)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p300705">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">k.szuster1</div>
					<div class="post-datetime">
						21 Nov 2015, 20:39					</div>
				</div>
				<div class="post-content content">
					<p>The software does work with CC, as reported by many. What I can suggest is to make sure you have installed all files properly.<br />To make things easier, I added a ipk package to the repository. You can copy it to you router and opkg install it.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p300746">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">dnk</div>
					<div class="post-datetime">
						22 Nov 2015, 03:20					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>k.szuster1 wrote:</cite><blockquote><p>The software does work with CC, as reported by many. What I can suggest is to make sure you have installed all files properly.<br />To make things easier, I added a ipk package to the repository. You can copy it to you router and opkg install it.</p></blockquote></div><p>I have &quot;OpenWrt Chaos Calmer 15.05 / LuCI (git-15.248.30277-3836b45) &quot; <br />and the module works as expected.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p300864">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">Avenger79</div>
					<div class="post-datetime">
						23 Nov 2015, 06:38					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for the work this is what I was looking for.&nbsp; Do you still plan to add the day of the week check box.&nbsp; I only restrict access Sunday thru Thursday(school night) and would love to be able to set it and forget it.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p300880">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">dnk</div>
					<div class="post-datetime">
						23 Nov 2015, 10:28					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>k.szuster1 wrote:</cite><blockquote><p>Not that simple, because all logic is in lua script. You need to do the same in a script. Make a script containing the following:<br /></p><div class="codebox"><pre><code>#!/bin/sh
VAL=$1
if [ &quot;$VAL&quot; != 0 ] &amp;&amp; [ &quot;$VAL&quot; != 1 ] ; then
    echo Supply argument: 0 or 1
    exit 1
fi

CNT=0

uci set access_control.general.enabled=$VAL
while uci get firewall.@rule[$CNT] &gt;/dev/null 2&gt;&amp;1 ; do
    ON=`uci get firewall.@rule[$CNT].ac_enabled 2&gt;/dev/null`
    if [ $? == 0 ] ; then 
        if [ $ON == 1 ] ; then
            ON=$VAL
        else
            ON=0
        fi
        uci set firewall.@rule[$CNT].enabled=$ON
    fi
    CNT=$((CNT+1))
done
uci commit
/etc/init.d/firewall restart</code></pre></div><p>Invoke it with argument 0 or 1.</p></blockquote></div><p>That script &quot;kills/turns on&quot;&nbsp; all firewall rules. If there are other custom rules, not only the access control rules - they will be killed also ???</p>											<p class="post-edited">(Last edited by <strong>dnk</strong> on 23 Nov 2015, 15:29)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p300940">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">k.szuster1</div>
					<div class="post-datetime">
						23 Nov 2015, 19:38					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>dnk wrote:</cite><blockquote><div class="quotebox"><cite>k.szuster1 wrote:</cite><blockquote><p>Not that simple, because all logic is in lua script. You need to do the same in a script. Make a script containing the following:<br /></p><div class="codebox"><pre><code>#!/bin/sh
VAL=$1
if [ &quot;$VAL&quot; != 0 ] &amp;&amp; [ &quot;$VAL&quot; != 1 ] ; then
    echo Supply argument: 0 or 1
    exit 1
fi

CNT=0

uci set access_control.general.enabled=$VAL
while uci get firewall.@rule[$CNT] &gt;/dev/null 2&gt;&amp;1 ; do
    ON=`uci get firewall.@rule[$CNT].ac_enabled 2&gt;/dev/null`
    if [ $? == 0 ] ; then 
        if [ $ON == 1 ] ; then
            ON=$VAL
        else
            ON=0
        fi
        uci set firewall.@rule[$CNT].enabled=$ON
    fi
    CNT=$((CNT+1))
done
uci commit
/etc/init.d/firewall restart</code></pre></div><p>Invoke it with argument 0 or 1.</p></blockquote></div><p>That script &quot;kills/turns on&quot;&nbsp; all firewall rules. If there are other custom rules, not only the access control rules - they will be killed also ???</p></blockquote></div><p>No. The rules added in the Access Control section are marked with additional field: ac_enabled. Te above script affects only records containing this field.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p301225">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">pirello</div>
					<div class="post-datetime">
						25 Nov 2015, 23:01					</div>
				</div>
				<div class="post-content content">
					<p>This should be implemented directly into the openwrt package.<br />Just, you know, add&nbsp; the days of the week?<br />Thanks!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p301425">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">k.szuster1</div>
					<div class="post-datetime">
						27 Nov 2015, 15:17					</div>
				</div>
				<div class="post-content content">
					<p>NEW VERSION AVAILABLE</p><p>Added filtering by week day.</p><p>Package ready to install on all platforms:<br /><a href="https://www.dropbox.com/s/suxf7vdleerbc5v/luci-app-access-control_0.2_all.ipk?dl=0">https://www.dropbox.com/s/suxf7vdleerbc … l.ipk?dl=0</a></p><p>...and a sample screen shot:<br /><a href="https://www.dropbox.com/s/26z6nu7d015n5pw/luci-app-access-control_0.2-screenshot.png?dl=0">https://www.dropbox.com/s/26z6nu7d015n5 … t.png?dl=0</a></p><p>If you&#039;d like to build the package yourself, there is source repository:<br /><a href="http://k-szuster.github.io/luci-access-control">http://k-szuster.github.io/luci-access-control</a><br />as a Luci app, and:<br /><a href="http://k-szuster.github.io/luci-access-control-package">http://k-szuster.github.io/luci-access-control-package</a><br />as a standalone package.<br />Both contain the same code.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p301476">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">hostle19</div>
					<div class="post-datetime">
						27 Nov 2015, 19:50					</div>
				</div>
				<div class="post-content content">
					<p>Great job !!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p301610">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">Avenger79</div>
					<div class="post-datetime">
						29 Nov 2015, 06:39					</div>
				</div>
				<div class="post-content content">
					<p>Thank you very much this is perfect!!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p302832">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">ex8</div>
					<div class="post-datetime">
						8 Dec 2015, 07:55					</div>
				</div>
				<div class="post-content content">
					<p>Awesome job! It is exactly what I want!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p302937">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">k.szuster1</div>
					<div class="post-datetime">
						8 Dec 2015, 21:47					</div>
				</div>
				<div class="post-content content">
					<p>NEW VERSION AVAILABLE</p><p>Now, it works properly with Openwrt Luci theme. Some minor bugs are fixed.</p><p>Package ready to install on all platforms:<br /><a href="https://github.com/k-szuster/luci-access-control-package/releases/download/v0.3.1/luci-app-access-control_0.3.1_all.ipk">https://github.com/k-szuster/luci-acces … .1_all.ipk</a></p><p>Source repository:<br /><a href="http://k-szuster.github.io/luci-access-control">http://k-szuster.github.io/luci-access-control</a><br />as a Luci app, and:<br /><a href="http://k-szuster.github.io/luci-access-control-package">http://k-szuster.github.io/luci-access-control-package</a><br />as a standalone package.<br />Both contain the same code.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p307918">
				<div class="post-metadata">
					<div class="post-num">Post #21</div>
					<div class="post-author">elux011</div>
					<div class="post-datetime">
						17 Jan 2016, 01:00					</div>
				</div>
				<div class="post-content content">
					<p>Great job !! Have Many Thanks!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p310050">
				<div class="post-metadata">
					<div class="post-num">Post #22</div>
					<div class="post-author">Naitachal</div>
					<div class="post-datetime">
						2 Feb 2016, 22:01					</div>
				</div>
				<div class="post-content content">
					<p>Yes Great Job!! </p><p>Would it be possible to block certain ports like 80 or 22&nbsp; or 80,22,443 and leave everything else alone?</p><p>Thanks Again</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p312108">
				<div class="post-metadata">
					<div class="post-num">Post #23</div>
					<div class="post-author">k.szuster1</div>
					<div class="post-datetime">
						19 Feb 2016, 10:45					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Naitachal wrote:</cite><blockquote><p>Yes Great Job!! </p><p>Would it be possible to block certain ports like 80 or 22&nbsp; or 80,22,443 and leave everything else alone?</p><p>Thanks Again</p></blockquote></div><p>This task is different from what I needed. Your proposal (and some other&#039;s) is to make&nbsp; a universal traffic filter with time control. Such universal filter is already there. It only misses scheduling. To achieve the goal, the firewall should be extended by adding schedules similar to those in &quot;internet access scheduler&quot;.<br />Technically this is simple, it requires modification of firewall lua scripts. Low level firewall/iptables software would remain unchanged. <br />Such firewall rules, as general, would cover the functionality of my software.<br />Anyway, the above approach means modifying existing Luci system, which is hard task for me. Perhaps you should ask Luci maintainers? I am ready for collaboration.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p317188">
				<div class="post-metadata">
					<div class="post-num">Post #24</div>
					<div class="post-author">Avenger79</div>
					<div class="post-datetime">
						29 Mar 2016, 05:35					</div>
				</div>
				<div class="post-content content">
					<p>I don&#039;t think this works with the recent update.&nbsp; Is it just me?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p319151">
				<div class="post-metadata">
					<div class="post-num">Post #25</div>
					<div class="post-author">david.lynch</div>
					<div class="post-datetime">
						11 Apr 2016, 17:59					</div>
				</div>
				<div class="post-content content">
					<p>This isn&#039;t available over Luci &gt; System &gt; Software &gt; Available packages? if not, it will be?</p>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 1 of 2</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=60801&amp;p=2.html">2</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>