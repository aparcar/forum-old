<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> USB Wifi Adapter as WAN</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 29 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p137901">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">derdigge</div>
					<div class="post-datetime">
						26 Jun 2011, 19:56					</div>
				</div>
				<div class="post-content content">
					<p>Hello Folks!</p><p>I am a newbie to openwrt but have small linux knowledge.<br />On my TP-Link1043ND(1.0) i got Backfire (r24038) running.<br />My Plan ist to connect my Neighbours Wlan using the USB adapter. (is 500m away and knows about that)<br />Then the internal wifi Controler of the 1043nd has to share internet localy in my living room.</p><p>I have an RTL8187L Adabter conected to the usb port.<br />Whith &quot;ifconfig wlan1 up&quot; the device comes up as ecxpected. (used the kmod-rtl8187 2.6.32.25+2010-10-19-1 Package)<br />I edited the /etc/config/wireless file like that:</p><p>config &#039;wifi-device&#039; &#039;radio0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;type&#039; &#039;mac80211&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;channel&#039; &#039;11&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;macaddr&#039; &#039;54:e6:fc:**:**:**&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;hwmode&#039; &#039;11ng&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;htmode&#039; &#039;HT20&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; list &#039;ht_capab&#039; &#039;SHORT-GI-40&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; list &#039;ht_capab&#039; &#039;DSSS_CCK-40&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;disabled&#039; &#039;0&#039;</p><p>config &#039;wifi-iface&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;device&#039; &#039;radio0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;network&#039; &#039;lan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;mode&#039; &#039;ap&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ssid&#039; &#039;OpenWrt&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;encryption&#039; &#039;psk2&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;key&#039; &#039;d3rd1gg3&#039;</p><p>config &#039;wifi-device&#039; &#039;radio1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;type&#039; &#039;rtl8187&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;channel&#039; &#039;6&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;macaddr&#039; &#039;00:C0:CA:**:**:**&#039;</p><p>config &#039;wifi-iface&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;device&#039; &#039;radio1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;encryption&#039; &#039;none&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;mode&#039; &#039;sta&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ssid&#039; &#039;Juliane&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;network&#039; &#039;wan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;bssid&#039; &#039;00:23:08:**:**:**&#039;</p><p>But after booting the 1043nd ist dosent connect to the acces point! (juliane)<br />What i am doing wrong? My Knowledgebase of these networkings are small, especially<br />openwrt. Since Wireless came out i allways used a &quot;managment tool&quot; in KDE for example.</p><p>Anyone can help me out?</p><p>Regards<br />derdigge</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p137909">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">blindbox</div>
					<div class="post-datetime">
						26 Jun 2011, 20:42					</div>
				</div>
				<div class="post-content content">
					<p>Have you tried to configure /etc/config/network then? Set wan device to wlan1 (or none). Also, set wan to dhcp. You can also do this all from the web interface. (administration &gt; network &gt; interface &gt; wan).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p137917">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">derdigge</div>
					<div class="post-datetime">
						26 Jun 2011, 21:52					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for your reply!</p><p>I Think that the problem is the assosiacion to the accesspoint. (the one that provides the internet)<br />Can someone give me please an excample config for wpa and wep encryption?</p><p>Thanks!<br />derdigge</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p137919">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">fyi</div>
					<div class="post-datetime">
						26 Jun 2011, 21:54					</div>
				</div>
				<div class="post-content content">
					<p>Run &quot;uci export network ; iwlist wlan1 scan&quot;.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p137927">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">NewUse</div>
					<div class="post-datetime">
						26 Jun 2011, 23:10					</div>
				</div>
				<div class="post-content content">
					<p>I have just setuped, and it&#039;s works, but a lot of was done via CLI.</p><p> But, I have Ralink-based usb and dir-300<br />&nbsp; <br />1)Compile OpenWRT with wpa_supplicant and hostapd<br />2)root@OpenWrt:/etc/config# cat wireless</p><p>config &#039;wifi-device&#039; &#039;radio0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;type&#039; &#039;mac80211&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;channel&#039; &#039;11&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;macaddr&#039; &#039;00:90:4c:c1:00:00&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;hwmode&#039; &#039;11g&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;disabled&#039; &#039;0&#039;</p><p>config &#039;wifi-iface&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;device&#039; &#039;radio0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;network&#039; &#039;lan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;mode&#039; &#039;ap&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ssid&#039; &#039;OpenWrt&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;encryption&#039; &#039;none&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;hidden&#039; &#039;0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;isolate&#039; &#039;0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;bgscan&#039; &#039;0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;wds&#039; &#039;0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;macfilter&#039; &#039;none&#039;</p><p>config &#039;wifi-device&#039; &#039;radio1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;type&#039; &#039;mac80211&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;macaddr&#039; &#039;1c:af:f7:6d:03:4f&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;htmode&#039; &#039;HT20&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; list &#039;ht_capab&#039; &#039;GF&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; list &#039;ht_capab&#039; &#039;SHORT-GI-20&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; list &#039;ht_capab&#039; &#039;SHORT-GI-40&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; list &#039;ht_capab&#039; &#039;RX-STBC1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;disabled&#039; &#039;0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;hwmode&#039; &#039;11ng&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;channel&#039; &#039;06&#039;</p><p>config &#039;wifi-iface&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;device&#039; &#039;radio1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;hidden&#039; &#039;0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;network&#039; &#039;wan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;wds&#039; &#039;0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;macfilter&#039; &#039;none&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &quot;mode&quot; &quot;sta&quot;</p><p>3) create wpa_supplicant start_up script :<br />a)cd /etc/init.d/<br />b) create file with folling content root@OpenWrt:/etc/init.d# cat peapclient<br />#!/bin/sh /etc/rc.common<br />#wpa_supplicant<br />START=99</p><p>start() {</p><p>echo start</p><p># commands to launch application</p><p>wpa_supplicant -B -P /var/run/wifi-wlan1.pid -Dnl80211 -i wlan1 -c /etc/config/peap.conf</p><p>sleep 15</p><p>#udhcpc -i eth0.1</p><p>}</p><p>c) ./peapclient enable<br />3) create wpa_supplicant configuration file</p><br /><p>reboot and enjoy <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>PS:<br />BTW: where did you find &quot;option &#039;type&#039; &#039;rtl8187&#039;&quot; ?&nbsp; I am trying to setup rtl8712, but didn&#039;t succeed <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><p>UPD: I have just tested with rtl8187L -- it also works fine <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>											<p class="post-edited">(Last edited by <strong>NewUse</strong> on 27 Jun 2011, 10:59)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p137977">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">derdigge</div>
					<div class="post-datetime">
						27 Jun 2011, 14:20					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>fyi wrote:</cite><blockquote><p>Run &quot;uci export network ; iwlist wlan1 scan&quot;.</p></blockquote></div><p>Networks arround are listed as ecxpected</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p137979">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">derdigge</div>
					<div class="post-datetime">
						27 Jun 2011, 14:37					</div>
				</div>
				<div class="post-content content">
					<p>Hi Again!</p><p>I have no Radio 1 by installing the driver by default.<br />When i install the driver Log File returns:</p><p>Jun 27 11:23:47 OpenWrt user.debug kernel: ieee80211 phy1: Selected rate control algorithm &#039;minstrel_ht&#039;<br />Jun 27 11:23:47 OpenWrt user.info kernel: ieee80211 phy1: hwaddr 00:c0:ca:27:20:6c, RTL8187vB (default) V1 + rtl8225z2, rfkill mask 2<br />Jun 27 11:23:47 OpenWrt user.info kernel: rtl8187: Customer ID is 0xFF<br />Jun 27 11:23:47 OpenWrt user.info kernel: Registered led device: rtl8187-phy1::radio<br />Jun 27 11:23:47 OpenWrt user.info kernel: Registered led device: rtl8187-phy1::tx<br />Jun 27 11:23:47 OpenWrt user.info kernel: Registered led device: rtl8187-phy1::rx<br />Jun 27 11:23:48 OpenWrt user.info kernel: rtl8187: wireless switch is on<br />Jun 27 11:23:48 OpenWrt user.info kernel: usbcore: registered new interface driver rtl8187</p><p>Sounds all fine for me. but there is no radio1 by default. (luci)<br />I can do ifconfig wlan1 up and it wents up, still no device in luci.</p><p>When the rooter reboots, Logfile returns:</p><p>Nov 19 19:28:05 OpenWrt user.info kernel: usbcore: registered new interface driver rtl8187</p><p>But it isnt up at startup.</p><p>There must be some think in openwrt mechanics that has to bring up devices and write the /etc/config/wireless. I think there is my Problem arround.</p><p>If this will work i think it will be easy to config the conection point for rtl8187 device using luci.</p><p>@NewUse ist the &quot;radio1&quot; up by default as you tried ther Kmod_rtl8187 package?</p><p>Thanks!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p137983">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">derdigge</div>
					<div class="post-datetime">
						27 Jun 2011, 18:47					</div>
				</div>
				<div class="post-content content">
					<p>So i thnink it is nearly done !</p><p>since Openwrt is not able to start the device on its own during startup of the router, i <br />edited /etc/rc.local like this:</p><p># Put your custom commands here that should be executed once<br /># the system init finished. By default this file does nothing.</p><p>ifconfig wlan1 up<br />iwconfig wlan1 mode managed key 000764494687520061987972AA<br />iwconfig wlan1 essid &quot;Juliane&quot;<br />udhcpc -i wlan1</p><p>exit 0</p><br /><p>Everything went fine so far. i can ping google.com inside the ssh terminal.<br />so the router itself is online. What static route i have to add that the client conected to the router are &quot;online&quot; ? <br />&#039; route add -p &#039; as i know from debian does not work at all!</p><p>Thank you!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p138011">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">NewUse</div>
					<div class="post-datetime">
						28 Jun 2011, 00:27					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><blockquote><p>Everything went fine so far. i can ping google.com inside the ssh terminal.<br />so the router itself is online. What static route i have to add that the client conected to the router are &quot;online&quot; ?</p></blockquote></div><p>If I have understand correctly (my English is real awful), you should enable nat from wan to lan, routing should not help...</p><p>If you&#039;ll made changes in /etc/config/wireless manually, by adding something like this:<br /> config &#039;wifi-device&#039; &#039;radio1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;type&#039; &#039;mac80211&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;macaddr&#039; &#039;00:c0:ca:27:20:6c&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;disabled&#039; &#039;0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;hwmode&#039; &#039;11g&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;channel&#039; &#039;06&#039;</p><p>config &#039;wifi-iface&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;device&#039; &#039;radio1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;hidden&#039; &#039;0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;network&#039; &#039;wan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;wds&#039; &#039;0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;macfilter&#039; &#039;none&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &quot;mode&quot; &quot;sta&quot;</p><p>it should help<br />Yours mac address I have copied from yours kernel log...</p><p>I have first add the minimal configuration, and all other parameters were add automaticly</p><p>BTW: any one know: should this rtl8187 driver works in ap mode?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p138032">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">derdigge</div>
					<div class="post-datetime">
						28 Jun 2011, 08:59					</div>
				</div>
				<div class="post-content content">
					<p>Hi man!</p><p>You Simply did it!<br />Ganz, großes Tennis!!!<br />Now is saw my mistake! I allways used &quot;option &#039;type&#039; &#039;rtl8187&#039;&quot; instead of &quot;option &#039;type&#039; &#039;mac80211&#039;&quot;<br />TX Power is now limited to 20 but that is enough for me. maybe others need it increased.</p><br /><p>This config added to /etc/config/wireless using editor joe was the solution for me!!!</p><p> config &#039;wifi-device&#039; &#039;radio1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;type&#039; &#039;mac80211&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;macaddr&#039; &#039;00:c0:ca:27:20:6c&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;disabled&#039; &#039;0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;hwmode&#039; &#039;11g&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;channel&#039; &#039;06&#039;</p><p>config &#039;wifi-iface&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;device&#039; &#039;radio1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;hidden&#039; &#039;0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;network&#039; &#039;wan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;wds&#039; &#039;0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;macfilter&#039; &#039;none&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &quot;mode&quot; &quot;sta&quot;</p><p>EDIT:</p><p>Txpower:</p><p>If you add &quot;&nbsp; &nbsp; &nbsp;option &#039;country&#039; &#039;ca&#039; &quot;<br />you can set txpower up to 27 (gaves me a quality boost. ping loss in one hour 1%)</p><p>AP Mode:</p><p>I tried Mastermode.<br />It works wit my ALFA Awus036h (500mw) flawlwssly with 54mbits amd wpa security. (tried 30mins - seems stable)</p><p>Also i tried my ALFA Awus036h (1000mw) its the same chipset but it dosent work. Apmode dosent work, client mode not verry stable.</p>											<p class="post-edited">(Last edited by <strong>derdigge</strong> on 28 Jun 2011, 13:38)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p141093">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">khudko_denys</div>
					<div class="post-datetime">
						11 Aug 2011, 22:15					</div>
				</div>
				<div class="post-content content">
					<p>Hi to all!<br />Also trying to make above, but don&#039;t know where the beginning of such a long story <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /><br />Maybe some step by step manual is available for setting up the router?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p144774">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">erriko</div>
					<div class="post-datetime">
						29 Sep 2011, 19:17					</div>
				</div>
				<div class="post-content content">
					<p>I managed to install and configure my ALFA Awus036h (1000mw) on a Fonera 2.0n (thanks to the latest trunk). Everything works but I can&#039;t select more thano 20db - 100mW.<br />Do you know if it is possible to change up to 30db?</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>