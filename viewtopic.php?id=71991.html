<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Router crashes when OpenVPN connects</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 5 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p365024">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">mattltm</div>
					<div class="post-datetime">
						6 Sep 2017, 12:51					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m trying to get my Dragino router to connect as a client to my OpenVPN server.</p><p>I&#039;ve followed the guides and can get the router to connect but it crashes as soon as it tries to configure the tun adaptor right after this command:</p><div class="codebox"><pre><code>/sbin/ifconfig tun0 10.8.0.2 netmask 255.255.248.0 mtu 1500 broadcast 10.8.7.255</code></pre></div><p>I can see from the server that the VPN connection is made but it forces the router to reboot.</p><p>This is all made a little harder since the router is using a modified firmware from Dragino.</p><p>I followed the instructions for the client config from the wiki: wiki.openwrt.org/doc/howto/vpn.openvpn</p><p>Can anyone help me get this working?</p><p>Thanks.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p365029">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">mattltm</div>
					<div class="post-datetime">
						6 Sep 2017, 13:48					</div>
				</div>
				<div class="post-content content">
					<p>Ok, a bit more info.</p><p>Running the ifconfig command from the shell returns:</p><div class="codebox"><pre><code>ifconfig: SIOCSIFADDR: No such device</code></pre></div><p>and running ifconfig -a produces this:</p><div class="codebox"><pre><code>br-lan    Link encap:Ethernet  HWaddr A8:40:41:17:BD:75  
          inet addr:10.130.1.1  Bcast:10.130.1.255  Mask:255.255.255.0
          inet6 addr: fe80::aa40:41ff:fe17:bd75/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:676 errors:0 dropped:0 overruns:0 frame:0
          TX packets:397 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:66211 (64.6 KiB)  TX bytes:53733 (52.4 KiB)

eth0      Link encap:Ethernet  HWaddr A8:40:41:17:BD:75  
          UP BROADCAST MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)
          Interrupt:5 

eth1      Link encap:Ethernet  HWaddr A8:40:41:17:BD:74  
          inet addr:192.168.1.111  Bcast:192.168.1.255  Mask:255.255.255.0
          inet6 addr: fe80::aa40:41ff:fe17:bd74/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:7834 errors:0 dropped:4 overruns:0 frame:0
          TX packets:1438 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:2130835 (2.0 MiB)  TX bytes:133393 (130.2 KiB)
          Interrupt:4 

lo        Link encap:Local Loopback  
          inet addr:127.0.0.1  Mask:255.0.0.0
          inet6 addr: ::1/128 Scope:Host
          UP LOOPBACK RUNNING  MTU:65536  Metric:1
          RX packets:213 errors:0 dropped:0 overruns:0 frame:0
          TX packets:213 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:19661 (19.2 KiB)  TX bytes:19661 (19.2 KiB)

teql0     Link encap:UNSPEC  HWaddr 00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00  
          NOARP  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:100 
          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)

wlan0     Link encap:Ethernet  HWaddr A8:40:41:17:BD:72  
          inet6 addr: fe80::aa40:41ff:fe17:bd72/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:695 errors:0 dropped:0 overruns:0 frame:0
          TX packets:455 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:77545 (75.7 KiB)  TX bytes:79920 (78.0 KiB)</code></pre></div><p>So it looks like tun0 does not exist. It is set in the network file:</p><div class="codebox"><pre><code>uci show network</code></pre></div><div class="codebox"><pre><code>network.loopback=interface
network.loopback.ifname=&#039;lo&#039;
network.loopback.proto=&#039;static&#039;
network.loopback.ipaddr=&#039;127.0.0.1&#039;
network.loopback.netmask=&#039;255.0.0.0&#039;
network.lan=interface
network.lan.type=&#039;bridge&#039;
network.lan.proto=&#039;static&#039;
network.lan.dns=&#039;8.8.8.8&#039;
network.lan.ifname=&#039;eth0&#039;
network.lan.netmask=&#039;255.255.255.0&#039;
network.lan.ipaddr=&#039;10.130.1.1&#039;
network.lan.gateway=&#039;255.255.255.255&#039;
network.@interface[0]=interface
network.@interface[0].ifname=&#039;bat0&#039;
network.mesh_0=interface
network.mesh_0.proto=&#039;static&#039;
network.mesh_0.mtu=&#039;1528&#039;
network.mesh_0.ipaddr=&#039;10.10.1.20&#039;
network.mesh_0.netmask=&#039;255.255.255.0&#039;
network.wan=interface
network.wan.ifname=&#039;eth1&#039;
network.wan.proto=&#039;dhcp&#039;
network.wan.hostname=&#039;dragino-100001&#039;
network.vpn0=interface
network.vpn0.ifname=&#039;tun0&#039;
network.vpn0.proto=&#039;none&#039;
network.vpn0.auto=&#039;1&#039;</code></pre></div><p>I&#039;ve verified that /dev/net/tun does exist and check the module is loaded.</p><div class="codebox"><pre><code>modprobe tun</code></pre></div><div class="codebox"><pre><code>tun is already loaded</code></pre></div><p>So why can&#039;t I get it to work!</p>											<p class="post-edited">(Last edited by <strong>mattltm</strong> on 6 Sep 2017, 13:48)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>