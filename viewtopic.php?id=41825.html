<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> In asterisk with Nat, why sip peer is unregistered ?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 2 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p189738">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">sjmsjm00</div>
					<div class="post-datetime">
						23 Jan 2013, 08:06					</div>
				</div>
				<div class="post-content content">
					<p>I set up Asterisk (ver. 1.8.10.1) on OpenWrt with NAT, DDNS, two ip-soft phones and one SIP Account from SIP provider.<br />There is no problem between two ip-soft phones in local-lan under NAT.<br />Yet, it is problem to communicate with external ip-soft phones through internet (via. SIP provider).<br />According to CLI message, sip peer can not be registered like below.<br />I am very thank you if anyone who know the reason give me some help for it.<br />For the detailed info. on this, please refer to the blow message from &quot;OpenWrt*CLI&gt;&quot;</p><p>OpenWrt*CLI&gt; sip show peers<br />Name/username&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Host&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Dyn Forcerport ACL Port&nbsp; &nbsp; &nbsp;Status&nbsp; &nbsp; &nbsp;<br />1001/1001&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 192.168.0.111&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; D&nbsp; &nbsp;N&nbsp; &nbsp; &nbsp; 38155&nbsp; &nbsp; Unmonitored <br />1002/1002&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 192.168.0.2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; D&nbsp; &nbsp;N&nbsp; &nbsp; &nbsp; 6465&nbsp; &nbsp; &nbsp;Unmonitored <br />peer-sjmsjm00_sip_imtel_c&nbsp; 211.115.87.190&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;N&nbsp; &nbsp; &nbsp; 5060&nbsp; &nbsp; &nbsp;OK (19 ms) <br />3 sip peers [Monitored: 1 online, 0 offline Unmonitored: 2 online, 0 offline]<br />OpenWrt*CLI&gt; sip show registry<br />Host&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dnsmgr Username&nbsp; &nbsp; &nbsp; &nbsp;Refresh State&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Reg.Time&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />peer-sjmsjm00_sip_imtel_com:5060&nbsp; &nbsp; &nbsp; &nbsp; N&nbsp; &nbsp; &nbsp; sjmsjm00&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;300 Unregistered&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />1 SIP registrations.<br />OpenWrt*CLI&gt; sip show settings</p><br /><p>Global Settings:<br />----------------<br />&nbsp; UDP Bindaddress:&nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0:5060<br />&nbsp; TCP SIP Bindaddress:&nbsp; &nbsp; Disabled<br />&nbsp; TLS SIP Bindaddress:&nbsp; &nbsp; Disabled<br />&nbsp; Videosupport:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;No<br />&nbsp; Textsupport:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; No<br />&nbsp; Ignore SDP sess. ver.:&nbsp; No<br />&nbsp; AutoCreate Peer:&nbsp; &nbsp; &nbsp; &nbsp; No<br />&nbsp; Match Auth Username:&nbsp; &nbsp; No<br />&nbsp; Allow unknown access:&nbsp; &nbsp;Yes<br />&nbsp; Allow subscriptions:&nbsp; &nbsp; Yes<br />&nbsp; Allow overlap dialing:&nbsp; Yes<br />&nbsp; Allow promisc. redir:&nbsp; &nbsp;No<br />&nbsp; Enable call counters:&nbsp; &nbsp;No<br />&nbsp; SIP domain support:&nbsp; &nbsp; &nbsp;No<br />&nbsp; Realm. auth:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; No<br />&nbsp; Our auth realm&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; asterisk<br />&nbsp; Use domains as realms:&nbsp; No<br />&nbsp; Call to non-local dom.: Yes<br />&nbsp; URI user is phone no:&nbsp; &nbsp;No<br />&nbsp; Always auth rejects:&nbsp; &nbsp; Yes<br />&nbsp; Direct RTP setup:&nbsp; &nbsp; &nbsp; &nbsp;No<br />&nbsp; User Agent:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PBX<br />&nbsp; SDP Session Name:&nbsp; &nbsp; &nbsp; &nbsp;Asterisk PBX 1.8.10.1<br />&nbsp; SDP Owner Name:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;root<br />&nbsp; Reg. context:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(not set)<br />&nbsp; Regexten on Qualify:&nbsp; &nbsp; No<br />&nbsp; Legacy userfield parse: No<br />&nbsp; Caller ID:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; asterisk<br />&nbsp; From: Domain:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; Record SIP history:&nbsp; &nbsp; &nbsp;Off<br />&nbsp; Call Events:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Off<br />&nbsp; Auth. Failure Events:&nbsp; &nbsp;Off<br />&nbsp; T.38 support:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;No<br />&nbsp; T.38 EC mode:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Unknown<br />&nbsp; T.38 MaxDtgrm:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -1<br />&nbsp; SIP realtime:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Disabled<br />&nbsp; Qualify Freq :&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 55000 ms<br />&nbsp; Q.850 Reason header:&nbsp; &nbsp; No<br />&nbsp; Store SIP_CAUSE:&nbsp; &nbsp; &nbsp; &nbsp; No</p><p>Network QoS Settings:<br />---------------------------<br />&nbsp; IP ToS SIP:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;CS0<br />&nbsp; IP ToS RTP audio:&nbsp; &nbsp; &nbsp; &nbsp;CS0<br />&nbsp; IP ToS RTP video:&nbsp; &nbsp; &nbsp; &nbsp;CS0<br />&nbsp; IP ToS RTP text:&nbsp; &nbsp; &nbsp; &nbsp; CS0<br />&nbsp; 802.1p CoS SIP:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;4<br />&nbsp; 802.1p CoS RTP audio:&nbsp; &nbsp;5<br />&nbsp; 802.1p CoS RTP video:&nbsp; &nbsp;6<br />&nbsp; 802.1p CoS RTP text:&nbsp; &nbsp; 5<br />&nbsp; Jitterbuffer enabled:&nbsp; &nbsp;No</p><p>Network Settings:<br />---------------------------<br />&nbsp; SIP address remapping:&nbsp; Enabled using externhost<br />&nbsp; Externhost:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;faxing.mooo.com<br />&nbsp; Externaddr:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;112.169.14.166:0<br />&nbsp; Externrefresh:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 10<br />&nbsp; Localnet:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;192.168.0.0/255.255.0.0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 10.0.0.0/255.0.0.0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 172.16.0.0/255.240.0.0</p><p>Global Signalling Settings:<br />---------------------------<br />&nbsp; Codecs:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0xc (ulaw|alaw)<br />&nbsp; Codec Order:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ulaw:20,alaw:20<br />&nbsp; Relax DTMF:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;No<br />&nbsp; RFC2833 Compensation:&nbsp; &nbsp;No<br />&nbsp; Symmetric RTP:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Yes<br />&nbsp; Compact SIP headers:&nbsp; &nbsp; No<br />&nbsp; RTP Keepalive:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 30 <br />&nbsp; RTP Timeout:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 600 <br />&nbsp; RTP Hold Timeout:&nbsp; &nbsp; &nbsp; &nbsp;0 (Disabled)<br />&nbsp; MWI NOTIFY mime type:&nbsp; &nbsp;application/simple-message-summary<br />&nbsp; DNS SRV lookup:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Yes<br />&nbsp; Pedantic SIP support:&nbsp; &nbsp;Yes<br />&nbsp; Reg. min duration&nbsp; &nbsp; &nbsp; &nbsp;60 secs<br />&nbsp; Reg. max duration:&nbsp; &nbsp; &nbsp; 600 secs<br />&nbsp; Reg. default duration:&nbsp; 300 secs<br />&nbsp; Outbound reg. timeout:&nbsp; 20 secs<br />&nbsp; Outbound reg. attempts: 0<br />&nbsp; Notify ringing state:&nbsp; &nbsp;Yes<br />&nbsp; &nbsp; Include CID:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; No<br />&nbsp; Notify hold state:&nbsp; &nbsp; &nbsp; No<br />&nbsp; SIP Transfer mode:&nbsp; &nbsp; &nbsp; open<br />&nbsp; Max Call Bitrate:&nbsp; &nbsp; &nbsp; &nbsp;384 kbps<br />&nbsp; Auto-Framing:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;No<br />&nbsp; Outb. proxy:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;not set&gt; <br />&nbsp; Session Timers:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Accept<br />&nbsp; Session Refresher:&nbsp; &nbsp; &nbsp; uas<br />&nbsp; Session Expires:&nbsp; &nbsp; &nbsp; &nbsp; 1800 secs<br />&nbsp; Session Min-SE:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;90 secs<br />&nbsp; Timer T1:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;500<br />&nbsp; Timer T1 minimum:&nbsp; &nbsp; &nbsp; &nbsp;100<br />&nbsp; Timer B:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 32000<br />&nbsp; No premature media:&nbsp; &nbsp; &nbsp;Yes<br />&nbsp; Max forwards:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;70</p><p>Default Settings:<br />-----------------<br />&nbsp; Allowed transports:&nbsp; &nbsp; &nbsp;UDP<br />&nbsp; Outbound transport:&nbsp; &nbsp;&nbsp; &nbsp;UDP<br />&nbsp; Context:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; default-incoming-call-context<br />&nbsp; Force rport:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Yes<br />&nbsp; DTMF:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;inband<br />&nbsp; Qualify:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0<br />&nbsp; Use ClientCode:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;No<br />&nbsp; Progress inband:&nbsp; &nbsp; &nbsp; &nbsp; Never<br />&nbsp; Language:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; MOH Interpret:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; default<br />&nbsp; MOH Suggest:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; Voice Mail Extension:&nbsp; &nbsp;asterisk</p><p>----<br />OpenWrt*CLI&gt;</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p189763">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						23 Jan 2013, 13:12					</div>
				</div>
				<div class="post-content content">
					<p>You need to install iptables-mod-conntrack-extra for sip-nat support.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p189837">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">sjmsjm00</div>
					<div class="post-datetime">
						24 Jan 2013, 09:02					</div>
				</div>
				<div class="post-content content">
					<p>Mr. jow, thank you for your answer. <br />I installed iptables-mod-nat-extra and iptables-mod-conntrack-extra and tested, however, there is still sip-peer(peer-sjmsjm00_sip_imtel_com) unregistered by &quot;OpenWrt*CLI&gt; sip show registery&quot;.<br />I have one question on it.<br />In my case, is there any need to define SRV record in &quot;/etc/config/dhcp&quot; or elsewhere?<br />If you had some experience of it, I would like you to advise for me in detail on this matter.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>