<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Problem with network when booting from usb</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 24 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p65827">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">aero7</div>
					<div class="post-datetime">
						27 Mar 2008, 01:43					</div>
				</div>
				<div class="post-content content">
					<p>Hi!<br />I&#039;ve set up my new Asus WL-500G Premium with a current svn trunk build of kamikaze (kernel 2.6) to boot from an usb stick.<br />(I followed a howto found on this forum and the according article in the wiki - both ways work fine, I tried everything *g*)<br />So, my device boots from usb and it boots from internal flash if there is no usb stick. So far everything&#039;s fine.</p><p>The problem I&#039;m experiencing is that the network config is not set up correctly (aka messed up completely) when the device boots from usb.<br />The config in the internal flash is the default one (2 vlans, one for WAN, one for LAN; LAN using bridge with fixed IP etc.) - this one is only there for fallback and should &quot;never&quot; be used in normal operation (when booting from usb).<br />The config stored on the usb stick looks different. Every port of the device should be in its own vlan, every vlan has a fixed ip address. I tested this config without usb, so I know it is working (and I have a similar setup running with whiterussian).<br />But... it does not work as soon as I boot it from usb. It seems like both configs (internal and usb) are applied subsequently. The usb config is not using a bridge, but there is a bridge created (&quot;br-lan&quot;). The vlan config seems to work, though. The vlans get set up properly according to the usb config. But the interface config is not set up correctly, resulting in a weird mess (the &quot;zombie&quot;-br-lan and one of the vlans - eth0.0 - using the same ip address and so on).<br />Another weird thing: as soon as interface &quot;wan&quot; is commented out in the internal config, it is not set up when booting from usb either.</p><p>I&#039;d appreciate any help...<br />Perhaps I got something wrong with the usb boot, but I thought that when booting from usb (I&#039;m currently using the method where /sbin/init gets replaced with a pivot_root-script), then the device is using everything (including /etc/config) from the usb partition.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>