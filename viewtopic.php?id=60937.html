<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> [SOLVED] Netflix Open Connect with Google DNS</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 21 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p299833">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">twotwo</div>
					<div class="post-datetime">
						15 Nov 2015, 05:48					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>I cannot access Netflix after changing my DNS from my ISP&#039;s (Telus) DNS to Google public DNS. I changed dns because I want to use dnssec and my ISP&#039;s DNS won&#039;t work with DNSSEC.</p><p><a href="https://help.netflix.com/en/node/85">According to Netflix FAQ:</a><br /></p><div class="quotebox"><blockquote><p>If you&#039;ve modified your device for custom connection settings, we recommend using your Internet service provider&#039;s default settings. If you are connecting with a Virtual Private Network, disable it and connect directly with your home Internet. If you have changed your device to a custom DNS setting, try resetting your device to acquire DNS automatically. If you are unsure how to complete any of these steps, reach out to the manufacturer of the device for more assistance.</p></blockquote></div><p>Telus is part of <a href="https://openconnect.netflix.com/">Netflix Open Connect</a> where they have netflix caching servers on ISPs network infrastructure.</p><p><a href="http://www.dslreports.com/faq/10846">Telus has other dns server</a> and out of the list two dns servers offer dnssec:</p><div class="codebox"><pre><code>209.202.110.120
209.202.110.121

dig @209.202.110.120 +dnssec debian.org

; &lt;&lt;&gt;&gt; DiG 9.10.3 &lt;&lt;&gt;&gt; @209.202.110.120 +dnssec debian.org
; (1 server found)
;; global options: +cmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 53602
;; flags: qr rd ra; QUERY: 1, ANSWER: 7, AUTHORITY: 6, ADDITIONAL: 11

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags: do; udp: 4096
;; QUESTION SECTION:
;debian.org.            IN    A

;; ANSWER SECTION:
debian.org.        300    IN    A    200.17.202.197
debian.org.        300    IN    A    150.203.164.38
debian.org.        300    IN    A    128.31.0.62
debian.org.        300    IN    A    140.211.15.34
debian.org.        300    IN    A    5.153.231.4
debian.org.        300    IN    A    130.89.148.14
debian.org.        300    IN    RRSIG    A 8 2 300 20151222060107 20151112050107 36840 debian.org. m8nWgsDuIpL6NsUuykMb7T5nhby6bGt2OmgMDKckZQ6qOhPAV2cckctI B0iiBvoUUaolX3W6W+XtpwueUWygZvopjZnVO94+u5PoQD5tUV0Hl168 2MnIfbekadQLju2025cqVp/I1hZkdg/7Ii4XJlgL+1+XeESU6QJyhRM6 rUKB5xSDFGBH3aqfr57G0Kl3yTr9xnIYhcf0Pb0qIdqEJ5NZsG6Gslts d8M2MHWp1jE9eBkxeYP3+D5uHowU3eV7

;; AUTHORITY SECTION:
debian.org.        2962    IN    NS    sec1.rcode0.net.
debian.org.        2962    IN    NS    debian1.dnsnode.net.
debian.org.        2962    IN    NS    dns1.easydns.com.
debian.org.        2962    IN    NS    sec2.rcode0.net.
debian.org.        2962    IN    NS    dns4.easydns.info.
debian.org.        28584    IN    RRSIG    NS 8 2 28800 20151212140543 20151102140515 36840 debian.org. Yg1Qh8Q7gNtMCXPczVXlrBsHCUmxap+4C3Q/XPP8ddpHp879b2N342gZ 4R6cygK92npZvzIlUzDUxCNwL056FcXkz+oRge8iHxIwADgqH0jcH+Q+ iriBZcgQoD1fbX5k+IV7t2949kQW25agG1EVuMUcNN7U5/AZAeeKtCs1 S6bnSwnyrbtO8rzLhgE8LtZSBbfkHVjBLjTzyRHE/D1n8zzLs3Ny5YoM u6SdmuWNjG3F4R2lsKkXSlXr4FgSaZLa

;; ADDITIONAL SECTION:
dns1.easydns.com.    170952    IN    A    64.68.192.210
dns1.easydns.com.    104483    IN    AAAA    2001:1838:f001::10
sec2.rcode0.net.    177445    IN    A    176.97.158.100
sec2.rcode0.net.    177445    IN    AAAA    2001:67c:10b8::100
sec1.rcode0.net.    4454    IN    A    192.174.68.100
sec1.rcode0.net.    4454    IN    AAAA    2001:67c:1bc::100
debian1.dnsnode.net.    6906    IN    A    194.146.106.126
debian1.dnsnode.net.    6906    IN    AAAA    2001:67c:1010:32::53
dns4.easydns.info.    26969    IN    A    194.0.2.19
dns4.easydns.info.    26969    IN    AAAA    2001:678:5::13

;; Query time: 78 msec
;; SERVER: 209.202.110.120#53(209.202.110.120)
;; WHEN: Sat Nov 14 19:39:26 PST 2015
;; MSG SIZE  rcvd: 962</code></pre></div><p>But anything other than ISP provided DNS addresses didn&#039;t work</p><div class="codebox"><pre><code>75.153.176.9
75.153.176.1</code></pre></div><p>I got list of domains netflix uses:<br /><span class="postimg"><img src="https://i.imgur.com/y8zpXxe.png" alt="https://i.imgur.com/y8zpXxe.png" /></span></p><p>I have added all the domains listed to /etc/config/dhcp<br /></p><div class="codebox"><pre><code>config dnsmasq
        option domainneeded &#039;1&#039;
        option boguspriv &#039;1&#039;
        option filterwin2k &#039;1&#039;
        option localise_queries &#039;1&#039;
        option rebind_protection &#039;1&#039;
        option rebind_localhost &#039;1&#039;
        option local &#039;/lan/&#039;
        option domain &#039;lan&#039;
        option expandhosts &#039;1&#039;
        option nonegcache &#039;1&#039;
        option authoritative &#039;1&#039;
        option readethers &#039;1&#039;
        option leasefile &#039;/tmp/dhcp.leases&#039;
        #option resolvfile &#039;/tmp/resolv.conf.auto&#039;
        option localservice &#039;1&#039;
        option dnssec &#039;1&#039;
        option strictorder &#039;1&#039;
        option noresolv  &#039;1&#039;
        list server &#039;/netflix.com/75.153.176.9&#039;
        list server &#039;/nflximg.com/75.153.176.9&#039;
        etc
        ...
        ...
        ...
        list server &#039;8.8.8.8&#039;
        list server &#039;8.8.4.4&#039;
        option dnsseccheckunsigned &#039;1&#039;</code></pre></div><p>Oddly enough, no matter what the dns record says, Netflix Apps work just fine on Android and IOS. On cyanogenmod I can see it requesting access to location information when on Google DNS but not requesting location access when on default dns.</p><p>On desktop/chrome it just exits with error.</p>											<p class="post-edited">(Last edited by <strong>twotwo</strong> on 11 Dec 2015, 21:44)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p299856">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">risk</div>
					<div class="post-datetime">
						15 Nov 2015, 11:51					</div>
				</div>
				<div class="post-content content">
					<p>sounds like their list is incomplete, try using wireshark to see what dns requests leave your computer when accessing netflix.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p299869">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">stangri</div>
					<div class="post-datetime">
						15 Nov 2015, 13:07					</div>
				</div>
				<div class="post-content content">
					<p>And please post the complete list (or even as is) as in the dhcp config -- would surely save time and effort to anyone who&#039;d want to retrace your steps.</p>											<p class="post-edited">(Last edited by <strong>stangri</strong> on 15 Nov 2015, 13:07)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p299982">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">twotwo</div>
					<div class="post-datetime">
						16 Nov 2015, 04:48					</div>
				</div>
				<div class="post-content content">
					<p>Sorry for late reply.<br />I got little busy for last couple days.<br />I will do the wireshark and full dhcp config in a few days. <br />I revered the dhcp config so I will have edit it back to the way it was.</p><p>I think this may not work because the dnssec option is a global config for all dns and telus dns won&#039;t work.<br />But I tried changing the dhcp config without dnssec and with all netflix domains pointing to telus and it still didn&#039;t work.</p>											<p class="post-edited">(Last edited by <strong>twotwo</strong> on 16 Nov 2015, 04:49)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p300011">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">stangri</div>
					<div class="post-datetime">
						16 Nov 2015, 12:43					</div>
				</div>
				<div class="post-content content">
					<p>On a side note, I&#039;m surprised that the Netflix wouldn&#039;t work with Google&#039;s DNS, because afaik the Google DNS was hardcoded in the Lollipop for Nexus devices and I don&#039;t remember hearing about Netflix access problems for them.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p303361">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">twotwo</div>
					<div class="post-datetime">
						11 Dec 2015, 20:02					</div>
				</div>
				<div class="post-content content">
					<p>Hey everyone,<br />Just a little update<br />I have done some further work and my isp has made some recent changes that might make this easier. (they have ipv6 enabled now)</p><p>So netflix with Google DNS works perfectly now.</p><p>The main problem remains, that is dnssec not working with netflix.</p><p>I did a trace on wireshark and found it interesting that domains similar to:</p><p>ipv6_1-lagg0-c004.1.yvr004.telus.isp.nflxvideo.net <em>points to =&gt;</em> ipv6_1-lagg0-c004.1.yvr004.telus.isp.nflxvideo.net<strong>.lan</strong></p><p>Wireshark shows a &quot;Server failure&quot; message in the packet.</p><p>so the .lan is actually same in /etc/config/dhcp:<br /></p><div class="codebox"><pre><code>local=/lan/
domain=lan</code></pre></div><p>So I turned off dnssec and clicked on as many netflix videos as I can and got list of domains to ip address list.</p><p>So ipv6_1-lagg0-c004.1.yvr004.telus.isp.nflxvideo.net actually points to:<br />2001:569:2:f31::2 and 205.250.87.233</p><p>Now is there is anyway to set domain to ip manually? I am thinking similar to a hosts file.</p><p>I also noticed that the domain names have similar pattern with <strong>c004</strong> and <strong>yvr004</strong> last number ranging from 1 to 5.</p><p>I found it interesting that with dnssec enabled that a domain would just point to a local address.</p><p>edit:<br />for those who want the list of addresses, it is easy to get from dig command. (for ipv6 you need to add -t AAAA)</p><p><strong>SOLVED</strong><br />1. I added expand-hosts directive to /etc/dnsmasq.conf<br />2. I added all the telus/netflix domains and IP addresses to /etc/hosts file</p>											<p class="post-edited">(Last edited by <strong>twotwo</strong> on 11 Dec 2015, 21:43)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>