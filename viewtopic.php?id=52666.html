<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> ZyXEL NBG-419N v2 support</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 27 Nov 2017 and 28 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 3</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=52666&amp;p=2.html">2</a></li><li><a href="viewtopic.php%3Fid=52666&amp;p=3.html">3</a></li></ul></nav></div>
			
		
		
			<article class="post" id="p246700">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">jama</div>
					<div class="post-datetime">
						11 Sep 2014, 00:12					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>I purchased new version of ZyXEL&#039;s NBG-419N.</p><p>The v2 version of the device looks identical to its predeseccors, and is *almost* able to boot AA and BB rc-3.</p><p>The kernel boots up nicely, but hangs to:</p><p>[&nbsp; &nbsp; 0.560000] VFS: Cannot open root device &quot;(null)&quot; or unknown-block(0,0)<br/>[&nbsp; &nbsp; 0.570000] Please append a correct &quot;root=&quot; boot option; here are the available partitions:<br/>[&nbsp; &nbsp; 0.590000] Kernel panic - not syncing: VFS: Unable to mount root fs on unknown-block(0,0)</p><p>BB rc-3 however goes a bit further, producing only one additional line:</p><p>[&nbsp; &nbsp; 2.520000] rt305x-esw 10110000.esw: link changed 0x01</p><p>AA boot log: (openwrt-ramips-rt305x-nbg-419n-squashfs-sysupgrade.bin)<br/></p><div class="codebox"><pre><code>Automatic boot of image at addr 0x80800000 ...
## Booting image at 80800000 ...
   Image Name:   MIPS OpenWrt Linux-3.3.8
   Created:      2013-03-23  19:02:00 UTC
   Image Type:   MIPS Linux Kernel Image (lzma compressed)
   Data Size:    887001 Bytes = 866.2 kB
   Load Address: 80000000
   Entry Point:  80000000
   Verifying Checksum ... OK
   Uncompressing Kernel Image ... OK
No initrd
## Transferring control to Linux (at address 80000000) ...
## Giving linux memsize in MB, 64

Starting kernel ...

[    0.000000] Linux version 3.3.8 (blogic@Debian-60-squeeze-64-minimal) (gcc version 4.6.3 20120201 (prerelease) (Linaro GCC 4.6-2012.02) ) #1 Sat Mar 23 19:00:46 UTC 2013
[    0.000000] bootconsole [early0] enabled
[    0.000000] CPU revision is: 0001964c (MIPS 24KEc)
[    0.000000] Ralink RT3352 id:1 rev:6 running at 384.00 MHz
[    0.000000] Determined physical RAM map:
[    0.000000]  memory: 04000000 @ 00000000 (usable)
[    0.000000] Initrd not found or empty - disabling initrd
[    0.000000] Zone PFN ranges:
[    0.000000]   Normal   0x00000000 -&gt; 0x00004000
[    0.000000] Movable zone start PFN for each node
[    0.000000] Early memory PFN ranges
[    0.000000]     0: 0x00000000 -&gt; 0x00004000
[    0.000000] Built 1 zonelists in Zone order, mobility grouping on.  Total pages: 16256
[    0.000000] Kernel command line:  board=NBG-419N console=ttyS1,57600 mtdparts=physmap-flash.0:192k(u-boot)ro,64k(u-boot-env)ro,64k(factory)ro,896k(kernel),2880k(rootfs),3776k@0x50000(firmware) rootfstype=squashfs,jffs2
[    0.000000] PID hash table entries: 256 (order: -2, 1024 bytes)
[    0.000000] Dentry cache hash table entries: 8192 (order: 3, 32768 bytes)
[    0.000000] Inode-cache hash table entries: 4096 (order: 2, 16384 bytes)
[    0.000000] Primary instruction cache 32kB, VIPT, 4-way, linesize 32 bytes.
[    0.000000] Primary data cache 16kB, 4-way, VIPT, no aliases, linesize 32 bytes
[    0.000000] Writing ErrCtl register=00078412
[    0.000000] Readback ErrCtl register=00078412
[    0.000000] Memory: 62160k/65536k available (2046k kernel code, 3376k reserved, 340k data, 176k init, 0k highmem)
[    0.000000] SLUB: Genslabs=9, HWalign=32, Order=0-3, MinObjects=0, CPUs=1, Nodes=1
[    0.000000] NR_IRQS:48
[    0.000000] console [ttyS1] enabled, bootconsole disabled
[    0.000000] console [ttyS1] enabled, bootconsole disabled
[    0.010000] Calibrating delay loop... 255.59 BogoMIPS (lpj=1277952)
[    0.090000] pid_max: default: 32768 minimum: 301
[    0.100000] Mount-cache hash table entries: 512
[    0.110000] NET: Registered protocol family 16
[    0.120000] MIPS: machine is ZyXEL NBG-419N
[    0.130000] gpiochip_add: registered GPIOs 0 to 23 on device: RT305X-GPIO0
[    0.140000] gpiochip_add: registered GPIOs 24 to 39 on device: RT305X-GPIO1
[    0.150000] gpiochip_add: registered GPIOs 40 to 51 on device: RT305X-GPIO2
[    0.180000] bio: create slab &lt;bio-0&gt; at 0
[    0.190000] Switching to clocksource MIPS
[    0.200000] NET: Registered protocol family 2
[    0.210000] IP route cache hash table entries: 1024 (order: 0, 4096 bytes)
[    0.230000] TCP established hash table entries: 2048 (order: 2, 16384 bytes)
[    0.240000] TCP bind hash table entries: 2048 (order: 1, 8192 bytes)
[    0.250000] TCP: Hash tables configured (established 2048 bind 2048)
[    0.270000] TCP reno registered
[    0.270000] UDP hash table entries: 256 (order: 0, 4096 bytes)
[    0.280000] UDP-Lite hash table entries: 256 (order: 0, 4096 bytes)
[    0.300000] NET: Registered protocol family 1
[    0.340000] squashfs: version 4.0 (2009/01/31) Phillip Lougher
[    0.350000] JFFS2 version 2.2 (NAND) (SUMMARY) (LZMA) (RTIME) (CMODE_PRIORITY) (c) 2001-2006 Red Hat, Inc.
[    0.370000] msgmni has been set to 121
[    0.380000] Block layer SCSI generic (bsg) driver version 0.4 loaded (major 254)
[    0.400000] io scheduler noop registered
[    0.410000] io scheduler deadline registered (default)
[    0.420000] Serial: 8250/16550 driver, 16 ports, IRQ sharing enabled
[    0.430000] serial8250: ttyS0 at MMIO 0x10000500 (irq = 13) is a 16550A
[    0.440000] serial8250: ttyS1 at MMIO 0x10000c00 (irq = 20) is a 16550A
[    0.470000] physmap platform flash device: 00800000 at bf000000
[    0.480000] physmap-flash physmap-flash.0: map_probe failed
[    0.510000] ramips-wdt ramips-wdt: timeout value must be 0 &lt; timeout &lt;= 33, using 33
[    0.520000] TCP cubic registered
[    0.530000] NET: Registered protocol family 17
[    0.540000] Bridge firewalling registered
[    0.550000] 8021q: 802.1Q VLAN Support v1.8
[    0.560000] VFS: Cannot open root device &quot;(null)&quot; or unknown-block(0,0)
[    0.570000] Please append a correct &quot;root=&quot; boot option; here are the available partitions:
[    0.590000] Kernel panic - not syncing: VFS: Unable to mount root fs on unknown-block(0,0)</code></pre></div><p>BB rc-3 boot log: (openwrt-ramips-rt305x-nbg-419n-squashfs-sysupgrade.bin)<br/></p><div class="codebox"><pre><code>Automatic boot of image at addr 0x80800000 ...
## Booting image at 80800000 ...
   Image Name:   MIPS OpenWrt Linux-3.10.49
   Created:      2014-08-08   2:02:16 UTC
   Image Type:   MIPS Linux Kernel Image (lzma compressed)
   Data Size:    1054434 Bytes =  1 MB
   Load Address: 80000000
   Entry Point:  80000000
   Verifying Checksum ... OK
   Uncompressing Kernel Image ... OK
No initrd
## Transferring control to Linux (at address 80000000) ...
## Giving linux memsize in MB, 64

Starting kernel ...

[    0.000000] Linux version 3.10.49 (bb@builder1) (gcc version 4.8.3 (OpenWrt/Linaro GCC 4.8-2014.04 r42001) ) #1 Fri Aug 8 04:01:07 CEST 2014
[    0.000000] SoC Type: Ralink RT3352 id:1 rev:6
[    0.000000] bootconsole [early0] enabled
[    0.000000] CPU revision is: 0001964c (MIPS 24KEc)
[    0.000000] MIPS: machine is ZyXEL NBG-419N
[    0.000000] Determined physical RAM map:
[    0.000000]  memory: 04000000 @ 00000000 (usable)
[    0.000000] Initrd not found or empty - disabling initrd
[    0.000000] Zone ranges:
[    0.000000]   Normal   [mem 0x00000000-0x03ffffff]
[    0.000000] Movable zone start for each node
[    0.000000] Early memory node ranges
[    0.000000]   node   0: [mem 0x00000000-0x03ffffff]
[    0.000000] Primary instruction cache 32kB, VIPT, 4-way, linesize 32 bytes.
[    0.000000] Primary data cache 16kB, 4-way, VIPT, no aliases, linesize 32 bytes
[    0.000000] Built 1 zonelists in Zone order, mobility grouping on.  Total pages: 16256
[    0.000000] Kernel command line: console=ttyS0,57600 rootfstype=squashfs,jffs2
[    0.000000] PID hash table entries: 256 (order: -2, 1024 bytes)
[    0.000000] Dentry cache hash table entries: 8192 (order: 3, 32768 bytes)
[    0.000000] Inode-cache hash table entries: 4096 (order: 2, 16384 bytes)
[    0.000000] Writing ErrCtl register=00000000
[    0.000000] Readback ErrCtl register=00000000
[    0.000000] Memory: 61648k/65536k available (2284k kernel code, 3888k reserved, 575k data, 212k init, 0k highmem)
[    0.000000] SLUB: HWalign=32, Order=0-3, MinObjects=0, CPUs=1, Nodes=1
[    0.000000] NR_IRQS:256
[    0.000000] CPU Clock: 384MHz
[    0.000000] Calibrating delay loop... 255.59 BogoMIPS (lpj=1277952)
[    0.070000] pid_max: default: 32768 minimum: 301
[    0.080000] Mount-cache hash table entries: 512
[    0.090000] pinctrl core: initialized pinctrl subsystem
[    0.100000] NET: Registered protocol family 16
[    0.120000] pinmux core: rt2880-pinmux does not support function sdram
[    0.130000] rt2880-pinmux pinctrl.1: invalid function sdram in map table
[    0.160000] bio: create slab &lt;bio-0&gt; at 0
[    0.170000] rt2880_gpio 10000600.gpio: registering 24 gpios
[    0.180000] rt2880_gpio 10000600.gpio: registering 24 irq handlers
[    0.190000] Switching to clocksource MIPS
[    0.200000] NET: Registered protocol family 2
[    0.210000] TCP established hash table entries: 512 (order: 0, 4096 bytes)
[    0.230000] TCP bind hash table entries: 512 (order: -1, 2048 bytes)
[    0.240000] TCP: Hash tables configured (established 512 bind 512)
[    0.250000] TCP: reno registered
[    0.260000] UDP hash table entries: 256 (order: 0, 4096 bytes)
[    0.270000] UDP-Lite hash table entries: 256 (order: 0, 4096 bytes)
[    0.280000] NET: Registered protocol family 1
[    0.290000] rt-timer 10000100.timer: maximum frequncy is 7812Hz
[    0.340000] squashfs: version 4.0 (2009/01/31) Phillip Lougher
[    0.350000] jffs2: version 2.2 (NAND) (SUMMARY) (LZMA) (RTIME) (CMODE_PRIORITY) (c) 2001-2006 Red Hat, Inc.
[    0.380000] msgmni has been set to 120
[    0.380000] io scheduler noop registered
[    0.390000] io scheduler deadline registered (default)
[    0.400000] Serial: 8250/16550 driver, 16 ports, IRQ sharing enabled
[    0.430000] 10000c00.uartlite: ttyS0 at MMIO 0x10000c00 (irq = 20) is a 16550A
[    0.450000] console [ttyS0] enabled, bootconsole disabled
[    0.450000] console [ttyS0] enabled, bootconsole disabled
[    0.470000] of-flash 1f000000.cfi: do_map_probe() failed
[    0.490000] eth0: done loading
[    0.500000] rt2880_wdt 10000120.watchdog: Initialized
[    0.520000] TCP: cubic registered
[    0.520000] NET: Registered protocol family 17
[    0.530000] Bridge firewalling registered
[    0.540000] 8021q: 802.1Q VLAN Support v1.8
[    0.550000] VFS: Cannot open root device &quot;(null)&quot; or unknown-block(0,0): error -6
[    0.570000] Please append a correct &quot;root=&quot; boot option; here are the available partitions:
[    0.580000] Kernel panic - not syncing: VFS: Unable to mount root fs on unknown-block(0,0)
[    2.520000] rt305x-esw 10110000.esw: link changed 0x01</code></pre></div><p>I flashed AA once, but restored to stock FW due to crash.</p><p>The boot logs are produced by loading the image to SDRAM by tftp and executing it, by choosing &#039;1&#039; from ZyXEL&#039;s u-boot menu.</p><p>Could there be something to do in order to run AA or BB on the device?</p><p>The CPU architecture seems to be correct:</p><div class="codebox"><pre><code># cat /proc/cpuinfo
system type             : Ralink SoC
processor               : 0
cpu model               : MIPS 24K V4.12
BogoMIPS                : 255.48
wait instruction        : yes
microsecond timers      : yes
tlb_entries             : 32
extra interrupt vector  : yes
hardware watchpoint     : yes
ASEs implemented        : mips16 dsp
VCED exceptions         : not available
VCEI exceptions         : not available</code></pre></div><p>Stock FW boot log:<br/></p><div class="codebox"><pre><code>U-Boot 1.1.3 (Mar  6 2012 - 17:34:10)

Board: Ralink APSoC DRAM:  64 MB
relocate_code Pointer at: 83fb0000
spi_wait_nsec: 3c
spi device id: c2 20 17 c2 20 (2017c220)
find flash: MX25L6405D
raspi_read: from:30000 len:1000
.raspi_read: from:30000 len:1000
.============================================
Ralink UBoot Version: 3.6.0.1_a3
--------------------------------------------
ASIC 3352_MP (Port5&lt;-&gt;None)
DRAM_CONF_FROM: Boot-Strapping
DRAM_TYPE: DDR2
DRAM_SIZE: 512 Mbits
DRAM_WIDTH: 16 bits
DRAM_TOTAL_WIDTH: 16 bits
TOTAL_MEMORY_SIZE: 64 MBytes
Flash component: SPI Flash
Date:Mar  6 2012  Time:17:34:10
============================================
icache: sets:256, ways:4, linesz:32 ,total:32768
dcache: sets:128, ways:4, linesz:32 ,total:16384

 ##### The CPU freq = 384 MHZ ####
 estimate memory size =64 Mbytes
 uboot: NBG-419N v2 Power LED...on

Please choose the operation:
   1: Load system code to SDRAM via TFTP.
   2: Load system code then write to Flash via TFTP.
   3: Boot system code via Flash (default).
   4: Entr boot command line interface.
   6: To emergency.
   7: Load Boot Loader code then write to Flash via Serial.
   9: Load Boot Loader code then write to Flash via TFTP.
   a: Auto load system code then write to Flash via TFTP.
 0

3: System Boot system code via Flash.
## Booting image at bc050000 ...
raspi_read: from:50000 len:40
.   Image Name:   Linux Kernel Image
   Created:      2013-08-26   9:35:00 UTC
   Image Type:   MIPS Linux Kernel Image (lzma compressed)
   Data Size:    4007317 Bytes =  3.8 MB
   Load Address: 80000000
   Entry Point:  802aa000
raspi_read: from:50040 len:3d2595
..............................................................   Verifying Checksum ... OK
   Uncompressing Kernel Image ...
No initrd
## Transferring control to Linux (at address 802aa000) ...
## Giving linux memsize in MB, 64

Starting kernel ...


LINUX started...

 THIS IS ASIC

 The CPU frequency set to 384 MHz
CPU revision is: 0001964c
Determined physical RAM map:
 memory: 04000000 @ 00000000 (usable)
Built 1 zonelists.  Total pages: 16256
Primary instruction cache 32kB, physically tagged, 4-way, linesize 32 bytes.
Primary data cache 16kB, 4-way, linesize 32 bytes.
cause = c0808044, status = 11000000
PID hash table entries: 256 (order: 8, 1024 bytes)
calculating r4koff... 00177000(1536000)
CPU frequency 384.00 MHz
Using 192.000 MHz high precision timer.
Dentry cache hash table entries: 8192 (order: 3, 32768 bytes)
Inode-cache hash table entries: 4096 (order: 2, 16384 bytes)
Mount-cache hash table entries: 512
IP route cache hash table entries: 1024 (order: 0, 4096 bytes)
TCP established hash table entries: 2048 (order: 2, 16384 bytes)
TCP bind hash table entries: 2048 (order: 1, 8192 bytes)
detected lzma initramfs
MX25L6405D(c2 2017c220) (8192 Kbytes)
mtd .name = raspi, .size = 0x00800000 (8M) .erasesize = 0x00010000 (64K) .numeraseregions = 0
mtd: partition &quot;Kernel&quot; extends beyond the end of device &quot;raspi&quot; -- size truncated to 0x7b0000
RT3xxx EHCI/OHCI init.
squashfs: LZMA suppport for slax.org by jro
fuse init (API version 7.8)
Ralink gpio driver initialized
RAMDISK driver initialized: 16 RAM disks of 16384K size 1024 blocksize
rdm_major = 253
Ralink APSoC Ethernet Driver Initilization. v2.1  256 rx/tx descriptors allocated, mtu = 1500!
MAC_ADRH -- : 0x0000107b
MAC_ADRL -- : 0xefc91f15
 kernel: NBG-419N v2 Power LED...on
RL this is patch v3
nf_conntrack version 0.5.0 (512 buckets, 4096 max 400 reserved)
ip_tables: (C) 2000-2006 Netfilter Core Team, Type=Restricted Cone


  2008/11/24 Kernel xt_register_target =======&gt;

arp_tables: (C) 2002 David S. Miller
init started: BusyBox v1.12.1 (2013-08-26 17:16Algorithmics/MIPS FPU Emulator v1.5
:06 CST)
starting pid 628, tty &#039;&#039;: &#039;/etc_ro/rcS&#039;
Welcome to
     _______  _______  ___     __  ____   _  _   ___
    |  ___  \|   __  ||   |   |__||    \ | || | /  /
    | |___| ||  |__| ||   |__  __ |     \| || |/  /
    |   _   /|   _   ||      ||  || |\     ||     \
    |__| \__\|__| |__||______||__||_| \____||_|\___\

                     =System Architecture Department=

ftpalg: Waiting for message from kernel

@@@ BssidNum @@@

@@@ BssidNum @@@
nvram flash is ok
NetUSB: module license &#039;Proprietary&#039; taints kernel.
Symbol usb_register_driver is being used by a non-GPL module, which will not be allowed in the future
Please see the file Documentation/feature-removal-schedule.txt in the kernel source tree for more details.
Symbol usb_deregister is being used by a non-GPL module, which will not be allowed in the future
Please see the file Documentation/feature-removal-schedule.txt in the kernel source tree for more details.
kc   88 : run_telnetDBGDServer start
kc  225 : init_DebugD end
INFO1612: NetUSB 1.156 u10, 00020615 : Feb  7 2012 18:26:20
INFO1614: AUTH  ISOC
INFO1615:
INFO0076:  init proc : PAGE_SIZE 4096
INFO1586:  sleep to wait br0 to wake up
INFO02C7:  use dev Name br0 : fail
starting pid 693, tty &#039;/dev/ttyS1&#039;: &#039;/bin/sh&#039;


BusyBox v1.12.1 (2013-08-26 17:16:06 CST) built-in shell (ash)
Enter &#039;help&#039; for a list of built-in commands.

# Password for &#039;admin&#039; changed
INFO02C7:  use dev Name br0 : fail
rmmod: ralink_wdt: No such file or directory
rmmod: cls: No such file or directory
rmmod: hw_nat: No such file or directory
rmmod: raeth: No such file or directory
insmod: bridge.ko: module not found
insmod: mii.ko: module not found
insmod: raeth.ko: module not found

phy_tx_ring = 0x03891000, tx_ring = 0xa3891000

phy_rx_ring0 = 0x03892000, rx_ring0 = 0xa3892000
MAC_ADRH -- : 0x0000107b
MAC_ADRL -- : 0xefc91f15
RT305x_ESW: Link Status Changed
CDMA_CSG_CFG = 81000007
GDMA1_FWD_CFG = C0710000
INFO02C7:  use dev Name br0 : fail

##### disable 1st wireless interface #####
rmmod: rt2860v2_ap_net: No such file or directory
rmmod: rt2860v2_ap: No such file or directory
rmmod: rt2860v2_ap_util: No such file or directory
rmmod: rt2860v2_sta_net: No such file or directory
rmmod: rt2860v2_sta: No such file or directory
rmmod: rt2860v2_sta_util: No such file or directory
insmod: rt2860v2_ap_util.ko: module not found


=== pAd = c0096000, size = 804440 ===

&lt;-- RTMPAllocAdapterBlock, Status=0
insmod: rt2860v2_ap_net.ko: module not found
rmmod: nf_nat_pptp: No such file or directory
rmmod: nf_conntrack_pptp: No such file or directory
rmmod: nf_nat_proto_gre: No such file or directory
rmmod: nf_conntrack_proto_gre: No such file or directory
RX DESC a3213000  size = 2048
&lt;-- RTMPAllocTxRxRingMemory, Status=0
Key1Str is Invalid key length(0) or Type(0)
Key2Str is Invalid key length(0) or Type(0)
Key3Str is Invalid key length(0) or Type(0)
Key4Str is Invalid key length(0) or Type(0)
1. Phy Mode = 9
2. Phy Mode = 9
3. Phy Mode = 9
RTMPSetPhyMode: channel is out of range, use first channel=0
MCS Set = ff ff 00 00 01
SYNC - BBP R4 to 20MHz.l
INFO02C7:  use dev Name br0 : fail
INFO02C7:  use dev Name br0 : fail
INFO02C7:  use dev Name br0 : fail
SYNC - BBP R4 to 20MHz.l
SYNC - BBP R4 to 20MHz.l
INFO02C7:  use dev Name br0 : fail
SYNC - BBP R4 to 20MHz.l
SYNC - BBP R4 to 20MHz.l
SYNC - BBP R4 to 20MHz.l
INFO02C7:  use dev Name br0 : fail
SYNC - BBP R4 to 20MHz.l
SYNC - BBP R4 to 20MHz.l
SYNC - BBP R4 to 20MHz.l
INFO02C7:  use dev Name br0 : fail
Main bssid = 10:7b:ef:c9:1f:14
&lt;==== rt28xx_init, Status=0
0x1300 = 00064380
vconfig: ioctl error for rem: Invalid argument
vconfig: ioctl error for rem: Invalid argument
rmmod: 8021q: No such file or directory
insmod: 8021q.ko: module not found
vconfig: ioctl error for rem: Invalid argument
eth2.2: Setting MAC address to  10 7b ef c9 1f 15.
VLAN (eth2.2):  Underlying device (eth2) has same MAC, not checking promiscious mode.
ifconfig: ioctl 0x8913 failed: No such device
brctl: bridge br0: No such device or address
##### config RT3052 vlan partition (LLLLW) #####
switch reg write offset=14, value=405555
switch reg write offset=50, value=2001
switch reg write offset=98, value=7f3f
switch reg write offset=e4, value=3f
switch reg write offset=40, value=1001
switch reg write offset=44, value=1001
switch reg write offset=48, value=1002
switch reg write offset=70, value=ffff506f
done.
INFO02C7:  use dev Name br0 : fail
eth2.1: Setting MAC address to  10 7b ef c9 1f 14.
VLAN (eth2.1):  Setting underlying device (eth2) to promiscious mode.
==================Start Kill TimeTool Daemon!!!!!==================
CloneMAC mode is ...
Enter timetool
INFO02D0:  use dev Name br0
INFO158F:  sleep to wait br0 end.
INFO15A8:  UDP_BROAD 7417 tcpPort:20005
INFO02D0:  use dev Name br0
INFO14DF: tcpConnector() started...
ifconfig: ioctl 0x8914 failed: Cannot assign requested address
ifconfig: ioctl 0x8914 failed: Cannot assign requested address
cat: can&#039;t open &#039;/etc/resolv.conf&#039;: No such file or directory
dhcp_DnsMode is 12...
INFO13BF: Bind to br0
killall: udhcpd: no process killed
Set: phy[0].reg[RT305x_ESW: Link Status Changed
0] = 3900
Set: phy[1].reg[0] = 3900
Set: phy[2].reg[0] = 3900
Set: phy[3].reg[0] = 3900
Set: phy[0].reg[0] = 3100
Set: phy[1].reg[0] = 3100
Set: phy[2].reg[0] = 3100
Set: phy[3].reg[0] = 3100

***** g_wl_interface = ra0 ******

ifconfig: ioctl 0x8913 failed: No such device
libupnp: using UDP SSDP_PORT = 1900
RT305x_ESW: Link Status Changed
iwpriv ra0 set IgmpSnEnable=1
Start  initInterRL debug: AQ_LAN_IP=c0a80101
net!!!!!   systeRL debug: AQ_SHIFT_COUNT=8
m[internet.sh] =RL debug: AQ_HTTP_PORT=50</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p246851">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">123serge123</div>
					<div class="post-datetime">
						12 Sep 2014, 14:59					</div>
				</div>
				<div class="post-content content">
					<p>v2 have some hardware diffs:<br/>- rt3052-&gt;rt3352 (autodetected);<br/>- parallel flash -&gt; serial flash (so fail to mount rootfs);<br/>- dwc_otg -&gt; ehci/ohci.<br/> Just for test you can try BB image for dlink dir-620 d1.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p246885">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">jama</div>
					<div class="post-datetime">
						12 Sep 2014, 23:33					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>and thank you so much for your quick reply.</p><p>I&#039;m sorry, but it didn&#039;t work.</p><p>BB image for dlink dir-620 d1 booted, but didn&#039;t do more than produced a bunch of filesystem error messages, before crash:<br/></p><div class="codebox"><pre><code>[   22.990000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00590000: 0xc376 instead
[   23.010000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00590004: 0x369c instead
[   23.030000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00590008: 0xde58 instead
[   23.050000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x0059000c: 0xd8e5 instead
[   23.070000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00590010: 0xb61d instead
[   23.090000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00590014: 0x6b49 instead
[   23.110000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00590018: 0x6d7c instead
[   23.120000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x0059001c: 0x6f0c instead
[   23.140000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00590020: 0x0917 instead
[   23.160000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00590024: 0xbd37 instead
[   23.180000] jffs2: Further such events for this erase block will not be printed
[   23.300000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x005f0000: 0x2a74 instead
[   23.320000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x005f0004: 0x47e3 instead
[   23.340000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x005f0008: 0x8cf3 instead
[   23.360000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x005f000c: 0x32af instead
[   23.380000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x005f0010: 0xf0d3 instead
[   23.400000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x005f0014: 0xb750 instead
[   23.420000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x005f0018: 0x8370 instead
[   23.440000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x005f001c: 0x814d instead
[   23.450000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x005f0020: 0x4f6e instead
[   23.470000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x005f0024: 0xf76d instead
[   23.490000] jffs2: Further such events for this erase block will not be printed
[   23.620000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00600000: 0xf77e instead
[   23.630000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00600004: 0xd902 instead
[   23.650000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00600008: 0xd68f instead
[   23.670000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x0060000c: 0x3fc6 instead
[   23.690000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00600010: 0xee99 instead
[   23.710000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00600014: 0x8ad6 instead
[   23.730000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00600018: 0xb6ed instead
[   23.750000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x0060001c: 0xf64c instead
[   23.770000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00600020: 0xfd40 instead
[   23.790000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00600024: 0x24d5 instead
[   23.800000] jffs2: Further such events for this erase block will not be printed
[   23.930000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00610000: 0x18c2 instead
[   23.950000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00610004: 0x401b instead
[   23.960000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00610008: 0x3589 instead
[   23.980000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x0061000c: 0x7a56 instead
[   24.000000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00610010: 0x717d instead
[   24.020000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00610014: 0xea78 instead
[   24.040000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00610018: 0x1273 instead
[   24.060000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x0061001c: 0x1401 instead
[   24.080000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00610020: 0x249b instead
[   24.100000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00610024: 0x8525 instead
[   24.120000] jffs2: Further such events for this erase block will not be printed
[   24.240000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x006c0000: 0xb197 instead
[   24.260000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x006c0004: 0xe273 instead
[   24.280000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x006c0008: 0xdf3c instead
[   24.300000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x006c000c: 0xb01c instead
[   24.320000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x006c0010: 0xea13 instead
[   24.340000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x006c0014: 0xd3e8 instead
[   24.350000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x006c0018: 0x067f instead
[   24.370000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x006c001c: 0x54f2 instead
[   24.390000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x006c0020: 0xbe5a instead
[   24.410000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x006c0024: 0x6ca3 instead
[   24.430000] jffs2: Further such events for this erase block will not be printed
[   24.550000] jffs2: Cowardly refusing to erase blocks on filesystem with no valid JFFS2 nodes
[   24.570000] jffs2: empty_blocks 33, bad_blocks 0, c-&gt;nr_blocks 109
[   24.580000] VFS: Cannot open root device &quot;(null)&quot; or unknown-block(31,4): error -5
[   24.590000] Please append a correct &quot;root=&quot; boot option; here are the available partitions:
[   24.610000] 1f00             192 mtdblock0  (driver?)
[   24.620000] 1f01              64 mtdblock1  (driver?)
[   24.630000] 1f02              64 mtdblock2  (driver?)
[   24.640000] 1f03            7872 mtdblock3  (driver?)
[   24.650000] 1f04            7011 mtdblock4  (driver?)
[   24.660000] Kernel panic - not syncing: VFS: Unable to mount root fs on unknown-block(31,4)</code></pre></div><p>However, by performing some additional searching, I found out that <strong>you are</strong> <strong><span class="bbu">the man</span></strong> who already solved the problem some time ago.</p><p>According to the thread <a href="https://forum.openwrt.org/viewtopic.php?id=40634">https://forum.openwrt.org/viewtopic.php?id=40634</a> a custom build for NBG-419N v2 was made, <a href="http://narod.ru/disk/63856855001.3fb9119dca7a83bf3a4046cbb1541ac8/nbg-419nv2-sysupgrade.bin.html">nbg-419nv2-sysupgrade.bin</a> (and can still be downloaded)</p><p>I can confirm that the custom build can be flashed on the device, and it boots up nicely.<br/></p><div class="codebox"><pre><code>BusyBox v1.19.4 (2012-10-05 23:41:12 NOVST) built-in shell (ash)
Enter &#039;help&#039; for a list of built-in commands.

  _______                     ________        __
 |       |.-----.-----.-----.|  |  |  |.----.|  |_
 |   -   ||  _  |  -__|     ||  |  |  ||   _||   _|
 |_______||   __|_____|__|__||________||__|  |____|
          |__| W I R E L E S S   F R E E D O M
 -----------------------------------------------------
 ATTITUDE ADJUSTMENT (Bleeding Edge, r33624)
 -----------------------------------------------------
  * 1/4 oz Vodka      Pour all ingredients into mixing
  * 1/4 oz Gin        tin with ice, strain into glass.
  * 1/4 oz Amaretto
  * 1/4 oz Triple sec
  * 1/4 oz Peach schnapps
  * 1/4 oz Sour mix
  * 1 splash Cranberry juice
 -----------------------------------------------------
root@OpenWrt:/# </code></pre></div><p>But, regarding the thread, some patches were needed from ZyXEL in order to produce the working image?</p><p>However, I understood that NAND would be supported on BB by default?</p><p>Can you Serge recall how this custom build for v2 was made?</p><p>Also, with some googling, I found some posts regarding v2 patching, but I guess these are not valid anymore, as I got the impression that the OpenWRT build system has changed quite a lot.</p><p><a href="http://pastebin.com/raw.php?i=Su918N9r">http://pastebin.com/raw.php?i=Su918N9r</a></p><p>In addition, I also found something related to custom mtd layout: (at the very end, but not for v2 though)</p><p><a href="http://ranosgrant.cocolog-nifty.com/openwrt-aa-r35864/new-mzk-wnh.diff">http://ranosgrant.cocolog-nifty.com/ope … k-wnh.diff</a></p><p>I <strong>really</strong> don&#039;t know whether or not these are still valid, or how to implement these in order to produce a specific build for v2, but could someone please have a look once more, as Serge already succseeded producing a fully working image?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p246905">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">123serge123</div>
					<div class="post-datetime">
						13 Sep 2014, 06:48					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>jama wrote:</cite><blockquote><p>But, regarding the thread, some patches were needed from ZyXEL in order to produce the working image?</p></blockquote></div><p>Only for building factory image which may be flashed form original Zyxel firware.<br/></p><div class="quotebox"><blockquote><p>Can you Serge recall how this custom build for v2 was made?</p></blockquote></div><p>That patch was simple and incomplete (flash layout, factory image, wifi eeprom, leds and buttons) because of tester inactivity.<br/></p><div class="quotebox"><blockquote><p>Also, with some googling, I found some posts regarding v2 patching, but I guess these are not valid anymore, as I got the impression that the OpenWRT build system has changed quite a lot.</p></blockquote></div><p>Yes. Starting from BB no need to recompile kernel to add new device.</p><p>New test images<br/><a href="https://yadi.sk/d/1ZV0lKJwbTE65">https://yadi.sk/d/1ZV0lKJwbTE65</a><br/>Some comments:<br/>1. AA image use custom kernel, so AA-release repo compatibility is lost (kernel modules may crash). But quick and stable <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile"/>.<br/>2. BB image is fully compatible with BB rc3 repo.<br/>I put dts-file. You may correct it and make new version of images for test.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p246913">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">jama</div>
					<div class="post-datetime">
						13 Sep 2014, 10:34					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>And thank you so much for your quick reply.</p><p>The AA build acts exactly as you said, i.e. kernel modules indeed do crash:<br/></p><div class="codebox"><pre><code>Please press Enter to activate this console. [    9.060000] Compat-drivers backport release: compat-drivers-2012-09-04-2-gddac993
[    9.070000] Backport based on wireless-testing.git master-2012-09-07
[    9.090000] compat.git: wireless-testing.git
[    9.130000] cfg80211: Calling CRDA to update world regulatory domain
[    9.140000] cfg80211: World regulatory domain updated:
[    9.150000] cfg80211:   (start_freq - end_freq @ bandwidth), (max_antenna_gain, max_eirp)
[    9.170000] cfg80211:   (2402000 KHz - 2472000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)
[    9.180000] cfg80211:   (2457000 KHz - 2482000 KHz @ 20000 KHz), (300 mBi, 2000 mBm)
[    9.200000] cfg80211:   (2474000 KHz - 2494000 KHz @ 20000 KHz), (300 mBi, 2000 mBm)
[    9.210000] cfg80211:   (5170000 KHz - 5250000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)
[    9.230000] cfg80211:   (5735000 KHz - 5835000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)
[    9.860000] usbcore: registered new interface driver usbfs
[    9.870000] usbcore: registered new interface driver hub
[    9.880000] usbcore: registered new device driver usb
[   10.630000] PPP generic driver version 2.4.2
[   10.640000] CPU 0 Unable to handle kernel paging request at virtual address 00000000, epc == 83087020, ra == 80160098
[   10.660000] Oops[#1]:
[   10.660000] Cpu 0
[   10.660000] $ 0   : 00000000 00000000 00000002 00000000
[   10.660000] $ 4   : 00000001 00000000 00000000 0000484b
[   10.660000] $ 8   : 00000000 80106470 00000000 00000000
[   10.660000] $12   : 00000019 801a0019 00000001 65762072
[   10.660000] $16   : 00000000 8383b28c 83084850 8306f000
[   10.660000] $20   : 0000000c 80292730 80230000 801ec054
[   10.660000] $24   : 00000000 80127c9c                  
[   10.660000] $28   : 830fe000 830ffd98 801ec074 80160098
[   10.660000] Hi    : 00000002
[   10.660000] Lo    : 00000000
[   10.660000] epc   : 83087020 0x83087020
[   10.660000]     Tainted: G           O
[   10.660000] ra    : 80160098 0x80160098
[   10.660000] Status: 1100a403    KERNEL EXL IE 
[   10.660000] Cause : 00800008
[   10.660000] BadVA : 00000000
[   10.660000] PrId  : 0001964c (MIPS 24KEc)
[   10.660000] Modules linked in: ppp_generic(+) slhc rt2800pci(O) rt2800lib(O) rt2x00soc(O) rt2x00pci(O) rt2x00lib(O) mac80211(O) usbcore usb_common nls_base crc_itu_t crc_ccitt eeprom_93cx6 cfg80211(O) compat(O) arc4 aes_generic crypto_algapi leds_gpio button_hotplug(O) gpio_keys_polled input_polldev input_core
[   10.660000] Process insmod (pid: 418, threadinfo=830fe000, task=839071e0, tls=77fb2440)
[   10.660000] Stack : 8391d7b8 00000000 00000000 83084850 00000000 80160098 83b47e40 83b43a00
[   10.660000]         00000000 80230000 83084850 00000000 83084850 80292a70 fffffff5 80230000
[   10.660000]         80260000 80160164 83080000 83087090 80260000 00000000 80230000 80230000
[   10.660000]         83087090 83084850 00000000 801601e0 83010010 00000004 83010000 830848d0
[   10.660000]         83080000 83087090 80260000 830870bc 830848d0 00000001 83084888 ffffffff
[   10.660000]         ...
[   10.660000] Call Trace:[&lt;80160098&gt;] 0x80160098
[   10.660000] [&lt;80160164&gt;] 0x80160164
[   10.660000] [&lt;83080000&gt;] 0x83080000
[   10.660000] [&lt;83087090&gt;] 0x83087090
[   10.660000] [&lt;83087090&gt;] 0x83087090
[   10.660000] [&lt;801601e0&gt;] 0x801601e0
[   10.660000] [&lt;83080000&gt;] 0x83080000
[   10.660000] [&lt;83087090&gt;] 0x83087090
[   10.660000] [&lt;830870bc&gt;] 0x830870bc
[   10.660000] [&lt;83087090&gt;] 0x83087090
[   10.660000] [&lt;80000900&gt;] 0x80000900
[   10.660000] [&lt;8006bc60&gt;] 0x8006bc60
[   10.660000] [&lt;8002e4f4&gt;] 0x8002e4f4
[   10.660000] [&lt;80041df0&gt;] 0x80041df0
[   10.660000] [&lt;800662bc&gt;] 0x800662bc
[   10.660000] [&lt;80008a84&gt;] 0x80008a84
[   10.660000] 
[   10.660000] 
[   10.660000] Code: 8c830214  10400003  24040001 &lt;8c640000&gt; 0082202b  00048036  24420001  00021080  00621821 
[   11.120000] ---[ end trace 6d1d71c0f4fc471d ]---
[   41.140000] ppp_async: gave up waiting for init of module ppp_generic.
[   41.150000] ppp_async: Unknown symbol ppp_channel_index (err -16)</code></pre></div><p>The BB build does not work at all; the results are pretty much the same as with dir-620 d1 image:<br/></p><div class="codebox"><pre><code>[    6.420000] jffs2: Further such events for this erase block will not be printed
[    6.540000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00130000: 0x2873 instead
[    6.560000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00130004: 0xc6c2 instead
[    6.580000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00130008: 0xb2a4 instead
[    6.600000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x0013000c: 0xe44a instead
[    6.620000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00130010: 0xaa2c instead
[    6.640000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00130014: 0x0818 instead
[    6.660000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00130018: 0xda90 instead
[    6.680000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x0013001c: 0x8a53 instead
[    6.700000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00130020: 0x60b0 instead
[    6.720000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00130024: 0x2953 instead
[    6.730000] jffs2: Further such events for this erase block will not be printed
[    6.860000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00140000: 0x9e18 instead
[    6.880000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00140004: 0xaf0b instead
[    6.890000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00140008: 0x6f74 instead
[    6.910000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x0014000c: 0x10f8 instead
[    6.930000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00140010: 0xdca7 instead
[    6.950000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00140014: 0x2772 instead
[    6.970000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00140018: 0xb6f8 instead
[    6.990000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x0014001c: 0xcaa1 instead
[    7.010000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00140020: 0x1c73 instead
[    7.030000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00140024: 0xf576 instead
[    7.050000] jffs2: Further such events for this erase block will not be printed
[    7.170000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00150000: 0xd66d instead
[    7.190000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00150004: 0xd3fc instead
[    7.210000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00150008: 0x4af0 instead
[    7.230000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x0015000c: 0xd70e instead
[    7.240000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00150010: 0x2884 instead
[    7.260000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00150014: 0x5e06 instead
[    7.280000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00150018: 0x3553 instead
[    7.300000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x0015001c: 0xa598 instead
[    7.320000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00150020: 0xbfe6 instead
[    7.340000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00150024: 0x1d2e instead
[    7.360000] jffs2: Further such events for this erase block will not be printed
[    7.480000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00160000: 0x2524 instead
[    7.500000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00160004: 0x93dd instead
[    7.520000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00160008: 0x3ad4 instead
[    7.540000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x0016000c: 0x0b6b instead
[    7.560000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00160010: 0x097b instead
[    7.580000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00160014: 0xdd9e instead
[    7.590000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00160018: 0xc8ec instead
[    7.610000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x0016001c: 0x603f instead
[    7.630000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00160020: 0xd7b3 instead
[    7.650000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00160024: 0xc07f instead
[    7.670000] jffs2: Further such events for this erase block will not be printed
[    7.790000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00170000: 0x43a6 instead
[    7.810000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00170004: 0x0920 instead
[    7.830000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00170008: 0xbcca instead
[    7.850000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x0017000c: 0x334c instead
[    7.870000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00170010: 0x021e instead
[    7.890000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00170014: 0xbe00 instead
[    7.910000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00170018: 0x59b1 instead
[    7.920000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x0017001c: 0xa52c instead
[    7.940000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00170020: 0x8298 instead
[    7.960000] jffs2: jffs2_scan_eraseblock(): Magic bitmask 0x1985 not found at 0x00170024: 0xd8f5 instead
[    7.980000] jffs2: Further such events for this erase block will not be printed
[    8.020000] jffs2: Empty flash at 0x00172b38 ends at 0x00173570
[    8.150000] jffs2: Cowardly refusing to erase blocks on filesystem with no valid JFFS2 nodes
[    8.170000] jffs2: empty_blocks 86, bad_blocks 0, c-&gt;nr_blocks 110
[    8.180000] VFS: Cannot open root device &quot;(null)&quot; or unknown-block(31,4): error -5
[    8.200000] Please append a correct &quot;root=&quot; boot option; here are the available partitions:
[    8.220000] 1f00             192 mtdblock0  (driver?)
[    8.230000] 1f01              64 mtdblock1  (driver?)
[    8.240000] 1f02              64 mtdblock2  (driver?)
[    8.250000] 1f03            7872 mtdblock3  (driver?)
[    8.260000] 1f04            7053 mtdblock4  (driver?)
[    8.270000] Kernel panic - not syncing: VFS: Unable to mount root fs on unknown-block(31,4)</code></pre></div><p>I&#039;m not quite much a programmer, but I&#039;ll have a look about the .dts -file. I guess the least what I can do is to modify the mtd -layout, as in /proc/mtd. Might as well need to change something else to have the image itself produced?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p246930">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">123serge123</div>
					<div class="post-datetime">
						13 Sep 2014, 13:09					</div>
				</div>
				<div class="post-content content">
					<p>I think that something wrong in your firmware installation procedure:<br/>1. AA custom don&#039;t use rt2800pci module but in your log it presents in crash dump (my build use compat-drivers-2014-05-22 for wifi).<br/>2. BB cann&#039;t find start of flash free space.<br/>It looks like&nbsp; old rootfs is used (from previous firmware installation).<br/>How do you install firmware exactly? Serial console or emergency recovery?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p246933">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">jama</div>
					<div class="post-datetime">
						13 Sep 2014, 13:55					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>Yes, you&#039;re correct.</p><p>Instead of flasing the image directly to the device, I tested it first by loading it to SDRAM, by choosing &#039;1&#039; from the u-boot menu.</p><p>Apparently, <strong>this was <span class="bbu">not</span> the correct approach</strong>.</p><p>By choosing &#039;2&#039;, and confirming the action by responding &#039;y&#039; to flash the image, I can confirm that both of the images do work.</p><p>And yes, I do have a serial console; I performed all the tasks over the serial console.</p><p>Could these patches/settings you made be included in BB, in order to have images for v2 in the future?</p><p>Thank you so much for your time, help and assistance. You&#039;re very kind.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p246934">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">123serge123</div>
					<div class="post-datetime">
						13 Sep 2014, 14:15					</div>
				</div>
				<div class="post-content content">
					<p>Before send patch to developers I&#039;d like&nbsp; you to do some additional check:<br/>1. leds and buttons (I take it from v1) works in v2 correctly.<br/>2. Does v2 have usb-port populated? In my dts-file it&#039;s enabled by default.<br/>3. Wifi work as expected.<br/>And now you can test BB rc3 without restriction, AA with possible crash of AA repo kernel modules.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p246940">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">jama</div>
					<div class="post-datetime">
						13 Sep 2014, 16:40					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><blockquote><p>1. leds and buttons (I take it from v1) works in v2 correctly.</p></blockquote></div><p><strong>Leds do work as expected;</strong></p><p>LAN &amp; WAN leds go on and off when connecting/disconnecting a cable, and blink during traffic.<br/>Wifi led goes on &amp; off when enabling/disabling Wifi via LuCI.<br/>Power led blinks during boot &amp; FW flash. Stays on after boot is completed.</p><p><strong>Some of the buttons do not work as expected;</strong></p><p>The LED button works, but it&#039;s only function is to turn off all the leds.</p><p>WLAN button does not work at all. It&#039;s function is to switch Wifi on and off, but nothing happens.<br/>Wifi can be enabled/disabled via LuCI regardless of the button position.</p><p>WPS button may not work. (And I have no means to test it, and I guess it&#039;s never implemented to OpenWRT?)</p><div class="quotebox"><blockquote><p>2. Does v2 have usb-port populated? In my dts-file it&#039;s enabled by default.</p></blockquote></div><p>It does. By inserting a usb stick to the port, a message is displayed to console, as well as logged to syslog:</p><div class="codebox"><pre><code>[  391.720000] usb 1-2: new full-speed USB device number 2 using ohci-platform

root@OpenWrt:/# dmesg | tail
[   25.810000] cfg80211:   (57240000 KHz - 65880000 KHz @ 2160000 KHz), (N/A, 4000 mBm), (N/A)
[   26.110000] br-lan: port 1(eth0.1) entered forwarding state
[   33.550000] IPv6: ADDRCONF(NETDEV_UP): wlan0: link is not ready
[   33.570000] device wlan0 entered promiscuous mode
[   33.610000] br-lan: port 2(wlan0) entered forwarding state
[   33.620000] br-lan: port 2(wlan0) entered forwarding state
[   33.630000] IPv6: ADDRCONF(NETDEV_CHANGE): wlan0: link becomes ready
[   35.620000] br-lan: port 2(wlan0) entered forwarding state
[  391.720000] usb 1-2: new full-speed USB device number 2 using ohci-platform
[  391.960000] usb 1-2: no of_node; not parsing pinctrl DT</code></pre></div><p>And that&#039;s all what happens.</p><div class="quotebox"><blockquote><p>3. Wifi work as expected.</p></blockquote></div><p><strong>Wifi works as expected;</strong></p><p>Wifi can be configured via LuCI, and a wireless device can receive an IP -address.<br/>The status of the connected wireless devices can be seen on LuCI.</p><div class="quotebox"><blockquote><p>And now you can test BB rc3 without restriction, AA with possible crash of AA repo kernel modules.</p></blockquote></div><p>Thanks, but I guess I&#039;ll stick with BB.</p><p>Kindly let me know if any additional information is needed. I&#039;ll do my best to help, and I&#039;ll reply as fast as I can.</p><p>Update:</p><p>I booted the device, and during the boot it asks you to specify debug level. I chose &#039;4&#039;.</p><p>After boot, by pressing the WPS -button, the following information is displayed:</p><div class="codebox"><pre><code>procd: hotplug_handler_debug(403): {{&quot;HOME&quot;:&quot;\/&quot;,&quot;PATH&quot;:&quot;\/sbin:\/bin:\/usr\/sbin:\/usr\/bin&quot;,&quot;SUBSYSTEM&quot;:&quot;button&quot;,&quot;ACTION&quot;:&quot;pressed&quot;,&quot;BUTTON&quot;:&quot;wps&quot;,&quot;SEEN&quot;:&quot;42949577&quot;,&quot;SEQNUM&quot;:&quot;387&quot;}}
procd: rule_handle_command(354): Command: execprocd: rule_handle_command(356):  /etc/rc.button/wpsprocd: rule_handle_command(357): 
procd: rule_handle_command(359): Message:procd: rule_handle_command(361):  HOME=/procd: rule_handle_command(361):  PATH=/sbin:/bin:/usr/sbin:/usr/binprocd: rule_handle_command(361):  SUBSYSTEM=buttonprocd: rule_handle_command(361):  ACTION=pressedprocd: rule_handle_command(361):  BUTTON=wpsprocd: rule_handle_command(361):  SEEN=42949577procd: rule_handle_command(361):  SEQNUM=387procd: rule_handle_command(362): 
procd: queue_next(280): Launched hotplug exec instance, pid=995
procd: rule_handle_command(354): Command: execprocd: rule_handle_command(356):  /sbin/hotplug-callprocd: rule_handle_command(356):  buttonprocd: rule_handle_command(357): 
procd: rule_handle_command(359): Message:procd: rule_handle_command(361):  HOME=/procd: rule_handle_command(361):  PATH=/sbin:/bin:/usr/sbin:/usr/binprocd: rule_handle_command(361):  SUBSYSTEM=buttonprocd: rule_handle_command(361):  ACTION=pressedprocd: rule_handle_command(361):  BUTTON=wpsprocd: rule_handle_command(361):  SEEN=42949577procd: rule_handle_command(361):  SEQNUM=387procd: rule_handle_command(362): 
procd: queue_proc_cb(285): Finished hotplug exec instance, pid=995
procd: queue_next(280): Launched hotplug exec instance, pid=996
procd: queue_proc_cb(285): Finished hotplug exec instance, pid=996
procd: hotplug_handler_debug(403): {{&quot;HOME&quot;:&quot;\/&quot;,&quot;PATH&quot;:&quot;\/sbin:\/bin:\/usr\/sbin:\/usr\/bin&quot;,&quot;SUBSYSTEM&quot;:&quot;button&quot;,&quot;ACTION&quot;:&quot;released&quot;,&quot;BUTTON&quot;:&quot;wps&quot;,&quot;SEEN&quot;:&quot;0&quot;,&quot;SEQNUM&quot;:&quot;388&quot;}}
procd: rule_handle_command(354): Command: execprocd: rule_handle_command(356):  /etc/rc.button/wpsprocd: rule_handle_command(357): 
procd: rule_handle_command(359): Message:procd: rule_handle_command(361):  HOME=/procd: rule_handle_command(361):  PATH=/sbin:/bin:/usr/sbin:/usr/binprocd: rule_handle_command(361):  SUBSYSTEM=buttonprocd: rule_handle_command(361):  ACTION=releasedprocd: rule_handle_command(361):  BUTTON=wpsprocd: rule_handle_command(361):  SEEN=0procd: rule_handle_command(361):  SEQNUM=388procd: rule_handle_command(362): 
procd: queue_next(280): Launched hotplug exec instance, pid=997
procd: rule_handle_command(354): Command: execprocd: rule_handle_command(356):  /sbin/hotplug-callprocd: rule_handle_command(356):  buttonprocd: rule_handle_command(357): 
procd: rule_handle_command(359): Message:procd: rule_handle_command(361):  HOME=/procd: rule_handle_command(361):  PATH=/sbin:/bin:/usr/sbin:/usr/binprocd: rule_handle_command(361):  SUBSYSTEM=buttonprocd: rule_handle_command(361):  ACTION=releasedprocd: rule_handle_command(361):  BUTTON=wpsprocd: rule_handle_command(361):  SEEN=0procd: rule_handle_command(361):  SEQNUM=388procd: rule_handle_command(362): 
procd: queue_proc_cb(285): Finished hotplug exec instance, pid=997
procd: queue_next(280): Launched hotplug exec instance, pid=998
procd: queue_proc_cb(285): Finished hotplug exec instance, pid=998</code></pre></div><p>Nothing is printed if you press WLAN or LED button.</p><p>I used BB all the time.</p>											<p class="post-edited">(Last edited by <strong>jama</strong> on 13 Sep 2014, 18:43)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p246963">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">123serge123</div>
					<div class="post-datetime">
						13 Sep 2014, 20:02					</div>
				</div>
				<div class="post-content content">
					<p>Base image need additional kernel modules to mount stick. So opkg update &amp;&amp; opkg install,<br/>at least kmod-scsi, kmod-sd_mod, kmod-usb-storage, kmod-fs-vfat, kmod-nls-cp1251 ( for me:))</p><p>leds:<br/>&quot;power&quot; - defined - works<br/>&quot;wps&quot; - defined - ?<br/>&quot;wifi&quot; - define - works<br/>Any other leds? usb?</p><p>button:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br/>&quot;reset&quot; - defined - ? - see /etc/rc.button - predefined action exists&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br/>&quot;wps&quot; - defined&nbsp; - works&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br/>&quot;wlan&quot; or &quot;rfkill&quot; - undefined - need to find - see /etc/rc.button - predefined action exists&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br/>&quot;led&quot; - undefined -&nbsp; works <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile"/> - possibly hardware button?&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br/>Any other?&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br/>Current state of leds and buttons<br/></p><div class="codebox"><pre><code>cat /sys/kernel/debug/gpio</code></pre></div><p>To check gpio if unreserved (e.g. gpio7)<br/>for led:<br/></p><div class="codebox"><pre><code>echo 7 &gt;/sys/class/gpio/export
echo out &gt;/sys/class/gpio/gpio7/direction
echo 1 &gt;&gt;/sys/class/gpio/gpio7/value</code></pre></div><p>for button:<br/>&quot;in&quot; to direction and see high/low current state while pressed/released<br/>Good luck!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p246979">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">jama</div>
					<div class="post-datetime">
						14 Sep 2014, 01:46					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><blockquote><p>Base image need additional kernel modules to mount stick. So opkg update &amp;&amp; opkg install,<br/>at least kmod-scsi, kmod-sd_mod, kmod-usb-storage, kmod-fs-vfat, kmod-nls-cp1251 ( for me:))</p></blockquote></div><p>Thanks. I installed the packages, and it worked like a charm. The system deteced the usb stick as in any other linux, and I was able to mount it.</p><br/><p>Regarding the leds: (from left to right, all leds in front panel)</p><p>power&nbsp; &nbsp; - works<br/>lan[1-4] - works<br/>wan&nbsp; &nbsp; &nbsp; - works<br/>wifi&nbsp; &nbsp; &nbsp;- works<br/>wan&nbsp; &nbsp; &nbsp; - works<br/>wps&nbsp; &nbsp; &nbsp; - does not work<br/>usb&nbsp; &nbsp; &nbsp; - does not work</p><p>Buttons:<br/></p><div class="codebox"><pre><code>root@OpenWrt:~# ls -al /etc/rc.button/
drwxr-xr-x    2 root     root            71 Aug 12 18:23 .
drwxr-xr-x    1 root     root             0 Sep 13 20:44 ..
-rwxr-xr-x    1 root     root            77 Aug  5 11:09 failsafe
-rwxr-xr-x    1 root     root            71 Aug  5 11:09 power
-rwxr-xr-x    1 root     root           281 Aug  5 11:09 reset
-rwxr-xr-x    1 root     root           522 Aug  5 11:09 rfkill</code></pre></div><p>reset&nbsp; &nbsp; - works; resets the device (and reboots)<br/>wps&nbsp; &nbsp; - the system is aware of the button, but nothing happens when pressed. (Debug dumps some info, however)<br/>wlan&nbsp; &nbsp; - is &#039;rfkill&#039;, as you already guessed. Nothing happens.<br/>led&nbsp; &nbsp; - I&#039;d say is nothing more than a hardware button.</p><p>No any other buttons.</p><div class="quotebox"><blockquote><p>for button:<br/>&quot;in&quot; to direction and see high/low current state while pressed/released<br/>Good luck!</p></blockquote></div><p>Current state of leds and buttons<br/></p><div class="codebox"><pre><code>root@OpenWrt:~# cat /sys/kernel/debug/gpio
GPIOs 0-23, platform/10000600.gpio, 10000600.gpio:
 gpio-0   (wps                 ) in  hi
 gpio-9   (nbg-419n:green:power) out lo
 gpio-10  (reset               ) in  hi
 gpio-14  (nbg-419n:green:wps  ) out hi</code></pre></div><p>And, if I press wps<br/></p><div class="codebox"><pre><code>root@OpenWrt:~# cat /sys/kernel/debug/gpio
GPIOs 0-23, platform/10000600.gpio, 10000600.gpio:
 gpio-0   (wps                 ) in  lo
 gpio-9   (nbg-419n:green:power) out lo
 gpio-10  (reset               ) in  hi
 gpio-14  (nbg-419n:green:wps  ) out hi</code></pre></div><div class="quotebox"><blockquote><p>To check gpio if unreserved (e.g. gpio7) for led:</p></blockquote></div><p>I ran the following scipt: (while usb stick in)<br/></p><div class="codebox"><pre><code>root@OpenWrt:~# i=0; while [ $i -lt 24 ] ; do echo -n &quot;$i : &quot; ; echo $i &gt;/sys/class/gpio/export ; i=`expr $i + 1` ; done ; echo
0 : ash: write error: Device or resource busy
1 : 2 : 3 : ash: write error: Invalid argument
4 : ash: write error: Invalid argument
5 : ash: write error: Invalid argument
6 : ash: write error: Invalid argument
7 : 8 : 9 : ash: write error: Device or resource busy
10 : ash: write error: Device or resource busy
11 : 12 : 13 : 14 : ash: write error: Device or resource busy
15 : ash: write error: Invalid argument
16 : ash: write error: Invalid argument
17 : 18 : 19 : 20 : 21 : 22 : 23 : </code></pre></div><p>syslog:<br/></p><div class="codebox"><pre><code>[   91.300000] rt2880-pinmux pinctrl.1: pin 3 is not set to gpio mux
[   91.310000] rt2880-pinmux pinctrl.1: request() failed for pin 3
[   91.330000] rt2880-pinmux pinctrl.1: pin-3 (pio:3) status -22
[   91.350000] rt2880-pinmux pinctrl.1: pin 4 is not set to gpio mux
[   91.360000] rt2880-pinmux pinctrl.1: request() failed for pin 4
[   91.370000] rt2880-pinmux pinctrl.1: pin-4 (pio:4) status -22
[   91.390000] rt2880-pinmux pinctrl.1: pin 5 is not set to gpio mux
[   91.410000] rt2880-pinmux pinctrl.1: request() failed for pin 5
[   91.420000] rt2880-pinmux pinctrl.1: pin-5 (pio:5) status -22
[   91.440000] rt2880-pinmux pinctrl.1: pin 6 is not set to gpio mux
[   91.450000] rt2880-pinmux pinctrl.1: request() failed for pin 6
[   91.470000] rt2880-pinmux pinctrl.1: pin-6 (pio:6) status -22
[   91.580000] rt2880-pinmux pinctrl.1: pin 15 is not set to gpio mux
[   91.590000] rt2880-pinmux pinctrl.1: request() failed for pin 15
[   91.600000] rt2880-pinmux pinctrl.1: pin-15 (pio:15) status -22
[   91.630000] rt2880-pinmux pinctrl.1: pin 16 is not set to gpio mux
[   91.640000] rt2880-pinmux pinctrl.1: request() failed for pin 16
[   91.650000] rt2880-pinmux pinctrl.1: pin-16 (pio:16) status -22</code></pre></div><p>Then<br/></p><div class="codebox"><pre><code>i=0; while [ $i -lt 24 ] ; do echo -n &quot;$i : &quot; ; echo out &gt;/sys/class/gpio/gpio$i/direction ; i=`expr $i + 1` ; done ; echo</code></pre></div><p>And pop; the usb led is on.</p><p>Which after<br/></p><div class="codebox"><pre><code>i=0; while [ $i -lt 24 ] ; do echo -n &quot;$i : &quot; ; echo 1 &gt;&gt;/sys/class/gpio/gpio$i/value ; i=`expr $i + 1` ; done ; echo</code></pre></div><p>Turns off the usb led.</p><p>No affect in any other leds - reagrdless of the state of the buttons.</p><p>Of which 13 is the usb led.</p><br/><p>syslog also contains the following:<br/></p><div class="codebox"><pre><code>[    5.600000] usb usb1: no of_node; not parsing pinctrl DT
[    5.600000] hub 1-0:1.0: no of_node; not parsing pinctrl DT
[    5.600000] hub 1-0:1.0: USB hub found
[    5.610000] hub 1-0:1.0: 2 ports detected
[    5.620000] leds-gpio gpio-leds.4: pins are not configured from the driver</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p246989">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">123serge123</div>
					<div class="post-datetime">
						14 Sep 2014, 07:05					</div>
				</div>
				<div class="post-content content">
					<p>So current state<br/>gpio: 0 - wps, 1, 2 , (3,4,5,6 - reserved SPI flash) 7,8, 9 - power, 10 - reset, 11, 12, 13 - usb led, 14 - wps led,<br/>(15,16 - reserved serial console),17,18,19,20,21,22,23</p><p>unknown: 1,2,7,8,11,12,17,18,19,20,21,22,23<br/>Switch all unknown into in-direction and see state while wlan-button pressed/released. I really want rfkill button <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile"/></p><p>check wps/usb led:<br/></p><div class="codebox"><pre><code>echo 1 &gt;/sys/class/leds/nbg-149n:green:wps/brightness
echo 1 &gt;/sys/class/leds/nbg-149n:green:usb/brightness</code></pre></div><p>Files updated:<br/>NBG-419N2.dts - add usb led<br/>openwrt-ramips-rt305x-nbg419v2-bb-rc3-squashfs-sysupgrade.v2.bin - only add usb led in kernel<br/>openwrt-ramips-rt305x-nbg419v2-bb-rc3-squashfs-sysupgrade.v3.bin - make changed in rootfs for&nbsp; wlan &amp; usb leds</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p247072">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">jama</div>
					<div class="post-datetime">
						15 Sep 2014, 00:08					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><blockquote><p>openwrt-ramips-rt305x-nbg419v2-bb-rc3-squashfs-sysupgrade.v2.bin - only add usb led in kernel</p></blockquote></div><div class="codebox"><pre><code>root@OpenWrt:/# echo 1 &gt;/sys/class/leds/nbg-149n:green:wps/brightness
/bin/ash: can&#039;t create /sys/class/leds/nbg-149n:green:wps/brightness: nonexistent directory
root@OpenWrt:/# echo 1 &gt;/sys/class/leds/nbg-149n:green:usb/brightness
/bin/ash: can&#039;t create /sys/class/leds/nbg-149n:green:usb/brightness: nonexistent directory

ls /sys/class/leds
nbg-419n:green:power     nbg-419n:green:wps       rt2800soc-phy0::quality
nbg-419n:green:usb       rt2800soc-phy0::assoc    rt2800soc-phy0::radio

root@OpenWrt:/# ls /sys/class/leds/nbg-419n:green:wps
brightness      max_brightness  trigger
device          subsystem       uevent

echo 1 &gt;/sys/class/leds/nbg-419n:green:usb/brightness</code></pre></div><p>Turns the usb led on. Inserting (and even mounting) a usb stick won&#039;t turn the led on.<br/></p><div class="codebox"><pre><code>echo 1 &gt;/sys/class/leds/nbg-419n:green:wps/brightness</code></pre></div><p>Turns the wps led on. Nothing happens if you press the wps button.</p><p>Enabling/disabling wifi via LuCI turns wlan led on/off (as well as the wifi itself....).</p><p>- - - - -<br/></p><div class="quotebox"><blockquote><p>openwrt-ramips-rt305x-nbg419v2-bb-rc3-squashfs-sysupgrade.v3.bin - make changed in rootfs for&nbsp; wlan &amp; usb leds</p></blockquote></div><div class="codebox"><pre><code>root@OpenWrt:/# echo 1 &gt;/sys/class/leds/nbg-149n:green:wps/brightness
bash: /sys/class/leds/nbg-149n:green:wps/brightness: No such file or directory
root@OpenWrt:/# echo 1 &gt;/sys/class/leds/nbg-149n:green:usb/brightness
bash: /sys/class/leds/nbg-149n:green:usb/brightness: No such file or directory

root@OpenWrt:/# ls /sys/class/leds
nbg-419n:green:power     nbg-419n:green:wps       rt2800soc-phy0::quality
nbg-419n:green:usb       rt2800soc-phy0::assoc    rt2800soc-phy0::radio

root@OpenWrt:/# ls /sys/class/leds/nbg-419n:green:wps
brightness      max_brightness  trigger
device          subsystem       uevent

echo 1 &gt;/sys/class/leds/nbg-419n:green:wps/brightness</code></pre></div><p>Turns the wps led on. Nothing happens if you press the wps button.<br/></p><div class="codebox"><pre><code>echo 1 &gt;/sys/class/leds/nbg-419n:green:usb/brightness</code></pre></div><p>Turns the usb led on. Inserting (and even mounting) a usb stick won&#039;t turn the led on.<br/></p><div class="codebox"><pre><code>echo 1 &gt; /sys/class/leds/rt2800soc-phy0::radio/brighteness</code></pre></div><p>Turns the wlan led on.</p><p>- - - - -<br/></p><div class="quotebox"><blockquote><p>openwrt-ramips-rt305x-nbg419v2-bb-rc3-squashfs-sysupgrade.v3.bin - make changed in rootfs for&nbsp; wlan &amp; usb leds</p><p>Switch all unknown into in-direction and see state while wlan-button pressed/released. I really want rfkill button</p></blockquote></div><div class="codebox"><pre><code>root@OpenWrt:~# for i in 1 2 7 8 11 12 17 18 19 20 21 22 23 ; do echo $i &gt;/sys/class/gpio/export ; done
root@OpenWrt:~# for i in 1 2 7 8 11 12 17 18 19 20 21 22 23 ; do echo in &gt;/sys/class/gpio/gpio$i/direction ; done</code></pre></div><p>WLAN button is &#039;ON&#039;, (button pressed) WIFI is ENABLED:<br/></p><div class="codebox"><pre><code>root@OpenWrt:~# for i in 1 2 7 8 11 12 17 18 19 20 21 22 23 ; do echo -n &quot;$i : &quot; ; cat /sys/class/gpio/gpio$i/value ; done ; echo
1 : 1
2 : 1
7 : 1
8 : 0
11 : 1
12 : 1
17 : 1
18 : 1
19 : 1
20 : 1
21 : 0
22 : 1
23 : 1</code></pre></div><p>WLAN button is &#039;OFF&#039;, (button released) WIFI is DISABLED:<br/></p><div class="codebox"><pre><code>root@OpenWrt:~# for i in 1 2 7 8 11 12 17 18 19 20 21 22 23 ; do echo -n &quot;$i : &quot; ; cat /sys/class/gpio/gpio$i/value ; done ; echo
1 : 1
2 : 1
7 : 1
8 : 0
11 : 1
12 : 0
17 : 1
18 : 1
19 : 1
20 : 1
21 : 0
22 : 1
23 : 1</code></pre></div><p>So, it&#039;s 12.....?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p247118">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">123serge123</div>
					<div class="post-datetime">
						15 Sep 2014, 18:36					</div>
				</div>
				<div class="post-content content">
					<p>Next test version <br/>openwrt-ramips-rt305x-nbg419v2-bb-rc3-squashfs-sysupgrade.v4.bin - added /etc/rc.button/wps script as sample (without real function, only on/off wps led), added rfkill button.<br/>BTW, wlan buttton has fixed position?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p247141">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">jama</div>
					<div class="post-datetime">
						15 Sep 2014, 22:28					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>LED and WLAN buttons both have fixed positions, so I guess those should be called on/off switches instead... <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink"/></p><p>A picture can describe more than a thousand words:</p><p>RESET push button, WLAN &amp; LED on/off switches:<br/><a href="http://www.zyxel.ch/assets/global/images/products/72/Back/ZyXEL_NBG-419-v2_7305.jpg">http://www.zyxel.ch/assets/global/image … 2_7305.jpg</a></p><p>WPS push button:<br/><a href="http://www.kiwi-electronics.nl/image/cache/data/products/netwerk/router/ZYX-NBG-419N-V2-2-800x533.jpg">http://www.kiwi-electronics.nl/image/ca … 00x533.jpg</a></p><p>The script for wps button does not work correctly. To test, I changed it to:<br/></p><div class="codebox"><pre><code>#!/bin/sh

logger &quot;${BUTTON} is ${ACTION}&quot;

#if [ &quot;${ACTION}&quot; = &quot;released&quot; ] then 
#       echo 0&gt;/sys/class/leds/nbg-419n:green:wps/brightness
#else 
        echo 1 &gt;/sys/class/leds/nbg-419n:green:wps/brightness
#fi </code></pre></div><p>which turns the led on, (but not off anymore).</p><p>Now the rfkill button need to pressed a few times before wifi stays enabled. (I guess the script interprets it as a push button.)<br/>LuCI is also able to determine the wifi status.</p><p>However, it looks that if wifi was enabled, then it will be enabled after reboot, even the button is switched to &#039;OFF&#039; position (in the u-boot section).<br/>By switching to ON first, and then OFF, the wifi will be diabled again.</p><p>The usb led does not lit if a usb stick is inserted to the usb port.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p247226">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">123serge123</div>
					<div class="post-datetime">
						16 Sep 2014, 20:39					</div>
				</div>
				<div class="post-content content">
					<p>openwrt-ramips-rt305x-nbg419v2-bb-rc3-squashfs-sysupgrade.v5.bin - fixed wlan switch I hope</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p247236">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">jama</div>
					<div class="post-datetime">
						16 Sep 2014, 22:16					</div>
				</div>
				<div class="post-content content">
					<p>Hello again, and thank you.</p><div class="quotebox"><blockquote><p>openwrt-ramips-rt305x-nbg419v2-bb-rc3-squashfs-sysupgrade.v5.bin - fixed wlan switch I hope</p></blockquote></div><p>I performed the following group of tests:</p><p>Power off the device. Switch WLAN button to &#039;OFF&#039; position. Connect power. Wait boot to complete. Switch WLAN button to &#039;ON&#039; position.<br/></p><div class="codebox"><pre><code>Please press Enter to activate this console.
[   12.390000] NET: Registered protocol family 10
[   12.420000] nf_conntrack version 0.5.0 (966 buckets, 3864 max)
[   12.440000] ip6_tables: (C) 2000-2006 Netfilter Core Team
[   12.480000] Linux video capture interface: v2.00
[   12.510000] Loading modules backported from Linux version master-2014-05-22-0-gf2032ea
[   12.520000] Backport generated by backports.git backports-20140320-37-g5c33da0
[   12.550000] ip_tables: (C) 2000-2006 Netfilter Core Team
[   12.600000] usbcore: registered new interface driver uvcvideo
[   12.620000] USB Video Class driver (1.1.1)
[   12.660000] xt_time: kernel timezone is -0000
[   12.720000] cfg80211: Calling CRDA to update world regulatory domain
[   12.770000] cfg80211: World regulatory domain updated:
[   12.780000] cfg80211:  DFS Master region: unset
[   12.780000] cfg80211:   (start_freq - end_freq @ bandwidth), (max_antenna_gain, max_eirp), (dfs_cac_time)
[   12.800000] cfg80211:   (2402000 KHz - 2472000 KHz @ 40000 KHz), (N/A, 2000 mBm), (N/A)
[   12.820000] cfg80211:   (2457000 KHz - 2482000 KHz @ 40000 KHz), (N/A, 2000 mBm), (N/A)
[   12.840000] cfg80211:   (2474000 KHz - 2494000 KHz @ 20000 KHz), (N/A, 2000 mBm), (N/A)
[   12.850000] cfg80211:   (5170000 KHz - 5250000 KHz @ 160000 KHz), (N/A, 2000 mBm), (N/A)
[   12.870000] cfg80211:   (5250000 KHz - 5330000 KHz @ 160000 KHz), (N/A, 2000 mBm), (0 s)
[   12.880000] cfg80211:   (5490000 KHz - 5730000 KHz @ 160000 KHz), (N/A, 2000 mBm), (0 s)
[   12.900000] cfg80211:   (5735000 KHz - 5835000 KHz @ 80000 KHz), (N/A, 2000 mBm), (N/A)
[   12.920000] cfg80211:   (57240000 KHz - 63720000 KHz @ 2160000 KHz), (N/A, 0 mBm), (N/A)
[   12.970000] PPP generic driver version 2.4.2
[   12.980000] NET: Registered protocol family 24
[   13.040000] ieee80211 phy0: rt2x00_set_rt: Info - RT chipset 3352, rev 0200 detected
[   13.050000] ieee80211 phy0: rt2x00_set_rf: Info - RF chipset 000c detected
[   17.090000] rt305x-esw 10110000.esw: link changed 0x00
[   18.730000] rt305x-esw 10110000.esw: link changed 0x11
procd: - init complete -
[   23.440000] device eth0.1 entered promiscuous mode
[   23.450000] device eth0 entered promiscuous mode
[   23.470000] br-lan: port 1(eth0.1) entered forwarding state
[   23.480000] br-lan: port 1(eth0.1) entered forwarding state
[   25.480000] br-lan: port 1(eth0.1) entered forwarding state



BusyBox v1.22.1 (2014-08-05 13:22:56 CEST) built-in shell (ash)
Enter &#039;help&#039; for a list of built-in commands.

  _______                     ________        __
 |       |.-----.-----.-----.|  |  |  |.----.|  |_
 |   -   ||  _  |  -__|     ||  |  |  ||   _||   _|
 |_______||   __|_____|__|__||________||__|  |____|
          |__| W I R E L E S S   F R E E D O M
 -----------------------------------------------------
 BARRIER BREAKER (14.07-rc3, r42056)
 -----------------------------------------------------
  * 1/2 oz Galliano         Pour all ingredients into
  * 4 oz cold Coffee        an irish coffee mug filled
  * 1 1/2 oz Dark Rum       with crushed ice. Stir.
  * 2 tsp. Creme de Cacao
 -----------------------------------------------------
root@OpenWrt:/# [  150.950000] IPv6: ADDRCONF(NETDEV_UP): wlan0: link is not ready
[  150.960000] device wlan0 entered promiscuous mode
[  151.000000] br-lan: port 2(wlan0) entered forwarding state
[  151.010000] br-lan: port 2(wlan0) entered forwarding state
[  151.020000] IPv6: ADDRCONF(NETDEV_CHANGE): wlan0: link becomes ready
[  153.010000] br-lan: port 2(wlan0) entered forwarding state
[  161.220000] device wlan0 left promiscuous mode
[  161.230000] br-lan: port 2(wlan0) entered disabled state
[  165.960000] IPv6: ADDRCONF(NETDEV_UP): wlan0: link is not ready
[  165.970000] device wlan0 entered promiscuous mode
[  166.010000] br-lan: port 2(wlan0) entered forwarding state
[  166.020000] br-lan: port 2(wlan0) entered forwarding state
[  166.030000] IPv6: ADDRCONF(NETDEV_CHANGE): wlan0: link becomes ready
[  168.020000] br-lan: port 2(wlan0) entered forwarding state</code></pre></div><p>It &#039;jumps&#039; a little, i.e. goes &#039;forwarding state&#039;, then &#039;disabled state&#039;, before finally staying at &#039;forwarding state&#039;.</p><p>Power off the device. Keep WLAN button in &#039;ON&#039; position. Power on the device.<br/></p><div class="codebox"><pre><code>Please press Enter to activate this console.
[   12.390000] NET: Registered protocol family 10
[   12.420000] nf_conntrack version 0.5.0 (966 buckets, 3864 max)
[   12.440000] ip6_tables: (C) 2000-2006 Netfilter Core Team
[   12.480000] Linux video capture interface: v2.00
[   12.510000] Loading modules backported from Linux version master-2014-05-22-0-gf2032ea
[   12.520000] Backport generated by backports.git backports-20140320-37-g5c33da0
[   12.550000] ip_tables: (C) 2000-2006 Netfilter Core Team
[   12.600000] usbcore: registered new interface driver uvcvideo
[   12.620000] USB Video Class driver (1.1.1)
[   12.660000] xt_time: kernel timezone is -0000
[   12.710000] cfg80211: Calling CRDA to update world regulatory domain
[   12.720000] cfg80211: World regulatory domain updated:
[   12.730000] cfg80211:  DFS Master region: unset
[   12.740000] cfg80211:   (start_freq - end_freq @ bandwidth), (max_antenna_gain, max_eirp), (dfs_cac_time)
[   12.760000] cfg80211:   (2402000 KHz - 2472000 KHz @ 40000 KHz), (N/A, 2000 mBm), (N/A)
[   12.780000] cfg80211:   (2457000 KHz - 2482000 KHz @ 40000 KHz), (N/A, 2000 mBm), (N/A)
[   12.790000] cfg80211:   (2474000 KHz - 2494000 KHz @ 20000 KHz), (N/A, 2000 mBm), (N/A)
[   12.810000] cfg80211:   (5170000 KHz - 5250000 KHz @ 160000 KHz), (N/A, 2000 mBm), (N/A)
[   12.820000] cfg80211:   (5250000 KHz - 5330000 KHz @ 160000 KHz), (N/A, 2000 mBm), (0 s)
[   12.840000] cfg80211:   (5490000 KHz - 5730000 KHz @ 160000 KHz), (N/A, 2000 mBm), (0 s)
[   12.860000] cfg80211:   (5735000 KHz - 5835000 KHz @ 80000 KHz), (N/A, 2000 mBm), (N/A)
[   12.870000] cfg80211:   (57240000 KHz - 63720000 KHz @ 2160000 KHz), (N/A, 0 mBm), (N/A)
[   12.970000] PPP generic driver version 2.4.2
[   12.990000] NET: Registered protocol family 24
[   13.040000] ieee80211 phy0: rt2x00_set_rt: Info - RT chipset 3352, rev 0200 detected
[   13.060000] ieee80211 phy0: rt2x00_set_rf: Info - RF chipset 000c detected
[   17.110000] rt305x-esw 10110000.esw: link changed 0x00
[   18.720000] rt305x-esw 10110000.esw: link changed 0x10
[   18.850000] rt305x-esw 10110000.esw: link changed 0x11
procd: - init complete -
[   23.470000] device eth0.1 entered promiscuous mode
[   23.480000] device eth0 entered promiscuous mode
[   23.500000] br-lan: port 1(eth0.1) entered forwarding state
[   23.510000] br-lan: port 1(eth0.1) entered forwarding state
[   25.510000] br-lan: port 1(eth0.1) entered forwarding state
[   30.840000] IPv6: ADDRCONF(NETDEV_UP): wlan0: link is not ready
[   30.860000] device wlan0 entered promiscuous mode
[   30.930000] br-lan: port 2(wlan0) entered forwarding state
[   30.940000] br-lan: port 2(wlan0) entered forwarding state
[   30.950000] IPv6: ADDRCONF(NETDEV_CHANGE): wlan0: link becomes ready
[   32.940000] br-lan: port 2(wlan0) entered forwarding state



BusyBox v1.22.1 (2014-08-05 13:22:56 CEST) built-in shell (ash)
Enter &#039;help&#039; for a list of built-in commands.

  _______                     ________        __
 |       |.-----.-----.-----.|  |  |  |.----.|  |_
 |   -   ||  _  |  -__|     ||  |  |  ||   _||   _|
 |_______||   __|_____|__|__||________||__|  |____|
          |__| W I R E L E S S   F R E E D O M
 -----------------------------------------------------
 BARRIER BREAKER (14.07-rc3, r42056)
 -----------------------------------------------------
  * 1/2 oz Galliano         Pour all ingredients into
  * 4 oz cold Coffee        an irish coffee mug filled
  * 1 1/2 oz Dark Rum       with crushed ice. Stir.
  * 2 tsp. Creme de Cacao
 -----------------------------------------------------
root@OpenWrt:/# </code></pre></div><p>It works fine.</p><p>Then,</p><p>While still powered on, switch WLAN button to &#039;OFF&#039; position. Wait a sec. Switch WLAN button to &#039;ON&#039; position.<br/></p><div class="codebox"><pre><code>root@OpenWrt:/# [  114.430000] device wlan0 left promiscuous mode
[  114.440000] br-lan: port 2(wlan0) entered disabled state
[  141.210000] IPv6: ADDRCONF(NETDEV_UP): wlan0: link is not ready
[  141.220000] device wlan0 entered promiscuous mode
[  141.260000] br-lan: port 2(wlan0) entered forwarding state
[  141.270000] br-lan: port 2(wlan0) entered forwarding state
[  141.280000] IPv6: ADDRCONF(NETDEV_CHANGE): wlan0: link becomes ready
[  143.270000] br-lan: port 2(wlan0) entered forwarding state
[  151.480000] device wlan0 left promiscuous mode
[  151.490000] br-lan: port 2(wlan0) entered disabled state
[  156.220000] IPv6: ADDRCONF(NETDEV_UP): wlan0: link is not ready
[  156.230000] device wlan0 entered promiscuous mode
[  156.270000] br-lan: port 2(wlan0) entered forwarding state
[  156.280000] br-lan: port 2(wlan0) entered forwarding state
[  156.290000] IPv6: ADDRCONF(NETDEV_CHANGE): wlan0: link becomes ready
[  158.280000] br-lan: port 2(wlan0) entered forwarding state</code></pre></div><p>So, the button works as it&#039;s supposed to work. Jumping is a minor issue, and can only be seen on console.</p><p>Now, if you want to be perfect, and nothing more than absolutely perfect, and you&#039;re most certain about it, keep reading. Otherwise, please close your eyes and hide from the evil world.</p><p>And, don&#039;t blame me. <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile"/> I don&#039;t work here. <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile"/> I have family to support. <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile"/> I&#039;m (still) too young to die. <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile"/></p><p>However, to test it in a bit more detail, I performed the following tests in order, while keeping the device powered on:</p><p>Turn Wifi OFF via LuCI, while button is set to &#039;ON&#039; position. -&gt; Wifi changes to &#039;disabled state&#039;.</p><p>Switch WLAN button to &#039;OFF&#039; position. -&gt; Wifi stays at &#039;disabled state&#039;.</p><p>Turn Wifi ON via LuCI, while button is set to &#039;OFF&#039; position. -&gt; Wifi changes to &#039;forwarding state&#039;.</p><p>Switch WLAN button to &#039;ON&#039; position. -&gt; Wifi changes to &#039;disabled state&#039; before returning to &#039;forwarding state&#039;. (As in dump above)</p><p>Turn Wifi OFF via LuCI, while button is set to &#039;ON&#039; position. -&gt; Wifi changes to &#039;disabled state&#039;.</p><p>Switch WLAN button to &#039;OFF&#039; position. -&gt; Wifi stays at &#039;disabled state&#039;.</p><p>Turn Wifi ON via LuCI, while button is set to &#039;OFF&#039; position. -&gt; Wifi changes to &#039;forwarding state&#039;.</p><p>Turn Wifi OFF via LuCI, while button is set to &#039;OFF&#039; position. -&gt; Wifi changes to &#039;disabled state&#039;.</p><p>Switch button to &#039;ON&#039; position. -&gt; Nothing happens. <strong>&lt;--- BUG</strong></p><p>So, there&#039;s some logical error.</p><p>I guess the only way to solve this would be reading the state of the WLAN button from registers, and act accordingly.</p><p>In <strong><span class="bbu">my</span></strong> opinion, the WLAN button state (on/off) should be honoured over LuCI. I.e., if the WLAN button is switched to &#039;ON&#039; position, then, and only then the wifi could be disabled/enabled via LuCI, and with command-line tools. Otherwise no. Also, regardelss of the situation, if the WLAN button is switched on, the wifi should be enabled as well.</p><p><strong>Update:</strong><br/>I rebooted the device while WLAN switch set to &#039;OFF&#039; position, and chose &#039;4&#039; as debug level.</p><p>When switching the WLAN to &#039;ON&#039; position, the following information is dumped to console:<br/></p><div class="codebox"><pre><code>procd: hotplug_handler_debug(403): {{&quot;HOME&quot;:&quot;\/&quot;,&quot;PATH&quot;:&quot;\/sbin:\/bin:\/usr\/sbin:\/usr\/bin&quot;,&quot;SUBSYSTEM&quot;:&quot;button&quot;,&quot;ACTION&quot;:&quot;pressed&quot;,&quot;BUTTON&quot;:&quot;rfkill&quot;,&quot;TYPE&quot;:&quot;switch&quot;,&quot;SEEN&quot;:&quot;54&quot;,&quot;SEQNUM&quot;:&quot;428&quot;}}
procd: rule_handle_command(354): Command: execprocd: rule_handle_command(356):  /etc/rc.button/rfkillprocd: rule_handle_command(357): 
procd: rule_handle_command(359): Message:procd: rule_handle_command(361):  HOME=/procd: rule_handle_command(361):  PATH=/sbin:/bin:/usr/sbin:/usr/binprocd: rule_handle_command(361):  SUBSYSTEM=buttonprocd: rule_handle_command(361):  ACTION=pressedprocd: rule_handle_command(361):  BUTTON=rfkillprocd: rule_handle_command(361):  TYPE=switchprocd: rule_handle_command(361):  SEEN=54procd: rule_handle_command(361):  SEQNUM=428procd: rule_handle_command(362): 
procd: queue_next(280): Launched hotplug exec instance, pid=1082
procd: rule_handle_command(354): Command: execprocd: rule_handle_command(356):  /sbin/hotplug-callprocd: rule_handle_command(356):  buttonprocd: rule_handle_command(357): 
procd: rule_handle_command(359): Message:procd: rule_handle_command(361):  HOME=/procd: rule_handle_command(361):  PATH=/sbin:/bin:/usr/sbin:/usr/binprocd: rule_handle_command(361):  SUBSYSTEM=buttonprocd: rule_handle_command(361):  ACTION=pressedprocd: rule_handle_command(361):  BUTTON=rfkillprocd: rule_handle_command(361):  TYPE=switchprocd: rule_handle_command(361):  SEEN=54procd: rule_handle_command(361):  SEQNUM=428procd: rule_handle_command(362): 
procd: queue_proc_cb(285): Finished hotplug exec instance, pid=1082
procd: queue_next(280): Launched hotplug exec instance, pid=1101
procd: queue_proc_cb(285): Finished hotplug exec instance, pid=1101
procd: hotplug_handler_debug(403): {{&quot;ACTION&quot;:&quot;remove&quot;,&quot;DEVPATH&quot;:&quot;\/devices\/10180000.wmac\/net\/wlan0\/queues\/tx-3&quot;,&quot;SUBSYSTEM&quot;:&quot;queues&quot;,&quot;SEQNUM&quot;:&quot;429&quot;}}
procd: hotplug_handler_debug(403): {{&quot;ACTION&quot;:&quot;remove&quot;,&quot;DEVPATH&quot;:&quot;\/devices\/10180000.wmac\/net\/wlan0\/queues\/tx-2&quot;,&quot;SUBSYSTEM&quot;:&quot;queues&quot;,&quot;SEQNUM&quot;:&quot;430&quot;}}
procd: hotplug_handler_debug(403): {{&quot;ACTION&quot;:&quot;remove&quot;,&quot;DEVPATH&quot;:&quot;\/devices\/10180000.wmac\/net\/wlan0\/queues\/tx-1&quot;,&quot;SUBSYSTEM&quot;:&quot;queues&quot;,&quot;SEQNUM&quot;:&quot;431&quot;}}
procd: hotplug_handler_debug(403): {{&quot;ACTION&quot;:&quot;remove&quot;,&quot;DEVPATH&quot;:&quot;\/devices\/10180000.wmac\/net\/wlan0\/queues\/tx-0&quot;,&quot;SUBSYSTEM&quot;:&quot;queues&quot;,&quot;SEQNUM&quot;:&quot;432&quot;}}
procd: hotplug_handler_debug(403): {{&quot;ACTION&quot;:&quot;remove&quot;,&quot;DEVPATH&quot;:&quot;\/devices\/10180000.wmac\/net\/wlan0&quot;,&quot;SUBSYSTEM&quot;:&quot;net&quot;,&quot;DEVTYPE&quot;:&quot;wlan&quot;,&quot;INTERFACE&quot;:&quot;wlan0&quot;,&quot;IFINDEX&quot;:&quot;3&quot;,&quot;SEQNUM&quot;:&quot;433&quot;}}
procd: rule_handle_command(354): Command: execprocd: rule_handle_command(356):  /sbin/hotplug-callprocd: rule_handle_command(356):  netprocd: rule_handle_command(357): 
procd: rule_handle_command(359): Message:procd: rule_handle_command(361):  ACTION=removeprocd: rule_handle_command(361):  DEVPATH=/devices/10180000.wmac/net/wlan0procd: rule_handle_command(361):  SUBSYSTEM=netprocd: rule_handle_command(361):  DEVTYPE=wlanprocd: rule_handle_command(361):  INTERFACE=wlan0procd: rule_handle_command(361):  IFINDEX=3procd: rule_handle_command(361):  SEQNUM=433procd: rule_handle_command(362): 
procd: queue_next(280): Launched hotplug exec instance, pid=1125
procd: queue_proc_cb(285): Finished hotplug exec instance, pid=1125
procd: hotplug_handler_debug(403): {{&quot;ACTION&quot;:&quot;add&quot;,&quot;DEVPATH&quot;:&quot;\/devices\/10180000.wmac\/net\/wlan0&quot;,&quot;SUBSYSTEM&quot;:&quot;net&quot;,&quot;DEVTYPE&quot;:&quot;wlan&quot;,&quot;INTERFACE&quot;:&quot;wlan0&quot;,&quot;IFINDEX&quot;:&quot;7&quot;,&quot;SEQNUM&quot;:&quot;434&quot;}}
procd: rule_handle_command(354): Command: execprocd: rule_handle_command(356):  /sbin/hotplug-callprocd: rule_handle_command(356):  netprocd: rule_handle_command(357): 
procd: rule_handle_command(359): Message:procd: rule_handle_command(361):  ACTION=addprocd: rule_handle_command(361):  DEVPATH=/devices/10180000.wmac/net/wlan0procd: rule_handle_command(361):  SUBSYSTEM=netprocd: rule_handle_command(361):  DEVTYPE=wlanprocd: rule_handle_command(361):  INTERFACE=wlan0procd: rule_handle_command(361):  IFINDEX=7procd: rule_handle_command(361):  SEQNUM=434procd: rule_handle_command(362): 
procd: queue_next(280): Launched hotplug exec instance, pid=1152
procd: hotplug_handler_debug(403): {{&quot;ACTION&quot;:&quot;add&quot;,&quot;DEVPATH&quot;:&quot;\/devices\/10180000.wmac\/net\/wlan0\/queues\/tx-0&quot;,&quot;SUBSYSTEM&quot;:&quot;queues&quot;,&quot;SEQNUM&quot;:&quot;435&quot;}}
procd: hotplug_handler_debug(403): {{&quot;ACTION&quot;:&quot;add&quot;,&quot;DEVPATH&quot;:&quot;\/devices\/10180000.wmac\/net\/wlan0\/queues\/tx-1&quot;,&quot;SUBSYSTEM&quot;:&quot;queues&quot;,&quot;SEQNUM&quot;:&quot;436&quot;}}
procd: hotplug_handler_debug(403): {{&quot;ACTION&quot;:&quot;add&quot;,&quot;DEVPATH&quot;:&quot;\/devices\/10180000.wmac\/net\/wlan0\/queues\/tx-2&quot;,&quot;SUBSYSTEM&quot;:&quot;queues&quot;,&quot;SEQNUM&quot;:&quot;437&quot;}}
procd: hotplug_handler_debug(403): {{&quot;ACTION&quot;:&quot;add&quot;,&quot;DEVPATH&quot;:&quot;\/devices\/10180000.wmac\/net\/wlan0\/queues\/tx-3&quot;,&quot;SUBSYSTEM&quot;:&quot;queues&quot;,&quot;SEQNUM&quot;:&quot;438&quot;}}
procd: queue_proc_cb(285): Finished hotplug exec instance, pid=1152</code></pre></div>											<p class="post-edited">(Last edited by <strong>jama</strong> on 16 Sep 2014, 22:46)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p247758">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">123serge123</div>
					<div class="post-datetime">
						22 Sep 2014, 18:21					</div>
				</div>
				<div class="post-content content">
					<p>Sorry, I was out for some days. Now I&#039;m back.<br/>But returning to our rams...<br/>All scenarios of use wlan-button may be simply inplemented in userspace and don&#039;t concern kernel configuration. I prefer software (Luci) way. As example think of case where no physical access (only remote access) to device.<br/>And finally if all works I&#039;ll make patch in two or three days.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p247784">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">jama</div>
					<div class="post-datetime">
						22 Sep 2014, 21:47					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>no problem at all. I hope you had time to relax, and fun.</p><p>In my opinion, everything works as supposed, except the USB led. It does not lit if something is inserted in the USB port.</p><p>However, and still, <strong>in <span class="bbu">my</span> opinion</strong>,</p><div class="quotebox"><blockquote><p>As example think of case where no physical access (only remote access) to device.</p></blockquote></div><p>Possess a security risk. Anyone having a remote access to the device, may turn the wifi on, regardless of the switch.</p><p><strong>But let&#039;s not make a big issue about this one. It&#039;s enough that people are aware of such possibility.</strong></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p247833">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">123serge123</div>
					<div class="post-datetime">
						23 Sep 2014, 16:18					</div>
				</div>
				<div class="post-content content">
					<p>Hmm..usb led...<br/> Just install kmod-ledtrig-usbdev<br/>Or <br/>openwrt-ramips-rt305x-nbg419v2-bb-rc3-squashfs-sysupgrade.v6.bin - kmod-ledtrig-usbdev added</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p247997">
				<div class="post-metadata">
					<div class="post-num">Post #21</div>
					<div class="post-author">jama</div>
					<div class="post-datetime">
						25 Sep 2014, 01:21					</div>
				</div>
				<div class="post-content content">
					<p>Hello, </p><p>and sorry for a bit late reply. Had some problems with the computer itself...</p><div class="quotebox"><blockquote><p>Just install kmod-ledtrig-usbdev</p></blockquote></div><p>Won&#039;t work ??<br/></p><div class="codebox"><pre><code>root@OpenWrt:/# opkg install kmod-ledtrig-usbdev
Package kmod-ledtrig-usbdev (3.10.49-1) installed in root is up to date.
Collected errors:
 * pkg_get_installed_files: Failed to open //usr/lib/opkg/info/kmod-ledtrig-usbdev.list: No such file or directory.</code></pre></div><p>???</p><div class="quotebox"><blockquote><p>openwrt-ramips-rt305x-nbg419v2-bb-rc3-squashfs-sysupgrade.v6.bin - kmod-ledtrig-usbdev added</p></blockquote></div><p>Does not work either.</p><p>In additition to this, I installed i.e.<br/></p><div class="codebox"><pre><code>opkg update
opkg install kmod-scsi-core kmod-scsi-generic kmod-sdhci kmod-fs-vfat kmod-usb-storage kmod-usb-storage-extras kmod-usb-core kmod-usb-ohci
opkg install kmod-nls-cp437 kmod-nls-iso8859-1
opkg install bash </code></pre></div><p>as usual, and the USB stick works, but the led won&#039;t lit.<br/></p><div class="codebox"><pre><code>[   92.940000] usb 1-2: new full-speed USB device number 2 using ohci-platform
[   93.180000] usb 1-2: no of_node; not parsing pinctrl DT
[   93.180000] usb-storage 1-2:1.0: no of_node; not parsing pinctrl DT
[   93.180000] usb-storage 1-2:1.0: USB Mass Storage device detected
[   93.210000] scsi0 : usb-storage 1-2:1.0
[   94.220000] scsi 0:0:0:0: Direct-Access     BUFFALO  ClipDrive        1.11 PQ: 0 ANSI: 2
[   94.240000] sd 0:0:0:0: no of_node; not parsing pinctrl DT
[   94.250000] sd 0:0:0:0: Attached scsi generic sg0 type 0
[   94.260000] sd 0:0:0:0: [sda] 1032192 512-byte logical blocks: (528 MB/504 MiB)
[   94.280000] sd 0:0:0:0: [sda] Write Protect is on
[   94.290000] sd 0:0:0:0: [sda] Mode Sense: 03 00 80 00
[   94.300000] sd 0:0:0:0: [sda] No Caching mode page found
[   94.310000] sd 0:0:0:0: [sda] Assuming drive cache: write through
[   94.360000] sd 0:0:0:0: [sda] No Caching mode page found
[   94.370000] sd 0:0:0:0: [sda] Assuming drive cache: write through
[   94.390000]  sda: sda1
[   94.440000] sd 0:0:0:0: [sda] No Caching mode page found
[   94.450000] sd 0:0:0:0: [sda] Assuming drive cache: write through
[   94.460000] sd 0:0:0:0: [sda] Attached SCSI removable disk
root@OpenWrt:/# mount /dev/sda1 /mnt
root@OpenWrt:/# ls /mnt/
DRIVERS                 Photos                  x.txt.txt
Documents</code></pre></div><p>??</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p248067">
				<div class="post-metadata">
					<div class="post-num">Post #22</div>
					<div class="post-author">123serge123</div>
					<div class="post-datetime">
						25 Sep 2014, 17:33					</div>
				</div>
				<div class="post-content content">
					<p>Please, check that ledtrig-usbdev is loaded. Then show /etc/config/system and<br/>cat /sys/class/leds/nbg-419n:green:usb/trigger<br/>cat /sys/class/leds/nbg-419n:green:usb/device_name</p><p>Must be:<br/>- system contain something like </p><div class="codebox"><pre><code>config led &#039;led_usb&#039;
option name &#039;USB&#039;
option sysfs &#039;nbg-419n:green:usb&#039;
option trigger &#039;usbdev&#039;
option dev &#039;1-1&#039;
option interval 50

config led &#039;led_wifi&#039;
option name &#039;wifi&#039;
option sysfs &#039;rt2800pci-phy0::radio&#039;
option trigger &#039;netdev&#039;
option dev &#039;wlan0&#039;
option mode &#039;link tx rx&#039;</code></pre></div><p>- trigger [usbdev]<br/>- device_name &quot;1-1&quot;</p><p>Else<br/>echo &quot;usbdev&quot; &gt; /sys/class/leds/nbg-419n:green:usb/trigger<br/>echo &quot;1-1&quot; &gt; /sys/class/leds/nbg-419n:green:usb/device_name<br/>(usb led must work upto reboot)<br/>add upper code to /etc/config/system and reboot if not present. (usb and wifi leds will work after reboot)</p><p>I hope it fix the problem.<br/>openwrt-ramips-rt305x-nbg419v2-bb-rc3-squashfs-sysupgrade.v7.bin - fixed kmod-ledtrig-usbdev add</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p248136">
				<div class="post-metadata">
					<div class="post-num">Post #23</div>
					<div class="post-author">jama</div>
					<div class="post-datetime">
						26 Sep 2014, 00:36					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><div class="quotebox"><blockquote><p>Please, check that ledtrig-usbdev is loaded. Then show /etc/config/system and<br/>cat /sys/class/leds/nbg-419n:green:usb/trigger<br/>cat /sys/class/leds/nbg-419n:green:usb/device_name</p></blockquote></div><div class="codebox"><pre><code>root@OpenWrt:/# lsmod |grep usb
ledtrig_usbdev          1952  0 
ums_usbat               7344  0 
usb_common              1160  1 usbcore
usb_storage            35976 10 ums_usbat
usbcore               107099 14 ums_usbat
root@OpenWrt:/#  lsmod |grep led
leds_gpio               2944  0 
ledtrig_usbdev          1952  0 </code></pre></div><div class="codebox"><pre><code>root@OpenWrt:/# cat /etc/config/system

config system
        option hostname &#039;OpenWrt&#039;
        option timezone &#039;UTC&#039;

config timeserver &#039;ntp&#039;
        list server &#039;0.openwrt.pool.ntp.org&#039;
        list server &#039;1.openwrt.pool.ntp.org&#039;
        list server &#039;2.openwrt.pool.ntp.org&#039;
        list server &#039;3.openwrt.pool.ntp.org&#039;
        option enable_server &#039;0&#039;

config led &#039;led_wifi_led&#039;
        option name &#039;wifi&#039;
        option sysfs &#039;rt2800pci-phy0::radio&#039;
        option trigger &#039;netdev&#039;
        option dev &#039;wlan0&#039;
        option mode &#039;link tx rx&#039;

config led &#039;led_usb&#039;
        option name &#039;USB&#039;
        option sysfs &#039;nbg-419n:green:usb&#039;
        option trigger &#039;usbdev&#039;
        option dev &#039;1-1&#039;
        option interval &#039;50&#039;</code></pre></div><div class="codebox"><pre><code>root@OpenWrt:/# cat /sys/class/leds/nbg-419n:green:usb/trigger
none pwmtimer timer default-on netdev [usbdev] phy0rx phy0tx phy0assoc phy0radio 
root@OpenWrt:/# cat /sys/class/leds/nbg-419n:green:usb/device_name
1-1</code></pre></div><p>Why the usbdev is in brackets....?<br/></p><div class="quotebox"><blockquote><p>echo &quot;usbdev&quot; &gt; /sys/class/leds/nbg-419n:green:usb/trigger<br/>echo &quot;1-1&quot; &gt; /sys/class/leds/nbg-419n:green:usb/device_name</p></blockquote></div><p>Produced nothing. The led won&#039;t lit.</p><p>I tried everything with both, v6 and v7, including several boots, even with the USB stick in during the reboots.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p248177">
				<div class="post-metadata">
					<div class="post-num">Post #24</div>
					<div class="post-author">123serge123</div>
					<div class="post-datetime">
						26 Sep 2014, 08:52					</div>
				</div>
				<div class="post-content content">
					<p>Change &quot;1-1&quot; to &quot;1-2&quot;.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p248266">
				<div class="post-metadata">
					<div class="post-num">Post #25</div>
					<div class="post-author">jama</div>
					<div class="post-datetime">
						27 Sep 2014, 14:02					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p><strong>I can confirm that the suggested methods work; <span class="bbu">the usb led works as expected.</span></strong></p><p>Insert a USB stick and issue:<br/></p><div class="codebox"><pre><code>root@(none):/# echo &quot;1-2&quot; &gt; /sys/class/leds/nbg-419n:green:usb/device_name</code></pre></div><p>and the USB light is lit.</p><p>Now, remove USB stick, and the led turns off.</p><p>Insert the USB stick again, and the led is lit.</p><p>In &#039;/etc/config/system&#039;, change:<br/></p><div class="codebox"><pre><code>config led &#039;led_usb&#039;
        option name &#039;USB&#039;
        option sysfs &#039;nbg-419n:green:usb&#039;
        option trigger &#039;usbdev&#039;
        option dev &#039;1-1&#039;
        option interval &#039;50&#039;</code></pre></div><p>to:<br/></p><div class="codebox"><pre><code>config led &#039;led_usb&#039;
        option name &#039;USB&#039;
        option sysfs &#039;nbg-419n:green:usb&#039;
        option trigger &#039;usbdev&#039;
        option dev &#039;1-2&#039;
        option interval &#039;50&#039;</code></pre></div><p>and remove the USB stick and reboot.</p><p>After the reboot, when inserting a USB stick, the usb led is lit, as well as turns off upon removal of the stick.</p><p>Done. Thanks.<br/>Have a nice weekend.</p>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 1 of 3</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=52666&amp;p=2.html">2</a></li><li><a href="viewtopic.php%3Fid=52666&amp;p=3.html">3</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>