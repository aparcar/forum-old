<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> TP-Link 1043ND - remote logging</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 28 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p174352">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">Mono</div>
					<div class="post-datetime">
						8 Aug 2012, 16:50					</div>
				</div>
				<div class="post-content content">
					<p>Hi!</p><p>First sorry for my bad English.</p><p>I have a TP-Link 1043ND router and I installed the Openwrt 10.03.1.<br />I have an Ubuntu server in the LAN.<br />I want to the router is logging to the Ubuntu server.</p><p>First I set the Ubuntu&#039;s rsyslogd to allow from anywhere the logging information. I think this is working because I become logging information from the router.<br />Second I going to the System/System/Logging menu and I put the IP address of the Ubuntu and I left the default port 514 and I choose the two loglevels: Debug</p><p>My problem is the following: </p><p>On the router I see many more log information than the Ubuntu server.<br />I see on the internet I can set in the /etc/config/system file manually the remote log server datas.<br />My config file is shown:<br />&quot;config &#039;system&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;zonename&#039; &#039;Europe/Budapest&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;timezone&#039; &#039;CET-1CEST,M3.5.0,M10.5.0/3&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;hostname&#039; &#039;Router&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;log_port&#039; &#039;514&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;log_ip&#039; &#039;192.168.1.107&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;conloglevel&#039; &#039;8&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;cronloglevel&#039; &#039;5&#039;<br />&quot;<br />I tried the loglevels on 7-7 but no changes. Of course if I set anything I rebooted after the router.</p><p>The difference is here.<br />------------------------------------------------------------------------------------------------------------------------<br />I get logs on the router on Luci or with the logread command:</p><p>Aug&nbsp; 8 15:02:12 Router user.info kernel: IMQ driver loaded successfully.<br />Aug&nbsp; 8 15:02:12 Router user.info kernel:&nbsp; &nbsp; &nbsp; &nbsp; Hooking IMQ before NAT on PREROUTING.<br />Aug&nbsp; 8 15:02:12 Router user.info kernel:&nbsp; &nbsp; &nbsp; &nbsp; Hooking IMQ after NAT on POSTROUTING.<br />Aug&nbsp; 8 15:02:12 Router user.info kernel: ohci_hcd: USB 1.1 &#039;Open&#039; Host Controller (OHCI) Driver<br />Aug&nbsp; 8 15:02:12 Router user.info kernel: uhci_hcd: USB Universal Host Controller Interface driver<br />Aug&nbsp; 8 15:02:12 Router user.info kernel: Initializing USB Mass Storage driver...<br />Aug&nbsp; 8 15:02:12 Router user.info kernel: scsi0 : SCSI emulation for USB Mass Storage devices<br />Aug&nbsp; 8 15:02:12 Router user.info kernel: usbcore: registered new interface driver usb-storage<br />Aug&nbsp; 8 15:02:12 Router user.info kernel: USB Mass Storage support registered.<br />Aug&nbsp; 8 15:02:12 Router user.debug kernel: usb-storage: device found at 2<br />Aug&nbsp; 8 15:02:12 Router user.debug kernel: usb-storage: waiting for device to settle before scanning<br />Aug&nbsp; 8 15:02:14 Router user.info kernel: cfg80211: Calling CRDA for country: HU<br />Aug&nbsp; 8 15:02:14 Router user.info kernel: cfg80211: Regulatory domain changed to country: HU<br />Aug&nbsp; 8 15:02:14 Router user.info kernel: cfg80211:&nbsp; &nbsp; &nbsp;(start_freq - end_freq @ bandwidth), (max_antenna_gain, max_eirp)<br />Aug&nbsp; 8 15:02:14 Router user.info kernel: cfg80211:&nbsp; &nbsp; &nbsp;(2402000 KHz - 2482000 KHz @ 40000 KHz), (N/A, 2000 mBm)<br />Aug&nbsp; 8 15:02:14 Router user.info kernel: cfg80211:&nbsp; &nbsp; &nbsp;(5170000 KHz - 5250000 KHz @ 40000 KHz), (N/A, 2000 mBm)<br />Aug&nbsp; 8 15:02:14 Router user.info kernel: cfg80211:&nbsp; &nbsp; &nbsp;(5250000 KHz - 5330000 KHz @ 40000 KHz), (N/A, 2000 mBm)<br />Aug&nbsp; 8 15:02:14 Router user.info kernel: cfg80211:&nbsp; &nbsp; &nbsp;(5490000 KHz - 5710000 KHz @ 40000 KHz), (N/A, 2700 mBm)<br />Aug&nbsp; 8 15:02:15 Router user.info sysinit: command failed: Invalid argument (-22)<br />Aug&nbsp; 8 15:02:15 Router daemon.info pppd[491]: PPP session is 195<br />Aug&nbsp; 8 15:02:15 Router daemon.info pppd[491]: Using interface pppoe-wan<br />Aug&nbsp; 8 15:02:15 Router daemon.notice pppd[491]: Connect: pppoe-wan &lt;--&gt; eth0.2<br />Aug&nbsp; 8 15:02:16 Router user.info kernel: device wlan0 entered promiscuous mode<br />Aug&nbsp; 8 15:02:16 Router user.info kernel: br-lan: port 2(wlan0) entering forwarding state<br />Aug&nbsp; 8 15:02:17 Router user.notice kernel: scsi 0:0:0:0: Direct-Access&nbsp; &nbsp; &nbsp;Kingston DT Micro&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PMAP PQ: 0 ANSI: 0 CCS<br />Aug&nbsp; 8 15:02:17 Router user.debug kernel: usb-storage: device scan complete<br />Aug&nbsp; 8 15:02:17 Router user.notice kernel: sd 0:0:0:0: [sda] 15356160 512-byte logical blocks: (7.86 GB/7.32 GiB)<br />Aug&nbsp; 8 15:02:17 Router user.notice kernel: sd 0:0:0:0: [sda] Write Protect is off<br />Aug&nbsp; 8 15:02:17 Router user.debug kernel: sd 0:0:0:0: [sda] Mode Sense: 23 00 00 00<br />Aug&nbsp; 8 15:02:17 Router user.err kernel: sd 0:0:0:0: [sda] Assuming drive cache: write through<br />Aug&nbsp; 8 15:02:17 Router user.err kernel: sd 0:0:0:0: [sda] Assuming drive cache: write through<br />Aug&nbsp; 8 15:02:17 Router user.info kernel:&nbsp; sda: sda1 sda2 sda3<br />Aug&nbsp; 8 15:02:17 Router user.err kernel: sd 0:0:0:0: [sda] Assuming drive cache: write through<br />Aug&nbsp; 8 15:02:17 Router user.notice kernel: sd 0:0:0:0: [sda] Attached SCSI removable disk<br />Aug&nbsp; 8 15:02:18 Router user.info kernel: yaffs: dev is 8388609 name is &quot;sda1&quot;<br />Aug&nbsp; 8 15:02:18 Router user.info kernel: yaffs: passed flags &quot;&quot;<br />Aug&nbsp; 8 15:02:18 Router user.warn kernel: yaffs: Attempting MTD mount on 8.1, &quot;sda1&quot;<br />Aug&nbsp; 8 15:02:18 Router user.info kernel: yaffs: dev is 8388609 name is &quot;sda1&quot;<br />Aug&nbsp; 8 15:02:18 Router user.info kernel: yaffs: passed flags &quot;&quot;<br />Aug&nbsp; 8 15:02:18 Router user.warn kernel: yaffs: Attempting MTD mount on 8.1, &quot;sda1&quot;<br />Aug&nbsp; 8 15:02:18 Router user.info kernel: device wlan0 left promiscuous mode<br />Aug&nbsp; 8 15:02:18 Router user.info kernel: br-lan: port 2(wlan0) entering disabled state<br />Aug&nbsp; 8 15:02:18 Router daemon.notice pppd[491]: PAP authentication succeeded<br />Aug&nbsp; 8 15:02:18 Router daemon.notice pppd[491]: peer from calling number 00:24:3E:12:5C:9A authorized<br />Aug&nbsp; 8 15:02:18 Router daemon.notice pppd[491]: local&nbsp; IP address 188.123.38.112<br />Aug&nbsp; 8 15:02:18 Router daemon.notice pppd[491]: remote IP address 10.0.0.1<br />Aug&nbsp; 8 15:02:18 Router daemon.notice pppd[491]: primary&nbsp; &nbsp;DNS address 194.120.47.3<br />Aug&nbsp; 8 15:02:18 Router daemon.notice pppd[491]: secondary DNS address 194.120.46.5<br />Aug&nbsp; 8 15:02:19 Router user.info kernel: device wlan0 entered promiscuous mode<br />Aug&nbsp; 8 15:02:19 Router user.info kernel: br-lan: port 2(wlan0) entering forwarding state<br />Aug&nbsp; 8 15:02:19 Router user.info kernel: EXT4-fs (sda2): mounted filesystem with ordered data mode<br />Aug&nbsp; 8 15:02:20 Router user.notice ifup: Enabling Router Solicitations on wan (pppoe-wan)<br />Aug&nbsp; 8 15:02:21 Router user.info sysinit: Loading defaults<br />Aug&nbsp; 8 15:02:21 Router user.info kernel: EXT4-fs (sda3): mounted filesystem with ordered data mode<br />Aug&nbsp; 8 15:02:21 Router user.info sysinit: Loading synflood protection<br />Aug&nbsp; 8 15:02:21 Router user.info sysinit: Adding custom chains<br />Aug&nbsp; 8 15:02:22 Router user.info sysinit: Loading zones<br />Aug&nbsp; 8 15:02:23 Router user.info sysinit: Loading forwardings<br />Aug&nbsp; 8 15:02:23 Router user.info sysinit: Loading redirects<br />Aug&nbsp; 8 15:02:23 Router user.info sysinit: Loading rules<br />Aug&nbsp; 8 15:02:24 Router user.info sysinit: Loading includes<br />Aug&nbsp; 8 15:02:24 Router user.info sysinit: Loading interfaces<br />Aug&nbsp; 8 15:02:24 Router user.info firewall: adding lan (br-lan) to zone lan<br />Aug&nbsp; 8 15:02:24 Router user.info firewall: adding wan (pppoe-wan) to zone wan<br />Aug&nbsp; 8 15:02:26 Router authpriv.info dropbear[1654]: Running in background<br />Aug&nbsp; 8 15:02:26 Router user.notice dnsmasq: DNS rebinding protection is active, will discard upstream RFC1918 responses!<br />Aug&nbsp; 8 15:02:30 Router daemon.info dnsmasq[1682]: started, version 2.55 cachesize 150<br />Aug&nbsp; 8 15:02:30 Router daemon.info dnsmasq[1682]: compile time options: IPv6 GNU-getopt no-DBus no-I18N DHCP TFTP<br />Aug&nbsp; 8 15:02:30 Router daemon.info dnsmasq-dhcp[1682]: DHCP, IP range 192.168.1.100 -- 192.168.1.120, lease time 12h<br />Aug&nbsp; 8 15:02:30 Router daemon.info dnsmasq[1682]: using local addresses only for domain lan<br />Aug&nbsp; 8 15:02:30 Router daemon.info dnsmasq[1682]: reading /tmp/resolv.conf.auto<br />Aug&nbsp; 8 15:02:30 Router daemon.info dnsmasq[1682]: using nameserver 194.120.47.3#53<br />Aug&nbsp; 8 15:02:30 Router daemon.info dnsmasq[1682]: using nameserver 194.120.46.5#53<br />Aug&nbsp; 8 15:02:30 Router daemon.info dnsmasq[1682]: using local addresses only for domain lan<br />Aug&nbsp; 8 15:02:30 Router daemon.info dnsmasq[1682]: read /etc/hosts - 1 addresses<br />Aug&nbsp; 8 15:02:30 Router daemon.info dnsmasq-dhcp[1682]: read /etc/ethers - 0 addresses<br />Aug&nbsp; 8 15:02:30 Router user.info sysinit: setting up led WLAN<br />Aug&nbsp; 8 15:02:30 Router user.info sysinit: setting up led USB<br />Aug&nbsp; 8 15:02:30 Router user.debug kernel: ar71xx-wdt: enabling watchdog timer<br />Aug&nbsp; 8 15:02:33 Router daemon.info dnsmasq-dhcp[1682]: DHCPDISCOVER(br-lan) 192.168.1.107 00:26:37:51:e3:63<br />Aug&nbsp; 8 15:02:33 Router daemon.info dnsmasq-dhcp[1682]: DHCPOFFER(br-lan) 192.168.1.107 00:26:37:51:e3:63<br />Aug&nbsp; 8 15:02:33 Router daemon.info dnsmasq-dhcp[1682]: DHCPREQUEST(br-lan) 192.168.1.107 00:26:37:51:e3:63<br />Aug&nbsp; 8 15:02:33 Router daemon.info dnsmasq-dhcp[1682]: DHCPACK(br-lan) 192.168.1.107 00:26:37:51:e3:63 MSI<br />Aug&nbsp; 8 15:03:41 Router daemon.info pppd[491]: System time change detected.<br />Aug&nbsp; 8 15:03:43 Router daemon.warn dnsmasq-dhcp[1682]: DHCP packet received on eth0.2 which has no address<br />Aug&nbsp; 8 15:04:00 Router daemon.info hostapd: wlan0: STA 2c:3c:4c:6c:32:40 IEEE 802.11: authenticated<br />Aug&nbsp; 8 15:04:00 Router daemon.info hostapd: wlan0: STA 2c:3c:4c:6c:32:40 IEEE 802.11: associated (aid 1)<br />Aug&nbsp; 8 15:04:00 Router daemon.info hostapd: wlan0: STA 2c:3c:4c:6c:32:40 WPA: pairwise key handshake completed (RSN)<br />Aug&nbsp; 8 15:04:00 Router daemon.info dnsmasq-dhcp[1682]: DHCPREQUEST(br-lan) 192.168.1.104 2c:3c:4c:6c:32:40<br />Aug&nbsp; 8 15:04:00 Router daemon.info dnsmasq-dhcp[1682]: DHCPACK(br-lan) 192.168.1.104 2c:3c:4c:6c:32:40 Mono-Acer-Wifi<br />Aug&nbsp; 8 15:07:41 Router authpriv.info dropbear[2522]: Child connection from 192.168.1.104:60194<br />Aug&nbsp; 8 15:07:50 Router authpriv.notice dropbear[2522]: Password auth succeeded for &#039;root&#039; from 192.168.1.104:60194<br />Aug&nbsp; 8 15:08:12 Router daemon.warn dnsmasq-dhcp[1682]: DHCP packet received on eth0.2 which has no address<br />Aug&nbsp; 8 15:08:16 Router daemon.warn dnsmasq-dhcp[1682]: DHCP packet received on eth0.2 which has no address<br />Aug&nbsp; 8 15:08:23 Router daemon.warn dnsmasq-dhcp[1682]: DHCP packet received on eth0.2 which has no address<br />Aug&nbsp; 8 15:08:39 Router daemon.warn dnsmasq-dhcp[1682]: DHCP packet received on eth0.2 which has no address<br />Aug&nbsp; 8 15:12:16 Router daemon.info hostapd: wlan0: STA 5d:1c:2c:6d:32:41 WPA: group key handshake completed (RSN)<br />------------------------------------------------------------------------------------------------------------------------</p><br /><br /><p>And the logs in this time interval:<br />------------------------------------------------------------------------------------------------------------------------<br />Aug&nbsp; 8 14:55:38 router.lan dnsmasq-dhcp[1823]: DHCP packet received on eth0.2 which has no address<br />Aug&nbsp; 8 15:02:05 router.lan dnsmasq-dhcp[1823]: DHCP packet received on eth0.2 which has no address<br />Aug&nbsp; 8 15:02:43 router.lan init: starting pid 5173, tty &#039;&#039;: &#039;/etc/init.d/rcS K stop&#039;<br />Aug&nbsp; 8 15:02:44 router.lan firewall: removing lan (br-lan) from zone lan<br />Aug&nbsp; 8 15:03:41 router.lan pppd[491]: System time change detected.<br />Aug&nbsp; 8 15:03:43 router.lan dnsmasq-dhcp[1682]: DHCP packet received on eth0.2 which has no address<br />Aug&nbsp; 8 15:04:00 router.lan hostapd: wlan0: STA 2c:3c:4c:6c:32:40 IEEE 802.11: authenticated<br />Aug&nbsp; 8 15:04:00 router.lan hostapd: wlan0: STA 2c:3c:4c:6c:32:40 IEEE 802.11: associated (aid 1)<br />Aug&nbsp; 8 15:04:00 router.lan hostapd: wlan0: STA 2c:3c:4c:6c:32:40 WPA: pairwise key handshake completed (RSN)<br />Aug&nbsp; 8 15:04:00 router.lan dnsmasq-dhcp[1682]: DHCPREQUEST(br-lan) 192.168.1.104 2c:3c:4c:6c:32:40<br />Aug&nbsp; 8 15:04:00 router.lan dnsmasq-dhcp[1682]: DHCPACK(br-lan) 192.168.1.104 2c:3c:4c:6c:32:40 Mono-Acer-Wifi<br />Aug&nbsp; 8 15:08:12 router.lan dnsmasq-dhcp[1682]: DHCP packet received on eth0.2 which has no address<br />Aug&nbsp; 8 15:12:16 router.lan hostapd: wlan0: STA 2c:3c:4c:6c:32:40 WPA: group key handshake completed (RSN)<br />Aug&nbsp; 8 15:14:41 router.lan dnsmasq-dhcp[1682]: DHCP packet received on eth0.2 which has no address<br />Aug&nbsp; 8 15:18:45 router.lan dnsmasq-dhcp[1682]: DHCPINFORM(br-lan) 192.168.1.104 2c:3c:4c:6c:32:40<br />Aug&nbsp; 8 15:18:45 router.lan dnsmasq-dhcp[1682]: DHCPACK(br-lan) 192.168.1.104 2c:3c:4c:6c:32:40 Mono-Acer-Wifi<br />------------------------------------------------------------------------------------------------------------------------</p><p>I can&#039;t see on the Ubuntu e.g. a success ssh login but I see the all DHCP info.</p><p>Do you have any idea? What is the problem?<br />Thanks!</p><br /><p>Edit:<br />Sorry but I found the problem. Ubuntu is separated the log informations depending on facility. I found all log data in the different log files. I created a new dedicated log file for the router and all router&#039;s log data going to this file.</p><p>Sorry Maybe will useful this for the another users.</p><p>Best regards,<br />Mono</p>											<p class="post-edited">(Last edited by <strong>Mono</strong> on 8 Aug 2012, 17:05)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>