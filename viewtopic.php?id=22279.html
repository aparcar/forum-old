<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> nslu2: telnet ok, but not ssh after password change</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 2 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p96268">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">lizby</div>
					<div class="post-datetime">
						23 Oct 2009, 03:36					</div>
				</div>
				<div class="post-content content">
					<p>I have 5 NSLU2s and have flashed them dozens of time, but I&#039;m having a problem now with trunk.&nbsp; I build openWrt (r18119), flash it, and can telnet in as usual.&nbsp; When I change the password and reboot and try to ssh in, I get &quot;Network error: connection refused&quot;.</p><p>I&#039;ve recompiled several times trying to strip down to the minimum, but get the same behaviour.&nbsp; I can successfully ping the device after ssh fails.</p><p>I can reflash the previous binary, backed up from prior modifications, and have no problem with ssh.&nbsp; </p><p>Below are the outputs of dmesg and ps.&nbsp; Any ideas about what my problem is?</p><p>-------------<br />ps output:<br /></p><div class="quotebox"><blockquote><p>PID USER&nbsp; &nbsp; &nbsp; &nbsp;VSZ STAT COMMAND<br />&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp; 1112 S&nbsp; &nbsp; init<br />&nbsp; &nbsp; 2 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&lt;&nbsp; [kthreadd]<br />&nbsp; &nbsp; 3 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&lt;&nbsp; [ksoftirqd/0]<br />&nbsp; &nbsp; 4 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&lt;&nbsp; [events/0]<br />&nbsp; &nbsp; 5 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&lt;&nbsp; [khelper]<br />&nbsp; &nbsp;42 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&lt;&nbsp; [kblockd/0]<br />&nbsp; &nbsp;68 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&nbsp; &nbsp;[pdflush]<br />&nbsp; &nbsp;69 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&nbsp; &nbsp;[pdflush]<br />&nbsp; &nbsp;70 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&lt;&nbsp; [kswapd0]<br />&nbsp; &nbsp;71 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&lt;&nbsp; [aio/0]<br />&nbsp; 603 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&lt;&nbsp; [mtdblockd]<br /> 1294 root&nbsp; &nbsp; &nbsp; 1112 S&nbsp; &nbsp; init<br /> 1315 root&nbsp; &nbsp; &nbsp; 1116 S&nbsp; &nbsp; syslogd -C16<br /> 1317 root&nbsp; &nbsp; &nbsp; 1096 S&nbsp; &nbsp; klogd<br /> 1329 root&nbsp; &nbsp; &nbsp; &nbsp;532 S&nbsp; &nbsp; /sbin/hotplug2 --override --persistent --set-worker /<br /> 1429 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&lt;&nbsp; [khubd]<br /> 1740 root&nbsp; &nbsp; &nbsp; 1100 S&nbsp; &nbsp; /usr/sbin/httpd -p 80 -h /www -r OpenWrt<br /> 1744 root&nbsp; &nbsp; &nbsp; 1104 S&nbsp; &nbsp; telnetd -l /bin/login.sh<br /> 1765 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SWN&nbsp; [jffs2_gcd_mtd5]<br /> 1795 root&nbsp; &nbsp; &nbsp; 1096 S&nbsp; &nbsp; watchdog -t 5 /dev/watchdog<br /> 1801 root&nbsp; &nbsp; &nbsp; &nbsp;892 S&nbsp; &nbsp; /usr/sbin/dropbear -p 22 -P /var/run/dropbear.1.pid<br /> 1803 root&nbsp; &nbsp; &nbsp; 1108 R&nbsp; &nbsp; /bin/ash --login<br /> 1811 root&nbsp; &nbsp; &nbsp; 1104 R&nbsp; &nbsp; ps</p></blockquote></div><p>-------------<br />dmesg output:<br /></p><div class="quotebox"><blockquote><p>=== IMPORTANT ============================<br />&nbsp; Use &#039;passwd&#039; to set your login password<br />&nbsp; this will disable telnet and enable SSH<br /> ------------------------------------------</p><br /><p>BusyBox v1.14.4 (2009-10-22 11:53:24 ADT) built-in shell (ash)<br />Enter &#039;help&#039; for a list of built-in commands.</p><p>&nbsp; _______&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;________&nbsp; &nbsp; &nbsp; &nbsp; __<br /> |&nbsp; &nbsp; &nbsp; &nbsp;|.-----.-----.-----.|&nbsp; |&nbsp; |&nbsp; |.----.|&nbsp; |_<br /> |&nbsp; &nbsp;-&nbsp; &nbsp;||&nbsp; _&nbsp; |&nbsp; -__|&nbsp; &nbsp; &nbsp;||&nbsp; |&nbsp; |&nbsp; ||&nbsp; &nbsp;_||&nbsp; &nbsp;_|<br /> |_______||&nbsp; &nbsp;__|_____|__|__||________||__|&nbsp; |____|<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |__| W I R E L E S S&nbsp; &nbsp;F R E E D O M<br /> KAMIKAZE (bleeding edge, r18119) ------------------<br />&nbsp; * 10 oz Vodka&nbsp; &nbsp; &nbsp; &nbsp;Shake well with ice and strain<br />&nbsp; * 10 oz Triple sec&nbsp; mixture into 10 shot glasses.<br />&nbsp; * 10 oz lime juice&nbsp; Salute!<br /> ---------------------------------------------------<br />root@OpenWrt:/# passwd<br />Changing password for root<br />New password:<br />Retype password:<br />Password for root changed by root<br />root@OpenWrt:/# dmesg<br />Linux version 2.6.28.10 (lb@eee-u) (gcc version 4.3.3 (GCC) ) #4 Thu Oct 22 19:57:15 ADT 2009<br />CPU: XScale-IXP42x Family [690541f1] revision 1 (ARMv5TE), cr=000039ff<br />CPU: VIVT data cache, VIVT instruction cache<br />Machine: Linksys NSLU2<br />Memory policy: ECC disabled, Data cache writeback<br />On node 0 totalpages: 8192<br />free_area_init_node: node 0, pgdat c021d330, node_mem_map c0233000<br />&nbsp; DMA zone: 64 pages used for memmap<br />&nbsp; DMA zone: 0 pages reserved<br />&nbsp; DMA zone: 8128 pages, LIFO batch:0<br />&nbsp; Normal zone: 0 pages used for memmap<br />&nbsp; Movable zone: 0 pages used for memmap<br />Built 1 zonelists in Zone order, mobility grouping on.&nbsp; Total pages: 8128<br />Kernel command line: root=/dev/mtdblock4 rootfstype=squashfs,jffs2 console=ttyS0,115200 init=/etc/preinit noinitrd<br />PID hash table entries: 128 (order: 7, 512 bytes)<br />Dentry cache hash table entries: 4096 (order: 2, 16384 bytes)<br />Inode-cache hash table entries: 2048 (order: 1, 8192 bytes)<br />Memory: 32MB = 32MB total<br />Memory: 30232KB available (1932K code, 181K data, 96K init)<br />Calibrating delay loop... 132.71 BogoMIPS (lpj=663552)<br />Mount-cache hash table entries: 512<br />CPU: Testing write buffer coherency: ok<br />net_namespace: 480 bytes<br />NET: Registered protocol family 16<br />IXP4xx: Using 16MiB expansion bus window size<br />NSLU2: Using MAC address 00:18:39:a6:25:ad for port 0<br />PCI: IXP4xx is host<br />PCI: IXP4xx Using direct access for memory space<br />pci 0000:00:01.0: reg 10 32bit mmio: [0x000000-0x000fff]<br />pci 0000:00:01.0: supports D1 D2<br />pci 0000:00:01.0: PME# supported from D0 D1 D2 D3hot<br />pci 0000:00:01.0: PME# disabled<br />pci 0000:00:01.1: reg 10 32bit mmio: [0x000000-0x000fff]<br />pci 0000:00:01.1: supports D1 D2<br />pci 0000:00:01.1: PME# supported from D0 D1 D2 D3hot<br />pci 0000:00:01.1: PME# disabled<br />pci 0000:00:01.2: reg 10 32bit mmio: [0x000000-0x0000ff]<br />pci 0000:00:01.2: supports D1 D2<br />pci 0000:00:01.2: PME# supported from D0 D1 D2 D3hot<br />pci 0000:00:01.2: PME# disabled<br />PCI: bus0: Fast back to back transfers disabled<br />pci 0000:00:01.0: dmabounce: registered device<br />pci 0000:00:01.1: dmabounce: registered device<br />pci 0000:00:01.2: dmabounce: registered device<br />i2c-gpio i2c-gpio.0: using pins 7 (SDA) and 6 (SCL)<br />NET: Registered protocol family 2<br />Switched to high resolution mode on CPU 0<br />IP route cache hash table entries: 1024 (order: 0, 4096 bytes)<br />TCP established hash table entries: 1024 (order: 1, 8192 bytes)<br />TCP bind hash table entries: 1024 (order: 0, 4096 bytes)<br />TCP: Hash tables configured (established 1024 bind 1024)<br />TCP reno registered<br />NET: Registered protocol family 1<br />IXP4xx Queue Manager initialized.<br />squashfs: version 3.0 (2006/03/15) Phillip Lougher<br />Registering mini_fo version $Id$<br />JFFS2 version 2.2. (NAND) (SUMMARY)&nbsp; Â© 2001-2006 Red Hat, Inc.<br />msgmni has been set to 59<br />io scheduler noop registered<br />io scheduler deadline registered (default)<br />Serial: 8250/16550 driver4 ports, IRQ sharing disabled<br />serial8250.0: ttyS0 at MMIO 0xc8000000 (irq = 15) is a XScale<br />console [ttyS0] enabled<br />serial8250.0: ttyS1 at MMIO 0xc8001000 (irq = 13) is a XScale<br />eth0: MII PHY 1 on NPE-B<br />IXP4XX-Flash.0: Found 1 x16 devices at 0x0 in 16-bit bank<br />IXP4XX-Flash.0: Found an alias at 0x800000 for the chip at 0x0<br /> Intel/Sharp Extended Query Table at 0x0031<br />Using buffer write method<br />cfi_cmdset_0001: Erase suspend on write enabled<br />erase region 0: offset=0x0,size=0x20000,blocks=64<br />Searching for RedBoot partition table in IXP4XX-Flash.0 at offset 0x7e0000<br />6 RedBoot partitions found on MTD device IXP4XX-Flash.0<br />Creating 6 MTD partitions on &quot;IXP4XX-Flash.0&quot;:<br />0x00000000-0x00040000 : &quot;RedBoot&quot;<br />0x00040000-0x00060000 : &quot;SysConf&quot;<br />0x00060000-0x00080000 : &quot;Loader&quot;<br />0x00080000-0x00180000 : &quot;Kernel&quot;<br />0x00180000-0x007e0000 : &quot;rootfs&quot;<br />mtd: partition &quot;rootfs&quot; set to be root filesystem<br />mtd: partition &quot;rootfs_data&quot; created automatically, ofs=2C0000, len=520000<br />0x002c0000-0x007e0000 : &quot;rootfs_data&quot;<br />0x007e0000-0x00800000 : &quot;FIS directory&quot;<br />rtc-x1205 0-006f: chip found, driver version 1.0.8<br />rtc-x1205 0-006f: rtc core: registered rtc-x1205 as rtc0<br />i2c /dev entries driver<br />IXP4xx Watchdog Timer: heartbeat 60 sec<br />Registered led device: nslu2:green:ready<br />Registered led device: nslu2:red:status<br />Registered led device: nslu2:green:disk-1<br />Registered led device: nslu2:green:disk-2<br />TCP westwood registered<br />NET: Registered protocol family 17<br />802.1Q VLAN Support v1.8 Ben Greear &lt;greearb@candelatech.com&gt;<br />All bugs added by David S. Miller &lt;davem@redhat.com&gt;<br />XScale DSP coprocessor detected.<br />rtc-x1205 0-006f: setting system clock to 1999-11-30 05:24:02 UTC (943939442)<br />VFS: Mounted root (squashfs filesystem) readonly.<br />Freeing init memory: 96K<br />Please be patient, while OpenWrt loads ...<br />mini_fo: using base directory: /<br />mini_fo: using storage directory: /jffs<br />net eth0: firmware: requesting NPE-B<br />NPE-B: firmware&#039;s license can be found in /usr/share/doc/LICENSE.IPL<br />NPE-B: firmware functionality 0x2, revision 0x2:1<br />eth0: link down<br />device eth0 entered promiscuous mode<br />SCSI subsystem initialized<br />usbcore: registered new interface driver usbfs<br />usbcore: registered new interface driver hub<br />eth0: link up, 100Mbps, full-duplex, lpa 0x4DE1<br />br-lan: topology change detected, propagating<br />br-lan: port 1(eth0) entering forwarding state<br />usbcore: registered new device driver usb<br />PPP generic driver version 2.4.2<br />ip_tables: (C) 2000-2006 Netfilter Core Team<br />NET: Registered protocol family 24<br />Driver &#039;sd&#039; needs updating - please use bus_type methods<br />ehci_hcd: USB 2.0 &#039;Enhanced&#039; Host Controller (EHCI) Driver<br />PCI: enabling device 0000:00:01.2 (0140 -&gt; 0142)<br />ehci_hcd 0000:00:01.2: EHCI Host Controller<br />ehci_hcd 0000:00:01.2: new USB bus registered, assigned bus number 1<br />ehci_hcd 0000:00:01.2: irq 26, io mem 0x48002000<br />ehci_hcd 0000:00:01.2: USB 2.0 started, EHCI 1.00<br />usb usb1: configuration #1 chosen from 1 choice<br />hub 1-0:1.0: USB hub found<br />hub 1-0:1.0: 5 ports detected<br />nf_conntrack version 0.5.0 (512 buckets, 2048 max)<br />usb 1-1: new high speed USB device using ehci_hcd and address 2<br />usb 1-1: configuration #1 chosen from 1 choice<br />ohci_hcd: USB 1.1 &#039;Open&#039; Host Controller (OHCI) Driver<br />PCI: enabling device 0000:00:01.0 (0140 -&gt; 0142)<br />ohci_hcd 0000:00:01.0: OHCI Host Controller<br />ohci_hcd 0000:00:01.0: new USB bus registered, assigned bus number 2<br />ohci_hcd 0000:00:01.0: irq 28, io mem 0x48000000<br />usb usb2: configuration #1 chosen from 1 choice<br />hub 2-0:1.0: USB hub found<br />hub 2-0:1.0: 3 ports detected<br />PCI: enabling device 0000:00:01.1 (0140 -&gt; 0142)<br />ohci_hcd 0000:00:01.1: OHCI Host Controller<br />ohci_hcd 0000:00:01.1: new USB bus registered, assigned bus number 3<br />ohci_hcd 0000:00:01.1: irq 27, io mem 0x48001000<br />usb usb3: configuration #1 chosen from 1 choice<br />hub 3-0:1.0: USB hub found<br />hub 3-0:1.0: 2 ports detected<br />usbcore: registered new interface driver usbserial<br />USB Serial support registered for generic<br />usb 3-1: new full speed USB device using ohci_hcd and address 2<br />usb 3-1: configuration #1 chosen from 1 choice<br />usbcore: registered new interface driver usbserial_generic<br />usbserial: USB Serial Driver core<br />Initializing USB Mass Storage driver...<br />usbcore: registered new interface driver usb-storage<br />USB Mass Storage support registered.<br />Linux video capture interface: v2.00<br />USB Serial support registered for ark3116<br />usbcore: registered new interface driver ark3116<br />USB Serial support registered for FTDI USB Serial Device<br />usbcore: registered new interface driver ftdi_sio<br />ftdi_sio: v1.4.3:USB FTDI Serial Converters Driver<br />USB Serial support registered for pl2303<br />pl2303 3-1:1.0: pl2303 converter detected<br />usb 3-1: pl2303 converter now attached to ttyUSB0<br />usbcore: registered new interface driver pl2303<br />pl2303: Prolific PL2303 USB to serial adaptor driver<br />uvcvideo: Found UVC 1.00 device &lt;unnamed&gt; (046d:0990)<br />usbcore: registered new interface driver uvcvideo<br />USB Video Class driver (v0.1.0)</p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p96270">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">mazilo</div>
					<div class="post-datetime">
						23 Oct 2009, 05:00					</div>
				</div>
				<div class="post-content content">
					<p>I am not sure what I had experienced through will help.</p><p>When I built an OpenWRT firmware stuffed with a lot of things for my FON2100 unit, I encountered the same problem you are facing. In my case, it turned out my FON2100 unit didn&#039;t have enough Flash space left for the system to change the password, but I was able to telnet in again without a password.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p96286">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">lizby</div>
					<div class="post-datetime">
						23 Oct 2009, 18:39					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for the response.&nbsp; I don&#039;t think that &quot;too full&quot; is the answer here--I&#039;ve pared back until when I telnet in, I have only 8% flash usage (versus 36% on the version where everything works except for no stty with which to set baud rate parameters).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p96292">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">lizby</div>
					<div class="post-datetime">
						23 Oct 2009, 22:30					</div>
				</div>
				<div class="post-content content">
					<p>Still failing with a minimal build.</p><p>I did &quot;make menuconfig&quot;, reset to defaults, changed to ixp4xx and NSLU2, unclicked dnsmasq, went into busybox and enabled stty, changed the IP, DNS, and Gateway addresses, exited saving the configuration, and ran &quot;make&quot;.&nbsp; I flashed the resulting squashfs file and successfully telneted in.&nbsp; I poke around and all looks ok to me.&nbsp; Flash usage is 7%.&nbsp; I change the password, reboot, and can&#039;t ssh in--still failing with&nbsp; &quot;Network error: connection refused&quot;. Ping still works.&nbsp; Telnet doesn&#039;t a second time.</p><p>I can reflash an old binary and ssh in with no problem.&nbsp; OpenWrt with the NSLU2 has always been a pain-free experience with me as far as re-flashing goes.&nbsp; Any ideas about fixing this problem would be appreciated.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p96478">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">lizby</div>
					<div class="post-datetime">
						27 Oct 2009, 21:30					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m chagrined to have to say that the cause of the problem was the typical one: &quot;user error&quot;.&nbsp; In the build I was reflashing from, I had reset the ssh address.&nbsp; When I reflashed, changed the password, and tried to ssh in by executing putty, it was trying to connect to that ip instead of the default.&nbsp; [Bangs forehead on keyboard.]</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>