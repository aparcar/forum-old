<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> How to get max throughput from small routers?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 19 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p308253">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">projects</div>
					<div class="post-datetime">
						19 Jan 2016, 23:04					</div>
				</div>
				<div class="post-content content">
					<p>Using the same test on three different platforms, the TP-Link never even gets close to what I should see.<br />The connection is a 50Mbs/5Mbs</p><p>This lead to wondering if there is a way of optimizing these little routers for throughput so I could get a better, closer bandwidth test result. </p><br /><p>Command: curl -o /dev/null <a href="http://speedtest.sea01.softlayer.com/downloads/test100.zip">http://speedtest.sea01.softlayer.com/do … est100.zip</a></p><p>Win7&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: 5453K<br />Linux&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: 6931K<br />Tp-Link 703: 2370k</p><br /><p>Win7; <br />&gt;curl <a href="http://speedtest.sea01.softlayer.com/downloads/test100.zip">http://speedtest.sea01.softlayer.com/do … est100.zip</a> -o NUL<br />&nbsp; % Total&nbsp; &nbsp; % Received % Xferd&nbsp; Average Speed&nbsp; &nbsp;Time&nbsp; &nbsp; Time&nbsp; &nbsp; &nbsp;Time&nbsp; Current<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Dload&nbsp; Upload&nbsp; &nbsp;Total&nbsp; &nbsp;Spent&nbsp; &nbsp; Left&nbsp; Speed<br />100&nbsp; 100M&nbsp; 100&nbsp; 100M&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0&nbsp; 5085k&nbsp; &nbsp; &nbsp; 0&nbsp; 0:00:20&nbsp; 0:00:20 --:--:-- 5453k</p><br /><p>Linux;<br /># curl -o /dev/null <a href="http://speedtest.sea01.softlayer.com/downloads/test100.zip">http://speedtest.sea01.softlayer.com/do … est100.zip</a><br />&nbsp; % Total&nbsp; &nbsp; % Received % Xferd&nbsp; Average Speed&nbsp; &nbsp;Time&nbsp; &nbsp; Time&nbsp; &nbsp; &nbsp;Time&nbsp; Current<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Dload&nbsp; Upload&nbsp; &nbsp;Total&nbsp; &nbsp;Spent&nbsp; &nbsp; Left&nbsp; Speed<br />100&nbsp; 100M&nbsp; 100&nbsp; 100M&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0&nbsp; 6296k&nbsp; &nbsp; &nbsp; 0&nbsp; 0:00:16&nbsp; 0:00:16 --:--:-- 6931k</p><br /><p>Openwrt TP-Link 703<br /># curl -o /dev/null <a href="http://speedtest.sea01.softlayer.com/downloads/test100.zip">http://speedtest.sea01.softlayer.com/do … est100.zip</a><br />&nbsp; % Total&nbsp; &nbsp; % Received % Xferd&nbsp; Average Speed&nbsp; &nbsp;Time&nbsp; &nbsp; Time&nbsp; &nbsp; &nbsp;Time&nbsp; Current<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Dload&nbsp; Upload&nbsp; &nbsp;Total&nbsp; &nbsp;Spent&nbsp; &nbsp; Left&nbsp; Speed<br />100&nbsp; 100M&nbsp; 100&nbsp; 100M&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0&nbsp; 2330k&nbsp; &nbsp; &nbsp; 0&nbsp; 0:00:43&nbsp; 0:00:43 --:--:-- 2370k</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p308257">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">eduperez</div>
					<div class="post-datetime">
						19 Jan 2016, 23:43					</div>
				</div>
				<div class="post-content content">
					<p>For best throughput, you need to use manufacturer firmware: OpenWrt does not offload packet handling to the hardware.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p308261">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">projects</div>
					<div class="post-datetime">
						20 Jan 2016, 00:09					</div>
				</div>
				<div class="post-content content">
					<p>Interesting conundrum <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" />. </p><p>I got rid of the factory firmware to run openwrt but would need the factory firmware to get the best throughput. </p><p>Guess it&#039;s not possible then.</p>											<p class="post-edited">(Last edited by <strong>projects</strong> on 20 Jan 2016, 00:10)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p308263">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">projects</div>
					<div class="post-datetime">
						20 Jan 2016, 00:20					</div>
				</div>
				<div class="post-content content">
					<p>The result is almost a third less. Would it be safe to triple the outcome to get some &#039;idea&#039;?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p308312">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">eduperez</div>
					<div class="post-datetime">
						20 Jan 2016, 12:27					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>projects wrote:</cite><blockquote><p>The result is almost a third less. Would it be safe to triple the outcome to get some &#039;idea&#039;?</p></blockquote></div><p>No, on some routers it can be worse, on others in can be better...</p><p>Problem is that the CPU in these routers is not capable of handling the packets fast enough, so the original firmware offloads some tasks to a specialized network chip; OpenWrt does all the handling in the CPU, and that is why it is slower. Obviously, each router has a different CPU and a different network chip; so there is no safe factor to get an idea.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p308315">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">occupymyday</div>
					<div class="post-datetime">
						20 Jan 2016, 12:40					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>eduperez wrote:</cite><blockquote><p>For best throughput, you need to use manufacturer firmware: OpenWrt does not offload packet handling to the hardware.</p></blockquote></div><p><a href="https://en.wikipedia.org/wiki/New_API">https://en.wikipedia.org/wiki/New_API</a></p><p>New API (also referred to as NAPI) is an interface to use interrupt mitigation techniques for networking devices in the Linux kernel. Such an approach is intended to reduce the overhead of packet receiving. The idea is to defer incoming message handling until there is a sufficient amount of them so that it is worth handling them all at once.</p>											<p class="post-edited">(Last edited by <strong>occupymyday</strong> on 20 Jan 2016, 12:43)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p308333">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">augustus_meyer</div>
					<div class="post-datetime">
						20 Jan 2016, 14:27					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><blockquote><p>New API (also referred to as NAPI) is an interface to use interrupt mitigation techniques for networking devices in the Linux kernel.</p></blockquote></div><p>Might be &quot;new&quot; for LINUX only. I wrote device drivers for some ancient OS, where this technique was the standard. I assume,&nbsp; &quot; interrupt mitigation&quot; means &quot;software interrupt mitigation&quot;. As opposed to &quot;hardware interrupt&quot;, which is to be handled by the &quot;interrupt service routine&quot;, which then might generate a &quot;software interrupt&quot; after stuffing the data (packet) into a buffer.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p308339">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">arokh</div>
					<div class="post-datetime">
						20 Jan 2016, 14:44					</div>
				</div>
				<div class="post-content content">
					<p>Are you running the test on the router itself? Try from a connected client instead. Using curl on the router and piping to a /dev node probably costs CPU and affect the speed.</p><p>@eduperez</p><p>I&#039;m pretty sure the WR703 has hw offloading, in any case it should be able to easily handle 50Mbps.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p308377">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">projects</div>
					<div class="post-datetime">
						20 Jan 2016, 20:03					</div>
				</div>
				<div class="post-content content">
					<p>&gt;Are you running the test on the router itself? Try from a connected client instead. </p><p>Yes, using the device as a small Linux device instead of as a router. It just gets a dhcp address and becomes just another device on the lan.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p308379">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">projects</div>
					<div class="post-datetime">
						20 Jan 2016, 20:04					</div>
				</div>
				<div class="post-content content">
					<p>Now I see conflicting replies. The device should be able to handle up to 50Mb/s and more?<br />Yet, running the same tests from these things always shows only a third of the results of any other devices on the same lan.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p308442">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">npkamen</div>
					<div class="post-datetime">
						21 Jan 2016, 05:28					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>projects wrote:</cite><blockquote><p>Now I see conflicting replies. The device should be able to handle up to 50Mb/s and more?<br />Yet, running the same tests from these things always shows only a third of the results of any other devices on the same lan.</p></blockquote></div><p>Did you try from another device as suggested?&nbsp; Connect the other device through the router and use it as a transport tool, not a computing tool.&nbsp; You should get better results.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p308485">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">projects</div>
					<div class="post-datetime">
						21 Jan 2016, 14:22					</div>
				</div>
				<div class="post-content content">
					<p>No, as I mentioned, there is no router software on this device, it is stripped of all that when I build. It is only a client, nothing else.</p>											<p class="post-edited">(Last edited by <strong>projects</strong> on 21 Jan 2016, 14:23)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p308496">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">danitool</div>
					<div class="post-datetime">
						21 Jan 2016, 16:39					</div>
				</div>
				<div class="post-content content">
					<p>Did you remove iptables kernel modules when you compiled your custom firmware?. It improves a bit the networking data transfer performance.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p308502">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">projects</div>
					<div class="post-datetime">
						21 Jan 2016, 17:07					</div>
				</div>
				<div class="post-content content">
					<p>This is pretty much my build. Since I&#039;m not using the device as a router, I should probably remove more and maybe add some things which might help throughput?</p><p>make image PROFILE=TLWR703 PACKAGES=&quot;libstdcpp ca-certificates libpthread bash curl kmod-ipv6 -dnsmasq -kmod-ath9k -uboot-envtools -wpad-mini -ppp -ppp-mod-pppoe -kmod-ppp -kmod-pppoe -kmod-usb-core -kmod-usb2 -kmod-ledtrig-usbdev -kmod-usb-ohci -kmod-usb-hid&quot; FILES=files/</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>