<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> HELP: complete firmware backup with software &amp; configuration files</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 1 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p209536">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">dreadycarpenter</div>
					<div class="post-datetime">
						11 Aug 2013, 23:24					</div>
				</div>
				<div class="post-content content">
					<p>I am looking to install a new openwrt firmware on my netgear wndr3800. I already have an older version of openwrt installed. I would like to do a complete firmware backup of my current setup, all applications and configuration files intact. I have read a couple of conflicting ways to do this.</p><p>one way is from<br /><a href="http://dangerzau.blogspot.com/2008/04/openwrt-backup-restore-so-youve-just.html">http://dangerzau.blogspot.com/2008/04/o … -just.html</a></p><p>dd if=/dev/mtd/1 of=/tmp/firmware.trx</p><p>another way is from<br /><a href="http://www.youtube.com/watch?v=fPjv1385mjA">http://www.youtube.com/watch?v=fPjv1385mjA</a><br />dd if=/dev/mtd0 of=/tmp/openwrt_sysbackup`date +%d%b%Y`.bin<br />dd if=/dev/mtd1 of=/tmp/openwrt_sysbackup`date +%d%b%Y`.bin<br />dd if=/dev/mtd2 of=/tmp/openwrt_sysbackup`date +%d%b%Y`.bin<br />dd if=/dev/mtd3 of=/tmp/openwrt_sysbackup`date +%d%b%Y`.bin<br />dd if=/dev/mtd4 of=/tmp/openwrt_sysbackup`date +%d%b%Y`.bin<br />dd if=/dev/mtd5 of=/tmp/openwrt_sysbackup`date +%d%b%Y`.bin<br />dd if=/dev/mtd6 of=/tmp/openwrt_sysbackup`date +%d%b%Y`.bin</p><br /><p>&quot;I would like a working way to backup my entire system to a flashable rom/firmware including all installed software packages &amp; configuration files&quot;<br />this is so I can install a newer version of openwrt with a newer kernel so I may install additional software packages that require a newer kernel.</p><p>I have also read a couple of other guides to do this, that only require some of the /dev/mtd partitions to be stacked in the bin file. </p><p>Questions:<br />1: Do I need to backup all mtd partitions? </p><p>2: if no, which ones will I need to backup to get a flashable firmware image with all software packages and configurations intact?</p><p>I know how to backup/restore my configuration and other needed files, I know how to get around directories, obtain, and flash a rom.</p><p>I am currently running:<br />OpenWrt Attitude Adjustment r33556 on a Netgear wndr3800 V2 (I think) with ar71xx</p><p>I would like to upgrade to this vesion:<br /><a href="http://downloads.openwrt.org/attitude_adjustment/12.09-rc2/ar71xx/generic/openwrt-ar71xx-generic-wndr3800-squashfs-sysupgrade.bin">http://downloads.openwrt.org/attitude_a … pgrade.bin</a></p><p>My current setup is important so if I run into problems I need to be able to easily reflash back to my current state as to avoid down time.</p>											<p class="post-edited">(Last edited by <strong>dreadycarpenter</strong> on 11 Aug 2013, 23:35)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p209537">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">dreadycarpenter</div>
					<div class="post-datetime">
						11 Aug 2013, 23:29					</div>
				</div>
				<div class="post-content content">
					<p>&quot;cat /proc/mtd&quot; generates this<br /><em><br />root@openwrt:~# cat /proc/mtd<br />dev:&nbsp; &nbsp; size&nbsp; &nbsp;erasesize&nbsp; name<br />mtd0: 00050000 00010000 &quot;u-boot&quot;<br />mtd1: 00020000 00010000 &quot;u-boot-env&quot;<br />mtd2: 00100000 00010000 &quot;kernel&quot;<br />mtd3: 00e80000 00010000 &quot;rootfs&quot;<br />mtd4: 00c90000 00010000 &quot;rootfs_data&quot;<br />mtd5: 00010000 00010000 &quot;art&quot;<br />mtd6: 00f80000 00010000 &quot;firmware&quot;<br /></em> </p><p>any help appreciated. cheers</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p209564">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						12 Aug 2013, 09:07					</div>
				</div>
				<div class="post-content content">
					<p>Why are you trying to update to an rc version of AA?<br />The final version is in <a href="http://downloads.openwrt.org/attitude_adjustment/12.09/ar71xx/generic/">http://downloads.openwrt.org/attitude_a … x/generic/</a></p><p>You should not worry too much about returning to the old version. I have been doing a community build for WNDR3700/3800 for almost three years, and Openwrt is very stable and works well with WNDR3700/3800. You might check: <a href="https://forum.openwrt.org/viewtopic.php?id=28392">https://forum.openwrt.org/viewtopic.php?id=28392</a></p><p>1)<br />Regarding your backup plans, they sound a bit complicated. I suggest a bit simpler backup plan. You are using the squashfs version that makes it rather simple.</p><p>There are two parts that you are interested of:<br />Flashed read-only &quot;ROM&quot;: The firmware itself that you have downloaded and flashed. If you have the original package on your PC, you can always reflash it.<br />Flash r/w &quot;RAM&quot;: All installed packages, all modified system files and all settings. With squashfs version, all modifications will get written in to /overlay directory. I contains a mirror of your file system tree with only those files that have been modified. It is usually seamlessy shown on top of the ROM files, so that you don&#039;t really notice it. </p><p>For backup purposes, it would be enough to copy all files from /overlay to a safe place. If you then need to recover, just reflash the needed firmware, boot into the router and copy those files back to /overlay and reboot. (Yeah, you need to maybe install a few packages to get the USB stick supported, but still rather easy).</p><p>2)<br />Alternative version for the upgrade path might be to backup all config settings and generate a list of installed add-on packages. Copy that list to your backup location. Then flash the new version, install packages using a script based on that list and restore the config settings.&nbsp; You might read this thread: <a href="https://forum.openwrt.org/viewtopic.php?pid=194478#p194478">https://forum.openwrt.org/viewtopic.php … 78#p194478</a></p><p>3)<br />Regarding the MTD sections, u-boot, u-boot-env and art are read-only and Openwrt does not touch them.</p>											<p class="post-edited">(Last edited by <strong>hnyman</strong> on 12 Aug 2013, 09:11)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p209597">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">dreadycarpenter</div>
					<div class="post-datetime">
						12 Aug 2013, 16:41					</div>
				</div>
				<div class="post-content content">
					<p>so none of my questions are answered,<br />are you saying I cannot do a complete firmware backup with all apps and data?</p><p><em>Questions:<br />1: Do I need to backup all mtd partitions?<br />2: if no, which ones will I need to backup to get a flashable firmware image with all software packages and configurations intact?</em></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p209601">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						12 Aug 2013, 17:21					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>dreadycarpenter wrote:</cite><blockquote><p>so none of my questions are answered,<br />are you saying I cannot do a complete firmware backup with all apps and data?</p><p><em>Questions:<br />1: Do I need to backup all mtd partitions?<br />2: if no, which ones will I need to backup to get a flashable firmware image with all software packages and configurations intact?</em></p></blockquote></div><p>No, I did not say that. I gave you the approach that I see as the easiest way to do the full backup, i.e. copy the contents of /overlay. I see no point in saving and then re-flashing also all the empty sectors, which you apparently insist doing. I a typical WNDR3800/WNDR3700v2 installation quite much of the flash is usually unused (unless you have crammed it full of packages).</p><p>To make you feel better, I try to answer your questions regarding the mtd approach...<br />1: No.<br />2: Like I already said in my previous answer, naturally you do not need the read-only parts, as those have never been modified by Openwrt. So you can forget about u-boot* and art.<br />Regarding the other mtd sections:<br />If you check the kernel log, you will notice that the mtd section adresses overlap eachother quite much. As far as I understand, you only need &quot;firmware&quot; 0x000000070000-0x000000ff0000, as both kernel and rootfs are covered by it. The r/w part of the live file system, rootfs_data is splitted away from rootfs itself, but is also included in that address space.</p><div class="codebox"><pre><code>[    2.900000] 0x000000000000-0x000000050000 : &quot;u-boot&quot;
[    2.900000] 0x000000050000-0x000000070000 : &quot;u-boot-env&quot;
[    2.910000] 0x000000070000-0x000000170000 : &quot;kernel&quot;
[    2.920000] 0x000000170000-0x000000ff0000 : &quot;rootfs&quot;
[    2.920000] mtd: partition &quot;rootfs&quot; set to be root filesystem
[    2.930000] mtd: partition &quot;rootfs_data&quot; created automatically, ofs=0x5e0000, len=0xa10000
[    2.940000] 0x0000005e0000-0x000000ff0000 : &quot;rootfs_data&quot;
[    2.940000] 0x000000ff0000-0x000001000000 : &quot;art&quot;
[    2.950000] 0x000000070000-0x000000ff0000 : &quot;firmware&quot;</code></pre></div>											<p class="post-edited">(Last edited by <strong>hnyman</strong> on 12 Aug 2013, 17:21)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p209608">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">gently</div>
					<div class="post-datetime">
						12 Aug 2013, 17:57					</div>
				</div>
				<div class="post-content content">
					<p>I guess topic starter is looking for a way to easily restore the router, doesn&#039;t matter which version is installed.<br />so when he decide to roll-back he would flash latest build, attach usb stick and overwrite all necessary partitions with all data he has at the moment, then reboot and it&#039;s done</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>