<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> How to achieve this design under CC 15.05.1 and LinkSys WRT1900AC V1</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 17 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p360097">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">magische_vogel</div>
					<div class="post-datetime">
						10 Jun 2017, 13:07					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>I have a LinkSys WRT1900AC V1 (Mamba) flashed with OpenWrt Chaos Calmer firmware version 15.05.1. <br />I want to create two networks (LAN interface + WIFI Interface) by splitting the switch into two seperated VLANs.</p><p>VLAN0 is used for bridging the LAN ports 2 ( Labelled externally port 2) and 3 ( Labelled externally port 1)<br />VLAN1 is used for bridging the LAN ports 0 ( Labelled externally port 4) and 1 ( Labelled externally port 3)<br />br0 is the bridge that the captive portal (CoovaChilli) will uses (Lan interface + Wifi Interface)<br />br1 is the bridge without captive portal (CoovaChilli) will uses (Lan interface + Wifi Interface)</p><p>At the end i should have two networks the first one is : <br />LAN0 + Wifi0 interfaces controlled by coovachilli to reach the internet<br />The second one is :<br />LAN1 interface without any restriction to reach the internet + Wifi1 interface controlled by WPA/WPA2 to reach the internet</p><p>Wrt1900AC-V1 Switch :</p><p>0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp;2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 3<br />4&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3&nbsp; &nbsp;2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1<br />&nbsp; \&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/&nbsp; &nbsp; &nbsp; &nbsp;\&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /<br />&nbsp; &nbsp;VLAN1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;VLAN0<br />&nbsp; &nbsp; &nbsp; &nbsp;|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |<br />&nbsp; +--br1--+&nbsp; &nbsp; &nbsp; &nbsp;+--br0--+<br />&nbsp; &nbsp; &nbsp; &nbsp;|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |<br />&nbsp; &nbsp; &nbsp; &nbsp;|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;CoovaChilli&gt;<br />&nbsp; &nbsp; &nbsp; &nbsp;|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |<br />&nbsp; &nbsp; &nbsp; &nbsp;|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tun0<br />&nbsp; &nbsp; &nbsp; &nbsp;|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |<br />&nbsp; +-------+&nbsp; &nbsp; +---------+ <br />&nbsp; &nbsp; &nbsp; &nbsp;|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | <br />&nbsp; &nbsp; &nbsp; &nbsp;&lt;userspace&gt;</p><p>Any hints, suggestions and help will be appreciated a lot.</p><p>Best regards</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p360133">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">Antek</div>
					<div class="post-datetime">
						10 Jun 2017, 22:22					</div>
				</div>
				<div class="post-content content">
					<p>Can you clarify what this &quot;Userspace&quot; is supposed to mean in your diagram? Do you mean the public Internet? Or some other network? Can you determine what is the CPU-facing port on your switch, and how many actual Ethernet NICs your router has?</p><p>To determine the last two, use &#039;swconfig&#039; and &#039;ifconfig&#039; tools. All interfaces with &#039;eth&#039; and a single number are usually unique Ethernet NICs.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p360140">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">magische_vogel</div>
					<div class="post-datetime">
						10 Jun 2017, 23:37					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Antek wrote:</cite><blockquote><p>Can you clarify what this &quot;Userspace&quot; is supposed to mean in your diagram? Do you mean the public Internet? Or some other network? Can you determine what is the CPU-facing port on your switch, and how many actual Ethernet NICs your router has?</p><p>To determine the last two, use &#039;swconfig&#039; and &#039;ifconfig&#039; tools. All interfaces with &#039;eth&#039; and a single number are usually unique Ethernet NICs.</p></blockquote></div><p>Hello Antek,</p><p>Thank you for your answer.<br />Userspace : wired and wireless devices used for internet connection depending on the selected network (LAN0+SSID0 or LAN1+SSID1), LAN0+SSID0 means public internet network, LAN1+SSID1 mean private internet network.&nbsp; <br />1. wired devices attached with br1 can access internet without any authentication and authorization system, but wireless devices attached with br1 should present valid WPA/WAP2 key to be able to access internet.<br />2. Wired and wireless devices attached to br0 must get authentication and authorization using captive portal system. <br />By the way i already installed mysql backend and freeradius AAA server and coovachilli under the OpenWrt system.<br />[img]h**p://routeragency.com/wp-content/uploads/2015/06/%E5%9B%BE%E7%89%871.png[/img]<br /></p><div class="codebox"><pre><code>root@OpenWrt:~# swconfig dev switch0 help
switch0: 1000000003.mvsw61xx(MV88E6172), ports: 7 (cpu @ 5), vlans: 64
     --switch
        Attribute 1 (int): enable_vlan (Enable 802.1q VLAN support)
        Attribute 2 (none): apply (Activate changes in the hardware)
        Attribute 3 (none): reset (Reset the switch)
     --vlan
        Attribute 1 (int): port_based (Use port-based (non-802.1q) VLAN only)
        Attribute 2 (int): vid (Get/set VLAN ID)
        Attribute 3 (ports): ports (VLAN port mapping)
     --port
        Attribute 1 (string): mask (Port-based VLAN mask)
        Attribute 2 (int): qmode (802.1q mode: 0=off/1=fallback/2=check/3=secure)
        Attribute 3 (string): status (Return port status)
        Attribute 4 (int): link (Get link speed)
        Attribute 5 (int): pvid (Primary VLAN ID)</code></pre></div><div class="codebox"><pre><code>root@OpenWrt:~# swconfig dev switch0 show
Global attributes:
        enable_vlan: 1
Port 0:
        mask: 0x0000: (0)
        qmode: 3
        status: link: down
        link: 0
        pvid: 1
Port 1:
        mask: 0x0000: (1)
        qmode: 3
        status: link: down
        link: 0
        pvid: 1
Port 2:
        mask: 0x0000: (2)
        qmode: 3
        status: link: down
        link: 0
        pvid: 1
Port 3:
        mask: 0x0000: (3)
        qmode: 3
        status: link: down
        link: 0
        pvid: 1
Port 4:
        mask: 0x0000: (4)
        qmode: 3
        status: link: up, speed: 100 Mbps, duplex: full
        link: 100
        pvid: 2
Port 5:
        mask: 0x0000: (5)
        qmode: 3
        status: link: up, speed: 1000 Mbps, duplex: full
        link: 1000
        pvid: 1
Port 6:
        mask: 0x0000: (6)
        qmode: 3
        status: link: up, speed: 1000 Mbps, duplex: full
        link: 1000
        pvid: 2
VLAN 1:
        port_based: 0
        vid: 1
        ports: 0 1 2 3 5
VLAN 2:
        port_based: 0
        vid: 2
        ports: 4 6</code></pre></div><div class="codebox"><pre><code>root@OpenWrt:~# ifconfig
br-lan    Link encap:Ethernet  HWaddr 94:10:3E:96:D8:86
          inet addr:192.168.1.1  Bcast:192.168.1.255  Mask:255.255.255.0
          inet6 addr: fe80::9610:3eff:fe96:d886/64 Scope:Link
          inet6 addr: fd23:a9f4:2714::1/60 Scope:Global
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:1792262 errors:0 dropped:0 overruns:0 frame:0
          TX packets:1816378 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:220633017 (210.4 MiB)  TX bytes:1573515062 (1.4 GiB)

br-wan    Link encap:Ethernet  HWaddr 96:10:3E:96:D8:86
          inet addr:192.168.2.2  Bcast:192.168.2.255  Mask:255.255.255.0
          inet6 addr: fe80::9410:3eff:fe96:d886/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:1638209 errors:0 dropped:0 overruns:0 frame:0
          TX packets:1631428 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:1500593285 (1.3 GiB)  TX bytes:224523654 (214.1 MiB)

eth0      Link encap:Ethernet  HWaddr 94:10:3E:96:D8:86
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:36707 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:532
          RX bytes:0 (0.0 B)  TX bytes:2847712 (2.7 MiB)
          Interrupt:26

eth1      Link encap:Ethernet  HWaddr 96:10:3E:96:D8:86
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:1867868 errors:0 dropped:0 overruns:0 frame:0
          TX packets:1628119 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:532
          RX bytes:1603185528 (1.4 GiB)  TX bytes:224105680 (213.7 MiB)
          Interrupt:27

lo        Link encap:Local Loopback
          inet addr:127.0.0.1  Mask:255.0.0.0
          inet6 addr: ::1/128 Scope:Host
          UP LOOPBACK RUNNING  MTU:65536  Metric:1
          RX packets:2987 errors:0 dropped:0 overruns:0 frame:0
          TX packets:2987 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:369228 (360.5 KiB)  TX bytes:369228 (360.5 KiB)

wlan0     Link encap:Ethernet  HWaddr 00:25:9C:13:8A:08
          inet6 addr: fe80::225:9cff:fe13:8a08/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:1733165 errors:0 dropped:0 overruns:0 frame:0
          TX packets:1792927 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:241956650 (230.7 MiB)  TX bytes:1565712505 (1.4 GiB)

wlan1     Link encap:Ethernet  HWaddr 00:25:9C:13:8A:09
          inet6 addr: fe80::225:9cff:fe13:8a09/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:32663 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:0 (0.0 B)  TX bytes:3144386 (2.9 MiB)</code></pre></div><p>best regards.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p360173">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">mk24</div>
					<div class="post-datetime">
						11 Jun 2017, 18:10					</div>
				</div>
				<div class="post-content content">
					<p>First create a br-guest and and a guest AP and get the captive portal it working with wifi.</p><p>Next log into your LAN wifi, using wifi is important in case you misconfigure the Ethernet switch you can still log in.</p><p>This is easier to do on LUCI.&nbsp; Go to the switch page.&nbsp; The default configuration is VLAN1 is the LAN ports going (untagged) to the cpu eth0 and VLAN2 is the WAN port going to cpu eth1.</p><p>Create a new VLAN 3.&nbsp; On port 5 (the CPU) make both 1 and 3 tagged.&nbsp; Turn off two of the external ports from VLAN 1 and put them untagged in VLAN 3.</p><p>Now that VLAN 1 is tagged to the CPU you have to set it that way in the lan bridge.&nbsp; Go to network interfaces lan physical settings and change it from eth0 to eth0.1.&nbsp; Then connect eth0.3 (the wired guest ports) to the guest network.</p><p>I&#039;m not sure about the 1900 eth0 may be eth1 and vice versa.&nbsp; Whichever cpu port is connected to the lan is what you should use for the guests (though you don&#039;t have to).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p360186">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">adri</div>
					<div class="post-datetime">
						11 Jun 2017, 23:32					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>mk24 wrote:</cite><blockquote><p>I&#039;m not sure about the 1900 eth0 may be eth1 and vice versa.&nbsp; Whichever cpu port is connected to the lan is what you should use for the guests (though you don&#039;t have to).</p></blockquote></div><p>On the WRT1x00 series, eth0 is the WAN port and eth1 is the cpu.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p360205">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">tapper</div>
					<div class="post-datetime">
						12 Jun 2017, 10:14					</div>
				</div>
				<div class="post-content content">
					<p>Hi LEDE 17.1.2 will give you better wifi on the 1900 AC.<br /><a href="https://lede-project.org/">https://lede-project.org/</a><br /><a href="https://downloads.lede-project.org/releases/17.01.2/targets/mvebu/generic/">https://downloads.lede-project.org/rele … u/generic/</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p360209">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">sera</div>
					<div class="post-datetime">
						12 Jun 2017, 11:54					</div>
				</div>
				<div class="post-content content">
					<p>adri,</p><p>both eth0 and eth1 are cpu ports connected to the switch and depending on kernel version are enumerated differently.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p360210">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">magische_vogel</div>
					<div class="post-datetime">
						12 Jun 2017, 12:02					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>adri wrote:</cite><blockquote><div class="quotebox"><cite>mk24 wrote:</cite><blockquote><p>I&#039;m not sure about the 1900 eth0 may be eth1 and vice versa.&nbsp; Whichever cpu port is connected to the lan is what you should use for the guests (though you don&#039;t have to).</p></blockquote></div><p>On the WRT1x00 series, eth0 is the WAN port and eth1 is the cpu.</p></blockquote></div><p>Hi Adri,</p><p>Depending on this link <br /><a href="http://ht*ps://wiki.openwrt.org/toh/linksys/wrt_ac_series">ht*ps://wiki.openwrt.org/toh/linksys/wrt_ac_series</a><br />The linkSys WRT1900AC v1 (Mamaba) specs are:<br />eth0 is the LAN (CPU@5 port), and eth1 is the WAN port. </p><p>Any one can correct me if i&#039;m wrong.</p><p>Best regards.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p360211">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">magische_vogel</div>
					<div class="post-datetime">
						12 Jun 2017, 12:15					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>mk24 wrote:</cite><blockquote><p>First create a br-guest and and a guest AP and get the captive portal it working with wifi.</p><p>Next log into your LAN wifi, using wifi is important in case you misconfigure the Ethernet switch you can still log in.</p><p>This is easier to do on LUCI.&nbsp; Go to the switch page.&nbsp; The default configuration is VLAN1 is the LAN ports going (untagged) to the cpu eth0 and VLAN2 is the WAN port going to cpu eth1.</p><p>Create a new VLAN 3.&nbsp; On port 5 (the CPU) make both 1 and 3 tagged.&nbsp; Turn off two of the external ports from VLAN 1 and put them untagged in VLAN 3.</p><p>Now that VLAN 1 is tagged to the CPU you have to set it that way in the lan bridge.&nbsp; Go to network interfaces lan physical settings and change it from eth0 to eth0.1.&nbsp; Then connect eth0.3 (the wired guest ports) to the guest network.</p><p>I&#039;m not sure about the 1900 eth0 may be eth1 and vice versa.&nbsp; Whichever cpu port is connected to the lan is what you should use for the guests (though you don&#039;t have to).</p></blockquote></div><p>Hi MK24,</p><p>Thank you for your answer.<br />Please can you show me the procedure to encsure the connection to my router even i misconfigure the ethernet switch. I think this step is the more important before making any changes to the switch device to avoid any access issues.<br />Best regards<br />By the way in the linksys 1900ac V1 the eth0 is the LAN and eth1 is the WAN reffering to openwrt website <a href="http://ht*ps://wiki.openwrt.org/toh/linksys/wrt_ac_series">ht*ps://wiki.openwrt.org/toh/linksys/wrt_ac_series</a></p><p>Best regards</p>											<p class="post-edited">(Last edited by <strong>magische_vogel</strong> on 12 Jun 2017, 12:15)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p360212">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">sera</div>
					<div class="post-datetime">
						12 Jun 2017, 12:15					</div>
				</div>
				<div class="post-content content">
					<p>magische_vogel,</p><p>the wiki is correct for all versions of OpenWrt.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p360216">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">Antek</div>
					<div class="post-datetime">
						12 Jun 2017, 13:08					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>magische_vogel wrote:</cite><blockquote><p>Please can you show me the procedure to encsure the connection to my router even i misconfigure the ethernet switch. I think this step is the more important before making any changes to the switch device to avoid any access issues.</p></blockquote></div><p>A wise man is precarious.</p><p>Here&#039;s my suggestion for a fall-back configuration. The strategy is to create a new, individual Wi-Fi access point with WPA2 encryption, and then ensure that the Dropbear SSH service is listening for connections on this interface and that firewall rules will permit access to the Dropbear server. It is the most bare-bones fail-safe system I can think of.</p><p>To perform this configuration, you need to have access to the SSH prompt. I use SSH prompt exclusively, so I cannot assist you in achieving this through LuCI.</p><p>To begin, add the following to your /etc/config/wireless to create a new Wi-Fi AP:<br /></p><div class="codebox"><pre><code># You should already have one of these. Do not change it, but observe the name.
config  wifi-device &#039;radio0&#039; 
   ... options of the wi-fi radio ...

# This is the new AP
config wifi-iface
   option device &#039;radio0&#039;  # Change &#039;radio0&#039; if required. It must match the wi-fi device
   option mode &#039;ap&#039;
   option encryption &#039;psk2&#039;
   option ssid &#039;OpenWRT_Failsafe&#039;
   option key &#039;MyPlaintextWPA2Key&#039; # Change this to whatever you feel appropriate
   option network &#039;OpenWRT_Failsafe&#039;</code></pre></div><p>Then create a new network interface by adding the following to /etc/config/network:</p><div class="codebox"><pre><code>config interface &#039;OpenWRT_Failsafe&#039;
   option proto &#039;static&#039;
   option ipaddr &#039;10.70.0.1&#039;   # I intentionally use an IP range which should not collide
   option netmask &#039;255.255.255.0&#039;
   option delegate &#039;0&#039;
   option ipv6 &#039;0&#039;</code></pre></div><p>Then enable DHCP on this new interface by adding the following to /etc/config/dhcp:</p><div class="codebox"><pre><code>config dhcp &#039;OpenWRT_Failsafe&#039;
   option interface &#039;OpenWRT_Failsafe&#039;
   option start &#039;50&#039;
   option limit &#039;10&#039;
   option leasetime &#039;2h&#039;</code></pre></div><p>Then create a new firewall zone for this interface by adding the following to /etc/config/firewall:</p><div class="codebox"><pre><code>config zone
   option name &#039;OpenWRT_Failsafe&#039;
   option input &#039;ACCEPT&#039;
   option output &#039;ACCEPT&#039;
   option forward &#039;REJECT&#039;
   option family &#039;ipv4&#039;
   option network &#039;OpenWRT_Failsafe&#039;</code></pre></div><p>Then ensure that Dropbear is listening on this interface by adding the following to /etc/config/dropbear:<br /></p><div class="codebox"><pre><code>config dropbear
   option Port &#039;22&#039;
   option Interface &#039;OpenWRT_Failsafe&#039;
   option PasswordAuth &#039;on&#039;
   option RootLogin &#039;on&#039;
   option RootPasswordAuth &#039;on&#039;</code></pre></div><p>Then issue the following commands:<br /></p><div class="codebox"><pre><code>/etc/init.d/network restart
/etc/init.d/firewall restart
/etc/init.d/dnsmasq restart
/etc/init.d/dropbear restart</code></pre></div><p>When restarting the &#039;network&#039; service, your currently open connection to the SSH server may be interrupted for a moment. </p><p>After restarting the services, ensure that the newly-created Wi-Fi AP is visible, you can connect to it and that you can reach the router through SSH when connected to the AP. The router&#039;s address in this network is 10.70.0.1.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p360247">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">magische_vogel</div>
					<div class="post-datetime">
						12 Jun 2017, 21:42					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Antek wrote:</cite><blockquote><div class="quotebox"><cite>magische_vogel wrote:</cite><blockquote><p>Please can you show me the procedure to encsure the connection to my router even i misconfigure the ethernet switch. I think this step is the more important before making any changes to the switch device to avoid any access issues.</p></blockquote></div><p>A wise man is precarious.</p><p>Here&#039;s my suggestion for a fall-back configuration. The strategy is to create a new, individual Wi-Fi access point with WPA2 encryption, and then ensure that the Dropbear SSH service is listening for connections on this interface and that firewall rules will permit access to the Dropbear server. It is the most bare-bones fail-safe system I can think of.</p><p>To perform this configuration, you need to have access to the SSH prompt. I use SSH prompt exclusively, so I cannot assist you in achieving this through LuCI.</p><p>To begin, add the following to your /etc/config/wireless to create a new Wi-Fi AP:<br /></p><div class="codebox"><pre><code># You should already have one of these. Do not change it, but observe the name.
config  wifi-device &#039;radio0&#039; 
   ... options of the wi-fi radio ...

# This is the new AP
config wifi-iface
   option device &#039;radio0&#039;  # Change &#039;radio0&#039; if required. It must match the wi-fi device
   option mode &#039;ap&#039;
   option encryption &#039;psk2&#039;
   option ssid &#039;OpenWRT_Failsafe&#039;
   option key &#039;MyPlaintextWPA2Key&#039; # Change this to whatever you feel appropriate
   option network &#039;OpenWRT_Failsafe&#039;</code></pre></div><p>Then create a new network interface by adding the following to /etc/config/network:</p><div class="codebox"><pre><code>config interface &#039;OpenWRT_Failsafe&#039;
   option proto &#039;static&#039;
   option ipaddr &#039;10.70.0.1&#039;   # I intentionally use an IP range which should not collide
   option netmask &#039;255.255.255.0&#039;
   option delegate &#039;0&#039;
   option ipv6 &#039;0&#039;</code></pre></div><p>Then enable DHCP on this new interface by adding the following to /etc/config/dhcp:</p><div class="codebox"><pre><code>config dhcp &#039;OpenWRT_Failsafe&#039;
   option interface &#039;OpenWRT_Failsafe&#039;
   option start &#039;50&#039;
   option limit &#039;10&#039;
   option leasetime &#039;2h&#039;</code></pre></div><p>Then create a new firewall zone for this interface by adding the following to /etc/config/firewall:</p><div class="codebox"><pre><code>config zone
   option name &#039;OpenWRT_Failsafe&#039;
   option input &#039;ACCEPT&#039;
   option output &#039;ACCEPT&#039;
   option forward &#039;REJECT&#039;
   option family &#039;ipv4&#039;
   option network &#039;OpenWRT_Failsafe&#039;</code></pre></div><p>Then ensure that Dropbear is listening on this interface by adding the following to /etc/config/dropbear:<br /></p><div class="codebox"><pre><code>config dropbear
   option Port &#039;22&#039;
   option Interface &#039;OpenWRT_Failsafe&#039;
   option PasswordAuth &#039;on&#039;
   option RootLogin &#039;on&#039;
   option RootPasswordAuth &#039;on&#039;</code></pre></div><p>Then issue the following commands:<br /></p><div class="codebox"><pre><code>/etc/init.d/network restart
/etc/init.d/firewall restart
/etc/init.d/dnsmasq restart
/etc/init.d/dropbear restart</code></pre></div><p>When restarting the &#039;network&#039; service, your currently open connection to the SSH server may be interrupted for a moment. </p><p>After restarting the services, ensure that the newly-created Wi-Fi AP is visible, you can connect to it and that you can reach the router through SSH when connected to the AP. The router&#039;s address in this network is 10.70.0.1.</p></blockquote></div><p>Hi Antek,</p><p>Thank you for your time and for your answer. I followed step by step the instructions you post. Unfortunately i&#039;m not able to access any configured wifi device now. When executing this command&nbsp; </p><div class="codebox"><pre><code>/etc/init.d/firewall restart</code></pre></div><p> i&#039;m getting this output:<br /></p><div class="codebox"><pre><code>root@OpenWrt:~# /etc/init.d/firewall restart
Warning: Unable to locate ipset utility, disabling ipset support
Warning: Section @zone[1] (OW_Failsafe) cannot resolve device of network &#039;OW_Failsafe&#039;
Warning: Section @zone[1] (OW_Failsafe) has no device, network, subnet or extra options
 * Flushing IPv4 filter table
 * Flushing IPv4 nat table
 * Flushing IPv4 mangle table
 * Flushing IPv4 raw table
 * Flushing IPv6 filter table
 * Flushing IPv6 mangle table
 * Flushing IPv6 raw table
 * Flushing conntrack table ...
 * Populating IPv4 filter table
   * Zone &#039;lan&#039;
   * Zone &#039;OW_Failsafe&#039;
   * Zone &#039;wan&#039;
   * Rule &#039;Allow-DHCP-Renew&#039;
   * Rule &#039;Allow-Ping&#039;
   * Rule &#039;Allow-IGMP&#039;
   * Rule #7
   * Rule #8
   * Forward &#039;lan&#039; -&gt; &#039;wan&#039;
 * Populating IPv4 nat table
   * Zone &#039;lan&#039;
   * Zone &#039;OW_Failsafe&#039;
   * Zone &#039;wan&#039;
 * Populating IPv4 mangle table
   * Zone &#039;lan&#039;
   * Zone &#039;OW_Failsafe&#039;
   * Zone &#039;wan&#039;
 * Populating IPv4 raw table
   * Zone &#039;lan&#039;
   * Zone &#039;OW_Failsafe&#039;
   * Zone &#039;wan&#039;
 * Populating IPv6 filter table
   * Zone &#039;lan&#039;
   * Zone &#039;wan&#039;
   * Rule &#039;Allow-DHCPv6&#039;
   * Rule &#039;Allow-MLD&#039;
   * Rule &#039;Allow-ICMPv6-Input&#039;
   * Rule &#039;Allow-ICMPv6-Forward&#039;
   * Rule #7
   * Rule #8
   * Forward &#039;lan&#039; -&gt; &#039;wan&#039;
 * Populating IPv6 mangle table
   * Zone &#039;lan&#039;
   * Zone &#039;wan&#039;
 * Populating IPv6 raw table
   * Zone &#039;lan&#039;
   * Zone &#039;wan&#039;
 * Set tcp_ecn to off
 * Set tcp_syncookies to on
 * Set tcp_window_scaling to on
 * Running script &#039;/etc/firewall.user&#039;
root@OpenWrt:~#</code></pre></div><p>In luci /network/inerfaces i see this:<br /></p><div class="codebox"><pre><code>Status Unsupported protocol type.
Install protocol extensions...</code></pre></div><p>With no possibility to edit the new interface from luci.<br />To make things more clearer for you here is the content of my network file:<br /></p><div class="codebox"><pre><code>root@OpenWrt:~# vi /etc/config/network

config interface &#039;loopback&#039;
        option ifname &#039;lo&#039;
        option proto &#039;static&#039;
        option ipaddr &#039;127.0.0.1&#039;
        option netmask &#039;255.0.0.0&#039;

config globals &#039;globals&#039;
        option ula_prefix &#039;fd23:a9f4:2714::/48&#039;

config interface &#039;lan&#039;
        option force_link &#039;1&#039;
        option type &#039;bridge&#039;
        option proto &#039;static&#039;
        option ipaddr &#039;192.168.1.1&#039;
        option netmask &#039;255.255.255.0&#039;
        option ip6assign &#039;60&#039;
        option _orig_ifname &#039;eth0 wlan0 wlan1&#039;
        option _orig_bridge &#039;true&#039;
        option ifname &#039;eth0&#039;

config interface &#039;OW_Failsafe&#039;
        option proto &#039;static&#039;
        option ipaddr &#039;10.70.0.1&#039;   # I intentionally use an IP range which should not collide
        option netmask &#039;255.255.255.0&#039;
        option delegate &#039;0&#039;
        option ipv6 &#039;0&#039;

config interface &#039;wan&#039;
        option ifname &#039;eth1&#039;
        option proto &#039;dhcp&#039;
        option type &#039;bridge&#039;

config interface &#039;wan6&#039;
        option ifname &#039;eth1&#039;
        option proto &#039;dhcpv6&#039;

config switch
        option name &#039;switch0&#039;
        option reset &#039;1&#039;
        option enable_vlan &#039;1&#039;

config switch_vlan
        option device &#039;switch0&#039;
        option vlan &#039;1&#039;
        option ports &#039;0 1 2 3 5&#039;

config switch_vlan
        option device &#039;switch0&#039;
        option vlan &#039;2&#039;
        option ports &#039;4 6&#039;</code></pre></div><p>My /etc/config/wireless file:<br /></p><div class="codebox"><pre><code>config wifi-device &#039;radio0&#039;
        option type &#039;mac80211&#039;
        option hwmode &#039;11ng&#039;
        option path &#039;soc/soc:pcie-controller/pci0000:00/0000:00:02.0/0000:02:00.0&#039;
        option country &#039;DZ&#039;
        option channel &#039;4&#039;
        option htmode &#039;HT20&#039;
        option disabled &#039;0&#039;
        option txpower &#039;20&#039;

# This is the new AP
config wifi-iface
        option device &#039;radio0&#039;  # Change &#039;radio0&#039; if required. It must match the wi-fi device
        option mode &#039;ap&#039;
        option encryption &#039;psk2&#039;
        option ssid &#039;OW_Failsafe&#039;
        option key &#039;xxxxxxx&#039; # Change this to whatever you feel appropriate
        option network &#039;OpenWRT_Failsafe&#039;

config wifi-iface
        option device &#039;radio0&#039;
        option mode &#039;ap&#039;
        option ssid &#039;Hamama&#039;
        option wmm &#039;0&#039;
        option network &#039;lan&#039;
        option encryption &#039;psk2+tkip+ccmp&#039;
        option key &#039;xxxxxxxx&#039;

config wifi-device &#039;radio1&#039;
        option type &#039;mac80211&#039;
        option channel &#039;36&#039;
        option hwmode &#039;11a&#039;
        option path &#039;soc/soc:pcie-controller/pci0000:00/0000:00:03.0/0000:03:00.0&#039;
        option htmode &#039;VHT80&#039;
        option country &#039;DE&#039;

config wifi-iface
        option device &#039;radio1&#039;
        option mode &#039;ap&#039;
        option ssid &#039;OpenWrt&#039;
        option encryption &#039;none&#039;
        option network &#039;lan&#039;</code></pre></div><p>My /etc/config/dhcp<br /></p><div class="codebox"><pre><code>config dnsmasq
        option domainneeded &#039;1&#039;
        option boguspriv &#039;1&#039;
        option filterwin2k &#039;0&#039;
        option localise_queries &#039;1&#039;
        option rebind_protection &#039;1&#039;
        option rebind_localhost &#039;1&#039;
        option local &#039;/lan/&#039;
        option domain &#039;lan&#039;
        option expandhosts &#039;1&#039;
        option nonegcache &#039;0&#039;
        option authoritative &#039;1&#039;
        option readethers &#039;1&#039;
        option leasefile &#039;/tmp/dhcp.leases&#039;
        option resolvfile &#039;/tmp/resolv.conf.auto&#039;
        option localservice &#039;1&#039;

config dhcp &#039;lan&#039;
        option interface &#039;lan&#039;
        option start &#039;100&#039;
        option limit &#039;150&#039;
        option leasetime &#039;12h&#039;
        option dhcpv6 &#039;server&#039;
        option ra &#039;server&#039;
        option ra_management &#039;1&#039;

config dhcp &#039;OW_Failsafe&#039;
        option interface &#039;OW_Failsafe&#039;
        option start &#039;50&#039;
        option limit &#039;10&#039;
        option leasetime &#039;2h&#039;

config dhcp &#039;wan&#039;
        option interface &#039;wan&#039;
        option ignore &#039;1&#039;

config odhcpd &#039;odhcpd&#039;
        option maindhcp &#039;0&#039;
        option leasefile &#039;/tmp/hosts/odhcpd&#039;
        option leasetrigger &#039;/usr/sbin/odhcpd-update&#039;</code></pre></div><p>My /etc/config/firewall:<br /></p><div class="codebox"><pre><code>config defaults
        option syn_flood        1
        option input            ACCEPT
        option output           ACCEPT
        option forward          REJECT
# Uncomment this line to disable ipv6 rules
#       option disable_ipv6     1

config zone
        option name             lan
        list   network          &#039;lan&#039;
        option input            ACCEPT
        option output           ACCEPT
        option forward          ACCEPT

config zone
        option name &#039;OW_Failsafe&#039;
        option input &#039;ACCEPT&#039;
        option output &#039;ACCEPT&#039;
        option forward &#039;REJECT&#039;
        option family &#039;ipv4&#039;
        list   network &#039;OW_Failsafe&#039;

config zone
        option name             wan
        list   network          &#039;wan&#039;
        list   network          &#039;wan6&#039;
        option input            REJECT
        option output           ACCEPT
        option forward          REJECT
        option masq             1
        option mtu_fix          1

config forwarding
        option src              lan
        option dest             wan

# We need to accept udp packets on port 68,
# see ht*ps://dev.openwrt.org/ticket/4108
config rule
        option name             Allow-DHCP-Renew
        option src              wan
        option proto            udp
        option dest_port        68
        option target           ACCEPT
        option family           ipv4

# Allow IPv4 ping
config rule
        option name             Allow-Ping
        option src              wan
        option proto            icmp
        option icmp_type        echo-request
        option family           ipv4
        option target           ACCEPT

config rule
        option name             Allow-IGMP
        option src              wan
        option proto            igmp
        option family           ipv4
        option target           ACCEPT

# Allow DHCPv6 replies
# see h*tps://dev.openwrt.org/ticket/10381
config rule
        option name             Allow-DHCPv6
        option src              wan
        option proto            udp
        option src_ip           fe80::/10
        option src_port         547
        option dest_ip          fe80::/10
        option dest_port        546
        option family           ipv6
        option target           ACCEPT

config rule
        option name             Allow-MLD
        option src              wan
        option proto            icmp
        option src_ip           fe80::/10
        list icmp_type          &#039;130/0&#039;
        list icmp_type          &#039;131/0&#039;
        list icmp_type          &#039;132/0&#039;
        list icmp_type          &#039;143/0&#039;
        option family           ipv6
        option target           ACCEPT

# Allow essential incoming IPv6 ICMP traffic
config rule
        option name             Allow-ICMPv6-Input
        option src              wan
        option proto    icmp
        list icmp_type          echo-request
        list icmp_type          echo-reply
        list icmp_type          destination-unreachable
        list icmp_type          packet-too-big
        list icmp_type          time-exceeded
        list icmp_type          bad-header
        list icmp_type          unknown-header-type
        list icmp_type          router-solicitation
        list icmp_type          neighbour-solicitation
        list icmp_type          router-advertisement
        list icmp_type          neighbour-advertisement
        option limit            1000/sec
        option family           ipv6
        option target           ACCEPT

config rule
        option name             Allow-MLD
        option src              wan
        option proto            icmp
        option src_ip           fe80::/10
        list icmp_type          &#039;130/0&#039;
        list icmp_type          &#039;131/0&#039;
        list icmp_type          &#039;132/0&#039;
        list icmp_type          &#039;143/0&#039;
        option family           ipv6
        option target           ACCEPT

# Allow essential incoming IPv6 ICMP traffic
config rule
        option name             Allow-ICMPv6-Input
        option src              wan
        option proto    icmp
        list icmp_type          echo-request
        list icmp_type          echo-reply
        list icmp_type          destination-unreachable
        list icmp_type          packet-too-big
        list icmp_type          time-exceeded
        list icmp_type          bad-header
        list icmp_type          unknown-header-type
        list icmp_type          router-solicitation
        list icmp_type          neighbour-solicitation
        list icmp_type          router-advertisement
        list icmp_type          neighbour-advertisement
        option limit            1000/sec
        option family           ipv6
        option target           ACCEPT

# Allow essential forwarded IPv6 ICMP traffic
config rule
        option name             Allow-ICMPv6-Forward
        option src              wan
        option dest             *
        option proto            icmp
        list icmp_type          echo-request
        list icmp_type          echo-reply
        list icmp_type          destination-unreachable
        list icmp_type          packet-too-big
        list icmp_type          time-exceeded
        list icmp_type          bad-header
        list icmp_type          unknown-header-type
        option limit            1000/sec
        option family           ipv6
        option target           ACCEPT

# include a file with users custom iptables rules
config include
        option path /etc/firewall.user</code></pre></div><p>My /etc/config/dropbear file:<br /></p><div class="codebox"><pre><code>config dropbear
        option PasswordAuth &#039;on&#039;
        option RootPasswordAuth &#039;on&#039;
        option Port         &#039;22&#039;
#       option BannerFile   &#039;/etc/banner&#039;

config dropbear
        option Port &#039;22&#039;
        option Interface &#039;OW_Failsafe&#039;
        option PasswordAuth &#039;on&#039;
        option RootLogin &#039;on&#039;
        option RootPasswordAuth &#039;on&#039;</code></pre></div><p>Please correct me if i&#039;m wrong.</p><p>Kind regards.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p360250">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">mk24</div>
					<div class="post-datetime">
						12 Jun 2017, 22:45					</div>
				</div>
				<div class="post-content content">
					<p>In /etc/config/wireless, you need to attach the AP to the OW_Failsafe network.&nbsp; &quot;OpenWrt_Failsafe&quot; isn&#039;t a network defined in /etc/config/network.</p><p>ssid is the name of the AP that is used on the air. It can be almost anything, such as &quot;OpenWrt_Failsafe&quot;.</p><p>Names of networks need to be 15 or fewer characters, including the &quot;br-&quot; that will be added if it is a bridge.&nbsp; It is also conventional to use only lower case.</p>											<p class="post-edited">(Last edited by <strong>mk24</strong> on 12 Jun 2017, 22:46)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p360256">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">magische_vogel</div>
					<div class="post-datetime">
						13 Jun 2017, 00:50					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>mk24 wrote:</cite><blockquote><p>In /etc/config/wireless, you need to attach the AP to the OW_Failsafe network.&nbsp; &quot;OpenWrt_Failsafe&quot; isn&#039;t a network defined in /etc/config/network.</p><p>ssid is the name of the AP that is used on the air. It can be almost anything, such as &quot;OpenWrt_Failsafe&quot;.</p><p>Names of networks need to be 15 or fewer characters, including the &quot;br-&quot; that will be added if it is a bridge.&nbsp; It is also conventional to use only lower case.</p></blockquote></div><p>Hi mk24,</p><p>Thank you so much for the hints.<br />I corrected the wireless config by attaching the AP to the &quot;ow_failesafe&quot; network. The firewall started without the prvious warnings except this one :<br /></p><div class="codebox"><pre><code>root@OpenWrt:~# /etc/init.d/firewall restart
Warning: Unable to locate ipset utility, disabling ipset support
 * Flushing IPv4 filter table
 * Flushing IPv4 nat table
 * Flushing IPv4 mangle table</code></pre></div><p>Is this warning important or can i ignore it for the moment ?</p><p>Now i&#039;m able to scan and connect to the new created wireless network.<br />I&#039;ll be thankfull if you can give me more hints on how to create captive portal for wired and wireless devices on switch port 3-4 and keep switch port 1-2 as it is + wireless network secured with WPA/WPA2 for direct internet connection without passing by the captive portal.<br />&nbsp; <br />Kind regards.</p>											<p class="post-edited">(Last edited by <strong>magische_vogel</strong> on 13 Jun 2017, 01:46)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p360262">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">magische_vogel</div>
					<div class="post-datetime">
						13 Jun 2017, 01:59					</div>
				</div>
				<div class="post-content content">
					<p>Hi Antek,</p><p>&quot;A wise man is precarious.&quot;</p><p>Your instructions helping me a lot to figure out how to ensure the failsafe alternative in case of troubles due to any misconfiguration of my router switch. I&#039;m inviting newbies members like me to follow &quot;Antek&quot; and &quot;mk24&quot; instuctions to avoid lock out them selfs and loose connection to their devices.</p><p>A priceless help from very kind members here in this nice forum.</p><p>Kind regards.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p360334">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">magische_vogel</div>
					<div class="post-datetime">
						14 Jun 2017, 05:13					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>mk24 wrote:</cite><blockquote><p>First create a br-guest and and a guest AP and get the captive portal it working with wifi.</p><p>Next log into your LAN wifi, using wifi is important in case you misconfigure the Ethernet switch you can still log in.</p><p>This is easier to do on LUCI.&nbsp; Go to the switch page.&nbsp; The default configuration is VLAN1 is the LAN ports going (untagged) to the cpu eth0 and VLAN2 is the WAN port going to cpu eth1.</p><p>Create a new VLAN 3.&nbsp; On port 5 (the CPU) make both 1 and 3 tagged.&nbsp; Turn off two of the external ports from VLAN 1 and put them untagged in VLAN 3.</p><p>Now that VLAN 1 is tagged to the CPU you have to set it that way in the lan bridge.&nbsp; Go to network interfaces lan physical settings and change it from eth0 to eth0.1.&nbsp; Then connect eth0.3 (the wired guest ports) to the guest network.</p><p>I&#039;m not sure about the 1900 eth0 may be eth1 and vice versa.&nbsp; Whichever cpu port is connected to the lan is what you should use for the guests (though you don&#039;t have to).</p></blockquote></div><p>Hi mk24</p><p>Can you eloborate your proposal please. I have the basic configuration and I&#039;d like to modify it, right now 4 ethernet ports have access to internet and are managed by default configuration + the failsafe wireless access as you know.<br />I&#039;d like to have 2 ports (3 and 4) with default configuration (Internet access), and the other 2 ports (1 and 2) redirected to a Hotspot captive portal.<br /></p><div class="codebox"><pre><code>root@OpenWrt:~# swconfig dev switch0 help
switch0: 1000000003.mvsw61xx(MV88E6172), ports: 7 (cpu @ 5), vlans: 64</code></pre></div><p>So this device supports 64 vlans, and the port 5 is the CPU port; ports 0,1,2,3 are associated to the 4 LAN connections on the back of the router.<br />After play with connecting cables to the LAN connections For this router and using this command <br /></p><div class="codebox"><pre><code>swconfig dev switch0 show</code></pre></div><p>. <br />I got the following allocation:<br />Port 0: LAN 4<br />Port 1: LAN 3<br />Port 2: LAN 2<br />Port 3: LAN 1<br />Port 4: WAN<br />Port 5: CPU</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;---------------------<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| wrt1900ac&nbsp; V1 |<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;---------------------<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;---------------------------------------------------------<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -------------------&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ---------------------<br />OS/VLAN&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | VLAN1(LAN) |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| VLAN2(WAN)&nbsp; |<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; --------------------&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;---------------------<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;---------------------------------------------------------&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ---------------<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ---------&nbsp; &nbsp; &nbsp;---------&nbsp; &nbsp; &nbsp;---------&nbsp; &nbsp; &nbsp;---------&nbsp; &nbsp; &nbsp; ------------------&nbsp; &nbsp; &nbsp; ----------&nbsp; &nbsp; &nbsp;----------<br />Physical&nbsp; | Port0 |&nbsp; &nbsp;| Port1 |&nbsp; &nbsp; | port2 |&nbsp; &nbsp; | Port3 |&nbsp; &nbsp;| CPU (port5) |&nbsp; &nbsp; &nbsp;| Port4 |&nbsp; &nbsp;| Port6 |<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ---------&nbsp; &nbsp; &nbsp;---------&nbsp; &nbsp; &nbsp;---------&nbsp; &nbsp; &nbsp; ---------&nbsp; &nbsp; &nbsp;------------------&nbsp; &nbsp; &nbsp; ----------&nbsp; &nbsp; ----------<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ---------&nbsp; &nbsp; &nbsp;---------&nbsp; &nbsp; &nbsp;---------&nbsp; &nbsp; &nbsp;---------&nbsp; &nbsp; &nbsp; &nbsp;---------------&nbsp; &nbsp; &nbsp; -------------&nbsp; &nbsp; ----------<br />Tagged&nbsp; &nbsp;|&nbsp; &nbsp;4&nbsp; &nbsp; &nbsp;|&nbsp; &nbsp; |&nbsp; &nbsp;3&nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; |&nbsp; &nbsp;2&nbsp; &nbsp; |&nbsp; &nbsp; &nbsp;|&nbsp; &nbsp;1&nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp;|&nbsp; &nbsp; &nbsp;eth0&nbsp; &nbsp; &nbsp;|&nbsp; &nbsp; &nbsp;| internet |&nbsp; &nbsp;|&nbsp; eth1&nbsp; |<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ---------&nbsp; &nbsp; &nbsp;---------&nbsp; &nbsp; &nbsp;---------&nbsp; &nbsp; &nbsp;---------&nbsp; &nbsp; &nbsp; &nbsp;---------------&nbsp; &nbsp; &nbsp; ------------&nbsp; &nbsp; &nbsp;----------</p><p>With the existing configuration, there is a two virtual LANs, with identity 1 and 2.</p><p>To reconfigure 2 virtual lans as you suggest, one associated to the right ports (LAN 1, LAN 2 / ports 3 and 2), and other associated to the left ports (LAN 3, LAN 4 / ports 1 and 0), i used the following configuration:</p><div class="codebox"><pre><code>config interface &#039;loopback&#039;
        option ifname &#039;lo&#039;
        option proto &#039;static&#039;
        option ipaddr &#039;127.0.0.1&#039;
        option netmask &#039;255.0.0.0&#039;

config globals &#039;globals&#039;
        option ula_prefix &#039;fd23:a9f4:2714::/48&#039;

config interface &#039;lan&#039;
        option force_link &#039;1&#039;
        option type &#039;bridge&#039;
        option proto &#039;static&#039;
        option ipaddr &#039;192.168.1.1&#039;
        option netmask &#039;255.255.255.0&#039;
        option ip6assign &#039;60&#039;
        option _orig_ifname &#039;eth0.1 wlan0 wlan1&#039;
        option _orig_bridge &#039;true&#039;
        option ifname &#039;eth0.1&#039;

config interface &#039;hot&#039;
        option ifname &#039;eth0.3&#039;
        option type &#039;bridge&#039;
        option proto &#039;static&#039;
        option ipaddr &#039;192.168.3.1&#039;
        option netmask &#039;255.255.255.0&#039;

config interface &#039;ow_failsafe&#039;
        option proto &#039;static&#039;
        option ipaddr &#039;10.70.0.1&#039;   # I intentionally use an IP range which should not collide
        option netmask &#039;255.255.255.0&#039;
        option delegate &#039;0&#039;
        option ipv6 &#039;0&#039;

config interface &#039;wan&#039;
        option ifname &#039;eth1&#039;
        option proto &#039;dhcp&#039;
        option type &#039;bridge&#039;

config interface &#039;wan6&#039;
        option ifname &#039;eth1&#039;
        option proto &#039;dhcpv6&#039;

config switch
        option name &#039;switch0&#039;
        option reset &#039;1&#039;
        option enable_vlan &#039;1&#039;

config switch_vlan
        option device &#039;switch0&#039;
        option vlan &#039;1&#039;
        option ports &#039;0 1 5t&#039;

config switch_vlan
        option device &#039;switch0&#039;
        option vlan &#039;2&#039;
        option ports &#039;4 6&#039;

config switch_vlan
        option device &#039;switch0&#039;
        option vlan &#039;3&#039;
        option ports &#039;2 3 5t&#039;</code></pre></div><p>This creates an interface called &quot;lan&quot; associated to the first vlan (eth0.1), that is, to the ports labelled in the router as LAN3, LAN4; it also creates the interface &quot;hot&quot; associated to the second vlan (eth0.3), on the remaining router ports. Note that each interface uses a different set of LAN ports (1,2 vs 3,4) and both obviously communicate with the CPU (port 5). As both access the port 5, this is tagged (5t).</p><p>For this to fully work, i need to provide additional firewall rules, and setup dhcp for the new interface (hot): I enter in /etc/config/firewall the following new lines:<br /></p><div class="codebox"><pre><code>config zone
      option name             hot
      list      network          &#039;hot&#039;
      option input            ACCEPT
      option output           ACCEPT
      option forward          REJECT

config forwarding   # to have access to the internet connection
        option dest &#039;wan&#039;
        option src &#039;hot&#039;</code></pre></div><p>and, in /etc/config/dhcp add now:<br /></p><div class="codebox"><pre><code>      config dhcp hot
      option interface     hot
      option start            200     
      option limit             250
      option leasetime    12h</code></pre></div><p>Please correct me if i&#039;m wrong.<br />Any more details regarding your suggestion &quot;First create a br-guest and and a guest AP and get the captive portal it working with wifi.&quot; will be helpfull. As i&#039;m newbie i&#039;m learning everyday from you and other members and of course reading a lot.</p><p>My kind regards.</p>											<p class="post-edited">(Last edited by <strong>magische_vogel</strong> on 14 Jun 2017, 06:27)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p360504">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">Antek</div>
					<div class="post-datetime">
						16 Jun 2017, 23:08					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>magische_vogel wrote:</cite><blockquote><p>Your instructions helping me a lot to figure out how to ensure the failsafe alternative in case of troubles due to any misconfiguration of my router switch. I&#039;m inviting newbies members like me to follow &quot;Antek&quot; and &quot;mk24&quot; instuctions to avoid lock out them selfs and loose connection to their devices.</p></blockquote></div><p>You&#039;re welcome. I noticed the same error as mk24 did, where the network name in the wireless config was incorrect. Glad you got it fixed though. In hindsight, perhaps I should&#039;ve added a comment to my configuration example that this name needs to match the &quot;OW_Failsafe&quot; network that you used.</p><p>Looking at your latest configuration files, they seem to be on the right track. However, I have no experience on router designs that have more than one Ethernet port on the SoC, or a stand-alone Ethernet controller in addition to the built-in ports of the SoC. Thus, whatever I suggest below might be off the mark, and quite a lot <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Sera said below that both eth0 and eth1 are wired directly to the CPU on the SoC, so one thing which strikes me as odd is that the &#039;swconfig dev switch0 help&#039; does not identify both ports 5 and 6 as CPU-facing ports. Perhaps this is a limitation of the swconfig tool itself, I don&#039;t know. My second guess would be that the port 6 is wired to a dedicated Ethernet-controller chip that, in turn, is wired to the SoC through a local or expansion bus? Since I don&#039;t know for sure, I trust Sera&#039;s knowledge in this matter and assume that this is just a limitation of the swconfig tool.</p><p>Anyhow, since you are resetting the switch in your configuration, then you could potentially omit the configuration for the VLAN 2 completely. Or alternatively, you could finish the configuration by tagging port 6 in the VLAN config, and then using &#039;eth1.2&#039; on the WAN network&#039;s interface. This would cause your configuration to be &quot;complete&quot; in a sense, so that all bolts and nuts in your config serve a well-defined purpose. Usually, having a full configuration, albeit verbose, is better than a half-way configuration where things might go wrong when you e.g. restart the router and it retains some bit somewhere in memory which causes unexpected behavior since this bit isn&#039;t explicitly set to any predefined value by the config.</p><p>Note, however, that if the VLANs and the physical ports work as you expect in the current config, then you can just leave it as is. Don&#039;t change it, if it works. I personally prefer configurations which are complete, but that&#039;s just a personal trait. </p><p>Regardless of your decision, do bear in mind what Sera said below: if you upgrade your kernel (that is, flash a newer version of OpenWRT to your router), then the ports eth0 and eth1 might get &quot;switched around&quot;, and this would cause total havoc if you tick the &quot;Keep the configuration&quot; box when performing the upgrade. Perhaps this is the reason why &#039;swconfig&#039; identifies the switch as &#039;1000000003.mvsw61xx&#039;?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p360530">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">magische_vogel</div>
					<div class="post-datetime">
						17 Jun 2017, 12:06					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Antek wrote:</cite><blockquote><div class="quotebox"><cite>magische_vogel wrote:</cite><blockquote><p>Your instructions helping me a lot to figure out how to ensure the failsafe alternative in case of troubles due to any misconfiguration of my router switch. I&#039;m inviting newbies members like me to follow &quot;Antek&quot; and &quot;mk24&quot; instuctions to avoid lock out them selfs and loose connection to their devices.</p></blockquote></div><p>You&#039;re welcome. I noticed the same error as mk24 did, where the network name in the wireless config was incorrect. Glad you got it fixed though. In hindsight, perhaps I should&#039;ve added a comment to my configuration example that this name needs to match the &quot;OW_Failsafe&quot; network that you used.</p><p>Looking at your latest configuration files, they seem to be on the right track. However, I have no experience on router designs that have more than one Ethernet port on the SoC, or a stand-alone Ethernet controller in addition to the built-in ports of the SoC. Thus, whatever I suggest below might be off the mark, and quite a lot <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Sera said below that both eth0 and eth1 are wired directly to the CPU on the SoC, so one thing which strikes me as odd is that the &#039;swconfig dev switch0 help&#039; does not identify both ports 5 and 6 as CPU-facing ports. Perhaps this is a limitation of the swconfig tool itself, I don&#039;t know. My second guess would be that the port 6 is wired to a dedicated Ethernet-controller chip that, in turn, is wired to the SoC through a local or expansion bus? Since I don&#039;t know for sure, I trust Sera&#039;s knowledge in this matter and assume that this is just a limitation of the swconfig tool.</p><p>Anyhow, since you are resetting the switch in your configuration, then you could potentially omit the configuration for the VLAN 2 completely. Or alternatively, you could finish the configuration by tagging port 6 in the VLAN config, and then using &#039;eth1.2&#039; on the WAN network&#039;s interface. This would cause your configuration to be &quot;complete&quot; in a sense, so that all bolts and nuts in your config serve a well-defined purpose. Usually, having a full configuration, albeit verbose, is better than a half-way configuration where things might go wrong when you e.g. restart the router and it retains some bit somewhere in memory which causes unexpected behavior since this bit isn&#039;t explicitly set to any predefined value by the config.</p><p>Note, however, that if the VLANs and the physical ports work as you expect in the current config, then you can just leave it as is. Don&#039;t change it, if it works. I personally prefer configurations which are complete, but that&#039;s just a personal trait. </p><p>Regardless of your decision, do bear in mind what Sera said below: if you upgrade your kernel (that is, flash a newer version of OpenWRT to your router), then the ports eth0 and eth1 might get &quot;switched around&quot;, and this would cause total havoc if you tick the &quot;Keep the configuration&quot; box when performing the upgrade. Perhaps this is the reason why &#039;swconfig&#039; identifies the switch as &#039;1000000003.mvsw61xx&#039;?</p></blockquote></div><p>Hi Antek,</p><p>Thank you again for your comment.<br />Me too I&#039;m trusting Sera&#039;s knowledge in this matter.<br />Yes, VLANs and the physical ports work as i&#039;m expecting in my router using the current config, but i agree with you that&#039;s better to have a configuration which is complete. <br />What do you mean by : &quot;omit the configuration for the VLAN 2 completely&quot;.<br />By the way i tried to finish the configuration as you suggested by tagging port 6 in the VLAN 2 config. After tagging the port 6 and restarting my router i cant&#039; see the &#039;eth1.2&#039; to attach it with the WAN network&#039;s interface, and my internet connection go down, but after untagging port 6 in the VLAN 2 my internet connection is comming up again.<br />I really want to complete my config, i think i&#039;m doing something wrong. Here is how my VLAN 2 config look like when tagging port 6:<br /></p><div class="codebox"><pre><code>config switch_vlan
        option device &#039;switch0&#039;
        option vlan &#039;2&#039;
        option vid &#039;2&#039;
        option ports &#039;4 6t&#039;</code></pre></div><p>Kind regards.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p360536">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">Antek</div>
					<div class="post-datetime">
						17 Jun 2017, 14:38					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>magische_vogel wrote:</cite><blockquote><p>What do you mean by : &quot;omit the configuration for the VLAN 2 completely&quot;.</p></blockquote></div><p>I mean that from the following config in your /etc/config/network at the moment<br /></p><div class="codebox"><pre><code>config switch
        option name &#039;switch0&#039;
        option reset &#039;1&#039;
        option enable_vlan &#039;1&#039;

config switch_vlan
        option device &#039;switch0&#039;
        option vlan &#039;1&#039;
        option ports &#039;0 1 5t&#039;

config switch_vlan
        option device &#039;switch0&#039;
        option vlan &#039;2&#039;
        option ports &#039;4 6&#039;

config switch_vlan
        option device &#039;switch0&#039;
        option vlan &#039;3&#039;
        option ports &#039;2 3 5t&#039;</code></pre></div><p>You would leave out the part that identifies &#039;vlan2&#039;<br /></p><div class="codebox"><pre><code>config switch_vlan
        option device &#039;switch0&#039;
        option vlan &#039;2&#039;
        option ports &#039;4 6&#039;</code></pre></div><p>But as I stated earlier, <strong>this isn&#039;t a good approach</strong>, as it would then leave ports 4 and 6 in an unconfigured state which may cause trouble later on.</p><div class="quotebox"><cite>magische_vogel wrote:</cite><blockquote><p>By the way i tried to finish the configuration as you suggested by tagging port 6 in the VLAN 2 config. After tagging the port 6 and restarting my router i cant&#039; see the &#039;eth1.2&#039; to attach it with the WAN network&#039;s interface, and my internet connection go down, but after untagging port 6 in the VLAN 2 my internet connection is comming up again.</p></blockquote></div><p>When the port is not tagged, type &#039;ifconfig&#039;. Do you see the &#039;eth1&#039; interface? If you tag the port and type &#039;/etc/init.d/network reload&#039;, then &#039;ifconfig&#039;, what interfaces do you see then? Does anything change? You can use the HWaddr variables to identify the physical interfaces and see what matches what.</p><p>As I said before, I have little experience from setups that have multiple Ethernet interfaces, so it&#039;s pretty much a try-and-go experiment for me as well. So remember, you do not need to complete the config if it works as it is. But if you feel interested enough, we can probe around together and try to understand how this stuff works <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p360537">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">mk24</div>
					<div class="post-datetime">
						17 Jun 2017, 15:13					</div>
				</div>
				<div class="post-content content">
					<p>The reason it is set up this way is because the eth ports in the CPU chip can&#039;t drive gigabit ethernet cables directly.&nbsp; They have &quot;GMII&quot; interfaces which are designed to connect to another chip.&nbsp; So the default eth1 --&gt; port 4 path is there to use the switch chip as a media converter.&nbsp; Although the switch can switch any path among its seven ports, there&#039;s really no need to alter the simple WAN setup while you&#039;re reconfiguring the eth0 --&gt; lan ports system.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>