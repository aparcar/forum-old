<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Bricked WAG160Nv2 - bootloader says Download mode1111 ... press enter</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 2 Oct 2014 and 30 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 3 of 3</div><nav><ul><li><a href="viewtopic.php%3Fid=27801&amp;p=1.html">1</a></li><li><a href="viewtopic.php%3Fid=27801&amp;p=2.html">2</a></li><li class="pagination-current"><span>3</span></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p128690">
				<div class="post-metadata">
					<div class="post-num">Post #51</div>
					<div class="post-author">jal2</div>
					<div class="post-datetime">
						17 Feb 2011, 16:20					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>1955jmgs wrote:</cite><blockquote><p>Guys, I&#039;ve followed this topic and remain amazed at all of your abilitys but can anyone answer the simple question re the WAG160N V1, Openwrt refers to this as supported under 10.0.3 with the name BRCM63XX, but there are a multitude of files there - which is the correct one. I have the converted CA42 connected to the serial port but have not got a clue which file to upload. I would rather not brick my router/modem but this is so obvious that I simply cannot see how to do it. Linksys Web firmware loader rejects all and if I stop the serial to enable upload firmware then it reject it too, as for TFTP no success either - AAAH, which file?<br/>John</p></blockquote></div><p>Please look into <a href="https://forum.openwrt.org/viewtopic.php?id=19601">this thread</a>, Virus posted a link to a running firmware. I don&#039;t own a version 1.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p128691">
				<div class="post-metadata">
					<div class="post-num">Post #52</div>
					<div class="post-author">jal2</div>
					<div class="post-datetime">
						17 Feb 2011, 16:31					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>james.harper wrote:</cite><blockquote><p>I&#039;m wondering if &#039;Download mode1111&#039; might mean I have an opportunity to load a new firmware via the serial port.</p></blockquote></div><p>Sorry for the long delay, I&nbsp; was too busy with my job.<br/>Yesterday I&#039;ve successfully downloaded a vendor firmware into a WAG160Nv2 in download mode <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile"/><br/>You find the tool <a href="https://github.com/jal2/WAG160Nv2">here</a>.</p><p>Next step is to get rid of the pid2 error in the bootloader for OpenWRT images. As the bootloader searches in the<br/>upper 2MBytes only and I don&#039;t want to restrict an OpenWRT image to squashfs, I&#039;d love to put the pid2 into the nvram area at initial start. The kernel is usually smaller than 2 MByte and everything above is writable, except for the ath_data and nvram mtd.</p>											<p class="post-edited">(Last edited by <strong>jal2</strong> on 17 Feb 2011, 16:34)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p128793">
				<div class="post-metadata">
					<div class="post-num">Post #53</div>
					<div class="post-author">xTomy</div>
					<div class="post-datetime">
						18 Feb 2011, 22:00					</div>
				</div>
				<div class="post-content content">
					<p>Hi everyone, I am successfull&nbsp; flash OpenWRT Backfire into my Linksys WAG160Nv2.&nbsp; But I have to &quot;cut&quot; jffs from image, so my change in system aren&#039;t&nbsp; permanent. If I need permanent change I have to do before compiling source code. I write HOW-TO with everything needed in my freetime, it is available there: <a href="http://www.stud.fit.vutbr.cz/~xproch21/doku.php?id=openwrt-linksys-en">http://www.stud.fit.vutbr.cz/~xproch21/doku.php?id=openwrt-linksys-en</a>. I hope that will be usefull.</p><p>Sorry for my english <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile"/></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p128800">
				<div class="post-metadata">
					<div class="post-num">Post #54</div>
					<div class="post-author">jal2</div>
					<div class="post-datetime">
						19 Feb 2011, 00:51					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>xTomy wrote:</cite><blockquote><p>Hi everyone, I am successfull&nbsp; flash OpenWRT Backfire into my Linksys WAG160Nv2.&nbsp; But I have to &quot;cut&quot; jffs from image, so my change in system aren&#039;t&nbsp; permanent. If I need permanent change I have to do before compiling source code. I write HOW-TO with everything needed in my freetime, it is available there: <a href="http://www.stud.fit.vutbr.cz/~xproch21/doku.php?id=openwrt-linksys-en">http://www.stud.fit.vutbr.cz/~xproch21/doku.php?id=openwrt-linksys-en</a>. I hope that will be usefull.</p></blockquote></div><p>I&#039;m currently trying to incorporate the pid2 into an OpenWRT image for the WAG160Nv2 patching the imagetag tool. Have you ever tried to run a svn trunk based OpenWRT image on your device? Any idea if the nvram utility works with the nvram area of the WAG160Nv2?</p><p>ADDED:<br/>Does WLAN works with your kernel - if yes, which driver?<br/>We should put all the information about the WAG160Nv2 into a wiki page at openwrt.org - eventually splitting <a href="http://wiki.openwrt.org/toh/linksys/wag160n">this one</a> into two. I&#039;d start this after the pid2 is added to the image.</p><p>BTW, the vendor firmware contains the pid2 at the end of the kernel area, but it has the kernel as the last part in flash, while OpenWRT has the rootfs there (to be able to let a jffs2 rootfs occupy the remaining space). So we either put the pid2 after the rootfs, which can be squashfs only in this case or put the pid2 e.g. into the nvram area.</p><p>Regards,<br/>JÃ¶rg</p>											<p class="post-edited">(Last edited by <strong>jal2</strong> on 19 Feb 2011, 01:25)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p128865">
				<div class="post-metadata">
					<div class="post-num">Post #55</div>
					<div class="post-author">xTomy</div>
					<div class="post-datetime">
						19 Feb 2011, 20:25					</div>
				</div>
				<div class="post-content content">
					<p>I would like to help with pid, but I don&#039;t know how you can add to image? With some imagetag tool? I don&#039;t have experience with this. I compiled release sources, don&#039;t tried developments sources.</p><p>Unfortunately, I don&#039;t tried my WLAN interface establish. I need only ethernets interfaces in my project, but if I have free time I should solve this.</p><p>Thanks for the clarification about pid. I have some question about tihs. Do you know value of pid2? I think that the pid have to be at exact place e.g. after rootfs, but you write that can be into the nvram area. Bootloader search in all flash memory? I don&#039;t understand this.</p><p>Thanks and cheers, <br/>Tomas</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p129340">
				<div class="post-metadata">
					<div class="post-num">Post #56</div>
					<div class="post-author">gaetronik</div>
					<div class="post-datetime">
						24 Feb 2011, 00:09					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>jal2 wrote:</cite><blockquote><div class="quotebox"><cite>xTomy wrote:</cite><blockquote><p>Hi everyone, I am successfull&nbsp; flash OpenWRT Backfire into my Linksys WAG160Nv2.&nbsp; But I have to &quot;cut&quot; jffs from image, so my change in system aren&#039;t&nbsp; permanent. If I need permanent change I have to do before compiling source code. I write HOW-TO with everything needed in my freetime, it is available there: <a href="http://www.stud.fit.vutbr.cz/~xproch21/doku.php?id=openwrt-linksys-en">http://www.stud.fit.vutbr.cz/~xproch21/doku.php?id=openwrt-linksys-en</a>. I hope that will be usefull.</p></blockquote></div><p>I&#039;m currently trying to incorporate the pid2 into an OpenWRT image for the WAG160Nv2 patching the imagetag tool. Have you ever tried to run a svn trunk based OpenWRT image on your device? Any idea if the nvram utility works with the nvram area of the WAG160Nv2?</p><p>ADDED:<br/>Does WLAN works with your kernel - if yes, which driver?<br/>We should put all the information about the WAG160Nv2 into a wiki page at openwrt.org - eventually splitting <a href="http://wiki.openwrt.org/toh/linksys/wag160n">this one</a> into two. I&#039;d start this after the pid2 is added to the image.</p><p>BTW, the vendor firmware contains the pid2 at the end of the kernel area, but it has the kernel as the last part in flash, while OpenWRT has the rootfs there (to be able to let a jffs2 rootfs occupy the remaining space). So we either put the pid2 after the rootfs, which can be squashfs only in this case or put the pid2 e.g. into the nvram area.</p><p>Regards,<br/>JÃ¶rg</p></blockquote></div><p>Couldn&#039;t you use the driver given in the official firmware source code there: <a href="http://homedownloads.cisco.com/downloads/gplcode/wag160nv2_v2.00.17_eu_annexA,0.tgz">http://homedownloads.cisco.com/downloads/gplcode/wag160nv2_v2.00.17_eu_annexA,0.tgz</a> . I have an annex A and it seems you have an annex B but it exists for annex B too. I&#039;m not used to work with openwrt but if you have an image i can make test and then bug report and maybe fix somes. </p><p>Regards,</p><p>GaÃ«tan</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p129496">
				<div class="post-metadata">
					<div class="post-num">Post #57</div>
					<div class="post-author">jal2</div>
					<div class="post-datetime">
						26 Feb 2011, 02:23					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>xTomy wrote:</cite><blockquote><p>I would like to help with pid, but I don&#039;t know how you can add to image? With some imagetag tool? I don&#039;t have experience with this. I compiled release sources, don&#039;t tried developments sources.</p><p>Unfortunately, I don&#039;t tried my WLAN interface establish. I need only ethernets interfaces in my project, but if I have free time I should solve this.</p><p>Thanks for the clarification about pid. I have some question about tihs. Do you know value of pid2? I think that the pid have to be at exact place e.g. after rootfs, but you write that can be into the nvram area. Bootloader search in all flash memory? I don&#039;t understand this.</p></blockquote></div><p>Sorry for the delay.<br/>Yes, I&#039;m trying to use the imagetag tool (tools/firmware-utils/src/imagetag.c) to add the pid.<br/>pid2 is &quot;seRcOmM&quot;.<br/>The bootloader searches the upper 2 MByte of flash for the pid2.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p129497">
				<div class="post-metadata">
					<div class="post-num">Post #58</div>
					<div class="post-author">jal2</div>
					<div class="post-datetime">
						26 Feb 2011, 02:25					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>gaetronik wrote:</cite><blockquote><p>Couldn&#039;t you use the driver given in the official firmware source code there: <a href="http://homedownloads.cisco.com/downloads/gplcode/wag160nv2_v2.00.17_eu_annexA,0.tgz">http://homedownloads.cisco.com/downloads/gplcode/wag160nv2_v2.00.17_eu_annexA,0.tgz</a> . I have an annex A and it seems you have an annex B but it exists for annex B too. I&#039;m not used to work with openwrt but if you have an image i can make test and then bug report and maybe fix somes.</p></blockquote></div><p>Thanks for the offer to help. I don&#039;t understand completely what driver you refer to - the one for WLAN?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p129498">
				<div class="post-metadata">
					<div class="post-num">Post #59</div>
					<div class="post-author">jal2</div>
					<div class="post-datetime">
						26 Feb 2011, 02:46					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ve managed to add the pid2 to the OpenWRT image, so that a reboot of the device is possible now.<br/>You find my patches for the imagetag and Makefile <a href="https://dev.openwrt.org/ticket/8938">here</a>.<br/>Just apply them in order to svn trunk (don&#039;t know if they work with any other branch).</p><p>They should produce two new images called openwrt-WAG160Nv2-annex_a-squashfs-web.bin&nbsp; and <br/>openwrt-WAG160Nv2-annex_b-squashfs-web.bin. You are able to either upload them using the vendor<br/>firmware web interface or use the download mode of the bootloader and a sercomm tool,<br/>e.g. the <a href="https://github.com/jal2/WAG160Nv2">Linux</a> one.<br/> As the images contain a zeroed CFE area there is a slight chance that some other version of the flash update cgi<br/>may overwrite the bootloader with the zeros (mine did not). In that case you need JTAG to revive the board. So the Linux sercomm tool<br/>may be a bit safer. It&#039;s always a good idea to backup the whole flash (especially the ath_data area) as a first step.</p><p>With the above patch we are restricted to a squashfs rootfs and sizeof(kernel) + sizeof(rootfs) must be greater than 2MByte.</p><p>EDIT: The OpenWRT image overwrote the ath_data section, we need to add it to the flash layout of the WAG160Nv2. Be sure to<br/>have a backup of it before trying to run OpenWRT!</p>											<p class="post-edited">(Last edited by <strong>jal2</strong> on 26 Feb 2011, 03:16)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p129620">
				<div class="post-metadata">
					<div class="post-num">Post #60</div>
					<div class="post-author">jal2</div>
					<div class="post-datetime">
						27 Feb 2011, 22:38					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>jal2 wrote:</cite><blockquote><p>EDIT: The OpenWRT image overwrote the ath_data section, we need to add it to the flash layout of the WAG160Nv2. Be sure to<br/>have a backup of it before trying to run OpenWRT!</p></blockquote></div><p>Fixed with the patch in <a href="https://dev.openwrt.org/ticket/8953">ticket #8953</a></p><p>[s]I guess it&#039;s time to update the wiki page for the WAG160Nv2.[/s]<br/>EDIT: Done. Please feel free to edit <a href="http://wiki.openwrt.org/toh/linksys/wag160nv2">here</a></p><p>BTW, wlan isn&#039;t working here, as I miss some code to write the PCI config data into the AR9223. I know how it looks like for the<br/>AR71xx SoC, but cannot figure out a good place to implement this on bcm63xx (see <a href="https://forum.openwrt.org/viewtopic.php?id=28848">this thread</a>)</p>											<p class="post-edited">(Last edited by <strong>jal2</strong> on 28 Feb 2011, 02:11)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 3 of 3</div><nav><ul><li><a href="viewtopic.php%3Fid=27801&amp;p=1.html">1</a></li><li><a href="viewtopic.php%3Fid=27801&amp;p=2.html">2</a></li><li class="pagination-current"><span>3</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>