<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Support for TP-Link Archer C2600</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 29 Mar 2018 and 6 May 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 9 of 49</div><nav><ul><li><a href="viewtopic.php%3Fid=54973&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=54973&amp;p=7.html">7</a></li><li><a href="viewtopic.php%3Fid=54973&amp;p=8.html">8</a></li><li class="pagination-current"><span>9</span></li><li><a href="viewtopic.php%3Fid=54973&amp;p=10.html">10</a></li><li><a href="viewtopic.php%3Fid=54973&amp;p=11.html">11</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=54973&amp;p=49.html">49</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p308874">
				<div class="post-metadata">
					<div class="post-num">Post #201</div>
					<div class="post-author">bendavid</div>
					<div class="post-datetime">
						24 Jan 2016, 19:46					</div>
				</div>
				<div class="post-content content">
					<p>Which builds specifically have you tried?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p308876">
				<div class="post-metadata">
					<div class="post-num">Post #202</div>
					<div class="post-author">ccmenb</div>
					<div class="post-datetime">
						24 Jan 2016, 19:50					</div>
				</div>
				<div class="post-content content">
					<p>r48132<br />r48147<br />r48196<br />r48233<br />r48252<br />r48259<br />Edit:----<br />r48479<br />r48548</p>											<p class="post-edited">(Last edited by <strong>ccmenb</strong> on 29 Jan 2016, 21:08)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p308877">
				<div class="post-metadata">
					<div class="post-num">Post #203</div>
					<div class="post-author">bendavid</div>
					<div class="post-datetime">
						24 Jan 2016, 19:51					</div>
				</div>
				<div class="post-content content">
					<p>Ok, thanks.</p><p>Has anyone tried one of these builds on a V1.0 router?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p308886">
				<div class="post-metadata">
					<div class="post-num">Post #204</div>
					<div class="post-author">Rocket</div>
					<div class="post-datetime">
						24 Jan 2016, 20:55					</div>
				</div>
				<div class="post-content content">
					<p>I had all except one of them installed and all worked without a problem. Only thing I needed to do was to do one reboot after the install. Because all of them got stuck...<br />I flash the image wait 5 min, then I reboot it. After that it takes another 2-3minutes to boot up and then it is running just fine.<br />@ccmenb: Did you try rebooting the device?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p308888">
				<div class="post-metadata">
					<div class="post-num">Post #205</div>
					<div class="post-author">ccmenb</div>
					<div class="post-datetime">
						24 Jan 2016, 21:14					</div>
				</div>
				<div class="post-content content">
					<p>Yes, I also tried rebooting the router, getting the same result.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p308904">
				<div class="post-metadata">
					<div class="post-num">Post #206</div>
					<div class="post-author">tedster22</div>
					<div class="post-datetime">
						24 Jan 2016, 23:28					</div>
				</div>
				<div class="post-content content">
					<p>I can confirm the hardware is identical in both versions, so it&#039;s bizarre as to why you are seeing any difference at all.</p><p>Historically, also, TP-link have always brought out version revisions eg v1.1, v1.2, v1.5, v1.7 but its the first number that counts. They never change the hardware if the first number is the same, just the pre-loaded firmware. If any hardware would have changed, it would be v2.x</p><p>Thanks</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p308924">
				<div class="post-metadata">
					<div class="post-num">Post #207</div>
					<div class="post-author">ccmenb</div>
					<div class="post-datetime">
						25 Jan 2016, 02:27					</div>
				</div>
				<div class="post-content content">
					<p>I can confirm that the version r48479 does not seem to work on v1.1.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p308930">
				<div class="post-metadata">
					<div class="post-num">Post #208</div>
					<div class="post-author">RedVortex</div>
					<div class="post-datetime">
						25 Jan 2016, 04:07					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>ccmenb wrote:</cite><blockquote><p>I can confirm that the version r48479 does not seem to work on v1.1.</p></blockquote></div><p>Same here. Flash goes through, reboot, then no lights, no ping, does not seems to boot.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p308980">
				<div class="post-metadata">
					<div class="post-num">Post #209</div>
					<div class="post-author">bendavid</div>
					<div class="post-datetime">
						25 Jan 2016, 15:07					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>tedster22 wrote:</cite><blockquote><p>I can confirm the hardware is identical in both versions, so it&#039;s bizarre as to why you are seeing any difference at all.</p><p>Historically, also, TP-link have always brought out version revisions eg v1.1, v1.2, v1.5, v1.7 but its the first number that counts. They never change the hardware if the first number is the same, just the pre-loaded firmware. If any hardware would have changed, it would be v2.x</p><p>Thanks</p></blockquote></div><p>I wonder if the difference is in the contents of some of the flash partitions which are normally not overwritten by stock or openwrt firmware updates.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p309031">
				<div class="post-metadata">
					<div class="post-num">Post #210</div>
					<div class="post-author">TeutonJon78</div>
					<div class="post-datetime">
						26 Jan 2016, 02:13					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>bendavid wrote:</cite><blockquote><p>I wonder if the difference is in the contents of some of the flash partitions which are normally not overwritten by stock or openwrt firmware updates.</p></blockquote></div><p>That would probably have to be something along those lines -- they haven&#039;t pushed out any variants on the firmware&#039;s available on the website, so they don&#039;t need something else along those lines (or they haven&#039;t released the firmware blobs yet).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p309055">
				<div class="post-metadata">
					<div class="post-num">Post #211</div>
					<div class="post-author">tedster22</div>
					<div class="post-datetime">
						26 Jan 2016, 11:28					</div>
				</div>
				<div class="post-content content">
					<p>I think the same, probably just some new mapping required. The HW is definitely identical so this should be supportable.</p><p>Did anyone ever figure out how to get the real MAC addresses out of the device?</p><p>Thanks</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p309580">
				<div class="post-metadata">
					<div class="post-num">Post #212</div>
					<div class="post-author">RedVortex</div>
					<div class="post-datetime">
						30 Jan 2016, 10:29					</div>
				</div>
				<div class="post-content content">
					<p>Just tested the latest r48548 build (Friday) and I have the same behaviour: flash goes through, router reboots, no led, no activity, just doesn&#039;t boot.</p><p>Thanks</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p309692">
				<div class="post-metadata">
					<div class="post-num">Post #213</div>
					<div class="post-author">bdheaton</div>
					<div class="post-datetime">
						31 Jan 2016, 08:59					</div>
				</div>
				<div class="post-content content">
					<p>The strangeness continues. I received and unboxed a C2600 today. It is labeled as v1.1 on both the box and on the C2600 itself. The factory software identifies it as hardware v1.0.</p><p>The QSDK build flashed and booted fine. (MAC addresses correct and matches sticker on hardware)<br />Arokh&#039;s R48548 build flashed and booted fine. (MAC addresses wrong as previously noted)</p><p>I will try to get a serial port installed tomorrow and possibly dig out the latest version of @bendavid&#039;s patches from OpenWRT-Devel and get my tree setup to build images for it.</p>											<p class="post-edited">(Last edited by <strong>bdheaton</strong> on 31 Jan 2016, 08:59)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p309728">
				<div class="post-metadata">
					<div class="post-num">Post #214</div>
					<div class="post-author">ccmenb</div>
					<div class="post-datetime">
						31 Jan 2016, 14:35					</div>
				</div>
				<div class="post-content content">
					<p>Yes it is mysterious. I tried to run the r48548 build, again, therefore TP-Link&#039;s WebUI as the TFTP method, and once the device loads the flash and resets no longer back to boot. Same as @RedVortex.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p309748">
				<div class="post-metadata">
					<div class="post-num">Post #215</div>
					<div class="post-author">bdheaton</div>
					<div class="post-datetime">
						31 Jan 2016, 17:57					</div>
				</div>
				<div class="post-content content">
					<p>Which R48548 file are you flashing with?</p><div class="quotebox"><cite>ccmenb wrote:</cite><blockquote><p>Yes it is mysterious. I tried to run the r48548 build, again, therefore TP-Link&#039;s WebUI as the TFTP method, and once the device loads the flash and resets no longer back to boot. Same as @RedVortex.</p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p309752">
				<div class="post-metadata">
					<div class="post-num">Post #216</div>
					<div class="post-author">ccmenb</div>
					<div class="post-datetime">
						31 Jan 2016, 19:06					</div>
				</div>
				<div class="post-content content">
					<p>Factory image from <a href="http://luci.subsignal.org/~trondah/c2600/r48548/">http://luci.subsignal.org/~trondah/c2600/r48548/</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p309754">
				<div class="post-metadata">
					<div class="post-num">Post #217</div>
					<div class="post-author">Heinz</div>
					<div class="post-datetime">
						31 Jan 2016, 19:15					</div>
				</div>
				<div class="post-content content">
					<p>I have the same problem.<br />C2600 v1.1<br />Firmware: <a href="http://luci.subsignal.org/~trondah/c2600/r48577/openwrt-ipq806x-C2600-squashfs-factory.bin">http://luci.subsignal.org/~trondah/c260 … actory.bin</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p309897">
				<div class="post-metadata">
					<div class="post-num">Post #218</div>
					<div class="post-author">RedVortex</div>
					<div class="post-datetime">
						1 Feb 2016, 20:53					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Heinz wrote:</cite><blockquote><p>I have the same problem.<br />C2600 v1.1<br />Firmware: <a href="http://luci.subsignal.org/~trondah/c2600/r48577/openwrt-ipq806x-C2600-squashfs-factory.bin">http://luci.subsignal.org/~trondah/c260 … actory.bin</a></p></blockquote></div><p>I&#039;m curious, what firmware from TP-Link are you using, the US or the International one ? I&#039;m asking because, by mistake, I&#039;ve installed the US one and I know it is different in some way from the International one because I cannot change the language or the country in the wireless settings anymore, it is stuck and grayed-out as United States.</p><p>Re-pushing the international one doesn&#039;t change anything, country is now fixed.</p><p>So, back to why I&#039;m asking this: maybe we cannot install OpenWRT over the US-based firmware but it works over the International one ?</p><p>I also wonder if it is possible to re-enable the country selection, if anyone knows...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p309901">
				<div class="post-metadata">
					<div class="post-num">Post #219</div>
					<div class="post-author">derpat</div>
					<div class="post-datetime">
						1 Feb 2016, 21:26					</div>
				</div>
				<div class="post-content content">
					<p>Hey guys. First of all a big thanks to bendavid for the progress he made without a working serial connection!</p><p>If experimented a bit with this device (V1.0) and the patches on the devel list - it&#039;s a bit difficult to get them together and fix them for current trunk. This is the patch I&#039;m working with at the moment:</p><div class="codebox"><pre><code> include/image.mk                                   |  11 +
 .../linux/ipq806x/base-files/etc/board.d/01_leds   |   7 +
 .../ipq806x/base-files/etc/board.d/02_network      |   3 +-
 .../etc/hotplug.d/firmware/11-ath10k-caldata       |  66 +++++
 target/linux/ipq806x/base-files/lib/ipq806x.sh     |   3 +
 .../ipq806x/base-files/lib/upgrade/platform.sh     |  34 ++-
 target/linux/ipq806x/image/Makefile                |  24 +-
 ...qcom-add-TP-Link-Archer-C2600-device-tree.patch | 300 +++++++++++++++++++++
 ...qcom-add-TP-Link-Archer-C2600-device-tree.patch | 300 +++++++++++++++++++++
 target/linux/ipq806x/profiles/tplink.mk            |  20 ++
 tools/firmware-utils/src/tplink-safeloader.c       | 114 +++++++-
 12 files changed, 891 insertions(+), 6 deletions(-)
 create mode 100644 package/kernel/mac80211/patches/941-ath10k_skip_otp_check.patch
 create mode 100644 target/linux/ipq806x/base-files/etc/hotplug.d/firmware/11-ath10k-caldata
 create mode 100644 target/linux/ipq806x/patches-3.18/802-ARM-qcom-add-TP-Link-Archer-C2600-device-tree.patch
 create mode 100644 target/linux/ipq806x/patches-4.1/802-ARM-qcom-add-TP-Link-Archer-C2600-device-tree.patch
 create mode 100644 target/linux/ipq806x/profiles/tplink.mk

diff --git a/include/image.mk b/include/image.mk
index 1522dd7..ee180f4 100644
--- a/include/image.mk
+++ b/include/image.mk
@@ -327,6 +327,17 @@ define Build/netgear-dni
     mv $@.new $@
 endef
 
+define Build/tplink-safe
+    $(STAGING_DIR_HOST)/bin/tplink-safeloader \
+        -B $(TPLINK_BOARD_ID) -V OpenWrt.$(REVISION) \
+        -k $(word 1,$^) \
+        -r $(word 2,$^) \
+        -j \
+        $(if $(findstring sysupgrade,$1),-S) \
+        -o $@.new
+    mv $@.new $@
+endef
+
 define Build/fit
     $(TOPDIR)/scripts/mkits.sh \
         -D $(DEVICE_NAME) -o $@.its -k $@ \
diff --git a/target/linux/ipq806x/base-files/etc/board.d/01_leds b/target/linux/ipq806x/base-files/etc/board.d/01_leds
index 07b5b06..46070ad6 100755
--- a/target/linux/ipq806x/base-files/etc/board.d/01_leds
+++ b/target/linux/ipq806x/base-files/etc/board.d/01_leds
@@ -19,6 +19,13 @@ r7500)
     ucidef_set_led_default &quot;wps&quot; &quot;WPS&quot; &quot;r7500:white:wps&quot; &quot;0&quot;
     ucidef_set_led_default &quot;rfkill&quot; &quot;rfkill&quot; &quot;r7500:white:rfkill&quot; &quot;0&quot;
     ;;
+c2600)
+    ucidef_set_led_usbdev &quot;usb1&quot; &quot;USB 1&quot; &quot;usb_2:blue&quot; &quot;2-1&quot;
+    ucidef_set_led_usbdev &quot;usb2&quot; &quot;USB 2&quot; &quot;usb_4:blue&quot; &quot;4-1&quot;
+    ucidef_set_led_netdev &quot;wan&quot; &quot;WAN&quot; &quot;wan:blue&quot; &quot;eth0&quot;
+    ucidef_set_led_netdev &quot;lan&quot; &quot;LAN&quot; &quot;lan:blue&quot; &quot;br-lan&quot;
+    ucidef_set_led_default &quot;general&quot; &quot;general&quot; &quot;ledgnr:blue&quot; &quot;1&quot;
+    ;;
 *)
     ;;
 esac
diff --git a/target/linux/ipq806x/base-files/etc/board.d/02_network b/target/linux/ipq806x/base-files/etc/board.d/02_network
index 1302a55..9f061e4 100755
--- a/target/linux/ipq806x/base-files/etc/board.d/02_network
+++ b/target/linux/ipq806x/base-files/etc/board.d/02_network
@@ -13,7 +13,8 @@ board=$(ipq806x_board_name)
 
 case &quot;$board&quot; in
 ap148 |\
 d7800 |\
-r7500)
+r7500 |\
+c2600)
     ucidef_add_switch &quot;switch0&quot; \
         &quot;1:lan&quot; &quot;2:lan&quot; &quot;3:lan&quot; &quot;4:lan&quot; &quot;6@eth1&quot; &quot;5:wan&quot; &quot;0@eth0&quot;
     ;;
diff --git a/target/linux/ipq806x/base-files/lib/ipq806x.sh b/target/linux/ipq806x/base-files/lib/ipq806x.sh
index 5b27bde..262183f 100644
--- a/target/linux/ipq806x/base-files/lib/ipq806x.sh
+++ b/target/linux/ipq806x/base-files/lib/ipq806x.sh
@@ -23,6 +23,9 @@ ipq806x_board_detect() {
     *&quot;R7500&quot;)
         name=&quot;r7500&quot;
         ;;
+    *&quot;C2600&quot;)
+        name=&quot;c2600&quot;
+        ;;
     esac
 
     [ -z &quot;$name&quot; ] &amp;&amp; name=&quot;unknown&quot;
diff --git a/target/linux/ipq806x/base-files/lib/upgrade/platform.sh b/target/linux/ipq806x/base-files/lib/upgrade/platform.sh
index c0e19a1..7fc08bb 100644
--- a/target/linux/ipq806x/base-files/lib/upgrade/platform.sh
+++ b/target/linux/ipq806x/base-files/lib/upgrade/platform.sh
@@ -11,6 +11,14 @@ platform_check_image() {
         nand_do_platform_check $board $1
         return $?;
         ;;
+    c2600)
+        local magic_long=&quot;$(get_magic_long &quot;$1&quot;)&quot;
+        [ &quot;$magic_long&quot; != &quot;27051956&quot; ] &amp;&amp; {
+            echo &quot;Invalid image, bad magic: $magic_long&quot;
+            return 1
+        }
+        return 0;
+        ;;
     *)
         return 1;
     esac
@@ -27,4 +35,28 @@ platform_pre_upgrade() {
     esac
 }
 
-# use default for platform_do_upgrade()
+platform_do_upgrade() {
+    local board=$(ipq806x_board_name)
+
+    case &quot;$board&quot; in
+    c2600)
+        platform_do_upgrade_c2600 &quot;$ARGV&quot;
+        ;;
+    esac
+}
+
+platform_do_upgrade_c2600() {
+    local kernpart=&quot;0:HLOS&quot;
+    local rootfspart=&quot;rootfs&quot;
+    
+    local kernel_mtd=&quot;$(find_mtd_index $kernpart)&quot;
+    
+    local kerndev=&quot;/dev/mtd${kernel_mtd}&quot;
+    local rootfsdev=$rootfspart
+    
+    PART_NAME=&quot;${kerndev}:${rootfsdev}&quot;
+    MTD_CONFIG_ARGS=&quot;-s 0x200000&quot;
+        
+    default_do_upgrade &quot;$ARGV&quot;
+    
+}
diff --git a/target/linux/ipq806x/image/Makefile b/target/linux/ipq806x/image/Makefile
index 14cf442..956d724 100644
--- a/target/linux/ipq806x/image/Makefile
+++ b/target/linux/ipq806x/image/Makefile
@@ -85,6 +85,19 @@ define Device/DniImage
 endef
 DEVICE_VARS += KERNEL_SIZE NETGEAR_BOARD_ID NETGEAR_HW_ID DEVICE_BLOCK_SIZE DEVICE_PAGE_SIZE
 
+define Device/TpSafeImage
+    PROFILES += $$(DEVICE_NAME)
+    FILESYSTEMS := squashfs
+    KERNEL_SUFFIX := -uImage
+    KERNEL = kernel-bin | append-dtb | uImage none
+    KERNEL_NAME := zImage
+    TPLINK_BOARD_ID :=
+    IMAGES := factory.bin sysupgrade.bin
+    IMAGE/factory.bin := tplink-safe factory
+    IMAGE/sysupgrade.bin := tplink-safe sysupgrade
+endef
+DEVICE_VARS += TPLINK_BOARD_ID
+
 define Device/AP148
     $(call Device/FitImage)
     $(call Device/UbiFit)
@@ -103,6 +116,15 @@ define Device/AP148-legacy
     BOARD_NAME := ap148
 endef
 
+define Device/C2600
+    $(call Device/TpSafeImage)
+    DEVICE_DTS := qcom-ipq8064-c2600
+    BLOCKSIZE := 128KiB
+    PAGESIZE := 2048
+    BOARD_NAME := c2600
+    TPLINK_BOARD_ID := C2600
+endef
+
 define Device/DB149
     $(call Device/FitImage)
     DEVICE_DTS := qcom-ipq8064-db149
@@ -121,6 +143,6 @@ define Device/R7500
     BOARD_NAME := r7500
 endef
 
-TARGET_DEVICES += AP148 AP148-legacy D7800 DB149 R7500
+TARGET_DEVICES += AP148 AP148-legacy C2600 D7800 DB149 R7500
 
 $(eval $(call BuildImage))
diff --git a/target/linux/ipq806x/patches-3.18/802-ARM-qcom-add-TP-Link-Archer-C2600-device-tree.patch b/target/linux/ipq806x/patches-3.18/802-ARM-qcom-add-TP-Link-Archer-C2600-device-tree.patch
new file mode 100644
index 0000000..536ae57
--- /dev/null
+++ b/target/linux/ipq806x/patches-3.18/802-ARM-qcom-add-TP-Link-Archer-C2600-device-tree.patch
@@ -0,0 +1,300 @@
+diff -urN a/arch/arm/boot/dts/Makefile b/arch/arm/boot/dts/Makefile
+--- a/arch/arm/boot/dts/Makefile    2015-11-25 22:51:15.148899604 +0100
++++ b/arch/arm/boot/dts/Makefile    2015-12-06 14:33:31.092396982 +0100
+@@ -362,6 +362,7 @@
+     qcom-ipq8064-db149.dtb \
+     qcom-ipq8064-r7500.dtb \
+     qcom-ipq8064-d7800.dtb \
++    qcom-ipq8064-c2600.dtb \
+     qcom-msm8660-surf.dtb \
+     qcom-msm8960-cdp.dtb \
+     qcom-msm8974-sony-xperia-honami.dtb
+diff -urN a/arch/arm/boot/dts/qcom-ipq8064-c2600.dts b/arch/arm/boot/dts/qcom-ipq8064-c2600.dts
+--- a/arch/arm/boot/dts/qcom-ipq8064-c2600.dts    1970-01-01 01:00:00.000000000 +0100
++++ b/arch/arm/boot/dts/qcom-ipq8064-c2600.dts    2015-12-06 14:20:05.152365670 +0100
+@@ -0,0 +1,285 @@
++#include &quot;qcom-ipq8064-v1.0.dtsi&quot;
++#include &lt;dt-bindings/input/input.h&gt;
++
++/ {
++    model = &quot;TP-Link Archer C2600&quot;;
++    compatible = &quot;tplink,c2600&quot;, &quot;qcom,ipq8064&quot;;
++
++    memory@0 {
++        reg = &lt;0x42000000 0x1e000000&gt;;
++        device_type = &quot;memory&quot;;
++    };
++
++    reserved-memory {
++        #address-cells = &lt;1&gt;;
++        #size-cells = &lt;1&gt;;
++        ranges;
++        rsvd@41200000 {
++            reg = &lt;0x41200000 0x300000&gt;;
++            no-map;
++        };
++    };
++
++    aliases {
++        serial0 = &amp;uart4;
++        mdio-gpio0 = &amp;mdio0;
++    };
++
++    chosen {
++        linux,stdout-path = &quot;serial0:115200n8&quot;;
++    };
++
++    soc {
++        pinmux@800000 {
++            i2c4_pins: i2c4_pinmux {
++                pins = &quot;gpio12&quot;, &quot;gpio13&quot;;
++                function = &quot;gsbi4&quot;;
++                bias-disable;
++            };
++
++            spi_pins: spi_pins {
++                mux {
++                    pins = &quot;gpio18&quot;, &quot;gpio19&quot;, &quot;gpio21&quot;;
++                    function = &quot;gsbi5&quot;;
++                    drive-strength = &lt;10&gt;;
++                    bias-none;
++                };
++            };
++
++            nand_pins: nand_pins {
++                mux {
++                    pins = &quot;gpio34&quot;, &quot;gpio35&quot;, &quot;gpio36&quot;,
++                           &quot;gpio37&quot;, &quot;gpio38&quot;, &quot;gpio39&quot;,
++                           &quot;gpio40&quot;, &quot;gpio41&quot;, &quot;gpio42&quot;,
++                           &quot;gpio43&quot;, &quot;gpio44&quot;, &quot;gpio45&quot;,
++                           &quot;gpio46&quot;, &quot;gpio47&quot;;
++                    function = &quot;nand&quot;;
++                    drive-strength = &lt;10&gt;;
++                    bias-disable;
++                };
++
++                pullups {
++                    pins = &quot;gpio39&quot;;
++                    bias-pull-up;
++                };
++
++                hold {
++                    pins = &quot;gpio40&quot;, &quot;gpio41&quot;, &quot;gpio42&quot;,
++                           &quot;gpio43&quot;, &quot;gpio44&quot;, &quot;gpio45&quot;,
++                           &quot;gpio46&quot;, &quot;gpio47&quot;;
++                    bias-bus-hold;
++                };
++            };
++
++            mdio0_pins: mdio0_pins {
++                mux {
++                    pins = &quot;gpio0&quot;, &quot;gpio1&quot;;
++                    function = &quot;gpio&quot;;
++                    drive-strength = &lt;8&gt;;
++                    bias-disable;
++                };
++            };
++
++            rgmii2_pins: rgmii2_pins {
++                mux {
++                    pins = &quot;gpio27&quot;, &quot;gpio28&quot;, &quot;gpio29&quot;, &quot;gpio30&quot;, &quot;gpio31&quot;, &quot;gpio32&quot;,
++                           &quot;gpio51&quot;, &quot;gpio52&quot;, &quot;gpio59&quot;, &quot;gpio60&quot;, &quot;gpio61&quot;, &quot;gpio62&quot; ;
++                    function = &quot;rgmii2&quot;;
++                    drive-strength = &lt;8&gt;;
++                    bias-disable;
++                };
++            };
++        };
++
++        gsbi@16300000 {
++            qcom,mode = &lt;GSBI_PROT_I2C_UART&gt;;
++            status = &quot;ok&quot;;
++            serial@16340000 {
++                status = &quot;ok&quot;;
++            };
++            /*
++             * The i2c device on gsbi4 should not be enabled.
++             * On ipq806x designs gsbi4 i2c is meant for exclusive
++             * RPM usage. Turning this on in kernel manifests as
++             * i2c failure for the RPM.
++             */
++        };
++
++        gsbi5: gsbi@1a200000 {
++            qcom,mode = &lt;GSBI_PROT_SPI&gt;;
++            status = &quot;ok&quot;;
++
++            spi4: spi@1a280000 {
++                status = &quot;ok&quot;;
++                spi-max-frequency = &lt;50000000&gt;;
++
++                pinctrl-0 = &lt;&amp;spi_pins&gt;;
++                pinctrl-names = &quot;default&quot;;
++
++                cs-gpios = &lt;&amp;qcom_pinmux 20 0&gt;;
++
++                flash: m25p80@0 {
++                    compatible = &quot;s25fl256s1&quot;;
++                    #address-cells = &lt;1&gt;;
++                    #size-cells = &lt;1&gt;;
++                    spi-max-frequency = &lt;50000000&gt;;
++                    reg = &lt;0&gt;;
++
++                    linux,part-probe = &quot;qcom-smem&quot;;
++                };
++            };
++        };
++
++        phy@100f8800 {        /* USB3 port 1 HS phy */
++            status = &quot;ok&quot;;
++        };
++
++        phy@100f8830 {        /* USB3 port 1 SS phy */
++            status = &quot;ok&quot;;
++        };
++
++        phy@110f8800 {        /* USB3 port 0 HS phy */
++            status = &quot;ok&quot;;
++        };
++
++        phy@110f8830 {        /* USB3 port 0 SS phy */
++            status = &quot;ok&quot;;
++        };
++
++        usb30@0 {
++            status = &quot;ok&quot;;
++        };
++
++        usb30@1 {
++            status = &quot;ok&quot;;
++        };
++
++        pcie0: pci@1b500000 {
++            status = &quot;ok&quot;;
++            phy-tx0-term-offset = &lt;7&gt;;
++        };
++
++        pcie1: pci@1b700000 {
++            status = &quot;ok&quot;;
++            phy-tx0-term-offset = &lt;7&gt;;
++        };
++
++        mdio0: mdio {
++            compatible = &quot;virtual,mdio-gpio&quot;;
++            #address-cells = &lt;1&gt;;
++            #size-cells = &lt;0&gt;;
++            gpios = &lt;&amp;qcom_pinmux 1 0 &amp;qcom_pinmux 0 0&gt;;
++            pinctrl-0 = &lt;&amp;mdio0_pins&gt;;
++            pinctrl-names = &quot;default&quot;;
++
++            phy0: ethernet-phy@0 {
++                device_type = &quot;ethernet-phy&quot;;
++                reg = &lt;0&gt;;
++                qca,ar8327-initvals = &lt;
++                    0x00004 0x7600000   /* PAD0_MODE */
++                    0x00008 0x1000000   /* PAD5_MODE */
++                    0x0000c 0x80        /* PAD6_MODE */
++                    0x000e4 0xaa545     /* MAC_POWER_SEL */
++                    0x000e0 0xc74164de  /* SGMII_CTRL */
++                    0x0007c 0x4e        /* PORT0_STATUS */
++                    0x00094 0x4e        /* PORT6_STATUS */
++                    &gt;;
++            };
++
++            phy4: ethernet-phy@4 {
++                device_type = &quot;ethernet-phy&quot;;
++                reg = &lt;4&gt;;
++            };
++        };
++
++        gmac1: ethernet@37200000 {
++            status = &quot;ok&quot;;
++            phy-mode = &quot;rgmii&quot;;
++            qcom,id = &lt;1&gt;;
++
++            pinctrl-0 = &lt;&amp;rgmii2_pins&gt;;
++            pinctrl-names = &quot;default&quot;;
++
++            fixed-link {
++                speed = &lt;1000&gt;;
++                full-duplex;
++            };
++        };
++
++        gmac2: ethernet@37400000 {
++            status = &quot;ok&quot;;
++            phy-mode = &quot;sgmii&quot;;
++            qcom,id = &lt;2&gt;;
++
++            fixed-link {
++                speed = &lt;1000&gt;;
++                full-duplex;
++            };
++        };
++    };
++        
++    gpio-keys {
++        compatible = &quot;gpio-keys&quot;;
++
++        wifi {
++            label = &quot;wifi&quot;;
++            gpios = &lt;&amp;qcom_pinmux 49 1&gt;;
++            linux,code = &lt;KEY_WLAN&gt;;
++        };
++
++        reset {
++            label = &quot;reset&quot;;
++            gpios = &lt;&amp;qcom_pinmux 64 1&gt;;
++            linux,code = &lt;KEY_RESTART&gt;;
++        };
++
++        wps {
++            label = &quot;wps&quot;;
++            gpios = &lt;&amp;qcom_pinmux 65 1&gt;;
++            linux,code = &lt;KEY_WPS_BUTTON&gt;;
++        };
++                ledgeneral {
++            label = &quot;ledgeneral&quot;;
++            gpios = &lt;&amp;qcom_pinmux 16 1&gt;;
++            linux,code = &lt;KEY_DOLLAR&gt;;
++        };
++    };
++
++    gpio-leds {
++        compatible = &quot;gpio-leds&quot;;
++
++        lan {
++            label = &quot;lan:blue&quot;;
++            gpios = &lt;&amp;qcom_pinmux 6 0&gt;;
++        };
++                usb4 {
++            label = &quot;usb_4:blue&quot;;
++            gpios = &lt;&amp;qcom_pinmux 7 0&gt;;
++        };
++                usb2 {
++            label = &quot;usb_2:blue&quot;;
++            gpios = &lt;&amp;qcom_pinmux 8 0&gt;;
++        };
++                wps {
++            label = &quot;wps:blue&quot;;
++            gpios = &lt;&amp;qcom_pinmux 9 0&gt;;
++        };
++                wan_blue {
++            label = &quot;wan:blue&quot;;
++            gpios = &lt;&amp;qcom_pinmux 33 1&gt;;
++        };
++                status {
++            label = &quot;status:blue&quot;;
++            gpios = &lt;&amp;qcom_pinmux 53 0&gt;;
++            default-state = &quot;on&quot;;
++        };
++                ledgnr {
++            label = &quot;ledgnr:blue&quot;;
++            gpios = &lt;&amp;qcom_pinmux 66 0&gt;;
++        };
++        };
++};
++
++&amp;adm_dma {
++    status = &quot;ok&quot;;
++};
diff --git a/target/linux/ipq806x/patches-4.1/802-ARM-qcom-add-TP-Link-Archer-C2600-device-tree.patch b/target/linux/ipq806x/patches-4.1/802-ARM-qcom-add-TP-Link-Archer-C2600-device-tree.patch
new file mode 100644
index 0000000..ada5254
--- /dev/null
+++ b/target/linux/ipq806x/patches-4.1/711-ARM-qcom-add-TP-Link-Archer-C2600-device-tree.patch
@@ -0,0 +1,300 @@
+diff -urN a/arch/arm/boot/dts/Makefile b/arch/arm/boot/dts/Makefile
+--- a/arch/arm/boot/dts/Makefile    2015-11-25 22:51:15.148899604 +0100
++++ b/arch/arm/boot/dts/Makefile    2015-12-06 14:33:31.092396982 +0100
+@@ -453,6 +453,7 @@
+     qcom-ipq8064-db149.dtb \
+     qcom-ipq8064-r7500.dtb \
+     qcom-ipq8064-d7800.dtb \
++    qcom-ipq8064-c2600.dtb \
+     qcom-msm8660-surf.dtb \
+     qcom-msm8960-cdp.dtb \
+     qcom-msm8974-sony-xperia-honami.dtb
+diff -urN a/arch/arm/boot/dts/qcom-ipq8064-c2600.dts b/arch/arm/boot/dts/qcom-ipq8064-c2600.dts
+--- a/arch/arm/boot/dts/qcom-ipq8064-c2600.dts    1970-01-01 01:00:00.000000000 +0100
++++ b/arch/arm/boot/dts/qcom-ipq8064-c2600.dts    2015-12-06 14:20:05.152365670 +0100
+@@ -0,0 +1,285 @@
++#include &quot;qcom-ipq8064-v1.0.dtsi&quot;
++#include &lt;dt-bindings/input/input.h&gt;
++
++/ {
++    model = &quot;TP-Link Archer C2600&quot;;
++    compatible = &quot;tplink,c2600&quot;, &quot;qcom,ipq8064&quot;;
++
++    memory@0 {
++        reg = &lt;0x42000000 0x1e000000&gt;;
++        device_type = &quot;memory&quot;;
++    };
++
++    reserved-memory {
++        #address-cells = &lt;1&gt;;
++        #size-cells = &lt;1&gt;;
++        ranges;
++        rsvd@41200000 {
++            reg = &lt;0x41200000 0x300000&gt;;
++            no-map;
++        };
++    };
++
++    aliases {
++        serial0 = &amp;uart4;
++        mdio-gpio0 = &amp;mdio0;
++    };
++
++    chosen {
++        linux,stdout-path = &quot;serial0:115200n8&quot;;
++    };
++
++    soc {
++        pinmux@800000 {
++            i2c4_pins: i2c4_pinmux {
++                pins = &quot;gpio12&quot;, &quot;gpio13&quot;;
++                function = &quot;gsbi4&quot;;
++                bias-disable;
++            };
++
++            spi_pins: spi_pins {
++                mux {
++                    pins = &quot;gpio18&quot;, &quot;gpio19&quot;, &quot;gpio21&quot;;
++                    function = &quot;gsbi5&quot;;
++                    drive-strength = &lt;10&gt;;
++                    bias-none;
++                };
++            };
++
++            nand_pins: nand_pins {
++                mux {
++                    pins = &quot;gpio34&quot;, &quot;gpio35&quot;, &quot;gpio36&quot;,
++                           &quot;gpio37&quot;, &quot;gpio38&quot;, &quot;gpio39&quot;,
++                           &quot;gpio40&quot;, &quot;gpio41&quot;, &quot;gpio42&quot;,
++                           &quot;gpio43&quot;, &quot;gpio44&quot;, &quot;gpio45&quot;,
++                           &quot;gpio46&quot;, &quot;gpio47&quot;;
++                    function = &quot;nand&quot;;
++                    drive-strength = &lt;10&gt;;
++                    bias-disable;
++                };
++
++                pullups {
++                    pins = &quot;gpio39&quot;;
++                    bias-pull-up;
++                };
++
++                hold {
++                    pins = &quot;gpio40&quot;, &quot;gpio41&quot;, &quot;gpio42&quot;,
++                           &quot;gpio43&quot;, &quot;gpio44&quot;, &quot;gpio45&quot;,
++                           &quot;gpio46&quot;, &quot;gpio47&quot;;
++                    bias-bus-hold;
++                };
++            };
++
++            mdio0_pins: mdio0_pins {
++                mux {
++                    pins = &quot;gpio0&quot;, &quot;gpio1&quot;;
++                    function = &quot;gpio&quot;;
++                    drive-strength = &lt;8&gt;;
++                    bias-disable;
++                };
++            };
++
++            rgmii2_pins: rgmii2_pins {
++                mux {
++                    pins = &quot;gpio27&quot;, &quot;gpio28&quot;, &quot;gpio29&quot;, &quot;gpio30&quot;, &quot;gpio31&quot;, &quot;gpio32&quot;,
++                           &quot;gpio51&quot;, &quot;gpio52&quot;, &quot;gpio59&quot;, &quot;gpio60&quot;, &quot;gpio61&quot;, &quot;gpio62&quot; ;
++                    function = &quot;rgmii2&quot;;
++                    drive-strength = &lt;8&gt;;
++                    bias-disable;
++                };
++            };
++        };
++
++        gsbi@16300000 {
++            qcom,mode = &lt;GSBI_PROT_I2C_UART&gt;;
++            status = &quot;ok&quot;;
++            serial@16340000 {
++                status = &quot;ok&quot;;
++            };
++            /*
++             * The i2c device on gsbi4 should not be enabled.
++             * On ipq806x designs gsbi4 i2c is meant for exclusive
++             * RPM usage. Turning this on in kernel manifests as
++             * i2c failure for the RPM.
++             */
++        };
++
++        gsbi5: gsbi@1a200000 {
++            qcom,mode = &lt;GSBI_PROT_SPI&gt;;
++            status = &quot;ok&quot;;
++
++            spi4: spi@1a280000 {
++                status = &quot;ok&quot;;
++                spi-max-frequency = &lt;50000000&gt;;
++
++                pinctrl-0 = &lt;&amp;spi_pins&gt;;
++                pinctrl-names = &quot;default&quot;;
++
++                cs-gpios = &lt;&amp;qcom_pinmux 20 0&gt;;
++
++                flash: m25p80@0 {
++                    compatible = &quot;s25fl256s1&quot;;
++                    #address-cells = &lt;1&gt;;
++                    #size-cells = &lt;1&gt;;
++                    spi-max-frequency = &lt;50000000&gt;;
++                    reg = &lt;0&gt;;
++
++                    linux,part-probe = &quot;qcom-smem&quot;;
++                };
++            };
++        };
++
++        phy@100f8800 {        /* USB3 port 1 HS phy */
++            status = &quot;ok&quot;;
++        };
++
++        phy@100f8830 {        /* USB3 port 1 SS phy */
++            status = &quot;ok&quot;;
++        };
++
++        phy@110f8800 {        /* USB3 port 0 HS phy */
++            status = &quot;ok&quot;;
++        };
++
++        phy@110f8830 {        /* USB3 port 0 SS phy */
++            status = &quot;ok&quot;;
++        };
++
++        usb30@0 {
++            status = &quot;ok&quot;;
++        };
++
++        usb30@1 {
++            status = &quot;ok&quot;;
++        };
++
++        pcie0: pci@1b500000 {
++            status = &quot;ok&quot;;
++            phy-tx0-term-offset = &lt;7&gt;;
++        };
++
++        pcie1: pci@1b700000 {
++            status = &quot;ok&quot;;
++            phy-tx0-term-offset = &lt;7&gt;;
++        };
++
++        mdio0: mdio {
++            compatible = &quot;virtual,mdio-gpio&quot;;
++            #address-cells = &lt;1&gt;;
++            #size-cells = &lt;0&gt;;
++            gpios = &lt;&amp;qcom_pinmux 1 0 &amp;qcom_pinmux 0 0&gt;;
++            pinctrl-0 = &lt;&amp;mdio0_pins&gt;;
++            pinctrl-names = &quot;default&quot;;
++
++            phy0: ethernet-phy@0 {
++                device_type = &quot;ethernet-phy&quot;;
++                reg = &lt;0&gt;;
++                qca,ar8327-initvals = &lt;
++                    0x00004 0x7600000   /* PAD0_MODE */
++                    0x00008 0x1000000   /* PAD5_MODE */
++                    0x0000c 0x80        /* PAD6_MODE */
++                    0x000e4 0xaa545     /* MAC_POWER_SEL */
++                    0x000e0 0xc74164de  /* SGMII_CTRL */
++                    0x0007c 0x4e        /* PORT0_STATUS */
++                    0x00094 0x4e        /* PORT6_STATUS */
++                    &gt;;
++            };
++
++            phy4: ethernet-phy@4 {
++                device_type = &quot;ethernet-phy&quot;;
++                reg = &lt;4&gt;;
++            };
++        };
++
++        gmac1: ethernet@37200000 {
++            status = &quot;ok&quot;;
++            phy-mode = &quot;rgmii&quot;;
++            qcom,id = &lt;1&gt;;
++
++            pinctrl-0 = &lt;&amp;rgmii2_pins&gt;;
++            pinctrl-names = &quot;default&quot;;
++
++            fixed-link {
++                speed = &lt;1000&gt;;
++                full-duplex;
++            };
++        };
++
++        gmac2: ethernet@37400000 {
++            status = &quot;ok&quot;;
++            phy-mode = &quot;sgmii&quot;;
++            qcom,id = &lt;2&gt;;
++
++            fixed-link {
++                speed = &lt;1000&gt;;
++                full-duplex;
++            };
++        };
++    };
++        
++    gpio-keys {
++        compatible = &quot;gpio-keys&quot;;
++
++        wifi {
++            label = &quot;wifi&quot;;
++            gpios = &lt;&amp;qcom_pinmux 49 1&gt;;
++            linux,code = &lt;KEY_WLAN&gt;;
++        };
++
++        reset {
++            label = &quot;reset&quot;;
++            gpios = &lt;&amp;qcom_pinmux 64 1&gt;;
++            linux,code = &lt;KEY_RESTART&gt;;
++        };
++
++        wps {
++            label = &quot;wps&quot;;
++            gpios = &lt;&amp;qcom_pinmux 65 1&gt;;
++            linux,code = &lt;KEY_WPS_BUTTON&gt;;
++        };
++                ledgeneral {
++            label = &quot;ledgeneral&quot;;
++            gpios = &lt;&amp;qcom_pinmux 16 1&gt;;
++            linux,code = &lt;KEY_DOLLAR&gt;;
++        };
++    };
++
++    gpio-leds {
++        compatible = &quot;gpio-leds&quot;;
++
++        lan {
++            label = &quot;lan:blue&quot;;
++            gpios = &lt;&amp;qcom_pinmux 6 0&gt;;
++        };
++                usb4 {
++            label = &quot;usb_4:blue&quot;;
++            gpios = &lt;&amp;qcom_pinmux 7 0&gt;;
++        };
++                usb2 {
++            label = &quot;usb_2:blue&quot;;
++            gpios = &lt;&amp;qcom_pinmux 8 0&gt;;
++        };
++                wps {
++            label = &quot;wps:blue&quot;;
++            gpios = &lt;&amp;qcom_pinmux 9 0&gt;;
++        };
++                wan_blue {
++            label = &quot;wan:blue&quot;;
++            gpios = &lt;&amp;qcom_pinmux 33 1&gt;;
++        };
++                status {
++            label = &quot;status:blue&quot;;
++            gpios = &lt;&amp;qcom_pinmux 53 0&gt;;
++            default-state = &quot;on&quot;;
++        };
++                ledgnr {
++            label = &quot;ledgnr:blue&quot;;
++            gpios = &lt;&amp;qcom_pinmux 66 0&gt;;
++        };
++        };
++};
++
++&amp;adm_dma {
++    status = &quot;ok&quot;;
++};
diff --git a/target/linux/ipq806x/profiles/tplink.mk b/target/linux/ipq806x/profiles/tplink.mk
new file mode 100644
index 0000000..d3f5a6c
--- /dev/null
+++ b/target/linux/ipq806x/profiles/tplink.mk
@@ -0,0 +1,20 @@
+#
+# Copyright (c) 2014 The Linux Foundation. All rights reserved.
+# Copyright (C) 2009 OpenWrt.org
+#
+# This is free software, licensed under the GNU General Public License v2.
+# See /LICENSE for more information.
+#
+
+define Profile/C2600
+    NAME:=TP-Link Archer C2600
+    PACKAGES:= \
+        kmod-usb-core kmod-usb-ohci kmod-usb2 kmod-ledtrig-usbdev \
+        kmod-usb3 kmod-usb-dwc3-qcom kmod-usb-phy-qcom-dwc3 \
+        kmod-ath10k ath10k-firmware-qca99x0 wpad-mini
+endef
+
+define Profile/C2600/Description
+    Package set for the TP-Link Archer C2600.
+endef
+$(eval $(call Profile,C2600))
diff --git a/tools/firmware-utils/src/tplink-safeloader.c b/tools/firmware-utils/src/tplink-safeloader.c
index 77a894b..f43ffd5 100644
--- a/tools/firmware-utils/src/tplink-safeloader.c
+++ b/tools/firmware-utils/src/tplink-safeloader.c
@@ -105,6 +105,8 @@ static const uint8_t md5_salt[16] = {
 /** Vendor information for CPE210/220/510/520 */
 static const char cpe510_vendor[] = &quot;CPE510(TP-LINK|UN|N300-5):1.0\r\n&quot;;
 
+/** Vendor information for C2600 */
+static const char c2600_vendor[] = &quot;&quot;;
 
 /**
     The flash partition table for CPE210/220/510/520;
@@ -128,6 +130,39 @@ static const struct flash_partition_entry cpe510_partitions[] = {
 };
 
 /**
+    The flash partition table for C2600;
+    it is the same as the one used by the stock images.
+*/
+static const struct flash_partition_entry c2600_partitions[] = {
+        {&quot;SBL1&quot;, 0x00000, 0x20000},
+        {&quot;MIBIB&quot;, 0x20000, 0x20000},
+        {&quot;SBL2&quot;, 0x40000, 0x20000},
+        {&quot;SBL3&quot;, 0x60000, 0x30000},
+        {&quot;DDRCONFIG&quot;, 0x90000, 0x10000},
+        {&quot;SSD&quot;, 0xa0000, 0x10000},
+        {&quot;TZ&quot;, 0xb0000, 0x30000},
+        {&quot;RPM&quot;, 0xe0000, 0x20000},
+        {&quot;fs-uboot&quot;, 0x100000, 0x70000},
+        {&quot;uboot-env&quot;, 0x170000, 0x40000},
+        {&quot;radio&quot;, 0x1b0000, 0x40000},
+        {&quot;os-image&quot;, 0x1f0000, 0x200000},
+        {&quot;file-system&quot;, 0x3f0000, 0x1b00000},
+        {&quot;default-mac&quot;, 0x1ef0000, 0x00200},
+        {&quot;pin&quot;, 0x1ef0200, 0x00200},
+        {&quot;product-info&quot;, 0x1ef0400, 0x0fc00},
+        {&quot;partition-table&quot;, 0x1f00000, 0x10000},
+        {&quot;soft-version&quot;, 0x1f10000, 0x10000},
+        {&quot;support-list&quot;, 0x1f20000, 0x10000},
+        {&quot;profile&quot;, 0x1f30000, 0x10000},
+        {&quot;default-config&quot;, 0x1f40000, 0x10000},
+        {&quot;user-config&quot;, 0x1f50000, 0x40000},
+        {&quot;qos-db&quot;, 0x1f90000, 0x40000},
+        {&quot;usb-config&quot;, 0x1fd0000, 0x10000},
+        {&quot;log&quot;, 0x1fe0000, 0x20000},
+    {NULL, 0, 0}
+};
+
+/**
    The support list for CPE210/220/510/520
 */
 static const char cpe510_support_list[] =
@@ -141,6 +176,13 @@ static const char cpe510_support_list[] =
     &quot;CPE220(TP-LINK|UN|N300-2):1.0\r\n&quot;
     &quot;CPE220(TP-LINK|UN|N300-2):1.1\r\n&quot;;
 
+/**
+   The support list for C2600
+*/
+static const char c2600_support_list[] =
+    &quot;SupportList:\r\n&quot;
+    &quot;{product_name:Archer C2600,product_ver:1.0.0,special_id:00000000}\r\n&quot;;
+        
 #define error(_ret, _errno, _str, ...)                \
     do {                            \
         fprintf(stderr, _str &quot;: %s\n&quot;, ## __VA_ARGS__,    \
@@ -240,14 +282,14 @@ static struct image_partition_entry make_soft_version(uint32_t rev) {
 }
 
 /** Generates the support-list partition */
-static struct image_partition_entry make_support_list(const char *support_list) {
+static struct image_partition_entry make_support_list(const char *support_list, bool trailzero) {
     size_t len = strlen(support_list);
     struct image_partition_entry entry = alloc_image_partition(&quot;support-list&quot;, len + 9);
 
     put32(entry.data, len);
     memset(entry.data+4, 0, 4);
     memcpy(entry.data+8, support_list, len);
-    entry.data[len+8] = &#039;\xff&#039;;
+    entry.data[len+8] = trailzero ? &#039;\x00&#039; : &#039;\xff&#039;;
 
     return entry;
 }
@@ -436,6 +478,37 @@ static void * generate_sysupgrade_image(const struct flash_partition_entry *flas
     return image;
 }
 
+static void * generate_sysupgrade_image_c2600(const struct flash_partition_entry *flash_parts, const struct image_partition_entry *image_parts, size_t *len) {
+    const struct flash_partition_entry *flash_os_image = &amp;flash_parts[11];
+    const struct flash_partition_entry *flash_file_system = &amp;flash_parts[12];
+
+    const struct image_partition_entry *image_os_image = &amp;image_parts[3];
+    const struct image_partition_entry *image_file_system = &amp;image_parts[4];
+
+    assert(strcmp(flash_os_image-&gt;name, &quot;os-image&quot;) == 0);
+    assert(strcmp(flash_file_system-&gt;name, &quot;file-system&quot;) == 0);
+
+    assert(strcmp(image_os_image-&gt;name, &quot;os-image&quot;) == 0);
+    assert(strcmp(image_file_system-&gt;name, &quot;file-system&quot;) == 0);
+
+    if (image_os_image-&gt;size &gt; flash_os_image-&gt;size)
+        error(1, 0, &quot;kernel image too big (more than %u bytes)&quot;, (unsigned)flash_os_image-&gt;size);
+    if (image_file_system-&gt;size &gt; flash_file_system-&gt;size)
+        error(1, 0, &quot;rootfs image too big (more than %u bytes)&quot;, (unsigned)flash_file_system-&gt;size);
+
+    *len = flash_file_system-&gt;base - flash_os_image-&gt;base + image_file_system-&gt;size;
+
+    uint8_t *image = malloc(*len);
+    if (!image)
+        error(1, errno, &quot;malloc&quot;);
+
+    memset(image, 0xff, *len);
+
+    memcpy(image, image_os_image-&gt;data, image_os_image-&gt;size);
+    memcpy(image + flash_file_system-&gt;base - flash_os_image-&gt;base, image_file_system-&gt;data, image_file_system-&gt;size);
+
+    return image;
+}
 
 /** Generates an image for CPE210/220/510/520 and writes it to a file */
 static void do_cpe510(const char *output, const char *kernel_image, const char *rootfs_image, uint32_t rev, bool add_jffs2_eof, bool sysupgrade) {
@@ -443,7 +516,7 @@ static void do_cpe510(const char *output, const char *kernel_image, const char *
 
     parts[0] = make_partition_table(cpe510_partitions);
     parts[1] = make_soft_version(rev);
-    parts[2] = make_support_list(cpe510_support_list);
+    parts[2] = make_support_list(cpe510_support_list,false);
     parts[3] = read_file(&quot;os-image&quot;, kernel_image, false);
     parts[4] = read_file(&quot;file-system&quot;, rootfs_image, add_jffs2_eof);
 
@@ -470,6 +543,39 @@ static void do_cpe510(const char *output, const char *kernel_image, const char *
         free_image_partition(parts[i]);
 }
 
+/** Generates an image for C2600 and writes it to a file */
+static void do_c2600(const char *output, const char *kernel_image, const char *rootfs_image, uint32_t rev, bool add_jffs2_eof, bool sysupgrade) {
+    struct image_partition_entry parts[6] = {};
+
+    parts[0] = make_partition_table(c2600_partitions);
+    parts[1] = make_soft_version(rev);
+    parts[2] = make_support_list(c2600_support_list,true);
+    parts[3] = read_file(&quot;os-image&quot;, kernel_image, false);
+    parts[4] = read_file(&quot;file-system&quot;, rootfs_image, add_jffs2_eof);
+
+    size_t len;
+    void *image;
+    if (sysupgrade)
+        image = generate_sysupgrade_image_c2600(c2600_partitions, parts, &amp;len);
+    else
+        image = generate_factory_image(c2600_vendor, parts, &amp;len);
+
+    FILE *file = fopen(output, &quot;wb&quot;);
+    if (!file)
+        error(1, errno, &quot;unable to open output file&quot;);
+
+    if (fwrite(image, len, 1, file) != 1)
+        error(1, 0, &quot;unable to write output file&quot;);
+
+    fclose(file);
+
+    free(image);
+
+    size_t i;
+    for (i = 0; parts[i].name; i++)
+        free_image_partition(parts[i]);
+}
+
 
 /** Usage output */
 static void usage(const char *argv0) {
@@ -552,6 +658,8 @@ int main(int argc, char *argv[]) {
 
     if (strcmp(board, &quot;CPE510&quot;) == 0)
         do_cpe510(output, kernel_image, rootfs_image, rev, add_jffs2_eof, sysupgrade);
+    else if (strcmp(board, &quot;C2600&quot;) == 0)
+        do_c2600(output, kernel_image, rootfs_image, rev, add_jffs2_eof, sysupgrade);
     else
         error(1, 0, &quot;unsupported board %s&quot;, board);</code></pre></div><p>Is this patch complete and up to date? The ath10k stuff is partial already commited to trunk.</p><p>Everything is working fine so far except the mac address issue, which is pretty anoying. I have 6 vlans, with two ipsec tunnels bound to vti devices, multiple SSIDs with freeradius etc... But I&#039;m experiencing a kernel panic round about every 24 hours. Sometimes the device reboots by itself, sometimes I need to reset it manually. I tried to get what&#039;s going on via a logread -f, but I don&#039;t see anything there. A serial connection would be good - did anyone make progress there? Is there anything else I can try to get at least an error message?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p309908">
				<div class="post-metadata">
					<div class="post-num">Post #220</div>
					<div class="post-author">bdheaton</div>
					<div class="post-datetime">
						1 Feb 2016, 22:31					</div>
				</div>
				<div class="post-content content">
					<p>FWIW, I&#039;m installing over the US firmware. </p><p>Today&#039;s project - clean out the solder in the serial port header holes, get a header on it, and try to get a serial console running.</p><div class="quotebox"><cite>RedVortex wrote:</cite><blockquote><div class="quotebox"><cite>Heinz wrote:</cite><blockquote><p>I have the same problem.<br />C2600 v1.1<br />Firmware: <a href="http://luci.subsignal.org/~trondah/c2600/r48577/openwrt-ipq806x-C2600-squashfs-factory.bin">http://luci.subsignal.org/~trondah/c260 … actory.bin</a></p></blockquote></div><p>I&#039;m curious, what firmware from TP-Link are you using, the US or the International one ? I&#039;m asking because, by mistake, I&#039;ve installed the US one and I know it is different in some way from the International one because I cannot change the language or the country in the wireless settings anymore, it is stuck and grayed-out as United States.</p><p>Re-pushing the international one doesn&#039;t change anything, country is now fixed.</p><p>So, back to why I&#039;m asking this: maybe we cannot install OpenWRT over the US-based firmware but it works over the International one ?</p><p>I also wonder if it is possible to re-enable the country selection, if anyone knows...</p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p309920">
				<div class="post-metadata">
					<div class="post-num">Post #221</div>
					<div class="post-author">Heinz</div>
					<div class="post-datetime">
						2 Feb 2016, 00:29					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>RedVortex wrote:</cite><blockquote><p>I&#039;m curious, what firmware from TP-Link are you using, the US or the International one ? I&#039;m asking because, by mistake, I&#039;ve installed the US one and I know it is different in some way from the International one because I cannot change the language or the country in the wireless settings anymore, it is stuck and grayed-out as United States.</p><p>Re-pushing the international one doesn&#039;t change anything, country is now fixed.</p><p>So, back to why I&#039;m asking this: maybe we cannot install OpenWRT over the US-based firmware but it works over the International one ?</p><p>I also wonder if it is possible to re-enable the country selection, if anyone knows...</p></blockquote></div><p>I have firmware with fix SSH from this topic. I can change Region.</p><p>@bdheaton&nbsp; did You read this post?: <a href="https://forum.openwrt.org/viewtopic.php?pid=300116#p300116">https://forum.openwrt.org/viewtopic.php … 16#p300116</a><br />My router does not have a chip U25. You have it?</p><p>C2600 in boot have: bootargs=console=ttyHSL1,115200n8<br />What is it HSL? Bluetooth?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p309933">
				<div class="post-metadata">
					<div class="post-num">Post #222</div>
					<div class="post-author">bdheaton</div>
					<div class="post-datetime">
						2 Feb 2016, 02:12					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Heinz wrote:</cite><blockquote><p>@bdheaton&nbsp; did You read this post?: <a href="https://forum.openwrt.org/viewtopic.php?pid=300116#p300116">https://forum.openwrt.org/viewtopic.php … 16#p300116</a><br />My router does not have a chip U25. You have it?</p><p>C2600 in boot have: bootargs=console=ttyHSL1,115200n8<br />What is it HSL? Bluetooth?</p></blockquote></div><p>Yup, read that post. I don&#039;t know that U25 is germane to serial port function. If nothing else, at least 2-3 people should try getting console working before we decide it isn&#039;t possible.</p><p>HSL1 is likely just the internal device ID for a UART on the IPQ8064 SOC. Different devices refer to on-board UARTs in different way. For example, an RPI refers to the hardware UART as /dev/ttyAMA0.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p309935">
				<div class="post-metadata">
					<div class="post-num">Post #223</div>
					<div class="post-author">TeutonJon78</div>
					<div class="post-datetime">
						2 Feb 2016, 02:18					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>RedVortex wrote:</cite><blockquote><p>I&#039;m curious, what firmware from TP-Link are you using, the US or the International one ? I&#039;m asking because, by mistake, I&#039;ve installed the US one and I know it is different in some way from the International one because I cannot change the language or the country in the wireless settings anymore, it is stuck and grayed-out as United States.</p><p>Re-pushing the international one doesn&#039;t change anything, country is now fixed.</p><p>So, back to why I&#039;m asking this: maybe we cannot install OpenWRT over the US-based firmware but it works over the International one ?</p><p>I also wonder if it is possible to re-enable the country selection, if anyone knows...</p></blockquote></div><p>bendavid doesn&#039;t have the US model. The firmwares are actually identical between the US and international one, at least from the actual system files. There is a partition called product_info that I believe holds the lock to US only setup. I think that if that partial is empty, it acts as the international version. If you flash the US version, then it writes the country code to that which locks it.</p>											<p class="post-edited">(Last edited by <strong>TeutonJon78</strong> on 2 Feb 2016, 02:20)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p309946">
				<div class="post-metadata">
					<div class="post-num">Post #224</div>
					<div class="post-author">bdheaton</div>
					<div class="post-datetime">
						2 Feb 2016, 05:05					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>bdheaton wrote:</cite><blockquote><p>Today&#039;s project - clean out the solder in the serial port header holes, get a header on it, and try to get a serial console running.</p></blockquote></div><p>Taking a break from that project. The 2 holes closest to the board edge cleared relatively easily. The next two are being a &lt;insert creative language here&gt;. Given how much heat it is taking to even start to melt the solder, I&#039;m guessing they are VCC/GND vias and likely hooked to large tracks under the black solder mask (conformal coating?).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p309966">
				<div class="post-metadata">
					<div class="post-num">Post #225</div>
					<div class="post-author">tedster22</div>
					<div class="post-datetime">
						2 Feb 2016, 10:31					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>bdheaton wrote:</cite><blockquote><p>The QSDK build flashed and booted fine. (MAC addresses correct and matches sticker on hardware)<br />Arokh&#039;s R48548 build flashed and booted fine. (MAC addresses wrong as previously noted)</p></blockquote></div><p>I wonder what the difference is between builds that makes the MAC be correct on the QSDK builds? Anyone able to discover how they are accessing the MAC from the partition data? I think this is the only bugbear for me (and others) and then it will be awesome.</p><p>Cheers</p>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 9 of 49</div><nav><ul><li><a href="viewtopic.php%3Fid=54973&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=54973&amp;p=7.html">7</a></li><li><a href="viewtopic.php%3Fid=54973&amp;p=8.html">8</a></li><li class="pagination-current"><span>9</span></li><li><a href="viewtopic.php%3Fid=54973&amp;p=10.html">10</a></li><li><a href="viewtopic.php%3Fid=54973&amp;p=11.html">11</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=54973&amp;p=49.html">49</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0.001 -->

</body>
</html>