<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> openvpn - lan devices cannot ping via vpn to LAN on vpn server</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 1 May 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 2 of 2</div><nav><ul><li><a href="viewtopic.php%3Fid=51569&amp;p=1.html">1</a></li><li class="pagination-current"><span>2</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p241427">
				<div class="post-metadata">
					<div class="post-num">Post #26</div>
					<div class="post-author">garfield1022</div>
					<div class="post-datetime">
						25 Jul 2014, 13:52					</div>
				</div>
				<div class="post-content content">
					<p>ok, so here&#039;s the clients IP on tun0</p><p>tun1&nbsp; &nbsp; &nbsp; Link encap:UNSPEC&nbsp; HWaddr 00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:10.8.0.6&nbsp; P-t-P:10.8.0.5&nbsp; Mask:255.255.255.255</p><p>based on what you say, I&#039;d use:</p><p>root@OpenWrt:~# route add -net 192.168.1.0 netmask 255.255.255.0 gw 10.8.0.6<br />route: SIOCADDRT: No such process<br />root@OpenWrt:~#</p><p>but, that doesn&#039;t work......</p><p>this, works:</p><p>root@OpenWrt:~# route add -net 192.168.1.0 netmask 255.255.255.0 gw 10.8.0.2</p><p>Therefore, we can only add a route for what actually exists, on the router itself.</p><p>with that route, i *can* ping 10.8.0.6 (the IP of the client, as shown at the beginning of this post).</p><p>zxdavb has the ip schema&#039;s correct.</p><p>the server is using x.x.x.1 as IP and x.x.x.2 as the PTP address..</p><p>the client, is using x.x.x.6 as its IP and x.x.x.5 as its PTP address.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p241441">
				<div class="post-metadata">
					<div class="post-num">Post #27</div>
					<div class="post-author">qasdfdsaq</div>
					<div class="post-datetime">
						25 Jul 2014, 15:14					</div>
				</div>
				<div class="post-content content">
					<p>I still don&#039;t understand why you&#039;re using net30 when you shouldn&#039;t...</p><p>See <a href="https://community.openvpn.net/openvpn/wiki/Topology">https://community.openvpn.net/openvpn/wiki/Topology</a></p><div class="quotebox"><blockquote><p>Routing to/across the VPN range gets harder in net30 since the clients on-link network is just the /30, so an additional &quot;supernet&quot; route must be added to reach the rest of the VPN, including the server at its designated IP. This complicates routing and makes understanding the config harder.</p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p241443">
				<div class="post-metadata">
					<div class="post-num">Post #28</div>
					<div class="post-author">garfield1022</div>
					<div class="post-datetime">
						25 Jul 2014, 15:28					</div>
				</div>
				<div class="post-content content">
					<p>i see....</p><p>This is my very first bout into vpns period.... so I&#039;m not sure what topology i should be using when using client/server on openwrt, nor what my configs should look like, etc etc... this is why I was requesting a &#039;step by step&#039;, to set this up correctly, and offering $50 for that step by step, to use the most fluent config, and the non-deprecated config.... </p><p>when I tried the set up as outlined on the wiki at:</p><p><a href="http://wiki.openwrt.org/doc/howto/vpn.openvpn">http://wiki.openwrt.org/doc/howto/vpn.openvpn</a></p><p>I found, that this didn&#039;t get the two talking to each other.....</p><p>So, if there is other docs, i&#039;ve missed, or a walkthrough, step by step, using keys/crts for setting this up properly, and easily would be greatly appreciated.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p241447">
				<div class="post-metadata">
					<div class="post-num">Post #29</div>
					<div class="post-author">qasdfdsaq</div>
					<div class="post-datetime">
						25 Jul 2014, 15:41					</div>
				</div>
				<div class="post-content content">
					<p>Honestly your posts are too long for me to figure out what&#039;s going on anymore, and I&#039;ve not played around with OpenVPN for a while so my memory&#039;s a bit hazy.</p><p>Nonetheless I&#039;ll try have a play around at the weekend or just leave it in case someone else has any ideas...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p241452">
				<div class="post-metadata">
					<div class="post-num">Post #30</div>
					<div class="post-author">garfield1022</div>
					<div class="post-datetime">
						25 Jul 2014, 16:37					</div>
				</div>
				<div class="post-content content">
					<p>yea, i know my posts were long....</p><p>hence a &#039;step by step&#039; which seems to be something being &#039;avoided&#039; right now..... for some reason or another....</p><p>using ca.crt, server.crt server.key and corresponding clients, what is the BEST way to configure a client and server using openwrt, that allows cross communication?</p><p>this is what I really want.</p><p>what firewall stuff do i HAVE to have... .etc</p><p>i feel, that I&#039;m missing a key component here, but can&#039;t put my finger on it.</p><p>I tried, the vanila configs, listed on ur wiki, but still only have one way connection lan -&gt; lan (client -&gt; server only).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p241455">
				<div class="post-metadata">
					<div class="post-num">Post #31</div>
					<div class="post-author">zxdavb</div>
					<div class="post-datetime">
						25 Jul 2014, 17:05					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>qasdfdsaq wrote:</cite><blockquote><p>Is the client a Windows computer?! Net30 should only be used for Windows clients.</p><p>See <a href="https://community.openvpn.net/openvpn/wiki/Topology">https://community.openvpn.net/openvpn/wiki/Topology</a></p></blockquote></div><p>It is (essentially) <em>obligated</em> for Windows clients, and is therefore the default topology in any case.&nbsp; I doubt it is the cause of this chaps&#039; problems, it just explains why his route table are the way it is.&nbsp; I agree that the route tables would look better without it (and it may make troubleshooting easier).</p><div class="quotebox"><cite>garfield1022 wrote:</cite><blockquote><p>when I tried the set up as outlined on the wiki at:<br /><a href="http://wiki.openwrt.org/doc/howto/vpn.openvpn">http://wiki.openwrt.org/doc/howto/vpn.openvpn</a><br />I found, that this didn&#039;t get the two talking to each other.....</p></blockquote></div><p>FWIW, the wiki article (which I wrote) was never intended to create a two-way route between two subnets/supernets (a less common use-case).&nbsp; It is designed for an OpenVPN client to talk privately to an OpenVPN server with the option to utilize it as a default gateway.</p><div class="quotebox"><cite>metai wrote:</cite><blockquote><p>Having a subnet behind the client access the OpenVPN server&#039;s subnet in a CA-based setup is quite complicated. See the second part of my post at <a href="https://forum.openwrt.org/viewtopic.php?pid=216715#p216715">https://forum.openwrt.org/viewtopic.php … 15#p216715</a> and following posts, especially at the bottom of the thread for a considerably easier (although not as flexible) secret-based alternative.</p></blockquote></div><p>I thought <strong>metai</strong> gave good advice, and I see no evidence that his advice was heeded (it&#039;s a bit difficult, because there are a *lot* of posts with a *lot* of text, but not much to say, if you see what I mean, and trawling through them is painful).</p><p>Anyway, in his post, <strong>metai</strong> referred to: <a href="http://www.clearcenter.com/support/documentation/clearos_guides/connecting_networks_with_openvpn">http://www.clearcenter.com/support/docu … th_openvpn</a>, which is a good starting point.</p><p><em>Question</em>: I&#039;d be interested if you could clarify your requirements.&nbsp; I understand that you want two subnets (or collections of subnets) routing between each other over a OpenVPN tunnel, but you don&#039;t appear to have specified whether the clients in the &#039;secondary&#039; site should access the internet via a local router, or a router on the primary site.</p><p>In particular, you don&#039;t want broadcast traffic between the two, right?</p><p>For now, my advice is to take the firewall out of the equation by using broad forwarding rules like you&#039;ve previously described.&nbsp; Then, fiddle with the route tables on the end-points of the OpenVPN tunnel directly until you get what you need.&nbsp; The clients will either use the OpenVPN tunnel end-points as their default gateway (better), or have their own route table entries.&nbsp; And use shared secret authentication rather than a PKI (as previously advised).</p><p>BTW, I doubt anyone is interested in your $50, but I may be wrong...</p>											<p class="post-edited">(Last edited by <strong>zxdavb</strong> on 25 Jul 2014, 17:43)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p241462">
				<div class="post-metadata">
					<div class="post-num">Post #32</div>
					<div class="post-author">garfield1022</div>
					<div class="post-datetime">
						25 Jul 2014, 17:45					</div>
				</div>
				<div class="post-content content">
					<p>i did read through that post for metai... but i don&#039;t see any of that addressing TWO way vpn connections between client and server......</p><p>all i see, is that clients ONLY go to servers.... but not the other way around (and I do not want to use redirect gateway either).</p><p>unless, i&#039;m just not seeing that....</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p241463">
				<div class="post-metadata">
					<div class="post-num">Post #33</div>
					<div class="post-author">garfield1022</div>
					<div class="post-datetime">
						25 Jul 2014, 17:46					</div>
				</div>
				<div class="post-content content">
					<p>unless, of course, that&#039;s how vpn works anyway... client -&gt; server only connection routing.....</p><p>hehe</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p241472">
				<div class="post-metadata">
					<div class="post-num">Post #34</div>
					<div class="post-author">qasdfdsaq</div>
					<div class="post-datetime">
						25 Jul 2014, 18:32					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>zxdavb wrote:</cite><blockquote><div class="quotebox"><cite>qasdfdsaq wrote:</cite><blockquote><p>Is the client a Windows computer?! Net30 should only be used for Windows clients.</p><p>See <a href="https://community.openvpn.net/openvpn/wiki/Topology">https://community.openvpn.net/openvpn/wiki/Topology</a></p></blockquote></div><p>It is (essentially) <em>obligated</em> for Windows clients, and is therefore the default topology in any case.&nbsp; I doubt it is the cause of this chaps&#039; problems, it just explains why his route table are the way it is.&nbsp; I agree that the route tables would look better without it (and it may make troubleshooting easier).</p></blockquote></div><p>I may be wrong but the article says it&#039;s only obligated for Windows clients <em>older than 2.09, which is 7 years out of date</em>. And indeed, the main reason I was mentioning it is to make troubleshooting easier.<br /></p><div class="quotebox"><blockquote><p>FWIW, the wiki article (which I wrote) was never intended to create a two-way route between two subnets/supernets (a less common use-case).&nbsp; It is designed for an OpenVPN client to talk privately to an OpenVPN server with the option to utilize it as a default gateway.</p></blockquote></div><p>Agreed, and some other guides that do intend to create two-way communication usually use a tap bridge instead of tun.</p><div class="quotebox"><blockquote><div class="quotebox"><cite>metai wrote:</cite><blockquote><p>Having a subnet behind the client access the OpenVPN server&#039;s subnet in a CA-based setup is quite complicated. See the second part of my post at <a href="https://forum.openwrt.org/viewtopic.php?pid=216715#p216715">https://forum.openwrt.org/viewtopic.php … 15#p216715</a> and following posts, especially at the bottom of the thread for a considerably easier (although not as flexible) secret-based alternative.</p></blockquote></div><p>I thought <strong>metai</strong> gave good advice, and I see no evidence that his advice was heeded (it&#039;s a bit difficult, because there are a *lot* of posts with a *lot* of text, but not much to say, if you see what I mean, and trawling through them is painful).</p><p>Anyway, in his post, <strong>metai</strong> referred to: <a href="http://www.clearcenter.com/support/documentation/clearos_guides/connecting_networks_with_openvpn">http://www.clearcenter.com/support/docu … th_openvpn</a>, which is a good starting point.</p></blockquote></div><p>While I agree with this, it has to be mentioned PSK based OpenVPN is generally advised against and for good reason. Firstly you can only have one client connected at a time (not sure why), and secondly, compromise of the key allows decoding of all previously transmitted data ever, not just the current session.</p><div class="quotebox"><blockquote><p>BTW, I doubt anyone is interested in your $50, but I may be wrong...</p></blockquote></div><p>He may be better off paying an IT consultant :-P I used to do similar jobs for $50, but these days, meh.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p241473">
				<div class="post-metadata">
					<div class="post-num">Post #35</div>
					<div class="post-author">qasdfdsaq</div>
					<div class="post-datetime">
						25 Jul 2014, 18:33					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>garfield1022 wrote:</cite><blockquote><p>i did read through that post for metai... but i don&#039;t see any of that addressing TWO way vpn connections between client and server......</p></blockquote></div><p>The direction of the initial VPN session connection is rather irrelevant as once established communication goes both ways. Indeed it <em>has</em> two allow two way connectivity otherwise a ping (and everything else) wouldn&#039;t work in either direction.</p><p>The PSK method for all intents and purposes works the same as the setup you have now, it&#039;s just easier.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p241476">
				<div class="post-metadata">
					<div class="post-num">Post #36</div>
					<div class="post-author">garfield1022</div>
					<div class="post-datetime">
						25 Jul 2014, 18:37					</div>
				</div>
				<div class="post-content content">
					<p>understood all that.....</p><p>here is what I do have....</p><p>when on client side, I can browse ANY device that&#039;s on the server sides&#039; lan.... but not the other way around.... on the server side, i can ONLY connect to the clients VPN IP. (so in that respect *that* two way DOES work).</p><p>I&#039;m trying to set up the tunnels, so that the clients&#039; LAN devices are all accessible from the server side LAN..... </p><p>the actual TUNNEL addresses, are reachable....</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p241480">
				<div class="post-metadata">
					<div class="post-num">Post #37</div>
					<div class="post-author">metai</div>
					<div class="post-datetime">
						25 Jul 2014, 18:57					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>zxdavb wrote:</cite><blockquote><p>Anyway, in his post, <strong>metai</strong> referred to: <a href="http://www.clearcenter.com/support/documentation/clearos_guides/connecting_networks_with_openvpn">http://www.clearcenter.com/support/docu … th_openvpn</a>, which is a good starting point.</p></blockquote></div><p>I need to comment this: No, this is is not a good <em>starting point</em>, it cannot be improved or extended in any way. There is no way to go from this two-subnet setup to a three-subnet setup, or to go from the shared secret to a CA.</p><p>That being said, setting up OpenVPN servers (and clients) to share subnets in a CA-based setup is an pretty much an everything-must-be-right-to-the-letter scenario. I found that if one deviates only slightly from the required setup, one experiences problems like the OP. However, the setup is actually spelt out in post #7 in the other thread, <a href="https://forum.openwrt.org/viewtopic.php?pid=217369#p217369">https://forum.openwrt.org/viewtopic.php … 69#p217369</a> (nota bene: &quot;client&quot; as in &quot;/etc/openvpn/ccd/client&quot; is not a generic term, it needs to actually match the client certificate&#039;s common name, in the configuration given it just happens to be &quot;client&quot;).</p>											<p class="post-edited">(Last edited by <strong>metai</strong> on 25 Jul 2014, 19:38)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p241481">
				<div class="post-metadata">
					<div class="post-num">Post #38</div>
					<div class="post-author">metai</div>
					<div class="post-datetime">
						25 Jul 2014, 18:59					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>garfield1022 wrote:</cite><blockquote><p>when on client side, I can browse ANY device that&#039;s on the server sides&#039; lan.... but not the other way around.... on the server side, i can ONLY connect to the clients VPN IP. (so in that respect *that* two way DOES work).</p></blockquote></div><p>Be more specific: By &quot;on client side&quot; do you mean on the client machine itself, or from any machine in the client subnet? Same for &quot;server side&quot;.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p241487">
				<div class="post-metadata">
					<div class="post-num">Post #39</div>
					<div class="post-author">garfield1022</div>
					<div class="post-datetime">
						25 Jul 2014, 19:47					</div>
				</div>
				<div class="post-content content">
					<p>thanks guys, for ALL your patience.... though.... i did find that in the &#039;client&#039; ccd </p><p>ifconfig-push 10.0.0.2 255.255.255.0<br />push &quot;route 192.168.88.0 255.255.255.0&quot;<br />iroute 192.168.89.0 255.255.255.0</p><p>the:</p><p>push &quot;route 192.168.88.0 255.255.255.0&quot; &lt;---</p><p>was redundant..... since its already set up in the openvpn.conf for the server itself anyway......</p><p>but, i finally got it to access BOTH lans..... sooo, if i add more, i just have to set up more routes.... in ccd folder for the &#039;client&#039; names, etc etc...</p><p>this is much like zaptel and zapata for asterisk... they too have to be seriously right-to-the-letter to work.... once one understands the ELEMENTS needed to get it working properly, its really not that difficult.&nbsp; Sorry for being confusing at times...</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 2 of 2</div><nav><ul><li><a href="viewtopic.php%3Fid=51569&amp;p=1.html">1</a></li><li class="pagination-current"><span>2</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>