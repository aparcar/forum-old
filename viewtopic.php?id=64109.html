<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Looking for Openwrt compatible router with this features</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 28 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p319100">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">alecuba16</div>
					<div class="post-datetime">
						11 Apr 2016, 12:37					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>I own a xiaomi mi mini router 580mhz/128ram wifi ralink.</p><p>But I have two main problems:</p><p>1-I cannot connect to pppoe vlan 20 (mt7620 only supports to vlan 15 max)<br />2-Wifi signal is poor , even with orangebox firmware.</p><p>I&#039;m looking for:</p><p>1-At least 128MB ram<br />2-560+mhz cpu or dual core<br />3-Strong wifi signal (Atheros is good on openwrt?)<br />4-Not too expensive, otherwise android box/rpi clone will remplace it.</p><p>My short search arrived to a good candidate: TL-WDR4310.</p><p>What is your opinion about wifi signal?</p><p>Thanks!!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p319103">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">diizzy</div>
					<div class="post-datetime">
						11 Apr 2016, 12:52					</div>
				</div>
				<div class="post-content content">
					<p>Should be fine, WDR3600 and WDR4300 are popular models, have in mind that the chinese model isn&#039;t as well documented however.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p319114">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">alecuba16</div>
					<div class="post-datetime">
						11 Apr 2016, 14:06					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>diizzy wrote:</cite><blockquote><p>Should be fine, WDR3600 and WDR4300 are popular models, have in mind that the chinese model isn&#039;t as well documented however.</p></blockquote></div><p>Thank you for your reply, I checked the WDR4300 and WDR3600 and many people complain about the range.</p><p>I&#039;m looking now the asus RT-N66U that doesn&#039;t support openwrt, but yes dd-wrt , and they said that it has build-in amplifier for wifi that delivers easy 100mW.</p><p>The final price is about $65 from china that is pretty cheap.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p319120">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">diizzy</div>
					<div class="post-datetime">
						11 Apr 2016, 15:13					</div>
				</div>
				<div class="post-content content">
					<p>That serves no purpose as your clients won&#039;t be powerful enough to transmit back and you&#039;re violating regulations (and possible the law). If you need to cover a larger area use an additional access point and/or range extender.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p319129">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">alecuba16</div>
					<div class="post-datetime">
						11 Apr 2016, 15:49					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>diizzy wrote:</cite><blockquote><p>That serves no purpose as your clients won&#039;t be powerful enough to transmit back and you&#039;re violating regulations (and possible the law). If you need to cover a larger area use an additional access point and/or range extender.</p></blockquote></div><p>I don&#039;t think that the problem is the devices, because with others old routers that I have been using they have enough powerful wifi modules to cover almost all my house area.</p><p>I was using 2 routers on my house to extend the range but due a problems with wifi roaming on some android phones(old) I&#039;m trying to cover the house with only 1 access point, plus use it as a NAS and pppoe for internet connection.</p><p>I have been using hg553 years ago (doesn&#039;t support VLAN 20 of my internet connection), and it has enough power to cover almost all my house with 100mW, and it has built-in antennas !.</p><p>Finally I will choose Asus - RT-N66U because it has built-in amplifiers to boost the output signal, plus supports VLAN 20, with 600 cpu 256 ram, I think that it will able to hold nas, pppoe and wifi tasks.</p><p>Thanks for your help.</p>											<p class="post-edited">(Last edited by <strong>alecuba16</strong> on 11 Apr 2016, 15:50)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p319137">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">stas2z</div>
					<div class="post-datetime">
						11 Apr 2016, 16:44					</div>
				</div>
				<div class="post-content content">
					<p>mt7620 supports 16 vlan table entries, any vlan id can be used<br />vlan id 20 can be used without any problem</p>											<p class="post-edited">(Last edited by <strong>stas2z</strong> on 11 Apr 2016, 16:45)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p319143">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">alecuba16</div>
					<div class="post-datetime">
						11 Apr 2016, 17:24					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>stas2z wrote:</cite><blockquote><p>mt7620 supports 16 vlan table entries, any vlan id can be used<br />vlan id 20 can be used without any problem</p></blockquote></div><p>Do you have MT7620A? because I was thinking the same idea like you, and this is one of the reasons that I have bougth the xiaomi mi router mini. But Is not possible , the maximum value is 15 and if you flash a unlocked firmware that let you to put any value bigger than 15 like orangebox it doesn&#039;t work.</p><p>Check the registers for vlan (0:3).</p><p><a href="https://www.anz.ru/files/mediatek/MT7620_ProgrammingGuide.pdf">https://www.anz.ru/files/mediatek/MT762 â€¦ gGuide.pdf</a></p><p>As you can see you have 4 bits to codificate vlan_id this is 2^4 = 16, so the possible values are 0-15 (0000 to 1111).</p>											<p class="post-edited">(Last edited by <strong>alecuba16</strong> on 11 Apr 2016, 17:27)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p319146">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">stas2z</div>
					<div class="post-datetime">
						11 Apr 2016, 17:41					</div>
				</div>
				<div class="post-content content">
					<p>is 12 bit (4096) enuff for your vlan id number?</p><p><span class="postimg"><img src="http://storage6.static.itmages.com/i/16/0411/h_1460385652_9771080_7aad760ca3.png" alt="http://storage6.static.itmages.com/i/16/0411/h_1460385652_9771080_7aad760ca3.png" /></span></p>											<p class="post-edited">(Last edited by <strong>stas2z</strong> on 11 Apr 2016, 17:41)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p319149">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">alecuba16</div>
					<div class="post-datetime">
						11 Apr 2016, 17:55					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>stas2z wrote:</cite><blockquote><p>is 12 bit (4096) enuff for your vlan id number?</p><p><span class="postimg"><img src="http://storage6.static.itmages.com/i/16/0411/h_1460385652_9771080_7aad760ca3.png" alt="http://storage6.static.itmages.com/i/16/0411/h_1460385652_9771080_7aad760ca3.png" /></span></p></blockquote></div><p>What you are showing here it must be enough range, but isn&#039;t working with VLAN 20.</p><p>I tested with 4 different openwrt routers that I have here(but poor wifi signal) and all of them is working except MT7620 with original FW / openwrt / pandorabox ( from StrangeOrange).</p><p>So or documentation has a mistake or the xiaomi doesn&#039;t have MT7620... or neither of available FW for it is well implemented.</p><p>Just testing a vlan between two of my routers with VLAN id 18 and xiaomi doesn&#039;t do nothing, like there is no packet received, the other side shows packed 100% lost, if i change the xiaomi with another router and its ok.</p><p>Checking the documentation again I see just at start of documentation:</p><p><span class="postimg"><img src="http://i.imgur.com/JyVBQUG.png" alt="http://i.imgur.com/JyVBQUG.png" /></span></p><p>More...</p><p><span class="postimg"><img src="http://i.imgur.com/voXcrro.png" alt="http://i.imgur.com/voXcrro.png" /></span></p><p>Following the VLAN section, if you scroll a little bit you will find this:</p><p><span class="postimg"><img src="http://i.imgur.com/NoXnmaj.png" alt="http://i.imgur.com/NoXnmaj.png" /></span></p><p>We have to consider that documentation might contains errors too as my experience with microchip&#039;s microcontrollers, like in some versions of 18F they just copy pasted tables with description of working interrupts on some pin/port, but in manufactured chips doesn&#039;t have physical connection of that port/pin to interrupts vector. <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p>											<p class="post-edited">(Last edited by <strong>alecuba16</strong> on 11 Apr 2016, 18:11)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p319153">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">stas2z</div>
					<div class="post-datetime">
						11 Apr 2016, 18:10					</div>
				</div>
				<div class="post-content content">
					<p>it&#039;s a vlan <strong>table index</strong>, not a vlan id in case of mt7620</p><p>for mt7621 vtcr value will be a bit different, the same bit 31 and 12 is set and lower 12 bit is a vlan id (cuz mt7530 gsw supports vlan4k)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p319154">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">alecuba16</div>
					<div class="post-datetime">
						11 Apr 2016, 18:14					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>stas2z wrote:</cite><blockquote><p>it&#039;s a vlan <strong>table index</strong>, not a vlan id in case of mt7620</p><p>for mt7621 vtcr value will be a bit different, the same bit 31 and 12 is set and lower 12 bit is a vlan id (cuz mt7530 gsw supports vlan4k)</p></blockquote></div><p>As I wrote in previous reply (edited) I have tested a minutes ago vlan between two openwrt routers(one of them xiaomi) with vlan id 18. and it doesn&#039;t work, is like no package from one to another.</p><p>If I change xiaomi by other it works (packet received), is not a configuration problem because I swapped tagged and untagged flags if there is some problem about this.</p><p>I we consider the documentation is ok, then it must be a bad implementation of switch driver , on openwrt fw. Or even a defective HW? but switch is working ok with vlan 1.</p>											<p class="post-edited">(Last edited by <strong>alecuba16</strong> on 11 Apr 2016, 18:17)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p319155">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">stas2z</div>
					<div class="post-datetime">
						11 Apr 2016, 18:18					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>alecuba16 wrote:</cite><blockquote><p>I we consider the documentation is ok, then it must be a bad implementation of switch driver , on openwrt fw.</p></blockquote></div><p>seems like, ive checked mediatek switch utility source used to control esw/gsw supplied with Mediatek SDK, and im absolutely right, 4 bits used is a vlan table index, not a vlan id for mt7620.</p><p>for mt7530 gsw<br /></p><div class="codebox"><pre><code>    value = (0x80001000 + cvid);  //w_vid_cmd
    reg_write(REG_ESW_VLAN_VTCR, value);

    wait_vtcr();</code></pre></div><p>for mt7620 built-in esw<br /></p><div class="codebox"><pre><code>    value = (0x80001000 + idx);  //w_vid_cmd
    reg_write(REG_ESW_VLAN_VTCR, value);

    wait_vtcr();</code></pre></div><br /><p>and here the code used to write vlan id to the vlan table with given index<br /></p><div class="codebox"><pre><code>    // set vlan identifier
    reg_read(REG_ESW_VLAN_ID_BASE + 4*(idx/2), &amp;vlan_id);
    if ((idx % 2) == 0) {
        vlan_id &amp;= 0xfff000;
        vlan_id |= cvid;
    } else {
        vlan_id &amp;= 0xfff;
        vlan_id |= (cvid &lt;&lt; 12);
    }
    reg_write(REG_ESW_VLAN_ID_BASE + 4*(idx/2), vlan_id);</code></pre></div><p>this code is missed for mt7530 gsw which supports writing vlan id directly to vtcr (without table)</p>											<p class="post-edited">(Last edited by <strong>stas2z</strong> on 11 Apr 2016, 18:31)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p319160">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">stas2z</div>
					<div class="post-datetime">
						11 Apr 2016, 18:38					</div>
				</div>
				<div class="post-content content">
					<p>btw, ive checked openwrt driver code and found simillar part, so it should work as expected</p><div class="codebox"><pre><code>#define REG_ESW_VLAN_VTIM(x)    (0x100 + 4 * ((x) / 2))
// 0x100 is REG_ESW_VLAN_ID_BASE

...

        /* vid of vlan */
        val = mt7530_r32(priv, REG_ESW_VLAN_VTIM(i));
        if (i % 2 == 0) {
            val &amp;= 0xfff000;
            val |= vid;
        } else {
            val &amp;= 0xfff;
            val |= (vid &lt;&lt; 12);
        }
        mt7530_w32(priv, REG_ESW_VLAN_VTIM(i), val);</code></pre></div><p>where i - table index and vid - actual vlan id</p>											<p class="post-edited">(Last edited by <strong>stas2z</strong> on 11 Apr 2016, 18:43)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p319163">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">alecuba16</div>
					<div class="post-datetime">
						11 Apr 2016, 18:42					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>stas2z wrote:</cite><blockquote><div class="quotebox"><cite>alecuba16 wrote:</cite><blockquote><p>I we consider the documentation is ok, then it must be a bad implementation of switch driver , on openwrt fw.</p></blockquote></div><p>seems like, ive checked mediatek switch utility source used to control esw/gsw supplied with Mediatek SDK, and im absolutely right, 4 bits used is a vlan table index, not a vlan id for mt7620.</p><p>for mt7530 gsw<br /></p><div class="codebox"><pre><code>    value = (0x80001000 + cvid);  //w_vid_cmd
    reg_write(REG_ESW_VLAN_VTCR, value);

    wait_vtcr();</code></pre></div><p>for mt7620 built-in esw<br /></p><div class="codebox"><pre><code>    value = (0x80001000 + idx);  //w_vid_cmd
    reg_write(REG_ESW_VLAN_VTCR, value);

    wait_vtcr();</code></pre></div></blockquote></div><p>I see,</p><p>Just checking inside the file swtich_rt305x.c I have found something that can be relationed with vlan</p><p><a href="https://github.com/hynnet/openwrt-mt7620/blob/56d740bd5c0d66bedf927df5e181ca68f2dfd3b2/package/ralink-utils/src/switch_rt305x.c#L382-386">https://github.com/hynnet/openwrt-mt762 â€¦ c#L382-386</a></p><p>He is jumping in groups of 4 </p><p>But I see on lines 441-445 that is what you said 4096.</p><p><a href="https://github.com/hynnet/openwrt-mt7620/blob/56d740bd5c0d66bedf927df5e181ca68f2dfd3b2/package/ralink-utils/src/switch_rt305x.c#L441-445">https://github.com/hynnet/openwrt-mt762 â€¦ c#L441-445</a></p><p>But it doesn&#039;t work I have reflashed the openwrt and original many times the past weekend, changed the configuration many times but nothing no PPPoE with vlan 20. Today I tested between openwrt routers and nothing..</p>											<p class="post-edited">(Last edited by <strong>alecuba16</strong> on 11 Apr 2016, 18:47)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p319164">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">stas2z</div>
					<div class="post-datetime">
						11 Apr 2016, 18:46					</div>
				</div>
				<div class="post-content content">
					<p>no, rt305x have a different switch</p><p>here is code i mentioned<br /><a href="https://github.com/hynnet/openwrt-mt7620/blob/56d740bd5c0d66bedf927df5e181ca68f2dfd3b2/package/ralink-utils/src/switch_gsw.c#L2170-L2180">https://github.com/hynnet/openwrt-mt762 â€¦ 2170-L2180</a></p><p>and here<br /><a href="https://github.com/hynnet/openwrt-mt7620/blob/56d740bd5c0d66bedf927df5e181ca68f2dfd3b2/package/ralink-utils/src/switch_gsw.c#L2255-L2256">https://github.com/hynnet/openwrt-mt762 â€¦ 2255-L2256</a></p>											<p class="post-edited">(Last edited by <strong>stas2z</strong> on 11 Apr 2016, 18:49)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p319166">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">alecuba16</div>
					<div class="post-datetime">
						11 Apr 2016, 18:54					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>stas2z wrote:</cite><blockquote><p>no, rt305x have a different switch</p><p>here is code i mentioned<br /><a href="https://github.com/hynnet/openwrt-mt7620/blob/56d740bd5c0d66bedf927df5e181ca68f2dfd3b2/package/ralink-utils/src/switch_gsw.c#L2170-L2180">https://github.com/hynnet/openwrt-mt762 â€¦ 2170-L2180</a></p><p>and here<br /><a href="https://github.com/hynnet/openwrt-mt7620/blob/56d740bd5c0d66bedf927df5e181ca68f2dfd3b2/package/ralink-utils/src/switch_gsw.c#L2255-L2256">https://github.com/hynnet/openwrt-mt762 â€¦ 2255-L2256</a></p></blockquote></div><p>Ok so each jump of 4 holds two vlan idx this is why the shift of 12 depending if its even or odd</p><p>Since this I don&#039;t know why isn&#039;t working for me.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p319167">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">stas2z</div>
					<div class="post-datetime">
						11 Apr 2016, 18:57					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>alecuba16 wrote:</cite><blockquote><p>Ok so each jump of 4 holds two vlan idx this is why the shift of 12 depending if its even or odd</p><p>Since this I don&#039;t know why isn&#039;t working for me.</p></blockquote></div><p>yep, exactly <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /><br />and as you can see it implemented right as documented<br />btw this switch utility code is outdated (no gsw support), but common logic is not changed for mt7620</p>											<p class="post-edited">(Last edited by <strong>stas2z</strong> on 11 Apr 2016, 18:59)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p319185">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">tmo26</div>
					<div class="post-datetime">
						11 Apr 2016, 20:33					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>stas2z wrote:</cite><blockquote><p>mt7620 supports 16 vlan table entries</p></blockquote></div><p>Unrelated to this thread, but related to the VLAN entries in the ToH:</p><p>Does the above mean, that all devices with SoC = MT7620x should have VLAN = YES?</p><div class="codebox"><pre><code>https://wiki.openwrt.org/toh/views/toh_extended_all?datasrt=platform&amp;dataflt[Platform*~]=7620</code></pre></div><br /><p>Is VLAN capability a characteristic of the SoC or of the switch?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p319190">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">stas2z</div>
					<div class="post-datetime">
						11 Apr 2016, 20:51					</div>
				</div>
				<div class="post-content content">
					<p>any mt7620 (mt7620n or mt7620a) have an internal 5 port esw, this esw supports 16 vlan entries (vlan id 0-4095), so yes, generally all 7620 devices are vlan capable. One note i wanna mention - mt7620a devices have additional&nbsp; 2xRGMII and sometimes it used to connect external gsw (like archer c2) so in such case vlan capabilities will depend on external switch chip.</p>											<p class="post-edited">(Last edited by <strong>stas2z</strong> on 11 Apr 2016, 20:53)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>