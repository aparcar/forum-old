<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> [Solved] Strange issue with sqm-scripts</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 28 Apr 2018 and 30 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 2 of 2</div><nav><ul><li><a href="viewtopic.php%3Fid=64812&amp;p=1.html">1</a></li><li class="pagination-current"><span>2</span></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p326521">
				<div class="post-metadata">
					<div class="post-num">Post #26</div>
					<div class="post-author">m45t3r</div>
					<div class="post-datetime">
						31 May 2016, 00:52					</div>
				</div>
				<div class="post-content content">
					<p>Just FYI, this seems to be the commit from which my cake is compiled (just looked at <a href="https://github.com/dtaht/ceropackages-3.10/blob/master/net/kmod-sched-cake/Makefile">Makefile</a>): <a href="https://github.com/dtaht/sch_cake/commit/008a2764270b9bd9bc5c3f7216ec7e2b92b763b5">https://github.com/dtaht/sch_cake/commi … 2b92b763b5</a></p><p>So it is not that old, and it seems that mostly that we have after that was code cleanups. So I don&#039;t know if it would help too much to update sch_cake (however if you think it will do, I can try).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p326523">
				<div class="post-metadata">
					<div class="post-num">Post #27</div>
					<div class="post-author">m45t3r</div>
					<div class="post-datetime">
						31 May 2016, 01:19					</div>
				</div>
				<div class="post-content content">
					<p>Some top tests:</p><p>Idle<br /></p><div class="codebox"><pre><code>Mem: 22428K used, 6684K free, 608K shrd, 1328K buff, 2792K cached
CPU:   0% usr   1% sys   0% nic  98% idle   0% io   0% irq   0% sirq
Load average: 0.80 1.24 0.59 1/44 6566</code></pre></div><p>While running netperfrunner.sh<br /></p><div class="codebox"><pre><code>Mem: 25004K used, 4108K free, 612K shrd, 1480K buff, 2868K cached
CPU:   0% usr   4% sys   0% nic  81% idle   0% io   0% irq  12% sirq
Load average: 0.51 1.12 0.58 1/54 6592</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p326537">
				<div class="post-metadata">
					<div class="post-num">Post #28</div>
					<div class="post-author">m45t3r</div>
					<div class="post-datetime">
						31 May 2016, 06:12					</div>
				</div>
				<div class="post-content content">
					<p>So from this topic: <a href="https://lists.bufferbloat.net/pipermail/cake/2016-January/001796.html">https://lists.bufferbloat.net/pipermail … 01796.html</a></p><div class="quotebox"><blockquote><p>Non-NAT should work fine, once I’ve fixed the algorithm.&nbsp; That’s a major part of what I intended triple-isolation to do.&nbsp; It still won’t isolate a given host from it’s *own* swarm traffic, unless you also apply Diffserv, but it should prevent one host from monopolising the link with a swarm.</p></blockquote></div><p>I seem to be testing triple-isolation wrong. I should run torrents in one PC, while trying to play games on another one, so cake can do its job (for now I am trying to run everything in the same PC). Now, if this works it is already great, since what I want is to avoid another tenant to run torrent and ruin the internet for everyone else. I will try this tomorrow and see if it works.</p><p>The only problem is that from this thread, as far I understand, triple-isolation does not work well with NAT, that I use here in this network. I just hope it is not the case.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p326554">
				<div class="post-metadata">
					<div class="post-num">Post #29</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						31 May 2016, 10:28					</div>
				</div>
				<div class="post-content content">
					<p>Hi m45t3r,</p><div class="quotebox"><cite>m45t3r wrote:</cite><blockquote><div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p>H<br />&nbsp; &nbsp; &nbsp; &nbsp; I believe there have been a few fixes to cake most recently that probably are not in your version, that might help a bit, I recall some symptoms were multi second stalls...</p></blockquote></div><p>I can try <a href="https://github.com/antoinedeschenes/openwrt-sqm">this repository</a> instead of ceropackages-3.10, it seems to have an up-to-date cake module. However I can&#039;t really try DD since I don&#039;t have much Flash.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; Yes, that looks pretty much up to date.<br /></p><div class="quotebox"><cite>m45t3r wrote:</cite><blockquote><div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p>&nbsp; &nbsp; &nbsp; &nbsp; Interesting, ingress.download shaping is more approximate than egress/uplink shaping in general, how does this work if you ridiculously over-shape the downstream to say 7000Kbps? Downstream shaping works better the larger the difference between real bottleneck link and artificial bottleneck is. As in reality the shaper throttle sits on the wrong end of the problematic over-sized and under-managed buffers (typically on the ISP side either at the DSLAM or at the BRAS) Maybe you could give that a try and then slowly increase bandwidth again to find a trade-off you are happy with?</p></blockquote></div><p>I tried 7000, League of Legends (a game that uses UDP packets) can still get disconnects. HTTP seems fine, though.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; Okay, so the multi second HTTP stalls are gone for good? I would then try to increase the bandwidth again until the http delay comes back (using the same stressful traffic pattern you used before), that should give you a decent estimate about the usable downlink bandwidth. Then the next step might be to figure out why &quot;League of Legends&quot; traffic still has issues... Are equipped to get a few packet captures in your network (the router itself seems too limited and without a USB port also not easily upgradeable)? It might be interesting to see, how these packets look in comparison to others... (if there is a simple differentiator that might allow to create a few LL specific filtering rules).<br />&nbsp; &nbsp; &nbsp; &nbsp; Oh, your bit-torrent client, is it using TCP or UDP? Could I convince you to also try the other?<br /></p><div class="quotebox"><cite>m45t3r wrote:</cite><blockquote><div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p>&nbsp; &nbsp; &nbsp; &nbsp; Okay that is a bit anemic, but for your connection it seems plenty. BTW when testing with top, please look at the idle value and calculate CPU usaga as 100-idle.</p></blockquote></div><p>I get something like this at load:<br /></p><div class="codebox"><pre><code>Mem: 24980K used, 4132K free, 596K shrd, 1748K buff, 5148K cached
CPU:   0% usr   0% sys   0% nic  78% idle   0% io   0% irq  20% sirq
Load average: 0.01 0.12 0.11 2/42 4270</code></pre></div></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; So according to my interpretation that is a usage of 100-78=22%, that is not much. Just for fun, have a look at that while running your bit-torrent load and while stressing the wifi (via local traffic) that should increase the CPU usage quite considerably. For such tests I tend to use &quot;top -d 1&quot; to get an updated view on the values while running a test, and then I simply aggregate the numbers in my head fuzzily (aka I eyeball it <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /> ). Control-c will end that top instance... On my wndr3700v2 wihi usage drives sirqs up and idle down, to the degree that I can saturate my 50/10 link via the LAN ports, but over wifi I use a few Mbps due to the router being to busy to process wifi to actually shape/route wan packets...<br /></p><div class="quotebox"><cite>m45t3r wrote:</cite><blockquote><div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p>&nbsp; &nbsp; &nbsp; &nbsp; I would be delighted to learn whether it does or does not work/improve things for you.</p></blockquote></div><p>It does not seem to make much of difference. Reducing the ingress rate seems to help more than this option. However only reducing ingress rate does not help in League of Legends, only HTTP/HTTPS</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; Too bad, I had great hopes for that option. Oh, do you by any chance run bit torrent and LL on the same computer? Triple-isolate will try to fairly share between internal and external host IPs, so if torrent traffic and LL live in the same internal machine, LL might be treated equal to each BT flow and given enough BT flows that will suck... I would not be amazed if HTTP traffic is &quot;saved&quot; by the new flow boost that cake offers (like fq_codel new flows get serviced first, a heuristic that often works wonders for latency critical sparse traffic). If we can either get BT traffic of LL traffic separated from each other (preferably by DSCP markings) trying layer_cake might actually have a chance to help a bit as well.<br />&nbsp; &nbsp; &nbsp; &nbsp; Final question how are the BT and LL hosts connected to your network, via LAN or WIFI/WLAN?</p><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p326585">
				<div class="post-metadata">
					<div class="post-num">Post #30</div>
					<div class="post-author">m45t3r</div>
					<div class="post-datetime">
						31 May 2016, 16:02					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p>&nbsp; &nbsp; &nbsp; &nbsp; Okay, so the multi second HTTP stalls are gone for good? I would then try to increase the bandwidth again until the http delay comes back (using the same stressful traffic pattern you used before), that should give you a decent estimate about the usable downlink bandwidth. Then the next step might be to figure out why &quot;League of Legends&quot; traffic still has issues... Are equipped to get a few packet captures in your network (the router itself seems too limited and without a USB port also not easily upgradeable)? It might be interesting to see, how these packets look in comparison to others... (if there is a simple differentiator that might allow to create a few LL specific filtering rules).</p></blockquote></div><p>More testing reveals that I still have some stalls, even on HTTP. Not really annoying however it is noticiable.</p><div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p>&nbsp; &nbsp; &nbsp; &nbsp; Oh, your bit-torrent client, is it using TCP or UDP? Could I convince you to also try the other?</p></blockquote></div><p>My client prefers UDP packets, however it uses both depending of the other client. If the other client uses only TCP my client accepts as well. BTW, I use Tixati on Windows, Transmission on Linux.</p><div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p>&nbsp; &nbsp; &nbsp; &nbsp; So according to my interpretation that is a usage of 100-78=22%, that is not much. Just for fun, have a look at that while running your bit-torrent load and while stressing the wifi (via local traffic) that should increase the CPU usage quite considerably. For such tests I tend to use &quot;top -d 1&quot; to get an updated view on the values while running a test, and then I simply aggregate the numbers in my head fuzzily (aka I eyeball it <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /> ). Control-c will end that top instance... On my wndr3700v2 wihi usage drives sirqs up and idle down, to the degree that I can saturate my 50/10 link via the LAN ports, but over wifi I use a few Mbps due to the router being to busy to process wifi to actually shape/route wan packets...</p></blockquote></div><p>With BitTorrent over WLAN I got sirq of 50%, much higher however not alarming. Could not get higher than that, however I didn&#039;t try multiple clients doing torrent, for example.</p><div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p>&nbsp; &nbsp; &nbsp; &nbsp; Too bad, I had great hopes for that option. Oh, do you by any chance run bit torrent and LL on the same computer? Triple-isolate will try to fairly share between internal and external host IPs, so if torrent traffic and LL live in the same internal machine, LL might be treated equal to each BT flow and given enough BT flows that will suck... I would not be amazed if HTTP traffic is &quot;saved&quot; by the new flow boost that cake offers (like fq_codel new flows get serviced first, a heuristic that often works wonders for latency critical sparse traffic). If we can either get BT traffic of LL traffic separated from each other (preferably by DSCP markings) trying layer_cake might actually have a chance to help a bit as well.<br />&nbsp; &nbsp; &nbsp; &nbsp; Final question how are the BT and LL hosts connected to your network, via LAN or WIFI/WLAN?</p></blockquote></div><p>I saw my mistake earlier, however even running BitTorrent over WLAN while running LoL over WAN did not improve the situation. I think the problem may be the fact that triple-isolate does not works correctly with NAT. I even tried setting up ingress to 7000, changing algorithms (tried layer_cake, got back to simple.qos and tried hsfc_lite too, both with fq_codel).</p><p>In the end, I got back to Gargoyle. SQM seems like a great idea, however without having a way to make it play well with torrents it is a no-deal for the majority of home users. I tested the same situation in Gargoyle, and got lower pings, no disconnects or stalls AND higher bandwidth (ACC works wonders here), at the expense of some manual configuration (I basically create one rule for each game based on port, and have another rule prioritizing small packets at most 576 bytes of size).</p><p>Sure it is not &quot;academic correct&quot; or something, and there is some problems with rule-based QoS since sometimes torrents is classified as priority packets, however at least it works the majority of time. BTW, I still thing SQM is the future, however at least for me it does not work yet.</p>											<p class="post-edited">(Last edited by <strong>m45t3r</strong> on 31 May 2016, 16:29)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p326591">
				<div class="post-metadata">
					<div class="post-num">Post #31</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						31 May 2016, 16:49					</div>
				</div>
				<div class="post-content content">
					<p>Hi m45t3r,</p><div class="quotebox"><cite>m45t3r wrote:</cite><blockquote><div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p>&nbsp; &nbsp; &nbsp; &nbsp; Okay, so the multi second HTTP stalls are gone for good? I would then try to increase the bandwidth again until the http delay comes back (using the same stressful traffic pattern you used before), that should give you a decent estimate about the usable downlink bandwidth. Then the next step might be to figure out why &quot;League of Legends&quot; traffic still has issues... Are equipped to get a few packet captures in your network (the router itself seems too limited and without a USB port also not easily upgradeable)? It might be interesting to see, how these packets look in comparison to others... (if there is a simple differentiator that might allow to create a few LL specific filtering rules).</p></blockquote></div><p>More testing reveals that I still have some stalls, even on HTTP. Not really annoying however it is noticiable.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; Argh, that is bad, but that might be related to recent changes in cake.<br /></p><div class="quotebox"><cite>m45t3r wrote:</cite><blockquote><div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p>&nbsp; &nbsp; &nbsp; &nbsp; Oh, your bit-torrent client, is it using TCP or UDP? Could I convince you to also try the other?</p></blockquote></div><p>My client preferes UDP packets, however it uses both depending of the other client. If the other client uses only TCP my client accepts as well. BTW, I use Tixati on Windows, Transmission on Linux.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; The idea here is to move as much torrent as possible from UDP based µTP to TCP, µTP uses the latency increase un-managed queues experience under saturating load as signal to back-off (bt torrents tries to be a good citizen), but SQM tries explicitly to minimize the latency increase thereby &quot;robbing&quot; BT of the signal it needs. So trying TCP might help.<br /></p><div class="quotebox"><cite>m45t3r wrote:</cite><blockquote><br /><div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p>&nbsp; &nbsp; &nbsp; &nbsp; So according to my interpretation that is a usage of 100-78=22%, that is not much. Just for fun, have a look at that while running your bit-torrent load and while stressing the wifi (via local traffic) that should increase the CPU usage quite considerably. For such tests I tend to use &quot;top -d 1&quot; to get an updated view on the values while running a test, and then I simply aggregate the numbers in my head fuzzily (aka I eyeball it <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /> ). Control-c will end that top instance... On my wndr3700v2 wihi usage drives sirqs up and idle down, to the degree that I can saturate my 50/10 link via the LAN ports, but over wifi I use a few Mbps due to the router being to busy to process wifi to actually shape/route wan packets...</p></blockquote></div><p>With BitTorrent over WLAN I got sirq of 50%, much higher however not alarming. Could not get higher than that, however I didn&#039;t try multiple clients doing torrent, for example.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; As ling as idle stays well above 0 I agree (also your general pattern does not look like CPU saturation)<br /></p><div class="quotebox"><cite>m45t3r wrote:</cite><blockquote><div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p>&nbsp; &nbsp; &nbsp; &nbsp; Too bad, I had great hopes for that option. Oh, do you by any chance run bit torrent and LL on the same computer? Triple-isolate will try to fairly share between internal and external host IPs, so if torrent traffic and LL live in the same internal machine, LL might be treated equal to each BT flow and given enough BT flows that will suck... I would not be amazed if HTTP traffic is &quot;saved&quot; by the new flow boost that cake offers (like fq_codel new flows get serviced first, a heuristic that often works wonders for latency critical sparse traffic). If we can either get BT traffic of LL traffic separated from each other (preferably by DSCP markings) trying layer_cake might actually have a chance to help a bit as well.<br />&nbsp; &nbsp; &nbsp; &nbsp; Final question how are the BT and LL hosts connected to your network, via LAN or WIFI/WLAN?</p></blockquote></div><p>I saw my mistake earlier, however even running BitTorrent over WLAN while running LoL over WAN did not improve the situation. I even tried setting up ingress to 7000, changing algorithms (got back to simple.qos and tried hsfc_lite too, both with fq_codel).</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; So the torrent machine and the LoL client are different machines, yet cake can not separate their traffic with the triple-isolate option? I have a hunch her; cake on the wan interface only &quot;sees&quot; the NATed internal addresses (or basically the same address) so the host isolation will not result in anything. Could you as a last test try the following:<br />connect both the LoL and the BT hosts to LAN ports on your router. And then use eth0 as interface for SQM, so instantiate SQM not on the wan interface but on the interface towards the switch. Please note that that operation will change the meaning of Download and upload direction n the SQM GUI, as these are always from the router&#039;s perspective, so make sure to switch the values. With that setup cake should now see the real internal host-IPs and actually stands a chance of attempting per IP fairness on top of per-flow fairness. We have a few more modifications of that idea using diefferent host-isolation options in cake ([ flowblind | srchost | dsthost | hosts | flows* | dual-srchost | dual-dsthost | triple-isolate ], the dual and triple options are relevant here as they promise IP and flow fairness).</p><div class="quotebox"><cite>m45t3r wrote:</cite><blockquote><br /><p>In the end, I got back to Gargoyle. SQM seems like a great idea, however without having a way to make it play well with torrents it is a no-deal for the majority of home users.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; So far BT has been a big feature request, but even more people asked for per-IP fairness (allowing to ameliorate the BT effect by running BT on a dedicated machine). Cake supposedly offers this capability, but so far that has not been tested too rigorously, I have the feeling we are close, that is why it would be great if you could help us out one last time to see whether the isolation options actually work in real life.<br />&nbsp; &nbsp; &nbsp; &nbsp; Other than that using Gargoyle is not a bad option, if one requires fine grained control.<br /></p><div class="quotebox"><cite>m45t3r wrote:</cite><blockquote><p>I tested the same situation in Gargoyle, and got lower pings, no disconnects or stalls AND higher bandwidth (ACC works wonders here), at the expense of some manual configuration (I basically create one rule for each game based on port, and have another rule prioritizing small packets at most 576 bytes of size).</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; In theory you could use the same differentiating factors to create a iptables filter that sets DSCP marks according to the same factors and then use the DSCP marks to put the traffic into different tiers. The challenge here is that on the WAN interface sqm does not see the internal ports on ingress and due to NAT the externally visible portnumbers are not gurateed to be stable (on the contrary).<br /></p><div class="quotebox"><cite>m45t3r wrote:</cite><blockquote><p>Sure it is not &quot;academic correct&quot; or something, and there is some problems with rule-based QoS since sometimes torrents is classified as priority packets, however at least it works the majority of time. BTW, I still thing SQM is the future, however at least for me it does not work yet.</p></blockquote></div><p>I agree the goal is not perfect, &quot;good enough&quot; will do just fine <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /> And currently sqm is not good enough, so we need to do more work! The idea I lead out above, with SQM on the SoC port that connects to the LAN switch might actually push sqm from where it stands now into good enough territory (and if it does not that would be important to know for the actual cake developer)...</p><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p326595">
				<div class="post-metadata">
					<div class="post-num">Post #32</div>
					<div class="post-author">m45t3r</div>
					<div class="post-datetime">
						31 May 2016, 17:01					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p>&nbsp; &nbsp; &nbsp; &nbsp; The idea here is to move as much torrent as possible from UDP based µTP to TCP, µTP uses the latency increase un-managed queues experience under saturating load as signal to back-off (bt torrents tries to be a good citizen), but SQM tries explicitly to minimize the latency increase thereby &quot;robbing&quot; BT of the signal it needs. So trying TCP might help.</p></blockquote></div><p>The problem isn&#039;t me really, the problem is the other tenants in the house. I kinda fixed the problem limiting torrent throughput, however I can&#039;t ask the same of the other tenants since they&#039;re not really computer scientists.</p><div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p>&nbsp; &nbsp; &nbsp; &nbsp; So the torrent machine and the LoL client are different machines, yet cake can not separate their traffic with the triple-isolate option? I have a hunch her; cake on the wan interface only &quot;sees&quot; the NATed internal addresses (or basically the same address) so the host isolation will not result in anything. Could you as a last test try the following:<br />connect both the LoL and the BT hosts to LAN ports on your router. And then use eth0 as interface for SQM, so instantiate SQM not on the wan interface but on the interface towards the switch. Please note that that operation will change the meaning of Download and upload direction n the SQM GUI, as these are always from the router&#039;s perspective, so make sure to switch the values. With that setup cake should now see the real internal host-IPs and actually stands a chance of attempting per IP fairness on top of per-flow fairness. We have a few more modifications of that idea using diefferent host-isolation options in cake ([ flowblind | srchost | dsthost | hosts | flows* | dual-srchost | dual-dsthost | triple-isolate ], the dual and triple options are relevant here as they promise IP and flow fairness).</p></blockquote></div><p>I may try this tomorrow, I will try with a more recent version of cake too since I will have to reflash my router anyway.</p><div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p>&nbsp; &nbsp; &nbsp; &nbsp; So far BT has been a big feature request, but even more people asked for per-IP fairness (allowing to ameliorate the BT effect by running BT on a dedicated machine). Cake supposedly offers this capability, but so far that has not been tested too rigorously, I have the feeling we are close, that is why it would be great if you could help us out one last time to see whether the isolation options actually work in real life.<br />&nbsp; &nbsp; &nbsp; &nbsp; Other than that using Gargoyle is not a bad option, if one requires fine grained control.</p></blockquote></div><p>If triple-isolation does work, it would be great. I will try changing the interface to see if it works.</p><div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p>&nbsp; &nbsp; &nbsp; &nbsp; In theory you could use the same differentiating factors to create a iptables filter that sets DSCP marks according to the same factors and then use the DSCP marks to put the traffic into different tiers. The challenge here is that on the WAN interface sqm does not see the internal ports on ingress and due to NAT the externally visible portnumbers are not gurateed to be stable (on the contrary).</p></blockquote></div><p>This would be outside my area of expertise, while I am a reasonable advanced Linux user I kinda hate iptables.</p><div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p>I agree the goal is not perfect, &quot;good enough&quot; will do just fine <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /> And currently sqm is not good enough, so we need to do more work! The idea I lead out above, with SQM on the SoC port that connects to the LAN switch might actually push sqm from where it stands now into good enough territory (and if it does not that would be important to know for the actual cake developer)...</p></blockquote></div><p>If my experience helps cake to be developed even further, I will do more tests for sure.</p>											<p class="post-edited">(Last edited by <strong>m45t3r</strong> on 31 May 2016, 17:01)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p326596">
				<div class="post-metadata">
					<div class="post-num">Post #33</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						31 May 2016, 17:22					</div>
				</div>
				<div class="post-content content">
					<p>Hi m45t3r,<br /></p><div class="quotebox"><cite>m45t3r wrote:</cite><blockquote><div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p>&nbsp; &nbsp; &nbsp; &nbsp; The idea here is to move as much torrent as possible from UDP based µTP to TCP, µTP uses the latency increase un-managed queues experience under saturating load as signal to back-off (bt torrents tries to be a good citizen), but SQM tries explicitly to minimize the latency increase thereby &quot;robbing&quot; BT of the signal it needs. So trying TCP might help.</p></blockquote></div><p>The problem isn&#039;t me really, the problem is the other tenants in the house. I kinda fixed the problem limiting torrent throughput, however I can&#039;t ask the same of the other tenants since they&#039;re not really computer scientists.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp;Mmmh, as much as I would like to argue that anybody using BT should be able to learn how to throttle it, I also realize that this is not a winning proposition. I also have heard the same argument being made often enough that I have to accept that this is real (so no use puting my finger in my ears and start singing LALALALALA, this issue is not going to solve itself).<br /></p><div class="quotebox"><cite>m45t3r wrote:</cite><blockquote><div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p>&nbsp; &nbsp; &nbsp; &nbsp; So the torrent machine and the LoL client are different machines, yet cake can not separate their traffic with the triple-isolate option? I have a hunch her; cake on the wan interface only &quot;sees&quot; the NATed internal addresses (or basically the same address) so the host isolation will not result in anything. Could you as a last test try the following:<br />connect both the LoL and the BT hosts to LAN ports on your router. And then use eth0 as interface for SQM, so instantiate SQM not on the wan interface but on the interface towards the switch. Please note that that operation will change the meaning of Download and upload direction n the SQM GUI, as these are always from the router&#039;s perspective, so make sure to switch the values. With that setup cake should now see the real internal host-IPs and actually stands a chance of attempting per IP fairness on top of per-flow fairness. We have a few more modifications of that idea using diefferent host-isolation options in cake ([ flowblind | srchost | dsthost | hosts | flows* | dual-srchost | dual-dsthost | triple-isolate ], the dual and triple options are relevant here as they promise IP and flow fairness).</p></blockquote></div><p>I may try this tomorrow, I will try with a more recent version of cake too since I will have to reflash my router anyway.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp;Oh, whenever you have time, it is rare to find someone encountering this issue who is also patient, willing and capable to actually persist in testing. I can wait, just post the results of that test once you get around to it <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /><br /></p><div class="quotebox"><cite>m45t3r wrote:</cite><blockquote><div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p>&nbsp; &nbsp; &nbsp; &nbsp; So far BT has been a big feature request, but even more people asked for per-IP fairness (allowing to ameliorate the BT effect by running BT on a dedicated machine). Cake supposedly offers this capability, but so far that has not been tested too rigorously, I have the feeling we are close, that is why it would be great if you could help us out one last time to see whether the isolation options actually work in real life.<br />&nbsp; &nbsp; &nbsp; &nbsp; Other than that using Gargoyle is not a bad option, if one requires fine grained control.</p></blockquote></div><p>If triple-isolation does work, it would be great. I will try changing the interface to see if it works.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp;Triple-isolate tries to make it simple, but in theory on ingress dual-dsthost and on egress dual-srchost should also establish fairness by internal host IPs, exactly what your setup seems to require. Triple-isolate is a clever idea by Jonathan Morton, cake&#039;s developer, that should avoid the need to specify the actual direction ingress/egress while still offering decent per-IP fairness. In my testing it worked well, but I have no bit-torrent issue to begin with (as I do rarely use BT at all <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /> ).<br /></p><div class="quotebox"><cite>m45t3r wrote:</cite><blockquote><div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p>&nbsp; &nbsp; &nbsp; &nbsp; In theory you could use the same differentiating factors to create a iptables filter that sets DSCP marks according to the same factors and then use the DSCP marks to put the traffic into different tiers. The challenge here is that on the WAN interface sqm does not see the internal ports on ingress and due to NAT the externally visible portnumbers are not gurateed to be stable (on the contrary).</p></blockquote></div><p>This would be outside my area of expertise, while I am a reasonable advanced Linux user I kinda hate iptables.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp;It also suffers from the problem that currently we do only see the NATed versions of internal IPs and ports, so this would require to instantiate SQM on the LAN interface. And that is not perfect, as it will also affect internal WIFI traffic (that needs to pass eth0 as well to reach the LAN ports, good enough for testing, but not a real solution...)<br /></p><div class="quotebox"><cite>m45t3r wrote:</cite><blockquote><div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p>I agree the goal is not perfect, &quot;good enough&quot; will do just fine <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /> And currently sqm is not good enough, so we need to do more work! The idea I lead out above, with SQM on the SoC port that connects to the LAN switch might actually push sqm from where it stands now into good enough territory (and if it does not that would be important to know for the actual cake developer)...</p></blockquote></div><p>If my experience helps cake to be developed even further, I will do more tests for sure.</p></blockquote></div><p>I for one, am quite thankful for all the tests you already performed. So kiitos?</p><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p326739">
				<div class="post-metadata">
					<div class="post-num">Post #34</div>
					<div class="post-author">m45t3r</div>
					<div class="post-datetime">
						1 Jun 2016, 16:49					</div>
				</div>
				<div class="post-content content">
					<p>Well, trying to use eth0 instead of pppoe-wan or wan give me a similar result than OP: very slow download speed in SpeedTest (~500kbps). Tried to invert ingress/egress, does not work. tc qdisc output:</p><p>Normal ingress/egress<br /></p><div class="codebox"><pre><code>root@PensionatoButui:~# tc qdisc
qdisc cake 800d: dev eth0 root refcnt 2 bandwidth 850Kbit diffserv4 triple-isolate rtt 100.0ms raw
qdisc ingress ffff: dev eth0 parent ffff:fff1 ----------------
qdisc mq 0: dev wlan0 root
qdisc fq_codel 0: dev wlan0 parent :1 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc fq_codel 0: dev wlan0 parent :2 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc fq_codel 0: dev wlan0 parent :3 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc fq_codel 0: dev wlan0 parent :4 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc fq_codel 0: dev pppoe-wan root refcnt 2 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc cake 800e: dev ifb4eth0 root refcnt 2 bandwidth 13500Kbit besteffort triple-isolate rtt 100.0ms raw</code></pre></div><p>Inverted ingress/egress<br /></p><div class="codebox"><pre><code>root@PensionatoButui:~# tc qdisc
qdisc cake 800a: dev eth0 root refcnt 2 bandwidth 13500Kbit diffserv4 triple-isolate rtt 100.0ms raw
qdisc ingress ffff: dev eth0 parent ffff:fff1 ----------------
qdisc mq 0: dev wlan0 root
qdisc fq_codel 0: dev wlan0 parent :1 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc fq_codel 0: dev wlan0 parent :2 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc fq_codel 0: dev wlan0 parent :3 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc fq_codel 0: dev wlan0 parent :4 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc fq_codel 0: dev pppoe-wan root refcnt 2 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc cake 800b: dev ifb4eth0 root refcnt 2 bandwidth 850Kbit besteffort triple-isolate rtt 100.0ms raw</code></pre></div><p>Anyway, I think I discovered why I had the issue in OP: probably applied multiple qdisc when I was trying different interfaces (since I was simply changing the interface in luci-app-sqm and clicking &quot;Save &amp; Apply&quot;). Apparently, simple doing a /etc/init.d/sqm restart does not remove the old configuration (that seems what &quot;Save &amp; Apply&quot; button does&quot;). You need to do a /etc/init.d/sqm stop AND /etc/init.d/sqm start to clean everything.</p><p>Wouldn&#039;t it be better to /etc/init.d/sqm restart clean old configuration before applying new ones, like what /etc/init.d/sqm stop and /etc/init.d/sqm start does?</p>											<p class="post-edited">(Last edited by <strong>m45t3r</strong> on 1 Jun 2016, 17:04)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p326742">
				<div class="post-metadata">
					<div class="post-num">Post #35</div>
					<div class="post-author">m45t3r</div>
					<div class="post-datetime">
						1 Jun 2016, 17:25					</div>
				</div>
				<div class="post-content content">
					<p>So I decided to set cake to br-lan interface. It kinda works:</p><div class="codebox"><pre><code>root@PensionatoButui:~# tc qdisc
qdisc fq_codel 0: dev eth0 root refcnt 2 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc cake 8046: dev br-lan root refcnt 2 bandwidth 12500Kbit diffserv4 triple-isolate rtt 100.0ms raw
qdisc ingress ffff: dev br-lan parent ffff:fff1 ----------------
qdisc mq 0: dev wlan0 root
qdisc fq_codel 0: dev wlan0 parent :1 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc fq_codel 0: dev wlan0 parent :2 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc fq_codel 0: dev wlan0 parent :3 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc fq_codel 0: dev wlan0 parent :4 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc fq_codel 0: dev pppoe-wan root refcnt 2 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc cake 8047: dev ifb4br-lan root refcnt 2 bandwidth 950Kbit besteffort triple-isolate rtt 100.0ms raw</code></pre></div><p>However, this only work in LAN, WLAN does not. And since it shapes LAN and not WAN, I think this would reduce the performance in local network too?</p><p>Anyway, in this case I can even disable triple-isolate and it works (didn&#039;t try a heavy test case, just one torrent and mostly download, but this already made LoL unresponsible). Even simple.qos+fq_codel seems to work in this case.</p><p>So I am just using the wrong interface? What would be the correct way to set in this case, considering both LAN and Wi-Fi? This is the available options: Just remember that I am using OpenWRT to actually connect via PPPoE, my ISP router is in bridge mode.</p><p><a href="http://imgur.com/e392KK9">http://imgur.com/e392KK9</a></p><p>BTW, I tried the autorate_ingress option from cake too. It seems to allow the ping to increase too much (like ~160ms, vs. ~40ms idle). I even tried to set &quot;Latency target&quot; to something like 5ms, didn&#039;t seem to work too.</p>											<p class="post-edited">(Last edited by <strong>m45t3r</strong> on 1 Jun 2016, 17:26)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p326862">
				<div class="post-metadata">
					<div class="post-num">Post #36</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						2 Jun 2016, 13:22					</div>
				</div>
				<div class="post-content content">
					<p>Hi m45t3r,</p><p>first thanks for your persistence, and sorry for being slightly distracted (I di have a day job that takes up my time...).</p><div class="quotebox"><cite>m45t3r wrote:</cite><blockquote><p>Well, trying to use eth0 instead of pppoe-wan or wan give me a similar result than OP: very slow download speed in SpeedTest (~500kbps).</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp;Ah, I was confused, pppoe-wan runs on top of eth0, so using eth0 will not help (if at all it will makes things harder as cake might have issues seeing the IP and tcp/udp headers do to the unexpected ppp/pppoe headers). Could you please post the result of:<br />cat /etc/config/network # but please remove passwords/usernames so it does not contain sensitive information<br />ifconfig</p><p>Typically, in a home router one interface is connected to the upstream/WAN (let&#039;s call thos ethWAN), on that interface we only see NATed addresses and hence triple-isolate has nothing to work with (for IPv4 that is, IPv6 might still be fine if unNATed). The CPU often is also connected to the WIFI/WLAN modules directly and also with typically a small switch via an additional ethernet interface (let&#039;s call it ethLAN). The idea to test is to set up SQM on that ethLAN instead of ethWAN, as on ethLAN cake will see the real internal IP address and has a fighting chance of separating the BT host from the LoL host. Sidenote in SQM download and upload actually refer to the point of view of the router, if instantiated on WAN than the router&#039;s view and the view of internal machines are identical, routers incoming/downoad direction is the download direction from the internet for internal machines as well. But if you instantiate SQM on a LAN interface the routers download direction is facing your internal hosts, so router ingress/downoad is you end-host upload direction (the same applies inverted for upload/egress); that is the rationale to switch the bandwidth entriies in the GUI if sqm is activated on an internal interface.<br /></p><div class="quotebox"><cite>m45t3r wrote:</cite><blockquote><p>Tried to invert ingress/egress, does not work. tc qdisc output:</p><p>Normal ingress/egress<br /></p><div class="codebox"><pre><code>root@PensionatoButui:~# tc qdisc
qdisc cake 800d: dev eth0 root refcnt 2 bandwidth 850Kbit diffserv4 triple-isolate rtt 100.0ms raw
qdisc ingress ffff: dev eth0 parent ffff:fff1 ----------------
qdisc mq 0: dev wlan0 root
qdisc fq_codel 0: dev wlan0 parent :1 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc fq_codel 0: dev wlan0 parent :2 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc fq_codel 0: dev wlan0 parent :3 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc fq_codel 0: dev wlan0 parent :4 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc fq_codel 0: dev pppoe-wan root refcnt 2 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc cake 800e: dev ifb4eth0 root refcnt 2 bandwidth 13500Kbit besteffort triple-isolate rtt 100.0ms raw</code></pre></div><p>Inverted ingress/egress<br /></p><div class="codebox"><pre><code>root@PensionatoButui:~# tc qdisc
qdisc cake 800a: dev eth0 root refcnt 2 bandwidth 13500Kbit diffserv4 triple-isolate rtt 100.0ms raw
qdisc ingress ffff: dev eth0 parent ffff:fff1 ----------------
qdisc mq 0: dev wlan0 root
qdisc fq_codel 0: dev wlan0 parent :1 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc fq_codel 0: dev wlan0 parent :2 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc fq_codel 0: dev wlan0 parent :3 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc fq_codel 0: dev wlan0 parent :4 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc fq_codel 0: dev pppoe-wan root refcnt 2 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc cake 800b: dev ifb4eth0 root refcnt 2 bandwidth 850Kbit besteffort triple-isolate rtt 100.0ms raw</code></pre></div></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp;SInce eth0 = WAN in your case that sort of was to be expected, the ingress/egress switch is not relevant here.<br /></p><div class="quotebox"><cite>m45t3r wrote:</cite><blockquote><p>Anyway, I think I discovered why I had the issue in OP: probably applied multiple qdisc when I was trying different interfaces (since I was simply changing the interface in luci-app-sqm and clicking &quot;Save &amp; Apply&quot;). Apparently, simple doing a /etc/init.d/sqm restart does not remove the old configuration (that seems what &quot;Save &amp; Apply&quot; button does&quot;). You need to do a /etc/init.d/sqm stop AND /etc/init.d/sqm start to clean everything.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp;That is weird as sqm start will stop all sqm on all active interfaces before starting up those that are configured and enabled... could you please post the output of:<br />cat /usr/lib/sqm/run.sh</p><div class="quotebox"><cite>m45t3r wrote:</cite><blockquote><p>Wouldn&#039;t it be better to /etc/init.d/sqm restart clean old configuration before applying new ones, like what /etc/init.d/sqm stop and /etc/init.d/sqm start does?</p></blockquote></div><p>As far as I can tell SQM does effectively that, so it seems there is a bug hidden there.</p><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p326863">
				<div class="post-metadata">
					<div class="post-num">Post #37</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						2 Jun 2016, 13:37					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>m45t3r wrote:</cite><blockquote><p>So I decided to set cake to br-lan interface. It kinda works:</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp;Okay, that is basically what I wanted you to test, SQM on an internal interface; this is the situation where you should switch the ingress/egress bandwidth...<br /></p><div class="quotebox"><cite>m45t3r wrote:</cite><blockquote><br /><div class="codebox"><pre><code>root@PensionatoButui:~# tc qdisc
qdisc fq_codel 0: dev eth0 root refcnt 2 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc cake 8046: dev br-lan root refcnt 2 bandwidth 12500Kbit diffserv4 triple-isolate rtt 100.0ms raw
qdisc ingress ffff: dev br-lan parent ffff:fff1 ----------------
qdisc mq 0: dev wlan0 root
qdisc fq_codel 0: dev wlan0 parent :1 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc fq_codel 0: dev wlan0 parent :2 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc fq_codel 0: dev wlan0 parent :3 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc fq_codel 0: dev wlan0 parent :4 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc fq_codel 0: dev pppoe-wan root refcnt 2 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc cake 8047: dev ifb4br-lan root refcnt 2 bandwidth 950Kbit besteffort triple-isolate rtt 100.0ms raw</code></pre></div></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp;...which I see you di.<br /></p><div class="quotebox"><cite>m45t3r wrote:</cite><blockquote><p>However, this only work in LAN, WLAN does not. And since it shapes LAN and not WAN, I think this would reduce the performance in local network too?</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp;So enabling SQM on a bridge device is not fully tested, but in theory should also affect the bridged in WLAN (assuming WLAN is bridged with LAN to begin with). But you are right this will also affect local traffic; this is why I did propose this as a worthwhile test, but not as a real solution...<br /></p><div class="quotebox"><cite>m45t3r wrote:</cite><blockquote><p>Anyway, in this case I can even disable triple-isolate and it works (didn&#039;t try a heavy test case, just one torrent and mostly download, but this already made LoL unresponsible). Even simple.qos+fq_codel seems to work in this case.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp;In this situation it would be highly interesting to see how things perform under the heavy test case (but both LoL and BT hosts need to be connected via cables, introducing WLAN connections is not going to make things easier to setup and interpret).<br /></p><div class="quotebox"><cite>m45t3r wrote:</cite><blockquote><p>So I am just using the wrong interface? What would be the correct way to set in this case, considering both LAN and Wi-Fi? This is the available options: Just remember that I am using OpenWRT to actually connect via PPPoE, my ISP router is in bridge mode.</p><p><a href="http://imgur.com/e392KK9">http://imgur.com/e392KK9</a></p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp;Ah, your router does not have a single internal LAN interface towards a switch but a number of direct connections to the LAN ports (LAN1 LAN2 ...), interesting. If you could leave it on br-lan and run your heavy tests with layer_cake/piece_of_cake and simplest/simple.qos and also try triple-isolate on both cake instances (make sure to delete this as fq_codel will fail with unknown arguments in the advanced option string fields) that would be great. In case triple-isolate does not do any good you could also try dual-srchost and dual-dsthost (the dual-dsthost should to be on the connection from the router to your LAN clients, the dual-srchost on the opposite direction; but if that does not help you could also try the reverse, the important thing is that ingress and egress need different options here)<br /></p><div class="quotebox"><cite>m45t3r wrote:</cite><blockquote><p>BTW, I tried the autorate_ingress option from cake too. It seems to allow the ping to increase too much (like ~160ms, vs. ~40ms idle). I even tried to set &quot;Latency target&quot; to something like 5ms, didn&#039;t seem to work too.</p></blockquote></div><p>I have no opinion on the functionality/suitability of the auto-rate option, nor have I tested that myself, so I would recommend to leave this disabled until the current issue is solved. Then IO would be delighted to learn about your experience with auto-rate <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" />. Not sure what you mean with &quot;Latency Target&quot; the rtt option in cake?</p><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p326894">
				<div class="post-metadata">
					<div class="post-num">Post #38</div>
					<div class="post-author">m45t3r</div>
					<div class="post-datetime">
						2 Jun 2016, 18:14					</div>
				</div>
				<div class="post-content content">
					<p>So I decided to switch to nxt_routed_hfsc.qos, after reading this description:</p><div class="quotebox"><blockquote><p><strong>nxt_routed_hfsc.qos:</strong><br />Uses a combination of HFSC and FLOW classifier to prioritize typical interactive protocols. This script is specially designed for clients behind NAT.</p></blockquote></div><p>And well, it seems to work! Not many tests made yet, however torrent running in WLAN is not affecting my gaming or web at all. I am even using fq_codel here for now, did not test cake with nxt_routed_hfsc.qos.</p><p>At least now I can do more tests without needing to flash Gargoyle/OpenWRT after each one. Gargoyle still works better since it does fair bandwidth division between clients, so I can BitTorrent in one while watching YouTube in other, and YouTube will not got to the worst quality because the BitTorrent client one will have reduced its bandwidth. But, I can live with that.</p><p>So, at least for now:<br /><strong>TL;DR</strong>, if you&#039;re suffering from bad performance in connection heavy situations (like BitTorrent) in NAT&#039;ed connections, try nxt_routed_hfsc.qos instead of simple.qos.</p>											<p class="post-edited">(Last edited by <strong>m45t3r</strong> on 2 Jun 2016, 18:18)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p326899">
				<div class="post-metadata">
					<div class="post-num">Post #39</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						2 Jun 2016, 18:45					</div>
				</div>
				<div class="post-content content">
					<p>Hi m45t3r,</p><div class="quotebox"><cite>m45t3r wrote:</cite><blockquote><p>So I decided to switch to nxt_routed_hfsc.qos, after reading this description:</p><div class="quotebox"><blockquote><p><strong>nxt_routed_hfsc.qos:</strong><br />Uses a combination of HFSC and FLOW classifier to prioritize typical interactive protocols. This script is specially designed for clients behind NAT.</p></blockquote></div><p>And well, it seems to work! Not many tests made yet, however torrent running in WLAN is not affecting my gaming or web at all. I am even using fq_codel here for now, did not test cake with nxt_routed_hfsc.qos.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; Cake will not work with nxt_routed_hfsc so do not bother trying.<br /></p><div class="quotebox"><cite>m45t3r wrote:</cite><blockquote><p>At least now I can do more tests without needing to flash Gargoyle/OpenWRT after each one. Gargoyle still works better since it does fair bandwidth division between clients, so I can BitTorrent in one while watching YouTube in other, and YouTube will not got to the worst quality because the BitTorrent client one will have reduced its bandwidth. But, I can live with that.</p><p>So, at least for now:<br /><strong>TL;DR</strong>, if you&#039;re suffering from bad performance in connection heavy situations (like BitTorrent) in NAT&#039;ed connections, try nxt_routed_hfsc.qos instead of simple.qos.</p></blockquote></div><p>Unfortunately I am not sure whether that generalizes well, but great that it worked for you.</p><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p326901">
				<div class="post-metadata">
					<div class="post-num">Post #40</div>
					<div class="post-author">m45t3r</div>
					<div class="post-datetime">
						2 Jun 2016, 18:49					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p>Unfortunately I am not sure whether that generalizes well, but great that it worked for you.</p></blockquote></div><p>Yep, it seems not. Tree of Savior (the game that I tested in that case since LoL was updating) uses TCP packets (I know, TCP for a interactive game, whatever) and seems to work ok. League of Legends uses UDP, and still have problems. Less than before (I can actually play still multi-second stalls), however you can &quot;feel&quot; that the skills are more unresponsible, and the ping goes from ~40 ms to ~150ms (ToS maintains almost the same ping in same situation).</p><p>Well, back to Gargoyle I guess.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p326914">
				<div class="post-metadata">
					<div class="post-num">Post #41</div>
					<div class="post-author">m45t3r</div>
					<div class="post-datetime">
						2 Jun 2016, 19:23					</div>
				</div>
				<div class="post-content content">
					<p>Some interesting things I discovered before I go back to Gargoyle for some time, since I am quite tired of this changing firmware thing. Disabling sqm-scripts (/etc/init.d/sqm stop), results in this configuration of tc qdisc:</p><div class="codebox"><pre><code>root@PensionatoButui:~# tc qdisc
qdisc fq_codel 0: dev eth0 root refcnt 2 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc mq 0: dev wlan0 root
qdisc fq_codel 0: dev wlan0 parent :1 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc fq_codel 0: dev wlan0 parent :2 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc fq_codel 0: dev wlan0 parent :3 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc fq_codel 0: dev wlan0 parent :4 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc fq_codel 0: dev pppoe-wan root refcnt 2 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn</code></pre></div><p>Not surprising to see fq_codel in interfaces since I think this is the default of OpenWRT. However just this seems to work better than some sqm-scripts settings I tried, no multi-second stalls and LoL working as expect (however the ping itself is quite high, ~200ms, I was expecting something like 2000ms or higher).</p><p>Finally, cake with dual-{dst,src}:<br /></p><div class="codebox"><pre><code>root@PensionatoButui:~# tc qdisc
qdisc fq_codel 0: dev eth0 root refcnt 2 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc cake 8032: dev br-lan root refcnt 2 bandwidth 13500Kbit besteffort dual-dsthost rtt 100.0ms raw
qdisc ingress ffff: dev br-lan parent ffff:fff1 ----------------
qdisc mq 0: dev wlan0 root
qdisc fq_codel 0: dev wlan0 parent :1 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc fq_codel 0: dev wlan0 parent :2 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc fq_codel 0: dev wlan0 parent :3 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc fq_codel 0: dev wlan0 parent :4 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc fq_codel 0: dev pppoe-wan root refcnt 2 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc cake 8033: dev ifb4br-lan root refcnt 2 bandwidth 850Kbit besteffort dual-srchost rtt 100.0ms raw</code></pre></div><p>The behavior in this case is quite good actually. It still seems that I get some delay while loading web pages, however my ping in LoL is really stable (38~46ms) and no disconnects. I can&#039;t use this though, since sometimes I need to transfer things using LAN, and using sqm-scripts in the br-lan interface seems a bad idea in this case.</p><p>However I am looking forward to cake future, and if someone really needs OpenWRT instead of Gargoyle and wants to use SQM with a similar user case as mine, I think cake with dual-{dst,src} seems an option. triple-isolation does not really worked for me, though.</p><p>P.S.: for the autorate_ingress option, I don&#039;t recommend it unless you don&#039;t need to use interactive applications. It allows the ping to increase too much (like ~100ms). However if you can, it does allow you to use your connection more efficiently, by allowing more bandwidth when necessary. I think ACC from Gargoyle still works much better, though.</p><p>Edit: just to clarify, I tested this with BitTorrent client in WLAN, games in LAN. Basically the same setup I tested before with triple-isolate.</p>											<p class="post-edited">(Last edited by <strong>m45t3r</strong> on 2 Jun 2016, 19:43)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p326916">
				<div class="post-metadata">
					<div class="post-num">Post #42</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						2 Jun 2016, 19:42					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>m45t3r wrote:</cite><blockquote><div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p>Unfortunately I am not sure whether that generalizes well, but great that it worked for you.</p></blockquote></div><p>Yep, it seems not. Tree of Savior (the game that I tested in that case since LoL was updating) uses TCP packets (I know, TCP for a interactive game, whatever) and seems to work ok. League of Legends uses UDP, and still have problems. Less than before (I can actually play still multi-second stalls), however you can &quot;feel&quot; that the skills are more unresponsible, and the ping goes from ~40 ms to ~150ms (ToS maintains almost the same ping in same situation).</p><p>Well, back to Gargoyle I guess.</p></blockquote></div><p>Hi m45t3r,</p><p>thanks for your patience and diligent testing! Too bad that this was not the solution to your issue.</p><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p326918">
				<div class="post-metadata">
					<div class="post-num">Post #43</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						2 Jun 2016, 19:51					</div>
				</div>
				<div class="post-content content">
					<p>Hi m45t3r,</p><div class="quotebox"><cite>m45t3r wrote:</cite><blockquote><p>Some interesting things I discovered before I go back to Gargoyle for some time, since I am quite tired of this changing firmware thing. Disabling sqm-scripts (/etc/init.d/sqm stop), results in this configuration of tc qdisc:</p><div class="codebox"><pre><code>root@PensionatoButui:~# tc qdisc
qdisc fq_codel 0: dev eth0 root refcnt 2 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc mq 0: dev wlan0 root
qdisc fq_codel 0: dev wlan0 parent :1 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc fq_codel 0: dev wlan0 parent :2 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc fq_codel 0: dev wlan0 parent :3 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc fq_codel 0: dev wlan0 parent :4 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc fq_codel 0: dev pppoe-wan root refcnt 2 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn</code></pre></div><p>Not surprising to see fq_codel in interfaces since I think this is the default of OpenWRT. However just this seems to work better than some sqm-scripts settings I tried, no multi-second stalls and LoL working as expect (however the ping itself is quite high, ~200ms, however I was expecting something like 2000ms or higher).</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; This indicates that something in sqm scripts or cake really was unhappy. Need to think about this, thanks for the report.<br /></p><div class="quotebox"><cite>m45t3r wrote:</cite><blockquote><p>Finally, cake with dual-{dst,src}:<br /></p><div class="codebox"><pre><code>root@PensionatoButui:~# tc qdisc
qdisc fq_codel 0: dev eth0 root refcnt 2 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc cake 8032: dev br-lan root refcnt 2 bandwidth 13500Kbit besteffort dual-dsthost rtt 100.0ms raw
qdisc ingress ffff: dev br-lan parent ffff:fff1 ----------------
qdisc mq 0: dev wlan0 root
qdisc fq_codel 0: dev wlan0 parent :1 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc fq_codel 0: dev wlan0 parent :2 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc fq_codel 0: dev wlan0 parent :3 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc fq_codel 0: dev wlan0 parent :4 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc fq_codel 0: dev pppoe-wan root refcnt 2 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc cake 8033: dev ifb4br-lan root refcnt 2 bandwidth 850Kbit besteffort dual-srchost rtt 100.0ms raw</code></pre></div><p>The behavior in this case is quite good actually. It still seems that I get some delay while loading web pages, however my ping in LoL is really stable (38~46ms) and no disconnects.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; Thanks for testing this! This indicates that cake&#039;s dual isolation options work as &quot;advertised&quot; even with quite adverse traffic patterns. That is really good to hear, interesting that triple-iosolate in the same configuration failed to produce the same results...<br /></p><div class="quotebox"><cite>m45t3r wrote:</cite><blockquote><p> I can&#039;t use this though, since sometimes I need to transfer things using LAN, and using sqm-scripts in the br-lan interface seems a bad idea in this case.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; Yes, unfortunately shaping on an internal LAN interface is supoptimal on a wifi equiped router. For some people the solution might be to actually use another router as internal dumb AP, and basically dedicate their first router as traffic shaper... NOt ideal, but certainly an option right now.<br /></p><div class="quotebox"><cite>m45t3r wrote:</cite><blockquote><p>However I am looking forward to cake future, and if someone really needs OpenWRT instead of Gargoyle and wants to use SQM with a similar user case as mine, I think cake with dual-{dst,src} seems an option. triple-isolation does not really worked for me, though.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; Again thanks for testing, only with a really demanding load (BT) and a good probe/measurement system (LoL) is it possible to actually tests properly, so I learned a lot about cake &quot;rom your actions.<br /></p><div class="quotebox"><cite>m45t3r wrote:</cite><blockquote><p>P.S.: for the autorate_ingress option, I don&#039;t recommend it unless you don&#039;t need to use interactive applications. It allows the ping to increase too much (like ~100ms). However if you can, it does allow you to use your connection more efficiently, by allowing more bandwidth when necessary. I think ACC from Gargoyle still works much better, though.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; I believe this option is not ready for prime-time yet...<br /></p><div class="quotebox"><cite>m45t3r wrote:</cite><blockquote><p>Edit: just to clarify, I tested this with BitTorrent client in WLAN, games in LAN. Basically the same setup I tested before with triple-isolate.</p></blockquote></div><p>Ah, shaper on br-lan affected both WLAN and LAN traffic, I believe typically br-lan bridges wireless and wired so that sounds like the expected behavior. And you have deserved a long time without router reboots/reflashes <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p><br /><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p326922">
				<div class="post-metadata">
					<div class="post-num">Post #44</div>
					<div class="post-author">m45t3r</div>
					<div class="post-datetime">
						2 Jun 2016, 19:57					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p>Ah, shaper on br-lan affected both WLAN and LAN traffic, I believe typically br-lan bridges wireless and wired so that sounds like the expected behavior. And you have deserved a long time without router reboots/reflashes <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p></blockquote></div><p>Yep, it is:</p><p>/etc/config/network (don&#039;t care about username/password, they&#039;re generic in my ISP)<br /></p><div class="codebox"><pre><code>config interface &#039;loopback&#039;
    option ifname &#039;lo&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;127.0.0.1&#039;
    option netmask &#039;255.0.0.0&#039;

config globals &#039;globals&#039;
    option ula_prefix &#039;fd35:6900:679f::/48&#039;

config interface &#039;eth&#039;
    option ifname &#039;eth0&#039;
    option proto &#039;none&#039;

config interface &#039;lan&#039;
    option ifname &#039;lan1 lan2 lan3 lan4&#039;
    option force_link &#039;1&#039;
    option type &#039;bridge&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;192.168.1.1&#039;
    option netmask &#039;255.255.255.0&#039;
    option ip6assign &#039;60&#039;

config interface &#039;wan&#039;
    option ifname &#039;wan&#039;
    option _orig_ifname &#039;wan&#039;
    option _orig_bridge &#039;false&#039;
    option proto &#039;pppoe&#039;
    option username &#039;turbonet@turbonet&#039;
    option password &#039;gvt25&#039;
    option peerdns &#039;0&#039;
    option dns &#039;8.8.8.8 8.8.4.4&#039;
    option keepalive &#039;10 6&#039;

config interface &#039;wan6&#039;
    option ifname &#039;wan&#039;
    option proto &#039;dhcpv6&#039;

config interface &#039;modem&#039;
    option proto &#039;static&#039;
    option ifname &#039;wan&#039;
    option ipaddr &#039;192.168.25.2&#039;
    option netmask &#039;255.255.255.0&#039;</code></pre></div><p>/etc/config/wireless<br /></p><div class="codebox"><pre><code>config wifi-device &#039;radio0&#039;
    option type &#039;mac80211&#039;
    option hwmode &#039;11g&#039;
    option path &#039;platform/ath9k&#039;
    option channel &#039;6&#039;
    option htmode &#039;HT40&#039;
    option country &#039;US&#039;
    option txpower &#039;24&#039;

config wifi-iface
    option device &#039;radio0&#039;
    option network &#039;lan&#039;
    option mode &#039;ap&#039;
    option ssid &#039;XXXXXX&#039;
    option encryption &#039;psk2+ccmp&#039;
    option key &#039;XXXXXXXXXXX&#039;</code></pre></div><p>This makes me even more confused on why dual-{dst,src} worked with WLAN, while triple-isolate did not work with WLAN. I did not test LAN with dual-{dst,src}, however considering that in this case even fq_codel or cake without triple-isolate was fine I don&#039;t thing this would be a issue.</p><p>Edit: btw, forgot to say that I am still using the cake from ceropackages-3.10. However from what I saw from sch_cake page on GitHub, there is no interesting updates except maybe a new algorithm called COBALT (that I don&#039;t even know how to use anyway).</p>											<p class="post-edited">(Last edited by <strong>m45t3r</strong> on 2 Jun 2016, 20:00)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p326952">
				<div class="post-metadata">
					<div class="post-num">Post #45</div>
					<div class="post-author">m45t3r</div>
					<div class="post-datetime">
						3 Jun 2016, 01:25					</div>
				</div>
				<div class="post-content content">
					<p>Well, looking forward for this: <a href="https://github.com/lede-project/source/pull/72">https://github.com/lede-project/source/pull/72</a></p><p>Finally got a .config for LEDE DD that fits in my TL-WR941ND router. Since this will come directly from upstream it will make everything much easier. I just hope that LEDE does not introduce even more bloat, I already have to disable opkg to fit everything in the image.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p327520">
				<div class="post-metadata">
					<div class="post-num">Post #46</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						7 Jun 2016, 15:05					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>m45t3r wrote:</cite><blockquote><p>Well, looking forward for this: <a href="https://github.com/lede-project/source/pull/72">https://github.com/lede-project/source/pull/72</a></p></blockquote></div><p>cake is now in the LEDE master. #72 got split into two, but now the code is there for easy building.</p><p><a href="https://git.lede-project.org/?p=source.git;a=commitdiff;h=23147dd43ac0835cc9077819c32a101dee42461d">https://git.lede-project.org/?p=source. … 1dee42461d</a><br /><a href="https://git.lede-project.org/?p=source.git;a=commitdiff;h=1a3c56f8322d27f4652d23eb7dc14a45e1631e1c">https://git.lede-project.org/?p=source. … 45e1631e1c</a></p><p>(I am also using the same patches in my Openwrt trunk build.)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p327544">
				<div class="post-metadata">
					<div class="post-num">Post #47</div>
					<div class="post-author">m45t3r</div>
					<div class="post-datetime">
						7 Jun 2016, 18:12					</div>
				</div>
				<div class="post-content content">
					<p>I compiled and installed LEDE (including cake changes) today, seems nice. For example, it actually reduced RAM usage for something back to AA days (7 or 8MB of free RAM, vs 5MB in BB and 4MB in CC). However the Wi-Fi on my router is completely unstable (lose connectivity on all connected devices after 1~2 minutes of operation, only got back after a reboot), so I could not test cake there.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p327574">
				<div class="post-metadata">
					<div class="post-num">Post #48</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						8 Jun 2016, 00:11					</div>
				</div>
				<div class="post-content content">
					<p>Hi m45t3r,</p><div class="quotebox"><cite>m45t3r wrote:</cite><blockquote><p>I compiled and installed LEDE (including cake changes) today, seems nice. For example, it actually reduced RAM usage for something back to AA days (7 or 8MB of free RAM, vs 5MB in BB and 4MB in CC). However the Wi-Fi on my router is completely unstable (lose connectivity on all connected devices after 1~2 minutes of operation, only got back after a reboot), so I could not test cake there.</p></blockquote></div><p>While this is probably not the final repository I put 4 test scripts into: <a href="https://github.com/moeller0/temporary_test_scripts_4_sqm-scripts">https://github.com/moeller0/temporary_t … qm-scripts</a><br />I would be delighted if you could test these four again, please (when ever you have time, you have such a great test case).</p><p>The *_LAN_* variants are to be used on an internally facing interface, the *_WAN_* versions for externally facing interfaces (the bandwidth is automatically flipped in the LAN scripts so in the GUI you can keep the bandwidth as related to your ISP). And as you already saw the SQM on a LAN interface will not shape WLAN/WIFI to and from internet traffic (but will shape WIFI to and from LAN traffic) so theses are only for testing not for general consumption...</p><p>The *_triple-isolate_* scripts use the un-directional triple-isolate option for both ingress and egress, the *_dual-isolate_* scripts use dual-srchost and dual-dsthost, one on egress one on ingress (and here the LAN and WAN versions have src and dst flipped, hopefully correctly).</p><p>I do not expect the WAN versions to have any positive effect on your load, but the LAN versions should. I am especially interested to see whether as in your past tests, the triple-isolate version still fails. But note the WAN versions should work for IPv6 packets (for IPv4 NAT on the WAN interface will remove the information about the internal IPs that is required for per-IP fairness unfortunately)</p><p>Thank you very much for al your help.</p><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp;M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p327576">
				<div class="post-metadata">
					<div class="post-num">Post #49</div>
					<div class="post-author">m45t3r</div>
					<div class="post-datetime">
						8 Jun 2016, 00:48					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p>Hi m45t3r,</p><div class="quotebox"><cite>m45t3r wrote:</cite><blockquote><p>I compiled and installed LEDE (including cake changes) today, seems nice. For example, it actually reduced RAM usage for something back to AA days (7 or 8MB of free RAM, vs 5MB in BB and 4MB in CC). However the Wi-Fi on my router is completely unstable (lose connectivity on all connected devices after 1~2 minutes of operation, only got back after a reboot), so I could not test cake there.</p></blockquote></div><p>While this is probably not the final repository I put 4 test scripts into: <a href="https://github.com/moeller0/temporary_test_scripts_4_sqm-scripts">https://github.com/moeller0/temporary_t … qm-scripts</a><br />I would be delighted if you could test these four again, please (when ever you have time, you have such a great test case).</p><p>The *_LAN_* variants are to be used on an internally facing interface, the *_WAN_* versions for externally facing interfaces (the bandwidth is automatically flipped in the LAN scripts so in the GUI you can keep the bandwidth as related to your ISP). And as you already saw the SQM on a LAN interface will not shape WLAN/WIFI to and from internet traffic (but will shape WIFI to and from LAN traffic) so theses are only for testing not for general consumption...</p><p>The *_triple-isolate_* scripts use the un-directional triple-isolate option for both ingress and egress, the *_dual-isolate_* scripts use dual-srchost and dual-dsthost, one on egress one on ingress (and here the LAN and WAN versions have src and dst flipped, hopefully correctly).</p><p>I do not expect the WAN versions to have any positive effect on your load, but the LAN versions should. I am especially interested to see whether as in your past tests, the triple-isolate version still fails. But note the WAN versions should work for IPv6 packets (for IPv4 NAT on the WAN interface will remove the information about the internal IPs that is required for per-IP fairness unfortunately)</p><p>Thank you very much for al your help.</p><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp;M.</p></blockquote></div><p>Well, I can test, however it will be on CC since, as I said, LEDE-DD have a very unstable Wi-Fi on my router.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 2 of 2</div><nav><ul><li><a href="viewtopic.php%3Fid=64812&amp;p=1.html">1</a></li><li class="pagination-current"><span>2</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>