<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Build custom bin with bare minimum</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 26 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p262447">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">sharkyenergy</div>
					<div class="post-datetime">
						22 Jan 2015, 14:35					</div>
				</div>
				<div class="post-content content">
					<p>Hello!</p><p>i would like to build a custom bin with the bare minimum in order to make following things work:</p><p>- wifi as guest to connect to existing wifi<br />- usb should work (dont know if i need any drivers for this??)<br />- GUI should be there for easy access to the guest wifi setup area<br />- a custom file (about 1 megabyte) should be loaded onto the device <br />- a script should start the above mentioned file on startup</p><p>the device is a TL-MR3040. it has only 4Mb flash.</p><p>could somebody please help me on this? how can i understand what the bare minimum is to make it work? </p><p>thanks!</p><p>Igor</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p262452">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">eleon216</div>
					<div class="post-datetime">
						22 Jan 2015, 15:08					</div>
				</div>
				<div class="post-content content">
					<p>I don&#039;t think this is possible. </p><p>I build a custom image for a TL-WR741ND. </p><p>Version Barrier Braker</p><p>minimum packages list (and ppp package and modules removed)</p><p>no GUI, no usb-support, no QOS... </p><p>Just minmal AP and routing functionality, and I get a imagesize of around 2.8 MByte. The bootloader needs some space too, so there are about 1MB left. <br />So I really don&#039;t think you will get all of this in 4MB. You could try removing IPv6, this will save some space, but I think you should get a device with at least 8MB flash, or use extroot.</p><p>and you need at least 64kB or 128kB additional free space (depeding on the eraseblocksize) for the overlay-partition to save your configuration (e.g. WLAN-Setup)</p>											<p class="post-edited">(Last edited by <strong>eleon216</strong> on 22 Jan 2015, 15:13)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p262456">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">sharkyenergy</div>
					<div class="post-datetime">
						22 Jan 2015, 15:23					</div>
				</div>
				<div class="post-content content">
					<p>hmm.. doesnt sound good.. </p><p>how can I as a noob understand what packages MUST be installed and what can be left away? i see the package folder with a lot of stuff in there but no description about what it is and what it does. I dont need IPv6, dont need firewall, dont need anything.. just connect to a existing wifi like any smartphone, and be able to use the USB and the lan. The bare minimum package made with image generator with no packages at all is 1.1 Mb.. I guess that with this file its a absolutely empty system.. right? what blocks would I have to add in order to have the above working?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p262463">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">zo0ok</div>
					<div class="post-datetime">
						22 Jan 2015, 15:53					</div>
				</div>
				<div class="post-content content">
					<p>Not possible to put the 1MB custom file on a USB memory, since USB is required anyways?<br />Or compress it?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p262464">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">sharkyenergy</div>
					<div class="post-datetime">
						22 Jan 2015, 15:58					</div>
				</div>
				<div class="post-content content">
					<p>nope.. none of the two is possible.. unfortunately...</p><p>Only thing that comes to my mind is to use a script that downloads the file from the web on every startup... but i dont like that..</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p262709">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">sharkyenergy</div>
					<div class="post-datetime">
						24 Jan 2015, 23:45					</div>
				</div>
				<div class="post-content content">
					<p>Guys i need to build my custom file, but i am having difficulties to understand what packages i have to include. is there somewhere a description of the packages? i would like to learn how to understand what i MUST include and what i CAN safely leave out.</p><p>I need following to work:<br />ethernet<br />wifi in client mode<br />USB<br />USB fat32 system<br />ssh<br />luci</p><p>This is it, this is all I need... could somebody please help me out on this?</p><p>thanks!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p262710">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">zo0ok</div>
					<div class="post-datetime">
						24 Jan 2015, 23:56					</div>
				</div>
				<div class="post-content content">
					<p>You should use the Image Builder (or is it to be called Image Generator?).<br />If you build from source (the buildroot) you can generate the Image Builder, and then use it.</p><p>In the Image Builder there is a folder target/linux/[platform] and in this folder you find &quot;profiles&quot;.<br />You use them as a start. Then you do:</p><p>make image PROFILE=Broadcom-None PACKAGES=&quot;-ppp netcat&quot;</p><p>if you want to exclude ppp (presuming it is part of profile) and include netcat.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p262714">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">sharkyenergy</div>
					<div class="post-datetime">
						25 Jan 2015, 00:23					</div>
				</div>
				<div class="post-content content">
					<p>thanks zo0ok for your answer... There are still 3 points that are not totally clear to me:</p><p>1) if i need for example ethernet, how can i know what packages i MUST include in order to work?<br />2) how can i know what packages i can safely remove? for example i have no clue if ppp has some effect on the rest of the system..<br />3) if i already have openwrt on my router, do i have to flash the .factory first or can i flash the sysupgrade right away?</p><p>thanks!</p><p>Igor</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p262721">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">mk24</div>
					<div class="post-datetime">
						25 Jan 2015, 00:59					</div>
				</div>
				<div class="post-content content">
					<p>ppp is used for DSL or 3G modems so is not necessary in your application.&nbsp; &nbsp;The e2fs driver is very large.&nbsp; Consider using f2fs instead (will require later than BB kernel though).&nbsp; You can put arbitrary files into your squashfs by putting them in the image builder files directory before making the image.&nbsp; These files will be compressed very effectively, but cannot be changed later without putting a whole new (uncompressed) copy into the jffs. </p><p>Upgrading the router to a larger flash chip is reasonably straightforward.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p262726">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">sharkyenergy</div>
					<div class="post-datetime">
						25 Jan 2015, 01:15					</div>
				</div>
				<div class="post-content content">
					<p>i came up with this to add to the packages variable, but i am not sure...</p><p>-firewall -jsonfilter -ubox -kmod-ip6tables -kmod-ipv6 -kmod-ppp -libip6tc -luci-proto-ipv6 -ip6tables -ppp</p><p>would this still work? or would i brick everything?</p><p>here is the Whole comand:</p><p>make image PROFILE=TLMR3040 PACKAGES=&quot;-firewall -jsonfilter -ubox -kmod-ip6tables -kmod-ipv6 -kmod-ppp -libip6tc -luci-proto-ipv6 -ip6tables kmod-usb2 kmod-usb-storage kmod-usb-storage-extras block-mount kmod-fs-vfat kmod-fs-ntfs&quot;</p><p>would this make sense?</p>											<p class="post-edited">(Last edited by <strong>sharkyenergy</strong> on 25 Jan 2015, 01:37)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p262799">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">sharkyenergy</div>
					<div class="post-datetime">
						25 Jan 2015, 17:42					</div>
				</div>
				<div class="post-content content">
					<p>I tried to flash the build with above mentioned packages but something screwed up luci. The black page with white text is showing up but then when it redirects to cgi-bin it doesnt load. Any idea what could be the cause? Thanks</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p262801">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						25 Jan 2015, 18:02					</div>
				</div>
				<div class="post-content content">
					<p>ubox is most likely essential. <br />jsonfilter is probably used at many places in parsing config.<br />firewall provides also NAT functionality.<br />I don&#039;t know how you ended up removing those packages, but hopefully you know what you do...</p><p>In principle the basic Openwrt is rather barebones already. ipv6 and ppp relaetd stuff is maybe extra, but not much more can be removed if you still want basic network functionality with NAT and wifi.</p><p>A device with 4 MB flash is not really suitable for current Openwrt if you want Luci GUI (and also that extra 1 MB file).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p263384">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">sharkyenergy</div>
					<div class="post-datetime">
						29 Jan 2015, 14:37					</div>
				</div>
				<div class="post-content content">
					<p>Thanks!</p><p>will removing IPV6 somehow influence the functionality of the network, if i use only IPV4? is there a connection between them?</p><p>thank you so much for your help!</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>