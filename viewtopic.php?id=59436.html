<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> SQM and unstable cable connection</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 5 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p290624">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">shm0</div>
					<div class="post-datetime">
						6 Sep 2015, 00:31					</div>
				</div>
				<div class="post-content content">
					<p>Hi<br />I have a 150/5mbit/s Connection<br />My modem syncs with 168960/5248kbit/s speeds.<br />At night i am able to reach ~162Mbit at speedtest.net<br />To setup sqm i did some pings to a known site with good respond.<br />I came up with this settings 160000 down 4950 up.<br />While downloading and uploading pings stayed low.<br />But at day time im not able to reach this speeds (download) at my pings start to rise.<br />What is the best way to set this up right?</p><p>Thank you.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p290626">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">makarel</div>
					<div class="post-datetime">
						6 Sep 2015, 00:59					</div>
				</div>
				<div class="post-content content">
					<p>your on a shared line.. at night=less users then at day so higher speeds<br />you cant do anything unless ask your ISP for guaranteed bandwidth(very expensive)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p290629">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">shm0</div>
					<div class="post-datetime">
						6 Sep 2015, 01:25					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for your answer.<br />As i said it is a cable / docsis 3 connection. <br />And cable is always a shared medium or?<br />Is there really no way to optimize sqm to adapt to those conditions?<br />I used a traditional traffic shaper before which could automatically adapt to those conditions.<br />Problem with that is it is a software solution and only runs on windows machines and has to be installed on all clients.<br />And doesnt work on non windows clients.<br />Pings are only getting high on downloads. on uploads pings are steady.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p290639">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">makarel</div>
					<div class="post-datetime">
						6 Sep 2015, 02:48					</div>
				</div>
				<div class="post-content content">
					<p>dude.. a shared line with all your neighbors.. not shared in house.. you cannot traffic shape it.. only your ISP can; you can only shape your lan traffic</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p290661">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						6 Sep 2015, 11:54					</div>
				</div>
				<div class="post-content content">
					<p>Hi shm0,</p><div class="quotebox"><cite>shm0 wrote:</cite><blockquote><p>Thanks for your answer.<br />As i said it is a cable / docsis 3 connection. <br />And cable is always a shared medium or?</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; Yes, in cable systems the individual customers share the same cable segment which therefore is a shared medium. Not that XDSL or Foiber do not share anything, so in the end all internet access is shared to some degree. But for cable system it is already the first segment that is shared.</p><div class="quotebox"><cite>shm0 wrote:</cite><blockquote><p>Is there really no way to optimize sqm to adapt to those conditions?</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; Sqm-scripts only allows static bandwidth assignments, so will work great for stable situations and not too well for fluctuating bandwidth systems. And for download shaping to be effective the shaper bandwidth needs the be noticeably lower than the real download bandwidth, if the real bandwidth drops, but the shaper&#039;s is not adjusted as well, the download shaper effectively looses its ability to bound the latency under load. You could either try gargoyle&#039;s ACC active congestion control, but you would need to switch to gargoyle for that. If however you can figure out a stable time period per day during which the available bandwidth is affected AND also figure out a reduced but stable ingress bandwidth for that period, you could use cron to change sqm configuration automatically. Sqm should try to get inspiration from ACC, but so far has not.<br /></p><div class="quotebox"><cite>shm0 wrote:</cite><blockquote><p>I used a traditional traffic shaper before which could automatically adapt to those conditions.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; What exactly is the traditional shaper you used?<br /></p><div class="quotebox"><cite>shm0 wrote:</cite><blockquote><p>Problem with that is it is a software solution and only runs on windows machines and has to be installed on all clients.<br />And doesnt work on non windows clients.<br />Pings are only getting high on downloads. on uploads pings are steady.</p></blockquote></div><p>This just shows that on your segment there are more consumers than producers, upload can also experience congestion <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /> But this is quite fortunate as gargoyle&#039;s ACC only works in the download direction and assumed stable upload. (The challenge is that one can only get round-trip-tme (RTT) measurements easily, while for separate ingress and egress control one would like to know the two one-way-delays that add up to the RTT, but I digress).</p><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p290687">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">shm0</div>
					<div class="post-datetime">
						6 Sep 2015, 17:32					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for your answer.</p><p>It seems Gargoyle has no support for my device yet.<br />The shaper i used before was CfosSpeed (<a href="https://www.cfos.de/en/cfosspeed/cfosspeed.htm?__ntrack_pv=1">https://www.cfos.de/en/cfosspeed/cfossp … track_pv=1</a>)<br />It works by assign priority classes to Protocols, Ports, Programs etc.<br />It has a huge predefined list and works quite well.</p><p>I found the betterspeedtest.sh script and did some testing.<br />At night i was able to use 167000kbit for my download speed.<br />Now at day time it seems the maximum i can go for is 127000kbit. At 128000kbit pings begin to skyrocket.<br />Upload is stable at 5120kbit all times.</p><p>I have one question through.<br />My ISP provides my Router which is needed to use VoIP.<br />End users are not supposed to use there own hardware. <br />But there is some trick to bridge the lan ports which allows me to connect my own hardware / router.<br />Upload sync speed is 5248kbit. VoIP uses G711 codec. It needs 64kbit as bandwith. I have 2 lines.<br />So i set upload to 5120 (5248-128)<br />Should i leave it that way or reduce it further to have more head room for voip?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p290695">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						6 Sep 2015, 18:38					</div>
				</div>
				<div class="post-content content">
					<p>Hi sham,<br /></p><div class="quotebox"><cite>shm0 wrote:</cite><blockquote><p>Thanks for your answer.</p><p>It seems Gargoyle has no support for my device yet.<br />The shaper i used before was CfosSpeed (<a href="https://www.cfos.de/en/cfosspeed/cfosspeed.htm?__ntrack_pv=1">https://www.cfos.de/en/cfosspeed/cfossp … track_pv=1</a>)<br />It works by assign priority classes to Protocols, Ports, Programs etc.<br />It has a huge predefined list and works quite well.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; Ah, cfosspeed I knew there wads something...<br /></p><div class="quotebox"><cite>shm0 wrote:</cite><blockquote><p>I found the betterspeedtest.sh script and did some testing.<br />At night i was able to use 167000kbit for my download speed.<br />Now at day time it seems the maximum i can go for is 127000kbit. At 128000kbit pings begin to skyrocket.<br />Upload is stable at 5120kbit all times.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; Okay, if this truly works everyday, that could be felt with with a cron job to change the configuration twice a day.<br /></p><div class="quotebox"><cite>shm0 wrote:</cite><blockquote><br /><p>I have one question through.<br />My ISP provides my Router which is needed to use VoIP.<br />End users are not supposed to use there own hardware. <br />But there is some trick to bridge the lan ports which allows me to connect my own hardware / router.<br />Upload sync speed is 5248kbit. VoIP uses G711 codec. It needs 64kbit as bandwith. I have 2 lines.<br />So i set upload to 5120 (5248-128)<br />Should i leave it that way or reduce it further to have more head room for voip?</p></blockquote></div><p>Good thinking. Often upload shaping still works at line rate so 5248 could work well (often people realize they need ti subtract 1-5% or so to get latency under load under control, but if 100% works fine that is even nicer). Yes I would reduce the upload bandwidth by &gt;= 128 Kbps. I would probably start with 5120 and the use betterspeedtes.sh or better netperfrunner.sh to saturate up- and downlink simultaneously while having both telephone lines active. If VoIP continues to work great and latency under load stays nicely bounded, I would stick at 5120, otherwise reduce by 50Kbps and try again, until both calls work well and the rest shows no sign of unacceptable latency increases under load.</p><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p290776">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">shm0</div>
					<div class="post-datetime">
						7 Sep 2015, 16:12					</div>
				</div>
				<div class="post-content content">
					<p>Thanks again <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /><br />i will test a bit around with voip and qos.<br />The router from my isp also does some qos. but im not quite sure if this works if the lan ports are bridged.<br />I had to reduce download speed further later the day to 120mbit.<br />But works quite nice now. i think i will just stick with that.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p290778">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						7 Sep 2015, 16:58					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>shm0 wrote:</cite><blockquote><p>Thanks again <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /><br />i will test a bit around with voip and qos.<br />The router from my isp also does some qos. but im not quite sure if this works if the lan ports are bridged.<br />I had to reduce download speed further later the day to 120mbit.<br />But works quite nice now. i think i will just stick with that.</p></blockquote></div><p>Sounds great, good luck.</p><p>Note that once your ISP switches you onto DOCSIS 3.1 equipment, you might not require any upload shaping (DOSCIS 3.1 requires the pie qdisc in the cable modem, which should work without the need to specify the bandwidth; that said I would still try to measure whether that performed as advertised). TO disable shaping for individual directions under sqm-scripts, simply set the bandwidth for that direction to 0. Sqm-scripts will interpret this as no-shaping instead of shaping to 0Kbps (there are more direct ways to disable a link, so shaping to 0 Bps certainly was not a functionality anybody was looking for <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /> ).</p><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p290786">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">shm0</div>
					<div class="post-datetime">
						7 Sep 2015, 17:32					</div>
				</div>
				<div class="post-content content">
					<p>thanks for the info but i think docsis 3.1 wont arrive here anytime soon ;(<br />And why does it only have uploading shaping? Why no download shaping?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p290871">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						8 Sep 2015, 11:05					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>shm0 wrote:</cite><blockquote><p>thanks for the info but i think docsis 3.1 wont arrive here anytime soon ;(<br />And why does it only have uploading shaping? Why no download shaping?</p></blockquote></div><p>As far as I know cable-labs has much tighter control over the cable modems (CPE) than the head-end (CMTS), and from the CPE side one can solve the upload direction for good, but for the download direction the control is not as tight and it is computationally more demanding. Ideally the CMTS would learn latency conserving traffic shaping as well, but as far as I know none of the manufacturers even acknowledged that they are interested in looking into this...</p><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p291817">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">shm0</div>
					<div class="post-datetime">
						14 Sep 2015, 17:15					</div>
				</div>
				<div class="post-content content">
					<p>Thank you <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><br /><p>i did some further testing at night again and used the betterspeedtest.sh script.<br />Also using cake now.<br />In another thread i found the math to calculate the overhead.<br />For my download speed it is : 1460/1514*168960 = 162933,68<br />which is exactly the max speed i measured most of the time at night.<br />i set sqm download speed to 154787(95%)<br />Now here comes the thing. it seems sqm &quot;looses&quot; 10mbit somewhere.<br />With 154787 i get 145mbit download speed.<br />With 164787 i get the 154mbit download speed.<br />What is going on here?</p><p>I also seems that i set my upload with 5120 to high.<br />betterspeedtest.sh shows nice low pings.<br />But with netperfrunner.sh (which does download and upload the same time) the pings start to rise high again.<br />I first thought i set my upload too high but no.<br />So did the math again: 1460/1514*5248 = 5060<br />With 5060 pings are low and stable everything above pings start to rise again.<br />But to be on the safe i set the upload speed 2% (read it somewhere that alteast 2% must be reserved) lower - 128 for voip = 4831</p><p>And now even at day time is seems smooth.</p>											<p class="post-edited">(Last edited by <strong>shm0</strong> on 14 Sep 2015, 17:17)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p291826">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						14 Sep 2015, 18:15					</div>
				</div>
				<div class="post-content content">
					<p>Hi Shm0,</p><div class="quotebox"><cite>shm0 wrote:</cite><blockquote><p>Thank you <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; You are welcome <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /><br /></p><div class="quotebox"><cite>shm0 wrote:</cite><blockquote><p>i did some further testing at night again and used the betterspeedtest.sh script.<br />Also using cake now.<br />In another thread i found the math to calculate the overhead.<br />For my download speed it is : 1460/1514*168960 = 162933,68<br />which is exactly the max speed i measured most of the time at night.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; Good, but note thgis really depends on the exact encapsulation and protocol used. IPv6 for example reduces the good put per packet by another 20 Bytes to 1460 and if you are unlucky the packet might require additional headers on the wire (like the ethernet frame check sequence or a VLAN tag or whatnot).<br /></p><div class="quotebox"><cite>shm0 wrote:</cite><blockquote><p>i set sqm download speed to 154787(95%)</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; Generally, the recommendation is 85-90% of line rate. Since in your calculation above you assume 100*(1 - 1460/1514) = 3.6% overhead you are at roughly 91.4% of line rate (or precisely 100*154787/168960 = 91.6%), which for the ingress or download direction is pushing your luck... (the symptoms of that are simply that under saturating loads there will be sluggish periods while the CMTS buffers fill and slowly drain, so nothing earth shattering bad)<br /></p><div class="quotebox"><cite>shm0 wrote:</cite><blockquote><p>Now here comes the thing. it seems sqm &quot;looses&quot; 10mbit somewhere.<br />With 154787 i get 145mbit download speed.<br />With 164787 i get the 154mbit download speed.<br />What is going on here?</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; I believe all is well, the shaper assumes link rates that include the overhead so really<br />1460/1514* 154787 = 149266.195509: 100*145000/149266&nbsp; = 97.1420149264, or 2.3% loss<br />1460/1514* 164787 = 158909.524439: 100*154000/158909 = 96.9108105897 , or 3.1% loss</p><p>which adds up to a loss of 4 to 5 Mbps not 10, but I see your point... Now which speedtest are you using and how many streams are used for the test?</p><p>It might be interesting to have a look at the output of:<br />&quot;tc -s qdisc show dev eth0&quot; # please replace eth0 with your egress interface&#039;s name <br />and of:<br />&quot;tc -s qdisc show dev ifb4eth0&quot; # please replace ifb4eth0 with your ingress interface&#039;s name</p><p>This will show what rate cake applied and give some statistics, so it seems a good idea run these commands than run a speedtest and run the commands again. Also of interest is the output of &quot;tc -d qdisc&quot; as that will tell a bit about what configuration you passed to cake<br /></p><div class="quotebox"><cite>shm0 wrote:</cite><blockquote><br /><p>I also seems that i set my upload with 5120 to high.<br />betterspeedtest.sh shows nice low pings.<br />But with netperfrunner.sh (which does download and upload the same time) the pings start to rise high again.<br />I first thought i set my upload too high but no.<br />So did the math again: 1460/1514*5248 = 5060<br />With 5060 pings are low and stable everything above pings start to rise again.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; It is quite normal that netperfrunner.sh especially with &quot;-l 150&quot; and &quot;-n 16&quot; will show clearer if bufferbloat ids not fully squelched, even though it does not tell you whether to blame ingress or egress, as you note. If netperfrunner shows larger latency spikes than I like I typically will go and reduce ingress and egree sequentially by 25% to figure out which side has a stronger effect on the latency increase. But your observation obviously shows that your ISP does not deliver 5248Kbps stably (or that they are adding additional overhead that you still need to account for on the bottleneck link). This is exactly the situation where iterative measurements, just as you did them, are in order, so congratulations <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /><br /></p><div class="quotebox"><cite>shm0 wrote:</cite><blockquote><br /><br /><p>But to be on the safe i set the upload speed 2% (read it somewhere that alteast 2% must be reserved) lower - 128 for voip = 4831</p><p>And now even at day time is seems smooth.</p></blockquote></div><p>Depending on the ISPs no reserve might be required, I personally have successfully de-bloated an ADSL2+ link running at 100% of egress link-rate, but that required measuring and accounting for per packet overhead and ATM quantization; thankfully you do not have to deal with that...</p><p>Anyway, it looks like things work pretty well for you, great&gt;</p><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p291852">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">shm0</div>
					<div class="post-datetime">
						14 Sep 2015, 22:39					</div>
				</div>
				<div class="post-content content">
					<p>Thanks again <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Im a bit confused.<br />In the bufferbloat wiki it states:<br /></p><div class="quotebox"><blockquote><p>Example 1: If your your provider boasts &quot;7 megabit download/768 kbps upload&quot;, enter numbers that are 85% of those values. 7 megabits-per-second is equal to 7000 kbit/s, 85% of that number is 5950 kbit/s. The proper value for 768 kbps would be 653 kbit/s.</p><p>Example 2: If you have measured your bandwidth with <a href="http://speedtest.net">http://speedtest.net</a> or other network test tool (disable SQM first), set the upload and download speeds to 95% of those numbers. If you get 6.2 megabits down and 0.67 megabits up (6200 kbps and 670 kbps, respectively), set your down and upload speeds to 95% of those numbers (5890 and 637 kbps, respectively)</p></blockquote></div><p>For case 1:<br />My advertised isp speeds are 150/5 Mbit<br />Do i use the 150000 or the sync speed (168960) for calculations?<br />150000* 0.85 =127500<br />168960 * 0.85 = 143616</p><p>Case 2:<br />I measured&nbsp; 162 Mbit for downlink and 4.89 Mbit for Uplink.</p><p>That would be 162 * 0.95 = 153.9 Mbit<br />and<br />4.89 * 0.95 = 4.6455 Mbit</p><p>I&#039;m a bit lost here...<br />Do i have to add the overhead before i calculate the percentage? Because shaper assumes rates with overhead included?<br />Like for case 1 with advertised speeds:<br />2 - (1460/1514) * 150 = 155350 ?<br />Then take 85 % of that? Which is only 132047</p><p>When i go with your example i should use:<br />168960 * 0.85 = 143616<br />5248 * 0.85 =4460.8 (But for upload probably higher)</p><p>I also read somewhere most people go for 90% Download and 95% upload ?</p><p>And what about this speedboost thing isp use to cheat speedtest.<br />That would explain why my modem syncs roughly 10-12 mbits higher.<br />Does UPC do this practices?</p><p>i used the betterspeedtest.sh and netperfrunner.sh from the OpenWRTScripts repo.<br />Host i used was the netperf-eu one. with default of 4 streams.</p><p>Here is the output from the commands:<br />tc -s qdisc show dev eth0:<br /></p><div class="codebox"><pre><code>qdisc cake 8013: root refcnt 9 bandwidth 4932Kbit diffserv4 flows raw
 Sent 1276670 bytes 6074 pkt (dropped 0, overlimits 1207 requeues 0)
 backlog 0b 0p requeues 0
           Class 0     Class 1     Class 2     Class 3
  rate      4932Kbit    4623Kbit    3699Kbit    1233Kbit
  target       5.0ms       5.0ms       5.0ms      14.7ms
interval     100.0ms     100.0ms     100.0ms     117.9ms
Pk delay         0us       604us         0us         0us
Av delay         0us        37us         0us         0us
Sp delay         0us         0us         0us         0us
  pkts             0        6063          11           0
way inds           0          23           0           0
way miss           0         512          11           0
way cols           0           0           0           0
  bytes            0     1275680         990           0
  drops            0           0           0           0
  marks            0           0           0           0
qdisc ingress ffff: parent ffff:fff1 ----------------
 Sent 4364661 bytes 18406 pkt (dropped 0, overlimits 0 requeues 0)
 backlog 0b 0p requeues 0</code></pre></div><p>tc -s qdisc show dev ifb4eth0<br /></p><div class="codebox"><pre><code>qdisc cake 8014: root refcnt 2 bandwidth 143616Kbit besteffort flows raw
 Sent 4735254 bytes 18875 pkt (dropped 0, overlimits 1764 requeues 0)
 backlog 0b 0p requeues 0
           Class 0
  rate    143616Kbit
  target       5.0ms
interval     100.0ms
Pk delay        55us
Av delay         2us
Sp delay         0us
  pkts         18654
way inds           0
way miss         549
way cols           0
  bytes      4735254
  drops            0
  marks            0</code></pre></div><p>tc -d qdisc<br /></p><div class="codebox"><pre><code>qdisc cake 8013: dev eth0 root refcnt 9 bandwidth 4932Kbit diffserv4 flows raw
qdisc ingress ffff: dev eth0 parent ffff:fff1 ----------------
qdisc mq 0: dev eth1 root
qdisc fq_codel 0: dev eth1 parent :1 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc fq_codel 0: dev eth1 parent :2 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc fq_codel 0: dev eth1 parent :3 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc fq_codel 0: dev eth1 parent :4 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc fq_codel 0: dev eth1 parent :5 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc fq_codel 0: dev eth1 parent :6 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc fq_codel 0: dev eth1 parent :7 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc fq_codel 0: dev eth1 parent :8 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc cake 8014: dev ifb4eth0 root refcnt 2 bandwidth 143616Kbit besteffort flows raw</code></pre></div><p>My ISP has currently some regional problems (perfect timing...) so i cant post numbers before / after testing.</p>											<p class="post-edited">(Last edited by <strong>shm0</strong> on 14 Sep 2015, 23:14)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p291858">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						14 Sep 2015, 23:22					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>shm0 wrote:</cite><blockquote><p>Thanks again <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Im a bit confused.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; Most likely because the matter is a bit complex, and I constantly fail to generalize and further sidetrack with giving too much irrelevant detail...<br /></p><div class="quotebox"><cite>shm0 wrote:</cite><blockquote><p>In the bufferbloat wiki it states:<br /></p><div class="quotebox"><blockquote><p>Example 1: If your your provider boasts &quot;7 megabit download/768 kbps upload&quot;, enter numbers that are 85% of those values. 7 megabits-per-second is equal to 7000 kbit/s, 85% of that number is 5950 kbit/s. The proper value for 768 kbps would be 653 kbit/s.</p><p>Example 2: If you have measured your bandwidth with <a href="http://speedtest.net">http://speedtest.net</a> or other network test tool (disable SQM first), set the upload and download speeds to 95% of those numbers. If you get 6.2 megabits down and 0.67 megabits up (6200 kbps and 670 kbps, respectively), set your down and upload speeds to 95% of those numbers (5890 and 637 kbps, respectively)</p></blockquote></div></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; Ah, I see we have not been terribly consistent in the numbers we put in the wiki. In the end this does not matter too much since, at least I believe so, we recommend to take these values as starting points and then test while measuring latency under load <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" />. And once you are prepared to refine the number iteratively all that matter is to start roughly at the right position to avoid wasting too much time.<br /></p><div class="quotebox"><cite>shm0 wrote:</cite><blockquote><br /><p>For case 1:<br />My advertised isp speeds are 150/5 Mbit<br />Do i use the 150000 or the sync speed (168960) for calculations?<br />150000* 0.85 =127500<br />168960 * 0.85 = 143616</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; Good question, if the sync speed is not affected by power boost&nbsp; (or what ever your ISP might call its temporary download rate booster for sparsely used links) I would probablu use that as reference, as not matter what this should be your upper limit, and I think it is quite interesting to see how close one can get to that limit while still having acceptable latency under load. Also a lot of cable ISPs seem to over-proision bandwidth maybe so they have less complaints that customers do not see the advertised numbers in speed tests...<br /></p><div class="quotebox"><cite>shm0 wrote:</cite><blockquote><br /><br /><p>Case 2:<br />I measured&nbsp; 162 Mbit for downlink and 4.89 Mbit for Uplink.</p><p>That would be 162 * 0.95 = 153.9 Mbit<br />and<br />4.89 * 0.95 = 4.6455 Mbit</p><p>I&#039;m a bit lost here...</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; If you are prepared to measure, just as you did, it does not matter too much; personally I have little experience with DOCSIS/cable, and on ADSL/VDSL 90% for download (with proper link layer adjustements) seem to work for downstream, while upstream often works at 97-100%.<br /></p><div class="quotebox"><cite>shm0 wrote:</cite><blockquote><br /><p>Do i have to add the overhead before i calculate the percentage? Because shaper assumes rates with overhead included?</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; If you take the good put as measured with a speedtest, and want to use that as basis you first need to translate that back into the effective rate including overhead. So assuming you measure 162Mbps good put this translates into 162000*1514/1460 = 167991.780822 shaper basis, than you take whatever percentage you want to start with as basis, say 95% -&gt; 0.95*162000*1514/1460 = 159592.191781. If you do not un-due the header overhead calculation you effectively just use slower percentage than 95%. But to repeat myself as long as one is willing to iteratively explore the effect of different bandwidth on latency under load this really really does not matter much, all the methods to figure out the initial values for the shaper we discuss here are really just simple heuristics to get people started. The lower starting points like 85% of link rate are almost guaranteed to result in decent latency under load behavior, but probably sacrifice more bandwidth that absolutely required...<br /></p><div class="quotebox"><cite>shm0 wrote:</cite><blockquote><br /><p>When i go with your example i should use:<br />168960 * 0.85 = 143616<br />5248 * 0.85 =4460.8 (But for upload probably higher)</p><p>I also read somewhere most people go for 90% Download and 95% upload ?</p><br /><br /><p>i used the betterspeedtest.sh and netperfrunner.sh from the OpenWRTScripts repo.<br />Host i used was the netperf-eu one. with default of 4 streams.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; More than 4 streams are sometimes required to fully saturate a link, this might explain some of the missing 5Mbps from your earlier tests.<br /></p><div class="quotebox"><cite>shm0 wrote:</cite><blockquote><br /><p>Here is the output from the commands:<br />tc -s qdisc show dev eth0:<br /></p><div class="codebox"><pre><code>qdisc cake 8013: root refcnt 9 bandwidth 4932Kbit diffserv4 flows raw
 Sent 1276670 bytes 6074 pkt (dropped 0, overlimits 1207 requeues 0)
 backlog 0b 0p requeues 0
           Class 0     Class 1     Class 2     Class 3
  rate      4932Kbit    4623Kbit    3699Kbit    1233Kbit
  target       5.0ms       5.0ms       5.0ms      14.7ms
interval     100.0ms     100.0ms     100.0ms     117.9ms
Pk delay         0us       604us         0us         0us
Av delay         0us        37us         0us         0us
Sp delay         0us         0us         0us         0us
  pkts             0        6063          11           0
way inds           0          23           0           0
way miss           0         512          11           0
way cols           0           0           0           0
  bytes            0     1275680         990           0
  drops            0           0           0           0
  marks            0           0           0           0
qdisc ingress ffff: parent ffff:fff1 ----------------
 Sent 4364661 bytes 18406 pkt (dropped 0, overlimits 0 requeues 0)
 backlog 0b 0p requeues 0</code></pre></div></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; This shows that on egress almost all packets are in class 1 (best effort) due to their DSCP markings, this class only has 4623Kbit available, cake reserves a few Kbps to allow class 0 (Background) will always be able to make some progress); if I recall correctly if there is no traffic in the background class class one will the whole pipe...<br /></p><div class="quotebox"><cite>shm0 wrote:</cite><blockquote><p>tc -s qdisc show dev ifb4eth0<br /></p><div class="codebox"><pre><code>qdisc cake 8014: root refcnt 2 bandwidth 143616Kbit besteffort flows raw
 Sent 4735254 bytes 18875 pkt (dropped 0, overlimits 1764 requeues 0)
 backlog 0b 0p requeues 0
           Class 0
  rate    143616Kbit
  target       5.0ms
interval     100.0ms
Pk delay        55us
Av delay         2us
Sp delay         0us
  pkts         18654
way inds           0
way miss         549
way cols           0
  bytes      4735254
  drops            0
  marks            0</code></pre></div></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; This shows that on ingress there is only one class anyway, so expect a maximal good-put of 1460/1514*143616 = 138493 Kbps.<br /></p><div class="quotebox"><cite>shm0 wrote:</cite><blockquote><p>tc -d qdisc<br /></p><div class="codebox"><pre><code>qdisc cake 8013: dev eth0 root refcnt 9 bandwidth 4932Kbit diffserv4 flows raw
qdisc ingress ffff: dev eth0 parent ffff:fff1 ----------------
qdisc mq 0: dev eth1 root
qdisc fq_codel 0: dev eth1 parent :1 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc fq_codel 0: dev eth1 parent :2 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc fq_codel 0: dev eth1 parent :3 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc fq_codel 0: dev eth1 parent :4 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc fq_codel 0: dev eth1 parent :5 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc fq_codel 0: dev eth1 parent :6 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc fq_codel 0: dev eth1 parent :7 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc fq_codel 0: dev eth1 parent :8 limit 1024p flows 1024 quantum 300 target 5.0ms interval 100.0ms ecn
qdisc cake 8014: dev ifb4eth0 root refcnt 2 bandwidth 143616Kbit besteffort flows raw</code></pre></div><p>My ISP has currently some regional problems (perfect timing...) so i cant post numbers before / after testing.</p></blockquote></div><p>Thanks for the data. The ISP problems are never well-timed <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" />.</p><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p291883">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">shm0</div>
					<div class="post-datetime">
						15 Sep 2015, 01:59					</div>
				</div>
				<div class="post-content content">
					<p>Thanks again clearing this things up for me <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /></p><p>My ISP is slowly recovering.<br />The provided speedtest by isp gives me again ~162 Mbits. bufferbloat servers currently &quot;only&quot; ~100 Mbits.<br />I think i will aim for the advertised 150 Mbits and look how it goes the next days.</p><p>Upload measures around 4.88 - 4.92 Mbit/s.<br />That would be 5102 kbit/s.<br />I also made a mistake calculating the voip bandwith.<br />G7.11 uses 64kbit bitrate for the audio encoding. But actual bandwith used is 95.2 kbit/s with overhead.<br />As stated here: <a href="http://www.3cx.com/blog/docs/bandwidth-utilised-for-voip/">http://www.3cx.com/blog/docs/bandwidth- … -for-voip/</a><br />So for 2 lines i set 5102 - 2*95.2 = 4911,6<br />I will go for 4900 and look how it goes.</p><br /><p>//Edit<br />The Download shaping comes close to 150mbit now ~149Mbit.<br />Upload:<br />5248 Kbit/s sync - Overhead = 5060 kbit/s<br />With Sqm disabled: 4.92 Mbit/s measured speed =&nbsp; 5102<br />Which is higher then calculated. but not much. <br />i will take the lower one and subtract the voip bandwith from it.</p><p>//Edit 2 <br />Upload is strange<br />5100 should allow 4.92 Mbit/s but gives 4.72 Mbit/s.<br />4666 should allow 4.5 Mbit/s but gives 4.35 MBit/s<br />4147 should allow 4 Mbit/s but gives 3.87 Mbit/s</p><p>Anyways good values are between 5000 and 5100 but to be on the safe site i use the 95% here.<br />i measured 4,92 max. So ~5100 * 0,95 = 4845 Kbit/s.<br />So i use 4845 - Voip Bandwith = 4654 kbit/s.</p><p>Tests with 155500 / 4650:<br /></p><div class="codebox"><pre><code>Testing netperf-eu.bufferbloat.net (ipv4) with 4 streams down and up while pinging heise.de. Takes about 150 seconds.
 Download:  138.37 Mbps
   Upload:  2.14 Mbps
  Latency: (in msec, 151 pings, 0.00% packet loss)
      Min: 15.082
    10pct: 18.431
   Median: 23.260
      Avg: 23.217
    90pct: 27.393
      Max: 41.968</code></pre></div><div class="codebox"><pre><code>Testing netperf-eu.bufferbloat.net (ipv4) with 16 streams down and up while pinging heise.de. Takes about 150 seconds.
netperf: send_omni: connect_data_socket failed: Connection timed out
 Download:  141.53 Mbps
   Upload:  1.8 Mbps
  Latency: (in msec, 152 pings, 0.00% packet loss)
      Min: 14.581
    10pct: 17.805
   Median: 22.593
      Avg: 22.999
    90pct: 28.042
      Max: 35.359</code></pre></div><br /><div class="codebox"><pre><code>2015-09-15 03:34:28 Testing against netperf-eu.bufferbloat.net (ipv4) with 5 simultaneous sessions while pinging heise.de (150 seconds in each direction)
.......................................................................................................................................................
 Download:  145.64 Mbps
  Latency: (in msec, 151 pings, 0.00% packet loss)
      Min: 15.526
    10pct: 18.082
   Median: 21.572
      Avg: 22.390
    90pct: 28.037
      Max: 34.901
.......................................................................................................................................................
   Upload:  4.37 Mbps
  Latency: (in msec, 151 pings, 0.00% packet loss)
      Min: 14.747
    10pct: 17.445
   Median: 21.241
      Avg: 21.429
    90pct: 25.035
      Max: 50.342</code></pre></div><div class="codebox"><pre><code>2015-09-15 03:39:42 Testing against netperf-eu.bufferbloat.net (ipv4) with 16 simultaneous sessions while pinging heise.de (150 seconds in each direction)
......................................................................................................................................................
 Download:  146.73 Mbps
  Latency: (in msec, 151 pings, 0.00% packet loss)
      Min: 16.105
    10pct: 17.784
   Median: 21.817
      Avg: 22.021
    90pct: 26.543
      Max: 30.524
........................................................................................................................................................
   Upload:  4.48 Mbps
  Latency: (in msec, 152 pings, 0.00% packet loss)
      Min: 14.470
    10pct: 17.765
   Median: 21.529
      Avg: 21.452
    90pct: 25.562
      Max: 29.031</code></pre></div><p>tc -s qdisc show dev eth0<br /></p><div class="codebox"><pre><code>qdisc cake 80b3: root refcnt 9 bandwidth 4650Kbit diffserv4 flows raw
 Sent 778745878 bytes 5662847 pkt (dropped 411044, overlimits 6711281 requeues 0)
 backlog 0b 0p requeues 0
           Class 0     Class 1     Class 2     Class 3
  rate      4650Kbit    4359Kbit    3487Kbit    1162Kbit
  target       5.0ms       5.0ms       5.2ms      15.6ms
interval     100.0ms     100.0ms     100.2ms     125.0ms
Pk delay         0us       2.5ms        23us        43us
Av delay         0us       336us         0us         0us
Sp delay         0us         0us         0us         0us
  pkts             0     6073880           6           5
way inds           0        5418           0           0
way miss           0         535           6           5
way cols           0           0           0           0
  bytes            0   844189578         540        1320
  drops            0      411044           0           0
  marks            0           0           0           0
qdisc ingress ffff: parent ffff:fff1 ----------------
 Sent 16705455072 bytes 11580011 pkt (dropped 0, overlimits 0 requeues 0)
 backlog 0b 0p requeues 0</code></pre></div><p>tc -s qdisc show dev ifb4eth0<br /></p><div class="codebox"><pre><code>root refcnt 2 bandwidth 155500Kbit besteffort flows raw
 Sent 17089688707 bytes 11578414 pkt (dropped 2614, overlimits 17824138 requeues 0)
 backlog 0b 0p requeues 0
           Class 0
  rate    155500Kbit
  target       5.0ms
interval     100.0ms
Pk delay         0us
Av delay         0us
Sp delay         0us
  pkts      11405182
way inds          41
way miss         552
way cols           0
  bytes  17093653873
  drops         2614
  marks            0</code></pre></div><p>Config<br /></p><div class="codebox"><pre><code>config queue &#039;eth1&#039;
    option linklayer &#039;none&#039;
    option interface &#039;eth0&#039;
    option qdisc &#039;cake&#039;
    option script &#039;layer_cake.qos&#039;
    option qdisc_advanced &#039;0&#039;
    option enabled &#039;1&#039;
    option upload &#039;4650&#039;
    option download &#039;155500&#039;</code></pre></div><p>Advanced settings are not working for cake or?</p>											<p class="post-edited">(Last edited by <strong>shm0</strong> on 15 Sep 2015, 04:55)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p291920">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						15 Sep 2015, 10:22					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>shm0 wrote:</cite><blockquote><p>Thanks again clearing this things up for me <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /></p><p>My ISP is slowly recovering.<br />The provided speedtest by isp gives me again ~162 Mbits. bufferbloat servers currently &quot;only&quot; ~100 Mbits.<br />I think i will aim for the advertised 150 Mbits and look how it goes the next days.</p><br /><p>Upload measures around 4.88 - 4.92 Mbit/s.<br />That would be 5102 kbit/s.<br />I also made a mistake calculating the voip bandwith.<br />G7.11 uses 64kbit bitrate for the audio encoding. But actual bandwith used is 95.2 kbit/s with overhead.<br />As stated here: <a href="http://www.3cx.com/blog/docs/bandwidth-utilised-for-voip/">http://www.3cx.com/blog/docs/bandwidth- … -for-voip/</a><br />]<a href="http://www.3cx.com/blog/docs/bandwidth-utilised-for-voip/">http://www.3cx.com/blog/docs/bandwidth- … -for-voip/</a></p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; Good point and reference, so the easiest approximation would be 100Kbps per VOIP stream then <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /><br /></p><div class="quotebox"><cite>shm0 wrote:</cite><blockquote><p>So for 2 lines i set 5102 - 2*95.2 = 4911,6<br />I will go for 4900 and look how it goes.</p><br /><p>//Edit<br />The Download shaping comes close to 150mbit now ~149Mbit.<br />Upload:<br />5248 Kbit/s sync - Overhead = 5060 kbit/s<br />With Sqm disabled: 4.92 Mbit/s measured speed =&nbsp; 5102<br />Which is higher then calculated. but not much. <br />i will take the lower one and subtract the voip bandwith from it.</p><p>//Edit 2 <br />Upload is strange<br />5100 should allow 4.92 Mbit/s but gives 4.72 Mbit/s.<br />4666 should allow 4.5 Mbit/s but gives 4.35 MBit/s<br />4147 should allow 4 Mbit/s but gives 3.87 Mbit/s</p><p>Anyways good values are between 5000 and 5100 but to be on the safe site i use the 95% here.<br />i measured 4,92 max. So ~5100 * 0,95 = 4845 Kbit/s.<br />So i use 4845 - Voip Bandwith = 4654 kbit/s.</p><p>Tests with 155500 / 4650:<br /></p><div class="codebox"><pre><code>Testing netperf-eu.bufferbloat.net (ipv4) with 4 streams down and up while pinging heise.de. Takes about 150 seconds.
 Download:  138.37 Mbps
   Upload:  2.14 Mbps
  Latency: (in msec, 151 pings, 0.00% packet loss)
      Min: 15.082
    10pct: 18.431
   Median: 23.260
      Avg: 23.217
    90pct: 27.393
      Max: 41.968</code></pre></div></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; This looks pretty good. You could try to increase the number of streams to 16 which might give you higher total bandwidths, but the expectancy for latency is that you should get close to minimum RTT plus twice the target duration, which is 5ms by default. So 15 ms + 5 ms + 5 ms = 25 ms and you see a median and average below that and even thew 90% come close, so this is a pretty useable setting for the shaper I would say. Also I want to add that this pretty much measures the effect of the realistic worst case, up- and down-link saturation, on new flows; if your link performs well under these conditions it all most likely perform well for all your normal use cases.<br /></p><div class="quotebox"><cite>shm0 wrote:</cite><blockquote><div class="codebox"><pre><code>Testing netperf-eu.bufferbloat.net (ipv4) with 16 streams down and up while pinging heise.de. Takes about 150 seconds.
netperf: send_omni: connect_data_socket failed: Connection timed out
 Download:  141.53 Mbps
   Upload:  1.8 Mbps
  Latency: (in msec, 152 pings, 0.00% packet loss)
      Min: 14.581
    10pct: 17.805
   Median: 22.593
      Avg: 22.999
    90pct: 28.042
      Max: 35.359</code></pre></div></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; Ah, here is the test with more streams, I should read first and comment later, I guess <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /> Again Latency is great, the loss on the upload looks worse that it actually is. The reason for this is that the downlink packet flows will require ACK-Ppackets send in the reverse direction that are not measured by netperf and hence reduce the good-put for the uplink streams (the same happens on the downlink, but since your uplink is much smaller the effect on download good-put is much smaller.) Okay, but how much upload bandwidth is consumed by the ACK-traffic? We need to make a few approximations (or you could supply these numbers), so lets assume your computer sends an ACK for every second full MTU incoming packet and that the speedtest uses full MTU packets, then:</p><p>Download packet rate required to achieve measured good-put: <br />(141530Kbps * 1000bit/K) / (1460Byte*8bit/Byte) = 12117.2945205 packets/second</p><p>Let&#039;s just assume this to be at least 64 bytes due to ethernet frames being &gt;= 64 bytes, depending on your actual setup the size might be slightly smaller or larger and I am unsure whether DOCSIS will strip out ethernet padding or transfer it. But no matter much 64 bytes should be a decent ball-park figure)<br />Size of ACK packets: 64 Bytes </p><p>Upload ACK rate: 0.5 * Download packet rate: 0.5*12117.2945205 = 6058.64726025</p><p>Upload ACK bandwidth: Upload ACK rate * Size of ACK packets = (0.5*12117.2945205 * (64*8))/1000^2 = 3.10202739725 Mbps</p><p>So with a measured 1.8 Mbps (let&#039;s ignore the per packet overhead here) and an assumed 3Mbps reverse invisible ACK traffic you are saturating your uplink just nicely with ~ 4.8Mbps </p><br /><div class="quotebox"><cite>shm0 wrote:</cite><blockquote><div class="codebox"><pre><code>2015-09-15 03:34:28 Testing against netperf-eu.bufferbloat.net (ipv4) with 5 simultaneous sessions while pinging heise.de (150 seconds in each direction)
.......................................................................................................................................................
 Download:  145.64 Mbps
  Latency: (in msec, 151 pings, 0.00% packet loss)
      Min: 15.526
    10pct: 18.082
   Median: 21.572
      Avg: 22.390
    90pct: 28.037
      Max: 34.901
.......................................................................................................................................................
   Upload:  4.37 Mbps
  Latency: (in msec, 151 pings, 0.00% packet loss)
      Min: 14.747
    10pct: 17.445
   Median: 21.241
      Avg: 21.429
    90pct: 25.035
      Max: 50.342</code></pre></div><div class="codebox"><pre><code>2015-09-15 03:39:42 Testing against netperf-eu.bufferbloat.net (ipv4) with 16 simultaneous sessions while pinging heise.de (150 seconds in each direction)
......................................................................................................................................................
 Download:  146.73 Mbps
  Latency: (in msec, 151 pings, 0.00% packet loss)
      Min: 16.105
    10pct: 17.784
   Median: 21.817
      Avg: 22.021
    90pct: 26.543
      Max: 30.524
........................................................................................................................................................
   Upload:  4.48 Mbps
  Latency: (in msec, 152 pings, 0.00% packet loss)
      Min: 14.470
    10pct: 17.765
   Median: 21.529
      Avg: 21.452
    90pct: 25.562
      Max: 29.031</code></pre></div><p>tc -s qdisc show dev eth0<br /></p><div class="codebox"><pre><code>qdisc cake 80b3: root refcnt 9 bandwidth 4650Kbit diffserv4 flows raw
 Sent 778745878 bytes 5662847 pkt (dropped 411044, overlimits 6711281 requeues 0)
 backlog 0b 0p requeues 0
           Class 0     Class 1     Class 2     Class 3
  rate      4650Kbit    4359Kbit    3487Kbit    1162Kbit
  target       5.0ms       5.0ms       5.2ms      15.6ms
interval     100.0ms     100.0ms     100.2ms     125.0ms
Pk delay         0us       2.5ms        23us        43us
Av delay         0us       336us         0us         0us
Sp delay         0us         0us         0us         0us
  pkts             0     6073880           6           5
way inds           0        5418           0           0
way miss           0         535           6           5
way cols           0           0           0           0
  bytes            0   844189578         540        1320
  drops            0      411044           0           0
  marks            0           0           0           0
qdisc ingress ffff: parent ffff:fff1 ----------------
 Sent 16705455072 bytes 11580011 pkt (dropped 0, overlimits 0 requeues 0)
 backlog 0b 0p requeues 0</code></pre></div><p>tc -s qdisc show dev ifb4eth0<br /></p><div class="codebox"><pre><code>root refcnt 2 bandwidth 155500Kbit besteffort flows raw
 Sent 17089688707 bytes 11578414 pkt (dropped 2614, overlimits 17824138 requeues 0)
 backlog 0b 0p requeues 0
           Class 0
  rate    155500Kbit
  target       5.0ms
interval     100.0ms
Pk delay         0us
Av delay         0us
Sp delay         0us
  pkts      11405182
way inds          41
way miss         552
way cols           0
  bytes  17093653873
  drops         2614
  marks            0</code></pre></div><p>Config<br /></p><div class="codebox"><pre><code>config queue &#039;eth1&#039;
    option linklayer &#039;none&#039;
    option interface &#039;eth0&#039;
    option qdisc &#039;cake&#039;
    option script &#039;layer_cake.qos&#039;
    option qdisc_advanced &#039;0&#039;
    option enabled &#039;1&#039;
    option upload &#039;4650&#039;
    option download &#039;155500&#039;</code></pre></div><p>Advanced settings are not working for cake or?</p></blockquote></div><p>option qdisc_advanced &#039;0&#039; just means you did not configure any advanced options, once you check the checkbox n the GUI you will see more.</p><p>All in all, it looks like your link is in pretty good shape now during the night conditions. I guess the next test will be performance during peak hours, to figure out whether you can find shaper settings that work during the day?</p><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p291965">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">shm0</div>
					<div class="post-datetime">
						15 Sep 2015, 17:53					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for helping me to get the best results <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /><br />I wondered myself why my upload is lower with full load in both directions.i thought about ack too. But i was not sure if that much bandwith is really used for acks and i couldnt find the calculation online (atleast an easy one <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" />)<br />Thanks for doing the actual math for this!<br />5Mbit Up is quite low for an 150mbit link. My ISP has new connections speeds ready 200/20 Mbit. But then i would get a new router. Its the same brand but newer model. I&#039;m not quite sure if the bridge trick works here to use my own hardware. But there is also a new law coming in my country which states that the user must be able to use his own hardware. In the next half here or so.<br />I think i will just wait...</p><p>Yes i also think the numbers looks pretty good. Good job bufferbloat team. Thanks for this nice peace of active queue management implementation!</p><p>Now for the day time testing <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Im not able to reach the full 150mbit with bufferbloat servers. <br />The peering of my isp is really not that good. They got bought by upc and they changed the hole routing. So most of the traffic stays in the upc network. I guess its cheaper...<br />Maybe i should get a cheap root server in my region here xD<br />My ISP speed test maxes out again at the shaped 150mbit. Doing some pings in background looks quite good.<br />But my first betterspeedtest.sh run gives me this:</p><div class="codebox"><pre><code>2015-09-15 15:49:51 Testing against netperf-eu.bufferbloat.net (ipv4) with 5 simultaneous sessions while pinging heise.de (150 seconds in each direction)
.......................................................................................................................................................
 Download:  128.08 Mbps
  Latency: (in msec, 151 pings, 0.00% packet loss)
      Min: 15.727
    10pct: 21.606
   Median: 97.574
      Avg: 151.150
    90pct: 393.321
      Max: 629.163
.......................................................................................................................................................
   Upload:  4.39 Mbps
  Latency: (in msec, 151 pings, 0.00% packet loss)
      Min: 13.717
    10pct: 17.530
   Median: 22.225
      Avg: 22.402
    90pct: 26.972
      Max: 31.478</code></pre></div><p>Download seems to rise pings again.</p><p>But netperfrunner.sh looks like this:</p><div class="codebox"><pre><code>./netperfrunner.sh -t 150 -n 16
2015-09-15 16:49:09 Testing netperf-eu.bufferbloat.net (ipv4) with 16 streams down and up while pinging heise.de. Takes about 150 seconds.
 Download:  141.31 Mbps
   Upload:  1.78 Mbps
  Latency: (in msec, 152 pings, 0.00% packet loss)
      Min: 14.174
    10pct: 17.782
   Median: 23.165
      Avg: 24.580
    90pct: 29.448
      Max: 119.737</code></pre></div><p>Higher download speed but nice pings.</p><p>Should i lower my download speed anyway?</p><p>For advanced settings. I mean if change something there with cake activated i cant see any change in the tc outputs.<br />How to change the target to 20ms and the interval to 150ms for example?</p><p>//Edit <br />Later in the evening:<br />155500/4650 (100% of 150 MBit + Overhead)<br /></p><div class="codebox"><pre><code> Testing netperf-eu.bufferbloat.net (ipv4) with 16 streams down and up while pinging heise.de. Takes about 150 seconds.
 Download:  128.95 Mbps
   Upload:  1.63 Mbps
  Latency: (in msec, 149 pings, 0.00% packet loss)
      Min: 15.822
    10pct: 21.497
   Median: 63.419
      Avg: 134.509
    90pct: 358.170
      Max: 641.134</code></pre></div><p>147770/4650 (95% of 150Mbit + Overhead)<br /></p><div class="codebox"><pre><code>2015-09-15 19:20:53 Testing netperf-eu.bufferbloat.net (ipv4) with 16 streams down and up while pinging heise.de. Takes about 150 seconds.
 Download:  122.8 Mbps
   Upload:  1.79 Mbps
  Latency: (in msec, 151 pings, 0.00% packet loss)
      Min: 15.116
    10pct: 19.544
   Median: 27.822
      Avg: 42.901
    90pct: 94.268
      Max: 177.657</code></pre></div><p>139993/4650 (90% of 150 Mbit + Overhead)<br /></p><div class="codebox"><pre><code>2015-09-15 19:25:13 Testing netperf-eu.bufferbloat.net (ipv4) with 16 streams down and up while pinging heise.de. Takes about 150 seconds.
 Download:  112.27 Mbps
   Upload:  1.9 Mbps
  Latency: (in msec, 150 pings, 0.00% packet loss)
      Min: 15.196
    10pct: 17.684
   Median: 22.766
      Avg: 23.107
    90pct: 28.398
 Max: 39.917</code></pre></div><p>Better pings but download doesnt seems maxed.</p><p>Same speed as before but only 4 streams (i noticed during testing sometimes more streams gives me lower download speed)<br /></p><div class="codebox"><pre><code>./netperfrunner.sh -t 150 -n 4
2015-09-15 19:29:28 Testing netperf-eu.bufferbloat.net (ipv4) with 4 streams down and up while pinging heise.de. Takes about 150 seconds.
 Download:  113.16 Mbps
   Upload:  2.07 Mbps
  Latency: (in msec, 149 pings, 0.00% packet loss)
      Min: 14.060
    10pct: 19.461
   Median: 23.755
      Avg: 24.653
    90pct: 29.867
      Max: 59.699</code></pre></div><p>Still not maxing out downspeed. ISP speedtest gives ~134 Mbit/s.</p><p>139993/4650 (90% of 150 Mbit + Overhead)<br /></p><div class="codebox"><pre><code>2015-09-15 19:25:13 Testing netperf-eu.bufferbloat.net (ipv4) with 16 streams down and up while pinging heise.de. Takes about 150 seconds.
 Download:  112.27 Mbps
   Upload:  1.9 Mbps
  Latency: (in msec, 150 pings, 0.00% packet loss)
      Min: 15.196
    10pct: 17.684
   Median: 22.766
      Avg: 23.107
    90pct: 28.398
 Max: 39.917</code></pre></div><p>Better pings but download doesnt seems maxed.</p><br /><p>Same speed as before but only 4 streams (i noticed during testing sometimes more streams gives me lower download speed)<br /></p><div class="codebox"><pre><code>./netperfrunner.sh -t 150 -n 4
2015-09-15 19:29:28 Testing netperf-eu.bufferbloat.net (ipv4) with 4 streams down and up while pinging heise.de. Takes about 150 seconds.
 Download:  113.16 Mbps
   Upload:  2.07 Mbps
  Latency: (in msec, 149 pings, 0.00% packet loss)
      Min: 14.060
    10pct: 19.461
   Median: 23.755
      Avg: 24.653
    90pct: 29.867
      Max: 59.699</code></pre></div><p>Download still not maxed. ISP gives ~135 Mbit/s.</p><p>Last test<br />132215/4650 (85% of 150Mbit + Overhead) <br /></p><div class="codebox"><pre><code>Testing netperf-eu.bufferbloat.net (ipv4) with 4 streams down and up while pinging heise.de. Takes about 150 seconds.
 Download:  115.03 Mbps
   Upload:  2.13 Mbps
  Latency: (in msec, 151 pings, 0.00% packet loss)
      Min: 14.442
    10pct: 17.558
   Median: 22.018
      Avg: 23.484
    90pct: 26.136
      Max: 122.554</code></pre></div><p>Again not maxing download speed but pings are nice.<br />I guess i will just stick with the 85%. To be on the safe side?</p>											<p class="post-edited">(Last edited by <strong>shm0</strong> on 15 Sep 2015, 20:40)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p292056">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						16 Sep 2015, 11:03					</div>
				</div>
				<div class="post-content content">
					<p>Hi shm0,</p><div class="quotebox"><cite>shm0 wrote:</cite><blockquote><p>Thanks for helping me to get the best results <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /><br />I wondered myself why my upload is lower with full load in both directions.i thought about ack too. But i was not sure if that much bandwith is really used for acks and i couldnt find the calculation online (atleast an easy one <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" />)<br />Thanks for doing the actual math for this!</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; Happy to help, but please note that the math is approximate only, for exact measurements you should gat a packet capture and figure out the size of your ACK packets exactly and the ACK rate. But the approximation should at least get the order of magnitude right <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /><br /></p><div class="quotebox"><cite>shm0 wrote:</cite><blockquote><p>5Mbit Up is quite low for an 150mbit link. My ISP has new connections speeds ready 200/20 Mbit. But then i would get a new router. Its the same brand but newer model. I&#039;m not quite sure if the bridge trick works here to use my own hardware. But there is also a new law coming in my country which states that the user must be able to use his own hardware. In the next half here or so.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; From this and your ping target I have a hunch I know which country you are speaking of <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /><br /></p><div class="quotebox"><cite>shm0 wrote:</cite><blockquote><p>I think i will just wait...</p><p>Yes i also think the numbers looks pretty good. Good job bufferbloat team. Thanks for this nice peace of active queue management implementation!</p><p>Now for the day time testing <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Im not able to reach the full 150mbit with bufferbloat servers. <br />The peering of my isp is really not that good.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; I have a similar issue with DTAG where the peelings in the evening often are congested and bandwidth suffers.<br /></p><div class="quotebox"><cite>shm0 wrote:</cite><blockquote><p>They got bought by upc and they changed the hole routing. So most of the traffic stays in the upc network. I guess its cheaper...<br />Maybe i should get a cheap root server in my region here xD<br />My ISP speed test maxes out again at the shaped 150mbit. Doing some pings in background looks quite good.<br />But my first betterspeedtest.sh run gives me this:</p><div class="codebox"><pre><code>2015-09-15 15:49:51 Testing against netperf-eu.bufferbloat.net (ipv4) with 5 simultaneous sessions while pinging heise.de (150 seconds in each direction)
.......................................................................................................................................................
 Download:  128.08 Mbps
  Latency: (in msec, 151 pings, 0.00% packet loss)
      Min: 15.727
    10pct: 21.606
   Median: 97.574
      Avg: 151.150
    90pct: 393.321
      Max: 629.163
.......................................................................................................................................................
   Upload:  4.39 Mbps
  Latency: (in msec, 151 pings, 0.00% packet loss)
      Min: 13.717
    10pct: 17.530
   Median: 22.225
      Avg: 22.402
    90pct: 26.972
      Max: 31.478</code></pre></div><p>Download seems to rise pings again.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; I agree that download session looks pretty terrible, upload is good though.<br /></p><div class="quotebox"><cite>shm0 wrote:</cite><blockquote><br /><br /><p>But netperfrunner.sh looks like this:</p><div class="codebox"><pre><code>./netperfrunner.sh -t 150 -n 16
2015-09-15 16:49:09 Testing netperf-eu.bufferbloat.net (ipv4) with 16 streams down and up while pinging heise.de. Takes about 150 seconds.
 Download:  141.31 Mbps
   Upload:  1.78 Mbps
  Latency: (in msec, 152 pings, 0.00% packet loss)
      Min: 14.174
    10pct: 17.782
   Median: 23.165
      Avg: 24.580
    90pct: 29.448
      Max: 119.737</code></pre></div><p>Higher download speed but nice pings.</p><p>Should i lower my download speed anyway?</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; This just shows that the available download bandwidth is quite variable. You will have to find the compromise between sacrificed bandwidth and the amount of induced latency you are willing to accept. Personally I probably would accept the occasional latency spike as long as normally latency is well contained.<br /></p><div class="quotebox"><cite>shm0 wrote:</cite><blockquote><p>For advanced settings. I mean if change something there with cake activated i cant see any change in the tc outputs.<br />How to change the target to 20ms and the interval to 150ms for example?</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp;Ah, so cake only offer a few advanced options, and interval and target currently are not among those, I believe. Have a look at the out put of tc:<br /></p><div class="codebox"><pre><code>user@computer:~&gt; sudo tc-adv qdisc add cake help
Usage: ... cake [ bandwidth RATE | unlimited* ]
                [ besteffort | precedence | diffserv8 | diffserv4* ]
                [ flowblind | srchost | dsthost | hosts | flows* ]
                [ atm | noatm* ] [ overhead N | conservative | raw* ]
    (* marks defaults)</code></pre></div><p>All those you could use, by checking the advanced options and the dangerous options checkboxes and use the two advanced option strings to pass arguments to cake (called &quot;Advanced option string to pass to the ingress/egress queueing disciplines; no error checking, use very carefully.&quot;). But I do not think there currently are interesting cake options to toggle...<br /></p><div class="quotebox"><cite>shm0 wrote:</cite><blockquote><p>//Edit <br />Later in the evening:<br />155500/4650 (100% of 150 MBit + Overhead)<br /></p><div class="codebox"><pre><code> Testing netperf-eu.bufferbloat.net (ipv4) with 16 streams down and up while pinging heise.de. Takes about 150 seconds.
 Download:  128.95 Mbps
   Upload:  1.63 Mbps
  Latency: (in msec, 149 pings, 0.00% packet loss)
      Min: 15.822
    10pct: 21.497
   Median: 63.419
      Avg: 134.509
    90pct: 358.170
      Max: 641.134</code></pre></div></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; Again latency is not too well controlled...<br /></p><div class="quotebox"><cite>shm0 wrote:</cite><blockquote><p>147770/4650 (95% of 150Mbit + Overhead)<br /></p><div class="codebox"><pre><code>2015-09-15 19:20:53 Testing netperf-eu.bufferbloat.net (ipv4) with 16 streams down and up while pinging heise.de. Takes about 150 seconds.
 Download:  122.8 Mbps
   Upload:  1.79 Mbps
  Latency: (in msec, 151 pings, 0.00% packet loss)
      Min: 15.116
    10pct: 19.544
   Median: 27.822
      Avg: 42.901
    90pct: 94.268
      Max: 177.657</code></pre></div></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; This looks better...<br /></p><div class="quotebox"><cite>shm0 wrote:</cite><blockquote><p>139993/4650 (90% of 150 Mbit + Overhead)<br /></p><div class="codebox"><pre><code>2015-09-15 19:25:13 Testing netperf-eu.bufferbloat.net (ipv4) with 16 streams down and up while pinging heise.de. Takes about 150 seconds.
 Download:  112.27 Mbps
   Upload:  1.9 Mbps
  Latency: (in msec, 150 pings, 0.00% packet loss)
      Min: 15.196
    10pct: 17.684
   Median: 22.766
      Avg: 23.107
    90pct: 28.398
 Max: 39.917</code></pre></div><p>Better pings but download doesnt seems maxed.</p><p>Same speed as before but only 4 streams (i noticed during testing sometimes more streams gives me lower download speed)</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; It looks like there is a lot of variability on your line, which means you might have to repeat each of these measurements a few times ...<br /></p><div class="quotebox"><cite>shm0 wrote:</cite><blockquote><div class="codebox"><pre><code>./netperfrunner.sh -t 150 -n 4
2015-09-15 19:29:28 Testing netperf-eu.bufferbloat.net (ipv4) with 4 streams down and up while pinging heise.de. Takes about 150 seconds.
 Download:  113.16 Mbps
   Upload:  2.07 Mbps
  Latency: (in msec, 149 pings, 0.00% packet loss)
      Min: 14.060
    10pct: 19.461
   Median: 23.755
      Avg: 24.653
    90pct: 29.867
      Max: 59.699</code></pre></div><p>Still not maxing out downspeed. ISP speedtest gives ~134 Mbit/s.</p><p>139993/4650 (90% of 150 Mbit + Overhead)<br /></p><div class="codebox"><pre><code>2015-09-15 19:25:13 Testing netperf-eu.bufferbloat.net (ipv4) with 16 streams down and up while pinging heise.de. Takes about 150 seconds.
 Download:  112.27 Mbps
   Upload:  1.9 Mbps
  Latency: (in msec, 150 pings, 0.00% packet loss)
      Min: 15.196
    10pct: 17.684
   Median: 22.766
      Avg: 23.107
    90pct: 28.398
 Max: 39.917</code></pre></div><p>Better pings but download doesnt seems maxed.</p><br /><p>Same speed as before but only 4 streams (i noticed during testing sometimes more streams gives me lower download speed)<br /></p><div class="codebox"><pre><code>./netperfrunner.sh -t 150 -n 4
2015-09-15 19:29:28 Testing netperf-eu.bufferbloat.net (ipv4) with 4 streams down and up while pinging heise.de. Takes about 150 seconds.
 Download:  113.16 Mbps
   Upload:  2.07 Mbps
  Latency: (in msec, 149 pings, 0.00% packet loss)
      Min: 14.060
    10pct: 19.461
   Median: 23.755
      Avg: 24.653
    90pct: 29.867
      Max: 59.699</code></pre></div><p>Download still not maxed. ISP gives ~135 Mbit/s.</p><p>Last test<br />132215/4650 (85% of 150Mbit + Overhead) <br /></p><div class="codebox"><pre><code>Testing netperf-eu.bufferbloat.net (ipv4) with 4 streams down and up while pinging heise.de. Takes about 150 seconds.
 Download:  115.03 Mbps
   Upload:  2.13 Mbps
  Latency: (in msec, 151 pings, 0.00% packet loss)
      Min: 14.442
    10pct: 17.558
   Median: 22.018
      Avg: 23.484
    90pct: 26.136
      Max: 122.554</code></pre></div><p>Again not maxing download speed but pings are nice.<br />I guess i will just stick with the 85%. To be on the safe side?</p></blockquote></div><p>There is always a trade-off between latency under load and useable bandwidth, you will have to find a compromise between both that works well for your applications and that you are happy with. You can always (temporarily) disable SQM if you need maximal bandwidth even at the cost of induced latency, and congestion on your cable segment might change, so simply keep re-assessing your shaper settings occasionally...</p><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p292592">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">shm0</div>
					<div class="post-datetime">
						19 Sep 2015, 16:39					</div>
				</div>
				<div class="post-content content">
					<p>Today my download speed is really low. only around 85 Mbit/s.<br />For the time being i created a script which set the download speed through uci and restart sqm.<br />It runs&nbsp; through cron every day 12 am and 12pm.<br />i think it would be better to directly set the download speed with tc. But im not sure how to do this.<br />Do i have to delete the ifb4eth0 device and recreate it with the new download speed? Or can it be changed on the fly?<br />//edit<br />Okay i think this is way or?<br />tc qdisc change dev ifb4eth0 root cake bandwidth 75Mbit&nbsp; besteffort</p><br /><p>I also thought to run a script every hour to collect data over the available bandwith for each day or create some adaptive adaption like gargoyle has. but this will take some time. <br />How to get the global wan speed ? CC has some nice real time graphs for bandwith. How can i use this data in a batch script for example?<br />When i have the data for each day i can use this as starting point for the adaptive shaping.</p>											<p class="post-edited">(Last edited by <strong>shm0</strong> on 19 Sep 2015, 16:46)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>