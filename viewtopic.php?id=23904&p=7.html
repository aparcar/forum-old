<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Multi-WAN Load Balancing</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 29 Mar 2018 and 3 May 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 7 of 14</div><nav><ul><li><a href="viewtopic.php%3Fid=23904&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=23904&amp;p=5.html">5</a></li><li><a href="viewtopic.php%3Fid=23904&amp;p=6.html">6</a></li><li class="pagination-current"><span>7</span></li><li><a href="viewtopic.php%3Fid=23904&amp;p=8.html">8</a></li><li><a href="viewtopic.php%3Fid=23904&amp;p=9.html">9</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=23904&amp;p=14.html">14</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p111942">
				<div class="post-metadata">
					<div class="post-num">Post #151</div>
					<div class="post-author">daniel_bergamini</div>
					<div class="post-datetime">
						26 Jun 2010, 05:24					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>daniel_bergamini wrote:</cite><blockquote><p>I&#039;m going to try and lower all the 300 and +300 stuff to 200 and +200 which should still get it out of the way and maybe work... we&#039;ll see.</p></blockquote></div><p>Yes indeed, a quick :%s/300/200/g and life is better, at least it&#039;s building out the table correctly.</p><div class="codebox"><pre><code>root@OpenWrt:~# ip rule show
0:    from all lookup local 
200:    from all fwmark 0x1 lookup 200 
210:    from 1.2.3.4 lookup 210 
211:    from all fwmark 0x10 lookup 210 
220:    from 192.168.100.100 lookup 220 
221:    from all fwmark 0x20 lookup 220 
32766:    from all lookup main 
32767:    from all lookup default</code></pre></div><p>I&#039;m going to play around a little with regard to seeing how it behaves after a failover but I&#039;ve been spot checking the connections and there is a lot less traffic from the wrong IP but still some. I have noticed that the ordering of the /tmp/resolv.conf.auto could be optimized a bit based on which connection is preferred.</p><p>For example, it wrote out wan&#039;s DNS servers first and then wan2&#039;s DNS servers, which means that all DNS traffic was going over wan, even though my default route was wan2. Fortunately it was all using the correct interface&#039;s IP, but still less than ideal. I think I could beat it by switching cables around and making wan the default route. Just something to think about...</p><p>Anyway, why is traffic still going out the wrong interface? I can only assume 256 is some magical boundary on the ip tables, which sort of makes sense.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p111948">
				<div class="post-metadata">
					<div class="post-num">Post #152</div>
					<div class="post-author">SouthPawn</div>
					<div class="post-datetime">
						26 Jun 2010, 11:06					</div>
				</div>
				<div class="post-content content">
					<p>I think the problem may be kernel specific, as I seem to see no issue with tables above 256.<br />In any case, I&#039;ve updated it to 1.0.14, which now puts the tables in the 170-190 range.</p><p>Let me know if you have any issues after that.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p111958">
				<div class="post-metadata">
					<div class="post-num">Post #153</div>
					<div class="post-author">Priyantha Bleeker</div>
					<div class="post-datetime">
						26 Jun 2010, 14:30					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>SouthPawn wrote:</cite><blockquote><div class="quotebox"><cite>Priyantha Bleeker wrote:</cite><blockquote><p>Well I don&#039;t need a specific traffic route, but I would like a sort of inteligent routering, so that it will choose the most logical way and the most fast way to the Internet.<br />If it is for a specific address via WAN1, and for another specific address via WAN2 it is the most ideal situation I think.</p></blockquote></div><p>In your situation, set the weight for the 8mbit wan to 10, and 5 for the 4mbit, as for specific addresses that&#039;s exactly what the outbound rules (mwanfw) is for.</p><p>[cut]</p><p>Then simply restart the service /etc/init.d/multiwan restart.</p></blockquote></div><p>Hi I did precise what you said.<br />But there wasn&#039;t changed anything.</p><p>I&#039;ve got here my config: <a href="http://www.priyantha.nl/multiwan">http://www.priyantha.nl/multiwan</a><br />In there I have also some preffered IP&#039;s over one specific WAN port, but that isn&#039;t working really.<br />For example in the config I have configures that the IP &quot;212.67.182.102&quot; should go over WAN and not over WAN2, but it is going over WAN2 acording to this traceroute:<br /></p><div class="codebox"><pre><code>traceroute to 212.67.182.102 (212.67.182.102), 30 hops max, 38 byte packets
 1  192.168.1.254 (192.168.1.254)  40.215 ms  6.326 ms  100.003 ms
 2  s55906c01.adsl.wanadoo.nl (85.144.108.1)  222.204 ms  63.414 ms  43.953 ms
 3  V512.dr3-asd5.nl.euro.net (194.134.152.37)  42.056 ms  184.549 ms  214.280 ms
 4  PC18.cr1-asd8.nl.euro.net (194.134.161.21)  227.640 ms  267.367 ms  58.792 ms
 5  PC11.er1-asd8.nl.euro.net (194.134.161.11)  89.888 ms  43.395 ms  111.789 ms
 6  asd-nik-pr01.xb.nl (195.69.144.90)  143.488 ms  171.624 ms  133.986 ms
 7  atm4-0-0-102.29999r9pe.ams.iparix.net (212.67.161.149)  123.030 ms  43.593 ms  44.833 ms
 8  212.67.182.162 (212.67.182.162)  128.244 ms  305.025 ms  385.464 ms
 9  ams-host.nl (212.67.182.102)  351.739 ms  247.630 ms  284.073 ms</code></pre></div><p>If I do the following before I am doing a traceroute: &quot;ip route add 212.67.182.102 via 213.148.226.1&quot;<br />Then I get this:<br /></p><div class="codebox"><pre><code>traceroute to 212.67.182.102 (212.67.182.102), 30 hops max, 38 byte packets
 1  ict.18.254.concepts.nl (213.197.18.254)  27.887 ms  7.651 ms  7.785 ms
 2  ict.18.25.concepts.nl (213.197.18.25)  23.080 ms  8.158 ms  8.305 ms
 3  asd-nik-pr01.xb.nl (195.69.144.90)  8.556 ms  8.782 ms  9.245 ms
 4  atm4-0-0-102.29999r9pe.ams.iparix.net (212.67.161.149)  8.882 ms  8.767 ms  9.177 ms
 5  212.67.182.162 (212.67.182.162)  9.100 ms  8.965 ms  9.000 ms
 6  ams-host.nl (212.67.182.102)  9.057 ms  9.165 ms  9.035 ms</code></pre></div><p>But then there is no any failover anymore which I want to have always if possible.<br />This is the output of &quot;ip route show&quot; this is AFTER adding the static route: <br /></p><div class="codebox"><pre><code>root@OpenWrt:~# ip route show
212.67.182.102 via 213.148.226.1 dev eth0.2 
192.168.3.0/24 dev br-lan  proto kernel  scope link  src 192.168.3.44 
192.168.1.0/24 dev eth0.3  proto kernel  scope link  src 192.168.1.67 
213.148.226.0/24 dev eth0.2  proto kernel  scope link  src 213.148.226.77 
default via 192.168.1.254 dev eth0.3 
default via 213.148.226.1 dev eth0.2</code></pre></div><p>Maybe you or somebody else can help me with this ?<br />Regards,</p><p>Priyantha</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p111965">
				<div class="post-metadata">
					<div class="post-num">Post #154</div>
					<div class="post-author">daniel_bergamini</div>
					<div class="post-datetime">
						26 Jun 2010, 19:13					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>SouthPawn wrote:</cite><blockquote><p>I think the problem may be kernel specific, as I seem to see no issue with tables above 256.<br />In any case, I&#039;ve updated it to 1.0.14, which now puts the tables in the 170-190 range.</p><p>Let me know if you have any issues after that.</p></blockquote></div><p>I wonder if it&#039;s a 2.4 vs 2.6 kernel kind of thing? Interesting you say 170-190&nbsp; because I&#039;m seeing it create rules 9-21. Not that I care as long as it&#039;s under 256.</p><div class="codebox"><pre><code>root@OpenWrt:~# uname -a
Linux OpenWrt 2.4.35.4 #12 Tue Dec 29 15:30:20 UTC 2009 mips unknown
root@OpenWrt:~# ip rule show
0:    from all lookup local 
9:    from all fwmark 0x1 lookup LoadBalancer 
10:    from 1.2.3.4 lookup MWAN1 
11:    from all fwmark 0x10 lookup MWAN1 
20:    from 192.168.100.100 lookup MWAN2 
21:    from all fwmark 0x20 lookup MWAN2 
32766:    from all lookup main 
32767:    from all lookup default</code></pre></div><p>Is this not right? Interestingly, with both connections in a working state, I am seeing DNS calls going out wan2 now, even though the /tmp/resolv.conf.auto has wan&#039;s DNS servers at the top of the file. I wonder if it was a timing thing last time.</p><p>I am still seeing wrong interface traffic but at a much reduced rate while both network connections are running properly. Once wan2 fails however, dnsmasq reloads with only wan&#039;s nameserver entries but wan2&#039;s IP is the only one making dns calls out wan&#039;s interface. It&#039;s really quite strange. If I do an &#039;ifdown wan2&#039; it corrects itself.</p><div class="codebox"><pre><code>Jun 26 12:03:25 OpenWrt user.notice root: [Multi-WAN Notice]: wan2 has failed and is currently offline.
Jun 26 12:03:25 OpenWrt user.info sysinit: ## Refreshing DNS Resolution and Tables ##
Jun 26 12:03:27 OpenWrt user.info sysinit: ## Refreshing Load Balancer ##
Jun 26 12:03:27 OpenWrt daemon.info dnsmasq[1019]: reading /tmp/resolv.conf.auto
Jun 26 12:03:27 OpenWrt daemon.info dnsmasq[1019]: using nameserver 4.2.2.3#53
Jun 26 12:03:27 OpenWrt daemon.info dnsmasq[1019]: using nameserver 4.2.2.1#53
Jun 26 12:03:27 OpenWrt daemon.info dnsmasq[1019]: using local addresses only for domain lan</code></pre></div><div class="codebox"><pre><code>root@OpenWrt:~# tcpdump -i eth0.1 -n net 4.2.2 and not icmp
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth0.1, link-type EN10MB (Ethernet), capture size 96 bytes
*** complete silence until wan2 fails and then; ***
12:03:41.685712 IP 192.168.100.100.12783 &gt; 4.2.2.1.53: 19756+ A? mail.google.com. (33)
12:03:41.686740 IP 192.168.100.100.12783 &gt; 4.2.2.3.53: 19756+ A? mail.google.com. (33)
12:03:46.690549 IP 192.168.100.100.12783 &gt; 4.2.2.1.53: 19756+ A? mail.google.com. (33)
12:03:46.691108 IP 192.168.100.100.12783 &gt; 4.2.2.3.53: 19756+ A? mail.google.com. (33)
12:03:51.698407 IP 192.168.100.100.37853 &gt; 4.2.2.1.53: 27751+ A? mail.google.com. (33)
12:03:51.699196 IP 192.168.100.100.37853 &gt; 4.2.2.3.53: 27751+ A? mail.google.com. (33)
12:03:56.700608 IP 192.168.100.100.37853 &gt; 4.2.2.1.53: 27751+ A? mail.google.com. (33)
12:03:56.701336 IP 192.168.100.100.37853 &gt; 4.2.2.3.53: 27751+ A? mail.google.com. (33)</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p111992">
				<div class="post-metadata">
					<div class="post-num">Post #155</div>
					<div class="post-author">SouthPawn</div>
					<div class="post-datetime">
						27 Jun 2010, 02:17					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>daniel_bergamini wrote:</cite><blockquote><div class="quotebox"><cite>SouthPawn wrote:</cite><blockquote><p>I think the problem may be kernel specific, as I seem to see no issue with tables above 256.<br />In any case, I&#039;ve updated it to 1.0.14, which now puts the tables in the 170-190 range.</p><p>Let me know if you have any issues after that.</p></blockquote></div><p>I wonder if it&#039;s a 2.4 vs 2.6 kernel kind of thing? Interesting you say 170-190&nbsp; because I&#039;m seeing it create rules 9-21. Not that I care as long as it&#039;s under 256.</p><div class="codebox"><pre><code>root@OpenWrt:~# uname -a
Linux OpenWrt 2.4.35.4 #12 Tue Dec 29 15:30:20 UTC 2009 mips unknown
root@OpenWrt:~# ip rule show
0:    from all lookup local 
9:    from all fwmark 0x1 lookup LoadBalancer 
10:    from 1.2.3.4 lookup MWAN1 
11:    from all fwmark 0x10 lookup MWAN1 
20:    from 192.168.100.100 lookup MWAN2 
21:    from all fwmark 0x20 lookup MWAN2 
32766:    from all lookup main 
32767:    from all lookup default</code></pre></div><p>Is this not right? Interestingly, with both connections in a working state, I am seeing DNS calls going out wan2 now, even though the /tmp/resolv.conf.auto has wan&#039;s DNS servers at the top of the file. I wonder if it was a timing thing last time.</p><p>I am still seeing wrong interface traffic but at a much reduced rate while both network connections are running properly. Once wan2 fails however, dnsmasq reloads with only wan&#039;s nameserver entries but wan2&#039;s IP is the only one making dns calls out wan&#039;s interface. It&#039;s really quite strange. If I do an &#039;ifdown wan2&#039; it corrects itself.</p><div class="codebox"><pre><code>Jun 26 12:03:25 OpenWrt user.notice root: [Multi-WAN Notice]: wan2 has failed and is currently offline.
Jun 26 12:03:25 OpenWrt user.info sysinit: ## Refreshing DNS Resolution and Tables ##
Jun 26 12:03:27 OpenWrt user.info sysinit: ## Refreshing Load Balancer ##
Jun 26 12:03:27 OpenWrt daemon.info dnsmasq[1019]: reading /tmp/resolv.conf.auto
Jun 26 12:03:27 OpenWrt daemon.info dnsmasq[1019]: using nameserver 4.2.2.3#53
Jun 26 12:03:27 OpenWrt daemon.info dnsmasq[1019]: using nameserver 4.2.2.1#53
Jun 26 12:03:27 OpenWrt daemon.info dnsmasq[1019]: using local addresses only for domain lan</code></pre></div><div class="codebox"><pre><code>root@OpenWrt:~# tcpdump -i eth0.1 -n net 4.2.2 and not icmp
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth0.1, link-type EN10MB (Ethernet), capture size 96 bytes
*** complete silence until wan2 fails and then; ***
12:03:41.685712 IP 192.168.100.100.12783 &gt; 4.2.2.1.53: 19756+ A? mail.google.com. (33)
12:03:41.686740 IP 192.168.100.100.12783 &gt; 4.2.2.3.53: 19756+ A? mail.google.com. (33)
12:03:46.690549 IP 192.168.100.100.12783 &gt; 4.2.2.1.53: 19756+ A? mail.google.com. (33)
12:03:46.691108 IP 192.168.100.100.12783 &gt; 4.2.2.3.53: 19756+ A? mail.google.com. (33)
12:03:51.698407 IP 192.168.100.100.37853 &gt; 4.2.2.1.53: 27751+ A? mail.google.com. (33)
12:03:51.699196 IP 192.168.100.100.37853 &gt; 4.2.2.3.53: 27751+ A? mail.google.com. (33)
12:03:56.700608 IP 192.168.100.100.37853 &gt; 4.2.2.1.53: 27751+ A? mail.google.com. (33)
12:03:56.701336 IP 192.168.100.100.37853 &gt; 4.2.2.3.53: 27751+ A? mail.google.com. (33)</code></pre></div></blockquote></div><p>My guess here is that it&#039;s just requests that were being made as the routing tables got updated for the failover.<br />I&#039;m thinking of changing this so that the default routing on the default routing table is actually the loopback which might help curb some of these. </p><p>I assume they drop off at some point, probably within minutes after failover is created.</p><p>The ip rules are listed with priority number, 9-X, the routing tables however are listed 170-190.</p><p>Edit: Upon closer inspection, I believe you and Priyantha have stumbled upon an issue I overlooked, with packets being generated on the router itself. </p><p>Namely the output &amp; postrouting tables, I will look in to this.</p>											<p class="post-edited">(Last edited by <strong>SouthPawn</strong> on 27 Jun 2010, 06:38)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p112000">
				<div class="post-metadata">
					<div class="post-num">Post #156</div>
					<div class="post-author">daniel_bergamini</div>
					<div class="post-datetime">
						27 Jun 2010, 06:58					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>SouthPawn wrote:</cite><blockquote><p>Edit: Upon closer inspection, I believe you and Priyantha have stumbled upon an issue I overlooked, with packets being generated on the router itself. </p><p>Namely the output &amp; postrouting tables, I will look in to this.</p></blockquote></div><p>This makes perfect sense, traffic going *through* the router appears to be working and failing over properly. If I set all my clients to go out to the net directly for DNS I bet everything would work flawlessly. Since OpenWRT is using DNSMasq, the router is initiating the requests and thus not failing over properly. Very good catch.</p><p>Would it be terribly hard to weight traffic types with a mod like this? Is this compatible with any of the existing qos scripts? Thanks again and I look forward to hearing what you decided to do with regard to the DNS issue. Please let me know if I can assist?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p112001">
				<div class="post-metadata">
					<div class="post-num">Post #157</div>
					<div class="post-author">SouthPawn</div>
					<div class="post-datetime">
						27 Jun 2010, 07:23					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>daniel_bergamini wrote:</cite><blockquote><div class="quotebox"><cite>SouthPawn wrote:</cite><blockquote><p>Edit: Upon closer inspection, I believe you and Priyantha have stumbled upon an issue I overlooked, with packets being generated on the router itself. </p><p>Namely the output &amp; postrouting tables, I will look in to this.</p></blockquote></div><p>This makes perfect sense, traffic going *through* the router appears to be working and failing over properly. If I set all my clients to go out to the net directly for DNS I bet everything would work flawlessly. Since OpenWRT is using DNSMasq, the router is initiating the requests and thus not failing over properly. Very good catch.</p><p>Would it be terribly hard to weight traffic types with a mod like this? Is this compatible with any of the existing qos scripts? Thanks again and I look forward to hearing what you decided to do with regard to the DNS issue. Please let me know if I can assist?</p></blockquote></div><p>It&#039;s entirely compatible with qos-scripts, <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /><br />I will let you know as soon as I figure it out, hopefully it won&#039;t take too long.</p><p>Thanks Daniel,<br />-Craig</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p112061">
				<div class="post-metadata">
					<div class="post-num">Post #158</div>
					<div class="post-author">daniel_bergamini</div>
					<div class="post-datetime">
						28 Jun 2010, 03:38					</div>
				</div>
				<div class="post-content content">
					<p>Just thought you&#039;d like to know I can add a route 256 now that I&#039;ve upgraded to the 2.6 kernel based 10.03 (openwrt-brcm47xx-squashfs.trx). I just had to know if that would fix it. I assume .13 would work for me now, but I think it&#039;s better to have it universal for people still on 2.4.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p112063">
				<div class="post-metadata">
					<div class="post-num">Post #159</div>
					<div class="post-author">SouthPawn</div>
					<div class="post-datetime">
						28 Jun 2010, 04:33					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>daniel_bergamini wrote:</cite><blockquote><p>Just thought you&#039;d like to know I can add a route 256 now that I&#039;ve upgraded to the 2.6 kernel based 10.03 (openwrt-brcm47xx-squashfs.trx). I just had to know if that would fix it. I assume .13 would work for me now, but I think it&#039;s better to have it universal for people still on 2.4.</p></blockquote></div><p>Just updated, 1.0.15.<br />I think I&#039;ll be keeping it at 170-190 for greater compatibility, initially moving it to 300 was to remove the cap on WANs possible, but I hardly think anyone will have 20 wans anyhow. <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /><br />Anyhow, I&#039;ve updated it so that the default route now points back to a lan interface instead of adding both default routes.</p><p>Thanks Again,<br />-Craig</p>											<p class="post-edited">(Last edited by <strong>SouthPawn</strong> on 28 Jun 2010, 04:34)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p112070">
				<div class="post-metadata">
					<div class="post-num">Post #160</div>
					<div class="post-author">daniel_bergamini</div>
					<div class="post-datetime">
						28 Jun 2010, 05:26					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>SouthPawn wrote:</cite><blockquote><p>Anyhow, I&#039;ve updated it so that the default route now points back to a lan interface instead of adding both default routes.</p><p>Thanks Again,<br />-Craig</p></blockquote></div><p>No, thank you Craig, this has been a huge improvement for me and I really appreciate all the attention you&#039;ve given me throughout the troubleshooting process.</p><p>Everything appears to be working normally, especially given that I have just recently reinstalled OpenWRT on this router. To the best of my knowledge I have not seen any wrong interface traffic since switching to .15. What I find interesting is I am now seeing simultaneous DNS calls across both interfaces (to the appropriately configured DNS server for that interface). I&#039;m pretty sure DNSmasq will just return the first result it receives, this is a pretty nice feature I think.</p><br /><p>Do you know within qos-scripts if the config behaves as you would expect when defining multiple interfaces? Eg, would I setup a:</p><div class="codebox"><pre><code>config &#039;interface&#039; &#039;wan&#039;
...
config &#039;interface&#039; &#039;wan2&#039;</code></pre></div><p>Configure their associated up/down speeds and it would respect that? With the current laci-app-qos it doesn&#039;t let you name the interface, so I didn&#039;t know if that was just a friendly name for the config file? Any other insight you can provide on using multi-wan with qos?</p><p>Thanks again Craig, I really appreciate everything!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p112071">
				<div class="post-metadata">
					<div class="post-num">Post #161</div>
					<div class="post-author">SouthPawn</div>
					<div class="post-datetime">
						28 Jun 2010, 06:43					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>daniel_bergamini wrote:</cite><blockquote><p>Do you know within qos-scripts if the config behaves as you would expect when defining multiple interfaces? Eg, would I setup a:</p><div class="codebox"><pre><code>config &#039;interface&#039; &#039;wan&#039;
...
config &#039;interface&#039; &#039;wan2&#039;</code></pre></div><p>Configure their associated up/down speeds and it would respect that? With the current laci-app-qos it doesn&#039;t let you name the interface, so I didn&#039;t know if that was just a friendly name for the config file? Any other insight you can provide on using multi-wan with qos?</p><p>Thanks again Craig, I really appreciate everything!</p></blockquote></div><p>Glad to hear it&#039;s working as expected! <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Here&#039;s an example from my /etc/config/qos file:</p><div class="codebox"><pre><code>config &#039;interface&#039; &#039;wan&#039;
        option &#039;classgroup&#039; &#039;Default&#039;
        option &#039;enabled&#039; &#039;1&#039;
        option &#039;overhead&#039; &#039;1&#039;
        option &#039;download&#039; &#039;10000&#039;
        option &#039;upload&#039; &#039;1536&#039;

config &#039;interface&#039; &#039;wan2&#039;
        option &#039;classgroup&#039; &#039;Default&#039;
        option &#039;enabled&#039; &#039;1&#039;
        option &#039;overhead&#039; &#039;1&#039;
        option &#039;download&#039; &#039;768&#039;
        option &#039;upload&#039; &#039;389&#039;</code></pre></div><p>They will share the same qos rules, but for each interface.<br />The multiwan script copies the tables and tc filters qos-scripts creates and edits them to work within our multiwan enviroment.</p>											<p class="post-edited">(Last edited by <strong>SouthPawn</strong> on 28 Jun 2010, 06:43)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p112119">
				<div class="post-metadata">
					<div class="post-num">Post #162</div>
					<div class="post-author">kadettgte</div>
					<div class="post-datetime">
						28 Jun 2010, 18:09					</div>
				</div>
				<div class="post-content content">
					<p>hi all, i managed to get this amazing script up &amp; running without any networking issues, but now my problem is another one,</p><p>For example, when i log in into some websites/foruns (phpbb3 for example) sometimes my session gets dropped because it goes from another ip, any workaround for this?</p><p>Best Regards</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p112122">
				<div class="post-metadata">
					<div class="post-num">Post #163</div>
					<div class="post-author">SouthPawn</div>
					<div class="post-datetime">
						28 Jun 2010, 18:14					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>kadettgte wrote:</cite><blockquote><p>hi all, i managed to get this amazing script up &amp; running without any networking issues, but now my problem is another one,</p><p>For example, when i log in into some websites/foruns (phpbb3 for example) sometimes my session gets dropped because it goes from another ip, any workaround for this?</p><p>Best Regards</p></blockquote></div><p>Generally speaking, if there is a compatibility issue, either create a outbound rule for that site to use either balancer, in luci is stated as Load Balancer(Compatibility) or designate that site to use a specific interface such as wan or wan2.</p><p>I still need to update the wiki... =P</p>											<p class="post-edited">(Last edited by <strong>SouthPawn</strong> on 28 Jun 2010, 18:14)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p112123">
				<div class="post-metadata">
					<div class="post-num">Post #164</div>
					<div class="post-author">kadettgte</div>
					<div class="post-datetime">
						28 Jun 2010, 18:23					</div>
				</div>
				<div class="post-content content">
					<p>Hi Again , and thanks for your fast reply hehe, </p><p>this is my configuration:</p><p>config &#039;multiwan&#039; &#039;config&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;default_route&#039; &#039;balancer&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;lan_if&#039; &#039;lan&#039;</p><br /><p>config &#039;interface&#039; &#039;wan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;weight&#039; &#039;10&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;health_interval&#039; &#039;10&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;icmp_hosts&#039; &#039;dns&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;timeout&#039; &#039;3&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;health_fail_retries&#039; &#039;3&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;health_recovery_retries&#039; &#039;5&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;dns&#039; &#039;auto&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;failover_to&#039; &#039;wan2&#039;</p><p>config &#039;interface&#039; &#039;wan2&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;weight&#039; &#039;10&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;health_interval&#039; &#039;10&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;icmp_hosts&#039; &#039;dns&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;timeout&#039; &#039;3&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;health_fail_retries&#039; &#039;3&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;health_recovery_retries&#039; &#039;5&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;dns&#039; &#039;auto&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;failover_to&#039; &#039;balancer&#039;</p><p>config &#039;mwanfw&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;dst&#039; &#039;195.245.173.151&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;wanrule&#039; &#039;wan&#039;</p><p>config &#039;mwanfw&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;dst&#039; &#039;195.245.173.150&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;wanrule&#039; &#039;wan2&#039;</p><br /><p>the problem is that it&#039;s not &quot;one-site&quot; specific, for example, at least 2 phpbb3 based sites will have this issue, as well as some others that i don&#039;t recall right now, is there any way to maintain a tcp session for a while? </p><p>if there isn&#039;t any way i&#039;ll just have to disable balancer and just use failover until i find a way (that if i find, i&#039;ll post it here)</p><p>Best Regards</p>											<p class="post-edited">(Last edited by <strong>kadettgte</strong> on 29 Jun 2010, 11:22)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p112128">
				<div class="post-metadata">
					<div class="post-num">Post #165</div>
					<div class="post-author">SouthPawn</div>
					<div class="post-datetime">
						28 Jun 2010, 19:10					</div>
				</div>
				<div class="post-content content">
					<p>See if you have any better results with 1.0.15-2. <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p112129">
				<div class="post-metadata">
					<div class="post-num">Post #166</div>
					<div class="post-author">kadettgte</div>
					<div class="post-datetime">
						28 Jun 2010, 19:12					</div>
				</div>
				<div class="post-content content">
					<p>damn you are fast <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" />, <br />i&#039;m going to try it in about 1hour or so, and then i&#039;ll post my results back.</p><p>Thanks a lot.</p><p>Best Regards</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p112152">
				<div class="post-metadata">
					<div class="post-num">Post #167</div>
					<div class="post-author">kadettgte</div>
					<div class="post-datetime">
						29 Jun 2010, 01:15					</div>
				</div>
				<div class="post-content content">
					<p>sorry for the late reply</p><p>well, your patch worked perfectly for most of the sites, i only have a problem with one, that i cannot find the problem</p><p>if i set the balancer to failover, it works perfectly, else it will fail even it i force it to go out from a specific uplink (which works for other sites/services/etc)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p112169">
				<div class="post-metadata">
					<div class="post-num">Post #168</div>
					<div class="post-author">ghdfans2010</div>
					<div class="post-datetime">
						29 Jun 2010, 10:47					</div>
				</div>
				<div class="post-content content">
					<p>I think there isn&#039;t really a build-system</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p112205">
				<div class="post-metadata">
					<div class="post-num">Post #169</div>
					<div class="post-author">andyballon</div>
					<div class="post-datetime">
						30 Jun 2010, 06:26					</div>
				</div>
				<div class="post-content content">
					<p>hi craig,</p><p>can you post version 1.0.14 in your ftp site again? that one works for me. i&#039;m using 2.4 kernel and when i upgraded to 1.0.15-2 i can&#039;t make outgoing connections from the router. lan to internet works but i can&#039;t wget, icmp telnet, nslookup, etc. from the router. i need that for the scripts i have that runs when the router boot up. i was not able to do a thorough diagnosis because i have work at home in 3 hours and i panicked and reverted to the last mw version i had saved - 1.0j. (what a loser huh?)<br />anyway, the last things i can remember before i pushed the red button were:<br />1. route does not display multiple gateway.<br />2. ip rule is ok. <br />3. multiwan interface routing distribution works from lan. i go through the right interface for the sites i defined.<br />4. when i removed 1.0.15-2 everything worked again.</p><p>that&#039;s it. if 1.0.15-2 works for the 2.6 kernel users maybe post 2 versions of the app in your site?<br />thanks in advance. sorry i could not be more help here.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p112207">
				<div class="post-metadata">
					<div class="post-num">Post #170</div>
					<div class="post-author">SouthPawn</div>
					<div class="post-datetime">
						30 Jun 2010, 06:56					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>andyballon wrote:</cite><blockquote><p>hi craig,</p><p>can you post version 1.0.14 in your ftp site again? that one works for me. i&#039;m using 2.4 kernel and when i upgraded to 1.0.15-2 i can&#039;t make outgoing connections from the router. lan to internet works but i can&#039;t wget, icmp telnet, nslookup, etc. from the router. i need that for the scripts i have that runs when the router boot up. i was not able to do a thorough diagnosis because i have work at home in 3 hours and i panicked and reverted to the last mw version i had saved - 1.0j. (what a loser huh?)<br />anyway, the last things i can remember before i pushed the red button were:<br />1. route does not display multiple gateway.<br />2. ip rule is ok. <br />3. multiwan interface routing distribution works from lan. i go through the right interface for the sites i defined.<br />4. when i removed 1.0.15-2 everything worked again.</p><p>that&#039;s it. if 1.0.15-2 works for the 2.6 kernel users maybe post 2 versions of the app in your site?<br />thanks in advance. sorry i could not be more help here.</p></blockquote></div><p>I&#039;ve put it back up, but let me ask you something, what&#039;s the name of your lan?<br />There&#039;s a new configuration option in .15 that uses the lan interface as the default gateway for the main table.<br />option &#039;lan_if&#039; &#039;lan&#039;</p><p>If that&#039;s not actually set to the actual name of your lan it could create a problem, if you could let me know it&#039;d be very beneficial for me. <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p112210">
				<div class="post-metadata">
					<div class="post-num">Post #171</div>
					<div class="post-author">andyballon</div>
					<div class="post-datetime">
						30 Jun 2010, 07:38					</div>
				</div>
				<div class="post-content content">
					<p>oh. i think it was &#039;lan&#039;. what should i put there? eth0.0? br-lan?<br />i still have time. i&#039;ll install .14 and tell you what it says.<br />THANKS!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p112211">
				<div class="post-metadata">
					<div class="post-num">Post #172</div>
					<div class="post-author">SouthPawn</div>
					<div class="post-datetime">
						30 Jun 2010, 08:08					</div>
				</div>
				<div class="post-content content">
					<p>It should be set to whichever the lan zone is.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p112212">
				<div class="post-metadata">
					<div class="post-num">Post #173</div>
					<div class="post-author">andyballon</div>
					<div class="post-datetime">
						30 Jun 2010, 08:21					</div>
				</div>
				<div class="post-content content">
					<p>hmmm... it is set to &#039;lan&#039; which is my lan zone.<br />and for some reason .14 stopped working for me as well.<br />can you upload .12 multiwan and its luci-app ipk?<br />i&#039;ll check if that works and try an upgrade to .15 and see if that works.<br />i&#039;ll report back after 6 hrs.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p112234">
				<div class="post-metadata">
					<div class="post-num">Post #174</div>
					<div class="post-author">andyballon</div>
					<div class="post-datetime">
						30 Jun 2010, 18:42					</div>
				</div>
				<div class="post-content content">
					<p>hi craig,<br />i tried version .14 again and it looks like the routers routing is the one that&#039;s getting affected.<br />i&#039;m getting a &quot;no route to host&quot; error when i ping a known host.<br />but forwarding is working since i can get to the internet from lan.<br />not really sure but outgoing to the internet from the router does not work.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p112303">
				<div class="post-metadata">
					<div class="post-num">Post #175</div>
					<div class="post-author">andyballon</div>
					<div class="post-datetime">
						1 Jul 2010, 18:11					</div>
				</div>
				<div class="post-content content">
					<p>woah! i think you&#039;ll be interested in this:<br />root@culiat-wg:~# ip route list<br />192.168.2.0/24 dev eth0.2&nbsp; proto kernel&nbsp; scope link&nbsp; src 192.168.2.214<br />192.168.1.0/24 dev br-lan&nbsp; proto kernel&nbsp; scope link&nbsp; src 192.168.1.1<br />114.108.200.0/23 dev eth0.1&nbsp; proto kernel&nbsp; scope link&nbsp; src 114.108.200.78<br />default via 192.168.1.1 dev br-lan</p><p>and here is what i have in config/multiwan:<br />root@culiat-wg:~# cat /etc/config/multiwan</p><p>config &#039;multiwan&#039; &#039;config&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;lan_if&#039; &#039;lan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;default_route&#039; &#039;fastbalancer&#039;</p><p>doing some more investigation...</p>									</div>
			</article>

			
		
						<div class="notice">
				<p>Sorry, posts 176 to 175 are missing from our archive.</p>
			</div>
		
		
	
	<div class="pagination"><div class="pagination-number">Page 7 of 14</div><nav><ul><li><a href="viewtopic.php%3Fid=23904&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=23904&amp;p=5.html">5</a></li><li><a href="viewtopic.php%3Fid=23904&amp;p=6.html">6</a></li><li class="pagination-current"><span>7</span></li><li><a href="viewtopic.php%3Fid=23904&amp;p=8.html">8</a></li><li><a href="viewtopic.php%3Fid=23904&amp;p=9.html">9</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=23904&amp;p=14.html">14</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>