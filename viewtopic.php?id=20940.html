<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Openwrt on rb433uah</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 28 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p90949">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">dblackbeer</div>
					<div class="post-datetime">
						7 Jul 2009, 01:33					</div>
				</div>
				<div class="post-content content">
					<p>Hi,<br />I&#039;ve been trying to install openwrt from sources applying patches described in <a href="http://forum.openwrt.org/viewtopic.php?pid=88540">this</a> post: , and I did it, but when I do network boot there is no NAND flash detected.</p><p>I got something like that:</p><div class="codebox"><pre><code>Built 1 zonelists in Zone order, mobility grouping on.  Total pages: 32512
Kernel command line: root=/dev/mtdblock2 rootfstype=squashfs,yaffs,jffs2 noinitrd console=ttyS0,115200 init=/etc/preinit
Primary instruction cache 64kB, VIPT, 4-way, linesize 32 bytes.
Primary data cache 32kB, 4-way, VIPT, cache aliases, linesize 32 bytes
Writing ErrCtl register=00001040
Readback ErrCtl register=00001040
PID hash table entries: 512 (order: 9, 2048 bytes)
Dentry cache hash table entries: 16384 (order: 4, 65536 bytes)
Inode-cache hash table entries: 8192 (order: 3, 32768 bytes)
Memory: 125412k/131072k available (1831k kernel code, 5488k reserved, 327k data, 1716k init, 0k highmem)
SLUB: Genslabs=6, HWalign=32, Order=0-3, MinObjects=0, CPUs=1, Nodes=1
Mount-cache hash table entries: 512
net_namespace: 644 bytes
NET: Registered protocol family 16
MIPS: machine is MikroTik RouterBOARD 433UAH
registering PCI controller with io_map_base unset
PCI: mapping irq 34 to pin1@0000:00:14.0
NET: Registered protocol family 2
IP route cache hash table entries: 1024 (order: 0, 4096 bytes)
TCP established hash table entries: 4096 (order: 3, 32768 bytes)
TCP bind hash table entries: 4096 (order: 2, 16384 bytes)
TCP: Hash tables configured (established 4096 bind 4096)
TCP reno registered
NET: Registered protocol family 1
squashfs: version 3.0 (2006/03/15) Phillip Lougher
Registering mini_fo version $Id$
JFFS2 version 2.2. (NAND) (SUMMARY)  Â© 2001-2006 Red Hat, Inc.
yaffs Jul  6 2009 18:02:20 Installing. 
msgmni has been set to 245
io scheduler noop registered
io scheduler deadline registered (default)
Serial: 8250/16550 driver $Revision: 1.90 $ 1 ports, IRQ sharing disabled
serial8250.0: ttyS0 at MMIO 0x18020000 (irq = 11) is a 16550A
console handover: boot [early0] -&gt; real [ttyS0]
ag71xx_mdio: probed
eth0: Atheros AG71xx at 0xba000000, irq 5
eth1: Atheros AG71xx at 0xb9000000, irq 4
Atheros AR71xx SPI Controller driver version 0.2.2
Atheros AR71xx hardware watchdog driver version 0.1.0
TCP vegas registered
NET: Registered protocol family 17
Bridge firewalling registered
802.1Q VLAN Support v1.8 Ben Greear &lt;greearb@candelatech.com&gt;
All bugs added by David S. Miller &lt;davem@redhat.com&gt;
Freeing unused kernel memory: 1716k freed
Algorithmics/MIPS FPU Emulator v1.5
[sighandler]: No more events to be processed, quitting.
[cleanup]: Waiting for children.
[cleanup]: All children terminated.
- preinit -
Press CTRL-C for failsafe

Please press Enter to activate this console. br-lan: Dropping NETIF_F_UFO since no NETIF_F_HW_CSUM feature.
device eth0 entered promiscuous mode
PPP generic driver version 2.4.2
ip_tables: (C) 2000-2006 Netfilter Core Team
nf_conntrack version 0.5.0 (2048 buckets, 8192 max)
wlan: trunk
ath_hal: module license &#039;Proprietary&#039; taints kernel.
ath_hal: 2009-05-08 (AR5210, AR5211, AR5212, AR5416, RF5111, RF5112, RF2413, RF5413, RF2133, RF2425, REGOPS_FUNC, XR)
ath_rate_minstrel: Minstrel automatic rate control algorithm 1.2 (trunk)
ath_rate_minstrel: look around rate set to 10%
ath_rate_minstrel: EWMA rolloff level set to 75%
ath_rate_minstrel: max segment size in the mrr set to 6000 us
wlan: mac acl policy registered
ath_pci: trunk
PCI: Enabling device 0000:00:14.0 (0000 -&gt; 0002)
Atheros HAL provided by OpenWrt, DD-WRT and MakSat Technologies
wifi0: 11a rates: 6Mbps 9Mbps 12Mbps 18Mbps 24Mbps 36Mbps 48Mbps 54Mbps
wifi0: 11b rates: 1Mbps 2Mbps 5.5Mbps 11Mbps
wifi0: 11g rates: 1Mbps 2Mbps 5.5Mbps 11Mbps 6Mbps 9Mbps 12Mbps 18Mbps 24Mbps 36Mbps 48Mbps 54Mbps
wifi0: turboA rates: 6Mbps 9Mbps 12Mbps 18Mbps 24Mbps 36Mbps 48Mbps 54Mbps
wifi0: turboG rates: 6Mbps 12Mbps 18Mbps 24Mbps 36Mbps 48Mbps 54Mbps
wifi0: H/W encryption support: WEP AES AES_CCM TKIP
ath_pci: wifi0: Atheros 5413: mem=0x10000000, irq=34
eth0: link up (100Mbps/Full duplex)
br-lan: port 1(eth0) entering learning state
br-lan: topology change detected, propagating
br-lan: port 1(eth0) entering forwarding state



BusyBox v1.11.2 (2009-07-06 14:05:27 ART) built-in shell (ash)
Enter &#039;help&#039; for a list of built-in commands.

  _______                     ________        __
 |       |.-----.-----.-----.|  |  |  |.----.|  |_
 |   -   ||  _  |  -__|     ||  |  |  ||   _||   _|
 |_______||   __|_____|__|__||________||__|  |____|
          |__| W I R E L E S S   F R E E D O M
 KAMIKAZE (8.09.1, r16499) ----------------------------
  * 10 oz Vodka       Shake well with ice and strain
  * 10 oz Triple sec  mixture into 10 shot glasses.
  * 10 oz lime juice  Salute!
 ---------------------------------------------------
root@OpenWrt:/#</code></pre></div><p>Maybe I&#039;m obviating something at compiling time?</p><p>Thanks to all.</p><p>dblackbeer</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p90965">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">Dogge</div>
					<div class="post-datetime">
						7 Jul 2009, 11:52					</div>
				</div>
				<div class="post-content content">
					<p><a href="http://forum.openwrt.org/viewtopic.php?id=20146">http://forum.openwrt.org/viewtopic.php?id=20146</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p90979">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">dblackbeer</div>
					<div class="post-datetime">
						7 Jul 2009, 18:03					</div>
				</div>
				<div class="post-content content">
					<p>Yes, the same post, I&#039;ve been following, but I couldn&#039;t apply the patch completly. There is a difference in header file ar71xx.h with patch so I did manually.<br />However I changed&nbsp; the #if 0 back to #if 1 in the file mach-rb-4xx.c and I got this:<br /></p><div class="codebox"><pre><code>root@OpenWrt:/# cat /proc/mtd 
dev:    size   erasesize  name
mtd0: 00010000 00001000 &quot;spi0.0&quot;
root@OpenWrt:/#</code></pre></div><p>Maybe I got wrong source revision? </p><div class="codebox"><pre><code>svn -r 16499 co svn://svn.openwrt.org/openwrt/branches/8.09</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p90995">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">dblackbeer</div>
					<div class="post-datetime">
						7 Jul 2009, 22:58					</div>
				</div>
				<div class="post-content content">
					<p>I solved by using Development branch, with a little modification over potsted patch file.</p><p>Regards dblackbber</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p91119">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">gdamjan</div>
					<div class="post-datetime">
						9 Jul 2009, 19:33					</div>
				</div>
				<div class="post-content content">
					<p>@dblackbeer<br />can you post the patch here?</p><p>and can it be included in kamikaze-trunk?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p91127">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">dblackbeer</div>
					<div class="post-datetime">
						9 Jul 2009, 21:35					</div>
				</div>
				<div class="post-content content">
					<p>Here&#039;s the patch. Only ar71xx.h file it looks quite different. The rest is basically the same thing. Finally I left line 72 with no change (#if 0) in mach-rb-4xx.c</p><div class="codebox"><pre><code>Index: target/linux/ar71xx/files/arch/mips/include/asm/mach-ar71xx/ar71xx.h
===================================================================
--- target/linux/ar71xx/files/arch/mips/include/asm/mach-ar71xx/ar71xx.h        (revision 16741)
+++ target/linux/ar71xx/files/arch/mips/include/asm/mach-ar71xx/ar71xx.h        (working copy)
@@ -124,7 +124,9 @@
        AR71XX_MACH_AW_NR580,   /* AzureWave AW-NR580 */
        AR71XX_MACH_RB_411,     /* MikroTik RouterBOARD 411/411A/411AH */
        AR71XX_MACH_RB_433,     /* MikroTik RouterBOARD 433/433AH */
+       AR71XX_MACH_RB_433U,     /* MikroTik RouterBOARD 433/433UAH */
        AR71XX_MACH_RB_450,     /* MikroTik RouterBOARD 450 */
+       AR71XX_MACH_RB_450G,     /* MikroTik RouterBOARD 450G */
        AR71XX_MACH_RB_493,     /* Mikrotik RouterBOARD 493/493AH */
        AR71XX_MACH_PB42,       /* Atheros PB42 */
        AR71XX_MACH_PB44,       /* Atheros PB44 */
Index: target/linux/ar71xx/files/arch/mips/ar71xx/prom.c
===================================================================
--- target/linux/ar71xx/files/arch/mips/ar71xx/prom.c   (revision 16741)
+++ target/linux/ar71xx/files/arch/mips/ar71xx/prom.c   (working copy)
@@ -39,10 +39,16 @@
                .name           = &quot;433&quot;,
                .mach_type      = AR71XX_MACH_RB_433,
        }, {
-               .name           = &quot;450&quot;,
+               .name        = &quot;433U&quot;,
+               .mach_type    = AR71XX_MACH_RB_433U,
+       }, {
+               .name           = &quot;450&quot;,
                .mach_type      = AR71XX_MACH_RB_450,
        }, {
-               .name           = &quot;493&quot;,
+               .+               .mach_type    = AR71XX_MACH_RB_450G,
+       }, {
+               .name           = &quot;493&quot;,
                .mach_type      = AR71XX_MACH_RB_493,
        }, {
                .name           = &quot;AP81&quot;,
Index: target/linux/ar71xx/files/arch/mips/ar71xx/mach-rb-4xx.c
===================================================================
--- target/linux/ar71xx/files/arch/mips/ar71xx/mach-rb-4xx.c    (revision 16741)
+++ target/linux/ar71xx/files/arch/mips/ar71xx/mach-rb-4xx.c    (working copy)
@@ -72,7 +72,7 @@
        }
 };

-#if 0
+#if 0
 /*
  * SPI device support is experimental
  */
@@ -84,7 +84,8 @@
        {
                .bus_num        = 0,
                .chip_select    = 0,
-               .max_speed_hz   = 25000000,
+               .max_speed_hz    = 33000000,
+               .mode        = SPI_MODE_0,
                .modalias       = &quot;m25p80&quot;,
                .platform_data  = &amp;rb4xx_flash_data,
        }
@@ -98,13 +99,15 @@
        {
                .bus_num        = 0,
        = &quot;450G&quot;,
                .chip_select    = 0,
-               .max_speed_hz   = 25000000,
+               .max_speed_hz    = 33000000,
+               .mode        = SPI_MODE_0,
                .modalias       = &quot;m25p80&quot;,
-               .platform_data  = &amp;rb433_flash_data,
+               .platform_data  = &amp;rb4xx_flash_data,
        }, {
                .bus_num        = 0,
                .chip_select    = 2,
-               .max_speed_hz   = 25000000,
+               .max_speed_hz    = 10000000,
+               .mode        = SPI_MODE_0,
                .modalias       = &quot;mmc_spi&quot;,
                .platform_data  = &amp;rb433_mmc_data,
        }
@@ -113,7 +116,6 @@
 static u32 rb433_spi_get_ioc_base(u8 chip_select, int cs_high, int is_on)
 {
        u32 ret;
-
        if (is_on == AR71XX_SPI_CS_INACTIVE) {
                ret = SPI_IOC_CS0 | SPI_IOC_CS1;
        } else {
@@ -205,7 +207,31 @@
 }

 MIPS_MACHINE(AR71XX_MACH_RB_433, &quot;MikroTik RouterBOARD 433/AH&quot;, rb433_setup);
+static void __init rb433u_setup(void)
+{
+    rb4xx_generic_setup();
+    rb433_add_device_spi();

+    ar71xx_add_device_mdio(0xffffffe9);
+
+    ar71xx_eth0_data.phy_if_mode = PHY_INTERFACE_MODE_MII;
+    ar71xx_eth0_data.phy_mask = 0x00000006;
+    ar71xx_eth0_data.speed = SPEED_100;
+    ar71xx_eth0_data.duplex = DUPLEX_FULL;
+
+    ar71xx_eth1_data.phy_if_mode = PHY_INTERFACE_MODE_RMII;
+    ar71xx_eth1_data.phy_mask = 0x00000010;
+
+    ar71xx_add_device_eth(1);
+    ar71xx_add_device_eth(0);
+
+    ar71xx_add_device_usb();
+
+    ar71xx_pci_init(ARRAY_SIZE(rb4xx_pci_irqs), rb4xx_pci_irqs);
+}
+
+MIPS_MACHINE(AR71XX_MACH_RB_433U, &quot;MikroTik RouterBOARD 433UAH&quot;, rb433u_setup);
+
 static void __init rb450_setup(void)
 {
        rb4xx_generic_setup();
@@ -226,7 +252,27 @@
 }

 MIPS_MACHINE(AR71XX_MACH_RB_450, &quot;MikroTik RouterBOARD 450&quot;, rb450_setup);
+static void __init rb450g_setup(void)
+{
+    rb4xx_generic_setup();
+    rb4xx_add_device_spi();

+    ar71xx_add_device_mdio(0xffffffe0);
+
+    ar71xx_eth0_data.phy_if_mode = PHY_INTERFACE_MODE_MII;
+    ar71xx_eth0_data.phy_mask = 0x0000000f;
+    ar71xx_eth0_data.speed = SPEED_1000;
+    ar71xx_eth0_data.duplex = DUPLEX_FULL;
+
+    ar71xx_eth1_data.phy_if_mode = PHY_INTERFACE_MODE_RMII;
+    ar71xx_eth1_data.phy_mask = 0x00000010;
+
+    ar71xx_add_device_eth(1);
+    ar71xx_add_device_eth(0);
+}
+
+MIPS_MACHINE(AR71XX_MACH_RB_450G, &quot;MikroTik RouterBOARD 450G&quot;, rb450g_setup);
+
 static void __init rb493_setup(void)
 {
        rb4xx_generic_setup();</code></pre></div><p>about to apply this patch in kamikaze-trunk I have no idea.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p91129">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">gdamjan</div>
					<div class="post-datetime">
						9 Jul 2009, 21:54					</div>
				</div>
				<div class="post-content content">
					<p>thanks, after booting with this kernel, I get:<br /></p><div class="codebox"><pre><code>$ cat /proc/mtd
dev:    size   erasesize  name
mtd0: 00040000 00040000 &quot;booter&quot;
mtd1: 003c0000 00040000 &quot;kernel&quot;
mtd2: 1fc00000 00040000 &quot;rootfs&quot;</code></pre></div><p>but also I get:<br /></p><div class="codebox"><pre><code>NAND flash driver for RouterBoard 4xx series version 0.1.10
NAND SPI clock 28333 kHz (AHB 170000 kHz / 6)
FLASH SPI clock 28333 kHz (AHB 170000 kHz / 6)
NAND device: Manufacturer ID: 0xad, Chip ID: 0xdc (Hynix NAND 512MiB 3,3V 8-bit)
Scanning device for bad blocks
Bad eraseblock 1 at 0x00040000
Bad eraseblock 2 at 0x00080000
Bad eraseblock 3 at 0x000c0000
Bad eraseblock 4 at 0x00100000       
...
Bad eraseblock 1993 at 0x1f240000
Creating 3 MTD partitions on &quot;NAND 512MiB 3,3V 8-bit&quot;:</code></pre></div><p>is this ok?? or..</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p91142">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">dblackbeer</div>
					<div class="post-datetime">
						10 Jul 2009, 01:13					</div>
				</div>
				<div class="post-content content">
					<p>I solved making Bios Nand Format. But Wait! check first if your kernel partition mounting it.<br />I got 60% used space and I cannot allocate elf image on it! And filesystem is empty.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p91158">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">gdamjan</div>
					<div class="post-datetime">
						10 Jul 2009, 13:23					</div>
				</div>
				<div class="post-content content">
					<div class="codebox"><pre><code>/dev/mtdblock1            3.8M      3.8M         0 100% /mnt
# find /mnt/
/mnt/
/mnt/lost+found</code></pre></div><p>I would make an erase from the &quot;BIOS&quot; but I wanted to backup the RouterOS first, just in case I need it again... I just don&#039;t know how?!?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p91160">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">AraKs</div>
					<div class="post-datetime">
						10 Jul 2009, 13:40					</div>
				</div>
				<div class="post-content content">
					<p>You can use Mikrotik NetInstall to restore RouterOS:<br /><a href="http://www.mikrotik.com/download/netinstall-3.24.zip">http://www.mikrotik.com/download/netinstall-3.24.zip</a></p><p>It&#039;s easy:<br />Start NetInstall on your pc, connect the RB433uah via eth to your pc, using serial console set RouterBOOT to boot from lan and reload the original firmware.<br /><a href="http://www.mikrotik.com/testdocs/ros/2.9/guide/netinstall.php">http://www.mikrotik.com/testdocs/ros/2. … nstall.php</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p91165">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">gdamjan</div>
					<div class="post-datetime">
						10 Jul 2009, 15:34					</div>
				</div>
				<div class="post-content content">
					<p>ok then. I erased the NAND from the boot menu, the errors are gone now.<br />This is what I get when I boot the openwrt initramfs:<br /></p><div class="codebox"><pre><code>root@OpenWrt:/# cat /proc/mtd
dev:    size   erasesize  name
mtd0: 00040000 00040000 &quot;booter&quot;
mtd1: 003c0000 00040000 &quot;kernel&quot;
mtd2: 1fc00000 00040000 &quot;rootfs&quot;
root@OpenWrt:/# mount /dev/mtdblock1 /mnt/
yaffs: dev is 32505857 name is &quot;mtdblock1&quot;
yaffs: passed flags &quot;&quot;
yaffs: Attempting MTD mount on 31.1, &quot;mtdblock1&quot;
yaffs: auto selecting yaffs2
yaffs_read_super: isCheckpointed 0
root@OpenWrt:/# ls /mnt/
lost+found
root@OpenWrt:/# df -h
Filesystem                Size      Used Available Use% Mounted on
tmpfs                    62.1M     52.0K     62.1M   0% /tmp
tmpfs                   512.0K         0    512.0K   0% /dev
/dev/mtdblock1            3.8M      2.3M      1.5M  60% /mnt
root@OpenWrt:/# find /mnt/
/mnt/
/mnt/lost+found</code></pre></div><p>it&#039;s a bit strange that there are no files in /dev/mtdblock1 but still it&#039;s 2.3M of 3.8M used</p>											<p class="post-edited">(Last edited by <strong>gdamjan</strong> on 10 Jul 2009, 15:36)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p91172">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">dblackbeer</div>
					<div class="post-datetime">
						10 Jul 2009, 16:46					</div>
				</div>
				<div class="post-content content">
					<p>Yes, I stalled at this point too. I&#039;m taking a look to a yaffs options in kernel config file.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p91175">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">dblackbeer</div>
					<div class="post-datetime">
						10 Jul 2009, 17:51					</div>
				</div>
				<div class="post-content content">
					<p>I don´t think that it be marked bad blocks. Both partitions mtdblock1 and mtdblock2 it looks similar too:</p><div class="codebox"><pre><code>root@OpenWrt:/# df -h
Filesystem                Size      Used Available Use% Mounted on
tmpfs                    62.1M     40.0K     62.1M   0% /tmp
tmpfs                   512.0K         0    512.0K   0% /dev
/dev/mtdblock1            3.8M      2.3M      1.5M  60% /mnt
/dev/mtdblock2          508.0M      2.3M    505.8M   0% /tmp/rootfs</code></pre></div><p>dblackbeer</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p91178">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">dblackbeer</div>
					<div class="post-datetime">
						10 Jul 2009, 20:51					</div>
				</div>
				<div class="post-content content">
					<p>Another posibility is to achieve a small kernel elf file like 1.5Mb. Can I get this?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p91222">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">dblackbeer</div>
					<div class="post-datetime">
						11 Jul 2009, 18:00					</div>
				</div>
				<div class="post-content content">
					<p>Ok, I solved this issue with this dirty patch:</p><div class="codebox"><pre><code>Index: trunk/target/linux/ar71xx/files/drivers/mtd/nand/rb4xx_nand.c
===================================================================
--- trunk/target/linux/ar71xx/files/drivers/mtd/nand/rb4xx_nand.c       (revision 16778)
+++ trunk/target/linux/ar71xx/files/drivers/mtd/nand/rb4xx_nand.c       (working copy)
@@ -92,7 +92,7 @@
        {
                .name   = &quot;kernel&quot;,
                .offset = (256 * 1024),
-               .size   = (4 * 1024 * 1024) - (256 * 1024),
+               .size   = (8 * 1024 * 1024) - (256 * 1024),
        },
        {
                .name   = &quot;rootfs&quot;,</code></pre></div><p>The patch file chages kernel partition size to 8 mb. Anyway we must to report the issue to developers, in both partitions kernel and rootfs I have 2.3 Mb used space despite filesystems are empty.</p><p>Now this is my partition table:</p><div class="codebox"><pre><code>root@OpenWrt:~# cat /proc/mtd
dev:    size   erasesize  name
mtd0: 00040000 00040000 &quot;booter&quot;
mtd1: 007c0000 00040000 &quot;kernel&quot;
mtd2: 1f800000 00040000 &quot;rootfs&quot;</code></pre></div><p>And here I have mounted kernel partition after booting from nand flash:</p><div class="codebox"><pre><code>root@OpenWrt:~# df -h
Filesystem                Size      Used Available Use% Mounted on
/dev/root               504.0M      9.7M    494.3M   2% /
tmpfs                    62.2M    828.0K     61.4M   1% /tmp
tmpfs                   512.0K         0    512.0K   0% /dev
/dev/mtdblock1            7.8M      4.5M      3.2M  58% /mnt</code></pre></div><p>But now I got full running Openwrt on RB433UAH!</p><p>Regards dblackbeer</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p91312">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">gdamjan</div>
					<div class="post-datetime">
						13 Jul 2009, 15:31					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><blockquote><p>The patch file chages kernel partition size to 8 mb.</p></blockquote></div><p>is that safe?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p91314">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">Dogge</div>
					<div class="post-datetime">
						13 Jul 2009, 15:33					</div>
				</div>
				<div class="post-content content">
					<p>Lol</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p91317">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">dblackbeer</div>
					<div class="post-datetime">
						13 Jul 2009, 16:47					</div>
				</div>
				<div class="post-content content">
					<p>There is no partition table like a disk. I read that partitions are hardcoded in a c file logically and I found it. Happily the routerboard bios isn`t seems has problem with this, I guess that bios doesn`t know anything about partitions addresses. Only need to know where the kernel file is and I left that part with no chages.</p><p>Regards<br />dblackbeer</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p91473">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">gdamjan</div>
					<div class="post-datetime">
						16 Jul 2009, 18:58					</div>
				</div>
				<div class="post-content content">
					<p>What image did you install on the rootfs partition?<br />I&#039;ve put the squashfs, but it&#039;s readonly after reboot ... how do I enable the jffs2 overlay like it&#039;s on the WRTs??</p><br /><p>EDIT:<br />ok, I just unpacked openwrt-ar71xx-rootfs.tgz in the mounted rootfs partition:<br /></p><div class="codebox"><pre><code>scp mypc:src/kamikaze_trunk/bin/openwrt-ar71xx-rootfs.tgz /tmp
mount /dev/mtdblock2 /mnt
cd /mnt
tar xzf /tmp/openwrt-ar71xx-rootfs.tgz</code></pre></div><p>I guess that gives me a RW yaffs2 filesystem</p>											<p class="post-edited">(Last edited by <strong>gdamjan</strong> on 17 Jul 2009, 17:50)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p91525">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">dblackbeer</div>
					<div class="post-datetime">
						18 Jul 2009, 00:09					</div>
				</div>
				<div class="post-content content">
					<p>When I passed rootfs with cat&nbsp; method I had that &quot;readonly&quot; problem. But I formatted nand flash and I did it manually: </p><div class="codebox"><pre><code>mount /dev/mtdblock2 /mnt
tar -xzvf openwrt-ar71xx-rootfs.tgz -C /mnt</code></pre></div><p>it worked for me.</p><p>Regards<br />dblackbeer</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p91553">
				<div class="post-metadata">
					<div class="post-num">Post #21</div>
					<div class="post-author">Dogge</div>
					<div class="post-datetime">
						18 Jul 2009, 20:17					</div>
				</div>
				<div class="post-content content">
					<p>Is this mmc_spi error still there in dmesg?<br /></p><div class="codebox"><pre><code>gpio-buttons driver version 0.1.1
input: gpio-buttons as /devices/platform/gpio-buttons/input/input0
mmc_spi spi0.2: can&#039;t share SPI bus
mmc_spi: probe of spi0.2 failed with error -16</code></pre></div>											<p class="post-edited">(Last edited by <strong>Dogge</strong> on 18 Jul 2009, 20:17)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p91560">
				<div class="post-metadata">
					<div class="post-num">Post #22</div>
					<div class="post-author">dblackbeer</div>
					<div class="post-datetime">
						18 Jul 2009, 23:53					</div>
				</div>
				<div class="post-content content">
					<p>no.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p91731">
				<div class="post-metadata">
					<div class="post-num">Post #23</div>
					<div class="post-author">gdamjan</div>
					<div class="post-datetime">
						22 Jul 2009, 19:44					</div>
				</div>
				<div class="post-content content">
					<p>Has anyone made the switch work with the RB433UAH?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p92790">
				<div class="post-metadata">
					<div class="post-num">Post #24</div>
					<div class="post-author">alysonbc</div>
					<div class="post-datetime">
						18 Aug 2009, 03:17					</div>
				</div>
				<div class="post-content content">
					<p>I install OpenWRT on a RouterBoard 433 UAH thanks to help from you.</p><p>But I do not to work other network interfaces. Only the interface with POE works.</p><p>More information below:</p><br /><p>My interfaces configuration:</p><p>root@OpenWrt:/# ifconfig<br />br-lan&nbsp; &nbsp; Link encap:Ethernet&nbsp; HWaddr 00:0C:42:41:29:7B<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:192.168.77.1&nbsp; Bcast:192.168.77.255&nbsp; Mask:255.255.255.0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:2 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:2 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:656 (656.0 B)&nbsp; TX bytes:814 (814.0 B)</p><p>br-wan&nbsp; &nbsp; Link encap:Ethernet&nbsp; HWaddr 00:0C:42:41:29:7C<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:10.10.10.1&nbsp; Bcast:10.10.10.255&nbsp; Mask:255.255.255.0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:0 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:0 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:0 (0.0 B)&nbsp; TX bytes:0 (0.0 B)</p><p>eth0&nbsp; &nbsp; &nbsp; Link encap:Ethernet&nbsp; HWaddr 00:0C:42:41:29:7B<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:2 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:2 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:1000<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:684 (684.0 B)&nbsp; TX bytes:814 (814.0 B)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Interrupt:5</p><p>eth1&nbsp; &nbsp; &nbsp; Link encap:Ethernet&nbsp; HWaddr 00:0C:42:41:29:7C<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:0 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:0 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:1000<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:0 (0.0 B)&nbsp; TX bytes:0 (0.0 B)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Interrupt:4</p><p>lo&nbsp; &nbsp; &nbsp; &nbsp; Link encap:Local Loopback<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:127.0.0.1&nbsp; Mask:255.0.0.0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP LOOPBACK RUNNING&nbsp; MTU:16436&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:0 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:0 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:0 (0.0 B)&nbsp; TX bytes:0 (0.0 B)</p><br /><p>Ping test:</p><p>root@OpenWrt:/# ping 192.168.77.254<br />PING 192.168.77.254 (192.168.77.254): 56 data bytes<br />64 bytes from 192.168.77.254: seq=0 ttl=64 time=6.739 ms<br />64 bytes from 192.168.77.254: seq=1 ttl=64 time=0.197 ms<br />64 bytes from 192.168.77.254: seq=2 ttl=64 time=0.220 ms<br />64 bytes from 192.168.77.254: seq=3 ttl=64 time=0.194 ms<br />^C<br />--- 192.168.23.254 ping statistics ---<br />4 packets transmitted, 4 packets received, 0% packet loss<br />round-trip min/avg/max = 0.194/1.837/6.739 ms</p><br /><p>root@OpenWrt:/# ping 10.10.10.20<br />PING 10.10.10.20 (10.10.10.20): 56 data bytes<br />^C<br />--- 10.10.10.20 ping statistics ---<br />5 packets transmitted, 0 packets received, 100% packet loss</p><br /><br /><br /><p>My dmesg:</p><p>ag71xx_mdio: probed<br />eth0: Atheros AG71xx at 0xba000000, irq 5<br />eth1: Atheros AG71xx at 0xb9000000, irq 4</p><br /><p>I installed the pciutils and ethtool to try to discover the problem but failed.</p><p>root@OpenWrt:/# ethtool eth0<br />Settings for eth0:<br />&nbsp; &nbsp; &nbsp; &nbsp; Supported ports: [ TP MII ]<br />&nbsp; &nbsp; &nbsp; &nbsp; Supported link modes:&nbsp; &nbsp;10baseT/Half 10baseT/Full<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 100baseT/Half 100baseT/Full<br />&nbsp; &nbsp; &nbsp; &nbsp; Supports auto-negotiation: Yes<br />&nbsp; &nbsp; &nbsp; &nbsp; Advertised link modes:&nbsp; 10baseT/Half 10baseT/Full<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 100baseT/Half 100baseT/Full<br />&nbsp; &nbsp; &nbsp; &nbsp; Advertised auto-negotiation: Yes<br />&nbsp; &nbsp; &nbsp; &nbsp; Speed: 100Mb/s<br />&nbsp; &nbsp; &nbsp; &nbsp; Duplex: Full<br />&nbsp; &nbsp; &nbsp; &nbsp; Port: MII<br />&nbsp; &nbsp; &nbsp; &nbsp; PHYAD: 4<br />&nbsp; &nbsp; &nbsp; &nbsp; Transceiver: external<br />&nbsp; &nbsp; &nbsp; &nbsp; Auto-negotiation: on<br />&nbsp; &nbsp; &nbsp; &nbsp; Current message level: 0x000000ff (255)<br />&nbsp; &nbsp; &nbsp; &nbsp; Link detected: yes</p><p>root@OpenWrt:/# ethtool eth1<br />Settings for eth1:<br />Cannot get device settings: No such device<br />&nbsp; &nbsp; &nbsp; &nbsp; Current message level: 0x000000ff (255)<br />&nbsp; &nbsp; &nbsp; &nbsp; Link detected: yes</p><p>root@OpenWrt:/# ethtool eth2<br />Settings for eth2:<br />Cannot get device settings: No such device<br />Cannot get wake-on-lan settings: No such device<br />Cannot get message level: No such device<br />Cannot get link status: No such device<br />No data available</p><p>root@OpenWrt:/# ethtool eth3<br />Settings for eth3:<br />Cannot get device settings: No such device<br />Cannot get wake-on-lan settings: No such device<br />Cannot get message level: No such device<br />Cannot get link status: No such device<br />No data available</p><br /><p>root@OpenWrt:/# lspci -vv<br />00:00.0 Non-VGA unclassified device: Device 0700:1107 (rev 01)<br />&nbsp; &nbsp; &nbsp; &nbsp; Control: I/O- Mem+ BusMaster+ SpecCycle- MemWINV+ VGASnoop- ParErr+ Stepping- SERR+ FastB2B+ DisINTx-<br />&nbsp; &nbsp; &nbsp; &nbsp; Status: Cap+ 66MHz+ UDF- FastB2B+ ParErr- DEVSEL=medium &gt;TAbort- &lt;TAbort- &lt;MAbort+ &gt;SERR- &lt;PERR- INTx-<br />&nbsp; &nbsp; &nbsp; &nbsp; Latency: 0<br />&nbsp; &nbsp; &nbsp; &nbsp; Region 0: Memory at &lt;unassigned&gt; (32-bit, prefetchable)<br />&nbsp; &nbsp; &nbsp; &nbsp; Region 1: I/O ports at &lt;unassigned&gt; [disabled]<br />&nbsp; &nbsp; &nbsp; &nbsp; Capabilities: [dc] Power Management version 2<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Flags: PMEClk- DSI- D1+ D2+ AuxCurrent=0mA PME(D0+,D1+,D2+,D3hot+,D3cold-)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Status: D0 PME-Enable- DSel=0 DScale=0 PME-<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Bridge: PM- B3+</p><br /><p>Please, help me!!!</p><p>Thanks in advance.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p92926">
				<div class="post-metadata">
					<div class="post-num">Post #25</div>
					<div class="post-author">dblackbeer</div>
					<div class="post-datetime">
						20 Aug 2009, 03:52					</div>
				</div>
				<div class="post-content content">
					<p>The key it must be in mach-rb-4xx.c file. I haven´t seen this yet.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>