<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Need Help: backfire 10.3 on Atheros AR2315 SOC</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 5 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p109021">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">MStorsved</div>
					<div class="post-datetime">
						13 May 2010, 17:32					</div>
				</div>
				<div class="post-content content">
					<p>Help.&nbsp; I am trying to build backfire 10.3 for my Atheros AR2315 SOC. I have been running 7.04 with an updated kernel - 2.6.25.8 for a long time now and need to upgrade to the latest release. I have built a 10.3 trx/try image which my redboot recognizes and initiates the boot process. But I am not seeing any output from the init scripts (on serial port), which I do on my previous releases.</p><p>I am hoping someone can tell by looking at the redboot output and boot logs, where things are locking up. Below are logs from both 7.04 and 10.3. The kernel commandline for 10.3 appears to be truncated in the log below. The actual string is:</p><p>CONFIG_CMDLINE=&quot;root=/dev/mtd2 noinitrd redboot_dir=-1 sysrq=0 panic=5 init=/etc/preinit rootfstype=squashfs mem=16M quiet&quot;</p><br /><p>Thanks alot.</p><p>********************</p><p>Kamikaze 7.04<br />kernel 2.6.25.8</p><p>RedBoot(tm) bootstrap and debug environment [ROMRAM]<br />Release, version V1.04 - built 09:09:04, Aug 15 2008</p><p>Copyright (C) 2000, 2001, 2002, 2003, 2004 Red Hat, Inc.</p><p>Board: Primex Analog Clock rev 2 <br />RAM: 0x80000000-0x80800000, [0x8003b3a0-0x807e1000] available<br />FLASH: 0xa8000000 - 0xa8800000, 128 blocks of 0x00010000 bytes each.<br />== Executing boot script in 0.100 seconds - enter ^C to abort<br />RedBoot&gt; exec 0xa8030000<br />Now booting linux kernel:<br /> Base address 0x80030000 Entry 0xa8030000<br /> Cmdline : <br />trx at a8030000.<br />kernel at a8031e74.<br />Decompressing...done.<br />[sighandler]: No more events to be processed, quitting.<br />[cleanup]: Waiting for children.<br />[cleanup]: All children terminated.<br />- preinit -<br />- init -<br />init started:&nbsp; BusyBox v1.4.2 (2009-11-10 10:29:31 CST) multi-call binary<br />Starting pid 368, console /dev/ttyS0: &#039;/etc/init.d/rcS&#039;<br />Starting PQ serial app. I can be reached via ssh at 172.22.2.104.</p><p>********************</p><p>Backfire 10.3<br />kernel 2.6.30.10</p><p>RedBoot(tm) bootstrap and debug environment [ROMRAM]<br />Release, version V1.04 - built 09:09:04, Aug 15 2008</p><p>Copyright (C) 2000, 2001, 2002, 2003, 2004 Red Hat, Inc.</p><p>Board: Primex Analog Clock rev 2 <br />RAM: 0x80000000-0x80800000, [0x8003b3a0-0x807e1000] available<br />FLASH: 0xa8000000 - 0xa8800000, 128 blocks of 0x00010000 bytes each.<br />== Executing boot script in 0.100 seconds - enter ^C to abort<br />RedBoot&gt; exec 0xa8030000<br />Now booting linux kernel:<br /> Base address 0x80030000 Entry 0xa8030000<br /> Cmdline : <br />trx at a8030000.<br />kernel at a8031e74.<br />Decompressing...done.<br />Linux version 2.6.30.10 (storsved@ole) (gcc version 4.2.4) #10 Thu May 13 07:19:28 CDT 2010<br />console [early0] enabled<br />CPU revision is: 00019064 (MIPS 4KEc)<br />Determined physical RAM map:<br /> memory: 02000000 @ 00000000 (usable)<br />Initrd not found or empty - disabling initrd<br />Zone PFN ranges:<br />&nbsp; Normal&nbsp; &nbsp;0x00000000 -&gt; 0x00002000<br />Movable zone start PFN for each node<br />early_node_map[1] active PFN ranges<br />&nbsp; &nbsp; 0: 0x00000000 -&gt; 0x00002000<br />Built 1 zonelists in Zone order, mobility grouping on.&nbsp; Total pages: 8128<br />Kernel command line: CONFIG_CMDLINE=&quot;root=/dev/mtd2 noinitrd redboot_dir=-1 sysrq=0 panic=5 init=/e&quot;<br />Primary instruction cache 16kB, VIPT, 4-way, linesize 16 bytes.<br />Primary data cache 16kB, 4-way, VIPT, no aliases, linesize 16 bytes<br />NR_IRQS:128<br />PID hash table entries: 128 (order: 7, 512 bytes)</p><p>********************</p><br /><p>Again thank you.</p><p>Mark</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p109024">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">xssa</div>
					<div class="post-datetime">
						13 May 2010, 18:51					</div>
				</div>
				<div class="post-content content">
					<p>You can remove &quot;quiet&quot; directive from kernel commmandline and look what happens with kernel on booting.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p109030">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">MStorsved</div>
					<div class="post-datetime">
						13 May 2010, 22:32					</div>
				</div>
				<div class="post-content content">
					<p>Thanks, removing &#039;quiet&#039; allowed my to see my typo -- root=/dev/mtd2 instead of root=/dev/mtdblock2.</p><p>Its booting farther now, but is failing when trying to execute the init script. I am using the canned preinit from base-files of atheros target. The file is making it into the root dir with the correct mode, and I believe I have the correct syntax for the cmdline string, see below. </p><p>What can cause failure trying to run preinit?</p><p>Thanks alot.</p><br /><br /><p>********** boot log</p><p>RedBoot(tm) bootstrap and debug environment [ROMRAM]<br />Release, version V1.04 - built 09:09:04, Aug 15 2008</p><p>Copyright (C) 2000, 2001, 2002, 2003, 2004 Red Hat, Inc.</p><p>Board: Primex Analog Clock rev 2 <br />RAM: 0x80000000-0x80800000, [0x8003b3a0-0x807e1000] available<br />FLASH: 0xa8000000 - 0xa8800000, 128 blocks of 0x00010000 bytes each.<br />== Executing boot script in 0.100 seconds - enter ^C to abort<br />RedBoot&gt; exec 0xa8030000<br />Now booting linux kernel:<br /> Base address 0x80030000 Entry 0xa8030000<br /> Cmdline : <br />trx at a8030000.<br />kernel at a8031e74.<br />Decompressing...done.<br />Linux version 2.6.30.10 (storsved@ole) (gcc version 4.2.4) #26 Thu May 13 14:13:04 CDT 2010<br />console [early0] enabled<br />CPU revision is: 00019064 (MIPS 4KEc)<br />Determined physical RAM map:<br /> memory: 02000000 @ 00000000 (usable)<br />User-defined physical RAM map:<br /> memory: 01000000 @ 00000000 (usable)<br />Initrd not found or empty - disabling initrd<br />Zone PFN ranges:<br />&nbsp; Normal&nbsp; &nbsp;0x00000000 -&gt; 0x00001000<br />Movable zone start PFN for each node<br />early_node_map[1] active PFN ranges<br />&nbsp; &nbsp; 0: 0x00000000 -&gt; 0x00001000<br />Built 1 zonelists in Zone order, mobility grouping off.&nbsp; Total pages: 4064<br />Kernel command line: root=/dev/mtdblock2 rootfstype=squashfs,jffs2 init=/etc/preinit mem=16M console=ttyS0,115200<br />Primary instruction cache 16kB, VIPT, 4-way, linesize 16 bytes.<br />Primary data cache 16kB, 4-way, VIPT, no aliases, linesize 16 bytes<br />NR_IRQS:128<br />PID hash table entries: 64 (order: 6, 256 bytes)<br />console handover: boot [early0] -&gt; real [ttyS0]<br />Dentry cache hash table entries: 2048 (order: 1, 8192 bytes)<br />Inode-cache hash table entries: 1024 (order: 0, 4096 bytes)<br />Memory: 13688k/16384k available (1734k kernel code, 2696k reserved, 350k data, 120k init, 0k highmem)<br />Calibrating delay loop... 183.50 BogoMIPS (lpj=917504)<br />Mount-cache hash table entries: 512<br />net_namespace: 296 bytes<br />NET: Registered protocol family 16<br />bio: create slab &lt;bio-0&gt; at 0<br />pci 0000:00:00.0: BAR 1: can&#039;t allocate mem resource [0x84000000-0x857f7fff]<br />pci 0000:00:03.0: BAR 1: can&#039;t allocate mem resource [0x84000000-0x857f7fff]<br />NET: Registered protocol family 2<br />IP route cache hash table entries: 1024 (order: 0, 4096 bytes)<br />TCP established hash table entries: 512 (order: 0, 4096 bytes)<br />TCP bind hash table entries: 512 (order: -1, 2048 bytes)<br />TCP: Hash tables configured (established 512 bind 512)<br />TCP reno registered<br />NET: Registered protocol family 1<br />Radio config found at offset 0xf8(0x1f8)<br />squashfs: version 4.0 (2009/01/31) Phillip Lougher<br />Registering mini_fo version $Id$<br />JFFS2 version 2.2. (NAND) (SUMMARY)&nbsp; Â© 2001-2006 Red Hat, Inc.<br />alg: No test for stdrng (krng)<br />io scheduler noop registered<br />io scheduler deadline registered (default)<br />gpiodev: gpio device registered with major 254<br />gpiodev: gpio platform device registered with access mask FFFFFFFF<br />Serial: 8250/16550 driver, 1 ports, IRQ sharing disabled<br />serial8250: ttyS0 at MMIO 0xb1100003 (irq = 37) is a 16550A<br />eth0: Atheros AR231x: 00:1e:b3:00:02:13, irq 4<br />ar231x_eth_mii: probed<br />eth0: attached PHY driver [Generic PHY] (mii_bus:phy_addr=0:00)<br />cmdlinepart partition parsing not available<br />Searching for RedBoot partition table in spiflash at offset 0x7d0000<br />Searching for RedBoot partition table in spiflash at offset 0x7e0000<br />Searching for RedBoot partition table in spiflash at offset 0x7f0000<br />7 RedBoot partitions found on MTD device spiflash<br />Creating 7 MTD partitions on &quot;spiflash&quot;:<br />0x000000000000-0x000000030000 : &quot;RedBoot&quot;<br />0x000000030000-0x0000003c0000 : &quot;linux&quot;<br />0x0000003c0000-0x000000750000 : &quot;linux2&quot;<br />0x000000750000-0x0000007f0000 : &quot;jffs&quot;<br />0x0000007f0000-0x000000800000 : &quot;FIS directory&quot;<br />0x0000007fe000-0x0000007ff000 : &quot;Atheros data&quot;<br />0x0000007ff000-0x000000800000 : &quot;RedBoot config&quot;<br />TCP cubic registered<br />NET: Registered protocol family 17<br />802.1Q VLAN Support v1.8 Ben Greear &lt;greearb@candelatech.com&gt;<br />All bugs added by David S. Miller &lt;davem@redhat.com&gt;<br />VFS: Mounted root (jffs2 filesystem) readonly on device 31:2.<br />Freeing unused kernel memory: 120k freed<br />Please be patient, while OpenWrt loads ...<br />Failed to execute /etc/preinit.&nbsp; Attempting defaults...<br />Kernel panic - not syncing: No init found.&nbsp; Try passing init= option to kernel.<br />Rebooting in 5 seconds..</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p109044">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">xssa</div>
					<div class="post-datetime">
						13 May 2010, 23:58					</div>
				</div>
				<div class="post-content content">
					<p>Where is your squashfs rootfs partition? Did you enable/flash it? Openwrt runs from squashfs ro partition with jffs on top of it.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p109321">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">MStorsved</div>
					<div class="post-datetime">
						18 May 2010, 18:58					</div>
				</div>
				<div class="post-content content">
					<p>I think the rootfs is getting lost when I create the trx/try image. I cannot change from my current redboot and it&#039;s looking for a trx image. I use the trx tool from openwrt 7.04 and take the vmlinux.bin.l7 and root.squashfs to create a new trx/try file. This is the only way I can even see the kernel booting. But I can&#039;t seem to get the kernel to see the rootfs.</p><p>Any ideas?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p109324">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">lexa2</div>
					<div class="post-datetime">
						18 May 2010, 19:13					</div>
				</div>
				<div class="post-content content">
					<p>Can you provide us with the 7.04 kernel boot log without &quot;quiet&quot; in the boot command line?<br />I&#039;m a little curious about the &quot;linux2&quot; partition on your mtd - looks like is might be the rootfs, which has been given the wrong name by the 7.04 image creation sctipt.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p109331">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">MStorsved</div>
					<div class="post-datetime">
						18 May 2010, 20:11					</div>
				</div>
				<div class="post-content content">
					<p>This message is going to get long.....sorry about that.</p><br /><p>Below are three boot logs in the following order:</p><p>1. successful boot based on openwrt 7.09<br />&nbsp; &nbsp;I&#039;ve been using this for a couple years. Flashing from redboot prompt when at my desk, or via mtd when logged into the unit.</p><p>2. failed boot of a trx img created from backfire vmlinux and root.squashfs<br />&nbsp; &nbsp;The kernel locks up trying to find rootfs.</p><p>3. failed boot when not using a trx img, but the backfire combined.squashfs.img<br />&nbsp; &nbsp;The kernel nevers boots, stops at the end of redboot (I think).</p><br /><br /><p>1. successful boot based on openwrt 7.09</p><p>RedBoot(tm) bootstrap and debug environment [ROMRAM]<br />Release, version V1.04 - built 09:09:04, Aug 15 2008</p><p>Copyright (C) 2000, 2001, 2002, 2003, 2004 Red Hat, Inc.</p><p>Board: Primex Analog Clock rev 2 <br />RAM: 0x80000000-0x80800000, [0x8003b3a0-0x807e1000] available<br />FLASH: 0xa8000000 - 0xa8800000, 128 blocks of 0x00010000 bytes each.<br />== Executing boot script in 0.100 seconds - enter ^C to abort<br />RedBoot&gt; exec 0xa8030000<br />Now booting linux kernel:<br /> Base address 0x80030000 Entry 0xa8030000<br /> Cmdline : <br />trx at a8030000.<br />kernel at a8031e74.<br />Decompressing...done.<br />[&nbsp; &nbsp; 0.000000] Linux version 2.6.25.8 (storsved@linembed01) (gcc version 4.1.2) #2 Tue May 18 08:400<br />[&nbsp; &nbsp; 0.000000] CPU revision is: 00019064 (MIPS 4KEc)<br />[&nbsp; &nbsp; 0.000000] Determined physical RAM map:<br />[&nbsp; &nbsp; 0.000000]&nbsp; memory: 02000000 @ 00000000 (usable)<br />[&nbsp; &nbsp; 0.000000] User-defined physical RAM map:<br />[&nbsp; &nbsp; 0.000000]&nbsp; memory: 01000000 @ 00000000 (usable)<br />[&nbsp; &nbsp; 0.000000] Initrd not found or empty - disabling initrd<br />[&nbsp; &nbsp; 0.000000] Zone PFN ranges:<br />[&nbsp; &nbsp; 0.000000]&nbsp; &nbsp;Normal&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 -&gt;&nbsp; &nbsp; &nbsp;4096<br />[&nbsp; &nbsp; 0.000000] Movable zone start PFN for each node<br />[&nbsp; &nbsp; 0.000000] early_node_map[1] active PFN ranges<br />[&nbsp; &nbsp; 0.000000]&nbsp; &nbsp; &nbsp;0:&nbsp; &nbsp; &nbsp; &nbsp; 0 -&gt;&nbsp; &nbsp; &nbsp;4096<br />[&nbsp; &nbsp; 0.010000] Built 1 zonelists in Zone order, mobility grouping off.&nbsp; Total pages: 4064<br />[&nbsp; &nbsp; 0.010000] Kernel command line: console=ttyS0,115200 init=/etc/preinit sysrq=0 panic=5 rootfsty <br />[&nbsp; &nbsp; 0.010000] Primary instruction cache 16kB, VIPT, 4-way, linesize 16 bytes.<br />[&nbsp; &nbsp; 0.010000] Primary data cache 16kB, 4-way, VIPT, no aliases, linesize 16 bytes<br />[&nbsp; &nbsp; 0.010000] Synthesized clear page handler (26 instructions).<br />[&nbsp; &nbsp; 0.010000] Synthesized copy page handler (46 instructions).<br />[&nbsp; &nbsp; 0.010000] PID hash table entries: 64 (order: 6, 256 bytes)<br />[&nbsp; &nbsp; 0.010000] console [ttyS0] enabled<br />[&nbsp; &nbsp; 0.010000] Dentry cache hash table entries: 2048 (order: 1, 8192 bytes)<br />[&nbsp; &nbsp; 0.010000] Inode-cache hash table entries: 1024 (order: 0, 4096 bytes)<br />[&nbsp; &nbsp; 0.020000] Memory: 13928k/16384k available (1545k kernel code, 2456k reserved, 276k data, 132k )<br />[&nbsp; &nbsp; 0.260000] Mount-cache hash table entries: 512<br />[&nbsp; &nbsp; 0.270000] net_namespace: 152 bytes<br />[&nbsp; &nbsp; 0.270000] NET: Registered protocol family 16<br />[&nbsp; &nbsp; 0.280000] Atheros board data found at 0xa87fe000<br />[&nbsp; &nbsp; 0.280000] Atheros cal data found at 0xa87fe0f8<br />[&nbsp; &nbsp; 0.290000] Radio config found at offset 0xf8(0x1f8)<br />[&nbsp; &nbsp; 0.370000] NET: Registered protocol family 2<br />[&nbsp; &nbsp; 0.470000] IP route cache hash table entries: 1024 (order: 0, 4096 bytes)<br />[&nbsp; &nbsp; 0.480000] TCP established hash table entries: 512 (order: 0, 4096 bytes)<br />[&nbsp; &nbsp; 0.480000] TCP bind hash table entries: 512 (order: -1, 2048 bytes)<br />[&nbsp; &nbsp; 0.490000] TCP: Hash tables configured (established 512 bind 512)<br />[&nbsp; &nbsp; 0.500000] TCP reno registered<br />[&nbsp; &nbsp; 0.530000] ar531x: Registering GPIODEV device<br />[&nbsp; &nbsp; 0.540000] squashfs: version 3.0 (2006/03/15) Phillip Lougher<br />[&nbsp; &nbsp; 0.550000] Registering mini_fo version $Id$<br />[&nbsp; &nbsp; 0.550000] JFFS2 version 2.2. (NAND) (SUMMARY)&nbsp; Â© 2001-2006 Red Hat, Inc.<br />[&nbsp; &nbsp; 0.560000] io scheduler noop registered<br />[&nbsp; &nbsp; 0.560000] io scheduler deadline registered (default)<br />[&nbsp; &nbsp; 0.580000] gpiodev: gpio device registered with major 254<br />[&nbsp; &nbsp; 0.580000] gpiodev: gpio platform device registered with access mask FFFFFFFF<br />[&nbsp; &nbsp; 0.590000] Serial: 8250/16550 driver $Revision: 1.90 $ 1 ports, IRQ sharing disabled<br />[&nbsp; &nbsp; 0.600000] serial8250: ttyS0 at MMIO 0xb1100003 (irq = 37) is a 16550A<br />[&nbsp; &nbsp; 0.640000] brd: module loaded<br />[&nbsp; &nbsp; 0.760000] ar2313_eth_mii: probed<br />[&nbsp; &nbsp; 0.760000] eth%d: attached PHY driver [Generic PHY] (mii_bus:phy_addr=0:00)<br />[&nbsp; &nbsp; 0.830000] eth0: Atheros AR231x: 00:1e:b3:00:02:13, irq 4<br />[&nbsp; &nbsp; 0.840000] cmdlinepart partition parsing not available<br />[&nbsp; &nbsp; 0.850000] Searching for RedBoot partition table in spiflash at offset 0x7f0000<br />[&nbsp; &nbsp; 0.920000] 7 RedBoot partitions found on MTD device spiflash<br />[&nbsp; &nbsp; 0.920000] Creating 7 MTD partitions on &quot;spiflash&quot;:<br />[&nbsp; &nbsp; 0.930000] 0x00000000-0x00030000 : &quot;RedBoot&quot;<br />[&nbsp; &nbsp; 0.940000] 0x00030000-0x003c0000 : &quot;linux&quot;<br />[&nbsp; &nbsp; 0.950000] Found try header<br />[&nbsp; &nbsp; 0.950000] mtd: partition &quot;rootfs&quot; created automatically, ofs=CF000, len=2F1000 <br />[&nbsp; &nbsp; 0.960000] Creating 1 MTD partitions on &quot;spiflash&quot;:<br />[&nbsp; &nbsp; 0.960000] 0x000cf000-0x003c0000 : &quot;rootfs&quot;<br />[&nbsp; &nbsp; 0.970000] mtd: partition &quot;rootfs&quot; doesn&#039;t start on an erase block boundary -- force read-only<br />[&nbsp; &nbsp; 0.980000] mtd: partition &quot;rootfs&quot; set to be root filesystem<br />[&nbsp; &nbsp; 0.990000] 0x003c0000-0x00750000 : &quot;linux2&quot;<br />[&nbsp; &nbsp; 1.000000] 0x00750000-0x007f0000 : &quot;jffs&quot;<br />[&nbsp; &nbsp; 1.010000] 0x007f0000-0x00800000 : &quot;FIS directory&quot;<br />[&nbsp; &nbsp; 1.020000] 0x007fe000-0x007ff000 : &quot;Atheros data&quot;<br />[&nbsp; &nbsp; 1.020000] mtd: partition &quot;Atheros data&quot; doesn&#039;t start on an erase block boundary -- force ready<br />[&nbsp; &nbsp; 1.030000] 0x007ff000-0x00800000 : &quot;RedBoot config&quot;<br />[&nbsp; &nbsp; 1.050000] TCP cubic registered<br />[&nbsp; &nbsp; 1.050000] NET: Registered protocol family 1<br />[&nbsp; &nbsp; 1.060000] NET: Registered protocol family 17<br />[&nbsp; &nbsp; 1.060000] 802.1Q VLAN Support v1.8 Ben Greear &lt;greearb@candelatech.com&gt;<br />[&nbsp; &nbsp; 1.070000] All bugs added by David S. Miller &lt;davem@redhat.com&gt;<br />[&nbsp; &nbsp; 1.090000] VFS: Mounted root (squashfs filesystem) readonly.<br />[&nbsp; &nbsp; 1.100000] Freeing unused kernel memory: 132k freed<br />[&nbsp; &nbsp; 2.830000] Algorithmics/MIPS FPU Emulator v1.5<br />[sighandler]: No more events to be processed, quitting.<br />[cleanup]: Waiting for children.<br />[cleanup]: All children terminated.<br />- preinit -<br />- init -<br />init started:&nbsp; BusyBox v1.4.2 (2009-11-10 10:29:31 CST) multi-call binary<br />Starting pid 368, console /dev/ttyS0: &#039;/etc/init.d/rcS&#039;<br />Starting PQ serial app. I can be reached via ssh at 172.22.2.104.</p><br /><p>2. failed boot of a trx img created from backfire vmlinux and root.squashfs</p><br /><p>RedBoot(tm) bootstrap and debug environment [ROMRAM]<br />Release, version V1.04 - built 09:09:04, Aug 15 2008</p><p>Copyright (C) 2000, 2001, 2002, 2003, 2004 Red Hat, Inc.</p><p>Board: Primex Analog Clock rev 2 <br />RAM: 0x80000000-0x80800000, [0x8003b3a0-0x807e1000] available<br />FLASH: 0xa8000000 - 0xa8800000, 128 blocks of 0x00010000 bytes each.<br />== Executing boot script in 0.100 seconds - enter ^C to abort<br />RedBoot&gt; exec 0xa8030000<br />Now booting linux kernel:<br /> Base address 0x80030000 Entry 0xa8030000<br /> Cmdline : <br />trx at a8030000.<br />kernel at a8031e74.<br />Decompressing...done.<br />Linux version 2.6.30.10 (storsved@ole) (gcc version 4.2.4) #43 Mon May 17 10:32:58 CDT 2010<br />console [early0] enabled<br />CPU revision is: 00019064 (MIPS 4KEc)<br />Determined physical RAM map:<br /> memory: 02000000 @ 00000000 (usable)<br />User-defined physical RAM map:<br /> memory: 01000000 @ 00000000 (usable)<br />Initrd not found or empty - disabling initrd<br />Zone PFN ranges:<br />&nbsp; Normal&nbsp; &nbsp;0x00000000 -&gt; 0x00001000<br />Movable zone start PFN for each node<br />early_node_map[1] active PFN ranges<br />&nbsp; &nbsp; 0: 0x00000000 -&gt; 0x00001000<br />Built 1 zonelists in Zone order, mobility grouping off.&nbsp; Total pages: 4064<br />Kernel command line: console=ttyS0,115200 init=/etc/preinit sysrq=0 panic=5 rootfstype=squashfs memM<br />Primary instruction cache 16kB, VIPT, 4-way, linesize 16 bytes.<br />Primary data cache 16kB, 4-way, VIPT, no aliases, linesize 16 bytes<br />NR_IRQS:128<br />PID hash table entries: 64 (order: 6, 256 bytes)<br />console handover: boot [early0] -&gt; real [ttyS0]<br />Dentry cache hash table entries: 2048 (order: 1, 8192 bytes)<br />Inode-cache hash table entries: 1024 (order: 0, 4096 bytes)<br />Memory: 13852k/16384k available (1597k kernel code, 2532k reserved, 331k data, 112k init, 0k highme)<br />Calibrating delay loop... 183.50 BogoMIPS (lpj=917504)<br />Mount-cache hash table entries: 512<br />net_namespace: 296 bytes<br />NET: Registered protocol family 16<br />bio: create slab &lt;bio-0&gt; at 0<br />NET: Registered protocol family 2<br />IP route cache hash table entries: 1024 (order: 0, 4096 bytes)<br />TCP established hash table entries: 512 (order: 0, 4096 bytes)<br />TCP bind hash table entries: 512 (order: -1, 2048 bytes)<br />TCP: Hash tables configured (established 512 bind 512)<br />TCP reno registered<br />NET: Registered protocol family 1<br />Radio config found at offset 0xf8(0x1f8)<br />squashfs: version 4.0 (2009/01/31) Phillip Lougher<br />Registering mini_fo version $Id$<br />JFFS2 version 2.2. (NAND) (SUMMARY)&nbsp; Â© 2001-2006 Red Hat, Inc.<br />alg: No test for stdrng (krng)<br />io scheduler noop registered<br />io scheduler deadline registered (default)<br />gpiodev: gpio device registered with major 254<br />gpiodev: gpio platform device registered with access mask FFFFFFFF<br />Serial: 8250/16550 driver, 1 ports, IRQ sharing disabled<br />serial8250: ttyS0 at MMIO 0xb1100003 (irq = 37) is a 16550A<br />eth0: Atheros AR231x: 00:1e:b3:00:02:13, irq 4<br />ar231x_eth_mii: probed<br />eth0: attached PHY driver [Generic PHY] (mii_bus:phy_addr=0:00)<br />cmdlinepart partition parsing not available<br />Searching for RedBoot partition table in spiflash at offset 0x7d0000<br />Searching for RedBoot partition table in spiflash at offset 0x7e0000<br />Searching for RedBoot partition table in spiflash at offset 0x7f0000<br />7 RedBoot partitions found on MTD device spiflash<br />Creating 7 MTD partitions on &quot;spiflash&quot;:<br />0x000000000000-0x000000030000 : &quot;RedBoot&quot;<br />0x000000030000-0x0000003c0000 : &quot;linux&quot;<br />0x0000003c0000-0x000000750000 : &quot;linux2&quot;<br />0x000000750000-0x0000007f0000 : &quot;jffs&quot;<br />0x0000007f0000-0x000000800000 : &quot;FIS directory&quot;<br />0x0000007fe000-0x0000007ff000 : &quot;Atheros data&quot;<br />0x0000007ff000-0x000000800000 : &quot;RedBoot config&quot;<br />TCP cubic registered<br />NET: Registered protocol family 17<br />802.1Q VLAN Support v1.8 Ben Greear &lt;greearb@candelatech.com&gt;<br />All bugs added by David S. Miller &lt;davem@redhat.com&gt;<br />VFS: Cannot open root device &quot;&lt;NULL&gt;&quot; or unknown-block(0,0)<br />Please append a correct &quot;root=&quot; boot option; here are the available partitions:<br />1f00&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;192 mtdblock0 (driver?)<br />1f01&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 3648 mtdblock1 (driver?)<br />1f02&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 3648 mtdblock2 (driver?)<br />1f03&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;640 mtdblock3 (driver?)<br />1f04&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 64 mtdblock4 (driver?)<br />1f05&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;4 mtdblock5 (driver?)<br />1f06&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;4 mtdblock6 (driver?)<br />Kernel panic - not syncing: VFS: Unable to mount root fs on unknown-block(0,0)<br />Rebooting in 5 seconds..&lt;6&gt;eth0: Configuring MAC for full duplex</p><br /><p>3. failed boot when not using a trx img, but the backfire combined.squashfs.img</p><p>RedBoot(tm) bootstrap and debug environment [ROMRAM]<br />Release, version V1.04 - built 09:09:04, Aug 15 2008</p><p>Copyright (C) 2000, 2001, 2002, 2003, 2004 Red Hat, Inc.</p><p>Board: Primex Analog Clock rev 2 <br />RAM: 0x80000000-0x80800000, [0x8003b3a0-0x807e1000] available<br />FLASH: 0xa8000000 - 0xa8800000, 128 blocks of 0x00010000 bytes each.<br />== Executing boot script in 0.100 seconds - enter ^C to abort<br />RedBoot&gt; exec 0xa8030000<br />Now booting linux kernel:<br /> Base address 0x80030000 Entry 0xa8030000<br /> Cmdline :</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p109333">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">lexa2</div>
					<div class="post-datetime">
						18 May 2010, 20:30					</div>
				</div>
				<div class="post-content content">
					<p>Here is the significant part:<br /></p><div class="codebox"><pre><code>[    0.840000] cmdlinepart partition parsing not available
[    0.850000] Searching for RedBoot partition table in spiflash at offset 0x7f0000
[    0.920000] 7 RedBoot partitions found on MTD device spiflash
[    0.920000] Creating 7 MTD partitions on &quot;spiflash&quot;:
[    0.930000] 0x00000000-0x00030000 : &quot;RedBoot&quot;
[    0.940000] 0x00030000-0x003c0000 : &quot;linux&quot;
[    0.950000] Found try header
[    0.950000] mtd: partition &quot;rootfs&quot; created automatically, ofs=CF000, len=2F1000
[    0.960000] Creating 1 MTD partitions on &quot;spiflash&quot;:
[    0.960000] 0x000cf000-0x003c0000 : &quot;rootfs&quot;
[    0.970000] mtd: partition &quot;rootfs&quot; doesn&#039;t start on an erase block boundary -- force read-only
[    0.980000] mtd: partition &quot;rootfs&quot; set to be root filesystem
[    0.990000] 0x003c0000-0x00750000 : &quot;linux2&quot;
[    1.000000] 0x00750000-0x007f0000 : &quot;jffs&quot;
[    1.010000] 0x007f0000-0x00800000 : &quot;FIS directory&quot;
[    1.020000] 0x007fe000-0x007ff000 : &quot;Atheros data&quot;
[    1.020000] mtd: partition &quot;Atheros data&quot; doesn&#039;t start on an erase block boundary -- force ready
[    1.030000] 0x007ff000-0x00800000 : &quot;RedBoot config&quot;</code></pre></div><p>Even more specifically:<br /></p><div class="codebox"><pre><code>[    0.940000] 0x00030000-0x003c0000 : &quot;linux&quot;
[    0.950000] Found try header
[    0.950000] mtd: partition &quot;rootfs&quot; created automatically, ofs=CF000, len=2F1000
[    0.960000] Creating 1 MTD partitions on &quot;spiflash&quot;:
[    0.960000] 0x000cf000-0x003c0000 : &quot;rootfs&quot;
[    0.970000] mtd: partition &quot;rootfs&quot; doesn&#039;t start on an erase block boundary -- force read-only
[    0.980000] mtd: partition &quot;rootfs&quot; set to be root filesystem</code></pre></div><p>Your problem is definitely related with the mtd-partition layout. It is not clear what the &quot;linux2&quot; partition is for (maybe, a backup kernel?), but it is clear that the kernel from the OpenWRT version 7.x somehow autodetects that the &quot;linux&quot; partition is in fact the kernel and the rootfs concatenated together. After finding out the &quot;try header&quot; is somehow calculates the correct offset values and auto adds rootfs mtd partition. This partition would be later used as the root filesystem device.</p><p>In order to troubleshoot the problem you may try to fetch the latest OpenWRT sources from the SVN and track down the changes to the mtd-related kernel stuff for AR7 target back to the OpenWRT 7.x times. Alternative possibility is to manually specify mtd partitions and their boundaries in the kernel command line (you may get the idea about how to do it looking into the &quot;target/linux/ar71xx/image/Makefile&quot; file in the current OpenWRT trunk. In any case it would be helpfull to take the&nbsp; backup of the flash contents and prepare the JTAG-stuff prior getting into the experiments.</p>											<p class="post-edited">(Last edited by <strong>lexa2</strong> on 18 May 2010, 20:31)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p109337">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">MStorsved</div>
					<div class="post-datetime">
						18 May 2010, 21:05					</div>
				</div>
				<div class="post-content content">
					<p>I was digging into the other targets supported by backfire to find the only target using trx format in image creation is the adm5120. So I configured this target and did a make. A kernel patch and file &#039;trxsplit.c&#039; is applied and build. With my config, the generic atheros, there is no mention of trx anyware, but only in backfire. In my old build, openwrt 7.09 2.6.25.8 there are mtd trx source.<br />Could I need to apply the same patches that adm5120 is using?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p109339">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">lexa2</div>
					<div class="post-datetime">
						18 May 2010, 21:40					</div>
				</div>
				<div class="post-content content">
					<p>Your millage may vary, unfortunately the only person who may know the correct answer is you :-(.</p><p>I haven&#039;t got any of AR2315 SoC boards here to do the experiments and you hadn&#039;t posted any detailed information about how exactly had you been building openwrt 7.09/openwrt 10.03 and flashing it onto the board. The only thing I can clearly see is that 7.09 kernel somehow manages to find the location of the rootfs on the flash inside the &quot;linux&quot; mtd partition while 10.03 kernel fails to do so and eventually fails to boot.</p><p>As for the trx format - D-Link DIR-320 also uses trx format but it is Broadcom BRCM47xx-based device and it use CFE as the bootloader, so trx format might be different from the one used by your board.</p><p>One of the devices with the Redboot loader I&#039;ve been experimenting with was D-Link DIR-300. You may find some usefull information on Redboot on the wiki page for DIR-300: <a href="http://wiki.openwrt.org/oldwiki/openwrtdocs/hardware/d_link/dir_300">http://wiki.openwrt.org/oldwiki/openwrt â¦ nk/dir_300</a></p><p>I wouldn&#039;t be surprised if your problems can be easily fixed using &quot;fis&quot; command under Redboot console.<br />Just wondering: it might be as easy as deleting &quot;linux&quot; flash partition (and maybe &quot;linux2&quot;, in case it is not needed for your board to function) and creating two new partitions &quot;linux&quot; and &quot;rootfs&quot;, flashing one with the lzma-compressed kernel image and another with the squashfs-based rootfs image. There will be some caveats (for example, jffs2 uses the tailing part of the rootfs for storing data, calling that virtual mtd partition as rootfs_data, so it would be necessary for rootfs partition to be bigger in size than the original squashfs filesystem image) and you must be warned that it is very easy to destroy some valuable contents of the flash during the experiments.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p109460">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">MStorsved</div>
					<div class="post-datetime">
						20 May 2010, 00:30					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for your help. I&#039;m getting further but still can&#039;t get a mountable rootfs.<br />I&#039;ve tried passing the root=/dev/mtdblockX argument in CONFIG_CMDLINE string, with 1,2 and 3 in &#039;X&#039; above, but without success. I guess it was my assumption the the mtdblock number would correlate with the device given out below.</p><p>Anymore ideas?</p><p>again, thanks</p><p>*********boot log************</p><br /><p>RedBoot(tm) bootstrap and debug environment [ROMRAM]<br />Release, version V1.04 - built 09:09:04, Aug 15 2008</p><p>Copyright (C) 2000, 2001, 2002, 2003, 2004 Red Hat, Inc.</p><p>Board: Primex Analog Clock rev 2 <br />RAM: 0x80000000-0x80800000, [0x8003b3a0-0x807e1000] available<br />FLASH: 0xa8000000 - 0xa8800000, 128 blocks of 0x00010000 bytes each.<br />== Executing boot script in 0.100 seconds - enter ^C to abort<br />RedBoot&gt; exec 0xa8030000<br />Now booting linux kernel:<br /> Base address 0x80030000 Entry 0xa8030000<br /> Cmdline : <br />trx at a8030000.<br />kernel at a8031e74.<br />Decompressing...done.<br />[&nbsp; &nbsp; 0.000000] Linux version 2.6.30.10 (storsved@ole) (gcc version 4.2.4) #77 Wed May 19 16:20:06 C0<br />[&nbsp; &nbsp; 0.000000] console [early0] enabled<br />[&nbsp; &nbsp; 0.000000] CPU revision is: 00019064 (MIPS 4KEc)<br />[&nbsp; &nbsp; 0.000000] Determined physical RAM map:<br />[&nbsp; &nbsp; 0.000000]&nbsp; memory: 02000000 @ 00000000 (usable)<br />[&nbsp; &nbsp; 0.000000] User-defined physical RAM map:<br />[&nbsp; &nbsp; 0.000000]&nbsp; memory: 01000000 @ 00000000 (usable)<br />[&nbsp; &nbsp; 0.000000] Initrd not found or empty - disabling initrd<br />[&nbsp; &nbsp; 0.000000] Zone PFN ranges:<br />[&nbsp; &nbsp; 0.000000]&nbsp; &nbsp;Normal&nbsp; &nbsp;0x00000000 -&gt; 0x00001000<br />[&nbsp; &nbsp; 0.000000] Movable zone start PFN for each node<br />[&nbsp; &nbsp; 0.000000] early_node_map[1] active PFN ranges<br />[&nbsp; &nbsp; 0.000000]&nbsp; &nbsp; &nbsp;0: 0x00000000 -&gt; 0x00001000<br />[&nbsp; &nbsp; 0.000000] Built 1 zonelists in Zone order, mobility grouping off.&nbsp; Total pages: 4064<br />[&nbsp; &nbsp; 0.000000] Kernel command line: console=ttyS0,115200 rootfstype=squashfs root=/dev/mtdblock3 inM<br />[&nbsp; &nbsp; 0.000000] Primary instruction cache 16kB, VIPT, 4-way, linesize 16 bytes.<br />[&nbsp; &nbsp; 0.000000] Primary data cache 16kB, 4-way, VIPT, no aliases, linesize 16 bytes<br />[&nbsp; &nbsp; 0.000000] NR_IRQS:128<br />[&nbsp; &nbsp; 0.000000] PID hash table entries: 64 (order: 6, 256 bytes)<br />[&nbsp; &nbsp; 0.000000] console handover: boot [early0] -&gt; real [ttyS0]<br />[&nbsp; &nbsp; 0.000000] Dentry cache hash table entries: 2048 (order: 1, 8192 bytes)<br />[&nbsp; &nbsp; 0.010000] Inode-cache hash table entries: 1024 (order: 0, 4096 bytes)<br />[&nbsp; &nbsp; 0.020000] Memory: 13812k/16384k available (1633k kernel code, 2572k reserved, 336k data, 112k )<br />[&nbsp; &nbsp; 0.030000] Calibrating delay loop... 183.50 BogoMIPS (lpj=917504)<br />[&nbsp; &nbsp; 0.260000] Mount-cache hash table entries: 512<br />[&nbsp; &nbsp; 0.270000] net_namespace: 296 bytes<br />[&nbsp; &nbsp; 0.280000] NET: Registered protocol family 16<br />[&nbsp; &nbsp; 0.310000] bio: create slab &lt;bio-0&gt; at 0<br />[&nbsp; &nbsp; 0.340000] NET: Registered protocol family 2<br />[&nbsp; &nbsp; 0.350000] IP route cache hash table entries: 1024 (order: 0, 4096 bytes)<br />[&nbsp; &nbsp; 0.360000] TCP established hash table entries: 512 (order: 0, 4096 bytes)<br />[&nbsp; &nbsp; 0.370000] TCP bind hash table entries: 512 (order: -1, 2048 bytes)<br />[&nbsp; &nbsp; 0.370000] TCP: Hash tables configured (established 512 bind 512)<br />[&nbsp; &nbsp; 0.380000] TCP reno registered<br />[&nbsp; &nbsp; 0.380000] NET: Registered protocol family 1<br />[&nbsp; &nbsp; 0.390000] Radio config found at offset 0xf8(0x1f8)<br />[&nbsp; &nbsp; 0.420000] squashfs: version 4.0 (2009/01/31) Phillip Lougher<br />[&nbsp; &nbsp; 0.420000] Registering mini_fo version $Id$<br />[&nbsp; &nbsp; 0.430000] JFFS2 version 2.2. (NAND) (SUMMARY)&nbsp; Â© 2001-2006 Red Hat, Inc.<br />[&nbsp; &nbsp; 0.450000] alg: No test for stdrng (krng)<br />[&nbsp; &nbsp; 0.450000] io scheduler noop registered<br />[&nbsp; &nbsp; 0.460000] io scheduler deadline registered (default)<br />[&nbsp; &nbsp; 0.470000] gpiodev: gpio device registered with major 254<br />[&nbsp; &nbsp; 0.480000] gpiodev: gpio platform device registered with access mask FFFFFFFF<br />[&nbsp; &nbsp; 0.490000] Serial: 8250/16550 driver, 1 ports, IRQ sharing disabled<br />[&nbsp; &nbsp; 0.490000] serial8250: ttyS0 at MMIO 0xb1100003 (irq = 37) is a 16550A<br />[&nbsp; &nbsp; 0.580000] eth0: Atheros AR231x: 00:06:80:e0:00:12, irq 4<br />[&nbsp; &nbsp; 0.700000] ar231x_eth_mii: probed<br />[&nbsp; &nbsp; 0.700000] eth0: attached PHY driver [Generic PHY] (mii_bus:phy_addr=0:00)<br />[&nbsp; &nbsp; 0.710000] Searching for RedBoot partition table in spiflash at offset 0x7d0000<br />[&nbsp; &nbsp; 0.820000] Searching for RedBoot partition table in spiflash at offset 0x7e0000<br />[&nbsp; &nbsp; 0.920000] Searching for RedBoot partition table in spiflash at offset 0x7f0000<br />[&nbsp; &nbsp; 1.020000] 6 RedBoot partitions found on MTD device spiflash<br />[&nbsp; &nbsp; 1.030000] Creating 6 MTD partitions on &quot;spiflash&quot;:<br />[&nbsp; &nbsp; 1.040000] 0x000000000000-0x000000030000 : &quot;RedBoot&quot;<br />[&nbsp; &nbsp; 1.040000] mtd: Giving out device 0 to RedBoot<br />[&nbsp; &nbsp; 1.050000] 0x000000030000-0x0000003c0000 : &quot;linux&quot;<br />[&nbsp; &nbsp; 1.060000] mtd: Giving out device 1 to linux<br />[&nbsp; &nbsp; 1.060000] 0x0000003c0000-0x0000007f0000 : &quot;rootfs&quot;<br />[&nbsp; &nbsp; 1.070000] mtd: Giving out device 2 to rootfs<br />[&nbsp; &nbsp; 1.080000] mtd: partition &quot;rootfs&quot; set to be root filesystem<br />[&nbsp; &nbsp; 1.080000] mtd: partition &quot;rootfs_data&quot; created automatically, ofs=520000, len=2D0000 <br />[&nbsp; &nbsp; 1.090000] 0x000000520000-0x0000007f0000 : &quot;rootfs_data&quot;<br />[&nbsp; &nbsp; 1.100000] mtd: Giving out device 3 to rootfs_data<br />[&nbsp; &nbsp; 1.100000] 0x0000007f0000-0x000000800000 : &quot;FIS directory&quot;<br />[&nbsp; &nbsp; 1.110000] mtd: Giving out device 4 to FIS directory<br />[&nbsp; &nbsp; 1.120000] 0x0000007fe000-0x0000007ff000 : &quot;Atheros data&quot;<br />[&nbsp; &nbsp; 1.130000] mtd: Giving out device 5 to Atheros data<br />[&nbsp; &nbsp; 1.130000] 0x0000007ff000-0x000000800000 : &quot;RedBoot config&quot;<br />[&nbsp; &nbsp; 1.140000] mtd: Giving out device 6 to RedBoot config<br />[&nbsp; &nbsp; 1.150000] TCP cubic registered<br />[&nbsp; &nbsp; 1.150000] NET: Registered protocol family 17<br />[&nbsp; &nbsp; 1.160000] 802.1Q VLAN Support v1.8 Ben Greear &lt;greearb@candelatech.com&gt;<br />[&nbsp; &nbsp; 1.170000] All bugs added by David S. Miller &lt;davem@redhat.com&gt;<br />[&nbsp; &nbsp; 1.180000] VFS: Cannot open root device &quot;mtdblock3&quot; or unknown-block(0,0)<br />[&nbsp; &nbsp; 1.190000] Please append a correct &quot;root=&quot; boot option; here are the available partitions:<br />[&nbsp; &nbsp; 1.200000] Kernel panic - not syncing: VFS: Unable to mount root fs on unknown-block(0,0)<br />[&nbsp; &nbsp; 1.200000] Rebooting in 5 seconds..&lt;6&gt;eth0: Configuring MAC for full duplex</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p109462">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">duvi</div>
					<div class="post-datetime">
						20 May 2010, 00:46					</div>
				</div>
				<div class="post-content content">
					<p>If it is AR2315 and it already has redboot, why don&#039;t you try the same steps as for the fonera?</p><p><a href="http://wiki.openwrt.org/toh/fon/fonera#installing.openwrt.with.redboot">http://wiki.openwrt.org/toh/fon/fonera# â¦ th.redboot</a></p><p>The commands I use (of course first set up tftp and use local and server ip addresses in fconfig as appropriate for you):</p><p>fconfig</p><p>Run script at boot: true<br />Boot script:<br />.. fis load -l vmlinux.bin.l7<br />.. exec<br />Boot script timeout (1000ms resolution): 10<br />Use BOOTP for network configuration: false<br />Gateway IP address: 0.0.0.0<br />Local IP address: 192.168.1.254<br />Local IP address mask: 255.255.255.0<br />Default server IP address: 192.168.1.83<br />Console baud rate: 9600<br />GDB connection port: 9000<br />Force console for special debug messages: false<br />Network debug at boot time: false</p><p>Save to nvram.</p><p>fis init<br />load -r -b %{FREEMEMLO} openwrt-atheros-vmlinux.lzma<br />fis create -e 0x80041000 -r 0x80041000 vmlinux.bin.l7<br />load -r -b %{FREEMEMLO} openwrt-atheros-root.squashfs<br />fis free</p><p>//here you get the start and end of the free rom, calculate the difference in hex, and use it below as 0xLENGTH</p><p>fis create -l 0xLENGTH rootfs</p><p>reset</p>											<p class="post-edited">(Last edited by <strong>duvi</strong> on 20 May 2010, 00:48)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p109463">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">lexa2</div>
					<div class="post-datetime">
						20 May 2010, 00:50					</div>
				</div>
				<div class="post-content content">
					<p>Something had certainly changed since your previous bootlog for backfire kernel.</p><p>Here is the most insteresting part:<br /></p><div class="codebox"><pre><code>[    0.710000] Searching for RedBoot partition table in spiflash at offset 0x7d0000
[    0.820000] Searching for RedBoot partition table in spiflash at offset 0x7e0000
[    0.920000] Searching for RedBoot partition table in spiflash at offset 0x7f0000
[    1.020000] 6 RedBoot partitions found on MTD device spiflash
[    1.030000] Creating 6 MTD partitions on &quot;spiflash&quot;:
[    1.040000] 0x000000000000-0x000000030000 : &quot;RedBoot&quot;
[    1.040000] mtd: Giving out device 0 to RedBoot
[    1.050000] 0x000000030000-0x0000003c0000 : &quot;linux&quot;
[    1.060000] mtd: Giving out device 1 to linux
[    1.060000] 0x0000003c0000-0x0000007f0000 : &quot;rootfs&quot;
[    1.070000] mtd: Giving out device 2 to rootfs
[    1.080000] mtd: partition &quot;rootfs&quot; set to be root filesystem
[    1.080000] mtd: partition &quot;rootfs_data&quot; created automatically, ofs=520000, len=2D0000
[    1.090000] 0x000000520000-0x0000007f0000 : &quot;rootfs_data&quot;
[    1.100000] mtd: Giving out device 3 to rootfs_data
[    1.100000] 0x0000007f0000-0x000000800000 : &quot;FIS directory&quot;
[    1.110000] mtd: Giving out device 4 to FIS directory
[    1.120000] 0x0000007fe000-0x0000007ff000 : &quot;Atheros data&quot;
[    1.130000] mtd: Giving out device 5 to Atheros data
[    1.130000] 0x0000007ff000-0x000000800000 : &quot;RedBoot config&quot;
[    1.140000] mtd: Giving out device 6 to RedBoot config</code></pre></div><p>As you can see, now the kernel had successfully found rootfs partition and auto-created rootfs_data partition which will host the jffs2 read-write overlay later.<br />Had you tried to boot without specifying root=&lt;something&gt; at all? Looks like that the kernel from 7.x version automatically picks rootfs partition as the root so it might be also the case for 10.03 kernel.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p109465">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">lexa2</div>
					<div class="post-datetime">
						20 May 2010, 00:59					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>duvi wrote:</cite><blockquote><p>If it is AR2315 and it already has redboot, why don&#039;t you try the same steps as for the fonera?</p></blockquote></div><p>It seems to me that there are no differences between loading kernel from the flash partition called &quot;linux&quot; and the flash partition called &quot;vmlinux.bin.l7&quot; - the results should be generally the same.</p><p>If you would look once again into the kernel boot logs then you will definitely see that at first the problem was kernel not recognizing the rootfs inside the linux redboot mtd partition, but now it happily finds &quot;rootfs&quot; partition (looks like thread author had created it using redboot&#039;s fis command) but don&#039;t use it as the default system root.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p109466">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">lexa2</div>
					<div class="post-datetime">
						20 May 2010, 01:08					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>MStorsved wrote:</cite><blockquote><p>...Anymore ideas?...</p></blockquote></div><p>Also you may try specifying &quot;root=31:2&quot; (31 is the major device number for mtdblock, 2 is the minor number for mtdblock2).<br />Of course you may try to use any other digit instead of 2 for minor number, but accordingly to the latest bootlog rootfs partition gets the minor number 2:<br /></p><div class="codebox"><pre><code>[    1.070000] mtd: Giving out device 2 to rootfs</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p109472">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">MStorsved</div>
					<div class="post-datetime">
						20 May 2010, 01:46					</div>
				</div>
				<div class="post-content content">
					<p>I found something, but not sure how to fix it. I found the rootfs being created by the canned backfire atheros image scripts is making a little endian fs, not big. I&#039;ve not modified any of the scripts which create the images.<br />I tried to add &#039;-be&#039; to the image.mk, but the new mksquashfs4 doesn&#039;t like the argument and pukes.</p><p>see below:</p><p>the backfire file:</p><p>storsved@linembed01:~$ file /var/lib/tftpboot/openwrt-atheros-root.squashfs /var/lib/tftpboot/openwrt-atheros-root.squashfs: Squashfs filesystem, little endian, version 4.0, 365018111 bytes, 410 inodes, blocksize: 0 bytes, created: Thu Aug 20 00:00:48 1981</p><p>the openwrt 7.09 file:</p><p>storsved@linembed01:~$ file /opt/openwrt-primex-1.2/bin/openwrt-atheros-2.6-root.squashfs /opt/openwrt-primex-1.2/bin/openwrt-atheros-2.6-root.squashfs: Squashfs filesystem, big endian, version 3.0, 1830148 bytes, 396 inodes, blocksize: 65536 bytes, created: Tue May 18 08:40:23 2010</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p109474">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">lexa2</div>
					<div class="post-datetime">
						20 May 2010, 02:10					</div>
				</div>
				<div class="post-content content">
					<p>Quoting from the <a href="http://tldp.org/HOWTO/SquashFS-HOWTO/whatis.html">tdlp squashfs FAQ</a>:<br /></p><div class="quotebox"><blockquote><p>Both big and little endian architectures are supported; SquashFS can mount file systems created on different byte-order machines</p></blockquote></div><p>So, fs endianess should not be a problem, as any variant should work. Have you tried to boot with &quot;root=31:2&quot;? Have you tried not to specify the &quot;root=&quot; at all?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p109478">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">MStorsved</div>
					<div class="post-datetime">
						20 May 2010, 05:30					</div>
				</div>
				<div class="post-content content">
					<p>Yes, I have tried without root=, and still no go. But I have not tried what the kernel is saying--- root=31:2, but will try. <br />So mounting filesystems of different endian-ness really doesn&#039;t matter? I guess I was hoping that was the problem. Probably why the new squashfs doesn&#039;t have an endian argument, at least as far as I could see, quickly browsing the source.</p><p>Where does the 31:2 designation come from?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p109479">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">lexa2</div>
					<div class="post-datetime">
						20 May 2010, 10:04					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>MStorsved wrote:</cite><blockquote><p>So mounting filesystems of different endian-ness really doesn&#039;t matter? I guess I was hoping that was the problem. Probably why the new squashfs doesn&#039;t have an endian argument, at least as far as I could see, quickly browsing the source.</p></blockquote></div><p>It depends on the filesystem design and kernel driver implementation. In case filesystem specs take the endian-ness into considetation and if it is possible to determine the variant from the fs metadata/superblock/ets - it would be possible to implement the kernel driver that would work normally with both variants of endian-ness. Most advanced filesystems like zfs even may cope with the different endian-ness metadata inside the single filesystem image. </p><p>I wasn&#039;t aware before that the squashfs is one of the filesystems supporting both endian-ness at the same time, but the quick googling showed that it is one of the key features squashfs offers.</p><div class="quotebox"><cite>MStorsved wrote:</cite><blockquote><p>Where does the 31:2 designation come from?</p></blockquote></div><p>This is the mtdblock2 device major and minor numbers as assigned by default by the linux kernel. I had obtained this using simple &quot;ln -l /dev/mtdblock2&quot; on couple of the openwrt boxes I have and then checking up that the numbers are likely to be the same on any linux kernel 2.6 by searching google.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p109547">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">xssa</div>
					<div class="post-datetime">
						21 May 2010, 00:34					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>MStorsved wrote:</cite><blockquote><p>[&nbsp; &nbsp; 1.180000] VFS: Cannot open root device &quot;mtdblock3&quot; or unknown-block(0,0)<br />[&nbsp; &nbsp; 1.190000] Please append a correct &quot;root=&quot; boot option; here are the available partitions:<br />[&nbsp; &nbsp; 1.200000] Kernel panic - not syncing: VFS: Unable to mount root fs on unknown-block(0,0)<br />[&nbsp; &nbsp; 1.200000] Rebooting in 5 seconds..&lt;6&gt;eth0: Configuring MAC for full duplex</p></blockquote></div><p>Did you change default kernel config?<br />Check kernel-&gt;device drivers-&gt;-*-&nbsp; &nbsp;Common interface to block layer for MTD &#039;translation layers&#039;<br />&lt;*&gt;&nbsp; &nbsp;Caching block device access to MTD devices</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>