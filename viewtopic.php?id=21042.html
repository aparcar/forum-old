<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> bridging multiple wireless mini-pci card with wired ethernet interface</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 29 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p91297">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">dobest03</div>
					<div class="post-datetime">
						13 Jul 2009, 10:07					</div>
				</div>
				<div class="post-content content">
					<p>Hello, everyone.</p><p>I&#039;ve been developing AP/router with Gateworks 2348-4 (IXP425) board where 3 mini-pci atheros wireless card<br />installed, using Kamikaze 8.09.1</p><p>I&#039;d like to configure i/f&#039;s like this:</p><p>eth1: WAN I/F<br />eth0, wifi0, wifi1, wifi2: as bridge.</p><p>(eth0, eth1 is interfaces built in IXP425 and it is wired.<br /> eth1 is connected another AP/router. And this router gives<br />clients dhcp addresses from 192.168.0 network.<br />)</p><p>I&#039;d like to know how to:<br />1. bridge multiple atheros wireless mini-pci card and ethernet(eth0), say br-lan<br />2. put three wireless card to AP mode.<br />3. forwarding packet from br-lan to eth1 (wan)</p><p>Is that possible? I&#039;ve actually search through howto&#039;s but I couldn&#039;t<br />find the related one... If anyone know the howto URL<br />please let me know</p><br /><p>For you reference, the following is the message when I booted:<br /></p><div class="codebox"><pre><code>Please press Enter to activate this console. firmware: requesting NPE-B
NPE-B: firmware&#039;s license can be found in /usr/share/doc/LICENSE.IPL
NPE-B: firmware functionality 0x2, revision 0x2:1
eth0: link down
br-lan: Dropping NETIF_F_UFO since no NETIF_F_HW_CSUM feature.
device eth0 entered promiscuous mode
firmware: requesting NPE-C
NPE-C: firmware&#039;s license can be found in /usr/share/doc/LICENSE.IPL
NPE-C: firmware functionality 0x5, revision 0x2:1
eth1: link down
PPP generic driver version 2.4.2
ip_tables: (C) 2000-2006 Netfilter Core Team
nf_conntrack version 0.5.0 (1024 buckets, 4096 max)
wlan: trunk
ath_hal: module license &#039;Proprietary&#039; taints kernel.
ath_hal: 2009-05-08 (AR5210, AR5211, AR5212, AR5416, RF5111, RF5112, RF2413, RF5
413, RF2133, RF2425, REGOPS_FUNC, XR)
ath_rate_minstrel: Minstrel automatic rate control algorithm 1.2 (trunk)
ath_rate_minstrel: look around rate set to 10%
ath_rate_minstrel: EWMA rolloff level set to 75%
ath_rate_minstrel: max segment size in the mrr set to 6000 us
wlan: mac acl policy registered
ath_pci: trunk
PCI: enabling device 0000:00:01.0 (0340 -&gt; 0342)
Atheros HAL provided by OpenWrt, DD-WRT and MakSat Technologies
wifi0: 11a rates: 6Mbps 9Mbps 12Mbps 18Mbps 24Mbps 36Mbps 48Mbps 54Mbps
wifi0: turboA rates: 6Mbps 9Mbps 12Mbps 18Mbps 24Mbps 36Mbps 48Mbps 54Mbps
wifi0: H/W encryption support: WEP AES AES_CCM TKIP
ath_pci: wifi0: Atheros 5212: mem=0x48000000, irq=28
PCI: enabling device 0000:00:03.0 (0340 -&gt; 0342)
Atheros HAL provided by OpenWrt, DD-WRT and MakSat Technologies
wifi1: 11b rates: 1Mbps 2Mbps 5.5Mbps 11Mbps
wifi1: 11g rates: 1Mbps 2Mbps 5.5Mbps 11Mbps 6Mbps 9Mbps 12Mbps 18Mbps 24Mbps 36
Mbps 48Mbps 54Mbps
wifi1: turboG rates: 6Mbps 12Mbps 18Mbps 24Mbps 36Mbps 48Mbps 54Mbps
wifi1: H/W encryption support: WEP AES AES_CCM TKIP
ath_pci: wifi1: Atheros 5212: mem=0x48020000, irq=26
PCI: enabling device 0000:00:04.0 (0340 -&gt; 0342)
Atheros HAL provided by OpenWrt, DD-WRT and MakSat Technologies
wifi2: 11a rates: 6Mbps 9Mbps 12Mbps 18Mbps 24Mbps 36Mbps 48Mbps 54Mbps
wifi2: turboA rates: 6Mbps 9Mbps 12Mbps 18Mbps 24Mbps 36Mbps 48Mbps 54Mbps
wifi2: H/W encryption support: WEP AES AES_CCM TKIP
ath_pci: wifi2: Atheros 5212: mem=0x48030000, irq=25
eth1: link up, 100Mbps, full-duplex, lpa 0x45E1
device ath0 entered promiscuous mode
br-lan: port 2(ath0) entering learning state
br-lan: topology change detected, propagating
br-lan: port 2(ath0) entering forwarding state
br-lan: port 2(ath0) entering disabled state
device ath0 left promiscuous mode
br-lan: port 2(ath0) entering disabled state
device ath0 entered promiscuous mode
br-lan: port 2(ath0) entering learning state
br-lan: topology change detected, propagating
br-lan: port 2(ath0) entering forwarding state
br-lan: port 2(ath0) entering disabled state
device ath0 left promiscuous mode
br-lan: port 2(ath0) entering disabled state
device ath0 entered promiscuous mode
br-lan: port 2(ath0) entering learning state
br-lan: topology change detected, propagating
br-lan: port 2(ath0) entering forwarding state
br-lan: port 2(ath0) entering disabled state
device ath0 left promiscuous mode
br-lan: port 2(ath0) entering disabled state</code></pre></div><p>/etc/config/network:<br /></p><div class="codebox"><pre><code>#config switch eth0
#       option vlan0    &quot;0 1 2 3 5*&quot;
#       option vlan1    &quot;4 5&quot;

config &#039;interface&#039; &#039;loopback&#039;
        option &#039;ifname&#039; &#039;lo&#039;
        option &#039;proto&#039; &#039;static&#039;
        option &#039;ipaddr&#039; &#039;127.0.0.1&#039;
        option &#039;netmask&#039; &#039;255.0.0.0&#039;

config &#039;interface&#039; &#039;wan&#039;
        option &#039;ifname&#039; &#039;eth1&#039;
        option &#039;proto&#039; &#039;dhcp&#039;

config &#039;interface&#039; &#039;lan&#039;
        option &#039;ifname&#039; &#039;eth0&#039; &#039;wifi0&#039; &#039;wifi1&#039; &#039;wifi2&#039;
#       option &#039;ifname&#039; &quot;eth0.0&quot;
        option &#039;type&#039; &#039;bridge&#039;
        option &#039;proto&#039; &#039;static&#039;
        option &#039;ipaddr&#039; &#039;192.168.1.1&#039;
        option &#039;netmask&#039; &#039;255.255.255.0&#039;
        option &#039;dns&#039; &#039;&#039;
        option &#039;gateway&#039; &#039;192.168.0.1&#039;</code></pre></div><p>/etc/config/wireless:<br /></p><div class="codebox"><pre><code>config wifi-device  wifi0
        option type     atheros
        option channel  auto
        option country  kr

        # REMOVE THIS LINE TO ENABLE WIFI:
        #option disabled 1
config wifi-iface
        option device   wifi0
        option network  lan
        option mode     ap
        option ssid     OpenWrt
        option encryption psk, psk2
        option isolate  1

config wifi-device  wifi1
        option type     atheros
        option channel  auto
        option country  kr

        # REMOVE THIS LINE TO ENABLE WIFI:
        #option disabled 1
config wifi-iface
        option device   wifi1
        option network  lan
        option mode     ap
        option ssid     OpenWrt
        option encryption psk, psk2
        option isolate  1

config wifi-device  wifi2
        option type     atheros
        option channel  auto
        option country  kr

        # REMOVE THIS LINE TO ENABLE WIFI:
        #option disabled 1
config wifi-iface
        option device   wifi2
        option network  lan
        option mode     ap
        option ssid     OpenWrt
        option encryption psk, psk2
        option isolate  1</code></pre></div><p>&#039;brctl&#039; didn&#039;t allow bridge with wired and wireless i/f&#039;s..<br />Is that due to the i/f configuration problem with /etc/config/network, /etc/config/wirelss etc,<br />or should I use another package other than bridge-utility?</p><br /><p>Thank you!..</p>											<p class="post-edited">(Last edited by <strong>dobest03</strong> on 13 Jul 2009, 10:20)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p91299">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">dobest03</div>
					<div class="post-datetime">
						13 Jul 2009, 10:47					</div>
				</div>
				<div class="post-content content">
					<p>I coudn&#039;t see bridged interfaces with &#039;brctl show&#039; so<br />I posted an question.</p><p>I&#039;ve changed the /etc/config/network and /etc/config/wireless is like the following<br />and it seems working.</p><p>/etc/config/network:</p><div class="codebox"><pre><code>root@OpenWrt:~# cat /etc/config/network
config switch eth0
        option vlan0    &quot;0 1 2 3 5*&quot;
        option vlan1    &quot;4 5&quot;

config &#039;interface&#039; &#039;loopback&#039;
        option &#039;ifname&#039; &#039;lo&#039;
        option &#039;proto&#039; &#039;static&#039;
        option &#039;ipaddr&#039; &#039;127.0.0.1&#039;
        option &#039;netmask&#039; &#039;255.0.0.0&#039;

config &#039;interface&#039; &#039;wan&#039;
        option &#039;ifname&#039; &#039;eth1&#039;
        option &#039;proto&#039; &#039;dhcp&#039;

config &#039;interface&#039; &#039;lan&#039;
#       option &#039;ifname&#039; &#039;eth0&#039; &#039;wifi0&#039; &#039;wifi1&#039; &#039;wifi2&#039;
        option &#039;ifname&#039; &quot;eth0.0&quot;
        option &#039;type&#039; &#039;bridge&#039;
        option &#039;proto&#039; &#039;static&#039;
        option &#039;ipaddr&#039; &#039;192.168.1.1&#039;
        option &#039;netmask&#039; &#039;255.255.255.0&#039;
        option &#039;dns&#039; &#039;&#039;
        option &#039;gateway&#039; &#039;192.168.0.1&#039;</code></pre></div><p>/etc/config/wireless:</p><div class="codebox"><pre><code>config wifi-device  wifi0
        option type     atheros
        option channel  auto
        option country  kr

        # REMOVE THIS LINE TO ENABLE WIFI:
        #option disabled 1
config wifi-iface
        option device   wifi0
        option network  lan
        option mode     ap
        option ssid     OpenWrt
        option encryption psk, psk2
        option key      &quot;some_key&quot;
        option isolate  1

config wifi-device  wifi1
        option type     atheros
        option channel  auto
        option country  kr

        # REMOVE THIS LINE TO ENABLE WIFI:
        #option disabled 1
config wifi-iface
        option device   wifi1
        option network  lan
        option mode     ap
        option ssid     OpenWrt
        option encryption psk, psk2
        option key      &quot;some_key&quot;
        option isolate  1

config wifi-device  wifi2
        option type     atheros
        option channel  auto
        option country  kr

        # REMOVE THIS LINE TO ENABLE WIFI:
        #option disabled 1
config wifi-iface
        option device   wifi2
        option network  lan
        option mode     ap
        option ssid     OpenWrt
        option encryption psk, psk2
        option key      &quot;some_key&quot;
        option isolate  1</code></pre></div><p>And I tried to connect with wireless usb dongle from my development PC to Gateworks boards:</p><p>From developemnt pc:</p><div class="codebox"><pre><code> $ ifconfig
lo        Link encap:Local Loopback  
          inet addr:127.0.0.1  Mask:255.0.0.0
          inet6 addr: ::1/128 Scope:Host
          UP LOOPBACK RUNNING  MTU:16436  Metric:1
          RX packets:145 errors:0 dropped:0 overruns:0 frame:0
          TX packets:145 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:13013 (13.0 KB)  TX bytes:13013 (13.0 KB)

ra0       Link encap:Ethernet  HWaddr 00:12:0e:a8:34:de  
          inet addr:192.168.1.103  Bcast:192.168.1.255  Mask:255.255.255.0
          inet6 addr: fe80::212:eff:fea8:34de/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:1000 errors:0 dropped:0 overruns:0 frame:0
          TX packets:223 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:153230 (153.2 KB)  TX bytes:18906 (18.9 KB)

$ iwconfig
lo        no wireless extensions.

eth0      no wireless extensions.

vboxnet0  no wireless extensions.

pan0      no wireless extensions.

ra0       RT2870 Wireless  ESSID:&quot;OpenWrt&quot;  Nickname:&quot;RT2870STA&quot;
          Mode:Managed  Frequency=2.457 GHz  Access Point: 00:15:6D:53:7C:AC   
          Bit Rate=54 Mb/s   
          RTS thr:off   Fragment thr:off
          Link Quality=82/100  Signal level:-62 dBm  Noise level:-83 dBm
          Rx invalid nwid:0  Rx invalid crypt:0  Rx invalid frag:0
          Tx excessive retries:0  Invalid misc:0   Missed beacon:0

$ ping www.intel.com
PING a961.g.akamai.net (125.56.214.48) 56(84) bytes of data.
64 bytes from 125.56.214.48: icmp_seq=1 ttl=52 time=12.3 ms
64 bytes from 125.56.214.48: icmp_seq=2 ttl=52 time=31.3 ms
64 bytes from 125.56.214.48: icmp_seq=3 ttl=52 time=11.4 ms
64 bytes from 125.56.214.48: icmp_seq=4 ttl=52 time=10.8 ms
^C
--- a961.g.akamai.net ping statistics ---
4 packets transmitted, 4 received, 0% packet loss, time 3005ms
rtt min/avg/max/mdev = 10.848/16.519/31.395/8.605 ms</code></pre></div><p>ps from gateworks is like the following:</p><div class="codebox"><pre><code>root@OpenWrt:~# ps
  PID USER       VSZ STAT COMMAND
    1 root      1116 S    init       
    2 root         0 SW&lt;  [kthreadd]
    3 root         0 SW&lt;  [ksoftirqd/0]
    4 root         0 SW&lt;  [events/0]
    5 root         0 SW&lt;  [khelper]
   39 root         0 SW&lt;  [kblockd/0]
   67 root         0 SW   [pdflush]
   68 root         0 SW   [pdflush]
   69 root         0 SW&lt;  [kswapd0]
   70 root         0 SW&lt;  [aio/0]
  602 root         0 SW&lt;  [mtdblockd]
 1868 root         0 SWN  [jffs2_gcd_mtd3]
 1882 root      1128 R    /bin/ash --login 
 1890 root      1128 S    syslogd -C16 
 1892 root      1108 S    klogd 
 1904 root       592 S    /sbin/hotplug2 --override --persistent --max-children
 2354 root      1128 S    udhcpc -t 0 -i eth1 -b -p /var/run/eth1.pid -R 
 2385 root       808 S    hostapd -P /var/run/wifi-ath0.pid -B /var/run/hostapd
 2445 root       808 S    hostapd -P /var/run/wifi-ath1.pid -B /var/run/hostapd
 2505 root       808 S    hostapd -P /var/run/wifi-ath2.pid -B /var/run/hostapd
 2675 root       892 S    /usr/sbin/dropbear -p 22 
 2680 root      1112 S    /usr/sbin/httpd -p 80 -h /www -r OpenWrt 
 2701 nobody     712 S    /usr/sbin/dnsmasq -K -D -y -Z -b -E -s lan -S /lan/ -
 2708 root      1108 S    watchdog -t 5 /dev/watchdog 
 2718 root      1116 R    ps</code></pre></div><p>I have a question about vlan port mapping:</p><p>&nbsp; &nbsp; &nbsp; &nbsp; option vlan0&nbsp; &nbsp; &quot;0 1 2 3 5*&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; option vlan1&nbsp; &nbsp; &quot;4 5&quot;</p><p>0: for eth0,<br />1~3: for wireless i/f (ath0, ath1, ath2)<br />4: eth1<br />5: internal port which has a VLAN-tagged connection into LInux internals.</p><p>My consumption is right? Where can I confirm the port number and i/f..</p><p>If one more wireless card is installed that configuraiton must change like the following?</p><p>&nbsp; &nbsp; &nbsp; &nbsp; option vlan0&nbsp; &nbsp; &quot;0 1 2 3 4 5*&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; option vlan1&nbsp; &nbsp; &quot;6 5&quot;</p><p>Thank you for your reading ~!</p>											<p class="post-edited">(Last edited by <strong>dobest03</strong> on 13 Jul 2009, 11:46)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p91365">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">MMCM</div>
					<div class="post-datetime">
						14 Jul 2009, 15:29					</div>
				</div>
				<div class="post-content content">
					<p>As &quot;config switch eth0&quot; says, it&#039;s the configuration of the internal switch (if your device does have any).<br />If your device does not have an internals switch (supported by openwrt!), the whole &quot;config switch&quot; section is useless, in that case, vlans like &quot;eth0.1&quot; and &quot;eth0.0&quot; will not exist, unless you create your own with vconfig.<br />Since your devices seems to have only two ethernet interfaces, which are eth0 and eth1, it does not have an internal switch.<br />So you should bridge your wireless interfaces with eth0, if eth1 is used for WAN.<br />Either specify the wireless interface in &quot;option ifname&quot; in /etc/config/network **OR** use the &quot;option network&quot; in /etc/config/wireless.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>