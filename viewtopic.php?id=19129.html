<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> macfilter</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 2 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p82850">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">shuo</div>
					<div class="post-datetime">
						28 Feb 2009, 01:30					</div>
				</div>
				<div class="post-content content">
					<p>hi all,</p><p>i would like to know how to enable the macfilter. i want to allow wireless access just for user, whose mac address are in the maclist. <br />i add following line to /etc/config/wirelss:</p><p>option &#039;maclist&#039; &#039;00-00-00-00-00-f8 00:00:00:00:00:0e&#039;<br />option &#039;macpolicy&#039; &#039;allow&#039;</p><p>unfortunately it does not matter which kind of mac address is configured. its always working. also if i try to configure &quot;deny&quot; its possible to connect.<br />where is my mistake....?</p><p>thx</p>											<p class="post-edited">(Last edited by <strong>shuo</strong> on 28 Feb 2009, 12:45)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p82870">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">Yanira</div>
					<div class="post-datetime">
						28 Feb 2009, 13:13					</div>
				</div>
				<div class="post-content content">
					<p>The first MAC address is in wrong format.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p82875">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">shuo</div>
					<div class="post-datetime">
						28 Feb 2009, 13:39					</div>
				</div>
				<div class="post-content content">
					<p>but if it is the wrong format, why it is possible to connect? the router should allow just the mac addresses which are configured in the list. shouldnt?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p82957">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">shuo</div>
					<div class="post-datetime">
						1 Mar 2009, 14:17					</div>
				</div>
				<div class="post-content content">
					<p>nobody any idea?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p85642">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">el_goretto</div>
					<div class="post-datetime">
						11 Apr 2009, 21:49					</div>
				</div>
				<div class="post-content content">
					<p>Same annoying problem here, mac filtering isn&#039;t effective at all, whatever I put in macpolicy. <br />I tried &quot;deny&quot; but no effect either, it&#039;s as if macfilter is always disabled.&nbsp; I used &quot;wifi&quot; command to force AP to use new parameters after each modification of the /etc/config/wireless file (dunno if it&#039;s the right way)</p><br /><div class="codebox"><pre><code>option &#039;maclist&#039; &#039; 00:12:17:94:04:10 00:18:F8:2C:9A:FA 00:1c:bf:04:b0:52 00:0e:9b:44:e9:ce 00:1c:f0:d3:cb:aa 00:1e:e5:ff:3a:6b 00:1f:3c:33:8e:55&#039;
option &#039;macpolicy&#039; &#039;allow&#039;</code></pre></div><p>Any wifi adapter (with its mac not in maclist) can connect to AP.<br />This problem appears after upgrading WRT54GL from White Russian to 8.09 Kamikaze (through Xwrt/Kamikaze 8.09 (with 2.4 kernel, not a 2.6 with b43 which doesn&#039;t support macfiltering as far as I know) firmware package). Mac filter was fine with White Russian.<br />Is there some nvram interaction remaining? Something induced by the upgrade process (imported some setup part from nvram?)?</p><br /><br /><br /><p>BTW, the /etc/config/* kamikaze files are really nice and easy to configure (had to inject a FW rule impossible to handle with Xwrt webif).</p>											<p class="post-edited">(Last edited by <strong>el_goretto</strong> on 11 Apr 2009, 22:12)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p85644">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">el_goretto</div>
					<div class="post-datetime">
						11 Apr 2009, 22:04					</div>
				</div>
				<div class="post-content content">
					<p>Maybe it is related to some problem in the wifi interface name (I&#039;m not used to uci yet):</p><div class="codebox"><pre><code>root@OpenWrt:/etc/config# uci show wireless
wireless.wl0=wifi-device
wireless.wl0.type=broadcom
wireless.wl0.hwmode=
wireless.wl0.channel=11
wireless.wl0.maxassoc=[...]
wireless.wl0.disabled=0
wireless.wl0.antenna=
wireless.wl0.country=
wireless.@wifi-iface[0]=wifi-iface
wireless.@wifi-iface[0].device=wl0
wireless.@wifi-iface[0].network=lan
wireless.@wifi-iface[0].mode=ap
wireless.@wifi-iface[0].ssid=HOHOHO
wireless.@wifi-iface[0].bssid=
wireless.@wifi-iface[0].encryption=psk2
wireless.@wifi-iface[0].server=
wireless.@wifi-iface[0].port=
wireless.@wifi-iface[0].hidden=0
wireless.@wifi-iface[0].isolate=0
wireless.@wifi-iface[0].txpower=
wireless.@wifi-iface[0].bgscan=0
wireless.@wifi-iface[0].frag=
wireless.@wifi-iface[0].rts=
wireless.@wifi-iface[0].wds=0
wireless.@wifi-iface[0].key=HAHAHAHA
[...]
wireless.@wifi-iface[0].maclist= 00:12:17:94:04:10 00:18:F8:2C:9A:FA 00:1c:bf:04:b0:52 00:0e:9b:44:e9:ce 00:1c:f0:d3:cb:aa 00:1e:e5:ff:3a:6b 00:1f:3c:33:8e:55
wireless.@wifi-iface[0].macpolicy=allow</code></pre></div><p>I&#039;ve seen this page: <a href="http://oldwiki.openwrt.org/OpenWrtDocs(2f)KamikazeConfiguration.html#head-620a51134de86855704249c6b051da7b743224a6">http://oldwiki.openwrt.org/OpenWrtDocs( â€¦ 7b743224a6</a><br />But still no wl package to install said opkg, and as you can see, I get wireless.@wifi-iface[0].macpolicy and not wireless.wl0.macpolicy, though they are connected somehow (wireless.@wifi-iface[0].device=wl0).</p><p>Is this procedure still accurate? Should I make my own init script to filter mac?<br />And btw... why is this not included in Kamikaze core?</p><br /><p>Thank you for your answer.</p>											<p class="post-edited">(Last edited by <strong>el_goretto</strong> on 11 Apr 2009, 22:05)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p85654">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">KeFaS</div>
					<div class="post-datetime">
						12 Apr 2009, 03:58					</div>
				</div>
				<div class="post-content content">
					<p>You should try with iptables.</p><p>Something like that:</p><div class="codebox"><pre><code>iptables -P INPUT DROP
iptables -P FORWARD DROP
iptables -P OUTPUT ACCEPT

iptables -A INPUT -i wl0 -j DROP
iptables -A FORWARD -i wl0  -j DROP

iptables -A INPUT -i wl0 -m mac --mac-source 00:11:22:33:44:55:66 -j ACCEPT
iptables -A FORWARD -i wl0 -m mac --mac-source 00:11:22:33:44:55:66 -j ACCEPT</code></pre></div><p>But I think you have to remove (disable) uci firewall and build your own iptables firewall with this lines at the end.</p>											<p class="post-edited">(Last edited by <strong>KeFaS</strong> on 12 Apr 2009, 04:14)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p85712">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">el_goretto</div>
					<div class="post-datetime">
						13 Apr 2009, 13:47					</div>
				</div>
				<div class="post-content content">
					<p>Yes, I could use iptables for my own purpose ^^<br />But router is not mine (family one) and I don&#039;t want to put some specific configuration that can&#039;t be handled through a webif by non-tech people (... family <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" />). That&#039;s why mac filtering is borderline but ok, iptables not at all.</p><p>I&#039;m amazed by the lack of documentation about kamikaze releases. I luckily found something (while looking for info about luci): <a href="http://luci.freifunk-halle.net/UserDocs/FAQ">http://luci.freifunk-halle.net/UserDocs/FAQ</a><br />wireless.@wifi-iface[0].macpolicy is for madwifi, for broadcom, it&#039;s wireless.@wifi-iface[0].macfilter.<br />Hurrah.</p><p>Except that wireless.@wifi-iface[0].macfilter is not effective either, no matter what value is in wireless.@wifi-iface[0].macpolicy or even if it&#039;s not defined at all.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p85736">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">kupesoft</div>
					<div class="post-datetime">
						13 Apr 2009, 20:32					</div>
				</div>
				<div class="post-content content">
					<p>Note that MAC filtering alone isn&#039;t a very secure way of setting things up.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p85857">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">ninja</div>
					<div class="post-datetime">
						14 Apr 2009, 22:11					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>el_goretto wrote:</cite><blockquote><p>...But still no wl package to install said opkg..</p></blockquote></div><p>Looks like wl package is available by now.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p86133">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">alfred</div>
					<div class="post-datetime">
						19 Apr 2009, 04:45					</div>
				</div>
				<div class="post-content content">
					<p>Is there any wl package for 2.6? I think it is just for target 2.4.<br />So, how to set up mac filter on 2.6 targets? (beside the iptables solution)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p88545">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">el_goretto</div>
					<div class="post-datetime">
						23 May 2009, 22:04					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>alfred wrote:</cite><blockquote><p>Is there any wl package for 2.6? I think it is just for target 2.4.<br />So, how to set up mac filter on 2.6 targets? (beside the iptables solution)</p></blockquote></div><div class="quotebox"><cite>el_goretto wrote:</cite><blockquote><p>Xwrt/Kamikaze 8.09 (with 2.4 kernel, not a 2.6 with b43 which doesn&#039;t support macfiltering as far as I know</p></blockquote></div><p>I don&#039;t know if this 2.6 b43 driver status has changed.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p88550">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">el_goretto</div>
					<div class="post-datetime">
						23 May 2009, 22:25					</div>
				</div>
				<div class="post-content content">
					<p>Thanks ninja for the info about wl package.</p><p>Btw, I installed it and made some &quot;dirty&quot; modifications to the script from the Kamikaze documentation:</p><div class="codebox"><pre><code>#!/bin/sh /etc/rc.common                                                                                 
# The macfilter 2 means that the filter works in &quot;Allow&quot; mode.                                           
# Other options are: 0 - disabled, or 1 - Deny.                                                          
#                                                                                                        
# The maclist is a list of mac addresses to allow/deny, quoted, with spaces                              
#  separating multiple entries                                                                           
# eg  &quot;00:0D:0B:B5:2A:BF 00:0D:0C:A2:2A:BA&quot;                                                              
START=47                                                                                                 
#MACFILTER=`uci get wireless.wl0.macfilter`                                                              
MACFILTER=`uci get wireless.@wifi-iface[0].macfilter`                                                    
[ $MACFILTER == &quot;allow&quot; ] &amp;&amp; MACFILTER=2                                                                 
[ $MACFILTER == &quot;deny&quot; ] &amp;&amp; MACFILTER=1                                                                  
[ $MACFILTER == &quot;none&quot; ] &amp;&amp; MACFILTER=0                                                              
                                                                                                         
#MACLIST=`uci get wireless.wl0.maclist`                                                                  
MACLIST=`uci get wireless.@wifi-iface[0].maclist`                                                        
                                                                                                         
start() {                                                                                                
        wlc ifname wl0 maclist &quot;$MACLIST&quot;                                                                
        wlc ifname wl0 macfilter &quot;$MACFILTER&quot;                                                            
}                                                                                                        
stop() {                                                                                                 
       wlc ifname wl0 maclist none                                                                       
       wlc ifname wl0 macfilter 0                                                                        
}</code></pre></div><p>So that Xwrt webif still inject a valid configuration in /etc/config/wireless that is properly translated by this script.</p><br /><br /><p>--<br />edit: tested on 2.4 branch, and it seems to work correctly in &quot;allow&quot; mode at least.<br />mac filtering: Solved for me.</p>											<p class="post-edited">(Last edited by <strong>el_goretto</strong> on 23 May 2009, 22:48)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p98657">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">el_goretto</div>
					<div class="post-datetime">
						12 Dec 2009, 19:18					</div>
				</div>
				<div class="post-content content">
					<p>Just a shame this topic sinked into nowhere...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p100394">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">adamham</div>
					<div class="post-datetime">
						13 Jan 2010, 22:41					</div>
				</div>
				<div class="post-content content">
					<p>Hullo,</p><p>I have mac filtering working, thanks largely to this post (thanks!). My script is similar to el_groetto&#039;s and I have installed it in /etc/init.d. So far so good.</p><p>When I add or remove a MAC address from my list I&#039;d ideally like this script to be called automatically. I noticed the message &quot;Reloading wireless ...&quot; that appears when I update my mac list via the webif2 wireless configuration page. </p><p>So far my experiments with adding calls to my init script have been random shots in the dark. I&#039;ll keep on plugging, and post the solution should I stumble onto it, but would appreciate any help if it can be given.</p><p>thx</p><p>(BTW - I&#039;m running KAMIKAZE (8.09.1, r18452))</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p105079">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">Floppe</div>
					<div class="post-datetime">
						23 Mar 2010, 13:37					</div>
				</div>
				<div class="post-content content">
					<p>If I understood b43 homepage correctly, then it should support mac filter. Any inputs on this?</p><p>I really would like so see wrt-radauth ported to support kernel 2.6 and b43 but I guess this is a dream never come true.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>