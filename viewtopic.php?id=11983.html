<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> OpenVPN &amp; DHCP</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 2 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p53556">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">kikazzi</div>
					<div class="post-datetime">
						8 Aug 2007, 01:14					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ve gone through the installation for OpenVPN on my router twice over the last two weeks trying to get my VPN connection up and running.&nbsp; Unfortunately, I haven&#039;t had any luck.&nbsp; I&#039;ve figured how to break it and how to get it to partially work.&nbsp; I get the following messages when trying to connect:</p><p>The server reports: <br /></p><div class="codebox"><pre><code>Tue Aug  7 13:40:42 2007 OpenVPN 2.0.9 mipsel-linux [SSL] [LZO] [EPOLL] built on Feb 13 2007
Tue Aug  7 13:40:42 2007 WARNING: file &#039;/etc/secret.key&#039; is group or others accessible
Tue Aug  7 13:40:42 2007 Static Encrypt: Cipher &#039;BF-CBC&#039; initialized with 128 bit key
Tue Aug  7 13:40:42 2007 Static Encrypt: Using 160 bit message hash &#039;SHA1&#039; for HMAC authentication
Tue Aug  7 13:40:42 2007 Static Decrypt: Cipher &#039;BF-CBC&#039; initialized with 128 bit key
Tue Aug  7 13:40:42 2007 Static Decrypt: Using 160 bit message hash &#039;SHA1&#039; for HMAC authentication
Tue Aug  7 13:40:42 2007 TUN/TAP device tap0 opened
Tue Aug  7 13:40:42 2007 Data Channel MTU parms [ L:1576 D:1450 EF:44 EB:4 ET:32 EL:0 ]
Tue Aug  7 13:40:42 2007 Local Options hash (VER=V4): &#039;8b888ddc&#039;
Tue Aug  7 13:40:42 2007 Expected Remote Options hash (VER=V4): &#039;8b888ddc&#039;
Tue Aug  7 13:40:42 2007 UDPv4 link local (bound): [undef]:1194
Tue Aug  7 13:40:42 2007 UDPv4 link remote: [undef]
Tue Aug  7 13:41:20 2007 Peer Connection Initiated with 64.90.196.88:1719
Tue Aug  7 13:41:20 2007 Initialization Sequence Completed</code></pre></div><p>Client Log:<br /></p><div class="codebox"><pre><code>Tue Aug 07 13:39:19 2007 OpenVPN 2.0.9 Win32-MinGW [SSL] [LZO] built on Oct  1 2006
Tue Aug 07 13:39:19 2007 IMPORTANT: OpenVPN&#039;s default port number is now 1194, based on an official port number assignment by IANA.  OpenVPN 2.0-beta16 and earlier used 5000 as the default port.
Tue Aug 07 13:39:19 2007 Static Encrypt: Cipher &#039;BF-CBC&#039; initialized with 128 bit key
Tue Aug 07 13:39:19 2007 Static Encrypt: Using 160 bit message hash &#039;SHA1&#039; for HMAC authentication
Tue Aug 07 13:39:19 2007 Static Decrypt: Cipher &#039;BF-CBC&#039; initialized with 128 bit key
Tue Aug 07 13:39:19 2007 Static Decrypt: Using 160 bit message hash &#039;SHA1&#039; for HMAC authentication
Tue Aug 07 13:39:19 2007 TAP-WIN32 device [OpenVPN] opened: \\.\Global\{1DE2142B-DC85-4E16-B545-137922458420}.tap
Tue Aug 07 13:39:19 2007 TAP-Win32 Driver Version 8.4 
Tue Aug 07 13:39:19 2007 TAP-Win32 MTU=1500
Tue Aug 07 13:39:19 2007 Successful ARP Flush on interface [5] {1DE2142B-DC85-4E16-B545-137922458420}
Tue Aug 07 13:39:19 2007 Data Channel MTU parms [ L:1576 D:1450 EF:44 EB:4 ET:32 EL:0 ]
Tue Aug 07 13:39:19 2007 Local Options hash (VER=V4): &#039;8b888ddc&#039;
Tue Aug 07 13:39:19 2007 Expected Remote Options hash (VER=V4): &#039;8b888ddc&#039;
Tue Aug 07 13:39:19 2007 UDPv4 link local: [undef]
Tue Aug 07 13:39:19 2007 UDPv4 link remote: x.x.x.x:1194
Tue Aug 07 13:39:28 2007 Peer Connection Initiated with x.x.x.x:1194
Tue Aug 07 13:39:30 2007 TEST ROUTES: 0/0 succeeded len=-1 ret=0 a=0 u/d=down
Tue Aug 07 13:39:30 2007 Route: Waiting for TUN/TAP interface to come up...
Tue Aug 07 13:39:31 2007 TEST ROUTES: 0/0 succeeded len=-1 ret=0 a=0 u/d=down
Tue Aug 07 13:39:31 2007 Route: Waiting for TUN/TAP interface to come up...
Tue Aug 07 13:39:32 2007 TEST ROUTES: 0/0 succeeded len=-1 ret=0 a=0 u/d=down
Tue Aug 07 13:39:32 2007 Route: Waiting for TUN/TAP interface to come up...
Tue Aug 07 13:39:33 2007 TEST ROUTES: 0/0 succeeded len=-1 ret=0 a=0 u/d=down
Tue Aug 07 13:39:33 2007 Route: Waiting for TUN/TAP interface to come up...
Tue Aug 07 13:39:34 2007 TEST ROUTES: 0/0 succeeded len=-1 ret=0 a=0 u/d=down
Tue Aug 07 13:39:34 2007 Route: Waiting for TUN/TAP interface to come up...
Tue Aug 07 13:39:35 2007 TEST ROUTES: 0/0 succeeded len=-1 ret=0 a=0 u/d=down
Tue Aug 07 13:39:35 2007 Route: Waiting for TUN/TAP interface to come up...
Tue Aug 07 13:39:37 2007 TEST ROUTES: 0/0 succeeded len=-1 ret=0 a=0 u/d=down
Tue Aug 07 13:39:37 2007 Route: Waiting for TUN/TAP interface to come up...
Tue Aug 07 13:39:38 2007 TEST ROUTES: 0/0 succeeded len=-1 ret=0 a=0 u/d=down
Tue Aug 07 13:39:38 2007 Route: Waiting for TUN/TAP interface to come up...
Tue Aug 07 13:39:39 2007 TEST ROUTES: 0/0 succeeded len=-1 ret=0 a=0 u/d=down
Tue Aug 07 13:39:39 2007 Route: Waiting for TUN/TAP interface to come up...
Tue Aug 07 13:39:40 2007 TEST ROUTES: 0/0 succeeded len=-1 ret=0 a=0 u/d=down
Tue Aug 07 13:39:40 2007 Route: Waiting for TUN/TAP interface to come up...
Tue Aug 07 13:39:41 2007 TEST ROUTES: 0/0 succeeded len=-1 ret=0 a=0 u/d=down
Tue Aug 07 13:39:41 2007 Route: Waiting for TUN/TAP interface to come up...
Tue Aug 07 13:39:42 2007 TEST ROUTES: 0/0 succeeded len=-1 ret=0 a=0 u/d=down
Tue Aug 07 13:39:42 2007 Route: Waiting for TUN/TAP interface to come up...
Tue Aug 07 13:39:43 2007 TEST ROUTES: 0/0 succeeded len=-1 ret=0 a=0 u/d=down
Tue Aug 07 13:39:43 2007 Route: Waiting for TUN/TAP interface to come up...
Tue Aug 07 13:39:44 2007 TEST ROUTES: 0/0 succeeded len=-1 ret=0 a=0 u/d=down
Tue Aug 07 13:39:44 2007 Route: Waiting for TUN/TAP interface to come up...
Tue Aug 07 13:39:45 2007 TEST ROUTES: 0/0 succeeded len=-1 ret=0 a=0 u/d=down
Tue Aug 07 13:39:45 2007 Route: Waiting for TUN/TAP interface to come up...
Tue Aug 07 13:39:46 2007 TEST ROUTES: 0/0 succeeded len=-1 ret=0 a=0 u/d=down
Tue Aug 07 13:39:46 2007 Route: Waiting for TUN/TAP interface to come up...
Tue Aug 07 13:39:47 2007 TEST ROUTES: 0/0 succeeded len=-1 ret=0 a=0 u/d=down
Tue Aug 07 13:39:47 2007 Route: Waiting for TUN/TAP interface to come up...
Tue Aug 07 13:39:48 2007 TEST ROUTES: 0/0 succeeded len=-1 ret=0 a=0 u/d=down
Tue Aug 07 13:39:48 2007 Route: Waiting for TUN/TAP interface to come up...
Tue Aug 07 13:39:49 2007 TEST ROUTES: 0/0 succeeded len=-1 ret=0 a=0 u/d=down
Tue Aug 07 13:39:49 2007 Route: Waiting for TUN/TAP interface to come up...
Tue Aug 07 13:39:50 2007 TEST ROUTES: 0/0 succeeded len=-1 ret=0 a=0 u/d=down
Tue Aug 07 13:39:50 2007 Route: Waiting for TUN/TAP interface to come up...
Tue Aug 07 13:39:50 2007 TEST ROUTES: 0/0 succeeded len=-1 ret=0 a=0 u/d=down
Tue Aug 07 13:39:50 2007 Route: Waiting for TUN/TAP interface to come up...
Tue Aug 07 13:39:52 2007 TEST ROUTES: 0/0 succeeded len=-1 ret=0 a=0 u/d=down
Tue Aug 07 13:39:52 2007 Route: Waiting for TUN/TAP interface to come up...
Tue Aug 07 13:39:53 2007 TEST ROUTES: 0/0 succeeded len=-1 ret=0 a=0 u/d=down
Tue Aug 07 13:39:53 2007 Route: Waiting for TUN/TAP interface to come up...
Tue Aug 07 13:39:54 2007 TEST ROUTES: 0/0 succeeded len=-1 ret=0 a=0 u/d=down
Tue Aug 07 13:39:54 2007 Route: Waiting for TUN/TAP interface to come up...
Tue Aug 07 13:39:55 2007 TEST ROUTES: 0/0 succeeded len=-1 ret=0 a=0 u/d=down
Tue Aug 07 13:39:55 2007 Route: Waiting for TUN/TAP interface to come up...
Tue Aug 07 13:39:56 2007 TEST ROUTES: 0/0 succeeded len=-1 ret=0 a=0 u/d=down
Tue Aug 07 13:39:56 2007 Route: Waiting for TUN/TAP interface to come up...
Tue Aug 07 13:39:57 2007 TEST ROUTES: 0/0 succeeded len=-1 ret=0 a=0 u/d=down
Tue Aug 07 13:39:57 2007 Route: Waiting for TUN/TAP interface to come up...
Tue Aug 07 13:39:58 2007 TEST ROUTES: 0/0 succeeded len=-1 ret=0 a=0 u/d=down
Tue Aug 07 13:39:58 2007 Route: Waiting for TUN/TAP interface to come up...
Tue Aug 07 13:40:00 2007 TEST ROUTES: 0/0 succeeded len=-1 ret=0 a=0 u/d=down
Tue Aug 07 13:40:00 2007 Initialization Sequence Completed With Errors ( see http://openvpn.net/faq.html#dhcpclientserv )
Tue Aug 07 13:42:18 2007 read UDPv4: Connection reset by peer (WSAECONNRESET) (code=10054)
Tue Aug 07 13:42:19 2007 read UDPv4: Connection reset by peer (WSAECONNRESET) (code=10054)
Tue Aug 07 13:42:19 2007 read UDPv4: Connection reset by peer (WSAECONNRESET) (code=10054)
Tue Aug 07 13:42:20 2007 read UDPv4: Connection reset by peer (WSAECONNRESET) (code=10054)
Tue Aug 07 13:42:21 2007 read UDPv4: Connection reset by peer (WSAECONNRESET) (code=10054)
Tue Aug 07 13:42:22 2007 read UDPv4: Connection reset by peer (WSAECONNRESET) (code=10054)</code></pre></div><p>/etc/server.ovpn (I&#039;ve tried theis with tap0, same thing)</p><div class="codebox"><pre><code># Which TCP/UDP port should OpenVPN listen on?
port 1194

# TCP or UDP server?
proto udp

# &quot;dev tap&quot; will create an ethernet tunnel.
# try tap0 if tap isn&#039;t working
dev tap

# The keepalive directive causes ping-like
# messages to be sent back and forth over
# the link so that each side knows when
# the other side has gone down.
# Ping every 10 seconds, assume that remote
# peer is down if no ping received during
# a 120 second time period.
keepalive 10 120

# Enable compression on the VPN link.
# If you enable it here, you must also
# enable it in the client config file.
;comp-lzo

# The persist options will try to avoid
# accessing certain resources on restart
# that may no longer be accessible because
# of the privilege downgrade.
;persist-key
;persist-tun

# Output a short status file showing
# current connections, truncated
# and rewritten every minute.
status openvpn-status.log

# Set the appropriate level of log
# file verbosity.
#
# 0 is silent, except for fatal errors
# 4 is reasonable for general usage
# 5 and 6 can help to debug connection problems
# 9 is extremely verbose
verb 3

# Silence repeating messages.  At most 20
# sequential messages of the same message
# category will be output to the log.
;mute 20

#Static Key
secret /etc/secret.key</code></pre></div><p>/etc/firewall.user</p><div class="codebox"><pre><code>#!/bin/sh
# Copyright (C) 2006 OpenWrt.org

iptables -F input_rule
iptables -F output_rule
iptables -F forwarding_rule
iptables -t nat -F prerouting_rule
iptables -t nat -F postrouting_rule

# The following chains are for traffic directed at the IP of the
# WAN interface

iptables -F input_wan
iptables -F forwarding_wan
iptables -t nat -F prerouting_wan

### Open port to WAN
## -- This allows port 22 to be answered by (dropbear on) the router
iptables -t nat -A prerouting_wan -p tcp --dport 22 -j ACCEPT
iptables        -A input_wan      -p tcp --dport 22 -j ACCEPT

### Port forwarding
## -- This forwards port 8080 on the WAN to port 80 on 192.168.1.2
# iptables -t nat -A prerouting_wan -p tcp --dport 8080 -j DNAT --to 192.168.1.2
# iptables        -A forwarding_wan -p tcp --dport 80 -d 192.168.1.2 -j ACCEPT

### DMZ
## -- Connections to ports not handled above will be forwarded to 192.168.1.2
# iptables -t nat -A prerouting_wan -j DNAT --to 192.168.1.2
# iptables        -A forwarding_wan -d 192.168.1.2 -j ACCEPT

### OpenVPN
## allow connections from outside
iptables -t nat -A prerouting_wan -p udp --dport 1194 -j ACCEPT
iptables        -A input_wan      -p udp --dport 1194 -j ACCEPT
## allow input/forwarding for the VPN interfaces, see http://openvpn.net/faq.htm
## also needs ip_forward, see http://openvpn.net/faq.html#ip-forward and http://
iptables -A INPUT   -i tun+ -j ACCEPT
iptables -A FORWARD -i tun+ -j ACCEPT
iptables -A INPUT   -i tap+ -j ACCEPT
iptables -A FORWARD -i tap+ -j ACCEPT</code></pre></div><p>Client OpenVPN config:</p><div class="codebox"><pre><code>dev tap

proto udp

# The hostname/IP and port of the server.
# You can have multiple remote entries
# to load balance between the servers.
remote x.x.x.x 1194

# Keep trying indefinitely to resolve the
# host name of the OpenVPN server.  Very useful
# on machines which are not permanently connected
# to the internet such as laptops.
resolv-retry infinite

# Most clients don&#039;t need to bind to
# a specific local port number.
nobind

# Try to preserve some state across restarts.
;persist-key
;persist-tun

# Wireless networks often produce a lot
# of duplicate packets.  Set this flag
# to silence duplicate packet warnings.
mute-replay-warnings

# original: secret secret.key
secret key.txt

# Enable compression on the VPN link.
# Don&#039;t enable this unless it is also
# enabled in the server config file.
;comp-lzo

# Set log file verbosity.
verb 3

# Silence repeating messages
;mute 20</code></pre></div><p>I don&#039;t get an IP address initially and then get a bizzare one after all the messages. I&#039;ve verified that the DHCP client is on at the two clients I&#039;ve tested the VPN on and that windows firewall is off. I don&#039;t have a 3rd party firewall.&nbsp; Machine A is on a remote network that is open as far as VPN connections go (tested, good) and Machine B is on the internal network (same error messages after modifying the client for float and local IP).</p><p>I&#039;ve been searching all over the net and on this site but just can&#039;t find the answer to this issue.&nbsp; I&#039;m assuming that my router is failing to do something on connection, but I don&#039;t know what.&nbsp; Any ideas would be greatly appreciated.</p>											<p class="post-edited">(Last edited by <strong>kikazzi</strong> on 8 Aug 2007, 01:19)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p53577">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">kikazzi</div>
					<div class="post-datetime">
						8 Aug 2007, 17:22					</div>
				</div>
				<div class="post-content content">
					<p>Any thoughts on this?&nbsp; Basically my connection begins through the router (both respond to eachother), but then something fails - <br />Tue Aug 07 13:39:31 2007 TEST ROUTES: 0/0 succeeded len=-1 ret=0 a=0 u/d=down<br />Tue Aug 07 13:39:31 2007 Route: Waiting for TUN/TAP interface to come up...</p><p>OpenVPN says this is a DHCP issue, but I&#039;ve verified all the steps they&#039;ve suggested to get it working.&nbsp; Could OpenWRT not be pushing DHCP to the VPN connection?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p53644">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">OpenWrter</div>
					<div class="post-datetime">
						9 Aug 2007, 23:09					</div>
				</div>
				<div class="post-content content">
					<p>I would assume if you have two routers with DHCP up, than you have some sort of IP address conflict.&nbsp; Your logs look all in order when it hits this part:</p><p>Tue Aug 07 13:39:30 2007 Route: Waiting for TUN/TAP interface to come up...<br />Tue Aug 07 13:39:31 2007 TEST ROUTES: 0/0 succeeded len=-1 ret=0 a=0 u/d=down</p><p>I usually get:</p><p>Thu Aug 09 13:08:09 2007 Route: Waiting for TUN/TAP interface to come up...<br />Thu Aug 09 13:08:10 2007 TEST ROUTES: 2/2 succeeded len=2 ret=1 a=0 u/d=up<br />Thu Aug 09 13:08:10 2007 route ADD 192.168.153.0 MASK 255.255.255.0 10.10.153.17<br />Thu Aug 09 13:08:10 2007 Route addition via IPAPI succeeded<br />Thu Aug 09 13:08:10 2007 route ADD 10.10.153.1 MASK 255.255.255.255 10.10.153.17<br />Thu Aug 09 13:08:10 2007 Route addition via IPAPI succeeded<br />Thu Aug 09 13:08:10 2007 Initialization Sequence Completed</p><p>So, there may be something wrong with the communication between the two, possibly a server/client config error.&nbsp; I would try to setup both server/client on both servers, then try from both ends to establish a connection.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p53959">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">kikazzi</div>
					<div class="post-datetime">
						15 Aug 2007, 19:00					</div>
				</div>
				<div class="post-content content">
					<p>I don&#039;t have 2 routers with DHCP up, AFAIK. I think for some reason OpenVPN on my router is not doing something it needs to be doing.&nbsp; Could you post your server config and your client config?&nbsp; I feel like I am missing something that will push an IP address to my client <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> </p><p>I&#039;ve been working on this for the last week, trying new configurations, starting from scratch, etc.&nbsp; Any help would be appreciated.&nbsp; Also, I am not using the --server parameter in my OpenWRT openvpn.&nbsp; Is that correct?</p><p>Also, could you post your server log for the connection?&nbsp; Mine goes this far -<br /><em>Wed Aug 15 10:01:40 2007 Peer Connection Initiated with x.x.x.x:1947<br />Wed Aug 15 10:01:42 2007 Initialization Sequence Completed</em><br />Is that normal?</p>											<p class="post-edited">(Last edited by <strong>kikazzi</strong> on 15 Aug 2007, 19:03)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p53960">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">kikazzi</div>
					<div class="post-datetime">
						15 Aug 2007, 19:07					</div>
				</div>
				<div class="post-content content">
					<p>The thing I really don&#039;t understand is why this doesn&#039;t work from within my OpenWRT network.&nbsp; As I said, I have a machine directly plugged into the router (192.168.1.10 ip) and have it try a direct, in network connection to OpenVPN (at 192.168.1.1).&nbsp; It gets the exact same problem with the connection - same server log, same <br /><em>Route: Waiting for TUN/TAP interface to come up...<br />TEST ROUTES: 0/0 succeeded len=-1 ret=0 a=0 u/d=down</em></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p53974">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">OpenWrter</div>
					<div class="post-datetime">
						15 Aug 2007, 23:38					</div>
				</div>
				<div class="post-content content">
					<p>It could also be that they are on the same subnet.&nbsp; 192.168.1.xx going to the 192.168.1.xx network may be causing the problem.&nbsp; Try setting one of them to the 192.168.2.xx subnet.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p54066">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">sorenstoutner</div>
					<div class="post-datetime">
						17 Aug 2007, 08:17					</div>
				</div>
				<div class="post-content content">
					<p>kikazzi,</p><p>In /etc/server.opvn, change &quot;dev tap&quot; to &quot;dev tap0&quot;.&nbsp; When it is set as &quot;dev tap&quot; it creates a new tap that is one higher than the tap created by the script and bridged with br0.&nbsp; I&#039;ve also updated the wiki at <a href="http://wiki.openwrt.org/OpenVPNHowTo">http://wiki.openwrt.org/OpenVPNHowTo</a> with an explanation.</p>											<p class="post-edited">(Last edited by <strong>sorenstoutner</strong> on 17 Aug 2007, 08:18)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p54105">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">kikazzi</div>
					<div class="post-datetime">
						17 Aug 2007, 19:42					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>sorenstoutner wrote:</cite><blockquote><p>kikazzi,</p><p>In /etc/server.opvn, change &quot;dev tap&quot; to &quot;dev tap0&quot;.&nbsp; When it is set as &quot;dev tap&quot; it creates a new tap that is one higher than the tap created by the script and bridged with br0.&nbsp; I&#039;ve also updated the wiki at <a href="http://wiki.openwrt.org/OpenVPNHowTo">http://wiki.openwrt.org/OpenVPNHowTo</a> with an explanation.</p></blockquote></div><p>Ok, I tried this, with server as TAP0, client as TAP0, and both as TAP0.&nbsp; There was no change.&nbsp; I&#039;m wondering if my server is failing to do something, because on 3 different computers with 3 different builds on 2 different networks, I get the exact same error.&nbsp; <br />I read somewhere that the server log should note that it is assigning an IP address.&nbsp; Here is my log with the verbosity cranked up a bit (server):</p><p><strong><br />Fri Aug 17 10:39:00 2007 us=25119 TUN/TAP device tap0 opened<br />Fri Aug 17 10:39:00 2007 us=29012 TUN/TAP TX queue length set to 100<br />Fri Aug 17 10:39:00 2007 us=33659 Data Channel MTU parms [ L:1576 D:1450 EF:44 EB:4 ET:32 EL:0 ]<br />Fri Aug 17 10:39:00 2007 us=37562 Local Options String: &#039;V4,dev-type tap,link-mtu 1576,tun-mtu 1532,proto UDPv4,cipher BF-CBC,auth SHA1,keysize 128,secret&#039;<br />Fri Aug 17 10:39:00 2007 us=40872 Expected Remote Options String: &#039;V4,dev-type tap,link-mtu 1576,tun-mtu 1532,proto UDPv4,cipher BF-CBC,auth SHA1,keysize 128,secret&#039;<br />Fri Aug 17 10:39:00 2007 us=52843 Local Options hash (VER=V4): &#039;8b888ddc&#039;<br />Fri Aug 17 10:39:00 2007 us=56950 Expected Remote Options hash (VER=V4): &#039;8b888ddc&#039;<br />Fri Aug 17 10:39:00 2007 us=60559 Socket Buffers: R=[32767-&gt;65534] S=[32767-&gt;65534]<br />Fri Aug 17 10:39:00 2007 us=64276 UDPv4 link local (bound): [undef]:1194<br />Fri Aug 17 10:39:00 2007 us=68285 UDPv4 link remote: [undef]<br />Fri Aug 17 10:39:12 2007 us=150018 UDPv4 READ [60] from 64.90.196.88:3671:&nbsp; DATA len=60<br />Fri Aug 17 10:39:12 2007 us=155234 Peer Connection Initiated with 64.90.196.88:3671<br />Fri Aug 17 10:39:12 2007 us=159011 Initialization Sequence Completed<br />Fri Aug 17 10:39:12 2007 us=163525 UDPv4 WRITE [156] to 64.90.196.88:3671:&nbsp; DATA len=156<br />Fri Aug 17 10:39:12 2007 us=167771 UDPv4 READ [380] from 64.90.196.88:3671:&nbsp; DATA len=380<br />Fri Aug 17 10:39:12 2007 us=172713 UDPv4 READ [380] from 64.90.196.88:3671:&nbsp; DATA len=380<br />Fri Aug 17 10:39:16 2007 us=782956 UDPv4 READ [380] from 64.90.196.88:3671:&nbsp; DATA len=380<br /></strong><br />and so on, back and forth with the read/writes<br />no mention of an IP address assignment, even though the client is set for DHCP.&nbsp; Is this how my server output should look?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p54110">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">sorenstoutner</div>
					<div class="post-datetime">
						17 Aug 2007, 22:00					</div>
				</div>
				<div class="post-content content">
					<p>Did you create the script file /etc/openvpnbridge?</p><p>#!/bin/sh</p><p>#/etc/openvpnbridge<br /># OpenVPN Bridge Config File<br /># Creates TAP devices for use by OpenVPN and bridges them into OpenWRT Bridge<br /># Taken from <a href="http://openvpn.net/bridge.html">http://openvpn.net/bridge.html</a></p><p># Define Bridge Interface<br /># Preexisting on OpenWRT<br />br=&quot;br0&quot;</p><p># Define list of TAP interfaces to be bridged,<br /># for example tap=&quot;tap0 tap1 tap2&quot;.<br />tap=&quot;tap0&quot;</p><br /><p>case &quot;$1&quot; in<br />&nbsp; &nbsp; &nbsp; &nbsp; up)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # Make sure module is loaded<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; insmod tun</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # Build tap devices<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for t in $tap; do<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; openvpn --mktun --dev $t<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; done</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # Add TAP interfaces to OpenWRT bridge</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for t in $tap; do<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; brctl addif $br $t<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; done</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #Configure bridged interfaces</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for t in $tap; do<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ifconfig $t 0.0.0.0 promisc up<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; done<br />&nbsp; &nbsp; &nbsp; &nbsp; ;;<br />&nbsp; &nbsp; &nbsp; &nbsp; down)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for t in $tap; do<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ifconfig $t 0.0.0.0 down<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; done</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for t in $tap; do<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; brctl delif $br $t<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; done</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for t in $tap; do<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; openvpn --rmtun --dev $t<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; done</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rmmod tun<br />&nbsp; &nbsp; &nbsp; &nbsp; ;;<br />&nbsp; &nbsp; &nbsp; &nbsp; *)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo &quot;$0 {up|down}&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; ;;<br />esac</p><br /><p>You need to make it executable and then create a startup script to call it.&nbsp; This adds tap0 to br0.&nbsp; Your DHCP server be default will offer addresses to anything on br0.&nbsp; I did this setup last night and had a lot of problems until I figured out that my script was bridging tap0 to br0 and then my server.ovpn was creating a new tap (tap1) that wasn&#039;t bridged.&nbsp; That&#039;s why changing the device in server.ovpn to tap0 is important.</p><p>There are further instructions on the wiki at <a href="http://wiki.openwrt.org/OpenVPNHowTo">http://wiki.openwrt.org/OpenVPNHowTo</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p54127">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">kikazzi</div>
					<div class="post-datetime">
						18 Aug 2007, 00:44					</div>
				</div>
				<div class="post-content content">
					<p>That was it!&nbsp; I forgot to make my openvpnbridge file an executable!&nbsp; I am such a moron &gt;&lt;&nbsp; Thank you so much, I&#039;m up and getting an IP address now!</p><p>My question now is, is there a way to route a specific port range of traffic over the VPN?&nbsp; For example, I would like to route all World of Warcraft port traffic over the VPN &gt;.&gt;&nbsp; Is there a way to do this besides the full gateway-redirect?</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>