<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> TP-Link TL-WR841N(D) Extended Build [v3,v5,v7,v8,v9]</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 30 Mar 2018 and 27 Apr 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 5</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=54604&amp;p=2.html">2</a></li><li><a href="viewtopic.php%3Fid=54604&amp;p=3.html">3</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=54604&amp;p=5.html">5</a></li></ul></nav></div>
			
		
		
			<article class="post" id="p257862">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">amq</div>
					<div class="post-datetime">
						16 Dec 2014, 11:42					</div>
				</div>
				<div class="post-content content">
					<p><a href="http://i.imgur.com/ykEmXWC.png"><span class="postimg"><img src="http://i.imgur.com/TIl4ExN.png" alt="http://i.imgur.com/TIl4ExN.png" /></span></a></p><p>Decided to share a custom build I&#039;ve created for my own use:<br /></p><ul><li><p>Chaos Calmer</p></li><li><p>LuCI with IPv6</p></li><li><p>MiniUPnP</p></li><li><p>OpenVPN with mbed TLS</p></li><li><p>DNSCrypt</p></li><li><p>ipset-dns</p></li><li><p>Reghack (WiFi channels 12 and 13)</p></li><li><p>Minified LuCI&#039;s CSS and JS</p></li><li><p>Removed kernel debugging and USB support</p></li><li><p>Nothing else has been touched. Basically, it is a &#039;make defconfig&#039; + profile + the mentioned above.</p></li><li><p>Free ROM: 150 KB</p></li><li><p>Total available RAM: 15000 KB</p></li><li><p>OpenVPN BF-CBC speed: 12Mbs/12Mbs (measured on v8 downloading ubuntu via torrent)</p></li></ul><p><strong>Download firmware:</strong><br /><a href="https://www.dropbox.com/sh/kcg47suzd5duh9z/AABB8DrehpQPBG8iwjJTP_ICa?dl=0">dropbox</a></p><p><strong>Build script:</strong><br /><a href="https://gist.github.com/amq/71a7c1ab521fb3c2aca6">https://gist.github.com/amq/71a7c1ab521fb3c2aca6</a><br />Kudos to <a href="https://forum.openwrt.org/viewtopic.php?pid=225772#p225772">Aegisu</a></p><p><strong>Supported devices:</strong><br />tl-wr841nd-v3<br />tl-wr841nd-v5<br />tl-wr841nd-v7<br />tl-wr841n-v8<br />tl-wr841n-v9<br />tl-wr847n-v8</p><p><strong>Changelog:</strong></p><p><span class="bbu">2015-09-13</span><br />- Chaos Calmer 15.05 (r46849)<br />- Removed QoS<br />- Added dnscrypt-proxy<br />- Added ipset-dns<br />- Added luci-app-openvpn</p><p><span class="bbu">2015-04-21</span><br />- r45545<br />- Added QoS<br />- Added Reghack<br />- Removed kernel debugging and USB support</p><p><span class="bbu">2015-01-22</span><br />- r44077<br />- Included patch for PolarSSL CVE-2015-1182</p><p><span class="bbu">2014-12-19</span><br />- r43751<br />- Compiled with GCC 4.9</p><p><span class="bbu">2014-12-16</span><br />- r43720<br />- Initial release</p><p><strong>How to achieve the same build with the &#039;menu makeconfig&#039; interface</strong></p><div class="codebox"><pre><code>1. rm .config .config.old
2. make defconfig
3. make menuconfig
(use space to select, make sure you see a star after a selection, not an M; use esc to go back)

_Target Profile - TP-LINK TL-WR841N/ND

Enable:
_LuCI - Collections - luci
_LuCI - Applications - luci-app-upnp
_LuCI - Applications - luci-app-openvpn
_Network - VPN - openvpn-polarssl
_Network - ipset-dns
_Network - IP addresses and Names - dnscrypt-proxy

Disable:
_Global build settings - Enable support for printk, Crash logging, Support for paging of anonymous memory (swap), Compile the kernel with symbol tables information, Compile the kernel with debug information, Compile the kernel with SysRq support, Enable printk timestamps
_Advanced configuration options (for developers) - Toolchain options - GCC compiler Version - gcc 4.9
_Kernel modules - USB Support - everything</code></pre></div><p>OpenVPN setup guides:<br /><a href="https://blog.ipredator.se/howto/openwrt/configuring-openvpn-on-openwrt.html">https://blog.ipredator.se/howto/openwrt … enwrt.html</a><br /><a href="https://www.robertkehoe.com/2015/08/setup-openvpn-using-openwrt/">https://www.robertkehoe.com/2015/08/set … g-openwrt/</a></p>											<p class="post-edited">(Last edited by <strong>amq</strong> on 4 Dec 2016, 18:33)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p258129">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">amq</div>
					<div class="post-datetime">
						19 Dec 2014, 13:11					</div>
				</div>
				<div class="post-content content">
					<p>Recompiled with GCC 4.9.2 compared to 4.8.2 in the initial release, this should fix a bunch of regressions.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p262076">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">amq</div>
					<div class="post-datetime">
						19 Jan 2015, 23:01					</div>
				</div>
				<div class="post-content content">
					<p>Just an update on stability: I currently have 20d uptime and counting on my v8, while openvpn and torrents are always on. Haven&#039;t experienced any wifi dropouts either (n mode).</p>											<p class="post-edited">(Last edited by <strong>amq</strong> on 22 Jan 2015, 14:18)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p262458">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">amq</div>
					<div class="post-datetime">
						22 Jan 2015, 15:27					</div>
				</div>
				<div class="post-content content">
					<p>2015-01-22<br />- r44077<br />- Includes patch for PolarSSL CVE-2015-1182</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p262718">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">julianocs</div>
					<div class="post-datetime">
						25 Jan 2015, 00:46					</div>
				</div>
				<div class="post-content content">
					<p>Hi amq.</p><p>First, thanks for your release...<br />A feedback...</p><p>The release TP-Link TL-WR841N - CC - r43751 was very unstable to me. A lot of drops.<br />My config is: 1 main router (running Gargoyle) + 6 routers in WDS mode.</p><p>This last release is working great...</p><p>Juliano</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p264438">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">OpenEverything</div>
					<div class="post-datetime">
						7 Feb 2015, 01:49					</div>
				</div>
				<div class="post-content content">
					<p>Hey, I am new here, and new to Openwrt in general, and just wanted to say thank you very much for uploading this. Everything is working great after updating to your build on my wr841n v9. This is exactly what I was looking for, a working build with openvpn. I just have a couple questions. After installing this and logging into Luci it says I&#039;m running&nbsp; OpenWrt Chaos Calmer r44077 / LuCI Master (git-15.022.39965-4b2d2e3) . Is that the latest/greatest version of Luci for this router? Is it possible to configure OpenVPN through Luci or do I need to do that via the terminal? Please forgive my ignorance, I understand this site is run mostly by vulenteers.</p><p>Also, prior to finding this build, I was using someone else&#039;s firmware that I downloaded via a plain http connection, and no md5sum was available. I knew that was a bad idea, but I just really needed my router to work at the time. Should I reinstall all of the packages to make sue that no malicious code is present on my system? Or would the sysupgrade have taken care of that already?</p><p>After configuring the opkg sources correctly, I was finally able to run opkg update successfully. Is there a way to verify all of the packages on the system through opkg, like running &quot;apt-get check&quot; on a debian system?</p><p>Thanks again. Good work.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p264525">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">amq</div>
					<div class="post-datetime">
						7 Feb 2015, 18:12					</div>
				</div>
				<div class="post-content content">
					<p>OpenEverything, when I build my firmware I always clone <a href="https://github.com/openwrt-mirror/openwrt,">https://github.com/openwrt-mirror/openwrt,</a> ensuring that every package including Luci is the newest possible version. You can configure most of the stuff in Luci, but for example OpenVPN has to be configured manually (/etc/config/openvpn).</p><p>sysupgrade is everything you need, especially if you have chosen not to save the old configuration (if you did you don&#039;t have to reflash, you can simply reset to defaults).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p264730">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">OpenEverything</div>
					<div class="post-datetime">
						9 Feb 2015, 02:29					</div>
				</div>
				<div class="post-content content">
					<p>Thank you very much for the answer. I will do a reset just to be safe than. I may try building it myself once I feel more confident doing so. Currently this is the only router I have that will run OpenWRT and I do not want to accidentally brick it.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p265614">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">pl3x</div>
					<div class="post-datetime">
						15 Feb 2015, 14:48					</div>
				</div>
				<div class="post-content content">
					<p>Hi amq, I&#039;ve been using your builds for a while and they work great!</p><p>I have a problem though, I&#039;m trying to install luci-qos and since your last build is a bit old I&#039;m not able to (shows a error about kernel version).</p><p>I&#039;ve tried building myself using your script but I can&#039;t manage it to work, could you please make an updated build so that I can install luci-qos? (or maybe add that module yourself if you could)</p><p>Thanks!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p265651">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">amq</div>
					<div class="post-datetime">
						15 Feb 2015, 19:59					</div>
				</div>
				<div class="post-content content">
					<p>pl3x, okay, I will include QoS in the next build (in about a week).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p265773">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">DrLastContaQt</div>
					<div class="post-datetime">
						16 Feb 2015, 17:19					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m using TL-WR841N v9 as a WiFi repeater. My main router is TL-WR3600. Every day, when I&#039;m playing PS3 (LAN via TL-WR841N v9) WiFi on repeater goes down, and I have to reset device. Is anyone using TL-WR841N v9 as a bridged WiFi repeater with any success? Unfortunately I can&#039;t connect main router and repeater via LAN cable.</p><p>I have Gargoyle 1.7 on repeater and 1.6 on main router.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p266250">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">amq</div>
					<div class="post-datetime">
						20 Feb 2015, 12:53					</div>
				</div>
				<div class="post-content content">
					<p>Regarding QoS, there is not enough space. I don&#039;t think it&#039;s worth messing arround with library striping or cutting out stuff from the profile.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p266266">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">DrLastContaQt</div>
					<div class="post-datetime">
						20 Feb 2015, 14:15					</div>
				</div>
				<div class="post-content content">
					<p>OK, so I use your build on my TL-WR841n v9 and it work great. I establish relayd wifi bridge with my main router 4 days ago, and since than I have played PS3 twice and WiFi never goes down.</p><p>Could you include relayd in your next release, cause opkg update lists are not working?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p266335">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">amq</div>
					<div class="post-datetime">
						20 Feb 2015, 23:53					</div>
				</div>
				<div class="post-content content">
					<p>To make OPKG work change the configuration to:</p><div class="codebox"><pre><code>dest root /
dest ram /tmp
lists_dir ext /var/opkg-lists
option overlay_root /overlay
src/gz chaos_calmer_base http://downloads.openwrt.org/snapshots/trunk/ar71xx/generic/packages/base
src/gz chaos_calmer_luci http://downloads.openwrt.org/snapshots/trunk/ar71xx/generic/packages/luci
src/gz chaos_calmer_management http://downloads.openwrt.org/snapshots/trunk/ar71xx/generic/packages/management
src/gz chaos_calmer_packages http://downloads.openwrt.org/snapshots/trunk/ar71xx/generic/packages/packages
src/gz chaos_calmer_routing http://downloads.openwrt.org/snapshots/trunk/ar71xx/generic/packages/routing
src/gz chaos_calmer_telephony http://downloads.openwrt.org/snapshots/trunk/ar71xx/generic/packages/telephony</code></pre></div>											<p class="post-edited">(Last edited by <strong>amq</strong> on 20 Feb 2015, 23:53)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p266599">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">DrLastContaQt</div>
					<div class="post-datetime">
						23 Feb 2015, 10:37					</div>
				</div>
				<div class="post-content content">
					<p>I will make this changes. Thanks for advice.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p267609">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">pl3x</div>
					<div class="post-datetime">
						4 Mar 2015, 15:19					</div>
				</div>
				<div class="post-content content">
					<p>Any updates on next release?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p267640">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">OpenEverything</div>
					<div class="post-datetime">
						4 Mar 2015, 19:11					</div>
				</div>
				<div class="post-content content">
					<p>I have a request... I don&#039;t know if this is possible, but a killer feature would be to include an NFS package so that we can network mount the router to a local network server, as a pseudo-memory upgrade. I think if that functionality was added, we could install whatever packages we wanted! Is that doable?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p267738">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">amq</div>
					<div class="post-datetime">
						5 Mar 2015, 13:41					</div>
				</div>
				<div class="post-content content">
					<p>The latest trunk r44597 has issues with OpenVPN and QoS (segfaults, see <a href="https://dev.openwrt.org/ticket/19102">https://dev.openwrt.org/ticket/19102</a> and <a href="https://dev.openwrt.org/ticket/19101">https://dev.openwrt.org/ticket/19101</a>), I will release a new build after they are fixed. The good news is that it will most probably include QoS.</p>											<p class="post-edited">(Last edited by <strong>amq</strong> on 5 Mar 2015, 14:56)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p269072">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">amq</div>
					<div class="post-datetime">
						18 Mar 2015, 00:43					</div>
				</div>
				<div class="post-content content">
					<p>OpenVPN is still broken in trunk.</p><p>My current release is proven stable and there have been no super-signifficant changes in trunk, so I won&#039;t hurry things up until we get a build which I would use myself.</p><p>BTW, I&#039;ve made over 8 builds in the meantime and each time reverted to the 44077.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p269485">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">savahu</div>
					<div class="post-datetime">
						21 Mar 2015, 16:12					</div>
				</div>
				<div class="post-content content">
					<p>Please add the restricted channels with reghack.<br /><a href="http://luci.subsignal.org/~jow/reghack/README.txt">http://luci.subsignal.org/~jow/reghack/README.txt</a></p><p>There is not enough space left to do it myself.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p273315">
				<div class="post-metadata">
					<div class="post-num">Post #21</div>
					<div class="post-author">amq</div>
					<div class="post-datetime">
						21 Apr 2015, 20:38					</div>
				</div>
				<div class="post-content content">
					<p>Here we go <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>2015-04-21<br />- r45545<br />- Added QoS<br />- Added Reghack<br />- Removed kernel debugging and USB support</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p273383">
				<div class="post-metadata">
					<div class="post-num">Post #22</div>
					<div class="post-author">marzese</div>
					<div class="post-datetime">
						22 Apr 2015, 11:39					</div>
				</div>
				<div class="post-content content">
					<p>Many thanks for your efforts amq - definitely the best release I have found for this router.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p274036">
				<div class="post-metadata">
					<div class="post-num">Post #23</div>
					<div class="post-author">marco_silva85</div>
					<div class="post-datetime">
						26 Apr 2015, 21:47					</div>
				</div>
				<div class="post-content content">
					<p>this image is really nice, also bittorrent started to work for me in this version <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>is it possible to add ppp-mod-pptp support?<br />in no ways I want to push it over you since this release is already awesome, but can you try at least to add it on the script so I can compile it myself? all my efforts have been fruitless (image exceeds size)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p274160">
				<div class="post-metadata">
					<div class="post-num">Post #24</div>
					<div class="post-author">amq</div>
					<div class="post-datetime">
						27 Apr 2015, 16:55					</div>
				</div>
				<div class="post-content content">
					<p>marco_silva85, PPTP has been compromised and even Microsoft (the author itself) suggests to move to L2TP, IKEv2, or SSTP<br /><a href="https://technet.microsoft.com/en-us/library/security/2743314">https://technet.microsoft.com/en-us/lib … ty/2743314</a></p><p>You can find the build script in the first post. You will have to install the packages as listed here: <a href="http://wiki.openwrt.org/doc/howto/buildroot.exigence.">http://wiki.openwrt.org/doc/howto/buildroot.exigence.</a> You will also need to additionally install default-jre-headless, java-wrappers, libjargs-java (on ubuntu) to use yuicompressor and closure-compiler.</p><p>Everyone: please do not be silent if you find some issue or want to include something that many others would appreciate <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p274163">
				<div class="post-metadata">
					<div class="post-num">Post #25</div>
					<div class="post-author">marco_silva85</div>
					<div class="post-datetime">
						27 Apr 2015, 17:07					</div>
				</div>
				<div class="post-content content">
					<p>amq is really nice that you have the concern for security but I know about it. I need PPTP because it&#039;s the vpn provided for me so I have no choice.<br />Do you think it will fit in the remaining 132kB?</p><p>btw I tried to install it (ppp-mod-pptp) using Software Management, but it says:<br /></p><div class="codebox"><pre><code>Collected errors:
 * satisfy_dependencies_for: Cannot satisfy the following dependencies for ppp-mod-pptp:
 *     kernel (= 3.18.11-1-317527fb328b694536ee00c07026c22c)
 *     kernel (= 3.18.11-1-317527fb328b694536ee00c07026c22c)
(...) it states this for 10 times total
 *     kernel (= 3.18.11-1-317527fb328b694536ee00c07026c22c)
 * 
 * opkg_install_cmd: Cannot install package ppp-mod-pptp.</code></pre></div><p>Thanks for the directions <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p>											<p class="post-edited">(Last edited by <strong>marco_silva85</strong> on 27 Apr 2015, 17:10)</p>
									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 1 of 5</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=54604&amp;p=2.html">2</a></li><li><a href="viewtopic.php%3Fid=54604&amp;p=3.html">3</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=54604&amp;p=5.html">5</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>