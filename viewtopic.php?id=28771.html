<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> USB disconnect problem</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 22 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p129206">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">fbauhaus</div>
					<div class="post-datetime">
						22 Feb 2011, 17:36					</div>
				</div>
				<div class="post-content content">
					<p>We got a couple of hundred alix6e1 boards running populated with Sierra Wireless MC8790 3G modems. Recently some of the devices begin to show an odd behavior. After some uptime (usually a couple of days sometimes only hours) the kernel reports that the modem has been disconnected and then reconnected which wouldn&#039;t be a problem but after the reconnect the ttyUSB4 line first becomes ttyUSB4 again then gets disconnected again and becomes ttyUSB7.</p><p>The systems are running a custom build OpenWRT (based on Kamikaze r15916, which was recent when we began development and which we can&#039;t easily change) with a 2.6.28.10 linux kernel (with sierra driver v.1.7.8 instead the 1.3.2 coming with r15916) with only ohci (we had to disable ehci because of a hardware bug in the CS5536 on the mainboard).</p><p>I have found a lots of problems with 3g usb/pcie modules but none seemed to match my exact problem. Has anyone experienced something similar with either this or another pci-e 3G modem?</p><p>Unfortunately this problem occurs on none of your systems we got in the labs only on systems out in the field. So when I face the problem I don&#039;t got a lot of time to try around since I have to bring the device back online asap.</p><br /><p>Kind regards,<br />Florian</p><br /><div class="codebox"><pre><code>Feb 15 04:07:18 alix6e user.info kernel: usb 1-2: USB disconnect, address 2
Feb 15 04:07:18 alix6e user.err kernel: sierra ttyUSB4: resubmit read urb failed.(-19)
Feb 15 04:07:18 alix6e user.info kernel: sierra ttyUSB0: Sierra USB modem converter now disconnected from ttyUSB0
Feb 15 04:07:18 alix6e user.info kernel: sierra 1-2:1.0: device disconnected
Feb 15 04:07:18 alix6e user.info kernel: sierra ttyUSB1: Sierra USB modem converter now disconnected from ttyUSB1
Feb 15 04:07:18 alix6e user.info kernel: sierra 1-2:1.1: device disconnected
Feb 15 04:07:18 alix6e user.info kernel: sierra ttyUSB2: Sierra USB modem converter now disconnected from ttyUSB2
Feb 15 04:07:18 alix6e user.info kernel: sierra 1-2:1.2: device disconnected
Feb 15 04:07:18 alix6e user.info kernel: sierra ttyUSB3: Sierra USB modem converter now disconnected from ttyUSB3
Feb 15 04:07:18 alix6e user.info kernel: sierra 1-2:1.3: device disconnected
Feb 15 04:07:18 alix6e user.info kernel: sierra 1-2:1.4: device disconnected
Feb 15 04:07:18 alix6e user.info kernel: sierra ttyUSB5: Sierra USB modem converter now disconnected from ttyUSB5
Feb 15 04:07:18 alix6e daemon.info pppd[29390]: Hangup (SIGHUP)
Feb 15 04:07:18 alix6e user.info kernel: sierra 1-2:1.5: device disconnected
Feb 15 04:07:18 alix6e user.info kernel: sierra ttyUSB6: Sierra USB modem converter now disconnected from ttyUSB6
Feb 15 04:07:18 alix6e user.info kernel: sierra 1-2:1.6: device disconnected
Feb 15 04:07:18 alix6e daemon.notice pppd[29390]: Modem hangup
Feb 15 04:07:18 alix6e daemon.info pppd[29390]: Connect time 4856.3 minutes.
Feb 15 04:07:18 alix6e daemon.info pppd[29390]: Sent 1146338 bytes, received 762787 bytes.
Feb 15 04:07:18 alix6e daemon.debug pppd[29390]: Script /etc/ppp/ip-down started (pid 22776)
Feb 15 04:07:18 alix6e daemon.notice pppd[29390]: Connection terminated.
Feb 15 04:07:19 alix6e daemon.debug pppd[29390]: Script /etc/ppp/ip-down finished (pid 22776), status = 0x1
Feb 15 04:07:23 alix6e user.info kernel: usb 1-2: new full speed USB device using ohci_hcd and address 3
Feb 15 04:07:24 alix6e user.info kernel: usb 1-2: configuration #1 chosen from 1 choice
Feb 15 04:07:24 alix6e user.info kernel: sierra 1-2:1.0: Sierra USB modem converter detected
Feb 15 04:07:24 alix6e user.info kernel: usb 1-2: Sierra USB modem converter now attached to ttyUSB0
Feb 15 04:07:24 alix6e user.info kernel: sierra 1-2:1.1: Sierra USB modem converter detected
Feb 15 04:07:24 alix6e user.info kernel: usb 1-2: Sierra USB modem converter now attached to ttyUSB1
Feb 15 04:07:24 alix6e user.info kernel: sierra 1-2:1.2: Sierra USB modem converter detected
Feb 15 04:07:24 alix6e user.info kernel: usb 1-2: Sierra USB modem converter now attached to ttyUSB2
Feb 15 04:07:24 alix6e user.info kernel: sierra 1-2:1.3: Sierra USB modem converter detected
Feb 15 04:07:24 alix6e user.info kernel: usb 1-2: Sierra USB modem converter now attached to ttyUSB3
Feb 15 04:07:24 alix6e user.info kernel: sierra 1-2:1.4: Sierra USB modem converter detected
Feb 15 04:07:24 alix6e user.info kernel: usb 1-2: Sierra USB modem converter now attached to ttyUSB5
Feb 15 04:07:24 alix6e user.info kernel: sierra 1-2:1.5: Sierra USB modem converter detected
Feb 15 04:07:24 alix6e user.info kernel: usb 1-2: Sierra USB modem converter now attached to ttyUSB6
Feb 15 04:07:24 alix6e user.info kernel: sierra 1-2:1.6: Sierra USB modem converter detected
Feb 15 04:07:24 alix6e user.info kernel: usb 1-2: Sierra USB modem converter now attached to ttyUSB7
Feb 15 04:07:25 alix6e daemon.info pppd[29390]: Starting link
Feb 15 04:07:26 alix6e daemon.err pppd[29390]: tcgetattr: No such device or address (line 916)
Feb 15 04:07:27 alix6e daemon.warn pppd[29390]: tcsetattr: No such device or address (line 1010)
Feb 15 04:07:27 alix6e daemon.info pppd[29390]: Exit.
Feb 15 04:07:27 alix6e user.info kernel: sierra ttyUSB4: Sierra USB modem converter now disconnected from ttyUSB4
Feb 15 04:10:20 alix6e daemon.notice pppd[23065]: pppd 2.4.3 started by root, uid 0
Feb 15 04:10:20 alix6e daemon.info pppd[23065]: Using interface ppp0
Feb 15 04:10:21 alix6e daemon.notice pppd[23065]: local  IP address 10.64.64.64
Feb 15 04:10:21 alix6e daemon.notice pppd[23065]: remote IP address 10.112.112.112
Feb 15 04:10:23 alix6e daemon.info pppd[23065]: Starting link
Feb 15 04:10:23 alix6e daemon.err pppd[23065]: Failed to open /dev/ttyUSB4: No such device
Feb 15 04:20:02 alix6e daemon.info pppd[23065]: Starting link
Feb 15 04:20:03 alix6e daemon.err pppd[23065]: Failed to open /dev/ttyUSB4: No such device
Feb 15 04:20:07 alix6e daemon.info pppd[23065]: Starting link
Feb 15 04:20:08 alix6e daemon.err pppd[23065]: Failed to open /dev/ttyUSB4: No such device
Feb 15 04:20:28 alix6e daemon.info pppd[23065]: Starting link
Feb 15 04:20:28 alix6e daemon.err pppd[23065]: Failed to open /dev/ttyUSB4: No such device
Feb 15 04:20:32 alix6e daemon.info pppd[23065]: Starting link
Feb 15 04:20:32 alix6e daemon.err pppd[23065]: Failed to open /dev/ttyUSB4: No such device
Feb 15 04:20:45 alix6e daemon.info pppd[23065]: Terminating on signal 15
Feb 15 04:20:45 alix6e daemon.info pppd[23065]: Exit.</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p129378">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">fbauhaus</div>
					<div class="post-datetime">
						24 Feb 2011, 15:55					</div>
				</div>
				<div class="post-content content">
					<p>Actually here is what sierra wireless says about the problem:</p><div class="codebox"><pre><code>Yes, we had a couple reports of similar behavior.
I would recommend you to get a newer driver 1.7.34 and also to get some kernel patches that can help you with this.
Well, the other reports were with EHCI, but it can be related.

&gt; &gt;In the latest kernel-2.6.34 (released on May 16, 2010) I found a few more patches related to interrupt handling:
&gt; &gt;2010-04-30 Eric Dumazetr8169: Fix rtl8169_rx_interrupt() 
&gt; &gt;2010-04-26 françois romieur8169: more broken register writes workaround 
&gt; &gt;2010-04-26 françois romieur8169: failure to enable mwi should not be fatal 
&gt; &gt;http://www.mail-archive.com/linuxbios@linuxbios.org/msg11385.html
&gt; &gt;2010-05-20 Alek DuUSB: EHCI: clear PHCD before resuming 
&gt; &gt;2010-02-16 Alek DuUSB: ehci: phy low power mode bug fixing 
&gt; &gt;2010-04-22 Dinh Nguyenusb: Increase timeout value for device reset 
&gt; &gt;2010-01-20 Alan SternUSB: EHCI &amp; UHCI: fix race between root-hub suspend... 
&gt; &gt;2010-05-20 Alan SternUSB: EHCI: fix controller wakeup flag settings during... 
&gt; &gt;2010-05-20 Alan SternUSB: straighten out port feature vs. port status usage</code></pre></div><p>I updated my kernel module to 1.7.36 (which my contact at sierra stated is even better) and will see if it helps.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p129387">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">yamasaki</div>
					<div class="post-datetime">
						24 Feb 2011, 17:15					</div>
				</div>
				<div class="post-content content">
					<p>Thank you ^^</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p167097">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">lgentili</div>
					<div class="post-datetime">
						11 May 2012, 15:25					</div>
				</div>
				<div class="post-content content">
					<p>fbauhaus,</p><p>I&#039;m facing the same problem. I&#039;ve updated to sierra driver but still the problem is there.<br />I&#039;m using backfire_10.3.1 and the kernel is only 2.6.32.<br />Could you share how you fixed this problem?</p><p>Regards,</p><p>Leandro</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>