<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Atheros only! - Next Generation Piranha firmware (v4) + AAP (v3)</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 20 Aug 2015 and 21 Apr 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 2 of 13</div><nav><ul><li><a href="viewtopic.php%3Fid=26116&amp;p=1.html">1</a></li><li class="pagination-current"><span>2</span></li><li><a href="viewtopic.php%3Fid=26116&amp;p=3.html">3</a></li><li><a href="viewtopic.php%3Fid=26116&amp;p=4.html">4</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=26116&amp;p=13.html">13</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p116368">
				<div class="post-metadata">
					<div class="post-num">Post #26</div>
					<div class="post-author">orange</div>
					<div class="post-datetime">
						3 Sep 2010, 08:31					</div>
				</div>
				<div class="post-content content">
					<p>Wow, lots of traffic in here! Sorry for not coming back that fast. Actually, I&#039;m moving apartments right now and this turns out to be a 24/7 job.</p><p>@lux<br />Your assumption is perfectly correct. Unfortunately, due to the busybox built-in grep, the blacklist indeed need to be a non-empty file. AAP &quot;calculates&quot; the temp files (/tmp/aap_blst etc) on-the-fly out of /e/c/aap. Same applies to white-, mac- and hiddenlists btw. That said, please use the supplied /e/c/aap and leave it as is (with the dummy entries as there need to be at least one ssid, fakemac, blst and key defined) and just append your custom bssid sections (only ONE section per bssid) for proper AAP functionality.</p><p>EDIT: I added this important information to the tutorial (post #2). I&#039;ve almost forgotten this one as my very own custom /e/c/aap is VERY long and includes various fakemac, ssid, blst and key options. Thanks for pointing this out again.</p><p>There&#039;s no need to define the ssid option unless the network is hidden. AAP utilizes OPN networks by default IF prefonly toggle is set to &quot;0&quot;</p><p>@Seth7<br />There is no default passwd/login. Just telnet in (telnet 10.0.0.1), run &quot;passwd&quot;, supply the desired password twice, then SSH in (ssh root@10.0.0.1). Also, v4 100708 has been taken down in favor of v4 100813 (obvious reason for the opkg 404 error)</p><p><strong><span style="color: #FF0000">@all<br />If you&#039;re having problems to get AAP running, I&#039;d like to ask you to post your /e/c/aap, the output of &quot;aap log&quot; and &quot;aap list&quot; respectively. Otherwise, I&#039;m more or less unable to support you. Descriptions like &quot;It doesn&#039;t work for me&quot; actually are NOT enough information for a support request. Thanks in advance!</span></strong></p><p>HTH orange</p>											<p class="post-edited">(Last edited by <strong>orange</strong> on 3 Sep 2010, 14:26)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p116393">
				<div class="post-metadata">
					<div class="post-num">Post #27</div>
					<div class="post-author">Seth7</div>
					<div class="post-datetime">
						3 Sep 2010, 19:52					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;v placed a 5V switching reg next to my router ... less than an inch (1cm about) .... </p><p>I think its creating too much interference ..... ill need to remove it and use its original 5V supply and see if it still can&#039;t connect to anything ..</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p116407">
				<div class="post-metadata">
					<div class="post-num">Post #28</div>
					<div class="post-author">Seth7</div>
					<div class="post-datetime">
						4 Sep 2010, 00:24					</div>
				</div>
				<div class="post-content content">
					<p>I think this what you had asked for as far as information ....</p><p>I have eliminated hte 5V switcher ....... and ...</p><p>root@OpenWrt:~# aap list<br />26&nbsp; gmt_12a&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 00:18:84:13:69:09 8&nbsp; wep&nbsp; 2C0EE80617<br />root@OpenWrt:~# aap log<br />[808] 00:00:55 (re-)scan done, 1 suitable APs found in range, initiating connection attempt(s)<br />[808] 00:03:51 connection to AP 00:18:84:13:69:09 failed/skipped, tried all suitable APs, initiating (re-)scan<br />[808] 00:03:53 (re-)scan done, 1 suitable APs found in range, initiating connection attempt(s)<br />[808] 00:06:47 connection to AP 00:18:84:13:69:09 failed/skipped, tried all suitable APs, initiating (re-)scan<br />[808] 00:06:49 (re-)scan done, 1 suitable APs found in range, initiating connection attempt(s)<br />root@OpenWrt:~# aap list<br />26&nbsp; gmt_12a&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 00:18:84:13:69:09 8&nbsp; wep&nbsp; 2C0EE80617<br />root@OpenWrt:~# cd ..<br />root@OpenWrt:/# cd etc/config/<br />root@OpenWrt:/etc/config# vi aap</p><p>config &#039;aap&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;checkfreq&#039; &#039;60&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;dhcptimeout&#039; &#039;160&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ineturl&#039; &#039;<a href="http://www.google.com">www.google.com</a>&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;logenable&#039; &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;prefonly&#039; &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;rescandelay&#039; &#039;43200&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;warndelay&#039; &#039;220&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;watchinet&#039; &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;autostart&#039; &#039;1&#039;</p><p>config &#039;00:18:84:13:69:09&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;key&#039; &#039;2C0EE80617&#039;</p><p>config &#039;00:22:33:44:55:66&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;fakemac&#039; &#039;00:33:44:55:66:77&#039;</p><p>config &#039;00:44:55:66:77:88&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ssid&#039; &#039;default&#039;</p><p>config &#039;00:55:66:77:88:99&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;blst&#039; &#039;1&#039;</p><p>config &#039;00:02:6f:33:c7:b4&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;blst&#039; &#039;1&#039;</p><p>~<br />~<br />~<br />~<br />~<br />~<br />~<br />~<br />~<br />~<br />~<br />~<br />- aap 1/27 3%<br />any thing look wrong ??? perhaps the KEY ??</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p116457">
				<div class="post-metadata">
					<div class="post-num">Post #29</div>
					<div class="post-author">lux</div>
					<div class="post-datetime">
						4 Sep 2010, 19:57					</div>
				</div>
				<div class="post-content content">
					<p>@Seth7<br />Maybe I can help you, but post your /etc/config/wireless and /etc/config/network files</p><p>Is the key 2C0EE80617 correct or not? Cause of course if it is not correct it wont work...</p>											<p class="post-edited">(Last edited by <strong>lux</strong> on 4 Sep 2010, 19:59)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p116471">
				<div class="post-metadata">
					<div class="post-num">Post #30</div>
					<div class="post-author">Seth7</div>
					<div class="post-datetime">
						4 Sep 2010, 22:52					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>lux wrote:</cite><blockquote><p>@Seth7<br />Maybe I can help you, but post your /etc/config/wireless and /etc/config/network files</p><p>Is the key 2C0EE80617 correct or not? Cause of course if it is not correct it wont work...</p></blockquote></div><p>Yea .. the Key is correct ...... it was a copy/paste - so no mistakes</p><br /><p>etc/config/wireless</p><p>config &#039;wifi-device&#039; &#039;wifi0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;type&#039; &#039;atheros&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;channel&#039; &#039;auto&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;country&#039; &#039;392&#039;</p><p>config &#039;wifi-iface&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;device&#039; &#039;wifi0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;network&#039; &#039;wan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;mode&#039; &#039;sta&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ssid&#039; &#039;lazana&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;encryption&#039; &#039;none&#039;</p><p>config &#039;wifi-iface&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;device&#039; &#039;wifi0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;network&#039; &#039;lan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;mode&#039; &#039;ap&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ssid&#039; &#039;Link&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;encryption&#039; &#039;none&#039;</p><p>etc/config/network</p><p>config &#039;interface&#039; &#039;loopback&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ifname&#039; &#039;lo&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;proto&#039; &#039;static&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ipaddr&#039; &#039;127.0.0.1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;netmask&#039; &#039;255.0.0.0&#039;</p><p>config &#039;interface&#039; &#039;wan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;proto&#039; &#039;dhcp&#039;</p><p>config &#039;interface&#039; &#039;lan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ifname&#039; &#039;eth0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;type&#039; &#039;bridge&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;proto&#039; &#039;static&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ipaddr&#039; &#039;10.0.0.1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;netmask&#039; &#039;255.255.255.0&#039;</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p116482">
				<div class="post-metadata">
					<div class="post-num">Post #31</div>
					<div class="post-author">lux</div>
					<div class="post-datetime">
						5 Sep 2010, 02:17					</div>
				</div>
				<div class="post-content content">
					<p>@Seth7<br />I have a fonera FON2201 with Piranha v4/100813.<br />I suppose you have the same or a similar router.</p><p>In first: in an old thread (<a href="https://forum.openwrt.org/viewtopic.php?id=21636">https://forum.openwrt.org/viewtopic.php?id=21636</a>) Orange wrote &quot;Requirements: ... It assumes a single madwifi-VAP ath0 in sta mode&quot;.<br />But your configuration has 2 SSIDs: one in sta and one in ap mode.<br />Probably cause you want it to work like a WiFi repeater.<br />But aap doesn&#039;t work with this configuration.<br />I modified a bit the code solving this problem and I will post my code in the next days (cause I&#039;m also working on another &quot;weakness&quot;: macchanger on every boot changes randomly the mac, but the choice is not random at all cause the /dev/random has not enough entropy in such a small device)</p><p>So, if your router is similar to mine, I would try the next configuration:</p><p>&gt;&gt; etc/config/wireless</p><p>config &#039;wifi-device&#039; &#039;wifi0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;type&#039; &#039;atheros&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;channel&#039; &#039;auto&#039;<br />#&nbsp; &nbsp; &nbsp; &nbsp;option &#039;country&#039; &#039;392&#039; #this is an optional change</p><p>config &#039;wifi-iface&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;device&#039; &#039;wifi0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;network&#039; &#039;wan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;mode&#039; &#039;sta&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ssid&#039; &#039;lazana&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;encryption&#039; &#039;none&#039;</p><br /><p>&gt;&gt; etc/config/network</p><p>config &#039;interface&#039; &#039;loopback&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ifname&#039; &#039;lo&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;proto&#039; &#039;static&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ipaddr&#039; &#039;127.0.0.1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;netmask&#039; &#039;255.0.0.0&#039;</p><p>config &#039;interface&#039; &#039;wan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;proto&#039; &#039;dhcp&#039;</p><p>config &#039;interface&#039; &#039;lan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ifname&#039; &#039;eth0.1 eth0.2&#039; #but try also just &#039;eth0.1&#039; or &#039;eth0&#039; <br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;type&#039; &#039;bridge&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;proto&#039; &#039;static&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ipaddr&#039; &#039;10.0.0.1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;netmask&#039; &#039;255.255.255.0&#039;</p><br /><p>&gt;&gt; the /etc/config/aap you posted before is OK</p><p>Then connect to the router by ethernet cable into the port labeled as &quot;computer&quot; (if you are confused just try both) and verify if the router is connected to the bssid 00:18:84:13:69:09 (as you wrote in your aap config file) with the command: iwconfig<br />And also try the commands: aap log, aap list, ping <a href="http://www.google.com">www.google.com</a><br />If something is wrong try to check the log with the command: logread</p><p>Let me know your results<br />Later I will explain you how to add a virtual ssid as you want</p>											<p class="post-edited">(Last edited by <strong>lux</strong> on 5 Sep 2010, 03:07)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p116493">
				<div class="post-metadata">
					<div class="post-num">Post #32</div>
					<div class="post-author">Seth7</div>
					<div class="post-datetime">
						5 Sep 2010, 11:00					</div>
				</div>
				<div class="post-content content">
					<p>crud .. changing &#039;eth0&#039; to &#039;eth0.1&#039; has made in inaccessible .. gona haft to solder some wires and get into it via serial</p><p>reset button dosent seem to be working</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p116498">
				<div class="post-metadata">
					<div class="post-num">Post #33</div>
					<div class="post-author">Seth7</div>
					<div class="post-datetime">
						5 Sep 2010, 11:13					</div>
				</div>
				<div class="post-content content">
					<p>ok ... changing &#039;etho&#039; to &#039;etho eth0.1 etho.2&#039; seemed to be ok ...</p><p>removed the AP</p><p>and </p><p>root@OpenWrt:~# iwconfig<br />lo&nbsp; &nbsp; &nbsp; &nbsp; no wireless extensions.</p><p>eth0&nbsp; &nbsp; &nbsp; no wireless extensions.</p><p>br-lan&nbsp; &nbsp; no wireless extensions.</p><p>eth0.1&nbsp; &nbsp; no wireless extensions.</p><p>eth0.2&nbsp; &nbsp; no wireless extensions.</p><p>wifi0&nbsp; &nbsp; &nbsp;no wireless extensions.</p><p>ath0&nbsp; &nbsp; &nbsp; IEEE 802.11g&nbsp; ESSID:&quot;OPEN_WRT&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Mode:Managed&nbsp; Frequency:2.462 GHz&nbsp; Access Point: 00:18:84:13:69:09<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Bit Rate:1 Mb/s&nbsp; &nbsp;Tx-Power:18 dBm<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RTS thr:off&nbsp; &nbsp;Fragment thr:off<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Encryption key:2C0E-E806-17&nbsp; &nbsp;Security mode:restricted<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Power Management:off<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Link Quality=20/70&nbsp; Signal level=-76 dBm&nbsp; Noise level=-96 dBm<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Rx invalid nwid:0&nbsp; Rx invalid crypt:0&nbsp; Rx invalid frag:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Tx excessive retries:0&nbsp; Invalid misc:0&nbsp; &nbsp;Missed beacon:0</p><p>root@OpenWrt:~# aap log<br />[833] 00:00:56 (re-)scan done, 1 suitable APs found in range, initiating connection attempt(s)<br />root@OpenWrt:~# aap log<br />[833] 00:00:56 (re-)scan done, 1 suitable APs found in range, initiating connection attempt(s)<br />[833] 00:03:47 connected to AP 00:18:84:13:69:09 on channel 11 with WAN IP 192.168.208.143</p><p>So how about the VAP ??</p>											<p class="post-edited">(Last edited by <strong>Seth7</strong> on 5 Sep 2010, 11:13)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p116528">
				<div class="post-metadata">
					<div class="post-num">Post #34</div>
					<div class="post-author">lux</div>
					<div class="post-datetime">
						5 Sep 2010, 18:11					</div>
				</div>
				<div class="post-content content">
					<p>@Seth7<br />--<br />EDIT<br />After writing this message I tried to go back to the original code af AAP (I don&#039;t have it anymore, but I commented all my lines) and it was working with one VAP... so now I dont know if this can really solve your situation (but had the same problem as you)!!!<br />Anyway my modifications make sense and they are mandatory for another improvement: the random change of the MAC address which I&#039;ll describe later<br />--</p><p>AAP requires &quot;a single madwifi-VAP ath0 in sta mode&quot; as Orange wrote here: <a href="https://forum.openwrt.org/viewtopic.php?id=21636">https://forum.openwrt.org/viewtopic.php?id=21636</a><br />I modified the code of AAP to get it working also with a single madwifi-VAP ath0 in &quot;sta&quot; mode plus some VAPs in &quot;ap&quot; mode, so it is possible to use the router like a WiFi repeater</p><p>The maximum number of VAPs in AP mode for OpenWRT is 4, as written here: <a href="http://downloads.openwrt.org/kamikaze/docs/openwrt.html#x1-120001.2.2">http://downloads.openwrt.org/kamikaze/d … 120001.2.2</a></p><p>These VAPs in &quot;sta&quot; and &quot;ap&quot; mode have to be defined in the file /etc/config/wireless</p><br /><p>&gt;&gt;&gt;&gt; Here is an example of /etc/config/wireless with one &quot;sta&quot;and one &quot;ap&quot;:</p><p>config &#039;wifi-device&#039; &#039;wifi0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;type&#039; &#039;atheros&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;channel&#039; &#039;auto&#039;<br />#&nbsp; &nbsp; &nbsp; &nbsp;option &#039;country&#039; &#039;392&#039;</p><p>config &#039;wifi-iface&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;device&#039; &#039;wifi0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;network&#039; &#039;wan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;mode&#039; &#039;sta&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;hidden&#039; &#039;0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ssid&#039; &#039;SSID&#039;</p><p>config &#039;wifi-iface&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;device&#039; &#039;wifi0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;network&#039; &#039;lan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;mode&#039; &#039;ap&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ssid&#039; &#039;OpenWRT&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;encryption&#039; &#039;psk2&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;key&#039; &#039;password&#039;</p><br /><br /><p>&gt;&gt;&gt;&gt; Here is how to modify the code of AAP</p><p>NOTE: BEFORE EDITING THE CODE IT&#039;S BETTER TO WAIT TO KNOW WHAT ORANGE THINKS ABOUT IT, CAUSE HE KNOWS THIS STUFF MUCH BETTER THAN ME</p><p>- Stop aap with the command: aap stop<br />- Edit aap with the command: vi /bin/aap<br />- Here is what to edit:<br />Lines around 122 (inside the function aap_connect()):<br />[only lines in red are edited or added]<br />...<br />if [ `grep -ic $aap_bssid /tmp/aap_mlst` = &quot;1&quot; ]; then<br />&nbsp; &nbsp; &nbsp; &nbsp; aap_fakemac=`grep -i $aap_bssid /tmp/aap_mlst | awk -F&quot;$(printf &#039;\t&#039;)&quot; &#039;{print $2}&#039;`<br />&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #FF0000">#wlanconfig ath0 destroy #commented</span><br />&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #FF0000">ifconfig | grep ath | awk &#039;{split($1, z); print &quot;wlanconfig&quot;, z[1], &quot;destroy&quot; | &quot;sh&quot;}&#039; #added</span><br />&nbsp; &nbsp; &nbsp; &nbsp; macchanger -m $aap_fakemac wifi0<br />&nbsp; &nbsp; &nbsp; &nbsp; wlanconfig ath0 create wlandev wifi0 wlanmode sta<br />else<br />&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #FF0000">#wlanconfig ath0 destroy #commented</span><br />&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #FF0000">ifconfig | grep ath | awk &#039;{split($1, z); print &quot;wlanconfig&quot;, z[1], &quot;destroy&quot; | &quot;sh&quot;}&#039; #added</span><br />&nbsp; &nbsp; &nbsp; &nbsp; macchanger -A wifi0<br />&nbsp; &nbsp; &nbsp; &nbsp; wlanconfig ath0 create wlandev wifi0 wlanmode sta<br />fi<br />...</p><p>And few lines after:<br />...<br />uci set wireless.@wifi-iface[0].encryption=$aap_encryption<br />uci set wireless.@wifi-iface[0].key=$aap_key<br /><span style="color: #FF0000">rm /var/run/hostapd-ath*/ath* #added</span><br />ifup wan<br />/sbin/wifi<br />...</p><p>- Close vi and save<br />- Edit the file /etc/config/wireless introducing a VAP as I wrote before<br />- Reboot the router</p><br /><p>Technically the problem was that, before connecting to a new network, AAP was destroying just the ath0 connection<br />Now it will destroy all the ath* connections</p><p>@Orange: if you have time, take a look to my code cause I&#039;m not so expert and if you find it useful you can add it to the official release<br />@Seth7: it works for me, let me know if it also works for you</p><p>(I&#039;m also working on another &quot;weakness&quot;: on every boot AAP changes randomly the MAC address before connecting to an AP; but if there is no ethernet connection, but just wifi connections, so this choice is not random at all, cause the random MAC is often - almost always - the same. The problem is that the source of entropy for the /dev/random device - used by macchanger - is just the ethernet connection. I solved it with a pseudo-random choice and I&#039;ll post the solution later after some tests)</p>											<p class="post-edited">(Last edited by <strong>lux</strong> on 5 Sep 2010, 18:15)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p116619">
				<div class="post-metadata">
					<div class="post-num">Post #35</div>
					<div class="post-author">Seth7</div>
					<div class="post-datetime">
						7 Sep 2010, 17:04					</div>
				</div>
				<div class="post-content content">
					<p>Sounds great !!!!</p><p>The changes you posted didn&#039;t seem to have any ill effects ..... connected to MY encrypted AP with no issues and VAP running well .....</p><p>Ill change it later to remove my AP and see what happens ....</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p116729">
				<div class="post-metadata">
					<div class="post-num">Post #36</div>
					<div class="post-author">Seth7</div>
					<div class="post-datetime">
						8 Sep 2010, 23:27					</div>
				</div>
				<div class="post-content content">
					<p>I would like this to show all detected AP&#039;s and connect to secured AP&#039;s if i want to ....</p><p>Isnt the option prefonly &#039;0&#039;&nbsp; &nbsp;--- make it connect to anything ??</p><p>I have several AP&#039;s in my area that are secured - i just want to see if they were scanned so that i know the Wrouter didn&#039;t go deaf !!!</p><p>Also would changing scan delay longer - to let the VAP be detected or is the VAP only active when&nbsp; the router is connected to something ??</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p116750">
				<div class="post-metadata">
					<div class="post-num">Post #37</div>
					<div class="post-author">lux</div>
					<div class="post-datetime">
						9 Sep 2010, 15:18					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m happy that it&#039;s working also for you!!</p><p>About your questions: the VAP (in &quot;ap&quot; mode) is just working when the AP (in &quot;sta&quot; mode) is connected.<br />So when AAP can&#039;t connect to any network, the VAP is not working.<br />I tested this situation.</p><p>About the prefonly option, I&#039;m not so sure cause I didn&#039;t test it so much.<br />Anyway Orange wrote: &quot;# Defines the search mode. Try to find all accesspoints that provide internet access. &quot;0&quot;=NO, &quot;1&quot;=YES<br />aap_prefonly=0<br />...AAP utilizes OPN networks by default IF prefonly toggle is set to 0&quot;<br />So I suppose that:<br /> - if it&#039;s 0, then it connects to the strongest signal between all the open networks available and the networks defined into the config file<br /> - if it&#039;s 1, then it connects just to the strongest signal between the networks defined into the config file</p><p>To scan the available networks and find the strongest signal it uses the command:<br />wlanconfig ath0 list scan</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p116776">
				<div class="post-metadata">
					<div class="post-num">Post #38</div>
					<div class="post-author">napierzaza</div>
					<div class="post-datetime">
						9 Sep 2010, 20:58					</div>
				</div>
				<div class="post-content content">
					<p>Which image file would work as a ramdisk on a meraki mini?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p116804">
				<div class="post-metadata">
					<div class="post-num">Post #39</div>
					<div class="post-author">Seth7</div>
					<div class="post-datetime">
						10 Sep 2010, 05:14					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>napierzaza wrote:</cite><blockquote><p>Which image file would work as a ramdisk on a meraki mini?</p></blockquote></div><p>RamDisk ??? i didn&#039;t know there was a mod to add a ramdisk/flash to the Fon. Are you working on a hard ware mod??</p><p>Ill bet this will work on a Meraki mini ....... its very similar to a Fon ...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p116820">
				<div class="post-metadata">
					<div class="post-num">Post #40</div>
					<div class="post-author">napierzaza</div>
					<div class="post-datetime">
						10 Sep 2010, 14:40					</div>
				</div>
				<div class="post-content content">
					<p>Maybe I&#039;m mixing my terms. But I wanted to load the firmware into the device without saving it on the flash chip. For testing.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p116831">
				<div class="post-metadata">
					<div class="post-num">Post #41</div>
					<div class="post-author">Seth7</div>
					<div class="post-datetime">
						10 Sep 2010, 17:52					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>napierzaza wrote:</cite><blockquote><p>Maybe I&#039;m mixing my terms. But I wanted to load the firmware into the device without saving it on the flash chip. For testing.</p></blockquote></div><p>I don&#039;t think that&#039;s possible .... there are changes to MadWifi and other repositories ..... but i believe you can copy your routers flash contents via ftp and put it back later ...... ill assume that your router has original firmware or open-wrt??</p><p>If its openwrt then just flash it back with latest openwrt if you don&#039;t like AAP ..... keep in mind im just a NOOB.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p116861">
				<div class="post-metadata">
					<div class="post-num">Post #42</div>
					<div class="post-author">Seth7</div>
					<div class="post-datetime">
						11 Sep 2010, 01:00					</div>
				</div>
				<div class="post-content content">
					<p>lux ...</p><p>Do you know off hand if channel 0 or -1 can be set .... perhaps using another country code??</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p116882">
				<div class="post-metadata">
					<div class="post-num">Post #43</div>
					<div class="post-author">Seth7</div>
					<div class="post-datetime">
						11 Sep 2010, 08:38					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Seth7 wrote:</cite><blockquote><p>lux ...</p><p>Do you know off hand if channel 0 or -1 can be set .... perhaps using another country code??</p></blockquote></div><p>duh ... option &#039;channel&#039; &#039;6&#039; </p><p>under the e/c/wireless config....</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p117051">
				<div class="post-metadata">
					<div class="post-num">Post #44</div>
					<div class="post-author">orange</div>
					<div class="post-datetime">
						13 Sep 2010, 18:48					</div>
				</div>
				<div class="post-content content">
					<p>@lux<br />First of all, I&#039;m sorry for still being that silent but unfortunately, I&#039;m still on my way moving apartments, renovating, re-establishing my working environment, setting up a new wireless Piranha drone (this time with a homebrew cantenna), etc. I somewhat under-estimated the efforts involved with it. Thus, I currently have very few spare time on the plate. This may take another few weeks until finished. I&#039;ll then be back with full engagement.</p><p>That said, I&#039;d quickly like to answer your questions/comment your contributions (btw, much appreciated!)</p><p>1. The random Mac feature:<br />In the past, AAP has been released with the feature to utilize a specific Mac upon connection attempt (for networks with enabled Mac filtering). The Mac was reset to default when connecting to a network without Mac filtering. At some point in time, I decided to re-write this AAP module to connect with a random Mac by default while preserving the specific Mac definition for Mac-filtering networks. This fits best into my very personal usage scenario (obfuscating the drone) but I see that it may NOT fit for everyone. Thus my proposal is to introduce another toggle with subsequent releases to switch between the two described behaviours. Sounds good?</p><p>2. Your code contributions<br />From my perspective (by having a quick look), your AAP modifications make perfect sense and thus will be introduced to subsequent AAP releases. Thanks for sharing your thoughts, I actually love it to see someone REALLY think about AAP enhancements.</p><p>3. The prefonly toggle<br /></p><div class="quotebox"><blockquote><p>So I suppose that:<br />- if it&#039;s 0, then it connects to the strongest signal between all the open networks available and the networks defined into the config file<br />- if it&#039;s 1, then it connects just to the strongest signal between the networks defined into the config file</p></blockquote></div><p>Perfectly correct assumption! The default is prefonly=0 just due to the fact that, OPN surrounding networks assumed, AAP works out of the box for quick internet access (while on the road or something) without any user configuration required. Certainly, you may whitelist/utilize OPN networks as well while using prefonly=1, i.e. you just need to configure the OPN networks of desire with an empty key argument (this may be broken with most recent UCI releases deleting empty UCI configuration arguments, need to check this once time allows), that&#039;s it!</p><p>@napierzaza<br /></p><div class="quotebox"><blockquote><p>Which image file would work as a ramdisk on a meraki mini?</p></blockquote></div><p>I&#039;m unsure about that one (never tried that myself). That said, the Meraki Mini mini is in general (as an Atheros device supported by OpenWrt Backfire) supported by Piranha v4 .. and if there is a stock OpenWrt image capable of what you&#039;re trying to achieve at <a href="http://downloads.openwrt.org/backfire/10.03/atheros/">http://downloads.openwrt.org/backfire/10.03/atheros/</a> there is a corresponding image at <a href="http://piranha.pwnz.org/pub/v4/100813/">http://piranha.pwnz.org/pub/v4/100813/</a> as well. If not, this is something not covered by the default build process.</p>											<p class="post-edited">(Last edited by <strong>orange</strong> on 13 Sep 2010, 19:16)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p117497">
				<div class="post-metadata">
					<div class="post-num">Post #45</div>
					<div class="post-author">ethernos</div>
					<div class="post-datetime">
						19 Sep 2010, 18:26					</div>
				</div>
				<div class="post-content content">
					<p>hi lux !<br />the configuration you&#039;v posted is exactly what dosn&#039;t work for me with the last Backfire 10.03.1-rc3.<br /> </p><div class="quotebox"><cite>Lux wrote:</cite><blockquote><p>.....<br />config &#039;wifi-iface&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;device&#039; &#039;wifi0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;network&#039; &#039;wan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;mode&#039; &#039;sta&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;hidden&#039; &#039;0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ssid&#039; &#039;SSID&#039;</p><p>config &#039;wifi-iface&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;device&#039; &#039;wifi0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;network&#039; &#039;lan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;mode&#039; &#039;ap&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ssid&#039; &#039;OpenWRT&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;encryption&#039; &#039;psk2&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;key&#039; &#039;password&#039;<br />.....</p></blockquote></div><p>i just wanted to test aap under backfire but opkg return an <strong>&quot; has no valid architecture &quot;</strong><br />I want to try piranha but since this message i don&#039;t realy think i shoold</p><p>here is my architecture<br /> </p><div class="quotebox"><cite>root@OpenWrt:~# cat /proc/cpuinfo wrote:</cite><blockquote><p>system type&nbsp; &nbsp; &nbsp; &nbsp; : Atheros AR9132 rev 2<br />machine&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : TP-LINK TL-WR1043ND<br />processor&nbsp; &nbsp; &nbsp; &nbsp; : 0<br />cpu model&nbsp; &nbsp; &nbsp; &nbsp; : MIPS 24Kc V7.4<br />BogoMIPS&nbsp; &nbsp; &nbsp; &nbsp; : 266.24<br />wait instruction&nbsp; &nbsp; : yes<br />microsecond timers&nbsp; &nbsp; : yes<br />tlb_entries&nbsp; &nbsp; &nbsp; &nbsp; : 16<br />extra interrupt vector&nbsp; &nbsp; : yes<br />hardware watchpoint&nbsp; &nbsp; : yes, count: 4, address/irw mask: [0x0ff8, 0x0ffc, 0x0ffb, 0x0ffb]<br />ASEs implemented&nbsp; &nbsp; : mips16<br />shadow register sets&nbsp; &nbsp; : 1<br />core&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : 0<br />VCED exceptions&nbsp; &nbsp; &nbsp; &nbsp; : not available<br />VCEI exceptions&nbsp; &nbsp; &nbsp; &nbsp; : not available</p></blockquote></div><p>what do you tink ?<br />thank you</p>											<p class="post-edited">(Last edited by <strong>ethernos</strong> on 19 Sep 2010, 18:27)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p117566">
				<div class="post-metadata">
					<div class="post-num">Post #46</div>
					<div class="post-author">lux</div>
					<div class="post-datetime">
						20 Sep 2010, 19:02					</div>
				</div>
				<div class="post-content content">
					<p>@Orange<br />I&#039;m writing some improvements for AAP<br />They are not so big changes, just few stuff I found useful<br />One change is about a small bug with the ping when watchinet is 0<br />Another change is a &quot;more random&quot; mac changes<br />Then a web interface<br />And then I&#039;m trying to minimize the IO to files (in particular the writes)</p><p>I have not so much time, but when I finish it I&#039;ll send it to you (just to let you know)<br />I&#039;m doing it cause of my needs, but maybe some changes are not conciliabile with your plan about the software (for example you dont want a web interface)</p><br /><p>@ethernos<br />You can&#039;t run AAP on a pre-compiled OpenWrt distribution as Orange wrote here: <a href="https://forum.openwrt.org/viewtopic.php?id=26116">https://forum.openwrt.org/viewtopic.php?id=26116</a><br />&quot;...That said, due to its design, AAP is Atheros only and won&#039;t run on a pre-compiled OpenWrt distribution as it needs a patch to madwifi sources, in order to un-truncate &quot;wlanconfig ath0 list scan&quot; SSID output, that isn&#039;t part of OpenWrt by default. I don&#039;t feel it appropriate to provide comprehensive patching/installation and OpenWrt configuration instructions as this would significantly higher both the potential for failure and my very own maintenance overhead in supporting AAP. Thus I provide Piranha (currently v4) as a ready-to-use solution. Support for other OpenWrt platforms (Broadcom etc) isn&#039;t planned (at least not from a short term perspective)...&quot;</p><p>Orange is the creator of Piranha and AAP so you should ask him if it is possible to install it on your devise.<br />Anyway Piranha is just OpenWrt with something preinstalled and patched, so if your device can run OpenWrt maybe it can also run Piranha.<br />But keep in mind that I&#039;m not expert at all in this, so wait for Orange answer cause I dont want you to make a big mess.</p><p>So, I assume that now AAP is not working on your device<br />If AAP is not working, with that configuration you posted, I would expect this behaviour:<br /> - the AP in STA (client) mode cant connect to anything, cause there is not a wifi network with ssid &#039;SSID&#039; and with no encryption close to your device<br /> - the AP in AP (access point) mode is not working cause the STA one failed<br />I posted this configuration cause it works with AAP</p><p>If you want it to work like a wifi client with a virtual access point (without AAP), so: change the AP in STA (client) mode with the right ssid name and encryption key (I mean the one from the original network close to you router)<br />When this AP in client mode is working, so also the virtual AP will work</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p117638">
				<div class="post-metadata">
					<div class="post-num">Post #47</div>
					<div class="post-author">orange</div>
					<div class="post-datetime">
						21 Sep 2010, 23:23					</div>
				</div>
				<div class="post-content content">
					<p>@lux<br /></p><div class="quotebox"><blockquote><p>I&#039;m writing some improvements for AAP<br />They are not so big changes, just few stuff I found useful<br />One change is about a small bug with the ping when watchinet is 0<br />Another change is a &quot;more random&quot; mac changes<br />Then a web interface<br />And then I&#039;m trying to minimize the IO to files (in particular the writes)</p><p>I have not so much time, but when I finish it I&#039;ll send it to you (just to let you know)<br />I&#039;m doing it cause of my needs, but maybe some changes are not conciliabile with your plan about the software (for example you dont want a web interface)</p></blockquote></div><p>Sounds very nice! I&#039;m actually really looking forward to your AAP improvements. It&#039;s much appreciated to see someone actively contributing to the Piranha Project. And btw, I&#039;d LOVE to have a web interface for AAP. That said, it would be cool if we could talk about its design a bit in advance. Please contact me via email (contact details on the Piranha Project Website). Thanks!</p><p>@ethernos<br /></p><div class="quotebox"><blockquote><p>Orange is the creator of Piranha and AAP so you should ask him if it is possible to install it on your devise.<br />Anyway Piranha is just OpenWrt with something preinstalled and patched, so if your device can run OpenWrt maybe it can also run Piranha.<br />But keep in mind that I&#039;m not expert at all in this, so wait for Orange answer cause I dont want you to make a big mess.</p></blockquote></div><p>lux provided perfectly correct informations. Piranha v4 will work on all Atheros hardware supported by Backfire 10.03 (that&#039;s what it actually is, besides a few minor modifications). Next Piranha v4 snapshot (no ETA yet) will be based upon Backfire 10.03.1.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p117664">
				<div class="post-metadata">
					<div class="post-num">Post #48</div>
					<div class="post-author">Seth7</div>
					<div class="post-datetime">
						22 Sep 2010, 02:29					</div>
				</div>
				<div class="post-content content">
					<p>HuRAH !!!!! </p><p>More writers ... i will love to test !!!!!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p118361">
				<div class="post-metadata">
					<div class="post-num">Post #49</div>
					<div class="post-author">Seth7</div>
					<div class="post-datetime">
						3 Oct 2010, 06:50					</div>
				</div>
				<div class="post-content content">
					<p>yep ... looking forward to it ...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p118552">
				<div class="post-metadata">
					<div class="post-num">Post #50</div>
					<div class="post-author">w0rdpress</div>
					<div class="post-datetime">
						6 Oct 2010, 00:09					</div>
				</div>
				<div class="post-content content">
					<p>not sure if this is a bug for Piranha, or openwrt:</p><p>config &#039;interface&#039; &#039;wan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ifname&#039; &#039;eth0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;macaddr&#039; 00:11:22:33:44:55</p><p>is not effective, original mac is always showing. neither is the following:</p><p>ifconfig eth0 hw ether 00:11:22:33:44:55<br />ifconfig: SIOCSIFHWADDR: Operation not supported</p><p>any idea?</p>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 2 of 13</div><nav><ul><li><a href="viewtopic.php%3Fid=26116&amp;p=1.html">1</a></li><li class="pagination-current"><span>2</span></li><li><a href="viewtopic.php%3Fid=26116&amp;p=3.html">3</a></li><li><a href="viewtopic.php%3Fid=26116&amp;p=4.html">4</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=26116&amp;p=13.html">13</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>