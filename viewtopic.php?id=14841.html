<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Asus WL-500gP doesn&#039;t work correctly as WPA access point (nas exits)</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 22 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p64916">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">mmp</div>
					<div class="post-datetime">
						10 Mar 2008, 22:36					</div>
				</div>
				<div class="post-content content">
					<p>Hello, I use Kamikaze 7.09 on Asus WL-500gP and have a bit weird problem. Original firmware works absolutely correctly with WPA configuration. But after flashing and configuring OpenWrt, some interesting happened. First time I did this, WPA worked correctly as well, but from some point it started to stop working. At that point, I flashed back original firmware, which worked correctly. Now I again loaded OpenWrt, and found out that it works correctly with open network and WEP, but when WPA is enabled I can &quot;associate&quot; -- my laptop&#039;s driver says I&#039;m associated, but on AP I see that /usr/sbin/nas just exited and sometimes this appears on the console:</p><p>#0 (0x1000bf30)-&gt;0x1000bf30: &nbsp; &nbsp; 0 sec 0 usec&nbsp; &nbsp; 0x403840<br />#1 (0x1000bf30)-&gt;0x1000bf30: &nbsp; &nbsp; 0 sec 0 usec&nbsp; &nbsp; 0x403840<br />(...a thousand lines in the future...)<br />#1088 (0x1000bf30)-&gt;0x1000bf30: &nbsp; &nbsp; 0 sec 0 usec&nbsp; &nbsp; 0x403840<br />...(giving up)</p><p>I can just say that original firmware worked correctly. I have no idea about what is happening, I tried to google, but it looks like I&#039;m the only one with this problem. I would return the device, but apparently, original firmware works correctly, so it would probably be pointless attempt. Maybe it&#039;s some really weird hardware revision no one else has seen before. If anyone has idea what could be wrong, I&#039;m open to suggestions.</p><p>UPDATE1:<br />Looks like the abovementioned console output is from libshared.asus.so or something similar (src/router/shared.asus/linux_timer.c in asus GPL sources), generated by print_event_queue. Hard to say what causes that, though.</p>											<p class="post-edited">(Last edited by <strong>mmp</strong> on 11 Mar 2008, 09:49)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p64947">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">thomasa88</div>
					<div class="post-datetime">
						11 Mar 2008, 15:04					</div>
				</div>
				<div class="post-content content">
					<p>I have the same problem <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><p>Running on a wrt54g-v2 with kamikaze 7.09 and I get the exact symptoms and the same error output.</p><p>Shortening my key to 20 chars seems to have helped, but I wonder how it worked in the first placed.</p>											<p class="post-edited">(Last edited by <strong>thomasa88</strong> on 12 Mar 2008, 10:12)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p65007">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">mmp</div>
					<div class="post-datetime">
						12 Mar 2008, 18:01					</div>
				</div>
				<div class="post-content content">
					<p>I also tried shortening the key, (to 14 and then to 8 characters) but unfortunately it did not help me, nas still after association attempt. </p><p>I read the source a bit more; problem seems to be that event queue (represented by unidirectional linked list) seems to be looped to itself -- sources even contain check for this condition (and exit in case of failure, which might corresponds with nas exiting after this error), so I assume this error is known to Broadcom developers (according to copyright notice). There are some warnings about race condition, I&#039;m not sure whether related to this issue, though.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p65008">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">netprince</div>
					<div class="post-datetime">
						12 Mar 2008, 18:07					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m curious if you have tried building a firmware from SVN?&nbsp; There is a newer version of the wifi driver in trunk, perhaps you will have better luck.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p65025">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">mmp</div>
					<div class="post-datetime">
						12 Mar 2008, 21:09					</div>
				</div>
				<div class="post-content content">
					<p>I just tried OpenWrt SVN trunk, the problem persists, and if &#039;nas&#039; is run from command line, it also prints all the bugs with timer. I&#039;ll try to give it a show soon.</p><p>UPDATE1: It looks like trunk has libshared statically linked to nas, so there is nothing I can do with SVN trunk, going to give a try to kamikaze_9.07 .</p>											<p class="post-edited">(Last edited by <strong>mmp</strong> on 13 Mar 2008, 00:45)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p65184">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">mmp</div>
					<div class="post-datetime">
						15 Mar 2008, 02:42					</div>
				</div>
				<div class="post-content content">
					<p>I think I found out what causes this issue. As far as I understand it, there is error in libshared.so, linux_timer.c, which (apparently only under certain circumstances) allows to re-enqueue event, which is already in queue. This could also possibly solve issues with nas-running APs, which suddenly stop responding via wireless -- after such condition is discovered, libshared dumps event queue and exits. </p><p>Patch available at&nbsp; <a href="http://handhelds.org/~mmp/patches/brcm_libshared_avoid_reenqueue.patch">http://handhelds.org/~mmp/patches/brcm_ â€¦ ueue.patch</a> . It would be great if Broadcom people could also see it, as the most recent version of broadcom driver in openwrt doesn&#039;t have this issue fixed (and unfortunately is statically linked, so there is no way to fix it). Please test and report any regressions.</p><p>UPDATE1: argh, to not forget, patch should be applied to package/nvram/<br />UPDATE2: compiled library for kamikaze_9.07 is at <a href="http://handhelds.org/~mmp/misc/libshared.so">http://handhelds.org/~mmp/misc/libshared.so</a></p>											<p class="post-edited">(Last edited by <strong>mmp</strong> on 15 Mar 2008, 10:06)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p65234">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">loyukfai</div>
					<div class="post-datetime">
						16 Mar 2008, 18:12					</div>
				</div>
				<div class="post-content content">
					<p>I had problems making WPA2 (PSK) work on a WBR2-G54 as well.</p><p>After installing the libshared.so provided by mmp, it started to work.</p><p>Thanks.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p66433">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">nbd</div>
					<div class="post-datetime">
						7 Apr 2008, 03:25					</div>
				</div>
				<div class="post-content content">
					<p>Fix applied to trunk in r10750</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p67709">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">Fatus</div>
					<div class="post-datetime">
						2 May 2008, 03:19					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>mmp wrote:</cite><blockquote><p>UPDATE2: compiled library for kamikaze_9.07 is at <a href="http://handhelds.org/~mmp/misc/libshared.so">http://handhelds.org/~mmp/misc/libshared.so</a></p></blockquote></div><p>If you meant 7.09 and not trunk, where to put this library? 7.09 has broadcom-wl 4.80.53.0, whose nas has libshared statically linked, I guess. You certainly meant broadcom-wl 4.50.10.5.x in trunk, right?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p69326">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">youth4ever</div>
					<div class="post-datetime">
						8 Jun 2008, 22:35					</div>
				</div>
				<div class="post-content content">
					<p>hi mmp,</p><p>I have the same problem as you with a Asus wl 500g-P and OpenWrt Kamikaze 7.09 with openwrt-brcm-2.4-squashfs.trx<br /> I receive lots of mesages (thousands):</p><p>#1084 (0x1000bf30)-&gt;0x1000bf30:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 sec 0 usec&nbsp; &nbsp; 0x403840<br />#1085 (0x1000bf30)-&gt;0x1000bf30:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 sec 0 usec&nbsp; &nbsp; 0x403840<br />#1086 (0x1000bf30)-&gt;0x1000bf30:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 sec 0 usec&nbsp; &nbsp; 0x403840<br />#1087 (0x1000bf30)-&gt;0x1000bf30:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 sec 0 usec&nbsp; &nbsp; 0x403840<br />#1088 (0x1000bf30)-&gt;0x1000bf30:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 sec 0 usec&nbsp; &nbsp; 0x403840<br />Apprently the first time the wireless worked well, but after a few hours I begun to receive these messages.</p><p>Can you please explain me how you managed to resolve the problem ? <br />I didn&#039;t found the libshared.so, linux_timer.c files anywhere in the filesystem. Of course I use nas.<br />But how can I use your patch to resolve the problem with the <a href="http://handhelds.org/~mmp/misc/libshared.so">http://handhelds.org/~mmp/misc/libshared.so</a> ?</p><p>Thank you in advance.</p>											<p class="post-edited">(Last edited by <strong>youth4ever</strong> on 8 Jun 2008, 22:36)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p69397">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">youth4ever</div>
					<div class="post-datetime">
						10 Jun 2008, 15:12					</div>
				</div>
				<div class="post-content content">
					<p>I reduced the dimension of the WPA PSK key from 26 characters to 11 characters. </p><p>Now the wireless works good, and it is stable from 2 days now.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>