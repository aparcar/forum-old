<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> command for (re)configuration</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 20 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p362294">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">AugustQ</div>
					<div class="post-datetime">
						19 Jul 2017, 15:56					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>my question: is there a command that enforces a reconfiguration of OpenWrt?</p><p>The reason:<br />to make OpenWrt work with the Huawei E3372h-stick I needed a second-LAN-card initially (I used a USB-LAN-adapter, this worked too). So on booting OpenWrt initally everything is detected and the configuration is written to the files.</p><p>Luckily I had the adapter but what can I do when I don&#039;t have this?</p><p>When I boot OpenWrt initially a CD-Rom is detected (=E3372h). After installing the package usb-modeswitch this stick is switched to modem-mode. But what about the configuration? Is there a way to enforce the process analog to the first boot-process?</p><p>Regards<br />AugustQ</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p362300">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">Antek</div>
					<div class="post-datetime">
						19 Jul 2017, 21:04					</div>
				</div>
				<div class="post-content content">
					<p>Since you need &#039;usb-modeswitch&#039; (and probably &#039;wwan&#039;) packages to get your stick working, then maybe you need to build a custom image using the OpenWRT Buildroot that has these packages pre-installed?</p><p>You&#039;ll still need to configure the settings using whatever LAN interface your router has in order to make the stick connect to your carrier&#039;s network, but at least you&#039;ll have the software ready, and you don&#039;t need to fetch them from the net, which is probably the reason why you needed the second USB-LAN adapter.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p362930">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">AugustQ</div>
					<div class="post-datetime">
						31 Jul 2017, 16:47					</div>
				</div>
				<div class="post-content content">
					<p>Hi Antek,</p><p>first of all: I&#039;ve a working/functional version of OpenWrt with the Huawei-stick. And yes: I needed usb-modeswitch and wwan.</p><p>My question was: when installing everything is detected and the config-files are written, but not in the case of the Huawei-stick. So I used a trick: I I installed a second LAN-interface (a USB-LAN-adapter). So in the first boot-process the configuration is detected and all config-files are written..</p><p>So I thoug of: can I omit the step with the USB-LAN-adapter? </p><p>When I used the Huawei-stick the configuration written does not include eth1, when using the USB-LAN-adapter the configuration contains eth1. Looks like the switching of the stick to eth1 is done too late. And I&#039;m looking for a solution which uses the stick directly and does not need the trick with the LAN-adapter.</p><p>So: is there a routine which I can call via the commandline (or a little program that calls such a routine) that checks the configuration and write the config-files accordingly.</p><p>This is done at the inital boot of OpenWrt, but I want do start this process manually because I assume that the stick is not detected properly.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p362941">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">mk24</div>
					<div class="post-datetime">
						31 Jul 2017, 21:38					</div>
				</div>
				<div class="post-content content">
					<p>You can put configuration files into your custom image.&nbsp; These will be used as defaults instead of the firstboot autodetections.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p362943">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">Antek</div>
					<div class="post-datetime">
						31 Jul 2017, 21:55					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>AugustQ wrote:</cite><blockquote><p>My question was: when installing everything is detected and the config-files are written, but not in the case of the Huawei-stick. So I used a trick: I I installed a second LAN-interface (a USB-LAN-adapter). So in the first boot-process the configuration is detected and all config-files are written..</p><p>So I thoug of: can I omit the step with the USB-LAN-adapter?</p></blockquote></div><p>Sorry. I misunderstood your question, so my answer was bit off-point. Mk24&#039;s suggestion should solve your issue.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p362996">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">AugustQ</div>
					<div class="post-datetime">
						1 Aug 2017, 16:53					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>are configuration-files the criteria for first-boot/following boot? Which files are used? /etc/confignetwork, more ......</p><p>I looked into the img-file I used and did not find /etc/config/networki.<br />So with my test-machine here I will give this a try.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p362998">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">AugustQ</div>
					<div class="post-datetime">
						1 Aug 2017, 17:11					</div>
				</div>
				<div class="post-content content">
					<p>renaming the network-file and rebooting does not help: my notebook does not get an IP-address. </p><p>So this is not the way to enforce the first boot.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p363001">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">AugustQ</div>
					<div class="post-datetime">
						1 Aug 2017, 17:28					</div>
				</div>
				<div class="post-content content">
					<p>so let me describe the steps I went to make this Huawei-stick working:</p><p>first to say: my machine is a Fujitsu S700 (=Futro)</p><p>step #1: on the Futro I booted Knoppix via USB-memory-stick, copied the image of OpenWrt to the flash-memory of the Futro. power down.</p><p>step #2: removed the USB-memory-stick, added a USB-LAN-adapter</p><p>step #3: powered the Futro. it entered in config-mode. on my notebook I could start a browser and via 192.168.1.1 could look at the configuration and made some decisisons. this was written to the Futro.</p><p>step #4: powered down the Futro. removed the LAN-Adapter, replaced it by the Huawei-stick, rebooted the machine</p><p>step #5: on the Futro I edited the /etc/config/network-file: switched eth0 and eth1. power down</p><p>step #6: powedred the Futro, connected it to the internet via eth0 and loaded the packages usb-modeswitch and wwan. after this I edited /etc/config/network and switched eth0 and eth1 again (=back to the original state).</p><p>step #7: rebooted the Futro.</p><p>As you can see the USB-LAN-adapter is not needed, it&#039;s only a placeholder for an ethx-device. In case you do not have one (or any other device like a riser-card and a LAN-adapter) how can you do the configuration?</p><p>So my question is: is there a way to go back to step #3?<br />I would then omit the USB-LAN-adapter, get a cconfiguration only with eth0, connect the Futro to the internet, load my packages and then go back to step#3.</p><p>Do you have any idea how to do this?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p363002">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">AugustQ</div>
					<div class="post-datetime">
						1 Aug 2017, 17:31					</div>
				</div>
				<div class="post-content content">
					<p>is this the correct place for my question?</p><p>Or does it belong to the developers-section?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p363016">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">mk24</div>
					<div class="post-datetime">
						1 Aug 2017, 21:06					</div>
				</div>
				<div class="post-content content">
					<p>With only one Ethernet port, make the router a LAN device.<br />First connect only to aPC.<br />Change IP to one that is in your LAN<br />Set DNS and gateway to your main router&#039;s IP<br />Turn off DHCP server in /etc/config/dhcp<br />Now connect router and PC to your LAN and log in on new address.<br />You should now be able to run opkg update, etc.</p><p>Or you can install packages without connecting the router to the internet two ways:<br /> Use image builder to make a custom image with packages you need.<br />Or find and download the .ipk file from the image server packages/ directory.&nbsp; SCP it to the router&#039;s /tmp directory then run <br />opkg install /tmp/filename.ipk<br />You may get an error of missing dependencies.&nbsp; In that case, download transfer and install those packages first.</p><p>Installing kmod-usb-hid (and it&#039;s dependencies) on a machine like the Futro should let you run a local control shell with a USB keyboard and VGA screen.</p>											<p class="post-edited">(Last edited by <strong>mk24</strong> on 1 Aug 2017, 21:17)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p363056">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">AugustQ</div>
					<div class="post-datetime">
						2 Aug 2017, 16:09					</div>
				</div>
				<div class="post-content content">
					<p>Hi mk24,</p><p>I think this discussion goes in a wrong direction. </p><p>What I have: a working Futro, using the Huawei-stick to connect to the internet. Tested, works.</p><p>What I want to do: write a documentation explaining all the steps needed to come to this point.</p><p>But as I&#039;ve already described in my post #8 I went through a detour using a USB-LAN-adapter which I do not need. It&#039;s only used for the trick: create eth1 (which later is done by the Huawei-stick).</p><p>So if you don&#039;t have such an adapter what do you do?</p><p>So my question is: when I install the software (eth0 is detected), configure the system, connect to the internet and load the packages needed, insert the Huawei-stick (now eth1 is created). how can I create NOW the new configuration?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p363062">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">mk24</div>
					<div class="post-datetime">
						2 Aug 2017, 16:47					</div>
				</div>
				<div class="post-content content">
					<p>Make the machine a device on an existing LAN as I described, so OpenWrt can download from the Internet.</p><p>Install drivers necessary for 4G modem.&nbsp; Plug in the modem.&nbsp; </p><p>Now that you have a physical wan device, go to the wan section of /etc/config/network and add a line: option device eth1.&nbsp; (In some cases a USB modem will come up as usb0, use that instead) I&#039;m pretty sure that a wan network and firewall zone will be created even on single port machines, but the single port will be connected to the lan and the wan will have no physical connection.</p><p>Also reconfigure the lan to again make it a primary router with DHCP server.&nbsp; Delete the DNS and gateway settings as those will now be picked up by DHCP from the modem and the wireless carrier. Disconnect from the existing LAN you can now use it independently.</p>											<p class="post-edited">(Last edited by <strong>mk24</strong> on 2 Aug 2017, 16:52)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p363063">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">AugustQ</div>
					<div class="post-datetime">
						2 Aug 2017, 16:51					</div>
				</div>
				<div class="post-content content">
					<p>I would like to describe the situation from a different angle:</p><p>after copying the image-file to the Futro I can mount /dev/sda2 (/dev/sda is the flash-memory of the Futro in Knoppix). So I can see the file /etc/config/network - initially it has a size of approx. 500 bytes.</p><p>So leaving Knoppix and booting the Futro with OpenWrt I see that the file /etc/config/network changed: it now has a current timestamp and it also has a size of approx. 2K.</p><p>How is this done? Can I start the same process manually?</p><p>The reason for this: the Huawei-stick is detected too late so the configuration written does not contain the statements for using this stick.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>