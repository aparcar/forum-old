<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> PublicKey authenticated SSH /FROM/ OpenWRT</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 1 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p20481">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">bobpaul</div>
					<div class="post-datetime">
						8 Feb 2006, 22:30					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;d like to ssh FROM my router to my desktop without using a password so I can script things on the router. I can do the reverse just fine by following the instructions on the <a href="http://wiki.openwrt.org/DropbearPublicKeyAuthenticationHowto">wiki</a>.</p><p>I&#039;ve tried adding the contents of `nvram get eou_public_key` to my local ~/.ssh/authorized_keys prefacing it with both ssh-rsa and ssh-dsa and suffixing it with root@OpenWrt, but that doesn&#039;t work. I&#039;ve also tried using dropbearkey on both /etc/dropbear/dropbear_rsa_host_key and dropbear_dsa_host_key to generate the public key using what I believe are my current private keys, but that hasn&#039;t worked either.</p><p>What has worked is something I&#039;m not too keen on as it requires me to share the private key of a local user account.</p><p>I logged in as the samba user (has limited rights) and made an identity file by issuing the command on my desktop:<br /><strong>su samba<br />ssh-keygen -t rsa</strong><br />Then I made that identity authorized to access my desktop by doing<br /><strong>cat ~/.ssh/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys</strong><br />I then scp&#039;d the ~/.ssh/id_rsa private key file it created to my router.</p><p>Then on the router, I had to convert that to a format dropbear would use. Do that with<br /><strong>dropbearconvert openssh dropbear id_rsa /etc/dropbear/samba_identity</strong></p><p>I can now ssh, scp, shfsmount, etc into my local computer by using the identity file without worry of plain text passwords:<br /><strong>ssh -i /etc/samba_identity samba@192.168.1.2</strong></p><p>Has anone gotten this working without the need for an identity file?</p><p>[Edit] Spelling mistake, and confusing sentence</p>											<p class="post-edited">(Last edited by <strong>bobpaul</strong> on 8 Feb 2006, 22:31)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p22876">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">gojoors</div>
					<div class="post-datetime">
						15 Mar 2006, 12:08					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>I&#039;ve been trying to do this also.</p><p>In fact you don&#039;t need to share the private key of a local user account. Yes, you must have a user account to login from the router, but you can have a private key dedicated to the router.<br />So, <br />on the router :<br />- a private key : generated by dropbear or converted from openssh, stored in <strong>&#039;/etc/dropbear/dopbear_rsa_host_key&#039;</strong><br />- the public key from the _desktop__host_ (ie the one from <strong>&#039;/etc/ssh/id_rsa.pub&#039;</strong>) in <strong>&#039;/tmp/.ssh/known_hosts&#039;</strong> to avoid the message &#039;...is not a known host...(y/n)?&#039;... I think it is better to store it elsewhere (<strong>&#039;/etc/dropbear/&#039;</strong>) and copy it there at boot time (<strong>&#039;/etc/init.d/S50dropbear&#039;</strong>), otherwise it will be lost during a reboot.</p><p>on the desktop user account :<br />- the public key from the router in <strong>&#039;~/.ssh/authorized_keys&#039;</strong>.<br /> you can generate it with dropbear using :<br /></p><div class="codebox"><pre><code>dropbearkey -y -f /etc/dropbear_rsa_host_key | grep ssh-rsa &gt; /tmp/dropbear_rsa_host_key.pub</code></pre></div><p>Then you can add <strong>root@$router_hostname</strong> at the end of the line so the file looks like &#039;ssh-rsa $key root@router_hostname&#039;<br />Just add the content of this file to <strong>&#039;~/.ssh/authorized_keys&#039;</strong> and your router will be authorized when accessing with <strong>&#039;ssh -i /etc/dropbear/dopbear_rsa_host_key $user@$desktop&#039;</strong></p><p>It seems that dropbear doesn&#039;t use public key authentication without the &#039;-i&#039; option&#039; in the command line, so it is really needed.</p><p>let&#039;s go scripting now !</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p26413">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">sancho</div>
					<div class="post-datetime">
						2 May 2006, 00:54					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for this small how-to - it helped me a lot right now...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p30044">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">Nicson</div>
					<div class="post-datetime">
						6 Jul 2006, 03:43					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>gojoors wrote:</cite><blockquote><p>It seems that dropbear doesn&#039;t use public key authentication without the &#039;-i&#039; option&#039; in the command line, so it is really needed.</p></blockquote></div><p>Yes, but I added an alias for it in /etc/profile:</p><p>alias ssh=&#039;ssh -i /etc/dropbear/dropbear_rsa_host_key&#039;</p><p>or</p><p>alias ssh=&#039;ssh -i /etc/dropbear/dropbear_dss_host_key&#039;</p><p>if you prefere dss :P</p><p>with this you can use the ssh command just as if you had your $HOME/.ssh/id-*.pub</p><p>ssh user@host</p><p>=)</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>