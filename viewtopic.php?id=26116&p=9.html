<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Atheros only! - Next Generation Piranha firmware (v4) + AAP (v3)</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 20 Aug 2015 and 21 Apr 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 9 of 13</div><nav><ul><li><a href="viewtopic.php%3Fid=26116&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=26116&amp;p=7.html">7</a></li><li><a href="viewtopic.php%3Fid=26116&amp;p=8.html">8</a></li><li class="pagination-current"><span>9</span></li><li><a href="viewtopic.php%3Fid=26116&amp;p=10.html">10</a></li><li><a href="viewtopic.php%3Fid=26116&amp;p=11.html">11</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=26116&amp;p=13.html">13</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p137105">
				<div class="post-metadata">
					<div class="post-num">Post #201</div>
					<div class="post-author">muttnik</div>
					<div class="post-datetime">
						13 Jun 2011, 21:19					</div>
				</div>
				<div class="post-content content">
					<p>I too am interested in obtaining a copy of Piranha if it is available anywhere.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p137434">
				<div class="post-metadata">
					<div class="post-num">Post #202</div>
					<div class="post-author">bulanula</div>
					<div class="post-datetime">
						18 Jun 2011, 14:33					</div>
				</div>
				<div class="post-content content">
					<p>The plot thickens. Seems like Seth7 also has disappeared ???</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p137574">
				<div class="post-metadata">
					<div class="post-num">Post #203</div>
					<div class="post-author">muttnik</div>
					<div class="post-datetime">
						20 Jun 2011, 18:24					</div>
				</div>
				<div class="post-content content">
					<p>I thought the internet was &quot;forever&quot;.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p137623">
				<div class="post-metadata">
					<div class="post-num">Post #204</div>
					<div class="post-author">bulanula</div>
					<div class="post-datetime">
						21 Jun 2011, 19:08					</div>
				</div>
				<div class="post-content content">
					<p>LOL not really. </p><p>Piranha now is completely unavailable.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p138022">
				<div class="post-metadata">
					<div class="post-num">Post #205</div>
					<div class="post-author">Seth7</div>
					<div class="post-datetime">
						28 Jun 2011, 04:45					</div>
				</div>
				<div class="post-content content">
					<p>I know I have it saved somewhere .... just not found yet.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p138287">
				<div class="post-metadata">
					<div class="post-num">Post #206</div>
					<div class="post-author">Seth7</div>
					<div class="post-datetime">
						1 Jul 2011, 08:00					</div>
				</div>
				<div class="post-content content">
					<p>Getting close .... about when were they last accessible ?<br/>I can&#039;t remember ... it was an image for Fibers right? ... <br/>A squash.bin and .lzma?</p><p>Iv found a couple saved files just not sure if its for the fin or much older WRT54G version ...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p138288">
				<div class="post-metadata">
					<div class="post-num">Post #207</div>
					<div class="post-author">Seth7</div>
					<div class="post-datetime">
						1 Jul 2011, 08:00					</div>
				</div>
				<div class="post-content content">
					<p>Fonera</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p139483">
				<div class="post-metadata">
					<div class="post-num">Post #208</div>
					<div class="post-author">orange</div>
					<div class="post-datetime">
						20 Jul 2011, 13:23					</div>
				</div>
				<div class="post-content content">
					<p>Mates,</p><p>I just like to provide some insight into the recent happenings with Piranha/AAP, i.e. to end the confusion. First of all, heliohost.org terminated my free hosting account to unknown reasons without any warning in advance - I guess I missed to login too often to their forums/cpanel and CRUNCH BANG! I&#039;m pretty sorry for that! It has never been my intention to take it offline. That said, I currently cannot afford the spare time to start the website from scratch. Also I&#039;m not that sure when I will continue to work on Piranha/AAP as I simply lack the sufficient time to actually do so (it always has been VERY time consuming and there are other issues on the table very important to me personally). I too often have promised to continue improving the script and now I better say its future is unclear.</p><p>If your only problem with your particular device is an incompatibility with the underlying Backfire 10.03, you may just checkout a working revision from SVN, apply the AAP madwifi-patch (there are several copies around, e.g. at borgbox developers), introduce the script and you&#039;re ready to go - there isn&#039;t too much magic involved here. You just need to invest some time to come up with it.</p><p>All that said, I haven&#039;t declared Piranha/AAP (my &quot;baby&quot;) dead for an indefinite amount of time but I cannot forecast when I&#039;ll again get to it. As I see, e.g. Seth7 has a backup of the latest version - may you please redistribute it in some sort to the rest of the community?</p><p>Have a good time everyone (until we hear/see us again),<br/>orange</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p139949">
				<div class="post-metadata">
					<div class="post-num">Post #209</div>
					<div class="post-author">Seth7</div>
					<div class="post-datetime">
						26 Jul 2011, 05:45					</div>
				</div>
				<div class="post-content content">
					<p>Glad your ok ... darn ... now I gota verify that what I have is/was the last image .... ill have it loaded onto a fresh Fon ( getting close to one of my last) and if it ill post it.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p140096">
				<div class="post-metadata">
					<div class="post-num">Post #210</div>
					<div class="post-author">bulanula</div>
					<div class="post-datetime">
						27 Jul 2011, 17:44					</div>
				</div>
				<div class="post-content content">
					<p>News anyone ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p140149">
				<div class="post-metadata">
					<div class="post-num">Post #211</div>
					<div class="post-author">orange</div>
					<div class="post-datetime">
						28 Jul 2011, 12:00					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>bulanula wrote:</cite><blockquote><p>News anyone ?</p></blockquote></div><p>Do you, or anyone else, have a webhost directory where I may upload the latest Piranha v4/AAP v3 to (via FTP)? I SHOULD have a copy of Piranha v4/AAP v3 on my old buildhost still. Please drop me a line (via PM) to provide FTP access or something. I&#039;ll see what I can do.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p140201">
				<div class="post-metadata">
					<div class="post-num">Post #212</div>
					<div class="post-author">bulanula</div>
					<div class="post-datetime">
						29 Jul 2011, 00:34					</div>
				</div>
				<div class="post-content content">
					<p>You can use a free service like megaupload or rapidshare etc. ? Or maybe on the openwrt servers. Otherwise, I do not have a FTP server right now sorry. Maybe somebody else ???</p><p>So, are you saying that this latest Piranha is based on a recent OpenWRT build so it might work on my microredboot EOC-2610P too ??? Or just the same old august 2010 version from last year ??</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p140242">
				<div class="post-metadata">
					<div class="post-num">Post #213</div>
					<div class="post-author">Seth7</div>
					<div class="post-datetime">
						29 Jul 2011, 16:12					</div>
				</div>
				<div class="post-content content">
					<p>I don&#039;t ..</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p140500">
				<div class="post-metadata">
					<div class="post-num">Post #214</div>
					<div class="post-author">spyd3rweb</div>
					<div class="post-datetime">
						3 Aug 2011, 01:28					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>orange wrote:</cite><blockquote><p>Do you, or anyone else, have a webhost directory where I may upload the latest Piranha v4/AAP v3 to (via FTP)?</p></blockquote></div><p>Orange,</p><p>Would it be possible for you to dump your latest Piranha v4/APP v3 firmware/docs to a free repository at either code.google.com or github.com and link it back to this thread? I believe this is really one of the only ways to preserve your work for the masses.</p><p>Just FYI, borgbox.com has gone the way of piranha.pwnz.org, and unfortunately google search cache is really the only way there is for recovering any of the borgbox documentation. Fortunately he used a github.com repository to save his firmware:<br/><a href="http://github.com/downloads/guinness1/borgbox/borgboxV3-beta-om1p-atheros-release.tgz">http://github.com/downloads/guinness1/b … elease.tgz</a></p><p>We all appreciate the hardwork that you&#039;ve put into the Piranha firmware, hopefully we can preserve it... and we look forward to having you back in the near future.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p140623">
				<div class="post-metadata">
					<div class="post-num">Post #215</div>
					<div class="post-author">orange</div>
					<div class="post-datetime">
						4 Aug 2011, 23:37					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>spyd3rweb wrote:</cite><blockquote><div class="quotebox"><cite>orange wrote:</cite><blockquote><p>Do you, or anyone else, have a webhost directory where I may upload the latest Piranha v4/AAP v3 to (via FTP)?</p></blockquote></div><p>Orange,</p><p>Would it be possible for you to dump your latest Piranha v4/APP v3 firmware/docs to a free repository at either code.google.com or github.com and link it back to this thread? I believe this is really one of the only ways to preserve your work for the masses.</p><p>Just FYI, borgbox.com has gone the way of piranha.pwnz.org, and unfortunately google search cache is really the only way there is for recovering any of the borgbox documentation. Fortunately he used a github.com repository to save his firmware:<br/><a href="http://github.com/downloads/guinness1/borgbox/borgboxV3-beta-om1p-atheros-release.tgz">http://github.com/downloads/guinness1/b … elease.tgz</a></p><p>We all appreciate the hardwork that you&#039;ve put into the Piranha firmware, hopefully we can preserve it... and we look forward to having you back in the near future.</p></blockquote></div><p>OK, I just thought a bit about a possible future of AAP/Piranha and here are my (intermediate) results/ideas ... There seem to be some interest in continuing the project and that&#039;s appreciated!</p><p>1. I&#039;ll no longer develop a stand-alone firmware &quot;Piranha&quot; but rather a so-to-speak &quot;universal AAP&quot; that should work upon default OpenWrt Backfire/Attitude Adjustment, if possible. I think this would be a win!win! for both the community and myself.</p><p>2. To achieve this, I&#039;m going to get rid of the patched madwifi-ng/wlanconfig dependency and utilize &quot;iwinfo&quot; instead. Afaik, it provides &quot;universal&quot; scan results across the device spectrum and is thus usable with multiple chipsets (to be verified).</p><p>3. As a logical result, I&#039;ll distribute AAP (v4) as a standalone script (and maybe a setup routine) that anyone with a router/AP already running OpenWrt (Atheros, Broadcom, what not ...) may upload and use with their device.</p><p>4. I plan to use some public repository (github, google code, etc ...) to distribute the script and I&#039;m going to provide a NEW support/documentation thread for AAP (v4) at OpenWrt forums. No more website maintenance.</p><p>5. I certainly will try to adress issues discussed here over the last year with the further development of AAP (v4). Maybe I&#039;ll even change the name of the script while doing all these changes in order to get rid of AutoAP comparisons (suggestions welcome) ... In the end, AAP has NOTHING, maybe VERY little, to do with AutoAP for dd-wrt.</p><p>6. Due to all these plans/ideas, I don&#039;t feel the urgent need to (re-)distribute AAP v3 and/or Piranha v4. Let me know if you feel different. I would need to wake my old build server and &quot;he&quot; is currently rather &quot;unaccessible&quot;, i.e. dead!</p><p>All that said, I won&#039;t promise any ETA (I actually can&#039;t even do this due to the current life situation) as this (1 to 6) requires both a rather comprehensive re-write of the current AAP as well as some chitchat with appropriate developers, especially jow (in order to get sufficient info about iwinfo capabilities).</p><p>Last but not least, I&#039;m curious what you think about these thoughts/ideas ... Just my current 0.02$.</p><p>Thanks,<br/>orange</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p140797">
				<div class="post-metadata">
					<div class="post-num">Post #216</div>
					<div class="post-author">orange</div>
					<div class="post-datetime">
						8 Aug 2011, 03:49					</div>
				</div>
				<div class="post-content content">
					<p>OK, good news! I took the time to slightly (very slightly actually) modify AAP v3 100813 to work (with one minor restriction) with default OpenWrt Backfire up to 10.03.1-rc5.</p><p>To make it very clear: This is &quot;only&quot; a slightly modified AAP v3 100813 and not the previously announced new AAP v4 (yet), but it&#039;s usable outside Piranha v4! The said restriction is that you can only connect to SSIDs with 14 characters at maximum (this restriction is due to the missing madwifi-ng patch with default OpenWrt Backfire). This modified AAP v3 100813 will ONLY work with Atheros devices running madwifi-ng drivers, Attitude Adjustment is thus not supported. See this offer as a quick fix in order to again distribute AAP to the community until AAP v4 is out the door.</p><p>So far the foreword ...</p><p>scp the following script to your device filesytem at /bin/aap and &quot;chmod +x&quot; it</p><div class="codebox"><pre><code>#!/bin/sh
aap_uci() {
rm -f /tmp/aap_hlst3 /tmp/aap_mlst3 /tmp/aap_wlst3
uci show aap | awk &#039;/^aap.@aap/ {print substr($0,13)}&#039; | awk NR!=1 &gt; /tmp/aap_vtmp
aap_autostart=`awk &#039;/^autostart=/ {print substr($0,11)}&#039; /tmp/aap_vtmp`
if [ `grep -c &quot;^/bin/aap start&quot; /etc/rc.local` != &quot;0&quot; ] &amp;&amp; [ $aap_autostart -eq 0 ]; then
    awk &#039;!/^\/bin\/aap start/&#039; /etc/rc.local &gt; /tmp/aap_autostart
    cp /tmp/aap_autostart /etc/rc.local
fi
if [ `grep -c &quot;^/bin/aap start&quot; /etc/rc.local` = &quot;0&quot; ] &amp;&amp; [ $aap_autostart -eq 1 ]; then
    awk &#039;!/^exit 0/&#039; /etc/rc.local &gt; /tmp/aap_autostart
    echo -e &quot;/bin/aap start\nexit 0&quot; &gt;&gt; /tmp/aap_autostart
    cp /tmp/aap_autostart /etc/rc.local
fi
aap_checkfreq=`awk &#039;/^checkfreq=/ {print substr($0,11)}&#039; /tmp/aap_vtmp`
aap_dhcptimeout=`awk &#039;/^dhcptimeout=/ {print substr($0,13)}&#039; /tmp/aap_vtmp`
aap_ineturl=`awk &#039;/^ineturl=/ {print substr($0,9)}&#039; /tmp/aap_vtmp`
aap_logenable=`awk &#039;/^logenable=/ {print substr($0,11)}&#039; /tmp/aap_vtmp`
aap_prefonly=`awk &#039;/^prefonly=/ {print substr($0,10)}&#039; /tmp/aap_vtmp`
aap_rescandelay2=`awk &#039;/^rescandelay=/ {print substr($0,13)}&#039; /tmp/aap_vtmp`
aap_dtmp=$(($aap_rescandelay2%5))
aap_rescandelay=$(($aap_rescandelay2-$aap_dtmp))
aap_warndelay=`awk &#039;/^warndelay=/ {print substr($0,11)}&#039; /tmp/aap_vtmp`
aap_watchinet=`awk &#039;/^watchinet=/ {print substr($0,11)}&#039; /tmp/aap_vtmp`
uci show aap | awk &#039;substr($0,27) ~ /^blst=1$/ {print substr($0,6,17)}&#039; &gt; /tmp/aap_blst
uci show aap | awk &#039;substr($0,27) ~ /^ssid=/ {print substr($0,6,17)}&#039; &gt; /tmp/aap_hlst2
aap_hlst2=`awk &#039;{printf(&quot;%s\t&quot;, $0)}&#039; /tmp/aap_hlst2`
aap_hcount=`wc -l &lt; /tmp/aap_hlst2`
a=1
while [ $a -le $aap_hcount ]; do
    aap_hlst=`echo &quot;$aap_hlst2&quot; | awk -F&quot;$(printf &#039;\t&#039;)&quot; -v a=&quot;$a&quot; &#039;{print $a}&#039;`
    uci get aap.@$aap_hlst[0].ssid &gt;&gt; /tmp/aap_hlst3
    a=$(($a+1))
done
uci show aap | awk &#039;substr($0,27) ~ /^fakemac=/ {print substr($0,6,17)}&#039; &gt; /tmp/aap_mlst2
aap_mlst2=`awk &#039;{printf(&quot;%s\t&quot;, $0)}&#039; /tmp/aap_mlst2`
aap_mcount=`wc -l &lt; /tmp/aap_mlst2`
b=1
while [ $b -le $aap_mcount ]; do
    aap_mlst=`echo &quot;$aap_mlst2&quot; | awk -F&quot;$(printf &#039;\t&#039;)&quot; -v b=&quot;$b&quot; &#039;{print $b}&#039;`
    uci get aap.@$aap_mlst[0].fakemac &gt;&gt; /tmp/aap_mlst3
    b=$(($b+1))
done
uci show aap | awk &#039;substr($0,27) ~ /^key=/ {print substr($0,6,17)}&#039; &gt; /tmp/aap_wlst2
aap_wlst2=`awk &#039;{printf(&quot;%s\t&quot;, $0)}&#039; /tmp/aap_wlst2`
aap_wcount=`wc -l &lt; /tmp/aap_wlst2`
c=1
while [ $c -le $aap_wcount ]; do
    aap_wlst=`echo &quot;$aap_wlst2&quot; | awk -F&quot;$(printf &#039;\t&#039;)&quot; -v c=&quot;$c&quot; &#039;{print $c}&#039;`
    uci get aap.@$aap_wlst[0].key &gt;&gt; /tmp/aap_wlst3
    c=$(($c+1))
done
awk -v OFS=&quot;$(printf &#039;\t&#039;)&quot; &#039;NR==FNR{v[FNR]=$0;next} {print v[FNR],$0}&#039; /tmp/aap_hlst2 /tmp/aap_hlst3 | awk -F&quot;$(printf &#039;\t&#039;)&quot; &#039;{if($2 !~ /^ *$/) print $0}&#039; &gt; /tmp/aap_hlst
awk -v OFS=&quot;$(printf &#039;\t&#039;)&quot; &#039;NR==FNR{w[FNR]=$0;next} {print w[FNR],$0}&#039; /tmp/aap_mlst2 /tmp/aap_mlst3 | awk -F&quot;$(printf &#039;\t&#039;)&quot; &#039;{if($2 !~ /^ *$/) print $0}&#039; &gt; /tmp/aap_mlst
awk -v OFS=&quot;$(printf &#039;\t&#039;)&quot; &#039;NR==FNR{y[FNR]=$0;next} {print y[FNR],$0}&#039; /tmp/aap_wlst2 /tmp/aap_wlst3 | grep -ivf /tmp/aap_blst &gt; /tmp/aap_wlst
}
aap_scan() {
rm -f /tmp/aap_rlst2
wlanconfig ath0 list scan | awk &#039;NR!=1&#039; | awk -v tab=&quot;$(printf &#039;\t&#039;)&quot; &#039;{gsub(/  +/,tab)}1&#039; | awk -F&quot;$(printf &#039;\t&#039;)&quot; &#039;BEGIN{OFS=&quot;  &quot;}{gsub(&quot; &quot;,&quot;  &quot;,$4);gsub(&quot; &quot;,&quot;  &quot;,$5);gsub(&quot; &quot;,&quot;  &quot;,$6);gsub(&quot; &quot;,&quot;  &quot;,$7);print}&#039; | awk -F&quot;  &quot; -v OFS=&quot;$(printf &#039;\t&#039;)&quot; &#039;{split($5,snr,&quot;:&quot;);print snr[1],$1,$2,$3,$7,$8}&#039; | awk -F&quot;$(printf &#039;\t&#039;)&quot; -v OFS=&quot;$(printf &#039;\t&#039;)&quot; &#039;{if($6==&quot;RSN&quot;) enc=&quot;psk2&quot;;else if($6==&quot;WPA&quot;) enc=&quot;psk&quot;;else if($5~/P/) enc=&quot;wep&quot;;else if($5!~/P/) enc=&quot;none&quot;;print $1,$2,$3,$4,enc}&#039; &gt; /tmp/aap_slst
awk -F &quot;$(printf &#039;\t&#039;)&quot; -v OFS=&quot;$(printf &#039;\t&#039;)&quot; &#039;NR==FNR{x[tolower($1)]=$2;next}{if(x[$3]) print $1,$2,$3,$4,$5,x[$3]}&#039; /tmp/aap_wlst /tmp/aap_slst | grep -ivf /tmp/aap_blst &gt; /tmp/aap_rlst2
if [ $aap_prefonly -eq 0 ]; then
    awk -F&quot;$(printf &#039;\t&#039;)&quot; &#039;$NF == &quot;none&quot;&#039; /tmp/aap_slst | grep -ivf /tmp/aap_blst &gt;&gt; /tmp/aap_rlst2
fi
sort -nrt&quot;$(printf &#039;\t&#039;)&quot; -k1 /tmp/aap_rlst2 | uniq &gt; /tmp/aap_rlst
aap_apcount=`wc -l &lt; /tmp/aap_rlst`
}
aap_varupdate() {
rm -f /tmp/aap_htmp
channel=`awk -F&quot;$(printf &#039;\t&#039;)&quot; &#039;{printf(&quot;%i\t&quot;, $4)}&#039; /tmp/aap_rlst`
ssid=`awk -F&quot;$(printf &#039;\t&#039;)&quot; &#039;{printf(&quot;%s\t&quot;, $2)}&#039; /tmp/aap_rlst`
bssid=`awk -F&quot;$(printf &#039;\t&#039;)&quot; &#039;{printf(&quot;%s\t&quot;, $3)}&#039; /tmp/aap_rlst`
encryption=`awk -F&quot;$(printf &#039;\t&#039;)&quot; &#039;{printf(&quot;%s\t&quot;, $5)}&#039; /tmp/aap_rlst`
key=`awk -F&quot;$(printf &#039;\t&#039;)&quot; &#039;{printf(&quot;%s\t&quot;, $6)}&#039; /tmp/aap_rlst`
k=1
while [ $k -le $aap_apcount ]; do
    ssid2=`echo &quot;$ssid&quot; | awk -F&quot;$(printf &#039;\t&#039;)&quot; -v k=&quot;$k&quot; &#039;{print $k}&#039;`
    if [ -z &quot;$ssid2&quot; ] || [ &quot;$(echo &quot;$ssid2&quot; | grep -c ^0x0*)&quot; -ne 0 ]; then
#    if [ -z &quot;$ssid2&quot; ] || [ &quot;$(echo &quot;$ssid2&quot; | grep -c ^0x0*$)&quot; -ne 0 ]; then
        hidden=1
    else
        hidden=0
    fi
    echo $hidden &gt;&gt; /tmp/aap_htmp
    k=$(($k+1))
done
hidden2=`awk &#039;{printf(&quot;%i\t&quot;,$0)}&#039; /tmp/aap_htmp`
}
aap_counter() {
echo &quot;0&quot; &gt; /tmp/aap_ctmp
while [ $aap_count -lt $aap_rescandelay ]; do
    sleep 5
    aap_count=$(($aap_count+5))
    echo $aap_count &gt; /tmp/aap_ctmp
done
}
aap_check() {
echo &quot;&quot; &gt; /tmp/aap_ptmp
echo &quot;&quot; &gt; /tmp/aap_ptmp3
while true; do
    if [ $aap_watchinet -eq 1 ]; then
        ping -c 3 $aap_ineturl &gt; /tmp/aap_ptmp2 2&gt; /dev/null
    else
        ping -c 3 $(netstat -r | awk &#039;/default/ {print $2}&#039;) &gt; /tmp/aap_ptmp2 2&gt; /dev/null
    fi
    aap_ping_status=$?
    aap_ping=`awk &#039;/packets/ {split($7, z, &quot;%&quot;); print z[1]}&#039; /tmp/aap_ptmp2`
    echo $aap_ping_status &gt; /tmp/aap_ptmp3
    echo $aap_ping &gt; /tmp/aap_ptmp
    sleep $aap_checkfreq
done
}
aap_connect() {
aap_channel=`echo &quot;$channel&quot; | awk -F&quot;$(printf &#039;\t&#039;)&quot; -v j=&quot;$j&quot; &#039;{print $j}&#039;`
aap_bssid=`echo &quot;$bssid&quot; | awk -F&quot;$(printf &#039;\t&#039;)&quot; -v j=&quot;$j&quot; &#039;{print $j}&#039;`
aap_hidden=`echo &quot;$hidden2&quot; | awk -F&quot;$(printf &#039;\t&#039;)&quot; -v j=&quot;$j&quot; &#039;{print $j}&#039;`
if [ `grep -ic $aap_bssid /tmp/aap_hlst` = &quot;1&quot; ] &amp;&amp; [ $aap_hidden -eq 1 ]; then
    aap_ssid=`grep -i $aap_bssid /tmp/aap_hlst | awk -F&quot;$(printf &#039;\t&#039;)&quot; &#039;{print $2}&#039;`
else
    aap_ssid=`echo &quot;$ssid&quot; | awk -F&quot;$(printf &#039;\t&#039;)&quot; -v j=&quot;$j&quot; &#039;{print $j}&#039;`
fi
aap_encryption=`echo &quot;$encryption&quot; | awk -F&quot;$(printf &#039;\t&#039;)&quot; -v j=&quot;$j&quot; &#039;{print $j}&#039;`
aap_key=`echo &quot;$key&quot; | awk -F&quot;$(printf &#039;\t&#039;)&quot; -v j=&quot;$j&quot; &#039;{print $j}&#039;`
if [ `grep -ic $aap_bssid /tmp/aap_mlst` = &quot;1&quot; ]; then
    aap_fakemac=`grep -i $aap_bssid /tmp/aap_mlst | awk -F&quot;$(printf &#039;\t&#039;)&quot; &#039;{print $2}&#039;`
    wlanconfig ath0 destroy
    macchanger -m $aap_fakemac wifi0
    wlanconfig ath0 create wlandev wifi0 wlanmode sta
else
    wlanconfig ath0 destroy
    macchanger -A wifi0
    wlanconfig ath0 create wlandev wifi0 wlanmode sta
fi
uci set wireless.wifi0.channel=$aap_channel
uci set wireless.@wifi-iface[0].ssid=&quot;$aap_ssid&quot;
uci set wireless.@wifi-iface[0].bssid=$aap_bssid
uci set wireless.@wifi-iface[0].hidden=$aap_hidden
uci set wireless.@wifi-iface[0].encryption=$aap_encryption
uci set wireless.@wifi-iface[0].key=$aap_key
ifup wan
/sbin/wifi
}
aap_main() {
while true; do
    aap_uci
    aap_scan
    if [ $aap_apcount -ne 0 ]; then
        aap_varupdate
        aap_count=0
        aap_counter &amp;
        aap_counter_pid=$!
        echo $aap_counter_pid &gt; /var/run/aap_counter.pid
        aap_count2=0
        j=1
        if [ $aap_logenable -eq 1 ]; then
            logger -p user.info -t aap[$(awk &#039;{print $0}&#039; /var/run/aap_main.pid)] &quot;(re-)scan done, $aap_apcount suitable APs found in range, initiating connection attempt(s)&quot;
        fi
        while [ $j -le $aap_apcount ] &amp;&amp; [ $aap_count2 -ne $aap_rescandelay ]; do
            aap_count2=`awk &#039;{print $0}&#039; /tmp/aap_ctmp`
            while [ -z &quot;$aap_count2&quot; ]; do
                sleep 1
                aap_count2=`awk &#039;{print $0}&#039; /tmp/aap_ctmp`
            done
            aap_connect
            sleep $aap_dhcptimeout
            aap_check &amp;
            aap_check_pid=$!
            echo $aap_check_pid &gt; /var/run/aap_check.pid
            sleep 3
            aap_ping_status2=`awk &#039;{print $0}&#039; /tmp/aap_ptmp3`
            while [ -z &quot;$aap_ping_status2&quot; ]; do
                sleep 1
                aap_ping_status2=`awk &#039;{print $0}&#039; /tmp/aap_ptmp3`
            done
            if [ $aap_ping_status2 -eq 0 ]; then
                aap_ping2=0
                if [ $aap_logenable -eq 1 ]; then
                    logger -p user.info -t aap[$(awk &#039;{print $0}&#039; /var/run/aap_main.pid)] &quot;connected to AP $aap_bssid on channel $aap_channel with WAN IP $(ifconfig ath0 | awk &#039;/inet/ {print substr($2,6)}&#039;)&quot;
                fi
            else
                aap_ping2=100
            fi
            while [ $aap_ping2 -ne 100 ] &amp;&amp; [ $aap_count2 -ne $aap_rescandelay ]; do
                aap_ping_status2=`awk &#039;{print $0}&#039; /tmp/aap_ptmp3`
                while [ -z &quot;$aap_ping_status2&quot; ]; do
                    sleep 1
                    aap_ping_status2=`awk &#039;{print $0}&#039; /tmp/aap_ptmp3`
                done
                if [ $aap_ping_status2 -eq 0 ]; then
                    aap_ping2=`awk &#039;{print $0}&#039; /tmp/aap_ptmp`
                    while [ -z &quot;$aap_ping2&quot; ]; do
                        sleep 1
                        aap_ping2=`awk &#039;{print $0}&#039; /tmp/aap_ptmp`
                    done
                else
                    aap_ping2=100
                fi
                aap_count2=`awk &#039;{print $0}&#039; /tmp/aap_ctmp`
                while [ -z &quot;$aap_count2&quot; ]; do
                    sleep 1
                    aap_count2=`awk &#039;{print $0}&#039; /tmp/aap_ctmp`
                done
                sleep 3
            done
            j=$(($j+1))
            kill $aap_check_pid
            if [ $aap_logenable -eq 1 ]; then
                if [ $j -le $aap_apcount ] &amp;&amp; [ $aap_count2 -ne $aap_rescandelay ]; then
                    logger -p user.info -t aap[$(awk &#039;{print $0}&#039; /var/run/aap_main.pid)] &quot;connection to AP $aap_bssid failed/skipped, trying next suitable AP&quot;
                elif [ $j -gt $aap_apcount ]; then
                    logger -p user.info -t aap[$(awk &#039;{print $0}&#039; /var/run/aap_main.pid)] &quot;connection to AP $aap_bssid failed/skipped, tried all suitable APs, initiating (re-)scan&quot;
                else
                    logger -p user.info -t aap[$(awk &#039;{print $0}&#039; /var/run/aap_main.pid)] &quot;(re-)scan delay of $aap_rescandelay seconds reached, initiating (re-)scan&quot;
                fi
            fi
        done
        kill $aap_counter_pid 2&gt; /dev/null
    else
        if [ $aap_logenable -eq 1 ]; then
            logger -p user.warn -t aap[$(awk &#039;{print $0}&#039; /var/run/aap_main.pid)] &quot;(re-)scan done, no suitable APs found in range, initiating (re-)scan in $aap_warndelay seconds&quot;
        fi
        sleep $aap_warndelay
    fi
done
}
aap_start() {
if [ ! -f /var/run/aap_main.pid ]; then
    aap_main &amp;
    echo $! &gt; /var/run/aap_main.pid
fi
}
aap_stop() {
kill $(awk &#039;{print $0}&#039; /var/run/aap_counter.pid) $(awk &#039;{print $0}&#039; /var/run/aap_check.pid) $(awk &#039;{print $0}&#039; /var/run/aap_main.pid)
rm -f /var/run/aap_counter.pid /var/run/aap_check.pid /var/run/aap_main.pid
}
case &quot;$1&quot; in
    enable)
        uci set aap.@aap[0].autostart=1
        if [ `grep -c &quot;^/bin/aap start&quot; /etc/rc.local` = &quot;0&quot; ]; then
            awk &#039;!/^exit 0/&#039; /etc/rc.local &gt; /tmp/aap_autostart
            echo -e &quot;/bin/aap start\nexit 0&quot; &gt;&gt; /tmp/aap_autostart
            cp /tmp/aap_autostart /etc/rc.local
        fi
        uci commit aap
        ;;
    disable)
        uci set aap.@aap[0].autostart=0
        if [ `grep -c &quot;^/bin/aap start&quot; /etc/rc.local` != &quot;0&quot; ]; then
            awk &#039;!/^\/bin\/aap start/&#039; /etc/rc.local &gt; /tmp/aap_autostart
            cp /tmp/aap_autostart /etc/rc.local
        fi
        uci commit aap
        ;;
    list)
        awk -F&quot;$(printf &#039;\t&#039;)&quot; &#039;{printf(&quot;%-3i %-32s %-17s %-2i %-4s %s\n&quot;,$1,$2,$3,$4,$5,$6)}&#039; /tmp/aap_rlst
        ;;
    log)
        logread | awk &#039;/aap/ {split($0,a,&quot;]: &quot;); split($6,b,&quot;p&quot;); split(b[2],c,&quot;:&quot;); print c[1],$3,a[2]}&#039;
        ;;
    skip)
        echo &quot;100&quot; &gt; /tmp/aap_ptmp
        ;;
    restart)
        aap_stop &gt; /dev/null 2&gt;&amp;1
        aap_start &gt; /dev/null 2&gt;&amp;1
        ;;
    start)
        aap_start &gt; /dev/null 2&gt;&amp;1
        ;;
    stop)
        aap_stop &gt; /dev/null 2&gt;&amp;1
        ;;
    *)
        echo -e &quot;\n  AAP v3 100813 - (C) 2009, 2010 by orange\n  http://piranha.pwnz.org\n\n  usage: `basename $0` [enable,disable,list,log,skip,restart,start,stop]\n&quot;
        exit
esac</code></pre></div><p>... and the following config to /etc/config/aap<br/></p><div class="codebox"><pre><code>config &#039;aap&#039;
    option &#039;autostart&#039; &#039;0&#039;
    option &#039;checkfreq&#039; &#039;60&#039;
    option &#039;dhcptimeout&#039; &#039;60&#039;
    option &#039;ineturl&#039; &#039;www.google.com&#039;
    option &#039;logenable&#039; &#039;1&#039;
    option &#039;prefonly&#039; &#039;0&#039;
    option &#039;rescandelay&#039; &#039;43200&#039;
    option &#039;warndelay&#039; &#039;120&#039;
    option &#039;watchinet&#039; &#039;1&#039;

config &#039;00:11:22:33:44:55&#039;
    option &#039;key&#039; &#039;00010203040506070809101112&#039;

config &#039;00:22:33:44:55:66&#039;
    option &#039;fakemac&#039; &#039;00:33:44:55:66:77&#039;

config &#039;00:44:55:66:77:88&#039;
    option &#039;ssid&#039; &#039;default&#039;

config &#039;00:55:66:77:88:99&#039;
    option &#039;blst&#039; &#039;1&#039;</code></pre></div><p>Last but not least you need to &quot;opkg install macchanger&quot; as an AAP v3 dependency and configure the /e/c/network and /e/c/wireless as follows ...<br/></p><div class="codebox"><pre><code>root@OpenWrt:~# cat /etc/config/network 
# Copyright (C) 2006 OpenWrt.org

config interface loopback
    option ifname    lo
    option proto    static
    option ipaddr    127.0.0.1
    option netmask    255.0.0.0
    
config interface wan
    option proto    dhcp
    
config interface lan
    option ifname    eth0
    option proto    static
    option ipaddr    10.0.0.1
    option netmask    255.255.255.0
root@OpenWrt:~# cat /etc/config/wireless 

config &#039;wifi-device&#039; &#039;wifi0&#039;
    option &#039;type&#039; &#039;atheros&#039;
    option &#039;channel&#039; &#039;auto&#039;
    option &#039;disabled&#039; &#039;0&#039;
    option &#039;country&#039; &#039;392&#039;

config &#039;wifi-iface&#039;
    option &#039;device&#039; &#039;wifi0&#039;
    option &#039;ssid&#039; &#039;OpenWrt&#039;
    option &#039;encryption&#039; &#039;none&#039;
    option &#039;network&#039; &#039;wan&#039;
    option &#039;mode&#039; &#039;sta&#039;</code></pre></div><p>For configuration questions regarding AAP v3, please read the AAP sections of <a href="https://forum.openwrt.org/viewtopic.php?pid=115174#p115174">https://forum.openwrt.org/viewtopic.php … 74#p115174</a> and <a href="https://forum.openwrt.org/viewtopic.php?pid=115182#p115182">https://forum.openwrt.org/viewtopic.php … 82#p115182</a> respectively.</p><p>If something is unclear, please don&#039;t hesitate to ask questions. I&#039;ll certainly streamline this with the upcoming release of AAP v4, but this is (as said above) my quick fix for you!</p><p>best,<br/>orange</p>											<p class="post-edited">(Last edited by <strong>orange</strong> on 8 Aug 2011, 03:59)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p141186">
				<div class="post-metadata">
					<div class="post-num">Post #217</div>
					<div class="post-author">Seth7</div>
					<div class="post-datetime">
						13 Aug 2011, 06:04					</div>
				</div>
				<div class="post-content content">
					<p>Ok ... I can give that a shot ins fresh Fon.....</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p142063">
				<div class="post-metadata">
					<div class="post-num">Post #218</div>
					<div class="post-author">bulanula</div>
					<div class="post-datetime">
						24 Aug 2011, 21:40					</div>
				</div>
				<div class="post-content content">
					<p>Hope everything is OK orange and you can get this project jump started again. </p><p>Thanks !</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p142271">
				<div class="post-metadata">
					<div class="post-num">Post #219</div>
					<div class="post-author">orange</div>
					<div class="post-datetime">
						27 Aug 2011, 11:58					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>bulanula wrote:</cite><blockquote><p>Hope everything is OK orange and you can get this project jump started again. </p><p>Thanks !</p></blockquote></div><p>It is, thanks! Reading your post, I&#039;m actually not sure if you really noticed that you can use AAP v3 RIGHT NOW on your &quot;microredboot EOC-2610P&quot; - Please re-read <a href="https://forum.openwrt.org/viewtopic.php?pid=140797#p140797">https://forum.openwrt.org/viewtopic.php … 97#p140797</a> and notice that default OpenWrt Backfire up to 10.03.1-rc5 is supported by the instructions I posted.</p><p>Looking forward to your testing results,<br/>orange</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p142557">
				<div class="post-metadata">
					<div class="post-num">Post #220</div>
					<div class="post-author">bulanula</div>
					<div class="post-datetime">
						31 Aug 2011, 00:58					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>orange wrote:</cite><blockquote><div class="quotebox"><cite>bulanula wrote:</cite><blockquote><p>Hope everything is OK orange and you can get this project jump started again. </p><p>Thanks !</p></blockquote></div><p>It is, thanks! Reading your post, I&#039;m actually not sure if you really noticed that you can use AAP v3 RIGHT NOW on your &quot;microredboot EOC-2610P&quot; - Please re-read <a href="https://forum.openwrt.org/viewtopic.php?pid=140797#p140797">https://forum.openwrt.org/viewtopic.php … 97#p140797</a> and notice that default OpenWrt Backfire up to 10.03.1-rc5 is supported by the instructions I posted.</p><p>Looking forward to your testing results,<br/>orange</p></blockquote></div><p>Yes I noticed but I don&#039;t really have enough time to try it out ATM. Thank you for everything ! Will let you know testing results ASAP as I get some time.</p>											<p class="post-edited">(Last edited by <strong>bulanula</strong> on 31 Aug 2011, 00:58)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p142693">
				<div class="post-metadata">
					<div class="post-num">Post #221</div>
					<div class="post-author">orange</div>
					<div class="post-datetime">
						1 Sep 2011, 12:08					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>bulanula wrote:</cite><blockquote><p>Yes I noticed but I don&#039;t really have enough time to try it out ATM. Thank you for everything ! Will let you know testing results ASAP as I get some time.</p></blockquote></div><p>OK, I&#039;m really looking forward to your testing results. Don&#039;t hesitate to ask if you need further assistance.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p142758">
				<div class="post-metadata">
					<div class="post-num">Post #222</div>
					<div class="post-author">bulanula</div>
					<div class="post-datetime">
						2 Sep 2011, 17:31					</div>
				</div>
				<div class="post-content content">
					<p>Sure, just need to get some time for it.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p143400">
				<div class="post-metadata">
					<div class="post-num">Post #223</div>
					<div class="post-author">goatroper</div>
					<div class="post-datetime">
						12 Sep 2011, 09:55					</div>
				</div>
				<div class="post-content content">
					<p>Is it possible to configure per-SSID static IPs with AAP?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p143866">
				<div class="post-metadata">
					<div class="post-num">Post #224</div>
					<div class="post-author">bulanula</div>
					<div class="post-datetime">
						17 Sep 2011, 18:26					</div>
				</div>
				<div class="post-content content">
					<p>Just waiting now for the final OpenWRT version to be released until I try this and build a custom firmware file etc.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p143931">
				<div class="post-metadata">
					<div class="post-num">Post #225</div>
					<div class="post-author">orange</div>
					<div class="post-datetime">
						18 Sep 2011, 17:37					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>goatroper wrote:</cite><blockquote><p>Is it possible to configure per-SSID static IPs with AAP?</p></blockquote></div><p>No, this is not possible.</p>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 9 of 13</div><nav><ul><li><a href="viewtopic.php%3Fid=26116&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=26116&amp;p=7.html">7</a></li><li><a href="viewtopic.php%3Fid=26116&amp;p=8.html">8</a></li><li class="pagination-current"><span>9</span></li><li><a href="viewtopic.php%3Fid=26116&amp;p=10.html">10</a></li><li><a href="viewtopic.php%3Fid=26116&amp;p=11.html">11</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=26116&amp;p=13.html">13</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>