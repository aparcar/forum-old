<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> any way to filter packets going through the switch?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 31 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p21325">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">hedpe</div>
					<div class="post-datetime">
						22 Feb 2006, 08:49					</div>
				</div>
				<div class="post-content content">
					<p>Hey guys,</p><p>I have written a netfilter for the WRT54G following the guide here:<br /><a href="http://www.linuxjournal.com/node/7184/print">http://www.linuxjournal.com/node/7184/print</a></p><p>It works great on the WRT54G to see packets that go in and out of the &quot;Internet&quot; port</p><p>I was wondering if it is possible to write a filter for the switch, so that if two computers are connected to switch port 1 and switch port 2, if they send packets to each other, I can filter them through netfilter some how</p><p>Is this possible?&nbsp; Basically I understand that packets do not go through the routers TCP/IP stack if the host and destination are on the same subnet.&nbsp; Is there any way to force this?&nbsp; Does wireless also bypass the TCP/IP stack?</p><p>Thanks!<br />George</p>											<p class="post-edited">(Last edited by <strong>hedpe</strong> on 22 Feb 2006, 09:14)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p21326">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">zsjoska</div>
					<div class="post-datetime">
						22 Feb 2006, 10:12					</div>
				</div>
				<div class="post-content content">
					<p>You probably have to split your switch and use different interface for the different ports...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p21329">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">sioux</div>
					<div class="post-datetime">
						22 Feb 2006, 11:08					</div>
				</div>
				<div class="post-content content">
					<p>what about ebtables ??</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p21355">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">hedpe</div>
					<div class="post-datetime">
						22 Feb 2006, 17:25					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>zsjoska wrote:</cite><blockquote><p>You probably have to split your switch and use different interface for the different ports...</p></blockquote></div><p>how is it that i can do this?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p21365">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">zsjoska</div>
					<div class="post-datetime">
						22 Feb 2006, 18:55					</div>
				</div>
				<div class="post-content content">
					<p>in this way, however I never tried<br /><a href="http://wiki.openwrt.org/OpenWrtDocs/Configuration#head-cdceb01bb26cc4c59c558d91f7d76c37c5318626">http://wiki.openwrt.org/OpenWrtDocs/Con â€¦ 37c5318626</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p21367">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">hedpe</div>
					<div class="post-datetime">
						22 Feb 2006, 19:24					</div>
				</div>
				<div class="post-content content">
					<p>awesome, i will give that a try, thanks for your help guys</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p21385">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">hedpe</div>
					<div class="post-datetime">
						23 Feb 2006, 01:29					</div>
				</div>
				<div class="post-content content">
					<p>ok i tried following that guide and i couldn&#039;t get switch port 2 working after trying to create its own vlan for itself</p><p>I do not have openwrt installed, i have a telnet daemon so i can telnet to the WRT54G</p><p>i tried creating a seperate vlan for switch port 2<br />nvram set vlan0ports=&quot;1 3 4 5*&quot;<br />nvram set vlan0hwname=et0<br />nvram set vlan1ports=&quot;0 5&quot;<br />nvram set vlan1hwname=et0<br />nvram set vlan2ports=&quot;2&quot;<br />nvram set vlan2hwname=et0<br />vconfig add eth0 2<br />reboot<br />ifconfig vlan2 hw ether 00:13:10:F6:47:01<br />ifconfig vlan2 up<br /># ifconfig -a<br />br0&nbsp; &nbsp; &nbsp; &nbsp;Link encap:Ethernet&nbsp; HWaddr 00:13:10:F6:47:2E&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:192.168.1.1&nbsp; Bcast:192.168.1.255&nbsp; Mask:255.255.255.0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:192 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:262 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:13132 (12.8 kb)&nbsp; TX bytes:69769 (68.1 kb)</p><p>eth0&nbsp; &nbsp; &nbsp; Link encap:Ethernet&nbsp; HWaddr 00:13:10:F6:47:2E&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:624 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:270 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:100 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:54563 (53.2 kb)&nbsp; TX bytes:72442 (70.7 kb)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Interrupt:5 Base address:0x2000 </p><p>eth1&nbsp; &nbsp; &nbsp; Link encap:Ethernet&nbsp; HWaddr 00:13:10:F6:47:30&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:0 errors:0 dropped:0 overruns:0 frame:202<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:85 errors:90 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:100 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:0 (0.0 b)&nbsp; TX bytes:28290 (27.6 kb)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Interrupt:4 Base address:0x1000 </p><p>lo&nbsp; &nbsp; &nbsp; &nbsp; Link encap:Local Loopback&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:127.0.0.1&nbsp; Mask:255.0.0.0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP LOOPBACK RUNNING MULTICAST&nbsp; MTU:16436&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:0 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:0 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:0 (0.0 b)&nbsp; TX bytes:0 (0.0 b)</p><p>vlan0&nbsp; &nbsp; &nbsp;Link encap:Ethernet&nbsp; HWaddr 00:13:10:F6:47:2E&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:193 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:262 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:13988 (13.6 kb)&nbsp; TX bytes:70817 (69.1 kb)</p><p>vlan1&nbsp; &nbsp; &nbsp;Link encap:Ethernet&nbsp; HWaddr 00:12:3F:98:0C:04&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:128.2.140.229&nbsp; Bcast:128.2.141.255&nbsp; Mask:255.255.254.0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:430 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:8 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:29293 (28.6 kb)&nbsp; TX bytes:1625 (1.5 kb)</p><p>vlan2&nbsp; &nbsp; &nbsp;Link encap:Ethernet&nbsp; HWaddr 00:13:10:F6:47:01&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:0 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:0 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:0 (0.0 b)&nbsp; TX bytes:0 (0.0 b)</p><p>Then i plug a computer into the switch port 2, and try to dhcp to get an address, no response...</p><p>I guess I mis-understood something about the settings...</p><p>thanks!<br />George</p>											<p class="post-edited">(Last edited by <strong>hedpe</strong> on 23 Feb 2006, 01:56)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p21390">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">mbm</div>
					<div class="post-datetime">
						23 Feb 2006, 02:55					</div>
				</div>
				<div class="post-content content">
					<p>The switch is only configured when the et.o initially loads (or if you use the admcfg/robocfg utils). Simply setting the nvram variable doesn&#039;t change the current switch configuration.</p><p>(FYI - The rc5 release will replace et.o with an opensource driver, &quot;b44&quot; and will make the switch configuration accessable via /proc, eliminating the need for admcfg or robocfg)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p21435">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">hedpe</div>
					<div class="post-datetime">
						23 Feb 2006, 17:57					</div>
				</div>
				<div class="post-content content">
					<p>so is there any way for me to modify the firmware or startup to configure the switch this way without using robocfg?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p21447">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">hedpe</div>
					<div class="post-datetime">
						23 Feb 2006, 20:39					</div>
				</div>
				<div class="post-content content">
					<p>after searching through the code, I found:<br /></p><div class="codebox"><pre><code>  struct nvram_tuple vlan[] = {
    { &quot;lan_ifname&quot;, &quot;br0&quot;, 0 },
    { &quot;lan_ifnames&quot;, &quot;vlan0 eth1 eth2 eth3&quot;, 0 },
    { &quot;wan_ifname&quot;, &quot;vlan1&quot;, 0 },
    { &quot;wan_ifnames&quot;, &quot;vlan1&quot;, 0 },
    { 0, 0, 0 }
  };</code></pre></div><p>in router/rc/rc.c</p><p>not sure if this is what i&#039;m looking for?</p><p>In the meantime i am going to try putting robocfg on my firmware...</p>											<p class="post-edited">(Last edited by <strong>hedpe</strong> on 23 Feb 2006, 21:31)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p21451">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">hedpe</div>
					<div class="post-datetime">
						23 Feb 2006, 22:30					</div>
				</div>
				<div class="post-content content">
					<p>I tried using robocfg on my WRT54G v3.1 and i get:<br />SIOCETHTOOL: your ethernet module is either unsupported or outdated: Invalid argument</p><p>what else can i try?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p21452">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">mbm</div>
					<div class="post-datetime">
						23 Feb 2006, 22:51					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>hedpe wrote:</cite><blockquote><p>after searching through the code, I found:<br /></p><div class="codebox"><pre><code>  struct nvram_tuple vlan[] = {
    { &quot;lan_ifname&quot;, &quot;br0&quot;, 0 },
    { &quot;lan_ifnames&quot;, &quot;vlan0 eth1 eth2 eth3&quot;, 0 },
    { &quot;wan_ifname&quot;, &quot;vlan1&quot;, 0 },
    { &quot;wan_ifnames&quot;, &quot;vlan1&quot;, 0 },
    { 0, 0, 0 }
  };</code></pre></div><p>in router/rc/rc.c</p><p>not sure if this is what i&#039;m looking for?</p><p>In the meantime i am going to try putting robocfg on my firmware...</p></blockquote></div><p>You do realize you&#039;re on the openwrt.org site right? Those files aren&#039;t present in the openwrt firmware or sources.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p21453">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">dl</div>
					<div class="post-datetime">
						23 Feb 2006, 22:54					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><blockquote><p>nvram set vlan2ports=&quot;2&quot;</p></blockquote></div><p>vlan2 has nothing to talk to - it&#039;s sitting there by itself, so of course it won&#039;t work. Add the cpu port (5) to the ..ports per the example.</p><p>- DL</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p21454">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">candlerb</div>
					<div class="post-datetime">
						23 Feb 2006, 23:00					</div>
				</div>
				<div class="post-content content">
					<p>More info here: <a href="http://wiki.openwrt.org/OpenWrtNVRAM">http://wiki.openwrt.org/OpenWrtNVRAM</a></p><p>I suspect you will want something like this:</p><p>nvram set vlan0ports=&quot;1 3 4 5*&quot;<br />nvram set vlan0hwname=et0<br />nvram set vlan1ports=&quot;0 5&quot;<br />nvram set vlan1hwname=et0<br />nvram set vlan1ports=&quot;2 5&quot;<br />nvram set vlan1hwname=et0<br />nvram set lan_ifname=&quot;br0&quot;<br />nvram set lan_ifnames=&quot;eth1 vlan0 vlan2&quot;&nbsp; &nbsp;&lt;&lt;&lt; NOTE: check whether current setting is eth1 or eth2, and use that<br />nvram commit<br />&lt;reboot&gt;</p><p>This filters off switch port 2, probably labelled &quot;LAN 3&quot; on your hardware, to a separate vlan. (Use &quot;robocfg show&quot; to see which devices are plugged into which ports). Then the bridge br0 connects the wifi, the other LAN ports, and the LAN 3 port. Traffic between the LAN 3 port and the other ports can then be filtered using ebtables.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p21455">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">hedpe</div>
					<div class="post-datetime">
						23 Feb 2006, 23:20					</div>
				</div>
				<div class="post-content content">
					<p>that seemed to work because the computer can now connect on the port, however the transmission rate was cut in half now!</p><p>I am sure this has to do with using twice the CPU now, which is understandable</p><p>however it did not solve the initial problem of getting the packets to show through a netfilter ... the packets never went through the tcp/ip stack in the kernel</p><p>any other suggestions to get the packets to go through the kernel then?</p><br /><p>and yes mbm i know its openwrt forum, and i&#039;m sorry, but there is no greater active forum for help on the wrt54g, and i appreciate it very much</p>											<p class="post-edited">(Last edited by <strong>hedpe</strong> on 24 Feb 2006, 01:00)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p21458">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">dl</div>
					<div class="post-datetime">
						24 Feb 2006, 01:11					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>hedpe wrote:</cite><blockquote><p>however it did not solve the initial problem of getting the packets to show through a netfilter ... the packets never went through the tcp/ip stack in the kernel</p></blockquote></div><p>I think you&#039;ll have to break the bridge to accomplish this.</p><p>- DL</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p21463">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">hedpe</div>
					<div class="post-datetime">
						24 Feb 2006, 03:56					</div>
				</div>
				<div class="post-content content">
					<p>how do you break the bridge?&nbsp; just remove it? what implications does this have?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p21529">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">candlerb</div>
					<div class="post-datetime">
						25 Feb 2006, 00:49					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>hedpe wrote:</cite><blockquote><p>that seemed to work because the computer can now connect on the port, however the transmission rate was cut in half now!</p><p>I am sure this has to do with using twice the CPU now, which is understandable</p><p>however it did not solve the initial problem of getting the packets to show through a netfilter ... the packets never went through the tcp/ip stack in the kernel</p><p>any other suggestions to get the packets to go through the kernel then?</p></blockquote></div><p>For bridging, you need to use ebtables. For an example of how to load the relevant modules and a pointer to the ebtables documentation see <a href="http://forum.openwrt.org/viewtopic.php?id=4481">http://forum.openwrt.org/viewtopic.php?id=4481</a></p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>