<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> How to decrease the size of tmpfs (/tmp)?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 12 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p141692">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">zoli</div>
					<div class="post-datetime">
						19 Aug 2011, 14:45					</div>
				</div>
				<div class="post-content content">
					<p>Hi!</p><p>How to decrease the size of tmpfs (/tmp)? To free up some memory.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p141693">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">Orca</div>
					<div class="post-datetime">
						19 Aug 2011, 15:06					</div>
				</div>
				<div class="post-content content">
					<p>To quickly gain 1,3MiB of memory:<br /><a href="http://wiki.openwrt.org/doc/techref/opkg#package.manipulation">http://wiki.openwrt.org/doc/techref/opk … nipulation</a></p><p>delete packages list/lists</p><br /><p>And if you mean howto decrease the MAXIMUM size of tmpfs? It grows and shrinks with usage.</p><p>This does not explain how:&nbsp; <a href="http://wiki.openwrt.org/doc/techref/process.boot">http://wiki.openwrt.org/doc/techref/process.boot</a></p><p>But based on the stuff in there, you may find the responsible file in here:&nbsp; <a href="https://dev.openwrt.org/browser/trunk/package/base-files/files">https://dev.openwrt.org/browser/trunk/p … iles/files</a></p><p>Maybe.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p141694">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">Orca</div>
					<div class="post-datetime">
						19 Aug 2011, 15:07					</div>
				</div>
				<div class="post-content content">
					<p>What I do know: <br />There IS a pre-init. Then there is init.</p><p>What I do not know:<br />the answer to your question</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p141695">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">Orca</div>
					<div class="post-datetime">
						19 Aug 2011, 15:13					</div>
				</div>
				<div class="post-content content">
					<p>Ah, and regarding the whole filesystems, you find an overview here:&nbsp; <a href="http://wiki.openwrt.org/doc/techref/flash.layout">http://wiki.openwrt.org/doc/techref/flash.layout</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p141951">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">zoli</div>
					<div class="post-datetime">
						23 Aug 2011, 20:18					</div>
				</div>
				<div class="post-content content">
					<p><img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> Thx.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p142021">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">Orca</div>
					<div class="post-datetime">
						24 Aug 2011, 14:31					</div>
				</div>
				<div class="post-content content">
					<p>Your welcome. Did you find the solution? I would not mind having that information in the wiki.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p142086">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">regeszter</div>
					<div class="post-datetime">
						25 Aug 2011, 09:33					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>the tempfs uses only the real reserved memory by the files not the full size of the tempfs.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p142205">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">zoli</div>
					<div class="post-datetime">
						26 Aug 2011, 17:45					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Orca wrote:</cite><blockquote><p>Your welcome. Did you find the solution? I would not mind having that information in the wiki.</p></blockquote></div><p>Currently no solution. <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><div class="quotebox"><cite>regeszter wrote:</cite><blockquote><p>Hi,</p><p>the tempfs uses only the real reserved memory by the files not the full size of the tempfs.</p></blockquote></div><p>It seems to me the tempfs occupied the total size of the memory. If so, I have wasted the half of my memory, because my tmp files are always only about few kb. My device usus 28Mb ram, tempfs is about 14Mb. I think 28 Mb is too much, suspicious. How could it be to find out how much tempfs actually engaged?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p142210">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">Orca</div>
					<div class="post-datetime">
						26 Aug 2011, 17:56					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>zoli wrote:</cite><blockquote><p>It seems to me the tempfs occupied the total size of the memory.</p></blockquote></div><p>Why do you think that?</p><br /><div class="quotebox"><cite>zoli wrote:</cite><blockquote><p>If so, I have wasted the half of my memory, because my tmp files are always only about few kb. My device usus 28Mb ram, tempfs is about 14Mb. I think 28 Mb is too much, suspicious. How could it be to find out how much tempfs actually engaged?</p></blockquote></div><div class="codebox"><pre><code>df
tmpfs                    14724      1544     13180  10% /tmp</code></pre></div><p>tmpfs uses 10% of the value it could maximally use (=14.724KiB) The rest (90%) is free RAM.</p><br /><p>Ah, also mind that linux reports more memory than is actually available (other commands). Something like virtual memory allocation or so. There was a post in this very forum, but good luck find it with this forum software...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p142285">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">fyi</div>
					<div class="post-datetime">
						27 Aug 2011, 13:44					</div>
				</div>
				<div class="post-content content">
					<p><a href="http://lxr.free-electrons.com/source/Documentation/filesystems/tmpfs.txt">Linux/Documentation/filesystems/tmpfs.txt - Linux Cross Reference - Free Electrons</a><br /></p><div class="quotebox"><blockquote><p>tmpfs puts everything into the kernel internal caches and grows and shrinks to accommodate the files it contains and is able to swap unneeded pages out to swap space. It has maximum size limits which can be adjusted on the fly via &#039;mount -o remount ...&#039;</p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p142435">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">zoli</div>
					<div class="post-datetime">
						29 Aug 2011, 11:16					</div>
				</div>
				<div class="post-content content">
					<p>Yes, the files uses 10% space, but the filesystem uses allways 14Mb ram. No? I try the remount.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p142455">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">gulikoza</div>
					<div class="post-datetime">
						29 Aug 2011, 13:42					</div>
				</div>
				<div class="post-content content">
					<p>No, it doesn&#039;t...tmpfs will only take as much memory as the files require. I almost always mount tmpfs at 100% memory...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p186479">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">Zgembo</div>
					<div class="post-datetime">
						19 Dec 2012, 12:42					</div>
				</div>
				<div class="post-content content">
					<p>Answer lies in /lib/preinit/10_essential_fs:</p><p>calc_tmpfs_size() {<br />&nbsp; &nbsp; pi_size=$(awk &#039;/MemTotal:/ {l=10485760;mt=($2*1024);print((s=mt/2)&lt;l)&amp;&amp;(mt&gt;l)?mt-l:s}&#039; /proc/meminfo)<br />}</p><p>Changing this would require re-compiling and re-flashing rootfs. Relevant source file can be found at&nbsp; package/base-files/files/lib/preinit/.</p><p>The above awk expression ensures that either half of total RAM or a minimum of &#039;l&#039; bytes stays reserved for OS (whatever value is larger). Specifying one&#039;s own &#039;l&#039; value would decrease the amount of RAM dedicated to tmpfs. Feel free to experiment with this awk line in OpeWRT shell to find te optimal values for your user case., or simply set dixed pi_size. And remember to keep tmpfs size greater than flash update binary.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p233803">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">UTI_BAIT</div>
					<div class="post-datetime">
						18 May 2014, 15:52					</div>
				</div>
				<div class="post-content content">
					<p>for anyone who gets here, looking for a more clear answer, try <br /></p><div class="codebox"><pre><code> mount -t tmpfs -o remount,size=1G tmpfs /tmp</code></pre></div><p>where 1G is the amount of memory dedicated to the tmpfs ....<br />on current ( barrier breaker ) builds, add the command to the startup under &#039;system&#039; ( or /etc/rc.local , above exit ) ....</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>