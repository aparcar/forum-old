<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> mwan3; multi-wan policy routing (general topic)</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 22 May 2013 and 6 May 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 50 of 65</div><nav><ul><li><a href="viewtopic.php%3Fid=39052&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=48.html">48</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=49.html">49</a></li><li class="pagination-current"><span>50</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=51.html">51</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=52.html">52</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=65.html">65</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p270497">
				<div class="post-metadata">
					<div class="post-num">Post #1226</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						30 Mar 2015, 14:16					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>kpv wrote:</cite><blockquote><p>However, mwan3 complains that vpn1/tun1 doesn&#039;t have a default route. I tried a separate &quot;config route ...&quot; in /etc/config/network, but it didn&#039;t seem to work either. Any suggestions?</p></blockquote></div><p>Is the default route really absent, or is it a false postive?</p><p>Did you edit the openvpn config file as altuhovd did?<br /></p><div class="codebox"><pre><code>#push &quot;redirect-gateway def1&quot;
push &quot;route 0.0.0.0 0.0.0.0 vpn_gateway 3&quot;</code></pre></div>											<p class="post-edited">(Last edited by <strong>Adze</strong> on 30 Mar 2015, 14:18)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p270505">
				<div class="post-metadata">
					<div class="post-num">Post #1227</div>
					<div class="post-author">altuhovd</div>
					<div class="post-datetime">
						30 Mar 2015, 15:30					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><div class="quotebox"><cite>altuhovd wrote:</cite><blockquote><p>2) But not working at router itself (can not ping any host, nslookup not working).<br />from router I can not ping 8.8.8.8, but can ping IPs in OpenVPN (LAN at office).</p></blockquote></div><p>Probably because replies are not routed back over openvpn tunnel <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" />. If you ping from router, your router will create an ip packet based on main routing table. So if you ping 8.8.8.8, it will create an icmp packet with source 9.9.9.9 (ip address on interface eth0) and destination 8.8.8.8, which will be routed over OpenVPN tunnel. Please try &quot;ping -I tun0 8.8.8.8&quot; to confirm.</p></blockquote></div><p>I&#039;m watching (tcpdump) at OpenVPN tunnel and do not see any packets with target 8.8.8.8. So, packet is not goging to OpenVPN tunnel (with source 9.9.9.9).</p><p>What the difference between traffic from LAN and traffic from device&#039;s kernel?</p><p>from router = ping -I tun0 8.8.8.8 = is working.<br />from LAN PC = ping 8.8.8.8 = is working<br />from router = ping 8.8.8.8 = is not working.</p><p>Can I fix that with iptables -t mangle OUTPUT chain?<br />I want to mark outgoing (from device&#039;s kernel) packets/connections and route it with ip rule.</p><p>In the OUTPUT chain (mangle) already presents rules for mwan3_hook, but why the do not work for packets from device&#039;s kernel<br /></p><div class="codebox"><pre><code>Chain OUTPUT (policy ACCEPT 922K packets, 734M bytes)
 pkts bytes target     prot opt in     out     source               destination
1218K  829M mwan3_hook  all  --  *      *       0.0.0.0/0            0.0.0.0/0
1218K  829M mwan3_output_hook  all  --  *      *       0.0.0.0/0            0.0.0.0/0</code></pre></div>											<p class="post-edited">(Last edited by <strong>altuhovd</strong> on 30 Mar 2015, 15:39)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p270507">
				<div class="post-metadata">
					<div class="post-num">Post #1228</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						30 Mar 2015, 15:39					</div>
				</div>
				<div class="post-content content">
					<p>Hi altuhovd,</p><p>You should not have to manual edit mwan3 tables... It should work. Is conntrack enabled for the openvpn zone? If you tcpdump, can you see which interface it does leave?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p270508">
				<div class="post-metadata">
					<div class="post-num">Post #1229</div>
					<div class="post-author">altuhovd</div>
					<div class="post-datetime">
						30 Mar 2015, 15:43					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><p>Hi altuhovd,</p><p>You should not have to manual edit mwan3 tables... It should work. Is conntrack enabled for the openvpn zone? If you tcpdump, can you see which interface it does leave?</p></blockquote></div><p>Oh, sorry, you were right.<br />Packets going to OpenVPN tunnel with source 9.9.9.9 (ip on eth0).<br />But why? Lowest metric on default gateways?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p270509">
				<div class="post-metadata">
					<div class="post-num">Post #1230</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						30 Mar 2015, 15:46					</div>
				</div>
				<div class="post-content content">
					<p>Yup. You have to use NAT if necessairy..</p>											<p class="post-edited">(Last edited by <strong>Adze</strong> on 30 Mar 2015, 15:46)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p270528">
				<div class="post-metadata">
					<div class="post-num">Post #1231</div>
					<div class="post-author">altuhovd</div>
					<div class="post-datetime">
						30 Mar 2015, 17:13					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m done! It&#039;s all working now! I will test switching between ovpn-&gt;wan-wan2</p><p>Thank you Adze!</p><p>For device&#039;s generated traffic we need NAT, lines in the Firewall - Custom Rules (/etc/firewall.user) do that job:</p><p>iptables -t nat -A postrouting_ovpn_rule -s 192.168.0.0/16 -j RETURN<br />iptables -t nat -A postrouting_ovpn_rule -j SNAT --to-source 192.168.70.1</p><p>And script /etc/hotplug.d/iface/16-mwan3-kill-sessions:<br /></p><div class="codebox"><pre><code>#!/bin/sh

case &quot;$ACTION&quot; in
       ifup)
        conntrack -F
        logger -t mwan3user &quot;mwan3user $ACTION of $INTERFACE ($DEVICE)&quot;
       ;;

       ifdown)
        conntrack -F
        logger -t mwan3user &quot;mwan3user $ACTION of $INTERFACE ($DEVICE)&quot;
       ;;
esac

exit 0</code></pre></div>											<p class="post-edited">(Last edited by <strong>altuhovd</strong> on 31 Mar 2015, 12:47)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p270537">
				<div class="post-metadata">
					<div class="post-num">Post #1232</div>
					<div class="post-author">kpv</div>
					<div class="post-datetime">
						30 Mar 2015, 17:54					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><div class="quotebox"><cite>kpv wrote:</cite><blockquote><p>However, mwan3 complains that vpn1/tun1 doesn&#039;t have a default route. I tried a separate &quot;config route ...&quot; in /etc/config/network, but it didn&#039;t seem to work either. Any suggestions?</p></blockquote></div><p>Is the default route really absent, or is it a false postive?</p><p>Did you edit the openvpn config file as altuhovd did?<br /></p><div class="codebox"><pre><code>#push &quot;redirect-gateway def1&quot;
push &quot;route 0.0.0.0 0.0.0.0 vpn_gateway 3&quot;</code></pre></div></blockquote></div><p>I&#039;m trying to make this setup work by only making changes at my end (OpenWrt running the OpenVPN client), without assuming that I can make changes to the OpenVPN server (which in my usage scenario might be a 3rd party commercial service).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p270558">
				<div class="post-metadata">
					<div class="post-num">Post #1233</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						30 Mar 2015, 20:51					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>kpv wrote:</cite><blockquote><div class="quotebox"><cite>Adze wrote:</cite><blockquote><p>Is the default route really absent, or is it a false postive?</p></blockquote></div><p>I&#039;m trying to make this setup work by only making changes at my end (OpenWrt running the OpenVPN client), without assuming that I can make changes to the OpenVPN server (which in my usage scenario might be a 3rd party commercial service).</p></blockquote></div><p>So the default route... is it actually there?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p270564">
				<div class="post-metadata">
					<div class="post-num">Post #1234</div>
					<div class="post-author">kpv</div>
					<div class="post-datetime">
						30 Mar 2015, 21:05					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>arfett wrote:</cite><blockquote><div class="quotebox"><cite>kpv wrote:</cite><blockquote><div class="quotebox"><cite>Adze wrote:</cite><blockquote><p>Is the default route really absent, or is it a false postive?</p></blockquote></div><p>I&#039;m trying to make this setup work by only making changes at my end (OpenWrt running the OpenVPN client), without assuming that I can make changes to the OpenVPN server (which in my usage scenario might be a 3rd party commercial service).</p></blockquote></div><p>So the default route... is it actually there?</p></blockquote></div><p>No, it wasn&#039;t there.</p><p>Note: I tried a &quot;config route ... &quot; statement in /etc/config/network but didn&#039;t give it much testing, as I am first trying to ensure that my general approach is correct.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p270653">
				<div class="post-metadata">
					<div class="post-num">Post #1235</div>
					<div class="post-author">kpv</div>
					<div class="post-datetime">
						31 Mar 2015, 15:59					</div>
				</div>
				<div class="post-content content">
					<p>Any ideas / suggestions ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p270720">
				<div class="post-metadata">
					<div class="post-num">Post #1236</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						31 Mar 2015, 21:40					</div>
				</div>
				<div class="post-content content">
					<p>Hi kpv,</p><p>When you have an interface configured in network configuration with proto set to none, openwrt will not start this interface during boot and thus the static(s) for that interface will not be set. I think it will work if you manually UP the interface.</p>											<p class="post-edited">(Last edited by <strong>Adze</strong> on 31 Mar 2015, 21:41)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p270796">
				<div class="post-metadata">
					<div class="post-num">Post #1237</div>
					<div class="post-author">darkdje</div>
					<div class="post-datetime">
						1 Apr 2015, 12:34					</div>
				</div>
				<div class="post-content content">
					<p>Hi Adze and thank you for mwan3</p><p>For now everything works fine when using as load balancing, but that&#039;s not my final goal here<br />I tried to configure it to do one thing. I have two network:</p><p>The first one is a simple internet connection than I connect to wan interface. As it&#039;s coming from my internet provider it give me <br />a IP: 192.168.2.0/24&nbsp; // GW: 192.168.2.1&nbsp; // DNS:192.168.2.1 by DHCP</p><p>The second one is a private network. It give also everything by DHCP: IP: 128.127.15.0/24 // GW: 128.127.15.1 //DNS: 172.26.101.1. This network is here to provide just a few &quot;url&quot; like &quot;timing-data.aks&quot;</p><p>So What I want to do is to force the DNS resolution of &quot;timing-data.aks&quot; with 172.26.101.1 DNS and show the page with the good network. All the others web access will be redirect to the internet connection.</p><p>After reading a lot of page here, I&#039;ve seen &quot;fovecifer&quot; who wanted to do almost the same with a vpn but maybe not in DNS point of view.</p><p>1. He create an &quot;ipset&quot; for his particular url<br />As I&#039;ve never configured network whitout GUI, I don&#039;t really know which file to modify with my ssh access and what to write in it.</p><p>2. I think I have to configure my DNSMasq to resolv timing-data.aks with the good DNS and write it into ipset<br />I think that everything as to be done in /etc/config/dhcp but I don&#039;t really know which line to add.</p><p>3. I think that here I have to configure mwan3 rules to transfer all the network to wan exept for my ipset to wan2.<br />This one, I think I understand how to type it&nbsp; but I will see when I will succeed for 1 and 2.</p><p>Am I in the good direction to make my network working?</p><p>PS: sorry for my bad english</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p270889">
				<div class="post-metadata">
					<div class="post-num">Post #1238</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						1 Apr 2015, 21:02					</div>
				</div>
				<div class="post-content content">
					<p>Hi darkdje,</p><p>What you are trying to do is pretty straightforward. First make sure you have the correct software versions running. You need dnsmasq with ipset support; ipset version 6.24 and mwan3 version 1.6-1 (or higher ofcourse). Make sure that you have a mwan3 rule configured that routes traffic towards 172.26.101.1 over correct wan.</p><p>You need to edit /etc/dnsmasq.conf and add the following lines.<br /></p><div class="codebox"><pre><code>#Lookup timing-data.aks at specific dns server
server=/timing-data.aks/172.26.101.1
#populate ipset timing-data with timing-data.aks resolv results 
ipset=/timing-data.aks/timing-data</code></pre></div><p>After dnsmasq restart, you can use the ipset &quot;timing-data&quot; in your mwan3 rules. Good luck</p>											<p class="post-edited">(Last edited by <strong>Adze</strong> on 1 Apr 2015, 21:07)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p270942">
				<div class="post-metadata">
					<div class="post-num">Post #1239</div>
					<div class="post-author">darkdje</div>
					<div class="post-datetime">
						2 Apr 2015, 02:26					</div>
				</div>
				<div class="post-content content">
					<p>It seems to work fine for the internet part. For the other one, I can&#039;t check before next weeks since I have no access to the network now. I&#039;ll let you know.</p><p>Thanks you very much Adze!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p271096">
				<div class="post-metadata">
					<div class="post-num">Post #1240</div>
					<div class="post-author">altuhovd</div>
					<div class="post-datetime">
						3 Apr 2015, 13:59					</div>
				</div>
				<div class="post-content content">
					<p>Another problem is DNAT.<br />It&#039;s not working.</p><p>I added an iptables rule (for transparent proxy):<br /></p><div class="codebox"><pre><code>Chain prerouting_rule (1 references)
 pkts bytes target     prot opt in     out     source               destination
   29  1508 DNAT       tcp  --  *      *       192.168.70.0/24      0.0.0.0/0            tcp dpt:80 to:192.168.29.5:3128</code></pre></div><p>And I have no traffic on 192.168.29.5:3128 from 192.168.70.0/24</p><p>From tcpdump on br-lan interface:<br /></p><div class="codebox"><pre><code>15:58:16.158917 IP 192.168.70.200.21724 &gt; 90.156.201.98.80: Flags [S], seq 3798717873, win 65535, options [mss 1460,nop,wscale 1,nop,nop,sackOK], length 0
15:58:16.159872 IP 90.156.201.98 &gt; 192.168.70.200: ICMP host 90.156.201.98 unreachable, length 36</code></pre></div><p>forwarding is allowed. I can telnet to 192.168.29.5:3128 from 192.168.70.200</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p271097">
				<div class="post-metadata">
					<div class="post-num">Post #1241</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						3 Apr 2015, 14:02					</div>
				</div>
				<div class="post-content content">
					<p>Hi altohovd,</p><p>It is working; you are doing it wrong. Please read mwan3 wiki about privoxy.</p>											<p class="post-edited">(Last edited by <strong>Adze</strong> on 3 Apr 2015, 14:03)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p271098">
				<div class="post-metadata">
					<div class="post-num">Post #1242</div>
					<div class="post-author">altuhovd</div>
					<div class="post-datetime">
						3 Apr 2015, 14:05					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><p>Hi altohovd,</p><p>It is working; you are doing it wrong. Please read mwan3 wiki about privoxy.</p></blockquote></div><p>I&#039;m so ashamed, all written long ago, went to read</p><p>My solution is forward all tcp:80 traffic to OpenVPN tunnel (with squid transparent proxy on gateway):<br /></p><div class="codebox"><pre><code>Active rules:
source             destination        proto  src-port      dest-port     policy          hits
--------------------------------------------------------------------------------------------------
0.0.0.0/0          0.0.0.0/0          tcp    0:65535       80          ovpn_wan_wan2  </code></pre></div>											<p class="post-edited">(Last edited by <strong>altuhovd</strong> on 3 Apr 2015, 14:16)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p272541">
				<div class="post-metadata">
					<div class="post-num">Post #1243</div>
					<div class="post-author">projectgus</div>
					<div class="post-datetime">
						15 Apr 2015, 01:23					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>kpv wrote:</cite><blockquote><div class="quotebox"><cite>Adze wrote:</cite><blockquote><p>Is the default route really absent, or is it a false postive?</p><p>Did you edit the openvpn config file as altuhovd did?<br /></p><div class="codebox"><pre><code>#push &quot;redirect-gateway def1&quot;
push &quot;route 0.0.0.0 0.0.0.0 vpn_gateway 3&quot;</code></pre></div></blockquote></div><p>I&#039;m trying to make this setup work by only making changes at my end (OpenWrt running the OpenVPN client), without assuming that I can make changes to the OpenVPN server (which in my usage scenario might be a 3rd party commercial service).</p></blockquote></div><p>Hi kpv,</p><p>I ran into this problem just now as well, for the same reason (third party OpenVPN server pushes &#039;redirect-gateway def1&#039;, so mwan3 says &quot;Could not find gateway for interface&quot;). The routing entries for the OpenVPN interface when &quot;def1&quot; is enabled are:<br /></p><div class="codebox"><pre><code>0.0.0.0/1 via 10.0.0.1 
128.0.0.0/1 via 10.0.0.1 </code></pre></div><p>... taken together obviously equivalent to a default route, but &#039;ip route list dev tun0 default&#039; doesn&#039;t output anything.</p><p>According to the OpenVPN wiki there&#039;s <a href="https://community.openvpn.net/openvpn/wiki/IgnoreRedirectGateway">no simple way to override when &#039;redirect-gateway def1&#039; is pushed from the server</a>.</p><p>A hack that works for me in mwan3 is to change the two places in /etc/hotplug.d/iface/15-mwan3 that currently read:<br /></p><div class="codebox"><pre><code>ip -4 route list dev $DEVICE default | head -1</code></pre></div><p>To read:<br /></p><div class="codebox"><pre><code>ip -4 route list dev $DEVICE match 0.0.0.0/1 | head -1</code></pre></div><p>... this prints the gateway both for OpenVPN &#039;def1&#039; routes, and for default gateways. It&#039;s obviously a hack though.</p><p>It would be possible to make a function that checked the same gateway matches both 128.0.0.0/1 and 0.0.0.0/1, which would avoid any weird corner cases if someone routed 128.0.0.0/1 differently to 0.0.0.0/1 (is this likely?!)</p><p>Adze, please let me know if you&#039;d like to see a patch for either of these possibilities (the hack, or the workaround function). Thanks very much for all your work on mwan3, btw. Finding that it exists was a massive relief!</p><br /><p>Angus</p>											<p class="post-edited">(Last edited by <strong>projectgus</strong> on 15 Apr 2015, 01:25)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p272576">
				<div class="post-metadata">
					<div class="post-num">Post #1244</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						15 Apr 2015, 09:30					</div>
				</div>
				<div class="post-content content">
					<p>Hi Angus,</p><p>While your hack does work to let mwan3 think that there is a route, the routes 0.0.0.0/1 and 128.0.0.0/1 will be added to known networks. As a result all wan traffic will traverse over openvpn link, regardless of rules. To conclude, this will not work.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p272596">
				<div class="post-metadata">
					<div class="post-num">Post #1245</div>
					<div class="post-author">Coldstream87</div>
					<div class="post-datetime">
						15 Apr 2015, 12:09					</div>
				</div>
				<div class="post-content content">
					<p>I have seen this comming up on other threads where i have been looking for solutions to my vpn problem but i am not sure if this will help me in the right path.</p><p>i want to use a seperate wifi instance to go over openvpn while the other regular two use my default internet.<br />can this be set-up with MWAN3?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p272605">
				<div class="post-metadata">
					<div class="post-num">Post #1246</div>
					<div class="post-author">projectgus</div>
					<div class="post-datetime">
						15 Apr 2015, 13:23					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><p>While your hack does work to let mwan3 think that there is a route, the routes 0.0.0.0/1 and 128.0.0.0/1 will be added to known networks. As a result all wan traffic will traverse over openvpn link, regardless of rules. To conclude, this will not work.</p></blockquote></div><p>Hi Adze,</p><p>Yes, of course. Sorry, I should have realised this last night before posting.</p><p>I think then that the thing to do is to just to add a hotplug hook before mwan3 that replaces the two routes with a single default route on ifup, and deletes them on ifdown. Still hacky but it should work OK. I&#039;ll see how I go.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p272612">
				<div class="post-metadata">
					<div class="post-num">Post #1247</div>
					<div class="post-author">Coldstream87</div>
					<div class="post-datetime">
						15 Apr 2015, 14:44					</div>
				</div>
				<div class="post-content content">
					<p>Hmm whenever i try to install mwan3 on latest trunk (archer c5) my router becomes unusable no matter what i do and i have to TFTP restore it, is this a known issue?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p272729">
				<div class="post-metadata">
					<div class="post-num">Post #1248</div>
					<div class="post-author">pier4r</div>
					<div class="post-datetime">
						16 Apr 2015, 13:39					</div>
				</div>
				<div class="post-content content">
					<p>This is a really great work. &lt;3 to Adze and contributors. I always relied on <a href="http://213.136.13.52/mwan3_latest_all.ipk">http://213.136.13.52/mwan3_latest_all.ipk</a>&nbsp; that now it is not available anymore (maybe temporarily).</p><p>Does someone knows other locations/mirrors ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p272736">
				<div class="post-metadata">
					<div class="post-num">Post #1249</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						16 Apr 2015, 13:58					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>pier4r wrote:</cite><blockquote><p>I always relied on <a href="http://213.136.13.52/mwan3_latest_all.ipk">http://213.136.13.52/mwan3_latest_all.ipk</a>&nbsp; that now it is not available anymore (maybe temporarily).</p></blockquote></div><p>Server is back online. Crashed somehow... Please keep in mind that only version 1.4 is available from that server. For version 1.5 and up you need to compile it yourself.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p272741">
				<div class="post-metadata">
					<div class="post-num">Post #1250</div>
					<div class="post-author">pier4r</div>
					<div class="post-datetime">
						16 Apr 2015, 14:54					</div>
				</div>
				<div class="post-content content">
					<p>Nice, thanks. Maybe we could write it on the wiki page? I didn&#039;t know it (i thought was the latest)</p><p>Suggestion: i don&#039;t know if github provides a bit of space for distribution of binaries, in the case github does not, what about a public dropbox folder o similar?</p>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 50 of 65</div><nav><ul><li><a href="viewtopic.php%3Fid=39052&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=48.html">48</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=49.html">49</a></li><li class="pagination-current"><span>50</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=51.html">51</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=52.html">52</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=65.html">65</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0.001 -->

</body>
</html>