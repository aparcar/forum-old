<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Backfire on WL700gE</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 26 Apr 2018 and 29 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 2 of 2</div><nav><ul><li><a href="viewtopic.php%3Fid=25699&amp;p=1.html">1</a></li><li class="pagination-current"><span>2</span></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p143380">
				<div class="post-metadata">
					<div class="post-num">Post #26</div>
					<div class="post-author">Gregoire</div>
					<div class="post-datetime">
						12 Sep 2011, 00:37					</div>
				</div>
				<div class="post-content content">
					<p>@ hcc23 : thank for the reply :-)</p><p>This backfire for our device is a hard one...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p155381">
				<div class="post-metadata">
					<div class="post-num">Post #27</div>
					<div class="post-author">14skywalker</div>
					<div class="post-datetime">
						25 Jan 2012, 21:51					</div>
				</div>
				<div class="post-content content">
					<p>Hi Everyone,</p><p>I have backfire running om my WL700gE now:<br /></p><div class="codebox"><pre><code>Trying 192.168.1.1...
Connected to 192.168.1.1.
Escape character is &#039;^]&#039;.
 === IMPORTANT ============================
  Use &#039;passwd&#039; to set your login password
  this will disable telnet and enable SSH
 ------------------------------------------


BusyBox v1.15.3 (2011-11-24 04:30:44 CET) built-in shell (ash)
Enter &#039;help&#039; for a list of built-in commands.

  _______                     ________        __
 |       |.-----.-----.-----.|  |  |  |.----.|  |_
 |   -   ||  _  |  -__|     ||  |  |  ||   _||   _|
 |_______||   __|_____|__|__||________||__|  |____|
          |__| W I R E L E S S   F R E E D O M
 Backfire (10.03.1, r29592) ------------------------
  * 1/3 shot Kahlua    In a shot glass, layer Kahlua 
  * 1/3 shot Bailey&#039;s  on the bottom, then Bailey&#039;s, 
  * 1/3 shot Vodka     then Vodka.
 ---------------------------------------------------
root@OpenWrt:/# uname -a
Linux OpenWrt 2.6.32.27 #5 Wed Dec 21 05:56:26 CET 2011 mips GNU/Linux
root@OpenWrt:/# df
Filesystem           1K-blocks      Used Available Use% Mounted on
/dev/root                  768       768         0 100% /mnt/openwrt/rom
tmpfs                    31060      1528     29532   5% /tmp
tmpfs                      512         0       512   0% /dev
root                     31060         4     31056   0% /tmp/root
mini_fo:/tmp/root          768       768         0 100% /mnt/openwrt
/dev/hda1               482214     13313    444002   3% /</code></pre></div><p>I made a new image and included the init.rd script (below). Inspired by this article: <a href="http://www.rooot.net/en/geek-stuff/openwrt/36-mount-external-usb-root-partition-openwrt.html)">http://www.rooot.net/en/geek-stuff/open â€¦ nwrt.html)</a>. Nobody has found a way to fit cfdisk and mkfs.ext3 in the image. So it is still a hassle to partition and format your drive after the first flash: download and install the packages in /tmp.</p><p>Let me know if anyone fancies this image. Then I will put it up somewhere.</p><div class="codebox"><pre><code>#!/bin/sh /etc/rc.common

START=40

start () {
    echo &quot;checking for alternative boot device&quot;
    EXTERNAL_PARTITION=$(nvram get boot_dev)

    echo &quot;loading USB and ext3 modules&quot;
    for module in usbcore usb-ohci uhci ehci-hcd scsi_mod sd_mod usb-storage jbd ext3; do
    insmod $module
    done
    sleep 2s

    [ &quot;$FAILSAFE&quot; != &quot;true&quot; ] &amp;&amp; [ -b $EXTERNAL_PARTITION ] &amp;&amp; {
        mount $EXTERNAL_PARTITION /mnt/root
        [ -x /mnt/root/sbin/init ] &amp;&amp; {
            mount -o move /proc /mnt/root/proc &amp;&amp; \
            pivot_root /mnt/root /mnt/root/mnt/openwrt &amp;&amp; {
                mount -o move /mnt/openwrt/dev /dev
                mount -o move /mnt/openwrt/tmp /tmp
                }
            }
        }
    }</code></pre></div>											<p class="post-edited">(Last edited by <strong>14skywalker</strong> on 28 Jan 2012, 14:13)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p155391">
				<div class="post-metadata">
					<div class="post-num">Post #28</div>
					<div class="post-author">hcc23</div>
					<div class="post-datetime">
						25 Jan 2012, 22:52					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>14skywalker wrote:</cite><blockquote><p>Hi Everyone,<br />I have backfire running om my WL700gE now:</p></blockquote></div><p>This is really great news <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>If you wouldn&#039;t mind, can you post your .config file? Then we all can rebuild our own images and keep up with upcoming developments in trunk.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p155619">
				<div class="post-metadata">
					<div class="post-num">Post #29</div>
					<div class="post-author">14skywalker</div>
					<div class="post-datetime">
						28 Jan 2012, 13:57					</div>
				</div>
				<div class="post-content content">
					<p>Hi Everyone, I did nothing special to the basic setup of ImageBuilder. This is my WL700GE.mk file:</p><div class="codebox"><pre><code>#
# Copyright (C) 2006 OpenWrt.org
#
# This is free software, licensed under the GNU General Public License v2.
# See /LICENSE for more information.
#

define Profile/WL700GE
  NAME:=ASUS WL700GE
  PACKAGES:=-ppp -ppp-mod-pppoe -kmod-ipt-nathelper -iptables -dnsmasq -bridge kmod-ide-core kmod-ide-aec62xx kmod-fs-ext3 -firewall -wpad-mini
endef

define Profile/WL700GE/Description
    used the packages from 2.4 and also excluded -firewall and -wpad-mini
endef
$(eval $(call Profile,WL700GE))</code></pre></div><p>I will try to get the config file downloadable somewhere.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p157061">
				<div class="post-metadata">
					<div class="post-num">Post #30</div>
					<div class="post-author">rostman</div>
					<div class="post-datetime">
						11 Feb 2012, 20:32					</div>
				</div>
				<div class="post-content content">
					<p>Please, upload image and write a tutorial step by step how to flash.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p158576">
				<div class="post-metadata">
					<div class="post-num">Post #31</div>
					<div class="post-author">larmoe</div>
					<div class="post-datetime">
						24 Feb 2012, 14:47					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><blockquote><p>I will try to get the config file downloadable somewhere.</p></blockquote></div><p>Hi 14skywalker</p><p>For enthusiastic reasons I just bought myself a WL700gE. It would really be nice if you could upload your .config file. <br />Thanks in advance.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p160465">
				<div class="post-metadata">
					<div class="post-num">Post #32</div>
					<div class="post-author">larmoe</div>
					<div class="post-datetime">
						11 Mar 2012, 22:17					</div>
				</div>
				<div class="post-content content">
					<p>Fixed it! <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /><br /></p><div class="codebox"><pre><code>BusyBox v1.15.3 (2012-03-06 15:52:41 CET) built-in shell (ash)
Enter &#039;help&#039; for a list of built-in commands.

  _______                     ________        __
 |       |.-----.-----.-----.|  |  |  |.----.|  |_
 |   -   ||  _  |  -__|     ||  |  |  ||   _||   _|
 |_______||   __|_____|__|__||________||__|  |____|
          |__| W I R E L E S S   F R E E D O M
 Backfire (10.03.1, r30807) ------------------------
  * 1/3 shot Kahlua    In a shot glass, layer Kahlua 
  * 1/3 shot Bailey&#039;s  on the bottom, then Bailey&#039;s, 
  * 1/3 shot Vodka     then Vodka.
 ---------------------------------------------------
root@OpenWrt:/# uname -a
Linux OpenWrt 2.6.32.27 #2 Tue Mar 6 16:37:36 CET 2012 mips GNU/Linux
root@OpenWrt:/#</code></pre></div><p>Used kexec for the squashfs image (r27227) and followed some of the links below. <br /><a href="https://forum.openwrt.org/viewtopic.php?id=23901">https://forum.openwrt.org/viewtopic.php?id=23901</a><br /><a href="http://code.google.com/p/wl-700ge/">http://code.google.com/p/wl-700ge/</a></p>											<p class="post-edited">(Last edited by <strong>larmoe</strong> on 11 Mar 2012, 22:23)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p161034">
				<div class="post-metadata">
					<div class="post-num">Post #33</div>
					<div class="post-author">mart</div>
					<div class="post-datetime">
						16 Mar 2012, 07:37					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>14skywalker wrote:</cite><blockquote><p>Hi Everyone,</p><p>I have backfire running om my WL700gE now:</p><p>Let me know if anyone fancies this image. Then I will put it up somewhere.</p></blockquote></div><p>Far out! I stopped checking this thread a couple of months ago.</p><p>Now I see an offer of a working image!&nbsp; </p><p>I would very much like that image please and bit of a guide of what to do after flashing to get basic router functions.</p><p>Thank you.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p161677">
				<div class="post-metadata">
					<div class="post-num">Post #34</div>
					<div class="post-author">larmoe</div>
					<div class="post-datetime">
						21 Mar 2012, 23:53					</div>
				</div>
				<div class="post-content content">
					<p>Here is a brief description on how to run backfire with the 2.6 kernel on the ASUS WL700gE. In the belief that this was a simple task, I recently bought this piece of hardware as a replacement for a slowly dying WL500gE. To my knowledge the WL700gE is the only 3 USB port, &lt; 20watt, HDD-router, printer-, scanner-, http-, samba-, and UPnP-server available. Trying to squeeze all these expectations in to 1,8MB of flash was therefore a rather disappointing experience.</p><p>After trawling the internet for a while I went for the kexec approach. In short this implies compiling a small flash image (kexec kernel), that basically preforms the same tasks as a bios. Once installed the router can boot a second kernel from a USB/HDD drive, and you never need to change the flash image. </p><p>This guide describes how to build a kexec image and load a second kernel image from a ext2 formatted USB flash drive. It may also be possible to load a second image form the hard drive, but since I want my disk to spin down for long periods of time, I choose to place my root and swap partition on a USB drive. </p><p><strong>Use this HOWTO at your own risk!</strong></p><p><strong>Prerequisites</strong><br />&nbsp; &nbsp; - A working build system (I use Ubuntu 11.10) see <a href="http://wiki.openwrt.org/doc/howto/buildroot.exigence">http://wiki.openwrt.org/doc/howto/buildroot.exigence</a>&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; - 3-4 GB of available hard disk space to build (i.e. cross-compile) OpenWrt.<br />&nbsp; &nbsp; - Basic knowledge on how to build the linux kernel.<br />&nbsp; &nbsp; - USB flash drive <br />&nbsp; &nbsp; <br /><strong>1. Build the kexec image </strong><br />(if you just want the image get it <a href="http://www.fileden.com/files/2012/3/21/3281530/openwrt-brcm47xx-squashfs.trx">here</a>)<br />Create build DIR and download source revision 27227 (the current revision produces to large an image)<br /></p><div class="codebox"><pre><code>mkdir ~/openwrt
cd openwrt
svn checkout --revision=27227 svn://svn.openwrt.org/openwrt/branches/backfire/ ./r27227
cd r27227</code></pre></div><p>Check dependencies, get a working config file and run make (this will take some time).<br /></p><div class="codebox"><pre><code>make defconfig
wget http://www.fileden.com/files/2012/3/21/3281530/config_kexec
mv config_kexec .config
make menuconfig</code></pre></div><p>Add extra functions to your kexec image if required (extra functions take up space you don&#039;t have). If you want to boot a second image from the harddrive, disable all the USB modules, and add: &quot;Kernel modules&quot; -&gt; &quot;Block devices&quot; -&gt; &quot;*kmod-ide-core&quot;, &quot;*kmod-ide-aec62xx&quot;. (not tested). Else do nothing, save and exit. <br /></p><div class="codebox"><pre><code>make V=99 world
make kernel_menuconfig</code></pre></div><p>Select -&gt; &quot;Kernel type&quot; -&gt; &quot;*kexec system call&quot;, and select &quot;General setup&quot; ? &quot;* Support initial ramdisks compressed using LZMA and Built-in initramfs compression mode&quot; â€“&gt; &quot;*LZMA&quot;, save and exit.<br />Now you have to </p><div class="codebox"><pre><code> nano -w build_dir/linux-brcm47xx/linux-2.6.32.27/arch/mips/kernel/machine_kexec.c</code></pre></div><p>Modify line 55 <br />from: &quot;kexec_start_address = image-&gt;start;&quot; <br />into: &quot;kexec_start_address = (unsigned long) phys_to_virt(image-&gt;start);&quot;</p><p>The kexec image will need to know where to find the second kernel image. This is specified in the /etc/rc.local, but since we can&#039;t modify files once in flash, the file must be modified now. The rc.local file supplied will load a second initramfs kernel image named &quot;openwrt-brcm47xx-vmlinux.elf&quot; from the root of a usb drive (ext2 formatted). The rc.local file must go in ~/openwrt/r27227/files/etc/ before &quot;make&quot;.<br /></p><div class="codebox"><pre><code>mkdir files &amp;&amp; cd files/ &amp;&amp; mkdir etc &amp;&amp; cd etc
wget http://www.fileden.com/files/2012/3/21/3281530/rc.local
cd ~/openwrt/r27227/
make V=99</code></pre></div><p>You should now have a 1,77MB .trx image in &quot;~/openwrt/r27227/bin/brcm47xx/&quot;.<br />If you want to boot the second kernel from the HDD, change rc.local accordingly before make.</p><p>If you don&#039;t want to spend time compiling your own kexec image just:<br /></p><div class="codebox"><pre><code>wget http://www.fileden.com/files/2012/3/21/3281530/openwrt-brcm47xx-squashfs.trx</code></pre></div><p>and flash. </p><p><strong>2. Flash the image to the router</strong></p><p>Connect your PC to a LAN port of the router. Power up the router while holding the ez-setup button until the &quot;Ready light&quot; stops flashing. The router now runs a tfpd server, IP: 192.168.1.1. <br />In order to connect to the router you must give your PC a static IP. On a Linux PC this is done by disabling Networkmanager and:<br /></p><div class="codebox"><pre><code>sudo /sbin/ifconfig eth0 192.168.1.2
sudo /sbin/route add -host 192.168.1.2 dev eth0</code></pre></div><p>Try to ping the router&#039;s IP to see if you are good to go.<br />Get &quot;tftp&quot; (if you don&#039;t have it already), CD into the directory of the kexec trx image and flash:<br /></p><div class="codebox"><pre><code>tftp 192.168.1.1
tftp&gt; bin
tftp&gt; put openwrt-brcm47xx-squashfs.trx</code></pre></div><p>Wait for 2 minutes and press the &quot;reset&quot; button on the router. When the &quot;Ready&quot; light goes out you should be able to connect to the router by:<br /></p><div class="codebox"><pre><code>telnet 192.168.1.1</code></pre></div><p>To-do next: Build a initramfs image to load from USB.</p>											<p class="post-edited">(Last edited by <strong>larmoe</strong> on 25 Dec 2012, 22:28)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p161822">
				<div class="post-metadata">
					<div class="post-num">Post #35</div>
					<div class="post-author">mart</div>
					<div class="post-datetime">
						23 Mar 2012, 00:06					</div>
				</div>
				<div class="post-content content">
					<p>larmoe,&nbsp; these instructions look brilliant, I think even a noob like me could this working.&nbsp; I especially like your succinct description of the kexec approach, it hadn&#039;t dawned on me that you would never need to change the flash image again.&nbsp; And having the second kernel on usb instead of hdd - even better!</p><p>Now get this, a couple of days ago I noticed repeated hard drive activity from my WL700, I couldn&#039;t get to the web interface.&nbsp; Turns out it was stuck in a cycle of constant reboots.&nbsp; I cycled the power a few times, didn&#039;t help, pressed reset button, nope.&nbsp; I reflashed it with the Asus firmware restoration tool with the kfurge modified asus firmware and it still kept rebooting same as before.&nbsp; Flashed again with stock asus 1.7.8 and it seemed to be OK, so I upgraded to kfurge firmware via web interface and it went back to the same reboot loop.&nbsp; Then flashed the stock asus again and left it alone, it seemed OK.&nbsp; Next morning there were no lights on, it looked like it was powered off.&nbsp; I hoped maybe someone had accidentally pressed the power button.&nbsp; I restarted it, but in the afternoon it was off again.&nbsp; Flashed it a few more times, but now it always goes back to infinite reboot loop.</p><p>I have checked the power supply while the device is operating (booting) and it is producing 12 volts (and 5 volts to hdd).&nbsp; I have tried a different hard drive.&nbsp; I can&#039;t seem to get the device into tftp mode.&nbsp; I have tried all sorts of combinations of holding down buttons and powering on.&nbsp; The ready light will flash 5 (or is it 6 times? - I should know by now) and then go out, but I can never ping or tftp the device.&nbsp; I&#039;m pretty much out of ideas.&nbsp; It could still be the power supply, maybe my digital meter samples too slow to detect voltage changes that might cause a reboot, having said that I think the reboots occurr at the same regular interval not a random times, so maybe not power supply.&nbsp; I dont know if there are some pins on the board somewhere I could short to cause a reset, whether that would be any different than pressing the reset button.&nbsp; I think the serial console is beyond me.&nbsp; I have just about given up, I&#039;ll wait a couple of days to get used to the idea and then move on, unless I get some inspiration before then.&nbsp; I&#039;ll download your image just in case.&nbsp; I hope others benefit from your work.&nbsp; Thank you again for taking the time to supply this information.<br />Martin.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p161957">
				<div class="post-metadata">
					<div class="post-num">Post #36</div>
					<div class="post-author">larmoe</div>
					<div class="post-datetime">
						23 Mar 2012, 21:39					</div>
				</div>
				<div class="post-content content">
					<p>If you can&#039;t ping the router after pressing the ez-button during power-up, check your PC&#039;s network settings. Especially remember to disable Networkmanager (if you run Linux). Sounds like a hardware problem though. </p><p>/larmoe</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p162197">
				<div class="post-metadata">
					<div class="post-num">Post #37</div>
					<div class="post-author">mart</div>
					<div class="post-datetime">
						27 Mar 2012, 02:07					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ve had some success.&nbsp; Lazy me I was trying to tftp in windows (it had worked before a long time ago).&nbsp; I was able to get tftp to work in Ubuntu.</p><p>I flashed to the 2.4 pivot root image from <a href="https://forum.openwrt.org/viewtopic.php?pid=113428#p113428">https://forum.openwrt.org/viewtopic.php â€¦ 28#p113428</a> and then followed bluegold&#039;s instructions in the first post of this thread to partition the drive and copy rom to hdd.&nbsp; </p><p>Took me a while but I have my WL700ge running again and seems to be stable so far.&nbsp; In trying to get LuCI running I thought I must have to set passwd - so I locked myself out because I hadn&#039;t installed dropbear yet. So I had to flash again.&nbsp; I then learned about /etc/init.d uhttpd enable <img src="https://forum.openwrt.org/img/smilies/tongue.png" width="15" height="15" alt="tongue" /> .&nbsp; I don&#039;t use the device as a router, its an access point/NAS/UPnP server, etc behind the main all in one modem router, took me while to get the network config right for AP mode.&nbsp; I thought am I gonna screw the network config and lock myself out again.&nbsp; Samba took me a while too because I mistakenly installed some samba 2 package (samba-server) over the top of samba3, thinking samba-server was needed for netBIOS name browsing in windows.&nbsp; Once I got the samba3 config files in place things started looking up.&nbsp; I now have UPnP working and hdparm spinning the disc down.&nbsp; I&#039;m fairly happy now.</p><p>But dont let that stop you from posting part 2 of your guide: Build a initramfs image to load from USB.&nbsp; <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p><p>Cheers,<br />Martin.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p164914">
				<div class="post-metadata">
					<div class="post-num">Post #38</div>
					<div class="post-author">bonym</div>
					<div class="post-datetime">
						18 Apr 2012, 13:29					</div>
				</div>
				<div class="post-content content">
					<p>Hi larmoe,<br />i&#039;m happy to hear your compilled firmware.<br />building the image is nice, but i&#039;m not 100% in it :-).<br />Would you be so kind to compile a firm using HDD (with 3 partition like mentioned before) instead of USB?<br />it would help me a lot.<br />thanks<br />bonym</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p171431">
				<div class="post-metadata">
					<div class="post-num">Post #39</div>
					<div class="post-author">maartenjd</div>
					<div class="post-datetime">
						3 Jul 2012, 15:57					</div>
				</div>
				<div class="post-content content">
					<p>Larmoe,</p><p>Thanks once again.</p><p>1) I have got it working now for some weeks, compiled the primary kernel straight from your .config and the secondary as an initramfs in accordance with <a href="https://forum.openwrt.org/viewtopic.php?id=23901">https://forum.openwrt.org/viewtopic.php?id=23901</a>. One problem persists: When I do a cold reboot (after a power-off) the system boots the primary kernel (firmware) but remains in a loop on this error:</p><p>=============<br />....<br />Freeing unused kernel memory: 136k freed<br />Please be patient, while OpenWrt loads ...<br />irq 3: nobody cared (try booting with the &quot;irqpoll&quot; option)<br />Call Trace:[&lt;8000a2fc&gt;] 0x8000a2fc<br />[&lt;8000a2fc&gt;] 0x8000a2fc<br />[&lt;80059f00&gt;] 0x80059f00<br />[&lt;8005a0d4&gt;] 0x8005a0d4<br />[&lt;8005a8d8&gt;] 0x8005a8d8<br />[&lt;8004e008&gt;] 0x8004e008<br />.....<br />.....<br />handlers:<br />[&lt;8015dd3c&gt;]<br />Disabling IRQ #3<br />irq 3: nobody cared (try booting with the &quot;irqpoll&quot; option)<br />Call Trace:[&lt;8000a2fc&gt;] 0x8000a2fc<br />....<br />etc<br />=================</p><p>After a second (hot) reboot using the reset button, the system starts up normally</p><p>In a country with many power outages, that is not very handy. Any idea how to solve this? Indeed use the irqpoll option? Do you have similar experiences? Or could it be a consequence of having not enough NVRAM available for the JFFS? (need to look up that error report).</p><p>2) Still need to figure out why the system won&#039;t boot when a second USB-device (an external HD) is attached. I think that there I need to do some tweeking of the rc.local and use labels and/or UUID of the USB-boot stick and the external HD to tell the system from where to boot.</p><p>Regards,<br />Maarten</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p176603">
				<div class="post-metadata">
					<div class="post-num">Post #40</div>
					<div class="post-author">larmoe</div>
					<div class="post-datetime">
						1 Sep 2012, 10:34					</div>
				</div>
				<div class="post-content content">
					<p>Hi Maarten</p><p>I have the same problem. The router gets stuck in the kexec image after a cold boot, and the usb image doesn&#039;t load. I think that it&#039;s a memory/hardware problem since the router boots normally, when the &quot;halt&quot; command is issued before the power is disconnected.<br />Unfortunately this doesn&#039;t help in case of sudden power cut.&nbsp; &nbsp;</p><p>Regards <br />Lars</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p180692">
				<div class="post-metadata">
					<div class="post-num">Post #41</div>
					<div class="post-author">larmoe</div>
					<div class="post-datetime">
						15 Oct 2012, 23:51					</div>
				</div>
				<div class="post-content content">
					<p>There seems to be a solution under way for the &quot;cold boot issue&quot;: <a href="http://wl700ge.hezik.nl/comment/12#comment-12">http://wl700ge.hezik.nl/comment/12#comment-12</a> </p><p>/larmoe</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p181683">
				<div class="post-metadata">
					<div class="post-num">Post #42</div>
					<div class="post-author">Gregoire</div>
					<div class="post-datetime">
						28 Oct 2012, 17:55					</div>
				</div>
				<div class="post-content content">
					<p>Really nice to see such great info here and at <a href="http://wl700ge.hezik.nl/10.03.1">http://wl700ge.hezik.nl/10.03.1</a> :-)</p><p>Would it be possible to use the USB image, put the &quot;second&quot; image to USB, boot with USB, then do a rsync from USB to HDD, then do the final flash with a &quot;final&quot; HDD image ?</p><p>Also, am I right that after that I can update directly on the router (with opkg update ; opkg upgrade) ?</p><p>Thanks you very much !!!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p181789">
				<div class="post-metadata">
					<div class="post-num">Post #43</div>
					<div class="post-author">larmoe</div>
					<div class="post-datetime">
						29 Oct 2012, 22:01					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Gregoire wrote:</cite><blockquote><p>Would it be possible to use the USB image, put the &quot;second&quot; image to USB, boot with USB, then do a rsync from USB to HDD, then do the final flash with a &quot;final&quot; HDD image ?</p></blockquote></div><p>I don&#039;t get the point. If you want to free the front USB port, you can use one of the ports on the rear, or solder an extra port internally in the device.&nbsp; <br /></p><div class="quotebox"><cite>Gregoire wrote:</cite><blockquote><p>Also, am I right that after that I can update directly on the router (with opkg update ; opkg upgrade)</p></blockquote></div><p>Yes.</p><p>/larmoe</p>											<p class="post-edited">(Last edited by <strong>larmoe</strong> on 29 Oct 2012, 22:01)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p181857">
				<div class="post-metadata">
					<div class="post-num">Post #44</div>
					<div class="post-author">Gregoire</div>
					<div class="post-datetime">
						30 Oct 2012, 15:18					</div>
				</div>
				<div class="post-content content">
					<p>The point is to avoid removing the internal HDD, having to put it into a PC, copy the files to it, then put it back into the router which isn&#039;t really easy for everyone.<br />Afterthat we got a working router without usb needed at all (I don&#039;t need any usb on it as I use the internal hdd).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p189113">
				<div class="post-metadata">
					<div class="post-num">Post #45</div>
					<div class="post-author">Lieta</div>
					<div class="post-datetime">
						16 Jan 2013, 16:51					</div>
				</div>
				<div class="post-content content">
					<p>I get unaligned access when starting openvpn. How to fix it?<br />root@Lieta:/# /etc/init.d/openvpn start<br />root@Lieta:/# Unhandled kernel unaligned access[#1]:<br />Cpu 0<br />$ 0&nbsp; &nbsp;: 00000000 1000dc00 81060000 00010000<br />$ 4&nbsp; &nbsp;: 82556242 000000fa 8255623c 00000000<br />$ 8&nbsp; &nbsp;: 838ad710 83308560 838ad6c0 00000000<br />$12&nbsp; &nbsp;: ffffffff 8263a388 8263a390 00000001<br />$16&nbsp; &nbsp;: 83308560 838ad6c0 00000000 82554ac0<br />$20&nbsp; &nbsp;: 00000001 838ad774 810751a4 00000000<br />$24&nbsp; &nbsp;: 00000000 8255623c<br />$28&nbsp; &nbsp;: 838f0000 838f1c00 00010000 801a0534<br />Hi&nbsp; &nbsp; : 00000000<br />Lo&nbsp; &nbsp; : 000005e0<br />epc&nbsp; &nbsp;: 801a05d8 0x801a05d8<br />&nbsp; &nbsp; Not tainted<br />ra&nbsp; &nbsp; : 801a0534 0x801a0534<br />Status: 1000dc03&nbsp; &nbsp; KERNEL EXL IE<br />Cause : 00800010<br />BadVA : 82556242<br />PrId&nbsp; : 00029006 (Broadcom BCM3302)<br />Modules linked in: tun usb_storage usbserial usbnet uhci_hcd ohci_hcd xt_IMQ imq nf_nat_tftp nf_conntrack_tftp nf_nat_irc nf_conntrack_irc nf_nat_ftp nf_conntrack_ftp xt_HL xt_hl xt_MARK ipt_ECN xt_CLASSIFY xt_time xt_tcpmss xt_statistic xt_mark xt_length ipt_ecn xt_DSCP xt_dscp xt_string xt_layer7 ipt_MASQUERADE iptable_nat nf_nat xt_CONNMARK xt_recent xt_helper xt_conntrack xt_connmark xt_connbytes xt_NOTRACK iptable_raw xt_state nf_conntrack_ipv4 nf_defrag_ipv4 nf_conntrack ehci_hcd sd_mod pppoe pppox ipt_REJECT xt_TCPMSS ipt_LOG xt_comment xt_multiport xt_mac xt_limit iptable_mangle iptable_filter ip_tables xt_tcpudp x_tables ide_gd_mod bonding ext2 ext3 jbd ppp_async ppp_generic slhc aec62xx xfs vfat fat ntfs ext4 jbd2 b43legacy b43 mac80211 usbcore ts_fsm ts_bm ts_kmp scsi_mod nls_base ipv6 ide_core mbcache exportfs crc16 crc_ccitt cfg80211 compat arc4 aes_generic deflate ecb cbc switch_robo switch_core diag<br />Process openvpn (pid: 1695, threadinfo=838f0000, task=80d4a948, tls=00000000)<br />Stack : 82554ac0 801a1fcc 7ffd75e0 83302380 838ad6c0 00000000 838ad6c0 8022c79c<br />&nbsp; &nbsp; &nbsp; &nbsp; 00000008 0047ccd7 838f1d04 838f1e78 00000001 838f1c80 00000002 8385ed80<br />&nbsp; &nbsp; &nbsp; &nbsp; 80280000 83302380 82556200 838ad6c0 83302380 8022cab8 80d4a948 1000dc00<br />&nbsp; &nbsp; &nbsp; &nbsp; 80d4add0 80d4a948 800a61cc 0000001f 00000000 80d4a948 00000000 83302380<br />&nbsp; &nbsp; &nbsp; &nbsp; 838ad6c0 8028ac9c 82d51400 801acd00 838f1c68 800a6368 00100100 00200200<br />&nbsp; &nbsp; &nbsp; &nbsp; ...<br />Call Trace:[&lt;801a1fcc&gt;] 0x801a1fcc<br />[&lt;8022c79c&gt;] 0x8022c79c<br />[&lt;8022cab8&gt;] 0x8022cab8<br />[&lt;800a61cc&gt;] 0x800a61cc<br />[&lt;801acd00&gt;] 0x801acd00<br />[&lt;800a6368&gt;] 0x800a6368<br />[&lt;801acfa0&gt;] 0x801acfa0<br />[&lt;8001d66c&gt;] 0x8001d66c<br />[&lt;8009d874&gt;] 0x8009d874<br />[&lt;801ad778&gt;] 0x801ad778<br />[&lt;8001d7d4&gt;] 0x8001d7d4<br />[&lt;8002bb98&gt;] 0x8002bb98<br />[&lt;80220cec&gt;] 0x80220cec<br />[&lt;8002bcb0&gt;] 0x8002bcb0<br />[&lt;801ad94c&gt;] 0x801ad94c<br />[&lt;82d02638&gt;] 0x82d02638<br />[&lt;80093460&gt;] 0x80093460<br />[&lt;8003e0c4&gt;] 0x8003e0c4<br />[&lt;800940e8&gt;] 0x800940e8<br />[&lt;800942ac&gt;] 0x800942ac<br />[&lt;80003230&gt;] 0x80003230<br />[&lt;8002ae60&gt;] 0x8002ae60</p><br /><p>Code: 00641824&nbsp; 10600008&nbsp; 8e2400a4 &lt;c0820000&gt; 24420001&nbsp; e0820000&nbsp; 10400021&nbsp; 00000000&nbsp; 08068193<br />Disabling lock debugging due to kernel taint<br />Kernel panic - not syncing: Fatal exception in interrupt<br />Rebooting in 3 seconds..<br />Please stand by while rebooting the system...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p189115">
				<div class="post-metadata">
					<div class="post-num">Post #46</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						16 Jan 2013, 16:52					</div>
				</div>
				<div class="post-content content">
					<p>You probably forced installing an incompatible kmod-tun.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p189457">
				<div class="post-metadata">
					<div class="post-num">Post #47</div>
					<div class="post-author">Lieta</div>
					<div class="post-datetime">
						20 Jan 2013, 17:40					</div>
				</div>
				<div class="post-content content">
					<p>Thanks. I rebuilt everything from latest trunk. Another problem popped up. When I put the router under heavy load, e.g. download a torrent file with speed of some MB/s, it crashes.</p><p>root@Lieta:~# uname -a<br />Linux Lieta 3.6.11 #3 Fri Jan 18 22:59:23 UTC 2013 mips GNU/Linux<br />root@Lieta:/# [ 1064.912000] [sched_delayed] sched: RT throttling activated<br />[ 1123.212000] Unhandled kernel unaligned access[#1]:<br />[ 1123.212000] Cpu 0<br />[ 1123.212000] $ 0&nbsp; &nbsp;: 00000000 1000dc00 b54e6225 b54e6235<br />[ 1123.212000] $ 4&nbsp; &nbsp;: 00010000 00010000 8108220c 00000024<br />[ 1123.212000] $ 8&nbsp; &nbsp;: 00000020 81080000 00000004 00000001<br />[ 1123.212000] $12&nbsp; &nbsp;: 82c11f90 00000000 00000000 0000003c<br />[ 1123.212000] $16&nbsp; &nbsp;: 82d81bc0 00000001 802acc10 802e0000<br />[ 1123.212000] $20&nbsp; &nbsp;: 00000006 00000008 808e0000 808e0000<br />[ 1123.212000] $24&nbsp; &nbsp;: 00000000 801f5e6c<br />[ 1123.212000] $28&nbsp; &nbsp;: 82fa4000 82fa5ca0 00208140 801baa1c<br />[ 1123.212000] Hi&nbsp; &nbsp; : 00000000<br />[ 1123.212000] Lo&nbsp; &nbsp; : 00000000<br />[ 1123.212000] epc&nbsp; &nbsp;: 8006c140 put_page+0x34/0xbc<br />[ 1123.212000]&nbsp; &nbsp; &nbsp;Tainted: G&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;O<br />[ 1123.212000] ra&nbsp; &nbsp; : 801baa1c skb_release_data+0xf8/0x178<br />[ 1123.212000] Status: 1000dc03&nbsp; &nbsp; KERNEL EXL IE<br />[ 1123.212000] Cause : 00800010<br />[ 1123.212000] BadVA : b54e6235<br />[ 1123.212000] PrId&nbsp; : 00029006 (Broadcom BMIPS3300)<br />[ 1123.212000] Modules linked in: ide_gd_mod aec62xx ide_core usb_storage ohci_hcd nf_nat_irc nf_nat_ftp nf_conntrack_irc nf_conntrack_ftp ipt_MASQUERADE iptable_nat nf_nat pppoe xt_conntrack xt_CT xt_NOTRACK iptable_raw xt_state nf_conntrack_ipv4 nf_defrag_ipv4 nf_conntrack ehci_hcd sd_mod pppox ipt_REJECT xt_TCPMSS xt_LOG xt_comment xt_multiport xt_mac xt_limit iptable_mangle iptable_filter ip_tables xt_tcpudp x_tables tun ppp_async ppp_generic slhc ext4 jbd2 mbcache b43legacy(O) b43(O) mac80211(O) usbcore usb_common scsi_mod nls_base crc16 crc_ccitt cfg80211(O) compat(O) ssb_hcd bcma_hcd arc4 aes_generic crypto_blkcipher cryptomgr aead crypto_hash crypto_algapi switch_robo(O) switch_core(O) b44 diag(O)<br />[ 1123.212000] Process irq/6-b43 (pid: 941, threadinfo=82fa4000, task=82c031b8, tls=00000000)<br />[ 1123.212000] Stack : 82d10bc8 00000000 00000040 838c8560 82d81bc0 82d81bc0 82c29460 801baab8<br />&nbsp; &nbsp; &nbsp; &nbsp; 802d0000 801c487c 838c8560 82d81bc0 82d81bc0 801c3a60 82fa5cd8 82fa5cd8<br />&nbsp; &nbsp; &nbsp; &nbsp; 808e1204 00000007 00000001 808e1208 00000003 00000002 00000100 800204d0<br />&nbsp; &nbsp; &nbsp; &nbsp; 00ff0000 8005826c 802d0000 00010000 fffffffe 802d0000 1000dc00 82d74000<br />&nbsp; &nbsp; &nbsp; &nbsp; 00ff0000 8005826c 802d0000 00010000 fffffffe 802d0000 80060000 80020760<br />&nbsp; &nbsp; &nbsp; &nbsp; ...<br />[ 1123.212000] Call Trace:<br />[ 1123.212000] [&lt;8006c140&gt;] put_page+0x34/0xbc<br />[ 1123.212000] [&lt;801baa1c&gt;] skb_release_data+0xf8/0x178<br />[ 1123.212000] [&lt;801baab8&gt;] __kfree_skb+0x1c/0x1b8<br />[ 1123.212000] [&lt;801c3a60&gt;] net_tx_action+0xa0/0x1e0<br />[ 1123.212000] [&lt;800204d0&gt;] __do_softirq+0xc8/0x1b4<br />[ 1123.212000] [&lt;80020760&gt;] do_softirq+0x5c/0x94<br />[ 1123.212000] [&lt;80020994&gt;] irq_exit+0x4c/0x7c<br />[ 1123.212000] [&lt;80005744&gt;] ret_from_irq+0x0/0x4<br />[ 1123.212000] [&lt;8025992c&gt;] mutex_unlock+0x18/0xa0<br />[ 1123.212000] [&lt;82f07a24&gt;] b43_controller_restart+0x860/0xa3c [b43]<br />[ 1123.212000] [&lt;801a3f24&gt;] ssb_pci_write32+0x0/0x94<br />[ 1123.212000]<br />[ 1123.212000]<br />Code: 00a42024&nbsp; 10800008&nbsp; 00000000 &lt;c0640000&gt; 2485ffff&nbsp; e0650000&nbsp; 10a0fffc&nbsp; 00000000&nbsp; 0801b06c<br />[ 1123.472000] ---[ end trace 562f8b910bfe7f02 ]---<br />[ 1123.484000] Kernel panic - not syncing: Fatal exception in interrupt<br />[ 1123.484000] Rebooting in 3 seconds..</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p190032">
				<div class="post-metadata">
					<div class="post-num">Post #48</div>
					<div class="post-author">Lieta</div>
					<div class="post-datetime">
						26 Jan 2013, 13:39					</div>
				</div>
				<div class="post-content content">
					<p>pure-ftpd requires argp-standalone<br />No idea where to get it. Not available on <a href="http://downloads.openwrt.org/snapshots/trunk/brcm47xx/packages/">http://downloads.openwrt.org/snapshots/ â€¦ /packages/</a> and make menuconfig as well.<br />root@Lieta:~# opkg install pure-ftpd<br />Installing pure-ftpd (1.0.32-3) to root...<br />Downloading <a href="http://downloads.openwrt.org/snapshots/trunk/brcm47xx/packages/pure-ftpd_1.0.32-3_brcm47xx.ipk.">http://downloads.openwrt.org/snapshots/ â€¦ m47xx.ipk.</a><br />Collected errors:<br /> * satisfy_dependencies_for: Cannot satisfy the following dependencies for pure-ftpd:<br /> * &nbsp; &nbsp; argp-standalone * <br /> * opkg_install_cmd: Cannot install package pure-ftpd.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p219867">
				<div class="post-metadata">
					<div class="post-num">Post #49</div>
					<div class="post-author">fxvale</div>
					<div class="post-datetime">
						13 Dec 2013, 06:12					</div>
				</div>
				<div class="post-content content">
					<p>Hello!</p><p>To: larmoe<br /></p><div class="quotebox"><cite>larmoe wrote:</cite><blockquote><p>To-do next: Build a initramfs image to load from USB.</p></blockquote></div><p>I have a asus wl700ge router with 2mb rom. I took a USB-Flash Image from here (<a href="http://wl700ge.hezik.nl/node/116">http://wl700ge.hezik.nl/node/116</a>) and upload it in a router. Firmware is working, but how can I move it to a USB-Flash? Instruction from here (<a href="http://wl700ge.hezik.nl/content/30-change-root-hddusb">http://wl700ge.hezik.nl/content/30-change-root-hddusb</a>) is not suitable. Can you tell me, step by step, how to do it, since it is not described anywhere else for cropped version of OpenWRT <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p221298">
				<div class="post-metadata">
					<div class="post-num">Post #50</div>
					<div class="post-author">larmoe</div>
					<div class="post-datetime">
						31 Dec 2013, 00:12					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>fxvale wrote:</cite><blockquote><p>Firmware is working, but how can I move it to a USB-Flash?.</p></blockquote></div><p>The Flash image is only for the routers internal &quot;Flash&quot;. Use the &quot;Basic 2nd Image&quot; to put on your USB memory or compile your own kernel.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 2 of 2</div><nav><ul><li><a href="viewtopic.php%3Fid=25699&amp;p=1.html">1</a></li><li class="pagination-current"><span>2</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>