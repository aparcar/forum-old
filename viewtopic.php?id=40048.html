<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> [TL-WDR4300] Flashed with factory image -&gt; bricked</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 1 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p181112">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">svenz</div>
					<div class="post-datetime">
						21 Oct 2012, 18:51					</div>
				</div>
				<div class="post-content content">
					<p>I really did something stupid. My router (TP-Link WDR 4300 Ver 1.1) was flashed with the latest openwrt firmware for testing. I wanted to revert to the factory firmware for decent usb support, so I downloaded the latest official WDR 4300 firmware from the TP Link site and uploaded it into openwrt&#039;s control panel. I received the warning &quot;It appears that you try to flash an image that does not fit into the flash memory, please verify the image file!&quot; (It was 8,3 MB and router&#039;s memory was only 8,1 MB), but I ignored it since it couldn&#039;t be a problem; it was an official .bin file for wdr 4300.</p><p>Unfortunately the router doesn&#039;t do anything but giving a fancy blue light show... I connected the cable from wan to my computer and set the ip manually to 192...2, but couldn&#039;t receive a signal. Also tried the on/off button with the WPS/reset button to try to go in <a href="http://wiki.openwrt.org/doc/howto/generic.failsafe">failsafe mode</a>.</p><p>What do I do? I have no experience with openwrt and don&#039;t have a serial cable <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> Could I return it under warranty?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p181114">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">nebbia88</div>
					<div class="post-datetime">
						21 Oct 2012, 19:13					</div>
				</div>
				<div class="post-content content">
					<p>buy a cheap usb to serial cable XD (3.3V TTL level, for example those with pl2303 chip, or maybe you already have a dku-5/ca-42 nokia phone cable.. don&#039;t connect a &quot;classic&quot; RS232 serial port!)</p>											<p class="post-edited">(Last edited by <strong>nebbia88</strong> on 21 Oct 2012, 19:14)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p185552">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">svenz</div>
					<div class="post-datetime">
						8 Dec 2012, 19:30					</div>
				</div>
				<div class="post-content content">
					<p>I bought an Emintent usb to serial converter with Prolific PL2303 chipset. I connected it to the COM port of my computer, opened two Putty windows to both my COM ports (COM2 and COM4), plugged the cable into one of the usb ports of the router and started up the router. Nothing happens at the screen of Putty. I tried both USB ports. Am I doing something wrong?</p><p>Router isn&#039;t connected by ethernet yet, nor is the tftpd server active.</p><p>Device manager:<br /><a href="http://postimage.org/image/rttrdmqax/"><span class="postimg"><img src="http://s12.postimage.org/rttrdmqax/aparaatbeheer.jpg" alt="http://s12.postimage.org/rttrdmqax/aparaatbeheer.jpg" /></span></a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p186196">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">svenz</div>
					<div class="post-datetime">
						16 Dec 2012, 13:24					</div>
				</div>
				<div class="post-content content">
					<p>So, I should probably send it back for repair right?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p186197">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						16 Dec 2012, 13:44					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>svenz wrote:</cite><blockquote><p>Nothing happens at the screen of Putty. I tried both USB ports. Am I doing something wrong?</p></blockquote></div><p>My wndr3700 required that I plugged in the serial cable only after the power-on and the boot process had just started. If the serial cable was connected when I turn on the power, there was no output.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p186201">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">nebbia88</div>
					<div class="post-datetime">
						16 Dec 2012, 15:14					</div>
				</div>
				<div class="post-content content">
					<p>use linux if you can, you don&#039;t have the right drivers installed! those 2 com ports seems onboard, you can confirm noticing that they don&#039;t disappear when you disconnect the usb-to-serial...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p186208">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">johan666</div>
					<div class="post-datetime">
						16 Dec 2012, 17:15					</div>
				</div>
				<div class="post-content content">
					<p>if it is stock firmware, there is NO openwrt failsafe mode, do you know ?<br />Then, the default router IP is 192.168.0.1<br />NOT 192.168.1.1</p><p>Did you try that ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p186209">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						16 Dec 2012, 17:29					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>svenz wrote:</cite><blockquote><p>...plugged the cable into one of the <strong>usb ports of the router</strong> and started up the router. Nothing happens at the screen of Putty. I tried both USB ports. Am I doing something wrong?</p></blockquote></div><p>I read you wrongly on the first time. The serial connection does not work that way, as there is no USB support in the early part of the boot process. You have to open the router and connect the serial end to the connector inside the router. And then connect the USB side to a USB port in your PC. The serial connector is shown in the middle of the circuit board in the wiki&#039;s photo.<br /><a href="http://wiki.openwrt.org/toh/tp-link/tl-wdr4300#photos">http://wiki.openwrt.org/toh/tp-link/tl-wdr4300#photos</a></p><p>(Additionally, there is also advice what to do with the oversized firmware files. Apparently you have to cut the first 256 kB away in certain situations. <a href="http://wiki.openwrt.org/toh/tp-link/tl-wdr4300#back.to.original.firmware">http://wiki.openwrt.org/toh/tp-link/tl- … l.firmware</a> )</p>											<p class="post-edited">(Last edited by <strong>hnyman</strong> on 16 Dec 2012, 17:31)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p186210">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">nebbia88</div>
					<div class="post-datetime">
						16 Dec 2012, 17:41					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>svenz wrote:</cite><blockquote><p> I received the warning &quot;It appears that you try to flash an image that does not fit into the flash memory, please verify the image file!&quot; (It was 8,3 MB and router&#039;s memory was only 8,1 MB), but I ignored it since it couldn&#039;t be a problem; it was an official .bin file for wdr 4300.</p></blockquote></div><p>That was exactly the problem, you flashed an image that contained &quot;boot&quot; in name, you must strip that part before flashing to &quot;firmware&quot; partition, because the first 0x20200 bytes are for header and u-boot image <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><p>as wiki says:</p><p><a href="http://wiki.openwrt.org/toh/tp-link/tl-wdr4300#back.to.original.firmware">http://wiki.openwrt.org/toh/tp-link/tl- … l.firmware</a></p><br /><p>also, flash with mtd, not from luci:</p><p><a href="http://wiki.openwrt.org/doc/howto/generic.uninstall#via.openwrt.cli">http://wiki.openwrt.org/doc/howto/gener … penwrt.cli</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p187918">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">omiez</div>
					<div class="post-datetime">
						5 Jan 2013, 02:32					</div>
				</div>
				<div class="post-content content">
					<p>Hello Nebbia</p><p>Is there a way to cut the firmware using a Linux Machine with dd before uploading it to the Router like explained on the Wiki?</p><p>If yes how?</p><p>I use Lubuntu on one computer and want to prepare a original image to flash back in case of any problems.</p><p>Thank you.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p187926">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">nebbia88</div>
					<div class="post-datetime">
						5 Jan 2013, 08:55					</div>
				</div>
				<div class="post-content content">
					<p>Using dd on your pc???</p>											<p class="post-edited">(Last edited by <strong>nebbia88</strong> on 5 Jan 2013, 08:56)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p187996">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">omiez</div>
					<div class="post-datetime">
						6 Jan 2013, 02:32					</div>
				</div>
				<div class="post-content content">
					<p>In the Wiki it says:</p><div class="codebox"><pre><code>wget or scp the stock firmware file to /tmp/
cd /tmp
dd if=orig.bin of=tplink.bin skip=257 bs=512</code></pre></div><p>Using the command dd to cut the firmware.<br />Can i do this operatin on a Linux computer before uploading the firmware to the Router?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p188014">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						6 Jan 2013, 10:39					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>omiez wrote:</cite><blockquote><p>In the Wiki it says:</p><div class="codebox"><pre><code>wget or scp the stock firmware file to /tmp/
cd /tmp
dd if=orig.bin of=tplink.bin skip=257 bs=512</code></pre></div><p>Using the command dd to cut the firmware.<br />Can i do this operatin on a Linux computer before uploading the firmware to the Router?</p></blockquote></div><p>Yes. Read the man page of &quot;dd&quot; in your Linux pc...&nbsp; <br />Basically that command tells dd to skip over 257x512 bytes. And remember to adjust filenames according to the reality.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p188359">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">omiez</div>
					<div class="post-datetime">
						9 Jan 2013, 04:25					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>hnyman wrote:</cite><blockquote><div class="quotebox"><cite>omiez wrote:</cite><blockquote><p>In the Wiki it says:</p><div class="codebox"><pre><code>wget or scp the stock firmware file to /tmp/
cd /tmp
dd if=orig.bin of=tplink.bin skip=257 bs=512</code></pre></div><p>Using the command dd to cut the firmware.<br />Can i do this operatin on a Linux computer before uploading the firmware to the Router?</p></blockquote></div><p>Yes. Read the man page of &quot;dd&quot; in your Linux pc...&nbsp; <br />Basically that command tells dd to skip over 257x512 bytes. And remember to adjust filenames according to the reality.</p></blockquote></div><p>I will do a research of dd in Linux.</p><p>And yes i will use the the real filename of original firmware or simply rename the file in &quot;orig.bin&quot; in case of uploading the firmware directly to the router.</p><p>Does anyone of you flashed the router back to original firmware since you use it?</p><p>Another good idea would be someone to make the cutted firmware ready to flash in case of need.</p><p>Someone out there is able to do this please and share with us?</p><p>Thank you!</p><p>EDIT:</p><p>I used a Hex Editor to cut the original firmware to 0x20200 and now the size is exactly the one given in wiki.</p><p>I think this way I have cut the Header and Uboot.</p><p>Can anyone confirm this please and if can use this file to get back to original firmware?</p><p>I will also upload the file for other people that need to go back or recover.</p><p>Here is the Firmware that i cutted and is it exactly 8,126,464 Bytes like in Wiki.</p><p>If somebody need it to flash back or unbrick here it is.</p><p>l<br /><a href="http://www.4shared.com/zip/7HFS9EY-/Wdr4300_Cut.htm">LINK</a></p>											<p class="post-edited">(Last edited by <strong>omiez</strong> on 10 Jan 2013, 03:18)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p188954">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">omiez</div>
					<div class="post-datetime">
						15 Jan 2013, 02:42					</div>
				</div>
				<div class="post-content content">
					<p>Anybody?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p191565">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">svenz</div>
					<div class="post-datetime">
						10 Feb 2013, 17:36					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for all your help! I managed to link the rs232 to the board and get some info from putty. This is what I got:<br /><a href="http://postimage.org/image/817sxdplz/"><span class="postimg"><img src="http://s7.postimage.org/817sxdplz/rs232.jpg" alt="http://s7.postimage.org/817sxdplz/rs232.jpg" /></span></a></p><p>Is this special language for &quot;you unrecoverable bricked your router&quot;? <img src="https://forum.openwrt.org/img/smilies/roll.png" width="15" height="15" alt="roll" /></p><p>The VCC isn&#039;t connected, the ground is connected and the TX is connected to RX of RS232, RX to TX of RS232. I didn&#039;t receive a signal if I connected TX To TX and RX to RX. I double checked the pin numbers and connections.</p><p>@omiez you can use this file, it&#039;s the latest firmware without the boot:<br /></p><div class="codebox"><pre><code>http://speedy.sh/Tjs2S/tplink.bin</code></pre></div>											<p class="post-edited">(Last edited by <strong>svenz</strong> on 10 Feb 2013, 17:42)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p191571">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">nebbia88</div>
					<div class="post-datetime">
						10 Feb 2013, 19:03					</div>
				</div>
				<div class="post-content content">
					<p>You talk of RS232.. But you mean a ttl serial adapter, right? <br />Also, serial port settings?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p191573">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">svenz</div>
					<div class="post-datetime">
						10 Feb 2013, 19:14					</div>
				</div>
				<div class="post-content content">
					<p>My god. lol. I have a prolific usb to rs232. I&#039;ll buy the TTL version.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p191585">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">nebbia88</div>
					<div class="post-datetime">
						10 Feb 2013, 22:31					</div>
				</div>
				<div class="post-content content">
					<p>Uhm.. If its based on pl2303 should be ok?!? Whats the model name?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p191588">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">svenz</div>
					<div class="post-datetime">
						10 Feb 2013, 22:57					</div>
				</div>
				<div class="post-content content">
					<p>The shop said it was pl2303, but they removed the product. It&#039;s similar to this one:<br /><a href="http://www.compusb.com/usbtoseadfor.html">http://www.compusb.com/usbtoseadfor.html</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p191721">
				<div class="post-metadata">
					<div class="post-num">Post #21</div>
					<div class="post-author">db90h</div>
					<div class="post-datetime">
						11 Feb 2013, 22:09					</div>
				</div>
				<div class="post-content content">
					<p>This one is $7, awful cute, has driver support built into most Linux editions, and comes with current Windows drivers: <a href="http://www.amazon.com/gp/product/B006JKNWLE/ref=oh_details_o02_s00_i00">http://www.amazon.com/gp/product/B006JK … 02_s00_i00</a></p><p>Coincidentally, I have it hooked up to a TL-WDR4300 right now.</p><p>Oh, and the fact that you are getting output, even though it is scrambled due to your adapter or an inadequate or misconfigured connection, indicates that the router is not irrecovably bricked.</p>											<p class="post-edited">(Last edited by <strong>db90h</strong> on 11 Feb 2013, 22:54)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p191729">
				<div class="post-metadata">
					<div class="post-num">Post #22</div>
					<div class="post-author">svenz</div>
					<div class="post-datetime">
						12 Feb 2013, 00:02					</div>
				</div>
				<div class="post-content content">
					<p>Thanks! I&#039;ll leave the VCC unconnected and let you guys know how it turns out.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p192204">
				<div class="post-metadata">
					<div class="post-num">Post #23</div>
					<div class="post-author">svenz</div>
					<div class="post-datetime">
						16 Feb 2013, 15:56					</div>
				</div>
				<div class="post-content content">
					<p>Yey I have output <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /> But I can&#039;t manage to put in the tpl&amp;enter on time. I tried before &quot;autobooting&quot;, on the same time/right after, a little bit after and constantly during the total boot process. Is this because of a setting in putty (currently 115200, data 8, stop 1, parity none, flow control none)&nbsp; or should I connect the VCC to VCC of the usb? Btw, usb also has a 3V3 signal I can connect the vcc of router with.</p><p>Putty:<br /><a href="http://postimage.org/image/gkc9823uv/"><span class="postimg"><img src="http://s7.postimage.org/gkc9823uv/tpl.jpg" alt="http://s7.postimage.org/gkc9823uv/tpl.jpg" /></span></a></p><p>When connecting TX cable to TR I could see on putty what I was typing and the cables are well connected to the motherboard.</p>											<p class="post-edited">(Last edited by <strong>svenz</strong> on 16 Feb 2013, 16:03)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p192255">
				<div class="post-metadata">
					<div class="post-num">Post #24</div>
					<div class="post-author">nebbia88</div>
					<div class="post-datetime">
						17 Feb 2013, 02:23					</div>
				</div>
				<div class="post-content content">
					<p>Never use vcc!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p193631">
				<div class="post-metadata">
					<div class="post-num">Post #25</div>
					<div class="post-author">svenz</div>
					<div class="post-datetime">
						2 Mar 2013, 16:51					</div>
				</div>
				<div class="post-content content">
					<p>Okay <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> What would you suggest I do to solve this?</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>