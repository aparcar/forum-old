<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> ubiquiti EdgeRouter X (ER-X)</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 29 Mar 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 2 of 2</div><nav><ul><li><a href="viewtopic.php%3Fid=60896&amp;p=1.html">1</a></li><li class="pagination-current"><span>2</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p333194">
				<div class="post-metadata">
					<div class="post-num">Post #26</div>
					<div class="post-author">webtron</div>
					<div class="post-datetime">
						4 Aug 2016, 01:11					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ve been testing the trunk version on the SFP version of the router and the main thing that&#039;s missing is the ability to enable the poe on the ports. Has anyone worked out how to enable this? I&#039;ve tried all the GPIO info in the wiki but nothing so far.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p333740">
				<div class="post-metadata">
					<div class="post-num">Post #27</div>
					<div class="post-author">poldim</div>
					<div class="post-datetime">
						9 Aug 2016, 00:35					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>rstanford wrote:</cite><blockquote><p>Does anyone know if an updated version of this has been released.?</p><p>I have just purchased one and am getting garbage over the serial port. I&#039;m assuming it&#039;s a baud problem and have tried all rates from 9600 to 230400. I have had success with a Edgerouter lite so I know my serial hardware is ok.</p><p>The board on mine also look different from the photo on the page.</p></blockquote></div><p>I agree, just opened up a new one I got last week and it is similar to yours with a single screw on each side.<br /><a href="https://lh3.googleusercontent.com/zxVs0a2xVsAwuf_cH6ijSd3AhwL_bW7y_QuLndSpTxA78nSaPP0CJovKoDT7grW4N-f8ieokzH-ByQ=w1283-h962-no">https://lh3.googleusercontent.com/zxVs0 … 83-h962-no</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p337792">
				<div class="post-metadata">
					<div class="post-num">Post #28</div>
					<div class="post-author">combolek</div>
					<div class="post-datetime">
						10 Sep 2016, 05:35					</div>
				</div>
				<div class="post-content content">
					<p>HI, I am trying to setup OpenWrt on Edgerouter X but need some help.</p><p>I am following the instructions at the TOH wiki page (sorry, I am not allowed links). I got the serial console to work, but something must have changed in the build system. In menuconfig after choosing</p><p>Target system: Ralink RT288x/RT3xxx<br />Subtarget: MT7621 based boards</p><p>there is no way to choose </p><p>Target profile: Ubiquiti EdgeRouter X</p><p>In fact there are no profiles to choose from other than &quot;default profile&quot;. Digging through git history I found that they they were all deleted in this commit (again, can&#039;t link...):</p><p>&quot;ramips: convert a bunch of targets to new image building code&quot;<br />Commit 15458e85bc42672eb06dee5fb45597298b4a7162</p><p>So how/where do I choose the new equivalent of a target profile?</p><p>Thanks</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p337812">
				<div class="post-metadata">
					<div class="post-num">Post #29</div>
					<div class="post-author">combolek</div>
					<div class="post-datetime">
						10 Sep 2016, 11:11					</div>
				</div>
				<div class="post-content content">
					<p>OK, I figured out how to build the initramfs image (had to enable it in menuconfig) and I now have working OpenWrt.</p><p>However, switching back to stock firmware does not work. I can flash it using serial console and TFTP and it starts booting, but then it fails with UBI error and kernel panic.</p><p>Someone here in this thread (post #21) mentioned that you have to </p><div class="quotebox"><blockquote><p>restore rootfs mounting its UBIFS volume</p></blockquote></div><p>. But I don&#039;t know what that means or how to do it?</p><p>Below is the error that I am getting. Can anyone help?</p><p>Thanks</p><div class="codebox"><pre><code>## Booting image at bfd40000 ...
   Image Name:   Linux Kernel Image
   Image Type:   MIPS Linux Kernel Image (lzma compressed)
   Data Size:    1702204 Bytes =  1.6 MB
   Load Address: 80001000
   Entry Point:  803766f0
..........................   Verifying Checksum ... OK
   Uncompressing Kernel Image ... OK
No initrd
## Transferring control to Linux (at address 803766f0) ...
## Giving linux memsize in MB, 256

Starting kernel ...


LINUX started...

 THIS IS ASIC
Linux version 3.10.14-UBNT (root@edgeos-builder2) (gcc version 4.6.3 (Buildroot 2012.11.1) ) #1 SMP Fri Jul 29 16:53:39 PDT 2016

 The CPU feqenuce set to 880 MHz
GCMP present
CPU0 revision is: 0001992f (MIPS 1004Kc)
Software DMA cache coherency
Determined physical RAM map:
 memory: 10000000 @ 00000000 (usable)
Zone ranges:
  Normal   [mem 0x00000000-0x0fffffff]
Movable zone start for each node
Early memory node ranges
  node   0: [mem 0x00000000-0x0fffffff]
Detected 3 available secondary CPU(s)
Primary instruction cache 32kB, 4-way, VIPT, linesize 32 bytes.
Primary data cache 32kB, 4-way, PIPT, no aliases, linesize 32 bytes
MIPS secondary cache 256kB, 8-way, linesize 32 bytes.
PERCPU: Embedded 7 pages/cpu @81203000 s6720 r8192 d13760 u32768
Built 1 zonelists in Zone order, mobility grouping on.  Total pages: 65024
Kernel command line: console=ttyS1,57600n8 ubi.mtd=7 root=ubi0_0 rootfstype=ubifs rootsqimg=squashfs.img rootsqwdir=w rw
PID hash table entries: 1024 (order: 0, 4096 bytes)
Dentry cache hash table entries: 32768 (order: 5, 131072 bytes)
Inode-cache hash table entries: 16384 (order: 4, 65536 bytes)
Writing ErrCtl register=00022467
Readback ErrCtl register=00022467
Memory: 254796k/262144k available (3575k kernel code, 7348k reserved, 1031k data, 188k init, 0k highmem)
Hierarchical RCU implementation.
NR_IRQS:128
console [ttyS1] enabled
Calibrating delay loop... 577.53 BogoMIPS (lpj=1155072)
pid_max: default: 32768 minimum: 301
Security Framework initialized
Mount-cache hash table entries: 512
launch: starting cpu1
launch: cpu1 gone!
CPU1 revision is: 0001992f (MIPS 1004Kc)
Primary instruction cache 32kB, 4-way, VIPT, linesize 32 bytes.
Primary data cache 32kB, 4-way, PIPT, no aliases, linesize 32 bytes
MIPS secondary cache 256kB, 8-way, linesize 32 bytes.
Synchronize counters for CPU 1: done.
launch: starting cpu2
launch: cpu2 gone!
CPU2 revision is: 0001992f (MIPS 1004Kc)
Primary instruction cache 32kB, 4-way, VIPT, linesize 32 bytes.
Primary data cache 32kB, 4-way, PIPT, no aliases, linesize 32 bytes
MIPS secondary cache 256kB, 8-way, linesize 32 bytes.
Synchronize counters for CPU 2: done.
launch: starting cpu3
launch: cpu3 gone!
CPU3 revision is: 0001992f (MIPS 1004Kc)
Primary instruction cache 32kB, 4-way, VIPT, linesize 32 bytes.
Primary data cache 32kB, 4-way, PIPT, no aliases, linesize 32 bytes
MIPS secondary cache 256kB, 8-way, linesize 32 bytes.
Synchronize counters for CPU 3: done.
Brought up 4 CPUs
devtmpfs: initialized
NET: Registered protocol family 16
bio: create slab &lt;bio-0&gt; at 0
Switching to clocksource MIPS
NET: Registered protocol family 2
TCP established hash table entries: 2048 (order: 2, 16384 bytes)
TCP bind hash table entries: 2048 (order: 2, 16384 bytes)
TCP: Hash tables configured (established 2048 bind 2048)
TCP: reno registered
UDP hash table entries: 256 (order: 1, 8192 bytes)
UDP-Lite hash table entries: 256 (order: 1, 8192 bytes)
NET: Registered protocol family 1
4 CPUs re-calibrate udelay(lpj = 1167360)
squashfs: version 4.0 (2009/01/31) Phillip Lougher
Registering unionfs 2.5.13 (for 3.10.34)
aufs 3.10.x-20140915
msgmni has been set to 497
io scheduler noop registered
io scheduler cfq registered (default)
Serial: 8250/16550 driver, 2 ports, IRQ sharing disabled
serial8250: ttyS0 at MMIO 0x1e000d00 (irq = 27) is a 16550A
serial8250: ttyS1 at MMIO 0x1e000c00 (irq = 26) is a 16550A
Ralink gpio driver initialized
i2cdrv_major = 218
loop: module loaded
flash manufacture id: 1c, device id 70 15
EN25QH16(1c 70151c70) (2048 Kbytes)
mtd .name = raspi, .size = 0x00200000 (2M) .erasesize = 0x00010000 (64K) .numeraseregions = 0
Creating 1 MTD partitions on &quot;raspi&quot;:
0x000000000000-0x000000080000 : &quot;SPI_FLASH&quot;
MediaTek Nand driver init, version v2.1 Fix AHB virt2phys error
Allocate 16 byte aligned buffer: 804c0430
Enable NFI Clock
# MTK NAND # : Use HW ECC
NAND ID [01 DA 90 95 46, 00909546]
Device found in MTK table, ID: 1da, EXT_ID: 909546
Support this Device in MTK table! 1da
NAND device: Manufacturer ID: 0x01, Chip ID: 0xda (AMD/Spansion NAND 256MiB 3,3V 8-bit), 256MiB, page size: 2048, OOB size: 112
[NAND]select ecc bit:12, sparesize :112 spare_per_sector=28
Scanning device for bad blocks
Signature matched and data read!
load_fact_bbt success 2047
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
Creating 7 MTD partitions on &quot;MT7621-NAND&quot;:
0x000000000000-0x00000ff80000 : &quot;ALL&quot;
0x000000000000-0x000000080000 : &quot;Bootloader&quot;
0x000000080000-0x0000000e0000 : &quot;Config&quot;
0x0000000e0000-0x000000140000 : &quot;eeprom&quot;
0x000000140000-0x000000440000 : &quot;Kernel&quot;
0x000000440000-0x000000740000 : &quot;Kernel2&quot;
0x000000740000-0x00000ff00000 : &quot;RootFS&quot;
[mtk_nand] probe successfully!
UBNT BD mac 802aa85f532f kidx 1 mrev 18 serial 802AA85F532F type e50
rdm_major = 253
GMAC1_MAC_ADRH -- : 0x0000802a
GMAC1_MAC_ADRL -- : 0xa85f532f
Ralink APSoC Ethernet Driver Initilization. v3.1  512 rx/tx descriptors allocated, mtu = 1500!
GMAC1_MAC_ADRH -- : 0x0000802a
GMAC1_MAC_ADRL -- : 0xa85f532f
PROC INIT OK!
Ralink I2C Init
TCP: cubic registered
Initializing XFRM netlink socket
NET: Registered protocol family 17
NET: Registered protocol family 15
UBI: attaching mtd7 to ubi0
UBI: scanning is finished
UBI error: ubi_read_volume_table: the layout volume was not found
UBI error: ubi_attach_mtd_dev: failed to attach mtd7, error -22
UBI error: ubi_init: cannot attach mtd7
UBIFS error (pid 1): ubifs_mount: cannot open &quot;ubi0_0&quot;, error -19
VFS: Cannot open root device &quot;ubi0_0&quot; or unknown-block(0,0): error -19
Please append a correct &quot;root=&quot; boot option; here are the available partitions:
1f00             512 mtdblock0  (driver?)
1f01          261632 mtdblock1  (driver?)
1f02             512 mtdblock2  (driver?)
1f03             384 mtdblock3  (driver?)
1f04             384 mtdblock4  (driver?)
1f05            3072 mtdblock5  (driver?)
1f06            3072 mtdblock6  (driver?)
1f07          253696 mtdblock7  (driver?)
Kernel panic - not syncing: VFS: Unable to mount root fs on unknown-block(0,0)</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p338143">
				<div class="post-metadata">
					<div class="post-num">Post #30</div>
					<div class="post-author">Hamy</div>
					<div class="post-datetime">
						13 Sep 2016, 09:46					</div>
				</div>
				<div class="post-content content">
					<p>Hello all</p><p>Because of it&#039;s low price and seemingly good hardware, I am interested in this model. I would like to know the state of openwrt support for this model. Are you guys running the trunk versions without issues? in particular, i am interested in running openvpn on it and use it as a openvpn server. have any of you guys tried that and successfully established a vpn connection?</p><p>I would appreciate your input very much. <br />thanks</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p338160">
				<div class="post-metadata">
					<div class="post-num">Post #31</div>
					<div class="post-author">Hamy</div>
					<div class="post-datetime">
						13 Sep 2016, 14:01					</div>
				</div>
				<div class="post-content content">
					<p>@combolek<br />How did you exactly flash it? From what i&#039;ve read so far, it appears to me that the safest way to flash back to the stock firmware via uboot enviroment is to locate the kernel part and the ubifs part (which includes the squashfs file) in the firmware, then figure out which kernel is the active one, and then separately flash back kernel and ubifs partition.</p><p>Edit: well, what do you know. they&#039;re already separated in the stock fimeware .tar file</p>											<p class="post-edited">(Last edited by <strong>Hamy</strong> on 13 Sep 2016, 14:07)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p338314">
				<div class="post-metadata">
					<div class="post-num">Post #32</div>
					<div class="post-author">combolek</div>
					<div class="post-datetime">
						15 Sep 2016, 08:15					</div>
				</div>
				<div class="post-content content">
					<p>I tried different methods of flashing but the results are pretty much the same. First I tried using the bootloader option 2 to flash from TFTP (concatenated kernel+rootfs). I also tried flashing separately kernel and rootfs as you say, using mtd while booted the initramfs openwrt image.</p><p>I do not know how to flash directly from uboot command line. What are the commands?</p><p>AFAICT, openwrt is working fine, though I am only using it as a basic router/firewall. I have not tried openvpn.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p338315">
				<div class="post-metadata">
					<div class="post-num">Post #33</div>
					<div class="post-author">Hamy</div>
					<div class="post-datetime">
						15 Sep 2016, 08:59					</div>
				</div>
				<div class="post-content content">
					<p>Unfortunately i do not know much about UBI yet but i&#039;m pretty sure the issue relies on squashfs that needs to be inside a UBIFS partitions. according to the guy who added openwrt support for this device:</p><div class="quotebox"><blockquote><p>Stock firmware uses custom kernel patch to mount squashfs from a file that is located on UBIFS volume.</p></blockquote></div><p>This should possibly involve creating UBI/UBIFS then copying the squashfs file to that partition and potentially renaming it. base on how the custom kernel patch works, extra steps might be needed.</p><p>I suggest you directly try contacting the author of the openwrt patch (his email address is in the patch file). he should be able to solve this mystery.</p><p>for flashing in u-boot environment, you could use this as a reference:<br /><a href="https://wiki.openwrt.org/doc/howto/generic.flashing.serial">https://wiki.openwrt.org/doc/howto/gene … ing.serial</a><br />Though i do not think this would be necessary for reverting back to the stock firmware.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p338318">
				<div class="post-metadata">
					<div class="post-num">Post #34</div>
					<div class="post-author">combolek</div>
					<div class="post-datetime">
						15 Sep 2016, 09:39					</div>
				</div>
				<div class="post-content content">
					<p>Oh, thanks, will try this.</p><p>Actually, given that OpenWrt works fine and that&#039;s what I intend to use, I don&#039;t really need to go back to stock firmware. I just don&#039;t like the one way street on principle :-)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p338321">
				<div class="post-metadata">
					<div class="post-num">Post #35</div>
					<div class="post-author">Hamy</div>
					<div class="post-datetime">
						15 Sep 2016, 11:16					</div>
				</div>
				<div class="post-content content">
					<p>One more hack that might be worth trying is making a custom sysupgrade image actually containing stock firmware and use openwrt sysupgrade to flash it to the device(don&#039;t forget to add -n flag) . making such image is pretty simple, just extract both stock and sysupgrade tar files and you could figure it out.</p><p>just make sure that you&#039;re ready to recover from it in case things go wrong</p><p>Edit: Actually, scratch that. it likely wouldn&#039;t work.</p>											<p class="post-edited">(Last edited by <strong>Hamy</strong> on 15 Sep 2016, 11:23)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p338592">
				<div class="post-metadata">
					<div class="post-num">Post #36</div>
					<div class="post-author">combolek</div>
					<div class="post-datetime">
						19 Sep 2016, 03:52					</div>
				</div>
				<div class="post-content content">
					<p>OK, success. Someone else has figured it out :-). I used this post:<br /><a href="https://community.ubnt.com/t5/EdgeMAX/What-are-the-recovery-options-on-a-EdgeRouter-X/m-p/1678385#M128414">https://community.ubnt.com/t5/EdgeMAX/W … 85#M128414</a><br />Once I followed the steps to recreate the ubifs volume I was able to get back to stock firmware no problem.</p><p>So, now I can reflash OpenWrt again and keep using it with a piece of mind :-).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p338593">
				<div class="post-metadata">
					<div class="post-num">Post #37</div>
					<div class="post-author">Hamy</div>
					<div class="post-datetime">
						19 Sep 2016, 03:58					</div>
				</div>
				<div class="post-content content">
					<p>Great. please also consider adding the necessary steps the wiki so others could benefit as well.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p338602">
				<div class="post-metadata">
					<div class="post-num">Post #38</div>
					<div class="post-author">combolek</div>
					<div class="post-datetime">
						19 Sep 2016, 06:04					</div>
				</div>
				<div class="post-content content">
					<p>Heh, I spoke too soon. I now get the dreaded A12 error:<br /><a href="https://community.ubnt.com/t5/EdgeMAX/ERLite-3-Initialization-Error-A12-old-firmware-possible/td-p/1304245">https://community.ubnt.com/t5/EdgeMAX/E … -p/1304245</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p339318">
				<div class="post-metadata">
					<div class="post-num">Post #39</div>
					<div class="post-author">valentt</div>
					<div class="post-datetime">
						27 Sep 2016, 11:01					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>combolek wrote:</cite><blockquote><p>Heh, I spoke too soon. I now get the dreaded A12 error:<br /><a href="https://community.ubnt.com/t5/EdgeMAX/ERLite-3-Initialization-Error-A12-old-firmware-possible/td-p/1304245">https://community.ubnt.com/t5/EdgeMAX/E … -p/1304245</a></p></blockquote></div><p>But you can still run OpenWrt without problems, right?</p><p>Are there any issues with OpenWrt on ER-X devices or is everything working perfectly?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p339320">
				<div class="post-metadata">
					<div class="post-num">Post #40</div>
					<div class="post-author">Hamy</div>
					<div class="post-datetime">
						27 Sep 2016, 11:24					</div>
				</div>
				<div class="post-content content">
					<p>Just a side note for users wishing to switch to third party firmwares (like openwrt):<br />Always try to backup <strong>all</strong> original mtd partitions. sooner or later, you might need them. in case of this device, it likely just need a slight adjustment of ubf/ubfs settings/partitions. but aside from the fact that you could have restored the original mtds to revert back to the stock firmware and be done with it, they could have helped to uncover whats wrong what needs to be adjusted.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p339326">
				<div class="post-metadata">
					<div class="post-num">Post #41</div>
					<div class="post-author">valentt</div>
					<div class="post-datetime">
						27 Sep 2016, 13:30					</div>
				</div>
				<div class="post-content content">
					<p>@Hamy can you write up a short how to on wiki. It would be really helpful to have steps needed to backup and restore mtd partitions. For some who does this for first time it is a daunting task.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p342315">
				<div class="post-metadata">
					<div class="post-num">Post #42</div>
					<div class="post-author">combolek</div>
					<div class="post-datetime">
						28 Oct 2016, 05:11					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>valentt wrote:</cite><blockquote><div class="quotebox"><cite>combolek wrote:</cite><blockquote><p>Heh, I spoke too soon. I now get the dreaded A12 error:<br /><a href="https://community.ubnt.com/t5/EdgeMAX/ERLite-3-Initialization-Error-A12-old-firmware-possible/td-p/1304245">https://community.ubnt.com/t5/EdgeMAX/E … -p/1304245</a></p></blockquote></div><p>But you can still run OpenWrt without problems, right?</p><p>Are there any issues with OpenWrt on ER-X devices or is everything working perfectly?</p></blockquote></div><p>Yes, as far as I can tell OpenWrt works fine. I don&#039;t know of any problems but I am probably using only a small subset of the features.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p344245">
				<div class="post-metadata">
					<div class="post-num">Post #43</div>
					<div class="post-author">valentt</div>
					<div class="post-datetime">
						20 Nov 2016, 19:25					</div>
				</div>
				<div class="post-content content">
					<p>Was anyone successful in getting POE enabled on ports?</p>											<p class="post-edited">(Last edited by <strong>valentt</strong> on 20 Nov 2016, 19:25)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p344260">
				<div class="post-metadata">
					<div class="post-num">Post #44</div>
					<div class="post-author">webtron</div>
					<div class="post-datetime">
						20 Nov 2016, 23:02					</div>
				</div>
				<div class="post-content content">
					<p>Yes Sven worked it out and it&#039;s in the wiki now <a href="https://wiki.openwrt.org/toh/ubiquiti/ubiquiti_edgerouter_x_er-x_ka">https://wiki.openwrt.org/toh/ubiquiti/u … _x_er-x_ka</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p361619">
				<div class="post-metadata">
					<div class="post-num">Post #45</div>
					<div class="post-author">xl</div>
					<div class="post-datetime">
						7 Jul 2017, 03:50					</div>
				</div>
				<div class="post-content content">
					<p>it works!<br />thx a lot</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p368472">
				<div class="post-metadata">
					<div class="post-num">Post #46</div>
					<div class="post-author">n1ctf</div>
					<div class="post-datetime">
						20 Nov 2017, 01:49					</div>
				</div>
				<div class="post-content content">
					<p>Hello,<br />I am having issues upgrading a UBNT ERX from the factory openwrt image as follows.<br />Thank you very much in advance for your expert advice.</p><p>The problem is I am getting a system crash and reset when performing sysupgrade.<br />The factory image installed fine with the add command after compiling.<br />&nbsp; &nbsp; &nbsp; &nbsp;DESIGNATED DRIVER (Bleeding Edge, r49395) </p><p>I have tried upgrading with the latest download from <br />&nbsp; &nbsp; &nbsp;openwrt-ramips-mt7621-ubnt-erx-squashfs-sysupgrade.tar<br />as well as the tar file that make menuconfig created.</p><p>These are the commands that I wrote on a VirtualBox session of Ubuntu running on a Windows 7 host to build the compiled tar files:<br />git clone ... openwrt.git<br />cd openwrt<br />./scripts/feeds update -a<br />./scripts/feeds install -a<br />make menuconfig</p><p>These are the options I selected: <br />Ralink RT288x/RT3xxx<br />MT7621 based boards<br />Ubiquity Edge Router X<br />ramdisk<br />squashfs</p><p>this is the console view after running sysupgrade:<br />john@john-VirtualBox:/tmp$ ssh root@192.168.1.1</p><br /><p>BusyBox v1.24.2 () built-in shell (ash)</p><p>&nbsp; _______&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;________&nbsp; &nbsp; &nbsp; &nbsp; __<br /> |&nbsp; &nbsp; &nbsp; &nbsp;|.-----.-----.-----.|&nbsp; |&nbsp; |&nbsp; |.----.|&nbsp; |_<br /> |&nbsp; &nbsp;-&nbsp; &nbsp;||&nbsp; _&nbsp; |&nbsp; -__|&nbsp; &nbsp; &nbsp;||&nbsp; |&nbsp; |&nbsp; ||&nbsp; &nbsp;_||&nbsp; &nbsp;_|<br /> |_______||&nbsp; &nbsp;__|_____|__|__||________||__|&nbsp; |____|<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |__| W I R E L E S S&nbsp; &nbsp;F R E E D O M<br /> -----------------------------------------------------<br /> DESIGNATED DRIVER (Bleeding Edge, 50140)<br /> -----------------------------------------------------<br />&nbsp; * 2 oz. Orange Juice&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Combine all juices in a<br />&nbsp; * 2 oz. Pineapple Juice&nbsp; &nbsp; &nbsp; tall glass filled with<br />&nbsp; * 2 oz. Grapefruit Juice&nbsp; &nbsp; &nbsp;ice, stir well.<br />&nbsp; * 2 oz. Cranberry Juice<br /> -----------------------------------------------------<br />root@OpenWrt:~# cd /tmp<br />root@OpenWrt:/tmp# sysupgrade -v openwrt-ramips-mt7621-ubnt-erx-squashfs-sysupgr<br />ade.tar<br />Saving config files...<br />etc/config/dhcp<br />etc/config/dropbear<br />etc/config/firewall<br />etc/config/network<br />etc/config/system<br />etc/dropbear/dropbear_rsa_host_key<br />etc/group<br />etc/hosts<br />etc/inittab<br />etc/opkg/keys/af22f7a88858c8e9<br />etc/opkg/keys/ce8180f5ff8d2a38<br />etc/passwd<br />etc/profile<br />etc/rc.local<br />etc/shadow<br />etc/shells<br />etc/sysctl.conf<br />etc/sysctl.d/local.conf<br />killall: watchdog: no process killed<br />Connection to 192.168.1.1 closed by remote host.<br />Connection to 192.168.1.1 closed.<br />john@john-VirtualBox:/tmp$ </p><p>Regards,<br />John</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p368473">
				<div class="post-metadata">
					<div class="post-num">Post #47</div>
					<div class="post-author">webtron</div>
					<div class="post-datetime">
						20 Nov 2017, 01:53					</div>
				</div>
				<div class="post-content content">
					<p>Try using the -n switch when doing the sysupgrade to wipe the current config <br /></p><div class="codebox"><pre><code>sysupgrade -n openwrt-ramips-mt7621-ubnt-erx-squashfs-sysupgr
ade.tar</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p368503">
				<div class="post-metadata">
					<div class="post-num">Post #48</div>
					<div class="post-author">n1ctf</div>
					<div class="post-datetime">
						20 Nov 2017, 17:20					</div>
				</div>
				<div class="post-content content">
					<p>Webtron,<br />I tried the -n switch, and the same thing happens. It crashes and reboots.<br />One thing to tell you is that I followed the procedure on the openwrt site for clearing up memory for sysupgrades, in case the problem was lack of sufficient memory. This entailed deleting the cache and two directories. <br />Before I performed this step, I would receive a command failed error, and then sysupgrade exited, but the box did not reboot. <br />I did attempt the sysupgrade with the -n switch also.<br />Now that the directories are removed, it doesn&#039;t get as far and then it crashes. So apparently releasing memory created another problem.<br />Can you advise what the procedure is to recover, or to reinstall the factory image from an existing factory image? Do I need to recover back to the UBNT OS, and start again, or is there a simpler method if I already have the factory image on board?<br />Thank you for your assistance.<br />Regards,<br />John</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p368775">
				<div class="post-metadata">
					<div class="post-num">Post #49</div>
					<div class="post-author">floppus</div>
					<div class="post-datetime">
						25 Nov 2017, 04:21					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ve managed to make it work but hit a couple snags following the instructions on the wiki.</p><p>* First, there is no &quot;Target Profile&quot; for the EdgeRouter X.&nbsp; Only the default profile is available.</p><p>However, in order to build the &quot;factory&quot; image, the entire system must fit into 3 MB.&nbsp; So if you just use the default settings, the build will fail.</p><p>So you will need to go through the menuconfig and manually remove some unnecessary packages, such as WiFi and USB packages, in order to get the build to succeed.</p><p>I used the following:<br /></p><div class="codebox"><pre><code> Target System: Ralink RT288x/RT3xxx
 Subtarget: MT7621 based boards
 Target Profile: Default Profile
 Target Images &gt; ramdisk: Y
 Kernel Modules &gt; Wireless Drivers &gt; kmod-mt76: N
 Kernel Modules &gt; Wireless Drivers &gt; kmod-mac80211: N
 Kernel Modules &gt; Wireless Drivers &gt; kmod-cfg80211: N
 Kernel Modules &gt; USB Support &gt; kmod-usb3: N
 Kernel Modules &gt; USB Support &gt; kmod-usb-core: N
 Utilities &gt; iwinfo: N
 Network &gt; iw: N
 Network &gt; wpad-mini: N
 Network &gt; hostapd-common: N
 Libraries &gt; libiwinfo: N</code></pre></div><p>* Second, failsafe mode is BADLY broken: the device does not respond to any network activity on any port.&nbsp; This is apparently because the switch is configured to use VLANs by default, but failsafe mode doesn&#039;t understand that.&nbsp; The script /lib/preinit/07_set_preinit_iface_ramips works around the same issue for certain other models.</p><p>It seems to me that this workaround is a security risk; unless I&#039;m missing something, this script is invoked at every startup (failsafe or not), which would mean that the router is, if only briefly, acting as a dumb switch.&nbsp; If an attacker were able to exploit some other bug that would cause the router to reboot, this would give them a short window during which they could send packets that bypass the firewall.</p><p>At any rate, here&#039;s how to enable the workaround for ERX.&nbsp; (I have no idea whether this is appropriate/necessary for *all* MT7621 devices or not.)</p><div class="codebox"><pre><code>--- a/target/linux/ramips/base-files/lib/preinit/07_set_preinit_iface_ramips
+++ b/target/linux/ramips/base-files/lib/preinit/07_set_preinit_iface_ramips
@@ -6,7 +6,7 @@
 . /lib/ramips.sh
 
 ramips_set_preinit_iface() {
-    RT3X5X=`cat /proc/cpuinfo | egrep &quot;(RT3.5|RT5350|MT7628|MT7688|MT7620)&quot;`
+    RT3X5X=`cat /proc/cpuinfo | egrep &quot;(RT3.5|RT5350|MT7628|MT7688|MT7620|MT7621)&quot;`
 
     if [ -n &quot;${RT3X5X}&quot; ]; then
         # The ethernet switch driver enables VLAN by default, but
@@ -17,6 +17,9 @@ ramips_set_preinit_iface() {
         *MT7620*)
             ralink_switchdev=mt7620
             ;;
+        *MT7621*)
+            ralink_switchdev=mt7530
+            ;;
         esac
         swconfig dev $ralink_switchdev set reset 1
         swconfig dev $ralink_switchdev set enable_vlan 0</code></pre></div>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 2 of 2</div><nav><ul><li><a href="viewtopic.php%3Fid=60896&amp;p=1.html">1</a></li><li class="pagination-current"><span>2</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>