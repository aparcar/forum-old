<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> pppoe: Unable to complete PPPoE Discovery</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 1 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p10774">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">schoppa</div>
					<div class="post-datetime">
						15 Aug 2005, 00:21					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>after booting the pppoe needs more than 2 minutes to establish a connection. I get these error messages:</p><p>Any ideas?</p><div class="codebox"><pre><code>Jan  1 01:00:47 (none) kern.warn pppd[402]: Timeout waiting for PADS packets
Jan  1 01:00:47 (none) kern.err pppd[402]: Unable to complete PPPoE Discovery</code></pre></div><div class="codebox"><pre><code>....
        ifconfig $IFNAME up
        /usr/sbin/pppd nodetach \
                plugin rp-pppoe.so \
                connect /bin/true \
                usepeerdns \
                defaultroute \
                noipdefault \
                persist \
                noauth \
                hide-password \
                linkname $type \
                user &quot;$USERNAME&quot; \
                password &quot;$PASSWORD&quot; \
                $MTU \
                $REDIAL \
                $IFNAME
....</code></pre></div><div class="codebox"><pre><code>Jan  1 01:00:11 (none) kern.info kernel: PPP generic driver version 2.4.2
Jan  1 01:00:12 (none) kern.info pppd[402]: Plugin rp-pppoe.so loaded.
Jan  1 01:00:12 (none) user.info : Plugin rp-pppoe.so loaded.
Jan  1 01:00:12 (none) kern.notice pppd[402]: pppd 2.4.3 started by root, uid 0
Jan  1 01:00:17 (none) kern.notice crond[614]: crond 2.3.2 dillon, started, log level 8
Jan  1 01:00:17 (none) kern.info dropbear[625]: Running in background
Jan  1 01:00:33 (none) kern.info dropbear[627]: Child connection from 192.168.1.40:34015
Jan  1 01:00:37 (none) kern.notice dropbear[627]: password auth succeeded for &#039;root&#039; from 192.168.1.40:34015
Jan  1 01:00:47 (none) kern.warn pppd[402]: Timeout waiting for PADS packets
Jan  1 01:00:47 (none) kern.err pppd[402]: Unable to complete PPPoE Discovery
Jan  1 01:00:47 (none) user.info : Timeout waiting for PADS packets
Jan  1 01:00:47 (none) user.info : Unable to complete PPPoE Discovery
Jan  1 01:01:52 (none) kern.warn pppd[402]: Timeout waiting for PADS packets
Jan  1 01:01:52 (none) kern.err pppd[402]: Unable to complete PPPoE Discovery
Jan  1 01:01:52 (none) user.info : Timeout waiting for PADS packets
Jan  1 01:01:52 (none) user.info : Unable to complete PPPoE Discovery
Jan  1 01:02:23 (none) kern.info pppd[402]: PPP session is 8202
Jan  1 01:02:23 (none) user.info : PPP session is 8202
Jan  1 01:02:23 (none) kern.info pppd[402]: Using interface ppp0
Jan  1 01:02:23 (none) kern.notice pppd[402]: Connect: ppp0 &lt;--&gt; vlan1
Jan  1 01:02:23 (none) kern.warn pppd[402]: Couldn&#039;t increase MTU to 1500
Jan  1 01:02:23 (none) kern.warn pppd[402]: Couldn&#039;t increase MRU to 1500
Jan  1 01:02:23 (none) user.info : Using interface ppp0
Jan  1 01:02:23 (none) user.info : Connect: ppp0 &lt;--&gt; vlan1
Jan  1 01:02:23 (none) user.info : Couldn&#039;t increase MTU to 1500
Jan  1 01:02:23 (none) user.info : Couldn&#039;t increase MRU to 1500
Jan  1 01:02:23 (none) kern.notice pppd[402]: PAP authentication succeeded
Jan  1 01:02:23 (none) kern.notice pppd[402]: PAP authentication succeeded
Jan  1 01:02:23 (none) kern.notice pppd[402]: peer from calling number 00:90:1A:A0:15:B5 authorized
Jan  1 01:02:23 (none) user.info : PAP authentication succeeded
Jan  1 01:02:23 (none) user.info : PAP authentication succeeded
Jan  1 01:02:23 (none) user.info : peer from calling number 00:90:1A:A0:15:B5 authorized
Jan  1 01:02:23 (none) kern.notice pppd[402]: local  IP address 84.134.140.129
Jan  1 01:02:23 (none) kern.notice pppd[402]: remote IP address 217.0.116.115
Jan  1 01:02:23 (none) kern.notice pppd[402]: primary   DNS address 217.237.149.161
Jan  1 01:02:23 (none) kern.notice pppd[402]: secondary DNS address 217.237.150.97
Jan  1 01:02:23 (none) user.info : local  IP address 84.134.140.129
Jan  1 01:02:23 (none) user.info : remote IP address 217.0.116.115
Jan  1 01:02:23 (none) user.info : primary   DNS address 217.237.149.161
Jan  1 01:02:23 (none) user.info : secondary DNS address 217.237.150.97</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p11880">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">freezer2k</div>
					<div class="post-datetime">
						9 Sep 2005, 14:47					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>Ive got the exact same errors with the same symptom, it takes 2-3minutes after boot to have an etablished ppp connection.</p><br /><p>Maybe it has to do something with the MTU set @nvram? i set it to 1400 (AOL DSL in germany), in the log is also the error &quot;kern.warn pppd[402]: Couldn&#039;t increase MTU to 1500&quot;, after the 2-3minutes i get connected, BUT ifconfig shows an MTU of 1454 at the ppp0 device - not the 1400 i set in the nvram settings.</p><p>This also results that clients have problems with some www-sites (as example ebay.de). I can set the MTU manually to 1400, then all sites are accessible by the clients.</p><br /><br /><p>Greetz,<br />Freezer</p>											<p class="post-edited">(Last edited by <strong>freezer2k</strong> on 9 Sep 2005, 14:50)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p11918">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">roTT</div>
					<div class="post-datetime">
						10 Sep 2005, 19:15					</div>
				</div>
				<div class="post-content content">
					<p>i saw the same behaviour</p><p>modified /sbin/ifup.pppoe commenting this lines</p><p>&nbsp; &nbsp; &nbsp; &nbsp; #IDLETIME=$(nvram get ppp_idletime)<br />&nbsp; &nbsp; &nbsp; &nbsp; #IDLETIME=${IDLETIME:+lcp-echo-failure $IDLETIME}</p><p>now the &quot;power on to ppp link&quot; time is under a minute. reconnects are fast too</p><p>also a look in that file will help you to understand the nvram vars involved in the link creation, usefull if you have more than one (a)dsl provider.</p><p>hope this helps</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p11955">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">freezer2k</div>
					<div class="post-datetime">
						11 Sep 2005, 19:51					</div>
				</div>
				<div class="post-content content">
					<p>mh lol <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /></p><br /><p>out-commenting these lines in the config results that the &quot;power on to ppp up&quot; time has been increased to nearly 6 minutes <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /></p><br /><p>what does the ppp_idletime nvram value do? Will maybe help an other value? Also i noticed that this entry does not exist in my nvram!</p><br /><p>Greetz,<br />Freezer</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p11963">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">Shining</div>
					<div class="post-datetime">
						12 Sep 2005, 02:54					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>freezer2k wrote:</cite><blockquote><p>what does the ppp_idletime nvram value do?</p></blockquote></div><p>Its name is quite misleading - ppp_idletime sets the lcp-echo-failure value for pppd. Quoting from the pppd man page:<br /></p><div class="quotebox"><cite>manpage wrote:</cite><blockquote><p>If&nbsp; this&nbsp; option is given, pppd will presume the peer to be dead if n LCP echo-requests are sent without receiving&nbsp; a&nbsp; valid&nbsp; LCP<br />echo-reply.&nbsp; &nbsp;If&nbsp; this&nbsp; happens, pppd will terminate the connection.</p></blockquote></div><p>so values will lead to faster connection aborts.</p><p>Regarding the original problem: when the session initiation has advanced to a situation where a PADS is expected by the client, there already has been some information exchange between the client and the server. PADS packets may not arrive due to wrongly set MTU/MRU but it would be easier to tell if the &quot;debug&quot; option were switched on for the pppd process.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p12507">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">nieslpriem</div>
					<div class="post-datetime">
						22 Sep 2005, 09:26					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>im using &quot;White Russian RC3&quot; on a LinkSys WRT54GSv1.1.</p><div class="quotebox"><cite>freezer2k wrote:</cite><blockquote><p>Maybe it has to do something with the MTU set @nvram? i set it to 1400 (AOL DSL in germany), in the log is also the error &quot;kern.warn pppd[402]: Couldn&#039;t increase MTU to 1500&quot;, after the 2-3minutes i get connected, BUT ifconfig shows an MTU of 1454 at the ppp0 device - not the 1400 i set in the nvram settings.</p><p>This also results that clients have problems with some www-sites (as example ebay.de). I can set the MTU manually to 1400, then all sites are accessible by the clients.</p></blockquote></div><p>I have the same problem with ebay.de. But manually setting doesn&#039;t help.<br /></p><div class="codebox"><pre><code>root@OpenWrt:/etc# ifconfig ppp0 mtu 1454
root@OpenWrt:/etc# ifconfig ppp0
ppp0      Link encap:Point-Point Protocol
          inet addr:82.135.10.237  P-t-P:82.135.10.1  Mask:255.255.255.255
          UP POINTOPOINT RUNNING NOARP MULTICAST  MTU:1454  Metric:1
          RX packets:637 errors:0 dropped:0 overruns:0 frame:0
          TX packets:720 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:3
          RX bytes:682881 (666.8 KiB)  TX bytes:50584 (49.3 KiB)</code></pre></div><p>Here is the debug output from logread:<br /></p><div class="codebox"><pre><code>Jan  1 01:00:20 (none) kern.info kernel: PPP generic driver version 2.4.2
Jan  1 01:00:21 (none) kern.info pppd[302]: Plugin rp-pppoe.so loaded.
Jan  1 01:00:21 (none) user.info : Plugin rp-pppoe.so loaded.
Jan  1 01:00:21 (none) kern.notice pppd[302]: pppd 2.4.3 started by root, uid 0
Jan  1 01:00:22 (none) kern.debug pppd[302]: PADS: Service-Name: &#039;&#039;
Jan  1 01:00:22 (none) user.info : PADS: Service-Name: &#039;&#039;
Jan  1 01:00:22 (none) kern.info pppd[302]: PPP session is 59259
Jan  1 01:00:22 (none) user.info : PPP session is 59259
Jan  1 01:00:22 (none) kern.debug pppd[302]: using channel 1
Jan  1 01:00:22 (none) user.info : using channel 1
Jan  1 01:00:22 (none) kern.info pppd[302]: Using interface ppp0
Jan  1 01:00:22 (none) user.info : Using interface ppp0
Jan  1 01:00:22 (none) kern.notice pppd[302]: Connect: ppp0 &lt;--&gt; vlan1
Jan  1 01:00:22 (none) user.info : Connect: ppp0 &lt;--&gt; vlan1
Jan  1 01:00:22 (none) kern.warn pppd[302]: Couldn&#039;t increase MTU to 1500
Jan  1 01:00:22 (none) user.info : Couldn&#039;t increase MTU to 1500
Jan  1 01:00:22 (none) kern.warn pppd[302]: Couldn&#039;t increase MRU to 1500
Jan  1 01:00:22 (none) user.info : Couldn&#039;t increase MRU to 1500
Jan  1 01:00:22 (none) kern.debug pppd[302]: sent [LCP ConfReq id=0x1 &lt;mru 1400&gt; &lt;magic 0x8c7d8d60&gt;]
Jan  1 01:00:22 (none) user.info : sent [LCP ConfReq id=0x1 &lt;mru 1400&gt; &lt;magic 0x8c7d8d60&gt;]
Jan  1 01:00:22 (none) kern.debug pppd[302]: rcvd [LCP ConfReq id=0x5a &lt;mru 1492&gt; &lt;auth chap MD5&gt; &lt;magic 0x6846dbed&gt;] 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
Jan  1 01:00:22 (none) user.info : rcvd [LCP ConfReq id=0x5a &lt;mru 1492&gt; &lt;auth chap MD5&gt; &lt;magic 0x6846dbed&gt;] 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
Jan  1 01:00:22 (none) kern.debug pppd[302]: sent [LCP ConfAck id=0x5a &lt;mru 1492&gt; &lt;auth chap MD5&gt; &lt;magic 0x6846dbed&gt;]
Jan  1 01:00:22 (none) user.info : sent [LCP ConfAck id=0x5a &lt;mru 1492&gt; &lt;auth chap MD5&gt; &lt;magic 0x6846dbed&gt;]
Jan  1 01:00:22 (none) kern.debug pppd[302]: rcvd [LCP ConfAck id=0x1 &lt;mru 1400&gt; &lt;magic 0x8c7d8d60&gt;] 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
Jan  1 01:00:22 (none) user.info : rcvd [LCP ConfAck id=0x1 &lt;mru 1400&gt; &lt;magic 0x8c7d8d60&gt;] 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
Jan  1 01:00:22 (none) kern.debug pppd[302]: rcvd [CHAP Challenge id=0x1 &lt;97eb95a68a08a7b9930cb10398dcd164&gt;, name = &quot;ac1-br1-lanal052&quot;] 00
Jan  1 01:00:22 (none) user.info : rcvd [CHAP Challenge id=0x1 &lt;97eb95a68a08a7b9930cb10398dcd164&gt;, name = &quot;ac1-br1-lanal052&quot;] 00
Jan  1 01:00:22 (none) kern.debug pppd[302]: sent [CHAP Response id=0x1 &lt;1f46f493c4a2e53cbf95c96e47509412&gt;, name = &quot;X0009734@mdsl.mnet-online.de&quot;]
Jan  1 01:00:22 (none) user.info : sent [CHAP Response id=0x1 &lt;1f46f493c4a2e53cbf95c96e47509412&gt;, name = &quot;X0009734@mdsl.mnet-online.de&quot;]
Jan  1 01:00:23 (none) kern.debug pppd[302]: rcvd [CHAP Success id=0x1 &quot;CHAP authentication success, unit 9866&quot;]
Jan  1 01:00:23 (none) kern.info pppd[302]: CHAP authentication succeeded: CHAP authentication success, unit 9866
Jan  1 01:00:23 (none) kern.notice pppd[302]: CHAP authentication succeeded
Jan  1 01:00:23 (none) kern.notice pppd[302]: peer from calling number 00:02:3B:02:9C:84 authorized
Jan  1 01:00:23 (none) kern.debug pppd[302]: sent [IPCP ConfReq id=0x1 &lt;addr 0.0.0.0&gt; &lt;ms-dns1 0.0.0.0&gt; &lt;ms-dns3 0.0.0.0&gt;]
Jan  1 01:00:23 (none) kern.debug pppd[302]: rcvd [IPCP ConfReq id=0x3c &lt;addr 82.135.10.1&gt;] 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
Jan  1 01:00:23 (none) kern.debug pppd[302]: sent [IPCP ConfAck id=0x3c &lt;addr 82.135.10.1&gt;]
Jan  1 01:00:23 (none) user.info : rcvd [CHAP Success id=0x1 &quot;CHAP authentication success, unit 9866&quot;]
Jan  1 01:00:23 (none) user.info : CHAP authentication succeeded: CHAP authentication success, unit 9866
Jan  1 01:00:23 (none) user.info : CHAP authentication succeeded
Jan  1 01:00:23 (none) user.info : peer from calling number 00:02:3B:02:9C:84 authorized
Jan  1 01:00:23 (none) user.info : sent [IPCP ConfReq id=0x1 &lt;addr 0.0.0.0&gt; &lt;ms-dns1 0.0.0.0&gt; &lt;ms-dns3 0.0.0.0&gt;]
Jan  1 01:00:23 (none) user.info : rcvd [IPCP ConfReq id=0x3c &lt;addr 82.135.10.1&gt;] 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
Jan  1 01:00:23 (none) user.info : sent [IPCP ConfAck id=0x3c &lt;addr 82.135.10.1&gt;]
Jan  1 01:00:23 (none) kern.debug pppd[302]: rcvd [IPCP ConfNak id=0x1 &lt;addr 82.135.10.145&gt; &lt;ms-dns1 212.18.3.5&gt; &lt;ms-dns3 212.18.0.5&gt;] 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
Jan  1 01:00:23 (none) kern.debug pppd[302]: sent [IPCP ConfReq id=0x2 &lt;addr 82.135.10.145&gt; &lt;ms-dns1 212.18.3.5&gt; &lt;ms-dns3 212.18.0.5&gt;]
Jan  1 01:00:23 (none) user.info : rcvd [IPCP ConfNak id=0x1 &lt;addr 82.135.10.145&gt; &lt;ms-dns1 212.18.3.5&gt; &lt;ms-dns3 212.18.0.5&gt;] 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
Jan  1 01:00:23 (none) user.info : sent [IPCP ConfReq id=0x2 &lt;addr 82.135.10.145&gt; &lt;ms-dns1 212.18.3.5&gt; &lt;ms-dns3 212.18.0.5&gt;]
Jan  1 01:00:23 (none) kern.debug pppd[302]: rcvd [IPCP ConfAck id=0x2 &lt;addr 82.135.10.145&gt; &lt;ms-dns1 212.18.3.5&gt; &lt;ms-dns3 212.18.0.5&gt;] 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
Jan  1 01:00:23 (none) kern.notice pppd[302]: replacing old default route to br0 [192.168.0.1]
Jan  1 01:00:23 (none) kern.notice pppd[302]: local  IP address 82.135.10.145
Jan  1 01:00:23 (none) kern.notice pppd[302]: remote IP address 82.135.10.1
Jan  1 01:00:23 (none) kern.notice pppd[302]: primary   DNS address 212.18.3.5
Jan  1 01:00:23 (none) kern.notice pppd[302]: secondary DNS address 212.18.0.5
Jan  1 01:00:23 (none) user.info : rcvd [IPCP ConfAck id=0x2 &lt;addr 82.135.10.145&gt; &lt;ms-dns1 212.18.3.5&gt; &lt;ms-dns3 212.18.0.5&gt;] 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00</code></pre></div><p>Has someone found a solution?</p><p>TIA<br />Daniel</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p12602">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">doddel</div>
					<div class="post-datetime">
						23 Sep 2005, 13:07					</div>
				</div>
				<div class="post-content content">
					<p>addressed the problem here by a script that via telnet connects to the adsl modem and brings the adsl line down and up again. After that connect follows mostly quickly. Apparently the modems in the phone exchange and at the client can get into a situation that does not produce these PADS packets that the ppp negotiation is waiting for.<br />But, ...., we noticed here that the moments this problem happens often coincide with popular internet use moments.<br />ADSL modem capacity is in some telephone exchanges a scarce resource and requires investment by the telco.<br />So another possible source of the problem is your telco and the adsl capacity installed in the local exchange.</p><p>example of the script to talk with the modem, to be adapted to your needs:</p><p>#!/bin/sh<br />IFS=<br />host_attempt=0<br />while ((!( /bin/ping -c 1 **ipnumber_of_provider_gateway** | grep -q &#039;1 packets received&#039; )) &amp;&amp; \<br />&nbsp; &nbsp; &nbsp; &nbsp; [ $host_attempt -lt &#039;3&#039; ] )<br />do<br />&nbsp; &nbsp; &nbsp; &nbsp; host_attempt=`expr $host_attempt + 1`<br />&nbsp; &nbsp; &nbsp; &nbsp; /bin/sleep 1<br />done<br />&nbsp; &nbsp; &nbsp; &nbsp; LOGSTRING=&quot;`date`&quot;<br />if [ $host_attempt = 3 ] ; then<br />&nbsp; &nbsp; &nbsp; &nbsp; echo -e $LOGSTRING &gt;&gt; /etc/**your_choice_of_logname**.log<br />&nbsp; &nbsp; &nbsp; &nbsp; # kill pppoe and adsl link<br />&nbsp; &nbsp; &nbsp; &nbsp; /usr/bin/killall -9 ifup.pppoe<br />&nbsp; &nbsp; &nbsp; &nbsp; /usr/bin/killall -9 pppd<br />&nbsp; &nbsp; &nbsp; &nbsp; # bring down wan<br />&nbsp; &nbsp; &nbsp; &nbsp; /sbin/ifdown wan<br />&nbsp; &nbsp; &nbsp; &nbsp; /etc/init.d/fixed&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# fixed is a script that sets temporary nvram for static wan IP<br />&nbsp; &nbsp; &nbsp; &nbsp; /bin/sleep 1<br />&nbsp; &nbsp; &nbsp; &nbsp; /sbin/ifup wan&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# bring wan back up with modem&#039;s ip reachable<br />&nbsp; &nbsp; &nbsp; &nbsp; /etc/init.d/fixed_ipt&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# script to change and open the iptables firewall; do not use masquerade<br />&nbsp; &nbsp; &nbsp; &nbsp; nc -i 2 **ip_of_adsl_modem** 23 &lt;&lt;EOT | grep &quot;Downstream Noise Margin&quot; &gt;&gt; /etc/**your_choice_of_logname**.log<br />**modem&#039;s_password**<br />bsp line<br />bsp down<br />bsp up<br />@close<br />EOT<br />&nbsp; &nbsp; &nbsp; &nbsp; /bin/sleep 10<br />&nbsp; &nbsp; &nbsp; &nbsp;/etc/init.d/dynamic&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# script to restore nvram parameters to previous dynamic state<br />&nbsp; &nbsp; &nbsp; &nbsp; /bin/sleep 1<br />&nbsp; &nbsp; &nbsp; &nbsp; /sbin/ifup wan<br />&nbsp; &nbsp; &nbsp; &nbsp; /etc/init.d/**your_firewall**&nbsp; &nbsp; # restore iptables firewall<br />fi</p><p>=====================================<br />the commands after modem&#039;s password are specific for the OS of the modem and its Command line Interface (CLI).<br />This script logs the moments that this reconnect attempt is made and monitors the signal to noise ratio on the ADSL line. All of this script telnet detail is modem dependent. It starts talking to the modem after attempting three times without success to ping the Telco&#039;s gateway. NC is set to give out its command lines with two second intervals, until EOT comes along.<br />And this script is called by crond; we do it here every three minutes.</p>											<p class="post-edited">(Last edited by <strong>doddel</strong> on 23 Sep 2005, 13:09)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p12603">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">olli</div>
					<div class="post-datetime">
						23 Sep 2005, 13:29					</div>
				</div>
				<div class="post-content content">
					<p>Please update to the new White Russian RC3 release.</p><p>There are lots of PPP bugs fixed.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>