<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> QOS in OpenWRT that doesn&#039;t demolish download speeds (more)?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 29 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p174137">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">AndyInNYC</div>
					<div class="post-datetime">
						6 Aug 2012, 03:13					</div>
				</div>
				<div class="post-content content">
					<p>I have the latest backfire installed on my WNDR3700.&nbsp; I would like to enable QOS to allow me to use my VOIP business line without completely relagating my download speeds to dial-up levels.</p><p>As background, I have an Asterisk box in the basement connected to flowroute.com.&nbsp; I will only have a single call going at any given time.&nbsp; I also use a Skype softphone on occassion, but never both at the same time.</p><p>If I install and enable the luci QOS module, my download speeds go from 3MB/s to a few hundred K which is unbearable when trying to download multi-gig size files.</p><p>So, is there a module or configuration trick which will, if I pick up the phone or make a call on Skype, reserve the level of bandwith required for voice and let everything else run like the wind?</p><p>Thanks</p><p>Andrew</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p174157">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						6 Aug 2012, 09:01					</div>
				</div>
				<div class="post-content content">
					<p>I am using wndr3700 with &quot;Luci QoS&quot;, but the current trunk version, which is built on Codel logic. Continuous download speed yesterday was about 6 MB/s while upload at the same time was 0.5 MB/s. Ping latency was still low. (I have 110/5 Mb/s cable connection, so those speeds match that quite well.)</p><p>&quot;Latest Backfire&quot; is a contradictory concept, as most of the code is from March 2010 (10.03). Backfire has an old QoS module, which is not quite that good. (Also remember to adjust the speed limits on that QoS Luci page.)</p><p>I would strongly suggest that you jump from old Backfire to Attitude Adjustment trunk. It works ok.<br />If you want ready images for wndr3700, you can try these:<br /><a href="https://forum.openwrt.org/viewtopic.php?id=28392">https://forum.openwrt.org/viewtopic.php?id=28392</a><br /><a href="https://forum.openwrt.org/viewtopic.php?id=27722">https://forum.openwrt.org/viewtopic.php?id=27722</a></p>											<p class="post-edited">(Last edited by <strong>hnyman</strong> on 6 Aug 2012, 09:04)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p174170">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">eleon216</div>
					<div class="post-datetime">
						6 Aug 2012, 11:17					</div>
				</div>
				<div class="post-content content">
					<p>@AndyInNYC: did you set the upload/download speed for QOS?<br />And make sure you set all VOIP-Traffic to Express. If your asterixbox, is only for VOIP you could just make QOS-rules for its IP.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p174198">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">AndyInNYC</div>
					<div class="post-datetime">
						6 Aug 2012, 15:40					</div>
				</div>
				<div class="post-content content">
					<p>The firmware I have installed is:&nbsp; Backfire (10.03.1-RC6, r28680).&nbsp; I was of the impression that this is the latest/greatest of the official firmware.</p><p>I have seen arokh&#039;s 129 page thread, but I have also noticed a posting to which there was no reply regarding openvpn crashing upon startup.&nbsp; I&#039;m trying to get openvpn working on this machine, so I think I&#039;ll stay with the firmware I&#039;m using - at least until I know what&#039;s wrong on my side.&nbsp; When &#039;everyting else&#039; is working on my router I&#039;ll make the jump.</p><p>Can either of you suggest what settings I need to make in Luci QoS in order to &#039;reserve&#039; just enough bandwidth for a single VOIP call?</p><p>My phone system is 192.168.40.29 on my network and my file server is .28.&nbsp; The server has a number of functions, but the phone system is a dedicated box.&nbsp; I have no idea what QoS rules to create or how to create them - thanks for your guidance.</p><br /><p>Regards,</p><p>Andrew</p>											<p class="post-edited">(Last edited by <strong>AndyInNYC</strong> on 6 Aug 2012, 15:41)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p174199">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">AndyInNYC</div>
					<div class="post-datetime">
						6 Aug 2012, 17:16					</div>
				</div>
				<div class="post-content content">
					<p>Reserve in the last posting is a misstatement.&nbsp; I want all bandwidth available for normal uses.&nbsp; If a VOIP call is being made, I want to throttle back all the other uses so that I have bandwidth for the call without issues.</p><p>I don&#039;t want too much bandwidth being allocated for the call, nor do I want X% of my available bandwidth held in reserve in case I should make a phone call.</p><p>As a further hitch, I have an AT&amp;T MCell (micro cell) which captures my cell calls and runs them out over my broadband (I get terrible local AT&amp;T reception).&nbsp; Obviously I don&#039;t want to impair these calls either.&nbsp; I need to check, but let&#039;s pretend that the Micro Cell is 192.168.40.200 on the network.</p><p>Thanks again for any help you may provide.</p><p>Andrew</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p174200">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						6 Aug 2012, 17:38					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>AndyInNYC wrote:</cite><blockquote><p>The firmware I have installed is:&nbsp; Backfire (10.03.1-RC6, r28680).&nbsp; I was of the impression that this is the latest/greatest of the official firmware.</p></blockquote></div><p>The latest would the final 10.03.1, r29592. But that is also mainly based on the same old March 2010 code as the original Backfire 10.03.</p><p><a href="http://wiki.openwrt.org/about/history">http://wiki.openwrt.org/about/history</a>&nbsp; <br />Check the chart there. Backfire branched at r20655 two years ago. The later adjustments (for 10.03.1) have brought minor improvements, but mainly the codebase is two years old. It also uses different packages (like openvpn) than trunk, so its package versions can also be quite old.</p><p>Backfire&#039;s age is causing trouble for being the official release as the trunk is so much more advanced. It is definitely not &quot;the greatest&quot;.</p><p>Devs are apparently planning to release current Attitude Adjustment trunk as a new release in the next few days/weeks: <a href="https://lists.openwrt.org/pipermail/openwrt-devel/2012-August/016219.html">https://lists.openwrt.org/pipermail/ope â€¦ 16219.html</a></p><p>Trunk is quite good for everyday use.</p><p>------</p><p>Regarding Luci QoS: have you adjusted the speed limits there? What are your current limits? and your connection&#039;s nominal speed?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p174203">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">AndyInNYC</div>
					<div class="post-datetime">
						6 Aug 2012, 18:28					</div>
				</div>
				<div class="post-content content">
					<p>hnyman,</p><p>Presently I don&#039;t have QOS enabled - I need better inputs and understanding before I try again (hence my posting).<br />My download speed appears to be in excess of 3 MB/sec; I don&#039;t know my upload speed.</p><p>QOS shows up in Network -&gt; QOS; I thought I remembered it being under Services (like Dyndns and OpenVPN).&nbsp; I do have luci-app-qos installed.</p><p>Could you suggest settings which will allow me to meet my needs as described above?<br />Will I also need to download L7 protocols and set up anything else for Skype?</p><p>Thanks again.</p><p>Andrew</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p174204">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">towolf</div>
					<div class="post-datetime">
						6 Aug 2012, 18:50					</div>
				</div>
				<div class="post-content content">
					<p>First of all, the values to enter in the qos configuration are your maximal net bandwidth minus some headroom that qos needs to be effective (I hink this is no longer true for the post-backfire codel-based qos). Especially the upload value needs to be lower than the maximum you observed empirically.</p><p>I have a &quot;up to&quot; 16Mbit / 1Mbit line. The observed actual net rates are for me about 12Mbit and 950 kbit respectively. I hence entered this in the qos config</p><div class="codebox"><pre><code>  option download     12000  
  option upload       800</code></pre></div><p>Since you cannot control downstream in a meaningful manner I left it at 12000, but upstream needs the headroom and through testing with simultaneous saturating upload traffic and pings I settled on 800.</p><br /><p>I also have this stanza</p><div class="codebox"><pre><code>onfig classify                      
 option target       &quot;Express&quot;      
 option ports        &quot;22,5190,5060,5222,19295,19301-19310</code></pre></div><p>where the 19xxx ports are for Google voice and video chats, 5060 is supposed to be VoIP, but I have a hunch that this is only the port for negotiation not payload data. 5222 is XMPP instant messaging.</p><p>Iâ€™m not sure you can successfully prioritize Skype because Skype hides on port 80 and port 433, which are the usual HTTP(S) ports.</p>											<p class="post-edited">(Last edited by <strong>towolf</strong> on 6 Aug 2012, 18:51)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p174392">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">AndyInNYC</div>
					<div class="post-datetime">
						9 Aug 2012, 03:49					</div>
				</div>
				<div class="post-content content">
					<p>hnyman,</p><p>I installed the version of the firmware you reference.&nbsp; After typing my password into luci, my browser displays the following:</p><p>/usr/lib/lua/luci/dispatcher.lua:449: Failed to execute function dispatcher target for entry &#039;/&#039;.<br />The called action terminated with an exception:<br />/usr/lib/lua/luci/dispatcher.lua:449: Failed to execute firstchild dispatcher target for entry &#039;/admin&#039;.<br />The called action terminated with an exception:<br />/usr/lib/lua/luci/sauth.lua:97: attempt to perform arithmetic on field &#039;atime&#039; (a nil value)<br />stack traceback:<br />&nbsp; &nbsp; [C]: in function &#039;assert&#039;<br />&nbsp; &nbsp; /usr/lib/lua/luci/dispatcher.lua:449: in function &#039;dispatch&#039;<br />&nbsp; &nbsp; /usr/lib/lua/luci/dispatcher.lua:195: in function &lt;/usr/lib/lua/luci/dispatcher.lua:194&gt;</p><br /><p>So now I&#039;m a step back from square 1.</p><p>Can you suggest a fix or a way to install new firmware without luci?&nbsp; I still have internet connectivity, just no router management</p><p>Andrew</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p174406">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						9 Aug 2012, 08:31					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>AndyInNYC wrote:</cite><blockquote><p>hnyman,<br />I installed the version of the firmware you reference.</p></blockquote></div><p>??? which firmware and which revision?</p><p>I have been personally been using all those versions of my firmware, and have been able to login quite normally. </p><p>Regarding Arohk&#039;s firmware, there apparently was some problem yesterday: <a href="https://forum.openwrt.org/viewtopic.php?pid=174341#p174341">https://forum.openwrt.org/viewtopic.php â€¦ 41#p174341</a> . That is probably due to a firmware being made in middle of yesterday&#039;s changes to Luci&#039;s password dialogs: <a href="http://luci.subsignal.org/trac/changeset?new=8903%40luci&amp;old=8897%40luci">http://luci.subsignal.org/trac/changese â€¦ 897%40luci</a></p><p>Other possibility is that your browser cache is dirty and has some leftovers from the previous firmware&#039;s files. Use another browser or clear the browser cache.</p><p>Upgrading without Luci GUI is easy, just login to the router&#039;s console with SSH and then use command line commands to perform the actions. FTP to pull the new firmware from net (or copy it from USB stick) and then use &#039;sysupgrade&#039; command to update it. <a href="http://wiki.openwrt.org/doc/howto/generic.sysupgrade">http://wiki.openwrt.org/doc/howto/generic.sysupgrade</a></p><p>If you haven&#039;t used a Linux console earlier, now you have good reasons to get familiar with it ;-)<br />PuTTY is a great choice for a SSH/telnet tool.</p><p>Note also that if there is a password, SSH works but telnetl doesn&#039;t. If there is no password set, telnet works, but not SSH. <a href="http://wiki.openwrt.org/doc/howto/firstlogin">http://wiki.openwrt.org/doc/howto/firstlogin</a></p>											<p class="post-edited">(Last edited by <strong>hnyman</strong> on 9 Aug 2012, 08:33)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p174448">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">AndyInNYC</div>
					<div class="post-datetime">
						9 Aug 2012, 15:01					</div>
				</div>
				<div class="post-content content">
					<p>Yes, I discovered sysupgrade and it worked fine.&nbsp; I use putty all the time for editing, but I refuse to learn vi so I always install nano.</p><p>The version I installed was found under Index of /trondah/public_html/latest-release-is-r33035/ and was openwrt-ar71xx-generic-wndr3700-squashfs-sysupgrade.bin.</p><p>I did clear the cache, I&#039;m thinking that the file was &#039;new&#039; as of yesterday and that there is a problem.</p><p>I&#039;ll try again with it in a few days.</p><p>So I&#039;m now back up and running with release candidate (6?) and at least able to access luci.&nbsp; Perhaps this is best picked up post-vacation.</p><p>Andrew</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p174468">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						9 Aug 2012, 17:38					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>AndyInNYC wrote:</cite><blockquote><p>The version I installed was found under Index of /trondah/public_html/latest-release-is-r33035/ and was openwrt-ar71xx-generic-wndr3700-squashfs-sysupgrade.bin.</p></blockquote></div><p>Yeah, that was Arokh&#039;s firmware, not mine. Apparently that build hit a short-term login problem that has already been corrected: <br /><a href="http://luci.subsignal.org/trac/ticket/465">http://luci.subsignal.org/trac/ticket/465</a></p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>