<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> ar9331&#039;s usb stability issue - [SOLVED]</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 23 Mar 2017 and 6 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 13 of 13</div><nav><ul><li><a href="viewtopic.php%3Fid=39956&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39956&amp;p=11.html">11</a></li><li><a href="viewtopic.php%3Fid=39956&amp;p=12.html">12</a></li><li class="pagination-current"><span>13</span></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p243480">
				<div class="post-metadata">
					<div class="post-num">Post #301</div>
					<div class="post-author">tarelkin</div>
					<div class="post-datetime">
						11 Aug 2014, 15:54					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Bajramo wrote:</cite><blockquote><div class="quotebox"><cite>tarelkin wrote:</cite><blockquote><div class="quotebox"><cite>tarelkin wrote:</cite><blockquote><p>Hi. I have tplink tl-mr3040(v2.1, aa 12.09) &lt;---&gt; dlink hub(dub h7) &lt;---&gt; usb audio card (xonar U3), so i hear the &quot;sizzling/popping&quot; with and without playing music too. Could you please tell me what usb extension did you used to solve ground loop.</p></blockquote></div><br /><p>So, finally i have flashed it with BB 14.07-rc2 and I think the problem has gone.</p></blockquote></div><p>Does&nbsp; BB 14.07-rc2 include Lucl web interface or just CL interface?</p></blockquote></div><p>Not out of the box, firstly you have to install it from opkg repository.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p248193">
				<div class="post-metadata">
					<div class="post-num">Post #302</div>
					<div class="post-author">Graafvaag</div>
					<div class="post-datetime">
						26 Sep 2014, 14:59					</div>
				</div>
				<div class="post-content content">
					<p>This issue is marked &#039;solved&#039;, but as far as I can verify the issue still exists when the AR9331 is set up as station looking for AP&#039;s. I&#039;m talking specificly about the issue of the USB &#039;randomly&#039; freezing when running full speed instead of high speed.</p><p>Adding a hardware USB 2.0 hub is not a possible workaround in my situation for BOM cost reasons.</p><div class="quotebox"><cite>Squonk wrote:</cite><blockquote><p>... but it is nevertheless the same bug, we just have to find where to put the missing workaround macro!</p></blockquote></div><p>Has anyone since tried/succeeded &#039;fixing&#039; this driver for the unassociated-STA part? This could be something we can look into.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p248374">
				<div class="post-metadata">
					<div class="post-num">Post #303</div>
					<div class="post-author">danak6jq</div>
					<div class="post-datetime">
						28 Sep 2014, 20:33					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Graafvaag wrote:</cite><blockquote><p>This issue is marked &#039;solved&#039;, but as far as I can verify the issue still exists when the AR9331 is set up as station looking for AP&#039;s. I&#039;m talking specificly about the issue of the USB &#039;randomly&#039; freezing when running full speed instead of high speed.</p><p>Adding a hardware USB 2.0 hub is not a possible workaround in my situation for BOM cost reasons.</p><div class="quotebox"><cite>Squonk wrote:</cite><blockquote><p>... but it is nevertheless the same bug, we just have to find where to put the missing workaround macro!</p></blockquote></div><p>Has anyone since tried/succeeded &#039;fixing&#039; this driver for the unassociated-STA part? This could be something we can look into.</p></blockquote></div><p>I tinkered for a bit on this. I ended-up concluding that the unassociated-STA is autonomously repeatedly channel-scanning without software intervention, thus there&#039;s no hook for the macro that resets the USB PLL. Of course, I don&#039;t really know the details of the AR wlan interface and may be mistaken.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p255121">
				<div class="post-metadata">
					<div class="post-num">Post #304</div>
					<div class="post-author">ucefil</div>
					<div class="post-datetime">
						21 Nov 2014, 17:46					</div>
				</div>
				<div class="post-content content">
					<p>Microchip/SMSC USB2412 works well too!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p257055">
				<div class="post-metadata">
					<div class="post-num">Post #305</div>
					<div class="post-author">gloriatorios</div>
					<div class="post-datetime">
						9 Dec 2014, 08:55					</div>
				</div>
				<div class="post-content content">
					<p>Try to watch the register 0xb8116c84 and 0xb8116c88,check the value before and after wlan reset,and restore the value back when do wlan reset to workaround this &quot;wlan vs usb&quot; bug.There are many hang check in ath9k driver,and also current the ath9k driver is not stable enough for use,it&#039;s wlan reset very often,though nbd fix some deeply bug in the recently svn change,we still need dig the ath9k source code,the ath9k is not stable enough to do the AA formal release...<br />I get some info from atheros SDK,but i&#039;m not test it and don&#039;t make sure it&#039;s work for this topic.<br />_________________<br /><a href="http://www.xn----7sbbediizdzip6bvi.com/">vrati</a> <a href="http://www.xn----7sbbediizdzip6bvi.com/">блиндирани врати </a> <a href="http://www.xn----7sbbediizdzip6bvi.com/">врати за апартаменти</a> <a href="http://www.xn----7sbbediizdzip6bvi.com/">входни врати</a> <a href="http://www.xn----7sbbediizdzip6bvi.com/">метални врати</a> <a href="http://www.xn----7sbbediizdzip6bvi.com/">метални решетки</a> <a href="http://www.xn----7sbbediizdzip6bvi.com/">метални решетки цени</a></p>											<p class="post-edited">(Last edited by <strong>gloriatorios</strong> on 13 Dec 2014, 11:12)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p276240">
				<div class="post-metadata">
					<div class="post-num">Post #306</div>
					<div class="post-author">jmomo</div>
					<div class="post-datetime">
						14 May 2015, 05:09					</div>
				</div>
				<div class="post-content content">
					<p>FYI I had problems with a USB-serial adapter yesterday. The following kernel message was given.</p><p>[&nbsp; 382.210000] ftdi_sio ttyUSB0: failed to get modem status: -145</p><p>The USB device failed and I had to reset the USB to get it to work again.</p><p>My setup was a TP-Link TL-WR710N with a cheap Sabernet HB-UMLS 4-port USB hub and three USB-to-serial adapters on the hub. Only one was being used at the time.</p><p>OpenWRT build was r45574.</p><p>The host had Wifi on, in client mode, and unassociated with an AP. So, it was probably scanning.</p><p>It only happened once. After I reset the USB interface via the GPIO, it worked okay for the rest of the hour I needed it.</p><p>So, I am guessing this issue is not fully fixed, and it is possible for this problem to occur on a USB2.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p276301">
				<div class="post-metadata">
					<div class="post-num">Post #307</div>
					<div class="post-author">danak6jq</div>
					<div class="post-datetime">
						14 May 2015, 19:12					</div>
				</div>
				<div class="post-content content">
					<p>My experience with about 1000 devices running a custom ATmega16U4-based USB ACM device via a Microchip/SMSC USB2412 hub is that there are no problems with USB2. Same USB ACM device hangs in ~30 seconds without the hub.</p><p>I&#039;d tend to suspect the USB-serial error you saw is related to the USB-serial device itself.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p276346">
				<div class="post-metadata">
					<div class="post-num">Post #308</div>
					<div class="post-author">Squonk</div>
					<div class="post-datetime">
						15 May 2015, 08:48					</div>
				</div>
				<div class="post-content content">
					<p>@jmomo: does you hub enumerate as a full-speed or high-speed device? Please check dmseg.</p><p>Also, can you turn off WiFi for test purposes and see if the problem still occurs?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p276809">
				<div class="post-metadata">
					<div class="post-num">Post #309</div>
					<div class="post-author">jmomo</div>
					<div class="post-datetime">
						20 May 2015, 03:39					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Squonk wrote:</cite><blockquote><p>@jmomo: does you hub enumerate as a full-speed or high-speed device? Please check dmseg.</p><p>Also, can you turn off WiFi for test purposes and see if the problem still occurs?</p></blockquote></div><p>Good questions.</p><p>In the log below, I just now ssh&#039;d out to the unit which I posted about above and turned off the USB interface on, after having shut it off for a few seconds:</p><div class="codebox"><pre><code>Wed May 20 00:28:58 2015 kern.info kernel: [633000.300000] usb 1-1: new high-speed USB device number 34 using ehci-platform
Wed May 20 00:28:58 2015 kern.info kernel: [633000.450000] hub 1-1:1.0: USB hub found
Wed May 20 00:28:58 2015 kern.info kernel: [633000.450000] hub 1-1:1.0: 4 ports detected
Wed May 20 00:28:58 2015 kern.info kernel: [633000.750000] usb 1-1.1: new full-speed USB device number 35 using ehci-platform
Wed May 20 00:28:58 2015 kern.info kernel: [633000.860000] pl2303 1-1.1:1.0: pl2303 converter detected
Wed May 20 00:28:58 2015 kern.info kernel: [633000.860000] usb 1-1.1: pl2303 converter now attached to ttyUSB0
Wed May 20 00:28:58 2015 kern.info kernel: [633000.950000] usb 1-1.3: new full-speed USB device number 36 using ehci-platform
Wed May 20 00:28:59 2015 kern.info kernel: [633001.080000] pl2303 1-1.3:1.0: pl2303 converter detected
Wed May 20 00:28:59 2015 kern.info kernel: [633001.080000] usb 1-1.3: pl2303 converter now attached to ttyUSB1
Wed May 20 00:28:59 2015 kern.info kernel: [633001.180000] usb 1-1.4: new full-speed USB device number 37 using ehci-platform
Wed May 20 00:28:59 2015 kern.info kernel: [633001.320000] ftdi_sio 1-1.4:1.0: FTDI USB Serial Device converter detected
Wed May 20 00:28:59 2015 kern.info kernel: [633001.320000] usb 1-1.4: Detected FT232RL
Wed May 20 00:28:59 2015 kern.info kernel: [633001.320000] usb 1-1.4: FTDI USB Serial Device converter now attached to ttyUSB2</code></pre></div><p>You can see that the hub is doing USB2 and then the three serial devices are USB1.</p><p>To the best of my knowledge the hub has always negotiated as UBS2/High-speed, but if the problem happens again, I will be sure to look through the dmesg log to find out what the USB hub was negotiated at before the problems.</p><br /><br /><p>I can&#039;t answer the question regarding turning the WIFI off because the issue happens on a very intermittent basis and it&#039;s really hard to reproduce. I regret that I don&#039;t have the time to help test this in a more scientific way.</p><p>Sorry for being slow on reply to my post. I was not subscribed to the topic. I am now.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p276810">
				<div class="post-metadata">
					<div class="post-num">Post #310</div>
					<div class="post-author">jmomo</div>
					<div class="post-datetime">
						20 May 2015, 03:45					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>danak6jq wrote:</cite><blockquote><p>I&#039;d tend to suspect the USB-serial error you saw is related to the USB-serial device itself.</p></blockquote></div><p>That is possible.</p><p>I don&#039;t recall if I tested the other USB serial devices after that one failed or not. I suspect I just reset the USB interface and just moved on. I was dealing with a network outage at the time, so troubleshooting this USB issue wasn&#039;t my priority.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p276813">
				<div class="post-metadata">
					<div class="post-num">Post #311</div>
					<div class="post-author">jmomo</div>
					<div class="post-datetime">
						20 May 2015, 04:37					</div>
				</div>
				<div class="post-content content">
					<p>Oh wow.</p><p>I wrote the previous posts maybe an hour ago. I had left my device sitting there doing not much and didn&#039;t really think about it.</p><p>I just came back to it. I had a logread -f going in one terminal and was connected to a serial interface on the other via screen.</p><p>It spewed out a ton of USB errors. In fact, more than 32000 lines worth of them, overrunning my terminal scrollback buffer. So, I don&#039;t actually know what the errors started with.</p><p>Here&#039;s what I&#039;ve got:</p><div class="codebox"><pre><code>Wed May 20 01:15:30 2015 kern.err kernel: [635792.370000] usb 1-1: clear tt 1 (9233) error -71
Wed May 20 01:15:30 2015 kern.err kernel: [635792.380000] pl2303 ttyUSB0: usb_serial_generic_read_bulk_callback - nonzero urb status: -71
Wed May 20 01:15:30 2015 kern.err kernel: [635792.380000] usb 1-1: clear tt 1 (9243) error -71
Wed May 20 01:15:30 2015 kern.err kernel: [635792.380000] pl2303 ttyUSB1: usb_serial_generic_read_bulk_callback - nonzero urb status: -71
Wed May 20 01:15:30 2015 kern.err kernel: [635792.380000] usb 1-1: clear tt 1 (9233) error -71
Wed May 20 01:15:30 2015 kern.err kernel: [635792.390000] pl2303 ttyUSB0: usb_serial_generic_read_bulk_callback - nonzero urb status: -71
Wed May 20 01:15:30 2015 kern.err kernel: [635792.390000] usb 1-1: clear tt 1 (9243) error -71
Wed May 20 01:15:30 2015 kern.err kernel: [635792.390000] pl2303 ttyUSB1: usb_serial_generic_read_bulk_callback - nonzero urb status: -71
Wed May 20 01:15:30 2015 kern.err kernel: [635792.390000] usb 1-1: clear tt 1 (9233) error -71
Wed May 20 01:15:30 2015 kern.err kernel: [635792.400000] pl2303 ttyUSB0: usb_serial_generic_read_bulk_callback - nonzero urb status: -71
Wed May 20 01:15:30 2015 kern.err kernel: [635792.400000] usb 1-1: clear tt 1 (9243) error -71
Wed May 20 01:15:30 2015 kern.err kernel: [635792.400000] pl2303 ttyUSB1: usb_serial_generic_read_bulk_callback - nonzero urb status: -71
Wed May 20 01:15:30 2015 kern.err kernel: [635792.400000] usb 1-1: clear tt 1 (9233) error -71
Wed May 20 01:15:30 2015 kern.err kernel: [635792.410000] pl2303 ttyUSB0: usb_serial_generic_read_bulk_callback - nonzero urb status: -71
Wed May 20 01:15:30 2015 kern.err kernel: [635792.410000] usb 1-1: clear tt 1 (9243) error -71
Wed May 20 01:15:30 2015 kern.info kernel: [635792.410000] usb 1-1.1: USB disconnect, device number 35
Wed May 20 01:15:30 2015 kern.err kernel: [635792.410000] pl2303 ttyUSB0: pl2303_read_int_callback - usb_submit_urb failed with result -19
Wed May 20 01:15:30 2015 kern.info kernel: [635792.410000] pl2303 ttyUSB0: pl2303 converter now disconnected from ttyUSB0
Wed May 20 01:15:30 2015 kern.info kernel: [635792.410000] pl2303 1-1.1:1.0: device disconnected
Wed May 20 01:15:30 2015 kern.err kernel: [635792.410000] pl2303 ttyUSB1: usb_serial_generic_read_bulk_callback - nonzero urb status: -71
Wed May 20 01:15:30 2015 kern.err kernel: [635792.420000] usb 1-1: clear tt 1 (9233) error -71
Wed May 20 01:15:30 2015 kern.info kernel: [635792.420000] usb 1-1.3: USB disconnect, device number 36
Wed May 20 01:15:30 2015 kern.info kernel: [635792.420000] pl2303 ttyUSB1: pl2303 converter now disconnected from ttyUSB1
Wed May 20 01:15:30 2015 kern.info kernel: [635792.420000] pl2303 1-1.3:1.0: device disconnected
Wed May 20 01:15:30 2015 kern.err kernel: [635792.420000] usb 1-1: clear tt 1 (9243) error -71
Wed May 20 01:15:30 2015 kern.info kernel: [635792.430000] usb 1-1.4: USB disconnect, device number 37
Wed May 20 01:15:30 2015 kern.info kernel: [635792.430000] ftdi_sio ttyUSB2: FTDI USB Serial Device converter now disconnected from ttyUSB2
Wed May 20 01:15:30 2015 kern.info kernel: [635792.430000] ftdi_sio 1-1.4:1.0: device disconnected
Wed May 20 01:15:30 2015 kern.info kernel: [635792.550000] usb 1-1: reset high-speed USB device number 34 using ehci-platform
Wed May 20 01:15:31 2015 kern.info kernel: [635793.020000] usb 1-1.1: new full-speed USB device number 38 using ehci-platform
Wed May 20 01:15:31 2015 kern.info kernel: [635793.150000] pl2303 1-1.1:1.0: pl2303 converter detected
Wed May 20 01:15:31 2015 kern.info kernel: [635793.150000] usb 1-1.1: pl2303 converter now attached to ttyUSB0
Wed May 20 01:15:31 2015 kern.info kernel: [635793.250000] usb 1-1.3: new full-speed USB device number 39 using ehci-platform
Wed May 20 01:15:31 2015 kern.info kernel: [635793.380000] pl2303 1-1.3:1.0: pl2303 converter detected
Wed May 20 01:15:31 2015 kern.info kernel: [635793.380000] usb 1-1.3: pl2303 converter now attached to ttyUSB1
Wed May 20 01:15:31 2015 kern.info kernel: [635793.500000] usb 1-1.4: new full-speed USB device number 40 using ehci-platform
Wed May 20 01:15:31 2015 kern.info kernel: [635793.640000] ftdi_sio 1-1.4:1.0: FTDI USB Serial Device converter detected
Wed May 20 01:15:31 2015 kern.info kernel: [635793.640000] usb 1-1.4: Detected FT232RL
Wed May 20 01:15:31 2015 kern.info kernel: [635793.640000] usb 1-1.4: FTDI USB Serial Device converter now attached to ttyUSB2</code></pre></div><p>There are something like 30000 lines that look like the first few there.</p><p>At the time of these errors, the WIFI was on, in client mode, and scanning/unassociated.</p><p>All of the serial interfaces appear to be operating normally right now.</p><p>I regret that I do not have these devices to log to a syslog server or store their log files somewhere safe. I really don&#039;t know if this has happened before or how often it happens while I am not watching, because I only use my serial interfaces interactively on an as-needed basis. I usually check dmesg/logread when I log into a device, but I&#039;ve not noticed this before.</p>											<p class="post-edited">(Last edited by <strong>jmomo</strong> on 20 May 2015, 04:47)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p279664">
				<div class="post-metadata">
					<div class="post-num">Post #312</div>
					<div class="post-author">jmomo</div>
					<div class="post-datetime">
						11 Jun 2015, 04:24					</div>
				</div>
				<div class="post-content content">
					<p>I just had problems again with one of my ar9331 TP-Link TL-WR710N devices (described above).</p><p>Like before, wifi was in client mode and unassociated. I had a USB hub with a single USB-to-Serial adapter on it.</p><p>I started getting some weird lag and timeouts where my input was not taking or being echoed back to me. I didn&#039;t suspect anything was wrong with the serial device I was talking to (a Cisco ASA console), so I figured it was this bug again.</p><p>In the log below, you will see what I did.</p><p>I first shut down the wifi with &quot;wifi down&quot;, since I didn&#039;t need the 802.11 interface at the time. That seems to have caused the kernel to cough up an error on the serial interface I had been using a few seconds before.</p><p>This hardware can flip it&#039;s USB port on and off via a GPIO, and I had a script that does that, so that&#039;s what I did next. You see me shut down the USB interface at 23:34:50 and then turn it back on again at 23:34:54.</p><br /><div class="codebox"><pre><code>Wed Jun 10 23:33:32 2015 daemon.notice netifd: Interface &#039;wireless&#039; is disabled
Wed Jun 10 23:34:50 2015 kern.err kernel: [433099.970000] pl2303 ttyUSB0: usb_serial_generic_read_bulk_callback - nonzero urb status: -71
Wed Jun 10 23:34:50 2015 kern.info kernel: [433099.970000] usb 1-1: USB disconnect, device number 2
Wed Jun 10 23:34:50 2015 kern.info kernel: [433099.970000] usb 1-1.3: USB disconnect, device number 3
Wed Jun 10 23:34:50 2015 kern.info kernel: [433099.980000] pl2303 ttyUSB0: pl2303 converter now disconnected from ttyUSB0
Wed Jun 10 23:34:50 2015 kern.info kernel: [433099.980000] pl2303 1-1.3:1.0: device disconnected
Wed Jun 10 23:34:50 2015 kern.err kernel: [433099.990000] usb 1-1: clear tt 1 (9033) error -71
Wed Jun 10 23:34:54 2015 kern.info kernel: [433104.200000] usb 1-1: new high-speed USB device number 4 using ehci-platform
Wed Jun 10 23:34:54 2015 kern.info kernel: [433104.350000] hub 1-1:1.0: USB hub found
Wed Jun 10 23:34:54 2015 kern.info kernel: [433104.350000] hub 1-1:1.0: 4 ports detected
Wed Jun 10 23:34:54 2015 kern.info kernel: [433104.650000] usb 1-1.3: new full-speed USB device number 5 using ehci-platform
Wed Jun 10 23:34:54 2015 kern.info kernel: [433104.780000] pl2303 1-1.3:1.0: pl2303 converter detected
Wed Jun 10 23:34:54 2015 kern.info kernel: [433104.780000] usb 1-1.3: pl2303 converter now attached to ttyUSB0</code></pre></div><p>Note that this host has an uptime of about 4 days. It was working fine on day 1 and then yesterday.</p><p>If the clock was wandering around, it&#039;s subtle. It was enough to cause in/output problems but not quite enough to cause the serial device to die or generate kernel errors before I shut down wifi.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p284461">
				<div class="post-metadata">
					<div class="post-num">Post #313</div>
					<div class="post-author">dl163audience</div>
					<div class="post-datetime">
						22 Jul 2015, 06:05					</div>
				</div>
				<div class="post-content content">
					<p><a href="https://github.com/8devices/carambola2/commit/b08b59ceb4e7f0bad4c0b17e703e1e5c4e168923">https://github.com/8devices/carambola2/ … 5c4e168923</a><br />this patch will not prevent usb to hang if i use the usb_control_msg quicklly</p><p>if i use the usb&#039;s bulk transfer, it will stable, </p><p>but i use the usb&#039;s control transfer, it will still go to hang.</p><p>then it will post the -145 (which is timeout error if you continue to use the device):</p><p>the error is :</p><p>usb-1-1.4: usbfs: USBDEVFS_CONTROL failed cmd main rqt 64 rq 0 len 0 ret -145</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p284491">
				<div class="post-metadata">
					<div class="post-num">Post #314</div>
					<div class="post-author">dl163audience</div>
					<div class="post-datetime">
						22 Jul 2015, 12:02					</div>
				</div>
				<div class="post-content content">
					<p>i close the wifi, then test the usb control transfer, it will stable,<br />i i open the wifi, then test the usb control transfer, it will hang after working sometime,<br />so i think, it still relative to ar9331&#039;s wifi reset.<br />may be somewhere does&#039;t patched which still have some influences to the usb.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p300045">
				<div class="post-metadata">
					<div class="post-num">Post #315</div>
					<div class="post-author">charless.houeto</div>
					<div class="post-datetime">
						16 Nov 2015, 18:41					</div>
				</div>
				<div class="post-content content">
					<p>Me i have a comfatst router/ap cf-wa700 with Chipset: Qualcomm Atharos AR9341. but how can i use openwrt with it?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p319075">
				<div class="post-metadata">
					<div class="post-num">Post #316</div>
					<div class="post-author">roger_</div>
					<div class="post-datetime">
						11 Apr 2016, 05:07					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>RoutyMcRouter wrote:</cite><blockquote><p>I have a question I didn&#039;t see the answer to in this thread.</p><p>Is it possible that this is a power issue, but not necessarily a lack of power, but a lack of clean power?&nbsp; When I was looking on ebay for a cheap hub, a seller mentioned that a passive hub doesn&#039;t need a PS because of an internal 3.3VDC regulator.</p></blockquote></div><p>Could be, a passive hub fixed my problems.</p><p>But I don&#039;t know if there are stability complaints with stock device firmware, so I&#039;m still inclined to think it&#039;s a software issue.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p327444">
				<div class="post-metadata">
					<div class="post-num">Post #317</div>
					<div class="post-author">LuisR</div>
					<div class="post-datetime">
						6 Jun 2016, 21:57					</div>
				</div>
				<div class="post-content content">
					<p>I got two tl-mr3020 routers one with a hub and another one without a hub, both got a logitech cams with the same model and firmware version, everything goes well until I update the firmware to Chaos Chalmer r46996.<br />Before the update, routers where running fine for a year or more, Im using motion for a security survillance, but after the update, the one without the hub start to have problems with the usb connection, I didn&#039;t post before because I took the time to test for power problems, change the power capacitors, back to previous version and so on, the problem is solved turning off and on the usb power via gpio pin but there are problems at least, some times runs fine for a day or two but some other times get bad after a minute, I already testing a power problem, using the lab power, testing with the multimeter about power drain and so on, when using with an ethernet connection everything goes better but not perfect and when I turn on the wifi the problems are worst, my solution was putting a hub, but Im very limited with the free space inside the box having the router, the power and the cam.<br />I try to get back to the Openwrt version before chaos chalmer, but no lucky, the problem persist, and I dont fully understand Openwrt to check if there are some pll register or value that was modified after the upgrade and stored in some memory position or if the bootloader was changed in the upgrade, but I try and fail.</p><p>If someone can send me a tip I will really apreciate it, because I have no room to put a hub in the case that hold my cam.</p><p>Thanks and sorry for my english.<br />Luis</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 13 of 13</div><nav><ul><li><a href="viewtopic.php%3Fid=39956&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39956&amp;p=11.html">11</a></li><li><a href="viewtopic.php%3Fid=39956&amp;p=12.html">12</a></li><li class="pagination-current"><span>13</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>