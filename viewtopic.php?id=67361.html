<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> NAPTR support?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 19 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p337117">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">jack11brown11</div>
					<div class="post-datetime">
						4 Sep 2016, 02:15					</div>
				</div>
				<div class="post-content content">
					<p>Happy holiday weekend!</p><p>Does the version of dnsmasq that&#039;s provided with CC include support for naptr records?&nbsp; I&#039;ve checked the syntax using /usr/sbin/dnsmasq --test --naptr-record=blahblah and the syntax checks ok, but I&#039;m wondering if the startup script (/etc/init.d/dnsmasq) supports it?&nbsp; It appears to run through the config files looking for all the options, but naptr-record isn&#039;t there.</p><p>Maybe I&#039;m overlooking something?</p><p>If I can figure out naptr support, I can finally shut down another DNS server running on my SIP server so VOIP phones know where to make a connection to.</p><p>Jack</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p337189">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">stangri</div>
					<div class="post-datetime">
						5 Sep 2016, 04:03					</div>
				</div>
				<div class="post-content content">
					<p>Not sure about NAPTR support, but afaik, stuff which isn&#039;t configurable thru uci can be added to /etc/dnsmasq.conf. </p><p>You can check /tmp/etc/dnsmasq.conf to confirm your edits made it to the final config file actually used by dnsmasq on OpenWrt.</p><p>Please post results of your experiments. <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p337262">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">jack11brown11</div>
					<div class="post-datetime">
						5 Sep 2016, 22:22					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ve added the following to /etc/dnsmasq.conf (according to the limited information in the file itself for syntax)</p><p>srv-host=_sip._tcp.internal.int,sip.internal.int,5060<br />srv-host=_sip._udp.internal.int,sip.internal.int,5060</p><p>naptr-record=sip.internal.int,2,0,s,SIP+D2U,&quot;&quot;,_sip._udp<br />naptr-record=sip.internal.int,2,0,s,SIP+D2T,&quot;&quot;,_sip._tdp</p><p>The naptr-record syntax is adapted from the full man pages for dnsmasq.</p><p>After executing /etc/init.d/dnsmasq reload (and restart, even a reboot of the router,) none of these lines are recorded in /tmp/etc/dnsmasq.conf.</p><br /><p>Jack</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p337264">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">aafj</div>
					<div class="post-datetime">
						5 Sep 2016, 22:44					</div>
				</div>
				<div class="post-content content">
					<p><a href="https://wiki.openwrt.org/doc/uci/dhcp">dhcp_option</a>? Might get it to dnsmasq</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p337289">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">jack11brown11</div>
					<div class="post-datetime">
						6 Sep 2016, 00:48					</div>
				</div>
				<div class="post-content content">
					<p>Excellent suggestion.&nbsp; I was able to add the srv records and have them recognized by the dnsmasq script so they appear in /tmp/etc/dnsmasq.conf.</p><p>After doing further testing, it appears my SIP installation does not explicitly require NAPTR records, so I&#039;ll leave it at that.&nbsp; Though, someone else in the future may have a requirement.</p><p>Thanks for the awesome suggestion of the dhcp-option.&nbsp; There was even an example in the documentation for srv records that I just completely skipped over.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>