<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Need help using uqmi with Sierra Wireless MC7354, ipv6 and Verizon</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 28 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p373390">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">Dieter_SH</div>
					<div class="post-datetime">
						7 Mar 2018, 16:23					</div>
				</div>
				<div class="post-content content">
					<p>Hello everyone,</p><p>I run into a problem when I try to establish a connection when using ipv6 protocol on MC7354.</p><p>What I am using:<br />Embedded hardware (Allwinner A20, ARM Cortex A7) with Sierra Wireless modem MC7354. MC7354 has Verizon firmware installed.<br />Linux 3.19.0-rc6+ from Sunxi<br />uqmi from git, last snapshot from 2016-12-19<br />dhclient 4.36<br />Provider is Verizon with dual stack capability so I can use ipv4 and/or ipv6. APN is &quot;vzwinternet&quot;.</p><p>Maybe I use the uqmi tool and/or dhclient in a wrong way ?</p><p>Here is my procedure for ipv4 connection that works:<br />uqmi --device=/dev/cdc-wdm0 --wda-set-data-format 802.3</p><p>uqmi --device=/dev/cdc-wdm0 --keep-client-id wds --start-network vzwinternet --ip-family ipv4<br />1137624840</p><p>uqmi --device=/dev/cdc-wdm0 --get-data-status<br />&quot;connected&quot;</p><p>uqmi --device=/dev/cdc-wdm0 --get-current-settings<br />{<br />&nbsp; &nbsp; &nbsp; &nbsp; &quot;pdp-type&quot;: &quot;ipv4-or-ipv6&quot;,<br />&nbsp; &nbsp; &nbsp; &nbsp; &quot;ip-family&quot;: &quot;ipv4&quot;,<br />&nbsp; &nbsp; &nbsp; &nbsp; &quot;mtu&quot;: 1428,<br />&nbsp; &nbsp; &nbsp; &nbsp; &quot;ipv4&quot;: {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;ip&quot;: &quot;100.64.246.204&quot;,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;dns1&quot;: &quot;198.224.156.135&quot;,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;dns2&quot;: &quot;198.224.157.135&quot;,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;gateway&quot;: &quot;100.64.246.205&quot;,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;subnet&quot;: &quot;255.255.255.248&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; },<br />&nbsp; &nbsp; &nbsp; &nbsp; &quot;ipv6&quot;: {</p><p>&nbsp; &nbsp; &nbsp; &nbsp; },<br />&nbsp; &nbsp; &nbsp; &nbsp; &quot;domain-names&quot;: {</p><p>&nbsp; &nbsp; &nbsp; &nbsp; }<br />}</p><p>dhclient -4 -1 -v wwan0<br />Internet Systems Consortium DHCP Client 4.3.6</p><p>Listening on LPF/wwan0/76:50:94:8a:3e:ce<br />Sending on&nbsp; &nbsp;LPF/wwan0/76:50:94:8a:3e:ce<br />Sending on&nbsp; &nbsp;Socket/fallback<br />DHCPDISCOVER on wwan0 to 255.255.255.255 port 67 interval 7<br />DHCPREQUEST on wwan0 to 255.255.255.255 port 67<br />DHCPOFFER from 100.64.246.205<br />DHCPACK from 100.64.246.205<br />bound to 100.64.246.204 -- renewal in 2888 seconds.</p><p>ifconfig<br />lo&nbsp; &nbsp; &nbsp; &nbsp; Link encap:Local Loopback<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:127.0.0.1&nbsp; Mask:255.0.0.0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet6 addr: ::1/128 Scope:Host<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP LOOPBACK RUNNING&nbsp; MTU:65536&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:0 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:0 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:0 (0.0 B)&nbsp; TX bytes:0 (0.0 B)</p><p>wwan0&nbsp; &nbsp; &nbsp;Link encap:Ethernet&nbsp; HWaddr 76:50:94:8A:3E:CE<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:100.64.246.204&nbsp; Bcast:100.64.246.207&nbsp; Mask:255.255.255.248<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet6 addr: fe80::7450:94ff:fe8a:3ece/64 Scope:Link<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:2 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:10 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:1000<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:612 (612.0 B)&nbsp; TX bytes:1332 (1.3 KiB)</p><p>ping 8.8.8.8<br />PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.<br />64 bytes from 8.8.8.8: icmp_seq=1 ttl=52 time=136 ms<br />64 bytes from 8.8.8.8: icmp_seq=2 ttl=52 time=32.5 ms<br />64 bytes from 8.8.8.8: icmp_seq=3 ttl=52 time=32.6 ms<br />64 bytes from 8.8.8.8: icmp_seq=4 ttl=52 time=29.7 ms<br />64 bytes from 8.8.8.8: icmp_seq=5 ttl=52 time=27.6 ms</p><p>Now my procedure for ipv6 connection that <strong>doesn&#039;t work</strong>:</p><p>cat /proc/sys/net/ipv6/conf/wwan0/accept_ra<br />1&nbsp; &nbsp; &nbsp; &nbsp;-&gt; Router-Advertisement is on</p><p>uqmi --device=/dev/cdc-wdm0 --wda-set-data-format 802.3</p><p>uqmi --device=/dev/cdc-wdm0 --keep-client-id wds --start-network vzwinternet --ip-family ipv6<br />1137614968</p><p>uqmi --device=/dev/cdc-wdm0 --get-data-status<br />&quot;connected&quot;</p><p>uqmi --device=/dev/cdc-wdm0 --get-current-settings<br />{<br />&nbsp; &nbsp; &nbsp; &nbsp; &quot;pdp-type&quot;: &quot;ipv4-or-ipv6&quot;,<br />&nbsp; &nbsp; &nbsp; &nbsp; &quot;ip-family&quot;: &quot;ipv6&quot;,<br />&nbsp; &nbsp; &nbsp; &nbsp; &quot;mtu&quot;: 1428,<br />&nbsp; &nbsp; &nbsp; &nbsp; &quot;ipv4&quot;: {</p><p>&nbsp; &nbsp; &nbsp; &nbsp; },<br />&nbsp; &nbsp; &nbsp; &nbsp; &quot;ipv6&quot;: {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;ip&quot;: &quot;2600:100c:b211:76d7:4482:dac1:221:e5e9&quot;,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;ip-prefix-length&quot;: 64,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;gateway&quot;: &quot;2600:100c:b211:76d7:4cac:43d9:3409:c1e8&quot;,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;gw-prefix-length&quot;: 64,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;dns1&quot;: &quot;2001:4888:47:ff00:406:d::&quot;,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;dns2&quot;: &quot;2001:4888:41:ff00:404:d::&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; },<br />&nbsp; &nbsp; &nbsp; &nbsp; &quot;domain-names&quot;: {</p><p>&nbsp; &nbsp; &nbsp; &nbsp; }<br />}</p><p>Some curiosity: Every time I recall the &quot;--get-current-settings&quot; while &quot;--get-data-status&quot; is &quot;connected&quot; I get a new ipv6 address.</p><p>ifconfig wwan0 up&nbsp; &nbsp; &nbsp; &nbsp;(otherwise dhclient didn&#039;t find wwan0 interface)</p><p>Then dhclient fails:</p><p>dhclient -6 -1 -v wwan0<br />Internet Systems Consortium DHCP Client 4.3.6</p><p>Listening on Socket/wwan0<br />Sending on&nbsp; &nbsp;Socket/wwan0<br />Created duid &quot;\000\001\000\001\&quot;2\207\035\306\344\263\370\007\220&quot;.<br />PRC: Soliciting for leases (INIT).<br />XMT: Forming Solicit, 0 ms elapsed.<br />XMT:&nbsp; X-- IA_NA b3:f8:07:90<br />XMT:&nbsp; | X-- Request renew in&nbsp; +3600<br />XMT:&nbsp; | X-- Request rebind in +5400<br />XMT: Solicit on wwan0, interval 1010ms.<br />XMT: Forming Solicit, 1010 ms elapsed.<br />XMT:&nbsp; X-- IA_NA b3:f8:07:90<br />XMT:&nbsp; | X-- Request renew in&nbsp; +3600<br />XMT:&nbsp; | X-- Request rebind in +5400<br />XMT: Solicit on wwan0, interval 2100ms.<br />XMT: Forming Solicit, 3110 ms elapsed.<br />XMT:&nbsp; X-- IA_NA b3:f8:07:90<br />XMT:&nbsp; | X-- Request renew in&nbsp; +3600<br />XMT:&nbsp; | X-- Request rebind in +5400<br />XMT: Solicit on wwan0, interval 4180ms.<br />XMT: Forming Solicit, 7290 ms elapsed.<br />XMT:&nbsp; X-- IA_NA b3:f8:07:90<br />XMT:&nbsp; | X-- Request renew in&nbsp; +3600<br />XMT:&nbsp; | X-- Request rebind in +5400<br />XMT: Solicit on wwan0, interval 8460ms.<br />XMT: Forming Solicit, 15760 ms elapsed.<br />XMT:&nbsp; X-- IA_NA b3:f8:07:90<br />XMT:&nbsp; | X-- Request renew in&nbsp; +3600<br />XMT:&nbsp; | X-- Request rebind in +5400<br />XMT: Solicit on wwan0, interval 16400ms.<br />XMT: Forming Solicit, 32170 ms elapsed.<br />XMT:&nbsp; X-- IA_NA b3:f8:07:90<br />XMT:&nbsp; | X-- Request renew in&nbsp; +3600<br />XMT:&nbsp; | X-- Request rebind in +5400<br />XMT: Solicit on wwan0, interval 27840ms.<br />Max retransmission duration exceeded.</p><p>I tried to set the interface wwan0 and the route manually with the shown settings from &quot;--get-current-settings&quot; but this seems not to work.</p><p>Any help would be appreciated.</p><p>Dieter</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>