<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Kamikaze 7.09: IPv6 not being forwarded across the bridge</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 18 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p65640">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">eto_ch</div>
					<div class="post-datetime">
						24 Mar 2008, 13:17					</div>
				</div>
				<div class="post-content content">
					<p>I have 2 WRT54Gs running Kamikaze 7.09. WRT54G(1) is setup as an AP, WRT54G(2) as a bridge (sta) with the lan interface bridged. I have IPv4 and IPv6 enabled. The whole network is using the Cisco router as the default gateway and providing DHCP (for v4) and RA/ND (for v6) services. So there is no need for any 6to4 tunnel on my devices since I have native IPv6 Internet access off the router.</p><p>--Internet (v4 &amp; v6)-- Router --(LAN)-- WRT54G(1) --(wifi link)-- WRT54G(2) --(LAN)-- Workstations (v4 &amp; v6)</p><p>All works fine for IPv4 (DHCP assigned IP addresses, DNS resolution, IPv4 packets being forwarded, etc...)</p><p>IPv6 only works if connected to the WRT54G(1) or the Router. IPv6 traffic doesn&#039;t seem to cross the wifi bridge.</p><p>So on either side of the wifi link I can ping6 hosts.<br />The WRT54Gs and workstations do receive their IPv6 addresses using the RA/ND services. I&#039;ve also tried it with static IPv6 addresses assigned and have the same issue.</p><p>Any suggestions as to what the issue may be?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p65646">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">Wodin</div>
					<div class="post-datetime">
						24 Mar 2008, 13:47					</div>
				</div>
				<div class="post-content content">
					<p>Just a guess. Check your firewall rules. (ip6tables)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p65647">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">eto_ch</div>
					<div class="post-datetime">
						24 Mar 2008, 14:01					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Wodin wrote:</cite><blockquote><p>Just a guess. Check your firewall rules. (ip6tables)</p></blockquote></div><p>Thanks but ip6tables isn&#039;t even installed. I&#039;ve got my units down to a very lean configuration.</p><p>base-files-brcm-2.4 - 10-9078 - <br />bridge - 1.0.6-1 - <br />busybox - 1.4.2-2 - <br />dnsmasq - 2.39-1 - <br />dropbear - 0.50-2 - <br />iptables - 1.3.7-1 - <br />kernel - 2.4.34-brcm-1 - <br />kmod-brcm-wl - 2.4.34+4.80.53.0-1 - <br />kmod-diag - 2+2.4.34-brcm-1 - <br />kmod-ipv6 - 2.4.34-brcm-1 - <br />kmod-switch - 2.4.34-brcm-1 - <br />kmod-wlcompat - 2.4.34+brcm-6 - <br />libgcc - 3.4.6-10 - <br />mtd - 5 - <br />nas - 4.80.53.0-1 - <br />ntpclient - 2003_194-4 - <br />nvram - 1 - <br />uclibc - 0.9.28-10 - <br />wireless-tools - 29-1 - <br />wl - 4.80.53.0-1 - <br />wlc - 4.80.53.0-1 -</p><p>Could my issue be related in any way to the 2.4 vs 2.6 and IPv6 threads discussed elsewhere? Doesn&#039;t actually seem to be the same scenario since my setup is native, no firewall or tunnels required here.</p>											<p class="post-edited">(Last edited by <strong>eto_ch</strong> on 24 Mar 2008, 15:44)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p66014">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">eto_ch</div>
					<div class="post-datetime">
						30 Mar 2008, 18:14					</div>
				</div>
				<div class="post-content content">
					<p>*bump* <br />So I take it not too many people are running IPv6 without the tunnel broker and would have come across this issue? Or am I mistaken?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p66370">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">eggert</div>
					<div class="post-datetime">
						5 Apr 2008, 13:43					</div>
				</div>
				<div class="post-content content">
					<p>Just a wild guess, but perhaps you need<br /></p><div class="codebox"><pre><code>echo 1 &gt; /proc/sys/net/ipv6/conf/all/forwarding</code></pre></div><p>on the WRT (2)?</p>											<p class="post-edited">(Last edited by <strong>eggert</strong> on 5 Apr 2008, 13:43)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p66419">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">eto_ch</div>
					<div class="post-datetime">
						6 Apr 2008, 20:31					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>eggert wrote:</cite><blockquote><p>Just a wild guess, but perhaps you need<br /></p><div class="codebox"><pre><code>echo 1 &gt; /proc/sys/net/ipv6/conf/all/forwarding</code></pre></div><p>on the WRT (2)?</p></blockquote></div><p>Thanks.. gave it a try but still no success.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p66693">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">wobin</div>
					<div class="post-datetime">
						11 Apr 2008, 14:15					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>eto_ch wrote:</cite><blockquote><p>--Internet (v4 &amp; v6)-- Router --(LAN)-- WRT54G(1) --(wifi link)-- WRT54G(2) --(LAN)-- Workstations (v4 &amp; v6)</p><p>All works fine for IPv4 (DHCP assigned IP addresses, DNS resolution, IPv4 packets being forwarded, etc...)</p><p>IPv6 only works if connected to the WRT54G(1) or the Router. IPv6 traffic doesn&#039;t seem to cross the wifi bridge.</p></blockquote></div><p>I have exactly the same setup, and exactly the same problem.</p><p>I&#039;ve been running tcpdump on WRT(1). After a reboot of WRT(2) I get the following:</p><div class="codebox"><pre><code>13:08:48.278484 IP6 :: &gt; ff02::1:ffc7:20: ICMP6, neighbor solicitation, who has fe80::21d:7eff:fec7:20, length 24
13:08:49.234541 IP6 fe80::21d:7eff:fec7:20 &gt; ip6-allrouters: ICMP6, router solicitation, length 16
13:08:49.235304 IP6 fe80::21e:beff:fe7d:a29 &gt; ip6-allnodes: ICMP6, router advertisement, length 64
13:08:53.234431 IP6 fe80::21d:7eff:fec7:20 &gt; ip6-allrouters: ICMP6, router solicitation, length 16
13:08:53.235183 IP6 fe80::21e:beff:fe7d:a29 &gt; ip6-allnodes: ICMP6, router advertisement, length 64
13:08:57.234453 IP6 fe80::21d:7eff:fec7:20 &gt; ip6-allrouters: ICMP6, router solicitation, length 16
13:08:57.235215 IP6 fe80::21e:beff:fe7d:a29 &gt; ip6-allnodes: ICMP6, router advertisement, length 64
20 hello 2 fdelay 15</code></pre></div><p>fe80::21d:7eff:fec7:20 is the assigned link-local address on WRT(2)&#039;s wl0, fe80::21e:beff:fe7d:a29 is the router. The address from my assigned prefix is set on br-lan.</p><p>So sollicitation and advertising go OK. I also get my assigned prefix from the router. But even doing a ping to the router (either the configured address from the prefix or the link-local address) does nothing. It seems that WRT(2) does not send the traffic out over wl0.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p66695">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">xerces8</div>
					<div class="post-datetime">
						11 Apr 2008, 14:43					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>eggert wrote:</cite><blockquote><p>Just a wild guess, but perhaps you need<br /></p><div class="codebox"><pre><code>echo 1 &gt; /proc/sys/net/ipv6/conf/all/forwarding</code></pre></div><p>on the WRT (2)?</p></blockquote></div><p>When bridging, routing is not needed.</p><p>I have a similar problem, but on different hardware:<br /> - OpenWRT (1.0) on router, acting as AP, with IPv6 stack enabled and radvd running<br /> - laptop running Windows XP connected over Wifi (station)<br /> - the same laptop runs several virtual machines (VMWare, set up for briged networking) (VM OS is linux and Windows)</p><p>I seems that the VMs have full IPv4 functionality, but not IPv6. As if IPv6 has problems passing bridges.</p><p>Regards,<br />David</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p66697">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">wobin</div>
					<div class="post-datetime">
						11 Apr 2008, 15:12					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>wobin wrote:</cite><blockquote><p>It seems that WRT(2) does not send the traffic out over wl0.</p></blockquote></div><p>It does. Traffic goes out wl0 on WRT(2), but does not enter wl0 on WRT(1). Now that&#039;s weird.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p70553">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">dom</div>
					<div class="post-datetime">
						6 Jul 2008, 18:35					</div>
				</div>
				<div class="post-content content">
					<p>I have pretty much the same problem:</p><p>ADSL (v4 and v6) &lt;-wired-&gt; Debian router &lt;-wired-&gt; 3com AP &lt;-wireless-&gt; WRT54GL &lt;-wired-&gt; desktop</p><p>WRT54GL is bridging wireless to wired in client mode.</p><p>Desktop can pass ipv4/ipv6 traffic succesfully when connected via PCI wireless card, but can only pass ipv4 traffic when connected via the WRT54GL.</p><p>tcpdump on the WRT54GL shows the &quot;ICMP6, neighbor solicitation&quot; packets travelling across wl0, but they do not appear on the interface<br />on the router.</p><p>Anyone have any further thoughts?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p70590">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">eto_ch</div>
					<div class="post-datetime">
						7 Jul 2008, 15:10					</div>
				</div>
				<div class="post-content content">
					<p>So this does seem to be more than an isolated issue (sort of glad to know I&#039;m not on my own). How can we work on getting this fixed?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p73131">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">automatthias</div>
					<div class="post-datetime">
						8 Sep 2008, 11:19					</div>
				</div>
				<div class="post-content content">
					<p>I has similar symptoms. My network layout:</p><p>openwrt (+radvd) ---switch--- clover (+virtualbox) ---clover:br0(eth0+vbox0)--- lobelia (guest OS)</p><p>IPv6 address autoconfiguration didn&#039;t work on lobelia. Lobelia was sending neighbor solicitations, openwrt was replying with neighbor advertisements, but they weren&#039;t arriving at lobelia. I was debugging it, then left it for an hour, and when I came back, lobelia had its ipv6 address configured. I have no idea what was happening there.</p><p>I&#039;ve found out that the bridge on clover had STP enabled, but the bridge on openwrt had disabled STP. I don&#039;t know whether it makes any difference.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p74080">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">Stupendoussteve</div>
					<div class="post-datetime">
						30 Sep 2008, 20:58					</div>
				</div>
				<div class="post-content content">
					<p>I am having this same issue with pretty much the same setup as above.</p><p>My wireless clients connected to the AP use IPv6 just fine.</p><p>The second WRT54G (client mode) received a global IPv6 address from the first one, and wired clients connected to it also received addresses.</p><p>Neither the second WRT54G or the clients behind it can ping the gateway, which is the wireless AP. Problem is somewhere on the client WRT side. Have tried messing with the routing tables on it but no change, it refuses to send IPv6 over the wireless.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p74098">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">pmarks</div>
					<div class="post-datetime">
						1 Oct 2008, 07:30					</div>
				</div>
				<div class="post-content content">
					<p>Are your wireless clients acting as a router, or a bridge?</p><p>According to <a href="http://www.dd-wrt.com/wiki/index.php/Wireless_Bridge#Limitations">http://www.dd-wrt.com/wiki/index.php/Wi … imitations</a> , wireless client bridge mode does funny NAT-like stuff with the MAC addresses of clients.&nbsp; I can&#039;t imagine such things being very friendly to IPv6&#039;s link-local addressing and multicast neighbor discovery.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p74525">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">sxpert</div>
					<div class="post-datetime">
						11 Oct 2008, 00:41					</div>
				</div>
				<div class="post-content content">
					<p>you should be using separate netblocks for each bit and route. ipv6 is designed for routing, not really for bridging</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p105233">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">Skinkie</div>
					<div class="post-datetime">
						25 Mar 2010, 07:43					</div>
				</div>
				<div class="post-content content">
					<p>I was breaking my head over the same issue the past night. The solution is more easy than one may ever expect; I have only added the following to my radvd.conf file, and magically everything works.</p><p>&nbsp; &nbsp; &nbsp; &nbsp; AdvLinkMTU 1480;<br />&nbsp; &nbsp; &nbsp; &nbsp; MinRtrAdvInterval 3;<br />&nbsp; &nbsp; &nbsp; &nbsp; MaxRtrAdvInterval 10;</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>