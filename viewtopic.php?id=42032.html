<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> WNDR4300 [update] - building the image</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 2 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p190495">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">treborr</div>
					<div class="post-datetime">
						31 Jan 2013, 08:30					</div>
				</div>
				<div class="post-content content">
					<p>I would like to build image for the WNDR4300.</p><p>For the first try I was not able to build the files for flashing.</p><p>I have downloaded the source files from netgear webpage and from it I have build the firmware files =&gt; building enviroment is ok.</p><p>I have compared the Makefile in the source and in trunk of openwrt for WNDR4300 profile.<br />In the trunk of openwrt the profile WNDR4300 call Build NetgearNAND - this build process is not defined.<br />I changed the profile WNDR4300 to call Build Netgear =&gt; I got the file &quot;ready to flash&quot;.</p><p>I flashed the file to router. It was minimalistic configuration.</p><p>I can ping to router<br />I can not telnet, ssh, ...</p><p>I flashed back the original firmware over tftp.</p><br /><p>Is anyone interested in next results?</p><p>Can anyone help me to make correct config file and correct profile for WNDR 4300?<br />I have no expirience with it.</p>											<p class="post-edited">(Last edited by <strong>treborr</strong> on 2 Feb 2013, 00:29)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p190662">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">treborr</div>
					<div class="post-datetime">
						2 Feb 2013, 00:30					</div>
				</div>
				<div class="post-content content">
					<p>I am sorry, I did not want to delete the text of original post.</p>											<p class="post-edited">(Last edited by <strong>treborr</strong> on 2 Feb 2013, 00:57)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p202880">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">treborr</div>
					<div class="post-datetime">
						27 May 2013, 08:46					</div>
				</div>
				<div class="post-content content">
					<p>Hi all,<br />I have built the firmware (ready to flash file) from source files and flashed it (version V1.0.1.42). It is working. I used for building Debian. <br />I compared the router boot log (my file flashed) with boot log (flashed file from Netgear) and the boot logs are almost the same. There are differences in the date of image creation, the user, who image created and the machine name, on the image was created.&nbsp; Here is part of the boot log (flashed file from Netgear):<br /></p><div class="codebox"><pre><code>U-Boot 1.1.4 (Jun 28 2012 - 10:12:47)

U-boot dni29 V0.3 for DNI HW ID: 29763948 flash 128MB RAM 128MB 1st Radio 2x2 2nd Radio 3x3


DRAM:  128 MB
Atheros on-chip NAND FLash Controller Driver, Version 0.1 (c) 2010 Atheros Communications, Ltd.
Ath Nand ID[87ff0178]: 2c:f1:80:95:02
ONFI MICRON      MT29F1G08ABADAWP   
Micron NAND 128MiB 3,3V 8-bit [128MB]
====== NAND Parameters ======
sc = 0x87ff0158 bbt = 0x87f68008 bbt_size = 0x100 nf_ctrl = 0x344
page = 0x800 block = 0x20000 oob = 0x40
size = 128MB
Setting 0xb8116290 to 0x4c982d0f
Using default environment

In:    serial
Out:   serial
Err:   serial
Net:   ag934x_enet_initialize...
 4096 bytes read: OK
Fetching MAC Address from 0x87fe7928
 wasp  reset mask:c02300 
WASP  ----&gt; S17 PHY *
: cfg1 0x80000000 cfg2 0x7114
eth0: 10:0d:7f:50:6f:b7
athrs17_reg_init: complete
eth0 up
eth0
Hit any key to stop autoboot:  2  1  0 
dup 1 speed 1000

 Client starts...[Listening] for ADVERTISE...Tchecksum bad
checksum bad
checksum bad
TT
Retry count exceeded; boot the image as usual

 nmrp server is stopped or failed !

Loading from device 0: ath-nand (offset 0x6c0000)

** check kernel image **
   Verifying Checksum ... OK

** check rootfs image **
   Verifying Checksum ... OK
## Booting image at 81000000 ...
   Image Name:   MIPS OpenWrt Linux-2.6.31
   Created:      2012-11-26  11:13:13 UTC
   Image Type:   MIPS Linux Kernel Image (lzma compressed)
   Data Size:    1086998 Bytes =  1 MB
   Load Address: 80002000
   Entry Point:  80282bc0
   Verifying Checksum ... OK
   Uncompressing Kernel Image ... OK

Starting kernel ...

Booting Atheros AR934x
Linux version 2.6.31 (root@dnixm-compiler1) (gcc version 4.3.3 (GCC) ) #10 Mon Nov 26 19:12:49 CST 2012</code></pre></div><p>I have tried to build the ready flash file with current trunk files. I have used some profile files from Netgear source files. At the end I got ready flash file. I have flashed the file from the original web interface. It was ok. There is a problem during the boot: Here is the log:<br /></p><div class="codebox"><pre><code>U-Boot 1.1.4 (Jun 28 2012 - 10:12:47)

U-boot dni29 V0.3 for DNI HW ID: 29763948 flash 128MB RAM 128MB 1st Radio 2x2 2nd Radio 3x3


DRAM:  128 MB
Atheros on-chip NAND FLash Controller Driver, Version 0.1 (c) 2010 Atheros Communications, Ltd.
Ath Nand ID[87ff0178]: 2c:f1:80:95:02
ONFI MICRON      MT29F1G08ABADAWP   
Micron NAND 128MiB 3,3V 8-bit [128MB]
====== NAND Parameters ======
sc = 0x87ff0158 bbt = 0x87f68008 bbt_size = 0x100 nf_ctrl = 0x344
page = 0x800 block = 0x20000 oob = 0x40
size = 128MB
Setting 0xb8116290 to 0x4c982d0f
Using default environment

In:    serial
Out:   serial
Err:   serial
Net:   ag934x_enet_initialize...
 4096 bytes read: OK
Fetching MAC Address from 0x87fe7928
 wasp  reset mask:c02300 
WASP  ----&gt; S17 PHY *
: cfg1 0x80000000 cfg2 0x7114
eth0: 10:0d:7f:50:6f:b7
athrs17_reg_init: complete
eth0 up
eth0
Hit any key to stop autoboot:  2  1  0 
dup 1 speed 1000

 Client starts...[Listening] for ADVERTISE...checksum bad
Tchecksum bad
checksum bad
Tchecksum bad
T
Retry count exceeded; boot the image as usual

 nmrp server is stopped or failed !

Loading from device 0: ath-nand (offset 0x6c0000)

** check kernel image **
   Verifying Checksum ... OK

** check rootfs image **

** Bad Magic Number 0x0 **

The Router is in TFTP Server Firmware Recovery mode NOW!</code></pre></div><p>Does anyone have any idea? Check kernel image is ok, but the check rootfs image not <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><div class="codebox"><pre><code>** check kernel image **
   Verifying Checksum ... OK

** check rootfs image **

** Bad Magic Number 0x0 **</code></pre></div>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>