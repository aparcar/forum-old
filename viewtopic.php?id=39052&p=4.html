<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> mwan3; multi-wan policy routing (general topic)</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 22 May 2013 and 6 May 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 4 of 65</div><nav><ul><li><a href="viewtopic.php%3Fid=39052&amp;p=1.html">1</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=2.html">2</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=3.html">3</a></li><li class="pagination-current"><span>4</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=5.html">5</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=6.html">6</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=65.html">65</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p189580">
				<div class="post-metadata">
					<div class="post-num">Post #76</div>
					<div class="post-author">doctor64</div>
					<div class="post-datetime">
						22 Jan 2013, 00:18					</div>
				</div>
				<div class="post-content content">
					<p>Hi, Adze.</p><p>I&#039;m upgrading my home network and trying to create dual wan setup. Unfortunately, only first wan is working. Please, can you help me?<br/>My config:<br/></p><div class="codebox"><pre><code>network

config interface &#039;loopback&#039;
    option ifname &#039;lo&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;127.0.0.1&#039;
    option netmask &#039;255.0.0.0&#039;

config interface &#039;lan&#039;
    option ifname &#039;eth0.1&#039;
    option type &#039;bridge&#039;
    option proto &#039;static&#039;
    option netmask &#039;255.255.255.0&#039;
    option ipaddr &#039;192.168.64.192&#039;
#    option dns &#039;192.168.64.66&#039;

config interface &#039;wan&#039;
    option ifname &#039;eth0.2&#039;
    option _orig_ifname &#039;eth0.2&#039;
    option _orig_bridge &#039;false&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;89.252.1.74&#039;
    option netmask &#039;255.255.255.0&#039;
    option gateway &#039;89.252.1.1&#039;
    option macaddr &#039;00:90:27:57:1f:84&#039;
    option metric &#039;10&#039;

config switch
    option name &#039;rtl8366rb&#039;
    option reset &#039;1&#039;
    option enable_vlan &#039;1&#039;
    option enable_vlan4k &#039;1&#039;

config switch_vlan
    option device &#039;rtl8366rb&#039;
    option vlan &#039;1&#039;
    option ports &#039;2 3 4 5t&#039;

config switch_vlan
    option device &#039;rtl8366rb&#039;
    option vlan &#039;2&#039;
    option ports &#039;0 5t&#039;

config switch_vlan
    option device &#039;rtl8366rb&#039;
    option vlan &#039;3&#039;
    option ports &#039;1 5t&#039;

config interface &#039;wan2&#039;
    option proto &#039;dhcp&#039;
    option ifname &#039;eth0.3&#039;
    option metric &#039;20&#039;

mwan3 


config interface &#039;wan&#039;
    option enabled &#039;1&#039;
    list track_ip &#039;8.8.4.4&#039;
    list track_ip &#039;8.8.8.8&#039;
    list track_ip &#039;89.252.1.1&#039;
    option reliability &#039;2&#039;
    option count &#039;1&#039;
    option timeout &#039;2&#039;
    option interval &#039;5&#039;
    option down &#039;3&#039;
    option up &#039;8&#039;

config interface &#039;wan2&#039;
    option enabled &#039;1&#039;
    option interval &#039;5&#039;
    option down &#039;3&#039;
    option up &#039;8&#039;
    option timeout &#039;2&#039;
    option count &#039;1&#039;
    list track_ip &#039;93.73.88.1&#039;
    option reliability &#039;1&#039;

config member &#039;wan_m1_w3&#039;
    option interface &#039;wan&#039;
    option metric &#039;1&#039;
    option weight &#039;3&#039;

config member &#039;wan_m2_w3&#039;
    option interface &#039;wan&#039;
    option metric &#039;2&#039;
    option weight &#039;3&#039;

config member &#039;wan2_m1_w2&#039;
    option interface &#039;wan2&#039;
    option metric &#039;1&#039;
    option weight &#039;2&#039;

config member &#039;wan2_m2_w2&#039;
    option interface &#039;wan2&#039;
    option metric &#039;2&#039;
    option weight &#039;2&#039;

config policy &#039;wan_only&#039;
    list use_member &#039;wan_m1_w3&#039;

config policy &#039;wan2_only&#039;
    list use_member &#039;wan2_m1_w2&#039;

config policy &#039;wan_wan2_loadbalanced&#039;
    list use_member &#039;wan_m1_w3&#039;
    list use_member &#039;wan2_m1_w2&#039;

config policy &#039;wan_pri_wan2_sec&#039;
    list use_member &#039;wan_m1_w3&#039;
    list use_member &#039;wan2_m2_w2&#039;

config policy &#039;wan2_pri_wan_sec&#039;
    list use_member &#039;wan_m2_w3&#039;
    list use_member &#039;wan2_m1_w2&#039;

config rule
    option dest_ip &#039;0.0.0.0/0&#039;
    option use_policy &#039;wan_pri_wan2_sec&#039;

firewall


config defaults
    option syn_flood &#039;1&#039;
    option input &#039;DROP&#039;
#&#039;ACCEPT&#039;
    option output &#039;ACCEPT&#039;
    option forward &#039;REJECT&#039;

config zone
    option name &#039;lan&#039;
    option network &#039;lan&#039;
    option input &#039;ACCEPT&#039;
    option output &#039;ACCEPT&#039;
    option forward &#039;REJECT&#039;

config zone
    option name &#039;wan&#039;
    option input &#039;REJECT&#039;
    option output &#039;ACCEPT&#039;
    option forward &#039;REJECT&#039;
    option masq &#039;1&#039;
    option mtu_fix &#039;1&#039;
    option network &#039;wan wan2&#039;

config forwarding
    option src &#039;lan&#039;
    option dest &#039;wan&#039;

config rule
    option name &#039;Allow-DHCP-Renew&#039;
    option src &#039;wan&#039;
    option proto &#039;udp&#039;
    option dest_port &#039;68&#039;
    option target &#039;ACCEPT&#039;
    option family &#039;ipv4&#039;

config rule
    option name &#039;Allow-Ping&#039;
    option src &#039;wan&#039;
    option proto &#039;icmp&#039;
    option icmp_type &#039;echo-request&#039;
    option family &#039;ipv4&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-DHCPv6&#039;
    option src &#039;wan&#039;
    option proto &#039;udp&#039;
    option src_ip &#039;fe80::/10&#039;
    option src_port &#039;547&#039;
    option dest_ip &#039;fe80::/10&#039;
    option dest_port &#039;546&#039;
    option family &#039;ipv6&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-ICMPv6-Input&#039;
    option src &#039;wan&#039;
    option proto &#039;icmp&#039;
    list icmp_type &#039;echo-request&#039;
    list icmp_type &#039;echo-reply&#039;
    list icmp_type &#039;destination-unreachable&#039;
    list icmp_type &#039;packet-too-big&#039;
    list icmp_type &#039;time-exceeded&#039;
    list icmp_type &#039;bad-header&#039;
    list icmp_type &#039;unknown-header-type&#039;
    list icmp_type &#039;router-solicitation&#039;
    list icmp_type &#039;neighbour-solicitation&#039;
    list icmp_type &#039;router-advertisement&#039;
    list icmp_type &#039;neighbour-advertisement&#039;
    option limit &#039;1000/sec&#039;
    option family &#039;ipv6&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-ICMPv6-Forward&#039;
    option src &#039;wan&#039;
    option dest &#039;*&#039;
    option proto &#039;icmp&#039;
    list icmp_type &#039;echo-request&#039;
    list icmp_type &#039;echo-reply&#039;
    list icmp_type &#039;destination-unreachable&#039;
    list icmp_type &#039;packet-too-big&#039;
    list icmp_type &#039;time-exceeded&#039;
    list icmp_type &#039;bad-header&#039;
    list icmp_type &#039;unknown-header-type&#039;
    option limit &#039;1000/sec&#039;
    option family &#039;ipv6&#039;
    option target &#039;ACCEPT&#039;

config include
    option path &#039;/etc/firewall.user&#039;</code></pre></div><p>Basically, i want what most time my main connection (wan) used, but in case of link fail, wan2 goes active. <br/>But then i disconnect wan, nothing switched.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p189613">
				<div class="post-metadata">
					<div class="post-num">Post #77</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						22 Jan 2013, 10:34					</div>
				</div>
				<div class="post-content content">
					<p>Hi doctor64,</p><br/><p>Your config looks good in general. There are two things i would change, but that should not be the cause of your problem. The two things i would change are:</p><p>1. Remove the lines &quot;option _orig_ifname &#039;eth0.2&#039;&quot; and &quot;option _orig_bridge &#039;false&#039;&quot; form the network config. I have seen some troubles with this line in conjunction with mwan3<br/>2. Remove the lines &quot;option interval &#039;5&#039;&quot;, &quot;option down &#039;3&#039;&quot;, &quot;option up &#039;8&#039;&quot;, &quot;option timeout &#039;2&#039;&quot;, &quot;option count &#039;1&#039;&quot;, &quot;list track_ip &#039;93.73.88.1&#039;&quot; and &quot;option reliability &#039;1&#039;&quot; from the mwan3 config in the &quot;wan2&quot; interface config section. As this is a gateway of last resort, it has no added functionality to check if it is up.</p><br/><p>But now to tackle the real problem; could you paste me the outcome of the following comands:</p><div class="codebox"><pre><code>ip rule
ip addr list
ip route list
ip route list table 1001
ip route list table 1002
ip route list table 1019
iptables -L -t mangle -v -n</code></pre></div><p>Thnx!</p>											<p class="post-edited">(Last edited by <strong>Adze</strong> on 22 Jan 2013, 10:35)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p189627">
				<div class="post-metadata">
					<div class="post-num">Post #78</div>
					<div class="post-author">doctor64</div>
					<div class="post-datetime">
						22 Jan 2013, 12:32					</div>
				</div>
				<div class="post-content content">
					<p>Hello Adze!</p><p>I make proposed changes in config files, still not switching. regarding (2) - in the future i plan implement more sophisticated routing like &quot;torrents on wan&quot;, &quot;http load balancing&quot;, etc.</p><div class="codebox"><pre><code>root@ap1:~# ping www.google.com -I eth0.2
PING www.google.com (77.88.221.34): 56 data bytes
64 bytes from 77.88.221.34: seq=0 ttl=59 time=1.265 ms
64 bytes from 77.88.221.34: seq=1 ttl=59 time=0.769 ms
^C
--- www.google.com ping statistics ---
2 packets transmitted, 2 packets received, 0% packet loss
round-trip min/avg/max = 0.769/1.017/1.265 ms
root@ap1:~# ping www.google.com -I eth0.3
PING www.google.com (77.88.221.44): 56 data bytes
64 bytes from 77.88.221.44: seq=0 ttl=59 time=14.942 ms
64 bytes from 77.88.221.44: seq=1 ttl=59 time=15.444 ms
^C
--- www.google.com ping statistics ---
2 packets transmitted, 2 packets received, 0% packet loss
round-trip min/avg/max = 14.942/15.193/15.444 ms
root@ap1:~# ip rule
0:      from all lookup local
1001:   from 89.252.1.74 fwmark 0x0/0x8000 lookup 1001
1002:   from 93.73.90.160 fwmark 0x0/0x8000 lookup 1002
1008:   from all fwmark 0x100/0xff00 lookup 1001
1009:   from all fwmark 0x200/0xff00 lookup 1002
1016:   from all fwmark 0x1000/0xff00 lookup 1016
1017:   from all fwmark 0x1100/0xff00 lookup 1017
1018:   from all fwmark 0x1200/0xff00 lookup 1018
1019:   from all fwmark 0x1300/0xff00 lookup 1019
1020:   from all fwmark 0x1400/0xff00 lookup 1020
32766:  from all lookup main
32767:  from all lookup default
root@ap1:~# ip addr list
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 16436 qdisc noqueue state UNKNOWN
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP qlen 1000
    link/ether d8:5d:4c:d7:c5:c4 brd ff:ff:ff:ff:ff:ff
4: ifb0: &lt;BROADCAST,NOARP&gt; mtu 1500 qdisc noop state DOWN qlen 32
    link/ether c2:d9:60:fe:22:f3 brd ff:ff:ff:ff:ff:ff
5: ifb1: &lt;BROADCAST,NOARP&gt; mtu 1500 qdisc noop state DOWN qlen 32
    link/ether ea:af:d8:ff:8d:8f brd ff:ff:ff:ff:ff:ff
6: br-lan: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP
    link/ether d8:5d:4c:d7:c5:c4 brd ff:ff:ff:ff:ff:ff
    inet 192.168.64.192/24 brd 192.168.64.255 scope global br-lan
7: eth0.1@eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master br-lan state UP
    link/ether d8:5d:4c:d7:c5:c4 brd ff:ff:ff:ff:ff:ff
8: eth0.2@eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP
    link/ether 00:90:27:57:1f:84 brd ff:ff:ff:ff:ff:ff
    inet 89.252.1.74/24 brd 89.252.1.255 scope global eth0.2
9: eth0.3@eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP
    link/ether d8:5d:4c:d7:c5:c4 brd ff:ff:ff:ff:ff:ff
    inet 93.73.90.160/21 brd 93.73.95.255 scope global eth0.3
10: wlan0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq master br-lan state UP qlen 32
    link/ether d8:5d:4c:d7:c5:c4 brd ff:ff:ff:ff:ff:ff
root@ap1:~# ip route list
default via 89.252.1.1 dev eth0.2  proto static  metric 10
default via 93.73.88.1 dev eth0.3  proto static  metric 20
89.252.1.0/24 dev eth0.2  proto static  scope link  metric 10
93.73.88.0/21 dev eth0.3  proto static  scope link  metric 20
192.168.64.0/24 dev br-lan  proto kernel  scope link  src 192.168.64.192
root@ap1:~# ip route list table 1001
default via 89.252.1.1 dev eth0.2
root@ap1:~# ip route list table 1002
default via 93.73.88.1 dev eth0.3
root@ap1:~# ip route list table 1019
default via 89.252.1.1 dev eth0.2  metric 1
default via 93.73.88.1 dev eth0.3  metric 2
blackhole default  metric 1000
root@ap1:~# iptables -L -t mangle -v -n
Chain PREROUTING (policy ACCEPT 26469 packets, 6906K bytes)
 pkts bytes target     prot opt in     out     source               destination
27824 7093K mwan3_pre  all  --  *      *       0.0.0.0/0            0.0.0.0/0

Chain INPUT (policy ACCEPT 5673 packets, 605K bytes)
 pkts bytes target     prot opt in     out     source               destination

Chain FORWARD (policy ACCEPT 20707 packets, 6293K bytes)
 pkts bytes target     prot opt in     out     source               destination
21543 6426K zone_wan_MSSFIX  all  --  *      *       0.0.0.0/0            0.0.0.0/0

Chain OUTPUT (policy ACCEPT 5442 packets, 402K bytes)
 pkts bytes target     prot opt in     out     source               destination
 5751  426K mwan3_pre  all  --  *      *       0.0.0.0/0            0.0.0.0/0

Chain POSTROUTING (policy ACCEPT 26149 packets, 6695K bytes)
 pkts bytes target     prot opt in     out     source               destination
27153 6842K mwan3_post  all  --  *      *       0.0.0.0/0            0.0.0.0/0

Chain mwan3_default (1 references)
 pkts bytes target     prot opt in     out     source               destination
   73  9782 MARK       all  --  *      *       0.0.0.0/0            224.0.0.0/3         mark match !0x8000/0x8000 MARK or 0x8000
  155 11942 MARK       all  --  *      *       0.0.0.0/0            89.252.1.0/24       mark match !0x8000/0x8000 MARK or 0x8000
    0     0 MARK       all  --  *      *       0.0.0.0/0            93.73.88.0/21       mark match !0x8000/0x8000 MARK or 0x8000
 5267  554K MARK       all  --  *      *       0.0.0.0/0            192.168.64.0/24     mark match !0x8000/0x8000 MARK or 0x8000

Chain mwan3_post (1 references)
 pkts bytes target     prot opt in     out     source               destination
   25  1171 MARK       all  --  *      eth0.3  0.0.0.0/0            0.0.0.0/0           mark match !0x8000/0x8000 MARK xset 0x200/0xff00
15973 5341K MARK       all  --  *      eth0.2  0.0.0.0/0            0.0.0.0/0           mark match !0x8000/0x8000 MARK xset 0x100/0xff00
11042 1491K MARK       all  --  *      *       0.0.0.0/0            0.0.0.0/0           mark match 0x8000/0x8000 MARK and 0xffff7fff
27153 6842K CONNMARK   all  --  *      *       0.0.0.0/0            0.0.0.0/0           CONNMARK save mask 0xff00

Chain mwan3_pre (2 references)
 pkts bytes target     prot opt in     out     source               destination
33575 7519K CONNMARK   all  --  *      *       0.0.0.0/0            0.0.0.0/0           CONNMARK restore mask 0xff00
   31  3297 MARK       all  --  eth0.3 *       0.0.0.0/0            0.0.0.0/0           MARK xset 0x8200/0xff00
11214 1530K MARK       all  --  eth0.2 *       0.0.0.0/0            0.0.0.0/0           MARK xset 0x8100/0xff00
22260 5979K mwan3_default  all  --  *      *       0.0.0.0/0            0.0.0.0/0           mark match !0x8000/0x8000
 5320  448K mwan3_rules  all  --  *      *       0.0.0.0/0            0.0.0.0/0           mark match 0x0/0xff00

Chain mwan3_rules (1 references)
 pkts bytes target     prot opt in     out     source               destination
 4639  394K MARK       all  --  *      *       0.0.0.0/0            0.0.0.0/0           mark match 0x0/0xff00 MARK xset 0x1300/0xff00

Chain zone_wan_MSSFIX (1 references)
 pkts bytes target     prot opt in     out     source               destination
  925 47404 TCPMSS     tcp  --  *      eth0.2  0.0.0.0/0            0.0.0.0/0           tcp flags:0x06/0x02 TCPMSS clamp to PMTU
    0     0 TCPMSS     tcp  --  *      eth0.3  0.0.0.0/0            0.0.0.0/0           tcp flags:0x06/0x02 TCPMSS clamp to PMTU
root@ap1:~#</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p189628">
				<div class="post-metadata">
					<div class="post-num">Post #79</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						22 Jan 2013, 12:43					</div>
				</div>
				<div class="post-content content">
					<p>Hi doctor64,</p><br/><p>As far as i can see, all looks OK... Could you bring down the primary link, wait for 30 seconds and then paste the outcome of all the commands again please?</p><br/><p>Thnx!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p189633">
				<div class="post-metadata">
					<div class="post-num">Post #80</div>
					<div class="post-author">doctor64</div>
					<div class="post-datetime">
						22 Jan 2013, 13:24					</div>
				</div>
				<div class="post-content content">
					<p>Hello Adze!</p><p>I disconnect main wan cable and wait few minutes.<br/></p><div class="codebox"><pre><code>root@ap1:~# ping 8.8.8.8
PING 8.8.8.8 (8.8.8.8): 56 data bytes
^C
--- 8.8.8.8 ping statistics ---
14 packets transmitted, 0 packets received, 100% packet loss
root@ap1:~# ping 8.8.8.8 -I eth0.3
PING 8.8.8.8 (8.8.8.8): 56 data bytes
64 bytes from 8.8.8.8: seq=0 ttl=46 time=40.580 ms
64 bytes from 8.8.8.8: seq=1 ttl=46 time=62.562 ms
64 bytes from 8.8.8.8: seq=2 ttl=46 time=40.363 ms
^C
--- 8.8.8.8 ping statistics ---
3 packets transmitted, 3 packets received, 0% packet loss
round-trip min/avg/max = 40.363/47.835/62.562 ms
root@ap1:~# ip rule
0:      from all lookup local
1001:   from 89.252.1.74 fwmark 0x0/0x8000 lookup 1001
1002:   from 93.73.90.160 fwmark 0x0/0x8000 lookup 1002
1008:   from all fwmark 0x100/0xff00 lookup 1001
1009:   from all fwmark 0x200/0xff00 lookup 1002
1016:   from all fwmark 0x1000/0xff00 lookup 1016
1017:   from all fwmark 0x1100/0xff00 lookup 1017
1018:   from all fwmark 0x1200/0xff00 lookup 1018
1019:   from all fwmark 0x1300/0xff00 lookup 1019
1020:   from all fwmark 0x1400/0xff00 lookup 1020
32766:  from all lookup main
32767:  from all lookup default
root@ap1:~# ip addr list
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 16436 qdisc noqueue state UNKNOWN
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP qlen 1000
    link/ether d8:5d:4c:d7:c5:c4 brd ff:ff:ff:ff:ff:ff
4: ifb0: &lt;BROADCAST,NOARP&gt; mtu 1500 qdisc noop state DOWN qlen 32
    link/ether c2:d9:60:fe:22:f3 brd ff:ff:ff:ff:ff:ff
5: ifb1: &lt;BROADCAST,NOARP&gt; mtu 1500 qdisc noop state DOWN qlen 32
    link/ether ea:af:d8:ff:8d:8f brd ff:ff:ff:ff:ff:ff
6: br-lan: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP
    link/ether d8:5d:4c:d7:c5:c4 brd ff:ff:ff:ff:ff:ff
    inet 192.168.64.192/24 brd 192.168.64.255 scope global br-lan
7: eth0.1@eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master br-lan state UP
    link/ether d8:5d:4c:d7:c5:c4 brd ff:ff:ff:ff:ff:ff
8: eth0.2@eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP
    link/ether 00:90:27:57:1f:84 brd ff:ff:ff:ff:ff:ff
    inet 89.252.1.74/24 brd 89.252.1.255 scope global eth0.2
9: eth0.3@eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP
    link/ether d8:5d:4c:d7:c5:c4 brd ff:ff:ff:ff:ff:ff
    inet 93.73.90.160/21 brd 93.73.95.255 scope global eth0.3
10: wlan0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq master br-lan state UP qlen 32
    link/ether d8:5d:4c:d7:c5:c4 brd ff:ff:ff:ff:ff:ff
root@ap1:~# ip route list
default via 89.252.1.1 dev eth0.2  proto static  metric 10
default via 93.73.88.1 dev eth0.3  proto static  metric 20
89.252.1.0/24 dev eth0.2  proto static  scope link  metric 10
93.73.88.0/21 dev eth0.3  proto static  scope link  metric 20
192.168.64.0/24 dev br-lan  proto kernel  scope link  src 192.168.64.192
root@ap1:~# ip route list table 1001
default via 89.252.1.1 dev eth0.2
root@ap1:~# ip route list table 1002
default via 93.73.88.1 dev eth0.3
root@ap1:~# ip route list table 1019
default via 93.73.88.1 dev eth0.3  metric 2
blackhole default  metric 1000
root@ap1:~# iptables -L -t mangle -v -n
Chain PREROUTING (policy ACCEPT 44209 packets, 20M bytes)
 pkts bytes target     prot opt in     out     source               destination
 477K  302M mwan3_pre  all  --  *      *       0.0.0.0/0            0.0.0.0/0

Chain INPUT (policy ACCEPT 6609 packets, 727K bytes)
 pkts bytes target     prot opt in     out     source               destination

Chain FORWARD (policy ACCEPT 37588 packets, 19M bytes)
 pkts bytes target     prot opt in     out     source               destination
 438K  298M zone_wan_MSSFIX  all  --  *      *       0.0.0.0/0            0.0.0.0/0

Chain OUTPUT (policy ACCEPT 9050 packets, 717K bytes)
 pkts bytes target     prot opt in     out     source               destination
40005 3064K mwan3_pre  all  --  *      *       0.0.0.0/0            0.0.0.0/0

Chain POSTROUTING (policy ACCEPT 46594 packets, 20M bytes)
 pkts bytes target     prot opt in     out     source               destination
 478K  301M mwan3_post  all  --  *      *       0.0.0.0/0            0.0.0.0/0

Chain mwan3_default (1 references)
 pkts bytes target     prot opt in     out     source               destination
   81 10404 MARK       all  --  *      *       0.0.0.0/0            224.0.0.0/3         mark match !0x8000/0x8000 MARK or 0x8000
 6095  587K MARK       all  --  *      *       0.0.0.0/0            89.252.1.0/24       mark match !0x8000/0x8000 MARK or 0x8000
   19  1121 MARK       all  --  *      *       0.0.0.0/0            93.73.88.0/21       mark match !0x8000/0x8000 MARK or 0x8000
 6006  607K MARK       all  --  *      *       0.0.0.0/0            192.168.64.0/24     mark match !0x8000/0x8000 MARK or 0x8000

Chain mwan3_post (1 references)
 pkts bytes target     prot opt in     out     source               destination
 3287  228K MARK       all  --  *      eth0.2  0.0.0.0/0            0.0.0.0/0           mark match !0x8000/0x8000 MARK xset 0x100/0xff00
30463   20M MARK       all  --  *      eth0.3  0.0.0.0/0            0.0.0.0/0           mark match !0x8000/0x8000 MARK xset 0x200/0xff00
 175K   23M MARK       all  --  *      *       0.0.0.0/0            0.0.0.0/0           mark match 0x8000/0x8000 MARK and 0xffff7fff
 478K  301M CONNMARK   all  --  *      *       0.0.0.0/0            0.0.0.0/0           CONNMARK save mask 0xff00

Chain mwan3_pre (2 references)
 pkts bytes target     prot opt in     out     source               destination
 517K  305M CONNMARK   all  --  *      *       0.0.0.0/0            0.0.0.0/0           CONNMARK restore mask 0xff00
    0     0 MARK       all  --  eth0.2 *       0.0.0.0/0            0.0.0.0/0           MARK xset 0x8100/0xff00
19709 1777K MARK       all  --  eth0.3 *       0.0.0.0/0            0.0.0.0/0           MARK xset 0x8200/0xff00
 347K  283M mwan3_default  all  --  *      *       0.0.0.0/0            0.0.0.0/0           mark match !0x8000/0x8000
30372 2630K mwan3_rules  all  --  *      *       0.0.0.0/0            0.0.0.0/0           mark match 0x0/0xff00

Chain mwan3_rules (1 references)
 pkts bytes target     prot opt in     out     source               destination
 2642  236K MARK       all  --  *      *       0.0.0.0/0            0.0.0.0/0           mark match 0x0/0xff00 MARK xset 0x1300/0xff00

Chain zone_wan_MSSFIX (1 references)
 pkts bytes target     prot opt in     out     source               destination
  833 43096 TCPMSS     tcp  --  *      eth0.3  0.0.0.0/0            0.0.0.0/0           tcp flags:0x06/0x02 TCPMSS clamp to PMTU
root@ap1:~#
root@ap1:~# logread|grep mwan3
Jan 22 12:18:04 ap1 user.notice root: mwan3: ifup interface wan (eth0.2)
Jan 22 12:18:12 ap1 user.notice root: mwan3: ifup interface wan2 (eth0.3)
Jan 22 12:30:29 ap1 user.notice root: mwan3: Interface wan (eth0.2) is offline
Jan 22 12:30:29 ap1 user.notice root: mwan3: ifdown interface wan (eth0.2)
Jan 22 12:33:01 ap1 user.notice root: mwan3: Lost 16 ping(s) on interface wan (eth0.2)
Jan 22 12:33:37 ap1 user.notice root: mwan3: Interface wan (eth0.2) is online
Jan 22 12:33:38 ap1 user.notice root: mwan3: ifup interface wan (eth0.2)
Jan 22 13:12:05 ap1 user.notice root: mwan3: Interface wan (eth0.2) is offline
Jan 22 13:12:05 ap1 user.notice root: mwan3: ifdown interface wan (eth0.2)</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p189636">
				<div class="post-metadata">
					<div class="post-num">Post #81</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						22 Jan 2013, 13:48					</div>
				</div>
				<div class="post-content content">
					<p>Hi doctor64,</p><br/><p>I think mwan3 works OK, only your test method is worng... <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink"/> Let me explain.</p><p>If you don&#039;t use the loopback routing trick i mentioned in the TS (experimental section), packets originating from the router itself aren&#039;t load-balanced by mwan3. I recon that if you do this test from a client on your LAN it does failover.</p><p>Everything looks OK to me. Can you test from a client (not from the router) or use the loopback trick please?</p><br/><p>Thnx!</p>											<p class="post-edited">(Last edited by <strong>Adze</strong> on 22 Jan 2013, 13:50)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p189638">
				<div class="post-metadata">
					<div class="post-num">Post #82</div>
					<div class="post-author">doctor64</div>
					<div class="post-datetime">
						22 Jan 2013, 14:06					</div>
				</div>
				<div class="post-content content">
					<p>Hello Adze!</p><p>AAAA! I&#039;m idiot! <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile"/> It&#039;s my stupid fault <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad"/> I&#039;m also relocate DNS server from internal network to router. ping to ip address (not name) from internal network works like charm. After i run <br/></p><div class="codebox"><pre><code>ip route add default via 127.0.0.1 dev lo src 192.168.64.192</code></pre></div><p>all is working as expected </p><p>Great thanks for your understanding and help.</p><p>Just two silly question:<br/>1: where is right place to put this command on openwrt? Im not very familiar with linux, sorry<br/>2: it will be nice if luci frontend can display current status of multiwan via web-interface, like original multiwan do...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p189645">
				<div class="post-metadata">
					<div class="post-num">Post #83</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						22 Jan 2013, 14:34					</div>
				</div>
				<div class="post-content content">
					<p>Hi doctor64,</p><br/><p>Nice to see it is solved! <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile"/></p><p>The way i permanently configure this loopback trick is i first define an alias ip on my loopback interface. This is to keep LAN and router originated traffic separate. I then add a static rule to the rc.common file.</p><p>/etc/config/network<br/></p><div class="codebox"><pre><code>config interface &#039;loopback&#039;
    option ifname &#039;lo&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;127.0.0.1&#039;
    option netmask &#039;255.0.0.0&#039;

config alias
    option interface &#039;loopback&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;192.168.2.1&#039;
    option netmask &#039;255.255.255.255&#039;</code></pre></div><p>cat /etc/rc.local <br/></p><div class="codebox"><pre><code># Put your custom commands here that should be executed once
# the system init finished. By default this file does nothing.
ip route add default via 192.168.2.1 dev lo src 192.168.2.1 metric 5
exit 0</code></pre></div><p>As for remark 2, i don&#039;t use the webinterface. It is/was an independent project from Arfett. I won&#039;t be adding this functionality myself, but maybe you have some spare time to add this?!? Mwan3 itself doee not monitor status or saves states of a wan interface. It just runs some commands when an interface goes up or down and then exits.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p189660">
				<div class="post-metadata">
					<div class="post-num">Post #84</div>
					<div class="post-author">doctor64</div>
					<div class="post-datetime">
						22 Jan 2013, 16:16					</div>
				</div>
				<div class="post-content content">
					<p>Hi Adze!</p><p>Sorry for asking again, but i should substitute 192.168.2.1 and 255.255.255.255 with actual values of my lan interface or use another address within my lan subnet? I mean my lan have address 192.168.64.192 - i should use 192.168.64.192 or 192.168.64.193 for example?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p189661">
				<div class="post-metadata">
					<div class="post-num">Post #85</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						22 Jan 2013, 16:18					</div>
				</div>
				<div class="post-content content">
					<p>Use a whole new ip address (range) for this, separate from LAN.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p189672">
				<div class="post-metadata">
					<div class="post-num">Post #86</div>
					<div class="post-author">doctor64</div>
					<div class="post-datetime">
						22 Jan 2013, 18:17					</div>
				</div>
				<div class="post-content content">
					<p>Hi Adze</p><p>thank you very much again.</p><p>Now little question about load balancing - as i understand for load balancing metric value of two interfaces (in mwan3 config) should be equal. and traffic divided accordingly to weight values? <br/>So, for example, wan1 have weight 60 and wan2 have weight 40 mean what 60% of traffic goes to wan1 and 40% goes to wan2?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p189675">
				<div class="post-metadata">
					<div class="post-num">Post #87</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						22 Jan 2013, 18:25					</div>
				</div>
				<div class="post-content content">
					<p>Yes,&nbsp; although mwan3 balances based on sessions. So it is possible that one session creates a lot more traffic than another. So you might not see exactly a 60/40 ratio back in the interface counters.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p189687">
				<div class="post-metadata">
					<div class="post-num">Post #88</div>
					<div class="post-author">doctor64</div>
					<div class="post-datetime">
						22 Jan 2013, 19:28					</div>
				</div>
				<div class="post-content content">
					<p>Ok, to be more clear &quot;60% of sessions goes to wan1 and 40% goes to wan2&quot;?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p189698">
				<div class="post-metadata">
					<div class="post-num">Post #89</div>
					<div class="post-author">kir0</div>
					<div class="post-datetime">
						22 Jan 2013, 21:58					</div>
				</div>
				<div class="post-content content">
					<p>Hi Adze<br/>I sent you a letter to the PM for help..<br/>Sorry for my english...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p190559">
				<div class="post-metadata">
					<div class="post-num">Post #90</div>
					<div class="post-author">Steltek</div>
					<div class="post-datetime">
						31 Jan 2013, 23:50					</div>
				</div>
				<div class="post-content content">
					<p>Just wondering, does this support NAT reflection? Asking because since I&#039;ve set it up, I can&#039;t seem to be able to access my own systems via my external IP any more.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p190573">
				<div class="post-metadata">
					<div class="post-num">Post #91</div>
					<div class="post-author">baojia</div>
					<div class="post-datetime">
						1 Feb 2013, 04:03					</div>
				</div>
				<div class="post-content content">
					<p>hi, all</p><p>does anyone know how to use mwan3 with multiple pppoe sessions?<br/>i&#039;ve tried to use macvlan, but the others sessions keep failing.</p><p>and i&#039;ve tested it with pfsense virtualbox, my network works with multiple pppoe sessions.</p><p>thx</p>											<p class="post-edited">(Last edited by <strong>baojia</strong> on 1 Feb 2013, 04:04)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p190629">
				<div class="post-metadata">
					<div class="post-num">Post #92</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						1 Feb 2013, 17:58					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Steltek wrote:</cite><blockquote><p>Just wondering, does this support NAT reflection? Asking because since I&#039;ve set it up, I can&#039;t seem to be able to access my own systems via my external IP any more.</p></blockquote></div><p>NAT reflection in combination with mwan3 works. (should work)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p190630">
				<div class="post-metadata">
					<div class="post-num">Post #93</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						1 Feb 2013, 18:01					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>baojia wrote:</cite><blockquote><p>hi, all</p><p>does anyone know how to use mwan3 with multiple pppoe sessions?<br/>i&#039;ve tried to use macvlan, but the others sessions keep failing.</p><p>and i&#039;ve tested it with pfsense virtualbox, my network works with multiple pppoe sessions.</p><p>thx</p></blockquote></div><p>mwan3 works OK with multiple pppoe sessionss. Multiple pppoe sessions don&#039;t work with only one layer-3 interface. It&#039;s not a mwan3 problem.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p190699">
				<div class="post-metadata">
					<div class="post-num">Post #94</div>
					<div class="post-author">Steltek</div>
					<div class="post-datetime">
						2 Feb 2013, 13:52					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><div class="quotebox"><cite>Steltek wrote:</cite><blockquote><p>Just wondering, does this support NAT reflection? Asking because since I&#039;ve set it up, I can&#039;t seem to be able to access my own systems via my external IP any more.</p></blockquote></div><p>NAT reflection in combination with mwan3 works. (should work)</p></blockquote></div><p>Thanks, I&#039;ll have to check my setup then because mine definitely worked before I installed mwan3 and now no longer does.</p><p>The nat_reflection_fwd table is definitely in iptables but doesn&#039;t appear to be getting any packets, so something must be intercepting them before.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p190898">
				<div class="post-metadata">
					<div class="post-num">Post #95</div>
					<div class="post-author">kir0</div>
					<div class="post-datetime">
						4 Feb 2013, 17:54					</div>
				</div>
				<div class="post-content content">
					<p>Hi Adze<br/>I sent you a letter to the PM for help.. )</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p190978">
				<div class="post-metadata">
					<div class="post-num">Post #96</div>
					<div class="post-author">kokko</div>
					<div class="post-datetime">
						5 Feb 2013, 10:09					</div>
				</div>
				<div class="post-content content">
					<p>Do you have package for brcm47xx architecture? </p><p>I have Asus Wl-500GP with AA 12.09-rc1, just bought backup WAN and found out on forum that mwan3 is the best for multi WAN. Could you share brcm47xx&nbsp; package or show me the way how to make it by my own?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p191174">
				<div class="post-metadata">
					<div class="post-num">Post #97</div>
					<div class="post-author">kir0</div>
					<div class="post-datetime">
						6 Feb 2013, 20:39					</div>
				</div>
				<div class="post-content content">
					<p>Hi doctor64!<br/>I wanted to see your configuration mwan3 <br/>I have a problem mwan3<br/>Sorry for my english...<br/>thx!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p191481">
				<div class="post-metadata">
					<div class="post-num">Post #98</div>
					<div class="post-author">swoofz</div>
					<div class="post-datetime">
						9 Feb 2013, 10:42					</div>
				</div>
				<div class="post-content content">
					<p>Hi Adze,<br/>I&#039;ve been using your mwan2 for almost a year and realized that you now come up with the mwan3.</p><p>I use a VPN connection to watch movies from netflix and hulu but the VPN connection is done from the clients (PC, tablet, iphone, etc). I&#039;m thinking of establishing the VPN connection from my TPLink router so I don&#039;t need to set it up from clients.</p><p>I managed to connect to the VPN Server using OpenVPN from my router :<br/></p><div class="codebox"><pre><code>Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
0.0.0.0         10.143.1.9      128.0.0.0       UG    0      0        0 tun0
0.0.0.0         192.168.0.1     0.0.0.0         UG    10     0        0 br-lan
0.0.0.0         111.94.77.1     0.0.0.0         UG    20     0        0 eth1
10.143.1.1      10.143.1.9      255.255.255.255 UGH   0      0        0 tun0
10.143.1.9      0.0.0.0         255.255.255.255 UH    0      0        0 tun0
50.7.31.186     192.168.0.1     255.255.255.255 UGH   0      0        0 br-lan
111.94.77.0     0.0.0.0         255.255.255.0   U     20     0        0 eth1
128.0.0.0       10.143.1.9      128.0.0.0       UG    0      0        0 tun0
192.168.0.0     0.0.0.0         255.255.255.0   U     10     0        0 br-lan</code></pre></div><p>I&#039;m able to ping using both connection :<br/></p><div class="codebox"><pre><code>root@OpenWrt:/# ping -c 1 -I eth1 google.com
PING google.com (111.94.248.24): 56 data bytes
64 bytes from 111.94.248.24: seq=0 ttl=63 time=9.258 ms

--- google.com ping statistics ---
1 packets transmitted, 1 packets received, 0% packet loss
round-trip min/avg/max = 9.258/9.258/9.258 ms
root@OpenWrt:/# ping -c 1 -I tun0 google.com
PING google.com (111.94.248.32): 56 data bytes
64 bytes from 111.94.248.32: seq=0 ttl=47 time=565.236 ms

--- google.com ping statistics ---
1 packets transmitted, 1 packets received, 0% packet loss
round-trip min/avg/max = 565.236/565.236/565.236 ms</code></pre></div><p>Make a simple mwan3 config :<br/></p><div class="codebox"><pre><code>config interface &#039;WAN&#039;
        option enabled &#039;1&#039;
        list track_ip &#039;8.8.4.4&#039;
        option reliability &#039;1&#039;
        option count &#039;1&#039;
        option timeout &#039;2&#039;
        option interval &#039;5&#039;
        option down &#039;3&#039;
        option up &#039;8&#039;

config interface &#039;VPN&#039;
        option &#039;enabled&#039; &#039;1&#039;
        list track_ip &#039;8.8.4.4&#039;
        option reliability &#039;1&#039;
        option count &#039;1&#039;
        option timeout &#039;2&#039;
        option interval &#039;5&#039;
        option down &#039;3&#039;
        option up &#039;8&#039;

config member &#039;wan1_m1_w3&#039;
        option interface &#039;WAN&#039;
        option metric &#039;1&#039;
        option weight &#039;3&#039;

config member &#039;wan1_m2_w3&#039;
        option interface &#039;WAN&#039;
        option metric &#039;2&#039;
        option weight &#039;3&#039;

config member &#039;vpn_m1_w3&#039;
        option interface &#039;VPN&#039;
        option metric &#039;1&#039;
        option weight &#039;3&#039;

config policy &#039;wan1_only&#039;
        list use_member &#039;wan1_m1_w3&#039;

config policy &#039;vpn_only&#039;
        list use_member &#039;vpn_m1_w3&#039;

config rule
       option src_ip &#039;192.168.0.25&#039;
       option use_policy &#039;vpn_only&#039;

config rule
        option dest_ip &#039;0.0.0.0/0&#039;
        option use_policy &#039;wan1_only&#039;</code></pre></div><p>192.168.0.25 is my PC&#039;s IP Address, I would like to simply test that all connection made from my PC will be routed through the VPN tunnel</p><p>I then setup the firewall rule to allow traffic from LAN to VPN</p><div class="codebox"><pre><code>root@OpenWrt:/# cat /etc/config/firewall

config defaults
        option syn_flood &#039;1&#039;
        option input &#039;ACCEPT&#039;
        option output &#039;ACCEPT&#039;
        option forward &#039;ACCEPT&#039;

config zone
        option name &#039;lan&#039;
        option input &#039;ACCEPT&#039;
        option output &#039;ACCEPT&#039;
        option forward &#039;ACCEPT&#039;
        option masq &#039;1&#039;
        option network &#039;lan&#039;

config zone
        option name &#039;wan&#039;
        option output &#039;ACCEPT&#039;
        option masq &#039;1&#039;
        option forward &#039;ACCEPT&#039;
        option input &#039;ACCEPT&#039;
        option network &#039;WAN&#039;

config include
        option path &#039;/etc/firewall.user&#039;

config forwarding
        option dest &#039;wan&#039;
        option src &#039;lan&#039;

config forwarding
        option dest &#039;lan&#039;
        option src &#039;wan&#039;

config zone
        option name &#039;VPN&#039;
        option input &#039;ACCEPT&#039;
        option forward &#039;ACCEPT&#039;
        option output &#039;ACCEPT&#039;
        option network &#039;VPN&#039;
        option masq &#039;1&#039;

config forwarding
        option dest &#039;lan&#039;
        option src &#039;VPN&#039;

config forwarding
        option dest &#039;VPN&#039;
        option src &#039;lan&#039;</code></pre></div><p>Restarted the router and try to access the internet from my PC but no traffic at all, tried to ping google.com but lost all connection to internet from my PC. Tried to tcpdump -i tun0 while ping google.com from my PC but seems there&#039;s no traffic routed to the interface.</p><div class="codebox"><pre><code>root@OpenWrt:/# ip rule show
0:      from all lookup local
1001:   from 111.94.77.98 fwmark 0x0/0x8000 lookup 1001
1008:   from all fwmark 0x100/0xff00 lookup 1001
1009:   from all fwmark 0x200/0xff00 lookup 1002
1016:   from all fwmark 0x1000/0xff00 lookup 1016
1017:   from all fwmark 0x1100/0xff00 lookup 1017
32766:  from all lookup main
32767:  from all lookup default</code></pre></div><p>Please kindly advise. Thanks !</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p191570">
				<div class="post-metadata">
					<div class="post-num">Post #99</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						10 Feb 2013, 19:02					</div>
				</div>
				<div class="post-content content">
					<p>Hi swoofz,</p><br/><p>I&#039;d like to help you get things working. A couple of things strike me. I have some questions:</p><p>Why is there a default route to your br-lan interface?<br/>Why is there no default route for the tun0 interface (mwan3 needs this, so this is the reason it doesn&#039;t work!)?<br/>Is interface VPN defined in your network config?</p><br/><p>Thnx</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p191620">
				<div class="post-metadata">
					<div class="post-num">Post #100</div>
					<div class="post-author">swoofz</div>
					<div class="post-datetime">
						11 Feb 2013, 02:32					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><p>Hi swoofz,</p><br/><p>I&#039;d like to help you get things working. A couple of things strike me. I have some questions:</p><p>Why is there a default route to your br-lan interface?<br/>Why is there no default route for the tun0 interface (mwan3 needs this, so this is the reason it doesn&#039;t work!)?<br/>Is interface VPN defined in your network config?</p><br/><p>Thnx</p></blockquote></div><p>Hi Adze,<br/>Thanks for your response.</p><p>I think the default route for br-lan interface is there because the router create bridges between eth0 &amp; my wireless network i guess...</p><p>The way I connect to VPN is using the OpenVPN module, once I started it in luci it will then automatically define the route</p><p>Yes I defined the VPN in network config :<br/></p><div class="codebox"><pre><code>config interface &#039;VPN&#039;
        option proto &#039;none&#039;
        option ifname &#039;tun0&#039;
        option defaultroute &#039;0&#039;
        option peerdns &#039;0&#039;
        option auto &#039;1&#039;</code></pre></div><p>Please kindly advise. Thank you.</p>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 4 of 65</div><nav><ul><li><a href="viewtopic.php%3Fid=39052&amp;p=1.html">1</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=2.html">2</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=3.html">3</a></li><li class="pagination-current"><span>4</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=5.html">5</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=6.html">6</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=65.html">65</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0.001 -->

</body>
</html>