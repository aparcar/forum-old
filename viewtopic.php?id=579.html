<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> PPTP client won&#039;t connect</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 6 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p2791">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">abercoder</div>
					<div class="post-datetime">
						29 Oct 2004, 04:09					</div>
				</div>
				<div class="post-content content">
					<p>I am trying to get OpenWRT to act as a PPTP client to a Windows server. I&#039;ve got another WRT running Sveasoft alchemy and its connects fine. The openWRT router will connect to another VPN with a Linux server without problems. I cannot figure out why it won&#039;t connect. The syslog shows the following on OpenWRT:</p><p>Jan&nbsp; 1 23:09:54 OpenWrt kern.debug pppd[1130]: rcvd [CHAP Success id=0x8d &quot;S=D767F2F595C2F9B98F292557F3F6066F03C11BD9 M=Access granted&quot;]<br />Jan&nbsp; 1 23:09:54 OpenWrt kern.debug pppd[1130]: sent [CCP ConfReq id=0x1 &lt;mppe -H -M -S -L -D +C&gt; &lt;deflate 15&gt; &lt;deflate(old#) 15&gt;]<br />Jan&nbsp; 1 23:09:54 OpenWrt kern.debug pppd[1130]: sent [IPCP ConfReq id=0x1 &lt;compress VJ 0f 01&gt; &lt;addr 0.0.0.0&gt;]<br />Jan&nbsp; 1 23:09:54 OpenWrt kern.debug pppd[1130]: rcvd [CCP ConfReq id=0x1 &lt;mppe +H -M +S -L -D -C&gt;]<br />Jan&nbsp; 1 23:09:54 OpenWrt kern.debug pppd[1130]: sent [CCP ConfNak id=0x1 &lt;mppe -H -M +S -L -D -C&gt;]<br />Jan&nbsp; 1 23:09:54 OpenWrt kern.debug pppd[1130]: rcvd [LCP TermReq id=0x2 &quot;MPPE required but peer negotiation failed&quot;]<br />Jan&nbsp; 1 23:09:54 OpenWrt kern.info pppd[1130]: LCP terminated by peer (MPPE required but peer negotiation failed)<br />Jan&nbsp; 1 23:09:54 OpenWrt kern.debug pppd[1130]: sent [LCP TermAck id=0x2]<br />Jan&nbsp; 1 23:09:54 OpenWrt kern.debug pppd[1130]: rcvd [CCP ConfRej id=0x1 &lt;mppe -H -M -S -L -D +C&gt; &lt;deflate 15&gt; &lt;deflate(old#) 15&gt;]<br />Jan&nbsp; 1 23:09:54 OpenWrt kern.debug pppd[1130]: Discarded non-LCP packet when LCP not open</p><br /><p>but on sveasoft it says:</p><p>Oct 28 17:46:31 Sopita daemon.debug pppd[8968]: rcvd [CHAP Success id=0x88 &quot;S=967976A57478E47617F9146A6C852874A240DBB5 M=Access granted&quot;]<br />Oct 28 17:46:31 Sopita daemon.debug pppd[8968]: sent [CCP ConfReq id=0x1 &lt;mppe +H +M +S +L -D +C&gt;]<br />Oct 28 17:46:31 Sopita daemon.debug pppd[8968]: rcvd [CCP ConfReq id=0x1 &lt;mppe +H -M +S -L -D -C&gt;]<br />Oct 28 17:46:31 Sopita daemon.debug pppd[8968]: sent [CCP ConfAck id=0x1 &lt;mppe +H -M +S -L -D -C&gt;]<br />Oct 28 17:46:31 Sopita daemon.debug pppd[8968]: rcvd [CCP ConfNak id=0x1 &lt;mppe +H -M +S -L -D -C&gt;]<br />Oct 28 17:46:31 Sopita daemon.debug pppd[8968]: sent [CCP ConfReq id=0x2 &lt;mppe +H -M +S -L -D -C&gt;]<br />Oct 28 17:46:31 Sopita daemon.debug pppd[8968]: rcvd [CCP ConfAck id=0x2 &lt;mppe +H -M +S -L -D -C&gt;]<br />Oct 28 17:46:31 Sopita daemon.notice pppd[8968]: MPPE 128-bit stateless compression enabled<br />Oct 28 17:46:31 Sopita daemon.debug pppd[8968]: sent [IPCP ConfReq id=0x1 &lt;compress VJ 0f 01&gt; &lt;addr 0.0.0.0&gt;]<br />Oct 28 17:46:31 Sopita daemon.debug pppd[8968]: rcvd [IPCP ConfReq id=0x1 &lt;compress VJ 0f 01&gt; &lt;addr 172.x.x.x&gt;]<br />Oct 28 17:46:31 Sopita daemon.debug pppd[8968]: sent [IPCP ConfAck id=0x1 &lt;compress VJ 0f 01&gt; &lt;addr 172.x.x.x&gt;]<br />Oct 28 17:46:31 Sopita daemon.debug pppd[8968]: rcvd [IPCP ConfNak id=0x1 &lt;addr 172.17.176.124&gt;]<br />Oct 28 17:46:31 Sopita daemon.debug pppd[8968]: sent [IPCP ConfReq id=0x2 &lt;compress VJ 0f 01&gt; &lt;addr 172.x.x.x&gt;]<br />Oct 28 17:46:31 Sopita daemon.debug pppd[8968]: rcvd [IPCP ConfAck id=0x2 &lt;compress VJ 0f 01&gt; &lt;addr 172.x.x.x&gt;]<br />Oct 28 17:46:31 Sopita daemon.notice pppd[8968]: local&nbsp; IP address 172.17.176.124<br />Oct 28 17:46:31 Sopita daemon.notice pppd[8968]: remote IP address 172.17.176.1</p><br /><p>I have the ppp_deflate, ppp_async and ppp_mppe_mppc modules loaded. I notice that Sveasoft has these built straight into the kernel rather than as modules. From what I can tell the pptp-client, pppd and kernel versions are identical. </p><p>Any ideas why this doesn&#039;t work?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p2793">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">chimpanzee</div>
					<div class="post-datetime">
						29 Oct 2004, 07:51					</div>
				</div>
				<div class="post-content content">
					<p>show me the related configure files and I would give a shot. pptp(pppd) is quite picky on the options. I spent a few days to get the right config. In general, you need to enable both mppe and mschap-v2(and only this two) .</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p2803">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">abercoder</div>
					<div class="post-datetime">
						29 Oct 2004, 15:42					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ve actually not got a /etc/ppp/options file (or equivalent) on either system. What I&#039;ve done to make the call is to do run the command:</p><p>pptp 172.x.x.x user me password pass noauth debug lock persist</p><p>This works great on sveasoft, but gives me the errors on openwrt (on openwrt before running this I insmod the appropriate modules and create /var/lock as ppp creates some files there). </p><p>I&#039;m wondering if I compile the ppp options into the kernel (instead of as modules) like sveasoft does if that will work?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p2806">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">chimpanzee</div>
					<div class="post-datetime">
						29 Oct 2004, 17:54					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><blockquote><p>I&#039;ve actually not got a /etc/ppp/options file (or equivalent) on either system. What I&#039;ve done to make the call is to do run the command:</p><p>pptp 172.x.x.x user me password pass noauth debug lock persist</p><p>This works great on sveasoft, but gives me the errors on openwrt (on openwrt before running this I insmod the appropriate modules and create /var/lock as ppp creates some files there). </p><p>I&#039;m wondering if I compile the ppp options into the kernel (instead of as modules) like sveasoft does if that will work?</p></blockquote></div><p>If there is no other options and the remote is not properly configured, this will most likely failed. You need to add &quot;+mppe-128 require-mschap-v2&quot; and may be &quot;refuse-pap refuse-eap refuse-chap&quot;. The reason is that pptp(MS style) use mppe which requires mschap-v2 authentication but if you already agree on some other things(like pap or chap), pppd barks and stop.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p2815">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">abercoder</div>
					<div class="post-datetime">
						30 Oct 2004, 04:04					</div>
				</div>
				<div class="post-content content">
					<p>ok, i&#039;ll give that a try. I still don&#039;t see why sveasoft would be negotiating different options to openwrt given that the versions of pptp,pppd and the kernel are identical.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p2905">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">abercoder</div>
					<div class="post-datetime">
						8 Nov 2004, 05:19					</div>
				</div>
				<div class="post-content content">
					<p>I tried making a normal ppp config with a chap-secrets file and an options file. When require-mschap-v2 is enabled I get:</p><div class="quotebox"><blockquote><p>/usr/sbin/pppd: The remote system (PROVIDER) is required to authenticate itself<br />/usr/sbin/pppd: but I couldn&#039;t find any suitable secret (password) for it to use to do so.</p></blockquote></div><p>My options file consists of:</p><p>lock<br />noauth<br />nobsdcomp<br />nodeflate<br />debug<br />require-mppe-128<br />lcp-echo-failure 30<br />lcp-echo-interval 20<br />refuse-pap<br />refuse-eap<br />refuse-chap<br />+mppe-128</p><p>the chap-secrets consists of:</p><p><em>me@mydomain.com</em>&nbsp; &nbsp; *&nbsp; &nbsp; <em>mypassword</em></p><br /><p>I&#039;m still getting the same error messages though. I&#039;m wondering if not having the stateless option enabled is causing problems, howver I can&#039;t work out what option to use. Putting &quot;mppe-stateless&quot; or &quot;require-mppe-stateless&quot; in the options causes errors from pptp. </p><p>I&#039;m able to connect ok to my linux pptp server with this setup, just not to the windows server (which is what I need).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p2906">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">abercoder</div>
					<div class="post-datetime">
						8 Nov 2004, 05:31					</div>
				</div>
				<div class="post-content content">
					<p>Just found this page <a href="http://pptpclient.sourceforge.net/howto-diagnosis.phtml#mppe_rbpnf">http://pptpclient.sourceforge.net/howto … mppe_rbpnf</a> and it said to try the option nomppe-stateful, I added that to my options file and everything works fine. </p><p>By simply running:</p><p>pptp 123.123.123.123 user me@my.com password mypassword noauth lock nomppe-stateful debug</p><p>also works fine.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>