<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> WLAN for Linksys WAG160Nv2</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 29 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p139069">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">smichak</div>
					<div class="post-datetime">
						13 Jul 2011, 20:20					</div>
				</div>
				<div class="post-content content">
					<p>I got the ath9k wireless driver to work properly on my WAG160Nv2 Annex A router.</p><p>Quick instructions regarding the attached patch:</p><p>1. Checkout trunk from svn r25712.<br />2. Apply jal2 patches from&nbsp; and .<br />3. Apply the patch from <br />4. Configure kernel with the ath9k driver and build.</p><p>I am currently not sure on whether this works for Annex B devices. Also, I am using fixed address for reading the calibration data - it should probably be taken from flash configuration.</p><p>Please provide feedback,</p><p>Micha</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p140958">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">pace303</div>
					<div class="post-datetime">
						10 Aug 2011, 12:57					</div>
				</div>
				<div class="post-content content">
					<p>I did point 1,2,3,4 on a WAG160Nv2 annex A. However I still doesn&#039;t have a wireless interface.</p><p>I understand 4. as adding kernel modules&gt;wireless drivers&gt;kmod-ath9k. Is it right ?</p><p>The only reference I have about wireless on dmesg is:</p><p>wlan: trunk<br />wlan: mac acl policy registered</p><p>Can you detail point 4 ?</p><p>Thanks!</p><p>Pace</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p140968">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">smichak</div>
					<div class="post-datetime">
						10 Aug 2011, 16:10					</div>
				</div>
				<div class="post-content content">
					<p>Can you post the entire dmesg output?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p141061">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">pace303</div>
					<div class="post-datetime">
						11 Aug 2011, 13:55					</div>
				</div>
				<div class="post-content content">
					<p>Linux version 2.6.35.11 (none@n0ne) (gcc version 4.5.2 (Linaro GCC 4.5-2011.02-0) ) #2 Wed Aug 10 10:28:18 CEST 2011<br />Detected Broadcom 0x6358 CPU revision a1<br />CPU frequency is 300 MHz<br />32MB of RAM installed<br />registering 40 GPIOs<br />board_bcm963xx: CFE version: 1.0.37-5.4<br />bootconsole [early0] enabled<br />CPU revision is: 0002a010 (Broadcom BCM6358)<br />board_bcm963xx: board name: 96358GW<br />Determined physical RAM map:<br /> memory: 02000000 @ 00000000 (usable)<br />Initrd not found or empty - disabling initrd<br />Zone PFN ranges:<br />&nbsp; Normal&nbsp; &nbsp;0x00000000 -&gt; 0x00002000<br />Movable zone start PFN for each node<br />early_node_map[1] active PFN ranges<br />&nbsp; &nbsp; 0: 0x00000000 -&gt; 0x00002000<br />On node 0 totalpages: 8192<br />free_area_init_node: node 0, pgdat 802764c0, node_mem_map 81000000<br />&nbsp; Normal zone: 64 pages used for memmap<br />&nbsp; Normal zone: 0 pages reserved<br />&nbsp; Normal zone: 8128 pages, LIFO batch:0<br />Built 1 zonelists in Zone order, mobility grouping on.&nbsp; Total pages: 8128<br />Kernel command line:&nbsp; root=/dev/mtdblock2 rootfstype=squashfs,jffs2 noinitrd console=ttyS0,115200<br />PID hash table entries: 128 (order: -3, 512 bytes)<br />Dentry cache hash table entries: 4096 (order: 2, 16384 bytes)<br />Inode-cache hash table entries: 2048 (order: 1, 8192 bytes)<br />Primary instruction cache 32kB, VIPT, 2-way, linesize 16 bytes.<br />Primary data cache 16kB, 2-way, VIPT, cache aliases, linesize 16 bytes<br />Memory: 29628k/32768k available (2086k kernel code, 3140k reserved, 372k data, 156k init, 0k highmem)<br />Hierarchical RCU implementation.<br />&nbsp; &nbsp; RCU-based detection of stalled CPUs is disabled.<br />&nbsp; &nbsp; Verbose stalled-CPUs detection is disabled.<br />NR_IRQS:128<br />Calibrating delay loop... 299.00 BogoMIPS (lpj=598016)<br />pid_max: default: 32768 minimum: 301<br />Mount-cache hash table entries: 512<br />NET: Registered protocol family 16<br />registering PCI controller with io_map_base unset<br />bio: create slab &lt;bio-0&gt; at 0<br />pci 0000:00:01.0: reg 10: [mem 0x00000000-0x0000ffff]<br />pci 0000:00:01.0: BAR 0: assigned [mem 0x30000000-0x3000ffff]<br />pci 0000:00:01.0: BAR 0: set to [mem 0x30000000-0x3000ffff] (PCI address [0x30000000-0x3000ffff]<br />Switching to clocksource MIPS<br />NET: Registered protocol family 2<br />IP route cache hash table entries: 1024 (order: 0, 4096 bytes)<br />TCP established hash table entries: 1024 (order: 1, 8192 bytes)<br />TCP bind hash table entries: 1024 (order: 0, 4096 bytes)<br />TCP: Hash tables configured (established 1024 bind 1024)<br />TCP reno registered<br />UDP hash table entries: 256 (order: 0, 4096 bytes)<br />UDP-Lite hash table entries: 256 (order: 0, 4096 bytes)<br />NET: Registered protocol family 1<br />PCI: CLS 0 bytes, default 32<br />audit: initializing netlink socket (disabled)<br />type=2000 audit(0.212:1): initialized<br />squashfs: version 4.0 (2009/01/31) Phillip Lougher<br />Registering mini_fo version $Id$<br />JFFS2 version 2.2 (NAND) (SUMMARY) (LZMA) (RTIME) (CMODE_PRIORITY) (c) 2001-2006 Red Hat, Inc.<br />msgmni has been set to 57<br />io scheduler noop registered<br />io scheduler deadline registered (default)<br />gpiodev: gpio device registered with major 254<br />bcm63xx_uart.0: ttyS0 at MMIO 0xfffe0100 (irq = 10) is a bcm63xx_uart<br />console [ttyS0] enabled, bootconsole disabled<br />bcm963xx_flash: 0x00400000 at 0x1fc00000<br />bcm963xx: Found 1 x16 devices at 0x0 in 16-bit bank<br /> CFI mfr 0x000000c2<br /> CFI id&nbsp; 0x000022a8<br />Amd/Fujitsu Extended Query Table at 0x0040<br />&nbsp; Amd/Fujitsu Extended Query version 1.1.<br />number of CFI chips: 1<br />bcm963xx_flash: Read Signature value of CFE1CFE1<br />bcm963xx_flash: CFE bootloader detected<br />bcm963xx_flash: CFE pid area: hardware id YPX<br />bcm963xx_flash: CFE boot tag found with version 6 and board type 96358GW<br />bcm963xx_flash: Partition 0 is CFE offset 0 and length 10000<br />bcm963xx_flash: Partition 1 is kernel offset 10100 and length dff00<br />bcm963xx_flash: Partition 2 is rootfs offset f0000 and length 2f0000<br />bcm963xx_flash: Partition 3 is ath_data offset 3e0000 and length 10000<br />bcm963xx_flash: Partition 4 is nvram offset 3f0000 and length 10000<br />bcm963xx_flash: Partition 5 is linux offset 10000 and length 3d0000<br />bcm963xx_flash: Spare partition is 2a0000 offset and length 140000<br />Creating 6 MTD partitions on &quot;bcm963xx&quot;:<br />0x000000000000-0x000000010000 : &quot;CFE&quot;<br />0x000000010100-0x0000000f0000 : &quot;kernel&quot;<br />mtd: partition &quot;kernel&quot; must either start or end on erase block boundary or be smaller than an erase block -- forcing read-only<br />0x0000000f0000-0x0000003e0000 : &quot;rootfs&quot;<br />mtd: partition &quot;rootfs&quot; set to be root filesystem<br />mtd: partition &quot;rootfs_data&quot; created automatically, ofs=290000, len=150000 <br />0x000000290000-0x0000003e0000 : &quot;rootfs_data&quot;<br />0x0000003e0000-0x0000003f0000 : &quot;ath_data&quot;<br />0x0000003f0000-0x000000400000 : &quot;nvram&quot;<br />0x000000010000-0x0000003e0000 : &quot;linux&quot;<br />bcm63xx_wdt started, timer margin: 30 sec<br />Registered led device: power:green<br />Registered led device: power:red<br />Registered led device: adsl<br />Registered led device: internet:green<br />Registered led device: internet:red<br />TCP westwood registered<br />NET: Registered protocol family 17<br />802.1Q VLAN Support v1.8 Ben Greear &lt;greearb@candelatech.com&gt;<br />All bugs added by David S. Miller &lt;davem@redhat.com&gt;<br />VFS: Mounted root (squashfs filesystem) readonly on device 31:2.<br />Freeing unused kernel memory: 156k freed<br />eth0: link forced UP - 100/full - flow control off/off<br />roboswitch: Probing device eth0: found a 5325! It&#039;s a 5350.<br />There is already a switch registered on the device &#039;eth0&#039;<br />input: gpio-buttons as /devices/platform/gpio-buttons.0/input/input0<br />Button Hotplug driver version 0.4.1<br />mini_fo: using base directory: /<br />mini_fo: using storage directory: /overlay<br />eth0: link forced UP - 100/full - flow control off/off<br />device eth0 entered promiscuous mode<br />br-lan: port 1(eth0) entering forwarding state<br />br-lan: port 1(eth0) entering forwarding state<br />Compat-wireless backport release: compat-wireless-2011-01-31-4-g86702b3<br />Backport based on wireless-testing.git master-2011-02-07<br />cfg80211: Calling CRDA to update world regulatory domain<br />There is already a switch registered on the device &#039;eth0&#039;<br />PPP generic driver version 2.4.2<br />cfg80211: World regulatory domain updated:<br />cfg80211:&nbsp; &nbsp; &nbsp;(start_freq - end_freq @ bandwidth), (max_antenna_gain, max_eirp)<br />cfg80211:&nbsp; &nbsp; &nbsp;(2402000 KHz - 2472000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)<br />cfg80211:&nbsp; &nbsp; &nbsp;(2457000 KHz - 2482000 KHz @ 20000 KHz), (300 mBi, 2000 mBm)<br />cfg80211:&nbsp; &nbsp; &nbsp;(2474000 KHz - 2494000 KHz @ 20000 KHz), (300 mBi, 2000 mBm)<br />cfg80211:&nbsp; &nbsp; &nbsp;(5170000 KHz - 5250000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)<br />cfg80211:&nbsp; &nbsp; &nbsp;(5735000 KHz - 5835000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)<br />ip_tables: (C) 2000-2006 Netfilter Core Team<br />NET: Registered protocol family 24<br />nf_conntrack version 0.5.0 (465 buckets, 1860 max)<br />ath_hal: module license &#039;Proprietary&#039; taints kernel.<br />Disabling lock debugging due to kernel taint<br />ath_hal: 2009-05-08 (AR5210, AR5211, AR5212, AR5416, RF5111, RF5112, RF2413, RF5413, RF2133, RF2425, REGOPS_FUNC, XR)<br />ath_pci: trunk<br />wlan: trunk<br />wlan: mac acl policy registered<br />ath_rate_minstrel: Minstrel automatic rate control algorithm 1.2 (trunk)<br />ath_rate_minstrel: look around rate set to 10%<br />ath_rate_minstrel: EWMA rolloff level set to 75%<br />ath_rate_minstrel: max segment size in the mrr set to 6000 us</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p141457">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">pace303</div>
					<div class="post-datetime">
						16 Aug 2011, 07:58					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>smichak wrote:</cite><blockquote><p>Can you post the entire dmesg output?</p></blockquote></div><p>dmesg has been copied in a previous message.</p><p>can you paste your .config file please ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p143341">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">smichak</div>
					<div class="post-datetime">
						11 Sep 2011, 14:05					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>pace303 wrote:</cite><blockquote><div class="quotebox"><cite>smichak wrote:</cite><blockquote><p>Can you post the entire dmesg output?</p></blockquote></div><p>dmesg has been copied in a previous message.</p><p>can you paste your .config file please ?</p></blockquote></div><p>Sorry for the late response, I have been on a vacation. </p><p>From your dmesg output it seems like you&#039;re building the firmware with ath5k instead of ath9k. Also, note that you should see the printk&#039;s that were added in the patch (such as<br />&quot;pci-ath9k-fixup: Device vendor 0x%04x, id 0x%04x\n&quot;) in the dmesg output (this is currently not the case).</p><br /><p>My .config file: <a href="http://dl.dropbox.com/u/9357916/openwrt-config">http://dl.dropbox.com/u/9357916/openwrt-config</a></p><br /><br /><p>Micha</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p148035">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">pace303</div>
					<div class="post-datetime">
						9 Nov 2011, 17:02					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><blockquote><p>Sorry for the late response, I have been on a vacation. </p><p>From your dmesg output it seems like you&#039;re building the firmware with ath5k instead of ath9k. Also, note that you should see the printk&#039;s that were added in the patch (such as<br />&quot;pci-ath9k-fixup: Device vendor 0x%04x, id 0x%04x\n&quot;) in the dmesg output (this is currently not the case).</p><br /><p>My .config file: <a href="http://dl.dropbox.com/u/9357916/openwrt-config">http://dl.dropbox.com/u/9357916/openwrt-config</a></p><br /><br /><p>Micha</p></blockquote></div><p>Hi Micha,</p><p>sorry as well for the late answer.</p><p>The problem came from the make which downloads many sources for building the toolchain. Some files weren&#039;t available anymore from the Makefile, thus, I had to download them manually.</p><p>Once the correct toolchain compiled, everything is working perfectly. My recommendation is to do:</p><p>make V=99 </p><p>to be sure to detect any error from the Makefile downloading scripts.</p><p>regards,</p><p>pace303</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p151333">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">danitool</div>
					<div class="post-datetime">
						16 Dec 2011, 15:18					</div>
				</div>
				<div class="post-content content">
					<p>Hi, I&#039;m trying to add support for a new bcm6358 board. It&#039;s a Huawei hg556a. </p><p>It has exactly the same onboard wlan chip like the WAG160Nv2: <strong>Atheros AR9223 802.11b/g/n</strong>.<br />My work is almost done except the wireless support. The board has the same problem with the ath_data partition.</p><p>I think I&#039;ve located the ath_data partition between offsets: 0x00EFF000-0x00EFE000. I&#039;m not sure of it. This is the backup of my flash:<br /><a href="http://files.myopera.com/danitool/linux/hg556a_backup.bin.zip">http://files.myopera.com/danitool/linux … up.bin.zip</a></p><p>And this is the extracted data at those offsets:<br /><a href="http://files.myopera.com/danitool/linux/hg556a_ath_data.zip">http://files.myopera.com/danitool/linux … h_data.zip</a></p><p>Also with the OEM firmware the bootlog at early startup shows this about the ath wlan:<br /></p><div class="codebox"><pre><code>Board id is set HW556, ucHardwareType 0

fInfo.flash_wlanparam_start_blk = 119
fInfo.flash_wlanparam_number_blk = 1
fInfo.flash_wlanparam_length = 0x2000
fInfo.flash_wlanparam_blk_offset = 0x1e000</code></pre></div><p>What I want to know if I&#039;m in the correct way. Could you post your ath_data partition and whole flash backup to compare with mine?. Then I will try those patches fort the eeprom data partition to see if it works.</p><p>It would be nice bcm6358 with ath9k onboard chips get supported by openwrt.</p>											<p class="post-edited">(Last edited by <strong>danitool</strong> on 16 Dec 2011, 15:23)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p151523">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">hope11</div>
					<div class="post-datetime">
						19 Dec 2011, 08:55					</div>
				</div>
				<div class="post-content content">
					<p>Exciting?<br />I also have a hg556a||Waiting for good news???</p><p>I want to know&nbsp; the ttl settings,and Baud Rate</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p151537">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">danitool</div>
					<div class="post-datetime">
						19 Dec 2011, 12:59					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>hope11 wrote:</cite><blockquote><p>Exciting!<br />I also have a hg556a||Waiting for good news!!!</p><p>I want to know&nbsp; the ttl settings,and Baud Rate</p></blockquote></div><p><strong>155200 baud<br />8 databits<br />1 stopbit<br />no parity<br />no handsake</strong><br /><a href="http://wiki.openwrt.org/inbox/huawei.hg556a#serial">http://wiki.openwrt.org/inbox/huawei.hg556a#serial</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p151589">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">hope11</div>
					<div class="post-datetime">
						20 Dec 2011, 04:03					</div>
				</div>
				<div class="post-content content">
					<p>I try to do it&nbsp; as your method, but failure;</p><p>this website can&#039;t upload pictures, so i sent mail to you;</p><p>I hope you can help me,please.</p><br /><p>your mail:danitool@jabberes.org<br />my&nbsp; &nbsp;mail: linhao@cncoslight.com</p><br /><p>[danitool@jabberes.org can‘t send mail...........]</p>											<p class="post-edited">(Last edited by <strong>hope11</strong> on 20 Dec 2011, 04:46)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p151679">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">hope11</div>
					<div class="post-datetime">
						21 Dec 2011, 09:55					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>danitool wrote:</cite><blockquote><div class="quotebox"><cite>hope11 wrote:</cite><blockquote><p>Exciting!<br />I also have a hg556a||Waiting for good news!!!</p><p>I want to know&nbsp; the ttl settings,and Baud Rate</p></blockquote></div><p><strong>155200 baud<br />8 databits<br />1 stopbit<br />no parity<br />no handsake</strong><br /><a href="http://wiki.openwrt.org/inbox/huawei.hg556a#serial">http://wiki.openwrt.org/inbox/huawei.hg556a#serial</a></p></blockquote></div><p>155200 baud dose it is ‘115200’ ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p195942">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">cainwong</div>
					<div class="post-datetime">
						24 Mar 2013, 18:44					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>smichak wrote:</cite><blockquote><p>I got the ath9k wireless driver to work properly on my WAG160Nv2 Annex A router.</p><p>Quick instructions regarding the attached patch:</p><p>1. Checkout trunk from svn r25712.<br />2. Apply jal2 patches from&nbsp; and .<br />3. Apply the patch from <br />4. Configure kernel with the ath9k driver and build.</p><p>I am currently not sure on whether this works for Annex B devices. Also, I am using fixed address for reading the calibration data - it should probably be taken from flash configuration.</p><p>Please provide feedback,</p><p>Micha</p></blockquote></div><p>Hi there, Micha (if you still around ... <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" />). I&#039;m new to OpenWRT but i&#039;m pretty interest with the efforts that you have successfully made the WAG160Nv2&#039;s ath9k working on the OpenWRT.</p><p>(1) Can you provide the modded WAG160Nv2 ANNEX A firmware for me to test? And anything else i need to pay attention before modding the firmware?<br />(2) OR is there any simple and clear methods i can kick-start with (since your 1st posted instructions was missing apart)?</p><p>Thanks in advance.</p><p>Regards,<br />Cain</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>