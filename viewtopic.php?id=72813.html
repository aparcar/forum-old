<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Bridge in layer 2?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 29 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p369775">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">jondu94</div>
					<div class="post-datetime">
						19 Dec 2017, 11:22					</div>
				</div>
				<div class="post-content content">
					<p>Good morning, <br />I&#039;am having problems with the &quot;relayd&quot; package. The problem is that this app works in layer 3 (ARP NAT) instead of layer 2, so all the ARP packages throught the openWRTmodule has the ARP Sender address frame with the IP of the openWRT module instead of the real source (it is not a transparent bridge). This is a problem when the AP works besides a wireless controller.</p><p>Example topology:<br />PC1 (192.168.10.80)&lt;----&gt;OpenWRTmodule(192.168.1.1)&lt;----&gt;AP(192.168.10.15)&lt;----&gt;PC2 (192.168.10.34)</p><br /><p>So the question, <strong>is there any package working as a transparent bridge in layer 2?</strong></p><br /><p>Thank you,<br />Regards</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p369798">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">WWTK</div>
					<div class="post-datetime">
						19 Dec 2017, 20:13					</div>
				</div>
				<div class="post-content content">
					<p>The wireless and wired networks are already bridged and use the same subnet by default no relayd is needed so maybe I&#039;m missing something in your question.&nbsp; Relayd is only needed for a wireless bridge to another router, if that&#039;s what you are doing then wds is what you want but support for that is limited.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p369858">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">jondu94</div>
					<div class="post-datetime">
						21 Dec 2017, 10:03					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>WWTK wrote:</cite><blockquote><p>The wireless and wired networks are already bridged and use the same subnet by default no relayd is needed so maybe I&#039;m missing something in your question.&nbsp; Relayd is only needed for a wireless bridge to another router, if that&#039;s what you are doing then wds is what you want but support for that is limited.</p></blockquote></div><p>Sorry I forget to tell the chipset I&#039;am working on,</p><p>The chipset is the Atheros 9331. OpenWRT 15.05 (or other versions) gives us the option to make a physical bridge between LAN and WAN, but in this chipset it doesnt work, so I must install relayd to build a pseusobridge.</p><p>Thanks you and regards.</p><br /><p>Note: With GARGOYLE installed in my module and I see that the bridge works correctly (in layer 2), maybe this is not supported by OPENWRT becouse of its native way of making the bridge, idk.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p370492">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">jondu94</div>
					<div class="post-datetime">
						5 Jan 2018, 11:05					</div>
				</div>
				<div class="post-content content">
					<p>Anyone can help me please?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p370517">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">mpjanet</div>
					<div class="post-datetime">
						5 Jan 2018, 21:38					</div>
				</div>
				<div class="post-content content">
					<p>Not really understand your problem. Why Openwrt IP has to be in different network while you need a pure switch? Are you sure relayd is necesary?</p><p>Did you check the OpenWrt document : =wiki.openwrt.org_doc_recipes_dumbap? There are hardware specific configuration to bridge WAN and LAN interface without additional package. If GARGOYLE support it, OpenWrt should have a solution.</p>											<p class="post-edited">(Last edited by <strong>mpjanet</strong> on 5 Jan 2018, 21:39)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p373113">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">jondu94</div>
					<div class="post-datetime">
						2 Mar 2018, 11:34					</div>
				</div>
				<div class="post-content content">
					<p>Excuse me, I mean bridge between LAN and WLAN.</p><p>Yes, its necesary because with the Atheros 9331 its imposible to make a pure bridge from the interface, so I must use the pseudobridge.</p><p>In this link openwrt.org/docs/user-guide/wifi/relay_configuration?s[]=relayd says : &quot;Since opensource wireless drivers used in LEDE do not support bridging in client mode, the traffic between LAN and the wireless client must be joined by routing it.&quot;. </p><p>With Gargoyle the bridge is in layer 2 with versions below 1.8, with newer ones (1.9 and 1.10) the bridge is performed in layer 3 <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><p>I hear with the QSDK it is posible to build the bridge in layer 2 because it performs natively.</p>											<p class="post-edited">(Last edited by <strong>jondu94</strong> on 2 Mar 2018, 12:03)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p373118">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">adri</div>
					<div class="post-datetime">
						2 Mar 2018, 14:52					</div>
				</div>
				<div class="post-content content">
					<p>Gargoyle is based on OpenWrt.<br />When OpenWrt switched from layer 2 to layer 3, so did Gargoyle.<br />So your only option at the moment is using an old version of OpenWrt or an old version of Gargoyle.</p>											<p class="post-edited">(Last edited by <strong>adri</strong> on 2 Mar 2018, 14:53)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p373120">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">mk24</div>
					<div class="post-datetime">
						2 Mar 2018, 15:38					</div>
				</div>
				<div class="post-content content">
					<p>The fundamental problem is that an AP --&gt; STA link assumes that there is only one MAC address at the STA end.&nbsp; It is designed to serve one user&#039;s device per link.&nbsp; This is the so called &quot;3 address&quot; mode where the MAC of the STA radio is also the MAC of the ultimate destination of the packet, since they are the same device.</p><p>The WDS extension defined by IEEE allows true layer 2 bridging by transmitting an extra MAC in every packet, the MAC of the ultimate destination of the packet.&nbsp; This &quot;4 address mode&quot; allows the STA radio to be bridged out to serve several distinct devices. </p><p>If supported at both ends of the link, use AP(WDS) --&gt; STA(WDS) mode.&nbsp; This is a true layer 2 bridge with no extra translations to try to work around 3 address mode.&nbsp; Atheros chips and the ath9k driver have full support of WDS.</p><p>An AP running with WDS enabled will also still accept connections from non-WDS 3-address users.&nbsp; So it is quite transparent to turn on WDS on the AP in your main router and then connect an extension router as a WDS client along with regular clients.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p373134">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">adri</div>
					<div class="post-datetime">
						2 Mar 2018, 23:49					</div>
				</div>
				<div class="post-content content">
					<p>WDS usually works best when the AP and STA are both using the same chipset.<br />Chipsets from different manufactures sometimes refuse to communicate with eachother in WDS mode.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p373249">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">jondu94</div>
					<div class="post-datetime">
						5 Mar 2018, 09:57					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>adri wrote:</cite><blockquote><p>Gargoyle is based on OpenWrt.<br />When OpenWrt switched from layer 2 to layer 3, so did Gargoyle.<br />So your only option at the moment is using an old version of OpenWrt or an old version of Gargoyle.</p></blockquote></div><p>Thank you so much for your help. <br />Unafortunately, for example, gargoyle 1.8.1 is based on OpenWRT BB, but OpenWRT doesn&#039;t allow layer 2 bridge while Gargoyle does. <br />In all versions of OpenWRT I tested has layer 3 bridge.<br />Anyway, why would OpenWRT turn the bridge from being totally transparent on layer 2 to layer 3? isn&#039;t that a step back?</p><p>Kind regards.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p373250">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">jondu94</div>
					<div class="post-datetime">
						5 Mar 2018, 09:58					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>mk24 wrote:</cite><blockquote><p>The fundamental problem is that an AP --&gt; STA link assumes that there is only one MAC address at the STA end.&nbsp; It is designed to serve one user&#039;s device per link.&nbsp; This is the so called &quot;3 address&quot; mode where the MAC of the STA radio is also the MAC of the ultimate destination of the packet, since they are the same device.</p><p>The WDS extension defined by IEEE allows true layer 2 bridging by transmitting an extra MAC in every packet, the MAC of the ultimate destination of the packet.&nbsp; This &quot;4 address mode&quot; allows the STA radio to be bridged out to serve several distinct devices. </p><p>If supported at both ends of the link, use AP(WDS) --&gt; STA(WDS) mode.&nbsp; This is a true layer 2 bridge with no extra translations to try to work around 3 address mode.&nbsp; Atheros chips and the ath9k driver have full support of WDS.</p><p>An AP running with WDS enabled will also still accept connections from non-WDS 3-address users.&nbsp; So it is quite transparent to turn on WDS on the AP in your main router and then connect an extension router as a WDS client along with regular clients.</p></blockquote></div><p>Thank you so much for your elaborated response.<br />The problem is that I cannot use WDS since the APs where I connect my modules has the WDS disabled and I have no access to enable.<br />I would need a way to get the layer 2 bridge without WDS.<br />Is it possible to create a package or compilation to perform that real bridge?<br />I&#039;am new in OpenWRT, still learning, but I really want to use it because of his flexibility and open source phylosophy.</p><p>Kind regards.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>