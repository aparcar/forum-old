<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> iproute 2, tc and Netem support</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 16 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p6094">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">Turbocharged5</div>
					<div class="post-datetime">
						11 Apr 2005, 01:12					</div>
				</div>
				<div class="post-content content">
					<p>Hi All, </p><p>I&#039;m interested in using the WRT as WAN Network Emulator for a network/internet application that I am working on. </p><p>The WRT should be ideal for this <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>I was wondering if the latest version of OpenWRT supports iproute2 and the NETEM <a href="http://developer.osdl.org/shemminger/netem/">http://developer.osdl.org/shemminger/netem/</a><br /> options that go with the tc command?</p><p>for example - </p><p># tc qdisc change dev eth0 root netem delay 100ms 10ms</p><p>and...</p><p># tc qdisc change dev eth0 root netem loss .1%</p><br /><p>Most importantly for me is the ability to set delays and packet drop rates individually for each port. </p><p>Do you know if this is possible? </p><p>Any advice will be of great value and I will post a wiki on my findings if and when I can start acheiving my goals <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Cheers<br />Shaun</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p6121">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">Turbocharged5</div>
					<div class="post-datetime">
						11 Apr 2005, 19:58					</div>
				</div>
				<div class="post-content content">
					<p>*Quietly watches the tumble weeds go by...*</p><p>Apparently, &quot;Netem is part of the latest 2.4 and 2.6 kernels&quot;. What kernel version is OpenWRT on?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p6122">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">nbd</div>
					<div class="post-datetime">
						11 Apr 2005, 20:12					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><blockquote><p>*Quietly watches the tumble weeds go by...*</p><p>Apparently, &quot;Netem is part of the latest 2.4 and 2.6 kernels&quot;. What kernel version is OpenWRT on?</p></blockquote></div><p>Well... we&#039;re using iproute 2.6.9 and Linux 2.4.29, so I guess when you compile your own version of experimental, you can get your NETEM support.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p6125">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">Turbocharged5</div>
					<div class="post-datetime">
						11 Apr 2005, 20:30					</div>
				</div>
				<div class="post-content content">
					<p><img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /> </p><p>OK so this functionality is not yet available? (Darn, I was hoping not to have to buy a second WRT just to find out if this can or can&#039;t be done <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> )</p><br /><div class="quotebox"><blockquote><p>so I guess when you compile your own version of experimental, you can get your NETEM support.</p></blockquote></div><p>Hmm, I&#039;m a bit new to Linux (old hat at windoz). Although I have been playing around with the NSLU2 for a while. I guess I could have a go at compiling my own kernel. How hard can it be&nbsp; :? </p><p>Any pointers on how to get started *ducks and waits for the flames*</p><br /><br /><p> <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p42003">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">lvl</div>
					<div class="post-datetime">
						3 Feb 2007, 00:52					</div>
				</div>
				<div class="post-content content">
					<p>Kind of a late reply, but I figured someone else might be interested.. it took me half a day to figure it all out.</p><p>The short version:<br />- Grab my <a href="http://s1.talkto.nl/lvl/q_netem.so">q_netem.so</a> and put it in /usr/lib<br />- Grab my <a href="http://s1.talkto.nl/lvl/sch_netem.o">sch_netem.o</a> and put it in /lib/modules/2.4.30<br />- insmod sch_netem<br />- netem should now be working. test with something like &quot;tc qdisc add dev eth0 root netem delay 5ms&quot;</p><p>The long version:<br />- Find a linux box or run something in vmware<br />- svn co <a href="https://svn.openwrt.org/openwrt/branches/whiterussian/">https://svn.openwrt.org/openwrt/branches/whiterussian/</a><br />- open ./target/linux/linux-2.4/config/brcm, find the line &quot;# CONFIG_NET_SCH_NETEM is not set&quot;, and change it to &quot;CONFIG_NET_SCH_NETEM=m&quot;</p><p>(depending on the box you compile from, you might have to:<br />- apt-get install bzip2 unzip zlibc zlib1g-dev<br />- edit toolchain/Makefile and remove the gdb from &quot;TARGETS:=sed utils binutils gcc uClibc ipkg-utils gdb&quot;<br />- cp -r ./target/linux/package/openwrt/include/* ./staging_dir_mipsel/usr/include/ )</p><p>- run make menuconfig<br />- make sure package selection -&gt; iproute2 TC / IP are enabled (M)<br />- make sure kernel configuration -&gt; linux 2.4/support for broadcom based routers is enabled (*)<br />- if you want to save time compiling (and just need the netem modules, not a complete openwrt build), you can disable everything else</p><p>- run make clean world<br />- find your q_netem.so in ./build_mipsel/iproute2-2.6.11-050330/tc/<br />- find your sch_netem.o in ./build_mipsel/linux-2.4-brcm/modules/lib/modules/2.4.30/kernel/net/sched/</p><br /><p>I&#039;m pretty new at this, so please let me know if I did something wrong or left anything out.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p44610">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">ojacques</div>
					<div class="post-datetime">
						17 Mar 2007, 09:29					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>lvl wrote:</cite><blockquote><p>Kind of a late reply, but I figured someone else might be interested.. it took me half a day to figure it all out.</p><p>The short version:<br />- Grab my <a href="http://s1.talkto.nl/lvl/q_netem.so">q_netem.so</a> and put it in /usr/lib<br />- Grab my <a href="http://s1.talkto.nl/lvl/sch_netem.o">sch_netem.o</a> and put it in /lib/modules/2.4.30<br />- insmod sch_netem<br />- netem should now be working. test with something like &quot;tc qdisc add dev eth0 root netem delay 5ms&quot;</p></blockquote></div><p>Just wanted to say that it works like a charm (installed on top of WhiteRussian 0.9 - <a href="http://downloads.openwrt.org/whiterussian/0.9/)">http://downloads.openwrt.org/whiterussian/0.9/)</a>!<br />With this, you get a compact, reliable, almost free hardware network emulator - <a href="http://en.wikipedia.org/wiki/Network_emulation">http://en.wikipedia.org/wiki/Network_emulation</a>! It&#039;s great to emulate any kind of network conditions (high latency, asymetric bandwidth, jitter, packet loss, ...).</p><p>Thanks a million lvl!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p84490">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">Stochastic</div>
					<div class="post-datetime">
						25 Mar 2009, 03:55					</div>
				</div>
				<div class="post-content content">
					<p>Can anybody do me a huge favor and compile me a copy of these two for BRCM 2.4.30 whiterussian? I&#039;d really really appreciate it. AND I&#039;d be happy to personally host them with a link from this topic for a long, long time. Much appreciated. SQuinlanesq at gmail.com</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p84503">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">Stochastic</div>
					<div class="post-datetime">
						25 Mar 2009, 09:40					</div>
				</div>
				<div class="post-content content">
					<p>nevermind my post. I guess you can use ipkg to do this now. ipkg install ip tc</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p137372">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">anas465</div>
					<div class="post-datetime">
						17 Jun 2011, 15:01					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>&nbsp; &nbsp;I am opening this topic again since I would like to use netem on the top of my Linksys WRT54GL v1.1 with whiterussian 0.9 but still I am failing to do it.<br />Here are some logs I got:</p><p>root@OpenWrt:/# ipkg install ip tc<br />Installing ip (2.6.11-050330-1) to root...<br />Downloading <a href="http://downloads.openwrt.org/whiterussian/packages/ip_2.6.11-050330-1_mipsel.ipk">http://downloads.openwrt.org/whiterussi … mipsel.ipk</a><br />Package tc (2.6.11-050330-1) installed in root is up to date.<br />Configuring ip<br />Successfully terminated.<br />root@OpenWrt:/# </p><br /><p>root@OpenWrt:/# tc qdisc add dev eth0 root netem delay 10ms<br />Unknown qdisc &quot;netem&quot;, hence option &quot;delay&quot; is unparsable<br />root@OpenWrt:/# insmod sch_netem<br />insmod: sch_netem.o: no module by that name found</p><br /><p>What do you mean I can do it with ipkg?</p><p>Cheers</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p137437">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">anas465</div>
					<div class="post-datetime">
						18 Jun 2011, 15:18					</div>
				</div>
				<div class="post-content content">
					<p>any hint related to my last post?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p137443">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">scruffy</div>
					<div class="post-datetime">
						18 Jun 2011, 16:17					</div>
				</div>
				<div class="post-content content">
					<p>Sure:</p><p>I am using OpenWrt &quot;trunk&quot;, which is based on buildroot-ng:&nbsp; <a href="http://wiki.openwrt.org/_media/doc/howto/code_overview.png">http://wiki.openwrt.org/_media/doc/howt … erview.png</a> and netem works for me :-P</p><p>You may get a helping answer from somebody, but WhiteRussian ain&#039;t supported any longer.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p137473">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">anas465</div>
					<div class="post-datetime">
						18 Jun 2011, 19:01					</div>
				</div>
				<div class="post-content content">
					<p>thank you for you answer.</p><p>Could that be compatible with my linksys wrt54GL?</p><p>Are you using this version? <br /><a href="http://downloads.openwrt.org/snapshots/trunk/brcm47xx/">http://downloads.openwrt.org/snapshots/trunk/brcm47xx/</a></p><p>So netem package is already included and you could just load it?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p137475">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">scruffy</div>
					<div class="post-datetime">
						18 Jun 2011, 19:24					</div>
				</div>
				<div class="post-content content">
					<p>Download <a href="http://downloads.openwrt.org/snapshots/trunk/brcm47xx/packages/kmod-sched_2.6.37.6-1_brcm47xx.ipk">http://downloads.openwrt.org/snapshots/ … cm47xx.ipk</a><br />Extract it and look for <a href="http://lxr.free-electrons.com/source/net/sched/sch_netem.c">http://lxr.free-electrons.com/source/ne … ch_netem.c</a>, just compiled. sch_netem.ko</p><p>If it ain&#039;t present, then kmod-sched was compiled without it, and you need to compile your own WITH it.<br />It should be enough to compile the package kmod-sched and then install this with opkg!</p><p>For installation check: <a href="http://wiki.openwrt.org/doc/techref/opkg">http://wiki.openwrt.org/doc/techref/opkg</a>&nbsp; opkg install /tmp/kmod-sched_2.6.37.6-1_brcm47xx.ipk&nbsp; should do the trick.</p><p>To compile it, foo, dont&#039; know.<br />Follow this: <a href="http://wiki.openwrt.org/doc/howto/obtain.firmware.compile">http://wiki.openwrt.org/doc/howto/obtai … re.compile</a></p><p>make menuconfig bla bla</p><p>And then instead of a simple make, you have to tell him to only compile the missing package: &quot;kmod-sched&quot;.</p><p>cf: <a href="http://wiki.openwrt.org/doc/howto/obtain.firmware.compile#building.single.packages">http://wiki.openwrt.org/doc/howto/obtai … e.packages</a></p><p>You need the path of the package.</p><p>Please report back</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>