<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Share Internet from LAN to wireless interface</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 29 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p186893">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">fragaycia</div>
					<div class="post-datetime">
						24 Dec 2012, 12:38					</div>
				</div>
				<div class="post-content content">
					<p>Hi. I&#039;m trying to setup a network with my main router and a OpenWRT one.</p><p>The OpenWRT device is connected to the main router with a Ethernet cable, and has an access point with a different network IP.</p><p>The problem is I cannot configure it to get Internet from the main router and distribute it to the clients connected to the AP.</p><p><span class="postimg"><img src="http://i.imgur.com/n9LlG.png" alt="http://i.imgur.com/n9LlG.png" /></span></p><p>Thanks in advance.</p>											<p class="post-edited">(Last edited by <strong>fragaycia</strong> on 24 Dec 2012, 13:21)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p186899">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">written_direcon</div>
					<div class="post-datetime">
						24 Dec 2012, 13:53					</div>
				</div>
				<div class="post-content content">
					<p>Upcoming questions:</p><p>1) Do you like to have the main router and the OpenWrt subnet to be on different subnets?</p><p>2) Is your main router the gateway, DNS and DHCP server for your complete LAN?</p>											<p class="post-edited">(Last edited by <strong>written_direcon</strong> on 24 Dec 2012, 13:55)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p186900">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">fragaycia</div>
					<div class="post-datetime">
						24 Dec 2012, 13:56					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>written_direcon wrote:</cite><blockquote><p>Upcoming questions:<br />1) Do you like to have the main router and the OpenWrt subnet to be on different subnets?<br />2) Is your main router the gateway, DNS and DHCP server for your complete LAN?</p></blockquote></div><p>1. Exactly, that&#039;s what I want.<br />2. Yeah.</p><p>By the way, I forgot to mention. The LAN interface in the OpenWRT has the IP 192.168.0.100, and the DHCP server is disabled in that interface.</p><p>Thank you.</p>											<p class="post-edited">(Last edited by <strong>fragaycia</strong> on 24 Dec 2012, 14:00)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p186902">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">written_direcon</div>
					<div class="post-datetime">
						24 Dec 2012, 14:05					</div>
				</div>
				<div class="post-content content">
					<p>Okay then you should:</p><p>1) Enable the DHCP server on the OpenWrt router again. It&#039;s for the LAN &amp; WiFi by default.</p><p>2) Connect the OpenWrt&#039;s <strong>W</strong>AN port to one of the main routers <strong>L</strong>AN port.</p><p>3) The clients connecting to the OpenWrt router should be in DHCP client mode</p><p>That should do it. But remember you are doing double NAT then (on the main and OpenWrt router), which isn&#039;t a optimal solution.</p>											<p class="post-edited">(Last edited by <strong>written_direcon</strong> on 24 Dec 2012, 14:09)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p186904">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">fragaycia</div>
					<div class="post-datetime">
						24 Dec 2012, 14:16					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>written_direcon wrote:</cite><blockquote><p>Okay then you should:</p><p>1) Enable the DHCP server on the OpenWrt router again. It&#039;s for the LAN &amp; WiFi by default.</p><p>2) Connect the OpenWrt&#039;s <strong>W</strong>AN port to one of the main routers <strong>L</strong>AN port.</p><p>3) The clients connecting to the OpenWrt router should be in DHCP client mode</p><p>That should do it. But remember you are doing double NAT then (on the main and OpenWrt router), which isn&#039;t a optimal solution.</p></blockquote></div><p>The problem here is I don&#039;t know which one&#039;s the WAN port in the OpenWRT. That&#039;s the only problem, the DHCP server in OpenWRT is working and giving addresses.</p><p>The router I&#039;m using is this one:<br /><a href="http://wiki.openwrt.org/toh/huawei/hg553">http://wiki.openwrt.org/toh/huawei/hg553</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p186905">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">written_direcon</div>
					<div class="post-datetime">
						24 Dec 2012, 14:19					</div>
				</div>
				<div class="post-content content">
					<p>Then login to your OpenWrt and do trial &amp; error to find out which port is the WAN port. You can do this by switching the ethernet cable between the ports and by runnung the &#039;ifdown wan &amp;&amp; ifup wan&#039; command.</p><p>The WAN interface should get an IP address from the main routers subnet. Check with &#039;ifconfig&#039; command.</p><p>Another question: Which OpenWrt router do you own?</p>											<p class="post-edited">(Last edited by <strong>written_direcon</strong> on 24 Dec 2012, 14:21)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p186906">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">written_direcon</div>
					<div class="post-datetime">
						24 Dec 2012, 14:22					</div>
				</div>
				<div class="post-content content">
					<p>There you go (<a href="http://wiki.openwrt.org/toh/huawei/hg553#switch.ports.for.vlans">Switch Ports (for VLANs)</a>):</p><p>Switch port #4 = WAN</p>											<p class="post-edited">(Last edited by <strong>written_direcon</strong> on 24 Dec 2012, 14:23)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p186912">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">fragaycia</div>
					<div class="post-datetime">
						24 Dec 2012, 16:08					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><blockquote><p>Switch Ports (for VLANs)<br />Numbers 0-3 are Ports 1-4 as labeled on the unit, number 4 is the Internet (WAN) on the unit, 5 is the internal connection to the router itself. Don&#039;t be fooled: Port 1 on the unit is number 3 when configuring VLANs. vlan0 = eth0.0, vlan1 = eth0.1 and so on.</p></blockquote></div><p>There&#039;s no connection for the number 4 (WAN), only the labeled one.<br />Also, if I change the cable between the ports, it always shows it&#039;s the WAN connection in the status page:</p><p><span class="postimg"><img src="http://i.imgur.com/wBobX.png" alt="http://i.imgur.com/wBobX.png" /></span></p><p>Sorry if it seems I&#039;m a noob, is just English is not my first language and sometimes it&#039;s hard to explain these things haha</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p201120">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">fragaycia</div>
					<div class="post-datetime">
						8 May 2013, 06:56					</div>
				</div>
				<div class="post-content content">
					<p>Hi again! After a long time, I tried this again, and I was able to make the switch work with this config:</p><div class="codebox"><pre><code>config interface &#039;lan&#039;
        option proto &#039;static&#039;
        option ipaddr &#039;192.168.0.69&#039;
        option netmask &#039;255.255.255.0&#039;
        option gateway &#039;192.168.0.1&#039;
        option dns &#039;8.8.8.8&#039;
        option nat &#039;1&#039;
        option ifname &#039;eth1.0&#039;

config interface &#039;wan&#039;
        option ifname &#039;eth1.1&#039;
        option proto &#039;dhcp&#039;

config switch &#039;eth1&#039;
        option enable &#039;1&#039;
        option reset &#039;1&#039;
        option enable_vlan &#039;1&#039;

config switch_vlan
        option device &#039;eth1&#039;
        option vlan &#039;0&#039;
        option ports &#039;0 1 2 5t&#039;

config switch_vlan
        option device &#039;eth1&#039;
        option vlan &#039;1&#039;
        option ports &#039;3 5t&#039;

config interface &#039;wifi&#039;
        option proto &#039;static&#039;
        option ipaddr &#039;192.168.2.1&#039;
        option netmask &#039;255.255.255.0&#039;
        option nat &#039;1&#039;</code></pre></div><p>Now the problem is, by default, it takes the &quot;lan&quot; interface as WAN. If I stop that interface, then it takes the correct one (Port #4), getting IP from DHCP.</p><p>But, after connecting a client to the wifi interface, it doesn&#039;t get Internet. I&#039;m not sure if I have to set a bridge between the interfaces so... any help about this?</p><p>Thank you again!</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>