<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> [SOLVED?] Can&#039;t get polipo to use a disk cache...</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 27 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p241154">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">zxdavb</div>
					<div class="post-datetime">
						23 Jul 2014, 13:35					</div>
				</div>
				<div class="post-content content">
					<p>I was pleased to see polipo updated to v1.1.1 recently, so I thought I&#039;d give it another go!</p><p>I have used it before without problems, but this time I can&#039;t get it to use a disk cache.&nbsp; I am sure I&#039;m doing something simple wrong, but for the life of me I just can&#039;t see it!!&nbsp; Maybe someone could glance at my configuration and point out my stupidity?</p><p>Here is some debugging information:</p><div class="codebox"><pre><code>root@openwrt:/# ps -w | grep polipo
 3265 root      3220 S    /usr/sbin/polipo -c /var/etc/polipo.conf
14759 root      1356 S    grep polipo

root@openwrt:/# cat /var/etc/polipo.conf
### AUTOGENERATED CONFIGURATION
### DO NOT EDIT
### SEE /etc/config/polipo INSTEAD

### SECTION daemon
pidFile = &quot;/var/run/polipo.pid&quot;
daemonise = true

### SECTION general
proxyAddress = &quot;0.0.0.0&quot;
chunkHighMark = 2097152
logLevel = 0x2F
proxyPort = 8123
dnsMaxTimeout = 15
dnsQueryIPv6 = false
dnsUseGethostbyname = false
disableIndexing = false
disableServersList = false
logSyslog = true
allowedClients = &quot;127.0.0.1&quot;, &quot;172.16.0.0/12&quot;

### SECTION cache
diskCacheTruncateTime = 3333d
diskCacheUnlinkTime = 9999d
cacheIsShared = true

### SECTION pmm

### VALUES THAT ARE DISABLED WHEN EMPTY
diskCacheRoot = &quot;/opt/var/cache/polipo&quot;
logFile = &quot;/var/polipo.log&quot;
localDocumentRoot = &quot;&quot;

root@openwrt:/# ls -al /opt/var/cache/polipo
drwxrwxrwx    2 root     root          4096 Jul 21 16:11 .
drwxr-xr-x    4 root     root          4096 Jul 20 22:28 ..</code></pre></div><p>On <a href="http://172.27.0.1:8123/polipo/servers?">http://172.27.0.1:8123/polipo/servers?</a>, I can see the server list, and on <a href="http://172.27.0.1:8123/polipo/status?">http://172.27.0.1:8123/polipo/status?</a>, I can see the objects in memory (and objects are being &#039;superseded&#039; in the log).</p><p>However, <a href="http://172.27.0.1:8123/polipo/index?">http://172.27.0.1:8123/polipo/index?</a> is empty, and if I click on <strong>Write out in-memory cache</strong> via <a href="http://172.27.0.1:8123/polipo/status?">http://172.27.0.1:8123/polipo/status?</a>, nothing happens.</p><p>There are no helpful messages in the log file:</p><div class="codebox"><pre><code>root@openwrt:/# rm /var/polipo.log
root@openwrt:/# /etc/init.d/polipo restart
root@openwrt:/# cat /var/polipo.log
Established listening socket on port 8123.</code></pre></div><p>Any ideas?</p>											<p class="post-edited">(Last edited by <strong>zxdavb</strong> on 25 Sep 2014, 10:34)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p247908">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">guenti</div>
					<div class="post-datetime">
						24 Sep 2014, 11:38					</div>
				</div>
				<div class="post-content content">
					<p>same here on latest trunk (x86-32)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p248027">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">zxdavb</div>
					<div class="post-datetime">
						25 Sep 2014, 10:29					</div>
				</div>
				<div class="post-content content">
					<p>This is apparently a known bug - in my case, the devs lost interest with all the sheanigans over old/packages &amp; stuff that have been going on, and I gave up, but since then: </p><div class="codebox"><pre><code>On 18 September 2014 01:25, &lt;crypto@xxx.at&gt; wrote:
Hello.

I am running Polipo from Git master branch, and realized that the cache entries are not being written to disk.

I guess the regression has happened on commit:

2005534 - use checkRoot() which also handles WIN32 paths correctly (4 months ago) &lt;xnoreq&gt;

More specifically, in this hunk:

@@ -369,12 +368,7 @@ urlDirname(char *buf, int n, const char *url, int len)
     if(lwrcmp(url, &quot;http://&quot;, 7) != 0)
         return -1;

-    if(diskCacheRoot == NULL ||
-       diskCacheRoot-&gt;length &lt;= 0
-#ifndef WIN32
-       || diskCacheRoot-&gt;string[0] != &#039;/&#039;
-#endif
-       )
+    if(checkRoot(localDocumentRoot) &lt;= 0)
         return -1;

     if(n &lt;= diskCacheRoot-&gt;length)


I reverted this commit and the problem seems to be gone.

Thanks!

_______________________________________________
Polipo-users mailing list
Polipo-users@lists.sourceforge.net
https://lists.sourceforge.net/lists/listinfo/polipo-users</code></pre></div><p>Note that I have not checked this patch myself.</p>											<p class="post-edited">(Last edited by <strong>zxdavb</strong> on 25 Sep 2014, 10:36)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p248224">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">zxdavb</div>
					<div class="post-datetime">
						26 Sep 2014, 22:17					</div>
				</div>
				<div class="post-content content">
					<p>After reviewing the patch that caused the error, a workaround is to set localDocumentRoot to a valid directory (which can be empty), for example:</p><div class="codebox"><pre><code>uci set polipo.general.localDocumentRoot=/opt/var/share/polipo/www/
uci commit
/etc/init.d/polipo reload</code></pre></div><p>At least it worked for me.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p250163">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">zxdavb</div>
					<div class="post-datetime">
						11 Oct 2014, 23:10					</div>
				</div>
				<div class="post-content content">
					<p>My first patch!</p><div class="codebox"><pre><code>@@ -368,7 +368,7 @@ urlDirname(char *buf, int n, const char
     if(lwrcmp(url, &quot;http://&quot;, 7) != 0)
         return -1;

-    if(checkRoot(localDocumentRoot) &lt;= 0)
+    if(checkRoot(diskCacheRoot) &lt;= 0)
         return -1;

     if(n &lt;= diskCacheRoot-&gt;length)</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p296725">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">tlg</div>
					<div class="post-datetime">
						20 Oct 2015, 12:58					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>zxdavb wrote:</cite><blockquote><p>After reviewing the patch that caused the error, a workaround is to set localDocumentRoot to a valid directory (which can be empty), for example:</p><div class="codebox"><pre><code>uci set polipo.general.localDocumentRoot=/opt/var/share/polipo/www/
uci commit
/etc/init.d/polipo reload</code></pre></div><p>At least it worked for me.</p></blockquote></div><br /><p>Thanks for your efforts on this and the work around! <br />I have made a build based on the BB stable release (r46516) and the bug is still there.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p303396">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">haazee</div>
					<div class="post-datetime">
						12 Dec 2015, 10:22					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>zxdavb wrote:</cite><blockquote><p>After reviewing the patch that caused the error, a workaround is to set localDocumentRoot to a valid directory (which can be empty), for example:</p><br /><p>At least it worked for me.</p></blockquote></div><p>And yesterday I&#039;ve&nbsp; searched for this solution for many hours... finally I found it by myself, but... I&#039;m using an up to date Chaks Calmer. Why isn&#039;t it fixed yet? <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /><br />It is a very big sec.hole IMHO.&nbsp; I can use disk cache, only after allowing the web server, which gives a simple admin interface as a side effect, without any authentication/authorization.<br />I&#039;m more and more frustrated because of quality of openwrt packages. <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>