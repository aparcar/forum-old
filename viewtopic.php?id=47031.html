<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Extending wireless range by adding second router (by cable)</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 9 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p215958">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">mroek</div>
					<div class="post-datetime">
						29 Oct 2013, 01:18					</div>
				</div>
				<div class="post-content content">
					<p>Hi all,</p><p>I am hoping to get some help or advice on my planned setup, because I am unsure what would be the best method.</p><p>Current setup:</p><p>One WNDR3700v1 running OpenWrt. WAN connected to fiber modem for internet access. Both radios have two SSIDs, one for internal use, and one guest network. The two guest-SSIDs are bridged to a virtual guest interface which has DHCP (different IP range to the main network). Then there is a firewall zone for the guest interface than allows traffic to WAN/internet.</p><p>In other words, a bog standard setup with guest wireless networks.</p><p>However, the wireless range is insufficient, and I have ordered a second router (TP-Link WDR4300) to replace the WNDR3700, so I am planning to use the WNDR3700 to improve wireless coverage in my house. My issue is that I want to have only the main router to act as a DHCP-server, and I also want the second router to extend all four wireless networks (both main and guest networks on both bands).</p><p>I guess it would be possible to do this entirely wireless, but if I do it wired, then I could even use different channels (but same SSIDs and passwords) for the second router, allowing devices to connect to either router, but also potentially increasing bandwidth due to the routers using different channels.</p><p>To achieve what I want, I think I need to use VLANs to isolate the traffic between the guest network and the main network, but I am not sure how to set this up. I have no previous experience with VLANs, but I&#039;d like to gain some. A slightly complicating factor is that between the two routers there is a switch, but this is a managed switch (Cisco SG-200-08) capable of handling VLANs.</p><p>Given that I have only one cable from the main router to the Cisco switch (to which I have other devices connected as well), I need the main OpenWrt router to be able to send both tagged and untagged (for other traffic) frames on the port which is connected to the Cisco switch. I understand that this should be possible, but could perhaps be a bit finicky to get working.</p><p>If I create a VLAN in OpenWrt, how do I connect a wireless interface to this VLAN? If we look at my current setup, which already has a virtual interface called guest, would I then create a bridge between this interface and the VLAN (e.g eth0.5, or whatever VLAN number I choose)?</p><p>I realize that this explanation is perhaps difficult to understand, but if anyone is willing to help, I could create a diagram showing more detailed what I want to achieve. If my current plan sounds stupid, then by all means let me know.&nbsp; :-)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p215991">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">valentin2208</div>
					<div class="post-datetime">
						29 Oct 2013, 09:45					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>You could try to configure wndr3700 to simple repeater mode. I don&#039;t know, which wireless adapter is in netgear routers (atheros or broadcom or smthing else), so try this link <a href="http://wiki.openwrt.org/?do=search&amp;id=wds">http://wiki.openwrt.org/?do=search&amp;id=wds</a> , maybe it will help. If it will work with vlan properly you won&#039;t need switch at all</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p215995">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">neryba</div>
					<div class="post-datetime">
						29 Oct 2013, 09:58					</div>
				</div>
				<div class="post-content content">
					<p>you need create one tagged port on both routers. on the second router disable services like DHCP, change device to different IP,<br />lan bridge network and wireless configuration will be same</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p215996">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">mroek</div>
					<div class="post-datetime">
						29 Oct 2013, 10:04					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>valentin2208 wrote:</cite><blockquote><p>Hello,</p><p>You could try to configure wndr3700 to simple repeater mode. I don&#039;t know, which wireless adapter is in netgear routers (atheros or broadcom or smthing else), so try this link <a href="http://wiki.openwrt.org/?do=search&amp;id=wds">http://wiki.openwrt.org/?do=search&amp;id=wds</a> , maybe it will help. If it will work with vlan properly you won&#039;t need switch at all</p></blockquote></div><p>The WNDR3700 is Atheros-based, and wirelessly repeating should work, but I think I want to do it wired if I can.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216003">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">mroek</div>
					<div class="post-datetime">
						29 Oct 2013, 10:49					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>neryba wrote:</cite><blockquote><p>you need create one tagged port on both routers. on the second router disable services like DHCP, change device to different IP,<br />lan bridge network and wireless configuration will be same</p></blockquote></div><p>Assuming that I have the virtual interface called &#039;guest&#039; on my main router:</p><div class="codebox"><pre><code>From: /etc/config/network
config interface &#039;guest&#039;
        option type &#039;bridge&#039;
        option proto &#039;static&#039;
        option ipaddr &#039;192.168.14.1&#039;
        option netmask &#039;255.255.255.0&#039;</code></pre></div><p>This interface bridges the two wireless guest networks:<br /></p><div class="codebox"><pre><code>From: /etc/config/wireless
config wifi-iface
        option device &#039;radio0&#039;
        option mode &#039;ap&#039;
        option ssid &#039;guest&#039;
        option encryption &#039;psk2&#039;
        option key &#039;xxx&#039;
        option wps_pushbutton &#039;0&#039;
        option network &#039;guest&#039;

config wifi-iface
        option device &#039;radio1&#039;
        option mode &#039;ap&#039;
        option ssid &#039;guest_5g&#039;
        option encryption &#039;psk2&#039;
        option key &#039;xxx&#039;
        option wps_pushbutton &#039;0&#039;
        option network &#039;guest&#039;</code></pre></div><p>There is also a firewall zone allowing traffic from network guest to wan/internet, and two additional traffic rules to allow the guest to access DHCP and DNS from the device itself.</p><p>This is how my current system is set up, and it works as expected. Guests are isolated, have their own IP range (192.168.14.x), and can access internet.</p><p>If I add a VLAN (number 2) to this router and sets it to tagged on the port (port 1 here) where the second router will reside, e.g:</p><div class="codebox"><pre><code>From: /etc/config/network

config switch_vlan
        option device &#039;rtl8366s&#039;
        option vlan &#039;1&#039;
        option ports &#039;0 1 2 3 5t&#039;

config switch_vlan
        option device &#039;rtl8366s&#039;
        option vlan &#039;2&#039;
        option ports &#039;1t 5t&#039;</code></pre></div><p>Would it then be correct to change the guest interface to:</p><div class="codebox"><pre><code>From: /etc/config/network
config interface &#039;guest&#039;
        option type &#039;bridge&#039;
        option proto &#039;static&#039;
        option ipaddr &#039;192.168.14.1&#039;
        option netmask &#039;255.255.255.0&#039;
        option ifname &#039;eth0.2&#039;</code></pre></div><p>...to allow traffic between the guest network and VLAN 2?</p><p>If so, should this setup also allow untagged traffic on the same port (port 1) for non-guest traffic? Remember, there is a switch on this port, and I need to pass normal traffic also.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216007">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">neryba</div>
					<div class="post-datetime">
						29 Oct 2013, 10:59					</div>
				</div>
				<div class="post-content content">
					<p>you right, but second router will have 192.168.14.2 for example<br />ping 192.168.14.1 from second router. If ping ok then, then network configuration works properly</p>											<p class="post-edited">(Last edited by <strong>neryba</strong> on 29 Oct 2013, 11:01)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216010">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">mroek</div>
					<div class="post-datetime">
						29 Oct 2013, 11:07					</div>
				</div>
				<div class="post-content content">
					<p>Ok, thanks. I&#039;ll have to wait for the new hardware to arrive, but now I have at least a basic idea of how to do this.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>