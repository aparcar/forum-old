<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Swap not being used?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 21 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p66894">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">loodp</div>
					<div class="post-datetime">
						15 Apr 2008, 04:39					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>I&#039;d like to add some swap space to improve performance on NFS transfers on my Wl500gP w/ USB storage (running Kamikaze 7.09).</p><p>I installed swap-utils, formatted a 1 GB pen drive to Linux-Swap, plugged it in, and ran &quot;swapon /dev/discs/disc1/part1&quot;. The drive does seems to be recognized as swap space:</p><div class="quotebox"><blockquote><p># free<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; total&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<strong>used</strong>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;free&nbsp; &nbsp; &nbsp; &nbsp;shared&nbsp; &nbsp; &nbsp; buffers<br />Mem:&nbsp; &nbsp; &nbsp; &nbsp; 30512&nbsp; &nbsp; &nbsp; &nbsp; 29796&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 716&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 536<br /><strong>Swap</strong>:&nbsp; &nbsp; &nbsp; &nbsp;990696&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<strong>0</strong>&nbsp; &nbsp; &nbsp; &nbsp;990620<br />Total:&nbsp; &nbsp; &nbsp; 1021208&nbsp; &nbsp; &nbsp; &nbsp; 29872&nbsp; &nbsp; &nbsp; &nbsp;991336</p></blockquote></div><p>But it seems the swap space isn&#039;t being used. The output of &quot;free&quot; shows mostly 0 usage, sometimes it goes up to 76. And that&#039;s while I&#039;m writing to my NFS export, and the RAM has all been filled up and rates dropped to about 1MB/sec. (Curiously, RAM stays 99% full even after the transaction has stopped, though I&#039;m not sure that has anything to do with swap).</p><p>I&#039;ve searched the forums, and found 3 people who are describing exactly the same problem: <a href="http://forum.openwrt.org/viewtopic.php?pid=40375#p40375">HERE</a> and <a href="http://forum.openwrt.org/viewtopic.php?pid=62907#p62907">HERE</a></p><p>Is swap working for anybody? I would appreciate any pointers..</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p69275">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">loodp</div>
					<div class="post-datetime">
						7 Jun 2008, 05:22					</div>
				</div>
				<div class="post-content content">
					<p>When transferring several large files in one move, I noticed that rates would drop to about 1MB/sec after transferring about 80 MB, but as soon as one file was done and transfer of the next one started, speed went back to 7-10 MB/sec again briefly. But on many occasions, transfers also stalled for about a minute after completing one file.</p><p>So... is this the kind of the behavior you would expect on an NFS server with only 32MB of physical RAM at its disposal, or could I be doing better here?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p69291">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">KanjiMonster</div>
					<div class="post-datetime">
						7 Jun 2008, 20:14					</div>
				</div>
				<div class="post-content content">
					<p>Kamikaze 7.09 is pretty old... .<br />I&#039;m using trunk with an 2.6.25 kernel on my Asus, and swap seems to be used (currently at 2,9 MB).</p>											<p class="post-edited">(Last edited by <strong>KanjiMonster</strong> on 7 Jun 2008, 20:15)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p69401">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">youth4ever</div>
					<div class="post-datetime">
						10 Jun 2008, 15:55					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>KanjiMonster wrote:</cite><blockquote><p>Kamikaze 7.09 is pretty old... .<br />I&#039;m using trunk with an 2.6.25 kernel on my Asus, and swap seems to be used (currently at 2,9 MB).</p></blockquote></div><p>yes, but the wireless DOESN&#039;T WORK with 2.6 kernels.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p69403">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">youth4ever</div>
					<div class="post-datetime">
						10 Jun 2008, 16:16					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>loodp wrote:</cite><blockquote><p>When transferring several large files in one move, I noticed that rates would drop to about 1MB/sec after transferring about 80 MB, but as soon as one file was done and transfer of the next one started, speed went back to 7-10 MB/sec again briefly. But on many occasions, transfers also stalled for about a minute after completing one file.</p><p>So... is this the kind of the behavior you would expect on an NFS server with only 32MB of physical RAM at its disposal, or could I be doing better here?</p></blockquote></div><p>Yes, this is a general problem of the NFS. Previously I worked in small company which had a NFS server. All the station were without harddisk. We booted from NFS. I saw that the transfers of the large files (as divX movies) from another storage server to this NFS server is 7 MB/s at the beginning (in a 100 Mb network) and begin to decrease to 1 MBs and rested until the completion of the process. All the RAM of my station was used, and the swap also. <br />The problem is that the linux system doesn&#039;t manage the swap partition well. In fact the SWAP purpose is not a RAM replacement. It&#039;s a helper. It&#039;s very slow to use as a RAM replacement. And when you copy large files (the RAM memory is fulled), the SWAP space&nbsp; in your case is used. When it&#039;s fulled (as in the case of LARGE files) the processor has to do more tasks than ever. The SWAP is used as a buffer space for the incoming (download) ,used for the temporary storage and used for the upcoming (upload) the information from it to the right partition of the external harddisk. It is doing many tasks at once. <br />And the processor doesn&#039;t work well with the SWAP, because the processor works with the RAM, which ram consults the software, which tells that there is a SWAP place as a RAM replacement (when the RAM is fulled with the other softwares ). So there are lots of operations which must be done when SWAP is used.<br />And SWAP is slow because it&#039;s physically on the harddisk, and doesn&#039;t communicate directly with the processor.</p><p>I tried to simplify my explanation for the sake of simplicity. I hope that I made my point.<br />I hope that this helps.</p><p>If you want more speed, I saw some RAM upgrades for the router. But I wouldn&#039;t recommend you.</p>											<p class="post-edited">(Last edited by <strong>youth4ever</strong> on 10 Jun 2008, 19:51)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p69429">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">KanjiMonster</div>
					<div class="post-datetime">
						11 Jun 2008, 11:04					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>youth4ever wrote:</cite><blockquote><p>yes, but the wireless DOESN&#039;T WORK with 2.6 kernels.</p></blockquote></div><p>But that wasn&#039;t the question, he asked about swap, not wireless. <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" />. <br />Besides, <em>broadcom</em> wireless does not work. One could always replace the minipci card for an e.g. atheros based one (I did).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p69452">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">yasha</div>
					<div class="post-datetime">
						11 Jun 2008, 17:38					</div>
				</div>
				<div class="post-content content">
					<p>I would suggest playing with the priority myself, setting it manually rather than the -1 or whatever it goes to by default depending on the times you&#039;ve run swapon for that reboot, I get better results setting the mmc swap partition I set up on my buffalo to 500 or better. &quot;-p 500&quot;</p><p>So you&#039;d need to alter the init.d script with the startup line if you have it set to come up with the fstab uci config entry. I have not messed with it extensively, but as I recall from the manual, it will accept up to a 1000 priority value, giving it the highest priority. As to the validity of what I&#039;ve observed, only those with further knowledge of what exactly it&#039;s doing can comment, for all I know the priority value may ONLY be for swap space, rather than having any impact on when it is called by the kernel as opposed to regular memory. But I&#039;m fairly sure I&#039;ve noticed it using far more the higher I set it before running down further on physical memory.</p>											<p class="post-edited">(Last edited by <strong>yasha</strong> on 11 Jun 2008, 17:47)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p69922">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">loodp</div>
					<div class="post-datetime">
						22 Jun 2008, 00:46					</div>
				</div>
				<div class="post-content content">
					<p>I tried setting the swap priority higher (swapon [partition] -p [value]), apparently you can use any value from 0 to 32000 something. Didn&#039;t change anything though. Swap usage didn&#039;t go beyond a couple of bytes. Isn&#039;t swap priority only relative? Like, if you&#039;ve got two swap partitions, to determine which one to use first?</p><p>What&#039;s curious also is the fact that physical memory is pretty much all used up all the time, no matter what I&#039;m doing currently. That&#039;s even when &quot;top&quot; doesn&#039;t show any process using more than 1,5% of memory.</p><p>I just ran another test with a 200MB file, and I got an average of 999kb/sec writing and 654kb/sec reading. That is just awful.</p><p>So.. am I wasting my time here? Is there any way I&#039;ll ever get decent NFS or SMB transfer speeds with only 32MB RAM on the router?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p69941">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">yasha</div>
					<div class="post-datetime">
						22 Jun 2008, 23:35					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;d have to say, ya, your probably wasting your time if your looking for swap being the solution for this issue. I get more than a few megs of swap used, but it&#039;s only AFTER all the memory is used for the most-part that I can tell. The priority only effects multiple swap partitions that are set after reading all the docs I could find. So it has no bearing on when it&#039;s actually called.</p><p>I&#039;ll have to test my throughput later, but my nslu2 seems to do fine with samba. I watch HD shows from it all the time without any issues. I did do the easy 133 to 266 cpu mod a long while back, but everything else is the same as yours.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p69943">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">loodp</div>
					<div class="post-datetime">
						23 Jun 2008, 01:24					</div>
				</div>
				<div class="post-content content">
					<p>I can&#039;t complain about streaming -- my NFS link is fast enough for that, thank god. But getting the files up there in the first place is a pain in the behind.</p><p>System load doesn&#039;t seem to be the issue, it hardly gets any higher than 0.4 during the transfer. But when I type &quot;free&quot;, tells me physical memory is used up 98% pretty much at all times, whether a transfer is going on at that point or not. So that&#039;s why I thought swap should kick in there.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>