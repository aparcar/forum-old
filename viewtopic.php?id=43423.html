<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> USB external storage with rootfs and swap</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 29 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p197720">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">Tayeb</div>
					<div class="post-datetime">
						9 Apr 2013, 01:45					</div>
				</div>
				<div class="post-content content">
					<p>I have just posted a tutorial on howto increase memory to TL-MR3420 router with recourse to external HDD. It is all found in my blog at:</p><p><a href="http://redacacia.me/2013/04/08/openwrt-usb-external-storage-with-rootfs-swap/">http://redacacia.me/2013/04/08/openwrt- … otfs-swap/</a></p><p>Effectively is based upon on documentation found at this site and elsewhere on the Web.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p197749">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">MBS</div>
					<div class="post-datetime">
						9 Apr 2013, 11:51					</div>
				</div>
				<div class="post-content content">
					<p>Please keep us updated about longterm reliability, especially with that usb swap partition. I have been using extroot on a WR1043ND during the last year and had my problems with sudden usb disconnects/resets out of the sudden or due to EMI. That normally occurred after 10-20 days.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p197751">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">Tayeb</div>
					<div class="post-datetime">
						9 Apr 2013, 11:58					</div>
				</div>
				<div class="post-content content">
					<p>Thank you for your input. Will do by posting here. </p><p>Note that is why also I have also added idle-time routine. </p><p>The original work was published by K.&nbsp; L. Seet as mentioned in acknowledgements based on documents at OpenWRT site.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p197820">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">MBS</div>
					<div class="post-datetime">
						9 Apr 2013, 22:12					</div>
				</div>
				<div class="post-content content">
					<p>I don&#039;t see a relationship between spinning down the hdd and usb disconnects/resets (with disconnect I don&#039;t mean to physically unplug the usb cable; it is the behavior of the controller/driver).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p197831">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">Tayeb</div>
					<div class="post-datetime">
						9 Apr 2013, 23:43					</div>
				</div>
				<div class="post-content content">
					<p>I thought you were saying about issues with Swap becoming error prone.&nbsp; In your case it seems something is happening. Where is the fault on HDD side or router&#039;s side of USB connection? I have read elsewhere issues with the USB port. To avoid problem with power supply - a common cause of USB ports misbehaving - I have in my setup with USB hub with power supply.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p197833">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">MBS</div>
					<div class="post-datetime">
						10 Apr 2013, 00:45					</div>
				</div>
				<div class="post-content content">
					<p>My setup was: Router &lt;--&gt; USB-Hub &lt;--&gt; SD Card Reader &lt;--&gt; SD Card<br />I used the hub bus powered, since all the usb components should draw less than 500 mA. And all worked quite well in over 99% of the time. It is just that due to the long uptime, you will catch some unlikely events, like the mentioned EMI issues (sometimes seen when connecting another device on the same power line).<br />To sum it up: I have already seen the behavior, when the overlayed root filesystem gets temporarily disconnected: it still stays mounted, since there is still activity/open files. As a result, /dev/sda1 (my extroot) is not released and during reenumeration the flash drive got named /dev/sdb1.<br />What I have not yet seen is the behavior, when swap suddenly disappears.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p197834">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">Tayeb</div>
					<div class="post-datetime">
						10 Apr 2013, 00:56					</div>
				</div>
				<div class="post-content content">
					<p>If I may disagree the issue seems some switching caused by overdriving your USB port. I suggest trying out a hub that is externally supplied. The spike you are mentioning may just be inducing such a switching effect.</p><p>Also I suggest reading &quot;The Ten Commandments of USB&quot;:</p><p> <a href="http://www.bb-elec.com/Learning-Center/All-White-Papers/USB/The-Ten-Commandments-of-USB.aspx">http://www.bb-elec.com/Learning-Center/ … f-USB.aspx</a></p><p>I draw your attention on assuming you can draw 500mA. I would not rule EMI but I would suggest it is a multiplying factor.</p>											<p class="post-edited">(Last edited by <strong>Tayeb</strong> on 10 Apr 2013, 01:34)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p198494">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">Tayeb</div>
					<div class="post-datetime">
						16 Apr 2013, 01:06					</div>
				</div>
				<div class="post-content content">
					<p>One thing that has occured to me is how do you connect the hub to usb port of your router, whether you have tried to use a good shielded usb cable that is not too long.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p198519">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">MBS</div>
					<div class="post-datetime">
						16 Apr 2013, 10:49					</div>
				</div>
				<div class="post-content content">
					<p>First I had a hub with a thin 5cm cable, until it more or less died after a couple of months of 24/7 operation. Now I use one with external cable of about 1 m length, with regular shield.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p198580">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">Tayeb</div>
					<div class="post-datetime">
						16 Apr 2013, 22:46					</div>
				</div>
				<div class="post-content content">
					<p>And is the problem overcome or you still face the same problem? Unshielded 5m cable was inviting trouble surely!</p>											<p class="post-edited">(Last edited by <strong>Tayeb</strong> on 16 Apr 2013, 22:48)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p198611">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">MBS</div>
					<div class="post-datetime">
						17 Apr 2013, 08:17					</div>
				</div>
				<div class="post-content content">
					<p>Still the same. Last time this happened after about 1500000 seconds uptime, dmesg just outputs &quot;usb disconnect&quot; and then the regular enumeration begins.<br />Btw. my first hub came with a builtin thin 5 centimeter cable, I never used 5 meter cable at all.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p198625">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">Tayeb</div>
					<div class="post-datetime">
						17 Apr 2013, 10:51					</div>
				</div>
				<div class="post-content content">
					<p>Has the problem persisted with the same frequency or has improved? I am asking this perhaps to help you out in determining how to overcome the problem, based on my experience with USB connections in PCs.</p>											<p class="post-edited">(Last edited by <strong>Tayeb</strong> on 17 Apr 2013, 10:53)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p198704">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">MBS</div>
					<div class="post-datetime">
						17 Apr 2013, 21:29					</div>
				</div>
				<div class="post-content content">
					<p>Hard to say, since it is almost a year since I changed to the new hub and I just used the old hub for 2 or 3 months.<br />So, the pattern I noticed is, that it does that &quot;usb disconnect&quot; every 10 to 15 days. Besides, EMI has not been an issue ever since I moved the device to another power outlet, with no other inductive devices close by.<br />For myself I came to the conclusion, that hotplug devices are not the best choice, if long term stability and reliability is of concern. So sooner or later I will move my storage part to a raspberry pi with SD or a low power x86 with SSD.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>