<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Limiting concurrent connections per port.</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 7 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p316117">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">iletujestkont2</div>
					<div class="post-datetime">
						22 Mar 2016, 15:51					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>I have an router WR1043ND v1 with only 32MB of RAM. It works mostly good but there is a bit of the problem with it. When I run qBittorrent and seed some torrents the number of active connections very often exceeds 6k even though I have limitem them to 500 in the app. I have SWAP but apparently (from what my brother tells me) he can&#039;t really play any online game because he can&#039;t connect to the servers. I&#039;m already using SQM. It&#039;s very visible when playing Tibia it takes sometimes 30-40 tries to just get in the game and still it sometimes losses connection. Same with TeamSpeak.</p><p>So I&#039;m looking for a way to limit a number of connections for qBittorrent. It runs on a specific port. I thought I could use iptables to put a limit on that port but I have no idea what to put in the config files.</p><p>Anyone willing to help me, please?<br />Thank you.</p>											<p class="post-edited">(Last edited by <strong>iletujestkont2</strong> on 22 Mar 2016, 15:53)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p316140">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">bolvan</div>
					<div class="post-datetime">
						22 Mar 2016, 18:32					</div>
				</div>
				<div class="post-content content">
					<p>SQM would solve the problem if router had enough cpu power for your connection speed.<br />what it is ?<br />Have you run &quot;top&quot; when system is highly loaded ?<br />If you see cpu exhausted then you have to reduce maximum rate in SQM configuration.<br />If it sounds bad to you then buy more powerful router or move gateway to a faster platform.<br />My experience tells that even quite powerful WNDR3800 with 650 mhz MIPS cpu can only do 60 mbit both ways with SQM enabled. It cant do 100/100. In such situation I used banana PI with its gigabit ethernet as VLAN router .</p>											<p class="post-edited">(Last edited by <strong>bolvan</strong> on 22 Mar 2016, 18:35)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p316171">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">metai</div>
					<div class="post-datetime">
						22 Mar 2016, 20:23					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>iletujestkont2 wrote:</cite><blockquote><p>When I run qBittorrent and seed some torrents the number of active connections very often exceeds 6k even though I have limitem them to 500 in the app.</p></blockquote></div><p>One problem -- if not the main problem -- is that you are running a torrent application on a very small CPU with very little memory. 500 active connections is already pushing it on a desktop CPU, your router&#039;s CPU may be very well be overburdened. Combined with SQM -- which is also quite CPU-heavy -- you might strain your system quite a bit too much.</p><p>And, no, I don&#039;t agree with bolvan, even a more powerful router will not help a lot. Ultimately, a router is not really well-suited to run heavy torrent applications. You might actually be better off using a separate machine for torrents and I assume, serving files. That&#039;s what NAS boxen are for and good at, after all.</p><p>Anyway, have you tried limiting the connections to something <em>much</em> less? Like 16 or 32 connections? Try a rather low number to see if the problems go away, and then &quot;feel&quot; your way to a higher number.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p316207">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">iletujestkont2</div>
					<div class="post-datetime">
						22 Mar 2016, 23:50					</div>
				</div>
				<div class="post-content content">
					<p>The P2P torrent client is not running on router. That would be suicide. No, the torrent client is running on the desktop with Windows. The app is set to 500 global connections but still in my router that is more then 6k of them. Almost all udp.</p><p>The CPU is not stressed. I&#039;m having a script that blinks one of the LED on my router accordingly to CPU load. It&#039;s blinking slow which means that there is no much load on CPU. I&#039;m running a 60Mb internet connection.</p><p>As soon as I run torrent client on my desktop my brother can&#039;t connect to any online game. Once the connection is established it&#039;s mostly fine, but sometimes it takes like 30 tries to connect. I&#039;m not sure what&#039;s wrong. I think it&#039;s because of too much connections on the router.</p>											<p class="post-edited">(Last edited by <strong>iletujestkont2</strong> on 22 Mar 2016, 23:55)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p316238">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">eas</div>
					<div class="post-datetime">
						23 Mar 2016, 05:09					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>iletujestkont2 wrote:</cite><blockquote><p>The P2P torrent client is not running on router. That would be suicide. No, the torrent client is running on the desktop with Windows. The app is set to 500 global connections but still in my router that is more then 6k of them. Almost all udp.</p><p>The CPU is not stressed. I&#039;m having a script that blinks one of the LED on my router accordingly to CPU load. It&#039;s blinking slow which means that there is no much load on CPU. I&#039;m running a 60Mb internet connection.</p></blockquote></div><p>How are you measuring load? %CPU idle, or load average # of tasks waiting for the CPU?</p><div class="quotebox"><blockquote><p>As soon as I run torrent client on my desktop my brother can&#039;t connect to any online game. Once the connection is established it&#039;s mostly fine, but sometimes it takes like 30 tries to connect. I&#039;m not sure what&#039;s wrong. I think it&#039;s because of too much connections on the router.</p></blockquote></div><p>Sounds like you might want to lower the timeouts on UDP connection tracking. Unfortunately, I don&#039;t know how to do it the OpenWRT way. It looks like you can specific a timeout for an ipset, but the details are beyond me right now.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p316246">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">bolvan</div>
					<div class="post-datetime">
						23 Mar 2016, 07:33					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m sure your device cant handle 60 mbits full duplex with SQM enabled.<br />It can do it one side with ~10-20 mbit other side.&nbsp; More will burn CPU.<br />check it with top, its far more reliable then &quot;blinking&quot;<br />When cpu is overloaded user processes die or almost die. It means no DNS, no DHCP, no WIFI.<br />When gamer connects he requests DNS. Check if DNS can be resolved quickly and does not wait 10 seconds before resolved. Compare ping times in idle and loaded states.</p>											<p class="post-edited">(Last edited by <strong>bolvan</strong> on 23 Mar 2016, 07:46)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p316288">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">iletujestkont2</div>
					<div class="post-datetime">
						23 Mar 2016, 14:41					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>bolvan wrote:</cite><blockquote><p>I&#039;m sure your device cant handle 60 mbits full duplex with SQM enabled.<br />It can do it one side with ~10-20 mbit other side.&nbsp; More will burn CPU.<br />check it with top, its far more reliable then &quot;blinking&quot;<br />When cpu is overloaded user processes die or almost die. It means no DNS, no DHCP, no WIFI.<br />When gamer connects he requests DNS. Check if DNS can be resolved quickly and does not wait 10 seconds before resolved. Compare ping times in idle and loaded states.</p></blockquote></div><p>I agree. Blinking is not very accurate. I changed SQM settings for download to around 100Mb/s but still got around 40Mb from 60Mb when only downloading ubuntu ISOs from FTP(??). Even with speedtest and SQM enabled I can&#039;t beat 40Mb. From top, CPU usage for [ksoftirqd/0] was around 60% with load around 0.72-1.0 with SQM enabled. CPU idle was 5-7%. Ping hasn&#039;t changed though. Still lower than 60ms for google.com. That happens only on WiFi connection.</p><p>On ethernet I have all 60Mb with SQM enabled and CPU usage around 10% for [ksoftirqd/0] and load around 0.20. There was a 12% CPU idle.</p><p>I&#039;m not an expert but your saying that CPU in my router is not fast enough to handle 60Mb connection (through cable internet connection) with SQM enabled. So I should buy a new router then? Not happy about that. Still I don&#039;t understand how this is affecting Tibia and other games because even with SQM disabled I have connection issues.</p>											<p class="post-edited">(Last edited by <strong>iletujestkont2</strong> on 23 Mar 2016, 14:45)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p316290">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">iletujestkont2</div>
					<div class="post-datetime">
						23 Mar 2016, 15:02					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>iletujestkont2 wrote:</cite><blockquote><p>Sounds like you might want to lower the timeouts on UDP connection tracking. Unfortunately, I don&#039;t know how to do it the OpenWRT way. It looks like you can specific a timeout for an ipset, but the details are beyond me right now.</p></blockquote></div><p>I know how to do it. <br />How low should I get? I think that the default value is around 180.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p316294">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						23 Mar 2016, 15:23					</div>
				</div>
				<div class="post-content content">
					<p>I doubt if the large UDP table could cause any slowdowns, as most of the entries are just there waiting for timeout.</p><p>SQM and other QoS tools are CPU-heavy, like bolvan already said.</p><p>I suggest that you decrease the number of concurrent connections somewhat. SQM works per-stream, so reducing the number of stream from 500 to 400 (or 300) decreases the CPU significantly. You can surely adjust that setting in your bittorrent tool. That is the correct place for that, not iptables.</p><p>You need to make sure that you set the target speed limits low enough in the SQM settings. It is especially important that there is enough free bandwidth on the upload side, as the typical reason for connection problems is delays with the sent ack packets etc. that are needed for the tcp/ip protocols to work. SQM helps greatly to congestion, but it (and other QoS tools) do need some surplus bandwidth above the target set in the settings.</p><p>For reference: <br />My WNDR3800 (CPU at 680 MHz) can take ~80-85 Mb/s download+upload traffic. If you have 40+40, that would be the same. (and your CPU is apparently only 400 MHz, so 80 Mb/s might be too much for you)</p><p>I have 100/12 Mb/s fiber line and use 85000/10000 as SQM speed settings. Additionally, I have limited speed in my torrent client to 80000/9000, just to ensure that the torrent client does not hog all the bandwidth.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p316305">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">iletujestkont2</div>
					<div class="post-datetime">
						23 Mar 2016, 16:33					</div>
				</div>
				<div class="post-content content">
					<p>I have 60/3 (i guess) cable line internet connection and I have set SQM to 95% of that. Works mostly great.<br />I&#039;m thinking about switching to 120/12 so I would need a better router than WNDR3800. Any suggestions?</p><p>Also from what I have already told you I assume that SQM takes more more heavy hit on CPU when using it on WiFi? On my set up I couldn&#039;t get more than 40Mb (of 60 available) when using WiFi.</p><p>Still non on you told me why online gaming is so problematic. I wouldn&#039;t want to buy a new router only to found out that the problem still exists.</p>											<p class="post-edited">(Last edited by <strong>iletujestkont2</strong> on 23 Mar 2016, 16:44)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p316311">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						23 Mar 2016, 16:47					</div>
				</div>
				<div class="post-content content">
					<p>EDIT: I lift this bittorrent observation to top, as I see this&nbsp; as a major issue for you. </p><div class="quotebox"><cite>iletujestkont2 wrote:</cite><blockquote><p>I have 60/3 (i guess) cable line internet connection and I have set SQM to 95% of that.</p></blockquote></div><p>If your really only have 3 Mb/s upload speed, 500 simultaneous bittorrent connection is way too much. You waste too much of the upload bandwidth to protocol handling instead of actual payload data. You should reduce connection to some 150 or even lower. Each connection consumes some bandwidth just for packet acknowledgements etc. Currently you waste a lot of bandwidth.<br />---</p><p>Wired vs. wifi may play surprisingly in the QoS things.</p><p>You may need to try the various available alternative SQM options (scripts &quot;simple&quot;, &quot;hfcs_lite&quot; etc.).</p><p>I have posted my own results to the SQM development discussion at <a href="https://github.com/tohojo/sqm-scripts/pull/26#issuecomment-185833432">https://github.com/tohojo/sqm-scripts/p … -185833432</a><br /></p><div class="quotebox"><blockquote><p>I tested up-to-date Openwrt trunk with kernel 4.1.16 and the default SQM 1.0.7 with simple, layer_cake, hfsc_lite and hfsc_litest scripts with intentionally limited SQM settings 85000/10000 (that I use normally), 110000/15000 (that should exceed my connection and totally burden the router&#039;s CPU), as well as 110000/15000 using Wifi. All tests were run within an hour, so the general conditions are roughly similar.<br />I have maybe really good ISP connection with fiber coming to the house and a &quot;CAT5e wired home&quot;. The latency from my router to the national TV company&#039;s site is only about 2 ms, so the results are practically only about the computing burden of the different strategies and the &quot;default&quot; latency from Finland to Toke&#039;s server in the neighbouring Sweden...<br /></p><div class="codebox"><pre><code>             wired 85/10             wired 110/15         Wifi 110/15
           Download/Up/Latency     Download/Up/Latency    Download/Up/Latency
Simple       19.5/2.1/18.5           21.2/2.7/19          11.0/3.0/21
Layer_cake   20.2/2.1/18.7           24.0/2.7/50          20.0/2.8/37
hfsc_lite    20.7/2.2/19.5           25.0/2.7/50          19.0/2.9/35
hfsc_litest  20.7/2.2/18.7           25.0/2.7/52          18.0/2.8/35</code></pre></div><p>Check summary.png for an overview ;-)<br /><a href="https://www.dropbox.com/s/dqs01mxrrgepy8j/Summary.png?dl=0preview=Summary.png">https://www.dropbox.com/s/dqs01mxrrgepy … ummary.png</a><br />...<br />With wired 85/10 the experience was almost identical with all four qdisc strategies in SQM. Approx.&nbsp; 20 Mbit/s download / 2.1 Mbit/s upload and 19 ms latency shown in the flent summary graph.</p><p>With wired 110/15 there was more difference. Interestingly &quot;simple&quot; kept latency at 20 ms, while with the other 3 strategies latency jumped to 50 ms after ~20 seconds. (Might be a flent peculiarity, but still mentioning it.) &quot;simple&quot; kept low latency at 19 ms and 21 Mbit/s download, while the other 3 strategies had 50 ms latency while having 24-25 Mbit/s download per class.</p><p>But with Wifi in use from PC to router with 110/15 limits, &quot;simple&quot; lost its download speed. Latency was still low, but download speed was really low, just half of the normal. Interestingly, all four SQM strategies showed higher upload but lower download speed than with wired. (cake and hfs_lite(st) had also a lower latency than with wired. Strange.)</p></blockquote></div><p>(&quot;flent&quot; network measurement tool reports the overview as average of the 4 different traffic classes, so the total bandwidth was 4x the figures in the above table)</p><p>At least on my setup, the download speed using wifi and SQM &quot;simple&quot; was half of that what I could achieve with hfsc_lite+wifi, or simple+wired.<br />(cake is experimental, and not available in general builds. disregard that)</p>											<p class="post-edited">(Last edited by <strong>hnyman</strong> on 23 Mar 2016, 21:33)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p316317">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">bolvan</div>
					<div class="post-datetime">
						23 Mar 2016, 17:21					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>iletujestkont2 wrote:</cite><blockquote><p>Also from what I have already told you I assume that SQM takes more more heavy hit on CPU when using it on WiFi?</p></blockquote></div><p>SQM knows nothing about wifi. It works only on outbound (WAN) interface.<br />But yes, wifi processing takes more CPU than ethernet processing. And its more sensitive to availability of free CPU resources. If CPU is overloaded wifi can die or work slowly/unstable. Together with SQM it can easily overload CPU.<br />Thats why I connected banana pi to WNDR3800. WNDR3800 acts as wifi API and provides switch, banana acts as 2xVLAN gateway. I no more concerned about CPU because banana has 2 powerful ARM cores and 100/100 with HTB+fq_codel takes only 30-40% of them. And WNDR&#039;s CPU is freed for wifi. It does 110 mbits via wifi - tested with iperf. Although I do not recommend this solution to everyone because of annoying bugs in switch hardware or possibly driver, idea here is to have separate gateway device at least 2x more powerful than required.</p>											<p class="post-edited">(Last edited by <strong>bolvan</strong> on 23 Mar 2016, 17:29)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p316318">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">iletujestkont2</div>
					<div class="post-datetime">
						23 Mar 2016, 17:29					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>bolvan wrote:</cite><blockquote><div class="quotebox"><cite>iletujestkont2 wrote:</cite><blockquote><p>Also from what I have already told you I assume that SQM takes more more heavy hit on CPU when using it on WiFi?</p></blockquote></div><p>SQM knows nothing about wifi. It works only on outbound (WAN) interface.<br />But yes, wifi processing takes more CPU than ethernet processing. And its more sensitive to availability of free CPU resources. If CPU is overloaded wifi can die or work slowly/unstable. Together with SQM it can easily overload CPU.<br />Thats why I connected banana pi to WNDR3800. WNDR3800 acts as wifi API and provides switch, banana acts as 2xVLAN gateway. I no more concerned about CPU because banana has 2 powerful ARM cores and 100/100 with HTB+fq_codel takes only 30-40% of them. And WNDR&#039;s CPU is freed for wifi. It does 110 mbits via wifi - tested with iperf.</p></blockquote></div><p>Can you tell me more about this setup? Like how did you configured it or which version of banana are you using?<br />I would be interested in this solution.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p316322">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">bolvan</div>
					<div class="post-datetime">
						23 Mar 2016, 17:34					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>iletujestkont2 wrote:</cite><blockquote><p>Can you tell me more about this setup? Like how did you configured it or which version of banana are you using?<br />I would be interested in this solution.</p></blockquote></div><p>VLAN 1 - LAN<br />VLAN 2 - WAN</p><p>Inet &lt;&gt; Switch port 3. untagged, VLAN 2<br />banana &lt;&gt; Switch port 2. tagged VLAN 1,2<br />LAN &lt;&gt; Switch ports 0,1. utagged VLAN 1<br />WNDR&#039;s CPU &lt;&gt; Switch port 5. utagged VLAN 1</p><p>Banana has eth0.1 bound to its &quot;LAN&quot; and eth0.2 bound to its &quot;WAN&quot;.<br />WNDR only has LAN, WAN is disabled. its configured as bridged AP without NAT, DHCP, DNS</p><p>But as I added before, I do not recomend everyone this solution because of : <a href="https://dev.openwrt.org/ticket/22024">https://dev.openwrt.org/ticket/22024</a><br />I had to write script workaround to avoid this problem.<br />Better buy something with 2 network cards onboard. There are such devices.<br />And never rely on USB ethernet, its bad way.</p>											<p class="post-edited">(Last edited by <strong>bolvan</strong> on 23 Mar 2016, 17:36)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p316323">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">iletujestkont2</div>
					<div class="post-datetime">
						23 Mar 2016, 17:45					</div>
				</div>
				<div class="post-content content">
					<p>So it&#039;s not a working solution?<br />Like make it work and forget about it?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p316326">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">bolvan</div>
					<div class="post-datetime">
						23 Mar 2016, 17:49					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>iletujestkont2 wrote:</cite><blockquote><p>So it&#039;s not a working solution?<br />Like make it work and forget about it?</p></blockquote></div><p>Its working but requires some bug-avoiding techniques that make it look not so perfect as desired.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p316346">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">iletujestkont2</div>
					<div class="post-datetime">
						23 Mar 2016, 20:10					</div>
				</div>
				<div class="post-content content">
					<p>Then what about WR1043ND v2 or v3 with 720Mhz CPU and 64MB of RAM?<br />Would it suffice for 120/12Mb connection?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p316360">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">iletujestkont2</div>
					<div class="post-datetime">
						23 Mar 2016, 21:22					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>hnyman wrote:</cite><blockquote><p>At least on my setup, the download speed using wifi and SQM &quot;simple&quot; was half of that what I could achieve with hfsc_lite+wired, or simple+wired.<br />(cake is experimental, and not available in general builds. disregard that)</p></blockquote></div><p>You&#039;re right. I was able to get full internet speed on WiFi with SQM as hfsc_lite.qos with fq_codel.<br />The CPU though was under heavy load. 0-3% idle time. Pings where not badly affected. I think I will stay with this configuration. Thank you for point it out.</p><p>Is there some significant difference between hfsc_lite.qos and simple.qos?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p316365">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						23 Mar 2016, 21:37					</div>
				</div>
				<div class="post-content content">
					<p>Great that it worked for you.<br /></p><div class="quotebox"><cite>iletujestkont2 wrote:</cite><blockquote><p>Is there some significant difference between hfsc_lite.qos and simple.qos?</p></blockquote></div><p>Quite a lot. </p><p>To summarize, SQM is an upper-level framework and several alternative low-level filters (=&quot;qdisc&quot;) can be used. Both scripts define traffic classification rules using several qdiscs on top of each other. &quot;simple&quot; uses htb+fq_codel, while &quot;hfsc_lite&quot; uses hfsc+fq_codel. They have different characteristics and apparently also quite different CPU requirements.</p><p>This goes deeply technical, but you might just quickly look at the sources to get an understanding what I mean.<br />Link to simple.qos source: <a href="https://github.com/tohojo/sqm-scripts/blob/master/src/simple.qos">https://github.com/tohojo/sqm-scripts/b … simple.qos</a><br />Link to hfsc_lite.qos source: <a href="https://github.com/tohojo/sqm-scripts/blob/master/src/hfsc_lite.qos">https://github.com/tohojo/sqm-scripts/b … c_lite.qos</a></p>											<p class="post-edited">(Last edited by <strong>hnyman</strong> on 23 Mar 2016, 21:42)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p316366">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">iletujestkont2</div>
					<div class="post-datetime">
						23 Mar 2016, 21:39					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>hnyman wrote:</cite><blockquote><p>EDIT: I lift this bittorrent observation to top, as I see this&nbsp; as a major issue for you. </p><div class="quotebox"><cite>iletujestkont2 wrote:</cite><blockquote><p>I have 60/3 (i guess) cable line internet connection and I have set SQM to 95% of that.</p></blockquote></div><p>If your really only have 3 Mb/s upload speed, 500 simultaneous bittorrent connection is way too much. You waste too much of the upload bandwidth to protocol handling instead of actual payload data. You should reduce connection to some 150 or even lower. Each connection consumes some bandwidth just for packet acknowledgements etc. Currently you waste a lot of bandwidth.</p></blockquote></div><p>I&#039;m using qBittorrent with those settings:<br />Global maximum number of connections 500<br />Maximum number of connections per torrent: 100<br />Global maximum number of upload slots: 8<br />Maximum number of upload slots per torrent: 4</p><p>Are you suggesting I should be changing them? The are the default settings. And yes P2P is a major issue for me because my brother is bothering me about his stupid games.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p316370">
				<div class="post-metadata">
					<div class="post-num">Post #21</div>
					<div class="post-author">iletujestkont2</div>
					<div class="post-datetime">
						23 Mar 2016, 21:42					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>hnyman wrote:</cite><blockquote><div class="quotebox"><cite>iletujestkont2 wrote:</cite><blockquote><p>Is there some significant difference between hfsc_lite.qos and simple.qos?</p></blockquote></div><p>Quite a lot. </p><p>To summarize, SQM is an upper-level framework and several alternative low-level filters (=&quot;qdisc&quot;) can be used. &quot;simple&quot; uses htb + fq_codel, while hfsc_lite uses hfsc+fq_codel. They have different characteristics and apparently also quite different CPU requirements.</p><p>Great that it worked for you.</p></blockquote></div><p>I think I still switch back to simple.qos when I change my router to more powerful unit. I think there is a reason why simple.qos is the default one. For now hfsc_lite.qos will do.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p316375">
				<div class="post-metadata">
					<div class="post-num">Post #22</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						23 Mar 2016, 21:52					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>iletujestkont2 wrote:</cite><blockquote><p>I&#039;m using qBittorrent with those settings:<br />Global maximum number of connections 500<br />Maximum number of connections per torrent: 100<br />Global maximum number of upload slots: 8<br />Maximum number of upload slots per torrent: 4</p><p>Are you suggesting I should be changing them? The are the default settings. And yes P2P is a major issue for me because my brother is bothering me about his stupid games.</p></blockquote></div><p>Yes. I do suggest that.<br />With so low upload speed, you should have maybe max. 150-200 connections (global maximum of connections) at the same time. And probably no more than ~6 active torrents.</p><p>You could additionally check if your torrent client enables limiting upload speed. If yes, set the max speed a bit lower than the upload speed settings in SQM.</p><p>This link is not about your torrent client, but is a rather good summary: <a href="https://wiki.vuze.com/w/Good_settings">https://wiki.vuze.com/w/Good_settings</a><br />There are also several torrent-related calculators in the net that you could use to calculate &quot;optimal settings&quot;. (but they may give rather varying answers ;-)</p>											<p class="post-edited">(Last edited by <strong>hnyman</strong> on 23 Mar 2016, 22:11)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p316379">
				<div class="post-metadata">
					<div class="post-num">Post #23</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						23 Mar 2016, 22:13					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>iletujestkont2 wrote:</cite><blockquote><p>I think I still switch back to simple.qos when I change my router to more powerful unit. I think there is a reason why simple.qos is the default one. For now hfsc_lite.qos will do.</p></blockquote></div><p>hfsc_lite was actually introduced to SQM only a few weeks ago just to improve performance on low-powered routers. You might read the reasoning in the first message here:<br /><a href="https://github.com/tohojo/sqm-scripts/pull/26">https://github.com/tohojo/sqm-scripts/pull/26</a></p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>