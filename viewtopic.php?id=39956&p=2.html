<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> ar9331&#039;s usb stability issue - [SOLVED]</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 23 Mar 2017 and 6 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 2 of 13</div><nav><ul><li><a href="viewtopic.php%3Fid=39956&amp;p=1.html">1</a></li><li class="pagination-current"><span>2</span></li><li><a href="viewtopic.php%3Fid=39956&amp;p=3.html">3</a></li><li><a href="viewtopic.php%3Fid=39956&amp;p=4.html">4</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39956&amp;p=13.html">13</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p182260">
				<div class="post-metadata">
					<div class="post-num">Post #26</div>
					<div class="post-author">lsoltero</div>
					<div class="post-datetime">
						3 Nov 2012, 20:08					</div>
				</div>
				<div class="post-content content">
					<p>Hello All,</p><p>so i just received two more TP-MR3040 and loaded AA on them.&nbsp; And... the very first one out of the box suffers the USB issues that the AR9331 based systems are seeing.</p><p>So the hardware TP-Link hardware has the same issues as the Alfa Hornet.</p><p>As stated previously TP-Link must have a software driver fix for this or their 3G routes would not work.&nbsp; The question is... is there anyone in the community that is familiar enough with the USB driver code to be able to port the fix from the TP link sources to OpenWRT.</p><p>I would be really nice to come to resolution on this issue especially since it seems to be manufacturer independent.</p><p>--luis</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p182266">
				<div class="post-metadata">
					<div class="post-num">Post #27</div>
					<div class="post-author">Squonk</div>
					<div class="post-datetime">
						3 Nov 2012, 21:22					</div>
				</div>
				<div class="post-content content">
					<p>@luis: What would be interesting is to make sure that the stock TP-LINK firmware does actually work on a router that has the problem... Is it possible for you to check that?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p182280">
				<div class="post-metadata">
					<div class="post-num">Post #28</div>
					<div class="post-author">lsoltero</div>
					<div class="post-datetime">
						4 Nov 2012, 00:12					</div>
				</div>
				<div class="post-content content">
					<p>its going to take a bit to do this.&nbsp; I have to get my verizon dongle back from one of our developers so that I can test data through the dongle.&nbsp; </p><p>--luis</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p182283">
				<div class="post-metadata">
					<div class="post-num">Post #29</div>
					<div class="post-author">Squonk</div>
					<div class="post-datetime">
						4 Nov 2012, 01:25					</div>
				</div>
				<div class="post-content content">
					<p>On my side, I compared the TP-LINK mips-linux-2.6.31 kernel sources to the corresponding vanilla kernel.org linux-2.6.31 sources using the wonderful &quot;meld&quot; compare utility under Ubuntu.</p><p>I tried that instead of comparing to the linux-3.3.8 used in the AA branch, as sources have changed too much since then, making any comparison very difficult.</p><p>I did found a few changed made by TP-LINK:<br /></p><ul><li><p>an embedded control of the system LED that blinks when a packet is received, not the right way to do that: it is perform by a separate module in OpenWrt</p></li><li><p>an overflow control on the packet size read from the endpoint descriptor: this has been integrated into the mainstream kernel since then, but I tried anyway, I still have the bug <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> </p></li><li><p>added enforcing host mode upon ehci_init(), and reset both the HOST and PHY upon ehci_init() and ehci_probe()<br />. This is located in &quot;drivers/usb/host/ehci-ath.c&quot;, I don&#039;t see how this could be related to our bug</p></li><li><p>in the same file, there are some provisions for getting the EHCI capabilities and operation register, that seems taken care of completely differently in newer kernel, so it looks like it is not necessary any more</p></li></ul><p>Unfortunately, and with some confidence, I can say that I don&#039;t see any obvious &quot;fix&quot; for any hardware USB bug in the kernel sources provided by TP-LINK, but I am not an USB expert...</p><p>So, if you have a mean to reproduce the bug with both the original TP-LINK firmware and the OpenWrt one, this is worth a try... Obviously, you should get the same problem.</p><p>I can&#039;t do it myself, as I have this problem when connecting an Arduino board spitting debug info, so I can&#039;t do the same thing with the original firmware.</p>											<p class="post-edited">(Last edited by <strong>Squonk</strong> on 4 Nov 2012, 01:26)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p182367">
				<div class="post-metadata">
					<div class="post-num">Post #30</div>
					<div class="post-author">lsoltero</div>
					<div class="post-datetime">
						4 Nov 2012, 23:12					</div>
				</div>
				<div class="post-content content">
					<p>thanks for that...</p><p>the tp-link firmware is quite restrictive. its obviously designed as a 3G appliance.&nbsp; &nbsp;There is no way to telnet or ssh to the unit.&nbsp; &nbsp;I doubt they have minicom or cu or other terminal emulator on the system.&nbsp; What i can try is soldering a connection to the serial port and then creating a custom ppp script to test with our device.&nbsp; </p><p>Give me a few hours... let me see what I can come up with.</p><p>One thought i in the mean time is that tp-link sources on their website are not up to date.&nbsp; I notice the date is a bout year old on the tar file.&nbsp; I wonder if its possible that a fix exists but has not been published.</p><br /><p>--luis</p>											<p class="post-edited">(Last edited by <strong>lsoltero</strong> on 4 Nov 2012, 23:18)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p182370">
				<div class="post-metadata">
					<div class="post-num">Post #31</div>
					<div class="post-author">Squonk</div>
					<div class="post-datetime">
						4 Nov 2012, 23:35					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>lsoltero wrote:</cite><blockquote><p>the tp-link firmware is quite restrictive. its obviously designed as a 3G appliance.&nbsp; &nbsp;There is no way to telnet or ssh to the unit.&nbsp; &nbsp;I doubt they have minicom or cu or other terminal emulator on the system.&nbsp; What i can try is soldering a connection to the serial port and then creating a custom ppp script to test with our device.</p></blockquote></div><p>Good idea! Maybe &quot;cat&quot; could be helpful?</p><div class="quotebox"><cite>lsoltero wrote:</cite><blockquote><p>One thought i in the mean time is that tp-link sources on their website are not up to date.&nbsp; I notice the date is a bout year old on the tar file.&nbsp; I wonder if its possible that a fix exists but has not been published.</p></blockquote></div><p>That is quite a possibility!</p><p>But besides the device/host mode switching capability, the USB device is just standard EHCI.</p><p>I found this comment in the file &quot;drivers/usb/host/ehci-ath.c&quot;:</p><div class="codebox"><pre><code>    /* EHCI Register offset 0x100 - Info from ChipIdea */</code></pre></div><p>Wikipedia tells us the truth: <a href="http://en.wikipedia.org/wiki/Chipidea">http://en.wikipedia.org/wiki/Chipidea</a></p><p>So ChipIdea was the designer of the USB device IP block within the AR9331 SoC, and was acquired by Synopsys in 2009.</p><p>Maybe someone from ChipIdea/Synopsys is looking at this thread?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p182371">
				<div class="post-metadata">
					<div class="post-num">Post #32</div>
					<div class="post-author">lsoltero</div>
					<div class="post-datetime">
						4 Nov 2012, 23:37					</div>
				</div>
				<div class="post-content content">
					<p>question:</p><p>which sources did you look at?&nbsp; The ones for the MR3040? or the ones for your router?&nbsp; the reason i ask is that as far as I can tell the 3040 (and the chinese version) are routers that tp link advertises for 3G use.&nbsp; It has a publication date as recent as sept 6. 2012.<br /><a href="http://www.tp-link.com/en/support/download/?model=TL-MR3040&amp;version=V1">http://www.tp-link.com/en/support/downl … version=V1</a></p><p>--luis</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p182374">
				<div class="post-metadata">
					<div class="post-num">Post #33</div>
					<div class="post-author">nebbia88</div>
					<div class="post-datetime">
						4 Nov 2012, 23:52					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>lsoltero wrote:</cite><blockquote><p>the tp-link firmware is quite restrictive. its obviously designed as a 3G appliance.&nbsp; &nbsp;There is no way to telnet or ssh to the unit.&nbsp; &nbsp;I doubt they have minicom or cu or other terminal emulator on the system.</p></blockquote></div><p> <a href="https://forum.openwrt.org/viewtopic.php?pid=181589#p181589">https://forum.openwrt.org/viewtopic.php … 89#p181589</a> </p><p>could be useful?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p182378">
				<div class="post-metadata">
					<div class="post-num">Post #34</div>
					<div class="post-author">Squonk</div>
					<div class="post-datetime">
						5 Nov 2012, 01:05					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>lsoltero wrote:</cite><blockquote><p>question:</p><p>which sources did you look at?&nbsp; The ones for the MR3040? or the ones for your router?&nbsp; the reason i ask is that as far as I can tell the 3040 (and the chinese version) are routers that tp link advertises for 3G use.&nbsp; It has a publication date as recent as sept 6. 2012.<br /><a href="http://www.tp-link.com/en/support/download/?model=TL-MR3040&amp;version=V1">http://www.tp-link.com/en/support/downl … version=V1</a></p><p>--luis</p></blockquote></div><p>My router is a TP-Link TL-WR703N, and as it is not for export, it is not on the main TP-Link site or does not appear in the GPL section.</p><p>But it does appear in the Chinese TP-Link site with a download section (<a href="http://www.tp-link.com.cn/pages/product-detail.asp?d=225&amp;t=4">http://www.tp-link.com.cn/pages/product … 25&amp;t=4</a>), but I have not found any GPL stuff at all in the Chinese site <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><p>So, I was looking at the latest (and only) GPL sources for the TL-MR3020/MR3040/MR3220, which fortunately also apply to TL-WR703N &quot;3G&quot; routers from TP-LINK, from:<br /><a href="http://www.tp-link.com/en/support/gpl/?categoryid=547">http://www.tp-link.com/en/support/gpl/?categoryid=547</a></p><p>If you take a quick look at the code in the common downloadable &quot;150Router.tar&quot; file for all these routers, you clearly see that there is a provision for my TL-WR703N router&nbsp; too.</p><p>However, the &quot;150Router.tar&quot; file looks much older than the new firmwares, so it may not contain all the latest patches.</p>											<p class="post-edited">(Last edited by <strong>Squonk</strong> on 5 Nov 2012, 01:14)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p182381">
				<div class="post-metadata">
					<div class="post-num">Post #35</div>
					<div class="post-author">Squonk</div>
					<div class="post-datetime">
						5 Nov 2012, 01:11					</div>
				</div>
				<div class="post-content content">
					<p>@nebbia88: Thanks, now I know how to login into the stock firmware!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p182382">
				<div class="post-metadata">
					<div class="post-num">Post #36</div>
					<div class="post-author">lsoltero</div>
					<div class="post-datetime">
						5 Nov 2012, 02:21					</div>
				</div>
				<div class="post-content content">
					<p>hello all,</p><p>i am connected to the serial port and now running the native firmware on the mr3040.&nbsp; &nbsp;The console is password protected.&nbsp; Anyway have any ideas what the username and password might be?&nbsp; I followed the link @nebbia88 and although this does allow me to access the shell the uname: osteam and password: 5up do not work for this router.</p><p>here is a listing of the console mesgs on boot up.</p><p>U-Boot 1.1.4 (Mar 28 2012 - 17:31:23)</p><p>AP121 (ar9330) U-boot</p><p>DRAM:&nbsp; 32 MB<br />led turning on for 1s...<br />id read 0x100000ff<br />flash size 4194304, sector count = 64<br />Flash:&nbsp; 4 MB<br />Using default environment</p><p>In:&nbsp; &nbsp; serial<br />Out:&nbsp; &nbsp;serial<br />Err:&nbsp; &nbsp;serial<br />Net:&nbsp; &nbsp;ag7240_enet_initialize...<br />No valid address in Flash. Using fixed address<br />No valid address in Flash. Using fixed address<br />: cfg1 0x5 cfg2 0x7114<br />eth0: 00:03:7f:09:0b:ad<br />ag7240_phy_setup <br />eth0 up<br />: cfg1 0xf cfg2 0x7214<br />eth1: 00:03:7f:09:0b:ad<br />athrs26_reg_init_lan<br />ATHRS26: resetting s26<br />ATHRS26: s26 reset done<br />ag7240_phy_setup <br />eth1 up<br />eth0, eth1<br />Autobooting in 1 seconds<br />## Booting image at 9f020000 ...<br />&nbsp; &nbsp;Uncompressing Kernel Image ... OK</p><p>Starting kernel ...</p><p>Booting AR9330(Hornet)...<br />Linux version 2.6.31--LSDK-9.2.0.312 (root@localhost.localdomain) (gcc version 4.3.3 (GCC) ) #22 Wed Aug 22 11:18:12 CST 2012<br />flash_size passed from bootloader = 4<br />CPU revision is: 00019374 (MIPS 24Kc)<br />Determined physical RAM map:<br /> memory: 02000000 @ 00000000 (usable)<br />User-defined physical RAM map:<br /> memory: 02000000 @ 00000000 (usable)<br />Zone PFN ranges:<br />&nbsp; Normal&nbsp; &nbsp;0x00000000 -&gt; 0x00002000<br />Movable zone start PFN for each node<br />early_node_map[1] active PFN ranges<br />&nbsp; &nbsp; 0: 0x00000000 -&gt; 0x00002000<br />Built 1 zonelists in Zone order, mobility grouping on.&nbsp; Total pages: 8128<br />Kernel command line: console=ttyS0,115200 root=31:02 rootfstype=squashfs init=/sbin/init mtdparts=ar7240-nor0:128k(u-boot),1024k(kernel),2816(rootfs),64k(config),64k(ART) mem=32M<br />PID hash table entries: 128 (order: 7, 512 bytes)<br />Dentry cache hash table entries: 4096 (order: 2, 16384 bytes)<br />Inode-cache hash table entries: 2048 (order: 1, 8192 bytes)<br />Primary instruction cache 64kB, VIPT, 4-way, linesize 32 bytes.<br />Primary data cache 32kB, 4-way, VIPT, cache aliases, linesize 32 bytes<br />Writing ErrCtl register=00000000<br />Readback ErrCtl register=00000000<br />Memory: 29876k/32768k available (1884k kernel code, 2892k reserved, 521k data, 116k init, 0k highmem)<br />Hierarchical RCU implementation.<br />NR_IRQS:128<br />plat_time_init: plat time init done<br />Calibrating delay loop... 266.24 BogoMIPS (lpj=532480)<br />Mount-cache hash table entries: 512<br />NET: Registered protocol family 16<br />===== ar7240_platform_init: 0<br />bio: create slab &lt;bio-0&gt; at 0<br />SCSI subsystem initialized<br />usbcore: registered new interface driver usbfs<br />usbcore: registered new interface driver hub<br />usbcore: registered new device driver usb<br />NET: Registered protocol family 2<br />IP route cache hash table entries: 1024 (order: 0, 4096 bytes)<br />TCP established hash table entries: 1024 (order: 1, 8192 bytes)<br />TCP bind hash table entries: 1024 (order: 0, 4096 bytes)<br />TCP: Hash tables configured (established 1024 bind 1024)<br />TCP reno registered<br />NET: Registered protocol family 1<br />AR7240 GPIOC major 0<br />squashfs: version 4.0 (2009/01/31) Phillip Lougher<br />NTFS driver 2.1.29 [Flags: R/O].<br />msgmni has been set to 58<br />alg: No test for lzma (lzma-generic)<br />alg: No test for stdrng (krng)<br />io scheduler noop registered<br />io scheduler anticipatory registered<br />io scheduler deadline registered<br />io scheduler cfq registered (default)<br />Serial: 8250/16550 driver, 1 ports, IRQ sharing disabled<br />ttyS0: detected caps 00000000 should be 00000100<br />serial8250.0: ttyS0 at MMIO 0xb8020000 (irq = 19) is a 16550A<br />console [ttyS0] enabled<br />PPP generic driver version 2.4.2<br />NET: Registered protocol family 24<br />cmdlinepart partition parsing not available<br />set partition boot <br />set partition kernel <br />set partition rootfs <br />set partition config <br />set partition art <br />set partition ? <br />Searching for RedBoot partition table<br />5 RedBoot partitions found on MTD device ar7240-nor0<br />Creating 5 MTD partitions on &quot;ar7240-nor0&quot;:<br />0x000000000000-0x000000020000 : &quot;boot&quot;<br />0x000000020000-0x000000120000 : &quot;kernel&quot;<br />0x000000120000-0x0000003e0000 : &quot;rootfs&quot;<br />0x0000003e0000-0x0000003f0000 : &quot;config&quot;<br />0x0000003f0000-0x000000400000 : &quot;art&quot;<br />-&gt;Oops: flash id 0x10215 . <br />ehci_hcd: USB 2.0 &#039;Enhanced&#039; Host Controller (EHCI) Driver<br />Port Status 1c000004 <br />ar7240-ehci ar7240-ehci.0: ATH EHCI<br />ar7240-ehci ar7240-ehci.0: new USB bus registered, assigned bus number 1<br />ehci_reset Intialize USB CONTROLLER in host mode: 3<br />ehci_reset Port Status 1c000000 <br />ar7240-ehci ar7240-ehci.0: irq 3, io mem 0x1b000000<br />ehci_reset Intialize USB CONTROLLER in host mode: 3<br />ehci_reset Port Status 1c000000 <br />ar7240-ehci ar7240-ehci.0: USB 2.0 started, EHCI 1.00<br />usb usb1: configuration #1 chosen from 1 choice<br />hub 1-0:1.0: USB hub found<br />hub 1-0:1.0: 1 port detected<br />TCP cubic registered<br />NET: Registered protocol family 17<br />802.1Q VLAN Support v1.8 Ben Greear &lt;greearb@candelatech.com&gt;<br />All bugs added by David S. Miller &lt;davem@redhat.com&gt;<br />ar7240wdt_init: Registering WDT success<br />VFS: Mounted root (squashfs filesystem) readonly on device 31:2.<br />Freeing unused kernel memory: 116k freed<br />init started:&nbsp; BusyBox v1.01 (2012.08.01-03:58+0000) multi-call binary<br />This Board use 2.6.31<br />xt_time: kernel timezone is -0000<br />nf_conntrack version 0.5.0 (512 buckets, 5120 max)<br />ip_tables: (C) 2000-2006 Netfilter Core Team<br />insmod: cannot open module `/lib/modules/2.6.31/kernel/iptable_raw.ko&#039;: No such file or directory<br />insmod: cannot open module `/lib/modules/2.6.31/kernel/flashid.ko&#039;: No such file or directory<br />PPPoL2TP kernel driver, V1.0<br />PPTP driver version 0.8.3<br />insmod: cannot open module `/lib/modules/2.6.31/kernel/harmony.ko&#039;: No such file or directory</p><p>Now flash open!<br /> (none) mips #22 Wed Aug 22 11:18:12 CST 2012 (none)<br />(none) login: Now flash open!<br />Now flash open!<br />Now flash open!<br />Now flash open!<br />Erase from 0X3E0000 to 0X3E9980:.<br />Program from 0X3E0000 to 0X3E9980:<br />write successfully<br />ATHR_GMAC: Length per segment 1536<br />ATHR_GMAC: fifo cfg 3 01f00140<br />2<br />ATHR_GMAC: Max segments per packet :&nbsp; &nbsp;1<br />ATHR_GMAC: Max tx descriptor count :&nbsp; &nbsp;40<br />ATHR_GMAC: Max rx descriptor count :&nbsp; &nbsp;96<br />ATHR_GMAC: Mac capability flags&nbsp; &nbsp; :&nbsp; &nbsp;4D83<br />1<br />ATHR_GMAC: Max segments per packet :&nbsp; &nbsp;1<br />ATHR_GMAC: Max tx descriptor count :&nbsp; &nbsp;40<br />ATHR_GMAC: Max rx descriptor count :&nbsp; &nbsp;252<br />ATHR_GMAC: Mac capability flags&nbsp; &nbsp; :&nbsp; &nbsp;4403<br />athr_gmac_ring_alloc Allocated 640 at 0x81e9d800<br />athr_gmac_ring_alloc Allocated 4032 at 0x81d63000<br />Setting Drop CRC Errors, Pause Frames and Length Error frames <br />Setting PHY...mac 0<br />athr_gmac_ring_alloc Allocated 640 at 0x81e9d400<br />athr_gmac_ring_alloc Allocated 1536 at 0x81f2d000<br />Setting Drop CRC Errors, Pause Frames and Length Error frames <br />ATHRS26: resetting s26<br />ATHRS26: s26 reset done<br />Setting PHY...mac 1<br />device eth0 entered promiscuous mode<br />Now flash open!<br />nf_conntrack_rtsp v0.6.21 loading<br />nf_nat_rtsp v0.6.21 loading<br />asf: module license &#039;Proprietary&#039; taints kernel.<br />Disabling lock debugging due to kernel taint<br />ath_hal: 0.9.17.1 (AR9380, DEBUG, REGOPS_FUNC, WRITE_EEPROM, 11D)<br />ath_rate_atheros: Copyright (c) 2001-2005 Atheros Communications, Inc, All Rights Reserved<br />ath_dev: Copyright (c) 2001-2007 Atheros Communications, Inc, All Rights Reserved<br />ath_ahb: 9.2.0_U5.508 (Atheros/multi-bss)<br />Boostrap clock 25MHz<br />ar9300RadioAttach: Need analog access recipe!!<br />Restoring Cal data from Flash<br />ath_get_caps[4735] rx chainmask mismatch actual 1 sc_chainmak 0<br />ath_get_caps[4710] tx chainmask mismatch actual 1 sc_chainmak 0<br />wifi0: Atheros 9380: mem=0xb8100000, irq=2<br />wlan_vap_create : enter. devhandle=0x80d202c0, opmode=IEEE80211_M_HOSTAP, flags=0x1<br />wlan_vap_create : exit. devhandle=0x80d202c0, opmode=IEEE80211_M_HOSTAP, flags=0x1.<br />VAP device ath0 created </p><p> DES SSID SET=TP-LINK_POCKET_3040_7F9E48 <br />ieee80211_scan_unregister_event_handler: Failed to unregister evhandler=c0abc6c0 arg=81f6fac0<br />wlan_vap_delete : enter. vaphandle=0x80e72000<br />wlan_vap_delete : exit. vaphandle=0x80e72000<br />wlan_vap_create : enter. devhandle=0x80d202c0, opmode=IEEE80211_M_HOSTAP, flags=0x1<br />wlan_vap_create : exit. devhandle=0x80d202c0, opmode=IEEE80211_M_HOSTAP, flags=0x1.<br />VAP device ath0 created </p><p> DES SSID SET=TP-LINK_POCKET_3040_7F9E48 <br /> ieee80211_ioctl_siwmode: imr.ifm_active=393856, new mode=3, valid=1 <br />WARNING: Fragmentation with HT mode NOT ALLOWED!!<br />device ath0 entered promiscuous mode<br />br0: port 2(ath0) entering forwarding state<br /> ieee80211_ioctl_siwmode: imr.ifm_active=1442432, new mode=3, valid=1 <br />br0: port 2(ath0) entering disabled state</p><p> DES SSID SET=TP-LINK_POCKET_3040_7F9E48 <br />br0: port 2(ath0) entering forwarding state</p><p> TL-MR3040 mips #22 Wed Aug 22 11:18:12 CST 2012 (none)<br />TL-MR3040 login: admin<br />Password: <br />Login incorrect<br />TL-MR3040 login: root<br />Password: <br />Login incorrect<br />TL-MR3040 login: <br />Login timed out after 60 seconds.</p><p> TL-MR3040 mips #22 Wed Aug 22 11:18:12 CST 2012 (none)<br />TL-MR3040 login: osteam<br />Password: <br />Login incorrect<br />TL-MR3040 login: osteam<br />Password: <br />Login incorrect<br />TL-MR3040 login: root<br />Password: <br />Login incorrect<br />Jan&nbsp; 1 00:02:57 login[556]: invalid password for `root&#039; on `ttyS0&#039;</p><br /><p> TL-MR3040 mips #22 Wed Aug 22 11:18:12 CST 2012 (none)<br />TL-MR3040 login: root<br />Password: <br />Login incorrect<br />TL-MR3040 login:</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p182383">
				<div class="post-metadata">
					<div class="post-num">Post #37</div>
					<div class="post-author">lsoltero</div>
					<div class="post-datetime">
						5 Nov 2012, 02:40					</div>
				</div>
				<div class="post-content content">
					<p>using the webshell i discovered a user called ap71 which has no password which allows me to login.&nbsp; So... i am in.&nbsp; I don&#039;t have access to root and can&#039;t write anything to the device (even /tmp) but can look around.&nbsp; When I plug in my USB 1.1 device I get the following on the console.&nbsp; Does this mean any thing to anyone?</p><br /><p>$ usb 1-1: new full speed USB device using ar7240-ehci and address 3<br />usb 1-1: configuration #1 chosen from 1 choice<br />markModemSwitchInfo 871: vid = 0x1edd, pid = 0x9575, cmd = <br />cdc_acm 1-1:1.0: ttyACM0: USB ACM device<br />usbcore: registered new interface driver cdc_acm<br />cdc_acm: v0.26:USB Abstract Control Model driver for USB modems and ISDN adapters<br />connect_modem 629 modem name is /dev/ttyACM0, script is chat -S -V -f /etc/ppp/chat-modem-configure<br />connect_modem 629 modem name is /dev/ttyACM1, script is chat -S -V -f /etc/ppp/chat-gsm-test-qualcomm<br />Open modem error:No such device<br />Open modem error:19</p><p>^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^<br />USB 3G Modem available interfaces list<br />outputInterfaceInfo 974 Main interface_index[0] = 0<br />#######################################################################</p><br /><p>anyone have any idea what ar7240-ehci means?&nbsp; Is that ringing any bells with the TP-LINK source code? or is this a new device not listed in that source?</p><p>--luis</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p182427">
				<div class="post-metadata">
					<div class="post-num">Post #38</div>
					<div class="post-author">rickysland</div>
					<div class="post-datetime">
						5 Nov 2012, 12:20					</div>
				</div>
				<div class="post-content content">
					<p>Hello, I have do some information.<br />see this:https://dev.openwrt.org/ticket/12385#ticket<br />Sorry for my poor English.</p><p>The main test is: shutdown your wifi($wifi down)，useing Physics line connect, the problem gone...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p182492">
				<div class="post-metadata">
					<div class="post-num">Post #39</div>
					<div class="post-author">Squonk</div>
					<div class="post-datetime">
						5 Nov 2012, 23:17					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>lsoltero wrote:</cite><blockquote><p>using the webshell i discovered a user called ap71 which has no password which allows me to login.&nbsp; So... i am in.&nbsp; I don&#039;t have access to root and can&#039;t write anything to the device (even /tmp) but can look around.</p></blockquote></div><p>You can fix that: from the webshell, type:<br /></p><div class="codebox"><pre><code>chmod 777 /tmp</code></pre></div><p>You now have access to /tmp in r/w with the ap71 user until next reboot.</p><div class="quotebox"><cite>lsoltero wrote:</cite><blockquote><p>When I plug in my USB 1.1 device I get the following on the console.&nbsp; Does this mean any thing to anyone?</p><br /><p>$ usb 1-1: new full speed USB device using ar7240-ehci and address 3</p></blockquote></div><p>Yes... The Atheros AR9331 is actually a SoC with an integrated wireless radio... And an Atheros AR7240 400 MHz MIPS4kc CPU (see <a href="http://wiki.openwrt.org/toh/tp-link/tl-wr703n#features).">http://wiki.openwrt.org/toh/tp-link/tl- … features).</a></p><p>The &quot;-ehci&quot; suffix stands for &quot;Enhanced Host Controller Interface&quot;: this is the high-speed controller standard for USB 2.0. Low-speed and full-speed devices are normally handed over to the -ohci (Open Host Controller Interface) companiondriver. See <a href="http://en.wikipedia.org/wiki/Host_controller_interface_(USB,_Firewire)#USB.">http://en.wikipedia.org/wiki/Host_contr … wire)#USB.</a></p><p>What i don&#039;t understand is why this is not the &#039;ar7340-ohci&quot; driver that has been selected to handled your full-speed device?</p><div class="quotebox"><cite>lsoltero wrote:</cite><blockquote><p>usb 1-1: configuration #1 chosen from 1 choice<br />markModemSwitchInfo 871: vid = 0x1edd, pid = 0x9575, cmd =</p></blockquote></div><p>This is a trace by the &quot;/sbin/hotplug&quot; handler that dumps the device VID/PID of the inserted device.</p><div class="quotebox"><cite>lsoltero wrote:</cite><blockquote><p>cdc_acm 1-1:1.0: ttyACM0: USB ACM device<br />usbcore: registered new interface driver cdc_acm<br />cdc_acm: v0.26:USB Abstract Control Model driver for USB modems and ISDN adapters</p></blockquote></div><p>Based on the returned device descriptor, the cdc-acm driver was chosen and the corresponding module inserted by &quot;/sbin/hotplug&quot;.</p><p>The CDC-ACM (&quot;Character Device Class / Abstract Control Model&quot;) is the USB class/subclass used for modem using embedded &quot;AT&quot; commands for control (like Plain Old Serial Modems), rather than proprietary USB messages.</p><div class="quotebox"><cite>lsoltero wrote:</cite><blockquote><p>connect_modem 629 modem name is /dev/ttyACM0, script is chat -S -V -f /etc/ppp/chat-modem-configure<br />connect_modem 629 modem name is /dev/ttyACM1, script is chat -S -V -f /etc/ppp/chat-gsm-test-qualcomm<br />Open modem error:No such device<br />Open modem error:19</p><p>^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^<br />USB 3G Modem available interfaces list<br />outputInterfaceInfo 974 Main interface_index[0] = 0<br />#######################################################################</p></blockquote></div><p>The pppd daemon is then launched, that will try to open a PPP (point-to-point) IP link with the local modem and manage the ppp0 network interface. This is achieved by using the &quot;chat&quot; utility that will send the correct &quot;AT&quot; commands/get the corresponding answers to recongize/initialize the modem.</p><p>It does not go further than that, since obviously what you inserted is not a modem...</p><div class="quotebox"><cite>lsoltero wrote:</cite><blockquote><p>anyone have any idea what ar7240-ehci means?&nbsp; Is that ringing any bells with the TP-LINK source code? or is this a new device not listed in that source?</p></blockquote></div><p>See my answers above: this is not new: the &quot;ar7240-ehci&quot; (and the &quot;ar7240-ohci&quot;) driver is defined in &quot;arch/mips/ar7240/platform.c&quot; in the TP-LINK GPL source files, and the &quot;$ usb 1-1: new full speed USB device using ar7240-ehci and address 3&quot; message is generated from the standard &quot;drivers/usb/core/hub.c&quot; kernel source file.</p><p>Unfortunately, I have already checked there, to no avail. Not a single indication of a possible patch for a bug anywhere in there <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><p>On my side, I tried to access my Arduino board from within the stock firmware, but as &quot;stty&quot; is not there, nor any terminal emulator, I dont see how I could just run something on it that would display the USB serial input...</p><p>I tried to install the &quot;picocom&quot; terminal emulator from the AA branch, but it doesn&#039;t work because of incompatible uClinux libraries...</p><p>The only possible solution would be to use &quot;chat&quot;, but it must be launched from &quot;pppd&quot; (see <a href="http://osdir.com/ml/org.user-groups.linux.tolug/2003-08/msg00221.html),">http://osdir.com/ml/org.user-groups.lin … 221.html),</a> so I am trying to figure out how I could possibly launch it.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p182494">
				<div class="post-metadata">
					<div class="post-num">Post #40</div>
					<div class="post-author">TheRaster</div>
					<div class="post-datetime">
						5 Nov 2012, 23:36					</div>
				</div>
				<div class="post-content content">
					<p>I would just like to add some thoughts here.....</p><p>Last week or so I posted about my 3420 droping the usb now and then when doing speedtests on speedtest.net<br />Not liking the fact that it may affect me later with a program I need to be on the net with, And thinking it may be the router I got a nice new 3600 with 2 usb ports on the back.</p><p>All set up now and typing on here with the 3g modem in the back now and the new one has the same problem too <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p182495">
				<div class="post-metadata">
					<div class="post-num">Post #41</div>
					<div class="post-author">lsoltero</div>
					<div class="post-datetime">
						5 Nov 2012, 23:46					</div>
				</div>
				<div class="post-content content">
					<p>Are you using the native TP-LINK firmware or are you using OpenWRT?</p><p>--luis</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p182496">
				<div class="post-metadata">
					<div class="post-num">Post #42</div>
					<div class="post-author">TheRaster</div>
					<div class="post-datetime">
						5 Nov 2012, 23:50					</div>
				</div>
				<div class="post-content content">
					<p>Have tested with both. And with E353 modem and a sierra modem both do the same...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p182497">
				<div class="post-metadata">
					<div class="post-num">Post #43</div>
					<div class="post-author">Squonk</div>
					<div class="post-datetime">
						6 Nov 2012, 00:23					</div>
				</div>
				<div class="post-content content">
					<p>As suggested by rickysland (thanks!), I am trying to turn off the Wifi radio while doing the exact same test performed with my Arduino Leonardo spitting a counter every second on the USB serial (cdc-acm) at 57600 bps.</p><p>Now ticking for over an hour without a glitch... I will let it run the whole night (for me) and let you know tomorrow.</p><p>FYI, the same setup is hanging in less than an hour (sometimes only a few seconds) with Wifi turned on...</p><p>Luis (et al.), can you try that on your side too?</p><p>If it works like this and not when Wifi radio is turned on, then we got a problem here <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p182499">
				<div class="post-metadata">
					<div class="post-num">Post #44</div>
					<div class="post-author">lsoltero</div>
					<div class="post-datetime">
						6 Nov 2012, 00:46					</div>
				</div>
				<div class="post-content content">
					<p>i am doing more testing but seeing the same thing here...</p><p>on one of may AP121U which is prone to this issue i disabled the wifi and made 12 PPP connections back to back without issue...<br />turn on the wifi boom... on the first connection the USB hangs.&nbsp; I didn&#039;t even have a client connected to the WiFI so there was little or no data going over the WiFi interface...</p><p>more soon...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p182500">
				<div class="post-metadata">
					<div class="post-num">Post #45</div>
					<div class="post-author">Squonk</div>
					<div class="post-datetime">
						6 Nov 2012, 00:55					</div>
				</div>
				<div class="post-content content">
					<p>I may have the solution:</p><p><span class="postimg"><img src="http://oomz.net/p/web/IMG_5862.JPG" alt="Big Capacitor for USB!!!" /></span></p><p>See this thread: <a href="https://forum.openwrt.org/viewtopic.php?pid=155706#p155706">https://forum.openwrt.org/viewtopic.php … 06#p155706</a></p><p>Someone want tot try, I need to go to bed...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p182501">
				<div class="post-metadata">
					<div class="post-num">Post #46</div>
					<div class="post-author">lsoltero</div>
					<div class="post-datetime">
						6 Nov 2012, 01:38					</div>
				</div>
				<div class="post-content content">
					<p>ok... this is pretty conclusive... i have done the experiment a million times... enable wifi the USB interface hangs when starting a PPPD session. disable the wifi and it works perfectly.&nbsp; </p><p>I played around with different transmit levels.&nbsp; even at 0 (1mw) i can only get one or two sessions done before the port hangs.</p>											<p class="post-edited">(Last edited by <strong>lsoltero</strong> on 6 Nov 2012, 01:38)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p182508">
				<div class="post-metadata">
					<div class="post-num">Post #47</div>
					<div class="post-author">Squonk</div>
					<div class="post-datetime">
						6 Nov 2012, 08:35					</div>
				</div>
				<div class="post-content content">
					<p>Ok, it is working for &gt; 10 hours now without problem, so it is not worse than my M$ Windows <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>If I can find one, I will try to add a big electrolytic capacitor across C113 with Wifi enabled and see if it helps.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p182514">
				<div class="post-metadata">
					<div class="post-num">Post #48</div>
					<div class="post-author">Squonk</div>
					<div class="post-datetime">
						6 Nov 2012, 10:49					</div>
				</div>
				<div class="post-content content">
					<p>I have found a spare 100µF electrolytic capacitor to test.</p><p>However, before putting the soldering iron to heat, I tried re-enabling the Wifi using the LuCI web administration interface over Ethernet.</p><p>I also set up the LED to show the Wifi RX/TX activity with LuCI.</p><p>With the &quot;microcom -s 57600 /dev/ttyACM0&quot; command running in the serial console, it is working for &gt; 1 hour now without problem?!?</p><p>Before soldering the capacitor, I am now trying with the same command running over a Wifi SSH Shell.</p><p>EDIT: it hangs after half an hour, so the bug is related ti Wifi activity apparently.</p>											<p class="post-edited">(Last edited by <strong>Squonk</strong> on 6 Nov 2012, 11:17)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p182523">
				<div class="post-metadata">
					<div class="post-num">Post #49</div>
					<div class="post-author">Squonk</div>
					<div class="post-datetime">
						6 Nov 2012, 13:13					</div>
				</div>
				<div class="post-content content">
					<p>Bad news: even with a 100µF/16V electrolytic capacitor mounted across C113, my tests hanged after a little bit more than 1 hour <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><p>I will try again by adding a passive &quot;Octopus&quot; USB hub to confirm, but it looks like it is the only viable solution to avoid this problem...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p182526">
				<div class="post-metadata">
					<div class="post-num">Post #50</div>
					<div class="post-author">lsoltero</div>
					<div class="post-datetime">
						6 Nov 2012, 14:22					</div>
				</div>
				<div class="post-content content">
					<p>i have spent may hours experimenting with this... There seems to be some correlation between power draw on the USB, power of transmission on the wifi, and manufacturer of the device...</p><p>here are few of my findings.</p><p>I have two USB devices. One that draws power from the USB and one that does not.&nbsp; When the USB that draws power from the USB is connected to the AP121U i get permanent failures if the wifi is enabled with nothing connected.&nbsp; When in wifi transmit power 0 i can do a few connections before the USB port hangs.&nbsp; However, when using the NON powered USB device I can connect reliably when the wifi power is set to 0.&nbsp; However, the USB will fail if I have a wifi client connected to the device even with power set to 0.</p><p>The MR3040 is a lot less sensitive.&nbsp; I just had the USB device that draws power connected to this router with WiFI power set to 27 and a client connected to it and made many connections back to back without issue.&nbsp; That is not to say the problem is not there since we have been able to make this router fail, its just that its less sensitive than the alfa router.</p><p>Sorry to hear that the CAP test failed... I thought for sure that would address the issue since there seems to be some power related issues... My theory was that the USB hub (remember that...) made things work by evening out power draw on the USB removing spikes.&nbsp; But... i guess that theory no longer holds.&nbsp; So... in light of the new evidence my question is... why does everything work perfectly when a passive USB hub is used?</p><p>--luis</p>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 2 of 13</div><nav><ul><li><a href="viewtopic.php%3Fid=39956&amp;p=1.html">1</a></li><li class="pagination-current"><span>2</span></li><li><a href="viewtopic.php%3Fid=39956&amp;p=3.html">3</a></li><li><a href="viewtopic.php%3Fid=39956&amp;p=4.html">4</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39956&amp;p=13.html">13</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>