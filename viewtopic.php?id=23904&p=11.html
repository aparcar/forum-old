<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Multi-WAN Load Balancing</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 29 Mar 2018 and 3 May 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 11 of 14</div><nav><ul><li><a href="viewtopic.php%3Fid=23904&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=23904&amp;p=9.html">9</a></li><li><a href="viewtopic.php%3Fid=23904&amp;p=10.html">10</a></li><li class="pagination-current"><span>11</span></li><li><a href="viewtopic.php%3Fid=23904&amp;p=12.html">12</a></li><li><a href="viewtopic.php%3Fid=23904&amp;p=13.html">13</a></li><li><a href="viewtopic.php%3Fid=23904&amp;p=14.html">14</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p120361">
				<div class="post-metadata">
					<div class="post-num">Post #251</div>
					<div class="post-author">crisman</div>
					<div class="post-datetime">
						4 Nov 2010, 15:57					</div>
				</div>
				<div class="post-content content">
					<p>Hello, I installed multiwan 1.0.19, but it seems process stop after an error:</p><div class="codebox"><pre><code> ## Main Initialization ##
## Flushing IP Rules &amp; Routes ##
## Clearing Rules ##
## IP Rules Initialization ##
## Refreshing Routing Tables ##
## IPTables Rule Initialization ##
## Creating FW Rules ##
## Refreshing DNS Resolution and Tables ##
## Refreshing Load Balancer ##
/usr/bin/multiwan: line 1: syntax error: 0 +</code></pre></div><p>After that no process is present with name &quot;multiwan&quot;.</p><p>Can you help me, please?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p120384">
				<div class="post-metadata">
					<div class="post-num">Post #252</div>
					<div class="post-author">buildster</div>
					<div class="post-datetime">
						4 Nov 2010, 20:19					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>crisman wrote:</cite><blockquote><p>Hello, I installed multiwan 1.0.19, but it seems process stop after an error:</p><div class="codebox"><pre><code> ## Main Initialization ##
## Flushing IP Rules &amp; Routes ##
## Clearing Rules ##
## IP Rules Initialization ##
## Refreshing Routing Tables ##
## IPTables Rule Initialization ##
## Creating FW Rules ##
## Refreshing DNS Resolution and Tables ##
## Refreshing Load Balancer ##
/usr/bin/multiwan: line 1: syntax error: 0 +</code></pre></div><p>After that no process is present with name &quot;multiwan&quot;.</p><p>Can you help me, please?</p></blockquote></div><p>This is possibly yours truly&#039;s bad, forgetting to safe-guard missing configuration parameters. Can you ensure &quot;weight&quot; is specified and try it, again?</p><p>Turning on debug helps debugging <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" />. If the above suggestion doesn&#039;t help,&nbsp; posting your /etc/config/multiwan may help me locate the cause of your trouble.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p120392">
				<div class="post-metadata">
					<div class="post-num">Post #253</div>
					<div class="post-author">crisman</div>
					<div class="post-datetime">
						4 Nov 2010, 21:29					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>buildster wrote:</cite><blockquote><p>This is possibly yours truly&#039;s bad, forgetting to safe-guard missing configuration parameters. Can you ensure &quot;weight&quot; is specified and try it, again?</p><p>Turning on debug helps debugging <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" />. If the above suggestion doesn&#039;t help,&nbsp; posting your /etc/config/multiwan may help me locate the cause of your trouble.</p></blockquote></div><p>Sorry, it was a typo in my config ( a missing &#039; )...<br />Thanks</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p120441">
				<div class="post-metadata">
					<div class="post-num">Post #254</div>
					<div class="post-author">SystemR89</div>
					<div class="post-datetime">
						5 Nov 2010, 09:36					</div>
				</div>
				<div class="post-content content">
					<p>hi,<br />I&#039;ve two wan on the same subnet and I&#039;d like use multi wan. I know that this is a bad situation and that it can bypassed using a router to nat one wan but I can&#039;t do it.<br />Searching on the net I found this scenario: wiki.mikrotik.com/wiki/Manual:Load_balancing_multiple_same_subnet_links that is like mine. RouterOS is based on Linux so this approch should works also in openwrt, right?</p><p>Thank you for yout work!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p121362">
				<div class="post-metadata">
					<div class="post-num">Post #255</div>
					<div class="post-author">Bad Joker</div>
					<div class="post-datetime">
						18 Nov 2010, 01:14					</div>
				</div>
				<div class="post-content content">
					<p>Hey I have a question on this package. First of all, thank you for this great package, keep the good work up.</p><p>I&#039;m running it on an TP-Link WR1043ND router with 10.03 RC3.</p><p>multiwan package is installed in version 1.0.19-1, version 1.0.17 and 1.0.18 spams the syslog because of my 3g connection.</p><p>luci-app-multiwan package is installed in version 1.0.16.</p><p>WAN is an K3765-HV USB dongle via 3g ppp flatrate on Vodafone.de net.</p><p>WAN2 is an 2,0/0,2 MBit DSL line (which is connected through an separate router) configured as static IP on the WAN port.</p><p>The failover does not work for me reliable on the 3g link. After a certain time it declares the connection as dead and disables it. But the modem is still connected (no disconnect in the syslog, the led of the usb dongle is still static on, so hwconnect is there). Also it does not try to do a reconnect. So useless in combination with 3g for me.</p><p>I tried different configs.</p><p>As &#039;dns&#039; I tried auto and also the correct dns1/dns2 of my vodafone 3g, which are fixed.</p><p>As &#039;icmp_hosts&#039; I tried <a href="http://www.vodafone.de">www.vodafone.de</a>, and also the dns or wan gateway.</p><p>As &#039;timeout&#039; I tried from 3, 5 to 10 sec.</p><p>As &#039;health_fail_retries&#039; I tried from 3, 5 to 10 tries.</p><p>And of course several combinations of that.</p><p>The result is always the same, after a certain time multiwan declares the 3g line as dead and disables it. No reconnect or anything else. But the line is up and running fine, I can see no disconnect on the syslog by chat or pppd and as reported the usb dongle also indicates an connect with an static led in blueish or greenish (3g or gprs) when connected.</p><p>The 3g is realized by pppd with comgt (and chat), so serial link.</p><p>So how to investigate on that issue?</p><p>I would appreciate any suggestions.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p122506">
				<div class="post-metadata">
					<div class="post-num">Post #256</div>
					<div class="post-author">pio</div>
					<div class="post-datetime">
						3 Dec 2010, 02:16					</div>
				</div>
				<div class="post-content content">
					<p>This is a really cool script.&nbsp; I just got an OpenWRT capable router on Wednesday with the intention of using it to replace a debian box I&#039;d been using as a router with custom routing scripts I made for multi-WAN.&nbsp; This script really made my transition to OpenWRT easy!</p><p>My old custom method didn&#039;t have any failover, and I really love that about multiwan!&nbsp; </p><p>I was thinking it&#039;d be neat to make it so that you could set up the &quot;Failover Traffic Destination&quot; (failover_to) per &quot;Traffic Rule&quot; (mwanfw).&nbsp; I have two ISPs, one very reliable but small transfer limits, the other completely unreliable but no traffic limits.&nbsp; I have some traffic (80/443) which I&#039;d like to failover from the unreliable ISP to the reliable ISP, but other traffic (bittorrent) I would never want to failover to the low-limit ISP.&nbsp; I might be attempting to patch my multiwan to accomplish this, I&#039;ll be sure to report back in here.</p><p>I also have been monitoring the uptime of the unreliable connection for over 5 years; I&#039;m thinking since multiwan also performs that sort of monitoring, maybe I&#039;d throw in some hooks that&#039;d enable it to report uptime statistics to an external program somewhere.&nbsp; Not sure how useful that&#039;d be to others but I guess if I make any customizations at all I&#039;ll post em here.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p122512">
				<div class="post-metadata">
					<div class="post-num">Post #257</div>
					<div class="post-author">pio</div>
					<div class="post-datetime">
						3 Dec 2010, 07:46					</div>
				</div>
				<div class="post-content content">
					<p>I whipped up a thing allowing you to specify failover_to per wmanfw item in the config:</p><p><a href="http://pio.longstair.com/misc/multiwan_per_mwanfw_failover.patch.txt">http://pio.longstair.com/misc/multiwan_ … .patch.txt</a></p><p>I emailed more details to SouthPawn.. if you are brave, give it a shot!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p123208">
				<div class="post-metadata">
					<div class="post-num">Post #258</div>
					<div class="post-author">Black6spdZ</div>
					<div class="post-datetime">
						14 Dec 2010, 02:20					</div>
				</div>
				<div class="post-content content">
					<p>ok.. so recently update to most recent 10.03-rc4 on my router, previously running rc3. Its been a while since I&#039;ve messed with it but at one time had all three of my dsl lines properly load balanced with multiwan 1.0.18. So I also update to the multiwan 1.0.19-1. Traffic only used one interface. So I removed and reinstalled 1.0.18 and restored my previously saved openwrt config. It then started using two interfaces &quot;tested with a torrent d/l&quot;. Went back and forth between 18 and 19-1 experiencing the same results each time. So now I am back with 18 where I can use at least two lines but the third just sits idle.. configs look fine, same config for ever wan port. Here is the routing table.. notice only wan and wan2 have outgoing routes created.. why not the third?</p><p>Network&nbsp; &nbsp; &nbsp;Target&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; IPv4-Netmask&nbsp; &nbsp; &nbsp;IPv4-Gateway&nbsp; &nbsp; &nbsp;Metric <br />lan&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;192.168.10.0&nbsp; 255.255.255.0&nbsp; &nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 <br />wan&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;98.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 <br />wan3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;65.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 <br />wan2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;74.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0 <br />wan2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;74.243.46.1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 <br />wan&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;98.89.147.1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p123823">
				<div class="post-metadata">
					<div class="post-num">Post #259</div>
					<div class="post-author">Black6spdZ</div>
					<div class="post-datetime">
						23 Dec 2010, 20:54					</div>
				</div>
				<div class="post-content content">
					<p>why cant I downgrade to &lt; 1.0.19-1? There is a problem with this new script limiting me to only two wan connctions.. I have 3!<br />NVM, got 1.0.18 installed along with downgrading back to rc3 where once months ago all three of my wan circuits routed flawlessly, now its gone to hell after upgrading to rc4 and 1.0.19-1.. not sure exactly where to start other than the routing tables don&#039;t look like they should.. why wont it include my third wan into the routing table?</p>											<p class="post-edited">(Last edited by <strong>Black6spdZ</strong> on 24 Dec 2010, 03:03)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p124104">
				<div class="post-metadata">
					<div class="post-num">Post #260</div>
					<div class="post-author">Black6spdZ</div>
					<div class="post-datetime">
						28 Dec 2010, 22:25					</div>
				</div>
				<div class="post-content content">
					<p>just a follow-up, I did a hard reset and reflash to backfire rc4 r24038, fresh install of luci-app-multiwan which in turn installed multiwan 1.0.19-1. Setup each of my dsl connections on different subnets and the load balancing is working now just as it used to.</p><p>Network Target IPv4-Netmask IPv4-Gateway Metric <br />wan3 192.168.3.0 255.255.255.0 0.0.0.0 0 <br />wan2 192.168.2.0 255.255.255.0 0.0.0.0 0 <br />wan1 192.168.1.0 255.255.255.0 0.0.0.0 0 <br />lan 192.168.10.0 255.255.255.0 0.0.0.0 0 <br />wan3 0.0.0.0 0.0.0.0 192.168.3.254 0 <br />wan2 0.0.0.0 0.0.0.0 192.168.2.254 0 <br />wan1 0.0.0.0 0.0.0.0 192.168.1.254 0 </p><p>There are a couple problems however that I&#039;m not sure how to track down. When the router is heavily loaded I lose wan connection peridically for 10 seconds or so and it comes back and will repeat this behavior. The router isn&#039;t restarting as the uptime counter shows. Also, I cant seem to get port forwarding to work.. will it not work with multiwan?</p>											<p class="post-edited">(Last edited by <strong>Black6spdZ</strong> on 28 Dec 2010, 22:26)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p124622">
				<div class="post-metadata">
					<div class="post-num">Post #261</div>
					<div class="post-author">jouk</div>
					<div class="post-datetime">
						6 Jan 2011, 10:26					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m running the build from 3 januari of Arokh on a Netgear WNDR3700 and have done the usb overlay thingy to have some more space.</p><p>But when I configure and run multiwan the system spontaniously reboots! Configuration of my network is very standard (LAN/WAN/WAN2) as is the configuration of multiwan. I don&#039;t enable multiwan during startup because I found it suspicious that the device became unreachable after installing it. And when I start it from /etc/init.d/multiwan the device reboots within seconds.</p><p>I putted set -xv in the top of the script and saw that the ssh session was broken after the iptable multiwan rules were configured. Can reproduce it when necessary.</p><p>I don&#039;t know if it&#039;s the netgear, it&#039;s configuration or multiwan, but it&#039;s pretty frustrating.</p><p>Configuration:</p><p>/etc/config/network</p><div class="codebox"><pre><code>config &#039;interface&#039; &#039;loopback&#039;
        option &#039;ifname&#039; &#039;lo&#039;
        option &#039;proto&#039; &#039;static&#039;
        option &#039;ipaddr&#039; &#039;127.0.0.1&#039;
        option &#039;netmask&#039; &#039;255.0.0.0&#039;

config &#039;interface&#039; &#039;lan&#039;
        option &#039;type&#039; &#039;bridge&#039;
        option &#039;proto&#039; &#039;static&#039;
        option &#039;netmask&#039; &#039;255.255.255.0&#039;
        option &#039;ifname&#039; &#039;eth0.1&#039;
        option &#039;ipaddr&#039; &#039;192.168.11.250&#039;
        option &#039;defaultroute&#039; &#039;0&#039;
        option &#039;peerdns&#039; &#039;0&#039;

config &#039;interface&#039; &#039;wan&#039;
        option &#039;ifname&#039; &#039;eth1&#039;
        option &#039;proto&#039; &#039;static&#039;
        option &#039;netmask&#039; &#039;255.255.255.0&#039;
        option &#039;gateway&#039; &#039;192.168.12.252&#039;
        option &#039;dns&#039; &#039;192.168.12.252&#039;
        option &#039;defaultroute&#039; &#039;0&#039;
        option &#039;peerdns&#039; &#039;0&#039;
        option &#039;ipaddr&#039; &#039;192.168.12.254&#039;

config &#039;switch&#039;
        option &#039;name&#039; &#039;rtl8366s&#039;
        option &#039;reset&#039; &#039;1&#039;
        option &#039;enable_vlan&#039; &#039;1&#039;
        option &#039;blinkrate&#039; &#039;2&#039;

config &#039;switch_vlan&#039;
        option &#039;device&#039; &#039;rtl8366s&#039;
        option &#039;vlan&#039; &#039;1&#039;
        option &#039;ports&#039; &#039;0 1 2 5t&#039;

config &#039;switch_port&#039;
        option &#039;device&#039; &#039;rtl8366s&#039;
        option &#039;port&#039; &#039;1&#039;
        option &#039;led&#039; &#039;6&#039;

config &#039;switch_port&#039;
        option &#039;device&#039; &#039;rtl8366s&#039;
        option &#039;port&#039; &#039;2&#039;
        option &#039;led&#039; &#039;9&#039;

config &#039;switch_port&#039;
        option &#039;device&#039; &#039;rtl8366s&#039;
        option &#039;port&#039; &#039;5&#039;
        option &#039;led&#039; &#039;2&#039;

config &#039;switch_vlan&#039;
        option &#039;ports&#039; &#039;3 5t&#039;
        option &#039;vlan&#039; &#039;4&#039;

config &#039;interface&#039; &#039;wan2&#039;
        option &#039;proto&#039; &#039;static&#039;
        option &#039;netmask&#039; &#039;255.255.255.0&#039;
        option &#039;defaultroute&#039; &#039;0&#039;
        option &#039;peerdns&#039; &#039;0&#039;
        option &#039;macaddr&#039; &#039;C0:3F:0E:78:3C:3C&#039;
        option &#039;ifname&#039; &#039;eth0.4&#039;
        option &#039;ipaddr&#039; &#039;192.168.14.250&#039;</code></pre></div><p>/etc/config/firewall<br /></p><div class="codebox"><pre><code>config &#039;defaults&#039;
        option &#039;syn_flood&#039; &#039;1&#039;
        option &#039;input&#039; &#039;ACCEPT&#039;
        option &#039;output&#039; &#039;ACCEPT&#039;
        option &#039;forward&#039; &#039;REJECT&#039;

config &#039;zone&#039;
        option &#039;name&#039; &#039;lan&#039;
        option &#039;input&#039; &#039;ACCEPT&#039;
        option &#039;output&#039; &#039;ACCEPT&#039;
        option &#039;forward&#039; &#039;REJECT&#039;
        option &#039;network&#039; &#039;lan&#039;

config &#039;zone&#039;
        option &#039;name&#039; &#039;wan&#039;
        option &#039;input&#039; &#039;REJECT&#039;
        option &#039;output&#039; &#039;ACCEPT&#039;
        option &#039;forward&#039; &#039;REJECT&#039;
        option &#039;masq&#039; &#039;1&#039;
        option &#039;mtu_fix&#039; &#039;1&#039;
        option &#039;network&#039; &#039;wan wan2&#039;

config &#039;forwarding&#039;
        option &#039;src&#039; &#039;lan&#039;
        option &#039;dest&#039; &#039;wan&#039;

config &#039;rule&#039;
        option &#039;src&#039; &#039;wan&#039;
        option &#039;proto&#039; &#039;udp&#039;
        option &#039;dest_port&#039; &#039;68&#039;
        option &#039;target&#039; &#039;ACCEPT&#039;
        option &#039;family&#039; &#039;ipv4&#039;

config &#039;rule&#039;
        option &#039;src&#039; &#039;wan&#039;
        option &#039;proto&#039; &#039;icmp&#039;
        option &#039;icmp_type&#039; &#039;echo-request&#039;
        option &#039;target&#039; &#039;ACCEPT&#039;

config &#039;include&#039;
        option &#039;path&#039; &#039;/etc/firewall.user&#039;

config &#039;redirect&#039;
        option &#039;src&#039; &#039;wan&#039;
        option &#039;src_dport&#039; &#039;222&#039;
        option &#039;dest&#039; &#039;lan&#039;
        option &#039;dest_ip&#039; &#039;192.168.1.1&#039;
        option &#039;dest_port&#039; &#039;22&#039;
        option &#039;proto&#039; &#039;tcp&#039;

config &#039;rule&#039;
        option &#039;src&#039; &#039;wan&#039;
        option &#039;dest_port&#039; &#039;22&#039;
        option &#039;dest_ip&#039; &#039;192.168.1.1&#039;
        option &#039;proto&#039; &#039;tcp&#039;
        option &#039;target&#039; &#039;ACCEPT&#039;</code></pre></div><p>/etc/config/multiwan<br /></p><div class="codebox"><pre><code>config &#039;multiwan&#039; &#039;config&#039;
        option &#039;default_route&#039; &#039;balancer&#039;

config &#039;interface&#039; &#039;wan&#039;
        option &#039;weight&#039; &#039;10&#039;
        option &#039;health_interval&#039; &#039;10&#039;
        option &#039;timeout&#039; &#039;3&#039;
        option &#039;health_fail_retries&#039; &#039;3&#039;
        option &#039;health_recovery_retries&#039; &#039;5&#039;
        option &#039;failover_to&#039; &#039;wan2&#039;
        option &#039;dns&#039; &#039;auto&#039;
        option &#039;icmp_hosts&#039; &#039;gateway&#039;

config &#039;interface&#039; &#039;wan2&#039;
        option &#039;weight&#039; &#039;5&#039;
        option &#039;health_interval&#039; &#039;10&#039;
        option &#039;timeout&#039; &#039;3&#039;
        option &#039;health_fail_retries&#039; &#039;3&#039;
        option &#039;health_recovery_retries&#039; &#039;5&#039;
        option &#039;dns&#039; &#039;auto&#039;
        option &#039;icmp_hosts&#039; &#039;gateway&#039;
        option &#039;failover_to&#039; &#039;wan&#039;</code></pre></div><p>/etc/config/fstab<br /></p><div class="codebox"><pre><code>config global automount
        option from_fstab 1
        option anon_mount 1

config global autoswap
        option from_fstab 1
        option anon_swap 0
config mount
        option target   /overlay
        option fstype   ext3
        option options  rw,sync
        option enabled_fsck 1
        option is_rootfs 1
        option uuid     &#039;5cccd8bd-bd1e-4a26-9a3c-53f2ceeb134d&#039;
        option enabled  1

#config mount
#       option target   /mnt/sda1
#       option device   /dev/sda1
#       option fstype   ext4
#       option options  rw,noatime
#       option enabled  0
#       option enabled_fsck 0

config swap
        option device   /dev/sda2
        option enabled  0</code></pre></div><p>/etc/config/wireless<br /></p><div class="codebox"><pre><code>config &#039;wifi-device&#039; &#039;radio0&#039;
        option &#039;type&#039; &#039;mac80211&#039;
        option &#039;macaddr&#039; &#039;c0:3f:0e:78:3c:3a&#039;
        option &#039;hwmode&#039; &#039;11ng&#039;
        list &#039;ht_capab&#039; &#039;SHORT-GI-40&#039;
        list &#039;ht_capab&#039; &#039;TX-STBC&#039;
        list &#039;ht_capab&#039; &#039;RX-STBC1&#039;
        list &#039;ht_capab&#039; &#039;DSSS_CCK-40&#039;
        option &#039;txpower&#039; &#039;0&#039;
        option &#039;country&#039; &#039;NL&#039;
        option &#039;htmode&#039; &#039;HT40-&#039;
        option &#039;channel&#039; &#039;13&#039;

config &#039;wifi-iface&#039;
        option &#039;device&#039; &#039;radio0&#039;
        option &#039;mode&#039; &#039;ap&#039;
        option &#039;network&#039; &#039;lan&#039;
        option &#039;ssid&#039; &#039;vs34-24&#039;
        option &#039;encryption&#039; &#039;psk2&#039;
        option &#039;key&#039; &#039;secret&#039;

config &#039;wifi-device&#039; &#039;radio1&#039;
        option &#039;type&#039; &#039;mac80211&#039;
        option &#039;macaddr&#039; &#039;c0:3f:0e:78:3c:3c&#039;
        option &#039;hwmode&#039; &#039;11na&#039;
        list &#039;ht_capab&#039; &#039;SHORT-GI-40&#039;
        list &#039;ht_capab&#039; &#039;TX-STBC&#039;
        list &#039;ht_capab&#039; &#039;RX-STBC1&#039;
        list &#039;ht_capab&#039; &#039;DSSS_CCK-40&#039;
        option &#039;country&#039; &#039;NL&#039;
        option &#039;channel&#039; &#039;48&#039;
        option &#039;txpower&#039; &#039;17&#039;
        option &#039;htmode&#039; &#039;HT40-&#039;

config &#039;wifi-iface&#039;
        option &#039;device&#039; &#039;radio1&#039;
        option &#039;mode&#039; &#039;ap&#039;
        option &#039;network&#039; &#039;lan&#039;
        option &#039;ssid&#039; &#039;vs34-50&#039;
        option &#039;encryption&#039; &#039;psk2&#039;
        option &#039;key&#039; &#039;secret&#039;</code></pre></div><p>Besides these issues I would like to thank you all for the good work.</p><p>Any help with this issue would me very much appreciated.</p><p>kind regards</p><p>Jouk Hettema</p>											<p class="post-edited">(Last edited by <strong>jouk</strong> on 6 Jan 2011, 10:28)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p124987">
				<div class="post-metadata">
					<div class="post-num">Post #262</div>
					<div class="post-author">sequentur</div>
					<div class="post-datetime">
						9 Jan 2011, 22:29					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>jouk wrote:</cite><blockquote><p>But when I configure and run multiwan the system spontaniously reboots! Configuration of my network is very standard (LAN/WAN/WAN2) as is the configuration of multiwan.</p></blockquote></div><p>I have similar problem with a Linksys WRT54GL with Backfire (Two wan ADSL lines balanced with PPoE authentication under OpenWRT). The Linksys reboot unexpectedly, but this only happens the last 3 weeks (???). The multiwan version is 1.0.16. </p><p>Not sure but I think a hardware issue is the problem. </p><p>One week ago I migrate a Backfire 10.03.1-RC4/multiwan 1.0.19 on an Buffalo&nbsp; WZR-HP-G300NH (much more memory and fast CPU). The problem disappear, but now the issue is similar to that posted by &quot;Bad Joker&quot;. After a a wan fail does not reconnect when the ADSL line is up again. And I need manually restart multiwan.</p><div class="quotebox"><cite>Bad Joker wrote:</cite><blockquote><p>The failover does not work for me reliable on the 3g link. After a certain time it declares the connection as dead and disables it. But the modem is still connected (no disconnect in the syslog, the led of the usb dongle is still static on, so hwconnect is there). Also it does not try to do a reconnect. So useless in combination with 3g for me.</p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p125088">
				<div class="post-metadata">
					<div class="post-num">Post #263</div>
					<div class="post-author">dzesiu</div>
					<div class="post-datetime">
						10 Jan 2011, 21:26					</div>
				</div>
				<div class="post-content content">
					<p>Hi!<br />I&#039;ve successfully installed Multi-Wan on my TL-WR-1043ND but i still cannot force torrents to go only through wan2.<br />This is my multiwan config:</p><div class="codebox"><pre><code>config &#039;multiwan&#039; &#039;config&#039;
        option &#039;default_route&#039; &#039;wan&#039;

config &#039;interface&#039; &#039;wan&#039;
        option &#039;weight&#039; &#039;10&#039;
        option &#039;health_interval&#039; &#039;10&#039;
        option &#039;timeout&#039; &#039;3&#039;
        option &#039;health_fail_retries&#039; &#039;3&#039;
        option &#039;health_recovery_retries&#039; &#039;5&#039;
        option &#039;dns&#039; &#039;auto&#039;
        option &#039;icmp_hosts&#039; &#039;disable&#039;
        option &#039;failover_to&#039; &#039;wan2&#039;

config &#039;interface&#039; &#039;wan2&#039;
        option &#039;weight&#039; &#039;10&#039;
        option &#039;health_interval&#039; &#039;10&#039;
        option &#039;timeout&#039; &#039;3&#039;
        option &#039;health_fail_retries&#039; &#039;3&#039;
        option &#039;health_recovery_retries&#039; &#039;5&#039;
        option &#039;failover_to&#039; &#039;balancer&#039;
        option &#039;dns&#039; &#039;auto&#039;
        option &#039;icmp_hosts&#039; &#039;disable&#039;

config &#039;mwanfw&#039;
        option &#039;wanrule&#039; &#039;wan&#039;

config &#039;mwanfw&#039;
        option &#039;proto&#039; &#039;tcp&#039;
        option &#039;ports&#039; &#039;51413&#039;
        option &#039;wanrule&#039; &#039;wan2&#039;</code></pre></div><p>but i still see that transmission still establishes torrent connections on first wan... any ideas?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p126290">
				<div class="post-metadata">
					<div class="post-num">Post #264</div>
					<div class="post-author">Jan.Hetges</div>
					<div class="post-datetime">
						23 Jan 2011, 17:15					</div>
				</div>
				<div class="post-content content">
					<p>Hello Chris<br />thanks for your great script. i&#039;m using it on a ubiquity rs, running backfire-10.03.1-rc4. it works great with clients connected through a static route. but most of the clients in my setup are connected through a mesh network and the mesh routing is done by bmxd which uses routing tables 64/65 and rules 6400/6401, they seem to be deleted by the multiwan script :-(. maybe you&#039;d like to join our discussion here?!&nbsp; <br /><a href="http://lists.bmx6.net/pipermail/bmxd/2011-January/000005.html">http://lists.bmx6.net/pipermail/bmxd/20 … 00005.html</a><br />cheers</p><p>&nbsp; --Jan</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p126631">
				<div class="post-metadata">
					<div class="post-num">Post #265</div>
					<div class="post-author">yeow</div>
					<div class="post-datetime">
						27 Jan 2011, 12:43					</div>
				</div>
				<div class="post-content content">
					<p>Can someone explain to me what is &quot;option &#039;failover_to&#039; &#039;balancer&#039;&quot;? What is the purpose of balancer here?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p126633">
				<div class="post-metadata">
					<div class="post-num">Post #266</div>
					<div class="post-author">Jan.Hetges</div>
					<div class="post-datetime">
						27 Jan 2011, 13:40					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>yeow wrote:</cite><blockquote><p>Can someone explain to me what is &quot;option &#039;failover_to&#039; &#039;balancer&#039;&quot;? What is the purpose of balancer here?</p></blockquote></div><p>think of more than two wan connections</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p126659">
				<div class="post-metadata">
					<div class="post-num">Post #267</div>
					<div class="post-author">sur4die</div>
					<div class="post-datetime">
						27 Jan 2011, 19:53					</div>
				</div>
				<div class="post-content content">
					<p>Does anyone else have a problem with the multiwan script picking up DNS entries for 3g modems?</p><p>multiwan doesn&#039;t seem to pick up my dns entries because it doesn&#039;t seem as though they propagate into the UCI database however they appear in /tmp/resolv.conf.ppp</p><p>anyone have ideas on how I can get DNS working for my cellular modems?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p126687">
				<div class="post-metadata">
					<div class="post-num">Post #268</div>
					<div class="post-author">yeow</div>
					<div class="post-datetime">
						28 Jan 2011, 05:48					</div>
				</div>
				<div class="post-content content">
					<p>So the current 1.0.19 version support more that 2 WAN connections? Anyone has the complete configuration for that? </p><p>The current load balancing is based on round robin scheduler, or how it is done?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p126850">
				<div class="post-metadata">
					<div class="post-num">Post #269</div>
					<div class="post-author">cosmok</div>
					<div class="post-datetime">
						30 Jan 2011, 03:33					</div>
				</div>
				<div class="post-content content">
					<p>Working on a WRT160NL running Backfire (r24038) and 1.0.19-1. I believe my VLANs are setup correctly as the connections will work if only one of the sources are plugged in.&nbsp; Both DIR-412 routers have aircards from the same network, could that be causing issues or does anyone have other ideas? </p><p>multiwan<br /></p><div class="codebox"><pre><code>config &#039;multiwan&#039; &#039;config&#039;
    option &#039;default_route&#039; &#039;balancer&#039;

config &#039;interface&#039; &#039;wan&#039;
    option &#039;weight&#039; &#039;10&#039;
    option &#039;health_interval&#039; &#039;10&#039;
    option &#039;icmp_hosts&#039; &#039;dns&#039;
    option &#039;timeout&#039; &#039;3&#039;
    option &#039;health_fail_retries&#039; &#039;3&#039;
    option &#039;health_recovery_retries&#039; &#039;5&#039;
    option &#039;dns&#039; &#039;auto&#039;
    option &#039;failover_to&#039; &#039;wan1&#039;

config &#039;interface&#039; &#039;wan1&#039;
    option &#039;weight&#039; &#039;10&#039;
    option &#039;health_interval&#039; &#039;10&#039;
    option &#039;timeout&#039; &#039;3&#039;
    option &#039;health_fail_retries&#039; &#039;3&#039;
    option &#039;health_recovery_retries&#039; &#039;5&#039;
    option &#039;failover_to&#039; &#039;balancer&#039;
    option &#039;dns&#039; &#039;auto&#039;
    option &#039;icmp_hosts&#039; &#039;dns&#039;

config &#039;mwanfw&#039;
    option &#039;src&#039; &#039;192.168.1.0/24&#039;
    option &#039;dst&#039; &#039;ftp.netlab7.com&#039;
    option &#039;proto&#039; &#039;tcp&#039;
    option &#039;ports&#039; &#039;21&#039;
    option &#039;wanrule&#039; &#039;lan&#039;

config &#039;mwanfw&#039;
    option &#039;src&#039; &#039;192.168.0.3&#039;
    option &#039;proto&#039; &#039;icmp&#039;
    option &#039;wanrule&#039; &#039;balancer&#039;

config &#039;mwanfw&#039;
    option &#039;dst&#039; &#039;www.whatismyip.com&#039;
    option &#039;wanrule&#039; &#039;fastbalancer&#039;</code></pre></div><p>firewall<br /></p><div class="codebox"><pre><code>config &#039;defaults&#039;
    option &#039;syn_flood&#039; &#039;1&#039;
    option &#039;input&#039; &#039;ACCEPT&#039;
    option &#039;output&#039; &#039;ACCEPT&#039;
    option &#039;forward&#039; &#039;REJECT&#039;

config &#039;zone&#039;
    option &#039;name&#039; &#039;lan&#039;
    option &#039;input&#039; &#039;ACCEPT&#039;
    option &#039;output&#039; &#039;ACCEPT&#039;
    option &#039;forward&#039; &#039;REJECT&#039;

config &#039;zone&#039;
    option &#039;name&#039; &#039;wan&#039;
    option &#039;output&#039; &#039;ACCEPT&#039;
    option &#039;forward&#039; &#039;REJECT&#039;
    option &#039;masq&#039; &#039;1&#039;
    option &#039;mtu_fix&#039; &#039;1&#039;
    option &#039;input&#039; &#039;ACCEPT&#039;

config &#039;forwarding&#039;
    option &#039;src&#039; &#039;lan&#039;
    option &#039;dest&#039; &#039;wan1&#039;

config &#039;rule&#039;
    option &#039;src&#039; &#039;wan&#039;
    option &#039;proto&#039; &#039;udp&#039;
    option &#039;dest_port&#039; &#039;68&#039;
    option &#039;target&#039; &#039;ACCEPT&#039;

config &#039;rule&#039;
    option &#039;src&#039; &#039;wan&#039;
    option &#039;proto&#039; &#039;icmp&#039;
    option &#039;icmp_type&#039; &#039;echo-request&#039;
    option &#039;target&#039; &#039;ACCEPT&#039;

config &#039;include&#039;
    option &#039;path&#039; &#039;/etc/firewall.user&#039;

config &#039;zone&#039;
    option &#039;name&#039; &#039;wan1&#039;
    option &#039;input&#039; &#039;ACCEPT&#039;
    option &#039;output&#039; &#039;ACCEPT&#039;
    option &#039;forward&#039; &#039;REJECT&#039;
    option &#039;masq&#039; &#039;1&#039;
    option &#039;mtu_fix&#039; &#039;1&#039;
    option &#039;network&#039; &#039;wan1&#039;

config &#039;forwarding&#039;
    option &#039;src&#039; &#039;lan&#039;
    option &#039;dest&#039; &#039;wan&#039;

config &#039;forwarding&#039;
    option &#039;src&#039; &#039;lan&#039;
    option &#039;dest&#039; &#039;lan&#039;

config &#039;rule&#039;
    option &#039;target&#039; &#039;ACCEPT&#039;
    option &#039;src&#039; &#039;wan1&#039;
    option &#039;proto&#039; &#039;udp&#039;

config &#039;rule&#039;
    option &#039;target&#039; &#039;ACCEPT&#039;
    option &#039;src&#039; &#039;wan1&#039;
    option &#039;proto&#039; &#039;icmp&#039;</code></pre></div><p>network<br /></p><div class="codebox"><pre><code>config interface loopback
    option ifname    lo
    option proto    static
    option ipaddr    127.0.0.1
    option netmask    255.0.0.0

config interface lan
    option ifname    eth0.1
    option type    bridge
    option proto    static
    option ipaddr    192.168.1.1
    option netmask    255.255.255.0

config interface wan
    option ifname    eth1
    option proto    dhcp

config interface wan1
    option ifname    eth0.2
    option proto    dhcp

config switch rtl8306sd
    option name    eth0
    option reset    1
    option enable_vlan 1

config switch_vlan
    option device    eth0
    option vlan    1
    option ports    &quot;1 2 3 4*&quot;

config switch_vlan
    option device    eth0
    option vlan    2
    option ports    &quot;0 4t&quot;</code></pre></div>											<p class="post-edited">(Last edited by <strong>cosmok</strong> on 30 Jan 2011, 03:34)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p126852">
				<div class="post-metadata">
					<div class="post-num">Post #270</div>
					<div class="post-author">cosmok</div>
					<div class="post-datetime">
						30 Jan 2011, 04:20					</div>
				</div>
				<div class="post-content content">
					<p>Got it working, if you&#039;re using two similar connection sources make sure they are different from eachother (192.168.2.1 and 192.168.1.1, both of mine were 192.168.0.1 and 192.168.0.2).&nbsp; I had clients working off both so I had to finish this up once everyone got off both networks.&nbsp; Thanks for the posts and the scripts.</p>											<p class="post-edited">(Last edited by <strong>cosmok</strong> on 30 Jan 2011, 15:20)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p127618">
				<div class="post-metadata">
					<div class="post-num">Post #271</div>
					<div class="post-author">Priyantha Bleeker</div>
					<div class="post-datetime">
						8 Feb 2011, 00:20					</div>
				</div>
				<div class="post-content content">
					<p>Is it possible to use something like &quot;weighted fair queueing&quot; to load-balance ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p129886">
				<div class="post-metadata">
					<div class="post-num">Post #272</div>
					<div class="post-author">Black6spdZ</div>
					<div class="post-datetime">
						4 Mar 2011, 03:37					</div>
				</div>
				<div class="post-content content">
					<p>I am trying to re-install multiwan but the luci app is offline. does anyone have it on a mirror somewhere? luci-app-multiwan</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p130090">
				<div class="post-metadata">
					<div class="post-num">Post #273</div>
					<div class="post-author">Nilfred</div>
					<div class="post-datetime">
						7 Mar 2011, 11:15					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>pio wrote:</cite><blockquote><p>I whipped up a thing allowing you to specify failover_to per wmanfw item in the config:</p><p><a href="http://pio.longstair.com/misc/multiwan_per_mwanfw_failover.patch.txt">http://pio.longstair.com/misc/multiwan_ … .patch.txt</a></p><p>I emailed more details to SouthPawn.. if you are brave, give it a shot!</p></blockquote></div><p>The change is incompatible with former version as failover_to is required:<br /></p><div class="quotebox"><cite>multiwan_per_mwanfw_failover.patch.txt wrote:</cite><blockquote><p>+&nbsp; &nbsp; if [ -z &quot;$failover_to&quot; -o -z &quot;$wanrule&quot; ]; then<br />+&nbsp; &nbsp; return<br />+&nbsp; &nbsp; fi</p></blockquote></div><p>IMMO if failover_to is empty then use the same interface as wanrule to make it backwards compatible.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p130891">
				<div class="post-metadata">
					<div class="post-num">Post #274</div>
					<div class="post-author">skerit</div>
					<div class="post-datetime">
						16 Mar 2011, 18:23					</div>
				</div>
				<div class="post-content content">
					<p>Where can I get the latest version?<br />The netlab ftp seems to be down, and I&#039;m stuck with a very buggy 1.0.16 version.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p130892">
				<div class="post-metadata">
					<div class="post-num">Post #275</div>
					<div class="post-author">sur4die</div>
					<div class="post-datetime">
						16 Mar 2011, 18:36					</div>
				</div>
				<div class="post-content content">
					<p>1.0.19 is available in the 10.03.1-rc4 repository<br /><a href="http://downloads.openwrt.org/backfire/10.03.1-rc4/">http://downloads.openwrt.org/backfire/10.03.1-rc4/</a></p>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 11 of 14</div><nav><ul><li><a href="viewtopic.php%3Fid=23904&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=23904&amp;p=9.html">9</a></li><li><a href="viewtopic.php%3Fid=23904&amp;p=10.html">10</a></li><li class="pagination-current"><span>11</span></li><li><a href="viewtopic.php%3Fid=23904&amp;p=12.html">12</a></li><li><a href="viewtopic.php%3Fid=23904&amp;p=13.html">13</a></li><li><a href="viewtopic.php%3Fid=23904&amp;p=14.html">14</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0.001 -->

</body>
</html>