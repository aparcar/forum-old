<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Repeater configurations here! Both ways, bridged and simple repeater</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 5 Oct 2014 and 6 May 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 11</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=39077&amp;p=2.html">2</a></li><li><a href="viewtopic.php%3Fid=39077&amp;p=3.html">3</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39077&amp;p=11.html">11</a></li></ul></nav></div>
			
		
		
			<article class="post" id="p176718">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">dabyd64</div>
					<div class="post-datetime">
						3 Sep 2012, 02:00					</div>
				</div>
				<div class="post-content content">
					<p>Due I&#039;m seeing a lot of confusion to make a repeater with OpenWRT, I will put the 2 modes available, with its configs.<br />I hope its easy to understand.<br />Of course, first install the latest Trunk version of OpenWrt:<br /><a href="http://downloads.openwrt.org/snapshots/trunk/">http://downloads.openwrt.org/snapshots/trunk/</a><br /><strong><span style="color: red">Working in Atheros hardware and Attitude Adjustment. I don&#039;t know if it works on other hardware or OpenWrt versions.</span></strong></p><p><strong><span style="color: red">MODE 1: BRIDGED REPEATER</span></strong></p><p>Both wireless networks will be the same network, DHCP addresses wil be given by the main router, all computers will see each other.</p><p>First connect the router to internet, by connecting an ethernet cable between the openwrt&#039;s router WAN port and the main router.<br />Install Relayd<br /></p><div class="codebox"><pre><code>opkg update 
opkg install relayd
/etc/init.d/relayd enable</code></pre></div><p>.<br />.<br /><strong>/etc/config/wireless</strong><br /></p><div class="codebox"><pre><code>config wifi-device &#039;radio0&#039;
        #blahblah (default settings)
    option channel &#039;1&#039;         #Match with the main wireless network channel
    option disabled &#039;0&#039;

config wifi-iface
    option ssid &#039;MainWirelessNetwork&#039;
    option encryption &#039;psk&#039;        # Set wep, psk or psk2 for WEP, WPA or WPA2
    option device &#039;radio0&#039;
    option mode &#039;sta&#039;
    option network &#039;wwan&#039;
    option key &#039;MainRouterWirelessPassword&#039;

config wifi-iface
    option device &#039;radio0&#039;
    option mode &#039;ap&#039;
    option ssid &#039;RepeaterWirelessNetwork&#039;
    option encryption &#039;psk&#039;
    option key &#039;RepeaterWirelessPassword&#039;
    option network &#039;lan&#039;</code></pre></div><p>.<br />.<br /><strong>/etc/config/network</strong><br /></p><div class="codebox"><pre><code>config interface &#039;loopback&#039;
    option ifname &#039;lo&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;127.0.0.1&#039;
    option netmask &#039;255.0.0.0&#039;

config interface &#039;lan&#039;
    option ifname &#039;eth0&#039;
    option type &#039;bridge&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;192.168.10.1&#039;
    option gateway &#039;192.168.1.1&#039;   # Your main router&#039;s IP
    option netmask &#039;255.255.255.0&#039;
    option dns     &#039;192.168.1.1&#039;

config interface &#039;wwan&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;192.168.1.254&#039; #match you main router network 192.168.x.254
    option netmask &#039;255.255.255.0&#039; 
    option gateway &#039;192.168.1.1&#039;   #your main router&#039;s IP

config &#039;interface&#039; &#039;stabridge&#039; 
    option &#039;proto&#039; &#039;relay&#039; 
    option &#039;network&#039; &#039;lan wwan&#039; 
    option ipaddr &#039;192.168.1.254&#039; #Same IP as in WWAN</code></pre></div><p>.<br />.<br /><strong>/etc/config/dhcp</strong><br /></p><div class="codebox"><pre><code>config dhcp lan
    option interface    lan
    option start     100
    option limit    150
    option leasetime    12h
    option ignore    1

config dhcp wan
    option interface    wan
    option ignore    1</code></pre></div><br /><p>As we want to make all the same network, we can disable the firewall:<br /></p><div class="codebox"><pre><code>/etc/init.d/firewall stop
/etc/init.d/firewall disable</code></pre></div><p><span style="color: blue">Update 04/09/2015</span><br />Some users had trouble accesing shared services. This should fix them (thanks <strong>panni</strong>!):</p><div class="quotebox"><cite>panni wrote:</cite><blockquote><p>Install igmpproxy:</p><div class="codebox"><pre><code>opkg install igmpproxy</code></pre></div><p>Then edit the file /etc/config/igmpproxy<br />Make it look like this:</p><div class="codebox"><pre><code>config igmpproxy
    option quickleave 1

config phyint
    option network wwan
    option direction upstream
    list altnet 192.168.0.0/24

config phyint
    option network lan
    option direction downstream
    list altnet 192.168.0.0/24</code></pre></div></blockquote></div><br /><p><strong><span style="color: red">MODE 2: REPEATER, DIFFERENT NETWORK</span></strong></p><p>Repeater&#039;s clients will be able to see Main Network&#039;s devices, but not vice versa.<br />Addresses in the Repeater network are managed by the repeater.</p><p>Nothing has to be downloaded, the stock openwrt is enought. This is the easiest and simplest way of making a repeater</p><p><strong>/etc/config/wireless</strong><br /></p><div class="codebox"><pre><code>config wifi-device &#039;radio0&#039;
    #blahblah (default settings)
    option disabled &#039;0&#039;
    option channel &#039;1&#039;       #Match with the main wireless network channel

config wifi-iface
    option ssid &#039;MainWirelessNetwork&#039;
    option encryption &#039;psk&#039;        # Set wep, psk or psk2 for WEP, WPA or WPA2
    option device &#039;radio0&#039;
    option mode &#039;sta&#039;
    option network &#039;wwan&#039;
    option key &#039;MainRouterWirelessPassword&#039;

config wifi-iface
    option device &#039;radio0&#039;

    option mode &#039;ap&#039;
    option ssid &#039;RepeaterWirelessNetwork&#039;
    option encryption &#039;psk&#039;
    option key &#039;RepeaterWirelessPassword&#039;
    option network &#039;lan&#039;</code></pre></div><p>.<br />.<br /><strong>/etc/config/network</strong><br /></p><div class="codebox"><pre><code>config interface &#039;loopback&#039;
    option ifname &#039;lo&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;127.0.0.1&#039;
    option netmask &#039;255.0.0.0&#039;

config interface &#039;lan&#039;
    option ifname &#039;eth0&#039;
    option type &#039;bridge&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;192.168.10.1&#039;    #set to different range of your main router&#039;s network&quot;&quot;
    option netmask &#039;255.255.255.0&#039;

config interface &#039;wwan&#039;
    option proto &#039;dhcp&#039;</code></pre></div><p>.<br />.<br /><strong>/etc/config/dhcp</strong><br /></p><div class="codebox"><pre><code>config dhcp lan
    option interface    lan
    option start     100
    option limit    150
    option leasetime    12h
    option ignore    0

config dhcp wan
    option interface    wan
    option ignore    1</code></pre></div><p>.<br />.<br /><strong>/etc/config/firewall</strong><br /></p><div class="codebox"><pre><code>config defaults
    option syn_flood &#039;1&#039;
    option input &#039;ACCEPT&#039;
    option output &#039;ACCEPT&#039;
    option forward &#039;REJECT&#039;

config zone
    option name &#039;lan&#039;
    option network &#039;lan&#039;
    option input &#039;ACCEPT&#039;
    option output &#039;ACCEPT&#039;
    option forward &#039;REJECT&#039;

config zone
    option name &#039;wan&#039;
    option input &#039;REJECT&#039;
    option output &#039;ACCEPT&#039;
    option forward &#039;REJECT&#039;
    option masq &#039;1&#039;
    option mtu_fix &#039;1&#039;
    option network &#039;wan wwan&#039;

config forwarding
    option src &#039;lan&#039;
    option dest &#039;wan&#039;</code></pre></div><p>Once internet is running, its easy to install LuCi to get the nice web interface:<br /></p><div class="codebox"><pre><code>opkg update
opkg install luci

AND, IF YOU INSTALLED RELAYD
opkg install luci-proto-relay</code></pre></div><p>I have tested both and they work. I think this are the easiest configs for making a repeater.</p><p>Edit the files manually with the VI editor.<br />If you don&#039;t know how to use it, check this:<br /><span style="color: red">---------------------------------------------------------------------------</span><br /><span style="color: red"><strong>vi editor small tutorial</strong></span><br />Let&#039;s edit &quot;network&quot; file<br /></p><div class="quotebox"><blockquote><p>vi network</p></blockquote></div><p>Now, navigate with the arrow keys to the line you want to read, modify, etc.<br />To start writing first type &quot;i&quot; (command to insert).<br />Now you can write, delete, etc as usual.<br />To exit the insert mode press &quot;ESC&quot;.<br />To delete an entire line, press &quot;d&quot; twice.<br />Finally, to save the file press &quot;Z&quot; twice. Yes it must be UPPERCASE<br />If you screwed your file and want to discard changes press control+z to close without saving.</p><br /><p>Regards</p>											<p class="post-edited">(Last edited by <strong>dabyd64</strong> on 4 Sep 2015, 01:28)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p176739">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">written_direcon</div>
					<div class="post-datetime">
						3 Sep 2012, 09:06					</div>
				</div>
				<div class="post-content content">
					<p>Good howto, but it&#039;s already in the OpenWrt Wiki!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p176804">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">dabyd64</div>
					<div class="post-datetime">
						3 Sep 2012, 21:38					</div>
				</div>
				<div class="post-content content">
					<p>Yes, but the wiki has a problem, that is that most of people understand &quot;repeater&quot; but not &quot;bridged/unbridged wireless network&quot;.<br />That&#039;s why I said &quot;repeater&quot;. 99% of people search repeater.<br />I had the same problem too, at the beginning is hard to find and understand all the info.</p><p>Typing &quot;repeater&quot; in the wiki search won&#039;t show you anything useful at first, try it. For the noobs this is a real problem.</p>											<p class="post-edited">(Last edited by <strong>dabyd64</strong> on 15 May 2013, 16:26)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p176818">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">kakonema</div>
					<div class="post-datetime">
						4 Sep 2012, 04:25					</div>
				</div>
				<div class="post-content content">
					<p>Hi, i&#039;m new to this so bear with me, today i installed openwrt over ddwrt and learned how uci works and thats about it of my knowledge, so i&#039;ve managed to set bridge using this article <a href="http://wiki.openwrt.org/doc/recipes/bridgedclient">http://wiki.openwrt.org/doc/recipes/bridgedclient</a><br />using brcm 2.4 openwrt but there is nothing about virtual AP part of bridged router but picture clearly shows that both sides have their lan and wlan part functional. I see in this howto that second wireless config adds AP part but i&#039;m confused about network configuration and all the IP addreses and the relayd part because i dont use relayd for bridge so i&#039;m not sure if this configuration will work with mine so if anyone could write a step by step after this configuration <a href="http://wiki.openwrt.org/doc/recipes/bridgedclient">http://wiki.openwrt.org/doc/recipes/bridgedclient</a> i will be really grateful, btw primary router is 192.168.1.1 dhcp and bridged one is 192.168.1.2 static.<br />Thanks!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p176859">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">dabyd64</div>
					<div class="post-datetime">
						4 Sep 2012, 15:38					</div>
				</div>
				<div class="post-content content">
					<p>Do you really want to bridge both networks or just a wireless repeater for surfing? the second doesn&#039;t need relayd.<br />Also, tell us your router model, openwrt version...<br />Post here your configs to be easier to tell you.<br />Rememer to but your configs like this:<br /></p><div class="codebox"><pre><code>Example:

wireless

[c0de]
blah
blah
blah
[/c0de]

The text betweeen the [c0de] and[/c0de] will be showed like this text box, a lot tidier for reading
Logically its &quot;code&quot; and not &quot;c0de&quot;, just typed as that to avoid breaking the sintax in this box.</code></pre></div>											<p class="post-edited">(Last edited by <strong>dabyd64</strong> on 4 Sep 2012, 15:44)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p176863">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">kakonema</div>
					<div class="post-datetime">
						4 Sep 2012, 15:53					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>dabyd64 wrote:</cite><blockquote><p>Do you really want to bridge both networks or just a wireless repeater for surfing? the second doesn&#039;t need relayd.<br />Also, tell us your router model, openwrt version...<br />Post here your configs to be easier to tell you.<br />Rememer to but your configs like this:<br /></p><div class="codebox"><pre><code>Example:

wireless

[c0de]
blah
blah
blah
[/c0de]

The text betweeen the [c0de] and[/c0de] will be showed like this text box, a lot tidier for reading
Logically its &quot;code&quot; and not &quot;c0de&quot;, just typed as that to avoid breaking the sintax in this box.</code></pre></div></blockquote></div><p>Thanks for answering, i found this article <a href="http://wiki.openwrt.org/doc/recipes/broadcom.repeater">http://wiki.openwrt.org/doc/recipes/broadcom.repeater</a> i want that but bridged on the same subnet so what i want is wireless repeater bridge.</p><p>Router is wrt54gs 1.1 backfire 10.03.1 brcm 2.4</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p176867">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">dabyd64</div>
					<div class="post-datetime">
						4 Sep 2012, 16:32					</div>
				</div>
				<div class="post-content content">
					<p>Then do the config #1.<br />You know how to enter the router by telnet and editing the config files?<br />The first you need is to give internet to the router so it can download the relayd package.<br />Can you reach that point yourself?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p176941">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">kakonema</div>
					<div class="post-datetime">
						5 Sep 2012, 08:58					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>dabyd64 wrote:</cite><blockquote><p>Then do the config #1.<br />You know how to enter the router by telnet and editing the config files?<br />The first you need is to give internet to the router so it can download the relayd package.<br />Can you reach that point yourself?</p></blockquote></div><p>I know how to edit config files and bridged the router and internet is working but i dont have a virtual wireless ap on the bridged router which means that i can use lan ports with network and internet but dont have wireless signal from router.<br />relayd package doesn&#039;t exist for brcm-2.4 build.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p176952">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">kakonema</div>
					<div class="post-datetime">
						5 Sep 2012, 13:10					</div>
				</div>
				<div class="post-content content">
					<p>Followed this <a href="http://wiki.openwrt.org/doc/recipes/broadcom.repeater">http://wiki.openwrt.org/doc/recipes/broadcom.repeater</a> i cant get AP part working, i think that eth0.0 and wl0 are not bridged, the notes say </p><div class="quotebox"><blockquote><p>If you run `brctl show&#039; you will see that eth0.0 and wl0.1 are bridged.</p></blockquote></div><p>but i get this <br /></p><div class="codebox"><pre><code>bridge name     bridge id               STP enabled     interfaces
br-lan          8000.0013107cd1da       no              eth0.0</code></pre></div><p>is this right?<br />Here are config</p><p>/etc/config/wireless<br /></p><div class="codebox"><pre><code>config wifi-device  wl0
    option type     broadcom
    option channel  11

    # REMOVE THIS LINE TO ENABLE WIFI:
    option disabled 0

config wifi-iface
    option device   wl0
    option network    lan
    option mode     ap
    option ssid     Secondary
    option encryption psk2
    option key    &#039;network&#039;

config wifi-iface
    option device wl0
    option network wan
    option mode    sta
    option ssid    &#039;Main&#039;
    option encryption none</code></pre></div><p>/etc/config/network<br /></p><div class="codebox"><pre><code>#### VLAN configuration 
config switch eth0
    option enable   1

config switch_vlan eth0_0
    option device   &quot;eth0&quot;
    option vlan     0
    option ports    &quot;1 2 3 4 5*&quot;

config switch_vlan eth0_1
    option device   &quot;eth0&quot;
    option vlan     1
    option ports    &quot;0 5&quot;

#### Loopback configuration
config interface loopback
    option ifname    &quot;lo&quot;
    option proto    static
    option ipaddr    127.0.0.1
    option netmask 255.0.0.0


#### LAN configuration
config interface lan
    option type     bridge
    option ifname    &#039;eth0.0&#039;
    option proto    &#039;static&#039;
    option ipaddr    &#039;10.0.0.1&#039;
    option netmask    &#039;255.255.255.0&#039;
    option gateway &#039;&#039; 
    option dns &#039;&#039;

#### WAN configuration
config interface    wan
    option proto    &#039;dhcp&#039;</code></pre></div><p>Any clue?</p>											<p class="post-edited">(Last edited by <strong>kakonema</strong> on 5 Sep 2012, 13:10)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p176983">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">dabyd64</div>
					<div class="post-datetime">
						5 Sep 2012, 18:05					</div>
				</div>
				<div class="post-content content">
					<p>This configs are tested in Attitude Adjustment, and Atheros hardware, I have no idea how the Broadcom hardware works since I have never touched any router with it.<br />Have you tested the latest trunk version for your router?<br /><a href="http://downloads.openwrt.org/snapshots/trunk/brcm47xx/">http://downloads.openwrt.org/snapshots/trunk/brcm47xx/</a></p>											<p class="post-edited">(Last edited by <strong>dabyd64</strong> on 5 Sep 2012, 18:15)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p177111">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">dabyd64</div>
					<div class="post-datetime">
						6 Sep 2012, 14:54					</div>
				</div>
				<div class="post-content content">
					<p>Did you download the relayd package first? Can the router connect to internet? (do &quot;ping google.es&quot; in the console)<br />Paste your configs here, and also put the primary router IP address.</p><p>I&#039;, not sure about the firewall rule..I will check if I can do anything at home.</p>											<p class="post-edited">(Last edited by <strong>dabyd64</strong> on 6 Sep 2012, 14:56)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p177239">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">dabyd64</div>
					<div class="post-datetime">
						7 Sep 2012, 13:18					</div>
				</div>
				<div class="post-content content">
					<p>Oops I see, I didn&#039;t realise of that line &quot;Edit: I found out what was wrong, in dhcp file, I needed to add this section..&quot;<br />I just had saw the configs and the last part hehe, you tricked me <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" />.<br />Nice you fixed it! And of course, thanks for posting your problem and how you fixed it, making it available for everybody, in this thread.<br />A big problem in this forum is that there are a lots of posts about similar problems, so its hard to find them.<br />Doing it here, will keep the topic up and track all the issues for people who tries the repeater.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p177522">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">dabyd64</div>
					<div class="post-datetime">
						9 Sep 2012, 13:55					</div>
				</div>
				<div class="post-content content">
					<p>Do it as you always did. Telnet your main router or put its ip on the browser. I didn&#039;t need to do anything on the firewall.<br />I can enter both routers perfectly, 192.168.1.1(main router), 192.168.1.254(opemwrt in bridged mode, config #1), 192.168.10.1(config #2, unbridged mode).<br />By the way,have you tried before asking?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p179279">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">hgrueber</div>
					<div class="post-datetime">
						25 Sep 2012, 04:08					</div>
				</div>
				<div class="post-content content">
					<p>For the life of me I cannot get the bridged repeater mode working as per above. Clients that connect to the Repeater AP do not get assigned DHCP addresses from my main Cisco router. Not sure if I&#039;m doing something wrong or that maybe this just isn&#039;t supported under the firmware I&#039;m running.</p><p>Repeater hardware is TP-Link 1043ND running Attitude Adjustment 12.09-beta. Firewall and dnsmasq is shutdown and Relayd is confirmed as running. I can succesfully connect to the wwan ip address via the wireless connection for management purposes.</p><p>I see in the DHCP server logs on the router that the requests come through and a response is sent but no reponse is received from the device.</p><p><strong>Router DHCP log</strong></p><div class="codebox"><pre><code>Sep 25 00:50:02.277: DHCPD: DHCPREQUEST received from client 0104.4665.75a5.22.
Sep 25 00:50:02.277: DHCPD: Sending notification of ASSIGNMENT:
Sep 25 00:50:02.277:  DHCPD: address 192.168.1.23 mask 255.255.255.224
Sep 25 00:50:02.277:   DHCPD: htype 1 chaddr 0446.6575.a522
Sep 25 00:50:02.277:   DHCPD: lease time remaining (secs) = 2592000
Sep 25 00:50:02.277: DHCPD: Appending system default domain
Sep 25 00:50:02.277: DHCPD: Using hostname &#039;android-b07bf949c8721c81&#039; for dynamic update (from hostname option)
Sep 25 00:50:02.277: DHCPD: Sending DHCPACK to client 0104.4665.75a5.22 (192.168.1.23).
Sep 25 00:50:02.277: DHCPD: broadcasting BOOTREPLY to client 0446.6575.a522.
Sep 25 00:50:03.905: DHCPD: client&#039;s VPN is .
Sep 25 00:50:03.905: DHCPD: Sending notification of DISCOVER:
Sep 25 00:50:03.905:   DHCPD: htype 1 chaddr 0446.6575.a522
Sep 25 00:50:03.905:   DHCPD: remote id 020a0000c0a8011e00000001
Sep 25 00:50:03.905:   DHCPD: circuit id 00000000
Sep 25 00:50:03.905: DHCPD: DHCPDISCOVER received from client 0104.4665.75a5.22 on interface Vlan1.
Sep 25 00:50:03.905: DHCPD: Seeing if there is an internally specified pool class:
Sep 25 00:50:03.905:   DHCPD: htype 1 chaddr 0446.6575.a522
Sep 25 00:50:03.905:   DHCPD: remote id 020a0000c0a8011e00000001
Sep 25 00:50:03.905:   DHCPD: circuit id 00000000
Sep 25 00:50:03.905: DHCPD: Found previous server binding
Sep 25 00:50:03.905: DHCPD: Sending DHCPOFFER to client 0104.4665.75a5.22 (192.168.1.23).
Sep 25 00:50:03.905: DHCPD: broadcasting BOOTREPLY to client 0446.6575.a522.
Sep 25 00:50:08.389: DHCPD: client&#039;s VPN is .
Sep 25 00:50:08.389: DHCPD: Sending notification of DISCOVER:
Sep 25 00:50:08.389:   DHCPD: htype 1 chaddr 0446.6575.a522
Sep 25 00:50:08.389:   DHCPD: remote id 020a0000c0a8011e00000001
Sep 25 00:50:08.389:   DHCPD: circuit id 00000000
Sep 25 00:50:08.389: DHCPD: DHCPDISCOVER received from client 0104.4665.75a5.22 on interface Vlan1.
Sep 25 00:50:08.389: DHCPD: Seeing if there is an internally specified pool class:
Sep 25 00:50:08.389:   DHCPD: htype 1 chaddr 0446.6575.a522
Sep 25 00:50:08.389:   DHCPD: remote id 020a0000c0a8011e00000001
Sep 25 00:50:08.389:   DHCPD: circuit id 00000000
Sep 25 00:50:08.389: DHCPD: Found previous server binding
Sep 25 00:50:08.389: DHCPD: Sending DHCPOFFER to client 0104.4665.75a5.22 (192.168.1.23).
Sep 25 00:50:08.389: DHCPD: broadcasting BOOTREPLY to client 0446.6575.a522.</code></pre></div><p>Looking at packet captures I can see the DHCP responses getting broadcasted throughout the network to 255.255.255.255.</p><p>Anyhow I suspect relayd on the repeater isn&#039;t forwarding the broadcast responses through to my device requesting a DHCP address.</p><p>Config as follows:</p><p><strong>/etc/config/network</strong></p><div class="codebox"><pre><code>config interface &#039;loopback&#039;
        option ifname &#039;lo&#039;
        option proto &#039;static&#039;
        option ipaddr &#039;127.0.0.1&#039;
        option netmask &#039;255.0.0.0&#039;

config interface &#039;wan&#039;
        option ifname &#039;eth0.2&#039;
        option proto &#039;dhcp&#039;

config switch
        option name &#039;rtl8366rb&#039;
        option reset &#039;1&#039;
        option enable_vlan &#039;1&#039;
        option enable_vlan4k &#039;1&#039;

config switch_vlan
        option device &#039;rtl8366rb&#039;
        option vlan &#039;1&#039;
        option ports &#039;1 2 3 4 5t&#039;

config switch_vlan
        option device &#039;rtl8366rb&#039;
        option vlan &#039;2&#039;
        option ports &#039;0 5t&#039;

config interface &#039;wwan&#039;
        option proto &#039;dhcp&#039;

config interface &#039;lan&#039;
        option proto &#039;static&#039;
        option ipaddr &#039;192.168.2.1&#039;
        option netmask &#039;255.255.255.0&#039;
        option type &#039;bridge&#039;
 
config interface &#039;stabridge&#039;
        option proto &#039;relay&#039;
        option ipaddr &#039;192.168.1.26&#039;
        option network &#039;lan wwan&#039;
        list network &#039;lan wwan&#039;</code></pre></div><p><strong>/etc/config/wireless</strong></p><div class="codebox"><pre><code>config wifi-device &#039;radio0&#039;
        option type &#039;mac80211&#039;
        option macaddr &#039;b0:48:7a:db:57:6a&#039;
        list ht_capab &#039;SHORT-GI-40&#039;
        list ht_capab &#039;DSSS_CCK-40&#039;
        option distance &#039;20&#039;
        option country &#039;US&#039;
        option txpower &#039;20&#039;
        option channel &#039;4&#039;
        option noscan &#039;1&#039;

config wifi-iface
        option device &#039;radio0&#039;
        option mode &#039;sta&#039;
        option ssid &#039;MY_SSID&#039;
        option encryption &#039;psk2&#039;
        option key &#039;KEY&#039;
        option network &#039;wwan&#039;

config wifi-iface
        option device &#039;radio0&#039;
        option key &#039;KEY&#039;
        option mode &#039;ap&#039;
        option encryption &#039;psk2&#039;
        option ssid &#039;MY_SSID&#039;
        option network &#039;lan&#039;</code></pre></div><p><strong>/etc/config/dhcp</strong></p><div class="codebox"><pre><code>config dnsmasq
        option domainneeded &#039;1&#039;
        option boguspriv &#039;1&#039;
        option filterwin2k &#039;0&#039;
        option localise_queries &#039;1&#039;
        option rebind_protection &#039;1&#039;
        option rebind_localhost &#039;1&#039;
        option local &#039;/lan/&#039;
        option domain &#039;lan&#039;
        option expandhosts &#039;1&#039;
        option nonegcache &#039;0&#039;
        option authoritative &#039;1&#039;
        option readethers &#039;1&#039;
        option leasefile &#039;/tmp/dhcp.leases&#039;
        option resolvfile &#039;/tmp/resolv.conf.auto&#039;

config dhcp &#039;lan&#039;
        option interface &#039;lan&#039;
        option ignore &#039;1&#039;

config dhcp &#039;wan&#039;
        option interface &#039;wan&#039;
        option ignore &#039;1&#039;</code></pre></div><p><strong>/etc/config/firewall</strong></p><div class="codebox"><pre><code>config defaults
        option syn_flood &#039;1&#039;
        option input &#039;ACCEPT&#039;
        option output &#039;ACCEPT&#039;
        option forward &#039;ACCEPT&#039;

config zone
        option name &#039;lan&#039;
        option input &#039;ACCEPT&#039;
        option output &#039;ACCEPT&#039;
        option forward &#039;ACCEPT&#039;
        option network &#039;lan wwan stabridge&#039;

config zone
        option name &#039;wan&#039;
        option input &#039;REJECT&#039;
        option output &#039;ACCEPT&#039;
        option forward &#039;REJECT&#039;
        option masq &#039;1&#039;
        option mtu_fix &#039;1&#039;
        option network &#039;wan&#039;

config forwarding
        option src &#039;lan&#039;
        option dest &#039;wan&#039;</code></pre></div>											<p class="post-edited">(Last edited by <strong>hgrueber</strong> on 25 Sep 2012, 05:29)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p179312">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">dabyd64</div>
					<div class="post-datetime">
						25 Sep 2012, 11:47					</div>
				</div>
				<div class="post-content content">
					<p>did you tried disabling the firewall?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p179323">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">hgrueber</div>
					<div class="post-datetime">
						25 Sep 2012, 14:37					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>dabyd64 wrote:</cite><blockquote><p>did you tried disabling the firewall?</p></blockquote></div><p>Hey,</p><p>Yes, firewall is disabled (I put in the config above anyway as I have tried with and without).</p><p>I am running OpenWrt Attitude Adjustment r33482.</p><p>I found this bug report for r33212 which mentions the same problem I am experiencing.<br />Not sure if related but looks like I&#039;m not the only one who has seen this issue with relayd not forwarding dhcp.</p><p><a href="https://dev.openwrt.org/ticket/12063">https://dev.openwrt.org/ticket/12063</a></p>											<p class="post-edited">(Last edited by <strong>hgrueber</strong> on 25 Sep 2012, 14:38)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p179347">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">dabyd64</div>
					<div class="post-datetime">
						25 Sep 2012, 20:00					</div>
				</div>
				<div class="post-content content">
					<p>There are some routers that doesn&#039;t work with relayd.<br />For example, with some Hitron routers, relayd won&#039;t work, so I have to do routing... I have no idea why.<br />It seems that the router doesn&#039;t release the DHCP address for the same mac, the wireless client &#039;iface&#039; will request all DHCP addresses for all the clients in Openwrt&#039;s network...maybe its something about that.<br />But no idea!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p179389">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">hgrueber</div>
					<div class="post-datetime">
						26 Sep 2012, 07:41					</div>
				</div>
				<div class="post-content content">
					<p>Well the DHCP request is sent from the tp-link bridge AP and the response is sent back from the DHCP server to the client mac address. Nothing is received back though on the lan side of the repeater AP. Its almost as if the bridge AP is just throwing it away and not forwarding the DHCP response back through to the repeater AP lan side. Weird.</p><p>Anyhow I managed to get this all working using routed method above in your post. <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /><br />Not the ideal way but it works.<br />Also for some reason it is really unstable if I try to use wireless N, have had to run this router repeater as wireless G only. It is highly unstable when running N for me with constant dropouts, all fine on G though.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p179441">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">dabyd64</div>
					<div class="post-datetime">
						26 Sep 2012, 16:53					</div>
				</div>
				<div class="post-content content">
					<p>Download the latest trunk release (r33482) and try again.<br />Can you try with other router? Or whatever that can give wifi and dhcp addresses. Maybe it&#039;s your main router.<br />For example, if you have and Android phone, enable wifi tether and setup openwrt to connecto to it. Then try if the dhcp works.<br />About the N or G mode, I always use the mode &quot;11ng&quot;. I tried &quot;HT20&quot; and &quot;HT40+&quot; (20 and 40MHz) and both worked well...</p>											<p class="post-edited">(Last edited by <strong>dabyd64</strong> on 26 Sep 2012, 16:55)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p182867">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">alfredlim</div>
					<div class="post-datetime">
						10 Nov 2012, 07:53					</div>
				</div>
				<div class="post-content content">
					<p>Hi dabyd64,<br />I try the first method and it works perfectly. Thanks for sharing, can these be done via luci ?</p><p>I got a small tl wr703n, was thinking when go oversea can use it as a repeater in the hotel room</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p183066">
				<div class="post-metadata">
					<div class="post-num">Post #21</div>
					<div class="post-author">dabyd64</div>
					<div class="post-datetime">
						13 Nov 2012, 00:04					</div>
				</div>
				<div class="post-content content">
					<p>I don&#039;t configure this from the start through Luci, it&#039;s much faster copying the files directly. I have not even tried.</p><p>Once you installed Luci and set the config files, yes, you can configure both wireless interfaces, by going to Network/Wireless on Luci.<br />Changing the SSID, Channel and Security settings takes only a minute <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>											<p class="post-edited">(Last edited by <strong>dabyd64</strong> on 13 Nov 2012, 00:06)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p187278">
				<div class="post-metadata">
					<div class="post-num">Post #22</div>
					<div class="post-author">monotube</div>
					<div class="post-datetime">
						29 Dec 2012, 00:19					</div>
				</div>
				<div class="post-content content">
					<p>Hello,<br />I have tried the MODE 1: BRIDGED REPEATER, and it seems to work, or at least it makes a visible AP. I would however just like to extend my wifi coverage, so I&#039;m wondering if I can select the same name for both the main router and the &quot;option ssid &#039;RepeaterWirelessNetwork&#039;&quot; Or will they interfere in some way so that the repeater looses its connection? I&#039;m asking because the setup is far away and I can&#039;t risk to try if it doesn&#039;t work..<br />So can the repeater be connected to a main router with the same SSID as itself then redistributes? I know it works with WDS but this isn&#039;t the same. Also, I haven&#039;t turned the firewall off, just accepted incoming ssh connections.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p187388">
				<div class="post-metadata">
					<div class="post-num">Post #23</div>
					<div class="post-author">dabyd64</div>
					<div class="post-datetime">
						30 Dec 2012, 15:02					</div>
				</div>
				<div class="post-content content">
					<p>You can name your repeater with the same name.<br />However, I don&#039;t recommend to do that, my experiences say that some devices get confused and sometimes they connect to the weak signal from the main router, and&nbsp; others they do to the strong from openwrt, and so on.<br />It can be painful if that happens.<br />Easily solved by calling you repeater as &quot;MyNetwork2&quot; for example.<br />If you break wifi (it stops broadcasting the wireless)while testing, don&#039;t worry, connect by ethernet and reconfigure.<br />regards</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p187508">
				<div class="post-metadata">
					<div class="post-num">Post #24</div>
					<div class="post-author">gvego</div>
					<div class="post-datetime">
						31 Dec 2012, 20:14					</div>
				</div>
				<div class="post-content content">
					<p>Can I Use TL-WR740N with OpenWRT as a wireless client while making a PPPOE connection at the same time?</p><p>I have to make a PPPOE connection on every computer I use on my primary router (locked Thomson 780WL).</p><p>I would like to connect to Thomson with my WR740N (not possible by cable, only by wireless) router and have Internet access from it.</p><p>I would like to know if this is possible without having to buy a third router (that would make PPPOE connection via wan port).</p><p>Thanks in advance!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p189579">
				<div class="post-metadata">
					<div class="post-num">Post #25</div>
					<div class="post-author">aleics</div>
					<div class="post-datetime">
						21 Jan 2013, 23:27					</div>
				</div>
				<div class="post-content content">
					<p>Hi,<br />I have a openwrt HG553 that I&#039;d like to use as repeater of a master WDS Telsey router (not openwrt) linked via wifi, not cable.</p><p>How can I configure HG553 Openwrt wireless and network?<br />It&#039;s the same if i need to use #1 or #2 solution.</p><p>Thanks a lot</p>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 1 of 11</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=39077&amp;p=2.html">2</a></li><li><a href="viewtopic.php%3Fid=39077&amp;p=3.html">3</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39077&amp;p=11.html">11</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>