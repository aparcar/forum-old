<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> can&#039;t buil openwrt for tplink mr3020 when bluez-utils package is added</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 18 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p324164">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">psousa</div>
					<div class="post-datetime">
						16 May 2016, 20:29					</div>
				</div>
				<div class="post-content content">
					<p>Hi guys.</p><p>My project is to transform a tp-mr3020 (v1 I think - bottom label is not readable anymore) on a NMEA server by pairing a vluetooth globalsat GPS<br />It will be useful to use with WiFi only iPad (no 3g, so no GPS inside) with iSailor for navigation purposes<br />This way I will avoid the use of the iPhone as NMEA server (using its inside GPS)</p><p>I have the BT doongle on the USB port. It is detected by the openwrt. The problem is I have no tools to search and pair BT periferals because I can&#039;t build OpenWrt-ImageBuilder-15.05.1-ar71xx-generic.Linux-x86_64 with pakage bluez-utils (bluetooth utilities):<br />make image PROFILE=TLMR3020 PACKAGES=&quot;kmod-bluetooth bluez-libs bluez-utils&quot;</p><p>I mean, it runs ok without errors but files<br />bin/ar71xx/openwrt-15.05.1-ar71xx-generic-tl-mr3020-v1-squashfs-factory.bin<br />bin/ar71xx/openwrt-15.05.1-ar71xx-generic-tl-mr3020-v1-squashfs-sysupgrade.bin<br />are not created.</p><p>If I run<br />make image PROFILE=TLMR3020 PACKAGES=&quot;kmod-bluetooth bluez-libs&quot; (no bluez-utils)<br />everything runs as expected: openwrt-15.05.1-ar71xx-generic-tl-mr3020-v1-squashfs-factory.bin is created, I download it from inside the router, sysupgrade it, reboot and voila! But without bluez-utils I have no &quot;hciconfig&quot; command nor &quot;hcitool&quot; command so I can&#039;t search BT periferals...</p><p>Any tip on this?<br />Any other way to serach and pair bluetooth devices with the usb dongle?</p><div class="codebox"><pre><code>leonardo@leonardo-port:~$ ./sshTpLink 
root@192.168.1.1&#039;s password: 


BusyBox v1.23.2 (2016-01-02 18:01:44 CET) built-in shell (ash)

  _______                     ________        __
 |       |.-----.-----.-----.|  |  |  |.----.|  |_
 |   -   ||  _  |  -__|     ||  |  |  ||   _||   _|
 |_______||   __|_____|__|__||________||__|  |____|
          |__| W I R E L E S S   F R E E D O M
 -----------------------------------------------------
 CHAOS CALMER (15.05.1, r48532)
 -----------------------------------------------------
  * 1 1/2 oz Gin            Shake with a glassful
  * 1/4 oz Triple Sec       of broken ice and pour
  * 3/4 oz Lime Juice       unstrained into a goblet.
  * 1 1/2 oz Orange Juice
  * 1 tsp. Grenadine Syrup
 -----------------------------------------------------
root@OpenWrt:~# </code></pre></div><div class="codebox"><pre><code>root@OpenWrt:~# cat /proc/cpuinfo 
system type             : Atheros AR9330 rev 1
machine                 : TP-LINK TL-MR3020
processor               : 0
cpu model               : MIPS 24Kc V7.4
BogoMIPS                : 265.42
wait instruction        : yes
microsecond timers      : yes
tlb_entries             : 16
extra interrupt vector  : yes
hardware watchpoint     : yes, count: 4, address/irw mask: [0x0ffc, 0x0ffc, 0x0ffb, 0x0ffb]
isa                     : mips1 mips2 mips32r1 mips32r2
ASEs implemented        : mips16
shadow register sets    : 1
kscratch registers      : 0
package                 : 0
core                    : 0
VCED exceptions         : not available
VCEI exceptions         : not available

root@OpenWrt:~# </code></pre></div><div class="codebox"><pre><code>root@OpenWrt:~# cat /proc/meminfo 
MemTotal:          28580 kB
MemFree:            6436 kB
MemAvailable:      13084 kB
Buffers:            2268 kB
Cached:             6044 kB
SwapCached:            0 kB
Active:             6588 kB
Inactive:           3432 kB
Active(anon):       2316 kB
Inactive(anon):       40 kB
Active(file):       4272 kB
Inactive(file):     3392 kB
Unevictable:           0 kB
Mlocked:               0 kB
SwapTotal:             0 kB
SwapFree:              0 kB
Dirty:                 0 kB
Writeback:             0 kB
AnonPages:          1724 kB
Mapped:             2136 kB
Shmem:               648 kB
Slab:               5564 kB
SReclaimable:       1328 kB
SUnreclaim:         4236 kB
KernelStack:         304 kB
PageTables:          228 kB
NFS_Unstable:          0 kB
Bounce:                0 kB
WritebackTmp:          0 kB
CommitLimit:       14288 kB
Committed_AS:       4956 kB
VmallocTotal:    1048372 kB
VmallocUsed:        1620 kB
VmallocChunk:    1041864 kB
root@OpenWrt:~# </code></pre></div><br /><p><strong>Building with &quot;bluez-utils&quot;</strong><br /></p><div class="codebox"><pre><code>make image PROFILE=TLMR3020 PACKAGES=&quot;kmod-bluetooth bluez-libs bluez-utils&quot;</code></pre></div><div class="codebox"><pre><code>leonardo@leonardo-port:~/Downloads/openwrt/OpenWrt-ImageBuilder-15.05.1-ar71xx-generic.Linux-x86_64$ ll bin/ar71xx/
total 21952
drwxrwxr-x 2 leonardo leonardo    4096 May 16 18:21 ./
drwxrwxr-x 3 leonardo leonardo    4096 May 16 18:21 ../
-rw-rw-r-- 1 leonardo leonardo     714 May 16 18:21 md5sums
-rw-rw-r-- 1 leonardo leonardo 4325376 May 16 18:21 openwrt-15.05.1-ar71xx-generic-root.squashfs
-rw-r--r-- 1 leonardo leonardo 4128772 May 16 18:21 openwrt-15.05.1-ar71xx-generic-root.squashfs-64k
-rw-rw-r-- 1 leonardo leonardo 1632083 May 16 18:21 openwrt-15.05.1-ar71xx-generic-uImage-gzip.bin
-rw-rw-r-- 1 leonardo leonardo 1176662 May 16 18:21 openwrt-15.05.1-ar71xx-generic-uImage-lzma.bin
-rwxr-xr-x 1 leonardo leonardo 3556396 May 16 18:21 openwrt-15.05.1-ar71xx-generic-vmlinux.bin*
-rwxr-xr-x 1 leonardo leonardo 3561460 May 16 18:21 openwrt-15.05.1-ar71xx-generic-vmlinux.elf*
-rw-rw-r-- 1 leonardo leonardo 1638400 May 16 18:21 openwrt-15.05.1-ar71xx-generic-vmlinux.gz
-rw-rw-r-- 1 leonardo leonardo 1179648 May 16 18:21 openwrt-15.05.1-ar71xx-generic-vmlinux.lzma
-rwxr-xr-x 1 leonardo leonardo 1248625 May 16 18:21 openwrt-15.05.1-ar71xx-generic-vmlinux-lzma.elf*
-rw-rw-r-- 1 leonardo leonardo    1159 May 16 18:21 sha256sums
leonardo@leonardo-port:~/Downloads/openwrt/OpenWrt-ImageBuilder-15.05.1-ar71xx-generic.Linux-x86_64$ </code></pre></div><p><strong>Files will not be created<br />openwrt-15.05.1-ar71xx-generic-tl-mr3020-v1-squashfs-factory.bin<br />openwrt-15.05.1-ar71xx-generic-tl-mr3020-v1-squashfs-sysupgrade.bin</strong></p><br /><p><strong>Building without &quot;bluez-utils&quot;</strong><br /></p><div class="codebox"><pre><code>make image PROFILE=TLMR3020 PACKAGES=&quot;kmod-bluetooth bluez-libs&quot;</code></pre></div><div class="codebox"><pre><code>leonardo@leonardo-port:~/Downloads/openwrt/OpenWrt-ImageBuilder-15.05.1-ar71xx-generic.Linux-x86_64$ ll bin/ar71xx/
total 25476
drwxrwxr-x 2 leonardo leonardo    4096 May 16 18:24 ./
drwxrwxr-x 3 leonardo leonardo    4096 May 16 18:24 ../
-rw-rw-r-- 1 leonardo leonardo     915 May 16 18:24 md5sums
-rw-rw-r-- 1 leonardo leonardo 2490368 May 16 18:24 openwrt-15.05.1-ar71xx-generic-root.squashfs
-rw-r--r-- 1 leonardo leonardo 2228228 May 16 18:24 openwrt-15.05.1-ar71xx-generic-root.squashfs-64k
-rw-rw-r-- 1 leonardo leonardo 3932160 May 16 18:24 openwrt-15.05.1-ar71xx-generic-tl-mr3020-v1-squashfs-factory.bin
-rw-rw-r-- 1 leonardo leonardo 3407876 May 16 18:24 openwrt-15.05.1-ar71xx-generic-tl-mr3020-v1-squashfs-sysupgrade.bin
-rw-rw-r-- 1 leonardo leonardo 1632083 May 16 18:24 openwrt-15.05.1-ar71xx-generic-uImage-gzip.bin
-rw-rw-r-- 1 leonardo leonardo 1176662 May 16 18:24 openwrt-15.05.1-ar71xx-generic-uImage-lzma.bin
-rwxr-xr-x 1 leonardo leonardo 3556396 May 16 18:24 openwrt-15.05.1-ar71xx-generic-vmlinux.bin*
-rwxr-xr-x 1 leonardo leonardo 3561460 May 16 18:24 openwrt-15.05.1-ar71xx-generic-vmlinux.elf*
-rw-rw-r-- 1 leonardo leonardo 1638400 May 16 18:24 openwrt-15.05.1-ar71xx-generic-vmlinux.gz
-rw-rw-r-- 1 leonardo leonardo 1179648 May 16 18:24 openwrt-15.05.1-ar71xx-generic-vmlinux.lzma
-rwxr-xr-x 1 leonardo leonardo 1248625 May 16 18:24 openwrt-15.05.1-ar71xx-generic-vmlinux-lzma.elf*
-rw-rw-r-- 1 leonardo leonardo    1440 May 16 18:24 sha256sums
leonardo@leonardo-port:~/Downloads/openwrt/OpenWrt-ImageBuilder-15.05.1-ar71xx-generic.Linux-x86_64$</code></pre></div><p><strong>Files are created<br />openwrt-15.05.1-ar71xx-generic-tl-mr3020-v1-squashfs-factory.bin<br />openwrt-15.05.1-ar71xx-generic-tl-mr3020-v1-squashfs-sysupgrade.bin</strong></p>											<p class="post-edited">(Last edited by <strong>psousa</strong> on 16 May 2016, 20:38)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p324246">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">tmo26</div>
					<div class="post-datetime">
						17 May 2016, 08:04					</div>
				</div>
				<div class="post-content content">
					<p>Probable cause: Image is getting too big with bluez-utils selected.</p><p>bluez-utils &nbsp; &nbsp; 5.30-1 &nbsp; &nbsp; 1118832 -&gt; more than 1MB won&#039;t fit into the small flash of the MR3020.</p><p>Solutions:<br />- Get a router with 8MB i/o 4MB flash<br />- Stay with 4MB, but use extroot</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p324247">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">normblop</div>
					<div class="post-datetime">
						17 May 2016, 08:35					</div>
				</div>
				<div class="post-content content">
					<p>First, are you sure there are no errors? If you scroll up and read the output of &#039;make&#039; carefully, you may see that it is refusing to create files due to the size, but does not necessarily exit with an error.</p><p>You can also remove packages you&#039;re not going to use. This will free up space on routers with only 4MB flash.</p><p>Currently, I don&#039;t use IPv6 or PPP, so those are great candidates for removal. Also, if you know for sure you won&#039;t need to install more packages, you can remove opkg.</p><p>Here&#039;s what I put in my &quot;PACKAGES&quot; string:</p><div class="codebox"><pre><code>-luci-proto-ppp -ppp -ppp-mod-pppoe -odhcp6c -odhcpd -6relayd -ip6tables</code></pre></div><p>If you are not going to need to install more packages, add &quot;-opkg&quot; to the above.</p>											<p class="post-edited">(Last edited by <strong>normblop</strong> on 17 May 2016, 08:36)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p324307">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">psousa</div>
					<div class="post-datetime">
						17 May 2016, 17:44					</div>
				</div>
				<div class="post-content content">
					<p>ty</p><p>I removed everything I can and maximum free space I got was 650kb, more or less.<br />I decided to face other perspective: mount a 1gb pen and use it as system space (rootfs)<br />With USB pen space available for the system, I installed needed BT packages (including the big one: bluez-utils). I have compared the free space before and after needed packages installation and I found we need ~7mb of space (several dependencies were installed)! This makes it virtually impossible to install on a MR3020 (I say &quot;virtually&quot; because could be another way, I don&#039;t know).</p><p>The problem with this solution is that I have to attach a USB hub to use the pen and bt dongle at the very same time which make the solution a litle bigger than I expect.</p><p>The BT dongle is now working and detecting BT peripherals. Later today I will test it with the globalsat GPS. I will make GPS data available at a TCP port in NMEA format, so other applications can read from it. I will not use the &quot;gpsd&quot; as I found this GPS data stream very easy to configure on my Mac only with a few available system commands (very light solution). I think I have to install netcat because Busybox&#039;s nc can&#039;t listen ports, as far as I read somewhere, but I&#039;ll try it later.</p><p>Now I expect to give a new life to my VERY old BT GPS which was lost somewhere at the bottom of an old stuff box for years (I think it&#039;s about 10 years old, or so lol).</p><p>In the future I will try this with this €11 USB gps dongle (<a href="http://www.ebay.com/itm/Car-PC-computer-USB-Interface-USB-GPS-Receiver-Module-SIRF3-MMCX-Antenna-/181874004642?hash=item2a588912a2:g:6qUAAOSwuTxV-wya">http://www.ebay.com/itm/Car-PC-computer … SwuTxV-wya</a>). I will not need BT dongle, USB pen or USB hub anymore, so I expect to be able to install and use it with pre-compiled bin (that one with luci, available online). Also, the global solution will be very very small and can be acomodated inside a small box <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /><br />But stuff from China takes at least 1 month to deliver and I haven&#039;t such time at this point.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>