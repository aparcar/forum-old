<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Block ssh access using IP tables</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 26 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p289480">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">alirz</div>
					<div class="post-datetime">
						28 Aug 2015, 01:23					</div>
				</div>
				<div class="post-content content">
					<p>hi,<br />im running openwrt on my wrt1900ac router.</p><p>I already have ssh access over WAN to my router. Im trying to limit the IPs that can ssh to the router.</p><p>I&#039;ve tried adding several IPtables rules but i cant seem to block ssh access.</p><p>Currently the /etc/config/firewall has the following rule that enables ssh over WAN in the first place<br />---------------------------------------------------<br />config rule<br />&nbsp; &nbsp; &nbsp; &nbsp; option target &#039;ACCEPT&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;tcp udp&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option dest_port &#039;22&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option name &#039;ssh&#039;<br />---------------------------------------------------</p><p>Now i&#039;ve added the following rulers in the custom filewal rulles, where x.x.x.0 is the external i want to allow for ssh access over WAN. eth1 is my WAN port on the router:</p><p>-------------------------------------------------------------------------------------------------------------------------------------------<br />iptables -A INPUT -p tcp -i eth1 --dport 22 -s&nbsp; x.x.x.0/24 --state NEW,ESTABLISHED,RELATED -j ACCEPT<br />iptables -A INPUT -p tcp -i eth1 --dport 22 --state NEW,ESTABLISHED,RELATED -j DROP<br />-------------------------------------------------------------------------------------------------------------------------------------------</p><p>however even with that rule i can ssh from WAN IP to the router. Its worth mentioning that i do have a port forwaring rule on the router that routes port 22 from WAN to the router itself. I see that, that rule itself allows access from external IP. Could that rule be over writing my iptables rule?</p><p>Any help please?</p>											<p class="post-edited">(Last edited by <strong>alirz</strong> on 28 Aug 2015, 01:26)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p289490">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">makarel</div>
					<div class="post-datetime">
						28 Aug 2015, 02:25					</div>
				</div>
				<div class="post-content content">
					<p><a href="https://forum.openwrt.org/viewtopic.php?pid=289489#p289489">https://forum.openwrt.org/viewtopic.php â€¦ 89#p289489</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p289531">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">arokh</div>
					<div class="post-datetime">
						28 Aug 2015, 14:27					</div>
				</div>
				<div class="post-content content">
					<p>Firewalling rules are traversed top-down and stops when matched. Do the math <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>