<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> TP-Link MR3220V2</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 7 Oct 2014 and 6 May 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 2 of 6</div><nav><ul><li><a href="viewtopic.php%3Fid=38896&amp;p=1.html">1</a></li><li class="pagination-current"><span>2</span></li><li><a href="viewtopic.php%3Fid=38896&amp;p=3.html">3</a></li><li><a href="viewtopic.php%3Fid=38896&amp;p=4.html">4</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=38896&amp;p=6.html">6</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p183669">
				<div class="post-metadata">
					<div class="post-num">Post #26</div>
					<div class="post-author">budzulb</div>
					<div class="post-datetime">
						19 Nov 2012, 13:49					</div>
				</div>
				<div class="post-content content">
					<p>if wifi is switched off that everything works</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p183671">
				<div class="post-metadata">
					<div class="post-num">Post #27</div>
					<div class="post-author">nebbia88</div>
					<div class="post-datetime">
						19 Nov 2012, 13:56					</div>
				</div>
				<div class="post-content content">
					<p>But i did not ask that xD</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p183674">
				<div class="post-metadata">
					<div class="post-num">Post #28</div>
					<div class="post-author">budzulb</div>
					<div class="post-datetime">
						19 Nov 2012, 14:08					</div>
				</div>
				<div class="post-content content">
					<p>with English not so, probably didn&#039;t understand a question</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p183683">
				<div class="post-metadata">
					<div class="post-num">Post #29</div>
					<div class="post-author">nebbia88</div>
					<div class="post-datetime">
						19 Nov 2012, 15:28					</div>
				</div>
				<div class="post-content content">
					<p>no prob, i meant to ask what happen if you power on the router, enable wifi and use it, and THEN plug in the usb modem and connect to internet..</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p183735">
				<div class="post-metadata">
					<div class="post-num">Post #30</div>
					<div class="post-author">smahendra</div>
					<div class="post-datetime">
						20 Nov 2012, 09:38					</div>
				</div>
				<div class="post-content content">
					<p>Addition to issue reported from @budzulb. You pull out modem and put it back the connection is up from next few minutes and again disconnected. Not sure why.</p><p>Issue I was trying to fix:<br/>1. Got sealed pack modem got my ZTE AC2726 working but Huawei E173 not working.<br/>2. Upgraded with firmware available on website TP-Link all modem stopped working.<br/>3. Installed build given by @cindy.wijaya.<br/>4. Got router up and running. Configure 3G uid/password.<br/>5. Got connected.<br/>6. Disconnected within a few minutes. Using modem ZTE AC2726. Not sure why. Log is same as what @budzulb has given.<br/>7. Pull modem out, push in back. Click connect in interfaces connection up again but disconnected after a few minutes.<br/>8. Requested TP-Link original firmware shipped with router not available on there website.<br/>9. Restored the recieved firmware. Got it working back.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p183749">
				<div class="post-metadata">
					<div class="post-num">Post #31</div>
					<div class="post-author">budzulb</div>
					<div class="post-datetime">
						20 Nov 2012, 11:48					</div>
				</div>
				<div class="post-content content">
					<p>in any case with included wifi internet to stop,better I will show log before wifi inclusion</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p183799">
				<div class="post-metadata">
					<div class="post-num">Post #32</div>
					<div class="post-author">mooop12</div>
					<div class="post-datetime">
						20 Nov 2012, 19:01					</div>
				</div>
				<div class="post-content content">
					<p>I built my own firmware for MR3220 v2, but the WiFi and leds aren&#039;t working, can someone help me fix this?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p183906">
				<div class="post-metadata">
					<div class="post-num">Post #33</div>
					<div class="post-author">RalfFriedl</div>
					<div class="post-datetime">
						21 Nov 2012, 19:23					</div>
				</div>
				<div class="post-content content">
					<p>It seems that cindy.wijaya finds time for updates to the binary image, but not for instructions on how to create that image, which would be much more useful. It is also a violation of the GPL to provide binaries only.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p183907">
				<div class="post-metadata">
					<div class="post-num">Post #34</div>
					<div class="post-author">mooop12</div>
					<div class="post-datetime">
						21 Nov 2012, 19:36					</div>
				</div>
				<div class="post-content content">
					<p>She said &quot;9331 profile to build&quot;, but I&#039;m not sure what she meant. I mean, MR3220 is already built upon AR9xxx target.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p183908">
				<div class="post-metadata">
					<div class="post-num">Post #35</div>
					<div class="post-author">xopal</div>
					<div class="post-datetime">
						21 Nov 2012, 19:55					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>RalfFriedl wrote:</cite><blockquote><p>It seems that cindy.wijaya finds time for updates to the binary image, but not for instructions on how to create that image, which would be much more useful. It is also a violation of the GPL to provide binaries only.</p></blockquote></div><p>Compile 740Nv4 profiles with USB patch , thats all , how to patch the USB find <a href="https://forum.openwrt.org/viewtopic.php?id=33991">here</a> .</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p183909">
				<div class="post-metadata">
					<div class="post-num">Post #36</div>
					<div class="post-author">mooop12</div>
					<div class="post-datetime">
						21 Nov 2012, 20:05					</div>
				</div>
				<div class="post-content content">
					<p>Have you tested it? I wouldn&#039;t want to brick my router just yet...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p183912">
				<div class="post-metadata">
					<div class="post-num">Post #37</div>
					<div class="post-author">xopal</div>
					<div class="post-datetime">
						21 Nov 2012, 20:27					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>mooop12 wrote:</cite><blockquote><p>Have you tested it? I wouldn&#039;t want to brick my router just yet...</p></blockquote></div><p>Of course yes , i use this router too</p><p>Open /trunk/target/linux/ar71xx/files/arch/mips/ath79/mach-tl-wr741nd-v4.c</p><p>paste this code</p><div class="codebox"><pre><code>/*
 *  TP-LINK TL-WR741ND v4 board support
 *
 *  Copyright (C) 2011-2012 Gabor Juhos &lt;juhosg@openwrt.org&gt;
 *
 *  This program is free software; you can redistribute it and/or modify it
 *  under the terms of the GNU General Public License version 2 as published
 *  by the Free Software Foundation.
 */

#include &lt;linux/gpio.h&gt;

#include &lt;asm/mach-ath79/ath79.h&gt;
#include &lt;asm/mach-ath79/ar71xx_regs.h&gt;

#include &quot;common.h&quot;
#include &quot;dev-eth.h&quot;
#include &quot;dev-gpio-buttons.h&quot;
#include &quot;dev-leds-gpio.h&quot;
#include &quot;dev-m25p80.h&quot;
#include &quot;dev-usb.h&quot;
#include &quot;dev-wmac.h&quot;
#include &quot;machtypes.h&quot;

#define TL_WR741NDV4_GPIO_BTN_RESET    11
#define TL_WR741NDV4_GPIO_BTN_WPS    26

#define TL_WR741NDV4_GPIO_LED_WLAN    0
#define TL_WR741NDV4_GPIO_LED_QSS    1
#define TL_WR741NDV4_GPIO_USB_POWER    8
#define TL_WR741NDV4_GPIO_LED_WAN    13
#define TL_WR741NDV4_GPIO_LED_LAN1    14
#define TL_WR741NDV4_GPIO_LED_LAN2    15
#define TL_WR741NDV4_GPIO_LED_LAN3    16
#define TL_WR741NDV4_GPIO_LED_LAN4    17

#define TL_WR741NDV4_GPIO_LED_SYSTEM    27

#define TL_WR741NDV4_KEYS_POLL_INTERVAL    20    /* msecs */
#define TL_WR741NDV4_KEYS_DEBOUNCE_INTERVAL (3 * TL_WR741NDV4_KEYS_POLL_INTERVAL)

static const char *tl_wr741ndv4_part_probes[] = {
    &quot;tp-link&quot;,
    NULL,
};

static struct flash_platform_data tl_wr741ndv4_flash_data = {
    .part_probes    = tl_wr741ndv4_part_probes,
};

static struct gpio_led tl_wr741ndv4_leds_gpio[] __initdata = {
    {
        .name        = &quot;tp-link:green:lan1&quot;,
        .gpio        = TL_WR741NDV4_GPIO_LED_LAN1,
        .active_low    = 0,
    }, {
        .name        = &quot;tp-link:green:lan2&quot;,
        .gpio        = TL_WR741NDV4_GPIO_LED_LAN2,
        .active_low    = 0,
    }, {
        .name        = &quot;tp-link:green:lan3&quot;,
        .gpio        = TL_WR741NDV4_GPIO_LED_LAN3,
        .active_low    = 0,
    }, {
        .name        = &quot;tp-link:green:lan4&quot;,
        .gpio        = TL_WR741NDV4_GPIO_LED_LAN4,
        .active_low    = 1,
    }, {
        .name        = &quot;tp-link:green:qss&quot;,
        .gpio        = TL_WR741NDV4_GPIO_LED_QSS,
        .active_low    = 0,
    }, {
        .name        = &quot;tp-link:green:system&quot;,
        .gpio        = TL_WR741NDV4_GPIO_LED_SYSTEM,
        .active_low    = 1,
    }, {
        .name        = &quot;tp-link:green:wan&quot;,
        .gpio        = TL_WR741NDV4_GPIO_LED_WAN,
        .active_low    = 0,
    }, {
        .name        = &quot;tp-link:green:wlan&quot;,
        .gpio        = TL_WR741NDV4_GPIO_LED_WLAN,
        .active_low    = 0,
    },
};

static struct gpio_keys_button tl_wr741ndv4_gpio_keys[] __initdata = {
    {
        .desc        = &quot;reset&quot;,
        .type        = EV_KEY,
        .code        = KEY_RESTART,
        .debounce_interval = TL_WR741NDV4_KEYS_DEBOUNCE_INTERVAL,
        .gpio        = TL_WR741NDV4_GPIO_BTN_RESET,
        .active_low    = 0,
    }, {
        .desc        = &quot;WPS&quot;,
        .type        = EV_KEY,
        .code        = KEY_WPS_BUTTON,
        .debounce_interval = TL_WR741NDV4_KEYS_DEBOUNCE_INTERVAL,
        .gpio        = TL_WR741NDV4_GPIO_BTN_WPS,
        .active_low    = 0,
    }
};

static void __init tl_wr741ndv4_setup(void)
{
    u8 *mac = (u8 *) KSEG1ADDR(0x1f01fc00);
    u8 *ee = (u8 *) KSEG1ADDR(0x1fff1000);

    ath79_setup_ar933x_phy4_switch(true, true);

    ath79_gpio_function_disable(AR933X_GPIO_FUNC_ETH_SWITCH_LED0_EN |
                    AR933X_GPIO_FUNC_ETH_SWITCH_LED1_EN |
                    AR933X_GPIO_FUNC_ETH_SWITCH_LED2_EN |
                    AR933X_GPIO_FUNC_ETH_SWITCH_LED3_EN |
                    AR933X_GPIO_FUNC_ETH_SWITCH_LED4_EN);

    ath79_register_leds_gpio(-1, ARRAY_SIZE(tl_wr741ndv4_leds_gpio),
                 tl_wr741ndv4_leds_gpio);

    ath79_register_gpio_keys_polled(1, TL_WR741NDV4_KEYS_POLL_INTERVAL,
                    ARRAY_SIZE(tl_wr741ndv4_gpio_keys),
                    tl_wr741ndv4_gpio_keys);
                    
    gpio_request_one(TL_WR741NDV4_GPIO_USB_POWER,
             GPIOF_OUT_INIT_HIGH | GPIOF_EXPORT_DIR_FIXED,
             &quot;USB power&quot;);
    ath79_register_usb();

    ath79_register_m25p80(&amp;tl_wr741ndv4_flash_data);
    ath79_init_mac(ath79_eth0_data.mac_addr, mac, 1);
    ath79_init_mac(ath79_eth1_data.mac_addr, mac, -1);

    ath79_register_mdio(0, 0x0);
    ath79_register_eth(1);
    ath79_register_eth(0);

    ath79_register_wmac(ee, mac);
}

MIPS_MACHINE(ATH79_MACH_TL_WR741ND_V4, &quot;TL-WR741ND-v4&quot;,
         &quot;TP-LINK TL-WR741ND v4&quot;, tl_wr741ndv4_setup);</code></pre></div>											<p class="post-edited">(Last edited by <strong>xopal</strong> on 21 Nov 2012, 20:39)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p184019">
				<div class="post-metadata">
					<div class="post-num">Post #38</div>
					<div class="post-author">mooop12</div>
					<div class="post-datetime">
						22 Nov 2012, 22:16					</div>
				</div>
				<div class="post-content content">
					<p>Thanks, it&#039;s working. But it&#039;s a dirty hack. It would be nice if a dev could just add this new router. If I can build it with a little help I&#039;m sure a real dev would add support for this device in no time <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile"/></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p184096">
				<div class="post-metadata">
					<div class="post-num">Post #39</div>
					<div class="post-author">openwrt_user</div>
					<div class="post-datetime">
						23 Nov 2012, 18:13					</div>
				</div>
				<div class="post-content content">
					<p>Could someone post his .config as a starting point?<br/>Also some few instructions would be adequate <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink"/></p><p>beside editing &quot;/trunk/target/linux/ar71xx/files/arch/mips/ath79/mach-tl-wr741nd-v4.c&quot; is there any other modification needed?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p184120">
				<div class="post-metadata">
					<div class="post-num">Post #40</div>
					<div class="post-author">mooop12</div>
					<div class="post-datetime">
						23 Nov 2012, 20:22					</div>
				</div>
				<div class="post-content content">
					<p>Nope, just compile for wr740n and install the binary for version 4 of this router. Make sure it&#039;s version 4, because from what I saw it&#039;s the only one compatible with MR3200v2. As for .config, just put what you need in it. You&#039;ll have to force the installation of this image because sysupgrade performs some basic checking of image so you don&#039;t install a wrong one, just add -F option after sysupgrade.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p184226">
				<div class="post-metadata">
					<div class="post-num">Post #41</div>
					<div class="post-author">cindy.wijaya</div>
					<div class="post-datetime">
						25 Nov 2012, 05:22					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>matteo wrote:</cite><blockquote><p>@cindy.wijaya<br/>Thank you very much for sharing your builds!</p><p>Anyway, can you provide info on how to build the firmware? Maybe you can update the wiki <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile"/></p></blockquote></div><p>ok, i would prepare for it <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile"/></p><p>***<br/>Sorry for my busy days. This is modification needed to build mr3220.v2</p><p>/trunk/target/linux/ar71xx/image/makefile<br/></p><div class="codebox"><pre><code>#
# Copyright (C) 2008-2011 OpenWrt.org
#
# This is free software, licensed under the GNU General Public License v2.
# See /LICENSE for more information.
#

include $(TOPDIR)/rules.mk
include $(INCLUDE_DIR)/image.mk

JFFS2_BLOCKSIZE = 64k 128k 256k

define imgname
$(BIN_DIR)/$(IMG_PREFIX)-$(2)-$(patsubst jffs2-%,jffs2,$(patsubst squashfs-%,squashfs,$(1)))
endef

define rootfs_align
$(patsubst %-256k,0x40000,$(patsubst %-128k,0x20000,$(patsubst %-64k,0x10000,$(patsubst squashfs-%,0x4,$(1)))))
endef

define sysupname
$(call imgname,$(1),$(2))-sysupgrade.bin
endef

define factoryname
$(call imgname,$(1),$(2))-factory.bin
endef

COMMA:=,

define mkcmdline
$(if $(1),board=$(1) )$(if $(2),console=$(2)$(COMMA)$(3))
endef

SINGLE_PROFILES:=

define SingleProfile
  define Image/Build/Profile/$(3)
    $$(call Image/Build/Template/$(2)/$$(1),$(1),$(4),$$(call mkcmdline,$(5),$(6),$(7)),$(8),$(9),$(10),$(11),$(12))
  endef
  SINGLE_PROFILES += $(3)
endef

define MultiProfile
  define Image/Build/Profile/$(1)
    $(foreach p,$(2),
        $$(call Image/Build/Profile/$p,$$(1))
    )
  endef
endef

LOADER_MAKE := $(NO_TRACE_MAKE) -C lzma-loader KDIR=$(KDIR)

KDIR_TMP:=$(KDIR)/tmp
VMLINUX:=$(BIN_DIR)/$(IMG_PREFIX)-vmlinux
UIMAGE:=$(BIN_DIR)/$(IMG_PREFIX)-uImage
fs_squash:=squashfs-only
fs_64k:=64k
fs_64kraw:=64kraw
fs_128k:=128k
fs_256k:=256k
ifeq ($(CONFIG_TARGET_ROOTFS_INITRAMFS),y)
    fs_squash:=initramfs
    fs_64k:=initramfs
    fs_64kraw:=initramfs
    fs_128k:=initramfs
    fs_256k:=initramfs
    VMLINUX:=$(BIN_DIR)/$(IMG_PREFIX)-vmlinux-initramfs
    UIMAGE:=$(BIN_DIR)/$(IMG_PREFIX)-uImage-initramfs
endif

define CompressLzma
  $(STAGING_DIR_HOST)/bin/lzma e $(1) -lc1 -lp2 -pb2 $(2)
endef

define PatchKernelLzma
    cp $(KDIR)/vmlinux $(KDIR_TMP)/vmlinux-$(1)
    $(STAGING_DIR_HOST)/bin/patch-cmdline $(KDIR_TMP)/vmlinux-$(1) &quot;$(strip $(2))&quot;
    $(call CompressLzma,$(KDIR_TMP)/vmlinux-$(1),$(KDIR_TMP)/vmlinux-$(1).bin.lzma)
endef

define PatchKernelGzip
    cp $(KDIR)/vmlinux $(KDIR_TMP)/vmlinux-$(1)
    $(STAGING_DIR_HOST)/bin/patch-cmdline $(KDIR_TMP)/vmlinux-$(1) &quot;$(strip $(2))&quot;
    gzip -9 -c $(KDIR_TMP)/vmlinux-$(1) &gt; $(KDIR_TMP)/vmlinux-$(1).bin.gz
endef

define MkuImage
    mkimage -A mips -O linux -T kernel -a 0x80060000 -C $(1) $(2) \
        -e 0x80060000 -n &#039;MIPS OpenWrt Linux-$(LINUX_VERSION)&#039; \
        -d $(3) $(4)
endef

define MkuImageLzma
    $(call PatchKernelLzma,$(1),$(2))
    $(call MkuImage,lzma,,$(KDIR_TMP)/vmlinux-$(1).bin.lzma,$(KDIR_TMP)/vmlinux-$(1).uImage)
endef

define MkuImageLzma/initramfs
    $(call PatchKernelLzma,$(1),$(2))
    $(call MkuImage,lzma,,$(KDIR_TMP)/vmlinux-$(1).bin.lzma,$(call imgname,initramfs,$(1))-uImage.bin)
endef

define MkuImageGzip
    $(call PatchKernelGzip,$(1),$(2))
    $(call MkuImage,gzip,,$(KDIR_TMP)/vmlinux-$(1).bin.gz,$(KDIR_TMP)/vmlinux-$(1).uImage)
endef

define MkuImageGzip/initramfs
    $(call PatchKernelGzip,$(1),$(2))
    $(call MkuImage,gzip,,$(KDIR_TMP)/vmlinux-$(1).bin.gz,$(call imgname,initramfs,$(1))-uImage.bin)
endef

define MkuImageOKLI
    $(call MkuImage,lzma,-M 0x4f4b4c49,$(KDIR)/vmlinux.bin.lzma,$(KDIR_TMP)/vmlinux-$(1).okli)
endef

define CatFiles
    if [ `stat -c%s &quot;$(1)&quot;` -gt $(2) ]; then \
        echo &quot;Warning: $(1) is too big&quot;; \
    else if [ `stat -c%s $(3)` -gt $(4) ]; then \
        echo &quot;Warning: $(3) is too big&quot;; \
    else \
        ( dd if=$(1) bs=$(2) conv=sync; dd if=$(3) ) &gt; $(5); \
    fi; fi
endef

define Sysupgrade/KR
    $(call CatFiles,$(2),$(3),$(KDIR)/root.$(1),$(4),$(call sysupname,$(1),$(5)))
endef

define Sysupgrade/KRuImage
    $(call CatFiles,$(KDIR_TMP)/vmlinux-$(2).uImage,$(3),$(KDIR)/root.$(1),$(4),$(call sysupname,$(1),$(2)))
endef

define Sysupgrade/RKuImage
    $(call CatFiles,$(KDIR)/root.$(1),$(4),$(KDIR_TMP)/vmlinux-$(2).uImage,$(3),$(call sysupname,$(1),$(2)))
endef

define Image/BuildLoader
    -rm -rf $(KDIR)/lzma-loader
    $(LOADER_MAKE) LOADER=loader-$(1).$(2) KERNEL_CMDLINE=&quot;$(3)&quot;\
        LZMA_TEXT_START=0x80a00000 LOADADDR=0x80060000 \
        LOADER_DATA=&quot;$(KDIR)/vmlinux.bin.lzma&quot; BOARD=&quot;$(1)&quot; \
        compile loader.$(2)
endef

define Image/BuildLoaderAlone
    -rm -rf $(KDIR)/lzma-loader
    $(LOADER_MAKE) LOADER=loader-$(1).$(2) KERNEL_CMDLINE=&quot;$(3)&quot; \
        LZMA_TEXT_START=0x80a00000 LOADADDR=0x80060000 \
        BOARD=&quot;$(1)&quot; FLASH_OFFS=$(4) FLASH_MAX=$(5) \
        compile loader.$(2)
endef

define Build/Clean
    $(LOADER_MAKE) clean
endef


alfa_ap96_mtdlayout=mtdparts=spi0.0:256k(u-boot)ro,256k(u-boot-env)ro,13312k(rootfs),2048k(kernel),512k(caldata)ro,15360k@0x80000(firmware)
alfa_mtdlayout_8M=mtdparts=spi0.0:256k(u-boot)ro,64k(u-boot-env)ro,6144k(rootfs),1600k(kernel),64k(nvram),64k(art)ro,7744k@0x50000(firmware)
all0258n_mtdlayout=mtdparts=spi0.0:256k(u-boot),64k(u-boot-env),1024k(kernel),5248k(rootfs),1536k(failsafe),64k(art),6272k@0x50000(firmware)
all0315n_mtdlayout=mtdparts=spi0.0:256k(u-boot)ro,256k(u-boot-env),1024k(kernel),12544k(rootfs),2048k(failsafe),256k(art)ro,13568k@0x80000(firmware)
ap96_mtdlayout=mtdparts=spi0.0:192k(u-boot)ro,64k(u-boot-env)ro,6144k(rootfs),1728k(kernel),64k(art)ro,7872k@0x40000(firmware)
ap113_mtd_layout=mtdparts=spi0.0:64k(u-boot),3008k(rootfs),896k(uImage),64k(NVRAM),64k(ART),3904k@0x10000(firmware)
ap121_mtdlayout_2M=mtdparts=spi0.0:64k(u-boot)ro,1216k(rootfs),704k(kernel),64k(art)ro,1920k@0x10000(firmware)
ap121_mtdlayout_4M=mtdparts=spi0.0:256k(u-boot)ro,64k(u-boot-env)ro,2752k(rootfs),896k(kernel),64k(nvram),64k(art)ro,3648k@0x50000(firmware)
ap136_mtdlayout=mtdparts=spi0.0:256k(u-boot)ro,64k(u-boot-env)ro,6336k(rootfs),1408k(kernel),64k(mib0),64k(art)ro,7744k@0x50000(firmware)
cameo7240_mtdlayout=mtdparts=spi0.0:192k(u-boot)ro,64k(nvram)ro,960k(kernel),2752k(rootfs),64k(mac)ro,64k(art)ro,3712k@0x40000(firmware)
cameo913x_mtdlayout=mtdparts=spi0.0:128k(u-boot)ro,64k(config)ro,960k(kernel),2880k(rootfs),64k(art)ro,3840k@0x30000(firmware)
cameo933x_mtdlayout=mtdparts=spi0.0:64k(u-boot)ro,64k(art)ro,64k(mac)ro,64k(nvram)ro,192k(language)ro,896k(kernel),2752k(rootfs),3648k@0x70000(firmware)
cap4200ag_mtdlayout=mtdparts=spi0.0:256k(u-boot),64k(u-boot-env),320k(custom)ro,1536k(kernel),12096k(rootfs),2048k(failsafe),64k(art),13632k@0xa0000(firmware)
db120_mtdlayout=mtdparts=spi0.0:256k(u-boot)ro,64k(u-boot-env)ro,6336k(rootfs),1408k(kernel),64k(nvram),64k(art)ro,7744k@0x50000(firmware)
dir825b1_mtdlayout=mtdparts=spi0.0:256k(uboot)ro,64k(config)ro,1024k(kernel),5184k(rootfs),64k(caldata)ro,1600k(unknown)ro,6208k@0x50000(firmware),64k@0x7f0000(caldata_copy)
dir825b1_mtdlayout_fat=mtdparts=spi0.0:256k(uboot)ro,64k(config)ro,1024k(kernel),6784k(rootfs),64k(caldata)ro,7808k@0x50000(firmware),64k@0x660000(caldata_orig),6208k@0x50000(firmware_orig)
ew-dorin_mtdlayout_4M=mtdparts=spi0.0:256k(u-boot)ro,64k(u-boot-env),1024k(kernel),2688k(rootfs),64k(art),3712k@0x50000(firmware)
dlrtdev_mtdlayout=mtdparts=spi0.0:256k(uboot)ro,64k(config)ro,1024k(kernel),5184k(rootfs),64k(caldata)ro,640k(certs),960k(unknown)ro,6208k@0x50000(firmware),64k@0x7f0000(caldata_copy)
dlrtdev_mtdlayout_fat=mtdparts=spi0.0:256k(uboot)ro,64k(config)ro,1024k(kernel),6544k(rootfs),640k(certs),64k(caldata)ro,7168k@0x50000(firmware),64k@0x660000(caldata_orig),6208k@0x50000(firmware_orig)
pb92_mtdlayout=mtdparts=spi0.0:256k(u-boot)ro,64k(u-boot-env)ro,2752k(rootfs),896k(kernel),64k(nvram),64k(art)ro,3648k@0x50000(firmware)
planex_mtdlayout=mtdparts=spi0.0:256k(u-boot)ro,64k(u-boot-env)ro,960k(kernel),6784k(rootfs),128k(art)ro,7744k@0x50000(firmware)
ubntxm_mtdlayout=mtdparts=spi0.0:256k(u-boot)ro,64k(u-boot-env)ro,1024k(kernel),6528k(rootfs),256k(cfg)ro,64k(EEPROM)ro,7552k@0x50000(firmware)
ubdev_mtdlayout=mtdparts=spi0.0:256k(u-boot)ro,64k(u-boot-env)ro,1024k(kernel),6464k(rootfs),64k(certs),256k(cfg)ro,64k(EEPROM)ro,7488k@0x50000(firmware)
whrhpg300n_mtdlayout=mtdparts=spi0.0:248k(u-boot)ro,8k(u-boot-env)ro,960k(kernel),2816k(rootfs),64k(art)ro,3712k@0x40000(firmware)
wndr3700_mtdlayout=mtdparts=spi0.0:320k(u-boot)ro,128k(u-boot-env)ro,1024k(kernel),6656k(rootfs),64k(art)ro,7680k@0x70000(firmware)
wndr3700v2_mtdlayout=mtdparts=spi0.0:320k(u-boot)ro,128k(u-boot-env)ro,1024k(kernel),14848k(rootfs),64k(art)ro,15872k@0x70000(firmware)
zcn1523h_mtdlayout=mtdparts=spi0.0:256k(u-boot)ro,64k(u-boot-env)ro,6208k(rootfs),1472k(kernel),64k(configure)ro,64k(mfg)ro,64k(art)ro,7680k@0x50000(firmware)

define Image/BuildKernel
    cp $(KDIR)/vmlinux.elf $(VMLINUX).elf
    cp $(KDIR)/vmlinux $(VMLINUX).bin
    dd if=$(KDIR)/vmlinux.bin.lzma of=$(VMLINUX).lzma bs=65536 conv=sync
    dd if=$(KDIR)/vmlinux.bin.gz of=$(VMLINUX).gz bs=65536 conv=sync
    $(call MkuImage,gzip,,$(KDIR)/vmlinux.bin.gz,$(UIMAGE)-gzip.bin)
    $(call MkuImage,lzma,,$(KDIR)/vmlinux.bin.lzma,$(UIMAGE)-lzma.bin)
    -mkdir -p $(KDIR_TMP)
    $(call Image/Build/Initramfs)
endef

define Image/Build/WRT400N
    $(call MkuImageLzma,$(2),$(3))
    $(call Sysupgrade/KRuImage,$(1),$(2),1310720,6488064)
    if [ -e &quot;$(call sysupname,$(1),$(2))&quot; ]; then \
        wrt400n $(KDIR_TMP)/vmlinux-$(2).uImage $(KDIR)/root.$(1) $(call factoryname,$(1),$(2)); \
    fi
endef

define Image/Build/DIR825B1
    $(call MkuImageLzma,$(2),$(3) $(dir825b1_mtdlayout))
    $(call Sysupgrade/KRuImage,$(1),$(2),1048576,5308416)
    if [ -e &quot;$(call sysupname,$(1),$(2))&quot; ]; then \
        ( \
            dd if=$(call sysupname,$(1),$(2)); \
            echo -n &quot;$(4)&quot;; \
        ) &gt; $(call imgname,$(1),$(2))-backup-loader.bin; \
        if [ `stat -c%s $(call sysupname,$(1),$(2))` -gt 4194304 ]; then \
            echo &quot;Warning: $(call sysupname,$(1),$(2)) is too big&quot;; \
        else \
            ( \
                dd if=$(call sysupname,$(1),$(2)) bs=4096k conv=sync; \
                echo -n &quot;$(5)&quot;; \
            ) &gt; $(call factoryname,$(1),$(2)); \
        fi; \
    fi
    $(call MkuImageLzma,$(2)-fat,$(3) $(dir825b1_mtdlayout_fat))
    $(call CatFiles,$(KDIR_TMP)/vmlinux-$(2)-fat.uImage,1048576,$(KDIR)/root.$(1),6946816,$(KDIR_TMP)/$(2)-fat.bin)
    if [ -e &quot;$(KDIR_TMP)/$(2)-fat.bin&quot; ]; then \
        echo -n &quot;&quot; &gt; $(KDIR_TMP)/$(2)-fat.dummy; \
        sh $(TOPDIR)/scripts/combined-image.sh \
            &quot;$(KDIR_TMP)/$(2)-fat.bin&quot; \
            &quot;$(KDIR_TMP)/$(2)-fat.dummy&quot; \
            $(call sysupname,$(1),$(2)-fat); \
    fi
endef

define Image/Build/DLRTDEV
    $(call MkuImageLzma,$(2),$(3) $(dlrtdev_mtdlayout))
    $(call Sysupgrade/KRuImage,$(1),$(2),1048576,5308416)
    if [ -e &quot;$(call sysupname,$(1),$(2))&quot; ]; then \
        ( \
            dd if=$(call sysupname,$(1),$(2)); \
            echo -n &quot;$(4)&quot;; \
        ) &gt; $(call imgname,$(1),$(2))-backup-loader.bin; \
        if [ `stat -c%s $(call sysupname,$(1),$(2))` -gt 4194304 ]; then \
            echo &quot;Warning: $(call sysupname,$(1),$(2)) is too big&quot;; \
        else \
            ( \
                dd if=$(call sysupname,$(1),$(2)) bs=4096k conv=sync; \
                echo -n &quot;$(5)&quot;; \
            ) &gt; $(call factoryname,$(1),$(2)); \
        fi; \
    fi
    $(call MkuImageLzma,$(2)-fat,$(3) $(dlrtdev_mtdlayout_fat))
    $(call CatFiles,$(KDIR_TMP)/vmlinux-$(2)-fat.uImage,1048576,$(KDIR)/root.$(1),6946816,$(KDIR_TMP)/$(2)-fat.bin)
    if [ -e &quot;$(KDIR_TMP)/$(2)-fat.bin&quot; ]; then \
        echo -n &quot;&quot; &gt; $(KDIR_TMP)/$(2)-fat.dummy; \
        sh $(TOPDIR)/scripts/combined-image.sh \
            &quot;$(KDIR_TMP)/$(2)-fat.bin&quot; \
            &quot;$(KDIR_TMP)/$(2)-fat.dummy&quot; \
            $(call sysupname,$(1),$(2)-fat); \
    fi
endef

define Image/Build/WZRHPG30XNH
    $(call MkuImageLzma,$(2),$(3))
    $(call Sysupgrade/KRuImage,$(1),$(2),1048576,31850496)
    if [ -e &quot;$(call sysupname,$(1),$(2))&quot; ]; then \
        ( \
            dd if=$(call sysupname,$(1),$(2)); \
        ) &gt; $(call imgname,$(1),$(2))-tftp.bin; \
        buffalo-enc -p $(4) -v 1.99 \
            -i $(call sysupname,$(1),$(2)) \
            -o $(KDIR_TMP)/$(2).enc; \
        buffalo-tag -b $(4) -p $(4) -a ath -v 1.99 -m 1.01 -l mlang8 \
            -w 3 -c 0x80041000 -d 0x801e8000 -f 1 -r M_ \
            -i $(KDIR_TMP)/$(2).enc \
            -o $(call factoryname,$(1),$(2)); \
    fi
endef

define Image/Build/WHRHPG300N
    $(call MkuImageLzma,$(2),$(3) $(4))
    $(call Sysupgrade/KRuImage,$(1),$(2),983040,2883584)
    if [ -e &quot;$(call sysupname,$(1),$(2))&quot; ]; then \
        ( \
            dd if=$(call sysupname,$(1),$(2)); \
        ) &gt; $(call imgname,$(1),$(2))-tftp.bin; \
        buffalo-enc -p $(5) -v 1.99 \
            -i $(call sysupname,$(1),$(2)) \
            -o $(KDIR_TMP)/$(2).enc; \
        buffalo-tag -b $(5) -p $(5) -a ath -v 1.99 -m 1.01 -l mlang8 \
            -w 3 -c 0x80041000 -d 0x801e8000 -f 1 -r M_ \
            -i $(KDIR_TMP)/$(2).enc \
            -o $(call factoryname,$(1),$(2)); \
    fi
endef

define Image/Build/WHRHPG300N/initramfs
    $(call MkuImageLzma/initramfs,$(2),$(3) $(4))
endef

define Image/Build/Cameo
    $(call MkuImageLzma,$(2),$(3) $(4))
    $(call Sysupgrade/KRuImage,$(1),$(2),$(5),$(6))
    if [ -e &quot;$(call sysupname,$(1),$(2))&quot; ]; then \
        ( \
            dd if=$(KDIR_TMP)/vmlinux-$(2).uImage bs=$(5) conv=sync; \
            dd if=$(KDIR)/root.$(1) bs=$(6) conv=sync; \
            echo -n $(7); \
        ) &gt; $(call factoryname,$(1),$(2)); \
    fi
endef

define Image/Build/CameoHornet
    $(call MkuImageLzma,$(2),$(3) $(4))
    $(call Sysupgrade/KRuImage,$(1),$(2),$(5),$(6))
    if [ -e &quot;$(call sysupname,$(1),$(2))&quot; ]; then \
        mkcameofw -M HORNET -R &quot;DEF&quot; -S $(7) -V &quot;1.99&quot; \
            -K $(5) -I $$$$(($(5)+$(6))) \
            -k $(KDIR_TMP)/vmlinux-$(2).uImage \
            -r $(BIN_DIR)/$(IMG_PREFIX)-root.$(1) \
            -o $(call factoryname,$(1),$(2)); \
    fi
endef

define Image/Build/Cameo913x
    $(call Image/Build/Cameo,$(1),$(2),$(3),$(cameo913x_mtdlayout),983040,2949120,$(4))
endef

define Image/Build/Cameo913x/initramfs
    $(call MkuImageLzma/initramfs,$(2),$(3) $(cameo913x_mtdlayout))
endef

define Image/Build/Cameo7240
    $(call Image/Build/Cameo,$(1),$(2),$(3),$(cameo7240_mtdlayout),983040,2818048,$(4))
endef

define Image/Build/Cameo7240/initramfs
    $(call MkuImageLzma/initramfs,$(2),$(3) $(cameo7240_mtdlayout))
endef

define Image/Build/Cameo933x
    $(call Image/Build/CameoHornet,$(1),$(2),$(3),$(cameo933x_mtdlayout),917504,2818048,$(4))
endef

define Image/Build/Cameo933x/initramfs
    $(call MkuImageLzma/initramfs,$(2),$(3) $(cameo933x_mtdlayout))
endef

define Image/Build/Ath
    $(call Sysupgrade/$(7),$(1),$(2),$(5),$(6))
    if [ -e &quot;$(call sysupname,$(1),$(2))&quot; ]; then \
        dd if=$(KDIR_TMP)/vmlinux-$(2).uImage \
            of=$(call imgname,kernel,$(2)).bin bs=64k conv=sync; \
        dd if=$(KDIR)/root.$(1) \
            of=$(call imgname,$(1),$(2)-rootfs).bin bs=128k conv=sync; \
    fi
endef

define Image/Build/AthGzip
    $(call MkuImageGzip,$(2),$(3) $(4))
    $(call Image/Build/Ath,$(1),$(2),$(3),$(4),$(5),$(6),$(7))
endef

define Image/Build/AthGzip/initramfs
    $(call MkuImageGzip/initramfs,$(2),$(3) $(4))
endef

define Image/Build/AthLzma
    $(call MkuImageLzma,$(2),$(3) $(4))
    $(call Image/Build/Ath,$(1),$(2),$(3),$(4),$(5),$(6),$(7))
endef

define Image/Build/AthLzma/initramfs
    $(call MkuImageLzma/initramfs,$(2),$(3) $(4))
endef

define Image/Build/PB4X
    $(call PatchKernelLzma,$(2),$(3))
    dd if=$(KDIR_TMP)/vmlinux-$(2).bin.lzma \
       of=$(call imgname,kernel,$(2)).bin bs=64k conv=sync
    dd if=$(KDIR)/root.$(1) \
       of=$(call imgname,$(1),$(2)-rootfs).bin bs=128k conv=sync
    -sh $(TOPDIR)/scripts/combined-image.sh \
        &quot;$(call imgname,kernel,$(2)).bin&quot; \
        &quot;$(call imgname,$(1),$(2)-rootfs).bin&quot; \
        $(call sysupname,$(1),$(2))
endef


define Image/Build/MyLoader
    $(call PatchKernelLzma,$(2),$(3))
    -$(STAGING_DIR_HOST)/bin/mkmylofw -B $(2) -s $(4) \
        -p0x030000:0xe0000:al:0x80060000:kernel:$(KDIR_TMP)/vmlinux-$(2).bin.lzma \
        -p0x110000:0:::rootfs:$(KDIR)/root.$(1) \
        $(call imgname,$(1),$(2))-$(5)-factory.img
endef

define Image/Build/UBNTXM
    $(call MkuImageLzma,$(2),$(3) $(ubntxm_mtdlayout))
    $(call Sysupgrade/KRuImage,$(1),$(2),1048576,6684672)
    dd if=$(KDIR_TMP)/vmlinux-$(2).uImage of=$(KDIR_TMP)/vmlinux-$(2).uImage.bin bs=1024k conv=sync
    -$(STAGING_DIR_HOST)/bin/mkfwimage \
        -B $(4) -v $(5).$(6).v6.0.0-OpenWrt-$(REVISION) \
        -k $(KDIR_TMP)/vmlinux-$(2).uImage.bin \
        -r $(BIN_DIR)/$(IMG_PREFIX)-root.$(1) \
        -o $(call factoryname,$(1),$(2))
endef


define Image/Build/UBDEV
    $(call MkuImageLzma,$(2),$(3) $(ubdev_mtdlayout))
    $(call Sysupgrade/KRuImage,$(1),$(2),1048576,6684672)
    dd if=$(KDIR_TMP)/vmlinux-$(2).uImage of=$(KDIR_TMP)/vmlinux-$(2).uImage.bin bs=1024k conv=sync
    -$(STAGING_DIR_HOST)/bin/mkfwimage \
        -B $(4) -v $(5).$(6).v6.0.0-OpenWrt-$(REVISION) \
        -k $(KDIR_TMP)/vmlinux-$(2).uImage.bin \
        -r $(BIN_DIR)/$(IMG_PREFIX)-root.$(1) \
        -o $(call factoryname,$(1),$(2))
endef

define Image/Build/UBNT
    $(call PatchKernelLzma,$(2),$(3))
    dd if=$(KDIR_TMP)/vmlinux-$(2).bin.lzma of=$(KDIR_TMP)/vmlinux-$(2).lzma bs=64k conv=sync
    -$(STAGING_DIR_HOST)/bin/mkfwimage \
        -B $(4) -v $(5).$(6).OpenWrt.$(REVISION) \
        -k $(KDIR_TMP)/vmlinux-$(2).lzma \
        -r $(BIN_DIR)/$(IMG_PREFIX)-root.$(1) \
        -o $(call factoryname,$(1),$(2))
    -sh $(TOPDIR)/scripts/combined-image.sh \
        &quot;$(KDIR_TMP)/vmlinux-$(2).lzma&quot; \
        &quot;$(BIN_DIR)/$(IMG_PREFIX)-root.$(1)&quot; \
  $(call sysupname,$(1),$(2))
endef

define Image/Build/Planex/loader
    $(call Image/BuildLoaderAlone,$(1),gz,$(2) $(planex_mtdlayout),0x52000,0)
endef

define Image/Build/Planex
    [ -e &quot;$(KDIR)/loader-$(2).gz&quot; ]
    $(call MkuImage,gzip,,$(KDIR)/loader-$(2).gz,$(KDIR_TMP)/vmlinux-$(2).uImage)
    $(call MkuImageOKLI,$(2))
    ( \
        dd if=$(KDIR_TMP)/vmlinux-$(2).uImage bs=8k count=1 conv=sync; \
        dd if=$(KDIR_TMP)/vmlinux-$(2).okli; \
    ) &gt; $(KDIR_TMP)/kernel-$(2).bin
    $(call Sysupgrade/KR,$(1),$(KDIR_TMP)/kernel-$(2).bin,983040,6815744,$(2))
    if [ -e &quot;$(call sysupname,$(1),$(2))&quot; ]; then \
        $(STAGING_DIR_HOST)/bin/mkplanexfw \
            -B $(2) \
            -v 2.00.00 \
            -i $(call sysupname,$(1),$(2)) \
            -o $(call factoryname,$(1),$(2)); \
    fi
endef

define Image/Build/ALFA
    $(call MkuImageLzma,$(2),$(3) $(4))
    $(call Sysupgrade/RKuImage,$(1),$(2),$(5),$(6))
    if [ -e &quot;$(call sysupname,$(1),$(2))&quot; ]; then \
        rm -rf $(KDIR)/$(1); \
        mkdir -p $(KDIR)/$(1); \
        cd $(KDIR)/$(1); \
        cp $(KDIR_TMP)/vmlinux-$(2).uImage $(KDIR)/$(1)/$(7); \
        cp $(KDIR)/root.$(1) $(KDIR)/$(1)/$(8); \
        $(TAR) zcf $(call factoryname,$(1),$(2)) -C $(KDIR)/$(1) $(7) $(8); \
        ( \
            echo WRM7222C | dd bs=32 count=1 conv=sync; \
            echo -ne &#039;\xfe&#039;; \
        ) &gt;&gt; $(call factoryname,$(1),$(2)); \
    fi
endef

define Image/Build/ALFA/initramfs
    $(call MkuImageLzma/initramfs,$(2),$(3) $(4))
endef

define Image/Build/TPLINKOLD/loader
    $(call Image/BuildLoaderAlone,$(1),gz,$(2),0x22000,0)
endef

define Image/Build/TPLINKOLD
    [ -e &quot;$(KDIR)/loader-$(2).gz&quot; ]
    $(call MkuImageOKLI,$(2))
    ( \
        dd if=$(KDIR)/loader-$(2).gz bs=7680 count=1 conv=sync; \
        dd if=$(KDIR_TMP)/vmlinux-$(2).okli conv=sync; \
    ) &gt; $(KDIR_TMP)/kernel-$(2).bin
    -$(STAGING_DIR_HOST)/bin/mktplinkfw \
        -H $(4) -W $(5) -F $(6) -N OpenWrt -V $(REVISION)\
        -k $(KDIR_TMP)/kernel-$(2).bin \
        -r $(KDIR)/root.$(1) \
        -o $(call factoryname,$(1),$(2))
    -$(STAGING_DIR_HOST)/bin/mktplinkfw \
        -H $(4) -W $(5) -F $(6) -N OpenWrt -V $(REVISION) -s\
        -k $(KDIR_TMP)/kernel-$(2).bin \
        -r $(KDIR)/root.$(1) \
        -o $(call sysupname,$(1),$(2))
endef

define Image/Build/TPLINKOLD/initramfs
    $(call Image/BuildLoader,$(2),gz,$(3),0x80060000)
    -$(STAGING_DIR_HOST)/bin/mktplinkfw -c \
        -H $(4) -W $(5) -F $(6) -N OpenWrt -V $(REVISION) -s\
        -k $(KDIR)/loader-$(2).gz \
        -o $(call imgname,$(1),$(2))-uImage.bin
endef

define Image/Build/TPLINK/loader
    $(call Image/BuildLoaderAlone,$(1),gz,$(2),0x22000,0)
endef

define Image/Build/TPLINK
    [ -e &quot;$(KDIR)/loader-$(2).gz&quot; ]
    $(call MkuImageOKLI,$(2))
    ( \
        dd if=$(KDIR)/loader-$(2).gz bs=7680 count=1 conv=sync; \
        dd if=$(KDIR_TMP)/vmlinux-$(2).okli conv=sync; \
    ) &gt; $(KDIR_TMP)/kernel-$(2).bin
    -$(STAGING_DIR_HOST)/bin/mktplinkfw \
        -H $(4) -W $(5) -F $(6) -N OpenWrt -V $(REVISION)\
        -k $(KDIR_TMP)/kernel-$(2).bin \
        -r $(KDIR)/root.$(1) \
        -a $(call rootfs_align,$(1)) -j \
        -o $(call factoryname,$(1),$(2))
    -$(STAGING_DIR_HOST)/bin/mktplinkfw \
        -H $(4) -W $(5) -F $(6) -N OpenWrt -V $(REVISION) -s\
        -k $(KDIR_TMP)/kernel-$(2).bin \
        -r $(KDIR)/root.$(1) \
        -a $(call rootfs_align,$(1)) -j \
        -o $(call sysupname,$(1),$(2))
endef

define Image/Build/TPLINK/initramfs
    $(call Image/BuildLoader,$(2),gz,$(3),0x80060000)
    -$(STAGING_DIR_HOST)/bin/mktplinkfw -c \
        -H $(4) -W $(5) -F $(6) -N OpenWrt -V $(REVISION) -s\
        -k $(KDIR)/loader-$(2).gz \
        -o $(call imgname,$(1),$(2))-uImage.bin
endef

define Image/Build/TPLINK-LZMA
    $(call PatchKernelLzma,$(2),$(3))
    -$(STAGING_DIR_HOST)/bin/mktplinkfw \
        -H $(4) -W $(5) -F $(6) -N OpenWrt -V $(REVISION) $(7) \
        -k $(KDIR_TMP)/vmlinux-$(2).bin.lzma \
        -r $(KDIR)/root.$(1) \
        -a $(call rootfs_align,$(1)) -j \
        -o $(call factoryname,$(1),$(2))
    -$(STAGING_DIR_HOST)/bin/mktplinkfw \
        -H $(4) -W $(5) -F $(6) -N OpenWrt -V $(REVISION) $(7) -s \
        -k $(KDIR_TMP)/vmlinux-$(2).bin.lzma \
        -r $(KDIR)/root.$(1) \
        -a $(call rootfs_align,$(1)) -j \
        -o $(call sysupname,$(1),$(2))
endef

define Image/Build/TPLINK-LZMA/initramfs
    $(call PatchKernelLzma,$(2),$(3))
    -$(STAGING_DIR_HOST)/bin/mktplinkfw -c \
        -H $(4) -W $(5) -F $(6) -N OpenWrt -V $(REVISION) $(7) -s \
        -k $(KDIR_TMP)/vmlinux-$(2).bin.lzma \
        -o $(call imgname,$(1),$(2))-uImage.bin
endef

define Image/Build/CyberTAN
    $(call MkuImageGzip,$(2),$(3))
    $(STAGING_DIR_HOST)/bin/trx -o $(KDIR)/image.tmp -f $(KDIR_TMP)/vmlinux-$(2).uImage \
        -x 32 -a 0x10000 -x -32 -f $(KDIR)/root.$(1)
    -$(STAGING_DIR_HOST)/bin/addpattern -B $(2) -v v$(4) \
        -i $(KDIR)/image.tmp \
        -o $(call sysupname,$(1),$(2))
    -$(STAGING_DIR_HOST)/bin/addpattern -B $(2) -v v$(4) -g \
        -i $(KDIR)/image.tmp \
        -o $(call factoryname,$(1),$(2))
    rm $(KDIR)/image.tmp
endef

define Image/Build/Netgear/Build_uImage
    $(call MkuImageLzma,$(1),$(2) $(3))
    -rm -rf $(KDIR)/$(1)
    mkdir -p $(KDIR)/$(1)/image
    $(STAGING_DIR_HOST)/bin/wndr3700 \
        $(KDIR_TMP)/vmlinux-$(1).uImage \
        $(KDIR)/$(1)/image/uImage \
        $(4)
    $(STAGING_DIR_HOST)/bin/mksquashfs-lzma \
        $(KDIR)/$(1) $(KDIR_TMP)/vmlinux-$(1).uImage.squashfs.tmp \
        -nopad -noappend -root-owned -be
    -rm -rf $(KDIR)/$(1)
    mkimage -A mips -O linux -T filesystem -C none \
        -a 0xbf070000 -e 0xbf070000 \
        -n &#039;MIPS OpenWrt Linux-$(LINUX_VERSION)&#039; \
        -d $(KDIR_TMP)/vmlinux-$(1).uImage.squashfs.tmp \
        $(KDIR_TMP)/vmlinux-$(1).uImage.squashfs.tmp2
    $(STAGING_DIR_HOST)/bin/wndr3700 \
        $(KDIR_TMP)/vmlinux-$(1).uImage.squashfs.tmp2 \
        $(KDIR_TMP)/vmlinux-$(1).uImage.squashfs \
        $(4)
    -rm -f $(KDIR_TMP)/vmlinux-$(1).uImage.squashfs.tmp*
endef

define Image/Build/Netgear/Estimate_uImage
    $(call Image/Build/Netgear/Build_uImage,$(1)_est,$(2),$(3),$(4))
    ( \
        set -e; \
        kk=`echo &#039;$(3)&#039; | sed -e &#039;s/.*[:,]\([0-9]*\)k(kernel).*/\1/&#039;`; \
        rk=`echo &#039;$(3)&#039; | sed -e &#039;s/.*[:,]\([0-9]*\)k(rootfs).*/\1/&#039;`; \
        let &#039;tk = kk + rk&#039;; \
        s=`stat -c&#039;%s&#039; &#039;$(KDIR_TMP)/vmlinux-$(1)_est.uImage.squashfs&#039;`; \
        c=`echo &#039;$(3)&#039; | wc -c`; \
        let &#039;kk = (((s + c) / (64 * 1024) + 1) * 64)&#039;; \
        let &#039;rk = tk - kk&#039;; \
        echo &#039;$(3)&#039; | sed -e &quot;s/[0-9]*k(kernel)/$$$${kk}k(kernel)/&quot; \
                  -e &quot;s/[0-9]*k(rootfs)/$$$${rk}k(rootfs)/&quot; &gt; \
            &#039;$(KDIR_TMP)/$(1)_mtdparts&#039;; \
        let &#039;k = kk * 1024&#039;; \
        echo &quot;$$$${k}&quot; &gt; &#039;$(KDIR_TMP)/$(1)_kernel_maxsize&#039;; \
        let &#039;r = rk * 1024&#039;; \
        echo &quot;$$$${r}&quot; &gt; &#039;$(KDIR_TMP)/$(1)_rootfs_maxsize&#039;; \
    )
    -rm -f $(KDIR_TMP)/vmlinux-$(1)_est \
           $(KDIR_TMP)/vmlinux-$(1)_est.bin.lzma \
           $(KDIR_TMP)/vmlinux-$(1)_est.uImage \
           $(KDIR_TMP)/vmlinux-$(1)_est.uImage.squashfs
endef

define Image/Build/Netgear
    $(call Image/Build/Netgear/Estimate_uImage,$(2),$(3),$(4),$(5))
    $(call Image/Build/Netgear/Build_uImage,$(2),$(3),`cat $(KDIR_TMP)/$(2)_mtdparts`,$(5))
    if [ `stat -c%s &#039;$(KDIR_TMP)/vmlinux-$(2).uImage.squashfs&#039;` -gt \
         `cat &#039;$(KDIR_TMP)/$(2)_kernel_maxsize&#039;` ]; then \
                echo &quot;$(KDIR_TMP)/vmlinux-$(2).uImage.squashfs is too big&quot; &gt;&amp; 2; \
    else if [ `stat -c%s &#039;$(KDIR)/root.$(1)&#039;` -gt \
         `cat &#039;$(KDIR_TMP)/$(2)_rootfs_maxsize&#039;` ]; then \
                echo &quot;$(KDIR)/root.$(1) is too big&quot; &gt;&amp; 2; \
    else \
        ( \
            set -e; \
            dd if=$(KDIR_TMP)/vmlinux-$(2).uImage.squashfs \
            bs=`cat &#039;$(KDIR_TMP)/$(2)_kernel_maxsize&#039;` conv=sync; \
            dd if=$(KDIR)/root.$(1) bs=64k; \
        ) &gt; $(call sysupname,$(1),$(2)); \
        for r in $(7) ; do \
            [ -n &quot;$$$$r&quot; ] &amp;&amp; dashr=&quot;-$$$$r&quot; || dashr= ; \
            $(STAGING_DIR_HOST)/bin/mkdniimg \
                -B $(6) -v OpenWrt.$(REVISION) -r &quot;$$$$r&quot; $(8) \
                -i $(call sysupname,$(1),$(2)) \
                -o $(call imgname,$(1),$(2))-factory$$$$dashr.img; \
        done; \
    fi; fi
endef

define Image/Build/Netgear/initramfs
    $(call MkuImageLzma,$(2),$(3) $(4))
    $(STAGING_DIR_HOST)/bin/wndr3700 \
        $(KDIR_TMP)/vmlinux-$(2).uImage \
        $(call imgname,$(1),$(2))-uImage.bin \
        $(5)
endef

ifdef CONFIG_PACKAGE_uboot-ar71xx-nbg460n_550n_550nh
  define Image/Build/ZyXEL
    $(call MkuImageLzma,$(2),$(3))
    $(call Sysupgrade/KRuImage,$(1),$(2),917504,2752512)
    if [ -e &quot;$(call sysupname,$(1),$(2))&quot; ]; then \
        if [ ! -f $(BIN_DIR)/$(IMG_PREFIX)-$(2)-u-boot.bin ]; then \
            echo &quot;Warning: $(IMG_PREFIX)-$(2)-u-boot.bin not found&quot;; \
        else \
            $(STAGING_DIR_HOST)/bin/mkzynfw \
                -B $(4) \
                -b $(BIN_DIR)/$(IMG_PREFIX)-$(2)-u-boot.bin \
                -r $(call sysupname,$(1),$(2)):0x10000 \
                -o $(call factoryname,$(1),$(2)); \
    fi; fi
  endef
endif

define Image/Build/OpenMesh
    $(call MkuImageLzma,$(2))
    -sh $(TOPDIR)/scripts/om-fwupgradecfg-gen.sh \
        &quot;$(BUILD_DIR)/om2p-fwupgrade.cfg&quot; \
        &quot;$(KDIR_TMP)/vmlinux-$(2).uImage&quot; \
        &quot;$(KDIR)/root.$(1)&quot;
    -sh $(TOPDIR)/scripts/combined-ext-image.sh \
        &quot;$(4)&quot; &quot;$(call factoryname,$(1),$(2))&quot; \
        &quot;$(BUILD_DIR)/om2p-fwupgrade.cfg&quot; &quot;fwupgrade.cfg&quot; \
        &quot;$(KDIR_TMP)/vmlinux-$(2).uImage&quot; &quot;kernel&quot; \
        &quot;$(KDIR)/root.$(1)&quot; &quot;rootfs&quot;
endef

define Image/Build/Zcomax
    $(call MkuImageLzma,$(2),$(3) $(4))
    $(call Sysupgrade/RKuImage,$(1),$(2),1507328,6356992)
    if [ -e &quot;$(call sysupname,$(1),$(2))&quot; ]; then \
        $(STAGING_DIR_HOST)/bin/mkzcfw \
            -B $(2) \
            -k $(KDIR_TMP)/vmlinux-$(2).uImage \
            -r $(BIN_DIR)/$(IMG_PREFIX)-root.$(1) \
            -o $(call imgname,$(1),$(2))-factory.img; \
    fi
endef

define Image/Build/Zcomax/initramfs
    $(call MkuImageLzma/initramfs,$(2),$(3) $(4))
endef

define Image/Build/Template/initramfs/initramfs
    $(call Image/Build/$(1)/initramfs,initramfs,$(2),$(3),$(4),$(5),$(6),$(7),$(8))
endef

define Image/Build/Template/all/squashfs
    $(call Image/Build/$(1),squashfs,$(2),$(3),$(4),$(5),$(6),$(7),$(8))
endef

define Image/Build/Template/all/jffs2-64k
    $(call Image/Build/$(1),jffs2-64k,$(2),$(3),$(4),$(5),$(6),$(7),$(8))
endef

define Image/Build/Template/all/jffs2-128k
    $(call Image/Build/$(1),jffs2-128k,$(2),$(3),$(4),$(5),$(6),$(7),$(8))
endef

define Image/Build/Template/all/jffs2-256k
    $(call Image/Build/$(1),jffs2-256k,$(2),$(3),$(4),$(5),$(6),$(7),$(8))
endef

define Image/Build/Template/squashfs-only/loader
    $(call Image/Build/$(1)/loader,$(2),$(3),$(4),$(5),$(6),$(7),$(8))
endef

define Image/Build/Template/squashfs-only/squashfs
    $(call Image/Build/$(1),squashfs,$(2),$(3),$(4),$(5),$(6),$(7),$(8))
endef

define Image/Build/Template/64k/loader
    $(call Image/Build/$(1)/loader,$(2),$(3),$(4),$(5),$(6),$(7),$(8))
endef

define Image/Build/Template/64k/squashfs
    $(call Image/Build/$(1),squashfs-64k,$(2),$(3),$(4),$(5),$(6),$(7),$(8))
endef

define Image/Build/Template/64k/jffs2-64k
    $(call Image/Build/$(1),jffs2-64k,$(2),$(3),$(4),$(5),$(6),$(7),$(8))
endef

define Image/Build/Template/64kraw/loader
    $(call Image/Build/$(1)/loader,$(2),$(3),$(4),$(5),$(6),$(7),$(8))
endef

define Image/Build/Template/64kraw/squashfs
    $(call Image/Build/$(1),squashfs-raw,$(2),$(3),$(4),$(5),$(6),$(7),$(8))
endef

define Image/Build/Template/64kraw/jffs2-64k
    $(call Image/Build/$(1),jffs2-64k,$(2),$(3),$(4),$(5),$(6),$(7),$(8))
endef

define Image/Build/Template/128k/squashfs
    $(call Image/Build/$(1),squashfs,$(2),$(3),$(4),$(5),$(6),$(7),$(8))
endef

define Image/Build/Template/128k/jffs2-128k
    $(call Image/Build/$(1),jffs2-128k,$(2),$(3),$(4),$(5),$(6),$(7),$(8))
endef

define Image/Build/Template/256k/squashfs
    $(call Image/Build/$(1),squashfs,$(2),$(3),$(4),$(5),$(6),$(7),$(8))
endef

define Image/Build/Template/256k/jffs2-256k
    $(call Image/Build/$(1),jffs2-256k,$(2),$(3),$(4),$(5),$(6),$(7),$(8))
endef

$(eval $(call SingleProfile,ALFA,$(fs_64k),ALFANX,alfa-nx,ALFA-NX,ttyS0,115200,$$(alfa_mtdlayout_8M),1638400,6291456,vmlinux.gz.uImage,pb9x-2.6.31-jffs2))
$(eval $(call SingleProfile,ALFA,$(fs_64k),HORNETUB,hornet-ub,HORNET-UB,ttyATH0,115200,$$(alfa_mtdlayout_8M),1638400,6291456,kernel_image,rootfs_image))
$(eval $(call SingleProfile,AthGzip,$(fs_64k),AP81,ap81,AP81,ttyS0,115200,,1310720,6619136,KRuImage))
$(eval $(call SingleProfile,AthGzip,$(fs_64k),AP83,ap83,AP83,ttyS0,115200,,1310720,6619136,KRuImage))
$(eval $(call SingleProfile,AthGzip,$(fs_64k),AP96,ap96,AP96,ttyS0,115200,$$(ap96_mtdlayout),1769472,6291456,RKuImage))
$(eval $(call SingleProfile,AthLzma,$(fs_64k),ALFAAP96,alfa-ap96,ALFA-AP96,ttyS0,115200,$$(alfa_ap96_mtdlayout),2097152,13631488,RKuImage))
$(eval $(call SingleProfile,AthLzma,$(fs_64k),ALL0258N,all0258n,ALL0258N,ttyS0,115200,$$(all0258n_mtdlayout),1048576,5373952,KRuImage))
$(eval $(call SingleProfile,AthLzma,$(fs_256k),ALL0315N,all0315n,ALL0315N,ttyS0,115200,$$(all0315n_mtdlayout),1048576,12845056,KRuImage))
$(eval $(call SingleProfile,AthLzma,$(fs_64k),AP113,ap113,AP113,ttyS0,115200,$$(ap113_mtd_layout),917504,3080192,RK))
$(eval $(call SingleProfile,AthLzma,$(fs_64k),AP121_2M,ap121-2M,AP121,ttyATH0,115200,$$(ap121_mtdlayout_2M),720896,1245184,RKuImage))
$(eval $(call SingleProfile,AthLzma,$(fs_64k),AP121_4M,ap121-4M,AP121,ttyATH0,115200,$$(ap121_mtdlayout_4M),917504,2818048,RKuImage))
$(eval $(call SingleProfile,AthLzma,$(fs_64k),AP121MINI,ap121-mini,AP121-MINI,ttyATH0,115200,$$(ap121_mtdlayout_4M),917504,2818048,RKuImage))
$(eval $(call SingleProfile,AthLzma,$(fs_64k),AP136,ap136,AP136,ttyS0,115200,$$(ap136_mtdlayout),1441792,6488064,RKuImage))
$(eval $(call SingleProfile,AthLzma,$(fs_64k),CAP4200AG,cap4200ag,CAP4200AG,ttyS0,115200,$$(cap4200ag_mtdlayout),1572864,12386304,KRuImage))
$(eval $(call SingleProfile,AthLzma,$(fs_64k),DB120,db120,DB120,ttyS0,115200,$$(db120_mtdlayout),1441792,6488064,RKuImage))
$(eval $(call SingleProfile,AthLzma,$(fs_64k),EWDORINAP,ew-dorin,EW-DORIN,ttyATH0,115200,$$(ew-dorin_mtdlayout_4M),1048576,2752512,KRuImage))
$(eval $(call SingleProfile,AthLzma,$(fs_64k),EWDORINRT,ew-dorin-router,EW-DORIN-ROUTER,ttyATH0,115200,$$(ew-dorin_mtdlayout_4M),1048576,2752512,KRuImage))
$(eval $(call SingleProfile,AthLzma,$(fs_64k),PB92,pb92,PB92,ttyS0,115200,$$(pb92_mtdlayout),917504,2818048,KRuImage))
$(eval $(call SingleProfile,Cameo7240,$(fs_64k),DIR600A1,dir-600-a1,DIR-600-A1,ttyS0,115200,&quot;AP91-AR7240-RT-090223-00&quot;))
$(eval $(call SingleProfile,Cameo7240,$(fs_64k),DIR601A1,dir-601-a1,DIR-600-A1,ttyS0,115200,&quot;AP91-AR7240-RT-090223-02&quot;))
$(eval $(call SingleProfile,Cameo7240,$(fs_64k),DIR615E4,dir-615-e4,DIR-615-E4,ttyS0,115200,&quot;AP99-AR7240-RT-091105-05&quot;))
$(eval $(call SingleProfile,Cameo7240,$(fs_64k),FR54RTR,fr-54rtr,DIR-600-A1,ttyS0,115200,&quot;AP91-AR7240-RT-090223-01&quot;))
$(eval $(call SingleProfile,Cameo913x,$(fs_squash),A02RBW300N,a02-rb-w300n,TEW-632BRP,ttyS0,115200,&quot;AP81-AR9130-RT-070614-03&quot;))
$(eval $(call SingleProfile,Cameo913x,$(fs_squash),DIR615C1,dir-615-c1,DIR-615-C1,ttyS0,115200,&quot;AP81-AR9130-RT-070614-02&quot;))
$(eval $(call SingleProfile,Cameo913x,$(fs_squash),TEW632BRP,tew-632brp,TEW-632BRP,ttyS0,115200,&quot;AP81-AR9130-RT-070614-00&quot;))
$(eval $(call SingleProfile,Cameo913x,$(fs_squash),TEW652BRP_FW,tew-652brp,TEW-632BRP,ttyS0,115200,&quot;AP81-AR9130-RT-080609-05&quot;))
$(eval $(call SingleProfile,Cameo913x,$(fs_squash),TEW652BRP_RECOVERY,tew-652brp-recovery,TEW-632BRP,ttyS0,115200,&quot;AP81-AR9130-RT-070614-02&quot;))
$(eval $(call SingleProfile,Cameo933x,$(fs_squash),TEW712BR,tew-712br,TEW-712BR,ttyATH0,115200,&quot;HORNET-RT-TEW712BR-3&quot;))
$(eval $(call SingleProfile,CyberTAN,$(fs_64k),WRT160NL,wrt160nl,WRT160NL,ttyS0,115200,1.00.01))
$(eval $(call SingleProfile,DIR825B1,$(fs_64k),DIR825B1,dir-825-b1,DIR-825-B1,ttyS0,115200,01AP94-AR7161-RT-080619-00,00AP94-AR7161-RT-080619-00))
$(eval $(call SingleProfile,DIR825B1,$(fs_64k),TEW673GRU,tew-673gru,TEW-673GRU,ttyS0,115200,01AP94-AR7161-RT-080619-01,00AP94-AR7161-RT-080619-01))
$(eval $(call SingleProfile,DLRTDEV,$(fs_64k),DLRTDEV01,dlrtdev01,DIR-825-B1,ttyS0,115200,01AP94-AR7161-RT-080619-00,00AP94-AR7161-RT-080619-00))
$(eval $(call SingleProfile,MyLoader,$(fs_64k),WP543_2M,wp543,,ttyS0,115200,0x200000,2M))
$(eval $(call SingleProfile,MyLoader,$(fs_64k),WP543_4M,wp543,,ttyS0,115200,0x400000,4M))
$(eval $(call SingleProfile,MyLoader,$(fs_64k),WP543_8M,wp543,,ttyS0,115200,0x800000,8M))
$(eval $(call SingleProfile,MyLoader,$(fs_64k),WP543_16M,wp543,,ttyS0,115200,0x1000000,16M))
$(eval $(call SingleProfile,MyLoader,$(fs_64k),WPE72_4M,wpe72,,ttyS0,115200,0x400000,4M))
$(eval $(call SingleProfile,MyLoader,$(fs_64k),WPE72_8M,wpe72,,ttyS0,115200,0x800000,8M))
$(eval $(call SingleProfile,MyLoader,$(fs_64k),WPE72_16M,wpe72,,ttyS0,115200,0x1000000,16M))
$(eval $(call SingleProfile,Netgear,$(fs_64k),WNDR3700V1,wndr3700,WNDR3700,ttyS0,115200,$$(wndr3700_mtdlayout),3700,WNDR3700,&quot;&quot; NA,))
$(eval $(call SingleProfile,Netgear,$(fs_64k),WNDR3700V2,wndr3700v2,WNDR3700,ttyS0,115200,$$(wndr3700v2_mtdlayout),3701,WNDR3700v2,&quot;&quot;,-H 29763654+16+64))
$(eval $(call SingleProfile,Netgear,$(fs_64k),WNDR3800,wndr3800,WNDR3700,ttyS0,115200,$$(wndr3700v2_mtdlayout),3701,WNDR3800,&quot;&quot;,-H 29763654+16+128))
$(eval $(call SingleProfile,Netgear,$(fs_64k),WNDRMAC,wndrmac,WNDR3700,ttyS0,115200,$$(wndr3700v2_mtdlayout),3701,WNDRMAC,&quot;&quot;,-H 29763654+16+64))
$(eval $(call SingleProfile,Netgear,$(fs_64k),WNDRMACV2,wndrmacv2,WNDR3700,ttyS0,115200,$$(wndr3700v2_mtdlayout),3701,WNDRMACv2,&quot;&quot;,-H 29763654+16+128))
$(eval $(call SingleProfile,OpenMesh,$(fs_squash),OM2P,om2p,,,,OM2P))
$(eval $(call SingleProfile,PB4X,$(fs_128k),ALL0305,all0305,ALL0305,ttyS0,115200))
$(eval $(call SingleProfile,PB4X,$(fs_128k),EAP7660D,eap7660d,EAP7660D,ttyS0,115200))
$(eval $(call SingleProfile,PB4X,$(fs_64k),JA76PF,ja76pf,JA76PF,ttyS0,115200))
$(eval $(call SingleProfile,PB4X,$(fs_64k),JA76PF2,ja76pf2,JA76PF2,ttyS0,115200))
$(eval $(call SingleProfile,PB4X,$(fs_64k),JWAP003,jwap003,JWAP003,ttyS0,115200))
$(eval $(call SingleProfile,PB4X,$(fs_64k),PB42,pb42,PB42,ttyS0,115200))
$(eval $(call SingleProfile,PB4X,$(fs_64k),PB44,pb44,PB44,ttyS0,115200))
$(eval $(call SingleProfile,Planex,$(fs_64k),MZKW04NU,mzk-w04nu,MZK-W04NU,ttyS0,115200))
$(eval $(call SingleProfile,Planex,$(fs_64k),MZKW300NH,mzk-w300nh,MZK-W300NH,ttyS0,115200))
$(eval $(call SingleProfile,TPLINKOLD,$(fs_squash),TLWR841NV15,tl-wr841nd-v1.5,TL-WR841N-v1.5,ttyS0,115200,0x08410002,2,4M))
$(eval $(call SingleProfile,TPLINK,$(fs_64kraw),TLWA701,tl-wa701n-v1,TL-WA901ND,ttyS0,115200,0x07010001,1,4M))
$(eval $(call SingleProfile,TPLINK,$(fs_64kraw),TLWA7510NV1,tl-wa7510n,TL-WA7510N,ttyS0,115200,0x75100001,1,4M))
$(eval $(call SingleProfile,TPLINK,$(fs_64kraw),TLWA901NV1,tl-wa901nd-v1,TL-WA901ND,ttyS0,115200,0x09010001,1,4M))
$(eval $(call SingleProfile,TPLINK,$(fs_64kraw),TLWA901NV2,tl-wa901nd-v2,TL-WA901ND-v2,ttyS0,115200,0x09010002,1,4M))
$(eval $(call SingleProfile,TPLINK,$(fs_64kraw),TLWR740NV1,tl-wr740n-v1,TL-WR741ND,ttyS0,115200,0x07400001,1,4M))
$(eval $(call SingleProfile,TPLINK,$(fs_64kraw),TLWR740NV3,tl-wr740n-v3,TL-WR741ND,ttyS0,115200,0x07400003,1,4M))
$(eval $(call SingleProfile,TPLINK,$(fs_64kraw),TLWR741NV1,tl-wr741nd-v1,TL-WR741ND,ttyS0,115200,0x07410001,1,4M))
$(eval $(call SingleProfile,TPLINK,$(fs_64kraw),TLWR741NV2,tl-wr741nd-v2,TL-WR741ND,ttyS0,115200,0x07410001,1,4M))
$(eval $(call SingleProfile,TPLINK,$(fs_64kraw),TLWR743,tl-wr743nd-v1,TL-WR741ND,ttyS0,115200,0x07430001,1,4M))
$(eval $(call SingleProfile,TPLINK,$(fs_64kraw),TLWR841NV3,tl-wr841nd-v3,TL-WR941ND,ttyS0,115200,0x08410003,3,4M))
$(eval $(call SingleProfile,TPLINK,$(fs_64kraw),TLWR841NV5,tl-wr841nd-v5,TL-WR741ND,ttyS0,115200,0x08410005,1,4M))
$(eval $(call SingleProfile,TPLINK,$(fs_64kraw),TLWR841NV7,tl-wr841nd-v7,TL-WR841N-v7,ttyS0,115200,0x08410007,1,4M))
$(eval $(call SingleProfile,TPLINK,$(fs_64kraw),TLWR842,tl-wr842n-v1,TL-MR3420,ttyS0,115200,0x08420001,1,8M))
$(eval $(call SingleProfile,TPLINK,$(fs_64kraw),TLWR941NV2,tl-wr941nd-v2,TL-WR941ND,ttyS0,115200,0x09410002,2,4M))
$(eval $(call SingleProfile,TPLINK,$(fs_64kraw),TLWR941NV3,tl-wr941nd-v3,TL-WR941ND,ttyS0,115200,0x09410002,2,4M))
$(eval $(call SingleProfile,TPLINK,$(fs_64kraw),TLWR941NV4,tl-wr941nd-v4,TL-WR741ND,ttyS0,115200,0x09410004,1,4M))
$(eval $(call SingleProfile,TPLINK,$(fs_64kraw),TLWR1043,tl-wr1043nd-v1,TL-WR1043ND,ttyS0,115200,0x10430001,1,8M))
$(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLMR11U,tl-mr11u-v1,TL-MR11U,ttyATH0,115200,0x00110101,1,4Mlzma))
$(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLMR3020V1,tl-mr3020-v1,TL-MR3020,ttyATH0,115200,0x30200001,1,4Mlzma))
$(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLMR3020V2,tl-mr3220-v2,TL-MR3020,ttyATH0,115200,0x32200002,1,4Mlzma))
$(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLMR3040,tl-mr3040-v1,TL-MR3040,ttyATH0,115200,0x30400001,1,4Mlzma))
$(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLMR3220V2,tl-mr3220-v2,TL-MR3220,ttyATH0,115200,0x32200002,1,4Mlzma))
$(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLMR3420V2,tl-mr3420-v2,TL-MR3420,ttyATH0,115200,0x34200002,1,4Mlzma))
$(eval $(call SingleProfile,TPLINK,$(fs_64kraw),TLMR3220V1,tl-mr3220-v1,TL-MR3220,ttyS0,115200,0x32200001,1,4M)) 
$(eval $(call SingleProfile,TPLINK,$(fs_64kraw),TLMR3420V1,tl-mr3420-v1,TL-MR3420,ttyS0,115200,0x34200001,1,4M)) 
$(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLWR703,tl-wr703n-v1,TL-WR703N,ttyATH0,115200,0x07030101,1,4Mlzma))
$(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLWR740NV4,tl-wr740n-v4,TL-WR741ND-v4,ttyATH0,115200,0x07400004,1,4Mlzma))
$(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLMR3220V2,tl-mr3220-v2,TL-WR741ND-v4,ttyATH0,115200,0x32200002,1,4Mlzma))
$(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLWR841NV8,tl-wr841n-v8,TL-WR841N-v8,ttyS0,115200,0x08410008,1,4Mlzma))
$(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLWR1041,tl-wr1041n-v2,TL-WR1041N-v2,ttyS0,115200,0x10410002,1,4Mlzma))
$(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLWR2543,tl-wr2543-v1,TL-WR2543N,ttyS0,115200,0x25430001,1,8Mlzma,-v 3.13.99))
$(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLWDR3600V1,tl-wdr3600-v1,TL-WDR4300,ttyS0,115200,0x36000001,1,8Mlzma))
$(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLWDR4300V1,tl-wdr4300-v1,TL-WDR4300,ttyS0,115200,0x43000001,1,8Mlzma))
$(eval $(call SingleProfile,TPLINK-LZMA,$(fs_64kraw),TLWDR4310V1,tl-wdr4310-v1,TL-WDR4300,ttyS0,115200,0x43100001,1,8Mlzma))
$(eval $(call SingleProfile,UBDEV,$(fs_64k),UBDEV01,ubdev01,UBNT-UF,ttyS0,115200,XM,XM,ar7240))
$(eval $(call SingleProfile,UBNT,$(fs_64k),UBNTRS,ubnt-rs,UBNT-RS,ttyS0,115200,RS,RSx,ar7100))
$(eval $(call SingleProfile,UBNT,$(fs_64k),UBNTRSPRO,ubnt-rspro,UBNT-RSPRO,ttyS0,115200,RSPRO,RSPRO,ar7100pro))
$(eval $(call SingleProfile,UBNT,$(fs_64k),UBNTLSSR71,ubnt-ls-sr71,UBNT-LS-SR71,ttyS0,115200,LS-SR71,LS-SR71,ar7100))
$(eval $(call SingleProfile,UBNTXM,$(fs_64k),RW2458N,rw2458n,RW2458N,ttyS0,115200,XM,XM,ar7240))
$(eval $(call SingleProfile,UBNTXM,$(fs_64k),UBNTAIRROUTER,ubnt-airrouter,UBNT-AR,ttyS0,115200,XM,XM,ar7240))
$(eval $(call SingleProfile,UBNTXM,$(fs_64k),UBNTBULLETM,ubnt-bullet-m,UBNT-BM,ttyS0,115200,XM,XM,ar7240))
$(eval $(call SingleProfile,UBNTXM,$(fs_64k),UBNTROCKETM,ubnt-rocket-m,UBNT-RM,ttyS0,115200,XM,XM,ar7240))
$(eval $(call SingleProfile,UBNTXM,$(fs_64k),UBNTNANOM,ubnt-nano-m,UBNT-NM,ttyS0,115200,XM,XM,ar7240))
$(eval $(call SingleProfile,UBNTXM,$(fs_64k),UBNTUNIFI,ubnt-unifi,UBNT-UF,ttyS0,115200,XM,XM,ar7240))
$(eval $(call SingleProfile,UBNTXM,$(fs_64k),UBNTUNIFIOUTDOOR,ubnt-unifi-outdoor,UBNT-U20,ttyS0,115200,XM,XM,ar7240))
$(eval $(call SingleProfile,WHRHPG300N,$(fs_64k),WHRG301N,whr-g301n,WHR-G301N,ttyS0,115200,$$(whrhpg300n_mtdlayout),WHR-G301N))
$(eval $(call SingleProfile,WHRHPG300N,$(fs_64k),WHRHPG300N,whr-hp-g300n,WHR-HP-G300N,ttyS0,115200,$$(whrhpg300n_mtdlayout),WHR-HP-G300N))
$(eval $(call SingleProfile,WHRHPG300N,$(fs_64k),WHRHPGN,whr-hp-gn,WHR-HP-GN,ttyS0,115200,$$(whrhpg300n_mtdlayout),WHR-HP-GN))
$(eval $(call SingleProfile,WHRHPG300N,$(fs_64k),WLAEAG300N,wlae-ag300n,WLAE-AG300N,ttyS0,115200,$$(whrhpg300n_mtdlayout),WLAE-AG300N))
$(eval $(call SingleProfile,WRT400N,$(fs_64k),WRT400N,wrt400n,WRT400N,ttyS0,115200))
$(eval $(call SingleProfile,WZRHPG30XNH,$(fs_128k),WZRHPG300NH,wzr-hp-g300nh,WZR-HP-G300NH,ttyS0,115200,WZR-HP-G300NH))
$(eval $(call SingleProfile,WZRHPG30XNH,$(fs_64k),WZRHPG300NH2,wzr-hp-g300nh2,WZR-HP-G300NH2,ttyS0,115200,WZR-HP-G300NH2))
$(eval $(call SingleProfile,WZRHPG30XNH,$(fs_64k),WZRHPAG300H,wzr-hp-ag300h,WZR-HP-AG300H,ttyS0,115200,WZR-HP-AG300H))
$(eval $(call SingleProfile,WZRHPG30XNH,$(fs_64k),WZRHPG450H,wzr-hp-g450h,WZR-HP-G450H,ttyS0,115200,WZR-HP-AG450H))
$(eval $(call SingleProfile,Zcomax,$(fs_64k),ZCN1523H28,zcn-1523h-2-8,ZCN-1523H-2,ttyS0,115200,$$(zcn1523h_mtdlayout)))
$(eval $(call SingleProfile,Zcomax,$(fs_64k),ZCN1523H516,zcn-1523h-5-16,ZCN-1523H-5,ttyS0,115200,$$(zcn1523h_mtdlayout)))
$(eval $(call SingleProfile,ZyXEL,$(fs_64k),NBG_460N_550N_550NH,nbg460n_550n_550nh,NBG460N,ttyS0,115200,NBG-460N))
$(eval $(call MultiProfile,AP121,AP121_2M AP121_4M))
$(eval $(call MultiProfile,EWDORIN, EWDORINAP EWDORINRT))
$(eval $(call MultiProfile,TEW652BRP,TEW652BRP_FW TEW652BRP_RECOVERY))
$(eval $(call MultiProfile,TLWA901,TLWA901NV1 TLWA901NV2))
$(eval $(call MultiProfile,TLWA7510,TLWA7510NV1))
$(eval $(call MultiProfile,TLWR740,TLWR740NV1 TLWR740NV3 TLWR740NV4))
$(eval $(call MultiProfile,TLMR3220,TLMR3220V1 TLMR3220V2))
$(eval $(call MultiProfile,TLMR3420,TLMR3420V1 TLMR3420V2))
$(eval $(call MultiProfile,TLMR3020,TLMR3020V1 TLMR3020V2))
$(eval $(call MultiProfile,TLWR741,TLWR741NV1 TLWR741NV2 TLWR741NV4))
$(eval $(call MultiProfile,TLWR841,TLWR841NV15 TLWR841NV3 TLWR841NV5 TLWR841NV7 TLWR841NV8))
$(eval $(call MultiProfile,TLWR941,TLWR941NV2 TLWR941NV3 TLWR941NV4))
$(eval $(call MultiProfile,TLWDR4300,TLWDR3600V1 TLWDR4300V1 TLWDR4310V1))
$(eval $(call MultiProfile,UBNT,UBNTAIRROUTER UBNTRS UBNTRSPRO UBNTLSSR71 UBNTBULLETM UBNTROCKETM UBNTNANOM UBNTUNIFI UBNTUNIFIOUTDOOR))
$(eval $(call MultiProfile,WNDR3700,WNDR3700V1 WNDR3700V2 WNDR3800 WNDRMAC WNDRMACV2))
$(eval $(call MultiProfile,WP543,WP543_2M WP543_4M WP543_8M WP543_16M))
$(eval $(call MultiProfile,WPE72,WPE72_4M WPE72_8M WPE72_16M))
$(eval $(call MultiProfile,Default,$(SINGLE_PROFILES)))
$(eval $(call MultiProfile,Minimal,$(SINGLE_PROFILES)))
$(eval $(call MultiProfile,Madwifi,EAP7660D UBNTRS UBNTRSPRO UBNTLSSR71 WP543))

define Image/Build/squashfs
    cp $(KDIR)/root.squashfs $(KDIR)/root.squashfs-raw
    cp $(KDIR)/root.squashfs $(KDIR)/root.squashfs-64k
    $(STAGING_DIR_HOST)/bin/padjffs2 $(KDIR)/root.squashfs-64k 64
    cp $(KDIR)/root.squashfs-64k $(BIN_DIR)/$(IMG_PREFIX)-root.squashfs-64k
    $(call prepare_generic_squashfs,$(KDIR)/root.squashfs)
endef

define Image/Build/Initramfs
    $(call Image/Build/Profile/$(PROFILE),initramfs)
endef

define Image/Prepare
    gzip -9 -c $(KDIR)/vmlinux &gt; $(KDIR)/vmlinux.bin.gz
    $(call CompressLzma,$(KDIR)/vmlinux,$(KDIR)/vmlinux.bin.lzma)
    $(call Image/Build/Profile/$(if $(CONFIG_IB),Default,$(PROFILE)),loader)
endef

define Image/Build
    $(call Image/Build/$(1))
    dd if=$(KDIR)/root.$(1) of=$(BIN_DIR)/$(IMG_PREFIX)-root.$(1) bs=128k conv=sync
    $(call Image/Build/Profile/$(PROFILE),$(1))
endef

$(eval $(call BuildImage))</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p184227">
				<div class="post-metadata">
					<div class="post-num">Post #42</div>
					<div class="post-author">cindy.wijaya</div>
					<div class="post-datetime">
						25 Nov 2012, 05:22					</div>
				</div>
				<div class="post-content content">
					<p>build_dir/linux-ar71xx_generic/linux-3.3.8/arch/mips/ath79/Kconfig<br/></p><div class="codebox"><pre><code>if ATH79

menu &quot;Atheros AR71XX/AR724X/AR913X machine selection&quot;

config ATH79_MACH_ALFA_AP96
    bool &quot;ALFA Network AP96 board support&quot;
    select SOC_AR71XX
    select ATH79_DEV_ETH
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_SPI
    select ATH79_DEV_USB

config ATH79_MACH_HORNET_UB
    bool &quot;ALFA Network Hornet-UB board support&quot;
    select SOC_AR933X
    select ATH79_DEV_ETH
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_LEDS_GPIO
    select ATH79_DEV_M25P80
    select ATH79_DEV_USB
    select ATH79_DEV_WMAC

config ATH79_MACH_ALFA_NX
    bool &quot;ALFA Network N2/N5 board support&quot;
    select SOC_AR724X
    select ATH79_DEV_AP9X_PCI if PCI
    select ATH79_DEV_ETH
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_LEDS_GPIO
    select ATH79_DEV_M25P80

config ATH79_MACH_ALL0258N
    bool &quot;Allnet ALL0258N support&quot;
    select SOC_AR724X
    select ATH79_DEV_AP9X_PCI if PCI
    select ATH79_DEV_ETH
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_LEDS_GPIO
    select ATH79_DEV_M25P80

config ATH79_MACH_ALL0315N
    bool &quot;Allnet ALL0315N support&quot;
    select SOC_AR724X
    select ATH79_DEV_AP9X_PCI if PCI
    select ATH79_DEV_ETH
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_LEDS_GPIO
    select ATH79_DEV_M25P80

config ATH79_MACH_AP113
    bool &quot;Atheros AP113 board support&quot;
    select SOC_AR724X
    select ATH79_DEV_M25P80
    select ATH79_DEV_PB9X_PCI if PCI
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_LEDS_GPIO
    select ATH79_DEV_USB
    select ATH79_DEV_ETH

config ATH79_MACH_AP121
    bool &quot;Atheros AP121 reference board&quot;
    select SOC_AR933X
    select ATH79_DEV_ETH
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_LEDS_GPIO
    select ATH79_DEV_M25P80
    select ATH79_DEV_USB
    select ATH79_DEV_WMAC
    help
      Say &#039;Y&#039; here if you want your kernel to support the
      Atheros AP121 reference board.

config ATH79_MACH_AP136
    bool &quot;Atheros AP136 reference board&quot;
    select SOC_QCA955X
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_LEDS_GPIO
    select ATH79_DEV_SPI
    select ATH79_DEV_USB
    select ATH79_DEV_WMAC
    help
      Say &#039;Y&#039; here if you want your kernel to support the
      Atheros AP136 reference board.

config ATH79_MACH_AP81
    bool &quot;Atheros AP81 reference board&quot;
    select SOC_AR913X
    select ATH79_DEV_ETH
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_LEDS_GPIO
    select ATH79_DEV_M25P80
    select ATH79_DEV_USB
    select ATH79_DEV_WMAC
    help
      Say &#039;Y&#039; here if you want your kernel to support the
      Atheros AP81 reference board.

config ATH79_MACH_AP83
    bool &quot;Atheros AP83 board support&quot;
    select SOC_AR913X
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_LEDS_GPIO
    select ATH79_DEV_USB
    select ATH79_DEV_WMAC

config ATH79_MACH_AP96
    bool &quot;Atheros AP96 board support&quot;
    select SOC_AR71XX
    select ATH79_DEV_ETH
    select ATH79_DEV_AP9X_PCI if PCI
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_LEDS_GPIO
    select ATH79_DEV_M25P80
    select ATH79_DEV_USB

config ATH79_MACH_DB120
    bool &quot;Atheros DB120 reference board&quot;
    select SOC_AR934X
    select ATH79_DEV_AP9X_PCI if PCI
    select ATH79_DEV_ETH
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_LEDS_GPIO
    select ATH79_DEV_M25P80
    select ATH79_DEV_NFC
    select ATH79_DEV_USB
    select ATH79_DEV_WMAC
    help
      Say &#039;Y&#039; here if you want your kernel to support the
      Atheros DB120 reference board.

config ATH79_MACH_PB42
    bool &quot;Atheros PB42 board support&quot;
    select SOC_AR71XX
    select ATH79_DEV_ETH
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_M25P80

config ATH79_MACH_PB44
    bool &quot;Atheros PB44 reference board&quot;
    select SOC_AR71XX
    select ATH79_DEV_ETH
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_LEDS_GPIO
    select ATH79_DEV_SPI
    select ATH79_DEV_USB
    help
      Say &#039;Y&#039; here if you want your kernel to support the
      Atheros PB44 reference board.

config ATH79_MACH_PB92
    bool &quot;Atheros PB92 board support&quot;
    select SOC_AR724X
    select ATH79_DEV_ETH
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_LEDS_GPIO
    select ATH79_DEV_PB9X_PCI if PCI
    select ATH79_DEV_USB

config ATH79_MACH_AW_NR580
    bool &quot;AzureWave AW-NR580 board support&quot;
    select SOC_AR71XX
    select ATH79_DEV_ETH
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_LEDS_GPIO
    select ATH79_DEV_M25P80

config ATH79_MACH_WHR_HP_G300N
    bool &quot;Buffalo WHR-HP-G300N board support&quot;
    select SOC_AR724X
    select ATH79_DEV_ETH
    select ATH79_DEV_AP9X_PCI if PCI
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_LEDS_GPIO
    select ATH79_DEV_M25P80

config ATH79_MACH_WLAE_AG300N
    bool &quot;Buffalo WLAE-AG300N board support&quot;
    select SOC_AR71XX
    select ATH79_DEV_ETH
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_LEDS_GPIO
    select ATH79_DEV_M25P80

config ATH79_MACH_WZR_HP_AG300H
    bool &quot;Buffalo WZR-HP-AG300H board support&quot;
    select SOC_AR71XX
    select ATH79_DEV_ETH
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_LEDS_GPIO
    select ATH79_DEV_M25P80
    select ATH79_DEV_USB

config ATH79_MACH_WZR_HP_G300NH
    bool &quot;Buffalo WZR-HP-G300NH board support&quot;
    select SOC_AR913X
    select ATH79_DEV_ETH
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_LEDS_GPIO
    select ATH79_DEV_USB
    select ATH79_DEV_WMAC
    select RTL8366_SMI

config ATH79_MACH_WZR_HP_G300NH2
    bool &quot;Buffalo WZR-HP-G300NH2 board support&quot;
    select SOC_AR724X
    select ATH79_DEV_AP9X_PCI if PCI
    select ATH79_DEV_ETH
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_LEDS_GPIO
    select ATH79_DEV_M25P80
    select ATH79_DEV_USB

config ATH79_MACH_WZR_HP_G450H
    bool &quot;Buffalo WZR-HP-G450H board support&quot;
    select SOC_AR724X
    select ATH79_DEV_ETH
    select ATH79_DEV_AP9X_PCI if PCI
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_LEDS_GPIO
    select ATH79_DEV_M25P80
    select ATH79_DEV_USB

config ATH79_MACH_WP543
    bool &quot;Compex WP543/WPJ543 board support&quot;
    select SOC_AR71XX
    select ATH79_DEV_ETH
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_LEDS_GPIO
    select ATH79_DEV_M25P80
    select ATH79_DEV_USB
    select MYLOADER

config ATH79_MACH_WPE72
    bool &quot;Compex WPE72/WPE72NX board support&quot;
    select SOC_AR724X
    select ATH79_DEV_ETH
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_LEDS_GPIO
    select ATH79_DEV_M25P80
    select ATH79_DEV_USB
    select MYLOADER

config ATH79_MACH_DIR_600_A1
    bool &quot;D-Link DIR-600 A1/DIR-615 E4 support&quot;
    select SOC_AR724X
    select ATH79_DEV_AP9X_PCI if PCI
    select ATH79_DEV_ETH
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_LEDS_GPIO
    select ATH79_DEV_M25P80
    select ATH79_NVRAM

config ATH79_MACH_DIR_615_C1
    bool &quot;D-Link DIR-615 rev. C1 support&quot;
    select SOC_AR913X
    select ATH79_DEV_ETH
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_LEDS_GPIO
    select ATH79_DEV_M25P80
    select ATH79_DEV_WMAC
    select ATH79_NVRAM

config ATH79_MACH_DIR_825_B1
    bool &quot;D-Link DIR-825 rev. B1 board support&quot;
    select SOC_AR71XX
    select ATH79_DEV_ETH
    select ATH79_DEV_AP9X_PCI if PCI
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_LEDS_GPIO
    select ATH79_DEV_M25P80
    select ATH79_DEV_USB

config ATH79_MACH_EW_DORIN
    bool &quot;embedded wireless Dorin Platform support&quot;
    select SOC_AR933X
    select ATH79_DEV_M25P80
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_LEDS_GPIO
    select ATH79_DEV_WMAC
    select ATH79_DEV_ETH
    help
      Say &#039;Y&#039; here if you want your kernel to support the
      Dorin Platform from www.80211.de .

config ATH79_MACH_JA76PF
    bool &quot;jjPlus JA76PF board support&quot;
    select SOC_AR71XX
    select ATH79_DEV_ETH
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_LEDS_GPIO
    select ATH79_DEV_M25P80
    select ATH79_DEV_USB

config ATH79_MACH_JWAP003
    bool &quot;jjPlus JWAP003 board support&quot;
    select SOC_AR71XX
    select ATH79_DEV_ETH
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_M25P80
    select ATH79_DEV_USB

config ATH79_MACH_WRT160NL
    bool &quot;Linksys WRT160NL board support&quot;
    select SOC_AR913X
    select ATH79_DEV_ETH
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_LEDS_GPIO
    select ATH79_DEV_M25P80
    select ATH79_DEV_USB
    select ATH79_DEV_WMAC
    select ATH79_NVRAM

config ATH79_MACH_WRT400N
    bool &quot;Linksys WRT400N board support&quot;
    select SOC_AR71XX
    select ATH79_DEV_ETH
    select ATH79_DEV_AP9X_PCI if PCI
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_LEDS_GPIO
    select ATH79_DEV_M25P80

config ATH79_MACH_RB4XX
    bool &quot;MikroTik RouterBOARD 4xx series support&quot;
    select SOC_AR71XX
    select ATH79_DEV_ETH
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_LEDS_GPIO
    select ATH79_DEV_USB

config ATH79_MACH_RB750
    bool &quot;MikroTik RouterBOARD 750 support&quot;
    select SOC_AR724X
    select ATH79_DEV_ETH
    select ATH79_DEV_AP9X_PCI if PCI
    select ATH79_DEV_USB
    select ATH79_ROUTERBOOT
    select RLE_DECOMPRESS

config ATH79_MACH_RB2011
    bool &quot;MikroTik RouterBOARD 2011 support&quot;
    select SOC_AR934x
    select ATH79_DEV_ETH
    select ATH79_DEV_NFC
    select ATH79_DEV_WMAC
    select ATH79_ROUTERBOOT

config ATH79_MACH_WNDR3700
    bool &quot;NETGEAR WNDR3700 board support&quot;
    select SOC_AR71XX
    select ATH79_DEV_AP9X_PCI if PCI
    select ATH79_DEV_ETH
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_LEDS_GPIO
    select ATH79_DEV_M25P80
    select ATH79_DEV_USB

config ATH79_MACH_WNR2000
    bool &quot;NETGEAR WNR2000 board support&quot;
    select SOC_AR913X
    select ATH79_DEV_ETH
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_LEDS_GPIO
    select ATH79_DEV_M25P80
    select ATH79_DEV_WMAC

config ATH79_MACH_OM2P
    bool &quot;OpenMesh OM2P board support&quot;
    select SOC_AR724X
    select SOC_AR933X
    select ATH79_DEV_AP9X_PCI if PCI
    select ATH79_DEV_ETH
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_LEDS_GPIO
    select ATH79_DEV_M25P80
    select ATH79_DEV_WMAC

config ATH79_MACH_MZK_W04NU
    bool &quot;Planex MZK-W04NU board support&quot;
    select SOC_AR913X
    select ATH79_DEV_ETH
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_LEDS_GPIO
    select ATH79_DEV_M25P80
    select ATH79_DEV_USB
    select ATH79_DEV_WMAC

config ATH79_MACH_MZK_W300NH
    bool &quot;Planex MZK-W300NH board support&quot;
    select SOC_AR913X
    select ATH79_DEV_ETH
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_LEDS_GPIO
    select ATH79_DEV_M25P80
    select ATH79_DEV_WMAC

config ATH79_MACH_RW2458N
    bool &quot;Redwave RW2458N board support&quot;
    select SOC_AR724X
    select ATH79_DEV_ETH
    select ATH79_DEV_AP9X_PCI if PCI
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_LEDS_GPIO
    select ATH79_DEV_M25P80
    select ATH79_DEV_USB

config ATH79_MACH_CAP4200AG
    bool &quot;Senao CAP4200AG support&quot;
    select SOC_AR934X
    select ATH79_DEV_AP9X_PCI if PCI
    select ATH79_DEV_ETH
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_LEDS_GPIO
    select ATH79_DEV_M25P80
    select ATH79_DEV_WMAC

config ATH79_MACH_EAP7660D
    bool &quot;Senao EAP7660D support&quot;
    select SOC_AR71XX
    select ATH79_DEV_ETH
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_LEDS_GPIO
    select ATH79_DEV_M25P80

config ATH79_MACH_TL_MR11U
    bool &quot;TP-LINK TL-MR11U/TL-MR3040 support&quot;
    select SOC_AR933X
    select ATH79_DEV_ETH
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_LEDS_GPIO
    select ATH79_DEV_M25P80
    select ATH79_DEV_USB
    select ATH79_DEV_WMAC

config ATH79_MACH_TL_MR3020
    bool &quot;TP-LINK TL-MR3020 support&quot;
    select SOC_AR933X
    select ATH79_DEV_ETH
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_LEDS_GPIO
    select ATH79_DEV_M25P80
    select ATH79_DEV_USB
    select ATH79_DEV_WMAC

config ATH79_MACH_TL_MR3X20
    bool &quot;TP-LINK TL-MR3220/3420 support&quot;
    select SOC_AR724X
    select ATH79_DEV_AP9X_PCI if PCI
    select ATH79_DEV_ETH
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_LEDS_GPIO
    select ATH79_DEV_M25P80
    select ATH79_DEV_USB

config ATH79_MACH_TL_WA901ND
    bool &quot;TP-LINK TL-WA901ND/TL-WA7510N support&quot;
    select SOC_AR724X
    select ATH79_DEV_AP9X_PCI if PCI
    select ATH79_DEV_ETH
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_LEDS_GPIO
    select ATH79_DEV_M25P80

config ATH79_MACH_TL_WA901ND_V2
    bool &quot;TP-LINK TL-WA901ND v2 support&quot;
    select SOC_AR913X
    select ATH79_DEV_ETH
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_LEDS_GPIO
    select ATH79_DEV_M25P80
    select ATH79_DEV_WMAC

config ATH79_MACH_TL_WDR4300
    bool &quot;TP-LINK TL-WDR3600/4300/4310 board support&quot;
    select SOC_AR934X
    select ATH79_DEV_AP9X_PCI if PCI
    select ATH79_DEV_ETH
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_LEDS_GPIO
    select ATH79_DEV_M25P80
    select ATH79_DEV_USB
    select ATH79_DEV_WMAC

config ATH79_MACH_TL_WR703N
    bool &quot;TP-LINK TL-WR703N support&quot;
    select SOC_AR933X
    select ATH79_DEV_ETH
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_LEDS_GPIO
    select ATH79_DEV_M25P80
    select ATH79_DEV_USB
    select ATH79_DEV_WMAC

config ATH79_MACH_TL_WR741ND
    bool &quot;TP-LINK TL-WR741ND support&quot;
    select SOC_AR724X
    select ATH79_DEV_AP9X_PCI if PCI
    select ATH79_DEV_ETH
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_LEDS_GPIO
    select ATH79_DEV_M25P80

config ATH79_MACH_TL_WR741ND_V4
    bool &quot;TP-LINK TL-WR741ND v4 support&quot;
    select ATH79_DEV_USB
    select SOC_AR933X
    select ATH79_DEV_ETH
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_LEDS_GPIO
    select ATH79_DEV_M25P80
    select ATH79_DEV_WMAC

config ATH79_MACH_TL_WR841N_V1
    bool &quot;TP-LINK TL-WR841N v1 support&quot;
    select SOC_AR71XX
    select ATH79_DEV_DSA
    select ATH79_DEV_ETH
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_LEDS_GPIO
    select ATH79_DEV_M25P80

config ATH79_MACH_TL_WR841N_V8
    bool &quot;TP-LINK TL-WR841N/ND v8 support&quot;
    select SOC_AR934X
    select ATH79_DEV_ETH
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_LEDS_GPIO
    select ATH79_DEV_M25P80
    select ATH79_DEV_WMAC

config ATH79_MACH_TL_WR941ND
    bool &quot;TP-LINK TL-WR941ND support&quot;
    select SOC_AR913X
    select ATH79_DEV_DSA
    select ATH79_DEV_ETH
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_LEDS_GPIO
    select ATH79_DEV_M25P80
    select ATH79_DEV_WMAC

config ATH79_MACH_TL_WR1041N_V2
    bool &quot;TP-LINK TL-WR1041N v2 support&quot;
    select SOC_AR934X
    select ATH79_DEV_AP9X_PCI if PCI
    select ATH79_DEV_ETH
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_LEDS_GPIO
    select ATH79_DEV_M25P80
    select ATH79_DEV_USB
    select ATH79_DEV_WMAC

config ATH79_MACH_TL_WR1043ND
    bool &quot;TP-LINK TL-WR1043ND support&quot;
    select SOC_AR913X
    select ATH79_DEV_ETH
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_LEDS_GPIO
    select ATH79_DEV_M25P80
    select ATH79_DEV_USB
    select ATH79_DEV_WMAC

config ATH79_MACH_TL_WR2543N
    bool &quot;TP-LINK TL-WR2543N/ND support&quot;
    select SOC_AR724X
    select ATH79_DEV_AP9X_PCI if PCI
    select ATH79_DEV_ETH
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_LEDS_GPIO
    select ATH79_DEV_M25P80
    select ATH79_DEV_USB

config ATH79_MACH_TEW_632BRP
    bool &quot;TRENDnet TEW-632BRP support&quot;
    select SOC_AR913X
    select ATH79_DEV_ETH
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_LEDS_GPIO
    select ATH79_DEV_M25P80
    select ATH79_DEV_WMAC
    select ATH79_NVRAM

config ATH79_MACH_TEW_673GRU
    bool &quot;TRENDnet TEW-673GRU support&quot;
    select SOC_AR71XX
    select ATH79_DEV_AP9X_PCI if PCI
    select ATH79_DEV_ETH
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_LEDS_GPIO
    select ATH79_DEV_M25P80
    select ATH79_DEV_USB
    select ATH79_NVRAM

config ATH79_MACH_TEW_712BR
    bool &quot;TRENDnet TEW-712BR support&quot;
    select SOC_AR933X
    select ATH79_DEV_ETH
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_LEDS_GPIO
    select ATH79_DEV_M25P80
    select ATH79_DEV_WMAC
    select ATH79_NVRAM

config ATH79_MACH_UBNT
    bool &quot;Ubiquiti AR71xx based boards support&quot;
    select SOC_AR71XX
    select ATH79_DEV_ETH
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_LEDS_GPIO
    select ATH79_DEV_M25P80
    select ATH79_DEV_USB

config ATH79_MACH_UBNT_XM
    bool &quot;Ubiquiti Networks XM (rev 1.0) board&quot;
    select SOC_AR724X
    select ATH79_DEV_AP9X_PCI if PCI
    select ATH79_DEV_ETH
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_LEDS_GPIO
    select ATH79_DEV_M25P80
    select ATH79_DEV_USB
    help
      Say &#039;Y&#039; here if you want your kernel to support the
      Ubiquiti Networks XM (rev 1.0) board.

config ATH79_MACH_ZCN_1523H
    bool &quot;Zcomax ZCN-1523H support&quot;
    select SOC_AR724X
    select ATH79_DEV_AP9X_PCI if PCI
    select ATH79_DEV_ETH
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_LEDS_GPIO
    select ATH79_DEV_M25P80

config ATH79_MACH_NBG460N
    bool &quot;Zyxel NBG460N/550N/550NH board support&quot;
    select SOC_AR913X
    select ATH79_DEV_ETH
    select ATH79_DEV_GPIO_BUTTONS
    select ATH79_DEV_LEDS_GPIO
    select ATH79_DEV_M25P80
    select ATH79_DEV_WMAC

endmenu

config SOC_AR71XX
    select USB_ARCH_HAS_EHCI
    select USB_ARCH_HAS_OHCI
    select HW_HAS_PCI
    def_bool n

config SOC_AR724X
    select USB_ARCH_HAS_EHCI
    select USB_ARCH_HAS_OHCI
    select HW_HAS_PCI
    select PCI_AR724X if PCI
    def_bool n

config SOC_AR913X
    select USB_ARCH_HAS_EHCI
    def_bool n

config SOC_AR933X
    select USB_ARCH_HAS_EHCI
    def_bool n

config SOC_AR934X
    select USB_ARCH_HAS_EHCI
    select HW_HAS_PCI
    select PCI_AR724X if PCI
    def_bool n

config SOC_QCA955X
    select USB_ARCH_HAS_EHCI
    select HW_HAS_PCI
    select PCI_AR724X if PCI
    def_bool n

config ATH79_DEV_AP9X_PCI
    select ATH79_PCI_ATH9K_FIXUP
    def_bool n

config ATH79_DEV_DSA
    def_bool n

config ATH79_DEV_ETH
    def_bool n

config ATH79_DEV_M25P80
    select ATH79_DEV_SPI
    def_bool n

config ATH79_DEV_DSA
    def_bool n

config ATH79_DEV_ETH
    def_bool n

config ATH79_DEV_GPIO_BUTTONS
    def_bool n

config ATH79_DEV_LEDS_GPIO
    def_bool n

config ATH79_DEV_NFC
    depends on (SOC_AR934X)
    def_bool n

config ATH79_DEV_SPI
    def_bool n

config ATH79_DEV_USB
    def_bool n

config ATH79_DEV_WMAC
    depends on (SOC_AR913X || SOC_AR933X || SOC_AR934X || SOC_QCA955X)
    def_bool n

config ATH79_NVRAM
    def_bool n

config ATH79_PCI_ATH9K_FIXUP
    def_bool n

config ATH79_ROUTERBOOT
    def_bool n

config PCI_AR724X
    def_bool n

endif</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p184228">
				<div class="post-metadata">
					<div class="post-num">Post #43</div>
					<div class="post-author">cindy.wijaya</div>
					<div class="post-datetime">
						25 Nov 2012, 05:22					</div>
				</div>
				<div class="post-content content">
					<p>build_dir/linux-ar71xx_generic/linux-3.3.8/arch/mips/ath79/mach-tl-wr741nd-v4.c<br/></p><div class="codebox"><pre><code>/*
 *  TP-LINK TL-WR741ND v4 board support
 *
 *  Copyright (C) 2011-2012 Gabor Juhos &lt;juhosg@openwrt.org&gt;
 *
 *  This program is free software; you can redistribute it and/or modify it
 *  under the terms of the GNU General Public License version 2 as published
 *  by the Free Software Foundation.
 */
#include &quot;dev-usb.h&quot;
#include &lt;linux/gpio.h&gt;

#include &lt;asm/mach-ath79/ath79.h&gt;
#include &lt;asm/mach-ath79/ar71xx_regs.h&gt;

#include &quot;common.h&quot;
#include &quot;dev-eth.h&quot;
#include &quot;dev-gpio-buttons.h&quot;
#include &quot;dev-leds-gpio.h&quot;
#include &quot;dev-m25p80.h&quot;
#include &quot;dev-wmac.h&quot;
#include &quot;machtypes.h&quot;

#define TL_WR741NDV4_GPIO_BTN_RESET    11
#define TL_WR741NDV4_GPIO_BTN_WPS    26

#define TL_WR741NDV4_GPIO_LED_WLAN    0
#define TL_WR741NDV4_GPIO_LED_QSS    1
#define TL_WR741NDV4_GPIO_LED_WAN    13
#define TL_WR741NDV4_GPIO_LED_LAN1    14
#define TL_WR741NDV4_GPIO_LED_LAN2    15
#define TL_WR741NDV4_GPIO_LED_LAN3    16
#define TL_WR741NDV4_GPIO_LED_LAN4    17

#define TL_WR741NDV4_GPIO_LED_SYSTEM    27

#define TL_WR741NDV4_KEYS_POLL_INTERVAL    20    /* msecs */
#define TL_WR741NDV4_KEYS_DEBOUNCE_INTERVAL (3 * TL_WR741NDV4_KEYS_POLL_INTERVAL)

static const char *tl_wr741ndv4_part_probes[] = {
    &quot;tp-link&quot;,
    NULL,
};

static struct flash_platform_data tl_wr741ndv4_flash_data = {
    .part_probes    = tl_wr741ndv4_part_probes,
};

static struct gpio_led tl_wr741ndv4_leds_gpio[] __initdata = {
    {
        .name        = &quot;tp-link:green:lan1&quot;,
        .gpio        = TL_WR741NDV4_GPIO_LED_LAN1,
        .active_low    = 0,
    }, {
        .name        = &quot;tp-link:green:lan2&quot;,
        .gpio        = TL_WR741NDV4_GPIO_LED_LAN2,
        .active_low    = 0,
    }, {
        .name        = &quot;tp-link:green:lan3&quot;,
        .gpio        = TL_WR741NDV4_GPIO_LED_LAN3,
        .active_low    = 0,
    }, {
        .name        = &quot;tp-link:green:lan4&quot;,
        .gpio        = TL_WR741NDV4_GPIO_LED_LAN4,
        .active_low    = 1,
    }, {
        .name        = &quot;tp-link:green:qss&quot;,
        .gpio        = TL_WR741NDV4_GPIO_LED_QSS,
        .active_low    = 0,
    }, {
        .name        = &quot;tp-link:green:system&quot;,
        .gpio        = TL_WR741NDV4_GPIO_LED_SYSTEM,
        .active_low    = 1,
    }, {
        .name        = &quot;tp-link:green:wan&quot;,
        .gpio        = TL_WR741NDV4_GPIO_LED_WAN,
        .active_low    = 0,
    }, {
        .name        = &quot;tp-link:green:wlan&quot;,
        .gpio        = TL_WR741NDV4_GPIO_LED_WLAN,
        .active_low    = 0,
    },
};

static struct gpio_keys_button tl_wr741ndv4_gpio_keys[] __initdata = {
    {
        .desc        = &quot;reset&quot;,
        .type        = EV_KEY,
        .code        = KEY_RESTART,
        .debounce_interval = TL_WR741NDV4_KEYS_DEBOUNCE_INTERVAL,
        .gpio        = TL_WR741NDV4_GPIO_BTN_RESET,
        .active_low    = 0,
    }, {
        .desc        = &quot;WPS&quot;,
        .type        = EV_KEY,
        .code        = KEY_WPS_BUTTON,
        .debounce_interval = TL_WR741NDV4_KEYS_DEBOUNCE_INTERVAL,
        .gpio        = TL_WR741NDV4_GPIO_BTN_WPS,
        .active_low    = 0,
    }
};

static void __init tl_wr741ndv4_setup(void)
{
    u8 *mac = (u8 *) KSEG1ADDR(0x1f01fc00);
    u8 *ee = (u8 *) KSEG1ADDR(0x1fff1000);

    ath79_setup_ar933x_phy4_switch(true, true);

    ath79_gpio_function_disable(AR933X_GPIO_FUNC_ETH_SWITCH_LED0_EN |
                    AR933X_GPIO_FUNC_ETH_SWITCH_LED1_EN |
                    AR933X_GPIO_FUNC_ETH_SWITCH_LED2_EN |
                    AR933X_GPIO_FUNC_ETH_SWITCH_LED3_EN |
                    AR933X_GPIO_FUNC_ETH_SWITCH_LED4_EN);

    ath79_register_leds_gpio(-1, ARRAY_SIZE(tl_wr741ndv4_leds_gpio),
                 tl_wr741ndv4_leds_gpio);

    ath79_register_gpio_keys_polled(1, TL_WR741NDV4_KEYS_POLL_INTERVAL,
                    ARRAY_SIZE(tl_wr741ndv4_gpio_keys),
                    tl_wr741ndv4_gpio_keys);

    ath79_register_usb();
    ath79_register_m25p80(&amp;tl_wr741ndv4_flash_data);
    ath79_init_mac(ath79_eth0_data.mac_addr, mac, 1);
    ath79_init_mac(ath79_eth1_data.mac_addr, mac, -1);

    ath79_register_mdio(0, 0x0);
    ath79_register_eth(1);
    ath79_register_eth(0);

    ath79_register_wmac(ee, mac);
}

MIPS_MACHINE(ATH79_MACH_TL_WR741ND_V4, &quot;TL-WR741ND-v4&quot;,
         &quot;TP-LINK TL-WR741ND v4&quot;, tl_wr741ndv4_setup);</code></pre></div><p>/trunk/tools/firmware-utils/src/mktplink.c<br/></p><div class="codebox"><pre><code>/*
 * Copyright (C) 2009 Gabor Juhos &lt;juhosg@openwrt.org&gt;
 *
 * This tool was based on:
 *   TP-Link WR941 V2 firmware checksum fixing tool.
 *   Copyright (C) 2008,2009 Wang Jian &lt;lark@linux.net.cn&gt;
 *
 * This program is free software; you can redistribute it and/or modify it
 * under the terms of the GNU General Public License version 2 as published
 * by the Free Software Foundation.
 *
 */

#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;stdint.h&gt;
#include &lt;string.h&gt;
#include &lt;unistd.h&gt;     /* for unlink() */
#include &lt;libgen.h&gt;
#include &lt;getopt.h&gt;     /* for getopt() */
#include &lt;stdarg.h&gt;
#include &lt;errno.h&gt;
#include &lt;sys/stat.h&gt;

#include &lt;arpa/inet.h&gt;
#include &lt;netinet/in.h&gt;

#include &quot;md5.h&quot;

#define ALIGN(x,a) ({ typeof(a) __a = (a); (((x) + __a - 1) &amp; ~(__a - 1)); })

#define HEADER_VERSION_V1    0x01000000
#define HWID_TL_MR3020_V1    0x30200001
#define HWID_TL_MR3020_V2    0x30200002
#define HWID_TL_MR3220_V1    0x32200001
#define HWID_TL_MR3420_V1    0x34200001
#define HWID_TL_MR3220_V2    0x32200002
#define HWID_TL_WA701N_V1    0x07010001
#define HWID_TL_WA7510N_V1    0x75100001
#define HWID_TL_WA901ND_V1    0x09010001
#define HWID_TL_WA901ND_V2    0x09010002
#define HWID_TL_WR703N_V1    0x07030101
#define HWID_TL_WR741ND_V1    0x07410001
#define HWID_TL_WR741ND_V4    0x07410004
#define HWID_TL_WR740N_V1    0x07400001
#define HWID_TL_WR740N_V3    0x07400003
#define HWID_TL_WR743ND_V1    0x07430001
#define HWID_TL_WR841N_V1_5    0x08410002
#define HWID_TL_WR841ND_V3    0x08410003
#define HWID_TL_WR841ND_V5    0x08410005
#define HWID_TL_WR841ND_V7    0x08410007
#define HWID_TL_WR941ND_V2    0x09410002
#define HWID_TL_WR941ND_V4    0x09410004
#define HWID_TL_WR1043ND_V1    0x10430001
#define HWID_TL_WR1041N_V2    0x10410002
#define HWID_TL_WR2543N_V1    0x25430001

#define MD5SUM_LEN    16

struct file_info {
    char        *file_name;    /* name of the file */
    uint32_t    file_size;    /* length of the file */
};

struct fw_header {
    uint32_t    version;    /* header version */
    char        vendor_name[24];
    char        fw_version[36];
    uint32_t    hw_id;        /* hardware id */
    uint32_t    hw_rev;        /* hardware revision */
    uint32_t    unk1;
    uint8_t        md5sum1[MD5SUM_LEN];
    uint32_t    unk2;
    uint8_t        md5sum2[MD5SUM_LEN];
    uint32_t    unk3;
    uint32_t    kernel_la;    /* kernel load address */
    uint32_t    kernel_ep;    /* kernel entry point */
    uint32_t    fw_length;    /* total length of the firmware */
    uint32_t    kernel_ofs;    /* kernel data offset */
    uint32_t    kernel_len;    /* kernel data length */
    uint32_t    rootfs_ofs;    /* rootfs data offset */
    uint32_t    rootfs_len;    /* rootfs data length */
    uint32_t    boot_ofs;    /* bootloader data offset */
    uint32_t    boot_len;    /* bootloader data length */
    uint16_t    ver_hi;
    uint16_t    ver_mid;
    uint16_t    ver_lo;
    uint8_t        pad[354];
} __attribute__ ((packed));

struct flash_layout {
    char        *id;
    uint32_t    fw_max_len;
    uint32_t    kernel_la;
    uint32_t    kernel_ep;
    uint32_t    rootfs_ofs;
};

struct board_info {
    char        *id;
    uint32_t    hw_id;
    uint32_t    hw_rev;
    char        *layout_id;
};

/*
 * Globals
 */
static char *ofname;
static char *progname;
static char *vendor = &quot;TP-LINK Technologies&quot;;
static char *version = &quot;ver. 1.0&quot;;
static char *fw_ver = &quot;0.0.0&quot;;

static char *board_id;
static struct board_info *board;
static char *layout_id;
static struct flash_layout *layout;
static char *opt_hw_id;
static uint32_t hw_id;
static char *opt_hw_rev;
static uint32_t hw_rev;
static int fw_ver_lo;
static int fw_ver_mid;
static int fw_ver_hi;
static struct file_info kernel_info;
static uint32_t kernel_la = 0;
static uint32_t kernel_ep = 0;
static uint32_t kernel_len = 0;
static struct file_info rootfs_info;
static uint32_t rootfs_ofs = 0;
static uint32_t rootfs_align;
static struct file_info boot_info;
static int combined;
static int strip_padding;
static int add_jffs2_eof;
static unsigned char jffs2_eof_mark[4] = {0xde, 0xad, 0xc0, 0xde};

static struct file_info inspect_info;
static int extract = 0;

char md5salt_normal[MD5SUM_LEN] = {
    0xdc, 0xd7, 0x3a, 0xa5, 0xc3, 0x95, 0x98, 0xfb,
    0xdd, 0xf9, 0xe7, 0xf4, 0x0e, 0xae, 0x47, 0x38,
};

char md5salt_boot[MD5SUM_LEN] = {
    0x8c, 0xef, 0x33, 0x5b, 0xd5, 0xc5, 0xce, 0xfa,
    0xa7, 0x9c, 0x28, 0xda, 0xb2, 0xe9, 0x0f, 0x42,
};

static struct flash_layout layouts[] = {
    {
        .id        = &quot;4M&quot;,
        .fw_max_len    = 0x3c0000,
        .kernel_la    = 0x80060000,
        .kernel_ep    = 0x80060000,
        .rootfs_ofs    = 0x140000,
    }, {
        .id        = &quot;4Mlzma&quot;,
        .fw_max_len    = 0x3c0000,
        .kernel_la    = 0x80060000,
        .kernel_ep    = 0x80060000,
        .rootfs_ofs    = 0x100000,
    }, {
        .id        = &quot;8M&quot;,
        .fw_max_len    = 0x7c0000,
        .kernel_la    = 0x80060000,
        .kernel_ep    = 0x80060000,
        .rootfs_ofs    = 0x140000,
    }, {
        .id        = &quot;8Mlzma&quot;,
        .fw_max_len    = 0x7c0000,
        .kernel_la    = 0x80060000,
        .kernel_ep    = 0x80060000,
        .rootfs_ofs    = 0x100000,
    }, {
        /* terminating entry */
    }
};

static struct board_info boards[] = {
    {
        .id        = &quot;TL-MR3020v1&quot;,
        .hw_id        = HWID_TL_MR3020_V1,
        .hw_rev        = 1,
        .layout_id    = &quot;4Mlzma&quot;,
    }, {
        .id        = &quot;TL-MR3020v2&quot;,
        .hw_id        = HWID_TL_MR3020_V2,
        .hw_rev        = 1,
        .layout_id    = &quot;4Mlzma&quot;,
    }, {
        .id        = &quot;TL-MR3220v1&quot;,
        .hw_id        = HWID_TL_MR3220_V1,
        .hw_rev        = 1,
        .layout_id    = &quot;4M&quot;,
    }, {
        .id             = &quot;TL-MR3220v2&quot;,
        .hw_id          = HWID_TL_MR3220_V2,
        .hw_rev         = 1,
        .layout_id      = &quot;4Mlzma&quot;,
    }, {
        .id        = &quot;TL-MR3420v1&quot;,
        .hw_id        = HWID_TL_MR3420_V1,
        .hw_rev        = 1,
        .layout_id    = &quot;4M&quot;,
    }, {
        .id        = &quot;TL-WA701Nv1&quot;,
        .hw_id        = HWID_TL_WA701N_V1,
        .hw_rev        = 1,
        .layout_id    = &quot;4M&quot;,
    }, {
        .id        = &quot;TL-WA7510N&quot;,
        .hw_id        = HWID_TL_WA7510N_V1,
        .hw_rev        = 1,
        .layout_id    = &quot;4M&quot;,
    }, {
        .id        = &quot;TL-WA901NDv1&quot;,
        .hw_id        = HWID_TL_WA901ND_V1,
        .hw_rev        = 1,
        .layout_id    = &quot;4M&quot;,
    }, {
        .id             = &quot;TL-WA901NDv2&quot;,
        .hw_id          = HWID_TL_WA901ND_V2,
        .hw_rev         = 1,
        .layout_id    = &quot;4M&quot;,
    }, {
        .id        = &quot;TL-WR741NDv1&quot;,
        .hw_id        = HWID_TL_WR741ND_V1,
        .hw_rev        = 1,
        .layout_id    = &quot;4M&quot;,
    }, {
        .id        = &quot;TL-WR741NDv4&quot;,
        .hw_id        = HWID_TL_WR741ND_V4,
        .hw_rev        = 1,
        .layout_id    = &quot;4Mlzma&quot;,
    }, {
        .id        = &quot;TL-WR740Nv1&quot;,
        .hw_id        = HWID_TL_WR740N_V1,
        .hw_rev        = 1,
        .layout_id    = &quot;4M&quot;,
    }, {
        .id        = &quot;TL-WR740Nv3&quot;,
        .hw_id        = HWID_TL_WR740N_V3,
        .hw_rev        = 1,
        .layout_id    = &quot;4M&quot;,
    }, {
        .id        = &quot;TL-WR743NDv1&quot;,
        .hw_id        = HWID_TL_WR743ND_V1,
        .hw_rev        = 1,
        .layout_id    = &quot;4M&quot;,
    }, {
        .id        = &quot;TL-WR841Nv1.5&quot;,
        .hw_id        = HWID_TL_WR841N_V1_5,
        .hw_rev        = 2,
        .layout_id    = &quot;4M&quot;,
    }, {
        .id        = &quot;TL-WR841NDv3&quot;,
        .hw_id        = HWID_TL_WR841ND_V3,
        .hw_rev        = 3,
        .layout_id    = &quot;4M&quot;,
    }, {
        .id        = &quot;TL-WR841NDv5&quot;,
        .hw_id        = HWID_TL_WR841ND_V5,
        .hw_rev        = 1,
        .layout_id    = &quot;4M&quot;,
    }, {
        .id        = &quot;TL-WR841NDv7&quot;,
        .hw_id        = HWID_TL_WR841ND_V7,
        .hw_rev        = 1,
        .layout_id    = &quot;4M&quot;,
    }, {
        .id        = &quot;TL-WR941NDv2&quot;,
        .hw_id        = HWID_TL_WR941ND_V2,
        .hw_rev        = 2,
        .layout_id    = &quot;4M&quot;,
    }, {
        .id        = &quot;TL-WR941NDv4&quot;,
        .hw_id        = HWID_TL_WR941ND_V4,
        .hw_rev        = 1,
        .layout_id    = &quot;4M&quot;,
    }, {
        .id        = &quot;TL-WR1041Nv2&quot;,
        .hw_id        = HWID_TL_WR1041N_V2,
        .hw_rev        = 1,
        .layout_id    = &quot;4Mlzma&quot;,
    }, {
        .id        = &quot;TL-WR1043NDv1&quot;,
        .hw_id        = HWID_TL_WR1043ND_V1,
        .hw_rev        = 1,
        .layout_id    = &quot;8M&quot;,
    }, {
        .id        = &quot;TL-WR2543Nv1&quot;,
        .hw_id        = HWID_TL_WR2543N_V1,
        .hw_rev        = 1,
        .layout_id    = &quot;8Mlzma&quot;,
    }, {
        .id        = &quot;TL-WR703Nv1&quot;,
        .hw_id        = HWID_TL_WR703N_V1,
        .hw_rev        = 1,
        .layout_id    = &quot;4Mlzma&quot;,
    }, {
        /* terminating entry */
    }
};

/*
 * Message macros
 */
#define ERR(fmt, ...) do { \
    fflush(0); \
    fprintf(stderr, &quot;[%s] *** error: &quot; fmt &quot;\n&quot;, \
            progname, ## __VA_ARGS__ ); \
} while (0)

#define ERRS(fmt, ...) do { \
    int save = errno; \
    fflush(0); \
    fprintf(stderr, &quot;[%s] *** error: &quot; fmt &quot;\n&quot;, \
            progname, ## __VA_ARGS__, strerror(save)); \
} while (0)

#define DBG(fmt, ...) do { \
    fprintf(stderr, &quot;[%s] &quot; fmt &quot;\n&quot;, progname, ## __VA_ARGS__ ); \
} while (0)

static struct board_info *find_board(char *id)
{
    struct board_info *ret;
    struct board_info *board;

    ret = NULL;
    for (board = boards; board-&gt;id != NULL; board++){
        if (strcasecmp(id, board-&gt;id) == 0) {
            ret = board;
            break;
        }
    };

    return ret;
}

static struct board_info *find_board_by_hwid(uint32_t hw_id)
{
    struct board_info *board;

    for (board = boards; board-&gt;id != NULL; board++) {
        if (hw_id == board-&gt;hw_id)
            return board;
    };

    return NULL;
}

static struct flash_layout *find_layout(char *id)
{
    struct flash_layout *ret;
    struct flash_layout *l;

    ret = NULL;
    for (l = layouts; l-&gt;id != NULL; l++){
        if (strcasecmp(id, l-&gt;id) == 0) {
            ret = l;
            break;
        }
    };

    return ret;
}

static void usage(int status)
{
    FILE *stream = (status != EXIT_SUCCESS) ? stderr : stdout;
    struct board_info *board;

    fprintf(stream, &quot;Usage: %s [OPTIONS...]\n&quot;, progname);
    fprintf(stream,
&quot;\n&quot;
&quot;Options:\n&quot;
&quot;  -B &lt;board&gt;      create image for the board specified with &lt;board&gt;\n&quot;
&quot;  -c              use combined kernel image\n&quot;
&quot;  -E &lt;ep&gt;         overwrite kernel entry point with &lt;ep&gt; (hexval prefixed with 0x)\n&quot;
&quot;  -L &lt;la&gt;         overwrite kernel load address with &lt;la&gt; (hexval prefixed with 0x)\n&quot;
&quot;  -H &lt;hwid&gt;       use hardware id specified with &lt;hwid&gt;\n&quot;
&quot;  -F &lt;id&gt;         use flash layout specified with &lt;id&gt;\n&quot;
&quot;  -k &lt;file&gt;       read kernel image from the file &lt;file&gt;\n&quot;
&quot;  -r &lt;file&gt;       read rootfs image from the file &lt;file&gt;\n&quot;
&quot;  -a &lt;align&gt;      align the rootfs start on an &lt;align&gt; bytes boundary\n&quot;
&quot;  -R &lt;offset&gt;     overwrite rootfs offset with &lt;offset&gt; (hexval prefixed with 0x)\n&quot;
&quot;  -o &lt;file&gt;       write output to the file &lt;file&gt;\n&quot;
&quot;  -s              strip padding from the end of the image\n&quot;
&quot;  -j              add jffs2 end-of-filesystem markers\n&quot;
&quot;  -N &lt;vendor&gt;     set image vendor to &lt;vendor&gt;\n&quot;
&quot;  -V &lt;version&gt;    set image version to &lt;version&gt;\n&quot;
&quot;  -v &lt;version&gt;    set firmware version to &lt;version&gt;\n&quot;
&quot;  -i &lt;file&gt;       inspect given firmware file &lt;file&gt;\n&quot;
&quot;  -x              extract kernel and rootfs while inspecting (requires -i)\n&quot;
&quot;  -h              show this screen\n&quot;
    );

    exit(status);
}

static int get_md5(char *data, int size, char *md5)
{
    MD5_CTX ctx;

    MD5_Init(&amp;ctx);
    MD5_Update(&amp;ctx, data, size);
    MD5_Final(md5, &amp;ctx);
}

static int get_file_stat(struct file_info *fdata)
{
    struct stat st;
    int res;

    if (fdata-&gt;file_name == NULL)
        return 0;

    res = stat(fdata-&gt;file_name, &amp;st);
    if (res){
        ERRS(&quot;stat failed on %s&quot;, fdata-&gt;file_name);
        return res;
    }

    fdata-&gt;file_size = st.st_size;
    return 0;
}

static int read_to_buf(struct file_info *fdata, char *buf)
{
    FILE *f;
    int ret = EXIT_FAILURE;

    f = fopen(fdata-&gt;file_name, &quot;r&quot;);
    if (f == NULL) {
        ERRS(&quot;could not open \&quot;%s\&quot; for reading&quot;, fdata-&gt;file_name);
        goto out;
    }

    errno = 0;
    fread(buf, fdata-&gt;file_size, 1, f);
    if (errno != 0) {
        ERRS(&quot;unable to read from file \&quot;%s\&quot;&quot;, fdata-&gt;file_name);
        goto out_close;
    }

    ret = EXIT_SUCCESS;

 out_close:
    fclose(f);
 out:
    return ret;
}

static int check_options(void)
{
    int ret;

    if (inspect_info.file_name) {
        ret = get_file_stat(&amp;inspect_info);
        if (ret)
            return ret;

        return 0;
    } else if (extract) {
        ERR(&quot;no firmware for inspection specified&quot;);
        return -1;
    }

    if (board_id == NULL &amp;&amp; opt_hw_id == NULL) {
        ERR(&quot;either board or hardware id must be specified&quot;);
        return -1;
    }

    if (board_id) {
        board = find_board(board_id);
        if (board == NULL) {
            ERR(&quot;unknown/unsupported board id \&quot;%s\&quot;&quot;, board_id);
            return -1;
        }
        if (layout_id == NULL)
            layout_id = board-&gt;layout_id;

        hw_id = board-&gt;hw_id;
        hw_rev = board-&gt;hw_rev;
    } else {
        if (layout_id == NULL) {
            ERR(&quot;flash layout is not specified&quot;);
            return -1;
        }
        hw_id = strtoul(opt_hw_id, NULL, 0);

        if (opt_hw_rev)
            hw_rev = strtoul(opt_hw_rev, NULL, 0);
        else
            hw_rev = 1;
    }

    layout = find_layout(layout_id);
    if (layout == NULL) {
        ERR(&quot;unknown flash layout \&quot;%s\&quot;&quot;, layout_id);
        return -1;
    }

    if (!kernel_la)
        kernel_la = layout-&gt;kernel_la;
    if (!kernel_ep)
        kernel_ep = layout-&gt;kernel_ep;
    if (!rootfs_ofs)
        rootfs_ofs = layout-&gt;rootfs_ofs;

    if (kernel_info.file_name == NULL) {
        ERR(&quot;no kernel image specified&quot;);
        return -1;
    }

    ret = get_file_stat(&amp;kernel_info);
    if (ret)
        return ret;

    kernel_len = kernel_info.file_size;

    if (combined) {
        if (kernel_info.file_size &gt;
            layout-&gt;fw_max_len - sizeof(struct fw_header)) {
            ERR(&quot;kernel image is too big&quot;);
            return -1;
        }
    } else {
        if (rootfs_info.file_name == NULL) {
            ERR(&quot;no rootfs image specified&quot;);
            return -1;
        }

        ret = get_file_stat(&amp;rootfs_info);
        if (ret)
            return ret;

        if (rootfs_align) {
            kernel_len += sizeof(struct fw_header);
            kernel_len = ALIGN(kernel_len, rootfs_align);
            kernel_len -= sizeof(struct fw_header);

            DBG(&quot;kernel length aligned to %u&quot;, kernel_len);

            if (kernel_len + rootfs_info.file_size &gt;
                layout-&gt;fw_max_len - sizeof(struct fw_header)) {
                ERR(&quot;images are too big&quot;);
                return -1;
            }
        } else {
            if (kernel_info.file_size &gt;
                rootfs_ofs - sizeof(struct fw_header)) {
                ERR(&quot;kernel image is too big&quot;);
                return -1;
            }

            if (rootfs_info.file_size &gt;
                (layout-&gt;fw_max_len - rootfs_ofs)) {
                ERR(&quot;rootfs image is too big&quot;);
                return -1;
            }
        }
    }

    if (ofname == NULL) {
        ERR(&quot;no output file specified&quot;);
        return -1;
    }

    ret = sscanf(fw_ver, &quot;%d.%d.%d&quot;, &amp;fw_ver_hi, &amp;fw_ver_mid, &amp;fw_ver_lo);
    if (ret != 3) {
        ERR(&quot;invalid firmware version &#039;%s&#039;&quot;, fw_ver);
        return -1;
    }

    return 0;
}

static void fill_header(char *buf, int len)
{
    struct fw_header *hdr = (struct fw_header *)buf;

    memset(hdr, 0, sizeof(struct fw_header));

    hdr-&gt;version = htonl(HEADER_VERSION_V1);
    strncpy(hdr-&gt;vendor_name, vendor, sizeof(hdr-&gt;vendor_name));
    strncpy(hdr-&gt;fw_version, version, sizeof(hdr-&gt;fw_version));
    hdr-&gt;hw_id = htonl(hw_id);
    hdr-&gt;hw_rev = htonl(hw_rev);

    if (boot_info.file_size == 0)
        memcpy(hdr-&gt;md5sum1, md5salt_normal, sizeof(hdr-&gt;md5sum1));
    else
        memcpy(hdr-&gt;md5sum1, md5salt_boot, sizeof(hdr-&gt;md5sum1));

    hdr-&gt;kernel_la = htonl(kernel_la);
    hdr-&gt;kernel_ep = htonl(kernel_ep);
    hdr-&gt;fw_length = htonl(layout-&gt;fw_max_len);
    hdr-&gt;kernel_ofs = htonl(sizeof(struct fw_header));
    hdr-&gt;kernel_len = htonl(kernel_len);
    if (!combined) {
        hdr-&gt;rootfs_ofs = htonl(rootfs_ofs);
        hdr-&gt;rootfs_len = htonl(rootfs_info.file_size);
    }

    hdr-&gt;ver_hi = htons(fw_ver_hi);
    hdr-&gt;ver_mid = htons(fw_ver_mid);
    hdr-&gt;ver_lo = htons(fw_ver_lo);

    get_md5(buf, len, hdr-&gt;md5sum1);
}

static int pad_jffs2(char *buf, int currlen)
{
    int len;
    uint32_t pad_mask;

    len = currlen;
    pad_mask = (64 * 1024);
    while ((len &lt; layout-&gt;fw_max_len) &amp;&amp; (pad_mask != 0)) {
        uint32_t mask;
        int i;

        for (i = 10; i &lt; 32; i++) {
            mask = 1 &lt;&lt; i;
            if (pad_mask &amp; mask)
                break;
        }

        len = ALIGN(len, mask);

        for (i = 10; i &lt; 32; i++) {
            mask = 1 &lt;&lt; i;
            if ((len &amp; (mask - 1)) == 0)
                pad_mask &amp;= ~mask;
        }

        for (i = 0; i &lt; sizeof(jffs2_eof_mark); i++)
            buf[len + i] = jffs2_eof_mark[i];

        len += sizeof(jffs2_eof_mark);
    }

    return len;
}

static int write_fw(char *data, int len)
{
    FILE *f;
    int ret = EXIT_FAILURE;

    f = fopen(ofname, &quot;w&quot;);
    if (f == NULL) {
        ERRS(&quot;could not open \&quot;%s\&quot; for writing&quot;, ofname);
        goto out;
    }

    errno = 0;
    fwrite(data, len, 1, f);
    if (errno) {
        ERRS(&quot;unable to write output file&quot;);
        goto out_flush;
    }

    DBG(&quot;firmware file \&quot;%s\&quot; completed&quot;, ofname);

    ret = EXIT_SUCCESS;

 out_flush:
    fflush(f);
    fclose(f);
    if (ret != EXIT_SUCCESS) {
        unlink(ofname);
    }
 out:
    return ret;
}

static int build_fw(void)
{
    int buflen;
    char *buf;
    char *p;
    int ret = EXIT_FAILURE;
    int writelen = 0;

    buflen = layout-&gt;fw_max_len;

    buf = malloc(buflen);
    if (!buf) {
        ERR(&quot;no memory for buffer\n&quot;);
        goto out;
    }

    memset(buf, 0xff, buflen);
    p = buf + sizeof(struct fw_header);
    ret = read_to_buf(&amp;kernel_info, p);
    if (ret)
        goto out_free_buf;

    writelen = sizeof(struct fw_header) + kernel_len;

    if (!combined) {
        if (rootfs_align)
            p = buf + writelen;
        else
            p = buf + rootfs_ofs;

        ret = read_to_buf(&amp;rootfs_info, p);
        if (ret)
            goto out_free_buf;

        if (rootfs_align)
            writelen += rootfs_info.file_size;
        else
            writelen = rootfs_ofs + rootfs_info.file_size;

        if (add_jffs2_eof)
            writelen = pad_jffs2(buf, writelen);
    }

    if (!strip_padding)
        writelen = buflen;

    fill_header(buf, writelen);
    ret = write_fw(buf, writelen);
    if (ret)
        goto out_free_buf;

    ret = EXIT_SUCCESS;

 out_free_buf:
    free(buf);
 out:
    return ret;
}

/* Helper functions to inspect_fw() representing different output formats */
static inline void inspect_fw_pstr(char *label, char *str)
{
    printf(&quot;%-23s: %s\n&quot;, label, str);
}

static inline void inspect_fw_phex(char *label, uint32_t val)
{
    printf(&quot;%-23s: 0x%08x\n&quot;, label, val);
}

static inline void inspect_fw_phexpost(char *label,
                                       uint32_t val, char *post)
{
    printf(&quot;%-23s: 0x%08x (%s)\n&quot;, label, val, post);
}

static inline void inspect_fw_phexdef(char *label,
                                      uint32_t val, uint32_t defval)
{
    printf(&quot;%-23s: 0x%08x                  &quot;, label, val);

    if (val == defval)
        printf(&quot;(== OpenWrt default)\n&quot;);
    else
        printf(&quot;(OpenWrt default: 0x%08x)\n&quot;, defval);
}

static inline void inspect_fw_phexexp(char *label,
                                      uint32_t val, uint32_t expval)
{
    printf(&quot;%-23s: 0x%08x &quot;, label, val);

    if (val == expval)
        printf(&quot;(ok)\n&quot;);
    else
        printf(&quot;(expected: 0x%08x)\n&quot;, expval);
}

static inline void inspect_fw_phexdec(char *label, uint32_t val)
{
    printf(&quot;%-23s: 0x%08x / %8u bytes\n&quot;, label, val, val);
}

static inline void inspect_fw_phexdecdef(char *label,
                                         uint32_t val, uint32_t defval)
{
    printf(&quot;%-23s: 0x%08x / %8u bytes &quot;, label, val, val);

    if (val == defval)
        printf(&quot;(== OpenWrt default)\n&quot;);
    else
        printf(&quot;(OpenWrt default: 0x%08x)\n&quot;, defval);
}

static inline void inspect_fw_pmd5sum(char *label, uint8_t *val, char *text)
{
    int i;

    printf(&quot;%-23s:&quot;, label);
    for (i=0; i&lt;MD5SUM_LEN; i++)
        printf(&quot; %02x&quot;, val[i]);
    printf(&quot; %s\n&quot;, text);
}

static int inspect_fw(void)
{
    char *buf;
    struct fw_header *hdr;
    uint8_t md5sum[MD5SUM_LEN];
    struct board_info *board;
    int ret = EXIT_FAILURE;

    buf = malloc(inspect_info.file_size);
    if (!buf) {
        ERR(&quot;no memory for buffer!\n&quot;);
        goto out;
    }

    ret = read_to_buf(&amp;inspect_info, buf);
    if (ret)
        goto out_free_buf;
    hdr = (struct fw_header *)buf;

    inspect_fw_pstr(&quot;File name&quot;, inspect_info.file_name);
    inspect_fw_phexdec(&quot;File size&quot;, inspect_info.file_size);

    if (ntohl(hdr-&gt;version) != HEADER_VERSION_V1) {
        ERR(&quot;file does not seem to have V1 header!\n&quot;);
        goto out_free_buf;
    }

    inspect_fw_phexdec(&quot;Version 1 Header size&quot;, sizeof(struct fw_header));

    if (ntohl(hdr-&gt;unk1) != 0)
        inspect_fw_phexdec(&quot;Unknown value 1&quot;, hdr-&gt;unk1);

    memcpy(md5sum, hdr-&gt;md5sum1, sizeof(md5sum));
    if (ntohl(hdr-&gt;boot_len) == 0)
        memcpy(hdr-&gt;md5sum1, md5salt_normal, sizeof(md5sum));
    else
        memcpy(hdr-&gt;md5sum1, md5salt_boot, sizeof(md5sum));
    get_md5(buf, inspect_info.file_size, hdr-&gt;md5sum1);

    if (memcmp(md5sum, hdr-&gt;md5sum1, sizeof(md5sum))) {
        inspect_fw_pmd5sum(&quot;Header MD5Sum1&quot;, md5sum, &quot;(*ERROR*)&quot;);
        inspect_fw_pmd5sum(&quot;          --&gt; expected&quot;, hdr-&gt;md5sum1, &quot;&quot;);
    } else {
        inspect_fw_pmd5sum(&quot;Header MD5Sum1&quot;, md5sum, &quot;(ok)&quot;);
    }
    if (ntohl(hdr-&gt;unk2) != 0)
        inspect_fw_phexdec(&quot;Unknown value 2&quot;, hdr-&gt;unk2);
    inspect_fw_pmd5sum(&quot;Header MD5Sum2&quot;, hdr-&gt;md5sum2,
                       &quot;(purpose yet unknown, unchecked here)&quot;);
    if (ntohl(hdr-&gt;unk3) != 0)
        inspect_fw_phexdec(&quot;Unknown value 3&quot;, hdr-&gt;unk3);

    printf(&quot;\n&quot;);

    inspect_fw_pstr(&quot;Vendor name&quot;, hdr-&gt;vendor_name);
    inspect_fw_pstr(&quot;Firmware version&quot;, hdr-&gt;fw_version);
    board = find_board_by_hwid(ntohl(hdr-&gt;hw_id));
    if (board) {
        layout = find_layout(board-&gt;layout_id);
        inspect_fw_phexpost(&quot;Hardware ID&quot;,
                            ntohl(hdr-&gt;hw_id), board-&gt;id);
        inspect_fw_phexexp(&quot;Hardware Revision&quot;,
                           ntohl(hdr-&gt;hw_rev), board-&gt;hw_rev);
    } else {
        inspect_fw_phexpost(&quot;Hardware ID&quot;,
                            ntohl(hdr-&gt;hw_id), &quot;unknown&quot;);
        inspect_fw_phex(&quot;Hardware Revision&quot;,
                        ntohl(hdr-&gt;hw_rev));
    }

    printf(&quot;\n&quot;);

    inspect_fw_phexdec(&quot;Kernel data offset&quot;,
                       ntohl(hdr-&gt;kernel_ofs));
    inspect_fw_phexdec(&quot;Kernel data length&quot;,
                       ntohl(hdr-&gt;kernel_len));
    if (board) {
        inspect_fw_phexdef(&quot;Kernel load address&quot;,
                           ntohl(hdr-&gt;kernel_la),
                           layout ? layout-&gt;kernel_la : 0xffffffff);
        inspect_fw_phexdef(&quot;Kernel entry point&quot;,
                           ntohl(hdr-&gt;kernel_ep),
                           layout ? layout-&gt;kernel_ep : 0xffffffff);
        inspect_fw_phexdecdef(&quot;Rootfs data offset&quot;,
                              ntohl(hdr-&gt;rootfs_ofs),
                              layout ? layout-&gt;rootfs_ofs : 0xffffffff);
    } else {
        inspect_fw_phex(&quot;Kernel load address&quot;,
                        ntohl(hdr-&gt;kernel_la));
        inspect_fw_phex(&quot;Kernel entry point&quot;,
                        ntohl(hdr-&gt;kernel_ep));
        inspect_fw_phexdec(&quot;Rootfs data offset&quot;,
                           ntohl(hdr-&gt;rootfs_ofs));
    }
    inspect_fw_phexdec(&quot;Rootfs data length&quot;,
                       ntohl(hdr-&gt;rootfs_len));
    inspect_fw_phexdec(&quot;Boot loader data offset&quot;,
                       ntohl(hdr-&gt;boot_ofs));
    inspect_fw_phexdec(&quot;Boot loader data length&quot;,
                       ntohl(hdr-&gt;boot_len));
    inspect_fw_phexdec(&quot;Total firmware length&quot;,
                       ntohl(hdr-&gt;fw_length));

    if (extract) {
        FILE *fp;
        char *filename;

        printf(&quot;\n&quot;);

        filename = malloc(strlen(inspect_info.file_name) + 8);
        sprintf(filename, &quot;%s-kernel&quot;, inspect_info.file_name);
        printf(&quot;Extracting kernel to \&quot;%s\&quot;...\n&quot;, filename);
        fp = fopen(filename, &quot;w&quot;);
        if (fp)    {
            if (!fwrite(buf + ntohl(hdr-&gt;kernel_ofs),
                        ntohl(hdr-&gt;kernel_len), 1, fp)) {
                ERR(&quot;error in fwrite(): %s&quot;, strerror(errno));
            }
            fclose(fp);
        } else {
            ERR(&quot;error in fopen(): %s&quot;, strerror(errno));
        }
        free(filename);

        filename = malloc(strlen(inspect_info.file_name) + 8);
        sprintf(filename, &quot;%s-rootfs&quot;, inspect_info.file_name);
        printf(&quot;Extracting rootfs to \&quot;%s\&quot;...\n&quot;, filename);
        fp = fopen(filename, &quot;w&quot;);
        if (fp)    {
            if (!fwrite(buf + ntohl(hdr-&gt;rootfs_ofs),
                        ntohl(hdr-&gt;rootfs_len), 1, fp)) {
                ERR(&quot;error in fwrite(): %s&quot;, strerror(errno));
            }
            fclose(fp);
        } else {
            ERR(&quot;error in fopen(): %s&quot;, strerror(errno));
        }
        free(filename);
    }

 out_free_buf:
    free(buf);
 out:
    return ret;
}

int main(int argc, char *argv[])
{
    int ret = EXIT_FAILURE;
    int err;

    FILE *outfile;

    progname = basename(argv[0]);

    while ( 1 ) {
        int c;

        c = getopt(argc, argv, &quot;a:B:H:E:F:L:V:N:W:ci:k:r:R:o:xhsjv:&quot;);
        if (c == -1)
            break;

        switch (c) {
        case &#039;a&#039;:
            sscanf(optarg, &quot;0x%x&quot;, &amp;rootfs_align);
            break;
        case &#039;B&#039;:
            board_id = optarg;
            break;
        case &#039;H&#039;:
            opt_hw_id = optarg;
            break;
        case &#039;E&#039;:
            sscanf(optarg, &quot;0x%x&quot;, &amp;kernel_ep);
            break;
        case &#039;F&#039;:
            layout_id = optarg;
            break;
        case &#039;W&#039;:
            opt_hw_rev = optarg;
            break;
        case &#039;L&#039;:
            sscanf(optarg, &quot;0x%x&quot;, &amp;kernel_la);
            break;
        case &#039;V&#039;:
            version = optarg;
            break;
        case &#039;v&#039;:
            fw_ver = optarg;
            break;
        case &#039;N&#039;:
            vendor = optarg;
            break;
        case &#039;c&#039;:
            combined++;
            break;
        case &#039;k&#039;:
            kernel_info.file_name = optarg;
            break;
        case &#039;r&#039;:
            rootfs_info.file_name = optarg;
            break;
        case &#039;R&#039;:
            sscanf(optarg, &quot;0x%x&quot;, &amp;rootfs_ofs);
            break;
        case &#039;o&#039;:
            ofname = optarg;
            break;
        case &#039;s&#039;:
            strip_padding = 1;
            break;
        case &#039;i&#039;:
            inspect_info.file_name = optarg;
            break;
        case &#039;j&#039;:
            add_jffs2_eof = 1;
            break;
        case &#039;x&#039;:
            extract = 1;
            break;
        case &#039;h&#039;:
            usage(EXIT_SUCCESS);
            break;
        default:
            usage(EXIT_FAILURE);
            break;
        }
    }

    ret = check_options();
    if (ret)
        goto out;

    if (!inspect_info.file_name)
        ret = build_fw();
    else
        ret = inspect_fw();

 out:
    return ret;
}</code></pre></div><p>/trunk/target/linux/ar7xx/base-files/etc/uci-defaults/network<br/></p><div class="codebox"><pre><code>#!/bin/sh
#
# Copyright (C) 2011 OpenWrt.org
#

[ -e /etc/config/network ] &amp;&amp; exit 0

touch /etc/config/network

. /lib/functions/uci-defaults.sh
. /lib/ar71xx.sh

ucidef_set_interface_loopback

board=$(ar71xx_board_name)

case &quot;$board&quot; in
all0315n |\
all0258n |\
ja76pf2|\
ubnt-unifi-outdoor)
    ucidef_set_interface_lan &quot;eth0 eth1&quot;
    ;;

db120 |\
rb-2011l | \
rb-2011uas-2hnd)
    ucidef_set_interfaces_lan_wan &quot;eth0.1 eth1&quot; &quot;eth0.2&quot;
    ucidef_add_switch &quot;eth0&quot; &quot;1&quot; &quot;1&quot;
    ucidef_add_switch_vlan &quot;eth0&quot; &quot;1&quot; &quot;0t 2 3 4 5&quot;
    ucidef_add_switch_vlan &quot;eth0&quot; &quot;2&quot; &quot;0t 1&quot;
    ucidef_add_switch &quot;eth1&quot; &quot;1&quot; &quot;1&quot;
    ucidef_add_switch_vlan &quot;eth1&quot; &quot;1&quot; &quot;0 1 2 3 4 5&quot;
    ;;

dir-825-b1|\
tew-673gru)
    ucidef_set_interfaces_lan_wan &quot;eth0.1&quot; &quot;eth1&quot;
    ucidef_add_switch &quot;rtl8366s&quot; &quot;1&quot; &quot;1&quot;
    ucidef_add_switch_vlan &quot;rtl8366s&quot; &quot;1&quot; &quot;0 1 2 3 5t&quot;
    ;;

nbg460n_550n_550nh)
    ucidef_set_interfaces_lan_wan &quot;eth0&quot; &quot;eth1&quot;
    ucidef_add_switch &quot;rtl8366s&quot; &quot;1&quot; &quot;1&quot;
    ucidef_add_switch_vlan &quot;rtl8366s&quot; &quot;0&quot; &quot;0 1 2 3 5&quot;
    ;;

rb-433 |\
rb-433u)
    ucidef_set_interfaces_lan_wan &quot;eth1&quot; &quot;eth0&quot;
    ucidef_add_switch &quot;switch0&quot; &quot;1&quot; &quot;1&quot;
    ucidef_add_switch_vlan &quot;switch0&quot; &quot;1&quot; &quot;1 2 5&quot;
    ;;

rb-450)
    ucidef_set_interfaces_lan_wan &quot;eth1&quot; &quot;eth0&quot;
    ucidef_add_switch &quot;eth1&quot; &quot;1&quot; &quot;1&quot;
    ucidef_add_switch_vlan &quot;eth1&quot; &quot;1&quot; &quot;0 1 2 3 5&quot;
    ;;

rb-450g |\
routerstation-pro)
    ucidef_set_interfaces_lan_wan &quot;eth1&quot; &quot;eth0&quot;
    ucidef_add_switch &quot;switch0&quot; &quot;1&quot; &quot;1&quot;
    ucidef_add_switch_vlan &quot;switch0&quot; &quot;1&quot; &quot;0 1 2 3 4&quot;
    ;;

ap136 |\
rb-750gl |\
rb-751g |\
wzr-hp-g450h)
    ucidef_set_interfaces_lan_wan &quot;eth0.1&quot; &quot;eth0.2&quot;
    ucidef_add_switch &quot;switch0&quot; &quot;1&quot; &quot;1&quot;
    ucidef_add_switch_vlan &quot;switch0&quot; &quot;1&quot; &quot;0t 2 3 4 5&quot;
    ucidef_add_switch_vlan &quot;switch0&quot; &quot;2&quot; &quot;0t 1&quot;
    ;;

rb-493g)
    ucidef_set_interfaces_lan_wan &quot;eth0 eth1.1&quot; &quot;eth1.2&quot;
    ucidef_add_switch &quot;switch0&quot; &quot;1&quot; &quot;1&quot;
    ucidef_add_switch_vlan &quot;switch0&quot; &quot;1&quot; &quot;0 1 2 3 4&quot;
    ucidef_add_switch &quot;switch1&quot; &quot;1&quot; &quot;1&quot;
    ucidef_add_switch_vlan &quot;switch1&quot; &quot;1&quot; &quot;0t 1 2 3 4&quot;
    ucidef_add_switch_vlan &quot;switch1&quot; &quot;2&quot; &quot;0t 5&quot;
    ;;

wzr-hp-g300nh2 |\
pb92 |\
ap113)
    ucidef_set_interfaces_lan_wan &quot;eth0.1&quot; &quot;eth0.2&quot;
    ucidef_add_switch &quot;eth0&quot; &quot;1&quot; &quot;1&quot;
    ucidef_add_switch_vlan &quot;eth0&quot; &quot;1&quot; &quot;0t 1 3 4 5&quot;
    ucidef_add_switch_vlan &quot;eth0&quot; &quot;2&quot; &quot;0t 2&quot;
    ;;

tl-wdr4300|\
tl-wr1041n-v2)
    ucidef_set_interfaces_lan_wan &quot;eth0.1&quot; &quot;eth0.2&quot;
    ucidef_add_switch &quot;eth0&quot; &quot;1&quot; &quot;1&quot;
    ucidef_add_switch_vlan &quot;eth0&quot; &quot;1&quot; &quot;0t 2 3 4 5&quot;
    ucidef_add_switch_vlan &quot;eth0&quot; &quot;2&quot; &quot;0t 1&quot;
    ;;

tl-wr1043nd)
    ucidef_set_interfaces_lan_wan &quot;eth0.1&quot; &quot;eth0.2&quot;
    ucidef_add_switch &quot;rtl8366rb&quot; &quot;1&quot; &quot;1&quot;
    ucidef_add_switch_vlan &quot;rtl8366rb&quot; &quot;1&quot; &quot;1 2 3 4 5t&quot;
    ucidef_add_switch_vlan &quot;rtl8366rb&quot; &quot;2&quot; &quot;0 5t&quot;
    ;;

tl-wr2543n)
    ucidef_set_interfaces_lan_wan &quot;eth0.1&quot; &quot;eth0.2&quot;
    ucidef_add_switch &quot;switch0&quot; &quot;1&quot; &quot;1&quot;
    ucidef_add_switch_vlan &quot;switch0&quot; &quot;1&quot; &quot;1 2 3 4 9t&quot;
    ucidef_add_switch_vlan &quot;switch0&quot; &quot;2&quot; &quot;0 9t&quot;
    ;;

tl-wr841n-v1|\
tl-wr941nd)
    ucidef_set_interface_raw &quot;eth&quot; &quot;eth0&quot;
    ucidef_set_interfaces_lan_wan &quot;lan1 lan2 lan3 lan4&quot; &quot;wan&quot;
    ;;

tl-wr841n-v8)
    ucidef_set_interfaces_lan_wan &quot;eth1&quot; &quot;eth0&quot;
    ucidef_add_switch &quot;switch0&quot; &quot;1&quot; &quot;1&quot;
    ucidef_add_switch_vlan &quot;switch0&quot; &quot;1&quot; &quot;0 1 2 3 4&quot;
    ;;

wrt160nl)
    ucidef_set_interfaces_lan_wan &quot;eth0&quot; &quot;eth1&quot;
    ucidef_add_switch &quot;eth0&quot; &quot;1&quot; &quot;1&quot;
    ucidef_add_switch_vlan &quot;eth0&quot; &quot;1&quot; &quot;0 1 2 3 4 5&quot;
    ;;

wzr-hp-g300nh)
    ucidef_set_interfaces_lan_wan &quot;eth0.1&quot; &quot;eth1&quot;
    ucidef_add_switch &quot;switch0&quot; &quot;1&quot; &quot;1&quot;
    ucidef_add_switch_vlan &quot;switch0&quot; &quot;1&quot; &quot;0 1 2 3 5t&quot;
    ;;

all0305 |\
aw-nr580 |\
bullet-m |\
cap4200ag |\
eap7660d |\
rb-411 |\
tl-mr11u |\
tl-mr3020 |\
tl-mr3040 |\
tl-wa901nd |\
tl-wa901nd-v2 |\
tl-wr703n |\
wp543)
    ucidef_set_interface_lan &quot;eth0&quot;
    ;;

alfa-ap96 |\
alfa-nx |\
ap83 |\
jwap003 |\
pb42 |\
pb44 |\
routerstation|\
wpe72)
    ucidef_set_interfaces_lan_wan &quot;eth1&quot; &quot;eth0&quot;
    ;;

ap121 |\
ap121-mini |\
ap96 |\
airrouter |\
dir-600-a1 |\
dir-615-c1 |\
dir-615-e4 |\
ja76pf |\
rb-750 |\
rb-751 |\
tew-632brp |\
tew-712br |\
tl-mr3220 |\
tl-mr3220-v2 |\
tl-mr3420 |\
tl-wr741nd |\
tl-wr741nd-v4 |\
tl-wr841n-v7 |\
whr-g301n |\
whr-hp-g300n |\
whr-hp-gn |\
wzr-hp-ag300h)
    ucidef_set_interfaces_lan_wan &quot;eth0&quot; &quot;eth1&quot;
    ucidef_add_switch &quot;eth0&quot; &quot;1&quot; &quot;1&quot;
    ucidef_add_switch_vlan &quot;eth0&quot; &quot;1&quot; &quot;0 1 2 3 4&quot;
    ;;

wzr-hp-g450h)
    ucidef_set_interfaces_lan_wan &quot;eth0.1&quot; &quot;eth0.2&quot;
    ucidef_add_switch &quot;eth0&quot; &quot;1&quot; &quot;1&quot;
    ucidef_add_switch_vlan &quot;eth0&quot; &quot;1&quot; &quot;0t 2 3 4 5&quot;
    ucidef_add_switch_vlan &quot;eth0&quot; &quot;2&quot; &quot;0t 1&quot;
    ;;

ew-dorin)
    ucidef_set_interface_lan &quot;eth0&quot;
    ucidef_add_switch &quot;eth0&quot; &quot;1&quot; &quot;1&quot;
    ucidef_add_switch_vlan &quot;eth0&quot; &quot;1&quot; &quot;0 1 2 3&quot;
    ;;

ew-dorin-router)
    ucidef_set_interfaces_lan_wan &quot;eth0&quot; &quot;eth1&quot;
    ucidef_add_switch &quot;eth0&quot; &quot;1&quot; &quot;1&quot;
    ucidef_add_switch_vlan &quot;eth0&quot; &quot;1&quot; &quot;0 2 3&quot;
    ;;

*)
    ucidef_set_interfaces_lan_wan &quot;eth0&quot; &quot;eth1&quot;
    ;;
esac

uci commit network

exit 0</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p184229">
				<div class="post-metadata">
					<div class="post-num">Post #44</div>
					<div class="post-author">cindy.wijaya</div>
					<div class="post-datetime">
						25 Nov 2012, 05:42					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>openwrt_user wrote:</cite><blockquote><p>Could someone post his .config as a starting point?<br/>Also some few instructions would be adequate <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink"/></p><p>beside editing &quot;/trunk/target/linux/ar71xx/files/arch/mips/ath79/mach-tl-wr741nd-v4.c&quot; is there any other modification needed?</p></blockquote></div><p>just select profile mr3220 at menu config.</p><br/><p>***<br/>if needed you can download this:</p><p>mr3220-v2.config<br/><a href="https://www.box.com/s/x6mozis7kw5b9h86xhy4">https://www.box.com/s/x6mozis7kw5b9h86xhy4</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p184236">
				<div class="post-metadata">
					<div class="post-num">Post #45</div>
					<div class="post-author">nebbia88</div>
					<div class="post-datetime">
						25 Nov 2012, 09:51					</div>
				</div>
				<div class="post-content content">
					<p>cindy it will be awesome if you prepare those files in &quot;patch&quot; form, so they could be committed by openwrt trunk itself...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p184249">
				<div class="post-metadata">
					<div class="post-num">Post #46</div>
					<div class="post-author">GaDs</div>
					<div class="post-datetime">
						25 Nov 2012, 13:12					</div>
				</div>
				<div class="post-content content">
					<p>Replaced the files as indicated, an error:<br/></p><div class="codebox"><pre><code>&gt;make V=99 -j 3
Makefile:934: *** missing separator.  Stop.
make[5]: *** [image-prereq] Error 2
make[4]: *** [prereq] Error 2
make[3]: *** [target/linux/prereq] Error 2
make[2]: *** [/home/davn/OpenWrt/mr3220/trunk/staging_dir/target-mips_r2_uClibc-0.9.33.2/stamp/.target_prereq] Error 2
make[1]: *** [prereq] Error 2
make: *** [world] Error 2</code></pre></div><p>Used mr3220-v2.config<br/>Trunk 34325.</p>											<p class="post-edited">(Last edited by <strong>GaDs</strong> on 25 Nov 2012, 13:14)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p184251">
				<div class="post-metadata">
					<div class="post-num">Post #47</div>
					<div class="post-author">openwrt_user</div>
					<div class="post-datetime">
						25 Nov 2012, 14:00					</div>
				</div>
				<div class="post-content content">
					<p>I also have GaDs error even with trunk 34200. It fails at prereq.</p><p>the file is /trunk/tools/firmware-utils/src/mktplink<strong>fw</strong>.c ?<br/>minor typo?</p><p>Thanks Cindy for everything</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p184335">
				<div class="post-metadata">
					<div class="post-num">Post #48</div>
					<div class="post-author">picasoft</div>
					<div class="post-datetime">
						26 Nov 2012, 10:50					</div>
				</div>
				<div class="post-content content">
					<p>i have mr3220 and already patch openwrt mr3220 v2 (SUCCESS) but i have problem, i can&#039;t install kmod-video-core&nbsp; kmod-video-uvc. please any one help me. thx</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p184336">
				<div class="post-metadata">
					<div class="post-num">Post #49</div>
					<div class="post-author">picasoft</div>
					<div class="post-datetime">
						26 Nov 2012, 10:52					</div>
				</div>
				<div class="post-content content">
					<p>if there is an image for mr3220 v2 with video support. thank you all</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p184337">
				<div class="post-metadata">
					<div class="post-num">Post #50</div>
					<div class="post-author">nebbia88</div>
					<div class="post-datetime">
						26 Nov 2012, 10:53					</div>
				</div>
				<div class="post-content content">
					<p>what errors you have?</p>									</div>
			</article>

			
		
						<div class="notice">
				<p>Sorry, posts 51 to 50 are missing from our archive.</p>
			</div>
		
		
	
	<div class="pagination"><div class="pagination-number">Page 2 of 6</div><nav><ul><li><a href="viewtopic.php%3Fid=38896&amp;p=1.html">1</a></li><li class="pagination-current"><span>2</span></li><li><a href="viewtopic.php%3Fid=38896&amp;p=3.html">3</a></li><li><a href="viewtopic.php%3Fid=38896&amp;p=4.html">4</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=38896&amp;p=6.html">6</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>