<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Simple Port Forwarding not working</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 14 Apr 2018 and 26 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 2</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=36055&amp;p=2.html">2</a></li></ul></nav></div>
			
		
		
			<article class="post" id="p163805">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">apple4ever</div>
					<div class="post-datetime">
						9 Apr 2012, 11:17					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m really trying not to be frustrated, but I&#039;m trying something simple that should just work. I&#039;ve done a ton of reading and searching, but I don&#039;t know what I&#039;m doing wrong.</p><p>My setup: I have a Netgear WNDR3700v2 with OpenWrt Backfire 10.03.1 / LuCI 0.10.0. There is a server on my LAN with a web server running on port 9090. I want to connect on the WAN to port 9090, and access that server. That is really simple and easy to do with the OEM software. But I can&#039;t get it to work with OpenWRT (which I really want to run for VLANing my network). </p><p>There must be something simple I&#039;m missing. I even went back to a brand new install and the only thing I&#039;ve set up on the IPs and the Redirect/Rules settings. I&#039;ve been doing this all with the LuCI interface, but I&#039;ve been checking the iptables output and it seems right.</p><p>Here is my iptables config:</p><div class="codebox"><pre><code>Chain INPUT (policy ACCEPT)
target     prot opt source               destination         
DROP       all  --  anywhere             anywhere            state INVALID 
ACCEPT     all  --  anywhere             anywhere            state RELATED,ESTABLISHED 
ACCEPT     all  --  anywhere             anywhere            
syn_flood  tcp  --  anywhere             anywhere            tcp flags:FIN,SYN,RST,ACK/SYN 
input_rule  all  --  anywhere             anywhere            
input      all  --  anywhere             anywhere            

Chain FORWARD (policy ACCEPT)
target     prot opt source               destination         
DROP       all  --  anywhere             anywhere            state INVALID 
ACCEPT     all  --  anywhere             anywhere            state RELATED,ESTABLISHED 
forwarding_rule  all  --  anywhere             anywhere            
forward    all  --  anywhere             anywhere            

Chain OUTPUT (policy ACCEPT)
target     prot opt source               destination         
DROP       all  --  anywhere             anywhere            state INVALID 
ACCEPT     all  --  anywhere             anywhere            state RELATED,ESTABLISHED 
ACCEPT     all  --  anywhere             anywhere            
output_rule  all  --  anywhere             anywhere            
output     all  --  anywhere             anywhere            

Chain forward (1 references)
target     prot opt source               destination         
zone_lan_forward  all  --  anywhere             anywhere            
zone_wan_forward  all  --  anywhere             anywhere            

Chain forwarding_lan (1 references)
target     prot opt source               destination         

Chain forwarding_rule (1 references)
target     prot opt source               destination         
nat_reflection_fwd  all  --  anywhere             anywhere            

Chain forwarding_wan (1 references)
target     prot opt source               destination         

Chain input (1 references)
target     prot opt source               destination         
zone_lan   all  --  anywhere             anywhere            
zone_wan   all  --  anywhere             anywhere            

Chain input_lan (1 references)
target     prot opt source               destination         

Chain input_rule (1 references)
target     prot opt source               destination         

Chain input_wan (1 references)
target     prot opt source               destination         

Chain nat_reflection_fwd (1 references)
target     prot opt source               destination         
ACCEPT     tcp  --  174.54.200.0/21      192.168.0.52        tcp dpt:9090 

Chain output (1 references)
target     prot opt source               destination         
zone_lan_ACCEPT  all  --  anywhere             anywhere            
zone_wan_ACCEPT  all  --  anywhere             anywhere            

Chain output_rule (1 references)
target     prot opt source               destination         

Chain reject (4 references)
target     prot opt source               destination         
REJECT     tcp  --  anywhere             anywhere            reject-with tcp-reset 
REJECT     all  --  anywhere             anywhere            reject-with icmp-port-unreachable 

Chain syn_flood (1 references)
target     prot opt source               destination         
RETURN     tcp  --  anywhere             anywhere            tcp flags:FIN,SYN,RST,ACK/SYN limit: avg 25/sec burst 50 
DROP       all  --  anywhere             anywhere            

Chain zone_lan (1 references)
target     prot opt source               destination         
input_lan  all  --  anywhere             anywhere            
zone_lan_ACCEPT  all  --  anywhere             anywhere            

Chain zone_lan_ACCEPT (5 references)
target     prot opt source               destination         
ACCEPT     all  --  anywhere             anywhere            
ACCEPT     all  --  anywhere             anywhere            

Chain zone_lan_DROP (0 references)
target     prot opt source               destination         
DROP       all  --  anywhere             anywhere            
DROP       all  --  anywhere             anywhere            

Chain zone_lan_REJECT (0 references)
target     prot opt source               destination         
reject     all  --  anywhere             anywhere            
reject     all  --  anywhere             anywhere            

Chain zone_lan_forward (1 references)
target     prot opt source               destination         
zone_wan_ACCEPT  all  --  anywhere             anywhere            
forwarding_lan  all  --  anywhere             anywhere            
zone_lan_ACCEPT  all  --  anywhere             anywhere            

Chain zone_wan (1 references)
target     prot opt source               destination         
ACCEPT     udp  --  anywhere             anywhere            udp dpt:bootpc 
ACCEPT     icmp --  anywhere             anywhere            icmp echo-request 
input_wan  all  --  anywhere             anywhere            
zone_wan_REJECT  all  --  anywhere             anywhere            

Chain zone_wan_ACCEPT (3 references)
target     prot opt source               destination         
ACCEPT     all  --  anywhere             anywhere            
ACCEPT     all  --  anywhere             anywhere            

Chain zone_wan_DROP (0 references)
target     prot opt source               destination         
DROP       all  --  anywhere             anywhere            
DROP       all  --  anywhere             anywhere            

Chain zone_wan_REJECT (1 references)
target     prot opt source               destination         
reject     all  --  anywhere             anywhere            
reject     all  --  anywhere             anywhere            

Chain zone_wan_forward (1 references)
target     prot opt source               destination         
ACCEPT     tcp  --  anywhere             192.168.0.52        tcp spt:9090 dpt:9090 
zone_lan_ACCEPT  tcp  --  anywhere             anywhere            tcp spt:9090 dpt:9090 
zone_lan_ACCEPT  all  --  anywhere             anywhere            
forwarding_wan  all  --  anywhere             anywhere            
zone_wan_ACCEPT  all  --  anywhere             anywhere</code></pre></div><p>Please help! I don&#039;t know what else to do.</p>											<p class="post-edited">(Last edited by <strong>apple4ever</strong> on 9 Apr 2012, 11:18)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p163807">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">JohnnyUSA</div>
					<div class="post-datetime">
						9 Apr 2012, 11:33					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><blockquote><p>config &#039;redirect&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;src&#039; &#039;wan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;proto&#039; &#039;tcp&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;src_ip&#039; &#039;&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;src_dport&#039; &#039;34795&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;dest_ip&#039; &#039;192.168.1.100&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;dest_port&#039; &#039;34795&#039;</p><p>config &#039;rule&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;src&#039; &#039;wan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;proto&#039; &#039;tcp&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;src_ip&#039; &#039;&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;dest_ip&#039; &#039;&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;dest_port&#039; &#039;34795&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;target&#039; &#039;ACCEPT&#039;</p></blockquote></div><p>Example of uTorrent port forwarding on OpenWRT.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p163808">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">apple4ever</div>
					<div class="post-datetime">
						9 Apr 2012, 11:41					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>JohnnyUSA wrote:</cite><blockquote><div class="quotebox"><blockquote><p>config &#039;redirect&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;src&#039; &#039;wan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;proto&#039; &#039;tcp&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;src_ip&#039; &#039;&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;src_dport&#039; &#039;34795&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;dest_ip&#039; &#039;192.168.1.100&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;dest_port&#039; &#039;34795&#039;</p><p>config &#039;rule&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;src&#039; &#039;wan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;proto&#039; &#039;tcp&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;src_ip&#039; &#039;&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;dest_ip&#039; &#039;&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;dest_port&#039; &#039;34795&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;target&#039; &#039;ACCEPT&#039;</p></blockquote></div><p>Example of uTorrent port forwarding on OpenWRT.</p></blockquote></div><p>Yeah I already read that and tried that:</p><div class="codebox"><pre><code>config &#039;redirect&#039;
    option &#039;_name&#039; &#039;SecuritySpy&#039;
    option &#039;src&#039; &#039;wan&#039;
    option &#039;proto&#039; &#039;tcp&#039;
    option &#039;src_dport&#039; &#039;9090&#039;
    option &#039;dest_ip&#039; &#039;192.168.0.52&#039;
    option &#039;dest_port&#039; &#039;9090&#039;
    option &#039;target&#039; &#039;DNAT&#039;
    option &#039;dest&#039; &#039;lan&#039;

config &#039;rule&#039;
    option &#039;target&#039; &#039;ACCEPT&#039;
    option &#039;_name&#039; &#039;SecuritySpty&#039;
    option &#039;src&#039; &#039;wan&#039;
    option &#039;proto&#039; &#039;tcp&#039;
    option &#039;dest_port&#039; &#039;9090&#039;</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p163809">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">JohnnyUSA</div>
					<div class="post-datetime">
						9 Apr 2012, 11:47					</div>
				</div>
				<div class="post-content content">
					<p>Strange, because for me it works like charm..</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p163811">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">apple4ever</div>
					<div class="post-datetime">
						9 Apr 2012, 11:52					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>JohnnyUSA wrote:</cite><blockquote><p>Strange, because for me it works like charm..</p></blockquote></div><p>I know, it should work like a charm for me too. I don&#039;t understand it.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p164037">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">apple4ever</div>
					<div class="post-datetime">
						10 Apr 2012, 21:11					</div>
				</div>
				<div class="post-content content">
					<p>Still no suggestions? Anything I can do or look at? </p><p>Why is something so simple not working?</p><p>Is it a bug in Backfire 10.03.1? It must be.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p164039">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						10 Apr 2012, 21:21					</div>
				</div>
				<div class="post-content content">
					<p>Is &quot;192.168.0.52&quot; actually using OpenWrt as default gateway?<br />Also remove that second rule, its redundant. Port forwards take care of opening the appropriate ports as well.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p164043">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">apple4ever</div>
					<div class="post-datetime">
						10 Apr 2012, 21:43					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>jow wrote:</cite><blockquote><p>Is &quot;192.168.0.52&quot; actually using OpenWrt as default gateway?<br />Also remove that second rule, its redundant. Port forwards take care of opening the appropriate ports as well.</p></blockquote></div><p>Yes, it should be using 192.168.0.1 as the default gateway, as that was the old setting as well (I will verify when I get home). I see where you are going with this. I&#039;m going to try to run Wireshark on that computer to see if its getting traffic on 9090 from OpenWrt and its just not getting back, or if its not getting anything at all.</p><p>(Just FYI:192.168.0.1 is the default gateway, and the LAN IP of the OpenWrt router. 192.168.0.52 is the IP of the server that has a website hosted on port 9090 (which works from internal to the network as well as with the OEM firmware, so I&#039;m sure its not the computer)). </p><p>Okay, I can remove the second rule. I thought that was also need to open from the outside, but that would only be if I wanted to access something directly on the OpenWrt router? Say HTTPS traffic to the LuCI interface (which I&#039;ve tried and also doesn&#039;t work). </p><p>Thanks! OpenWrt works great as a router, and I can&#039;t want to add more things to it (VLAN, etc), but this is a big deal breaking.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p164061">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">towolf</div>
					<div class="post-datetime">
						11 Apr 2012, 00:42					</div>
				</div>
				<div class="post-content content">
					<p>Are you sure src_dport is correct? Normally source ports are random.</p><p>My rules look like this:</p><div class="codebox"><pre><code>config redirect                       
        option src              wan
        option src_dport        &#039;16881-16899&#039;
        option dest             lan
        option dest_ip          10.0.0.9
        option proto            tcpudp</code></pre></div><p>EDIT: sorry I get it now src_dport ? dest_port is the map.</p>											<p class="post-edited">(Last edited by <strong>towolf</strong> on 11 Apr 2012, 00:43)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p164063">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">apple4ever</div>
					<div class="post-datetime">
						11 Apr 2012, 00:51					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>towolf wrote:</cite><blockquote><p>Are you sure src_dport is correct? Normally source ports are random.</p><p>&lt;snip&gt;</p><p>EDIT: sorry I get it now src_dport ? dest_port is the map.</p></blockquote></div><p>Yeah, I was adding the ports in a lot of places just to see if I could fix it that way. No luck.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p164214">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">apple4ever</div>
					<div class="post-datetime">
						12 Apr 2012, 06:29					</div>
				</div>
				<div class="post-content content">
					<p>Okay, I ran Wireshark on the the server, and no traffic is coming in on port 9090 from the router (but it is when I connect via my computer).</p><p>So the firewall isn&#039;t properly routing the traffic.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p164226">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						12 Apr 2012, 09:50					</div>
				</div>
				<div class="post-content content">
					<p>Your rule listing in the first post shows a source port of 9090 - do you have any src_port (not src_dport) option in your rule?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p164326">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">apple4ever</div>
					<div class="post-datetime">
						13 Apr 2012, 04:22					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>jow wrote:</cite><blockquote><p>Your rule listing in the first post shows a source port of 9090 - do you have any src_port (not src_dport) option in your rule?</p></blockquote></div><p>Do you mean in the UCI config file (/etc/config/firewall) or in the iptables rules itself?</p><p>I added it to the UCI config file with no success.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p164624">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">apple4ever</div>
					<div class="post-datetime">
						16 Apr 2012, 06:24					</div>
				</div>
				<div class="post-content content">
					<p>Okay I tried a sysupgrade to the most recent trunk (April 11th) and still no success. </p><p>I can&#039;t believe something so simple doesn&#039;t work out of the box.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p165229">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">doctor78</div>
					<div class="post-datetime">
						20 Apr 2012, 18:16					</div>
				</div>
				<div class="post-content content">
					<p>Did u ever managed to get this work? I am having the exact same issue!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p165233">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">apple4ever</div>
					<div class="post-datetime">
						20 Apr 2012, 18:41					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>doctor78 wrote:</cite><blockquote><p>Did u ever managed to get this work? I am having the exact same issue!</p></blockquote></div><p>Nope, it still doesn&#039;t work. Its frustrating as hell when I could buy a 6 year old used router that I could set up and do this in about 10 minutes. I&#039;m probably going to have to go back to the OEM firmware. </p><p>What router do you have? I&#039;m wondering if its a bug in the source for this router. Mines a NetGear WNDR3700v2.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p165237">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						20 Apr 2012, 18:49					</div>
				</div>
				<div class="post-content content">
					<p>doctor78&#039;s problem is that the ISP apparently filters ingress traffic on certain ports. At least his rules never see any packets from the outside.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p165251">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">apple4ever</div>
					<div class="post-datetime">
						20 Apr 2012, 20:17					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>jow wrote:</cite><blockquote><p>doctor78&#039;s problem is that the ISP apparently filters ingress traffic on certain ports. At least his rules never see any packets from the outside.</p></blockquote></div><p>Is there a way I can check if mine is actually seeing the packets? Or other logging? Should I submit a ticket on the dev site?</p><p>I&#039;m certain its not my ISP because my old NetGear router handled this just fine. </p><p>Am I really the only one experiencing this? I feel like I&#039;m crazy.</p><p>Edit:</p><p>I forgot to mention that I did try some logging, but I don&#039;t think I had the correct logging rules set up.</p>											<p class="post-edited">(Last edited by <strong>apple4ever</strong> on 20 Apr 2012, 20:24)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p165252">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">doctor78</div>
					<div class="post-datetime">
						20 Apr 2012, 20:38					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>jow wrote:</cite><blockquote><p>doctor78&#039;s problem is that the ISP apparently filters ingress traffic on certain ports. At least his rules never see any packets from the outside.</p></blockquote></div><p>No Jow, my ISP does not filter any traffic. I called them and checked. If I bypass my router the RDC works fine. Through router it does not. I am starting to believe that something is wrong with arokh build.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p165363">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">veames</div>
					<div class="post-datetime">
						21 Apr 2012, 19:49					</div>
				</div>
				<div class="post-content content">
					<p>I am having the same issue on my WNDR3700v2 with 10.03.1</p><p>This has only started since I upgraded. Port forwarding does not work at all,packed are not seen at all.</p><p>Anyone have a workaround??</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p165364">
				<div class="post-metadata">
					<div class="post-num">Post #21</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						21 Apr 2012, 19:51					</div>
				</div>
				<div class="post-content content">
					<p>I run 10.03.1 on both WNDR3700 and WNDR3700v2 and I see zero issues.<br />Even the alleged &quot;same problem&quot; from doctor78 turned out to be a misconfigured destination host (it had a completely different ip).<br />So there is still zero evidence that port forwards are broken. Please post your complete /etc/config/firewall, including modifications to /etc/firewall.user if you did some.</p><p>The basic check list to run through before considering port forwards &quot;broken&quot;:</p><p> a) the destination ip is actually correct, check static lease, check local ip config of destination host<br /> b) the source ip is either unset (should be this way) or it is indeed matching the host trying to use the port forward - 99% of the cases should have the source ip unset (&quot;src_ip&quot; option, not &quot;src_dip&quot;)<br /> c) the source port is either unset (should be this way) or it is indeed matching the local outgoing port used by the client - 99% of the cases should have the source port unset (&quot;src_port&quot; option, not &quot;src_dport&quot;)<br /> d) ports, protocol match the traffic that should be forewarded<br /> e) a service is actually listening on the destination port of the destination host<br /> f) accessing the own public ip from within the lan is not the same as actually testing a port forward from the outside. OpenWrt will attempt to setup some loopback rules but they only work by default if your lan network is called &quot;lan&quot;<br /> g) traffic rules might overrule traffic redirects. So if you have a rule somewhere that says that tcp/22 should be rejected, it might prevent a port forward on tcp/22 from working<br /> h) services listening on forwarded ports might interfere, so if you try to forward tcp/22 to an internal host but dropbear is listening on tcp/22 as well then it might fail under certain circumstances, so try a different port first<br /> i) use &quot;{ iptables -nvL; iptables -t nat -nvL; } | grep port-nr&quot; to see if you rules are actually reached, a counter of 0 means that either no traffic ever arrived or that the arriving traffic was not matched, because e.g. a bad &quot;src_ip&quot; is set<br /> j) make sure the destination host uses the OpenWrt router as default route!<br /> k) make sure the destination host does not firewall its local port incoming or outgoing!<br /> l) make sure the destination host is actually properly reachable from the router (arp &amp; routing-wise)<br /> m) make sure the outgoing traffic is masqueraded (should be by default)<br /> n) make sure there are no NOTRACK rules in &quot;iptables -t raw -nvL&quot; that prevent conntracking from working<br /> o) make sure you actually created a DNAT rule. SNAT rules are a completely different thing<br /> p) &quot;it works on the vendor firmware&quot; means nothing without ensuring that the final rules are actually the same<br /> q) if port forwards would be truly broken for everyone there would be a lot of reports about it. So far the overwhelming majority of cases turned out to be misconfigurations</p><p>So please run through this checklist before jumping to conclusions.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p165366">
				<div class="post-metadata">
					<div class="post-num">Post #22</div>
					<div class="post-author">veames</div>
					<div class="post-datetime">
						21 Apr 2012, 20:30					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m not suggesting there is really a firmware issue, certainly it&#039;s probably a config somewhere.. Just need to find where.</p><p>Given that I am using default config, likely I am not the only one with the problem.</p><p>Followed your directions, thanks. Only thing that comes up.</p><p>root@OpenWrt:~# iptables -t raw -nvL<br />Chain PREROUTING (policy ACCEPT 9670 packets, 3257K bytes)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination<br /> 5406&nbsp; 804K zone_lan_notrack&nbsp; all&nbsp; --&nbsp; br-lan *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0<br /> 4264 2453K zone_wan_notrack&nbsp; all&nbsp; --&nbsp; eth1&nbsp; &nbsp;*&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0</p><p>Chain OUTPUT (policy ACCEPT 944 packets, 224K bytes)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination</p><p>Chain zone_lan_notrack (1 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination</p><p>Chain zone_wan_notrack (1 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination</p><p>My Host static IP is good, firewall is off, not ISP blocked, ARP is good. see attached firewall config</p><br /><p>---</p><p>root@OpenWrt:~# cat /etc/config/firewall<br />config defaults<br />&nbsp; &nbsp; &nbsp; &nbsp; option syn_flood&nbsp; &nbsp; &nbsp; &nbsp; 1<br />&nbsp; &nbsp; &nbsp; &nbsp; option input&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ACCEPT<br />&nbsp; &nbsp; &nbsp; &nbsp; option output&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ACCEPT<br />&nbsp; &nbsp; &nbsp; &nbsp; option forward&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; REJECT<br /># Uncomment this line to disable ipv6 rules<br />#&nbsp; &nbsp; &nbsp; &nbsp;option disable_ipv6&nbsp; &nbsp; &nbsp;1</p><p>config zone<br />&nbsp; &nbsp; &nbsp; &nbsp; option name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lan<br />&nbsp; &nbsp; &nbsp; &nbsp; option network&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#039;lan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option input&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ACCEPT<br />&nbsp; &nbsp; &nbsp; &nbsp; option output&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ACCEPT<br />&nbsp; &nbsp; &nbsp; &nbsp; option forward&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; REJECT</p><p>config zone<br />&nbsp; &nbsp; &nbsp; &nbsp; option name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;wan<br />&nbsp; &nbsp; &nbsp; &nbsp; option network&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#039;wan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option input&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; REJECT<br />&nbsp; &nbsp; &nbsp; &nbsp; option output&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ACCEPT<br />&nbsp; &nbsp; &nbsp; &nbsp; option forward&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; REJECT<br />&nbsp; &nbsp; &nbsp; &nbsp; option masq&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1<br />&nbsp; &nbsp; &nbsp; &nbsp; option mtu_fix&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1</p><p>config forwarding<br />&nbsp; &nbsp; &nbsp; &nbsp; option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lan<br />&nbsp; &nbsp; &nbsp; &nbsp; option dest&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;wan</p><p># We need to accept udp packets on port 68,<br /># see <a href="https://dev.openwrt.org/ticket/4108">https://dev.openwrt.org/ticket/4108</a><br />config rule<br />&nbsp; &nbsp; &nbsp; &nbsp; option name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Allow-DHCP-Renew<br />&nbsp; &nbsp; &nbsp; &nbsp; option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wan<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; udp<br />&nbsp; &nbsp; &nbsp; &nbsp; option dest_port&nbsp; &nbsp; &nbsp; &nbsp; 68<br />&nbsp; &nbsp; &nbsp; &nbsp; option target&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ACCEPT<br />&nbsp; &nbsp; &nbsp; &nbsp; option family&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ipv4</p><p># Allow IPv4 ping<br />config rule<br />&nbsp; &nbsp; &nbsp; &nbsp; option name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Allow-Ping<br />&nbsp; &nbsp; &nbsp; &nbsp; option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wan<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; icmp<br />&nbsp; &nbsp; &nbsp; &nbsp; option icmp_type&nbsp; &nbsp; &nbsp; &nbsp; echo-request<br />&nbsp; &nbsp; &nbsp; &nbsp; option family&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ipv4<br />&nbsp; &nbsp; &nbsp; &nbsp; option target&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ACCEPT</p><p># Allow DHCPv6 replies<br /># see <a href="https://dev.openwrt.org/ticket/10381">https://dev.openwrt.org/ticket/10381</a><br />config rule<br />&nbsp; &nbsp; &nbsp; &nbsp; option name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Allow-DHCPv6<br />&nbsp; &nbsp; &nbsp; &nbsp; option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wan<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; udp<br />&nbsp; &nbsp; &nbsp; &nbsp; option src_ip&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;fe80::/10<br />&nbsp; &nbsp; &nbsp; &nbsp; option src_port&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;547<br />&nbsp; &nbsp; &nbsp; &nbsp; option dest_ip&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fe80::/10<br />&nbsp; &nbsp; &nbsp; &nbsp; option dest_port&nbsp; &nbsp; &nbsp; &nbsp; 546<br />&nbsp; &nbsp; &nbsp; &nbsp; option family&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ipv6<br />&nbsp; &nbsp; &nbsp; &nbsp; option target&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ACCEPT</p><p># Allow essential incoming IPv6 ICMP traffic<br />config rule<br />&nbsp; &nbsp; &nbsp; &nbsp; option name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Allow-ICMPv6-Input<br />&nbsp; &nbsp; &nbsp; &nbsp; option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wan<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; icmp<br />&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo-request<br />&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; destination-unreachable<br />&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; packet-too-big<br />&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; time-exceeded<br />&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bad-header<br />&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; unknown-header-type<br />&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; router-solicitation<br />&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; neighbour-solicitation<br />&nbsp; &nbsp; &nbsp; &nbsp; option limit&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1000/sec<br />&nbsp; &nbsp; &nbsp; &nbsp; option family&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ipv6<br />&nbsp; &nbsp; &nbsp; &nbsp; option target&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ACCEPT</p><p># Allow essential forwarded IPv6 ICMP traffic<br />config rule<br />&nbsp; &nbsp; &nbsp; &nbsp; option name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Allow-ICMPv6-Forward<br />&nbsp; &nbsp; &nbsp; &nbsp; option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wan<br />&nbsp; &nbsp; &nbsp; &nbsp; option dest&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; icmp<br />&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo-request<br />&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; destination-unreachable<br />&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; packet-too-big<br />&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; time-exceeded<br />&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bad-header<br />&nbsp; &nbsp; &nbsp; &nbsp; list icmp_type&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; unknown-header-type<br />&nbsp; &nbsp; &nbsp; &nbsp; option limit&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1000/sec<br />&nbsp; &nbsp; &nbsp; &nbsp; option family&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ipv6<br />&nbsp; &nbsp; &nbsp; &nbsp; option target&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ACCEPT</p><p># include a file with users custom iptables rules<br />config include<br />&nbsp; &nbsp; &nbsp; &nbsp; option path /etc/firewall.user</p><br /><p>### EXAMPLE CONFIG SECTIONS<br /># do not allow a specific ip to access wan<br />#config rule<br />#&nbsp; &nbsp; &nbsp; &nbsp;option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lan<br />#&nbsp; &nbsp; &nbsp; &nbsp;option src_ip&nbsp; &nbsp;192.168.45.2<br />#&nbsp; &nbsp; &nbsp; &nbsp;option dest&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;wan<br />#&nbsp; &nbsp; &nbsp; &nbsp;option proto&nbsp; &nbsp; tcp<br />#&nbsp; &nbsp; &nbsp; &nbsp;option target&nbsp; &nbsp;REJECT</p><p># block a specific mac on wan<br />#config rule<br />#&nbsp; &nbsp; &nbsp; &nbsp;option dest&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;wan<br />#&nbsp; &nbsp; &nbsp; &nbsp;option src_mac&nbsp; 00:11:22:33:44:66<br />#&nbsp; &nbsp; &nbsp; &nbsp;option target&nbsp; &nbsp;REJECT</p><p># block incoming ICMP traffic on a zone<br />#config rule<br />#&nbsp; &nbsp; &nbsp; &nbsp;option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lan<br />#&nbsp; &nbsp; &nbsp; &nbsp;option proto&nbsp; &nbsp; ICMP<br />#&nbsp; &nbsp; &nbsp; &nbsp;option target&nbsp; &nbsp;DROP</p><p># port redirect port coming in on wan to lan</p><p>config &#039;redirect&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;src&#039; &#039;wan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;proto&#039; &#039;tcpudp&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;src_dport&#039; &#039;34795&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;dest_ip&#039; &#039;192.168.1.2&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;dest_port&#039; &#039;56976&#039;</p><p>#config &#039;rule&#039;<br />#&nbsp; &nbsp; &nbsp; &nbsp;option &#039;src&#039; &#039;wan&#039;<br />#&nbsp; &nbsp; &nbsp; &nbsp; option &#039;proto&#039; &#039;tcpudp&#039;<br />#&nbsp; &nbsp; &nbsp; &nbsp; option &#039;src_ip&#039; &#039;&#039;<br />#&nbsp; &nbsp; &nbsp; &nbsp; option &#039;dest_ip&#039; &#039;&#039;<br />#&nbsp; &nbsp; &nbsp; &nbsp; option &#039;dest_port&#039; &#039;56976&#039;<br />#&nbsp; &nbsp; &nbsp; &nbsp; option &#039;target&#039; &#039;ACCEPT&#039;</p><p>### FULL CONFIG SECTIONS<br />#config rule<br />#&nbsp; &nbsp; &nbsp; &nbsp;option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lan<br />#&nbsp; &nbsp; &nbsp; &nbsp;option src_ip&nbsp; &nbsp;192.168.45.2<br />#&nbsp; &nbsp; &nbsp; &nbsp;option src_mac&nbsp; 00:11:22:33:44:55<br />#&nbsp; &nbsp; &nbsp; &nbsp;option src_port 80<br />#&nbsp; &nbsp; &nbsp; &nbsp;option dest&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;wan<br />#&nbsp; &nbsp; &nbsp; &nbsp;option dest_ip&nbsp; 194.25.2.129<br />#&nbsp; &nbsp; &nbsp; &nbsp;option dest_port&nbsp; &nbsp; &nbsp; &nbsp; 120<br />#&nbsp; &nbsp; &nbsp; &nbsp;option proto&nbsp; &nbsp; tcp<br />#&nbsp; &nbsp; &nbsp; &nbsp;option target&nbsp; &nbsp;REJECT</p><p>#config redirect<br />#&nbsp; &nbsp; &nbsp; &nbsp;option src&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lan<br />#&nbsp; &nbsp; &nbsp; &nbsp;option src_ip&nbsp; &nbsp;192.168.45.2<br />#&nbsp; &nbsp; &nbsp; &nbsp;option src_mac&nbsp; 00:11:22:33:44:55<br />#&nbsp; &nbsp; &nbsp; &nbsp;option src_port&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1024<br />#&nbsp; &nbsp; &nbsp; &nbsp;option src_dport&nbsp; &nbsp; &nbsp; &nbsp; 80<br />#&nbsp; &nbsp; &nbsp; &nbsp;option dest_ip&nbsp; 194.25.2.129<br />#&nbsp; &nbsp; &nbsp; &nbsp;option dest_port&nbsp; &nbsp; &nbsp; &nbsp; 120<br />#&nbsp; &nbsp; &nbsp; &nbsp;option proto&nbsp; &nbsp; tcp</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p165369">
				<div class="post-metadata">
					<div class="post-num">Post #23</div>
					<div class="post-author">apple4ever</div>
					<div class="post-datetime">
						21 Apr 2012, 21:26					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>jow wrote:</cite><blockquote><p>I run 10.03.1 on both WNDR3700 and WNDR3700v2 and I see zero issues.<br />Even the alleged &quot;same problem&quot; from doctor78 turned out to be a misconfigured destination host (it had a completely different ip).<br />So there is still zero evidence that port forwards are broken. Please post your complete /etc/config/firewall, including modifications to /etc/firewall.user if you did some.</p><p>The basic check list to run through before considering port forwards &quot;broken&quot;:</p><p>&lt;snip checklist&gt;</p><p>So please run through this checklist before jumping to conclusions.</p></blockquote></div><p>Well the evidence is that this worked before with my old router, and now it doesn&#039;t work with this router. So something is not working, otherwise I wouldn&#039;t be here complaining about something so simple not working. I&#039;ll run through your checklist tonight, but here is my complete /etc/config/firewall:</p><div class="codebox"><pre><code>onfig rule
    option name &#039;Allow-DHCP-Renew&#039;
    option src &#039;wan&#039;
    option proto &#039;udp&#039;
    option dest_port &#039;68&#039;
    option target &#039;ACCEPT&#039;
    option family &#039;ipv4&#039;

config rule
    option name &#039;Allow-Ping&#039;
    option src &#039;wan&#039;
    option proto &#039;icmp&#039;
    option icmp_type &#039;echo-request&#039;
    option family &#039;ipv4&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-DHCPv6&#039;
    option src &#039;wan&#039;
    option proto &#039;udp&#039;
    option src_ip &#039;fe80::/10&#039;
    option src_port &#039;547&#039;
    option dest_ip &#039;fe80::/10&#039;
    option dest_port &#039;546&#039;
    option family &#039;ipv6&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-ICMPv6-Input&#039;
    option src &#039;wan&#039;
    option proto &#039;icmp&#039;
    list icmp_type &#039;echo-request&#039;
    list icmp_type &#039;destination-unreachable&#039;
    list icmp_type &#039;packet-too-big&#039;
    list icmp_type &#039;time-exceeded&#039;
    list icmp_type &#039;bad-header&#039;
    list icmp_type &#039;unknown-header-type&#039;
    list icmp_type &#039;router-solicitation&#039;
    list icmp_type &#039;neighbour-solicitation&#039;
    option limit &#039;1000/sec&#039;
    option family &#039;ipv6&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-ICMPv6-Forward&#039;
    option src &#039;wan&#039;
    option dest &#039;*&#039;
    option proto &#039;icmp&#039;
    list icmp_type &#039;echo-request&#039;
    list icmp_type &#039;destination-unreachable&#039;
    list icmp_type &#039;packet-too-big&#039;
    list icmp_type &#039;time-exceeded&#039;
    list icmp_type &#039;bad-header&#039;
    list icmp_type &#039;unknown-header-type&#039;
    option limit &#039;1000/sec&#039;
    option family &#039;ipv6&#039;
    option target &#039;ACCEPT&#039;

config rule
    option target &#039;ACCEPT&#039;
    option _name &#039;HTTP&#039;
    option src &#039;wan&#039;
    option proto &#039;tcp&#039;
    option src_port &#039;8000&#039;
    option dest_port &#039;8000&#039;

config rule
    option target &#039;ACCEPT&#039;
    option _name &#039;HTTPS&#039;
    option src &#039;wan&#039;
    option proto &#039;tcp&#039;
    option src_port &#039;8443&#039;
    option dest_port &#039;8443&#039;

config rule
    option target &#039;ACCEPT&#039;

config defaults
    option syn_flood &#039;1&#039;
    option input &#039;ACCEPT&#039;
    option output &#039;ACCEPT&#039;
    option forward &#039;REJECT&#039;
    option drop_invalid &#039;1&#039;

config zone
    option name &#039;lan&#039;
    option network &#039;lan&#039;
    option input &#039;ACCEPT&#039;
    option output &#039;ACCEPT&#039;
    option forward &#039;REJECT&#039;

config zone
    option name &#039;wan&#039;
    option network &#039;wan&#039;
    option input &#039;REJECT&#039;
    option output &#039;ACCEPT&#039;
    option masq &#039;1&#039;
    option mtu_fix &#039;1&#039;
    option forward &#039;ACCEPT&#039;

config include
    option path &#039;/etc/firewall.user&#039;

config redirect
    option target &#039;DNAT&#039;
    option src &#039;wan&#039;
    option dest &#039;lan&#039;
    option proto &#039;tcp udp&#039;
    option src_dport &#039;9090&#039;
    option dest_ip &#039;192.168.0.52&#039;
    option dest_port &#039;9090&#039;
    option name &#039;SecuritySpu&#039;
    option src_port &#039;9090&#039;

config forwarding
    option dest &#039;lan&#039;
    option src &#039;wan&#039;

config forwarding
    option dest &#039;wan&#039;
    option src &#039;lan&#039;</code></pre></div><p>I&#039;ll let you know what the checklist brings again.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p165372">
				<div class="post-metadata">
					<div class="post-num">Post #24</div>
					<div class="post-author">apple4ever</div>
					<div class="post-datetime">
						21 Apr 2012, 22:06					</div>
				</div>
				<div class="post-content content">
					<p>Just to clarify- I did just switch in my old router, and that works to port forward 9090. So its definitely something with my config.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p165373">
				<div class="post-metadata">
					<div class="post-num">Post #25</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						21 Apr 2012, 22:13					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>apple4ever wrote:</cite><blockquote><div class="codebox"><pre><code>config rule
config redirect
    option target &#039;DNAT&#039;
    option src &#039;wan&#039;
    option dest &#039;lan&#039;
    option proto &#039;tcp udp&#039;
    option src_dport &#039;9090&#039;
    option dest_ip &#039;192.168.0.52&#039;
    option dest_port &#039;9090&#039;
    option name &#039;SecuritySpu&#039;
    option src_port &#039;9090&#039;</code></pre></div></blockquote></div><p>That last option src_port &#039;9090&#039; looks to me that you are requiring that the traffic to be forwarded also <strong>originates from port 9090</strong> on the originating computer. That is probably not your intention. You might try removing that requirement.<br />(Ps. jow mentioned that already in #12 ...)</p><p>The &#039;tcpudp&#039; is usually written together. You have a space there. I am not sure if that works.</p><p><a href="http://wiki.openwrt.org/doc/uci/firewall#redirects">http://wiki.openwrt.org/doc/uci/firewall#redirects</a></p><p>You don&#039;t need to specify the forwarded port twice, if it stays the same in the forwarding.<br />An example of a working redirect from my /etc/config/firewall:<br /></p><div class="codebox"><pre><code>config &#039;redirect&#039;
        option &#039;_name&#039; &#039;someRule&#039;
        option &#039;src&#039; &#039;wan&#039;
        option &#039;proto&#039; &#039;tcpudp&#039;
        option &#039;src_dport&#039; &#039;17706&#039;
        option &#039;dest_ip&#039; &#039;192.168.1.188&#039;
        option &#039;target&#039; &#039;DNAT&#039;
        option &#039;dest&#039; &#039;lan&#039;</code></pre></div>											<p class="post-edited">(Last edited by <strong>hnyman</strong> on 21 Apr 2012, 22:24)</p>
									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 1 of 2</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=36055&amp;p=2.html">2</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>