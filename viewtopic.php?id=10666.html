<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Asterisk and Music-on-hold</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 29 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p48090">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">vinx</div>
					<div class="post-datetime">
						9 May 2007, 13:36					</div>
				</div>
				<div class="post-content content">
					<p>Hello,<br />I have installed Asterisk 1.2 in Asus Wl-500G Premium and everything work fine except music-on-hold.</p><p>I put an MP3 file in /usr/lib/asterisk/mohmp3 </p><p>this is my musiconhold.conf:</p><p>[default]<br />mode=quietmp3<br />directory=/usr/lib/asterisk/mohmp3</p><p>When I try to test the service I get:</p><p>May&nbsp; 9 11:58:19 NOTICE[10967] res_musiconhold.c: Request to schedule in the past?!?!</p><p>I read here:</p><p><a href="http://www.voip-info.org/wiki/view/Asterisk+timer">http://www.voip-info.org/wiki/view/Asterisk+timer</a></p><p>that the problem could be related to timing, so I installed &quot;dummy zaptel timer support&quot; reported in this topic:</p><p><a href="http://forum.openwrt.org/viewtopic.php?id=8198">http://forum.openwrt.org/viewtopic.php?id=8198</a></p><p>but the problem still persist and I&#039;m getting crazy.</p><p>Anyone can help?</p>											<p class="post-edited">(Last edited by <strong>vinx</strong> on 9 May 2007, 13:37)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p48099">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">zandbelt</div>
					<div class="post-datetime">
						9 May 2007, 15:21					</div>
				</div>
				<div class="post-content content">
					<p>Don&#039;t worry too much about it; try to solve it by implementing some of the suggestions in the following text:</p><p>&nbsp; <a href="http://www.asteriskguru.com/tutorials/request_schedule_past.html">http://www.asteriskguru.com/tutorials/r â€¦ _past.html</a></p><p>As you can see there, your box doesn&#039;t quite meet the hardware advise for Asterisk; stuff like this can always happen.<br />Also: I would advise to upgrade to 1.4.x (better support; future proof) unless you can give a reason why this is impossible.</p><p>Hans.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p48100">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">vinx</div>
					<div class="post-datetime">
						9 May 2007, 15:27					</div>
				</div>
				<div class="post-content content">
					<p>I already read that document, off course without success...</p><p>This is the situation:</p><p>I was running asterisk 1.0 on my old wrt54g v1, then I moved on an Asus WL-500Gp and I upgraded to ver. 1.4 but I wasn&#039;t able to let it work, so I downgraded to ver 1.2 and everything work fine except th music-on-hold, I know this is not so important but......</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p48104">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">baba2s</div>
					<div class="post-datetime">
						9 May 2007, 16:17					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>vinx wrote:</cite><blockquote><p>Hello,<br />I have installed Asterisk 1.2 in Asus Wl-500G Premium and everything work fine except music-on-hold.</p><p>I put an MP3 file in /usr/lib/asterisk/mohmp3 </p><p>this is my musiconhold.conf:</p><p>[default]<br />mode=quietmp3<br />directory=/usr/lib/asterisk/mohmp3</p><p>When I try to test the service I get:</p><p>May&nbsp; 9 11:58:19 NOTICE[10967] res_musiconhold.c: Request to schedule in the past?!?!</p><p>I read here:</p><p><a href="http://www.voip-info.org/wiki/view/Asterisk+timer">http://www.voip-info.org/wiki/view/Asterisk+timer</a></p><p>that the problem could be related to timing, so I installed &quot;dummy zaptel timer support&quot; reported in this topic:</p><p><a href="http://forum.openwrt.org/viewtopic.php?id=8198">http://forum.openwrt.org/viewtopic.php?id=8198</a></p><p>but the problem still persist and I&#039;m getting crazy.</p><p>Anyone can help?</p></blockquote></div><p>Do you have quietmp3 player application installed?&nbsp; Better don&#039;t go for it , use the native files&nbsp; mode<br />Take the backup of your musiconhold.conf and have only following... Thanks</p><p>[default]&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />mode=files&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />directory=/usr/lib/asterisk/mohmp3</p><p>[native]&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />mode=files&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />directory=/usr/lib/asterisk/mohmp3</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p48105">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">vinx</div>
					<div class="post-datetime">
						9 May 2007, 16:29					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>baba2s wrote:</cite><blockquote><p>Do you have quietmp3 player application installed?&nbsp; Better don&#039;t go for it , use the native files&nbsp; mode<br />Take the backup of your musiconhold.conf and have only following... Thanks</p><p>[default]&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />mode=files&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />directory=/usr/lib/asterisk/mohmp3</p><p>[native]&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />mode=files&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />directory=/usr/lib/asterisk/mohmp3</p></blockquote></div><p>Already tried, dosn&#039;t work. </p><p>what kind of music files are needed for native mode?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p48123">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">zandbelt</div>
					<div class="post-datetime">
						9 May 2007, 22:17					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>vinx wrote:</cite><blockquote><p>I was running asterisk 1.0 on my old wrt54g v1, then I moved on an Asus WL-500Gp and I upgraded to ver. 1.4 but I wasn&#039;t able to let it work,</p></blockquote></div><p>Can you indicate what went wrong for you with 1.4; I know people are running it succesfully on WL-500Gp so you should also be able to.<br />I would rather invest in solutions for 1.4 than for 1.2. Moreover: music-on-hold works just fine for me in 1.4...</p><p>Option 1 (external player for mp3s) :<br /></p><div class="codebox"><pre><code>[default]
mode=custom
directory=/usr/lib/asterisk/mohmp3
application=/usr/bin/madplay -Q -o raw:- --mono -R 8000 -a -12</code></pre></div><p>with mp3 files in &lt;directory&gt; </p><p>Option 2 (convert your audio files according to: <a href="http://astrecipes.net/?n=152)">http://astrecipes.net/?n=152)</a><br /></p><div class="codebox"><pre><code>[default]
mode=files
directory=/usr/lib/asterisk/moh</code></pre></div><p>Put your converted files in /usr/lib/asterisk/moh.<br />Both work just fine, with less CPU load for option 2.</p><p>Hans.</p>											<p class="post-edited">(Last edited by <strong>zandbelt</strong> on 9 May 2007, 22:48)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p48130">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">baba2s</div>
					<div class="post-datetime">
						9 May 2007, 23:36					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>vinx wrote:</cite><blockquote><p>[Already tried, dosn&#039;t work. </p><p>what kind of music files are needed for native mode?</p></blockquote></div><p>As Hans said, your MP3 file may be bad.<br />With above settings its worked for me in 1.2.x and working great in 1.4 on Asus WL-500Gp.</p><p>Thanks</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p48139">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">vinx</div>
					<div class="post-datetime">
						10 May 2007, 10:08					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>zandbelt wrote:</cite><blockquote><p>Can you indicate what went wrong for you with 1.4; I know people are running it succesfully on WL-500Gp so you should also be able to.<br />I would rather invest in solutions for 1.4 than for 1.2. Moreover: music-on-hold works just fine for me in 1.4...</p></blockquote></div><p>I don&#039;t know. I just insted ver. 1.4, copied sip.conf and extension.conf from 1.0 (working) and sip phones doesn&#039;t register, I was unable to register my geographic number with eutelia.</p><p>So I had need phone, so I uninstalled Ver 1.4 and installed ver 1.2 and with the same conf. files all worked lika a charm.</p><p>Probably in ver. 1.4 something has changed in conf. files, but right now I have no time to investigate.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p48140">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">vinx</div>
					<div class="post-datetime">
						10 May 2007, 11:32					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>zandbelt wrote:</cite><blockquote><p>Option 2 (convert your audio files according to: <a href="http://astrecipes.net/?n=152)">http://astrecipes.net/?n=152)</a><br /></p><div class="codebox"><pre><code>[default]
mode=files
directory=/usr/lib/asterisk/moh</code></pre></div><p>Put your converted files in /usr/lib/asterisk/moh.<br />Both work just fine, with less CPU load for option 2.</p></blockquote></div><p>Ok, I did option 2.<br />A strange behaviour happens. I copied tree files in /usr/lib/asterisk/moh respectly in wav, gms, ulaw coding.</p><p>I changed musiconhold.conf with this:</p><div class="codebox"><pre><code>[default]
mode=files
directory=/usr/lib/asterisk/moh</code></pre></div><p>I first reloaded res_musiconhold.so, then restarted asterisk, but still try to locate files in /usr/lib/asterisk/mohmp3 folder:</p><div class="codebox"><pre><code>May 10 10:24:51 WARNING[1331]: file.c:512 ast_openstream_full: File /usr/lib/asterisk/mohmp3/domoo3 does not exist in any format</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p48218">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">vinx</div>
					<div class="post-datetime">
						11 May 2007, 11:35					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>vinx wrote:</cite><blockquote><div class="quotebox"><cite>zandbelt wrote:</cite><blockquote><p>Can you indicate what went wrong for you with 1.4; I know people are running it succesfully on WL-500Gp so you should also be able to.<br />I would rather invest in solutions for 1.4 than for 1.2. Moreover: music-on-hold works just fine for me in 1.4...</p></blockquote></div><p>I don&#039;t know. I just insted ver. 1.4, copied sip.conf and extension.conf from 1.0 (working) and sip phones doesn&#039;t register, I was unable to register my geographic number with eutelia.</p><p>So I had need phone, so I uninstalled Ver 1.4 and installed ver 1.2 and with the same conf. files all worked lika a charm.</p><p>Probably in ver. 1.4 something has changed in conf. files, but right now I have no time to investigate.</p></blockquote></div><p>Is there a way to install asterisk 1.4 on a WRT54G v.1 ?</p><p>Now I have this one as a spare, and I can try to play with it, but the problem is the limited amount of flash (only 4Mb)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p51790">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">zandbelt</div>
					<div class="post-datetime">
						4 Jul 2007, 09:52					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>vinx wrote:</cite><blockquote><p>A strange behaviour happens. I copied tree files in /usr/lib/asterisk/moh respectly in wav, gms, ulaw coding.</p><p>I changed musiconhold.conf with this:</p><div class="codebox"><pre><code>[default]
mode=files
directory=/usr/lib/asterisk/moh</code></pre></div><p>I first reloaded res_musiconhold.so, then restarted asterisk, but still try to locate files in /usr/lib/asterisk/mohmp3 folder:</p><div class="codebox"><pre><code>May 10 10:24:51 WARNING[1331]: file.c:512 ast_openstream_full: File /usr/lib/asterisk/mohmp3/domoo3 does not exist in any format</code></pre></div></blockquote></div><p>You obviously must have a mixup somewhere in your configs (or you&#039;re looking at an old log file); check that you don&#039;t have two asterisk installations that get mixed up</p><p>Hans.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>