<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Archer C7 Network Config - Peer Review</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 5 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p273731">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">warwick666</div>
					<div class="post-datetime">
						24 Apr 2015, 15:14					</div>
				</div>
				<div class="post-content content">
					<p>Hi</p><p>Would someone mind peer reviewing my config please? Make sure i haven&#039;t missed anything major! I&#039;ve had no end of trouble getting it to stick. Using an Archer C7 in preparation for a fibre install, my current router doesn&#039;t have the throughput capability for the new connection, I&#039;ve just followed my nose with this stuff in the past and have no idea if it is setup best practice or not, do I need to set PVIDs?</p><p>Cheers,<br />Chris</p><p>config interface &#039;loopback&#039;<br />&nbsp; &nbsp; option ifname &#039;lo&#039;<br />&nbsp; &nbsp; option proto &#039;static&#039;<br />&nbsp; &nbsp; option ipaddr &#039;127.0.0.1&#039;<br />&nbsp; &nbsp; option netmask &#039;255.0.0.0&#039;</p><p>config interface &#039;lan&#039;<br />&nbsp; &nbsp; option ifname &#039;eth1.1&#039;<br />&nbsp; &nbsp; option force_link &#039;1&#039;<br />&nbsp; &nbsp; option type &#039;bridge&#039;<br />&nbsp; &nbsp; option proto &#039;static&#039;<br />&nbsp; &nbsp; option ipaddr &#039;192.168.1.254&#039;<br />&nbsp; &nbsp; option netmask &#039;255.255.255.0&#039;<br />&nbsp; &nbsp; option ip6assign &#039;60&#039;<br />&nbsp; &nbsp; option delegate &#039;0&#039;<br />&nbsp; &nbsp; option dns &#039;192.168.1.21 192.168.1.20&#039;<br />&nbsp; &nbsp; option gateway &#039;192.168.1.254&#039;</p><p>config interface &#039;DMZIN&#039;<br />&nbsp; &nbsp; option ifname &#039;eth1.4&#039;<br />&nbsp; &nbsp; option proto &#039;static&#039;<br />&nbsp; &nbsp; option ipaddr &#039;192.168.4.254&#039;<br />&nbsp; &nbsp; option netmask &#039;255.255.255.0&#039;<br />&nbsp; &nbsp; option delegate &#039;0&#039;<br />&nbsp; &nbsp; option gateway &#039;192.168.4.254&#039;<br />&nbsp; &nbsp; option dns &#039;192.168.1.21 192.168.1.20&#039;</p><p>config interface &#039;DMZOUT&#039;<br />&nbsp; &nbsp; option ifname &#039;eth1.3&#039;<br />&nbsp; &nbsp; option proto &#039;static&#039;<br />&nbsp; &nbsp; option ipaddr &#039;192.168.3.254&#039;<br />&nbsp; &nbsp; option netmask &#039;255.255.255.0&#039;<br />&nbsp; &nbsp; option delegate &#039;0&#039;<br />&nbsp; &nbsp; option gateway &#039;192.168.3.254&#039;<br />&nbsp; &nbsp; option dns &#039;192.168.1.21 192.168.1.20&#039;</p><p>config interface &#039;DMZDB&#039;<br />&nbsp; &nbsp; option ifname &#039;eth1.5&#039;<br />&nbsp; &nbsp; option proto &#039;static&#039;<br />&nbsp; &nbsp; option ipaddr &#039;192.168.5.254&#039;<br />&nbsp; &nbsp; option netmask &#039;255.255.255.0&#039;<br />&nbsp; &nbsp; option delegate &#039;0&#039;<br />&nbsp; &nbsp; option gateway &#039;192.168.5.254&#039;<br />&nbsp; &nbsp; option dns &#039;192.168.1.21 192.168.1.20&#039;</p><p>config interface &#039;wan&#039;<br />&nbsp; &nbsp; option ifname &#039;eth0&#039;<br />&nbsp; &nbsp; option proto &#039;pppoe&#039;<br />&nbsp; &nbsp; option username &#039;&#039;<br />&nbsp; &nbsp; option password &#039;&#039;</p><p>config interface &#039;wan6&#039;<br />&nbsp; &nbsp; option ifname &#039;@wan&#039;<br />&nbsp; &nbsp; option proto &#039;dhcpv6&#039;</p><p>config switch<br />&nbsp; &nbsp; option name &#039;switch0&#039;<br />&nbsp; &nbsp; option reset &#039;1&#039;<br />&nbsp; &nbsp; option enable_vlan &#039;1&#039;</p><p>config switch_vlan<br />&nbsp; &nbsp; option device &#039;switch0&#039;<br />&nbsp; &nbsp; option vlan &#039;1&#039;<br />&nbsp; &nbsp; option ports &#039;0t 2&#039;<br />&nbsp; &nbsp; option vid &#039;1&#039;</p><p>config switch_vlan<br />&nbsp; &nbsp; option device &#039;switch0&#039;<br />&nbsp; &nbsp; option vlan &#039;3&#039;<br />&nbsp; &nbsp; option ports &#039;0t 3&#039;<br />&nbsp; &nbsp; option vid &#039;3&#039;</p><p>config switch_vlan<br />&nbsp; &nbsp; option device &#039;switch0&#039;<br />&nbsp; &nbsp; option vlan &#039;4&#039;<br />&nbsp; &nbsp; option ports &#039;0t 4&#039;<br />&nbsp; &nbsp; option vid &#039;4&#039;</p><p>config switch_vlan<br />&nbsp; &nbsp; option device &#039;switch0&#039;<br />&nbsp; &nbsp; option vlan &#039;5&#039;<br />&nbsp; &nbsp; option ports &#039;0t 5&#039;<br />&nbsp; &nbsp; option vid &#039;5&#039;</p><p>config switch_vlan<br />&nbsp; &nbsp; option device &#039;switch0&#039;<br />&nbsp; &nbsp; option vlan &#039;2&#039;<br />&nbsp; &nbsp; option ports &#039;1 6&#039;<br />&nbsp; &nbsp; option vid &#039;2&#039;</p>											<p class="post-edited">(Last edited by <strong>warwick666</strong> on 24 Apr 2015, 15:19)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p273735">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">kh_tsang</div>
					<div class="post-datetime">
						24 Apr 2015, 15:24					</div>
				</div>
				<div class="post-content content">
					<p>In using openwrt in my own experience, I do not need PVID. However, it is required in commercial switches, I tried not fixing the PVID and leave it as default(1) and I get trouble afterwards.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p273737">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">kh_tsang</div>
					<div class="post-datetime">
						24 Apr 2015, 15:26					</div>
				</div>
				<div class="post-content content">
					<p>To have better understanding of your setup, I think it is better to draw a map describing what you want.</p>											<p class="post-edited">(Last edited by <strong>kh_tsang</strong> on 24 Apr 2015, 15:28)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p273738">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">warwick666</div>
					<div class="post-datetime">
						24 Apr 2015, 15:32					</div>
				</div>
				<div class="post-content content">
					<p>Ok thanks so you suggest setting the PVIDS? Each port trunks into a single 10Gbe backbone switch, the hosts plug into this also trunked to their own vSwitch.</p><p>I have it drawn up in visio both physical and logical, just trying to set the Archer up the same as the current TP-1043ND</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p273739">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">warwick666</div>
					<div class="post-datetime">
						24 Apr 2015, 15:36					</div>
				</div>
				<div class="post-content content">
					<p>just spotted an error in that config..change WAN config interface to eth0.2, thankfully it didn&#039;t lock me out again after the update <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p273744">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">kh_tsang</div>
					<div class="post-datetime">
						24 Apr 2015, 16:14					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>warwick666 wrote:</cite><blockquote><p>Ok thanks so you suggest setting the PVIDS? Each port trunks into a single 10Gbe backbone switch, the hosts plug into this also trunked to their own vSwitch.</p><p>I have it drawn up in visio both physical and logical, just trying to set the Archer up the same as the current TP-1043ND</p></blockquote></div><p>It is better to set the pvid as well to make the switch knows which vlan should the received untagged packet belong to.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p273788">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">BenFranske</div>
					<div class="post-datetime">
						24 Apr 2015, 18:51					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>warwick666 wrote:</cite><blockquote><p>just spotted an error in that config..change WAN config interface to eth0.2, thankfully it didn&#039;t lock me out again after the update <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p></blockquote></div><p>Actually that is incorrect, you are not tagging VLAN traffic on switch port 6 (eth0) so your WAN should simply be eth0.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p273800">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">warwick666</div>
					<div class="post-datetime">
						24 Apr 2015, 19:40					</div>
				</div>
				<div class="post-content content">
					<p>Ah right ok, both ways seem to work but if you are suggesting it&#039;s more secure then i&#039;ll gladly change it back <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> I left the WAN as default, i&#039;m not really clear on the relationship between it, the other interface, where things are getting tagged along the way in this architecture. The vlan for WAN doesn&#039;t matter at the moment but it will when the fibre gets turned on, so would be good to work it out.</p><p>Maybe someone could advise on firewall rules too?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p273803">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">kh_tsang</div>
					<div class="post-datetime">
						24 Apr 2015, 19:58					</div>
				</div>
				<div class="post-content content">
					<p>Since you are just changing the wan, I think using your old firewall rules would be enough unless you get performance issues. Make sure the network adapters are matched correctly to the firewall zones.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>