<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> NuCom R5010UN ADSL router</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 4 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p269382">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">suso</div>
					<div class="post-datetime">
						20 Mar 2015, 19:29					</div>
				</div>
				<div class="post-content content">
					<h5>NuCom R5010UN ADSL router</h5><p><span class="postimg"><img src="http://www.jazztel.com/jazztelMedia/mediaWeb/escaparate/320x342_NUCOM_R5010un.jpg" alt="NuCom R5010UN Jazztel" /></span></p><p><strong><span class="bbu">Hardware</span></strong><br />SoC: bcm6328<br />cpu model: Broadcom4350 V7.5<br />Chip ID: BCM6328B0, MIPS: 320MHz, DDR: 320MHz, Bus: 160MHz<br />flash size: 16 MB<br />RAM: 64 MB<br />WLAN: Broadcom BCM43217 2x2 802.11b/g/n transceiver<br />4 x ethernet<br />1 x USB host</p><p><span class="postimg"><img src="http://uip.nl.eu.org/R5010UN/R5010UN_NuCom_inside.JPG" alt="NuCom R5010UN inside" /></span></p><p><strong><span class="bbu">Serial port</span></strong><br />The serial port is available through header J6 which is in the lower left corner of the previous picture.<br />More detail and with the signal names below:</p><p><span class="postimg"><img src="http://uip.nl.eu.org/R5010UN/R5010UN_NuCom_serial.JPG" alt="NuCom R5010UN serial" /></span></p><p><strong><span class="bbu">OEM bootlog</span></strong></p><div class="codebox"><pre><code>HELO
CPUI
L1CI
DRAM
----
PHYS
ZQDN
PHYE
DINT
LSYN
USYN
MSYN
LMBE
PASS
----
ZBSS
CODE
DATA
L12F
MAIN


CFE version 1.0.37-106.5 for BCM96328 (32bit,SP,BE)
Build Date: 2013年 09月 09日 星期一 12:55:22 HKT (root@s54)
Copyright (C) 2000-2009 Broadcom Corporation.

clock=40000000
flash=S25FL128 size=16MB id=0x12018  sector=64k

HS Serial flash device: name S25FL128, id 0x12018 size 16384KB
Total Flash size: 16384K with 256 sectors
Chip ID: BCM6328B0, MIPS: 320MHz, DDR: 320MHz, Bus: 160MHz
Main Thread: TP0
Memory Test Passed
Total Memory: 67108864 bytes (64MB)
Boot Address: 0xb8000000


Board IP address                  : 192.168.1.1:ffffff00  
Host IP address                   : 192.168.1.100  
Gateway IP address                :   
Run from flash/host (f/h)         : f  
Default host run file name        : vmlinux  
Default host flash file name      : bcm963xx_fs_kernel  
Boot delay (0-9 seconds)          : 1  
Board Id (0-2)                    : 96328ang  
Number of MAC Addresses (1-32)    : 11  
Base MAC Address                  : fa:ba:da:fa:ba:da  
PSI Size (1-64) KBytes            : 32  
Enable Backup PSI [0|1]           : 1  
System Log Size (0-256) KBytes    : 0  
Main Thread Number [0|1]          : 0  

send udp message finished.
Not response, auto boot ...

Linux version 2.6.30 (root@s54) (gcc version 4.4.2 (Buildroot 2010.02-git) ) #2 Mon Sep 9 14:09:37 HKT 2013
clock=40000000
flash=S25FL128 size=16MB id=0x12018  sector=64k

HS Serial flash device: name S25FL128, id 0x12018 size 16384KB
96328ang prom init
CPU revision is: 0002a075 (Broadcom4350)
Determined physical RAM map:
 memory: 03f00000 @ 00000000 (usable)
Zone PFN ranges:
  DMA      0x00000000 -&gt; 0x00001000
  Normal   0x00001000 -&gt; 0x00003f00
Movable zone start PFN for each node
early_node_map[1] active PFN ranges
    0: 0x00000000 -&gt; 0x00003f00
On node 0 totalpages: 16128
free_area_init_node: node 0, pgdat 80331ac0, node_mem_map 81000000
  DMA zone: 32 pages used for memmap
  DMA zone: 0 pages reserved
  DMA zone: 4064 pages, LIFO batch:0
  Normal zone: 94 pages used for memmap
  Normal zone: 11938 pages, LIFO batch:1
Built 1 zonelists in Zone order, mobility grouping on.  Total pages: 16002
Kernel command line: root=31:0 ro noinitrd console=ttyS0,115200
wait instruction: enabled
Primary instruction cache 32kB, VIPT, 4-way, linesize 16 bytes.
Primary data cache 32kB, 2-way, VIPT, cache aliases, linesize 16 bytes
RCU-based detection of stalled CPUs is enabled.
NR_IRQS:128
PID hash table entries: 256 (order: 8, 1024 bytes)
console [ttyS0] enabled
Dentry cache hash table entries: 8192 (order: 3, 32768 bytes)
Inode-cache hash table entries: 4096 (order: 2, 16384 bytes)
Memory: 60300k/64512k available (2762k kernel code, 4192k reserved, 451k data, 128k init, 0k highmem)
Calibrating delay loop... 319.48 BogoMIPS (lpj=159744)
Mount-cache hash table entries: 512
net_namespace: 760 bytes
NET: Registered protocol family 16
Total Flash size: 16384K with 256 sectors
registering PCI controller with io_map_base unset
registering PCI controller with io_map_base unset
bio: create slab &lt;bio-0&gt; at 0
SCSI subsystem initialized
usbcore: registered new interface driver usbfs
usbcore: registered new interface driver hub
usbcore: registered new device driver usb
pci 0000:00:09.0: reg 10 32bit mmio: [0x10002600-0x100026ff]
pci 0000:00:0a.0: reg 10 32bit mmio: [0x10002500-0x100025ff]
pci 0000:01:00.0: PME# supported from D0 D3hot
pci 0000:01:00.0: PME# disabled
pci 0000:02:00.0: reg 10 64bit mmio: [0x000000-0x007fff]
pci 0000:02:00.0: supports D1 D2
pci 0000:01:00.0: PCI bridge, secondary bus 0000:02
pci 0000:01:00.0:   IO window: disabled
pci 0000:01:00.0:   MEM window: 0x10f00000-0x10ffffff
pci 0000:01:00.0:   PREFETCH window: disabled
PCI: Enabling device 0000:01:00.0 (0000 -&gt; 0002)
PCI: Setting latency timer of device 0000:01:00.0 to 64
BLOG v3.0 Initialized
NET: Registered protocol family 8
NET: Registered protocol family 20
NET: Registered protocol family 2
IP route cache hash table entries: 1024 (order: 0, 4096 bytes)
TCP established hash table entries: 2048 (order: 2, 16384 bytes)
TCP bind hash table entries: 2048 (order: 1, 8192 bytes)
TCP: Hash tables configured (established 2048 bind 2048)
TCP reno registered
NET: Registered protocol family 1
squashfs: version 4.0 (2009/01/31) Phillip Lougher
squashfs: version 4.0 with LZMA457 ported by BRCM
fuse init (API version 7.11)
msgmni has been set to 117
io scheduler noop registered (default)
pcieport-driver 0000:01:00.0: device [14e4:6328] has invalid IRQ; check vendor BIOS
PCI: Setting latency timer of device 0000:01:00.0 to 64
Driver &#039;sd&#039; needs updating - please use bus_type methods
PPP generic driver version 2.4.2
PPP Deflate Compression module registered
PPP BSD Compression module registered
NET: Registered protocol family 24
bcm963xx_mtd driver v1.0
File system address: 0xb8010100
ehci_hcd: USB 2.0 &#039;Enhanced&#039; Host Controller (EHCI) Driver
PCI: Enabling device 0000:00:0a.0 (0000 -&gt; 0002)
PCI: Setting latency timer of device 0000:00:0a.0 to 64
ehci_hcd 0000:00:0a.0: EHCI Host Controller
ehci_hcd 0000:00:0a.0: new USB bus registered, assigned bus number 1
ehci_hcd 0000:00:0a.0: Enabling legacy PCI PM
ehci_hcd 0000:00:0a.0: irq 50, io mem 0x10002500
ehci_hcd 0000:00:0a.0: USB f.f started, EHCI 1.00
usb usb1: configuration #1 chosen from 1 choice
hub 1-0:1.0: USB hub found
hub 1-0:1.0: 1 port detected
ohci_hcd: USB 1.1 &#039;Open&#039; Host Controller (OHCI) Driver
PCI: Enabling device 0000:00:09.0 (0000 -&gt; 0002)
PCI: Setting latency timer of device 0000:00:09.0 to 64
ohci_hcd 0000:00:09.0: OHCI Host Controller
ohci_hcd 0000:00:09.0: new USB bus registered, assigned bus number 2
ohci_hcd 0000:00:09.0: irq 49, io mem 0x10002600
usb usb2: configuration #1 chosen from 1 choice
hub 2-0:1.0: USB hub found
hub 2-0:1.0: 1 port detected
usbcore: registered new interface driver usblp
Initializing USB Mass Storage driver...
usbcore: registered new interface driver usb-storage
USB Mass Storage support registered.
brcmboard: brcm_board_init entry
SES: LED GPIO 0x800a is enabled
Serial: BCM63XX driver $Revision: 3.00 $
ttyS0 at MMIO 0xb0000100 (irq = 36) is a BCM63XX
ttyS1 at MMIO 0xb0000120 (irq = 36) is a BCM63XX
bcmxtmrt: Broadcom BCM6328B0 ATM/PTM Network Device v0.3 Sep  9 2013 12:40:50
bcmxtmcfg: bcmxtmcfg_init entry
adsl: adsl_init entry
Broadcom BCM6328B0 Ethernet Network Device v0.1 Sep  9 2013 12:39:05
ETH Init: 180 tx BDs at 0xa391d000
ETH Init: 400 rx BDs at 0xa3938000
ETH Init: 400 rx BDs at 0xa393a000
dgasp: kerSysRegisterDyingGaspHandler: bcmsw registered 
eth0: MAC Address: FA:BA:DA:FA:BA:DA
eth1: MAC Address: FA:BA:DA:FA:BA:DA
eth2: MAC Address: FA:BA:DA:FA:BA:DA
eth3: MAC Address: FA:BA:DA:FA:BA:DA
Broadcom Logger v0.1 Sep  9 2013 12:38:58
Broadcom 802.1Q VLAN Interface, v0.1
Mirror/redirect action on
u32 classifier
    input device check on 
    Actions configured 
TCP cubic registered
NET: Registered protocol family 10
ADDRCONF(NETDEV_UP): bcmsw: link is not ready
IPv6 over IPv4 tunneling driver
NET: Registered protocol family 17
Initializing MCPD Module
Ebtables v2.0 registered
ebt_time registered
ebt_ftos registered
ebt_wmm_mark registered
VFS: Mounted root (squashfs filesystem) readonly on device 31:0.
Freeing unused kernel memory: 128k freed
pktflow: module license &#039;Proprietary&#039; taints kernel.
Disabling lock debugging due to kernel taint
Initialized fcache state
Broadcom Packet Flow Cache  Char Driver v2.2 Nov 16 2010 15:04:32 Registered&lt;242&gt;
Created Proc FS /procfs/fcache
Broadcom Packet Flow Cache registered with netdev chain
Broadcom Packet Flow Cache learning via BLOG enabled.
Constructed Broadcom Packet Flow Cache v2.2 Nov 16 2010 15:04:32
wl: high_wmark_tot=400
PCI: Enabling device 0000:02:00.0 (0000 -&gt; 0002)
PCI: Setting latency timer of device 0000:02:00.0 to 64
wl: napimode=1
wl0: allocskbmode=1 currallocskbsz=256
otp_read_pci: bad crc
Neither SPROM nor OTP has valid image
wl:srom/otp not programmed, using main memory mapped srom info(wombo board)
wl:loading /etc/wlan/bcm43227_vars.bin
Failed to open srom image from &#039;/etc/wlan/bcm43227_vars.bin&#039;.
wl:loading /etc/wlan/bcm43227_map.bin
wl0: Broadcom BCMa8db 802.11 Wireless Controller 5.100.138.2001.cpe4.406.3
dgasp: kerSysRegisterDyingGaspHandler: wl0 registered 
unprotect_e253protect.&lt;6&gt;ip_tables: (C) 2000-2006 Netfilter Core Team
Netfilter messages via NETLINK v0.30.
nf_conntrack version 0.5.0 (1008 buckets, 4032 max)
device eth0 entered promiscuous mode
ADDRCONF(NETDEV_UP): eth0: link is not ready
device eth1 entered promiscuous mode
ADDRCONF(NETDEV_UP): eth1: link is not ready
device eth2 entered promiscuous mode
ADDRCONF(NETDEV_UP): eth2: link is not ready
device eth3 entered promiscuous mode
ADDRCONF(NETDEV_UP): eth3: link is not ready
BcmAdsl_Initialize=0x801A6BF4, g_pFnNotifyCallback=0x80329CF4
pSdramPHY=0xA3FFFFF8, 0x1002000 0x60800000
*** XfaceOffset: 0x21F90 =&gt; 0x21F90 ***
*** PhySdramSize got adjusted: 0x8339C =&gt; 0x98D48 ***
AdslCoreSharedMemInit: shareMemAvailable=422544
AdslCoreHwReset:  pLocSbSta=83160000 bkupThreshold=1600
AdslCoreHwReset:  AdslOemDataAddr = 0xA3F783D4
dgasp: kerSysRegisterDyingGaspHandler: dsl0 registered 
XTM Init: 400 rx BDs at 0xa3108000
XTM Init: 100 rx BDs at 0xa32c9000
###reset_nf_conntrack_net_ops;540;###
###reset_nf_conntrack_net_ops;540;###
###reset_nf_conntrack_net_ops;540;###
monitor task is initialized pid= 228 
br0: port 1(eth0) entering disabled state
br0: port 2(eth1) entering disabled state
br0: port 3(eth2) entering disabled state
br0: port 4(eth3) entering disabled state
unprotect_e254protect.&lt;2&gt;eth3 Link UP 100 mbps full duplex
br0: port 4(eth3) entering forwarding state
device wl0 entered promiscuous mode
device wl0.1 entered promiscuous mode
device wl0.2 entered promiscuous mode
device wl0.3 entered promiscuous mode
br0: port 5(wl0) entering forwarding state
  clear g_wps_status
eth3 Link DOWN.
br0: port 4(eth3) entering disabled state
br0: port 4(eth3) entering disabled state
eth3 Link UP 100 mbps full duplex
br0: port 4(eth3) entering forwarding state
dhcpd uses obsolete (PF_INET,SOCK_PACKET)</code></pre></div><p><strong><span class="bbu">Flashing procedure</span></strong><br />Connect header J6 to the serial port of the PC through appropriate level shifter because of router&#039;s 3.3V circuitry.<br />Connect one of the four ethernet ports of the router to the PC using a LAN cable.</p><p>If you use Ubuntu:<br />sudo apt-get install gtkterm</p><p>With a USB to serial dongle:<br />sudo gtkterm -p /dev/ttyUSB0 -s 115200 &amp;</p><p>Flashing ANY Firmware<br /> You must set your TCP/IP v4 protocol to:<br />&nbsp; &nbsp; IP: 192.168.1.2<br />&nbsp; &nbsp; Netmask: 255.255.255.0<br />&nbsp; &nbsp; Gateway: 192.168.1.1<br />&nbsp; &nbsp; DNS: (optional, can be blank).<br /> Then:<br />&nbsp; &nbsp; Power off the router.<br />&nbsp; &nbsp; Press reset button near the antenna.<br />&nbsp; &nbsp; Keep it pressed while powering up during ~20+ seconds.<br />&nbsp; &nbsp; Access to <a href="http://192.168.1.1">http://192.168.1.1</a> and upload binary file.<br />&nbsp; &nbsp; Wait until router reboots.</p><p>Alternatively send any key to the console at power up or reset. CFE will detect the key and stop before booting the image. You can then use a web browser to upload a new image.</p><p><strong><span class="bbu">Status</span></strong><br />I tried openwrt-AR-5387un-squashfs-cfe.bin as their hardware look similar (to me). However, after flashing this is output to the serial port:</p><div class="codebox"><pre><code>HELO
CPUI
L1CI
DRAM
----
PHYS
ZQDN
PHYE
DINT
LSYN
USYN
MSYN
LMBE
PASS
----
ZBSS
CODE
DATA
L12F
MAIN


CFE version 1.0.37-106.5 for BCM96328 (32bit,SP,BE)
Build Date: 2013å¹Ž 09æ 09æ¥ ææäž 12:55:22 HKT (root@s54)
Copyright (C) 2000-2009 Broadcom Corporation.

clock=40000000
flash=S25FL128 size=16MB id=0x12018  sector=64k

HS Serial flash device: name S25FL128, id 0x12018 size 16384KB
Total Flash size: 16384K with 256 sectors
Chip ID: BCM6328B0, MIPS: 320MHz, DDR: 320MHz, Bus: 160MHz
Main Thread: TP0
Memory Test Passed
Total Memory: 67108864 bytes (64MB)
Boot Address: 0xb8000000


Board IP address                  : 192.168.1.1:ffffff00  
Host IP address                   : 192.168.1.100  
Gateway IP address                :   
Run from flash/host (f/h)         : f  
Default host run file name        : vmlinux  
Default host flash file name      : bcm963xx_fs_kernel  
Boot delay (0-9 seconds)          : 1  
Board Id (0-2)                    : 96328ang  
Number of MAC Addresses (1-32)    : 11  
Base MAC Address                  : fa:ba:da:fa:ba:da
PSI Size (1-64) KBytes            : 32  
Enable Backup PSI [0|1]           : 1  
System Log Size (0-256) KBytes    : 0  
Main Thread Number [0|1]          : 0  

send udp message finished.
Not response, auto boot ...
*** Press any key to stop auto run (1 seconds) ***
Auto run second count down: 110
Booting from only image (0xb8010000) ...
Code Address: 0x80010000, Entry Address: 0x80010000
LZMA: Prossible old LZMA format, trying to decompress..
Decompression OK!
Entry at 0x80010000
Closing network.
Disabling Switch ports.
Flushing Receive Buffers...
0 buffers found.
Closing DMA Channels.
Starting program at 0x80010000
[    0.000000] Linux version 3.10.49 (bb@builder1) (gcc version 4.8.3 (OpenWrt/Linaro GCC 4.8-2014.04 r42625) ) #3 Wed Oct 1 15:07:11 CEST 2014
[    0.000000] Detected Broadcom 0x6328 CPU revision b0
[    0.000000] CPU frequency is 320 MHz
[    0.000000] 64MB of RAM installed
[    0.000000] registering 32 GPIOs
[    0.000000] board_bcm963xx: Boot address 0xb8000000
[    0.000000] board_bcm963xx: CFE version: unknown
[    0.000000] bcm63xx_nvram: nvram checksum failed, contents may be invalid (expected ffc8dd2f, got a69c1bd6)
[    0.000000] board_bcm963xx: unknown bcm963xx board: ÿ963ÿ8anÿ
[    0.000000] bootconsole [early0] enabled
[    0.000000] CPU revision is: 0002a075 (Broadcom BMIPS4350)
[    0.000000] Kernel panic - not syncing: unable to detect bcm963xx board</code></pre></div><p>There is definitely a problem with the board code to start with, but I wouldn&#039;t even know how to solve that. Building a new image? Is this router supported by Openwrt?</p><p>I successfully built images for several different devices but always following the instructions, if you know what I mean <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" />. Should I try to patch the board code in nvram? How do I do that?</p><p>Any contribution is appreciated!</p>											<p class="post-edited">(Last edited by <strong>suso</strong> on 20 Mar 2015, 20:00)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p269420">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">danitool</div>
					<div class="post-datetime">
						20 Mar 2015, 23:14					</div>
				</div>
				<div class="post-content content">
					<p>This is another boring BCM6328. As you can see all of these boards are pretty similar</p><p><a href="http://wiki.openwrt.org/tag/bcm6328?do=showtag&amp;tag=bcm6328">http://wiki.openwrt.org/tag/bcm6328?do= … ag=bcm6328</a></p><p>It&#039;s easy to add support, probably only adding your board ID <strong>96328ang</strong> to the kernel code will let you to boot OpenWrt. Changing the board ID, to one already supported by OpenWrt, at the CFE bootloader may also work, but first you should understand the risks of doing this.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p276501">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">suso</div>
					<div class="post-datetime">
						16 May 2015, 20:28					</div>
				</div>
				<div class="post-content content">
					<p>It may be another BCM6328, it&#039;s certainly not boring. On the contrary, it is driving me mad.</p><p>I found out that CFE allowed me to choose from three predefined board IDs. I change it from 96328ang to 96328avng. In this way I didn&#039;t have to add a new device as described here:</p><p><a href="http://wiki.openwrt.org/doc/devel/add.new.device">http://wiki.openwrt.org/doc/devel/add.new.device</a></p><p>Now I flashed a ready made generic 96328avng firmware I had downloaded from openwrt.org. First I tried:</p><p>openwrt-96328avng-16M-flash-generic-squashfs-cfe.bin</p><p>as I was sure the device had 16MB flash. No go. Then I tried both</p><p>openwrt-96328avng-4M-flash-generic-squashfs-cfe.bin</p><p>and</p><p>openwrt-96328avng-8M-flash-generic-squashfs-cfe.bin</p><p>just in case, but with the same result. To my surprise the problem is that during boot the board ID is read incorrectly. I dumped the output:</p><p>FF 39 36 33 FF 38 61 76 FF 67 0D 0A</p><p>which corresponds to &quot;.963.8av.&quot; where &#039;.&#039; stands for hex FF! In other words, every four bytes a hex FF is read. The same occurs in the log output in my first post above. The hex FF bytes are displayed as &#039;ÿ&#039; here:</p><div class="codebox"><pre><code>[    0.000000] board_bcm963xx: unknown bcm963xx board: ÿ963ÿ8anÿ</code></pre></div><p>The question is: why? The firmware should read the ID from nvram, right? Where is it exactly, at what address? How can I check it there? Can it be corrupt? I tried a few firmwares. Some of them may have little to do with this router. Can that damage the contents of the nvram?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p276507">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">danitool</div>
					<div class="post-datetime">
						16 May 2015, 22:56					</div>
				</div>
				<div class="post-content content">
					<p>This doesn&#039;t look good<br /></p><div class="codebox"><pre><code> bcm63xx_nvram: nvram checksum failed, contents may be invalid (expected ffc8dd2f, got a69c1bd6)</code></pre></div><p>No idea if nvram is corrupted, the nvram checksum should be located at offset 0x97C ( check <a href="http://wiki.openwrt.org/doc/techref/bootloader/cfe#cfe_header">http://wiki.openwrt.org/doc/techref/boo … cfe_header</a> ). To check what&#039;s going on you may need a backup of the bootloader. It can be done either using cfetool or else using an Openwrt RAM version firmware.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p277007">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">suso</div>
					<div class="post-datetime">
						21 May 2015, 14:28					</div>
				</div>
				<div class="post-content content">
					<p>I erased nvram from CFE. It asked for the parameters to write to nvram like board ID and MAC address, so that should be OK now. But... nothing changed. The boot still stops after nvram checksum failed and unknown bcm963xx board.</p><p>I tried to dump nvram contents but I can&#039;t find it. Issuing </p><div class="codebox"><pre><code>dm 80001000 1000</code></pre></div><p> seems to dump the start of the firmware, but where is nvram? What is the base address?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p277046">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">danitool</div>
					<div class="post-datetime">
						21 May 2015, 17:02					</div>
				</div>
				<div class="post-content content">
					<p>The base address should be 0xb8000000.</p><p>I built a RAM firmware with the Board ID forced to be 96328avng</p><p><a href="https://drive.google.com/file/d/0B-EMoBe-_OdBbWtJb1RhMjJSRmc/view?usp=sharing">https://drive.google.com/file/d/0B-EMoB … sp=sharing</a></p><p>For loading this RAM firmware you must set a static IP on your computer (i.e 192.168.1.35), install a TFTP server, put the file openwrt-brcm6328-ramfs.elf in the server&#039;s directory, and then execute this command in CFE:</p><div class="codebox"><pre><code>r 192.168.1.35:openwrt-brcm6328-ramfs.elf</code></pre></div><p>Let me know if it boots successfully.</p>											<p class="post-edited">(Last edited by <strong>danitool</strong> on 21 May 2015, 17:05)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p277192">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">suso</div>
					<div class="post-datetime">
						22 May 2015, 14:48					</div>
				</div>
				<div class="post-content content">
					<p>WOW! Did it boot?</p><div class="codebox"><pre><code>r 192.168.1.35:openwrt-brcm6328-ramfs.elf
0x80010000/3822916 0x803b5544/227736 Entry at 0x80014d10
Closing network.
Disabling Switch ports.
Flushing Receive Buffers...
0 buffers found.
Closing DMA Channels.
Starting program at 0x80014d10
[    0.000000] Linux version 3.10.49 (dani@tool) (gcc version 4.8.3 (OpenWrt/Linaro GCC 4.8-2014.04 r44365) ) #10 Thu May 21 15:33:16 CEST 2015
[    0.000000] Detected Broadcom 0x6328 CPU revision b0
[    0.000000] CPU frequency is 320 MHz
[    0.000000] 64MB of RAM installed
[    0.000000] registering 32 GPIOs
[    0.000000] board_bcm963xx: Boot address 0xb8000000
[    0.000000] board_bcm963xx: CFE version: unknown
[    0.000000] bcm63xx_nvram: nvram checksum failed, contents may be invalid (expected ff91aa22, got a4c9ce98)
[    0.000000] bootconsole [early0] enabled
[    0.000000] CPU revision is: 0002a075 (Broadcom BMIPS4350)
[    0.000000] board: board name: 96328avng
[    0.000000] Determined physical RAM map:
[    0.000000]  memory: 04000000 @ 00000000 (usable)
[    0.000000] Initrd not found or empty - disabling initrd
[    0.000000] Zone ranges:
[    0.000000]   Normal   [mem 0x00000000-0x03ffffff]
[    0.000000] Movable zone start for each node
[    0.000000] Early memory node ranges
[    0.000000]   node   0: [mem 0x00000000-0x03ffffff]
[    0.000000] Primary instruction cache 32kB, VIPT, 4-way, linesize 16 bytes.
[    0.000000] Primary data cache 32kB, 2-way, VIPT, cache aliases, linesize 16 bytes
[    0.000000] Built 1 zonelists in Zone order, mobility grouping on.  Total pages: 16256
[    0.000000] Kernel command line:  root=/dev/mtdblock2 rootfstype=squashfs,jffs2 noinitrd console=ttyS0,115200
[    0.000000] PID hash table entries: 256 (order: -2, 1024 bytes)
[    0.000000] Dentry cache hash table entries: 8192 (order: 3, 32768 bytes)
[    0.000000] Inode-cache hash table entries: 4096 (order: 2, 16384 bytes)
[    0.000000] Memory: 60892k/65536k available (2283k kernel code, 4644k reserved, 596k data, 892k init, 0k highmem)
[    0.000000] NR_IRQS:256
[    0.000000] Calibrating delay loop... 318.46 BogoMIPS (lpj=636928)
[    0.036000] pid_max: default: 32768 minimum: 301
[    0.040000] Mount-cache hash table entries: 512
[    0.048000] NET: Registered protocol family 16
[    0.284000] registering PCI controller with io_map_base unset
[    0.296000] bio: create slab &lt;bio-0&gt; at 0
[    0.300000] PCI host bridge to bus 0000:00
[    0.304000] pci_bus 0000:00: root bus resource [mem 0x10f00000-0x10ffffff]
[    0.308000] pci_bus 0000:00: root bus resource [??? 0x00000000 flags 0x0]
[    0.312000] pci_bus 0000:00: No busn resource found for root bus, will use [bus 00-ff]
[    0.316000] pci 0000:00:00.0: bridge configuration invalid ([bus 00-00]), reconfiguring
[    0.320000] pci 0000:00:00.0: BAR 8: assigned [mem 0x10f00000-0x10ffffff]
[    0.324000] pci 0000:01:00.0: BAR 0: assigned [mem 0x10f00000-0x10f07fff 64bit]
[    0.328000] pci 0000:00:00.0: PCI bridge to [bus 01]
[    0.332000] pci 0000:00:00.0:   bridge window [mem 0x10f00000-0x10ffffff]
[    0.336000] PCI: Enabling device 0000:00:00.0 (0000 -&gt; 0002)
[    0.340000] Switching to clocksource MIPS
[    0.348000] NET: Registered protocol family 2
[    0.356000] TCP established hash table entries: 512 (order: 0, 4096 bytes)
[    0.360000] TCP bind hash table entries: 512 (order: -1, 2048 bytes)
[    0.368000] TCP: Hash tables configured (established 512 bind 512)
[    0.376000] TCP: reno registered
[    0.380000] UDP hash table entries: 256 (order: 0, 4096 bytes)
[    0.384000] UDP-Lite hash table entries: 256 (order: 0, 4096 bytes)
[    0.392000] NET: Registered protocol family 1
[    1.776000] squashfs: version 4.0 (2009/01/31) Phillip Lougher
[    1.784000] jffs2: version 2.2 (NAND) (SUMMARY) (LZMA) (RTIME) (CMODE_PRIORITY) (c) 2001-2006 Red Hat, Inc.
[    1.792000] msgmni has been set to 118
[    1.796000] io scheduler noop registered
[    1.800000] io scheduler deadline registered (default)
[    1.808000] bcm63xx_uart.0: ttyS0 at MMIO 0xb0000100 (irq = 36) is a bcm63xx_uart
[    1.816000] console [ttyS0] enabled, bootconsole disabled
[    1.816000] console [ttyS0] enabled, bootconsole disabled
[    1.836000] m25p80 spi1.0: found s25fl129p1, expected m25p80
[    1.840000] m25p80 spi1.0: s25fl129p1 (16384 Kbytes)
[    1.844000] bcm63xxpart: CFE boot tag found with version 6 and board type 96328avng
[    1.852000] bcm63xxpart: Partition 0 is CFE offset 0 and length 10000
[    1.860000] bcm63xxpart: Partition 1 is kernel offset 10100 and length 12ff00
[    1.868000] bcm63xxpart: Partition 2 is rootfs offset 140000 and length eb0000
[    1.876000] bcm63xxpart: Partition 3 is nvram offset ff0000 and length 10000
[    1.884000] bcm63xxpart: Partition 4 is linux offset 10000 and length fe0000
[    1.888000] bcm63xxpart: Spare partition is offset 360004 and length c8fffc
[    1.896000] 5 bcm63xxpart partitions found on MTD device spi1.0
[    1.904000] Creating 5 MTD partitions on &quot;spi1.0&quot;:
[    1.908000] 0x000000000000-0x000000010000 : &quot;CFE&quot;
[    1.916000] 0x000000010100-0x000000140000 : &quot;kernel&quot;
[    1.920000] mtd: partition &quot;kernel&quot; must either start or end on erase block boundary or be smaller than an erase block -- forcing read-only
[    1.936000] 0x000000140000-0x000000ff0000 : &quot;rootfs&quot;
[    1.944000] mtd: device 2 (rootfs) set to be root filesystem
[    1.952000] mtd: partition &quot;rootfs_data&quot; created automatically, ofs=0x360000, len=0xc90000
[    1.960000] 0x000000360000-0x000000ff0000 : &quot;rootfs_data&quot;
[    1.968000] 0x000000ff0000-0x000001000000 : &quot;nvram&quot;
[    1.976000] 0x000000010000-0x000000ff0000 : &quot;linux&quot;
[    2.024000] b53_common: found switch: BCM63xx, rev 0
[    2.032000] bcm63xx-wdt bcm63xx-wdt:  started, timer margin: 30 sec
[    2.040000] TCP: cubic registered
[    2.040000] NET: Registered protocol family 17
[    2.048000] 8021q: 802.1Q VLAN Support v1.8
[    2.064000] Freeing unused kernel memory: 892K (802e1000 - 803c0000)
procd: Console is alive
procd: - watchdog -
procd: - preinit -
[    2.240000] bcm63xx_enetsw bcm63xx_enetsw.0: link UP on Port 1, 100Mbps, full-duplex
Press the [f] key and hit [enter] to enter failsafe mode
Press the [1], [2], [3] or [4] key and hit [enter] to select the debug level
procd: - early -
procd: - watchdog -
procd: - ubus -
procd: - init -
Please press Enter to activate this console.



BusyBox v1.22.1 (2015-02-10 20:28:19 CET) built-in shell (ash)
Enter &#039;help&#039; for a list of built-in commands.

  _______                     ________        __
 |       |.-----.-----.-----.|  |  |  |.----.|  |_
 |   -   ||  _  |  -__|     ||  |  |  ||   _||   _|
 |_______||   __|_____|__|__||________||__|  |____|
          |__| W I R E L E S S   F R E E D O M
 -----------------------------------------------------
 BARRIER BREAKER (Barrier Breaker, r44365)
 -----------------------------------------------------
  * 1/2 oz Galliano         Pour all ingredients into
  * 4 oz cold Coffee        an irish coffee mug filled
  * 1 1/2 oz Dark Rum       with crushed ice. Stir®sp. Creme de Cacao
 -----------------------------------------------------
root@(none):/# [   49.924000] bcm63xx_enetsw bcm63xx_enetsw.0: link UP on Port 1, 100Mbps, full-duplex
[   51.004000] bcm63xx_enetsw bcm63xx_enetsw.0: link UP on Port 1, 100Mbps, full-duplex
procd: - init complete -

root@OpenWrt:/#</code></pre></div><p>How did you do that? This is the first time this router does something useful!</p><p>What&#039;s the next step? Can this firmware be flashed?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p277198">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">danitool</div>
					<div class="post-datetime">
						22 May 2015, 15:24					</div>
				</div>
				<div class="post-content content">
					<p>Now you can make a backup of the CFE bootloader.</p><p>In your computer execute<br /></p><div class="codebox"><pre><code>nc -l -p 5600|dd of=mtd0-CFE.bin</code></pre></div><p>In Openwrt exectue:<br /></p><div class="codebox"><pre><code>dd if=/dev/mtd0|nc 192.168.1.35 5600</code></pre></div><p>Then check the CFE NVRAM, the board ID should be readable, otherwise the flash chip isn&#039;t working correctly caused by the kernel driver or the flash chip itself.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p277336">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">suso</div>
					<div class="post-datetime">
						23 May 2015, 19:41					</div>
				</div>
				<div class="post-content content">
					<p>It may be hard to believe but there is no link...</p><p>When I change the network cable to a different port I get encouraging messages:</p><div class="codebox"><pre><code>[  710.036000] bcm63xx_enetsw bcm63xx_enetsw.0: link UP on Port 1, 100Mbps, full-duplex
[  720.044000] bcm63xx_enetsw bcm63xx_enetsw.0: link DOWN on Port 1
[  729.048000] bcm63xx_enetsw bcm63xx_enetsw.0: link UP on Port 2, 100Mbps, full-duplex
[  740.056000] bcm63xx_enetsw bcm63xx_enetsw.0: link DOWN on Port 2
[  751.060000] bcm63xx_enetsw bcm63xx_enetsw.0: link UP on Port 3, 100Mbps, full-duplex
[  762.068000] bcm63xx_enetsw bcm63xx_enetsw.0: link DOWN on Port 3
[  765.072000] bcm63xx_enetsw bcm63xx_enetsw.0: link UP on Port 4, 100Mbps, full-duplex
[  788.080000] bcm63xx_enetsw bcm63xx_enetsw.0: link DOWN on Port 4
[  798.084000] bcm63xx_enetsw bcm63xx_enetsw.0: link UP on Port 1, 100Mbps, full-duplex</code></pre></div><p>but no link:</p><div class="codebox"><pre><code>root@OpenWrt:/etc/config# ifconfig
eth0      Link encap:Ethernet  HWaddr FF:64:D9:54:FF:EF  
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:141 errors:0 dropped:0 overruns:0 frame:0
          TX packets:1 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:30906 (30.1 KiB)  TX bytes:1043 (1.0 KiB)

lo        Link encap:Local Loopback  
          inet addr:127.0.0.1  Mask:255.0.0.0
          UP LOOPBACK RUNNING  MTU:65536  Metric:1
          RX packets:6096 errors:0 dropped:0 overruns:0 frame:0
          TX packets:6096 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:499872 (488.1 KiB)  TX bytes:499872 (488.1 KiB)</code></pre></div><p>This is /etc/config/network:</p><div class="codebox"><pre><code>config interface &#039;loopback&#039;
    option ifname &#039;lo&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;127.0.0.1&#039;
    option netmask &#039;255.0.0.0&#039;

config globals &#039;globals&#039;
    option ula_prefix &#039;fdb0:e6d7:47ad::/48&#039;

config interface &#039;lan&#039;
    option ifname &#039;eth0.1&#039;
    option force_link &#039;1&#039;
    option macaddr &#039;xx:xx:xx:xx:xx:xx&#039;
    option type &#039;bridge&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;192.168.1.1&#039;
    option netmask &#039;255.255.255.0&#039;
    option ip6assign &#039;60&#039;

config switch
    option name &#039;eth0&#039;
    option reset &#039;1&#039;
    option enable_vlan &#039;1&#039;

config switch_vlan
    option device &#039;eth0&#039;
    option vlan &#039;1&#039;
    option ports &#039;0 1 2 3 8t&#039;</code></pre></div><p>The MAC address reported by ifconfig doesn&#039;t match with the one I added here... Issuing /etc/init.d/network reload doesn&#039;t change that.</p><p>I checked swconfig:</p><div class="codebox"><pre><code>root@OpenWrt:/etc/config# swconfig dev eth0 show | grep link
    link: port:0 link:up speed:100baseT full-duplex auto
    link: port:1 link:down
    link: port:2 link:down
    link: port:3 link:down
    link: port:4 link:down
    link: port:5 link:down
    link: port:6 link:down
    link: port:7 link:down
    link: port:8 link:up speed:1000baseT full-duplex </code></pre></div><p>I can&#039;t find /proc/switch/:</p><div class="codebox"><pre><code>root@OpenWrt:/etc/config# ls -l /proc/switch/
ls: /proc/switch/: No such file or directory</code></pre></div><p>What can I do?</p>											<p class="post-edited">(Last edited by <strong>suso</strong> on 23 May 2015, 20:05)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p277340">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">danitool</div>
					<div class="post-datetime">
						23 May 2015, 20:17					</div>
				</div>
				<div class="post-content content">
					<p>Is the MAC address the problem?, I have no idea if <strong>FF:64:D9:54:FF:EF</strong> is a valid MAC</p><p>Test this network config<br /></p><div class="codebox"><pre><code>config interface loopback
        option ifname   lo
        option proto    static
        option ipaddr   127.0.0.1
        option netmask  255.0.0.0

config interface lan
        option type     bridge
        option macaddr 00:11:22:33:44:55
        option ifname   eth0
        option proto    static
        option ipaddr   192.168.1.1
        option netmask  255.255.255.0</code></pre></div><p>Then restart network<br /></p><div class="codebox"><pre><code>/etc/init.d/network restart</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p277345">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">suso</div>
					<div class="post-datetime">
						23 May 2015, 21:18					</div>
				</div>
				<div class="post-content content">
					<div class="codebox"><pre><code>root@OpenWrt:/etc/config# cat network

config interface &#039;loopback&#039;
    option ifname &#039;lo&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;127.0.0.1&#039;
    option netmask &#039;255.0.0.0&#039;

config interface lan
        option type     bridge
        option macaddr 00:11:22:33:44:55
        option ifname   eth0
        option proto    static
        option ipaddr   192.168.1.1
        option netmask  255.255.255.0

root@OpenWrt:/etc/config# ifconfig
eth0      Link encap:Ethernet  HWaddr FF:64:D9:54:FF:EF  
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:248 errors:0 dropped:0 overruns:0 frame:0
          TX packets:1 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:54078 (52.8 KiB)  TX bytes:1043 (1.0 KiB)

lo        Link encap:Local Loopback  
          inet addr:127.0.0.1  Mask:255.0.0.0
          UP LOOPBACK RUNNING  MTU:65536  Metric:1
          RX packets:70368 errors:0 dropped:0 overruns:0 frame:0
          TX packets:70368 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:5770176 (5.5 MiB)  TX bytes:5770176 (5.5 MiB)</code></pre></div><p>MAC address is ignored and perhaps the rest of /etc/config/network as well. Why?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p277350">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">danitool</div>
					<div class="post-datetime">
						23 May 2015, 22:06					</div>
				</div>
				<div class="post-content content">
					<p>I built another RAM firmware</p><p><a href="https://drive.google.com/file/d/0B-EMoBe-_OdBNjNzNDgxVEt4V0E/view?usp=sharing">https://drive.google.com/file/d/0B-EMoB … sp=sharing</a></p><p>in theory this one should have the MAC forced to be 00:11:22:33:44:55</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p277357">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">suso</div>
					<div class="post-datetime">
						24 May 2015, 00:03					</div>
				</div>
				<div class="post-content content">
					<p>Suddenly there is a link. Amazing! Thanks a lot!</p><p>But now the problem is this:</p><div class="codebox"><pre><code>root@OpenWrt:/# dd if=/dev/mtd0|nc 192.168.1.35 5600
0+0 records in
0+0 records out</code></pre></div><p>After about 40 seconds...</p><p>I&#039;m lost. Anything I can do to help?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p279891">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">suso</div>
					<div class="post-datetime">
						13 Jun 2015, 20:20					</div>
				</div>
				<div class="post-content content">
					<p>I tried it on a <a href="http://wiki.openwrt.org/toh/inventel/dv4210">livebox</a> and there it works without any problem:</p><div class="codebox"><pre><code>root@livebox:/tmp# dd if=/dev/mtd0 &gt; file
384+0 records in
384+0 records out
root@livebox:/tmp# ls -l file
-rw-r--r--    1 root     root        196608 Jun 13 19:11 file</code></pre></div><p>What is wrong with the R5010UN?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p279892">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">danitool</div>
					<div class="post-datetime">
						13 Jun 2015, 20:27					</div>
				</div>
				<div class="post-content content">
					<p>Probably for some reason Openwrt isn&#039;t able to access the SPI flash chip correctly.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p282055">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">suso</div>
					<div class="post-datetime">
						1 Jul 2015, 22:01					</div>
				</div>
				<div class="post-content content">
					<p>Is this information perhaps useful?</p><div class="codebox"><pre><code>root@OpenWrt:/# cat /proc/mtd
dev:    size   erasesize  name
mtd0: 00010000 00010000 &quot;CFE&quot;
mtd1: 0012ff00 00010000 &quot;kernel&quot;
mtd2: 00eb0000 00010000 &quot;rootfs&quot;
mtd3: 00c90000 00010000 &quot;rootfs_data&quot;
mtd4: 00010000 00010000 &quot;nvram&quot;
mtd5: 00fe0000 00010000 &quot;linux&quot;</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p288616">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">cheche</div>
					<div class="post-datetime">
						21 Aug 2015, 03:37					</div>
				</div>
				<div class="post-content content">
					<p>Suso,<br />1 - Are you sure that the pins are in the right order?<br />In my case.&nbsp; TXD RXD GRD 3.3V</p><p>2- I managed to follow your instructions and here is a copy of the MTD0<br /><a href="https://www.dropbox.com/s/qkqgjrpjyyxaj2e/mtd0-CFE-NucomR5010UN.bin?dl=0">https://www.dropbox.com/s/qkqgjrpjyyxaj … N.bin?dl=0</a></p><p>3- Here is the bootlog <a href="https://www.dropbox.com/s/n7uc3u3pmo28hyx/BOOTLOG15.05-rc3-brcm63xx-generic-96328avng-16M-flash-generic-squashfs-cfe.TXT?dl=0">https://www.dropbox.com/s/n7uc3u3pmo28h … e.TXT?dl=0</a></p>											<p class="post-edited">(Last edited by <strong>cheche</strong> on 21 Aug 2015, 03:55)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p288797">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">suso</div>
					<div class="post-datetime">
						22 Aug 2015, 19:54					</div>
				</div>
				<div class="post-content content">
					<p>Hey Cheche!</p><p>Thanks for your post. This is excellent news. I hope this is the CFE bootloader that danitool needed.</p><p>I&#039;m sure it didn&#039;t work for me because I screwed it up trying out random firmwares.</p><p>I refer to RXD as an input to the router. Do you agree?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p288811">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">cheche</div>
					<div class="post-datetime">
						22 Aug 2015, 20:58					</div>
				</div>
				<div class="post-content content">
					<p>Suso,<br />execute &quot;sm 0xb0001014 0x50b 4&quot;, then &quot;r&quot; in CFE and your router will boot up just fine. Someone in the IRC told me. He is in the process to forward some patch to test a proper fix</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p288835">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">suso</div>
					<div class="post-datetime">
						23 Aug 2015, 00:28					</div>
				</div>
				<div class="post-content content">
					<p>Yes it does. It boots... BARRIER BREAKER (14.07-rc1, r41580). Where does this firmware come from? It may be openwrt-96328avng-16M-flash-generic-squashfs-cfe.bin I flashed months ago but I never saw boot because I didn&#039;t know your trick by then. I wasn&#039;t aware this firmware ended up in flash.</p><p>Anyway, I&#039;m looking forward to the patch!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p288880">
				<div class="post-metadata">
					<div class="post-num">Post #21</div>
					<div class="post-author">cheche</div>
					<div class="post-datetime">
						23 Aug 2015, 14:17					</div>
				</div>
				<div class="post-content content">
					<p>Suso,<br />Please test this build.<br /><a href="https://www.dropbox.com/s/cmw0d5h78wewvdo/openwrt-brcm63xx-generic-96328avng-generic-squashfs-cfe-16M.bin?dl=0">https://www.dropbox.com/s/cmw0d5h78wewv … M.bin?dl=0</a></p><p>This is the fix to this problem <a href="https://dev.openwrt.org/changeset/46707">https://dev.openwrt.org/changeset/46707</a></p><p>Now that at least you are able to load a firmware and get it working this device&nbsp; needs a wiki page.</p>											<p class="post-edited">(Last edited by <strong>cheche</strong> on 23 Aug 2015, 21:05)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p288918">
				<div class="post-metadata">
					<div class="post-num">Post #22</div>
					<div class="post-author">suso</div>
					<div class="post-datetime">
						23 Aug 2015, 21:17					</div>
				</div>
				<div class="post-content content">
					<p>YES! You did it! It boots at power up:<br /></p><div class="codebox"><pre><code>HELO
CPUI
L1CI
DRAM
----
PHYS
ZQDN
PHYE
DINT
LSYN
USYN
MSYN
LMBE
PASS
----
ZBSS
CODE
DATA
L12F
MAIN


CFE version 1.0.37-106.5 for BCM96328 (32bit,SP,BE)
Build Date: 2013年 09月 09日 星期一 12:55:22 HKT (root@s54)
Copyright (C) 2000-2009 Broadcom Corporation.

clock=40000000
flash=S25FL128 size=16MB id=0x12018  sector=64k

HS Serial flash device: name S25FL128, id 0x12018 size 16384KB
Total Flash size: 16384K with 256 sectors
Chip ID: BCM6328B0, MIPS: 320MHz, DDR: 320MHz, Bus: 160MHz
Main Thread: TP0
Memory Test Passed
Total Memory: 67108864 bytes (64MB)
Boot Address: 0xb8000000


Board IP address                  : 192.168.1.1:ffffff00  
Host IP address                   : 192.168.1.100  
Gateway IP address                :   
Run from flash/host (f/h)         : f  
Default host run file name        : vmlinux  
Default host flash file name      : bcm963xx_fs_kernel  
Boot delay (0-9 seconds)          : 1  
Board Id (0-2)                    : 96328avng  
Number of MAC Addresses (1-32)    : 10  
Base MAC Address                  : fa:ba:da:fa:ba:da  
PSI Size (1-64) KBytes            : 32  
Enable Backup PSI [0|1]           : 1  
System Log Size (0-256) KBytes    : 0  
Main Thread Number [0|1]          : 0  
Voice Board Configuration (0-4)   : LE88276  

send udp message finished.
Not response, auto boot ...
*** Press any key to stop auto run (1 seconds) ***
Auto run second count down: 110
Booting from only image (0xb8010000) ...
Code Address: 0x80A00000, Entry Address: 0x80a00000
LZMA: Prossible old LZMA format, trying to decompress..
Decompression OK!
Entry at 0x80a00000
Closing network.
Disabling Switch ports.
Flushing Receive Buffers...
11 buffers found.
Closing DMA Channels.
Starting program at 0x80a00000
[    0.000000] Linux version 4.1.5 (cheche@casa) (gcc version 4.8.3 (OpenWrt/Linaro GCC 4.8-2014.04 r46705) ) #1 Sun Aug 23 13:09:09 CEST 2015
[    0.000000] Detected Broadcom 0x6328 CPU revision b0
[    0.000000] CPU frequency is 320 MHz
[    0.000000] 64MB of RAM installed
[    0.000000] board_bcm963xx: Boot address 0xb8000000
[    0.000000] board_bcm963xx: CFE version: 1.0.37-106.5
[    0.000000] bootconsole [early0] enabled
[    0.000000] CPU0 revision is: 0002a075 (Broadcom BMIPS4350)
[    0.000000] board: board name: 96328avng
[    0.000000] MIPS: machine is Broadcom BCM96328avng reference board
[    0.000000] Determined physical RAM map:
[    0.000000]  memory: 04000000 @ 00000000 (usable)
[    0.000000] Initrd not found or empty - disabling initrd
[    0.000000] Zone ranges:
[    0.000000]   Normal   [mem 0x0000000000000000-0x0000000003ffffff]
[    0.000000] Movable zone start for each node
[    0.000000] Early memory node ranges
[    0.000000]   node   0: [mem 0x0000000000000000-0x0000000003ffffff]
[    0.000000] Initmem setup node 0 [mem 0x0000000000000000-0x0000000003ffffff]
[    0.000000] Primary instruction cache 32kB, VIPT, 4-way, linesize 16 bytes.
[    0.000000] Primary data cache 32kB, 2-way, VIPT, cache aliases, linesize 16 bytes
[    0.000000] Built 1 zonelists in Zone order, mobility grouping on.  Total pages: 16256
[    0.000000] Kernel command line:  root=/dev/mtdblock2 rootfstype=squashfs,jffs2 noinitrd console=ttyS0,115200
[    0.000000] PID hash table entries: 256 (order: -2, 1024 bytes)
[    0.000000] Dentry cache hash table entries: 8192 (order: 3, 32768 bytes)
[    0.000000] Inode-cache hash table entries: 4096 (order: 2, 16384 bytes)
[    0.000000] Memory: 59916K/65536K available (2742K kernel code, 130K rwdata, 576K rodata, 1280K init, 187K bss, 5620K reserved, 0K cma-reserved)
[    0.000000] NR_IRQS:256
[    0.000000] clocksource MIPS: mask: 0xffffffff max_cycles: 0xffffffff, max_idle_ns: 11945377789 ns
[    0.000019] sched_clock: 32 bits at 160MHz, resolution 6ns, wraps every 13421772796ns
[    0.008673] Calibrating delay loop... 319.74 BogoMIPS (lpj=639488)
[    0.051009] pid_max: default: 32768 minimum: 301
[    0.056443] Mount-cache hash table entries: 1024 (order: 0, 4096 bytes)
[    0.063257] Mountpoint-cache hash table entries: 1024 (order: 0, 4096 bytes)
[    0.078178] clocksource jiffies: mask: 0xffffffff max_cycles: 0xffffffff, max_idle_ns: 7645041785100000 ns
[    0.089913] NET: Registered protocol family 16
[    0.330363] registering PCI controller with io_map_base unset
[    0.359634] PCI host bridge to bus 0000:00
[    0.363889] pci_bus 0000:00: root bus resource [mem 0x10f00000-0x10ffffff]
[    0.370951] pci_bus 0000:00: root bus resource [??? 0x00000000 flags 0x0]
[    0.377935] pci_bus 0000:00: root bus resource [??? 0x00000000 flags 0x0]
[    0.384919] pci_bus 0000:00: No busn resource found for root bus, will use [bus 00-ff]
[    0.393723] pci 0000:00:00.0: bridge configuration invalid ([bus 00-00]), reconfiguring
[    0.403149] pci 0000:00:00.0: BAR 8: assigned [mem 0x10f00000-0x10ffffff]
[    0.410174] pci 0000:01:00.0: BAR 0: assigned [mem 0x10f00000-0x10f07fff 64bit]
[    0.417708] pci 0000:00:00.0: PCI bridge to [bus 01]
[    0.422806] pci 0000:00:00.0:   bridge window [mem 0x10f00000-0x10ffffff]
[    0.431450] Switched to clocksource MIPS
[    0.438784] PCI: Enabling device 0000:00:00.0 (0000 -&gt; 0002)
[    0.444658] PCI: Enabling device 0000:01:00.0 (0000 -&gt; 0002)
[    0.450506] bcma: bus0: Found chip with id 43227, rev 0x01 and package 0x09
[    0.457707] bcma: bus0: Core 0 found: ChipCommon (manuf 0x4BF, id 0x800, rev 0x27, class 0x0)
[    0.466530] bcma: bus0: Core 1 found: IEEE 802.11 (manuf 0x4BF, id 0x812, rev 0x1E, class 0x0)
[    0.475470] bcma: bus0: Core 2 found: PCIe (manuf 0x4BF, id 0x820, rev 0x14, class 0x0)
[    0.483796] bcma_fallback_sprom: pci bus/device num mismatch: expected 0/0, but got 1/0
[    0.507749] bcma: bus0: Bus registered
[    0.512230] NET: Registered protocol family 2
[    0.518945] TCP established hash table entries: 1024 (order: 0, 4096 bytes)
[    0.526227] TCP bind hash table entries: 1024 (order: 0, 4096 bytes)
[    0.532815] TCP: Hash tables configured (established 1024 bind 1024)
[    0.539852] UDP hash table entries: 256 (order: 0, 4096 bytes)
[    0.545947] UDP-Lite hash table entries: 256 (order: 0, 4096 bytes)
[    0.553151] NET: Registered protocol family 1
[    0.560164] futex hash table entries: 256 (order: -1, 3072 bytes)
[    0.571043] squashfs: version 4.0 (2009/01/31) Phillip Lougher
[    0.577105] jffs2: version 2.2 (NAND) (SUMMARY) (LZMA) (RTIME) (CMODE_PRIORITY) (c) 2001-2006 Red Hat, Inc.
[    0.589276] io scheduler noop registered
[    0.593369] io scheduler deadline registered (default)
[    0.600773] bcm63xx_uart.0: ttyS0 at MMIO 0xb0000100 (irq = 36, base_baud = 1562500) is a bcm63xx_uart
[    0.610435] console [ttyS0] enabled
[    0.610435] console [ttyS0] enabled
[    0.617586] bootconsole [early0] disabled
[    0.617586] bootconsole [early0] disabled
[    0.635221] m25p80 spi1.0: found s25fl128s, expected m25p80
[    0.640995] m25p80 spi1.0: s25fl128s (16384 Kbytes)
[    0.646392] bcm63xxpart: CFE boot tag found with version 6 and board type 96328avng
[    0.654372] bcm63xxpart: Partition 0 is CFE offset 0 and length 10000
[    0.661015] bcm63xxpart: Partition 1 is kernel offset 10100 and length 12aa0a
[    0.668347] bcm63xxpart: Partition 2 is rootfs offset 13ab0a and length eb54f6
[    0.675774] bcm63xxpart: Partition 3 is nvram offset ff0000 and length 10000
[    0.683028] bcm63xxpart: Partition 4 is linux offset 10000 and length fe0000
[    0.690287] 5 bcm63xxpart partitions found on MTD device spi1.0
[    0.696378] Creating 5 MTD partitions on &quot;spi1.0&quot;:
[    0.701319] 0x000000000000-0x000000010000 : &quot;CFE&quot;
[    0.708125] 0x000000010100-0x00000013ab0a : &quot;kernel&quot;
[    0.714927] 0x00000013ab0a-0x000000ff0000 : &quot;rootfs&quot;
[    0.721682] mtd: device 2 (rootfs) set to be root filesystem
[    0.731355] 1 squashfs-split partitions found on MTD device rootfs
[    0.737772] 0x000000280000-0x000000ff0000 : &quot;rootfs_data&quot;
[    0.745196] 0x000000ff0000-0x000001000000 : &quot;nvram&quot;
[    0.752085] 0x000000010000-0x000000ff0000 : &quot;linux&quot;
[    0.796709] b53_common: found switch: BCM63xx, rev 0
[    0.802363] bcm63xx-wdt bcm63xx-wdt:  started, timer margin: 30 sec
[    0.811803] NET: Registered protocol family 17
[    0.816529] bridge: automatic filtering via arp/ip/ip6tables has been deprecated. Update your scripts to load br_netfilter if you need this.
[    0.829553] 8021q: 802.1Q VLAN Support v1.8
[    0.850211] VFS: Mounted root (squashfs filesystem) readonly on device 31:2.
[    0.874743] Freeing unused kernel memory: 1280K (80370000 - 804b0000)
[    2.432716] init: Console is alive
[    2.436566] init: - watchdog -
[    3.441114] init: - preinit -
[    4.167793] bcm63xx_enetsw bcm63xx_enetsw.0: link UP on Port 1, 100Mbps, full-duplex
[    4.229501] random: procd urandom read with 74 bits of entropy available
Press the [f] key and hit [enter] to enter failsafe mode
Press the [1], [2], [3] or [4] key and hit [enter] to select the debug level
[    7.757978] mount_root: jffs2 not ready yet, using temporary tmpfs overlay
[    7.812167] procd: - early -
[    7.815236] procd: - watchdog -
[    8.811626] procd: - ubus -
[    9.825964] procd: - init -
Please press Enter to activate this console.
[   11.222442] NET: Registered protocol family 10
[   11.239762] ip6_tables: (C) 2000-2006 Netfilter Core Team
[   11.273774] ip_tables: (C) 2000-2006 Netfilter Core Team
[   11.301168] nf_conntrack version 0.5.0 (956 buckets, 3824 max)
[   11.383740] xt_time: kernel timezone is -0000
[   11.413110] PPP generic driver version 2.4.2
[   11.422506] NET: Registered protocol family 24
[   13.557261] random: nonblocking pool is initialized
[   53.539578] m25p80 spi1.0: flash operation timed out
[   56.567805] bcm63xx_enetsw bcm63xx_enetsw.0: link UP on Port 1, 100Mbps, full-duplex
[   58.337441] SQUASHFS error: xz decompression failed, data probably corrupt
[   58.344553] SQUASHFS error: squashfs_read_data failed to read block 0x1222d6
[   58.351814] SQUASHFS error: Unable to read fragment cache entry [1222d6]
[   58.358695] SQUASHFS error: Unable to read page, block 1222d6, size 626c
[   58.365661] SQUASHFS error: Unable to read fragment cache entry [1222d6]
[   58.372543] SQUASHFS error: Unable to read page, block 1222d6, size 626c
[   58.379509] SQUASHFS error: Unable to read fragment cache entry [1222d6]
[   58.386387] SQUASHFS error: Unable to read page, block 1222d6, size 626c
[   58.393344] SQUASHFS error: Unable to read fragment cache entry [1222d6]
[   58.400225] SQUASHFS error: Unable to read page, block 1222d6, size 626c
[   58.407180] SQUASHFS error: Unable to read fragment cache entry [1222d6]
[   58.414060] SQUASHFS error: Unable to read page, block 1222d6, size 626c
[   59.161493] SQUASHFS error: xz decompression failed, data probably corrupt
[   59.168598] SQUASHFS error: squashfs_read_data failed to read block 0x10ed46
[   59.175854] SQUASHFS error: Unable to read fragment cache entry [10ed46]
[   59.182736] SQUASHFS error: Unable to read page, block 10ed46, size 13590
[   59.189791] SQUASHFS error: Unable to read fragment cache entry [10ed46]
[   59.196676] SQUASHFS error: Unable to read page, block 10ed46, size 13590
[   59.203716] SQUASHFS error: Unable to read fragment cache entry [10ed46]
[   59.210594] SQUASHFS error: Unable to read page, block 10ed46, size 13590
[   59.217636] SQUASHFS error: Unable to read fragment cache entry [10ed46]
[   59.224518] SQUASHFS error: Unable to read page, block 10ed46, size 13590
[   59.231565] SQUASHFS error: Unable to read fragment cache entry [10ed46]
[   59.238442] SQUASHFS error: Unable to read page, block 10ed46, size 13590
[   59.795804] bcm63xx_enetsw bcm63xx_enetsw.0: link UP on Port 1, 100Mbps, full-duplex
[   59.823038] device eth0.1 entered promiscuous mode
[   59.828015] device eth0 entered promiscuous mode
[   59.877183] br-lan: port 1(eth0.1) entered forwarding state
[   59.883009] br-lan: port 1(eth0.1) entered forwarding state
[   60.419371] jffs2: notice: (691) jffs2_build_xattr_subsystem: complete building xattr subsystem, 0 of xdatum (0 unchecked, 0 orphan) and 0 of xref (0 dead, 0 orphan) found.
[   61.883531] br-lan: port 1(eth0.1) entered forwarding state
[   63.656167] SQUASHFS error: Unable to read fragment cache entry [1222d6]
[   63.663095] SQUASHFS error: Unable to read page, block 1222d6, size 626c



BusyBox v1.23.2 (2015-08-22 14:28:19 CEST) built-in shell (ash)

  _______                     ________        __
 |       |.-----.-----.-----.|  |  |  |.----.|  |_
 |   -   ||  _  |  -__|     ||  |  |  ||   _||   _|
 |_______||   __|_____|__|__||________||__|  |____|
          |__| W I R E L E S S   F R E E D O M
 -----------------------------------------------------
 CHAOS CALMER (Bleeding Edge, r46708)
 -----------------------------------------------------
  * 1 1/2 oz Gin            Shake with a glassful
  * 1/4 oz Triple Sec       of broken ice and pour
  * 3/4 oz Lime Juice       unstrained into a goblet.
  * 1 1/2 oz Orange Juice
  * 1 tsp. Grenadine Syrup
 -----------------------------------------------------
root@OpenWrt:/# [   68.680447] SQUASHFS error: xz decompression failed, data probably corrupt
[   68.687563] SQUASHFS error: squashfs_read_data failed to read block 0x1222d6
[   68.694811] SQUASHFS error: Unable to read fragment cache entry [1222d6]
[   68.701698] SQUASHFS error: Unable to read page, block 1222d6, size 626c</code></pre></div><p>Congratulations, Cheche. Excellent work!</p><p>How did you do this? What does the fix do? What was the problem? And, last but not least, what&#039;s next?</p>											<p class="post-edited">(Last edited by <strong>suso</strong> on 23 Aug 2015, 21:25)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p288934">
				<div class="post-metadata">
					<div class="post-num">Post #23</div>
					<div class="post-author">cheche</div>
					<div class="post-datetime">
						23 Aug 2015, 23:21					</div>
				</div>
				<div class="post-content content">
					<p>Suso,<br />It was not me. I only was talking with @danitool and&nbsp; Jonas Gorski who is the person that make those changes. There is something wrong on your device. your bootlog output is different from mine. Maybe your changes on the CFE. Just test and report back any issues.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p288938">
				<div class="post-metadata">
					<div class="post-num">Post #24</div>
					<div class="post-author">suso</div>
					<div class="post-datetime">
						23 Aug 2015, 23:35					</div>
				</div>
				<div class="post-content content">
					<p>OK. Can I replace my bootloader with yours? Would that be a solution? Do you know how? Through the webinterface? Or from the CFE prompt?</p><p>Is this change included in r46708 so that I can try to build a firmware myself?</p><p>I tried to edit and create files in the overlayfs. After a reboot they disappear. The reboot command doesn&#039;t work, I have to cycle power. Is this normal in this stage? Do you see the same behaviour?</p><p>I reset the Board Id so it is the same as yours now. But I don&#039;t see any difference. Should I be worried?</p>											<p class="post-edited">(Last edited by <strong>suso</strong> on 24 Aug 2015, 01:43)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p288953">
				<div class="post-metadata">
					<div class="post-num">Post #25</div>
					<div class="post-author">cheche</div>
					<div class="post-datetime">
						24 Aug 2015, 01:42					</div>
				</div>
				<div class="post-content content">
					<p>Suso,<br />I see a lot of&nbsp; SQUASHFS error in your log. Your Base MAC have changed. So I assume that something is not right. If you want to replace your CFE go ahead, but I do not know if you break something else. </p><p>yes, that change is in trunk so you can build it yourself.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>