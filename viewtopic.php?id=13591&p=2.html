<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Fonera: setting up AP and STD</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 20 Apr 2018 and 28 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 2 of 2</div><nav><ul><li><a href="viewtopic.php%3Fid=13591&amp;p=1.html">1</a></li><li class="pagination-current"><span>2</span></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p60288">
				<div class="post-metadata">
					<div class="post-num">Post #26</div>
					<div class="post-author">j0inty</div>
					<div class="post-datetime">
						12 Dec 2007, 00:11					</div>
				</div>
				<div class="post-content content">
					<p>No...but for this you should ask a mac user who knows how you configure a second or more ip to an interface.</p><p>I&#039;m a Gentoo Linux User <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /></p><p>hBut have you try it now with the bridges ???</p><p>regards<br />j0inty.sL</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p60302">
				<div class="post-metadata">
					<div class="post-num">Post #27</div>
					<div class="post-author">eleon216</div>
					<div class="post-datetime">
						12 Dec 2007, 10:17					</div>
				</div>
				<div class="post-content content">
					<p>it is the same command in os x as it is in linux</p><p>for example </p><p>sudo ifconfig en0 add 192.168.4.2 netmask 255.255.255.0</p><p>to add the address 192.168.4.2 with the subnetmask 255.255.255.0 to the interface en0</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p60323">
				<div class="post-metadata">
					<div class="post-num">Post #28</div>
					<div class="post-author">Trew</div>
					<div class="post-datetime">
						12 Dec 2007, 16:06					</div>
				</div>
				<div class="post-content content">
					<p>now, i config all like this:</p><p><strong>Trew:</strong><br />TrewPC (MacOSX):<br />ifconfig en0 add 77.113.158.101 netmask 255.255.255.248&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # to the provider<br />ifconfig en0 add 192.168.1.1 netmask 255.255.255.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # to the fonera</p><p>TrewFoneraAP:<br />config interface loopback<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname&nbsp; &nbsp;lo<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; static<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr&nbsp; &nbsp;127.0.0.1<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask&nbsp; 255.0.0.0</p><p>config interface lan<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname&nbsp; &nbsp;eth0<br />&nbsp; &nbsp; &nbsp; &nbsp; option type&nbsp; &nbsp; &nbsp;bridge<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; static<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr&nbsp; &nbsp;192.168.1.2<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask&nbsp; 255.255.255.0</p><p>config wifi-device&nbsp; wifi0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; option type&nbsp; &nbsp; &nbsp;atheros&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; option channel&nbsp; 11&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />config wifi-iface&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; option device&nbsp; &nbsp;wifi0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; option network&nbsp; lan&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; option mode&nbsp; &nbsp; &nbsp;ap&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; option ssid&nbsp; &nbsp; &nbsp;myssid&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; option encryption none&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p><br /><p><strong>Jack:</strong><br />JackPC (Winzozz):<br />added an ip 77.113.158.201 with subnet 255.255.255.248&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; to the provider<br />added an ip 192.168.1.3 with subnet 255.255.255.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# to the fonera</p><p>JackFoneraSTA:<br />config interface loopback<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname&nbsp; &nbsp;lo<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; static<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr&nbsp; &nbsp;127.0.0.1<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask&nbsp; 255.0.0.0</p><p>config interface lan<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname&nbsp; &nbsp;eth0<br />&nbsp; &nbsp; &nbsp; &nbsp; option type&nbsp; &nbsp; &nbsp;bridge<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; static<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr&nbsp; &nbsp;192.168.1.4<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask&nbsp; 255.255.255.0</p><p>config wifi-device&nbsp; wifi0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; option type&nbsp; &nbsp; &nbsp;atheros&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; option channel&nbsp; 11&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />config wifi-iface&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; option device&nbsp; &nbsp;wifi0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; option network&nbsp; lan&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; option mode&nbsp; &nbsp; &nbsp;sta&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; option ssid&nbsp; &nbsp; &nbsp;myssid&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; option encryption none&nbsp; &nbsp;</p><br /><p>but, TrewFonera not able to ping JackFonera, they not connect..! (inside openwrt, i cannot ping other fonera)</p><p>have i to set any route? (gateway..)<br />and the wan (ath0) interface?</p>											<p class="post-edited">(Last edited by <strong>Trew</strong> on 12 Dec 2007, 16:34)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p60356">
				<div class="post-metadata">
					<div class="post-num">Post #29</div>
					<div class="post-author">j0inty</div>
					<div class="post-datetime">
						12 Dec 2007, 22:22					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>Today I have tested my bridge with the this configuration and a MAC G4 IBook <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" />. Works wunderfull and with wpa2 encryption.</p><p>But back to the Topic.</p><p>If you make an &quot;ifconfig -a&quot; on your fonera you will now see a devive called &quot;br-lan&quot; with the IP that you have setted for it. Now go on Trew&#039;s fonera and edit the /etc/hostapd.conf with this:</p><div class="codebox"><pre><code>interface=ath0
bridge=br-lan
driver=madwifi</code></pre></div><p>Check is hostapd running and enable it if needed. Try to connect with a Client, too. Check your &quot;dmesg&quot; on all fonera&nbsp; for the following lines.</p><div class="codebox"><pre><code>device eth0 entered promiscuous mode
br-lan: port 1(eth0) entering learning state
br-lan: topology change detected, propagating
br-lan: port 1(eth0) entering forwarding state
[...]
device ath0 entered promiscuous mode
br-lan: port 2(ath0) entering learning state
br-lan: topology change detected, propagating
br-lan: port 2(ath0) entering forwarding state</code></pre></div><p>regards<br />j0inty</p><p>PS: Have you turn off the firewall on the fonera. Try this if it already not running.<br />/etc/init.d/firewall stop</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p60427">
				<div class="post-metadata">
					<div class="post-num">Post #30</div>
					<div class="post-author">j0inty</div>
					<div class="post-datetime">
						14 Dec 2007, 17:37					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>have you tested it now and works everything fine ???</p><p>Please let it me know, because I want to make a similar thing by a friend in the beginning of next year.</p><p>regards<br />j0inty.sL</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p60434">
				<div class="post-metadata">
					<div class="post-num">Post #31</div>
					<div class="post-author">Trew</div>
					<div class="post-datetime">
						14 Dec 2007, 20:19					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>j0inty wrote:</cite><blockquote><p>If you make an &quot;ifconfig -a&quot; on your fonera you will now see a devive called &quot;br-lan&quot; with the IP that you have setted for it</p></blockquote></div><p>yes, here:<br /></p><div class="codebox"><pre><code>br-lan    Link encap:Ethernet  HWaddr 00:18:84:28:3E:D0  
          inet addr:192.168.1.2  Bcast:192.168.1.255  Mask:255.255.255.0
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:894 errors:0 dropped:0 overruns:0 frame:0
          TX packets:370 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:90258 (88.1 KiB)  TX bytes:47355 (46.2 KiB)</code></pre></div><div class="quotebox"><blockquote><p>Now go on Trew&#039;s fonera and edit the /etc/hostapd.conf with this:<br />interface=ath0<br />bridge=br-lan<br />driver=madwifi</p></blockquote></div><p>i must create that file (hostapd.conf), because it doesn&#039;t exist yet..!</p><div class="quotebox"><blockquote><p>Check is hostapd running and enable it if needed</p></blockquote></div><p>how i have to do?<br />i think that if i don&#039;t running this configuration file, the networking not run.</p><div class="quotebox"><blockquote><p>Check your &quot;dmesg&quot; on all fonera&nbsp; for the following lines:<br />device eth0 entered promiscuous mode<br />br-lan: port 1(eth0) entering learning state<br />br-lan: topology change detected, propagating<br />br-lan: port 1(eth0) entering forwarding state<br />[...]<br />device ath0 entered promiscuous mode<br />br-lan: port 2(ath0) entering learning state<br />br-lan: topology change detected, propagating<br />br-lan: port 2(ath0) entering forwarding state</p></blockquote></div><p>ok, i found all these string, in my dmesg command!</p><div class="quotebox"><blockquote><p>PS: Have you turn off the firewall on the fonera. Try this if it already not running.<br />/etc/init.d/firewall stop</p></blockquote></div><p>yes, i will stop it before every my test..!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p60446">
				<div class="post-metadata">
					<div class="post-num">Post #32</div>
					<div class="post-author">j0inty</div>
					<div class="post-datetime">
						15 Dec 2007, 00:30					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><blockquote><p>how i have to do?<br />i think that if i don&#039;t running this configuration file, the networking not run.</p></blockquote></div><p>Hi,</p><p>it seems that don&#039;t have hostapd installed. With the ipkg command you can install it.</p><div class="codebox"><pre><code>### On Trews fonera ###
ipkg list_installed
ipkg install hostapd</code></pre></div><p>I would delete the other hostapd.conf that you have create by your self, befor install the hostapd package.</p><p>regards<br />j0inty.sL</p><p>PS: If you want to use wpa or wpa2 encryption the other Fonera (not Trew) need wpa_supplicant installed.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p60453">
				<div class="post-metadata">
					<div class="post-num">Post #33</div>
					<div class="post-author">Trew</div>
					<div class="post-datetime">
						15 Dec 2007, 02:07					</div>
				</div>
				<div class="post-content content">
					<p>and if i setup an adhoc mode: <a href="http://forum.openwrt.org/viewtopic.php?id=13711">http://forum.openwrt.org/viewtopic.php?id=13711</a> ?</p><p>can i resolve all my problems?</p>											<p class="post-edited">(Last edited by <strong>Trew</strong> on 15 Dec 2007, 02:17)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p61682">
				<div class="post-metadata">
					<div class="post-num">Post #34</div>
					<div class="post-author">turrican</div>
					<div class="post-datetime">
						14 Jan 2008, 21:09					</div>
				</div>
				<div class="post-content content">
					<p>Hello!</p><p>I tried to set up my foneras as j0inty said. I have 2 foneras 1 configured for AP and 1 for STA.<br />The configurations:</p><p>root@FonAP:~# chmod -x /etc/init.d/firewall<br />root@FonAP:~# chmod -x /etc/init.d/dnsmasq<br />root@FonAP:~# reboot</p><p>root@FonAP:~# cat /etc/config/wireless<br />config wifi-device&nbsp; wifi0<br />&nbsp; &nbsp; &nbsp; &nbsp; option type&nbsp; &nbsp; &nbsp;atheros<br />&nbsp; &nbsp; &nbsp; &nbsp; option channel&nbsp; 5</p><p>&nbsp; &nbsp; &nbsp; &nbsp; option mode 11bg<br />&nbsp; &nbsp; &nbsp; &nbsp; option diversity 0<br />&nbsp; &nbsp; &nbsp; &nbsp; option txantenna 1<br />&nbsp; &nbsp; &nbsp; &nbsp; option rxantenna 1</p><p>config wifi-iface<br />&nbsp; &nbsp; &nbsp; &nbsp; option device&nbsp; &nbsp;wifi0<br />&nbsp; &nbsp; &nbsp; &nbsp; option network&nbsp; lan<br />&nbsp; &nbsp; &nbsp; &nbsp; option mode&nbsp; &nbsp; &nbsp;ap<br />&nbsp; &nbsp; &nbsp; &nbsp; option ssid&nbsp; &nbsp; &nbsp;LaFon<br />&nbsp; &nbsp; &nbsp; &nbsp; option encryption none<br />&nbsp; &nbsp; &nbsp; &nbsp; option hidden&nbsp; &nbsp;0<br />&nbsp; &nbsp; &nbsp; &nbsp; option bgscan&nbsp; &nbsp;0</p><p>root@FonAP:~# cat /etc/config/network<br />config interface loopback<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname&nbsp; &nbsp;lo<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; static<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr&nbsp; &nbsp;127.0.0.1<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask&nbsp; 255.0.0.0</p><p>config interface lan<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname&nbsp; &nbsp;eth0<br />&nbsp; &nbsp; &nbsp; &nbsp; option type&nbsp; &nbsp; &nbsp;bridge<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; static<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr&nbsp; &nbsp;192.168.108.3<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask&nbsp; 255.255.255.0<br />&nbsp; &nbsp; &nbsp; &nbsp; option gateway&nbsp; 192.168.108.254<br />&nbsp; &nbsp; &nbsp; &nbsp; option dns&nbsp; &nbsp; &nbsp; 192.168.108.254</p><br /><br /><p>root@FonSTA:~# chmod -x /etc/init.d/dnsmasq<br />root@FonSTA:~# chmod -x /etc/init.d/firewall<br />root@FonSTA:~# reboot</p><br /><p>root@FonSTA:~# cat /etc/config/network<br />config interface loopback<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname&nbsp; &nbsp;lo<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; static<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr&nbsp; &nbsp;127.0.0.1<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask&nbsp; 255.0.0.0</p><p>config interface lan<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname&nbsp; &nbsp;eth0<br />&nbsp; &nbsp; &nbsp; &nbsp; option type&nbsp; &nbsp; &nbsp;bridge<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; static<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr&nbsp; &nbsp;192.168.108.2<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask&nbsp; 255.255.255.0<br />&nbsp; &nbsp; &nbsp; &nbsp; option gateway&nbsp; 192.168.108.254<br />&nbsp; &nbsp; &nbsp; &nbsp; option dns&nbsp; &nbsp; &nbsp; 192.168.108.254</p><p>root@FonSTA:~# cat /etc/config/wireless<br />config wifi-device&nbsp; wifi0<br />&nbsp; &nbsp; &nbsp; &nbsp; option type&nbsp; &nbsp; &nbsp;atheros<br />&nbsp; &nbsp; &nbsp; &nbsp; option channel&nbsp; 5</p><p>&nbsp; &nbsp; &nbsp; &nbsp; option mode 11bg<br />&nbsp; &nbsp; &nbsp; &nbsp; option diversity 0<br />&nbsp; &nbsp; &nbsp; &nbsp; option txantenna 1<br />&nbsp; &nbsp; &nbsp; &nbsp; option rxantenna 1</p><p>config wifi-iface<br />&nbsp; &nbsp; &nbsp; &nbsp; option device&nbsp; &nbsp;wifi0<br />&nbsp; &nbsp; &nbsp; &nbsp; option network&nbsp; lan<br />&nbsp; &nbsp; &nbsp; &nbsp; option mode&nbsp; &nbsp; &nbsp;sta<br />&nbsp; &nbsp; &nbsp; &nbsp; option ssid&nbsp; &nbsp; &nbsp;LaFon<br />&nbsp; &nbsp; &nbsp; &nbsp; option encryption none</p><p>This setup doesn&#039;t work for me. The hostapd is running on the FonAP, with this config file:</p><p>interface=ath0<br />bridge=br-lan<br />driver=madwifi</p><p>root@FonAP:~# ps | grep hostapd<br />&nbsp; 432 root&nbsp; &nbsp; &nbsp; &nbsp; 604 S&nbsp; &nbsp;hostapd -B hostapd.conf</p><br /><p>I can see the FonSTA is connected:</p><p>root@FonAP:~# wlanconfig ath0 list<br />ADDR&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;AID CHAN RATE RSSI&nbsp; DBM&nbsp; IDLE&nbsp; TXSEQ&nbsp; TXFRAG&nbsp; RXSEQ&nbsp; RXFRAG CAPS ACAPS ERP&nbsp; &nbsp; STATE&nbsp; &nbsp; &nbsp;MODE<br />00:18:84:1e:7b:d1&nbsp; &nbsp; 1&nbsp; &nbsp; 5&nbsp; 36M&nbsp; &nbsp;37&nbsp; -58&nbsp; &nbsp;180&nbsp; &nbsp; &nbsp;90&nbsp; &nbsp; &nbsp; &nbsp;5&nbsp; &nbsp;2457&nbsp; &nbsp; &nbsp; &nbsp;0 ESs&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 7&nbsp; &nbsp;Normal WME ATH</p><p>I cant ping.</p><p>root@FonSTA:~#&nbsp; ping 192.168.108.3<br />PING 192.168.108.3 (192.168.108.3): 56 data bytes</p><p>--- 192.168.108.3 ping statistics ---<br />2 packets transmitted, 0 packets received, 100% packet loss</p><p>When check the ARP table the hw address is 00:00:00:00:00:00.</p><p>root@FonSTA:~# arp<br />IP address&nbsp; &nbsp; &nbsp; &nbsp;HW type&nbsp; &nbsp; &nbsp;Flags&nbsp; &nbsp; &nbsp; &nbsp;HW address&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Mask&nbsp; &nbsp; &nbsp;Device<br />192.168.108.3&nbsp; &nbsp; 0x1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;00:00:00:00:00:00&nbsp; &nbsp; &nbsp;*&nbsp; &nbsp; &nbsp; &nbsp; br-lan<br />192.168.108.210&nbsp; 0x1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;00:E0:A6:78:5A:13&nbsp; &nbsp; &nbsp;*&nbsp; &nbsp; &nbsp; &nbsp; br-lan<br />192.168.108.254&nbsp; 0x1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;00:00:00:00:00:00&nbsp; &nbsp; &nbsp;*&nbsp; &nbsp; &nbsp; &nbsp; br-lan</p><br /><p>192.168.108.210 is my laptop connected to FonSTA on ethernet interface, 192.168.108.254 is a WRT-54GL which is the gateway to the internet. </p><p>When I tcpdump on the FonAP I don&#039;t see any packets conming from the FonSTA.</p><p>When I tcpdump on the FonSTA I can see there are arp packets coming from the FonAP. </p><p>01:07:26.738486 arp who-has 192.168.108.2 tell 192.168.108.3<br />01:07:26.738831 arp reply 192.168.108.2 is-at 00:18:84:1e:7b:d0 (oui Unknown)</p><br /><p>As I can see the FonAP can send packets to the FonSTA, but the FonSTA can&#039;t send to the FonAP.<br />I can connect to the FonAP with my laptop via Wifi.</p><p>I tried the Routed client mode <a href="http://wiki.openwrt.org/ClientModeKamikazeStyleHowto">http://wiki.openwrt.org/ClientModeKamikazeStyleHowto</a> and it works, but I would like to use in Bridged client mode</p><br /><p>What is the problem ? Could you help me?</p><p>Thanks!</p>											<p class="post-edited">(Last edited by <strong>turrican</strong> on 14 Jan 2008, 21:10)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p61719">
				<div class="post-metadata">
					<div class="post-num">Post #35</div>
					<div class="post-author">j0inty</div>
					<div class="post-datetime">
						15 Jan 2008, 22:37					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>Best thanks for this much informations, so I can try to better understand your configuration.</p><p>1. Lets sort your infos, because I don&#039;t understand something.</p><p>Your AP is possible to get via ARP the STA mac address ?? But the STA doesn&#039;t store this mac address correctly or none.<br /></p><div class="codebox"><pre><code>When I tcpdump on the FonSTA I can see there are arp packets coming from the FonAP.

01:07:26.738486 arp who-has 192.168.108.2 tell 192.168.108.3
01:07:26.738831 arp reply 192.168.108.2 is-at 00:18:84:1e:7b:d0 (oui Unknown)</code></pre></div><p>But now the arp table show 00:00:00.... for the AP on STA<br /></p><div class="codebox"><pre><code>root@FonSTA:~# arp
IP address       HW type     Flags       HW address            Mask     Device
192.168.108.3    0x1         0x0         00:00:00:00:00:00     *        br-lan (wlan)
192.168.108.210  0x1         0x2         00:E0:A6:78:5A:13     *        br-lan (lan)
192.168.108.254  0x1         0x0         00:00:00:00:00:00     *        br-lan (wlan)</code></pre></div><p>Hmmmm, sounds bad <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> . You wrote that your AP is seeing that the STA in connected via wlan. <br /></p><div class="codebox"><pre><code>root@FonAP:~# wlanconfig ath0 list
ADDR               AID CHAN RATE RSSI  DBM  IDLE  TXSEQ  TXFRAG  RXSEQ  RXFRAG CAPS ACAPS ERP    STATE     MODE
00:18:84:1e:7b:d1    1    5  36M   37  -58   180     90       5   2457       0 ESs          0        7   Normal WME ATH</code></pre></div><p>Does the hostapd running on the STA ???<br />It seems that something is blocking the traffic.<br />From&amp;To the bridge interface <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" />. For ath0 it seems to work.<br />The arp request from AP will returned with a successfull arp reply from the STA.</p><p>Thats my /etc/hostapd.conf. I post that because every one&nbsp; sends me three lines and that can&#039;t it be.<br /></p><div class="codebox"><pre><code>root@fonera:~# cat /etc/hostapd.conf | grep -vh &#039;^[[:space:]]*\(#\|$\)&#039; &quot;$@&quot;
interface=ath0
bridge=br-lan
driver=madwifi
logger_syslog=-1
logger_syslog_level=2
logger_stdout=-1
logger_stdout_level=2
debug=0
dump_file=/tmp/hostapd.dump
ssid=wpa-test
eapol_key_index_workaround=0
eap_server=0
own_ip_addr=127.0.0.1
wpa=1
wpa_passphrase=&lt;wpa key&gt;
wpa_key_mgmt=WPA-PSK WPA-EAP
wpa_pairwise=TKIP CCMP
root@fonera:~#

root@fonera:~# cat /etc/config/network | grep -vh &#039;^[[:space:]]*\(#\|$\)&#039; &quot;$@&quot;
config interface loopback
        option ifname   lo
        option proto    static
        option ipaddr   127.0.0.1
        option netmask  255.0.0.0
config interface lan
        option ifname   eth0
        option type     bridge
        option proto    static
        option ipaddr   192.168.0.60
        option netmask  255.255.255.0
        option gateway  192.168.0.1
root@fonera:~# cat /etc/config/wireless | grep -vh &#039;^[[:space:]]*\(#\|$\)&#039; &quot;$@&quot;
config wifi-device  wifi0
        option type     atheros
        option channel  1
        option mode     11bg
        option diversity 0
        option txantenna 1
        option rxantenna 1
        option disabled 0
config wifi-iface
        option device   wifi0
        option network  lan
        option mode     ap
        option ssid     &lt;ssid&gt;
        option hidden   0
        option bgscan   0
        option encryption psk2
        option key      &lt;wpa_key&gt;
        option macfilter allow  # or deny
        option maclist 00:0C:6F:AF:30:7F
root@fonera:~#</code></pre></div><p>regards<br />j0inty</p>											<p class="post-edited">(Last edited by <strong>j0inty</strong> on 15 Jan 2008, 22:45)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p61729">
				<div class="post-metadata">
					<div class="post-num">Post #36</div>
					<div class="post-author">eleon216</div>
					<div class="post-datetime">
						16 Jan 2008, 01:08					</div>
				</div>
				<div class="post-content content">
					<p>@turrican and all other guys, who try to get bridged-client-mode working:</p><p>I guess the reason why you have troubles getting your wireless bridge in station mode running, is that itÂ´s not really supported. <br />if you stick with the 801.11g specifications you have two options: use station-mode to connect the ap and your client-router and handle to connection to client behind the &quot;wireless-bridge&quot; through layer3 (ip-routing). <br />or you use a wds-link between the two routers and bridge it to the local networks. wds was build for this purpose and will work! <br />The problem is, that in a &quot;normal&quot; wifi-frame you can only specify one source and one destination mac-address.<br />but you would need the source and destination address of wifi-link and the addresses of the &quot;real&quot; source and destination machines behind the routers. in a wds-package you have this 4 adresses, in a &quot;normal&quot; package you have only two addressfields, so bridging in stationmode canÂ´t work! (sorry I donÂ´t now all technical terms but I hope you get it)</p><p>ok it&nbsp; can work, but it canÂ´t work without tricks. there are some approaches to make it work.<br />the wet-mode of the broadcom-driver, does some sort of arp masquerading to achieve this. (this mode should work in whiterussian, so give it a try if you really want to use it)<br />or you can have a look at this: <br /><a href="http://wiki.openwrt.org/WirelessBridgeWithWPAHowto">http://wiki.openwrt.org/WirelessBridgeWithWPAHowto</a><br />there is an implementation with&nbsp; parprouted (a daemon for transparent IP (Layer 3) proxy ARP bridging) and a dhcp-forwarder cause the &quot;brigding&quot; with parprouted only works for ip packages, and so dhcp canÂ´t be forwarded with it. </p><p>so maybe you get the wet-mode running, or something that works as a bridge for ip-packages, and be happy with it. </p><p>but I really would recommend to use wds to create a real wireless bridge, or use routed-client-mode. <br />so learn a little bit about WDS, or ip-routing, and you should be able to create a wireless bridge which will meet your requirements (without strange arp-, dhcp- or whatever-problems) and your configuration would be&nbsp; 801.11g-compliant!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p62029">
				<div class="post-metadata">
					<div class="post-num">Post #37</div>
					<div class="post-author">turrican</div>
					<div class="post-datetime">
						21 Jan 2008, 17:58					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for your answer!</p><p>j0inty:</p><p>The hostapd runs on the AP.<br />Unfortunately, my AP can&#039;t get the mac address of the STA. The STA receives the ARP request, and tries to send the reply back to the AP, but the AP doesn&#039;t receive.<br />If I connecting my laptop to the AP via ath0 everything works well, so I think the STA blocks the outgoing traffic.</p><p>eleon216:</p><p>I will try the WDS. The Routed client mode works, but that is not my goal.</p><p>Thank you!</p>											<p class="post-edited">(Last edited by <strong>turrican</strong> on 21 Jan 2008, 17:59)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 2 of 2</div><nav><ul><li><a href="viewtopic.php%3Fid=13591&amp;p=1.html">1</a></li><li class="pagination-current"><span>2</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>