<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> upgrade TL-WR1043ND firmware using ssh?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 18 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p169820">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">chessman</div>
					<div class="post-datetime">
						12 Jun 2012, 14:00					</div>
				</div>
				<div class="post-content content">
					<p>Does anyone know the correct SSH command to use to upgrade the firmware on a TL-WR1043ND thats already running openwrt backfire 10.03.1 ?</p><p>Currently for the WRT45GL im using the following:<br />mtd -r write /tmp/upgrade.trx linux</p><p>but assuming different for the TL-WR1043ND, I cant find any trx files in the bin dir after compiling<br />Is it something like this:<br />mtd -e mtd2 write openwrt-ar71xx-tl-wr1043nd-v1-squashfs-sysupgrade.bin mtd2<br />Is that file correct?</p><p>I need confirmation of correct command and file to use so I don&#039;t end up bricking my router.</p><p>Ive got a script which automates the firmware upgrade on the WRT54GL and downloads new compiled firmware from my server using wget then flashes it.&nbsp; Works without problems but id like to apply it to the TL-WR1043ND aswell.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p169821">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">anthoferd</div>
					<div class="post-datetime">
						12 Jun 2012, 14:07					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m using the following command to install firmware on my TL-MR3220:</p><div class="codebox"><pre><code>mtd -r write /tmp/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin firmware</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p169830">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">eleon216</div>
					<div class="post-datetime">
						12 Jun 2012, 15:05					</div>
				</div>
				<div class="post-content content">
					<p>just use the &quot;sysupgrade&quot;-command, and you can decide of you want a keep your config or not. Make sure you use the sysupgrade-image not the factory</p>											<p class="post-edited">(Last edited by <strong>eleon216</strong> on 12 Jun 2012, 15:06)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p169864">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">chessman</div>
					<div class="post-datetime">
						13 Jun 2012, 00:07					</div>
				</div>
				<div class="post-content content">
					<p>just tried the following:</p><p>sysupgrade hxxp://x.x.x.x/openwrt-ar71xx-tl-wr1043nd-v1-squashfs-sysupgrade.bin</p><p>now router bricked, I dont know if I can get it back since this one doesnt support writing to flash through jtag</p><p>It started ok, started downloading firmware and flashing it then locked up.&nbsp; Any ideas?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p169877">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">chessman</div>
					<div class="post-datetime">
						13 Jun 2012, 07:16					</div>
				</div>
				<div class="post-content content">
					<p>ok i&#039;ve managed to solder up a max3232 with some 100n ceramic caps etc I had lying around and got into the serial console.</p><p>Got the following:<br />What should I do from here?</p><br /><p>U-Boot 1.1.4 (Apr 28 2011 - 15:55:09)</p><p>AP83 (ar9100) U-boot 0.0.11<br />DRAM:<br />sri<br />32 MB<br />id read 0x100000ff<br />flash size 8MB, sector count = 128<br />Flash:&nbsp; 8 MB<br />Using default environment</p><p>In:&nbsp; &nbsp; serial<br />Out:&nbsp; &nbsp;serial<br />Err:&nbsp; &nbsp;serial<br />Net:&nbsp; &nbsp;ag7100_enet_initialize...<br />No valid address in Flash. Using fixed address<br />: cfg1 0xf cfg2 0x7114<br />eth0: 00:03:7f:09:0b:ad<br />eth0 up<br />eth0<br />Autobooting in 1 seconds## Booting image at bf020000 ...<br />&nbsp; &nbsp;Uncompressing Kernel Image ... OK</p><p>Starting kernel ...</p><p>Linux version 2.6.32.27 (xxxxxxx@xxxxxxxxxxxx) (gcc version 4.3.3 (GCC) ) #18 Mon Jun 11 21:22:43 NZST 2012<br />bootconsole [early0] enabled<br />CPU revision is: 00019374 (MIPS 24Kc)<br />Atheros AR9132 rev 2, CPU:400.000 MHz, AHB:200.000 MHz, DDR:400.000 MHz<br />Determined physical RAM map:<br /> memory: 02000000 @ 00000000 (usable)<br />Initrd not found or empty - disabling initrd<br />Zone PFN ranges:<br />&nbsp; Normal&nbsp; &nbsp;0x00000000 -&gt; 0x00002000<br />Movable zone start PFN for each node<br />early_node_map[1] active PFN ranges<br />&nbsp; &nbsp; 0: 0x00000000 -&gt; 0x00002000<br />Built 1 zonelists in Zone order, mobility grouping on.&nbsp; Total pages: 8128<br />Kernel command line: rootfstype=squashfs,yaffs,jffs2 noinitrd console=ttyS0,115200 board=TL-WR1043ND<br />PID hash table entries: 128 (order: -3, 512 bytes)<br />Dentry cache hash table entries: 4096 (order: 2, 16384 bytes)<br />Inode-cache hash table entries: 2048 (order: 1, 8192 bytes)<br />Primary instruction cache 64kB, VIPT, 4-way, linesize 32 bytes.<br />Primary data cache 32kB, 4-way, VIPT, cache aliases, linesize 32 bytes<br />Writing ErrCtl register=00000000<br />Readback ErrCtl register=00000000<br />Memory: 29384k/32768k available (2045k kernel code, 3384k reserved, 405k data, 148k init, 0k highmem)<br />SLUB: Genslabs=7, HWalign=32, Order=0-3, MinObjects=0, CPUs=1, Nodes=1<br />Hierarchical RCU implementation.<br />NR_IRQS:56<br />Calibrating delay loop... 266.24 BogoMIPS (lpj=1331200)<br />Mount-cache hash table entries: 512<br />NET: Registered protocol family 16<br />MIPS: machine is TP-LINK TL-WR1043ND<br />bio: create slab &lt;bio-0&gt; at 0<br />Switching to clocksource MIPS<br />NET: Registered protocol family 2<br />IP route cache hash table entries: 1024 (order: 0, 4096 bytes)<br />TCP established hash table entries: 1024 (order: 1, 8192 bytes)<br />TCP bind hash table entries: 1024 (order: 0, 4096 bytes)<br />TCP: Hash tables configured (established 1024 bind 1024)<br />TCP reno registered<br />NET: Registered protocol family 1<br />squashfs: version 4.0 (2009/01/31) Phillip Lougher<br />Registering mini_fo version $Id$<br />JFFS2 version 2.2. (NAND) (SUMMARY)&nbsp; Â© 2001-2006 Red Hat, Inc.<br />yaffs Apr 13 2012 16:02:38 Installing.<br />msgmni has been set to 57<br />io scheduler noop registered<br />io scheduler deadline registered (default)<br />Serial: 8250/16550 driver, 1 ports, IRQ sharing disabled<br />serial8250.0: ttyS0 at MMIO 0x18020000 (irq = 11) is a 16550A<br />console [ttyS0] enabled, bootconsole disabled<br />console [ttyS0] enabled, bootconsole disabled<br />Atheros AR71xx SPI Controller driver version 0.2.4<br />m25p80 spi0.0: s25sl064a (8192 Kbytes)<br />Searching for RedBoot partition table in spi0.0 at offset 0x7e0000<br />Searching for RedBoot partition table in spi0.0 at offset 0x7f0000<br />No RedBoot partition table detected in spi0.0<br />spi0.0: no WRT160NL signature found<br />Creating 5 MTD partitions on &quot;spi0.0&quot;:<br />0x000000000000-0x000000020000 : &quot;u-boot&quot;<br />0x000000020000-0x000000160000 : &quot;kernel&quot;<br />0x000000160000-0x0000007f0000 : &quot;rootfs&quot;<br />mtd: partition &quot;rootfs&quot; set to be root filesystem<br />mtd: partition &quot;rootfs_data&quot; created automatically, ofs=370000, len=480000<br />0x000000370000-0x0000007f0000 : &quot;rootfs_data&quot;<br />0x0000007f0000-0x000000800000 : &quot;art&quot;<br />0x000000020000-0x0000007f0000 : &quot;firmware&quot;<br />Realtek RTL8366RB ethernet switch driver version 0.2.3<br />rtl8366rb rtl8366rb: using GPIO pins 18 (SDA) and 19 (SCK)<br />rtl8366rb rtl8366rb: RTL5937 ver. 3 chip found<br />rtl8366rb: probed<br />eth0: Atheros AG71xx at 0xb9000000, irq 4<br />Atheros AR71xx hardware watchdog driver version 0.1.0<br />TCP westwood registered<br />NET: Registered protocol family 17<br />802.1Q VLAN Support v1.8 Ben Greear &lt;greearb@candelatech.com&gt;<br />All bugs added by David S. Miller &lt;davem@redhat.com&gt;<br />VFS: Mounted root (squashfs filesystem) readonly on device 31:2.<br />Freeing unused kernel memory: 148k freed<br />Please be patient, while OpenWrt loads ...<br />CPU 0 Unable to handle kernel paging request at virtual address c00895b1, epc == 8016c440, ra == 8016c3b8<br />Oops[#1]:<br />Cpu 0</p>											<p class="post-edited">(Last edited by <strong>chessman</strong> on 13 Jun 2012, 07:17)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p169883">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">ninno</div>
					<div class="post-datetime">
						13 Jun 2012, 08:36					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>chessman wrote:</cite><blockquote><p>ok i&#039;ve managed to solder up a max3232 with some 100n ceramic caps etc I had lying around and got into the serial console.</p><p>Got the following:<br />What should I do from here?</p><br /><p>U-Boot 1.1.4 (Apr 28 2011 - 15:55:09)</p><br /><p>eth0 up<br />eth0<br />Autobooting in 1 seconds## Booting image at bf020000 ...<br />&nbsp; &nbsp;Uncompressing Kernel Image ... OK</p><p>Starting kernel ...<br />...<br />CPU 0 Unable to handle kernel paging request at virtual address c00895b1, epc == 8016c440, ra == 8016c3b8<br />Oops[#1]:<br />Cpu 0</p></blockquote></div><p>Just follow the wiki:<br /><a href="http://wiki.openwrt.org/toh/tp-link/tl-wr1043nd#recovery.via.serial.console">http://wiki.openwrt.org/toh/tp-link/tl- … al.console</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p169887">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">chessman</div>
					<div class="post-datetime">
						13 Jun 2012, 10:31					</div>
				</div>
				<div class="post-content content">
					<p>thanks, I managed to reflash using tftp.</p><p>the correct commands to use for SSH upgrade from internet is:</p><p>wget -O /tmp/openwrt-ar71xx-tl-wr1043nd-v1-squashfs-factory.bin hxxp://x.x.x.x/openwrt-ar71xx-tl-wr1043nd-v1-squashfs-factory.bin<br />mtd -r write /tmp/openwrt-ar71xx-tl-wr1043nd-v1-squashfs-factory.bin firmware</p><p>I can confirm that definitely works on a TL-WR1043ND v1.8, have just tried it.</p><p>I did also try &quot;openwrt-ar71xx-tl-wr1043nd-v1-squashfs-sysupgrade.bin&quot; instead of &quot;openwrt-ar71xx-tl-wr1043nd-v1-squashfs-factory.bin&quot; but ended up with another bad flash, had to use tftp again to recover.</p>											<p class="post-edited">(Last edited by <strong>chessman</strong> on 13 Jun 2012, 10:33)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>