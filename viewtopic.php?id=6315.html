<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Editing kernel command line</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 21 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p29830">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">star882</div>
					<div class="post-datetime">
						2 Jul 2006, 18:35					</div>
				</div>
				<div class="post-content content">
					<p>How do I edit the kernel command line of an image? (Or how to build an image with a custom kernel command line.)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p29836">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">rohde</div>
					<div class="post-datetime">
						2 Jul 2006, 20:28					</div>
				</div>
				<div class="post-content content">
					<p>Setting the nvram variable kernel_args should do the job.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p29841">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">florian_</div>
					<div class="post-datetime">
						2 Jul 2006, 23:23					</div>
				</div>
				<div class="post-content content">
					<p>Or directly modify the kernel configuration file located in target/linux/&lt;your arch&gt;/config</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p30184">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">star882</div>
					<div class="post-datetime">
						8 Jul 2006, 06:51					</div>
				</div>
				<div class="post-content content">
					<p>I tried setting the variable but it didn&#039;t work.<br />In &quot;target/linux&quot;, the folders are &quot;control&quot;, &quot;image&quot;, imagebuilder&quot;, &quot;linux-2.4&quot;, and &quot;package&quot;. In &quot;linux-2.4/config&quot; are 3 files named &quot;brcm&quot;, &quot;brcm~&quot;, and &quot;brcm.modules&quot;. I tried opening all three and neither file seems to have the kernel command line. What do I do? (I use whiterussian RC5.)</p><p>At least I got the router to see my USB Flash drive! So for now, I can get the router to detect the drive but not boot from it. I got close, though!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p30189">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">florian_</div>
					<div class="post-datetime">
						8 Jul 2006, 14:27					</div>
				</div>
				<div class="post-content content">
					<p>From : target/linux/linux-2.4/config/brcm</p><div class="codebox"><pre><code>CONFIG_CMDLINE=&quot;root=/dev/mtdblock2 rootfstype=squashfs,jffs2 init=/etc/preinit noinitrd console=ttyS0,115200&quot;</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p30197">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">star882</div>
					<div class="post-datetime">
						8 Jul 2006, 17:20					</div>
				</div>
				<div class="post-content content">
					<p>I got it edited (and the router acknowledges the change), but it still doesn&#039;t want to boot. Under what device name does a USB drive show up as? (I tried &quot;/dev/sda&quot;.)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p30228">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">florian_</div>
					<div class="post-datetime">
						9 Jul 2006, 14:01					</div>
				</div>
				<div class="post-content content">
					<p>Usually, you have formatted your USB device, so it mus be something valid such as /dev/sda1, sda2 or anything else according to your partition table.</p><p>Try plugging your device in a linux or unix-like computer and see which partition seems to be mountable</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p30234">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">star882</div>
					<div class="post-datetime">
						9 Jul 2006, 18:01					</div>
				</div>
				<div class="post-content content">
					<p>There is no partition table on the drive. On a PC, it shows up as &quot;/dev/sda&quot;. It&#039;s formatted as ext3, which I have enabled support for in the kernel.<br />I think the problem is the delay. It takes a few seconds for the drive to initialize. How do I make the router wait before trying to mount the drive?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p30235">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">wtzm</div>
					<div class="post-datetime">
						9 Jul 2006, 18:57					</div>
				</div>
				<div class="post-content content">
					<p>Just a quick thought: Have you actually built in in all the necessary options into you kernel (usb, usb-storage, scsi, ext3)? Your drive will also get recognized if these are built as modules; but these modules are of course not available before mounting the rootfs.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p30244">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">star882</div>
					<div class="post-datetime">
						9 Jul 2006, 23:53					</div>
				</div>
				<div class="post-content content">
					<p>Yes, I did do that. The router actually loads the USB and mass storage drivers but crashes before the drive initializes. The delay between the driver loading and the kernel panic message is very small - about 1/8 of a second or so, which is clearly not enough. The drive takes about 7 seconds to initialize when plugged into a regular Linux system. (I&#039;ll set a delay of maybe 10-15 seconds to ensure reliability, or better yet, have it wait until the drive is detected.)<br />So, I&#039;ll just need to know how to set a delay before mounting the drive and I&#039;ll continue to work from there. If I get it to work, I&#039;ll post the complete guide!</p><p>EDIT: I just thought about an alternate solution.<br />Put a ramdisk image on the router Flash somehow, which the router will first boot to. In the image will be a shell script that will keep on trying to mount the USB drive until it mounts. Then it switches root to the USB drive, gets rid of the ramdisk, and continues to boot as usual.<br />If a certain keystroke (thinking Ctrl-C) is typed as it is in the &quot;USB bootloader&quot;, it provides a simple user interface for troubleshooting (e.g. cut down versions of lsusb and a few basic UNIX commands).</p>											<p class="post-edited">(Last edited by <strong>star882</strong> on 10 Jul 2006, 07:56)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p30263">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">mangoo</div>
					<div class="post-datetime">
						10 Jul 2006, 15:01					</div>
				</div>
				<div class="post-content content">
					<p>With 2.6 kernels, setting the delay is easy: rootdelay=10 would make a 10-sec delay before kernel attempts to mount the rootfs.<br />It&#039;s sufficent for most USB devices.</p><p>With 2.4 kernels it&#039;s more problematic, and to have the same effect, the kernel needs patching.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p30331">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">star882</div>
					<div class="post-datetime">
						11 Jul 2006, 21:26					</div>
				</div>
				<div class="post-content content">
					<p>I just compiled the 2.6 kernel (kamikaze), and I couldn&#039;t get it to boot even with the delay. Can someone post a cut down OpenWRT image that runs on a Belkin v2000? I suspect a wiring mistake or something. I&#039;ll try to get it to work after bootup before trying to make the router boot from the drive.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>