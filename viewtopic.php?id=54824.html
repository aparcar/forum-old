<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Unable to compile U-Boot</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 22 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p259168">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">radekn</div>
					<div class="post-datetime">
						30 Dec 2014, 12:14					</div>
				</div>
				<div class="post-content content">
					<p>After U-Boot upgrade to 2014.10 I am unable to compile it. </p><div class="codebox"><pre><code>make[4]: Entering directory `/home/openwrt/openwrt/trunk/build_dir/host/u-boot-2014.10&#039;
  CHK     include/config/uboot.release
  CHK     include/generated/version_autogenerated.h
  CHK     include/generated/timestamp_autogenerated.h
  UPD     include/generated/timestamp_autogenerated.h
  HOSTCC  tools/dumpimage.o
  HOSTCC  tools/image-host.o
  HOSTCC  tools/mkenvimage.o
  HOSTCC  tools/mkimage.o
  HOSTLD  tools/mkenvimage
  HOSTLD  tools/dumpimage
/usr/lib/gcc/x86_64-linux-gnu/4.7/../../../x86_64-linux-gnu/libcrypto.a(c_zlib.o): In function `bio_zlib_free&#039;:
(.text+0x4d): undefined reference to `inflateEnd&#039;
/usr/lib/gcc/x86_64-linux-gnu/4.7/../../../x86_64-linux-gnu/libcrypto.a(c_zlib.o): In function `bio_zlib_free&#039;:
(.text+0x6b): undefined reference to `deflateEnd&#039;
/usr/lib/gcc/x86_64-linux-gnu/4.7/../../../x86_64-linux-gnu/libcrypto.a(c_zlib.o): In function `bio_zlib_ctrl&#039;:
(.text+0x284): undefined reference to `deflate&#039;
/usr/lib/gcc/x86_64-linux-gnu/4.7/../../../x86_64-linux-gnu/libcrypto.a(c_zlib.o): In function `bio_zlib_ctrl&#039;:
(.text+0x342): undefined reference to `zError&#039;
/usr/lib/gcc/x86_64-linux-gnu/4.7/../../../x86_64-linux-gnu/libcrypto.a(c_zlib.o): In function `zlib_stateful_expand_block&#039;:
(.text+0x411): undefined reference to `inflate&#039;
/usr/lib/gcc/x86_64-linux-gnu/4.7/../../../x86_64-linux-gnu/libcrypto.a(c_zlib.o): In function `zlib_stateful_compress_block&#039;:
(.text+0x4ca): undefined reference to `deflate&#039;
/usr/lib/gcc/x86_64-linux-gnu/4.7/../../../x86_64-linux-gnu/libcrypto.a(c_zlib.o): In function `zlib_stateful_finish&#039;:
(.text+0x51f): undefined reference to `inflateEnd&#039;
/usr/lib/gcc/x86_64-linux-gnu/4.7/../../../x86_64-linux-gnu/libcrypto.a(c_zlib.o): In function `zlib_stateful_finish&#039;:
(.text+0x528): undefined reference to `deflateEnd&#039;
/usr/lib/gcc/x86_64-linux-gnu/4.7/../../../x86_64-linux-gnu/libcrypto.a(c_zlib.o): In function `zlib_stateful_init&#039;:
(.text+0x5d7): undefined reference to `inflateInit_&#039;
/usr/lib/gcc/x86_64-linux-gnu/4.7/../../../x86_64-linux-gnu/libcrypto.a(c_zlib.o): In function `zlib_stateful_init&#039;:
(.text+0x659): undefined reference to `deflateInit_&#039;
/usr/lib/gcc/x86_64-linux-gnu/4.7/../../../x86_64-linux-gnu/libcrypto.a(c_zlib.o): In function `bio_zlib_read&#039;:
(.text+0x893): undefined reference to `inflate&#039;
/usr/lib/gcc/x86_64-linux-gnu/4.7/../../../x86_64-linux-gnu/libcrypto.a(c_zlib.o): In function `bio_zlib_read&#039;:
(.text+0x90d): undefined reference to `zError&#039;
/usr/lib/gcc/x86_64-linux-gnu/4.7/../../../x86_64-linux-gnu/libcrypto.a(c_zlib.o): In function `bio_zlib_read&#039;:
(.text+0x97c): undefined reference to `inflateInit_&#039;
/usr/lib/gcc/x86_64-linux-gnu/4.7/../../../x86_64-linux-gnu/libcrypto.a(c_zlib.o): In function `bio_zlib_write&#039;:
(.text+0xaab): undefined reference to `deflate&#039;
/usr/lib/gcc/x86_64-linux-gnu/4.7/../../../x86_64-linux-gnu/libcrypto.a(c_zlib.o): In function `bio_zlib_write&#039;:
(.text+0xb3d): undefined reference to `zError&#039;
/usr/lib/gcc/x86_64-linux-gnu/4.7/../../../x86_64-linux-gnu/libcrypto.a(c_zlib.o): In function `bio_zlib_write&#039;:
(.text+0xbcd): undefined reference to `deflateInit_&#039;
/usr/lib/gcc/x86_64-linux-gnu/4.7/../../../x86_64-linux-gnu/libcrypto.a(dso_dlfcn.o): In function `dlfcn_globallookup&#039;:
(.text+0x19): undefined reference to `dlopen&#039;
/usr/lib/gcc/x86_64-linux-gnu/4.7/../../../x86_64-linux-gnu/libcrypto.a(dso_dlfcn.o): In function `dlfcn_globallookup&#039;:
(.text+0x2c): undefined reference to `dlsym&#039;
/usr/lib/gcc/x86_64-linux-gnu/4.7/../../../x86_64-linux-gnu/libcrypto.a(dso_dlfcn.o): In function `dlfcn_globallookup&#039;:
(.text+0x37): undefined reference to `dlclose&#039;
/usr/lib/gcc/x86_64-linux-gnu/4.7/../../../x86_64-linux-gnu/libcrypto.a(dso_dlfcn.o): In function `dlfcn_bind_func&#039;:
(.text+0x354): undefined reference to `dlsym&#039;
/usr/lib/gcc/x86_64-linux-gnu/4.7/../../../x86_64-linux-gnu/libcrypto.a(dso_dlfcn.o): In function `dlfcn_bind_func&#039;:
(.text+0x3fb): undefined reference to `dlerror&#039;
/usr/lib/gcc/x86_64-linux-gnu/4.7/../../../x86_64-linux-gnu/libcrypto.a(dso_dlfcn.o): In function `dlfcn_bind_var&#039;:
(.text+0x474): undefined reference to `dlsym&#039;
/usr/lib/gcc/x86_64-linux-gnu/4.7/../../../x86_64-linux-gnu/libcrypto.a(dso_dlfcn.o): In function `dlfcn_bind_var&#039;:
(.text+0x52e): undefined reference to `dlerror&#039;
/usr/lib/gcc/x86_64-linux-gnu/4.7/../../../x86_64-linux-gnu/libcrypto.a(dso_dlfcn.o): In function `dlfcn_load&#039;:
(.text+0x5a2): undefined reference to `dlopen&#039;
/usr/lib/gcc/x86_64-linux-gnu/4.7/../../../x86_64-linux-gnu/libcrypto.a(dso_dlfcn.o): In function `dlfcn_load&#039;:
(.text+0x60b): undefined reference to `dlclose&#039;
/usr/lib/gcc/x86_64-linux-gnu/4.7/../../../x86_64-linux-gnu/libcrypto.a(dso_dlfcn.o): In function `dlfcn_load&#039;:
(.text+0x638): undefined reference to `dlerror&#039;
/usr/lib/gcc/x86_64-linux-gnu/4.7/../../../x86_64-linux-gnu/libcrypto.a(dso_dlfcn.o): In function `dlfcn_pathbyaddr&#039;:
(.text+0x6cd): undefined reference to `dladdr&#039;
/usr/lib/gcc/x86_64-linux-gnu/4.7/../../../x86_64-linux-gnu/libcrypto.a(dso_dlfcn.o): In function `dlfcn_pathbyaddr&#039;:
(.text+0x729): undefined reference to `dlerror&#039;
/usr/lib/gcc/x86_64-linux-gnu/4.7/../../../x86_64-linux-gnu/libcrypto.a(dso_dlfcn.o): In function `dlfcn_unload&#039;:
(.text+0x78a): undefined reference to `dlclose&#039;
collect2: error: ld returned 1 exit status
make[5]: *** [tools/dumpimage] Error 1
make[4]: *** [tools-only] Error 2
make[4]: Leaving directory `/home/openwrt/openwrt/trunk/build_dir/host/u-boot-2014.10&#039; </code></pre></div><p>My system is Debian 7.7 (amd64). I know it must be something missing somewhere, but I am unable to find what. <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /><br />Nearly identical bug is already reported <a href="https://dev.openwrt.org/ticket/18546">here</a>.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p259190">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">mk24</div>
					<div class="post-datetime">
						30 Dec 2014, 16:47					</div>
				</div>
				<div class="post-content content">
					<p>You&#039;re using the wrong libcrypto.&nbsp; The u-boot code is trying to call library functions which don&#039;t exist in the library.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p259217">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">zloop</div>
					<div class="post-datetime">
						30 Dec 2014, 19:12					</div>
				</div>
				<div class="post-content content">
					<p>Can you provide the output of &quot;scripts/diffconfig.sh&quot; ?</p><p>Did you run your config from a clean checkout ?</p><p>I was trying to run a normal compile in a Debian 7 VM (cat /etc/debian_version prints 7.7)<br />and it compiles fine.</p><p>Background:<br />The host/u-boot.... is compiled by tools/mkimage and that is normally NOT cleaned up with a simple &quot;make clean&quot;</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p259222">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">radekn</div>
					<div class="post-datetime">
						30 Dec 2014, 19:45					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ve performed <strong>make dirclean</strong> several times. I&#039;ve even deleted everything in staging_dir and build_dir manually.<br />What do you mean &quot;clean checkout&quot;? I am compiling from trunk, rev. 43797 right now (but this error is several weeks old).</p><p><strong>DiffConfig output:</strong><br /></p><div class="codebox"><pre><code>CONFIG_TARGET_brcm47xx=y
CONFIG_TARGET_brcm47xx_generic=y
CONFIG_TARGET_brcm47xx_generic_Broadcom-b43=y
CONFIG_DEVEL=y
CONFIG_TOOLCHAINOPTS=y
CONFIG_B43_FW_SQUASH_COREREVS=&quot;5,6,7,8,9,10,11,13,15,16,29&quot;
CONFIG_BUILD_STATIC_TOOLS=y
# CONFIG_GDB is not set
CONFIG_GNUTLS_ALPN=y
CONFIG_GNUTLS_ANON=y
CONFIG_GNUTLS_DTLS_SRTP=y
CONFIG_GNUTLS_HEARTBEAT=y
CONFIG_GNUTLS_OCSP=y
CONFIG_GNUTLS_PSK=y
CONFIG_IMAGEOPT=y
# CONFIG_KERNEL_DEBUG_INFO is not set
# CONFIG_KERNEL_DEBUG_KERNEL is not set
# CONFIG_KERNEL_KALLSYMS is not set
CONFIG_OPENSSL_WITH_EC=y
CONFIG_OPENVPN_nossl_ENABLE_DEF_AUTH=y
CONFIG_OPENVPN_nossl_ENABLE_FRAGMENT=y
CONFIG_OPENVPN_nossl_ENABLE_HTTP=y
CONFIG_OPENVPN_nossl_ENABLE_IPROUTE2=y
CONFIG_OPENVPN_nossl_ENABLE_LZO=y
CONFIG_OPENVPN_nossl_ENABLE_MULTIHOME=y
CONFIG_OPENVPN_nossl_ENABLE_PF=y
CONFIG_OPENVPN_nossl_ENABLE_PORT_SHARE=y
CONFIG_OPENVPN_nossl_ENABLE_SERVER=y
CONFIG_OPENVPN_nossl_ENABLE_SMALL=y
CONFIG_OPENVPN_nossl_ENABLE_SOCKS=y
CONFIG_OPENVPN_openssl_ENABLE_DEF_AUTH=y
CONFIG_OPENVPN_openssl_ENABLE_FRAGMENT=y
CONFIG_OPENVPN_openssl_ENABLE_HTTP=y
CONFIG_OPENVPN_openssl_ENABLE_IPROUTE2=y
CONFIG_OPENVPN_openssl_ENABLE_LZO=y
CONFIG_OPENVPN_openssl_ENABLE_MULTIHOME=y
CONFIG_OPENVPN_openssl_ENABLE_PF=y
CONFIG_OPENVPN_openssl_ENABLE_PORT_SHARE=y
CONFIG_OPENVPN_openssl_ENABLE_SERVER=y
CONFIG_OPENVPN_openssl_ENABLE_SMALL=y
CONFIG_OPENVPN_openssl_ENABLE_SOCKS=y
CONFIG_OPENVPN_openssl_ENABLE_X509_ALT_USERNAME=y
CONFIG_PACKAGE_6in4=m
CONFIG_PACKAGE_6rd=m
CONFIG_PACKAGE_6to4=m
CONFIG_PACKAGE_6tunnel=m
CONFIG_PACKAGE_at=m
CONFIG_PACKAGE_bash=m
CONFIG_PACKAGE_blkid=y
CONFIG_PACKAGE_block-mount=y
CONFIG_PACKAGE_boxbackup=m
CONFIG_PACKAGE_collectd=y
CONFIG_PACKAGE_collectd-mod-interface=y
CONFIG_PACKAGE_collectd-mod-iwinfo=y
CONFIG_PACKAGE_collectd-mod-load=y
CONFIG_PACKAGE_collectd-mod-network=y
CONFIG_PACKAGE_collectd-mod-rrdtool=y
CONFIG_PACKAGE_ddns-scripts=y
CONFIG_PACKAGE_dhcp6-client=m
CONFIG_PACKAGE_dhcp6-server=m
CONFIG_PACKAGE_dosfsck=m
CONFIG_PACKAGE_e2fsprogs=m
CONFIG_PACKAGE_ebtables=m
CONFIG_PACKAGE_etherwake=y
CONFIG_PACKAGE_fetchmail=m
CONFIG_PACKAGE_fetchmail-nossl=m
CONFIG_PACKAGE_hostapd=m
CONFIG_PACKAGE_iconv=m
CONFIG_PACKAGE_imapfilter=y
CONFIG_PACKAGE_ip=y
CONFIG_PACKAGE_ip6tables=m
CONFIG_PACKAGE_iptables-mod-condition=m
CONFIG_PACKAGE_iptables-mod-conntrack-extra=m
CONFIG_PACKAGE_iptables-mod-filter=m
CONFIG_PACKAGE_iptables-mod-ipopt=m
CONFIG_PACKAGE_iptables-mod-led=m
CONFIG_PACKAGE_iptables-mod-lua=m
CONFIG_PACKAGE_iptables-mod-nat-extra=m
CONFIG_PACKAGE_iptables-mod-ulog=y
CONFIG_PACKAGE_iputils-traceroute6=m
CONFIG_PACKAGE_iwcap=m
CONFIG_PACKAGE_iwinfo=m
# CONFIG_PACKAGE_kmod-b43legacy is not set
# CONFIG_PACKAGE_kmod-bgmac is not set
CONFIG_PACKAGE_kmod-block2mtd=m
CONFIG_PACKAGE_kmod-bridge=m
CONFIG_PACKAGE_kmod-button-hotplug=y
CONFIG_PACKAGE_kmod-crypto-authenc=m
CONFIG_PACKAGE_kmod-crypto-cbc=m
CONFIG_PACKAGE_kmod-crypto-crc32c=m
CONFIG_PACKAGE_kmod-crypto-deflate=m
CONFIG_PACKAGE_kmod-crypto-des=m
CONFIG_PACKAGE_kmod-crypto-ecb=y
CONFIG_PACKAGE_kmod-crypto-hash=y
CONFIG_PACKAGE_kmod-crypto-hmac=m
CONFIG_PACKAGE_kmod-crypto-hw-geode=m
CONFIG_PACKAGE_kmod-crypto-hw-hifn-795x=m
CONFIG_PACKAGE_kmod-crypto-hw-padlock=m
CONFIG_PACKAGE_kmod-crypto-iv=m
CONFIG_PACKAGE_kmod-crypto-manager=y
CONFIG_PACKAGE_kmod-crypto-md4=m
CONFIG_PACKAGE_kmod-crypto-md5=m
CONFIG_PACKAGE_kmod-crypto-michael-mic=m
CONFIG_PACKAGE_kmod-crypto-misc=m
CONFIG_PACKAGE_kmod-crypto-null=m
CONFIG_PACKAGE_kmod-crypto-pcompress=y
CONFIG_PACKAGE_kmod-crypto-rng=m
CONFIG_PACKAGE_kmod-crypto-sha1=y
CONFIG_PACKAGE_kmod-crypto-sha256=m
CONFIG_PACKAGE_kmod-crypto-test=m
CONFIG_PACKAGE_kmod-crypto-user=m
CONFIG_PACKAGE_kmod-crypto-wq=m
CONFIG_PACKAGE_kmod-ebtables=m
CONFIG_PACKAGE_kmod-fs-autofs4=m
CONFIG_PACKAGE_kmod-fs-exportfs=m
CONFIG_PACKAGE_kmod-fs-ntfs=m
CONFIG_PACKAGE_kmod-fs-vfat=y
CONFIG_PACKAGE_kmod-fs-xfs=m
CONFIG_PACKAGE_kmod-fuse=m
CONFIG_PACKAGE_kmod-gpio-button-hotplug=m
CONFIG_PACKAGE_kmod-gpio-dev=m
# CONFIG_PACKAGE_kmod-hwmon-core is not set
CONFIG_PACKAGE_kmod-ifb=m
CONFIG_PACKAGE_kmod-input-core=y
CONFIG_PACKAGE_kmod-input-polldev=m
CONFIG_PACKAGE_kmod-ip6tables=m
CONFIG_PACKAGE_kmod-ipt-condition=m
CONFIG_PACKAGE_kmod-ipt-conntrack-extra=m
CONFIG_PACKAGE_kmod-ipt-filter=m
CONFIG_PACKAGE_kmod-ipt-ipopt=m
CONFIG_PACKAGE_kmod-ipt-led=m
CONFIG_PACKAGE_kmod-ipt-lua=m
CONFIG_PACKAGE_kmod-ipt-nat-extra=m
CONFIG_PACKAGE_kmod-ipt-ulog=y
CONFIG_PACKAGE_kmod-iptunnel=m
CONFIG_PACKAGE_kmod-iptunnel4=m
CONFIG_PACKAGE_kmod-iptunnel6=m
CONFIG_PACKAGE_kmod-ipv6=m
CONFIG_PACKAGE_kmod-leds-gpio=m
CONFIG_PACKAGE_kmod-ledtrig-default-on=m
CONFIG_PACKAGE_kmod-ledtrig-gpio=m
CONFIG_PACKAGE_kmod-ledtrig-heartbeat=m
CONFIG_PACKAGE_kmod-ledtrig-morse=m
CONFIG_PACKAGE_kmod-ledtrig-netdev=m
CONFIG_PACKAGE_kmod-ledtrig-netfilter=m
CONFIG_PACKAGE_kmod-ledtrig-timer=m
CONFIG_PACKAGE_kmod-ledtrig-usbdev=m
CONFIG_PACKAGE_kmod-lib-crc32c=m
CONFIG_PACKAGE_kmod-lib-textsearch=y
CONFIG_PACKAGE_kmod-lib-zlib=m
CONFIG_PACKAGE_kmod-llc=m
CONFIG_PACKAGE_kmod-loop=m
CONFIG_PACKAGE_kmod-nf-conntrack6=m
CONFIG_PACKAGE_kmod-nf-ipt6=m
CONFIG_PACKAGE_kmod-nls-base=y
CONFIG_PACKAGE_kmod-nls-cp1250=m
CONFIG_PACKAGE_kmod-nls-cp437=y
CONFIG_PACKAGE_kmod-nls-cp850=m
CONFIG_PACKAGE_kmod-nls-cp852=m
CONFIG_PACKAGE_kmod-nls-iso8859-1=y
CONFIG_PACKAGE_kmod-nls-iso8859-2=m
CONFIG_PACKAGE_kmod-nls-utf8=m
# CONFIG_PACKAGE_kmod-ppp is not set
# CONFIG_PACKAGE_kmod-pps is not set
# CONFIG_PACKAGE_kmod-ptp is not set
CONFIG_PACKAGE_kmod-random-core=m
CONFIG_PACKAGE_kmod-scsi-core=y
CONFIG_PACKAGE_kmod-scsi-generic=m
CONFIG_PACKAGE_kmod-sit=m
CONFIG_PACKAGE_kmod-stp=m
# CONFIG_PACKAGE_kmod-tg3 is not set
CONFIG_PACKAGE_kmod-tun=y
CONFIG_PACKAGE_kmod-usb-brcm47xx=y
CONFIG_PACKAGE_kmod-usb-core=y
CONFIG_PACKAGE_kmod-usb-ohci=y
CONFIG_PACKAGE_kmod-usb-storage=y
CONFIG_PACKAGE_kmod-usb-storage-extras=m
CONFIG_PACKAGE_kmod-usb-uhci=y
CONFIG_PACKAGE_kmod-usb2=y
CONFIG_PACKAGE_libblkid=y
CONFIG_PACKAGE_libcap=m
CONFIG_PACKAGE_libcharset=m
CONFIG_PACKAGE_libelf1=m
CONFIG_PACKAGE_libext2fs=m
CONFIG_PACKAGE_libgmp=y
CONFIG_PACKAGE_libgnutls=y
CONFIG_PACKAGE_libgnutls-openssl=y
CONFIG_PACKAGE_libiconv-full=m
CONFIG_PACKAGE_libintl-full=m
CONFIG_PACKAGE_libiwinfo-lua=y
CONFIG_PACKAGE_libjson=y
CONFIG_PACKAGE_libltdl=y
CONFIG_PACKAGE_liblua=y
CONFIG_PACKAGE_liblzo=y
CONFIG_PACKAGE_libmnl=m
CONFIG_PACKAGE_libncurses=y
CONFIG_PACKAGE_libncursesw=y
CONFIG_PACKAGE_libnettle=y
CONFIG_PACKAGE_libnfnetlink=m
CONFIG_PACKAGE_libopenssl=y
CONFIG_PACKAGE_libpcap=y
CONFIG_PACKAGE_libpcre=y
CONFIG_PACKAGE_libpthread=y
CONFIG_PACKAGE_libreadline=m
CONFIG_PACKAGE_librpc=m
CONFIG_PACKAGE_librrd1=y
CONFIG_PACKAGE_librt=y
CONFIG_PACKAGE_libstdcpp=m
CONFIG_PACKAGE_libsysfs=m
CONFIG_PACKAGE_libubus-lua=y
CONFIG_PACKAGE_libuci-lua=y
CONFIG_PACKAGE_libuuid=y
CONFIG_PACKAGE_lsof=m
CONFIG_PACKAGE_lua=y
CONFIG_PACKAGE_luasocket=m
CONFIG_PACKAGE_luci=y
CONFIG_PACKAGE_luci-app-ddns=y
CONFIG_PACKAGE_luci-app-firewall=y
CONFIG_PACKAGE_luci-app-ntpc=y
CONFIG_PACKAGE_luci-app-statistics=y
CONFIG_PACKAGE_luci-app-watchcat=y
CONFIG_PACKAGE_luci-app-wol=y
CONFIG_PACKAGE_luci-base=y
CONFIG_PACKAGE_luci-i18n-english=y
CONFIG_PACKAGE_luci-lib-httpclient=m
CONFIG_PACKAGE_luci-lib-json=m
CONFIG_PACKAGE_luci-lib-nixio=y
CONFIG_PACKAGE_luci-mod-admin-full=y
CONFIG_PACKAGE_luci-mod-failsafe=m
CONFIG_PACKAGE_luci-proto-ipv6=m
CONFIG_PACKAGE_luci-proto-ppp=y
CONFIG_PACKAGE_luci-proto-relay=m
CONFIG_PACKAGE_luci-theme-bootstrap=y
CONFIG_PACKAGE_luci-theme-openwrt=y
CONFIG_PACKAGE_mountd=m
CONFIG_PACKAGE_msmtp=m
CONFIG_PACKAGE_msmtp-nossl=m
CONFIG_PACKAGE_msmtp-queue=m
CONFIG_PACKAGE_mtd-utils=m
CONFIG_PACKAGE_mtd-utils-doc-loadbios=m
CONFIG_PACKAGE_mtd-utils-docfdisk=m
CONFIG_PACKAGE_mtd-utils-flash-erase=m
CONFIG_PACKAGE_mtd-utils-flash-eraseall=m
CONFIG_PACKAGE_mtd-utils-flash-lock=m
CONFIG_PACKAGE_mtd-utils-flash-otp-dump=m
CONFIG_PACKAGE_mtd-utils-flash-otp-lock=m
CONFIG_PACKAGE_mtd-utils-flash-otp-write=m
CONFIG_PACKAGE_mtd-utils-flash-unlock=m
CONFIG_PACKAGE_mtd-utils-flashcp=m
CONFIG_PACKAGE_mtd-utils-ftl-check=m
CONFIG_PACKAGE_mtd-utils-ftl-format=m
CONFIG_PACKAGE_mtd-utils-jffs2dump=m
CONFIG_PACKAGE_mtd-utils-jffs2reader=m
CONFIG_PACKAGE_mtd-utils-mkfs.jffs2=m
CONFIG_PACKAGE_mtd-utils-mkfs.ubifs=m
CONFIG_PACKAGE_mtd-utils-mtd-debug=m
CONFIG_PACKAGE_mtd-utils-mtdinfo=m
CONFIG_PACKAGE_mtd-utils-nanddump=m
CONFIG_PACKAGE_mtd-utils-nandtest=m
CONFIG_PACKAGE_mtd-utils-nandwrite=m
CONFIG_PACKAGE_mtd-utils-nftl-format=m
CONFIG_PACKAGE_mtd-utils-nftldump=m
CONFIG_PACKAGE_mtd-utils-recv-image=m
CONFIG_PACKAGE_mtd-utils-rfddump=m
CONFIG_PACKAGE_mtd-utils-rfdformat=m
CONFIG_PACKAGE_mtd-utils-serve-image=m
CONFIG_PACKAGE_mtd-utils-sumtool=m
CONFIG_PACKAGE_mtd-utils-ubiattach=m
CONFIG_PACKAGE_mtd-utils-ubicrc32=m
CONFIG_PACKAGE_mtd-utils-ubidetach=m
CONFIG_PACKAGE_mtd-utils-ubiformat=m
CONFIG_PACKAGE_mtd-utils-ubimkvol=m
CONFIG_PACKAGE_mtd-utils-ubinfo=m
CONFIG_PACKAGE_mtd-utils-ubinize=m
CONFIG_PACKAGE_mtd-utils-ubirename=m
CONFIG_PACKAGE_mtd-utils-ubirmvol=m
CONFIG_PACKAGE_mtd-utils-ubirsvol=m
CONFIG_PACKAGE_mtd-utils-ubiupdatevol=m
CONFIG_PACKAGE_mutt=y
CONFIG_PACKAGE_ncat=m
CONFIG_PACKAGE_ncat-ssl=m
CONFIG_PACKAGE_ntpclient=y
CONFIG_PACKAGE_ntpd=m
CONFIG_PACKAGE_odhcp6c=m
# CONFIG_PACKAGE_odhcpd is not set
CONFIG_PACKAGE_openvpn-nossl=m
CONFIG_PACKAGE_openvpn-openssl=y
# CONFIG_PACKAGE_ppp is not set
CONFIG_PACKAGE_relayd=m
CONFIG_PACKAGE_resolveip=y
CONFIG_PACKAGE_rrdtool1=y
CONFIG_PACKAGE_ssmtp=y
CONFIG_PACKAGE_swap-utils=y
CONFIG_PACKAGE_terminfo=y
CONFIG_PACKAGE_uclibcxx=m
CONFIG_PACKAGE_udev=m
CONFIG_PACKAGE_uhttpd=y
CONFIG_PACKAGE_uhttpd-mod-ubus=y
CONFIG_PACKAGE_ulogd=m
CONFIG_PACKAGE_ulogd-mod-pcap=m
CONFIG_PACKAGE_vsftpd=y
CONFIG_PACKAGE_vsftpd-tls=m
CONFIG_PACKAGE_watchcat=y
CONFIG_PACKAGE_wget=m
CONFIG_PACKAGE_wget-nossl=y
CONFIG_PACKAGE_wide-dhcpv6-client=m
CONFIG_PACKAGE_wide-dhcpv6-control=m
CONFIG_PACKAGE_wide-dhcpv6-relay=m
CONFIG_PACKAGE_wide-dhcpv6-server=m
CONFIG_PACKAGE_wifitoggle=m
CONFIG_PACKAGE_wireless-tools=y
CONFIG_PACKAGE_zip=m
CONFIG_PACKAGE_zlib=y
CONFIG_PACKAGE_zoneinfo-core=m
CONFIG_PACKAGE_zoneinfo-europe=m
# CONFIG_PER_FEED_REPO is not set
CONFIG_STRIP_KERNEL_EXPORTS=y
CONFIG_UDEV_EXTRA_accelerometer=y
CONFIG_UDEV_EXTRA_ata_id=y
CONFIG_UDEV_EXTRA_cdrom_id=y
CONFIG_UDEV_EXTRA_input_id=y
CONFIG_UDEV_EXTRA_mtd_probe=y
CONFIG_UDEV_EXTRA_path_id=y
CONFIG_UDEV_EXTRA_qemu=y
CONFIG_UDEV_EXTRA_rule_generator=y
CONFIG_UDEV_EXTRA_scsi_id=y
CONFIG_UDEV_EXTRA_usb_id=y
CONFIG_UDEV_EXTRA_v4l_id=y
CONFIG_USE_MKLIBS=y
CONFIG_VERSIONOPT=y
CONFIG_VERSION_DIST=&quot;OpenWrt&quot;
CONFIG_VERSION_HWREV=&quot;&quot;
CONFIG_VERSION_MANUFACTURER=&quot;&quot;
CONFIG_VERSION_NICK=&quot;&quot;
CONFIG_VERSION_NUMBER=&quot;&quot;
CONFIG_VERSION_PRODUCT=&quot;&quot;
CONFIG_VERSION_REPO=&quot;file:/mnt/usb1/trunk/packages&quot;
CONFIG_PACKAGE_kmod-ipt-conntrack=y
CONFIG_PACKAGE_kmod-lib-crc-ccitt=y </code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p259225">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">zloop</div>
					<div class="post-datetime">
						30 Dec 2014, 20:17					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for posting your diffconfig.</p><p>Some quick analysis:<br /></p><div class="codebox"><pre><code>CONFIG_BUILD_STATIC_TOOLS=y</code></pre></div><p>Thats the reason for build failure.</p><p>I get build fails with Debian 7.7 (like yours) and Arch Linux<br /></p><div class="quotebox"><blockquote><p>HOSTLD&nbsp; tools/dumpimage<br />/usr/bin/ld: cannot find -lssl<br />/usr/bin/ld: cannot find -lcrypto</p></blockquote></div><p>So similar problem - Debian links the wrong libcrypto and Arch does not find any.</p><p>You probably should write a ticket for that - since its relatively easy to replicate (make tools/mkimage/compile -&gt; errors out from a clean tree with that config option)</p>											<p class="post-edited">(Last edited by <strong>zloop</strong> on 30 Dec 2014, 20:18)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p259235">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">radekn</div>
					<div class="post-datetime">
						30 Dec 2014, 21:46					</div>
				</div>
				<div class="post-content content">
					<p>Thanks a lot, setting <strong>CONFIG_BUILD_STATIC_TOOLS=n</strong> solved the problem.<br />Ticket is <a href="https://dev.openwrt.org/ticket/18666#ticket">here</a>.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p259247">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">zloop</div>
					<div class="post-datetime">
						31 Dec 2014, 00:19					</div>
				</div>
				<div class="post-content content">
					<p>One can fix the problem locally but <strong>STATIC compilation is highly distribution specific</strong></p><p>There are 3 solutions:</p><p><strong>Solution 1</strong> - partially fix Debian bug - &quot;dirty&quot;:<br />add a 001-fix_debian_static_libs.patch to tools/mkimage/patches/<br /></p><div class="codebox"><pre><code>--- a/tools/Makefile
+++ b/tools/Makefile
@@ -115,7 +115,7 @@ endif
 
 # MXSImage needs LibSSL
 ifneq ($(CONFIG_MX23)$(CONFIG_MX28)$(CONFIG_FIT_SIGNATURE),)
-HOSTLOADLIBES_mkimage += -lssl -lcrypto
+HOSTLOADLIBES_mkimage += -lssl -lcrypto -ldl -lz               
 endif
 
 HOSTLOADLIBES_dumpimage := $(HOSTLOADLIBES_mkimage)</code></pre></div><p>This adds the symbols for zlib/libs (like &#039;inflate&#039;) and from libdl (like &#039;dlopen&#039;).<br />BUT since dlopen is dynamically loading libs you dont really have a static binary.<br />Thats why you get a compiler warning like<br /></p><div class="codebox"><pre><code>/usr/lib/gcc/x86_64-linux-gnu/4.7/../../../x86_64-linux-gnu/libcrypto.a(dso_dlfcn.o): In function `dlfcn_globallookup&#039;:
(.text+0x19): warning: Using &#039;dlopen&#039; in statically linked applications requires at runtime the shared libraries from the glibc version used for linking</code></pre></div><p><strong>Solution 2:</strong> modify the build with custom OpenSSL - &quot;dirty&quot;<br />Arch Linux does not seem to provide static libraries. So one has to built openssl from source.<br /></p><div class="codebox"><pre><code>#download openssl
./Configure -no-shared -no-dso linux-x86_64
make

#check for wrong symbols (like from your warning):
objdump -x libcrypto.a  |grep dlfcn
objdump -x libcrypto.a  |grep inflateEnd
#output should be (almost?) empty </code></pre></div><p>you then modify tools/mkimage/Makefile in the Host section where &quot;tools-only&quot; is built to match sth like<br /></p><div class="codebox"><pre><code>    $(MAKE) --trace -C $(HOST_BUILD_DIR) \
        HOSTCC=&quot;$(HOSTCC)&quot; \
        HOSTCFLAGS=&quot;$(HOST_CFLAGS) -I/path/to/custom/openssl/include&quot; \
        HOSTLDFLAGS=&quot;$(HOST_STATIC_LINKING) $(HOST_LDFLAGS) -L/path/to/custom/openssl/&quot; \
                tools-only</code></pre></div><p>with that &quot;--trace&quot; you can see what commands are executed</p><p>There seem to be a bug/error when building u-boot-2014.10 now: rsa-sign.c:(.text+0x960): undefined reference to `BN_mod&#039;<br />this is fixed by the following patch<br /></p><div class="codebox"><pre><code>cat tools/mkimage/patches/001-fix_openssl_includes.patch 
--- a/lib/rsa/rsa-sign.c
+++ b/lib/rsa/rsa-sign.c
@@ -14,6 +14,7 @@
 #include &lt;openssl/err.h&gt;
 #include &lt;openssl/ssl.h&gt;
 #include &lt;openssl/evp.h&gt;
+#include &lt;openssl/bn.h&gt;
 
 #if OPENSSL_VERSION_NUMBER &gt;= 0x10000000L
 #define HAVE_ERR_REMOVE_THREAD_STATE</code></pre></div><p>Result: no complaining (no warnings unlike Solution 1)<br />FINALLY <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /><br /><strong>Solution 3:</strong> add tools/openssl package and let it compile the libraries with correct flags<br />possibly the cleanest</p>											<p class="post-edited">(Last edited by <strong>zloop</strong> on 31 Dec 2014, 00:28)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>