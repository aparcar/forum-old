<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> How to get time of  Microseconds accuracy?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 5 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p95093">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">huasion</div>
					<div class="post-datetime">
						30 Sep 2009, 05:46					</div>
				</div>
				<div class="post-content content">
					<p>Hi,all<br />I want to test how long my function (in kernal driver) would take . Since jiffies&#039; accuracy is 10ms and it is not enough for me. <br />I have tried gettimeofday() , clock(). But the result seems unnomal and absolutely wrong!<br />I am running Kamikaze 8.09 on alix 3d2 . Any body know how to do it? Thanks!</p>											<p class="post-edited">(Last edited by <strong>huasion</strong> on 30 Sep 2009, 05:48)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p95095">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">RaX</div>
					<div class="post-datetime">
						30 Sep 2009, 06:34					</div>
				</div>
				<div class="post-content content">
					<p>You may need to write your own high precision timer.</p><p>On x86 architecture(which is what your geode is) you can use rdtsc in assembler which returns the number of clock cycles executed since system start. That in conjunction with the clock speed of your chip should give you the necessary tools to write a high precision timer yourself.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p95104">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">Dogge</div>
					<div class="post-datetime">
						30 Sep 2009, 09:27					</div>
				</div>
				<div class="post-content content">
					<p>Most routers don&#039;t have an RTC. This is mainly your problem.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p95564">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">huasion</div>
					<div class="post-datetime">
						8 Oct 2009, 10:26					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>RaX wrote:</cite><blockquote><p>You may need to write your own high precision timer.</p><p>On x86 architecture(which is what your geode is) you can use rdtsc in assembler which returns the number of clock cycles executed since system start. That in conjunction with the clock speed of your chip should give you the necessary tools to write a high precision timer yourself.</p></blockquote></div><p>Thanks! The result seems workable though it is not of&nbsp; microsceonds accuracy. I think it returns reliable millisecond . What makes me supprise is that why there is no full accuracy since it is from clock ticks. Is that the sysytem hardware unstable ? I just cannot guess why.</p>											<p class="post-edited">(Last edited by <strong>huasion</strong> on 9 Oct 2009, 14:41)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p95576">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">huasion</div>
					<div class="post-datetime">
						8 Oct 2009, 14:39					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Dogge wrote:</cite><blockquote><p>Most routers don&#039;t have an RTC. This is mainly your problem.</p></blockquote></div><p>Hi?I have checked my router, it is said to have RTC according to instrument(http://www.pcengines.ch/alix3d2.htm)</p><p>And what makes the difference?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p95577">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						8 Oct 2009, 14:51					</div>
				</div>
				<div class="post-content content">
					<p>The RTC is battery backed and provides a stable frequency that is decoupled from the CPU iirc. The RTC is able to generate interrupts which can be used by software to obtain exact time measurements.</p><p>~ JoW</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p95578">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">huasion</div>
					<div class="post-datetime">
						8 Oct 2009, 15:09					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>jow wrote:</cite><blockquote><p>The RTC is battery backed and provides a stable frequency that is decoupled from the CPU iirc. The RTC is able to generate interrupts which can be used by software to obtain exact time measurements.</p><p>~ JoW</p></blockquote></div><p>Thanks. My router doesnt have a battery. Does that means it doesnt have RTC support, Which&nbsp; is not as the instrument say?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p95626">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">huasion</div>
					<div class="post-datetime">
						9 Oct 2009, 14:45					</div>
				</div>
				<div class="post-content content">
					<p>I have checked my router, the reason is that I need to add one battery&nbsp; on it(as well as a battery box as there is only two soldering point&nbsp; ). That&#039;s pretty funny!</p>											<p class="post-edited">(Last edited by <strong>huasion</strong> on 9 Oct 2009, 14:48)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p95628">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">michelbrown</div>
					<div class="post-datetime">
						9 Oct 2009, 15:05					</div>
				</div>
				<div class="post-content content">
					<p>Hello huasion<br /> You need to use the high resolution performance counter that is available in the QueryPerformanceCounter() function.&nbsp; It is able to provide times that exceed 1 microsecond accuracy on most hardware. The availability of the QueryPerformanceCounter() is dependent.on the system&#039;s hardware.&nbsp; To find out if it&#039;s available, and to find out its accuracy, use the QueryPerformanceFrequency()&nbsp; function. </p><p>The QueryPerformanceCounter() function returns the amount of time that has elapsed since the system was booted.&nbsp; Elapsed time can be found by comparing the returned values at two different points in time. <br />Thanks</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p95655">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">huasion</div>
					<div class="post-datetime">
						10 Oct 2009, 05:40					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>michelbrown wrote:</cite><blockquote><p>Hello huasion<br /> You need to use the high resolution performance counter that is available in the QueryPerformanceCounter() function.&nbsp; It is able to provide times that exceed 1 microsecond accuracy on most hardware. The availability of the QueryPerformanceCounter() is dependent.on the system&#039;s hardware.&nbsp; To find out if it&#039;s available, and to find out its accuracy, use the QueryPerformanceFrequency()&nbsp; function. </p><p>The QueryPerformanceCounter() function returns the amount of time that has elapsed since the system was booted.&nbsp; Elapsed time can be found by comparing the returned values at two different points in time. <br />Thanks</p></blockquote></div><p>Hi michelbrown,<br />The function QueryPerformanceCounter() is supported by win32 but not linux.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p95659">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">RaX</div>
					<div class="post-datetime">
						10 Oct 2009, 07:32					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>huasion wrote:</cite><blockquote><div class="quotebox"><cite>RaX wrote:</cite><blockquote><p>You may need to write your own high precision timer.</p><p>On x86 architecture(which is what your geode is) you can use rdtsc in assembler which returns the number of clock cycles executed since system start. That in conjunction with the clock speed of your chip should give you the necessary tools to write a high precision timer yourself.</p></blockquote></div><p>Thanks! The result seems workable though it is not of&nbsp; microsceonds accuracy. I think it returns reliable millisecond . What makes me supprise is that why there is no full accuracy since it is from clock ticks. Is that the sysytem hardware unstable ? I just cannot guess why.</p></blockquote></div><p>It returns the number of clock cycles executed since system start which, in conjunction with the speed of your processor, can be used to create a timer that is as precise as your processor is... which, of course, is the only way to time things on the system like you are trying to do. You can&#039;t outperform your own hardware =P</p><p>IE:: on a 600mhz processor you could time things in excess of 600million ticks per second max</p><p>And, in reply to the person that said RDTSC can&#039;t be used on routers...If I&#039;m not mistaken the only real architectures used in networking hardware are mips, arm, powerpc, and x86 all of which have rdtsc or a compatible replacement function. I realize there are some less mainstream architectures that are used...but they also probably have a workaround to get rdtsc working, you have to have a way to time things in systems after all <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>