<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Benchmark on mp3 decoding/encoding on the openwrt..</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 19 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p16891">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">toots</div>
					<div class="post-datetime">
						9 Dec 2005, 12:07					</div>
				</div>
				<div class="post-content content">
					<p>Hi all!</p><p>I&#039;ve ported lame and mpg321 to the openwrt.<br />Our goal at first was to check if it was realistic to play mp3 and ogg real time on the board..</p><p>But here, with wrt54g v1.0, results are really poort: 0.0025x real time for mp3 encoding with lame, and 0.15x for mp3 decoding with mpg321..</p><p>What we&#039;d like to know is:<br />-- Can anyone get better result with another supported board?<br />-- Is there important optimisation we should have overlooked?<br />The packages are allready in the tracker...</p><p>Thanks for your help!</p><p>Romain</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p16892">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">Nico</div>
					<div class="post-datetime">
						9 Dec 2005, 12:09					</div>
				</div>
				<div class="post-content content">
					<p>Can you provide a patch or an archive or your mpg321 port, so that we can include it in our future releases?</p>											<p class="post-edited">(Last edited by <strong>Nico</strong> on 9 Dec 2005, 12:09)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p16894">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">mbm</div>
					<div class="post-datetime">
						9 Dec 2005, 12:15					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ve been using madplay for mp3 decoding .. no issues so far</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p16895">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">toots</div>
					<div class="post-datetime">
						9 Dec 2005, 12:18					</div>
				</div>
				<div class="post-content content">
					<p>Yes of course!</p><p>I don&#039;t have time today but I&#039;ll do it ASAP <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Romain</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p16896">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">toots</div>
					<div class="post-datetime">
						9 Dec 2005, 12:20					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>mbm wrote:</cite><blockquote><p>I&#039;ve been using madplay for mp3 decoding .. no issues so far</p></blockquote></div><p>Do you have a package for this? I can&#039;t find any on the tracker..<br />Was it real time?</p><br /><p>Romain</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p16897">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">mbm</div>
					<div class="post-datetime">
						9 Dec 2005, 12:33					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>toots wrote:</cite><blockquote><p>Do you have a package for this? I can&#039;t find any on the tracker..<br />Was it real time?</p></blockquote></div><p>I still need to get around to packaging it; it was just a quick thing I did for a technology demo. Yes, it works realtime .. madplay is highly optimized; I was using a set of USB speakers and streaming internet radio. I found that if I tried to play mp3s off a USB thumb drive there was an occasional gap,&nbsp; copying them to ramdisk or using an actual (non flash) USB drive resulted in flawless playback -- there&#039;s probably some option to turn on buffering but I really didn&#039;t look into it.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p16898">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">toots</div>
					<div class="post-datetime">
						9 Dec 2005, 12:45					</div>
				</div>
				<div class="post-content content">
					<p>Well this is a GREAT news!</p><p>I will try madplay and provide a package I think.<br />BTW, madplay is based upon libmad, that I&#039;ve packaged too -- and now I get why there is a tarball of it in your archives <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>So in order to try to get the same speed as you, I would like to know:<br />-- Did you used some special configure options for libmad?<br />-- On what board did you try it?</p><br /><br /><p>Romain</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p16901">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">toots</div>
					<div class="post-datetime">
						9 Dec 2005, 13:12					</div>
				</div>
				<div class="post-content content">
					<div class="codebox"><pre><code>root@OpenWrt:~# time madplay -o /dev/null ./09\ -\ Derrick\ Morgan\ -\ Send\ a\ Little\ Rain.mp3
MPEG Audio Decoder 0.15.2 (beta) - Copyright (C) 2000-2004 Robert Leslie et al.
          Title: Send a Little Rain
         Artist: Derrick Morgan
          Track: 09
        Comment: Artist unsure
6178 frames decoded (0:02:41.3), -0.1 dB peak amplitude, 0 clipped samples
real    1m 0.50s
user    0m 59.77s
sys     0m 0.60s</code></pre></div><p>The song was 2m 41 long!</p><p>Well, with madplay, the difference is really important!!!!!</p><p>Thank you very much for that hint!</p><p>Packages are in my repository, and I will send patches when I&#039;ll have time to produce clean diff.</p><p>Romain</p>											<p class="post-edited">(Last edited by <strong>toots</strong> on 12 Dec 2005, 11:59)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p16902">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">Nico</div>
					<div class="post-datetime">
						9 Dec 2005, 13:22					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>toots wrote:</cite><blockquote><p>Packages are in my repository, and I will send patches when I&#039;ll have time to produce clean diff.</p></blockquote></div><p>Just send an archive of your package/madplay if you don&#039;t have much time.</p><p>Thanks for your help</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p16905">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">toots</div>
					<div class="post-datetime">
						9 Dec 2005, 13:48					</div>
				</div>
				<div class="post-content content">
					<p>Well, you can find them at:<br /><a href="http://www.cti.ecp.fr/~beauxir5/peercast/">http://www.cti.ecp.fr/~beauxir5/peercast/</a> if you are looking for the .ipk files.</p><p>BTW, I was wondering a thing about the decoding benchmark:<br />mpg321 and madplay use the same lib for decoding, so I can hardly figure out why it should be that different between them..<br />BUT, mpg321 uses pthread too, so I was wondering if pthread could be the bottleneck?</p><br /><p>Romain</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p16930">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">rohde</div>
					<div class="post-datetime">
						9 Dec 2005, 21:21					</div>
				</div>
				<div class="post-content content">
					<p>The bottleneck is probably floating point arithmetic. Since your linksys doesn&#039;t have an FPU you will take a beating on any floating point extensive program.<br />Luckily libmad is written entirely using fixed point arithmetic.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p16947">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">doggkruse</div>
					<div class="post-datetime">
						10 Dec 2005, 01:57					</div>
				</div>
				<div class="post-content content">
					<p>There has been quite a bit of work on iPodlinux with getting things to play realtime with similar cpu power.&nbsp; Might want to check it out.</p><p>Geoff</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p16973">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">toots</div>
					<div class="post-datetime">
						10 Dec 2005, 21:24					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>rohde wrote:</cite><blockquote><p>The bottleneck is probably floating point arithmetic. Since your linksys doesn&#039;t have an FPU you will take a beating on any floating point extensive program.<br />Luckily libmad is written entirely using fixed point arithmetic.</p></blockquote></div><p>Yep, but as far as I can get from mpg321, I get: <br /></p><div class="codebox"><pre><code>root@OpenWrt:~# ldd mpg321
        libid3tag.so.0 =&gt; /usr/lib/libid3tag.so.0 (0x2aaee000)
        libmad.so.0 =&gt; /usr/lib/libmad.so.0 (0x2ab3f000)
        libz.so.1 =&gt; /usr/lib/libz.so.1 (0x2ab95000)
        libao.so.2 =&gt; /usr/lib/libao.so.2 (0x2abe5000)
        libdl.so.0 =&gt; /rom/lib/libdl.so.0 (0x2ac29000)
        libgcc_s.so.1 =&gt; /rom/lib/libgcc_s.so.1 (0x2ac6b000)
        libc.so.0 =&gt; /rom/lib/libc.so.0 (0x2acba000)
        libpthread.so.0 =&gt; /lib/libpthread.so.0 (0x2ad5c000)
        ld-uClibc.so.0 =&gt; /rom/lib/ld-uClibc.so.0 (0x2aaa8000)</code></pre></div><p>So, the time gap does not seems to come from fixed point/ floating point.<br />It was quite sure since both decoders rely on the same lib for decoding.</p><br /><p>Romain</p>											<p class="post-edited">(Last edited by <strong>toots</strong> on 10 Dec 2005, 21:26)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p17002">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">bani</div>
					<div class="post-datetime">
						11 Dec 2005, 11:17					</div>
				</div>
				<div class="post-content content">
					<p>afaik there are no integerized mp3 encoders yet? only integerized players.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p17091">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">toots</div>
					<div class="post-datetime">
						12 Dec 2005, 11:58					</div>
				</div>
				<div class="post-content content">
					<p>Hi all!</p><p>I&#039;ve finally done the same benchmark for vorbis decompression:<br /></p><div class="codebox"><pre><code>root@OpenWrt:~# time cat 02\ -\ Muslin\ Praise\ -\ Premiere\ Recolte.ogg | ivorbisfile_example &gt; /dev/null
Artist=Sinsemilia
Title=Muslin Praise
Album=Premiere Recolte
Genre=Reggae
TrackNumber=2
Content group description=Reggae

Bitstream is 2 channel, 44100Hz

Decoded length: -131 samples
Encoded by: Xiph.Org libVorbis I 20030909

real    1m 32.60s
user    0m 0.06s
sys    0m 0.49s
Done.</code></pre></div><p>The song was 3m 56 long!</p><p>It is based upon vorbis fixed point implementation found at <a href="http://www.xiph.org/vorbis/">http://www.xiph.org/vorbis/</a><br />You can grab the shared libraries -- libvorbisidec, and the test program (staticaly linked) -- ivorbis, in my repository, and in the tracker.</p><br /><p>Romain</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>