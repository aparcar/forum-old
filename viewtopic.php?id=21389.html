<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> StrongSwan 4.3 ikev2 (ipsec) - howto install</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 18 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p92615">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">beus</div>
					<div class="post-datetime">
						13 Aug 2009, 15:16					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m planning on using strongSwan in combination with OpenWrt. I&#039;m wondering if there are more enthusiasts who wish to participate. </p><p>This first post will be updated as a howto - as work progresses.</p><p>Here is what I&#039;ve got until now. </p><p>== why strongSwan 4.3 with OpenWrt == <br />* Openswan for 2.4 <a href="https://forum.openwrt.org/viewtopic.php?pid=82667#p82667">reported broken</a><br />* Openswan <a href="http://wiki.openswan.org/index.php/Openswan/FeatureComparison">does not support IKEv2 and MOBIKE</a> (bit outdated comparison though)<br />* <a href="http://www.strongswan.org/">strongSwan</a> supporting 2.4 kernels (version 2.8) <a href="http://www.strongswan.org/">only support IKEv1, not IKEv2</a>. Version 4.3 support IKEv1 and IKEv2.<br />* dd-wrt does do IPSec, <a href="http://www.dd-wrt.com/phpBB2/viewtopic.php?p=168235#168235">as they favor OpenVPN</a><br />* IPSec allows for routing rules after it has passed the initial firewall. OpenVPN allows for (unristricted) access to the network behind the router.</p><p>== general info ==<br />* IKEv2 / strongswan 4.3 does not work with kernel 2.4<br />* Broadcom wifi currently <a href="https://forum.openwrt.org/viewtopic.php?pid=92202#p92202">not supported by stable kamikaze (8.09.1)</a>, however it is supported in <a href="http://downloads.openwrt.org/snapshots/trunk">trunk</a>. You might need to configure it right; see <a href="https://forum.openwrt.org/viewtopic.php?pid=92578#p92578">here</a> and <a href="https://forum.openwrt.org/viewtopic.php?pid=91679#p91679">here</a></p><p>== usefull links and guides ==<br />* this thread focusses on the installation of strongSwan in openwrt, check Building your own OpenWrt guide: <a href="http://nuwiki.openwrt.org/doc/howto/buildroot">http://nuwiki.openwrt.org/doc/howto/buildroot</a> and/or <a href="http://kamikaze.openwrt.org/docs/openwrt.html">http://kamikaze.openwrt.org/docs/openwrt.html</a> for a general howto on compiling openwrt. <br />[s]* MIPSEL binaries available from debian package repository, dependencies are included <a href="http://packages.debian.org/sid/libstrongswan">http://packages.debian.org/sid/libstrongswan</a>. Apparently opkg <a href="http://lists.openmoko.org/pipermail/devel/2008-July/000496.html">can handle these .deb files</a>. However,&nbsp; <a href="http://wiki.openmoko.org/wiki/Opkg#FAQ">&quot;There may be issues with some packages, concerning preinst and postinst scripts&quot;</a>. Haven&#039;t checked it yet.[/s] Trying to install <a href="http://packages.debian.org/sid/libstrongswan">these</a> packages gives the error: &quot;Packages were found, but none compatible with the architerctures configured&quot;. I tried the mips and mipsel package. Guess we need to (cross)compile after all.<br />* x-wrt plugin? <a href="http://wiki.strongswan.org/wiki/1/IpsecXWRT">http://wiki.strongswan.org/wiki/1/IpsecXWRT</a></p><br /><p>== systems ==<br />tested on Linksys WRT54GS 1.1</p>											<p class="post-edited">(Last edited by <strong>beus</strong> on 30 Aug 2009, 16:29)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p92827">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">beus</div>
					<div class="post-datetime">
						18 Aug 2009, 17:19					</div>
				</div>
				<div class="post-content content">
					<p>Step 1 -- Installing the build environment</p><p>! Building your own firmware you need to have access to a Linux, BSD or MacOSX system. ! </p><p>Follow the &#039;Building your own OpenWrt guide&#039;: <a href="http://nuwiki.openwrt.org/doc/howto/buildroot">http://nuwiki.openwrt.org/doc/howto/buildroot</a> / <a href="https://dev.openwrt.org/wiki/GetSource">https://dev.openwrt.org/wiki/GetSource</a><br />in short:</p><p>1.1 open a console and run<br /></p><div class="codebox"><pre><code>svn co svn://svn.openwrt.org/openwrt/trunk/</code></pre></div><p>this will create a trunk directory in the dir you ran the command in.</p><p>1.2 go into the trunk dir<br /></p><div class="codebox"><pre><code>cd trunk</code></pre></div><p>1.3 You need to have installed gcc, binutils, patch, bzip2, flex, bison, make, gettext, pkg-config, unzip, libz-dev and libc headers. <br />The build-system checks for the requirements and print what&#039;s missing on your system. Then install the packages.<br />To manually check the prerequisites run<br /></p><div class="codebox"><pre><code>make prereq</code></pre></div><p>Step 2 -- download the strongSwan package</p><p>2.1 download it from <a href="https://dev.openwrt.org/ticket/2538">https://dev.openwrt.org/ticket/2538</a><br />for the trunk version this can be done using the following command. Please check above url for a possible update to this.<br /></p><div class="codebox"><pre><code>cd package
wget --no-check-certificate https://dev.openwrt.org/raw-attachment/ticket/2538/strongswan-4.2.17.1.tar</code></pre></div><p>2.2 untar the file, as you are allready in the package directory it will untar into the right place.<br /></p><div class="codebox"><pre><code>tar -xvvf strongswan-4.2.17.1.tar
cd ..</code></pre></div><p>2.3 If you did not already untar the strongSwan package into the trunk/package directory, copy or link the untarred directory into your trunk/package dir. replace ~ with your installdir, in my case my home.<br /></p><div class="codebox"><pre><code>mv package_strongswan-4.2.17.1 ~/trunk/package</code></pre></div><p>2.4 runnnig make menuconfig will now include the strongswan option under the network section providing that you have selected a 2.6 kernel build.</p><p>Step 3 -- do some scripts magic</p><p>/todo package options, see Norberts post below<br /></p><div class="codebox"><pre><code>scripts/feeds update
scripts/feeds install libgmp
scripts/feeds install strace
scripts/feeds install openssl</code></pre></div><p>Notes:<br />* If you want Eliptic Curve Cryptography you need to remove the no-ec options in trunk/package/openssl/Makefile<br />You can edit the makefile using any editor.<br />* I edited the package-strongswan-4.2.17.1 Makefile and Config.in to allow selection of openssl.<br />Add in Config.in:<br /></p><div class="codebox"><pre><code># --enable-openssl &gt;&gt; Requires libcrypto.so.0.9.8.
config STRONGSWAN_ENABLE_OPENSSL
        bool
        prompt &quot;Enable the OpenSSL crypto plugin.&quot;
        default y
        select PACKAGE_libopenssl
        help
                Enables the OpenSSL crypto plugin (default Yes).
                StrongSwan: enable the OpenSSL crypto plugin [ no ]. Requires libcrypto.so.0.9.8.</code></pre></div><p>Add in Makefile allong with the other similar lines:<br /></p><div class="codebox"><pre><code>  $(if $(CONFIG_STRONGSWAN_ENABLE_OPENSSL),--enable-openssl) \</code></pre></div><p>I also changed the urandom config part in in the Makefile to the following:<br /></p><div class="codebox"><pre><code>$(if $(CONFIG_STRONGSWAN_WITH_URANDOM_DEVICE),--with-urandom-device=$(CONFIG_STRONGSWAN_DEVICE_URANDOM)) \</code></pre></div><p>Step 4 -- configure your build</p><div class="codebox"><pre><code>make menuconfig</code></pre></div><p>select the right package (i.e. 2.6 kernel).</p><p>Step 5 -- compile<br />Run the command<br /></p><div class="codebox"><pre><code>make</code></pre></div><p>Grab a cup of coffee, this will take a while... Especially the first time or after a &#039;make clean&#039;. The complete build takes about 1 to 2 hours on a 2.8GHZz Celeron machine and about 20 minutes using one core2duo 6600 @2.4GHz (using a single core). Using both cores -- &#039;make -j 3&#039; -- breakes on some packages, though several minutes can be gained by using &#039;make -j 3 || make&#039;</p><p>Step 6 -- flash your WRT device.<br />The trunk/bin directory now contains several .bin files and a .trx file.</p><p>If you have not before installed an open source wrt on you device use the corresponding .bin file.<br />If you previously installed an open source wrt, you can use the trx file.<br />The bin file is basically the trx file with extra headers so that your device with oem software will run them. </p><p>You can also run the command from promt; first download the image using wget, then install using mtd.<br />wget img-url -O /tmp/firware.trx<br />mtd -r write /tmp/firmware.trx linux</p><p>Step 7 -- installing strongSwan <br />You now have compiled and installed openWRT, yet you still need to install the strongSwan package.</p><p>The /trunk/bin/packages now contains a directory (in my case &#039;brcm47xx_uClibc-0.9.30.1&#039;) containing compiled packages.<br />7.1 You can copy these to your device and run then --<br />/todo howto</p><p>7.1 You can also copy this directory to a webserver (this was easier in my case) and add a rule to /etc/opkg.conf pointing at your server/path/to/directory/with/packages e.g., <a href="http://www.someserver.eu/openwrt/mypackages">www.someserver.eu/openwrt/mypackages</a><br />you can easily append a line to opkg.conf by opening a console to youre device<br /></p><div class="codebox"><pre><code>echo src/gz MyWRT http://www.someserver.eu/openwrt/mypackages &gt;&gt; /etc/opkg.conf
opkg update</code></pre></div><p>7.2 now install the packages<br /></p><div class="codebox"><pre><code>opkg install libgmp
opkg install kmod-crypto-*
opkg install kmod-ipsec*
opkg install strongswan</code></pre></div><p>Which in my case came down to:<br /></p><div class="codebox"><pre><code>opkg install libopenssl
opkg install libgmp
opkg install kmod-crypto-aes
opkg install kmod-crypto-arc4
opkg install kmod-crypto-authenc
opkg install kmod-crypto-core
opkg install kmod-crypto-des
opkg install kmod-crypto-hmac
opkg install kmod-crypto-md5
opkg install kmod-crypto-misc
opkg install kmod-crypto-sha1
opkg install kmod-ipsec
opkg install kmod-ipsec4
opkg install strongswan</code></pre></div><p>where libgmp and kmod-crypto-misc can be ommited when not enabled.</p><br /><p>To enable a gui on the router either install luci or webif²<br /></p><div class="codebox"><pre><code>opkg install luci-admin-full
opkg install luci-theme-openwrt

or

opkg install webif</code></pre></div>											<p class="post-edited">(Last edited by <strong>beus</strong> on 22 Sep 2009, 17:06)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p92833">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">aport</div>
					<div class="post-datetime">
						18 Aug 2009, 20:26					</div>
				</div>
				<div class="post-content content">
					<p>Does StrongSwan support manual keys, ie, not through IKE? I know manual keying is a security risk but for some reason people still want to do it.</p><p>If so I would be delighted to help out with this project.</p>											<p class="post-edited">(Last edited by <strong>aport</strong> on 18 Aug 2009, 20:26)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p92840">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">beus</div>
					<div class="post-datetime">
						18 Aug 2009, 22:45					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>aport wrote:</cite><blockquote><p>Does StrongSwan support manual keys, ie, not through IKE?</p></blockquote></div><p>I&#039;m not sure I follow. By manual keys, do you mean x.509 certificates, RSA keys or perhaps even username+password?</p><p>Googling <a href="http://www.faqs.org/docs/securing/chap25sec203.html">showed</a> that FreeS/WAN supports it, and strongSwan is <a href="http://www.strongswan.org/about.htm">based on the discontinued FreeS/WAN</a>, so I would recon so...</p><p>Perhaps you should try it out first on a regular unix computer, distributions are available for debian, openSUSE, ubuntu en gentoo. Making installation a piece of cake compared to setting it up on a WRT device.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p92908">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">aport</div>
					<div class="post-datetime">
						19 Aug 2009, 20:51					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>beus wrote:</cite><blockquote><div class="quotebox"><cite>aport wrote:</cite><blockquote><p>Does StrongSwan support manual keys, ie, not through IKE?</p></blockquote></div><p>I&#039;m not sure I follow. By manual keys, do you mean x.509 certificates, RSA keys or perhaps even username+password?</p><p>Googling <a href="http://www.faqs.org/docs/securing/chap25sec203.html">showed</a> that FreeS/WAN supports it, and strongSwan is <a href="http://www.strongswan.org/about.htm">based on the discontinued FreeS/WAN</a>, so I would recon so...</p><p>Perhaps you should try it out first on a regular unix computer, distributions are available for debian, openSUSE, ubuntu en gentoo. Making installation a piece of cake compared to setting it up on a WRT device.</p></blockquote></div><p>I&#039;ll try it out on my own machine. For IPsec there are two keying methods: Manual and IKE. IKE is what most people use, also known as automatic keying. IKE ensures that the keying is encrypted itself, though IKE tends to send lots of data through the tunnels at given intervals which on large networks can start to be quite &quot;chatty.&quot; Manual keying doesn&#039;t use IKE... think static IP instead of DHCP. The keying isn&#039;t encrypted so potentially when the tunnels are being established someone could grab your encryption hashes and just decrypt all traffic through the tunnel. Pretty low chance though.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p93051">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">norbert</div>
					<div class="post-datetime">
						23 Aug 2009, 16:46					</div>
				</div>
				<div class="post-content content">
					<p>see <a href="https://dev.openwrt.org/ticket/2538">https://dev.openwrt.org/ticket/2538</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p93210">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">beus</div>
					<div class="post-datetime">
						26 Aug 2009, 21:51					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>norbert wrote:</cite><blockquote><p>see <a href="https://dev.openwrt.org/ticket/2538">https://dev.openwrt.org/ticket/2538</a></p></blockquote></div><p>Looks very promising!</p><p>compiling it now.</p><p>Took me some time to figure out, butt here is a mini how-to.<br />1. follow the link above, download the appropriate package tar.<br />2. checkout the version you wish to compile. (see <a href="https://dev.openwrt.org/wiki/GetSource">https://dev.openwrt.org/wiki/GetSource</a>)<br />3. untar the package under step 1 into the checkoutdir/package folder<br />4. run make menuconfig from the checkoutdir folder, select 2.6 kernel.<br />--skip-able<br />5. It now is available under section &#039;network.&#039;, where you can change several compile options.<br />--end skip-able ---<br />5. run make from the checkoutdir folder.</p><p>&lt;&lt; 6. Get it to compile without errors &gt;&gt;<br />&lt;&lt; 7. figure out how-to install to device &gt;&gt;</p>											<p class="post-edited">(Last edited by <strong>beus</strong> on 2 Sep 2009, 15:55)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p93364">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">beus</div>
					<div class="post-datetime">
						30 Aug 2009, 02:12					</div>
				</div>
				<div class="post-content content">
					<p>Cannot seem to get it to compile, apparently GMP is missing. </p><p>tried installing it using.<br />sudo apt-get install gmp-devel<br />sudo apt-get install zlib1g-dev libbz2-dev</p><p>using the kamikaze checkout, with no alternations than described above.</p><p>Insights are greatly appreciated.</p><div class="codebox"><pre><code>make[3]: Entering directory `/home/beus/8.09/package/package_strongswan-4.2.14.2&#039;
(cd /home/beus/8.09/build_dir/mipsel/strongswan-4.2.14/./; if [ -x ./configure ]; then /usr/bin/find /home/beus/8.09/build_dir/mipsel/strongswan-4.2.14/ -name config.guess | xargs -r chmod u+w; /usr/bin/find /home/beus/8.09/build_dir/mipsel/strongswan-4.2.14/ -name config.guess | xargs -r -n1 cp /home/beus/8.09/scripts/config.guess; /usr/bin/find /home/beus/8.09/build_dir/mipsel/strongswan-4.2.14/ -name config.sub | xargs -r chmod u+w; /usr/bin/find /home/beus/8.09/build_dir/mipsel/strongswan-4.2.14/ -name config.sub | xargs -r -n1 cp /home/beus/8.09/scripts/config.sub; AR=mipsel-linux-uclibc-ar AS=&quot;mipsel-linux-uclibc-gcc -c -Os -pipe -mips32 -mtune=mips32 -funit-at-a-time -fhonour-copts&quot; LD=mipsel-linux-uclibc-ld NM=mipsel-linux-uclibc-nm CC=&quot;mipsel-linux-uclibc-gcc&quot; GCC=&quot;mipsel-linux-uclibc-gcc&quot; CXX=&quot;mipsel-linux-uclibc-g++&quot; RANLIB=mipsel-linux-uclibc-ranlib STRIP=mipsel-linux-uclibc-strip OBJCOPY=mipsel-linux-uclibc-objcopy OBJDUMP=mipsel-linux-uclibc-objdump SIZE=mipsel-linux-uclibc-size CFLAGS=&quot;-Os -pipe -mips32 -mtune=mips32 -funit-at-a-time -fhonour-copts &quot; CXXFLAGS=&quot;-Os -pipe -mips32 -mtune=mips32 -funit-at-a-time -fhonour-copts &quot; CPPFLAGS=&quot;-I/home/beus/8.09/staging_dir/mipsel/usr/include -I/home/beus/8.09/staging_dir/mipsel/include &quot; LDFLAGS=&quot;-L/home/beus/8.09/staging_dir/toolchain-mipsel_gcc4.1.2/lib -L/home/beus/8.09/staging_dir/mipsel/usr/lib -L/home/beus/8.09/staging_dir/mipsel/lib &quot; PKG_CONFIG_PATH=&quot;/home/beus/8.09/staging_dir/mipsel/usr/lib/pkgconfig:/home/beus/8.09/staging_dir/host/usr/lib/pkgconfig&quot; PKG_CONFIG_LIBDIR=&quot;/home/beus/8.09/staging_dir/mipsel/usr/lib/pkgconfig&quot;  ./configure --target=mipsel-linux --host=mipsel-linux --build=i486-linux-gnu --program-prefix=&quot;&quot; --program-suffix=&quot;&quot; --prefix=/usr --exec-prefix=/usr --bindir=/usr/bin --sbindir=/usr/sbin --libexecdir=/usr/lib --sysconfdir=/etc --datadir=/usr/share --localstatedir=/var --mandir=/usr/man --infodir=/usr/info --disable-nls  --with-random-device=&quot;/dev/random&quot; --with-random-device=&quot;/dev/random&quot;      --disable-des --disable-md5   --disable-fips-prf         --disable-pluto  --disable-tools --with-routing-table=&quot;220&quot; --disable-static ; fi; )
configure: loading site script /home/beus/8.09/include/site/mipsel-linux-uclibc
checking for a BSD-compatible install... /usr/bin/install -c
checking whether build environment is sane... yes
checking for a thread-safe mkdir -p... /bin/mkdir -p
checking for gawk... gawk
checking whether make sets $(MAKE)... yes
checking for mipsel-linux-strip... mipsel-linux-uclibc-strip
checking how to create a ustar tar archive... gnutar
checking for style of include used by make... GNU
checking for mipsel-linux-gcc... mipsel-linux-uclibc-gcc
checking for C compiler default output file name... a.out
checking whether the C compiler works... yes
checking whether we are cross compiling... yes
checking for suffix of executables...
checking for suffix of object files... o
checking whether we are using the GNU C compiler... yes
checking whether mipsel-linux-uclibc-gcc accepts -g... yes
checking for mipsel-linux-uclibc-gcc option to accept ISO C89... none needed
checking dependency style of mipsel-linux-uclibc-gcc... gcc3
checking how to run the C preprocessor... mipsel-linux-uclibc-gcc -E
checking for grep that handles long lines and -e... /bin/grep
checking for egrep... /bin/grep -E
checking for ANSI C header files... yes
checking for sys/types.h... yes
checking for sys/stat.h... yes
checking for stdlib.h... yes
checking for string.h... yes
checking for memory.h... yes
checking for strings.h... yes
checking for inttypes.h... yes
checking for stdint.h... yes
checking for unistd.h... yes
checking whether byte ordering is bigendian... (cached) no
checking pkg-config is at least version 0.9.0... yes
checking for a BSD-compatible install... /usr/bin/install -c
checking build system type... i486-pc-linux-gnu
checking host system type... mipsel-unknown-linux-gnu
checking for a sed that does not truncate output... /home/beus/8.09/staging_dir/host/bin/sed
checking for fgrep... /bin/grep -F
checking for ld used by mipsel-linux-uclibc-gcc... mipsel-linux-uclibc-ld
checking if the linker (mipsel-linux-uclibc-ld) is GNU ld... yes
checking for BSD- or MS-compatible name lister (nm)... mipsel-linux-uclibc-nm
checking the name lister (mipsel-linux-uclibc-nm) interface... BSD nm
checking whether ln -s works... yes
checking the maximum length of command line arguments... 805306365
checking whether the shell understands some XSI constructs... yes
checking whether the shell understands &quot;+=&quot;... yes
checking for mipsel-linux-uclibc-ld option to reload object files... -r
checking how to recognize dependent libraries... pass_all
checking for mipsel-linux-ar... mipsel-linux-uclibc-ar
checking for mipsel-linux-strip... (cached) mipsel-linux-uclibc-strip
checking for mipsel-linux-ranlib... mipsel-linux-uclibc-ranlib
checking command to parse mipsel-linux-uclibc-nm output from mipsel-linux-uclibc-gcc object... ok
checking for dlfcn.h... yes
checking for objdir... .libs
checking if mipsel-linux-uclibc-gcc supports -fno-rtti -fno-exceptions... no
checking for mipsel-linux-uclibc-gcc option to produce PIC... -fPIC -DPIC
checking if mipsel-linux-uclibc-gcc PIC flag -fPIC -DPIC works... yes
checking if mipsel-linux-uclibc-gcc static flag -static works... yes
checking if mipsel-linux-uclibc-gcc supports -c -o file.o... yes
checking if mipsel-linux-uclibc-gcc supports -c -o file.o... (cached) yes
checking whether the mipsel-linux-uclibc-gcc linker (mipsel-linux-uclibc-ld) supports shared libraries... yes
checking whether -lc should be explicitly linked in... no
checking dynamic linker characteristics... GNU/Linux ld.so
checking how to hardcode library paths into programs... immediate
checking whether stripping libraries is possible... yes
checking if libtool supports shared libraries... yes
checking whether to build shared libraries... yes
checking whether to build static libraries... no
checking for flex... flex
checking lex output file root... lex.yy
checking lex library... none needed
checking whether yytext is a pointer... no
checking for bison... bison -y
checking for mipsel-linux-gcc... (cached) mipsel-linux-uclibc-gcc
checking whether we are using the GNU C compiler... (cached) yes
checking whether mipsel-linux-uclibc-gcc accepts -g... (cached) yes
checking for mipsel-linux-uclibc-gcc option to accept ISO C89... (cached) none needed
checking dependency style of mipsel-linux-uclibc-gcc... (cached) gcc3
checking for gperf... no
checking for perl... /usr/bin/perl
checking for main in -ldl... yes
checking for backtrace... no
checking for dladdr... yes
checking for gcc atomic operations... no
checking for register_printf_function... yes
checking for main in -lgmp... no
configure: error: GNU Multi Precision library gmp not found
make[3]: *** [/home/beus/8.09/build_dir/mipsel/strongswan-4.2.14/.configured] Error 1
make[3]: Leaving directory `/home/beus/8.09/package/package_strongswan-4.2.14.2&#039;
make[2]: *** [package/package_strongswan-4.2.14.2/compile] Error 2
make[2]: Leaving directory `/home/beus/8.09&#039;
make[1]: *** [/home/beus/8.09/staging_dir/mipsel/stamp/.package_compile] Error 2
make[1]: Leaving directory `/home/beus/8.09&#039;
make: *** [world] Error 2
beus@althor:~/8.09$</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p93403">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">norbert</div>
					<div class="post-datetime">
						30 Aug 2009, 14:06					</div>
				</div>
				<div class="post-content content">
					<p>Think easy - its OpenWRT and not your local system...</p><p>1) <a href="https://dev.openwrt.org/wiki/GetSource">https://dev.openwrt.org/wiki/GetSource</a>:<br />svn co svn://svn.openwrt.org/openwrt/branches/8.09<br />or use the trunk</p><p>2) i moved trunk to openwrt_trunk_brcm47xx</p><p>3) set up feeds.conf:<br />src-svn packages svn://svn.openwrt.org/openwrt/packages<br />src-svn luci <a href="http://svn.luci.subsignal.org/luci/branches/luci-0.9/contrib/package">http://svn.luci.subsignal.org/luci/bran … ib/package</a></p><p>4) my additionally packages - only libgmp and strace are important:<br />scripts/feeds update<br />scripts/feeds install nano<br />scripts/feeds install ntpclient<br />scripts/feeds install usbutils<br />scripts/feeds install pciutils<br />scripts/feeds install speedtouch-usb-firmware<br />scripts/feeds install fetchmail<br />scripts/feeds install ssmtp<br />scripts/feeds install atftp<br />scripts/feeds install ddns-scripts<br />scripts/feeds install maradns<br />scripts/feeds install openntpd<br />scripts/feeds install strace<br />scripts/feeds install libgmp<br />scripts/feeds install libmysqlclient<br />scripts/feeds install libpq<br />scripts/feeds install libsqlite2<br />scripts/feeds install bluez-libs<br />scripts/feeds install uclibcxx<br />scripts/feeds install libspeex<br />scripts/feeds install libcurl<br />scripts/feeds install libxml2<br />scripts/feeds install libnetsnmp<br />scripts/feeds install ethtool<br />scripts/feeds install vnstat</p><p>scripts/feeds install libpopt</p><p>scripts/feeds install luci-httpd<br />scripts/feeds install luci-http<br />scripts/feeds install luci-core<br />scripts/feeds install luci-i18n-english<br />scripts/feeds install luci-i18n-german<br />scripts/feeds install luci-theme-openwrt<br />scripts/feeds install luci-admin-full<br />scripts/feeds install luci-app-ddns<br />scripts/feeds install luci-app-firewall<br />scripts/feeds install luci-app-initmgr<br />scripts/feeds install luci-app-ntpc<br />scripts/feeds install luci-app-qos</p><p>5) copy or better link strongswan in the package folder</p><p>6) configure and build image with your settings</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p93418">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">beus</div>
					<div class="post-datetime">
						30 Aug 2009, 16:36					</div>
				</div>
				<div class="post-content content">
					<p>Thanks! that really helped. Doing some compile runs now, it looks that the following commands do the trick for me<br /></p><div class="codebox"><pre><code>scripts/feeds update
scripts/feeds install libgmp
scripts/feeds install strace</code></pre></div><p>Next up, figuring out how not to brick my wrt. I suppose that I cannot simply install the <a href="shttp://downloads.openwrt.org/snapshots/trunk/brcm47xx/openwrt-wrt54gs-squashfs.bin">latest snapshot</a> and install the strongSwan package I compiled&nbsp; on that?</p><p>*edit<br />It turns out that you do not need libgmp if you select the option &#039;disable own gmp implementation&#039;.<br />I have not determined whether this can also be done when the &#039;enable openssl plugin&#039; is not selected. Of course scripts/feeds install openssl is required when using the openssl library.</p><p>*edit<br />Taken from <a href="http://gmplib.org/">http://gmplib.org/</a>:<br /></p><div class="quotebox"><blockquote><p>GMP is a free library for arbitrary precision arithmetic, operating on signed integers, rational numbers, and floating point numbers. There is no practical limit to the precision except the ones implied by the available memory in the machine GMP runs on. GMP has a rich set of functions, and the functions have a regular interface.</p><p>The main target applications for GMP are cryptography applications and research, Internet security applications, algebra systems, computational algebra research, etc.</p><p>GMP is carefully designed to be as fast as possible, both for small operands and for huge operands. The speed is achieved by using fullwords as the basic arithmetic type, by using fast algorithms, with highly optimised assembly code for the most common inner loops for a lot of CPUs, and by a general emphasis on speed.</p><p>GMP is faster than any other bignum library. The advantage for GMP increases with the operand sizes for many operations, since GMP uses asymptotically faster algorithms.</p></blockquote></div><p>It relates to strongswan as strongswan uses the libgmp plugin for cryptographic computations. As openssl does not link to libgmp (due to licensing issues) it stands to reason to either user openssl or libgmp. <strong>So if you don&#039;t use openssl, do not disable libgmp!</strong></p><p>According to the <a href="http://wiki.strongswan.org/wiki/strongswan/Autoconf">autoconf options for strongswan 4.3.*</a> only EAP AKA 3GPP2 requires libgmp, which is disabled by default. So you can disable the libgmp pluging when you use openssl and do not use 3GPP2.</p>											<p class="post-edited">(Last edited by <strong>beus</strong> on 14 Jan 2010, 15:02)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p93434">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">norbert</div>
					<div class="post-datetime">
						30 Aug 2009, 19:10					</div>
				</div>
				<div class="post-content content">
					<p>Better use &lt;trunk&gt;/bin/openwrt-wrt54gs-squashfs.bin</p><p>You should have a serial console to what happen on the router. If the image is working, copy the packages libgmp, kmod-crypt*, kmod-ipsec* and strongswan to the router and install all. opkg -test install strongswan-??.ipk shows the needed packages.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p93450">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">beus</div>
					<div class="post-datetime">
						30 Aug 2009, 23:28					</div>
				</div>
				<div class="post-content content">
					<p>seems to install properly...</p><p>you did not by chance include a GUI for setting up IPsec did you? (that would really make my day, which btw you already did <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" />)<br />perhaps some inspiration: <a href="http://wiki.strongswan.org/wiki/1/IpsecXWRT">http://wiki.strongswan.org/wiki/1/IpsecXWRT</a></p><p>I&#039;m gonna figure out how IPsec is configured first thing tomorrow. Perhaps even try to make a x-wrt install out of all of the above.</p><p>Regards,</p><p>Beus</p><p>/edit typos</p>											<p class="post-edited">(Last edited by <strong>beus</strong> on 31 Aug 2009, 11:13)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p93501">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">beus</div>
					<div class="post-datetime">
						31 Aug 2009, 15:57					</div>
				</div>
				<div class="post-content content">
					<p>trying to get the hang of IPsec/strongSwan, found <a href="http://wiki.strongswan.org/wiki/strongswan/UserDocumentation">http://wiki.strongswan.org/wiki/strongs … umentation</a> to be useful.</p><p>However, was wondering if the following is how it should be:<br /></p><div class="codebox"><pre><code>root@OpenWrt:/# ipsec start
Starting strongSwan 4.2.17 IPsec [starter]...
insmod: cannot insert &#039;ah4&#039;: File exists
insmod: cannot insert &#039;esp4&#039;: File exists
insmod: cannot insert &#039;ipcomp&#039;: unknown symbol in module, or unknown parameter
insmod: cannot insert &#039;xfrm4_tunnel&#039;: File exists
insmod: cannot insert &#039;xfrm_user&#039;: File exists</code></pre></div><p>Extra info:<br /></p><div class="codebox"><pre><code>root@OpenWrt:/# ipsec statusall
Performance:
  uptime: 5 seconds, since Aug 30 14:44:31 2009
  worker threads: 9 idle of 16, job queue load: 0, scheduled events: 0
  loaded plugins: aes sha1 sha2 random x509 pubkey xcbc hmac gmp kernel-netlink stroke updown
Listening IP addresses:
  192.168.1.19
  192.168.2.1
Connections:
Security Associations:
  none</code></pre></div><p>Well this looks good <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" />, it has aes, sha2, x509, pubkey and hmac..</p><p>more info:<br /></p><div class="codebox"><pre><code>root@OpenWrt:/# ipsec listalgs

List of registered IKEv2 Algorithms:

  encryption: AES_CBC
  integrity:  AES_XCBC_96 HMAC_SHA1_96 AUTH_HMAC_SHA1_128 AUTH_HMAC_SHA2_256_128 HMAC_MD5_96 (1026) AUTH_HMAC_SHA2_384_192 AUTH_HMAC_SHA2_512_256
  hasher:     HASH_SHA1 HASH_SHA256 HASH_SHA384 HASH_SHA512
  prf:        PRF_KEYED_SHA1 PRF_AES128_CBC PRF_HMAC_SHA2_256 PRF_HMAC_SHA1 PRF_HMAC_MD5 PRF_HMAC_SHA2_384 PRF_HMAC_SHA2_512
  dh-group:   MODP_2048_BIT MODP_1536_BIT MODP_3072_BIT MODP_4096_BIT MODP_6144_BIT MODP_8192_BIT MODP_1024_BIT MODP_768_BIT</code></pre></div><p>I want to use ECDH (elliptic curve Diffie-Hellman), but lets take things one step at a time.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p93691">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">beus</div>
					<div class="post-datetime">
						4 Sep 2009, 01:45					</div>
				</div>
				<div class="post-content content">
					<p>Trying to get it to compile with the --enable-openssl option for ECC, however I seem to run into a problem.</p><div class="codebox"><pre><code>checking for main in -lcrypto... no
configure: error: OpenSSL crypto library not found
make[3]: *** [/home/beus/openwrt/trunk-4.2.17.3/build_dir/target-mipsel_uClibc-0.9.30.1/strongswan-4.2.17/.configured_] Error 1</code></pre></div><p>I <a href="http://74.125.77.132/search?q=cache:eB9QrDf7sAcJ:wiki.strongswan.org/repositories/entry/strongswan/configure.in%3Fformat%3Draw%26rev%3Dcf00cffef237014486eecd0aa04ed8601a7d5265+%22OpenSSL+crypto+library+not+found%22+openwrt&amp;cd=2&amp;hl=nl&amp;ct=clnk&amp;gl=nl&amp;client=firefox-a">traced</a> it to come Config.in file that contains:<br /></p><div class="codebox"><pre><code>if test x$openssl = xtrue; then

      AC_HAVE_LIBRARY([crypto],[LIBS=&quot;$LIBS&quot;],[AC_MSG_ERROR([OpenSSL crypto library not found])])

      AC_CHECK_HEADER([openssl/evp.h],,[AC_MSG_ERROR([OpenSSL header openssl/evp.h not found!])])

fi</code></pre></div><p>I have yet to figure out which scripts/feeds install package I need, or which option I need to turn on in make menuconfig.</p><p>Did manage to figure out that the default openssl package had ECC disabled.<br />Enable them by removing the &#039;no-ec&#039; options in package/openssl/Makefile.</p><p>Also if you enable the &#039;enable the openssl crypto plugin&#039; option in strongSwan (using make menuconfig, I altered the Config.in an Makefile files) you can enable the &#039;disable own GNU MP (libgmp) based crypto implementation plugin&#039;.</p>											<p class="post-edited">(Last edited by <strong>beus</strong> on 24 Sep 2009, 15:08)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p93721">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">beus</div>
					<div class="post-datetime">
						4 Sep 2009, 16:18					</div>
				</div>
				<div class="post-content content">
					<p>Compiling the strongswan package as described above with the added option of &#039;--enable-uci&#039; crashes.</p><div class="codebox"><pre><code>make[3]: Entering directory `/local/wsjanwillem/package_strongswan-4.2.17.5&#039;
(cd /local/wsjanwillem/trunk.4.2.x/build_dir/target-mipsel_uClibc-0.9.30.1/stron
gswan-4.2.17/./; if [ -x ./configure ]; then /usr/bin/find /local/wsjanwillem/tr
unk.4.2.x/build_dir/target-mipsel_uClibc-0.9.30.1/strongswan-4.2.17/ -name confi
g.guess | xargs -r chmod u+w; /usr/bin/find /local/wsjanwillem/trunk.4.2.x/build
_dir/target-mipsel_uClibc-0.9.30.1/strongswan-4.2.17/ -name config.guess | xargs
 -r -n1 cp /local/wsjanwillem/trunk.4.2.x/scripts/config.guess; /usr/bin/find /l
ocal/wsjanwillem/trunk.4.2.x/build_dir/target-mipsel_uClibc-0.9.30.1/strongswan-
4.2.17/ -name config.sub | xargs -r chmod u+w; /usr/bin/find /local/wsjanwillem/
trunk.4.2.x/build_dir/target-mipsel_uClibc-0.9.30.1/strongswan-4.2.17/ -name con
fig.sub | xargs -r -n1 cp /local/wsjanwillem/trunk.4.2.x/scripts/config.sub; AR=
mipsel-openwrt-linux-uclibc-ar AS=&quot;mipsel-openwrt-linux-uclibc-gcc -c -Os -pipe
-mips32 -mtune=mips32 -funit-at-a-time -fhonour-copts -msoft-float&quot; LD=mipsel-op
enwrt-linux-uclibc-ld NM=mipsel-openwrt-linux-uclibc-nm CC=&quot;mipsel-openwrt-linux
-uclibc-gcc&quot; GCC=&quot;mipsel-openwrt-linux-uclibc-gcc&quot; CXX=&quot;mipsel-openwrt-linux-ucl
ibc-g++&quot; RANLIB=mipsel-openwrt-linux-uclibc-ranlib STRIP=mipsel-openwrt-linux-uc
libc-strip OBJCOPY=mipsel-openwrt-linux-uclibc-objcopy OBJDUMP=mipsel-openwrt-li
nux-uclibc-objdump SIZE=mipsel-openwrt-linux-uclibc-size CFLAGS=&quot;-Os -pipe -mips
32 -mtune=mips32 -funit-at-a-time -fhonour-copts -msoft-float &quot; CXXFLAGS=&quot;-Os -p
ipe -mips32 -mtune=mips32 -funit-at-a-time -fhonour-copts -msoft-float &quot; CPPFLAG
S=&quot;-I/local/wsjanwillem/trunk.4.2.x/staging_dir/target-mipsel_uClibc-0.9.30.1/us
r/include -I/local/wsjanwillem/trunk.4.2.x/staging_dir/target-mipsel_uClibc-0.9.
30.1/include &quot; LDFLAGS=&quot;-L/local/wsjanwillem/trunk.4.2.x/staging_dir/toolchain-m
ipsel_gcc-4.1.2_uClibc-0.9.30.1/usr/lib -L/local/wsjanwillem/trunk.4.2.x/staging
_dir/toolchain-mipsel_gcc-4.1.2_uClibc-0.9.30.1/lib -L/local/wsjanwillem/trunk.4
.2.x/staging_dir/target-mipsel_uClibc-0.9.30.1/usr/lib -L/local/wsjanwillem/trun
k.4.2.x/staging_dir/target-mipsel_uClibc-0.9.30.1/lib &quot;   ./configure --target=m
ipsel-openwrt-linux --host=mipsel-openwrt-linux --build=i486-linux-gnu --program
-prefix=&quot;&quot; --program-suffix=&quot;&quot; --prefix=/usr --exec-prefix=/usr --bindir=/usr/bi
n --sbindir=/usr/sbin --libexecdir=/usr/lib --sysconfdir=/etc --datadir=/usr/sha
re --localstatedir=/var --mandir=/usr/man --infodir=/usr/info --disable-nls  --d
isable-ipv6   --with-urandom-device=   --disable-des --disable-fips-prf   --disa
ble-md5 --disable-pluto       --disable-tools
     --enable-uci  --with-routing-table=&quot;220&quot; --disable-static ; fi; )
configure: WARNING: unrecognized options: --disable-nls, --disable-ipv6
configure: loading site script /local/wsjanwillem/trunk.4.2.x/include/site/mipsel-openwrt-linux-uclibc
checking for a BSD-compatible install... /usr/bin/install -c
checking whether build environment is sane... yes
checking for a thread-safe mkdir -p... /bin/mkdir -p
checking for gawk... gawk
checking whether make sets $(MAKE)... yes
checking for mipsel-openwrt-linux-strip... mipsel-openwrt-linux-uclibc-strip
checking how to create a ustar tar archive... gnutar
checking for style of include used by make... GNU
checking for mipsel-openwrt-linux-gcc... mipsel-openwrt-linux-uclibc-gcc
checking for C compiler default output file name... a.out
checking whether the C compiler works... yes
checking whether we are cross compiling... yes
checking for suffix of executables...
checking for suffix of object files... o
checking whether we are using the GNU C compiler... yes
checking whether mipsel-openwrt-linux-uclibc-gcc accepts -g... yes
checking for mipsel-openwrt-linux-uclibc-gcc option to accept ISO C89... none needed
checking dependency style of mipsel-openwrt-linux-uclibc-gcc... gcc3
checking how to run the C preprocessor... mipsel-openwrt-linux-uclibc-gcc -E
checking for grep that handles long lines and -e... /bin/grep
checking for egrep... /bin/grep -E
checking for ANSI C header files... yes
checking for sys/types.h... yes
checking for sys/stat.h... yes
checking for stdlib.h... yes
checking for string.h... yes
checking for memory.h... yes
checking for strings.h... yes
checking for inttypes.h... yes
checking for stdint.h... yes
checking for unistd.h... yes
checking whether byte ordering is bigendian... (cached) no
checking pkg-config is at least version 0.9.0... yes
checking for a BSD-compatible install... /usr/bin/install -c
checking build system type... i486-pc-linux-gnu
checking host system type... mipsel-openwrt-linux-gnu
checking for a sed that does not truncate output... /local/wsjanwillem/trunk.4.2.x/staging_dir/host/bin/sed
checking for fgrep... /bin/grep -F
checking for ld used by mipsel-openwrt-linux-uclibc-gcc... mipsel-openwrt-linux-uclibc-ld
checking if the linker (mipsel-openwrt-linux-uclibc-ld) is GNU ld... yes
checking for BSD- or MS-compatible name lister (nm)... mipsel-openwrt-linux-uclibc-nm
checking the name lister (mipsel-openwrt-linux-uclibc-nm) interface... BSD nm
checking whether ln -s works... yes
checking the maximum length of command line arguments... 98304
checking whether the shell understands some XSI constructs... yes
checking whether the shell understands &quot;+=&quot;... yes
checking for mipsel-openwrt-linux-uclibc-ld option to reload object files... -r
checking for mipsel-openwrt-linux-objdump... mipsel-openwrt-linux-uclibc-objdump
checking how to recognize dependent libraries... pass_all
checking for mipsel-openwrt-linux-ar... mipsel-openwrt-linux-uclibc-ar
checking for mipsel-openwrt-linux-strip... (cached) mipsel-openwrt-linux-uclibc-strip
checking for mipsel-openwrt-linux-ranlib... mipsel-openwrt-linux-uclibc-ranlib
checking command to parse mipsel-openwrt-linux-uclibc-nm output from mipsel-openwrt-linux-uclibc-gcc object... ok
checking for dlfcn.h... yes
checking for objdir... .libs
checking if mipsel-openwrt-linux-uclibc-gcc supports -fno-rtti -fno-exceptions... no
checking for mipsel-openwrt-linux-uclibc-gcc option to produce PIC... -fPIC -DPIC
checking if mipsel-openwrt-linux-uclibc-gcc PIC flag -fPIC -DPIC works... yes
checking if mipsel-openwrt-linux-uclibc-gcc static flag -static works... yes
checking if mipsel-openwrt-linux-uclibc-gcc supports -c -o file.o... yes
checking if mipsel-openwrt-linux-uclibc-gcc supports -c -o file.o... (cached) yes
checking whether the mipsel-openwrt-linux-uclibc-gcc linker (mipsel-openwrt-linux-uclibc-ld) supports shared libraries... yes
checking whether -lc should be explicitly linked in... no
checking dynamic linker characteristics... GNU/Linux ld.so
checking how to hardcode library paths into programs... immediate
checking whether stripping libraries is possible... yes
checking if libtool supports shared libraries... yes
checking whether to build shared libraries... yes
checking whether to build static libraries... no
checking for flex... flex
checking lex output file root... lex.yy
checking lex library... none needed
checking whether yytext is a pointer... no
checking for bison... bison -y
checking for mipsel-openwrt-linux-gcc... (cached) mipsel-openwrt-linux-uclibc-gcc
checking whether we are using the GNU C compiler... (cached) yes
checking whether mipsel-openwrt-linux-uclibc-gcc accepts -g... (cached) yes
checking for mipsel-openwrt-linux-uclibc-gcc option to accept ISO C89... (cached) none needed
checking dependency style of mipsel-openwrt-linux-uclibc-gcc... (cached) gcc3
checking for gperf... no
checking for perl... /usr/bin/perl
checking for main in -ldl... yes
checking for backtrace... no
checking for dladdr... yes
checking for gcc atomic operations... no
checking for register_printf_function... yes
checking for main in -lgmp... yes
checking gmp.h version &gt;= 4.1.4... yes
checking for main in -luci... no
configure: error: UCI library libuci not found
make[3]: *** [/local/wsjanwillem/trunk.4.2.x/build_dir/target-mipsel_uClibc-0.9.                                             30.1/strongswan-4.2.17/.configured_] Error 1
make[3]: Leaving directory `/local/wsjanwillem/package_strongswan-4.2.17.5&#039;
make[2]: *** [package/package_strongswan-4.2.17.5/compile] Error 2
make[2]: Leaving directory `/local/wsjanwillem/trunk.4.2.x&#039;
make[1]: *** [/local/wsjanwillem/trunk.4.2.x/staging_dir/target-mipsel_uClibc-0.                                             9.30.1/stamp/.package_compile] Error 2
make[1]: Leaving directory `/local/wsjanwillem/trunk.4.2.x&#039;
make: *** [world] Error 2</code></pre></div><p><a href="http://74.125.77.132/search?q=cache:eB9QrDf7sAcJ:wiki.strongswan.org/repositories/entry/strongswan/configure.in%3Fformat%3Draw%26rev%3Dcf00cffef237014486eecd0aa04ed8601a7d5265+%22OpenSSL+crypto+library+not+found%22+openwrt&amp;cd=2&amp;hl=nl&amp;ct=clnk&amp;gl=nl&amp;client=firefox-a">Traced this</a> to the Config.in file stating:<br /></p><div class="codebox"><pre><code>AC_ARG_ENABLE(
      [uci],
      AS_HELP_STRING([--enable-uci],[enable OpenWRT UCI configuration plugin (default is NO).]),
      [if test x$enableval = xyes; then
             uci=true
      fi]
) 
...
if test x$uci = xtrue; then

      AC_HAVE_LIBRARY([uci],[LIBS=&quot;$LIBS&quot;],[AC_MSG_ERROR([UCI library libuci not found])])

      AC_CHECK_HEADER([uci.h],,[AC_MSG_ERROR([UCI header uci.h not found!])])

fi 
...
AM_CONDITIONAL(USE_UCI, test x$uci = xtrue)
...
src/charon/plugins/uci/Makefile</code></pre></div><p>At the time of writing I have no clue which kernel option or package is missing to make this compile work. PACKAGE_libuci is enabled...</p><p>*edit<br />compiling it again after installing package luci-uci results in the following different error:<br /></p><div class="codebox"><pre><code>...
make[8]: Entering directory `/local/wsjanwillem/trunk.4.2.x/build_dir/target-mipsel_uClibc-0.9.30.1/strongswan-4.2.17/src/charon/plugins/updown&#039;
make[8]: Nothing to be done for `install-exec-am&#039;.
test -z &quot;/usr/lib/ipsec/plugins&quot; || /bin/mkdir -p &quot;/local/wsjanwillem/trunk.4.2.x/build_dir/target-mipsel_uClibc-0.9.30.1/strongswan-4.2.17/ipkg-install/usr/lib/ipsec/plugins&quot; /bin/bash ../../../../libtool   --mode=install /usr/bin/install -c  &#039;libstrongswan-updown.la&#039; &#039;/local/wsjanwillem/trunk.4.2.x/build_dir/target-mipsel_uClibc-0.9.30.1/strongswan-4.2.17/ipkg-install/usr/lib/ipsec/plugins/libstrongswan-updown.la&#039;
libtool: install: /usr/bin/install -c .libs/libstrongswan-updown.so.0.0.0 /local/wsjanwillem/trunk.4.2.x/build_dir/target-mipsel_uClibc-0.9.30.1/strongswan-4.2.17/ipkg-install/usr/lib/ipsec/plugins/libstrongswan-updown.so.0.0.0
libtool: install: (cd /local/wsjanwillem/trunk.4.2.x/build_dir/target-mipsel_uClibc-0.9.30.1/strongswan-4.2.17/ipkg-install/usr/lib/ipsec/plugins &amp;&amp; { ln -s -f libstrongswan-updown.so.0.0.0 libstrongswan-updown.so.0 || { rm -f libstrongswan-updown.so.0 &amp;&amp; ln -s libstrongswan-updown.so.0.0.0 libstrongswan-updown.so.0; }; })
libtool: install: (cd /local/wsjanwillem/trunk.4.2.x/build_dir/target-mipsel_uClibc-0.9.30.1/strongswan-4.2.17/ipkg-install/usr/lib/ipsec/plugins &amp;&amp; { ln -s -f libstrongswan-updown.so.0.0.0 libstrongswan-updown.so || { rm -f libstrongswan-updown.so &amp;&amp; ln -s libstrongswan-updown.so.0.0.0 libstrongswan-updown.so; }; })
libtool: install: /usr/bin/install -c .libs/libstrongswan-updown.lai /local/wsjanwillem/trunk.4.2.x/build_dir/target-mipsel_uClibc-0.9.30.1/strongswan-4.2.17/ipkg-install/usr/lib/ipsec/plugins/libstrongswan-updown.la
libtool: install: warning: remember to run `libtool --finish /usr/lib/ipsec/plugins&#039;
make[8]: Leaving directory `/local/wsjanwillem/trunk.4.2.x/build_dir/target-mipsel_uClibc-0.9.30.1/strongswan-4.2.17/src/charon/plugins/updown&#039;
make[7]: Leaving directory `/local/wsjanwillem/trunk.4.2.x/build_dir/target-mipsel_uClibc-0.9.30.1/strongswan-4.2.17/src/charon/plugins/updown&#039;
Making install in plugins/uci
make[7]: Entering directory `/local/wsjanwillem/trunk.4.2.x/build_dir/target-mipsel_uClibc-0.9.30.1/strongswan-4.2.17/src/charon/plugins/uci&#039;
/bin/bash ../../../../libtool --tag=CC   --mode=compile mipsel-openwrt-linux-uclibc-gcc -DPACKAGE_NAME=\&quot;strongSwan\&quot; -DPACKAGE_TARNAME=\&quot;strongswan\&quot; -DPACKAGE_VERSION=\&quot;4.2.17\&quot; -DPACKAGE_STRING=\&quot;strongSwan\ 4.2.17\&quot; -DPACKAGE_BUGREPORT=\&quot;\&quot; -DPACKAGE=\&quot;strongswan\&quot; -DVERSION=\&quot;4.2.17\&quot; -DSTDC_HEADERS=1 -DHAVE_SYS_TYPES_H=1 -DHAVE_SYS_STAT_H=1 -DHAVE_STDLIB_H=1 -DHAVE_STRING_H=1 -DHAVE_MEMORY_H=1 -DHAVE_STRINGS_H=1 -DHAVE_INTTYPES_H=1 -DHAVE_STDINT_H=1 -DHAVE_UNISTD_H=1 -DPKCS11_DEFAULT_LIB=\&quot;/usr/lib/opensc-pkcs11.so\&quot; -DDEV_RANDOM=\&quot;/dev/random\&quot; -DDEV_URANDOM=\&quot;\&quot; -DIPSEC_ROUTING_TABLE=220 -DIPSEC_ROUTING_TABLE_PRIO=220 -DHAVE_DLFCN_H=1 -DLT_OBJDIR=\&quot;.libs/\&quot; -DHAVE_LIBDL=1 -DHAVE_DLADDR=1 -DHAVE_PRINTF_HOOKS=1 -I. -I../../../../src/libstrongswan -I../../../../src/charon  -I/local/wsjanwillem/trunk.4.2.x/staging_dir/target-mipsel_uClibc-0.9.30.1/usr/include -I/local/wsjanwillem/trunk.4.2.x/staging_dir/target-mipsel_uClibc-0.9.30.1/include  -rdynamic -Os -pipe -mips32 -mtune=mips32 -funit-at-a-time -fhonour-copts -msoft-float  -MT uci_plugin.lo -MD -MP -MF .deps/uci_plugin.Tpo -c -o uci_plugin.lo uci_plugin.c
libtool: compile:  mipsel-openwrt-linux-uclibc-gcc -DPACKAGE_NAME=\&quot;strongSwan\&quot; -DPACKAGE_TARNAME=\&quot;strongswan\&quot; -DPACKAGE_VERSION=\&quot;4.2.17\&quot; &quot;-DPACKAGE_STRING=\&quot;strongSwan 4.2.17\&quot;&quot; -DPACKAGE_BUGREPORT=\&quot;\&quot; -DPACKAGE=\&quot;strongswan\&quot; -DVERSION=\&quot;4.2.17\&quot; -DSTDC_HEADERS=1 -DHAVE_SYS_TYPES_H=1 -DHAVE_SYS_STAT_H=1 -DHAVE_STDLIB_H=1 -DHAVE_STRING_H=1 -DHAVE_MEMORY_H=1 -DHAVE_STRINGS_H=1 -DHAVE_INTTYPES_H=1 -DHAVE_STDINT_H=1 -DHAVE_UNISTD_H=1 -DPKCS11_DEFAULT_LIB=\&quot;/usr/lib/opensc-pkcs11.so\&quot; -DDEV_RANDOM=\&quot;/dev/random\&quot; -DDEV_URANDOM=\&quot;\&quot; -DIPSEC_ROUTING_TABLE=220 -DIPSEC_ROUTING_TABLE_PRIO=220 -DHAVE_DLFCN_H=1 -DLT_OBJDIR=\&quot;.libs/\&quot; -DHAVE_LIBDL=1 -DHAVE_DLADDR=1 -DHAVE_PRINTF_HOOKS=1 -I. -I../../../../src/libstrongswan -I../../../../src/charon -I/local/wsjanwillem/trunk.4.2.x/staging_dir/target-mipsel_uClibc-0.9.30.1/usr/include -I/local/wsjanwillem/trunk.4.2.x/staging_dir/target-mipsel_uClibc-0.9.30.1/include -rdynamic -Os -pipe -mips32 -mtune=mips32 -funit-at-a-time -fhonour-copts -msoft-float -MT uci_plugin.lo -MD -MP -MF .deps/uci_plugin.Tpo -c uci_plugin.c  -fPIC -DPIC -o .libs/uci_plugin.o
mv -f .deps/uci_plugin.Tpo .deps/uci_plugin.Plo
/bin/bash ../../../../libtool --tag=CC   --mode=compile mipsel-openwrt-linux-uclibc-gcc -DPACKAGE_NAME=\&quot;strongSwan\&quot; -DPACKAGE_TARNAME=\&quot;strongswan\&quot; -DPACKAGE_VERSION=\&quot;4.2.17\&quot; -DPACKAGE_STRING=\&quot;strongSwan\ 4.2.17\&quot; -DPACKAGE_BUGREPORT=\&quot;\&quot; -DPACKAGE=\&quot;strongswan\&quot; -DVERSION=\&quot;4.2.17\&quot; -DSTDC_HEADERS=1 -DHAVE_SYS_TYPES_H=1 -DHAVE_SYS_STAT_H=1 -DHAVE_STDLIB_H=1 -DHAVE_STRING_H=1 -DHAVE_MEMORY_H=1 -DHAVE_STRINGS_H=1 -DHAVE_INTTYPES_H=1 -DHAVE_STDINT_H=1 -DHAVE_UNISTD_H=1 -DPKCS11_DEFAULT_LIB=\&quot;/usr/lib/opensc-pkcs11.so\&quot; -DDEV_RANDOM=\&quot;/dev/random\&quot; -DDEV_URANDOM=\&quot;\&quot; -DIPSEC_ROUTING_TABLE=220 -DIPSEC_ROUTING_TABLE_PRIO=220 -DHAVE_DLFCN_H=1 -DLT_OBJDIR=\&quot;.libs/\&quot; -DHAVE_LIBDL=1 -DHAVE_DLADDR=1 -DHAVE_PRINTF_HOOKS=1 -I. -I../../../../src/libstrongswan -I../../../../src/charon  -I/local/wsjanwillem/trunk.4.2.x/staging_dir/target-mipsel_uClibc-0.9.30.1/usr/include -I/local/wsjanwillem/trunk.4.2.x/staging_dir/target-mipsel_uClibc-0.9.30.1/include  -rdynamic -Os -pipe -mips32 -mtune=mips32 -funit-at-a-time -fhonour-copts -msoft-float  -MT uci_parser.lo -MD -MP -MF .deps/uci_parser.Tpo -c -o uci_parser.lo uci_parser.c
libtool: compile:  mipsel-openwrt-linux-uclibc-gcc -DPACKAGE_NAME=\&quot;strongSwan\&quot; -DPACKAGE_TARNAME=\&quot;strongswan\&quot; -DPACKAGE_VERSION=\&quot;4.2.17\&quot; &quot;-DPACKAGE_STRING=\&quot;strongSwan 4.2.17\&quot;&quot; -DPACKAGE_BUGREPORT=\&quot;\&quot; -DPACKAGE=\&quot;strongswan\&quot; -DVERSION=\&quot;4.2.17\&quot; -DSTDC_HEADERS=1 -DHAVE_SYS_TYPES_H=1 -DHAVE_SYS_STAT_H=1 -DHAVE_STDLIB_H=1 -DHAVE_STRING_H=1 -DHAVE_MEMORY_H=1 -DHAVE_STRINGS_H=1 -DHAVE_INTTYPES_H=1 -DHAVE_STDINT_H=1 -DHAVE_UNISTD_H=1 -DPKCS11_DEFAULT_LIB=\&quot;/usr/lib/opensc-pkcs11.so\&quot; -DDEV_RANDOM=\&quot;/dev/random\&quot; -DDEV_URANDOM=\&quot;\&quot; -DIPSEC_ROUTING_TABLE=220 -DIPSEC_ROUTING_TABLE_PRIO=220 -DHAVE_DLFCN_H=1 -DLT_OBJDIR=\&quot;.libs/\&quot; -DHAVE_LIBDL=1 -DHAVE_DLADDR=1 -DHAVE_PRINTF_HOOKS=1 -I. -I../../../../src/libstrongswan -I../../../../src/charon -I/local/wsjanwillem/trunk.4.2.x/staging_dir/target-mipsel_uClibc-0.9.30.1/usr/include -I/local/wsjanwillem/trunk.4.2.x/staging_dir/target-mipsel_uClibc-0.9.30.1/include -rdynamic -Os -pipe -mips32 -mtune=mips32 -funit-at-a-time -fhonour-copts -msoft-float -MT uci_parser.lo -MD -MP -MF .deps/uci_parser.Tpo -c uci_parser.c  -fPIC -DPIC -o .libs/uci_parser.o
uci_parser.c: In function &#039;section_enumerator_enumerate&#039;:
uci_parser.c:85: error: &#039;struct uci_option&#039; has no member named &#039;value&#039;
uci_parser.c:100: error: &#039;struct uci_option&#039; has no member named &#039;value&#039;
make[7]: *** [uci_parser.lo] Error 1
make[7]: Leaving directory `/local/wsjanwillem/trunk.4.2.x/build_dir/target-mipsel_uClibc-0.9.30.1/strongswan-4.2.17/src/charon/plugins/uci&#039;
make[6]: *** [install-recursive] Error 1
make[6]: Leaving directory `/local/wsjanwillem/trunk.4.2.x/build_dir/target-mipsel_uClibc-0.9.30.1/strongswan-4.2.17/src/charon&#039;
make[5]: *** [install-recursive] Error 1
make[5]: Leaving directory `/local/wsjanwillem/trunk.4.2.x/build_dir/target-mipsel_uClibc-0.9.30.1/strongswan-4.2.17/src&#039;
make[4]: *** [install-recursive] Error 1
make[4]: Leaving directory `/local/wsjanwillem/trunk.4.2.x/build_dir/target-mipsel_uClibc-0.9.30.1/strongswan-4.2.17&#039;
make[3]: *** [/local/wsjanwillem/trunk.4.2.x/build_dir/target-mipsel_uClibc-0.9.30.1/strongswan-4.2.17/.built] Error 2
make[3]: Leaving directory `/local/wsjanwillem/package_strongswan-4.2.17.5&#039;
make[2]: *** [package/package_strongswan-4.2.17.5/compile] Error 2
make[2]: Leaving directory `/local/wsjanwillem/trunk.4.2.x&#039;
make[1]: *** [/local/wsjanwillem/trunk.4.2.x/staging_dir/target-mipsel_uClibc-0.9.30.1/stamp/.package_compile] Error 2
make[1]: Leaving directory `/local/wsjanwillem/trunk.4.2.x&#039;
make: *** [world] Error 2</code></pre></div><p>*edit<br /><a href="http://wiki.strongswan.org/wiki/1/IpsecUci">http://wiki.strongswan.org/wiki/1/IpsecUci</a> states &quot;Use the configure option --enable-uci. You also need the libuci library and the uci tool.&quot;<br />the libuci library is no problem, the uci tool is what has me looking everywhere... Anyone any idea?<br />*edit<br />I might have traced the source of the problem, make reports:<br /></p><div class="codebox"><pre><code> make[1] world
 make[2] target/compile
 make[3] -C target/linux compile
 make[2] package/cleanup
 make[2] package/compile
 make[3] -C package/base-files compile
...
 make[3] -C package/opkg compile
 make[3] -C /home/beus/openwrt/package_strongswan-4.2.17.1 compile
 make[3] -C package/linux-atm compile
 make[3] -C package/libpcap compile
 make[3] -C package/ppp compile
 make[3] -C package/switch compile
 make[3] -C package/uci compile
 make[3] -C package/udevtrigger compile
 make[2] package/install
 make[3] -C package/base-files install
 make[3] -C package/broadcom-diag install
...</code></pre></div><p>ergo package/uci is compiled after strongswan, so it would be logical for strongSwan not to find the neccessary files.</p><p>*edit the solution to this is adding the following line to strongswan&#039;s Makefile.<br /></p><div class="codebox"><pre><code>PKG_BUILD_DEPENDS:=libuci</code></pre></div><p>The next error to tackle is:<br /></p><div class="codebox"><pre><code>/bin/bash ../../../../libtool --tag=CC   --mode=compile mipsel-openwrt-linux-uclibc-gcc -DPACKAGE_NAME=\&quot;strongSwan\&quot; -DPACKAGE_TARNAME=\&quot;strongswan\&quot; -DPACKAGE_VERSION=\&quot;4.2.17\&quot; -DPACKAGE_STRING=\&quot;strongSwan\ 4.2.17\&quot; -DPACKAGE_BUGREPORT=\&quot;\&quot; -DPACKAGE=\&quot;strongswan\&quot; -DVERSION=\&quot;4.2.17\&quot; -DSTDC_HEADERS=1 -DHAVE_SYS_TYPES_H=1 -DHAVE_SYS_STAT_H=1 -DHAVE_STDLIB_H=1 -DHAVE_STRING_H=1 -DHAVE_MEMORY_H=1 -DHAVE_STRINGS_H=1 -DHAVE_INTTYPES_H=1 -DHAVE_STDINT_H=1 -DHAVE_UNISTD_H=1 -DPKCS11_DEFAULT_LIB=\&quot;/usr/lib/opensc-pkcs11.so\&quot; -DDEV_RANDOM=\&quot;/dev/random\&quot; -DDEV_URANDOM=\&quot;\&quot; -DIPSEC_ROUTING_TABLE=220 -DIPSEC_ROUTING_TABLE_PRIO=220 -DHAVE_DLFCN_H=1 -DLT_OBJDIR=\&quot;.libs/\&quot; -DHAVE_LIBDL=1 -DHAVE_DLADDR=1 -DHAVE_PRINTF_HOOKS=1 -I. -I../../../../src/libstrongswan -I../../../../src/charon  -I/home/beus/openwrt/trunk-4.2.17.3-2/staging_dir/target-mipsel_uClibc-0.9.30.1/usr/include -I/home/beus/openwrt/trunk-4.2.17.3-2/staging_dir/target-mipsel_uClibc-0.9.30.1/include  -rdynamic -Os -pipe -mips32 -mtune=mips32 -funit-at-a-time -fhonour-copts -msoft-float  -MT uci_parser.lo -MD -MP -MF .deps/uci_parser.Tpo -c -o uci_parser.lo uci_parser.c
libtool: compile:  mipsel-openwrt-linux-uclibc-gcc -DPACKAGE_NAME=\&quot;strongSwan\&quot; -DPACKAGE_TARNAME=\&quot;strongswan\&quot; -DPACKAGE_VERSION=\&quot;4.2.17\&quot; &quot;-DPACKAGE_STRING=\&quot;strongSwan 4.2.17\&quot;&quot; -DPACKAGE_BUGREPORT=\&quot;\&quot; -DPACKAGE=\&quot;strongswan\&quot; -DVERSION=\&quot;4.2.17\&quot; -DSTDC_HEADERS=1 -DHAVE_SYS_TYPES_H=1 -DHAVE_SYS_STAT_H=1 -DHAVE_STDLIB_H=1 -DHAVE_STRING_H=1 -DHAVE_MEMORY_H=1 -DHAVE_STRINGS_H=1 -DHAVE_INTTYPES_H=1 -DHAVE_STDINT_H=1 -DHAVE_UNISTD_H=1 -DPKCS11_DEFAULT_LIB=\&quot;/usr/lib/opensc-pkcs11.so\&quot; -DDEV_RANDOM=\&quot;/dev/random\&quot; -DDEV_URANDOM=\&quot;\&quot; -DIPSEC_ROUTING_TABLE=220 -DIPSEC_ROUTING_TABLE_PRIO=220 -DHAVE_DLFCN_H=1 -DLT_OBJDIR=\&quot;.libs/\&quot; -DHAVE_LIBDL=1 -DHAVE_DLADDR=1 -DHAVE_PRINTF_HOOKS=1 -I. -I../../../../src/libstrongswan -I../../../../src/charon -I/home/beus/openwrt/trunk-4.2.17.3-2/staging_dir/target-mipsel_uClibc-0.9.30.1/usr/include -I/home/beus/openwrt/trunk-4.2.17.3-2/staging_dir/target-mipsel_uClibc-0.9.30.1/include -rdynamic -Os -pipe -mips32 -mtune=mips32 -funit-at-a-time -fhonour-copts -msoft-float -MT uci_parser.lo -MD -MP -MF .deps/uci_parser.Tpo -c uci_parser.c  -fPIC -DPIC -o .libs/uci_parser.o
uci_parser.c: In function &#039;section_enumerator_enumerate&#039;:
uci_parser.c:85: error: &#039;struct uci_option&#039; has no member named &#039;value&#039;
uci_parser.c:100: error: &#039;struct uci_option&#039; has no member named &#039;value&#039;
make[7]: *** [uci_parser.lo] Error 1
make[7]: Leaving directory `/home/beus/openwrt/trunk-4.2.17.3-2/build_dir/target-mipsel_uClibc-0.9.30.1/strongswan-4.2.17/src/charon/plugins/uci&#039;
make[6]: *** [install-recursive] Error 1
make[6]: Leaving directory `/home/beus/openwrt/trunk-4.2.17.3-2/build_dir/target-mipsel_uClibc-0.9.30.1/strongswan-4.2.17/src/charon&#039;
make[5]: *** [install-recursive] Error 1
make[5]: Leaving directory `/home/beus/openwrt/trunk-4.2.17.3-2/build_dir/target-mipsel_uClibc-0.9.30.1/strongswan-4.2.17/src&#039;
make[4]: *** [install-recursive] Error 1
make[4]: Leaving directory `/home/beus/openwrt/trunk-4.2.17.3-2/build_dir/target-mipsel_uClibc-0.9.30.1/strongswan-4.2.17&#039;
make[3]: *** [/home/beus/openwrt/trunk-4.2.17.3-2/build_dir/target-mipsel_uClibc-0.9.30.1/strongswan-4.2.17/.built] Error 2
make[3]: Leaving directory `/home/beus/openwrt/package_strongswan-4.2.17.7&#039;
make[2]: *** [package/package_strongswan-4.2.17.7/compile] Error 2
make[2]: Leaving directory `/home/beus/openwrt/trunk-4.2.17.3-2&#039;
make[1]: *** [/home/beus/openwrt/trunk-4.2.17.3-2/staging_dir/target-mipsel_uClibc-0.9.30.1/stamp/.package_compile] Error 2
make[1]: Leaving directory `/home/beus/openwrt/trunk-4.2.17.3-2&#039;
make: *** [world] Error 2</code></pre></div>											<p class="post-edited">(Last edited by <strong>beus</strong> on 10 Sep 2009, 14:40)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p94728">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">beus</div>
					<div class="post-datetime">
						21 Sep 2009, 14:30					</div>
				</div>
				<div class="post-content content">
					<p>interesing build options obtained <a href="http://wiki.strongswan.org/wiki/1/NetworkManager?version=11">here</a> that includes the netmanager. It is interesting because the build options include openssl, and disable several ciphers.<br /></p><div class="codebox"><pre><code>get strongswan SVN
svn co http://www.strongswan.org/ikev2/trunk strongswan
cd strongswan

build charon with OpenSSL/NM Plugin
./autogen.sh
./configure --disable-aes --disable-des --disable-md5 --disable-sha1 --disable-sha2 \
--disable-fips-prf --disable-gmp --disable-stroke --disable-pluto --disable-tools \
--disable-updown --enable-openssl --enable-nm --enable-eap-gtc \
--sysconfdir=/etc --prefix=/usr --libexecdir=/usr/lib
make
make install

build NetworkManager&#039;s strongsSwan plugin
cd src/charon/plugins/nm/gnome
./autogen.sh --sysconfdir=/etc --prefix=/usr --libexecdir=/usr/lib
make
make install</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p97877">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">aport</div>
					<div class="post-datetime">
						24 Nov 2009, 22:54					</div>
				</div>
				<div class="post-content content">
					<p>Just wanted to post a little update for me in this thread. I&#039;m using the latest tarball posted by norbert in the ticket above, and it&#039;s working GREAT! I really appreciate all the hard work... I prefer strongswan to openswan, and definitely over ipsec-tools &amp; racoon.</p><br /><p>My only issue now is that the OpenWRT firewall is very restrictive, which is a good thing. I need to punch some little holes to allow the esp traffic to flow, but I&#039;m not sure which chains to add the rules to. Any help would be greatly appreciated!</p><br /><br /><p>Here&#039;s what I have so far:</p><p>iptables -A input_rule -p esp -s $REMOTE_WAN -j ACCEPT<br />iptables -t nat -A postrouting_rule -d $REMOTE_SUBNET -j ACCEPT</p><br /><br /><p>This seems to work pretty well, but once the traffic is decrypted the firewall likes to drop all the packets originating from the remote subnet, so I added:<br />iptables -A input_rule -p tcp -s $REMOTE_SUBNET -j ACCEPT</p><br /><p>Not sure if that last rule poses any security threats.</p>											<p class="post-edited">(Last edited by <strong>aport</strong> on 25 Nov 2009, 00:46)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p104019">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">beus</div>
					<div class="post-datetime">
						1 Mar 2010, 18:01					</div>
				</div>
				<div class="post-content content">
					<p>Part of my struggles came from wanting the use the curl library. During compilation of strongswan -- or actually during the check before compilation -- an error occurred:<br /></p><div class="codebox"><pre><code>checking for main in -lcurl... no</code></pre></div><p>A solution I found by adding a TARGET_LDFLAGS command in the Makefile.</p><div class="codebox"><pre><code>...
PKG_BUILD_DIR:=$(BUILD_DIR)/$(PKG_NAME)-$(PKG_VERSION)
PKG_INSTALL_DIR:=$(PKG_BUILD_DIR)/ipkg-install

include $(INCLUDE_DIR)/package.mk

TARGET_LDFLAGS+=-Wl,-rpath-link=$(STAGING_DIR)/usr/lib

define Package/strongswan
  SECTION:=net
  CATEGORY:=Network
...</code></pre></div><p>.<br />thus <strong>TARGET_LDFLAGS+=-Wl,-rpath-link=$(STAGING_DIR)/usr/lib</strong> did the trick.</p>											<p class="post-edited">(Last edited by <strong>beus</strong> on 4 Mar 2010, 17:43)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p104224">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">beus</div>
					<div class="post-datetime">
						4 Mar 2010, 16:08					</div>
				</div>
				<div class="post-content content">
					<p>I encountered an error when I tried to minimize the footprint. As I do not need ikev1 I tried to disable all that has to do with pluto.</p><p>During which I found that <br />- one can disable pluto without problems<br />- one can disable tools without problems<br />- disabling pluto and stroke but not tools gives an error due to some file not found (some tools build upon ikev1).<br />- disabling pluto, stroke and tools gives an error due to the Makefile. As the install part of the make script refers to ipsec which appears no longer available.</p><p>changing the Makefile line<br /></p><div class="codebox"><pre><code>$(CP) $(PKG_INSTALL_DIR)/usr/sbin/ipsec $(1)/usr/sbin</code></pre></div><p>into<br /></p><div class="codebox"><pre><code>$(if $(!CONFIG_STRONGSWAN_STROKE),$(CP) $(PKG_INSTALL_DIR)/usr/sbin/ipsec $(1)/usr/sbin)</code></pre></div><p>did the trick, now it compiles fine. HOWEVER the ipsec command has not been build so you cannot start strongswan using &#039;ipsec start&#039;. I&#039;m not sure if the uci backend will work...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p105903">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">aport</div>
					<div class="post-datetime">
						2 Apr 2010, 20:45					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ve made an init script and UCI config for setting up some basic site-to-site tunnels with StrongSwan:<br /></p><div class="codebox"><pre><code>#!/bin/sh /etc/rc.common
# Copyright (C) 2009 NexAira Inc.
# Copyright (C) 2010 Adam Porter &lt;porter.adam@gmail.com&gt;

START=70
STOP=40

check_keyexchange() {
    local cfg=&quot;$1&quot;
    config_get keyexchange &quot;$cfg&quot; keyexchange

    [ &quot;$keyexchange&quot; = &quot;ikev1&quot; ] &amp;&amp; ikev1=yes 
    [ &quot;$keyexchange&quot; = &quot;ikev2&quot; ] &amp;&amp; ikev2=yes
}

setup_secrets() {
    local key
    config_get key &quot;$cfg&quot; key

    [ &quot;$wanip&quot; = &quot;%defaultroute&quot; ] &amp;&amp; wanip=&quot;%any&quot;

cat &gt;&gt; /etc/ipsec.secrets &lt;&lt;EOF
$wanip $remote_wan : PSK &quot;$key&quot;
EOF
}

setup_ipsecconf() {
    local cfg=&quot;$1&quot;

    config_get_bool enabled &quot;$cfg&quot; enabled 0

    [ &quot;$enabled&quot; = &quot;0&quot; ] &amp;&amp; return

    local leftsubnet rightsubnet local_lan remote_lan waniface auto
    local tunnel_name local_lan_network remote_wan remote_wan_network key keyexchange
    local wanip wandev waniface integrity ikeintegrity encryption dhgroup strict

    tunnel_name=&quot;$cfg&quot;
    config_get waniface &quot;$cfg&quot; waniface
    config_get local_lan &quot;$cfg&quot; local_lan
    config_get local_lan_network &quot;$cfg&quot; local_lan_network
    config_get remote_wan &quot;$cfg&quot; remote_wan
    config_get remote_lan &quot;$cfg&quot; remote_lan
    config_get remote_lan_network &quot;$cfg&quot; remote_lan_network
    config_get keyexchange &quot;$cfg&quot; keyexchange
    config_get integrity &quot;$cfg&quot; integrity
    config_get encryption &quot;$cfg&quot; encryption
    config_get dhgroup &quot;$cfg&quot; dhgroup
    config_get_bool strict &quot;$cfg&quot; strict 0
    config_get auto &quot;$cfg&quot; auto


    # calculate local network info
    eval &quot;$(ipcalc.sh $local_lan $local_lan_network)&quot;
    leftsubnet=&quot;$NETWORK/$PREFIX&quot;

    # calculate remote network info
    eval &quot;$(ipcalc.sh $remote_lan $remote_lan_network)&quot;
    rightsubnet=&quot;$NETWORK/$PREFIX&quot;

    # get the WAN IP
    if [ &quot;$waniface&quot; = &quot;default&quot; ]; then
        wanip=&quot;%defaultroute&quot;
    else
        wanip=$(uci -P /var/state get network.&quot;$waniface&quot;.ipaddr)
    fi

    # if there&#039;s no WAN IP, get out of here
    [ -z &quot;$wanip&quot; ] &amp;&amp; return

    [ &quot;$strict&quot; = 0 ] &amp;&amp; strict=&quot; &quot; || strict=&quot;!&quot;
    [ &quot;$integrity&quot; = &quot;sha1&quot; ] &amp;&amp; ikeintegrity=&quot;sha&quot; || ikeintegrity=&quot;md5&quot;

    cat &gt;&gt; /etc/ipsec.conf &lt;&lt;EOF
conn $tunnel_name
    left=$wanip
    leftsubnet=$leftsubnet
    leftfirewall=yes
    right=$remote_wan
    rightsubnet=$rightsubnet
    keyexchange=$keyexchange
    ike=$encryption-$ikeintegrity-$dhgroup$strict
    esp=$encryption-$integrity-$dhgroup$strict
    auto=${auto:-route}

EOF

    setup_secrets
    setup_firewall
}

setup_firewall() {
    echo &quot;iptables -A input_rule -p esp -s $remote_wan -j ACCEPT&quot; &gt;&gt; /etc/firewall.ipsec
    echo &quot;iptables -t nat -A postrouting_rule -d $rightsubnet -j ACCEPT&quot; &gt;&gt; /etc/firewall.ipsec
    # allow all traffic from remote subnet once tunnel is established
    echo &quot;iptables -A input_rule -p tcp -s $rightsubnet -j ACCEPT&quot; &gt;&gt; /etc/firewall.ipsec
    echo &quot;iptables -A input_rule -p udp -s $remote_wan --dport 500 -j ACCEPT # allow ISAKMP&quot; &gt;&gt; /etc/firewall.ipsec
    echo &quot;iptables -A input_rule -p udp -s $remote_wan --dport 4500 -j ACCEPT # allow NAT-T&quot; &gt;&gt; /etc/firewall.ipsec
}

setup_configs() {
    config_load ipsec
    config_foreach check_keyexchange tunnel

    cat &gt; /etc/ipsec.conf &lt;&lt; EOF
config setup
    plutodebug=control
    plutostart=${ikev1:-no}
    charonstart=${ikev2:-no}
    nat_traversal=yes

conn %default
    rekeymargin=3m
    keyingtries=2
    authby=secret

EOF
    config_foreach setup_ipsecconf tunnel
}

reload () {
    setup_configs
}

start() {

    setup_configs

    # start strongswan if any tunnels are enabled
    local flen=$(cat /etc/ipsec.conf | wc -l)
    [ &quot;$flen&quot; -gt 15 ] &amp;&amp; ipsec start &amp;

    return 0
}


stop() {
    # stop strongswan
    ipsec stop

    # remove config files
    [ -f &quot;/etc/ipsec.conf&quot; ] &amp;&amp; rm -r /etc/ipsec.conf
    [ -f &quot;/etc/ipsec.secrets&quot; ] &amp;&amp; rm -f /etc/ipsec.secrets
    [ -f &quot;/etc/firewall.ipsec&quot; ] &amp;&amp; rm -f /etc/firewall.ipsec
}</code></pre></div><div class="codebox"><pre><code>config tunnel default
    option enabled 0
    option waniface wan
    option local_lan 192.168.1.1
    option local_lan_network 255.255.255.0
    option remote_lan 192.168.2.1
    option remote_lan_network 255.255.255.0
    option remote_wan 1.1.1.1
    option keyexchange ikev1
    option key password
    option integrity sha1
    option encryption aes
    option dhgroup modp1024
    option auto start</code></pre></div><p>Try it out! It works for me with a basic router-to-router connection, allowing clients behind one router to communicate clients behind the other via their private IPs.</p><p>If you have any feedback/improvements please let me know! OpenWrt needs an IPsec implementation with UCI support pretty badly, IMO. OpenVPN is nice and all but a lot of devices still use IPsec.</p><br /><p>edit: I know StrongSwan has UCI integration, but it looks like it&#039;s only one tunnel... I wanted to support multiple tunnels so I went with the init script route. If StrongSwan&#039;s UCI actually supports multiple tunnels then I suppose my work is unneeded.</p>											<p class="post-edited">(Last edited by <strong>aport</strong> on 2 Apr 2010, 21:27)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p107325">
				<div class="post-metadata">
					<div class="post-num">Post #21</div>
					<div class="post-author">gabrielvlasiu</div>
					<div class="post-datetime">
						19 Apr 2010, 19:29					</div>
				</div>
				<div class="post-content content">
					<p>charon does not work for me. Pluto works fine.</p><p>KAMIKAZE (bleeding edge, r20639)</p><p>**** charon started manually: </p><p># /usr/lib/ipsec/charon&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />00[DMN] Starting IKEv2 charon daemon (strongSwan 4.3.6)<br />00[NET] unable to create raw socket: Address family not supported by protocol<br />00[NET] could not open IPv6 receive socket, IPv6 disabled<br />00[KNL] listening on interfaces:<br />00[KNL]&nbsp; &nbsp;eth0<br />00[KNL]&nbsp; &nbsp;eth1<br />00[KNL]&nbsp; &nbsp;br-lan<br />00[KNL]&nbsp; &nbsp; &nbsp;192.168.1.1<br />00[KNL]&nbsp; &nbsp;wlan0<br />00[KNL]&nbsp; &nbsp;mon.wlan0<br />00[KNL]&nbsp; &nbsp;ppp0<br />00[KNL]&nbsp; &nbsp; &nbsp;79.114.91.63<br />00[KNL] received netlink error: Address family not supported by protocol (124)<br />00[KNL] unable to create IPv6 routing table rule<br />00[CFG] loading ca certificates from &#039;/etc/ipsec.d/cacerts&#039;<br />00[CFG]&nbsp; &nbsp;loaded ca certificate &quot;C=X, ST=X, L=X, O=X, CN=X, E=X&quot; from &#039;/etc/ipsec.d/cacerts/caCert.der&#039;<br />00[CFG] loading aa certificates from &#039;/etc/ipsec.d/aacerts&#039;<br />00[CFG] loading ocsp signer certificates from &#039;/etc/ipsec.d/ocspcerts&#039;<br />00[CFG] loading attribute certificates from &#039;/etc/ipsec.d/acerts&#039;<br />00[CFG] loading crls from &#039;/etc/ipsec.d/crls&#039;<br />00[CFG]&nbsp; &nbsp;loaded crl from &#039;/etc/ipsec.d/crls/crl.pem&#039;<br />00[CFG] loading secrets from &#039;/etc/ipsec.secrets&#039;<br />00[CFG] loading secrets from &#039;/etc/ipsec.d/XXXX.secrets&#039;<br />00[CFG]&nbsp; &nbsp;loaded RSA private key from &#039;/etc/ipsec.d/private/XXXX.der&#039;<br />00[DMN] loaded plugins: aes des sha1 sha2 md5 fips-prf random x509 pubkey pkcs1 pgp dnskey pem xcbc hmac gmp kernel-netlink stroke updown attr resolve <br />00[JOB] spawning 1 worker threads</p><p>Here is stuck. I can only stop the process via ctrl-c.</p><p>**** Running via strace:</p><p>strace -f -ff /usr/lib/ipsec/charon<br />....<br />write(1, &quot;00[JOB] spawning 1 worker thread&quot;..., 3400[JOB] spawning 1 worker threads) = 34<br />rt_sigaction(SIGPIPE, {SIG_DFL, [], SA_STACK|SA_INTERRUPT|SA_SIGINFO|0x2b8e4f0}, {SIG_DFL, [RT_67 RT_68 RT_70 RT_71 RT_73 RT_74 RT_75 RT_76 RT_78 RT_79 RT_81<br />RT_82 RT_85 RT_86 RT_87 RT_89 RT_91 RT_94], SA_NOCLDSTOP}, 16) = 0<br />time([1271690002])&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = 1271690002<br />open(&quot;/etc/TZ&quot;, O_RDONLY)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= 14<br />read(14, &quot;EET-2EEST,M3.5.0/3,M10.5.0/4\n&quot;, 68) = 29<br />read(14, &quot;&quot;, 39)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = 0<br />close(14)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= 0<br />write(3, &quot;&lt;30&gt;Apr 19 18:13:22 syslog: 00[J&quot;..., 63) = 63<br />rt_sigaction(SIGPIPE, {SIG_DFL, [RT_67 RT_68 RT_70 RT_71 RT_73 RT_74 RT_75 RT_76 RT_78 RT_79 RT_81 RT_82 RT_85 RT_86 RT_87 RT_89 RT_91 RT_94], SA_NOCLDSTOP},<br />NULL, 16) = 0<br />brk(0x463000)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= 0x463000<br />pipe([1701650552, 1667392288])&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; = 14<br />clone(Process 1577 attached<br />child_stack=0x462d78, flags=CLONE_VM|CLONE_FS|CLONE_FILES|CLONE_SIGHAND) = 1577<br />[pid&nbsp; 1574] write(15, &quot;\177\344R\260\0\0\0\5 kernel-netlink stroke u&quot;..., 148) = 148<br />[pid&nbsp; 1574] rt_sigprocmask(SIG_SETMASK, NULL, [HUP INT TERM RT_0], 16) = 0<br />[pid&nbsp; 1574] write(15, &quot;*\263\220@\0\0\0\0\0\0\0\0*\255\0\250\0E\362\0\200\0@\3\0\0\0\0\0\0\0\0&quot;..., 148) = 148<br />[pid&nbsp; 1574] rt_sigprocmask(SIG_SETMASK, NULL, [HUP INT TERM RT_0], 16) = 0<br />[pid&nbsp; 1574] rt_sigsuspend([HUP INT TERM] &lt;unfinished ...&gt;<br />[pid&nbsp; 1577] rt_sigprocmask(SIG_SETMASK, ~[TRAP RT_1], NULL, 16) = 0<br />[pid&nbsp; 1577] read(14, &quot;\177\344R\260\0\0\0\5 kernel-netlink stroke u&quot;..., 148) = 148<br />[pid&nbsp; 1577] poll([{fd=14, events=POLLIN}], 1, 2000) = 1 ([{fd=14, revents=POLLIN}])<br />[pid&nbsp; 1577] getppid()&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= 1574<br />[pid&nbsp; 1577] read(14, &quot;*\263\220@\0\0\0\0\0\0\0\0*\255\0\250\0E\362\0\200\0@\3\0\0\0\0\0\0\0\0&quot;..., 148) = 148<br />[pid&nbsp; 1577] old_mmap(0x7f7fc000, 16384, PROT_READ|PROT_WRITE|PROT_EXEC, MAP_PRIVATE|MAP_FIXED|MAP_ANONYMOUS|MAP_GROWSDOWN, -1, 0) = 0x7f7fc000<br />[pid&nbsp; 1577] clone(Process 1578 attached<br />child_stack=0x7f7ffe00, flags=CLONE_VM|CLONE_FS|CLONE_FILES|CLONE_SIGHAND|SIGRT_1) = 1578<br />[pid&nbsp; 1577] kill(1574, SIGRT_0 &lt;unfinished ...&gt;<br />[pid&nbsp; 1578] getpid( &lt;unfinished ...&gt;<br />[pid&nbsp; 1577] &lt;... kill resumed&gt; )&nbsp; &nbsp; &nbsp; &nbsp; = 0<br />[pid&nbsp; 1574] &lt;... rt_sigsuspend resumed&gt; ) = ? ERESTARTNOHAND (To be restarted)<br />[pid&nbsp; 1574] --- SIGRT_0 (Unknown signal 32) @ 0 (0) ---<br />[pid&nbsp; 1574] sigreturn()&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= ? (mask now [EMT KILL SEGV PIPE ALRM TERM USR2 PWR URG IO TSTP TTIN VTALRM XCPU])<br />[pid&nbsp; 1574] rt_sigprocmask(SIG_BLOCK, [HUP INT TERM], NULL, 16) = 0<br />[pid&nbsp; 1574] rt_sigaction(SIGHUP, {SIG_DFL, [RT_68 RT_70 RT_74 RT_75 RT_82 RT_85 RT_86 RT_88 RT_90 RT_92 RT_94], SA_STACK|SA_INTERRUPT|0x2b207a4}, NULL, 16) = 0<br />[pid&nbsp; 1574] rt_sigaction(SIGINT, {SIG_DFL, [RT_68 RT_70 RT_74 RT_75 RT_82 RT_85 RT_86 RT_88 RT_90 RT_92 RT_94], SA_STACK|SA_INTERRUPT|0x2b207a4}, NULL, 16) = 0<br />[pid&nbsp; 1574] rt_sigaction(SIGTERM, {SIG_DFL, [RT_68 RT_70 RT_74 RT_75 RT_82 RT_85 RT_86 RT_88 RT_90 RT_92 RT_94], SA_STACK|SA_INTERRUPT|0x2b207a4}, NULL, 16) = 0<br />[pid&nbsp; 1574] rt_sigaction(128, {SIG_DFL, [RT_68 RT_70 RT_74 RT_75 RT_82 RT_85 RT_86 RT_88 RT_90 RT_92 RT_94], SA_STACK|SA_INTERRUPT|0x2b20720}, NULL, 16) = 0<br />[pid&nbsp; 1574] rt_sigprocmask(SIG_BLOCK, NULL, [HUP INT TERM RT_0], 16) = 0<br />[pid&nbsp; 1574] rt_sigsuspend(~[HUP INT TERM RT_1] &lt;unfinished ...&gt;<br />[pid&nbsp; 1578] &lt;... getpid resumed&gt; )&nbsp; &nbsp; &nbsp; = 1578<br />[pid&nbsp; 1577] poll([{fd=14, events=POLLIN}], 1, 2000 &lt;unfinished ...&gt;<br />[pid&nbsp; 1578] rt_sigprocmask(SIG_SETMASK, [HUP INT TERM RT_0], NULL, 16) = 0<br />[pid&nbsp; 1578] gettimeofday({1271690002, 343705}, NULL) = 0<br />[pid&nbsp; 1578] rt_sigprocmask(SIG_SETMASK, NULL, [HUP INT TERM RT_0], 16) = 0<br />[pid&nbsp; 1578] rt_sigsuspend([HUP INT TERM] &lt;unfinished ...&gt;<br />[pid&nbsp; 1577] &lt;... poll resumed&gt; )&nbsp; &nbsp; &nbsp; &nbsp; = 0 (Timeout)<br />[pid&nbsp; 1577] getppid()&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= 1574<br />[pid&nbsp; 1577] poll([{fd=14, events=POLLIN}], 1, 2000) = 0 (Timeout)<br />[pid&nbsp; 1577] getppid()&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= 1574<br />[pid&nbsp; 1577] poll([{fd=14, events=POLLIN}], 1, 2000) = 0 (Timeout)<br />[pid&nbsp; 1577] getppid()&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= 1574<br />[pid&nbsp; 1577] poll([{fd=14, events=POLLIN}], 1, 2000) = 0 (Timeout)<br />[pid&nbsp; 1577] getppid()&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= 1574<br />[pid&nbsp; 1577] poll([{fd=14, events=POLLIN}], 1, 2000) = 0 (Timeout)<br />[pid&nbsp; 1577] getppid()&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;= 1574<br />[pid&nbsp; 1577] poll([{fd=14, events=POLLIN}], 1, 2000<br />....</p><br /><p>Does anybody else have this problem?<br />Thank you.</p>											<p class="post-edited">(Last edited by <strong>gabrielvlasiu</strong> on 19 Apr 2010, 19:30)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p107346">
				<div class="post-metadata">
					<div class="post-num">Post #22</div>
					<div class="post-author">beus</div>
					<div class="post-datetime">
						19 Apr 2010, 23:59					</div>
				</div>
				<div class="post-content content">
					<p>did you use the - in progress work - here or the new added package as mentioned in <a href="https://dev.openwrt.org/ticket/2538#comment:19">https://dev.openwrt.org/ticket/2538#comment:19</a> ? If the first, try compiling it with the version in the link, perhaps that helps.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p222814">
				<div class="post-metadata">
					<div class="post-num">Post #23</div>
					<div class="post-author">bobcov</div>
					<div class="post-datetime">
						15 Jan 2014, 15:28					</div>
				</div>
				<div class="post-content content">
					<p>I keep getting an error in the Makefile for strongswan. The dump.txt says &quot;Makefile:51: *** missing `endef&#039;, unterminated `define&#039;.&nbsp; Stop.&quot;&nbsp; &nbsp;That&#039;s pretty obvious to a programmer, but from looking at it, I can&#039;t see the problem.<br />The lines wrapped, so don&#039;t think those are just new lines.<br />Also, I just found that if I added another &quot;endef&quot; before &quot;define Build/Compile&quot; I do not get the error, but because I do not know what adding &quot;endef&quot; means, my guess is it&#039;s not a &quot;fix.&quot;&nbsp; Any ideas?<br />Update2: Okay, untarring the files again to replace the edited Config.in and Makefile, for the changes suggested by the father of this thread, removed the errors. Is it possible cutting and pasting those changes in&nbsp; added unseen line endings or something?&nbsp; They looked normal on screen in nano. These were the changes for openssl and random that were suggested in the tutorial.</p><p>#<br /># Copyright (C) 2006 OpenWrt.org<br />#<br /># This is free software, licensed under the GNU General Public License v2.<br /># See /LICENSE for more information.<br />#<br /># $Id$</p><p>include $(TOPDIR)/rules.mk<br />#include $(INCLUDE_DIR)/kernel.mk</p><p>PKG_NAME:=strongswan<br />PKG_VERSION:=4.2.17<br />PKG_RELEASE:=1</p><p>PATCH_DIR=./patches</p><p>PKG_SOURCE:=$(PKG_NAME)-$(PKG_VERSION).tar.bz2<br />PKG_SOURCE_URL:=http://download.strongswan.org/<br />PKG_MD5SUM:=52058098d9ae038f9dc2c1b116f06dbb</p><p>PKG_BUILD_DIR:=$(BUILD_DIR)/$(PKG_NAME)-$(PKG_VERSION)<br />PKG_INSTALL_DIR:=$(PKG_BUILD_DIR)/ipkg-install</p><p>include $(INCLUDE_DIR)/package.mk</p><p>define Package/strongswan<br />&nbsp; SECTION:=net<br />&nbsp; CATEGORY:=Network<br /> TITLE:=StrongSwan IPsec IKEv1 and IKEv2 implementation<br />&nbsp; DEFAULT:=m<br />&nbsp; URL:=http://www.strongswan.org/<br />&nbsp; #DEPENDS:=+libpthread +libgmp +ip +kmod-ipsec +kmod-ipsec4 +iptables-mod-ipsec +kmod-ipt-ipsec +kmod-crypto-aes&nbsp; +kmod-c$<br />&nbsp; DEPENDS:=+libpthread +libgmp +ip +kmod-ipsec +kmod-ipsec4 +iptables-mod-ipsec +kmod-ipt-ipsec +kmod-crypto-authenc +kmod$<br />endef</p><p>define Package/strongswan/description<br />&nbsp; IPsec IKEv2 keying daemon:<br />&nbsp; strongSwan provides the userland part of IPsec. This minimalistic build<br />&nbsp; includes the IKEv2 keying daemon charon, the libstrongswan library and<br />&nbsp; crypto plugins for SHA1 and AES.<br />endef</p><p>define Package/strongswan/config<br />&nbsp; &nbsp; &nbsp; &nbsp; menu &quot;strongSwan Configuration&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; depends on PACKAGE_strongswan<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; source &quot;$(SOURCE)/Config.in&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; endmenu<br />endef</p><p>define Build/Configure<br />&nbsp; &nbsp; &nbsp; &nbsp; $(call Build/Configure/Default, \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $(if $(CONFIG_STRONGSWAN_DEVICE_RANDOM),--with-random-device=$(CONFIG_STRONGSWAN_DEVICE_RANDOM)) \<br />#&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$(if $(CONFIG_STRONGSWAN_DEVICE_URANDOM),--with-random-device=$(CONFIG_STRONGSWAN_DEVICE_RANDOM)) \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $(if $(CONFIG_STRONGSWAN_WITH_URANDOM_DEVICE),--with-urandom-device=$(CONFIG_STRONGSWAN_DEVICE_URANDOM)) \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $(if $(CONFIG_STRONGSWAN_DISABLE_RANDOM),--disable-random) \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $(if $(CONFIG_STRONGSWAN_CURL),--enable-curl) \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $(if $(CONFIG_STRONGSWAN_LDAP),--enable-ldap) \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $(if $(CONFIG_STRONGSWAN_MANAGER),--enable-manager) \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $(if $(CONFIG_STRONGSWAN_DISABLE_AES),--disable-aes) \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $(if $(CONFIG_STRONGSWAN_DISABLE_DES),--disable-des) \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $(if $(CONFIG_STRONGSWAN_DISABLE_MD5),--disable-md5) \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $(if $(CONFIG_STRONGSWAN_DISABLE_SHA1),--disable-sha1) \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $(if $(CONFIG_STRONGSWAN_DISABLE_SHA2),--disable-sha2) \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $(if $(CONFIG_STRONGSWAN_DISABLE_FIPS_PRF),--disable-fips-prf) \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $(if $(CONFIG_STRONGSWAN_DISABLE_GMP),--disable-gmp) \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $(if $(CONFIG_STRONGSWAN_DISABLE_X509),--disable-x509) \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $(if $(CONFIG_STRONGSWAN_DISABLE_PUBKEY),--disable-pubkey) \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $(if $(CONFIG_STRONGSWAN_DISABLE_HMAC),--disable-hmac) \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $(if $(CONFIG_STRONGSWAN_DISABLE_XCBC),--disable-xcbc) \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $(if $(CONFIG_STRONGSWAN_STROKE),--disable-stroke) \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $(if $(CONFIG_STRONGSWAN_CISCO_QUIRKS),--enable-cisco-quirks) \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $(if $(CONFIG_STRONGSWAN_NAT_TRANSPORT),--enable-nat-transport) \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $(if $(CONFIG_STRONGSWAN_PLUTO),--disable-pluto) \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$(if $(CONFIG_STRONGSWAN_CHARON),--disable-charon) \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $(if $(CONFIG_STRONGSWAN_ENABLE_OPENSSL),--enable-openssl) \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $(if $(CONFIG_STRONGSWAN_TOOLS),--disable-tools) \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $(if $(CONFIG_STRONGSWAN_ROUTING_TABLE),--with-routing-table=$(CONFIG_STRONGSWAN_ROUTING_TABLE),--disable-$<br />endef</p><p>define Build/Compile<br />&nbsp; &nbsp; &nbsp; &nbsp; $(MAKE) -C $(PKG_BUILD_DIR) \<br />&nbsp; &nbsp; &nbsp; &nbsp; INSTALL_PREFIX=&quot;$(PKG_INSTALL_DIR)&quot; \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DESTDIR=&quot;$(PKG_INSTALL_DIR)&quot; \<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; install<br />endef</p><p>define Package/strongswan/install<br />&nbsp; &nbsp; &nbsp; &nbsp; $(INSTALL_DIR) $(1)/usr/lib/ipsec/plugins<br />&nbsp; &nbsp; &nbsp; &nbsp; $(INSTALL_DIR) $(1)/etc<br />&nbsp; &nbsp; &nbsp; &nbsp; $(INSTALL_DIR) $(1)/usr/sbin<br />&nbsp; &nbsp; &nbsp; &nbsp; $(CP) -R $(PKG_INSTALL_DIR)/etc/* $(1)/etc/<br />&nbsp; &nbsp; &nbsp; &nbsp; $(CP) $(PKG_INSTALL_DIR)/usr/sbin/ipsec $(1)/usr/sbin<br />&nbsp; &nbsp; &nbsp; &nbsp; $(CP) $(PKG_INSTALL_DIR)/usr/lib/ipsec/* $(1)/usr/lib/ipsec/<br />&nbsp; &nbsp; &nbsp; &nbsp; $(CP) $(PKG_INSTALL_DIR)/usr/lib/libstrongswan.so.* $(1)/usr/lib/<br />&nbsp; &nbsp; &nbsp; &nbsp; $(CP) $(PKG_INSTALL_DIR)/usr/lib/ipsec/plugins/*.so.* $(1)/usr/lib/ipsec/plugins/<br />&nbsp; &nbsp; &nbsp; &nbsp; mkdir -p $(1)/etc/modules.d/<br />&nbsp; &nbsp; &nbsp; &nbsp; # really needed?<br />&nbsp; &nbsp; &nbsp; &nbsp; $(CP) ./files/50-strongswan $(1)/etc/modules.d/<br />endef</p><p>$(eval $(call BuildPackage,strongswan))</p>											<p class="post-edited">(Last edited by <strong>bobcov</strong> on 15 Jan 2014, 16:55)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>