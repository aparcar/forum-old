<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> U-Boot mod for routers with AR9331/AR9344</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 3 Apr 2015 and 7 May 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 2 of 25</div><nav><ul><li><a href="viewtopic.php%3Fid=43237&amp;p=1.html">1</a></li><li class="pagination-current"><span>2</span></li><li><a href="viewtopic.php%3Fid=43237&amp;p=3.html">3</a></li><li><a href="viewtopic.php%3Fid=43237&amp;p=4.html">4</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=43237&amp;p=25.html">25</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p199487">
				<div class="post-metadata">
					<div class="post-num">Post #26</div>
					<div class="post-author">dimonix</div>
					<div class="post-datetime">
						24 Apr 2013, 14:38					</div>
				</div>
				<div class="post-content content">
					<p>@pepe2k,<br/>Could you provide some tips for compiling RAM (non-relocatable) version of your u-boot?<br/>This would be very helpful, because RAM version could be loaded via standard u-boot, without burning the flash. It gives a very safe way of testing and debugging. Thanks.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p199490">
				<div class="post-metadata">
					<div class="post-num">Post #27</div>
					<div class="post-author">pepe2k</div>
					<div class="post-datetime">
						24 Apr 2013, 14:51					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>dimonix wrote:</cite><blockquote><p>@pepe2k,<br/>Could you provide some tips for compiling RAM (non-relocatable) version of your u-boot?<br/>This would be very helpful, because RAM version could be loaded via standard u-boot, without burning the flash. It gives a very safe way of testing and debugging. Thanks.</p></blockquote></div><p>I&#039;m sorry, but I don&#039;t know U-Boot very well, so I don&#039;t know how to do this... please, see also this FAQ answer:<br/><a href="http://www.denx.de/wiki/view/DULG/CanUBootBeConfiguredSuchThatItCanBeStartedInRAM">http://www.denx.de/wiki/view/DULG/CanUBootBeConfiguredSuchThatItCanBeStartedInRAM</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p199745">
				<div class="post-metadata">
					<div class="post-num">Post #28</div>
					<div class="post-author">Dioptimizer</div>
					<div class="post-datetime">
						26 Apr 2013, 16:21					</div>
				</div>
				<div class="post-content content">
					<p>You probably did not use search.<br/><a href="https://forum.openwrt.org/viewtopic.php?pid=193078#p193078">https://forum.openwrt.org/viewtopic.php?pid=193078#p193078</a><br/><a href="https://forum.openwrt.org/viewtopic.php?id=33205">https://forum.openwrt.org/viewtopic.php?id=33205</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p199748">
				<div class="post-metadata">
					<div class="post-num">Post #29</div>
					<div class="post-author">pepe2k</div>
					<div class="post-datetime">
						26 Apr 2013, 16:33					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Dioptimizer wrote:</cite><blockquote><p>You probably did not use search.<br/><a href="https://forum.openwrt.org/viewtopic.php?pid=193078#p193078">https://forum.openwrt.org/viewtopic.php?pid=193078#p193078</a><br/><a href="https://forum.openwrt.org/viewtopic.php?id=33205">https://forum.openwrt.org/viewtopic.php?id=33205</a></p></blockquote></div><p>What is so difficult to understand that U-Boot for AP121 platform is different from U-Boot for other platforms with architecture AR71xx...? It&#039;s not the same code! At 0x01FD00 offset in flash there is a model number for these routers (MR3020/3040/WR703N...) NOT a value for PLL register setting.</p><p>If you know how to make U-Boot to get setting for PLL register from flash and how to prepare version which can start from RAM... just download the code, do it and let us know about your results.</p>											<p class="post-edited">(Last edited by <strong>pepe2k</strong> on 26 Apr 2013, 16:37)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p199822">
				<div class="post-metadata">
					<div class="post-num">Post #30</div>
					<div class="post-author">abraham_lei</div>
					<div class="post-datetime">
						27 Apr 2013, 09:40					</div>
				</div>
				<div class="post-content content">
					<p>hi all:<br/>how can i find out the serial point (TX,RX,GND) on PCB board with ar9331?<br/>my router is tplink 741n v4 ,the image links:<br/><a href="https://lh6.googleusercontent.com/-JiPL1v_VH8g/UXtulxG33uI/AAAAAAAABAs/8GgtS0wU_D0/s1600/20130426_192117.jpg">https://lh6.googleusercontent.com/-JiPL … 192117.jpg</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p199829">
				<div class="post-metadata">
					<div class="post-num">Post #31</div>
					<div class="post-author">nebbia88</div>
					<div class="post-datetime">
						27 Apr 2013, 11:49					</div>
				</div>
				<div class="post-content content">
					<p>omg, have you read wiki for 741???</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p199853">
				<div class="post-metadata">
					<div class="post-num">Post #32</div>
					<div class="post-author">xopal</div>
					<div class="post-datetime">
						27 Apr 2013, 18:47					</div>
				</div>
				<div class="post-content content">
					<p>I just upgrade my 3220v2 boot loader with this u-boot and works well , I&#039;m doing upgrade process from u-boot console, here&#039;s the log :</p><div class="codebox"><pre><code>=~=~=~=~=~=~=~=~=~=~=~= PuTTY log 2013.04.27 21:59:42 =~=~=~=~=~=~=~=~=~=~=~=

U-Boot 1.1.4 (Nov 20 2012 - 15:40:01)

AP121 (ar9330) U-boot

DRAM:  32 MB
led turning on for 1s...
id read 0x100000ff
flash size 16777216, sector count = 256
Flash: 16 MB
Using default environment

In:    serial
Out:   serial
Err:   serial
Net:   ag7240_enet_initialize...
blah blah blah ...
blah blah blah ...
blah blah blah ...
No valid address in Flash. Using fixed address
No valid address in Flash. Using fixed address
: cfg1 0x5 cfg2 0x7114
eth0: 00:03:7f:09:0b:ad
ag7240_phy_setup 
eth0 up
: cfg1 0xf cfg2 0x7214
eth1: 00:03:7f:09:0b:ad
athrs26_reg_init_lan
ATHRS26: resetting s26
ATHRS26: s26 reset done
ag7240_phy_setup 
eth1 up
eth0, eth1
Autobooting in 3 seconds

hornet&gt; erase 0x9f000000 +0x10000


First 0x0 last 0x0 sector size 0x10000
   0
Erased 1 sectors
hornet&gt; tftpboot 0x81000000 uboot.bin

eth1 link down
Using eth0 device
TFTP from server 192.168.1.2; our IP address is 192.168.1.1
Filename &#039;uboot.bin&#039;.
Load address: 0x81000000
Loading: *#############
done
Bytes transferred = 65536 (10000 hex)
hornet&gt; cp.b 0x81000000 0x9f000000 0x10000

Copy to Flash... write addr: 9f000000
done



hornet&gt; reset 

*****************************************
*      U-Boot 1.1.4  (Apr 22 2013)      *
*****************************************

AP121 (AR9331) U-Boot for TL-MR3020

DRAM:  32 MB
FLASH: Winbond W25Q128 (16 MB)

LED on during eth initialization...

Hit any key to stop autobooting:  1 0 

Booting image at: 0x9F020000...
Uncompressing kernel image...
OK
Starting kernel...</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p199855">
				<div class="post-metadata">
					<div class="post-num">Post #33</div>
					<div class="post-author">pepe2k</div>
					<div class="post-datetime">
						27 Apr 2013, 18:51					</div>
				</div>
				<div class="post-content content">
					<p>Nice <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile"/><br/>What about reset button? Does it work? I didn&#039;t check what GPIOs are used in MR3220v2 for LEDs and reset button... but I will do it and make version dedicated for this model.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p199856">
				<div class="post-metadata">
					<div class="post-num">Post #34</div>
					<div class="post-author">xopal</div>
					<div class="post-datetime">
						27 Apr 2013, 18:59					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>pepe2k wrote:</cite><blockquote><p>Nice <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile"/><br/>What about reset button? Does it work? I didn&#039;t check what GPIOs are used in MR3220v2 for LEDs and reset button... but I will do it and make version dedicated for this model.</p></blockquote></div><p>Yes it works too :</p><div class="codebox"><pre><code>*****************************************
*      U-Boot 1.1.4  (Apr 22 2013)      *
*****************************************

AP121 (AR9331) U-Boot for TL-MR3020

DRAM:  32 MB
FLASH: Winbond W25Q128 (16 MB)

LED on during eth initialization...

Press reset button for at least:
- 3 sec. to run web failsafe mode
- 5 sec. to run U-Boot console
- 7 sec. to run U-Boot netconsole

Reset button is pressed for:  0  1  2  3  4  5  6  7  8  9 

Button was pressed for 9 sec...
Starting U-Boot netconsole...</code></pre></div><div class="codebox"><pre><code>*****************************************
*      U-Boot 1.1.4  (Apr 22 2013)      *
*****************************************

AP121 (AR9331) U-Boot for TL-MR3020

DRAM:  32 MB
FLASH: Winbond W25Q128 (16 MB)

LED on during eth initialization...

~»¿¿ÿ¿  66666666þþþPress reset button for at least:
- 3 sec. to run web failsafe mode
- 5 sec. to run U-Boot console
- 7 sec. to run U-Boot netconsole

Reset button is pressed for:  0  1  2  3 

Button was pressed for 3 sec...
HTTP server is starting for firmware update...

Ethernet mode (duplex/speed): 1/100 Mbps
HTTP server is starting at IP: 192.168.1.1
HTTP server is ready!</code></pre></div>											<p class="post-edited">(Last edited by <strong>xopal</strong> on 27 Apr 2013, 19:01)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p200714">
				<div class="post-metadata">
					<div class="post-num">Post #35</div>
					<div class="post-author">Dioptimizer</div>
					<div class="post-datetime">
						4 May 2013, 23:47					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>pepe2k wrote:</cite><blockquote><p>What is so difficult to understand that U-Boot for AP121 platform is different from U-Boot for other platforms with architecture AR71xx...? It&#039;s not the same code! At 0x01FD00 offset in flash there is a model number for these routers (MR3020/3040/WR703N...) NOT a value for PLL register setting.</p><p>If you know how to make U-Boot to get setting for PLL register from flash and how to prepare version which can start from RAM... just download the code, do it and let us know about your results.</p></blockquote></div><br/><p>I previously wrote one person on this subject (<a href="http://www.mail-archive.com/u-boot@lists.denx.de/msg100132.html">this</a>), but the processor was different - but a positive result is the same.<br/>To be honest, I&#039;m happy to dig into yours source code, but do not have time.</p><p>I will upload the major/base changes that I made for the AP96 platform.<br/>Based on <a href="http://dioptimizer.narod.ru/files/ap96/path.diff">the changes</a>(changes between the original and RAM mod Uboot) and <a href="http://dioptimizer.narod.ru/files/u-boot-1.3.0.tar.bz2">this sources</a>, I hope you understand the issue.</p><p>In patch or sources:<br/>Where all &quot;SKIP_LOWLEVEL_INIT&quot; = U-boot RAM mod</p><p>In source:<br/>Where CFG_PLL_OFFSET, CFG_PLL_MAGIC = responsible for the variable of CPU frequency.</p><p>P.S.<br/>I&#039;m sorry for my terrible English.</p>											<p class="post-edited">(Last edited by <strong>Dioptimizer</strong> on 5 May 2013, 01:47)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p200740">
				<div class="post-metadata">
					<div class="post-num">Post #36</div>
					<div class="post-author">NiHaoMike</div>
					<div class="post-datetime">
						5 May 2013, 05:06					</div>
				</div>
				<div class="post-content content">
					<p>Exactly how I write the bootloader to an 8MB Flash chip (SST25VF064, 8 pin SOIC version) using Flashrom and a Bus Pirate? (As in what settings to get the bootloader to the correct part of Flash.) I&#039;m upgrading a TL-WR702N (already did the RAM) and I already took out the old Flash chip and read it out to a file. Besides the bootloader itself, what else do I need to copy over so it can boot?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p200784">
				<div class="post-metadata">
					<div class="post-num">Post #37</div>
					<div class="post-author">MBS</div>
					<div class="post-datetime">
						5 May 2013, 13:16					</div>
				</div>
				<div class="post-content content">
					<p>You don&#039;t really need a programmer, just use uboot and connect your flash chips like that: <a href="https://forum.openwrt.org/viewtopic.php?pid=179169#p179169">https://forum.openwrt.org/viewtopic.php?pid=179169#p179169</a><br/>Essentially you need the uboot partition right at the start of the flash and the ART partition all the way at the end (original position + 4 MB).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p200787">
				<div class="post-metadata">
					<div class="post-num">Post #38</div>
					<div class="post-author">pepe2k</div>
					<div class="post-datetime">
						5 May 2013, 14:11					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Dioptimizer wrote:</cite><blockquote><p>I previously wrote one person on this subject (<a href="http://www.mail-archive.com/u-boot@lists.denx.de/msg100132.html">this</a>), but the processor was different - but a positive result is the same.<br/>To be honest, I&#039;m happy to dig into yours source code, but do not have time.</p><p>I will upload the major/base changes that I made for the AP96 platform.<br/>Based on <a href="http://dioptimizer.narod.ru/files/ap96/path.diff">the changes</a>(changes between the original and RAM mod Uboot) and <a href="http://dioptimizer.narod.ru/files/u-boot-1.3.0.tar.bz2">this sources</a>, I hope you understand the issue.</p><p>In patch or sources:<br/>Where all &quot;SKIP_LOWLEVEL_INIT&quot; = U-boot RAM mod</p><p>In source:<br/>Where CFG_PLL_OFFSET, CFG_PLL_MAGIC = responsible for the variable of CPU frequency.</p><p>P.S.<br/>I&#039;m sorry for my terrible English.</p></blockquote></div><p>OK, I understand what you want to get but I&#039;m afraid that option &quot;SKIP_LOWLEVEL_INIT&quot; isn&#039;t exist in U-Boot 1.1.4 (which is used by TP-Link) for AR7240... so it needs to be added. Maybe I will try.</p><p>I don&#039;t think (but maybe I&#039;m wrong!) also that setting new frequency for PLL and dividers for CPU/DDR/AHB on AR9331 is so simple like in the code you pointed to (just writing prepared register value into PLL setting register):<br/></p><div class="codebox"><pre><code>ar7240_reg_wr(AR7240_CPU_PLL_CONFIG,cfgpll);</code></pre></div><p>It needs to be tested because Assembler section for PLL initialization in original sources is bigger and contains more PLL and dividers registers operations.</p><p>For now I&#039;m thinking about new command in U-Boot console for PLL clock and CPU/DDR/AHB dividers manipulation, just for testing if we can change these values simply by changing proper registers, without reset the CPU and changing also other registers.</p><div class="quotebox"><cite>NiHaoMike wrote:</cite><blockquote><p>Exactly how I write the bootloader to an 8MB Flash chip (SST25VF064, 8 pin SOIC version) using Flashrom and a Bus Pirate? (As in what settings to get the bootloader to the correct part of Flash.) I&#039;m upgrading a TL-WR702N (already did the RAM) and I already took out the old Flash chip and read it out to a file. Besides the bootloader itself, what else do I need to copy over so it can boot?</p></blockquote></div><p>All you need to do is just erase whole chip (fill it with 0xFF) and put my U-Boot image at offset 0x0 (beginning of the FLASH). The ART image you can upload later in web panel. You need also to copy 64 KiB (from offset 0x10000) data from your original flash - this block contains MAC address and model number. Please, refer to the following flash layout:</p><p><span class="postimg"><img src="http://www.tech-blog.pl/wordpress/wp-content/uploads/2013/03/tl-mr3020_flash_layout.gif" alt="http://www.tech-blog.pl/wordpress/wp-content/uploads/2013/03/tl-mr3020_flash_layout.gif"/></span></p><p>But, for now in my U-Boot modification you FLASH won&#039;t be recognized properly and you won&#039;t be able to upload ART image! I will add it in next couple of days. Please, provide me full chip mark.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p200811">
				<div class="post-metadata">
					<div class="post-num">Post #39</div>
					<div class="post-author">NiHaoMike</div>
					<div class="post-datetime">
						5 May 2013, 17:57					</div>
				</div>
				<div class="post-content content">
					<p>Here&#039;s the datasheet:<br/><a href="http://ww1.microchip.com/downloads/en/DeviceDoc/25036B.pdf">http://ww1.microchip.com/downloads/en/DeviceDoc/25036B.pdf</a></p><p>I did a hexdump of the original image and the MAC address is at 0x001e0000. What is the original Flash layout of the WR-702N so I can copy the config?<br/></p><div class="quotebox"><blockquote><p>You don&#039;t really need a programmer, just use uboot and connect your flash chips like that: <a href="https://forum.openwrt.org/viewtopic.php?pid=179169#p179169">https://forum.openwrt.org/viewtopic.php?pid=179169#p179169</a><br/>Essentially you need the uboot partition right at the start of the flash and the ART partition all the way at the end (original position + 4 MB).</p></blockquote></div><p>I&#039;m an electrical engineer so I already have the programmer (Bus Pirate).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p200899">
				<div class="post-metadata">
					<div class="post-num">Post #40</div>
					<div class="post-author">pepe2k</div>
					<div class="post-datetime">
						6 May 2013, 13:43					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>NiHaoMike wrote:</cite><blockquote><p>Here&#039;s the datasheet:<br/><a href="http://ww1.microchip.com/downloads/en/DeviceDoc/25036B.pdf">http://ww1.microchip.com/downloads/en/DeviceDoc/25036B.pdf</a></p></blockquote></div><p>OK, could you also check with Bus Pirate the JEDEC ID for your chip (I need to know if it is the same as in datasheet).</p><div class="quotebox"><cite>NiHaoMike wrote:</cite><blockquote><p>I did a hexdump of the original image and the MAC address is at 0x001e0000. What is the original Flash layout of the WR-702N so I can copy the config?</p></blockquote></div><p>The offset is different than in other TP-Link products. I checked the wiki and I found that this model uses VxWorks and different bootloader so you cannot simply move config/content from old flash if you want to use my U-Boot version and OpenWrt.</p><p>I think that you should try to run this router with flash content copied from any WR703N, just change MAC address which should be at 0x0001FC00. If you want, I can give you whole original flash dump from my 703N, with my U-Boot.</p><p>Probably, you should also add support for this model in OpenWrt sources but... in my opinion this model isn&#039;t interesting - it needs FLASH and RAM MOD to run OpenWrt and even after that you get device without USB. The 703N isn&#039;t more expensive and has 4M/32M and USB already included <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink"/></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p200912">
				<div class="post-metadata">
					<div class="post-num">Post #41</div>
					<div class="post-author">NiHaoMike</div>
					<div class="post-datetime">
						6 May 2013, 16:09					</div>
				</div>
				<div class="post-content content">
					<p>It does match.</p><p>Could you upload a copy of a WR703N config page? (You can change the MAC to something like 12:34:56:78:90 if you don&#039;t want to post that.) I don&#039;t have a WR703N. I got the WR702N because it was on sale ($15) at a local store. Even if I got the WR703N, I would be upgrading it anyways.</p>											<p class="post-edited">(Last edited by <strong>NiHaoMike</strong> on 6 May 2013, 16:10)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p200925">
				<div class="post-metadata">
					<div class="post-num">Post #42</div>
					<div class="post-author">Dioptimizer</div>
					<div class="post-datetime">
						6 May 2013, 17:38					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>pepe2k wrote:</cite><blockquote><p>...<br/>I don&#039;t think (but maybe I&#039;m wrong!) also that setting new frequency for PLL and dividers for CPU/DDR/AHB on AR9331 is so simple like in the code you pointed to (just writing prepared register value into PLL setting register):<br/></p><div class="codebox"><pre><code>ar7240_reg_wr(AR7240_CPU_PLL_CONFIG,cfgpll);</code></pre></div><p>...</p></blockquote></div><p>The first thing to do is to assume that the ar9331 has at its core processor ar7241:<br/>Setting the frequency with reboot (for u-boot is critical and provided as an example):<br/><a href="http://www.google.com/translate_c?langpair=ru|en&amp;u=http://wiki.openwrt.org/ru/toh/tp-link/tl-mr3420/debrick%2525using%2525jtag">http://www.google.com/translate_c?langp … g%2525jtag</a> </p><p>Installing without restarting the CPU frequency selective (later from the company Compex, file init-ar7240.mac)<br/><a href="http://www.cpx.cz/dls/wpe72_WPE72NX_MMJ5N26E/wp72_loader_jtag.zip">http://www.cpx.cz/dls/wpe72_WPE72NX_MMJ5N26E/wp72_loader_jtag.zip</a><br/><a href="http://wiki.openwrt.org/doc/techref/bootloader/myloader#myloram">Source</a></p><p>Analogue for uboot commands:<br/>md 0x1 &lt;address&gt;<br/>mw &lt;address&gt; &lt;value&gt;</p><p>For example default PLL setup:<br/></p><div class="codebox"><pre><code>mw 0xb8050000 0x00040828
mw 0xb8050008 0x1
mw 0xb8050008 0x0</code></pre></div>											<p class="post-edited">(Last edited by <strong>Dioptimizer</strong> on 6 May 2013, 17:55)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p200932">
				<div class="post-metadata">
					<div class="post-num">Post #43</div>
					<div class="post-author">pepe2k</div>
					<div class="post-datetime">
						6 May 2013, 18:14					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Dioptimizer wrote:</cite><blockquote><p>The first thing to do is to assume that the ar9331 has at its core processor ar7241:<br/>Setting the frequency with reboot (for u-boot is critical and provided as an example):<br/><a href="http://www.google.com/translate_c?langpair=ru|en&amp;u=http://wiki.openwrt.org/ru/toh/tp-link/tl-mr3420/debrick%2525using%2525jtag">http://www.google.com/translate_c?langp … g%2525jtag</a></p></blockquote></div><p>Are you definitely sure that different Atheros SoCs with the same core CPU has same CPU/DDR/AHB PLL configuration registers?</p><div class="quotebox"><cite>Dioptimizer wrote:</cite><blockquote><p>Installing without restarting the CPU frequency selective (later from the company Compex, file init-ar7240.mac)<br/><a href="http://www.cpx.cz/dls/wpe72_WPE72NX_MMJ5N26E/wp72_loader_jtag.zip">http://www.cpx.cz/dls/wpe72_WPE72NX_MMJ5N26E/wp72_loader_jtag.zip</a><br/><a href="http://wiki.openwrt.org/doc/techref/bootloader/myloader#myloram">Source</a></p><p>Analogue for uboot commands:<br/>md 0x1 &lt;address&gt;<br/>mw &lt;address&gt; &lt;value&gt;</p></blockquote></div><p>I know how to use these commands in U-Boot... but I still don&#039;t get it what do you want to achieve? In my opinion, overclocking AR9331 with 25 MHz oscillator doesn&#039;t make any sens, because of very limited different dividers configurations!</p><p>If you want, you can write PM to me in Russian and explain what you want to achieve.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p200935">
				<div class="post-metadata">
					<div class="post-num">Post #44</div>
					<div class="post-author">Dioptimizer</div>
					<div class="post-datetime">
						6 May 2013, 18:26					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>pepe2k wrote:</cite><blockquote><p>Are you definitely sure that different Atheros SoCs with the same core CPU has same CPU/DDR/AHB PLL configuration registers?</p></blockquote></div><p>You can verify this by reading the memory address:<br/></p><div class="codebox"><pre><code>md 0x1 0xb8050000</code></pre></div><p>If the frequency of your CPU 400/400/200<br/>value mus be same - 0x00040828</p><div class="quotebox"><cite>pepe2k wrote:</cite><blockquote><p>In my opinion, overclocking AR9331 with 25 MHz oscillator doesn&#039;t make any sens, because of very limited different dividers configurations!</p></blockquote></div><p>And I&#039;m not talking about the fact that you will give something from overclocking.<br/>The discussion began with what seemed to you to deal with the complex registers responsible for the overclocking. (If I understand correctly)<br/><a href="https://forum.openwrt.org/viewtopic.php?pid=200787#p200787">https://forum.openwrt.org/viewtopic.php?pid=200787#p200787</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p200938">
				<div class="post-metadata">
					<div class="post-num">Post #45</div>
					<div class="post-author">pepe2k</div>
					<div class="post-datetime">
						6 May 2013, 18:32					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Dioptimizer wrote:</cite><blockquote><p>For example default PLL setup:<br/></p><div class="codebox"><pre><code>mw 0xb8050000 0x00040828
mw 0xb8050008 0x1
mw 0xb8050008 0x0</code></pre></div></blockquote></div><p>Nope, you are wrong. This commands just hang the router... Please, refer to AR9331 datasheet. 0x00040828 value is not proper for CPU_PLL_CONFIG register! For example (information from datasheet):</p><p>&quot;Bits 9:0 - Reserved. Must be written with zero. Contains zeros when read.&quot;</p><p>In your value (0x00040828) bits 0...9 aren&#039;t 0...</p><div class="quotebox"><cite>Dioptimizer wrote:</cite><blockquote><p>You can verify this by reading the memory address:<br/></p><div class="codebox"><pre><code>md 0x1 0xb8050000</code></pre></div><p>If the frequency of your CPU 400/400/200<br/>value mus be same - 0x00040828</p></blockquote></div><p>NO! You are wrong... Just read the AR9331 datasheet... PLEASE, read the documentation!</p><p>In MR3020:</p><div class="codebox"><pre><code>uboot&gt; md.b 0xb8050000 4

B8050000: 00 81 80 00    ....</code></pre></div><p>Do you understand now that different SoCs, even with the same CPU core, could have different registers, missing registers and different settings for PLL configuration?</p>											<p class="post-edited">(Last edited by <strong>pepe2k</strong> on 6 May 2013, 18:44)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p201121">
				<div class="post-metadata">
					<div class="post-num">Post #46</div>
					<div class="post-author">NiHaoMike</div>
					<div class="post-datetime">
						8 May 2013, 07:09					</div>
				</div>
				<div class="post-content content">
					<p>I hard coded the Flash to 8MB and it works great. BTW, for those trying to find a config page, don&#039;t bother. Just tack on 64kB of 0xFFs and then put in the model number and MAC address.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p201141">
				<div class="post-metadata">
					<div class="post-num">Post #47</div>
					<div class="post-author">mips</div>
					<div class="post-datetime">
						8 May 2013, 09:43					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>pepe2k wrote:</cite><blockquote><div class="quotebox"><cite>dimonix wrote:</cite><blockquote><p>@pepe2k,<br/>Could you provide some tips for compiling RAM (non-relocatable) version of your u-boot?<br/>This would be very helpful, because RAM version could be loaded via standard u-boot, without burning the flash. It gives a very safe way of testing and debugging. Thanks.</p></blockquote></div><p>I&#039;m sorry, but I don&#039;t know U-Boot very well, so I don&#039;t know how to do this... please, see also this FAQ answer:<br/><a href="http://www.denx.de/wiki/view/DULG/CanUBootBeConfiguredSuchThatItCanBeStartedInRAM">http://www.denx.de/wiki/view/DULG/CanUBootBeConfiguredSuchThatItCanBeStartedInRAM</a></p></blockquote></div><p>@pepe2k,dimonix:</p><p>I will try to give a RAM version when I have time.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p201670">
				<div class="post-metadata">
					<div class="post-num">Post #48</div>
					<div class="post-author">Davidwei</div>
					<div class="post-datetime">
						13 May 2013, 15:31					</div>
				</div>
				<div class="post-content content">
					<p>Hi,pepe2k<br/>Can you make the same uboot for AR9341(such as TL-WR841N V8,TL-WR843)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p201676">
				<div class="post-metadata">
					<div class="post-num">Post #49</div>
					<div class="post-author">pepe2k</div>
					<div class="post-datetime">
						13 May 2013, 16:19					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Davidwei wrote:</cite><blockquote><p>Hi,pepe2k<br/>Can you make the same uboot for AR9341(such as TL-WR841N V8,TL-WR843)</p></blockquote></div><p>I don&#039;t have any device with this SoC, so I don&#039;t have chance to test it.</p><p>I&#039;m working now at version for AR9344 (WDR3600/4300/4310) with O/C option in U-Boot console and recovery mode on reset button.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p201677">
				<div class="post-metadata">
					<div class="post-num">Post #50</div>
					<div class="post-author">headless.cross</div>
					<div class="post-datetime">
						13 May 2013, 16:30					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>pepe2k wrote:</cite><blockquote><p>I&#039;m working now at version for AR9344 (WDR3600/4300/4310) with O/C option in U-Boot console and recovery mode on reset button.</p></blockquote></div><p>Very good news you&#039;ve got here pepe2k. I&#039;m interested to try it.</p>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 2 of 25</div><nav><ul><li><a href="viewtopic.php%3Fid=43237&amp;p=1.html">1</a></li><li class="pagination-current"><span>2</span></li><li><a href="viewtopic.php%3Fid=43237&amp;p=3.html">3</a></li><li><a href="viewtopic.php%3Fid=43237&amp;p=4.html">4</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=43237&amp;p=25.html">25</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>