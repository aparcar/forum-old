<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Config not Working</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 31 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p88001">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">waltk</div>
					<div class="post-datetime">
						14 May 2009, 21:51					</div>
				</div>
				<div class="post-content content">
					<p>I am trying to configure a router as a client to an WPA-EAP site.&nbsp; The configuration using using LuCI does not connect, but I installed the wpa_supplicant, and when I start that manually, it connects without a problem.&nbsp; I tried to manually change the /etc/config/wireless file so that it matched the wpa_supplicant.conf, but that did not help.&nbsp; I seems from teh log that a critical error is that the &#039;/var/run/wpa_supplicant-wlan0.conf&#039; file can&#039;t be parse, but I am not sure how to fix this.&nbsp; At this stage, I would be happy if I could get the supplicant to start automatically.&nbsp; I tried creating a startup script for that, but it did not work either.&nbsp; Any help would be appreciated.</p><p>Here are the details.</p><p>Router:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;WRT54G v2.2<br />Firmware:&nbsp; &nbsp; &nbsp;openwrt-brcm47xx-squashfs.trx<br />Supplicant:&nbsp; &nbsp; wpa-supplicant_0.6.3-1_mipsel.ipk</p><br /><p>*********** Processes ****************<br /> ---------------------------------------------------<br />&nbsp; PID USER&nbsp; &nbsp; &nbsp; &nbsp;VSZ STAT COMMAND<br />&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp; 1968 S&nbsp; &nbsp; init<br />&nbsp; &nbsp; 2 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&lt;&nbsp; [kthreadd]<br />&nbsp; &nbsp; 3 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&lt;&nbsp; [ksoftirqd/0]<br />&nbsp; &nbsp; 4 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&lt;&nbsp; [events/0]<br />&nbsp; &nbsp; 5 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&lt;&nbsp; [khelper]<br />&nbsp; &nbsp;19 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&lt;&nbsp; [kblockd/0]<br />&nbsp; &nbsp;53 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&nbsp; &nbsp;[pdflush]<br />&nbsp; &nbsp;54 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&nbsp; &nbsp;[pdflush]<br />&nbsp; &nbsp;55 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&lt;&nbsp; [kswapd0]<br />&nbsp; &nbsp;56 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&lt;&nbsp; [aio/0]<br />&nbsp; &nbsp;68 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&lt;&nbsp; [mtdblockd]<br />&nbsp; 238 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SWN&nbsp; [jffs2_gcd_mtd3]<br />&nbsp; 250 root&nbsp; &nbsp; &nbsp; 1968 S&nbsp; &nbsp; logger -s -p 6 -t<br />&nbsp; 251 root&nbsp; &nbsp; &nbsp; 1968 S&nbsp; &nbsp; init<br />&nbsp; 265 root&nbsp; &nbsp; &nbsp; 1980 S&nbsp; &nbsp; syslogd -C16<br />&nbsp; 267 root&nbsp; &nbsp; &nbsp; 1964 S&nbsp; &nbsp; klogd<br />&nbsp; 279 root&nbsp; &nbsp; &nbsp; 1136 S&nbsp; &nbsp; /sbin/hotplug2 --override --persistent --max-children<br />&nbsp; 438 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&lt;&nbsp; [b43]<br />&nbsp; 559 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&lt;&nbsp; [ipolldevd]<br />&nbsp; 575 root&nbsp; &nbsp; &nbsp; 1980 S&nbsp; &nbsp; udhcpc -t 0 -i wlan0 -b -p /var/run/wlan0.pid -R<br />&nbsp; 760 root&nbsp; &nbsp; &nbsp; 1940 S&nbsp; &nbsp; /usr/sbin/dropbear -p 22<br />&nbsp; 765 root&nbsp; &nbsp; &nbsp; 1964 S&nbsp; &nbsp; /usr/sbin/httpd -p 80 -h /www -r OpenWrt<br />&nbsp; 792 nobody&nbsp; &nbsp; 1280 S&nbsp; &nbsp; /usr/sbin/dnsmasq -K -D -y -Z -b -E -s lan -S /lan/ -<br />&nbsp; 800 root&nbsp; &nbsp; &nbsp; 1996 S&nbsp; &nbsp; /usr/sbin/dropbear -p 22<br />&nbsp; 801 root&nbsp; &nbsp; &nbsp; 1976 S&nbsp; &nbsp; -ash<br />&nbsp; 806 root&nbsp; &nbsp; &nbsp; 1968 R&nbsp; &nbsp; ps -aux</p><br /><p>************&nbsp; /etc/config/wireless *****************</p><p>config &#039;wifi-device&#039; &#039;wlan0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;type&#039; &#039;mac80211&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;channel&#039; &#039;5&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;disabled&#039; &#039;0&#039;</p><p>config &#039;wifi-iface&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;device&#039; &#039;wlan0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ssid&#039; &#039;OpenWrt&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;network&#039; &#039;wan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;mode&#039; &#039;sta&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;eap_type&#039; &#039;PEAP&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;password&#039; &#039;&lt;password&gt;&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;encryption&#039; &#039;wpa&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;auth&#039; &#039;&lt;domain\user&gt;&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;identity&#039; &#039;&lt;domain\user&gt;&#039;</p><br /><p>********** Command used to successfully, but manually start supplicant **************</p><p>wpa_supplicant -B -iwlan0 -c/etc/wpa_supplicant.conf &amp;</p><br /><br /><br /><p>************ wpa_supplicant.conf&nbsp; *************</p><br /><p>network={<br />&nbsp; &nbsp; &nbsp; &nbsp;ssid=&quot;&lt;SSID&gt;&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp;scan_ssid=1<br />&nbsp; &nbsp; &nbsp; &nbsp;key_mgmt=WPA-EAP<br />&nbsp; &nbsp; &nbsp; &nbsp;eap=PEAP<br />&nbsp; &nbsp; &nbsp; &nbsp;anonymous_identity=&quot;&lt;domain\user&gt;&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp;identity=&quot;&lt;domain\user&gt;&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp;password=&quot;&lt;password&gt;&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp;phase1=&quot;peaplabel=0&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp;phase2=&quot;auth=MSCHAPV2&quot;<br />}</p><br /><br /><p>*********** Partial System Log Pre-Manual Start ****************</p><p>Feb&nbsp; 5 22:27:39 OpenWrt user.info kernel: Registered led device: b43-phy0::radio<br />Feb&nbsp; 5 22:27:39 OpenWrt user.debug kernel: b43-phy0 debug: Wireless interface started<br />Feb&nbsp; 5 22:27:39 OpenWrt user.debug kernel: b43-phy0 debug: Adding Interface type 2<br />Feb&nbsp; 5 22:27:39 OpenWrt user.info : udhcpc (v1.11.2) started<br />Feb&nbsp; 5 22:27:40 OpenWrt user.info : Line 10: unknown network field &#039;eap_type&#039;.<br />Feb&nbsp; 5 22:27:40 OpenWrt user.info : Line 17: failed to parse network block.<br />Feb&nbsp; 5 22:27:40 OpenWrt user.info : Failed to read or parse configuration &#039;/var/run/wpa_supplicant-wlan0.conf&#039;.<br />Feb&nbsp; 5 22:27:40 OpenWrt user.info : enable_mac80211(wlan0): Failed to set up wpa_supplicant for interface wlan0<br />Feb&nbsp; 5 22:27:40 OpenWrt user.debug kernel: b43-phy0 debug: Removing Interface type 2<br />Feb&nbsp; 5 22:27:40 OpenWrt user.debug kernel: b43-phy0 debug: Wireless interface stopped<br />Feb&nbsp; 5 22:27:40 OpenWrt user.debug kernel: b43-phy0 debug: DMA-30 rx_ring: Used slots 1/64, Failed frames 0/0 = 0.0%, Average tries 0.00<br />Feb&nbsp; 5 22:27:40 OpenWrt user.debug kernel: b43-phy0 debug: DMA-30 tx_ring_AC_BK: Used slots 0/128, Failed frames 0/0 = 0.0%, Average tries 0.00<br />Feb&nbsp; 5 22:27:40 OpenWrt user.debug kernel: b43-phy0 debug: DMA-30 tx_ring_AC_BE: Used slots 0/128, Failed frames 0/0 = 0.0%, Average tries 0.00<br />Feb&nbsp; 5 22:27:40 OpenWrt user.debug kernel: b43-phy0 debug: DMA-30 tx_ring_AC_VI: Used slots 0/128, Failed frames 0/0 = 0.0%, Average tries 0.00<br />Feb&nbsp; 5 22:27:40 OpenWrt user.debug kernel: b43-phy0 debug: DMA-30 tx_ring_AC_VO: Used slots 2/128, Failed frames 0/8 = 0.0%, Average tries 1.00<br />Feb&nbsp; 5 22:27:40 OpenWrt user.debug kernel: b43-phy0 debug: DMA-30 tx_ring_mcast: Used slots 0/128, Fail</p><br /><br /><p>*********** Partial System Log Post-Manual Start ****************</p><p>Feb&nbsp; 5 22:33:10 OpenWrt user.debug kernel: b43-phy0 debug: Wireless interface started<br />Feb&nbsp; 5 22:33:10 OpenWrt user.debug kernel: b43-phy0 debug: Adding Interface type 2<br />Feb&nbsp; 5 22:33:12 OpenWrt user.debug kernel: wlan0: authenticate with AP 00:e0:b8:76:26:9e<br />Feb&nbsp; 5 22:33:12 OpenWrt user.debug kernel: wlan0: authenticate with AP 00:e0:b8:76:26:9e<br />Feb&nbsp; 5 22:33:12 OpenWrt user.debug kernel: wlan0: authenticated<br />Feb&nbsp; 5 22:33:12 OpenWrt user.debug kernel: wlan0: associate with AP 00:e0:b8:76:26:9e<br />Feb&nbsp; 5 22:33:12 OpenWrt user.debug kernel: wlan0: RX AssocResp from 00:e0:b8:76:26:9e (capab=0x431 status=0 aid=5)<br />Feb&nbsp; 5 22:33:12 OpenWrt user.debug kernel: wlan0: associated<br />Feb&nbsp; 5 22:33:14 OpenWrt user.info : Sending select for &lt;ip&gt;...<br />Feb&nbsp; 5 22:33:14 OpenWrt user.info : Lease of &lt;ip&gt; obtained, lease time 87000<br />Feb&nbsp; 5 22:33:14 OpenWrt user.info : adding router &lt;ip&gt;<br />Feb&nbsp; 5 22:33:14 OpenWrt user.info : deleting old routes<br />Feb&nbsp; 5 22:33:14 OpenWrt user.info : adding dns &lt;ip&gt;<br />Feb&nbsp; 5 22:33:14 OpenWrt user.info : adding dns &lt;ip&gt;<br />Feb&nbsp; 5 22:33:16 OpenWrt user.notice root: adding wan (wlan0) to firewall zone wan<br />Feb&nbsp; 5 22:33:25 OpenWrt daemon.info dnsmasq[882]: reading /tmp/resolv.conf.auto<br />Feb&nbsp; 5 22:33:25 OpenWrt daemon.info dnsmasq[882]: using nameserver &lt;ip&gt;#53<br />Feb&nbsp; 5 22:33:25 OpenWrt daemon.info dnsmasq[882]: using nameserver &lt;ip&gt;#53<br />Feb&nbsp; 5 22:33:25 OpenWrt daemon.info dnsmasq[882]: using local addresses only for domain lan</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>