<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> SSID with multip VLAN&#039;s</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 21 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p149958">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">CMarco</div>
					<div class="post-datetime">
						30 Nov 2011, 19:19					</div>
				</div>
				<div class="post-content content">
					<p>Hello to all,</p><p>I have a on questions that, an I will be glade to hear opinions about it.<br />It is possible to have one SSID with two or more VLAN&#039;s for example:</p><p>/etc/config/network:<br />config switch&nbsp; &nbsp; &quot;eth0&quot;<br />&nbsp; &nbsp; option vlan0 &quot;1 2 3 4 5*&quot;<br />&nbsp; &nbsp; option vlan1 &quot;0 5&quot;</p><p>config interface lan<br />&nbsp; &nbsp; &nbsp; &nbsp; option type&nbsp; &nbsp; &nbsp;bridge<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname&nbsp; &nbsp;&quot;eth0.0&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; static<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr&nbsp; &nbsp;192.168.1.1<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask&nbsp; 255.255.255.0</p><p>config interface lan1<br />&nbsp; &nbsp; &nbsp; &nbsp; option type&nbsp; &nbsp; &nbsp;bridge<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname&nbsp; &nbsp;&quot;eth0.1&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; static<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr&nbsp; &nbsp;192.168.2.1<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask&nbsp; 255.255.255.0</p><p>config interface loopback<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname&nbsp; &nbsp;&quot;lo&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; static<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr&nbsp; &nbsp;127.0.0.1<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask&nbsp; 255.0.0.0</p><br /><p>------- /etc/config/wireless -------------------<br />config wifi-device&nbsp; &nbsp; &nbsp; wl0<br />&nbsp; &nbsp; &nbsp; &nbsp; option type&nbsp; &nbsp; &nbsp;broadcom<br />&nbsp; &nbsp; &nbsp; &nbsp; option channel&nbsp; 5</p><p>config wifi-iface<br />&nbsp; &nbsp; &nbsp; &nbsp; option device&nbsp; &nbsp;wl0<br />&nbsp; &nbsp; &nbsp; &nbsp; option mode&nbsp; &nbsp; &nbsp;ap<br />&nbsp; &nbsp; &nbsp; &nbsp; option ssid&nbsp; &nbsp; &nbsp;myNet<br />&nbsp; &nbsp; &nbsp; &nbsp; option hidden&nbsp; &nbsp;0<br />&nbsp; &nbsp; &nbsp; &nbsp; option encryption wep<br />&nbsp; &nbsp; &nbsp; &nbsp; option key&nbsp; &nbsp;XXXXXXXXXXXXXXX<br />&nbsp; &nbsp; &nbsp; &nbsp; option network&nbsp; &nbsp;lan&nbsp; lan1&nbsp; &nbsp; &nbsp;-&gt; I have tested with the two interfaces hear and this do not work</p><br /><p>If some one can give me an advice or an example I will appreciate.</p><p>Thanks in advanced!<br />Regards to all<br />CMarco</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p150137">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">CMarco</div>
					<div class="post-datetime">
						2 Dec 2011, 16:26					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>Somebody can give me an advice, please?</p><p>Regards to all<br />CMarco</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p150138">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">3zl</div>
					<div class="post-datetime">
						2 Dec 2011, 17:10					</div>
				</div>
				<div class="post-content content">
					<p>your wireless config cannot work like this.<br />Check with brctl, you will see the &quot;option bridge&quot; in network config builds a bridge with the name &quot;br-lan&quot; and the interfaces as members.<br />So &quot;brctl show&quot; shws what happened in detail.</p><p>To add a second interface to the bridge just declare it as member of a bridge i.d.&nbsp; option network lan .</p><p>You can script this also with : brctl addif br-lan &lt;your 2nd interface&gt;</p><p>Check it with &quot;brctl show&quot; ...&amp; read/learn&nbsp; more about bridging</p><p>regards<br />3zl</p>											<p class="post-edited">(Last edited by <strong>3zl</strong> on 2 Dec 2011, 17:17)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p150140">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">eleon216</div>
					<div class="post-datetime">
						2 Dec 2011, 17:25					</div>
				</div>
				<div class="post-content content">
					<p>what do you want to achieve with this? <br />why one&nbsp; SSID with two VLANs? First you create two VLANs and than you brigde this two VLANs?</p><p>If you want to do something like VLAN-trunking over Wifi look at <a href="https://forum.openwrt.org/viewtopic.php?id=33225">https://forum.openwrt.org/viewtopic.php?id=33225</a> and the link posted there. </p><p>if you want something else, describe what do you want to exactly and why do you want to do this. but I don&#039;t think you have the right idea how bridging works, and what is possible.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p150144">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">CMarco</div>
					<div class="post-datetime">
						2 Dec 2011, 18:44					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>What I want is to have one SSID with two vlan&#039;s. For example SSID &quot;Guest&quot; with VLAN3 and VLAN2.<br />Seems simple but...</p><p>In the VLAN-trunking over Wifi,&nbsp; I have one SSID per VLAN, now I&#039;am trying something diferent, one SSID with 2 VLAN&#039;s.</p><p>Can somebody tell me how can I do this, like a little example.</p><p>Regards to all<br />CMarco</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p150162">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">eleon216</div>
					<div class="post-datetime">
						3 Dec 2011, 00:40					</div>
				</div>
				<div class="post-content content">
					<p>check the link in the post!</p><p>this guy is using the dynamic VLAN capabilities of hostapd. So you can have multiple VLANs on one SSID. <br />The Radius-Server stores the VLAN for every user and if he connects his client get his VLAN assigned. So you run muliple VLANs over one SSID, but only one VLAN per client. I&#039;m not sure if you can run more than on VLAN per Client and I don&#039;t get the point either (except for trunking).</p><p>what you want to do isn&#039;t a standard setup, so please don&#039;t expect that someone will tell you exactly what to do. You will have to get your hands dirty</p>											<p class="post-edited">(Last edited by <strong>eleon216</strong> on 3 Dec 2011, 00:42)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p150217">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">CMarco</div>
					<div class="post-datetime">
						3 Dec 2011, 20:20					</div>
				</div>
				<div class="post-content content">
					<p>Ok, thanks for the opinions...<br />I&#039;m going to go to the bottom of this question... and I will give feedback soon...</p><br /><p>Regards to all<br />CMarco</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p150996">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">CMarco</div>
					<div class="post-datetime">
						12 Dec 2011, 19:40					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>How I said where I&#039;m...<br />I have a working scenario, where I have one access point and two stations. Each station is on it&#039;s own VLAN trunk&#039;ed out only one ethernet interface at the AP side and let the switch behind handle the VLAN separation.<br />This is done as widely explained via WDS and VLANs assigned to Bridges.<br />However, one of the stations need another VLAN added, i.e. the WDS to that station now needs to be a trunk and the Station needs to be VLAN transparent, i.e. the only ethernet interface will act as trunk and so shall the wireless interface.</p><p><span class="postimg"><img src="http://forum.mikrotik.com/download/file.php?id=8210" alt="http://forum.mikrotik.com/download/file.php?id=8210" /></span></p><p>The picture is not mine but the scenario that I&#039;m facing is the same as the picture...<br />The purpose is to provide 3 different type of services/different circuits to the equipment behind the stations.<br />the wireless links are WDS and whether or not i use VirtualAP&#039;s on the AP end, does not seem to matter so far, when having a dedicated VLAN per WDS link. However, now that I need two VLANs over one WDS I seem to struggle. <br />When I have only VLAN 66 and 3 was easy, but now with VLAN 5...</p><p>So can someone give advises how to solve this question</p><p>Regards<br />CMarco</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p151024">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">3zl</div>
					<div class="post-datetime">
						12 Dec 2011, 23:15					</div>
				</div>
				<div class="post-content content">
					<p>as&nbsp; eleon216 stated, you have to dig&nbsp; for madwifi hostapd dynamic vlan configuration.</p><p>example config explained here somehow</p><p><a href="http://dev.laptop.org/pub/firmware/libertas/thinfirm/hostapd.conf.sample">http://dev.laptop.org/pub/firmware/libe … onf.sample</a></p><p>it seems to go a very long way to accomplish your task.</p><p>Maybe you should consider a different approach for your application or is it more academic ?</p><p>good luck</p><p>regards<br />3zl</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p151058">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">CMarco</div>
					<div class="post-datetime">
						13 Dec 2011, 14:55					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>@3zl<br />The picture is not academic, is a real scenario. The approach that eleon216 stated I still have my doubt about is application in this WDS Scenario...</p><p>My first approach was what I show in the picture. Is an approach similar to what we all do, when configure Wired Trunk, where we have more than one VLAN in the same connection. My mistake was thinking that was a simple thing in Wireless... <br />I was searching in the Internet and of all the manufacturers no one, form what I saw, have do an approach like what I mentioned... They all do:</p><p>Create another WDS LINK, one WDS link per VLAN that you want to pass.<br />A WDS LINK1 to VLAN 66<br />A WDS LINK2 to VLAN 5<br />Both under the same radio, i.e. MAC80211...</p><p>Of course this is not equal to my first approach... <br />Have someone tested this approach and can give me feedback about is functionality with OpenWRT. And what you, that work with OpenWRT longer time than I<br />and have more experience, think about this second approach.</p><p>Regards,<br />CMarco</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p151099">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">3zl</div>
					<div class="post-datetime">
						13 Dec 2011, 22:18					</div>
				</div>
				<div class="post-content content">
					<p>Sorry, i&#039;m not a specialist in VLAN, but it seems to me, that its an intresting field to work on.</p><p>As far as i&nbsp; have gathered, madwifi drivers with hostpapd should be able to accomplish this, at least its in the configuration of the Link i did send.</p><div class="codebox"><pre><code># VLAN interface list for dynamic VLAN mode is read from a separate text file.
# This list is used to map VLAN ID from the RADIUS server to a network
# interface. Each station is bound to one interface in the same way as with
# multiple BSSIDs or SSIDs. Each line in this text file is defining a new
# interface and the line must include VLAN ID and interface name separated by
# white space (space or tab).
#vlan_file=/etc/hostapd.vlan

# Interface where 802.1q tagged packets should appear when a RADIUS server is
# used to determine which VLAN a station is on.  hostapd creates a bridge for
# each VLAN.  Then hostapd adds a VLAN interface (associated with the interface
# indicated by &#039;vlan_tagged_interface&#039;) and the appropriate wireless interface
# to the bridge.
#vlan_tagged_interface=eth0</code></pre></div><p>Have a look around <a href="http://www.zeroshell.net/eng/wireless-access-point">http://www.zeroshell.net/eng/wireless-access-point</a> seems&nbsp; to have VLAN on WIFI</p><p>Basics <a href="http://academic.csuohio.edu/yuc/papers/VLAN.pdf">academic.csuohio.edu/yuc/papers/VLAN.pdf</a></p><p>Interesting discussion on <a href="http://www.tomshardware.co.uk/forum/20018-17-vlan-operation-transparent-bridging">http://www.tomshardware.co.uk/forum/200 … t-bridging</a></p><p>MikroTIK <a href="http://wiki.mikrotik.com/wiki/802.1q_Trunk_extension_over_Wireless_P2P_Link">http://wiki.mikrotik.com/wiki/802.1q_Tr … s_P2P_Link</a></p><p><a href="http://jcostom.wordpress.com/2010/07/03/2-wireless-aps-in-one-with-vlan-trunking-in-openwrt">http://jcostom.wordpress.com/2010/07/03 … in-openwrt</a></p><br /><p>As we do use L2-AWDS-Mesh i might test if it passes VLAN tagged packages.</p><p>Are you willing to dig further and find a solution ?. I do think it can be done.<br />At least there a some infos on the internet.</p><p>regards<br />3zl</p>											<p class="post-edited">(Last edited by <strong>3zl</strong> on 14 Dec 2011, 00:52)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p151267">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">CMarco</div>
					<div class="post-datetime">
						15 Dec 2011, 19:03					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>@3zl<br />I have look to the links that you mentioned, thanks for them, and much more...</p><p>The link, MikroTIK <a href="http://wiki.mikrotik.com/wiki/802.1q_Tr">http://wiki.mikrotik.com/wiki/802.1q_Tr</a> … s_P2P_Link is the second approach that I have mentioned.</p><p>Starting with this approach...</p><p>In this picture <a href="http://wiki.mikrotik.com/images/f/f3/Vlan.jpg">http://wiki.mikrotik.com/images/f/f3/Vlan.jpg</a> they basically create one VAP and one WDS link per VLAN that they want to pass through 802.11Q wireless trunk<br />WDS LINK1 - VAP10 - to VLAN 10<br />WDS LINK2 - VAP20 - to VLAN 20<br />WDS LINK3 - VAP30 - to VLAN 30</p><p>I&#039;m thinking to test this under the same radio, MAC80211, in 802.11an...</p><p>As you said:&quot;As we do use L2-AWDS-Mesh i might test if it passes VLAN tagged packages.&quot;<br />I ask you can if you can test this, because I do not have still the equipment to test. And I&#039;m still searching what the best equipments for a scenario like L2-AWDS-Mesh. <br />If you can tell me what the wireless equipments that you use with OpenWRT I will appreciate very much.<br />Below is the configuration for device 1</p><p>Are you willing to dig further and find a solution ?. I do think it can be done.<br />R:Yes, my intention is to go further.</p><p>Device 1 <br />/etc/config/wireless <br />config wifi-device&nbsp; Wlan1<br />&nbsp; &nbsp; option type&nbsp; &nbsp; &nbsp;mac80211<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; option hwmode&nbsp; &nbsp;11na<br />&nbsp; &nbsp; option htmode&nbsp; &nbsp; HT20<br />&nbsp; &nbsp; option channel&nbsp; 36&nbsp; &nbsp; <br />&nbsp; &nbsp;&nbsp; &nbsp; option txpower&nbsp; &nbsp; 20<br />&nbsp; &nbsp; option disabled 0</p><p>config wifi-iface<br />&nbsp; &nbsp; option device&nbsp; &nbsp; &nbsp; &nbsp; wlan1<br />&nbsp; &nbsp; option network&nbsp; &nbsp; &nbsp;vlan10<br />&nbsp; &nbsp; option ssid&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;VLAN10<br />&nbsp; &nbsp; option wds&nbsp; &nbsp;&nbsp; &nbsp; 1<br />&nbsp; &nbsp; option mode&nbsp; &nbsp;&nbsp; &nbsp; sta<br />&nbsp; &nbsp; option hidden&nbsp; &nbsp;&nbsp; &nbsp; 0<br />&nbsp; &nbsp; option encryption&nbsp; psk2<br />&nbsp; &nbsp; option key&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#039;secret_key&#039;<br />&nbsp; &nbsp; <br />config wifi-iface<br />&nbsp; &nbsp; option device&nbsp; &nbsp; &nbsp; wlan1<br />&nbsp; &nbsp; option network&nbsp; &nbsp; &nbsp;vlan20<br />&nbsp; &nbsp; option ssid&nbsp; &nbsp;&nbsp; &nbsp; VLAN20<br />&nbsp; &nbsp; option wds&nbsp; &nbsp;&nbsp; &nbsp; 1<br />&nbsp; &nbsp; option mode&nbsp; &nbsp;&nbsp; &nbsp; sta<br />&nbsp; &nbsp; option hidden&nbsp; &nbsp;&nbsp; &nbsp; 0<br />&nbsp; &nbsp; option encryption&nbsp; psk2<br />&nbsp; &nbsp; option key&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#039;secret_key&#039;</p><p>config wifi-iface<br />&nbsp; &nbsp; option device&nbsp; &nbsp; &nbsp; wlan1<br />&nbsp; &nbsp; option network&nbsp; &nbsp; &nbsp;vlan30<br />&nbsp; &nbsp; option ssid&nbsp; &nbsp;&nbsp; &nbsp; VLAN30<br />&nbsp; &nbsp; option wds&nbsp; &nbsp;&nbsp; &nbsp; 1<br />&nbsp; &nbsp; option mode&nbsp; &nbsp;&nbsp; &nbsp; ap<br />&nbsp; &nbsp; option hidden&nbsp; &nbsp;&nbsp; &nbsp; 0<br />&nbsp; &nbsp; option encryption&nbsp; psk2<br />&nbsp; &nbsp; option key&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#039;secret_key&#039;</p><br /><p>#ETH0 - port 0 the uplink trunk port<br />config &#039;switch&#039; &#039;eth0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;reset&#039; &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;enable_vlan&#039; &#039;1&#039;</p><p>config &#039;switch_vlan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;device&#039; &#039;eth0&#039;&nbsp; &nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;vlan&#039; &#039;10&#039;&nbsp; &nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ports&#039; &#039;0t 5t&#039; &nbsp; &nbsp; &nbsp; &nbsp; </p><p>config &#039;switch_vlan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;device&#039; &#039;eth0&#039;&nbsp; &nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;vlan&#039; &#039;20&#039; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ports&#039; &#039;0t 2 3 5t&#039; &nbsp; &nbsp; </p><p>config &#039;switch_vlan&#039;&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;device&#039; &#039;eth0&#039;&nbsp; &nbsp;&nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;vlan&#039; &#039;30&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ports&#039; &#039;0t 4 5t&#039;&nbsp; &nbsp;&nbsp; </p><p>config interface loopback&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; option ifname&nbsp; &nbsp; &nbsp; lo<br />&nbsp; &nbsp; option proto&nbsp; &nbsp; &nbsp; &nbsp;static<br />&nbsp; &nbsp; option ipaddr&nbsp; &nbsp; &nbsp; 127.0.0.1<br />&nbsp; &nbsp; option netmask&nbsp; &nbsp; &nbsp;255.0.0.0</p><p>config interface vlan10<br />&nbsp; &nbsp; option type&nbsp; &nbsp; &nbsp; &nbsp; bridge&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; option stp&nbsp; &nbsp; &nbsp; &nbsp; 1<br />&nbsp; &nbsp; option ifname&nbsp; &nbsp; &nbsp; &nbsp; eth0.10<br />&nbsp; &nbsp; option proto&nbsp; &nbsp; &nbsp; &nbsp; static<br />&nbsp; &nbsp; option ipaddr&nbsp; &nbsp; &nbsp; &nbsp; 192.168.3.1&nbsp; &nbsp; <br />&nbsp; &nbsp; option netmask&nbsp; &nbsp; &nbsp; &nbsp; 255.255.255.0<br />&nbsp; &nbsp; option defaultroute&nbsp; &nbsp; 0<br />&nbsp; &nbsp; option peerdns&nbsp; &nbsp; &nbsp; &nbsp; 0</p><p>config interface vlan20<br />&nbsp; &nbsp; option type&nbsp; &nbsp; &nbsp; &nbsp; bridge<br />&nbsp; &nbsp; option stp&nbsp; &nbsp; &nbsp; &nbsp; 1<br />&nbsp; &nbsp; option ifname&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; eth0.20</p><p>config interface vlan30<br />&nbsp; &nbsp; option type&nbsp; &nbsp; &nbsp; &nbsp; bridge<br />&nbsp; &nbsp; option stp&nbsp; &nbsp; &nbsp; &nbsp; 1<br />&nbsp; &nbsp; option ifname&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; eth0.30</p><p>In the Device 2 the configuration is equal, if you want I can send you also the configuration, no problem... If you need something else...<br />All developers contribution will be very appreciated.</p><p>Regards,<br />CMarco</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p151346">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">3zl</div>
					<div class="post-datetime">
						16 Dec 2011, 17:46					</div>
				</div>
				<div class="post-content content">
					<p>Hello CMarco</p><p>i&#039;ve decided to have a deeper look at OpenWrt implementation of VLAN.</p><p>Scope is to build a setup with several virtual routers and Debian on VMware.</p><p>I will let you know any news / ideas i&#039;get out of this</p><p>regards<br />3zl</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p153313">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">3zl</div>
					<div class="post-datetime">
						6 Jan 2012, 12:44					</div>
				</div>
				<div class="post-content content">
					<p>i did promise to respond if there are news...here they are:&nbsp; success with trunking over wifi</p><p>&nbsp; Router&nbsp; &nbsp; &nbsp; &nbsp; : DIR-300 A1 (switch phy IC175C)<br />&nbsp; openwrt 8.09 r18808 / 10.03 trunk on DIR-300A1<br />&nbsp; wifi-if&nbsp; &nbsp; &nbsp; &nbsp;: awds0&nbsp; AWDS-L2 Mesh adhoc<br />&nbsp; trunk-if&nbsp; &nbsp; &nbsp; : veth0&nbsp; setup by vethd on eth0<br />&nbsp; eth0.1.eth0.4 :&nbsp; vlan-if set to respective ports 0..3</p><p>phy eth0 carries traffic from all ports but cannot assigned directly <br />to a bridge (kills switch ) , so use virtual interface attached via tun (&#039; vethd eth0 &#039;) .</p><p>The resulting interface veth0 can be briged with to a wireless interface (athx, wlan0..)<br />transporting &#039;raw&#039; ethernet stream thus mirrors vlan/ports to either side.</p><p>interface veth0 / br can be monitored with tcpdump <br />(take care to filter local ssh traffic, it causes loop)</p><p>[phy port0..portx]-&gt;[switch.eth0]-&gt;veth0-&gt;br&lt;-wif~~wif-&gt;br-&gt;veth0-&gt;[eth0.switch]...[phy port0..portx]<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />maybe same setup applies to WS or similiar WIFI-bridging on layer 3 , but did not&nbsp; test</p><p>if someone plays with this kind of setup, please report</p><p>regards<br />3zl</p>											<p class="post-edited">(Last edited by <strong>3zl</strong> on 7 Jan 2012, 01:35)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p153379">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">craigdavids</div>
					<div class="post-datetime">
						6 Jan 2012, 20:06					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>@3zl: After read this post, i think the topic is very interesting and I will be glade in participate in the test, and I have the conditions to test this in a WDS link between Router AP&#039;s. And if is there, also, others, developers of openwrt also, with the possibility to also try this, please join us.</p><p>In your message there are things that, maybe because of my lack of experience i do not understand.<br />like &quot;so use virtual interface attached via tun (&#039; vethd eth0 &#039;)&quot;. I&#039;m not understanding the transition [switch.eth0]-&gt;veth0.</p><p>Can you help me by, if it is not too much to ask, give same sample configurations.</p><p>@CMarco: I will test also your approach, after test 3zl approach, that I think summarizes a WDS P2P connection (wds+ap to wds+sta). But in this case, we have one WDS P2P connection for each VLAN transfered between router AP&#039;s, all above the same Radio, this is sharing the same characteristic, like frequency, channel, etc... With this your intention is to pass the VLAN&#039;s from one AP to another... like MikroTIK <a href="http://wiki.mikrotik.com/wiki/802.1q_Trunk_extension_over_Wireless_P2P_Link">http://wiki.mikrotik.com/wiki/802.1q_Tr … s_P2P_Link</a></p><p>Best Regards.<br />Craig Davids</p>											<p class="post-edited">(Last edited by <strong>craigdavids</strong> on 6 Jan 2012, 20:08)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p153417">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">3zl</div>
					<div class="post-datetime">
						6 Jan 2012, 23:59					</div>
				</div>
				<div class="post-content content">
					<p>i wil try to give some hints about whats going on:</p><p>1. Veth <br />&nbsp; &nbsp;Veth stands for Virtual ETHernet. It is a simple tunnel driver that works at the link layer and looks like a pair of ethernet devices interconnected with each other.<br />&nbsp; &nbsp;Simply speaking its a two-leg virtual device with one leg in the phy ethx and the other created by the driver , hence&nbsp; [ethx]&lt;-&gt;tun-driver&lt;-&gt;[vethx]<br />&nbsp; &nbsp;It can litterally be used like a phy ethernet device&nbsp; <a href="http://wiki.openvz.org/Virtual_Ethernet_device">http://wiki.openvz.org/Virtual_Ethernet_device</a><br />&nbsp; &nbsp;The verthd driver is available as ipkg package and as kernel driver (kernel_menuconfig..experimental)</p><p>2. eth0<br />&nbsp; &nbsp; as the VLAN interfaces eth0.x are created by kernel-driver, the &#039;parent&#039; eth can be accessed if not directly (because of driver issues) or by binding a veth to it and use the <br />&nbsp; &nbsp;vethx interface instead.</p><p>3. picture to clarify <br /><span class="postimg"><img src="http://i39.tinypic.com/20l1hlf.jpg" alt="http://i39.tinypic.com/20l1hlf.jpg" /></span></p><p>i will be happy to assist on further questions<br />3zl</p>											<p class="post-edited">(Last edited by <strong>3zl</strong> on 7 Jan 2012, 21:52)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p153947">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">craigdavids</div>
					<div class="post-datetime">
						12 Jan 2012, 14:38					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>@3zl: Thanks for the explanation, this is new for me.</p><p>I have&nbsp; Installed the packet &quot;veth -1.0-1-VETH is a daemon that virtualizes a ethernet card in Linux&quot; like you said.<br />I have done the command &quot;vethd eth0&quot; to bind veth0 into eth0<br />It says that &quot;Attached veth0 into eth0&quot;. So seems all ok.</p><p>After on /etc/config/network where I have:</p><p>config interface lan<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname&nbsp; &nbsp;eth0<br />&nbsp; &nbsp; &nbsp; &nbsp; option type&nbsp; &nbsp; &nbsp;bridge<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; static<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr&nbsp; &nbsp;192.168.1.110<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask&nbsp; 255.255.255.0<br />&nbsp; &nbsp; &nbsp; &nbsp; option network 192.168.1.0<br />&nbsp; &nbsp; &nbsp; &nbsp; option gateway 192.168.1.1</p><p>I have changed to:<br />config interface lan<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname&nbsp; &nbsp;veth0<br />&nbsp; &nbsp; &nbsp; &nbsp; option type&nbsp; &nbsp; &nbsp;bridge<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; static<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr&nbsp; &nbsp;192.168.1.110<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask&nbsp; 255.255.255.0<br />&nbsp; &nbsp; &nbsp; &nbsp; option network 192.168.1.0<br />&nbsp; &nbsp; &nbsp; &nbsp; option gateway 192.168.1.1</p><p>And when i do &quot;brctl show&quot; it says that bridge br-lan is created with veth0.<br />But I do not know why now i can not access or ping to the interface lan with ip 192.168.1.110. Without all the veth0 setup, I was always abel to ping to 192.168.1.110.</p><p>what I&#039;m forgetting, can you help me. </p><p>Regards,<br />Craig Davids</p>											<p class="post-edited">(Last edited by <strong>craigdavids</strong> on 12 Jan 2012, 14:49)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p153952">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">3zl</div>
					<div class="post-datetime">
						12 Jan 2012, 14:54					</div>
				</div>
				<div class="post-content content">
					<p>Hi craigdavids ,&nbsp; so wee&#039;l see what we can to checking out :</p><p>I suppose you are connected to the CPE via LAN ? what IP ip ?</p><p>logread ? <br />dmesg ?<br />ps&nbsp; .. vethd?</p><p>ifconfig eth0..veth0&nbsp; ..up ?<br />ifconfig br-lan ..up ?</p><p>i never had problems&nbsp; with veth though, might be something simple.</p><p>regards<br />3zl</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p153973">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">craigdavids</div>
					<div class="post-datetime">
						12 Jan 2012, 18:17					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>I start my router with this configuration in /etc/config/network, and the loopback also of course.<br />config interface lan<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname&nbsp; &nbsp;eth0<br />&nbsp; &nbsp; &nbsp; &nbsp; option type&nbsp; &nbsp; &nbsp;bridge<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; static<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr&nbsp; &nbsp;192.168.1.110<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask&nbsp; 255.255.255.0<br />&nbsp; &nbsp; &nbsp; &nbsp; option network 192.168.1.0<br />&nbsp; &nbsp; &nbsp; &nbsp; option gateway 192.168.1.1</p><p>At this point eth0 is up , and br-lan bridge with interface eth0 are up to. And all is ok, from my PC with IP 192.168.1.3 I can ping and access to 192.168.1.110.<br />After this i do: &quot;vethd eth0&quot; and appears a message &quot;Attached veth0 to eth0&quot;. <br />I do a &quot;ps -e | grep veth&quot; and it is all ok. </p><p>After this I go to /etc/config/network, and I only change &quot;option ifname eth0&quot; to &quot;option ifname veth0&quot;<br />config interface lan<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname&nbsp; &nbsp;veth0<br />&nbsp; &nbsp; &nbsp; &nbsp; option type&nbsp; &nbsp; &nbsp;bridge<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; static<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr&nbsp; &nbsp;192.168.1.110<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask&nbsp; 255.255.255.0<br />&nbsp; &nbsp; &nbsp; &nbsp; option network 192.168.1.0<br />&nbsp; &nbsp; &nbsp; &nbsp; option gateway 192.168.1.1</p><p>After this I save the configuration and i do /etc/init.d/network restart.&nbsp; And after this restart eth0 goes down and do not goes up again even if i do &quot;ifconfig eth0 up&quot;.</p><p>Do you see some mistake on this steps.</p><p>Regards<br />Craig Davids</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p153991">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">3zl</div>
					<div class="post-datetime">
						12 Jan 2012, 20:13					</div>
				</div>
				<div class="post-content content">
					<p>The time eth0 is down , how are you connected to the CPE ? <br />Do you have still access to OpenWrt ?<br />Have a look at logread&nbsp; &amp; dmesg about eth0 / veth0 / br-lan<br />Start with network config eth0 off the bridge and build bridge manually.</p><p>I do not have a Routerboard at hand so i&#039;ll test on atheros hardware D-Link and VMWare x86 build</p><p>regards</p><p>3zl</p>											<p class="post-edited">(Last edited by <strong>3zl</strong> on 17 Jan 2012, 08:43)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p153996">
				<div class="post-metadata">
					<div class="post-num">Post #21</div>
					<div class="post-author">3zl</div>
					<div class="post-datetime">
						12 Jan 2012, 21:08					</div>
				</div>
				<div class="post-content content">
					<p>just did a test in VMWare to check for your prblems.<br />To do step vy ste manually check for :</p><p>1.reconfig network eth0 NO bridge ..static IP<br />2.reboot &amp; check connetion</p><p>3. set bridge manually<br />vethd -v veth0 -e eth0&nbsp; # create interface <br />check if still connected to eth0</p><p>brctl addbr br-lan&nbsp; # create bridge<br />brctl addif br-lan veth0&nbsp; #add veth to bridge</p><p>ifconfig veth0 add &gt;some-ip i nyour lan segment&lt;<br />ifconfig veth&nbsp; up<br />ifconfig bv up<br />#<br />brctl show</p><p>set has effect immidiatley<br />do NOT network restart</p><p>try to connect to to veth0 IP&nbsp; # should be ok<br />try to connect to eth0 IP&nbsp; # should be ok</p><p>i.e. both interfaces should be accessible</p><p>logread&nbsp; # get infos whars going on<br />dmesg</p><p>did work for me in VMWare x86&nbsp; / DIR-300&nbsp; Kamikaze &amp; Backfire &amp; trunk</p><p>pse report what you find </p><p>regards<br />3zl</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p154073">
				<div class="post-metadata">
					<div class="post-num">Post #22</div>
					<div class="post-author">CMarco</div>
					<div class="post-datetime">
						13 Jan 2012, 13:32					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>Sorry for the delay on answer (and for this big post), but i have an accident and I was out of office for a few days. But here I&#039;m again..<br />So, first thanks 3zl and congratulations for the success with trunking over wifi. Also I&#039;m glade that Craig Davids join us and is interested in doing some test&#039;s.</p><p>@craigdavids you said:<br />&quot;@CMarco: I think summarizes a WDS P2P connection (wds+ap to wds+sta). But in this case, we have one WDS P2P connection for each VLAN transfered between router AP&#039;s, all above the same Radio, this is sharing the same characteristic, like frequency, channel, etc... With this your intention is to pass the VLAN&#039;s from one AP to another... like MikroTIK <a href="http://wiki.mikrotik.com/wiki/802.1q_Tr">http://wiki.mikrotik.com/wiki/802.1q_Tr</a> … s_P2P_Link&quot;</p><p>@craigdavid: yes your are correct. I have already test this approach and it works. The configuration example that I have put in a comment above, works but do not forget to use the same type of encryption in the wifi-iface under the same wifi-device, and the first AP, where I have &quot;option mode sta&quot; put &quot;option mode ap&quot;, and do not use eth0 in a bridge after VLAN interface declaration, thinks don&#039;t work.<br />Why if we use eth0 in a bridge after vlan interface declaration this don&#039;t work? I do not know if I&#039;m the first facing those difficulties.</p><p>I think your problem with veth0 may be resolved if instead doing /etc/init.d/network restart in the final step, do &quot;brctl addif br-lan veth0&quot; and &quot;brctl delif br-lan eth0&quot; and ifconfig veth0 up. I think may solve the problem. And other thing is that in older version of backfire vethd do no work well, but maybe some developer can answer better to this question.</p><br /><p>@3zl if the vlan-if (eth0.1.eth0.4 ) that you create, that you said that are set to respective ports 0..3, that are in the wireless trunk, if you also put, for example eth0.4, under other a wifi-device in a wifi-iface on mode AP can you connect clients. In other words is possible to have the VLAN 4 in the wifi trunk and in other wifi in mode ap for client connections all under the same wifi-device with diferent SSID&#039;s. I&#039;m asking this because I&#039;m with some problems in doing that.<br />The wireless wifi trunk was ok with a WDS link.</p><p>Best Regards,<br />CMarco</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p154087">
				<div class="post-metadata">
					<div class="post-num">Post #23</div>
					<div class="post-author">3zl</div>
					<div class="post-datetime">
						13 Jan 2012, 17:35					</div>
				</div>
				<div class="post-content content">
					<p>Hello CMarco,</p><p>i&#039;m glad to see you back and had success in the WDS-vlan trunking.<br />I do think using eth0-veth is a very general approach to get a trunk line.<br />Problem is ,except the radio, you dont have a phy-port if alll ports are controlled by the internal switch vi a vlan-tagging.<br />If i do remember well, the WRT54 CPE do have a phy-WAN-port, maybe other CPE&#039;s have similiar design.</p><p>Port-mirror:<br />If all CPE&#039;s do have same vlan configuration for their switch, the ports are like &quot;mirrored&quot; over the trunk-line.<br />You can cofigure individual ports though to belong to a different vlan and tag the output of the CPE having that vlan processed afterward.<br />The key idea is , that the kernel-driver generates the vlan-tagged packets and the switch is programmed to act on behalf&nbsp; you want to do with the vlan-packets.</p><p>Split trunk-line :<br />One approach to split the trunk-line would be forwarding though iptables ( firewall setup) to different zones. Much like std. LAN / WAN zone.<br />I&#039;ve been thinking about this and found it a natural way to have control over the trunk-line.</p><p>Some documentation would be very nice to end up in a &quot;howto&quot;, but my time is quite limited to work this out and document in detail for WDS and such.<br />Anyway a starting point would be to decribe your setup for others to understand too</p><p>keep on good work and let me know if i can help</p><p><a href="http://cdn.randomfunnypicture.com/pictures/1757no-job-done-till-paper-work.jpg">http://cdn.randomfunnypicture.com/pictu … r-work.jpg</a></p><p>regards<br />3zl</p>											<p class="post-edited">(Last edited by <strong>3zl</strong> on 16 Jan 2012, 17:58)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p154406">
				<div class="post-metadata">
					<div class="post-num">Post #24</div>
					<div class="post-author">craigdavids</div>
					<div class="post-datetime">
						16 Jan 2012, 17:37					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>Thanks to both, and veth0 problem solved. Will be carried, still testing and dealing with other problems.</p><p>I think CMarco was rise up a interesting question, that was &quot;In other words is possible to have the VLAN 4 in the wifi trunk and in other wifi in mode AP for client connections all under the same wifi-device with diferent SSID&#039;s.&quot;<br />Under the same Wifi-device i do not know, but under other wifi-device I&#039;m not seeing why not. In the veth0 that have all the vlan bridge (vlan 1,2,3,4) to wlan0 you do not do nothing, it stay like 3zl have descrive. What is new is that you have to put &quot;option type bridge&quot; under the config interface VLAN 4, that you mentioned, and bridge this interface vlan to the new wifi-iface under other wifi-device, for example wlan1. I Think in this way the traffic with vlan tag 4 will go througth the wifi trunk(wlan0) or for clients connected(wlan1) according to the mac address table.<br />I&#039;m guessing a little, 3zl what you think about this approach?</p><br /><p>I agree in some documentation maybe one on AWDS-L2 Mesh adhoc and other about wds. I think about mesh only exist this howto <a href="http://wiki.openwrt.org/inbox/mesh.olsr">http://wiki.openwrt.org/inbox/mesh.olsr</a>, a little poor, I think we can do better, and about wds only exists for broadcom a good example. I think is important to do one for mac80211 and atheros.</p><br /><p>Best Regards,<br />Craig Davids</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p154425">
				<div class="post-metadata">
					<div class="post-num">Post #25</div>
					<div class="post-author">dir2cas</div>
					<div class="post-datetime">
						16 Jan 2012, 22:45					</div>
				</div>
				<div class="post-content content">
					<p>Interesting topic. We discussed a similar concept before. <br /><a href="https://forum.openwrt.org/viewtopic.php?pid=135111#p135111">https://forum.openwrt.org/viewtopic.php … 11#p135111</a></p><p>As you gays probably know, IEEE 802.11 standard does not support Vlan trunking generically. Simply 802.11 data frame has no Vlan tag field and all you can do is to use a workaround solution as you are talking here - using the Vlan capabilities of the wired switched Ethernet infrastructure. <br />So generic L2 Vlan trunking is not possible, however the topic is really useful duscussing different manners to acheive something similar.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>