<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> TP-Link 1043nd slow WAN to /dev/null</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 20 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p135645">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">LaySoft</div>
					<div class="post-datetime">
						20 May 2011, 10:55					</div>
				</div>
				<div class="post-content content">
					<p>Hi!</p><p>I have a TP-Link 1043nd router, with OpenWrt 10.03.1rc4, but all 10.03 versions have the same issue. I make a speedtest script with curl, which downloads big files to /dev/null from a gigabit connected server on the internet:</p><p>curl -o /dev/null <a href="http://speedtest.szelessavkereso.hu/speedtest/random4000x4000.jpg">http://speedtest.szelessavkereso.hu/spe … 0x4000.jpg</a></p><p>My network speed is 120Mbit, and the computers connected to router&#039;s LAN ports, can be download with theese maximal speed. But the speedtest script only downloads max. 40Mbit speed. If i download big files from a local webserver, it goes with max. 100Mbit (local is only 100Mbit network.)</p><p>So the router can&#039;t download with maximal speed from WAN to /dev/null, but from LAN to /dev/null can download with maximal speed. What can be wrong?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p135650">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">Orca</div>
					<div class="post-datetime">
						20 May 2011, 11:36					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>LaySoft wrote:</cite><blockquote><p>on the internet:<br />curl -o /dev/null <a href="http://speedtest.szelessavkereso.hu/speedtest/random4000x4000.jpg">http://speedtest.szelessavkereso.hu/spe … 0x4000.jpg</a></p></blockquote></div><p>And, what does it say? After &quot;Deutschlands Blinde decken auf: Satanische Verse auf Raufasertapeten&quot; = &quot;&quot;Germany&#039;s blind discover: Satanic Verses on ingrain wall coverings&quot;</p><p>I am a bit afraid to ask, but my curiosity got the better of me once again.</p><div class="quotebox"><cite>LaySoft wrote:</cite><blockquote><p>My network speed is 120Mbit, and the computers connected to router&#039;s LAN ports, can be download with theese maximal speed. But the speedtest script only downloads max. 40Mbit speed. If i download big files from a local webserver, it goes with max. 100Mbit (local is only 100Mbit network.)</p><p>So the router can&#039;t download with maximal speed from WAN to /dev/null, but from LAN to /dev/null can download with maximal speed. What can be wrong?</p></blockquote></div><p>Do you use conntrack?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p135660">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">fyi</div>
					<div class="post-datetime">
						20 May 2011, 12:03					</div>
				</div>
				<div class="post-content content">
					<p>Try <a href="http://downloads.openwrt.org/snapshots/backfire/10.03.1-RC5-testing/">rc5</a>. I&#039;m not sure what&#039;s wrong. Just take a guess.</p><p><a href="https://forum.openwrt.org/viewtopic.php?pid=126410#p126410">OpenWrt / D-LINK DIR-825 B1: Good iperf results, poor throughput on internet</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p135662">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">LaySoft</div>
					<div class="post-datetime">
						20 May 2011, 12:18					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>fyi wrote:</cite><blockquote><p>Try <a href="http://downloads.openwrt.org/snapshots/backfire/10.03.1-RC5-testing/">rc5</a>. I&#039;m not sure what&#039;s wrong. Just take a guess.</p><p><a href="https://forum.openwrt.org/viewtopic.php?pid=126410#p126410">OpenWrt / D-LINK DIR-825 B1: Good iperf results, poor throughput on internet</a></p></blockquote></div><p>Thanks for your suggestion, i tried rc5, but nothing has changed.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p135666">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">vargalex</div>
					<div class="post-datetime">
						20 May 2011, 12:39					</div>
				</div>
				<div class="post-content content">
					<p>Hi!</p><p>What is the load of the router during this test?<br />Can you try it with wget?</p><p>vargalex<br /></p><div class="quotebox"><cite>LaySoft wrote:</cite><blockquote><p>Hi!</p><p>I have a TP-Link 1043nd router, with OpenWrt 10.03.1rc4, but all 10.03 versions have the same issue. I make a speedtest script with curl, which downloads big files to /dev/null from a gigabit connected server on the internet:</p><p>curl -o /dev/null <a href="http://speedtest.szelessavkereso.hu/speedtest/random4000x4000.jpg">http://speedtest.szelessavkereso.hu/spe … 0x4000.jpg</a></p><p>My network speed is 120Mbit, and the computers connected to router&#039;s LAN ports, can be download with theese maximal speed. But the speedtest script only downloads max. 40Mbit speed. If i download big files from a local webserver, it goes with max. 100Mbit (local is only 100Mbit network.)</p><p>So the router can&#039;t download with maximal speed from WAN to /dev/null, but from LAN to /dev/null can download with maximal speed. What can be wrong?</p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p135668">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">LaySoft</div>
					<div class="post-datetime">
						20 May 2011, 13:06					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>vargalex wrote:</cite><blockquote><p>Hi!</p><p>What is the load of the router during this test?<br />Can you try it with wget?</p><p>vargalex</p></blockquote></div><p>I tried with wget too, and the speed is the same. Meanwhile test, the top says curl or wget consumes approx. 40% cpu.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p135672">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">vargalex</div>
					<div class="post-datetime">
						20 May 2011, 14:51					</div>
				</div>
				<div class="post-content content">
					<p>Hi!</p><p>I have tested. I have on the WAN side an ftp server with 100 Mbps port. On the router:</p><div class="codebox"><pre><code>root@OpenWrt:~# ifconfig eth0.2 &amp;&amp; ifconfig br-lan
eth0.2    Link encap:Ethernet  HWaddr 00:16:E6:62:48:DC
          inet addr:172.16.0.228  Bcast:172.16.255.255  Mask:255.255.0.0
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:451820 errors:0 dropped:368 overruns:0 frame:0
          TX packets:284231 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:654586754 (624.2 MiB)  TX bytes:17024815 (16.2 MiB)

br-lan    Link encap:Ethernet  HWaddr 74:EA:3A:C2:57:7E
          inet addr:192.168.1.1  Bcast:192.168.1.255  Mask:255.255.255.0
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:4160 errors:0 dropped:0 overruns:0 frame:0
          TX packets:4270 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0
          RX bytes:640534 (625.5 KiB)  TX bytes:2022380 (1.9 MiB)

root@OpenWrt:~# date +%s &amp;&amp; wget ftp://172.16.13.31/test.img -O /dev/null &amp;&amp; date +%s
1305892031
Connecting to 172.16.13.31 (172.16.13.31:21)
null                 100% |************************************************************************************************************|   200M 00:00:00 ETA
1305892055
root@OpenWrt:~#</code></pre></div><p>The download of the 200 MB file took 24 seconds. 200 MB / 24 sec = 8.33 MB/s = 66.66 Mbps.</p><p>vargalex<br /></p><div class="quotebox"><cite>LaySoft wrote:</cite><blockquote><div class="quotebox"><cite>vargalex wrote:</cite><blockquote><p>Hi!</p><p>What is the load of the router during this test?<br />Can you try it with wget?</p><p>vargalex</p></blockquote></div><p>I tried with wget too, and the speed is the same. Meanwhile test, the top says curl or wget consumes approx. 40% cpu.</p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p135674">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">LaySoft</div>
					<div class="post-datetime">
						20 May 2011, 15:07					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>vargalex wrote:</cite><blockquote><p>root@OpenWrt:~# date +%s &amp;&amp; wget <a href="ftp://172.16.13.31/test.img">ftp://172.16.13.31/test.img</a> -O /dev/null &amp;&amp; date +%s<br />1305892031<br />Connecting to 172.16.13.31 (172.16.13.31:21)<br />null&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;100% |************************************************************************************************************|&nbsp; &nbsp;200M 00:00:00 ETA<br />1305892055<br />root@OpenWrt:~#<br />The download of the 200 MB file took 24 seconds. 200 MB / 24 sec = 8.33 MB/s = 66.66 Mbps.</p></blockquote></div><p>Interesting... Your router is TP-Link TL-WR1043ND? Which version of OpenWrt running on it? Can you test your exapmle with my server?</p><p>date +%s &amp;&amp; wget <a href="http://speedtest.szelessavkereso.hu/speedtest/random4000x4000.jpg">http://speedtest.szelessavkereso.hu/spe … 0x4000.jpg</a> -O /dev/null &amp;&amp; date +%s</p><p>Thank you!</p>											<p class="post-edited">(Last edited by <strong>LaySoft</strong> on 20 May 2011, 15:08)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p135678">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">samcrawford</div>
					<div class="post-datetime">
						20 May 2011, 16:26					</div>
				</div>
				<div class="post-content content">
					<p>Just to add something to this conversation: I have one of these devices and can hit 100 Mbps over the WAN port, but I&#039;ve disabled NAT, conntrack, iptables and loads of other modules I didn&#039;t require. I haven&#039;t tried the throughput on a stock build.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p135725">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">vargalex</div>
					<div class="post-datetime">
						21 May 2011, 13:15					</div>
				</div>
				<div class="post-content content">
					<p>Hi!</p><p>Yes, this is a TP-Link TL-WR1043ND v1.8 with an own OpenWrt build from trunk at April 2011.<br />I cannot test with your server, because I have only 30 Mbps internet access.</p><p>vargalex</p><div class="quotebox"><cite>LaySoft wrote:</cite><blockquote><div class="quotebox"><cite>vargalex wrote:</cite><blockquote><p>root@OpenWrt:~# date +%s &amp;&amp; wget <a href="ftp://172.16.13.31/test.img">ftp://172.16.13.31/test.img</a> -O /dev/null &amp;&amp; date +%s<br />1305892031<br />Connecting to 172.16.13.31 (172.16.13.31:21)<br />null&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;100% |************************************************************************************************************|&nbsp; &nbsp;200M 00:00:00 ETA<br />1305892055<br />root@OpenWrt:~#<br />The download of the 200 MB file took 24 seconds. 200 MB / 24 sec = 8.33 MB/s = 66.66 Mbps.</p></blockquote></div><p>Interesting... Your router is TP-Link TL-WR1043ND? Which version of OpenWrt running on it? Can you test your exapmle with my server?</p><p>date +%s &amp;&amp; wget <a href="http://speedtest.szelessavkereso.hu/speedtest/random4000x4000.jpg">http://speedtest.szelessavkereso.hu/spe … 0x4000.jpg</a> -O /dev/null &amp;&amp; date +%s</p><p>Thank you!</p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p136125">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">idrive</div>
					<div class="post-datetime">
						28 May 2011, 18:29					</div>
				</div>
				<div class="post-content content">
					<p>I have TP-Link TL-WR1043ND v1.0 and have flashed directly from the original TP Link firmware:<br /><a href="http://downloads.openwrt.org/backfire/10.03.1-rc4/ar71xx/openwrt-ar71xx-tl-wr1043nd-v1-squashfs-factory.bin">http://downloads.openwrt.org/backfire/1 … actory.bin</a></p><p>I have 120 Mbit/s cable internet access. After flashing Backfire 10.03.1-rc4 I can only download with about 60 Mbit/s, not faster. I have back to the original TP Link Firmware and have no limits anymore - for example 4x parallel downloads from <a href="http://www.debian.org">www.debian.org</a> gives me absolutely maximum 120 Mbit/s download performance.</p><p>So, I can confirm the issue that LaySoft have.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p136177">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">vargalex</div>
					<div class="post-datetime">
						29 May 2011, 23:45					</div>
				</div>
				<div class="post-content content">
					<p>Hi!</p><p>He have an another issue: &quot;<em>My network speed is 120Mbit, and the computers connected to router&#039;s LAN ports, can be download with theese maximal speed.</em>&quot;</p><p>So, on LAN side he have the maximal download speed.</p><div class="quotebox"><cite>idrive wrote:</cite><blockquote><p>I have TP-Link TL-WR1043ND v1.0 and have flashed directly from the original TP Link firmware:<br /><a href="http://downloads.openwrt.org/backfire/10.03.1-rc4/ar71xx/openwrt-ar71xx-tl-wr1043nd-v1-squashfs-factory.bin">http://downloads.openwrt.org/backfire/1 … actory.bin</a></p><p>I have 120 Mbit/s cable internet access. After flashing Backfire 10.03.1-rc4 I can only download with about 60 Mbit/s, not faster. I have back to the original TP Link Firmware and have no limits anymore - for example 4x parallel downloads from <a href="http://www.debian.org">www.debian.org</a> gives me absolutely maximum 120 Mbit/s download performance.</p><p>So, I can confirm the issue that LaySoft have.</p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p137213">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">ashrack</div>
					<div class="post-datetime">
						15 Jun 2011, 12:30					</div>
				</div>
				<div class="post-content content">
					<p>am getting the ruter next week. Will test it since I also have 100Mb/s connection.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>