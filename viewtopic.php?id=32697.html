<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> [TL-WR1043ND] - [OpenWRT Backfire 10.03.1-RC6] - can&#039;t mount USB</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 1 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p147183">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">kudlacz</div>
					<div class="post-datetime">
						1 Nov 2011, 00:42					</div>
				</div>
				<div class="post-content content">
					<p>I have a problem with mounting USB.</p><p>My FSTAB:<br /></p><div class="codebox"><pre><code>root@OpenWrt:~# uci show fstab
fstab.automount=global
fstab.automount.from_fstab=1
fstab.automount.anon_mount=1
fstab.autoswap=global
fstab.autoswap.from_fstab=1
fstab.autoswap.anon_swap=0
fstab.@swap[0]=swap
fstab.@swap[0].device=/dev/sda1
fstab.@swap[0].enabled=1
fstab.@swap[0].uuid=1d99bda5-0c3e-4887-855d-a80749ee6c91
fstab.@mount[0]=mount
fstab.@mount[0].device=/dev/sda2
fstab.@mount[0].target=/mnt/hdd
fstab.@mount[0].fstype=ext3
fstab.@mount[0].options=rw
fstab.@mount[0].enabled=1
fstab.@mount[0].is_rootfs=1
fstab.@mount[0].enabled_fsck=1
fstab.@mount[0].uuid=a0a4842a-3c2d-4d55-8547-5879964ec60f</code></pre></div><p>Installed packages:<br /></p><div class="codebox"><pre><code>root@OpenWrt:~# opkg list-installed
base-files - 43.29-r28646
block-extroot - 0.0.1-2.1
block-hotplug - 0.1.0-2.1
block-mount - 0.1.0-2.1
busybox - 1.15.3-3.1
chat - 2.4.4-16.1
comgt - 0.32-9
crda - 1.1.1-1
dnsmasq - 2.55-6
dropbear - 0.53.1-4
e2fsprogs - 1.41.11-1
fdisk - 2.13.0.1-4
firewall - 2-34.5
hotplug2 - 1.0-beta-3
iptables - 1.4.6-3.1
iptables-mod-conntrack - 1.4.6-3.1
iptables-mod-conntrack-extra - 1.4.6-3.1
iptables-mod-filter - 1.4.6-3.1
iptables-mod-imq - 1.4.6-3.1
iptables-mod-ipopt - 1.4.6-3.1
iptables-mod-nat - 1.4.6-3.1
iw - 0.9.22-2
kernel - 2.6.32.27-1
kmod-ath - 2.6.32.27+2011-09-14-1
kmod-ath9k - 2.6.32.27+2011-09-14-1
kmod-ath9k-common - 2.6.32.27+2011-09-14-1
kmod-button-hotplug - 2.6.32.27-1
kmod-cfg80211 - 2.6.32.27+2011-09-14-1
kmod-crc-ccitt - 2.6.32.27-1
kmod-crc16 - 2.6.32.27-1
kmod-crypto-aes - 2.6.32.27-1
kmod-crypto-arc4 - 2.6.32.27-1
kmod-crypto-core - 2.6.32.27-1
kmod-fs-cifs - 2.6.32.27-1
kmod-fs-ext4 - 2.6.32.27-1
kmod-fs-mbcache - 2.6.32.27-1
kmod-fs-vfat - 2.6.32.27-1
kmod-fuse - 2.6.32.27-1
kmod-i2c-core - 2.6.32.27-1
kmod-i2c-gpio-custom - 2.6.32.27-2
kmod-input-core - 2.6.32.27-1
kmod-input-gpio-buttons - 2.6.32.27-1
kmod-input-polldev - 2.6.32.27-1
kmod-ipt-conntrack - 2.6.32.27-1
kmod-ipt-conntrack-extra - 2.6.32.27-1
kmod-ipt-core - 2.6.32.27-1
kmod-ipt-filter - 2.6.32.27-1
kmod-ipt-imq - 2.6.32.27-1
kmod-ipt-ipopt - 2.6.32.27-1
kmod-ipt-nat - 2.6.32.27-1
kmod-ipt-nathelper - 2.6.32.27-1
kmod-leds-gpio - 2.6.32.27-1
kmod-ledtrig-usbdev - 2.6.32.27-1
kmod-mac80211 - 2.6.32.27+2011-09-14-1
kmod-nls-base - 2.6.32.27-1
kmod-nls-cp1250 - 2.6.32.27-1
kmod-nls-cp1251 - 2.6.32.27-1
kmod-nls-cp437 - 2.6.32.27-1
kmod-nls-cp850 - 2.6.32.27-1
kmod-nls-cp852 - 2.6.32.27-1
kmod-nls-iso8859-1 - 2.6.32.27-1
kmod-nls-iso8859-13 - 2.6.32.27-1
kmod-nls-iso8859-15 - 2.6.32.27-1
kmod-nls-iso8859-2 - 2.6.32.27-1
kmod-nls-utf8 - 2.6.32.27-1
kmod-ppp - 2.6.32.27-1
kmod-pppoe - 2.6.32.27-1
kmod-sched - 2.6.32.27-1
kmod-scsi-core - 2.6.32.27-1
kmod-textsearch - 2.6.32.27-1
kmod-tun - 2.6.32.27-1
kmod-usb-core - 2.6.32.27-1
kmod-usb-ohci - 2.6.32.27-1
kmod-usb-serial - 2.6.32.27-1
kmod-usb-serial-option - 2.6.32.27-1
kmod-usb-serial-sierrawireless - 2.6.32.27-1
kmod-usb-storage - 2.6.32.27-1
kmod-usb2 - 2.6.32.27-1
libblkid - 1.41.11-1
libc - 0.9.30.1-43.29
libext2fs - 1.41.11-1
libgcc - 4.3.3+cs-43.29
libip4tc - 1.4.6-3.1
libiwinfo - 16
liblua - 5.1.4-7
libncurses - 5.7-2
libnl-tiny - 0.1-1
libpthread - 0.9.30.1-43.29
librt - 0.9.30.1-43.29
libuci - 12012009.6-4
libuci-lua - 12012009.6-4
libusb - 0.1.12-2
libuuid - 1.41.11-1
libxtables - 1.4.6-3.1
lua - 5.1.4-7
luci - 0.10+svn7810-1
luci-app-firewall - 0.10+svn7810-1
luci-app-ntpc - 0.10+svn7810-1
luci-app-qos - 0.10+svn7810-1
luci-app-samba - 0.10+svn7810-1
luci-i18n-english - 0.10+svn7810-1
luci-lib-core - 0.10+svn7810-1
luci-lib-ipkg - 0.10+svn7810-1
luci-lib-lmo - 0.10+svn7810-1
luci-lib-nixio - 0.10+svn7810-1
luci-lib-sys - 0.10+svn7810-1
luci-lib-web - 0.10+svn7810-1
luci-mod-admin-core - 0.10+svn7810-1
luci-mod-admin-full - 0.10+svn7810-1
luci-proto-core - 0.10+svn7810-1
luci-proto-ppp - 0.10+svn7810-1
luci-sgi-cgi - 0.10+svn7810-1
luci-theme-base - 0.10+svn7810-1
luci-theme-openwrt - 0.10+svn7810-1
mtd - 13
nano - 2.2.6-1
ntfs-3g - 2011.4.12-1-fuseint
ntpclient - 2007_365-4
opkg - 576-2
ppp - 2.4.4-16.1
ppp-mod-pppoe - 2.4.4-16.1
qos-scripts - 1.2.1-3
samba3 - 3.0.24-8
swconfig - 9
tc - 2.6.29-1-2
uci - 12012009.6-4
udevtrigger - 106-1
uhttpd - 23.3
usb-modeswitch - 1.1.8-1
usb-modeswitch-data - 20110705-1
wireless-tools - 29-4
wpad-mini - 20110527-1</code></pre></div><p>List the partition tables on my usb<br /></p><div class="codebox"><pre><code>root@OpenWrt:~# fdisk -l

Disk /dev/sda: 8127 MB, 8127512576 bytes
251 heads, 62 sectors/track, 1020 cylinders
Units = cylinders of 15562 * 512 = 7967744 bytes
Disk identifier: 0xe552d01f

   Device Boot      Start         End      Blocks   Id  System
/dev/sda1               1           9       69998   82  Linux swap / Solaris
/dev/sda2              10         139     1011530   83  Linux
/dev/sda3             140        1020     6855061    b  W95 FAT32</code></pre></div><p><strong>and my USB doesn&#039;t mount</strong></p><div class="codebox"><pre><code>root@OpenWrt:~# df -h
Filesystem                Size      Used Available Use% Mounted on
/dev/root                 3.5M      3.5M         0 100% /rom
tmpfs                    14.4M    264.0K     14.1M   2% /tmp
tmpfs                   512.0K         0    512.0K   0% /dev
/dev/mtdblock3            3.1M    296.0K      2.8M   9% /overlay
mini_fo:/overlay          3.5M      3.5M         0 100% /

root@OpenWrt:~# mount
rootfs on / type rootfs (rw)
/dev/root on /rom type squashfs (ro,relatime)
proc on /proc type proc (rw,relatime)
sysfs on /sys type sysfs (rw,relatime)
tmpfs on /tmp type tmpfs (rw,nosuid,nodev,relatime)
tmpfs on /dev type tmpfs (rw,relatime,size=512k,mode=755)
devpts on /dev/pts type devpts (rw,relatime,mode=600)
/dev/mtdblock3 on /overlay type jffs2 (rw,relatime)
mini_fo:/overlay on / type mini_fo (rw,relatime)
debugfs on /sys/kernel/debug type debugfs (rw,relatime)
none on /proc/bus/usb type usbfs (rw,relatime)</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p147184">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						1 Nov 2011, 04:14					</div>
				</div>
				<div class="post-content content">
					<p>Remove the target option. Did you install block-hotplug, block-mount as well? Whats in dmesg?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p147192">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">kudlacz</div>
					<div class="post-datetime">
						1 Nov 2011, 09:23					</div>
				</div>
				<div class="post-content content">
					<p>Removed target option<br /></p><div class="codebox"><pre><code>root@OpenWrt:/# uci show fstab
fstab.automount=global
fstab.automount.from_fstab=1
fstab.automount.anon_mount=1
fstab.autoswap=global
fstab.autoswap.from_fstab=1
fstab.autoswap.anon_swap=0
fstab.@swap[0]=swap
fstab.@swap[0].device=/dev/sda1
fstab.@swap[0].enabled=1
fstab.@swap[0].uuid=1d99bda5-0c3e-4887-855d-a80749ee6c91
fstab.@mount[0]=mount
fstab.@mount[0].device=/dev/sda2
fstab.@mount[0].fstype=ext3
fstab.@mount[0].options=rw
fstab.@mount[0].enabled=1
fstab.@mount[0].is_rootfs=0
fstab.@mount[0].enabled_fsck=1
fstab.@mount[0].uuid=a0a4842a-3c2d-4d55-8547-5879964ec60f</code></pre></div><p>Dmesg shows:<br /></p><div class="codebox"><pre><code>[...]
usb-storage: device scan complete
sd 0:0:0:0: [sda] 15874048 512-byte logical blocks: (8.12 GB/7.56 GiB)
sd 0:0:0:0: [sda] Write Protect is off
sd 0:0:0:0: [sda] Mode Sense: 23 00 00 00
sd 0:0:0:0: [sda] Assuming drive cache: write through
sd 0:0:0:0: [sda] Assuming drive cache: write through
 sda: sda1 sda2 sda3
sd 0:0:0:0: [sda] Assuming drive cache: write through
sd 0:0:0:0: [sda] Attached SCSI removable disk
[...]</code></pre></div><p>/etc/fstab<br /></p><div class="codebox"><pre><code># WARNING: this is an auto generated file, please use uci to set defined filesystems
/dev/sda1       none    swap    sw      0       0</code></pre></div><p>/etc/init.d/fstab<br /></p><div class="codebox"><pre><code>#!/bin/sh /etc/rc.common                                                                                                             
# Copyright (C) 2007 OpenWrt.org                                                                                                     
# Copyright (C) 2010 Vertical Communications                                                                                         
# This is free software, licensed under the GNU General Public License v2.                                                           
# See /LICENSE for more information.                                                                                                 
#                                                                                                                                    
                                                                                                                                     
                                                                                                                                     
START=20                                                                                                                             
                                                                                                                                     
do_mount() {                                                                                                                         
        local cfg=&quot;$1&quot;                                                                                                               
        config_mount_by_section &quot;$cfg&quot;                                                                                               
}                                                                                                                                    
                                                                                                                                     
do_swapon() {                                                                                                                        
        local cfg=&quot;$1&quot;                                                                                                               
        config_swapon_by_section &quot;$cfg&quot;                                                                                              
}                                                                                                                                    
                                                                                                                                     
do_unmount() {                                                                                                                       
        local cfg=&quot;$1&quot;                                                                                                               
                                                                                                                                     
        config_get target &quot;$cfg&quot; target                                                                                              
        config_get_bool enabled &quot;$cfg&quot; &quot;enabled&quot; &#039;1&#039;                                                                                 
        [ -n &quot;$target&quot; -a &quot;$enabled&quot; -gt 0 ] || return 0                                                                             
        umount $target                                                                                                               
}                                                                                                                                    
                                                                                                                                     
do_swapoff() {                                                                                                                       
        local cfg=&quot;$1&quot;                                                                                                               
                                                                                                                                     
        config_get device &quot;$cfg&quot; device                                                                                              
        config_get_bool enabled &quot;$cfg&quot; &quot;enabled&quot; &#039;1&#039;                                                                                 
        [ -n &quot;$device&quot; -a  &quot;$enabled&quot; -gt 0 ] &amp;&amp; type swapoff &gt;/dev/null || return 0                                                 
        swapoff $device                                                                                                              
}

                                                                                                                                     
start() {                                                                                                                            
        . /lib/functions/mount.sh                                                                                                    
                                                                                                                                     
        config_load fstab                                                                                                            
        mkdir -p /var/lock                                                                                                           
        lock /var/lock/fstab.lck                                                                                                     
        [ -e /tmp/fstab ] || {                                                                                                       
                echo &#039;# WARNING: this is an auto generated file, please use uci to set defined filesystems&#039; &gt; /tmp/fstab             
        }                                                                                                                            
        lock -u /var/lock/fstab.lck                                                                                                  
        config_foreach do_swapon swap                                                                                                
        config_foreach do_mount mount                                                                                                
        config_foreach do_swapon swap  # do swap a second time so that swap on filesystems is enabled                                
}                                                                                                                                    
                                                                                                                                     
stop() {                                                                                                                             
        . /lib/functions/mount.sh                                                                                                    
                                                                                                                                     
        config_load fstab                                                                                                            
        config_foreach do_unmount mount                                                                                              
        config_foreach do_swapoff swap                                                                                               
        swapoff -a                                                                                                                   
}</code></pre></div>											<p class="post-edited">(Last edited by <strong>kudlacz</strong> on 1 Nov 2011, 09:35)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p147206">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">hubrat</div>
					<div class="post-datetime">
						1 Nov 2011, 12:43					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>I&#039;ve just setup usb on RC6. fstab wouldn&#039;t mount the drives for me but I could mount them manually. The interesting thing was that mount showed them as ext4 when they are formatted as ext3. Supposedly the kmod-fs-ext4 package supports ext3 filesystems but it wasn&#039;t in my case.</p><p>My solution was to install the kmod-fs-ext3 package as well and on the next boot fstab mounted all my drives correctly.</p><p>Hope this helps.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p147207">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">kudlacz</div>
					<div class="post-datetime">
						1 Nov 2011, 13:25					</div>
				</div>
				<div class="post-content content">
					<p>I installed kmod-fs-ext3 and now <strong>DMESG</strong> shows:<br /></p><div class="codebox"><pre><code>root@OpenWrt:/# dmesg
[...]
usb-storage: device scan complete
sd 0:0:0:0: [sda] 15874048 512-byte logical blocks: (8.12 GB/7.56 GiB)
sd 0:0:0:0: [sda] Write Protect is off
sd 0:0:0:0: [sda] Mode Sense: 23 00 00 00
sd 0:0:0:0: [sda] Assuming drive cache: write through
sd 0:0:0:0: [sda] Assuming drive cache: write through
 sda: sda1 sda2 sda3
sd 0:0:0:0: [sda] Assuming drive cache: write through
sd 0:0:0:0: [sda] Attached SCSI removable disk
[...]
i2c-gpio: probe of i2c-gpio.0 failed with error -16
Adding 69988k swap on /dev/sda1.  Priority:-1 extents:1 across:69988k 
EXT3-fs: invalid journal inode.
------------[ cut here ]------------
WARNING: at fs/inode.c:1265 0x800ee334()
[...]
WARNING: at fs/inode.c:1270 0x800ee36c()
[...]
WARNING: at fs/inode.c:1277 0x800ee408()
[...]</code></pre></div><p>And fstab:<br /></p><div class="codebox"><pre><code>root@OpenWrt:/# /etc/init.d/fstab restart
swapoff: /dev/sda1: Invalid argument
mkdir: cannot create directory &#039;&#039;: No such file or directory</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p147211">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						1 Nov 2011, 14:29					</div>
				</div>
				<div class="post-content content">
					<p>I assumed you wanted an external overlay because is_rootfs was 1 in your initial post. For a normal mount set it to 0 and re-add the target option.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>