<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Create VPN specific WIFI network</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 22 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p359227">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">razorhazor</div>
					<div class="post-datetime">
						28 May 2017, 21:22					</div>
				</div>
				<div class="post-content content">
					<p>Hi</p><p>I have a working OpenVPN connection configured with OpenWrt and I would like to only route traffic from a new WIFI SSID through the VPN tunnel and to have all traffic originating from the LAN and existing WIFI SSIDs routed through the already configured WAN network.</p><p>Is anyone able to help me understand how to write the FW rules?</p><p>I can see alot of guides showing how to route all wan traffic through the VPN tunnel, however I just want to selectively route traffic from one particular WIFI SSID and I can&#039;t get my head around how to do it!</p><p>Thanks<br />razorhazor</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p359229">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">mikma</div>
					<div class="post-datetime">
						28 May 2017, 22:22					</div>
				</div>
				<div class="post-content content">
					<p>Using VPN as an alternative to the WAN makes it a dual WAN setup, and you may want to have a look at mwan3.</p><p>But mwan3 may not be necessary since openwrt supports IP rules. I currently use neither mwan3 or plain IP rules, but I know it&#039;s easy to lock you out&nbsp; with IP rules requiring a restart in failsafe mode. Therefore make sure that failsafe mode is working and that you have a backup of the config.</p><p><a href="https://wiki.openwrt.org/doc/uci/network#ip_rules">https://wiki.openwrt.org/doc/uci/network#ip_rules</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p359314">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">golialive</div>
					<div class="post-datetime">
						29 May 2017, 13:11					</div>
				</div>
				<div class="post-content content">
					<p>Hey there.</p><p>I don&#039;t think &quot;multiwan&quot; is the path you want to follow, since you don&#039;t want to pass &quot;general traffic&quot; (originating from any device of your network and maybe even the router itself) through the VPN tunnel and apply failover of load balancing to it. Unless you want to do something in that area, multiwan is just to huge of a monster to configure.</p><p>But &quot;ip rules&quot; using a secondary routing table is the way to go, just as mikma suggested.</p><p><a href="https://forum.openwrt.org/viewtopic.php?pid=244242#p244242">https://forum.openwrt.org/viewtopic.php â€¦ 42#p244242</a><br />That&#039;s what I did a couple of years ago. My example doesn&#039;t create a secondary wifi for VPN traffic but only forces a single IP (that I configured statically in my DHCP server) of my default range. But it&#039;s enough for an example. Of course it&#039;s perfectly fine for you to set up a dedicated VLAN with its own IP range and a distinct wifi SSID on top of that.</p><p>The first code section (dealing with &quot;ip route&quot; and &quot;ip rule&quot;) is necessarily created on a command line level (startup script). At least I don&#039;t know about a UCI way of doing this.</p><p>The second code section (with the &quot;iptables&quot;) is pretty much the same as the link mikma gave you. So you can skip the command line section and add it to UCI instead, just as the link tells you.</p><p>Regards,<br />Stephan.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>