<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> openvpn-client: no tun0-device</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 5 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p79675">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">whotwagner</div>
					<div class="post-datetime">
						15 Jan 2009, 19:45					</div>
				</div>
				<div class="post-content content">
					<p>Hello,<br />i am not able to configure a openvpn-connection using kamikaze 8.09_RC1(openwrt-wrt54gs-squashfs). i want to conifgure a certificate-based net-net-vpn, but after &quot;initialization sequence&quot;&nbsp; there is no tun-device on the wrt-router.</p><p>logread says:<br />Jan 15 18:35:21 OpenWrt daemon.warn openvpn(sample_client)[12139]: WARNING: &#039;mtu-dynamic&#039; is present in remote config but missing in local config, remote=&#039;mtu-dynamic&#039;<br />Jan 15 18:35:21 OpenWrt daemon.notice openvpn(sample_client)[12139]: Data Channel Encrypt: Cipher &#039;BF-CBC&#039; initialized with 128 bit key<br />Jan 15 18:35:21 OpenWrt daemon.notice openvpn(sample_client)[12139]: Data Channel Encrypt: Using 160 bit message hash &#039;SHA1&#039; for HMAC authentication<br />Jan 15 18:35:21 OpenWrt daemon.notice openvpn(sample_client)[12139]: Data Channel Decrypt: Cipher &#039;BF-CBC&#039; initialized with 128 bit key<br />Jan 15 18:35:21 OpenWrt daemon.notice openvpn(sample_client)[12139]: Data Channel Decrypt: Using 160 bit message hash &#039;SHA1&#039; for HMAC authentication<br />Jan 15 18:35:21 OpenWrt daemon.notice openvpn(sample_client)[12139]: Control Channel: TLSv1, cipher TLSv1/SSLv3 DHE-RSA-AES256-SHA, 2048 bit RSA<br />Jan 15 18:35:21 OpenWrt daemon.notice openvpn(sample_client)[12139]: [mail.may.co.at] Peer Connection Initiated with 212.41.224.249:11196<br />Jan 15 18:35:22 OpenWrt daemon.notice openvpn(sample_client)[12139]: SENT CONTROL [mail.may.co.at]: &#039;PUSH_REQUEST&#039; (status=1)<br />Jan 15 18:35:22 OpenWrt daemon.notice openvpn(sample_client)[12139]: PUSH: Received control message: &#039;PUSH_REPLY&#039;<br />Jan 15 18:35:22 OpenWrt daemon.notice openvpn(sample_client)[12139]: Preserving previous TUN/TAP instance: tun0<br />Jan 15 18:35:22 OpenWrt daemon.notice openvpn(sample_client)[12139]: NOTE: Pulled options changed on restart, will need to close and reopen TUN/TAP device.<br />Jan 15 18:35:22 OpenWrt daemon.notice openvpn(sample_client)[12139]: Closing TUN/TAP interface<br />Jan 15 18:35:23 OpenWrt daemon.notice openvpn(sample_client)[12139]: TUN/TAP device tun0 opened<br />Jan 15 18:35:23 OpenWrt daemon.notice openvpn(sample_client)[12139]: Initialization Sequence Completed<br />Jan 15 18:35:33 OpenWrt daemon.err openvpn(sample_client)[12139]: Authenticate/Decrypt packet error: cipher final failed<br />Jan 15 18:35:43 OpenWrt daemon.err openvpn(sample_client)[12139]: Authenticate/Decrypt packet error: cipher final failed</p><br /><p>could anyone give me a hint?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p79707">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">whotwagner</div>
					<div class="post-datetime">
						16 Jan 2009, 16:10					</div>
				</div>
				<div class="post-content content">
					<p>Ok, the problem was that i configured --cipher on the server but not at the openvpn-client on the wrt.</p><p>Now the connection seems to be up and running, but the tun0 interface is not up. ifconfig shows no tun0 but ifconfig -a <br />when i ping from server-side i could sniff the packets at tun0 but on the client-side(openwrt) there is no tun0 and the packets get lost.</p><p>logread tells no problem. does anyone know what&#039;s wrong? does openvpn work as client on kamikaze 8.09, r13118?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p79709">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						16 Jan 2009, 16:28					</div>
				</div>
				<div class="post-content content">
					<p>Yes it does work. Maybe the ip config for the tun0 is missing? Perhaps you need an up script or push the ifconfig options from the vpn server.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p79720">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">xj25vm</div>
					<div class="post-datetime">
						16 Jan 2009, 18:37					</div>
				</div>
				<div class="post-content content">
					<p>Hello there,</p><p>I&#039;m not sure if it helps - but on &#039;normal&#039; Linux servers and desktops, when I get this error message it is because I don&#039;t have the tun module loaded. If I do:</p><p>#modprobe tun</p><p>the problem is usually solved. You might have to type:</p><p>#insmod tun</p><p>as I&#039;m not sure if OpenWRT comes with modprobe. If it fixes the problem, you can add this line somewhere in the startup scrips - not sure if there is a dedicated script in OpenWRT for loading modules.</p><p>EDIT: If this doesn&#039;t help, could you please post the server and client config files for OpenVPN. I suppose this might not be an OpenWRT specific problem - but maybe there is something obviously out of place in them.</p>											<p class="post-edited">(Last edited by <strong>xj25vm</strong> on 16 Jan 2009, 18:42)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p79736">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">whotwagner</div>
					<div class="post-datetime">
						16 Jan 2009, 22:27					</div>
				</div>
				<div class="post-content content">
					<p>the tun-module is loaded, otherwise &quot;ifconfig -a&quot; would not show it. <br />thank you jow for your hint. when i manually configure the tun0 interface it works. but i do not know how to configure it on a openwrt-router. how could i implement an ip-up-script and how could i integrate it into the firewalling?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p79737">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						16 Jan 2009, 22:31					</div>
				</div>
				<div class="post-content content">
					<p>The openvpn config has a &quot;up&quot; option, sth. like that:<br />up /etc/openvpn/setup-tun.sh</p><p>OpenVPN will try to execute that script after the connection was initialized. It passes relevant values as arguments and environment variables to the script.<br />You should implement the nescessary ifconfig and iptables setup stuff there. For further information refer to the OpenVPN manual:<br /><a href="http://openvpn.net/index.php/documentation/manuals/openvpn-20x-manpage.html">http://openvpn.net/index.php/documentat â€¦ npage.html</a> and search for &quot;--up cmd&quot;.</p><p>~ JoW</p>											<p class="post-edited">(Last edited by <strong>jow</strong> on 16 Jan 2009, 22:31)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p79740">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">whotwagner</div>
					<div class="post-datetime">
						16 Jan 2009, 23:03					</div>
				</div>
				<div class="post-content content">
					<p>i just added 2 options in /etc/config/openvpn for interface-configuration:<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifconfig &quot;10.10.111.2 10.10.111.1&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; option route &quot;172.17.0.0 255.255.255.0 10.10.111.1&quot;</p><p>is there a &quot;openwrt kamikaze&quot;-way of configuring the firewall for openvpn? i mean, there is the /etc/config/firewall-file, so i guess there could be another way beside the use of a up-script with iptables-rules.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p79741">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						16 Jan 2009, 23:11					</div>
				</div>
				<div class="post-content content">
					<p>Yes, the kamikaze way would be sth. like that:<br />Create a new interface section in /etc/config/network:<br /></p><div class="codebox"><pre><code>config interface vpn
  option ifname tun0
  option proto none</code></pre></div><p>Then add a new zone to the firewall config:<br /></p><div class="codebox"><pre><code>config &#039;zone&#039;
    option &#039;name&#039; &#039;vpn&#039;
    option &#039;input&#039; &#039;ACCEPT&#039;
    option &#039;output&#039; &#039;ACCEPT&#039;
    option &#039;forward&#039; &#039;ACCEPT&#039;</code></pre></div><p>And allow passing traffic to it:<br /></p><div class="codebox"><pre><code>config &#039;forwarding&#039;
    option &#039;src&#039; &#039;lan&#039;
    option &#039;dest&#039; &#039;vpn&#039;</code></pre></div><p>Finally you need to trigger the whole hotplug2 business in your vpn script to trigger firewall reconfiguration when vpn goes live:<br /></p><div class="codebox"><pre><code>ACTION=&quot;ifup&quot; INTERFACE=&quot;vpn&quot; . /etc/hotplug.d/iface/20-firewall</code></pre></div><p>The steps above are written from my memories, I haven&#039;t actually tested them.</p><p>~ JoW</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p79743">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">whotwagner</div>
					<div class="post-datetime">
						16 Jan 2009, 23:26					</div>
				</div>
				<div class="post-content content">
					<p>i did the settings in /etc/openvpn/firewall but when i try to hotplug the interface i&#039;ll get the following error:</p><p>root@OpenWrt:/etc/config# ACTION=&quot;ifup&quot; INTERFACE=&quot;vpn&quot; . /etc/hotplug.d/iface/20-firewall</p><p>iptables v1.3.8: Couldn&#039;t load target `zone_&#039;:File not found</p><p>Try `iptables -h&#039; or &#039;iptables --help&#039; for more information.<br />iptables: No chain/target/match by that name<br />iptables: No chain/target/match by that name<br />iptables: No chain/target/match by that name<br />iptables: No chain/target/match by that name<br />iptables: No chain/target/match by that name<br />iptables: No chain/target/match by that name<br />iptables: No chain/target/match by that name<br />iptables v1.3.8: Couldn&#039;t load target `zone__prerouting&#039;:File not found</p><p>Try `iptables -h&#039; or &#039;iptables --help&#039; for more information.<br />iptables v1.3.8: Couldn&#039;t load target `zone__forward&#039;:File not found</p><p>Try `iptables -h&#039; or &#039;iptables --help&#039; for more information.</p><br /><br /><p>then i tried:</p><p>root@OpenWrt:/etc/config# ACTION=&quot;ifup&quot; INTERFACE=&quot;tun0&quot; ZONE=&quot;vpn&quot; . /etc/hotplug.d/iface/20-firewall</p><p>iptables v1.3.8: Couldn&#039;t load target `zone_&#039;:File not found</p><p>Try `iptables -h&#039; or &#039;iptables --help&#039; for more information.<br />iptables: No chain/target/match by that name<br />iptables: No chain/target/match by that name<br />iptables: No chain/target/match by that name<br />iptables: No chain/target/match by that name<br />iptables: No chain/target/match by that name<br />iptables: No chain/target/match by that name<br />iptables: No chain/target/match by that name<br />iptables v1.3.8: Couldn&#039;t load target `zone__prerouting&#039;:File not found</p><p>Try `iptables -h&#039; or &#039;iptables --help&#039; for more information.<br />iptables v1.3.8: Couldn&#039;t load target `zone__forward&#039;:File not found</p><p>Try `iptables -h&#039; or &#039;iptables --help&#039; for more information.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p79761">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						17 Jan 2009, 11:34					</div>
				</div>
				<div class="post-content content">
					<p>Can you post the output of:<br /></p><div class="codebox"><pre><code>uci show network; uci show firewall</code></pre></div><p>?</p><p>Edit:<br />... and can you try this too after OpenVPN was started:<br /></p><div class="codebox"><pre><code>ifup vpn</code></pre></div><p>Check with logread whether the firewall has added tun0 to the rules.</p><p>~ JoW</p>											<p class="post-edited">(Last edited by <strong>jow</strong> on 17 Jan 2009, 11:36)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p79780">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">whotwagner</div>
					<div class="post-datetime">
						17 Jan 2009, 18:44					</div>
				</div>
				<div class="post-content content">
					<p>root@OpenWrt:~# uci show network<br />network.eth0=switch<br />network.eth0.vlan0=1 2 3 4 5*<br />network.eth0.vlan1=0 5<br />network.loopback=interface<br />network.loopback.ifname=lo<br />network.loopback.proto=static<br />network.loopback.ipaddr=127.0.0.1<br />network.loopback.netmask=255.0.0.0<br />network.lan=interface<br />network.lan.type=bridge<br />network.lan.ifname=eth0.0<br />network.lan.proto=static<br />network.lan.ipaddr=172.30.32.1<br />network.lan.netmask=255.255.255.0<br />network.wan=interface<br />network.wan.ifname=eth0.1<br />network.wan.proto=static<br />network.wan.ipaddr=&lt;my-ip&gt;<br />network.wan.netmask=255.255.255.248<br />network.wan.gateway=&lt;my-gateway&gt;<br />network.wan.dns=&lt;my-dns-server&gt;</p><br /><p>root@OpenWrt:~# uci show firewall<br />firewall.cfg02f50e=defaults<br />firewall.cfg02f50e.syn_flood=1<br />firewall.cfg02f50e.input=ACCEPT<br />firewall.cfg02f50e.output=ACCEPT<br />firewall.cfg02f50e.forward=REJECT<br />firewall.cfg04e8f0=zone<br />firewall.cfg04e8f0.name=lan<br />firewall.cfg04e8f0.input=ACCEPT<br />firewall.cfg04e8f0.output=ACCEPT<br />firewall.cfg04e8f0.forward=REJECT<br />firewall.cfg06a32b=zone<br />firewall.cfg06a32b.name=wan<br />firewall.cfg06a32b.input=REJECT<br />firewall.cfg06a32b.output=ACCEPT<br />firewall.cfg06a32b.forward=REJECT<br />firewall.cfg06a32b.masq=1<br />firewall.cfg08953c=zone<br />firewall.cfg08953c.name=vpn<br />firewall.cfg08953c.input=ACCEPT<br />firewall.cfg08953c.output=ACCEPT<br />firewall.cfg08953c.forward=ACCEPT<br />firewall.cfg0a783f=forwarding<br />firewall.cfg0a783f.src=lan<br />firewall.cfg0a783f.dest=vpn<br />firewall.cfg0c7a91=forwarding<br />firewall.cfg0c7a91.src=lan<br />firewall.cfg0c7a91.dest=wan<br />firewall.cfg0e961f=forwarding<br />firewall.cfg0e961f.src=vpn<br />firewall.cfg0e961f.dest=lan<br />firewall.cfg1074d6=rule<br />firewall.cfg1074d6.src=wan<br />firewall.cfg1074d6.src_ip=&lt;my-other-net&gt;<br />firewall.cfg1074d6.dest_port=22<br />firewall.cfg1074d6.proto=tcp<br />firewall.cfg1074d6.target=ACCEPT<br />firewall.cfg127409=rule<br />firewall.cfg127409.src=wan<br />firewall.cfg127409.src_ip=&lt;my-other-host2&gt;<br />firewall.cfg127409.dest_port=22<br />firewall.cfg127409.proto=tcp<br />firewall.cfg127409.target=ACCEPT<br />firewall.cfg140ad6=rule<br />firewall.cfg140ad6.src=wan<br />firewall.cfg140ad6.src_ip=&lt;my-other-host&gt;<br />firewall.cfg140ad6.target=ACCEPT<br />firewall.cfg165580=rule<br />firewall.cfg165580.src=wan<br />firewall.cfg165580.src_ip=&lt;my-other-host&gt;<br />firewall.cfg165580.proto=ICMP<br />firewall.cfg165580.target=ACCEPT</p><br /><p>root@OpenWrt:~# ifup vpn<br />interface not found.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p79786">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">xj25vm</div>
					<div class="post-datetime">
						17 Jan 2009, 20:05					</div>
				</div>
				<div class="post-content content">
					<p>Hello,</p><p>Could I butt in with a suggestion. Has it been confirmed that OpenVPN works ok on your box without the firewall? If not, could you temporarily disable the firewall, and test to make sure that everything is ok on OpenVPN&#039;s side of things and there is definitely no problem there - just to narrow the problem down.</p><p>If you already checked that, please ignore my comments. I will crawl back to my corner <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /></p><p>It&#039;s just that I&#039;ve had openvpn working on an NSLU2 with Kamikaze 7.09 few weeks ago - with no fireawall on the slug (as it was behind a router with port redirection) - and don&#039;t remember having to deal with any of these.</p>											<p class="post-edited">(Last edited by <strong>xj25vm</strong> on 17 Jan 2009, 20:07)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p79816">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">whotwagner</div>
					<div class="post-datetime">
						18 Jan 2009, 12:24					</div>
				</div>
				<div class="post-content content">
					<p>i would not be able to see any packets on tun0 with tcpdump if the tunnel would not work. I am quite sure that i just have to configure the firewall on the openwrt router.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p79820">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">xj25vm</div>
					<div class="post-datetime">
						18 Jan 2009, 13:39					</div>
				</div>
				<div class="post-content content">
					<p>What port are you using for OpenVPN? On udp or tcp? I&#039;m not sure - but can&#039;t seem to spot a rule in the firewall for allowing incoming packets on the OpenVPN port on the wan side of things.</p><p>Or is that the rule before last one, which seems to accept all packets from your other host?</p>											<p class="post-edited">(Last edited by <strong>xj25vm</strong> on 18 Jan 2009, 13:45)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p79825">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						18 Jan 2009, 14:10					</div>
				</div>
				<div class="post-content content">
					<p>Hi.</p><p>whotwagner, you forgot to add the vpn interface to your network config:<br /></p><div class="codebox"><pre><code>config interface vpn
  option ifname tun0
  option proto none</code></pre></div><p>Thats the reason why ifup vpn and the hotplug stuff is not working.</p><p>~ JoW</p>											<p class="post-edited">(Last edited by <strong>jow</strong> on 18 Jan 2009, 16:20)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p79830">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">whotwagner</div>
					<div class="post-datetime">
						18 Jan 2009, 16:09					</div>
				</div>
				<div class="post-content content">
					<p>Now it works. Thank you for your support :-D</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p217340">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">valentt</div>
					<div class="post-datetime">
						12 Nov 2013, 11:40					</div>
				</div>
				<div class="post-content content">
					<p>Hi, I&#039;m having this same issue. I don&#039;t have tun0 interface after starting openvpn as client.<br />I have added tun0 to my network config file and to firewall config file:</p><p># cat /etc/config/network </p><p>config interface &#039;loopback&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname &#039;lo&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;static&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr &#039;127.0.0.1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask &#039;255.0.0.0&#039;</p><p>config interface &#039;lan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname &#039;eth1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option type &#039;bridge&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;static&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr &#039;192.168.1.1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask &#039;255.255.255.0&#039;</p><p>config interface &#039;wan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname &#039;eth0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;dhcp&#039;</p><p>config interface &#039;vpn&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;none&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname &#039;tun0&#039;</p><br /><p>I can see in logs that openvpn is trying to setup ip address, but it fails. I also tried to do it manually:</p><p>/sbin/ifconfig tun0 10.1.1.11 pointopoint 255.255.255.0 mtu 1500<br />ifconfig: SIOCSIFADDR: No such device</p><p>Any ideas what is happening? I&#039;m using Attitude Adjustment 12.09 r36088</p><p># uci show network<br />network.loopback=interface<br />network.loopback.ifname=lo<br />network.loopback.proto=static<br />network.loopback.ipaddr=127.0.0.1<br />network.loopback.netmask=255.0.0.0<br />network.lan=interface<br />network.lan.ifname=eth1<br />network.lan.type=bridge<br />network.lan.proto=static<br />network.lan.ipaddr=192.168.1.1<br />network.lan.netmask=255.255.255.0<br />network.wan=interface<br />network.wan.ifname=eth0<br />network.wan.proto=dhcp<br />network.vpn=interface<br />network.vpn.proto=none<br />network.vpn.ifname=tun0</p><p>root@OpenWrt:~# uci show firewall<br />firewall.@defaults[0]=defaults<br />firewall.@defaults[0].syn_flood=1<br />firewall.@defaults[0].input=ACCEPT<br />firewall.@defaults[0].output=ACCEPT<br />firewall.@defaults[0].forward=REJECT<br />firewall.@zone[0]=zone<br />firewall.@zone[0].name=lan<br />firewall.@zone[0].network=lan<br />firewall.@zone[0].input=ACCEPT<br />firewall.@zone[0].output=ACCEPT<br />firewall.@zone[0].forward=REJECT<br />firewall.@zone[1]=zone<br />firewall.@zone[1].name=wan<br />firewall.@zone[1].network=wan<br />firewall.@zone[1].input=REJECT<br />firewall.@zone[1].output=ACCEPT<br />firewall.@zone[1].forward=REJECT<br />firewall.@zone[1].masq=1<br />firewall.@zone[1].mtu_fix=1<br />firewall.@zone[2]=zone<br />firewall.@zone[2].name=vpn<br />firewall.@zone[2].input=ACCEPT<br />firewall.@zone[2].output=ACCEPT<br />firewall.@zone[2].forward=ACCEPT<br />firewall.@forwarding[0]=forwarding<br />firewall.@forwarding[0].src=lan<br />firewall.@forwarding[0].dest=wan<br />firewall.@forwarding[1]=forwarding<br />firewall.@forwarding[1].src=lan<br />firewall.@forwarding[1].dest=vpn<br />firewall.@rule[0]=rule<br />firewall.@rule[0].name=Allow-DHCP-Renew<br />firewall.@rule[0].src=wan<br />firewall.@rule[0].proto=udp<br />firewall.@rule[0].dest_port=68<br />firewall.@rule[0].target=ACCEPT<br />firewall.@rule[0].family=ipv4<br />firewall.@rule[1]=rule<br />firewall.@rule[1].name=Allow-Ping<br />firewall.@rule[1].src=wan<br />firewall.@rule[1].proto=icmp<br />firewall.@rule[1].icmp_type=echo-request<br />firewall.@rule[1].family=ipv4<br />firewall.@rule[1].target=ACCEPT<br />firewall.@rule[2]=rule<br />firewall.@rule[2].name=Allow-DHCPv6<br />firewall.@rule[2].src=wan<br />firewall.@rule[2].proto=udp<br />firewall.@rule[2].src_ip=fe80::/10<br />firewall.@rule[2].src_port=547<br />firewall.@rule[2].dest_ip=fe80::/10<br />firewall.@rule[2].dest_port=546<br />firewall.@rule[2].family=ipv6<br />firewall.@rule[2].target=ACCEPT<br />firewall.@rule[3]=rule<br />firewall.@rule[3].name=Allow-ICMPv6-Input<br />firewall.@rule[3].src=wan<br />firewall.@rule[3].proto=icmp<br />firewall.@rule[3].icmp_type=echo-request echo-reply destination-unreachable packet-too-big time-exceeded bad-header unknown-header-type router-solicitation neighbour-solicitation router-advertisement neighbour-advertisement<br />firewall.@rule[3].limit=1000/sec<br />firewall.@rule[3].family=ipv6<br />firewall.@rule[3].target=ACCEPT<br />firewall.@rule[4]=rule<br />firewall.@rule[4].name=Allow-ICMPv6-Forward<br />firewall.@rule[4].src=wan<br />firewall.@rule[4].dest=*<br />firewall.@rule[4].proto=icmp<br />firewall.@rule[4].icmp_type=echo-request echo-reply destination-unreachable packet-too-big time-exceeded bad-header unknown-header-type<br />firewall.@rule[4].limit=1000/sec<br />firewall.@rule[4].family=ipv6<br />firewall.@rule[4].target=ACCEPT<br />firewall.@include[0]=include<br />firewall.@include[0].path=/etc/firewall.user</p><br /><p>And here is output from logs:<br />Nov 12 09:49:03 OpenWrt daemon.notice openvpn(sample_client)[1407]: OpenVPN 2.2.2 mips-openwrt-linux [SSL] [LZO2] [EPOLL] built on Mar 14 2013<br />Nov 12 09:49:03 OpenWrt daemon.warn openvpn(sample_client)[1407]: NOTE: OpenVPN 2.1 requires &#039;--script-security 2&#039; or higher to call user-defined scripts or executables<br />Nov 12 09:49:03 OpenWrt daemon.notice openvpn(sample_client)[1407]: LZO compression initialized<br />Nov 12 09:49:03 OpenWrt daemon.notice openvpn(sample_client)[1407]: Control Channel MTU parms [ L:1542 D:138 EF:38 EB:0 ET:0 EL:0 ]<br />Nov 12 09:49:03 OpenWrt daemon.notice openvpn(sample_client)[1407]: Socket Buffers: R=[163840-&gt;131072] S=[163840-&gt;131072]<br />Nov 12 09:49:03 OpenWrt daemon.notice openvpn(sample_client)[1407]: Data Channel MTU parms [ L:1542 D:1450 EF:42 EB:135 ET:0 EL:0 AF:3/1 ]<br />Nov 12 09:49:03 OpenWrt daemon.notice openvpn(sample_client)[1407]: UDPv4 link local: [undef]<br />Nov 12 09:49:03 OpenWrt daemon.notice openvpn(sample_client)[1407]: UDPv4 link remote: xx.xx.xx.xx:1194<br />Nov 12 09:49:03 OpenWrt daemon.notice openvpn(sample_client)[1407]: TLS: Initial packet from xx.xx.xx.xx:1194, sid=948eb803 46731bdf<br />Nov 12 09:49:03 OpenWrt daemon.notice openvpn(sample_client)[1407]: VERIFY OK: depth=1, /C=DE/ST=HE/L=Frankfurt_am_Main/O=MyServ/OU=IT_department/CN=openvpn/name=MyServVPN/emailAddress=val@MyServ.de<br />Nov 12 09:49:03 OpenWrt daemon.notice openvpn(sample_client)[1407]: VERIFY OK: nsCertType=SERVER<br />Nov 12 09:49:03 OpenWrt daemon.notice openvpn(sample_client)[1407]: VERIFY OK: depth=0, /C=DE/ST=HE/L=Frankfurt_am_Main/O=MyServ/OU=IT_department/CN=openvpn/name=MyServVPN/emailAddress=val@MyServ.de<br />Nov 12 09:49:05 OpenWrt daemon.notice openvpn(sample_client)[1407]: Data Channel Encrypt: Cipher &#039;BF-CBC&#039; initialized with 128 bit key<br />Nov 12 09:49:05 OpenWrt daemon.notice openvpn(sample_client)[1407]: Data Channel Encrypt: Using 160 bit message hash &#039;SHA1&#039; for HMAC authentication<br />Nov 12 09:49:05 OpenWrt daemon.notice openvpn(sample_client)[1407]: Data Channel Decrypt: Cipher &#039;BF-CBC&#039; initialized with 128 bit key<br />Nov 12 09:49:05 OpenWrt daemon.notice openvpn(sample_client)[1407]: Data Channel Decrypt: Using 160 bit message hash &#039;SHA1&#039; for HMAC authentication<br />Nov 12 09:49:05 OpenWrt daemon.notice openvpn(sample_client)[1407]: Control Channel: TLSv1, cipher TLSv1/SSLv3 DHE-RSA-AES256-SHA, 2048 bit RSA<br />Nov 12 09:49:05 OpenWrt daemon.notice openvpn(sample_client)[1407]: [openvpn] Peer Connection Initiated with xx.xx.xx.xx:1194<br />Nov 12 09:49:08 OpenWrt daemon.notice openvpn(sample_client)[1407]: SENT CONTROL [openvpn]: &#039;PUSH_REQUEST&#039; (status=1)<br />Nov 12 09:49:08 OpenWrt daemon.notice openvpn(sample_client)[1407]: PUSH: Received control message: &#039;PUSH_REPLY,route 10.1.1.0 255.255.255.0,topology net30,ping 10,ping-restart 120,ifconfig 10.1.1.11 255.255.255.0&#039;<br />Nov 12 09:49:08 OpenWrt daemon.notice openvpn(sample_client)[1407]: OPTIONS IMPORT: timers and/or timeouts modified<br />Nov 12 09:49:08 OpenWrt daemon.notice openvpn(sample_client)[1407]: OPTIONS IMPORT: --ifconfig/up options modified<br />Nov 12 09:49:08 OpenWrt daemon.notice openvpn(sample_client)[1407]: OPTIONS IMPORT: route options modified<br />Nov 12 09:49:08 OpenWrt daemon.warn openvpn(sample_client)[1407]: WARNING: Since you are using --dev tun with a point-to-point topology, the second argument to --ifconfig must be an IP address.&nbsp; You are using something (255.255.255.0) that looks more like a netmask. (sil<br />Nov 12 09:49:08 OpenWrt daemon.notice openvpn(sample_client)[1407]: TUN/TAP device tun0 opened<br />Nov 12 09:49:08 OpenWrt daemon.notice openvpn(sample_client)[1407]: TUN/TAP TX queue length set to 100<br />Nov 12 09:49:08 OpenWrt daemon.notice openvpn(sample_client)[1407]: /sbin/ifconfig tun0 10.1.1.11 pointopoint 255.255.255.0 mtu 1500<br />Nov 12 09:49:08 OpenWrt daemon.err openvpn(sample_client)[1407]: Linux ifconfig failed: external program exited with error status: 1<br />Nov 12 09:49:08 OpenWrt daemon.notice openvpn(sample_client)[1407]: Exiting<br />Nov 12 09:49:08 OpenWrt daemon.notice netifd: Interface &#039;vpn&#039; is now down</p>											<p class="post-edited">(Last edited by <strong>valentt</strong> on 12 Nov 2013, 11:50)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p217350">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						12 Nov 2013, 13:09					</div>
				</div>
				<div class="post-content content">
					<p>Well OpenVPN itself tells whats wrong:</p><div class="quotebox"><blockquote><p>WARNING: Since you are using --dev tun with a point-to-point topology, the second argument to --ifconfig must be an IP address.&nbsp; You are using something (255.255.255.0) that looks more like a netmask.</p></blockquote></div><p>Seems to me like an OpenVPN config problem. Either the supplied IPs or the topology are wrong.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p217909">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">valentt</div>
					<div class="post-datetime">
						19 Nov 2013, 00:26					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>jow wrote:</cite><blockquote><p>Well OpenVPN itself tells whats wrong:</p><div class="quotebox"><blockquote><p>WARNING: Since you are using --dev tun with a point-to-point topology, the second argument to --ifconfig must be an IP address.&nbsp; You are using something (255.255.255.0) that looks more like a netmask.</p></blockquote></div></blockquote></div><p>Found the issue. I had bad config in ccd/ directory. </p><p>I had this setup in my /etc/openvpn/ccd/client1 &quot;ifconfig-push 10.1.1.11 255.255.255.0&quot;<br />insted &quot;ifconfig-push 10.1.1.11 10.1.1.1&quot;</p><p>After fixing this in server config everything now works.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p218147">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">drfrink</div>
					<div class="post-datetime">
						21 Nov 2013, 16:55					</div>
				</div>
				<div class="post-content content">
					<p>I had a similar problem. I made a sysupgrade from Backfire where openvpn worked for me to Attitude.</p><p>When I started openvpn I got the message that openvpn could not find /dev/net/tun. After searching and stumbling about this thread I found out that there was no tun module:</p><p>#lsmod |grep tun<br />nothing</p><p>After installing kmod-tun i got<br />#lsmod |grep tun<br />tun&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 12864&nbsp; 0 </p><p>Et voila.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>