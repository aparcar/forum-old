<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Broke my WRTSL54GS; only safe mode works</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 22 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p53847">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">keenerb</div>
					<div class="post-datetime">
						14 Aug 2007, 02:29					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ve somehow managed to break my router.</p><p>It was working fine until I screwed with it.</p><p>I did this:</p><p>nvram set vlan0ports=&quot;0 1 2 3 4 5*&quot;<br />nvram set vlan1ports=&quot;5&quot;<br />nvram commit</p><p>And it broke.</p><p>Safe mode works OK.</p><p>I subsequently re-installed the factory firmware and did a factory reset, and it works fine.</p><p>I then re-installed the whiterussian 0.9 release, and no connectivity to the router, again except when in safe mode.</p><p>I downloaded and ran the nvram-clean.sh script (or whatever it&#039;s&nbsp; called.)</p><p>Here&#039;s my nvram dump, any help is appreciated.</p><div class="codebox"><pre><code>Intel_firmware_version=v1.41.8
MS_scan_folder_num=0
MS_scan_max_num=10
MServer=0
NAS_alert=Successfully updated share properties.
aa0=3
access_share=music
ag0=255
all_partitions_share=1
audio_AAC=1
audio_AC3=1
audio_AIF=1
audio_LPCM=1
audio_M3U=1
audio_M4A=1
audio_MP2=1
audio_MP3=1
audio_MPA=1
audio_PCM=1
audio_WAV=1
audio_WMA=1
backup_job10=:::::::::::
backup_job1=:::::::::::
backup_job2=:::::::::::
backup_job3=:::::::::::
backup_job4=:::::::::::
backup_job5=:::::::::::
backup_job6=:::::::::::
backup_job7=:::::::::::
backup_job8=:::::::::::
backup_job9=:::::::::::
bcm4712_firmware_version=v1.50.0
boardflags=0x0018
boardnum=42
boardrev=0x10
boardtype=0x042f
boot_ver=v3.5
boot_wait=on
bootnv_ver=1
ccode=0
cctl=0
clkfreq=264
create_modify_share_part=PUBSHARE
create_or_modify_share=disk_create
create_or_modify_user=create
ddns_enable=0
ddns_interval=60
dhcp_num=50
dhcp_start=100
dl_ram_addr=a0001000
domadmins_gid=42002
domain_WRTSL54GS_sid=S-1-4-0-0-0-0-0-5-15-c7438c2e-db0a231e-b544e77b-0-0-0-0-0-0-0-0-0-0-0
error_pop_up_on_all=enabled
et0macaddr=00:18:39:EE:07:6E
et0mdcport=0
et0phyaddr=30
et1macaddr=00:90:4C:60:00:2B
et1mdcport=1
et1phyaddr=5
flash_type=Intel 28F640J3 4Mx16
ftp_access=0
ftp_all=1
ftp_port=21
ftp_share_access=2:admin:rw:guest:r
ftp_share_folder=/
gid_range=42000-43000
gpio4=ses_button
gpio5=ses_led
gpio7=ses_led2
group_users=admin:1:admin guest:1:guest
guest_uid=35000
il0macaddr=00:18:39:ee:07:70
lan_dhcp_enabled=0
lan_dhcp_num=100
lan_dhcp_start=50
lan_dns= 192.168.5.5
lan_gateway=192.168.5.2
lan_hwaddr=00:18:39:EE:07:6E
lan_ifname=br0
lan_ifnames=eth0 eth2 eth3 eth4
lan_ipaddr=192.168.1.1
lan_netmask=255.255.255.0
lan_proto=static
lan_stp=0
logon_drive=Z:
machine_comment=WRTSL54GS
machine_name=WRTSL54GS
nobody_gid=42001
old_claim_diskname=Blank Disk 1
old_lan_netmask=255.255.255.0
openvpn_cli=0
openvpn_cli_auth=psk
openvpn_cli_port=1194
openvpn_cli_proto=udp
os_date=Sep 14 2006
os_flash_addr=bfc40000
os_ram_addr=80001000
os_version=3.91.38.0
pa0b0=0x170c
pa0b1=0xfa24
pa0b2=0xfe70
pa0itssit=62
pa0itssit=62
pa0maxpwr=0x48
photo_BMP=1
photo_GIF=1
photo_JPG=1
photo_PNG=1
photo_TIF=1
pmon_ver=CFE 3.91.38.0
ppp_demand=0
ppp_idletime=5
ppp_mru=1500
ppp_mtu=1500
ppp_redialperiod=30
pppoe_demand=0
pppoe_idletime=5
pptp_cli=0
private_shares=All_Partitions:*:comment:/foreign_shares
reset_gpio=7
root_passwd=admin
router_name=WRTSL54GS
scratch=a0180000
sdram_config=0x0062
sdram_init=0x000b
sdram_ncdl=0x10204
sdram_refresh=0x0000
shared_info=All_Partitions:1:admin:rw
smb_admin_user=admin
sromrev=2
storage_groups_limit=15
storage_shares_limit=15
storage_users_limit=15
uid_range=35000-40000
users_gid=42000
video_AVI=1
video_DAT=1
video_M4V=1
video_MP4=1
video_MPG=1
video_VOB=1
video_WMV=1
vlan0hwname=et0
vlan0ports=0 1 2 3 5*
vlan1hwname=et0
vlan1ports=4
wan_device=eth1
wan_dhcp_num=50
wan_dhcp_start=100
wan_gateway=0.0.0.0
wan_iface=eth1
wan_ifname=eth1
wan_ifnames=eth1
wan_ipaddr=0.0.0.0
wan_mtu=1500
wan_netmask=0.0.0.0
wan_proto=dhcp
watchdog=5000
wifi_dhcp_num=50
wifi_dhcp_start=100
wl0_afterburner=auto
wl0_antdiv=-1
wl0_ap_isolate=0
wl0_auth=0
wl0_auth_mode=none
wl0_bcn=100
wl0_channel=6
wl0_closed=0
wl0_corerev=9
wl0_country=Worldwide
wl0_country_code=ALL
wl0_crypto=tkip
wl0_dtim=1
wl0_frag=2346
wl0_frameburst=on
wl0_gmode=6
wl0_gmode_protection=off
wl0_hwaddr=00:18:39:EE:07:70
wl0_ifname=eth2
wl0_infra=1
wl0_key=1
wl0_lazywds=1
wl0_macmode=disabled
wl0_maxassoc=128
wl0_mode=ap
wl0_mrate=0
wl0_net_mode=mixed
wl0_net_reauth=36000
wl0_phytype=g
wl0_phytypes=g
wl0_plcphdr=long
wl0_radio=1
wl0_radioids=BCM2050
wl0_radius_port=1812
wl0_rate=0
wl0_rateset=default
wl0_rts=2347
wl0_ssid=linksys
wl0_wds_timeout=1
wl0_wep=disabled
wl0_wep_bit=64
wl0_wme=off
wl0_wme_ap_be=15 63 3 0 0 off
wl0_wme_ap_bk=15 1023 7 0 0 off
wl0_wme_ap_vi=7 15 1 6016 3008 off
wl0_wme_ap_vo=3 7 1 3264 1504 off
wl0_wme_no_ack=off
wl0_wme_sta_be=15 1023 3 0 0 off
wl0_wme_sta_bk=15 1023 7 0 0 off
wl0_wme_sta_vi=7 15 2 6016 3008 off
wl0_wme_sta_vo=3 7 2 3264 1504 off
wl0_wpa_gtk_rekey=3600
wl0gpio2=0
wl0gpio3=0
wl0id=0x4320
wl10_mode=sta
workgroup=Linksys</code></pre></div>											<p class="post-edited">(Last edited by <strong>keenerb</strong> on 14 Aug 2007, 02:39)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p53926">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">bkloppenborg</div>
					<div class="post-datetime">
						15 Aug 2007, 05:34					</div>
				</div>
				<div class="post-content content">
					<p>keenerb,</p><p>I can say I&#039;ve done that a few times trying to get VLANS to work with my two WRTSL54GS boxes.&nbsp; Without looking too deeply into your nvram settings, I&#039;d say try resetting the nvram variables for the VLANS:</p><div class="codebox"><pre><code>nvram set vlan0ports=0 1 2 3 5u
nvram set vlan1ports=4 5
nvram commit

reboot</code></pre></div><p>Since you can get into safe mode, it&#039;s worth a shot.</p><p>I think since the WRTSL54GS has a separate interface for the WAN, eth1, you need not configure vlan0 with 5*.&nbsp; Instead, it should be untagged (5u).&nbsp; As far as I know, most WRT-series routers use a single switch for the WAN and LAN traffic and separate them using vlans.</p>											<p class="post-edited">(Last edited by <strong>bkloppenborg</strong> on 15 Aug 2007, 05:36)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p53931">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">warrawarra</div>
					<div class="post-datetime">
						15 Aug 2007, 08:51					</div>
				</div>
				<div class="post-content content">
					<p>If you can just do a clean factory firmware flash ?? and then redo the current 0.9 you want it should work fine and all should be back to working / default.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p53984">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">bkloppenborg</div>
					<div class="post-datetime">
						16 Aug 2007, 07:12					</div>
				</div>
				<div class="post-content content">
					<p>In a more dangerous move, I have also reset the nvram and filesystem on both of my WRTSL54GS units.&nbsp; The Wiki details how to do it and also indicates that you could break your router (etc.).&nbsp; Of course, if you do this on your router, you are doing it at your own risk.&nbsp; </p><p>If you decide to &quot;reset&quot; your router, you should consider exporting your nvram variables:</p><div class="codebox"><pre><code>nvram show | sort</code></pre></div><p>and saving the output for reference.&nbsp; After that, I reset the router&#039;s firmware and nvram by using the following two commands (router automatically reboots):</p><div class="codebox"><pre><code>firstboot
mtd -r erase nvram</code></pre></div><p>After I did this on my second (newer) unit, I noticed that a few of the wireless nvram settings were missing.&nbsp; I manually added them using the following:</p><div class="codebox"><pre><code>nvram set wl0_closed=0
nvram set wl0_channel=2
nvram set wl0_macmode=allow
nvram set wl0_maclist=</code></pre></div><p>In case you need them, I exported the nvram variables after first flashing the router with OpenWRT and after resetting the nvram (before adding the last four variables).&nbsp; Just ask and I&#039;ll link to them.</p>											<p class="post-edited">(Last edited by <strong>bkloppenborg</strong> on 16 Aug 2007, 07:14)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p54461">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">fgordts</div>
					<div class="post-datetime">
						23 Aug 2007, 11:43					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>bkloppenborg wrote:</cite><blockquote><div class="codebox"><pre><code>nvram set wl0_closed=0
nvram set wl0_channel=2
nvram set wl0_macmode=allow
nvram set wl0_maclist=</code></pre></div><p>In case you need them, I exported the nvram variables after first flashing the router with OpenWRT and after resetting the nvram (before adding the last four variables).&nbsp; Just ask and I&#039;ll link to them.</p></blockquote></div><p>Do you need to do a commit after these?<br />Also, what do these 4 do exactly? Are they required? Thanks</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p54734">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">bkloppenborg</div>
					<div class="post-datetime">
						28 Aug 2007, 22:50					</div>
				</div>
				<div class="post-content content">
					<p>Yes, you are correct, you do need the nvram commit statement after them.&nbsp; </p><p>The last four settings put some of the wireless configuration parameters back into the unit that are not included after you erase/reset the nvram.&nbsp; </p><p>My router worked fine over the wired connection without those four variables set.&nbsp; I did not try the wireless connection without the aforementioned variables set.&nbsp; I guess, I am sure that they are not required to get the wired side of the router to work but they are used to configure the wireless connection so they are most likely needed.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>