<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Cross-compiled C code not working properly in Kamikaze</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 20 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p78150">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">eyang1</div>
					<div class="post-datetime">
						15 Dec 2008, 18:27					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>I&#039;ve tried cross-compile a source code called beep.c written by Johnathan Nightingale onto Kamikaze but the program is not working properly.</p><p>The source code:<br /><a href="http://www.johnath.com/beep/beep.c">http://www.johnath.com/beep/beep.c</a></p><p>When compiled on a PC (CentOS), I need to use sudo to run the beep program, otherwise I would get:</p><p>ioctl: Operation not permitted</p><p>In Kamikaze, as root when trying to run the program it returns:</p><p>ioctl: Invalid argument</p><p>The problem seems to related to ioctl.</p><p>The author has commented about ioctl in the README:</p><p>---------------------------------------------------------------------------------------------<br />As noted in the man page, some users are running into a situation where beep <br />dies with a complaint from ioctl().&nbsp; The reason for this, as Peter Tirsek was<br />nice enough to point out to me, stems from how the kernel handles beep&#039;s <br />attempt to poke at (for non-programmers: ioctl is a sort of catch-all function<br />that lets you poke at things that have no other predefined poking-at mechanism)<br />the tty, which is how it beeps.&nbsp; The short story is, the kernel checks that <br />either:</p><p>- you are the superuser<br />- you own the current tty</p><p>What this means is that root can always make beep work (to the best of my <br />knowledge!), and that any local user can make beep work, BUT a non-root remote<br />user cannot use beep in it&#039;s natural state.&nbsp; What&#039;s worse, an xterm, or other<br />x-session counts, as far as the kernel is concerned, as &#039;remote&#039;, so beep <br />won&#039;t work from a non-priviledged xterm either.&nbsp; I had originally chalked this<br />up to a bug, but there&#039;s actually nothing I can do about it, and it really is <br />a Good Thing that the kernel does things this way.&nbsp; There is also a solution.</p><p>By default beep is not installed with the suid bit set, because that would <br />just be zany.&nbsp; On the other hand, if you do make it suid root, all your <br />problems with beep bailing on ioctl calls will magically vanish, which is <br />pleasant, and the only reason not to is that any suid program is a potential <br />security hole.&nbsp; Conveniently, beep is very short, so auditing it is pretty <br />straightforward.</p><p>...</p><p>-----------------------------------------------------------------------------------------------------</p><p>I&#039;m wondering if the problem is related me accessing Kamikaze through serial console or the program is not cross-compiled properly.</p><p>Thanks in advance for any comment/help!</p><br /><p>Edward</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>