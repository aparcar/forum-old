<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Router that does 110 down/20 up with fq_codel QOS enabled?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 29 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p277785">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">fawbaw</div>
					<div class="post-datetime">
						28 May 2015, 00:51					</div>
				</div>
				<div class="post-content content">
					<p>What&#039;s the cheapest OpenWRT supported router that can handle 110 down/20 up with fq_codel QOS enabled?</p><p>I currently have a 3700v2 running CeroWRT that can handle close to 80 to 90 down with QOS enabled, but then CPU limitations stop it from going above that. </p><p>I was looking at the WRT1900/R7000, but someone else found that it barely does 90mbit with QOS enabled.</p><p>I am looking for wired performance, must have gigabit ports. I will probably stick with my current 3700v2 for the wireless access point, so if there is a wired-only router that&#039;s cheaper, that would work great too.</p><p>Any recommendations? I saw someone claiming that the Archer c7 can handle &gt;100 mbit down with QOS enabled, but not sure if that&#039;s true.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p277793">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">drawz</div>
					<div class="post-datetime">
						28 May 2015, 01:49					</div>
				</div>
				<div class="post-content content">
					<p>I thought CeroWrt on the WNDR3x00 only hit about 50-60mbps? There was some discussion on the CeroWrt/Bloat mailing list about the WRT1900AC capabilities, but I don&#039;t recall the speeds attained. It definitely has one of the most powerful CPUs available today in a consumer router, so I can&#039;t imagine much would beat it (in terms of consumer devices). That said, I think a dedicated x86 box is probably the best way to attain those speeds with QOS/SQM. Maybe a Baytrail Celeron/Pentium or similar?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p277816">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">languagegame</div>
					<div class="post-datetime">
						28 May 2015, 06:13					</div>
				</div>
				<div class="post-content content">
					<p>I was in a similar situation with a 3700v2, and I ultimately decided to disable SQM on the downlink and only use on the uplink.&nbsp; &nbsp;SQM is generally more suited towards managing/prioritizing upload as I understand it, and this lets you still get the full download speed.&nbsp; Realize this is not exactly what you are looking for, but saves you from having to get a new router.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p277828">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">fawbaw</div>
					<div class="post-datetime">
						28 May 2015, 09:14					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>languagegame wrote:</cite><blockquote><p>I was in a similar situation with a 3700v2, and I ultimately decided to disable SQM on the downlink and only use on the uplink.&nbsp; &nbsp;SQM is generally more suited towards managing/prioritizing upload as I understand it, and this lets you still get the full download speed.&nbsp; Realize this is not exactly what you are looking for, but saves you from having to get a new router.</p></blockquote></div><p>How do I disable just the downlink? The settings tab for CeroWRT just has an &quot;enable&quot; checkbox. If I set the speeds for download way past my actual bandwidth, I see it not working (i.e. ping times grow as if SQM were off), but I suspect that that just leaves SQM on and still eats CPU cycles.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p277829">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">fawbaw</div>
					<div class="post-datetime">
						28 May 2015, 09:15					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>drawz wrote:</cite><blockquote><p>I thought CeroWrt on the WNDR3x00 only hit about 50-60mbps? There was some discussion on the CeroWrt/Bloat mailing list about the WRT1900AC capabilities, but I don&#039;t recall the speeds attained. It definitely has one of the most powerful CPUs available today in a consumer router, so I can&#039;t imagine much would beat it (in terms of consumer devices). That said, I think a dedicated x86 box is probably the best way to attain those speeds with QOS/SQM. Maybe a Baytrail Celeron/Pentium or similar?</p></blockquote></div><p>The 50-60mbps number is also something I&#039;ve seen too, but for some reason my 3700v2 is able to be better than that, but only up to about 80mbps or so. Certainly not coming close to the 120 I&#039;m paying extra for.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p277946">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">drawz</div>
					<div class="post-datetime">
						29 May 2015, 00:51					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>fawbaw wrote:</cite><blockquote><div class="quotebox"><cite>languagegame wrote:</cite><blockquote><p>I was in a similar situation with a 3700v2, and I ultimately decided to disable SQM on the downlink and only use on the uplink.&nbsp; &nbsp;SQM is generally more suited towards managing/prioritizing upload as I understand it, and this lets you still get the full download speed.&nbsp; Realize this is not exactly what you are looking for, but saves you from having to get a new router.</p></blockquote></div><p>How do I disable just the downlink? The settings tab for CeroWRT just has an &quot;enable&quot; checkbox. If I set the speeds for download way past my actual bandwidth, I see it not working (i.e. ping times grow as if SQM were off), but I suspect that that just leaves SQM on and still eats CPU cycles.</p></blockquote></div><p>I believe if you set the speed to &quot;0&quot; it will be off for that direction.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p277995">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						29 May 2015, 09:40					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>drawz wrote:</cite><blockquote><p>[about sqm-scripts]<br />I believe if you set the speed to &quot;0&quot; it will be off for that direction.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; That, while not well documented, is correct. As shaping one direction to zero will make a link totally unusable for tcp, zero was &quot;overloaded&quot; to denote &quot;zero shaping&quot; and not shaping to zero... Maybe the GUI should include some hints regarding this...</p><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p278255">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">fawbaw</div>
					<div class="post-datetime">
						31 May 2015, 09:20					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>drawz wrote:</cite><blockquote><div class="quotebox"><cite>fawbaw wrote:</cite><blockquote><div class="quotebox"><cite>languagegame wrote:</cite><blockquote><p>I was in a similar situation with a 3700v2, and I ultimately decided to disable SQM on the downlink and only use on the uplink.&nbsp; &nbsp;SQM is generally more suited towards managing/prioritizing upload as I understand it, and this lets you still get the full download speed.&nbsp; Realize this is not exactly what you are looking for, but saves you from having to get a new router.</p></blockquote></div><p>How do I disable just the downlink? The settings tab for CeroWRT just has an &quot;enable&quot; checkbox. If I set the speeds for download way past my actual bandwidth, I see it not working (i.e. ping times grow as if SQM were off), but I suspect that that just leaves SQM on and still eats CPU cycles.</p></blockquote></div><p>I believe if you set the speed to &quot;0&quot; it will be off for that direction.</p></blockquote></div><p>This worked for me, setting it to 0 did turn it off for that direction. Thanks!</p><p>As far as my original problem, I think I&#039;ve solved it by getting the Archer C7 from tplink. I&#039;ll leave some of my thoughts here in case anyone else runs a search looking for the same information to avoid this kind of scenario: <a href="http://xkcd.com/979/">http://xkcd.com/979/</a></p><p>With the &quot;bandwidth control&quot; feature in the tplink official stock firmware suspiciously taking the same arguments as fq_codel (i.e ingress speed and egress speed and an enable flag), I tried to see if it helps my bufferbloat. It does it the exact same way as fq_codel, so I can pretty much guess that they&#039;ve renamed it. </p><p>I did do an nmap scan of the router running the stock firmware, and it looks like they are running Linux kernel 2.6. So they must have backported fq_codel or used the 2.6 version. </p><p>In any case, it is comfortably able to shape ~120 mbit for me, so I&#039;m going to stick with it. I will probably flash it with openwrt at some point, but I&#039;m going to see how stable the stock firmware is for me first. </p><p>Also, I read some perf data about tplink having closed source binary blobs that don&#039;t work in openwrt, so there is a chance that the openwrt firmware on it might not hit 120 meg down with SQM turned on. I&#039;ll try it out at some point, but for right now it&#039;s working and I&#039;ll leave it at that.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p278318">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">drawz</div>
					<div class="post-datetime">
						31 May 2015, 19:42					</div>
				</div>
				<div class="post-content content">
					<p>I doubt TP-Link is using FQ_codel, but by slowing down the link it shold improve bufferbloat some. Probably not quite as well as fq_codel though. I know this was the case using Tomato firmware on a WRT54G which definitely does not have fq_codel.</p><p>Are you using hardware accelerated NAT on the stock firmware?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p278392">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						1 Jun 2015, 09:55					</div>
				</div>
				<div class="post-content content">
					<p>Hi fawbaw,</p><div class="quotebox"><cite>fawbaw wrote:</cite><blockquote><p>[...]<br />With the &quot;bandwidth control&quot; feature in the tplink official stock firmware suspiciously taking the same arguments as fq_codel (i.e ingress speed and egress speed and an enable flag), I tried to see if it helps my bufferbloat. It does it the exact same way as fq_codel, so I can pretty much guess that they&#039;ve renamed it.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; So fq_codel is a queueing discipline its main parameters are interval (a rough estimate of the typical RTTor 100ms by default) and target, the sojourn time we aim for. Ingress and egress speed, typically, are important for traffic policers or shapers, like HTB and HFSC. So the existence of these two paramerts hence indicates some traffic control, but is not a strong indicator for fq_codel.<br /></p><div class="quotebox"><cite>fawbaw wrote:</cite><blockquote><p>I did do an nmap scan of the router running the stock firmware, and it looks like they are running Linux kernel 2.6. So they must have backported fq_codel or used the 2.6 version.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; Interesting approach, I would have downloaded the GPL tar ball for the archer and just looked into the source <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /> this should also solve the &quot;was something back-ported&quot; question.<br /></p><div class="quotebox"><cite>fawbaw wrote:</cite><blockquote><p>In any case, it is comfortably able to shape ~120 mbit for me, so I&#039;m going to stick with it. I will probably flash it with openwrt at some point, but I&#039;m going to see how stable the stock firmware is for me first.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; This might be taken as an indicator that tp-link uses a policer on ingress (policers are computationally cheap compared to shapers), IIRC others have struggled to get the C7 shaping at 120 Mbps, but since I have not looked at either source nor firmware this is conjecture on my part.<br /></p><div class="quotebox"><cite>fawbaw wrote:</cite><blockquote><p>Also, I read some perf data about tplink having closed source binary blobs that don&#039;t work in openwrt, so there is a chance that the openwrt firmware on it might not hit 120 meg down with SQM turned on. I&#039;ll try it out at some point, but for right now it&#039;s working and I&#039;ll leave it at that.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; Typically openwrt seems advanced compared to vendor firmwares with the potential exception of off-load features vendors tend to enable any off-load under the sun to allow their weak routers to punch way above their weight, while openwrt does more of the right thing and avoids most of these off-loads (the off-loads often are fickle and disallow a whole set of important features and due to being proprietary often also enforce the use of ancient kernels).</p><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p278421">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">arokh</div>
					<div class="post-datetime">
						1 Jun 2015, 13:30					</div>
				</div>
				<div class="post-content content">
					<p>The WDR4900 is probably the home router supported by OpenWrt that has the most CPU power.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p278452">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">fawbaw</div>
					<div class="post-datetime">
						1 Jun 2015, 18:55					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>drawz wrote:</cite><blockquote><p>I doubt TP-Link is using FQ_codel, but by slowing down the link it shold improve bufferbloat some. Probably not quite as well as fq_codel though. I know this was the case using Tomato firmware on a WRT54G which definitely does not have fq_codel.</p><p>Are you using hardware accelerated NAT on the stock firmware?</p></blockquote></div><p>Yes, I have left the default settings for hardware accel NAT (enabled by default). I don&#039;t see a reason to disable it -- should I?</p><p>As far as buying a WDR4900, I did try to do that at first, but it isn&#039;t available from Amazon and tplink seems to have switched it out with the Archer series. Oh well.</p><p>Thanks for the extra info moeller0, it was enlightening. I&#039;ll try to see if I can get a build of openwrt on it sometime soon. I did notice some usual weirdness with the stock firmware. Took a day or so to surface, but it seems to not do so well with &gt;24 hours of uptime under it&#039;s belt. It was showing excessive latency with a dslreports test, so I fiddled with some settings regarding their &quot;packet statistics&quot; feature that allows for some type of DOS protection (it measures e.g. UDP packets coming in per second, and if the threshold is exceeded, it blocks the host). Once I fiddled with some stuff and ran the test again, it was back to being not terrible at latency under load. So very suspicious behavior indeed. I&#039;ll monitor this further and see what happens. I am terribly used to having ridiculous uptimes with my CeroWRT router.. that was like a ROCK, nothing could faze it, it would be the same consistent behavior after 10 days or 100 days of uptime. If only it was faster...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p278552">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">fawbaw</div>
					<div class="post-datetime">
						2 Jun 2015, 09:49					</div>
				</div>
				<div class="post-content content">
					<p>So I um... downloaded the GPL source for my C7 v2 stock firmware from tp-link&#039;s website. The kernel files are dated 2012-06-13. There is no sign of net/sched/sch_fq_codel.c there. So the bandwidth control thing is not running fq_codel, at least the kernel version anyway. So it is using some other type of queing as you mentioned, moeller0. I have no idea what they are using, and no way to find out. Yaaaay closed source software!!! /s</p><p>I tried CC-rc1 build on the router, and the performance was significantly lower. Also didn&#039;t help that Comcast was pooping its pants today with all the DNS and bandwidth downgrade issues in my service area. Didn&#039;t get a good chance to really put it through it&#039;s paces. </p><p>-h</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p278559">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">arokh</div>
					<div class="post-datetime">
						2 Jun 2015, 10:57					</div>
				</div>
				<div class="post-content content">
					<p>You can OC your 3700 to 800MHz as well, might be worth a try.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p278588">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">johndoe</div>
					<div class="post-datetime">
						2 Jun 2015, 15:49					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>fawbaw wrote:</cite><blockquote><p>Yes, I have left the default settings for hardware accel NAT (enabled by default). I don&#039;t see a reason to disable it -- should I?</p></blockquote></div><p>the hardware accel NAT feature is NOT available on OpenWrt. google &quot;openwrt hardware nat&quot;</p><p>just fyi.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p281541">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">alphasparc</div>
					<div class="post-datetime">
						27 Jun 2015, 06:57					</div>
				</div>
				<div class="post-content content">
					<p>Any plans to optimize the performance of FQ_CODEL qdisc etc to improve the maximum possible throughput?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p281569">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						27 Jun 2015, 15:51					</div>
				</div>
				<div class="post-content content">
					<p>Hi alphasparc,</p><div class="quotebox"><cite>alphasparc wrote:</cite><blockquote><p>Any plans to optimize the performance of FQ_CODEL qdisc etc to improve the maximum possible throughput?</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; As far as I know, fq_codel is not the problem, but rather the software rate-shaping. There is a new qdisc under development, called &quot;cake&quot;, that tries to fix some of the issues. It seems a bit more efficient at shaping than HTB, but expect no wonders. There are a number of steps that could be further optimized, as far as I can see, but that only bring something like &lt; 5% (more shaped bandwidth) each. I fear the real elution for higher sped links will be more powerful hardware. (Tangent: several routers combined a relatively powerful, proprietary?, offload engine with a rather puny CPU. Resulting in a device that with the manufacturer&#039;s firmware can reach quite impressive speeds, but the moment the packet handling needs to be performed by the CPU performance craters. Unfortunately traffic shaping requires the CPU...)</p><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p321019">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">Bogey</div>
					<div class="post-datetime">
						24 Apr 2016, 00:07					</div>
				</div>
				<div class="post-content content">
					<p>Cake seems to perform better if you are on limits with CPU.</p><p>Here is comparison with 100/10 Mbit/s connection downloading Ubuntu with bit torrent huge amount of peers.<br /><a href="http://imgur.com/a/vZsv1">http://imgur.com/a/vZsv1</a></p><p>I have set 95000 as download ingress.<br />Router is TP-LINK Archer C5</p>											<p class="post-edited">(Last edited by <strong>Bogey</strong> on 24 Apr 2016, 00:09)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>