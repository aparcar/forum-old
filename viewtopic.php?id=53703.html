<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> TP-Link Archer C7: 802.11ac slower in OpenWRT than native firmware</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 19 Apr 2018 and 6 May 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 9</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=53703&amp;p=2.html">2</a></li><li><a href="viewtopic.php%3Fid=53703&amp;p=3.html">3</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=53703&amp;p=9.html">9</a></li></ul></nav></div>
			
		
		
			<article class="post" id="p252476">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">mastabog</div>
					<div class="post-datetime">
						30 Oct 2014, 02:01					</div>
				</div>
				<div class="post-content content">
					<p>I have an Archer C7 v2. Is OpenWRT expected to be slower than native firmware under TCP? How about in general on various routers?</p><p>Doing an iperf test between two machines behind the router -- one LAN (wired), one WLAN (wireless). The wired one runs Windows 8.1 Pro and the wireless one runs MacOSX 10.10 (Macbook Pro late 2013), using the settings below. On Windows, I used the <a href="https://code.google.com/p/xjperf/downloads/list">JPerf 2.0.2</a> package (GUI over iperf), while on MacOSX 10.10 I used iperf from Macports (just do &quot;port install iperf&quot;). In all tests, the router sits at about half a meter in front of the laptop and the position is not changed, nor anything is moving in the room, while the tests are running. Channel fading is thus low and consistent. I used channel 36 and 149 with VHT80 (all other settings left on their defaults; both channels give same results, 149 allows for higher Tx power). The &quot;-i 1&quot; causes iperf to report speed every second.</p><p><strong>If you wish to test yourself</strong>, make sure the wireless machine is a true 3-stream (3x3 mimo) AC1300 801.11ac, i.e. support tru 1300 Mbps PHY rate with aggregate AMPDU support (latter should be available by default) -- using phones/tablets or devices that are not 3-stream AC1300 will not reveal differences. The other machine must be wired on a gigabit port. Otherwise you won&#039;t be able to hit 800+ Mbps.</p><br /><p>Iperf commands:</p><p>(server, Mac): iperf -s -i 1 -w 6M<br />(client, Win): iperf -c 192.168.1.19 -i 1 -w 6M -l 2M</p><br /><p><strong><span class="bbu">TP-Link firmware TCP results (latest TP-Link firmware from 11 Sept 2014)</span></strong><br /></p><div class="quotebox"><blockquote><p>[ ID] Interval&nbsp; &nbsp; &nbsp; &nbsp;Transfer&nbsp; &nbsp; &nbsp;Bandwidth<br />[216]&nbsp; 0.0- 1.0 sec&nbsp; &nbsp;102 MBytes&nbsp; &nbsp;856 Mbits/sec<br />[216]&nbsp; 1.0- 2.0 sec&nbsp; &nbsp;104 MBytes&nbsp; &nbsp;872 Mbits/sec<br />[216]&nbsp; 2.0- 3.0 sec&nbsp; &nbsp;104 MBytes&nbsp; &nbsp;872 Mbits/sec<br />[216]&nbsp; 3.0- 4.0 sec&nbsp; &nbsp;104 MBytes&nbsp; &nbsp;872 Mbits/sec<br />[216]&nbsp; 4.0- 5.0 sec&nbsp; 96.0 MBytes&nbsp; &nbsp;805 Mbits/sec<br />[216]&nbsp; 5.0- 6.0 sec&nbsp; &nbsp;104 MBytes&nbsp; &nbsp;872 Mbits/sec<br />[216]&nbsp; 6.0- 7.0 sec&nbsp; &nbsp;104 MBytes&nbsp; &nbsp;872 Mbits/sec<br />[216]&nbsp; 7.0- 8.0 sec&nbsp; &nbsp;104 MBytes&nbsp; &nbsp;872 Mbits/sec<br />[216]&nbsp; 8.0- 9.0 sec&nbsp; &nbsp;104 MBytes&nbsp; &nbsp;872 Mbits/sec<br />[216]&nbsp; 9.0-10.0 sec&nbsp; &nbsp;104 MBytes&nbsp; &nbsp;872 Mbits/sec<br />[216]&nbsp; <strong>0.0-10.1 sec&nbsp; 1032 MBytes&nbsp; &nbsp;860 Mbits/sec</strong><br />Done.</p></blockquote></div><br /><p><strong><span class="bbu">OpenWRT TCP results (OpenWRT 14.07 release)</span></strong>:<br /></p><div class="quotebox"><blockquote><p>[212]&nbsp; 0.0- 1.0 sec&nbsp; 46.0 MBytes&nbsp; &nbsp;386 Mbits/sec<br />[212]&nbsp; 1.0- 2.0 sec&nbsp; 64.0 MBytes&nbsp; &nbsp;537 Mbits/sec<br />[212]&nbsp; 2.0- 3.0 sec&nbsp; 64.0 MBytes&nbsp; &nbsp;537 Mbits/sec<br />[212]&nbsp; 3.0- 4.0 sec&nbsp; 64.0 MBytes&nbsp; &nbsp;537 Mbits/sec<br />[212]&nbsp; 4.0- 5.0 sec&nbsp; 56.0 MBytes&nbsp; &nbsp;470 Mbits/sec<br />[212]&nbsp; 5.0- 6.0 sec&nbsp; 64.0 MBytes&nbsp; &nbsp;537 Mbits/sec<br />[212]&nbsp; 6.0- 7.0 sec&nbsp; 64.0 MBytes&nbsp; &nbsp;537 Mbits/sec<br />[212]&nbsp; 7.0- 8.0 sec&nbsp; 64.0 MBytes&nbsp; &nbsp;537 Mbits/sec<br />[212]&nbsp; 8.0- 9.0 sec&nbsp; 48.0 MBytes&nbsp; &nbsp;403 Mbits/sec<br />[212]&nbsp; 9.0-10.0 sec&nbsp; 56.0 MBytes&nbsp; &nbsp;470 Mbits/sec<br />[212]&nbsp; <strong>0.0-10.1 sec&nbsp; &nbsp;592 MBytes&nbsp; &nbsp;491 Mbits/sec</strong><br />Done.</p></blockquote></div><p><strong>NOTE:</strong> That was the best score I managed to record. <strong>Most of the time</strong>, the speed under OpenWRT drops to 200 Mbits/s or fluctuates between 200 and 500 Mbits/s. It is never as consistent or as high as the speed under the TP-Link firmware on when using TCP.</p><br /><p><strong><span class="bbu">Using UDP instead of TCP, then both OpenWRT and TP-Link firmware yield around 800 Mbits/s.</span></strong>. With a UDP buffer size of 1MB, iperf settings were:</p><p>(server, Mac): iperf -s -u -i 1 -w 1M -l 4K<br />(client, Win): iperf -c 192.168.1.101 -i 1 -w 1M -l 4K -b 850M</p><div class="quotebox"><blockquote><p>[SUM]&nbsp; 1.0- 2.0 sec&nbsp; 98.5 MBytes&nbsp; &nbsp;826 Mbits/sec<br />[&nbsp; 4]&nbsp; 2.0- 3.0 sec&nbsp; 98.5 MBytes&nbsp; &nbsp;827 Mbits/sec&nbsp; &nbsp;0.039 ms 1123/26350 (4.3%)<br />[&nbsp; 4]&nbsp; 2.0- 3.0 sec&nbsp; 152 datagrams received out-of-order<br />[&nbsp; 4]&nbsp; 3.0- 4.0 sec&nbsp; 98.5 MBytes&nbsp; &nbsp;826 Mbits/sec&nbsp; &nbsp;0.044 ms 1082/26292 (4.1%)<br />[&nbsp; 4]&nbsp; 3.0- 4.0 sec&nbsp; 182 datagrams received out-of-order<br />[&nbsp; 4]&nbsp; 4.0- 5.0 sec&nbsp; &nbsp;100 MBytes&nbsp; &nbsp;841 Mbits/sec&nbsp; &nbsp;0.080 ms&nbsp; 904/26557 (3.4%)<br />[&nbsp; 4]&nbsp; 4.0- 5.0 sec&nbsp; 160 datagrams received out-of-order<br />[&nbsp; 4]&nbsp; 5.0- 6.0 sec&nbsp; 85.7 MBytes&nbsp; &nbsp;719 Mbits/sec&nbsp; &nbsp;0.030 ms 4103/26039 (16%)<br />[&nbsp; 4]&nbsp; 5.0- 6.0 sec&nbsp; 153 datagrams received out-of-order<br />[&nbsp; 4]&nbsp; 6.0- 7.0 sec&nbsp; &nbsp;100 MBytes&nbsp; &nbsp;841 Mbits/sec&nbsp; &nbsp;1.580 ms&nbsp; 808/26478 (3.1%)<br />[&nbsp; 4]&nbsp; 6.0- 7.0 sec&nbsp; 327 datagrams received out-of-order<br />[&nbsp; 4]&nbsp; 7.0- 8.0 sec&nbsp; 88.1 MBytes&nbsp; &nbsp;739 Mbits/sec&nbsp; &nbsp;0.039 ms 3598/26151 (14%)<br />[&nbsp; 4]&nbsp; 7.0- 8.0 sec&nbsp; 198 datagrams received out-of-order<br />[&nbsp; 4]&nbsp; 8.0- 9.0 sec&nbsp; 85.5 MBytes&nbsp; &nbsp;717 Mbits/sec&nbsp; 57.913 ms 4441/26333 (17%)<br />[&nbsp; 4]&nbsp; 8.0- 9.0 sec&nbsp; 195 datagrams received out-of-order<br />[&nbsp; 4]&nbsp; <strong>0.0- 9.9 sec&nbsp; &nbsp;944 MBytes&nbsp; &nbsp;799 Mbits/sec&nbsp; &nbsp;0.971 ms 21178/262767</strong> (8.1%)<br />[&nbsp; 4]&nbsp; 0.0- 9.9 sec&nbsp; 1799 datagrams received out-of-order</p></blockquote></div><br /><p><strong><span class="bbu">Question</span></strong></p><p>Obviously the router itself is capable of hitting 800+ Mbits/s. I know TCP is more demanding on the CPU than UDP, so is the lower TCP throughput in OpenWRT due to the driver used?</p><p>If not, any pointers or ideas on what to try to improve it? See below things I&#039;ve already tried.</p><p>- Fresh OpenWRT was flashed then the following issued: <em>uci set wireless.radio0.htmode=VHT80; uci set wireless.radio0.disabled=0; uci commit; wifi;</em> ... nothing else was installed or enabled.<br />- I tried using both open (no auth) and WPA/WPA2.<br />- Also tried using channel 149 so I could use 30 dBm Tx power (channel 36 was limited to 17dBm).<br />- Also tried setting sysctl options <em>net.core.rmem_max=2097152</em>, <em>net.core.wmem_max=2097152</em>, <em>net.ipv4.tcp_rmem=4096 87380 2097152</em> and <em>net.ipv4.tcp_wmem=4096 87380 2097152</em>.<br />- Checked the received power strength under both firmwares (under MacOSX &gt; Wireless Diagnostics &gt; Performance) and it was pretty much the same in both cases, around -40 dBm. Channel noise is around -95/-96 dBm. So no saturation.</p><p>Nothing I tried helped getting more throughput under TCP in OpenWRT ... any clues?</p><p>Are there any known kernel modules that take such a toll in OpenWRT? What modules are safe to disable for this simple test? (assuming nothing else is needed)</p><p>Cheers.</p><p>p.s. On wired-to-wired I hit 940+ Mbits/s without much effort on both firmwares, which is expected since only the hardware ethernet switch is used in this case.</p>											<p class="post-edited">(Last edited by <strong>mastabog</strong> on 27 Nov 2014, 05:32)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p252602">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">rseiler</div>
					<div class="post-datetime">
						31 Oct 2014, 07:18					</div>
				</div>
				<div class="post-content content">
					<p>Well done on the extremely thorough job. I&#039;d be very curious what you see with pure-wireless test. With stock, it tops out at around 220 AFAIK.</p><p>All I can add is a general impression made over the years: firmware like OpenWRT and DD-WRT very commonly slow things down. Reports of them speeding things must be very rare, since I don&#039;t remember any.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p252618">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">etan</div>
					<div class="post-datetime">
						31 Oct 2014, 13:07					</div>
				</div>
				<div class="post-content content">
					<p>slow and buggy, if not webcam and ad-blocking on router I would not use it. Whenever I complain some arrogant writes me to build own firmware :-(</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p252631">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">bibocc</div>
					<div class="post-datetime">
						31 Oct 2014, 14:40					</div>
				</div>
				<div class="post-content content">
					<p>What version of OpenWRT did you use for these tests?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p252653">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">drawz</div>
					<div class="post-datetime">
						31 Oct 2014, 17:35					</div>
				</div>
				<div class="post-content content">
					<p>no hardware NAT acceleration in openwrt or dd-wrt. the code released by atheros is not compatible with several openwrt/dd-wrt features.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p252659">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">mastabog</div>
					<div class="post-datetime">
						31 Oct 2014, 17:57					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>bibocc wrote:</cite><blockquote><p>What version of OpenWRT did you use for these tests?</p></blockquote></div><p>As I said in my post &quot;Using OpenWRT 14.07&quot;. I tried recent trunk snapshots, but none work, they all seem broken in many respects; the wireless driver doesn&#039;t even recognize the 5GHz adapter, so the archer-c7 trunk snapshots are pretty useless ...</p><div class="quotebox"><cite>drawz wrote:</cite><blockquote><p>no hardware NAT acceleration in openwrt or dd-wrt. the code released by atheros is not compatible with several openwrt/dd-wrt features.</p></blockquote></div><p>First, the two machines were on the LAN, there&#039;s no WAN or NAT involved (but the bigger and more complex iptables tables in OpenWRT may take a toll, I don&#039;tknow). Still, even if that were to be the reason, then wouldn&#039;t the UDP speed be lower for OpwnWRT? Right now both firmwares get the same speed on UDP. See my original post. It&#039;s just on TCP that things get much slower on OpenWRT.</p>											<p class="post-edited">(Last edited by <strong>mastabog</strong> on 1 Nov 2014, 06:09)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p252680">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">rseiler</div>
					<div class="post-datetime">
						31 Oct 2014, 21:31					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>drawz wrote:</cite><blockquote><p>no hardware NAT acceleration in openwrt or dd-wrt. the code released by atheros is not compatible with several openwrt/dd-wrt features.</p></blockquote></div><p>Isn&#039;t what&#039;s going on above LAN-LAN though?&nbsp; I thought the problem was only WAN-LAN.<br /><a href="https://forum.openwrt.org/viewtopic.php?pid=251532#p251532">https://forum.openwrt.org/viewtopic.php … 32#p251532</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p252706">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">mastabog</div>
					<div class="post-datetime">
						1 Nov 2014, 06:05					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>rseiler wrote:</cite><blockquote><div class="quotebox"><cite>drawz wrote:</cite><blockquote><p>no hardware NAT acceleration in openwrt or dd-wrt. the code released by atheros is not compatible with several openwrt/dd-wrt features.</p></blockquote></div><p>Isn&#039;t what&#039;s going on above LAN-LAN though?&nbsp; I thought the problem was only WAN-LAN.<br /><a href="https://forum.openwrt.org/viewtopic.php?pid=251532#p251532">https://forum.openwrt.org/viewtopic.php … 32#p251532</a></p></blockquote></div><p>The tests were run between two machines on the LAN behind the router, one wired, one wireless. There&#039;s no WAN involved, so no NAT either. However, I don&#039;t know how much the bigger and more complex iptables tables of OpenWRT are taking a toll ... they re clearly not a problem on UDP (both firmwares get the same throughput then). It&#039;s TCP that gets much slower on OpenWRT.</p>											<p class="post-edited">(Last edited by <strong>mastabog</strong> on 1 Nov 2014, 06:10)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p252707">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">drawz</div>
					<div class="post-datetime">
						1 Nov 2014, 06:39					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>rseiler wrote:</cite><blockquote><div class="quotebox"><cite>drawz wrote:</cite><blockquote><p>no hardware NAT acceleration in openwrt or dd-wrt. the code released by atheros is not compatible with several openwrt/dd-wrt features.</p></blockquote></div><p>Isn&#039;t what&#039;s going on above LAN-LAN though?&nbsp; I thought the problem was only WAN-LAN.<br /><a href="https://forum.openwrt.org/viewtopic.php?pid=251532#p251532">https://forum.openwrt.org/viewtopic.php … 32#p251532</a></p></blockquote></div><p>Oops my bad. LAN-LAN shouldn&#039;t be slower though. Did you test with both clients wired? Did you test on both bands of wireless? This would help narrow the problem. Apologies if you already stated this.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p252767">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">mastabog</div>
					<div class="post-datetime">
						1 Nov 2014, 17:54					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>drawz wrote:</cite><blockquote><div class="quotebox"><cite>rseiler wrote:</cite><blockquote><div class="quotebox"><cite>drawz wrote:</cite><blockquote><p>no hardware NAT acceleration in openwrt or dd-wrt. the code released by atheros is not compatible with several openwrt/dd-wrt features.</p></blockquote></div><p>Isn&#039;t what&#039;s going on above LAN-LAN though?&nbsp; I thought the problem was only WAN-LAN.<br /><a href="https://forum.openwrt.org/viewtopic.php?pid=251532#p251532">https://forum.openwrt.org/viewtopic.php … 32#p251532</a></p></blockquote></div><p>Oops my bad. LAN-LAN shouldn&#039;t be slower though. Did you test with both clients wired? Did you test on both bands of wireless? This would help narrow the problem. Apologies if you already stated this.</p></blockquote></div><p>Are you an OpenWRT developer? I did state that on wired neither firmware has a problem and they hit 940+ Mbps. I&#039;m willing to provide more info but it would also help if you read my original report (I don&#039;t mean to be an ass by it, but I did provide detail there which answer both your posts so far).</p><p>Testing on 2.4 GHz would be rather pointless for two reasons:<br />(i) the whole 2.4 GHz spectrum is very crowded here where I live and the results would be skewed due to too much collision avoidance<br />(ii) as I already showed, OpenWRT already achieves 450 Mbits/s on 5GHz at the application level, i.e. 500-600 Mbps at the PHY level. Given that the 2.4GHz band on this router is limited to 450 Mbps PHY (about 350-400 Mbps at application level with large AMPDU), then that would be the bottleneck for both firmwares, both would hit it easily if channels were clean.</p><p>So far I think the problem is OpenWRT&#039;s wifi driver. If it was due to kernel modules or the more complex iptables tables hogging the CPU then the problem would have shown in the UDP or wired tests as well, but there it doesn&#039;t. Monitoring the CPU usage with &quot;top&quot; shows max 6-8% CPU load when doing the TCP iperf test.</p><p>Are there any wifi driver parameters that I could try to tweak with? Anyone has any other ideas?</p>											<p class="post-edited">(Last edited by <strong>mastabog</strong> on 1 Nov 2014, 18:01)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p252785">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">drawz</div>
					<div class="post-datetime">
						1 Nov 2014, 22:56					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>mastabog wrote:</cite><blockquote><div class="quotebox"><cite>drawz wrote:</cite><blockquote><div class="quotebox"><cite>rseiler wrote:</cite><blockquote><p>Isn&#039;t what&#039;s going on above LAN-LAN though?&nbsp; I thought the problem was only WAN-LAN.<br /><a href="https://forum.openwrt.org/viewtopic.php?pid=251532#p251532">https://forum.openwrt.org/viewtopic.php … 32#p251532</a></p></blockquote></div><p>Oops my bad. LAN-LAN shouldn&#039;t be slower though. Did you test with both clients wired? Did you test on both bands of wireless? This would help narrow the problem. Apologies if you already stated this.</p></blockquote></div><p>Are you an OpenWRT developer? I did state that on wired neither firmware has a problem and they hit 940+ Mbps. I&#039;m willing to provide more info but it would also help if you read my original report (I don&#039;t mean to be an ass by it, but I did provide detail there which answer both your posts so far).</p><p>Testing on 2.4 GHz would be rather pointless for two reasons:<br />(i) the whole 2.4 GHz spectrum is very crowded here where I live and the results would be skewed due to too much collision avoidance<br />(ii) as I already showed, OpenWRT already achieves 450 Mbits/s on 5GHz at the application level, i.e. 500-600 Mbps at the PHY level. Given that the 2.4GHz band on this router is limited to 450 Mbps PHY (about 350-400 Mbps at application level with large AMPDU), then that would be the bottleneck for both firmwares, both would hit it easily if channels were clean.</p><p>So far I think the problem is OpenWRT&#039;s wifi driver. If it was due to kernel modules or the more complex iptables tables hogging the CPU then the problem would have shown in the UDP or wired tests as well, but there it doesn&#039;t. Monitoring the CPU usage with &quot;top&quot; shows max 6-8% CPU load when doing the TCP iperf test.</p><p>Are there any wifi driver parameters that I could try to tweak with? Anyone has any other ideas?</p></blockquote></div><p>Not a developer, so I can&#039;t really help much, just brainstorming with you. But I asked about 2.4 Ghz because on this router that uses the Ath9k driver while 5 GHz uses the Ath10k driver. Ath10k is not as mature at this point. I also thought you should test wired to take the wifi driver out of the equation, but it sounds like you&#039;re suspicious of wifi and want to focus on fixing that.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p252789">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">dem</div>
					<div class="post-datetime">
						2 Nov 2014, 00:16					</div>
				</div>
				<div class="post-content content">
					<p>I&nbsp; have 3 of these routers and I&#039;ve had problems with 5Ghz too.&nbsp; &nbsp;I find certain TCP connections get dropped or blocked on 5Ghz but are okay on 2.4Ghz.&nbsp; &nbsp;I&#039;ve upgraded my WIFI clients to the latest Intel wireless drivers too.</p><p>I compiled a new version of 14.07 r42943 to test on one of them (there is a new ath10k firmware version in r42943) but there&#039;s no improvement on 5Ghz.&nbsp; My two others are running 14.07 r42625.&nbsp; &nbsp;</p><p>I&#039;m going to do some more testing using other 5Ghz clients but I agree that ath10k looks pretty immature.<br />I might also try Chaos Calmer as there is at least one further patch to ath10k that might make a difference.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p252917">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">mastabog</div>
					<div class="post-datetime">
						3 Nov 2014, 07:26					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>dem wrote:</cite><blockquote><p>I&#039;m going to do some more testing using other 5Ghz clients but I agree that ath10k looks pretty immature.<br />I might also try Chaos Calmer as there is at least one further patch to ath10k that might make a difference.</p></blockquote></div><p>See my post above about that: all recent trunk spanshops I tried are broken (don&#039;t even see the 5GHz phy, plus other broken things/packages). I&#039;d be surprised if you managed to compile an actual working binary, but do please let us know here, and also please share it if it&#039;s actually any better.</p><div class="quotebox"><cite>drawz wrote:</cite><blockquote><p>Not a developer, so I can&#039;t really help much, just brainstorming with you. But I asked about 2.4 Ghz because on this router that uses the Ath9k driver while 5 GHz uses the Ath10k driver. Ath10k is not as mature at this point. I also thought you should test wired to take the wifi driver out of the equation, but it sounds like you&#039;re suspicious of wifi and want to focus on fixing that.</p></blockquote></div><p>I did test wired (please see above, or the 1st post). As I said, 2.4 GHz would not be a problem since it&#039;s already exceeding the max 2.4 speed and is not of interest anyway. I want it to hit the 800-900 Mbps on 11ac like it does on the native firmware.</p>											<p class="post-edited">(Last edited by <strong>mastabog</strong> on 3 Nov 2014, 08:23)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p252927">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">arokh</div>
					<div class="post-datetime">
						3 Nov 2014, 10:08					</div>
				</div>
				<div class="post-content content">
					<p>You are getting 800-900Mbps on LAN &lt;--&gt; 11ac ?? That must be some kind of record, no? I&#039;ve read lots of reviews of this router and the max throughput I have seen in benchmarks are 400Mbps:</p><p><a href="http://www.smallnetbuilder.com/wireless/wireless-reviews/32498-tp-link-archer-c7-v2-reviewed?showall=&amp;start=2">http://www.smallnetbuilder.com/wireless … mp;start=2</a></p><p>So how is it you are getting double the performance? As far as I know there are very few routers that can actually achieve that kind of speed on wireless.</p><p>You&#039;re actually besting the speed of two paired Asus RT-AC87U routers. No other routers on the market can achieve the speeds you are getting from a router to a laptop. So very curious how you can get results like that.</p><p><a href="http://www.pcworld.com/article/2597549/asus-rt-ac87u-wi-fi-router-review-yes-it-s-fast.html">http://www.pcworld.com/article/2597549/ … -fast.html</a></p>											<p class="post-edited">(Last edited by <strong>arokh</strong> on 3 Nov 2014, 10:21)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p252928">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">trismo</div>
					<div class="post-datetime">
						3 Nov 2014, 10:26					</div>
				</div>
				<div class="post-content content">
					<p>arokh <br />LAN&lt;-&gt;WLAN 800-1000 Mbps<br />WLAN&lt;-&gt;WLAN 400-600 Mbps</p><p>with free frequency band</p>											<p class="post-edited">(Last edited by <strong>trismo</strong> on 3 Nov 2014, 10:39)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p252933">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">arokh</div>
					<div class="post-datetime">
						3 Nov 2014, 11:12					</div>
				</div>
				<div class="post-content content">
					<p>I don&#039;t have ac hardware myself so I can&#039;t confirm this, but your speeds seem impossible considering you are beating the fastest router on the market. See the tests above, how is that possible?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p252972">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">mastabog</div>
					<div class="post-datetime">
						3 Nov 2014, 17:29					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>arokh wrote:</cite><blockquote><p>You are getting 800-900Mbps on LAN &lt;--&gt; 11ac ?? That must be some kind of record, no? I&#039;ve read lots of reviews of this router and the max throughput I have seen in benchmarks are 400Mbps:</p><p><a href="http://www.smallnetbuilder.com/wireless/wireless-reviews/32498-tp-link-archer-c7-v2-reviewed?showall=&amp;start=2">http://www.smallnetbuilder.com/wireless … mp;start=2</a></p><p>So how is it you are getting double the performance? As far as I know there are very few routers that can actually achieve that kind of speed on wireless.</p><p>You&#039;re actually besting the speed of two paired Asus RT-AC87U routers. No other routers on the market can achieve the speeds you are getting from a router to a laptop. So very curious how you can get results like that.</p><p><a href="http://www.pcworld.com/article/2597549/asus-rt-ac87u-wi-fi-router-review-yes-it-s-fast.html">http://www.pcworld.com/article/2597549/ … -fast.html</a></p></blockquote></div><div class="quotebox"><cite>arokh wrote:</cite><blockquote><p>I don&#039;t have ac hardware myself so I can&#039;t confirm this, but your speeds seem impossible considering you are beating the fastest router on the market. See the tests above, how is that possible?</p></blockquote></div><p>I laid out all the details in my first post which clearly answers all your questions and suspicions. You could just read it. If still in doubt, you could buy it and repeat the steps and setup from the 1st post. Otherwise I don&#039;t quite know what to make of your posts (other than you like Asus).</p>											<p class="post-edited">(Last edited by <strong>mastabog</strong> on 3 Nov 2014, 23:35)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p253118">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">arokh</div>
					<div class="post-datetime">
						4 Nov 2014, 21:16					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m just curious more than anything, was just wondering if those speeds are correct or perhaps the test is at fault somehow.</p><p>How is the cpu load when you are testing in openwrt btw?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p253120">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">mastabog</div>
					<div class="post-datetime">
						4 Nov 2014, 21:25					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>arokh wrote:</cite><blockquote><p>I&#039;m just curious more than anything, was just wondering if those speeds are correct or perhaps the test is at fault somehow.</p><p>How is the cpu load when you are testing in openwrt btw?</p></blockquote></div><p>How can the test be at fault? Honestly, it&#039;s all in the 1st post. Feel free to read the details and replicate it. Everything is correct (I copy-pasted the iperf results). It&#039;s not just iperf; using wget to fetch a large file from the Win PC gets the same speed. I also reported the CPU % in a post above, around 6%, which is expected (it&#039;s not doing any NAT).</p>											<p class="post-edited">(Last edited by <strong>mastabog</strong> on 4 Nov 2014, 21:40)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p253129">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">dem</div>
					<div class="post-datetime">
						5 Nov 2014, 00:31					</div>
				</div>
				<div class="post-content content">
					<p>@arokh You might be confusing 2.4Ghz 802.11n with 5Ghz 802.11ac specification.</p><p><a href="http://en.wikipedia.org/wiki/IEEE_802.11ac#Data_rates_and_speed">http://en.wikipedia.org/wiki/IEEE_802.1 … _and_speed</a></p><p>The Archer C7 has two radios - 2.4Ghz and 5Ghz<br />It is actually advertised as AC1750 which is supposed to be 1300 Mbit/s.&nbsp; Of course we will never see those speeds in practice.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p253170">
				<div class="post-metadata">
					<div class="post-num">Post #21</div>
					<div class="post-author">arokh</div>
					<div class="post-datetime">
						5 Nov 2014, 10:24					</div>
				</div>
				<div class="post-content content">
					<p>Not at all, I&#039;m aware of 5GHz theorerical speeds. Like I said, other benchmarks does not even come close to gigabit speeds have a look around. Was just looking for an explanation about that, perhaps reviewers aren&#039;t using clients capable of utilizing several streams, I don&#039;t know.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p253209">
				<div class="post-metadata">
					<div class="post-num">Post #22</div>
					<div class="post-author">mastabog</div>
					<div class="post-datetime">
						5 Nov 2014, 17:48					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>arokh wrote:</cite><blockquote><p>Not at all, I&#039;m aware of 5GHz theorerical speeds. Like I said, other benchmarks does not even come close to gigabit speeds have a look around. Was just looking for an explanation about that, perhaps reviewers aren&#039;t using clients capable of utilizing several streams, I don&#039;t know.</p></blockquote></div><p>I don&#039;t wish to sound cross, but this is getting odd and very off-topic. The results are correct and other 11ac routers get the same speeds. Even <a href="http://www.pcworld.com/article/2597549/asus-rt-ac87u-wi-fi-router-review-yes-it-s-fast.html">the link you provided</a> shows 850+ Mbps 11ac speeds -- look at the <em>first graph</em>. </p><p>Let&#039;s please get back to the actual topic, i.e. the fact that OpenWRT gets consistently lower speeds than the native firmware.</p>											<p class="post-edited">(Last edited by <strong>mastabog</strong> on 7 Nov 2014, 00:25)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p253572">
				<div class="post-metadata">
					<div class="post-num">Post #23</div>
					<div class="post-author">emmeff</div>
					<div class="post-datetime">
						8 Nov 2014, 03:36					</div>
				</div>
				<div class="post-content content">
					<p>Is anybody actively working on this? I just got an Archer C7 this week and am dying to get off the stock firmware (I need a DNS server, for example).</p><p>I am pleased with the stock firmware and don&#039;t want to lose any performance going with OpenWRT.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p253573">
				<div class="post-metadata">
					<div class="post-num">Post #24</div>
					<div class="post-author">dem</div>
					<div class="post-datetime">
						8 Nov 2014, 04:06					</div>
				</div>
				<div class="post-content content">
					<p>Okay so I&#039;ve compiled a new Chaos Calmer (r43186) for the Archer C7 and I actually need to correct a statement I made earlier.&nbsp; &nbsp;This new CC version has the new ATH10K firmware version 3 whereas my later BB build has the same firmware version 2 as my earlier BB (r42943 and r42625 respectively).</p><p>I ran out of time today to test the 5Ghz as I decided to run your iperf tests on BB before hand to see if there was any difference between BB and CC with the new firmware.</p><p>Unfortunately I found I was getting very poor 5Ghz wireless speeds so I decided to installed iperf on the BB C7 router and run the same tests between the router and a server but this time solely via Ethernet.&nbsp; <br />This time the maximum TCP speeds I got was just over 200Mbits/sec!?&nbsp; This is supposed to be on Gigabit Ethernet.</p><p>I ran &quot;swconfig dev switch0 show&quot; to check that the C7 was connected via Gigabit.&nbsp; Indeed it was.&nbsp; I thought maybe the old Ethernet cabling in the building wasn&#039;t rated CAT5e or higher so I ran some tests between servers and got over 1.6 Gigabit/sec and finally between a Windows 7 desktop and a server (on a long cable run) and got consistently over 870Mbits/sec</p><p>I thought maybe iperf was maxing out the CPU on the C7 and hence that was causing the slow down but &quot;top&quot; confirmed iperf was using less than 70% CPU and it had plenty spare idle.&nbsp; &nbsp; I ran the same iperf tests on the older BB version and still got just over 200Mbit/sec.</p><p>I just wonder whether the slow 200Mbit/sec speed is still down to the C7 resources.&nbsp; I will see if I can do some profiling on Openwrt to see why iperf delivers such poor Ethernet speeds on the C7.&nbsp; &nbsp; Maybe I need to adjust some settings with sysctl to improve TCP speeds.</p><p>@Mastabog&nbsp; Any chance you&#039;d be able to run the same Ethernet tests on you C7 to see what you get?<br />I&#039;m keen to test the new CC build&#039;s 5Ghz speeds next week but I want to be sure the bottleneck isn&#039;t going to be on the Ethernet first.</p><p>Has anyone else done Ethernet benchmarking on Openwrt using iPerf?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p253596">
				<div class="post-metadata">
					<div class="post-num">Post #25</div>
					<div class="post-author">alphasparc</div>
					<div class="post-datetime">
						8 Nov 2014, 11:28					</div>
				</div>
				<div class="post-content content">
					<p>You need to be more specific.<br />There are different types of Ethernet Test.<br />If you put the client and the server on the same network where there is no translation of IP Address then you are testing LAN to LAN throughput<br />If you put the client and the server on different network where there is translation of IP Address then you are testing LAN to WAN throughput.</p>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 1 of 9</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=53703&amp;p=2.html">2</a></li><li><a href="viewtopic.php%3Fid=53703&amp;p=3.html">3</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=53703&amp;p=9.html">9</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>