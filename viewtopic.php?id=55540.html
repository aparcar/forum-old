<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> NORDVPN has a new script which works.</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 22 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p263958">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">chuxxsss67</div>
					<div class="post-datetime">
						3 Feb 2015, 09:12					</div>
				</div>
				<div class="post-content content">
					<p>Hi all,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;I am new to OpenWRT and was using DD-WRT before this but found Openwrt worked better for me on my WDR4300 router. Here is the script which may help others config your router to work with NordVPN servers. It may work for other VPN, but I have not tested it. </p><p>#!/bin/sh</p><p>USERNAME=&quot;Username&quot;<br />PASSWORD=&quot;Password&quot;</p><p>PROTO=&quot;udp&quot;<br />TUN=&quot;tun1&quot;<br />REMOTE=&quot;remote vpn-nl.nordvpn.com 1194&quot;</p><p>CA_CRT=&#039;-----BEGIN CERTIFICATE-----<br />MIID7DCCA1WgAwIBAgIJAJBW0AnvvfI9MA0GCSqGSIb3DQEBBQUAMIGrMQswCQYD<br />VQQGEwJOTDELMAkGA1UECBMCTkwxFTATBgNVBAcTDFNhbkZyYW5jaXNjbzEQMA4G<br />A1UEChMHTm9yZFZQTjELMAkGA1UECxMCTkwxGzAZBgNVBAMTEnZwbi1ubC5ub3Jk<br />dnBuLmNvbTEbMBkGA1UEKRMSdnBuLW5sLm5vcmR2cG4uY29tMR8wHQYJKoZIhvcN<br />AQkBFhBtYWlsQGhvc3QuZG9tYWluMB4XDTE0MDQyMjEwMjY0OVoXDTI0MDQxOTEw<br />MjY0OVowgasxCzAJBgNVBAYTAk5MMQswCQYDVQQIEwJOTDEVMBMGA1UEBxMMU2Fu<br />RnJhbmNpc2NvMRAwDgYDVQQKEwdOb3JkVlBOMQswCQYDVQQLEwJOTDEbMBkGA1UE<br />AxMSdnBuLW5sLm5vcmR2cG4uY29tMRswGQYDVQQpExJ2cG4tbmwubm9yZHZwbi5j<br />b20xHzAdBgkqhkiG9w0BCQEWEG1haWxAaG9zdC5kb21haW4wgZ8wDQYJKoZIhvcN<br />AQEBBQADgY0AMIGJAoGBANWLMY7HjzfL0zgWCmCCQRNxoqbhi1Kxd5/U/uJgPmME<br />nKTp89kQ3janQJTsIK/M8r96C+YgTua9ElRTIri6GmAD8lAfMV5CujI5N9iEs8AU<br />Bl3x8T22nzmTI+IYF+qBPp6g+ks+5/LiYNVBbIebNnnwvWZDBNenTRCITE/8ymsH<br />AgMBAAGjggEUMIIBEDAdBgNVHQ4EFgQU7tE7MjUdkRr+n2h3faMRty3zs/8wgeAG<br />A1UdIwSB2DCB1YAU7tE7MjUdkRr+n2h3faMRty3zs/+hgbGkga4wgasxCzAJBgNV<br />BAYTAk5MMQswCQYDVQQIEwJOTDEVMBMGA1UEBxMMU2FuRnJhbmNpc2NvMRAwDgYD<br />VQQKEwdOb3JkVlBOMQswCQYDVQQLEwJOTDEbMBkGA1UEAxMSdnBuLW5sLm5vcmR2<br />cG4uY29tMRswGQYDVQQpExJ2cG4tbmwubm9yZHZwbi5jb20xHzAdBgkqhkiG9w0B<br />CQEWEG1haWxAaG9zdC5kb21haW6CCQCQVtAJ773yPTAMBgNVHRMEBTADAQH/MA0G<br />CSqGSIb3DQEBBQUAA4GBAIOc3yXYw7O7D+lPXrOW2CYcsGKnXS5+9Kvn+rOTOCMH<br />4+GlSW38gwiUCYi7C2kH52VhMOLMmYosVQZMRgNRAB0immKUi1JaVq5UDkOgo+rK<br />keifSsGBJH4dnKUrG5lOQ7tGA88oT4Qlal6U1tFe2tR7keSXWVZYwtPz6jIrzK3q<br />-----END CERTIFICATE-----&#039;</p><p>TLS_AUTH=&#039;-----BEGIN OpenVPN Static key V1-----<br />6ee32f05bd25efbd64cf08a469c6aa36<br />755dab4ea4cfa434c708faa51426848e<br />afaab0e7d275af6924aaa8fd48d5098d<br />7cd50b5a79d80fb85a0bcb0a9b2ec4d9<br />f021e8d8584902736f8090a98e2eea88<br />edbd26dc88361bac87d2151ade2f67be<br />0ffd5fcf26a1d72ac7374079b46a79e8<br />df52be0a49d590d80ad9bcc67ea5a01d<br />0e2629b3de628c3e29229d8cda7c1fa1<br />45111ecd7b123fda2d831216eab6c01b<br />2d00a0a0c48109f2d0903bd93e8a0088<br />c861d0b1d34513f01e075b655441662f<br />d36b27a51841dffd7abc8535550330f6<br />17266a0d891f55a6be533de8ec6483bc<br />c36a67ed57e215861ab408cbc218bb24<br />a6cbc028cfbf56a6b11ff64ed7073be0<br />-----END OpenVPN Static key V1-----&#039;</p><p>#### Don&#039;t modify below here ####</p><p>#### Ensure gui client disabled ####<br />if [ `nvram get openvpncl_enable` != 0 ]; then<br />&nbsp; &nbsp;nvram set openvpncl_enable=0<br />&nbsp; &nbsp;nvram commit<br />&nbsp; &nbsp;sleep 10<br />fi</p><p>mkdir /tmp/vpncl; cd /tmp/vpncl</p><p>echo -e &quot;$USERNAME\n$PASSWORD&quot; &gt; userpass.txt</p><p>echo &quot;#!/bin/sh<br />iptables -t nat -I POSTROUTING -o $TUN -j MASQUERADE&quot; &gt; route-up.sh</p><p>echo &quot;#!/bin/sh<br />iptables -t nat -D POSTROUTING -o $TUN -j MASQUERADE&quot; &gt; route-down.sh</p><p>echo &quot;$CA_CRT&quot; &gt; ca.crt<br />echo &quot;$TLS_AUTH&quot; &gt; tls-auth.key<br />sleep 10</p><p>echo &quot;client<br />dev $TUN<br />proto $PROTO</p><p>$REMOTE<br />resolv-retry infinite<br />nobind</p><p>tun-mtu 1500<br />tun-mtu-extra 32<br />mssfix 1450</p><p>persist-key<br />persist-tun<br />keepalive 5 30</p><p>comp-lzo<br />mute 20<br />verb 3<br />log-append vpn.log<br />fast-io</p><p>auth-user-pass userpass.txt<br />script-security 2<br />remote-cert-tls server<br />cipher AES-256-CBC</p><p>ca ca.crt<br />tls-auth tls-auth.key 1</p><p>daemon&quot; &gt; openvpn.conf</p><p>chmod 600 ca.crt tls-auth.key userpass.txt openvpn.conf; chmod 700 route-up.sh route-down.sh</p><p>(killall openvpn ; openvpn --config openvpn.conf --route-up /tmp/vpncl/route-up.sh --down-pre /tmp/vpncl/route-down.sh) &amp;</p><p>exit 0</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p315116">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">ttl</div>
					<div class="post-datetime">
						16 Mar 2016, 15:27					</div>
				</div>
				<div class="post-content content">
					<p>@chuxxsss67: Thank you for posting this. Can you (or someone else) please explain what to do with this script?</p><p>I mean, is it an init script? How do you create it and how do you activate it? And then what other steps are needed in order to make the connection?</p><p>I&#039;m using openwrt on a TP-Link TL-WR740N.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p328142">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">zzrqgyqk</div>
					<div class="post-datetime">
						12 Jun 2016, 02:59					</div>
				</div>
				<div class="post-content content">
					<p>HI,</p><p>From SSH terminal do:</p><p>opkg update<br />opkg install openvpn-openssl luci-app-openvpn</p><p>vi /etc/config/openvpn</p><p>Add this lines</p><p>config openvpn &#039;NordVPNUK2TCP&#039;<br />&nbsp; &nbsp; option dev &#039;tun&#039;<br />&nbsp; &nbsp; option proto &#039;tcp&#039;<br />&nbsp; &nbsp; option nobind &#039;1&#039;<br />&nbsp; &nbsp; option verb &#039;3&#039;<br />&nbsp; &nbsp; option comp_lzo &#039;yes&#039;<br />&nbsp; &nbsp; option persist_tun &#039;1&#039;<br />&nbsp; &nbsp; option persist_key &#039;1&#039;<br />&nbsp; &nbsp; option client &#039;1&#039;<br />&nbsp; &nbsp; option fast_io &#039;1&#039;<br />&nbsp; &nbsp; option pull &#039;1&#039;<br />&nbsp; &nbsp; option resolv_retry &#039;infinite&#039;<br />&nbsp; &nbsp; option tun_mtu &#039;1500&#039;<br />&nbsp; &nbsp; option tun_mtu_extra &#039;32&#039;<br />&nbsp; &nbsp; option ping &#039;15&#039;<br />&nbsp; &nbsp; option ping_restart &#039;0&#039;<br />&nbsp; &nbsp; option ping_timer_rem &#039;1&#039;<br />&nbsp; &nbsp; option reneg_sec &#039;0&#039;<br />&nbsp; &nbsp; option remote_cert_tls &#039;server&#039;<br />&nbsp; &nbsp; option auth_user_pass &#039;/etc/openvpn/userpass.txt&#039;<br />&nbsp; &nbsp; option cipher &#039;AES-256-CBC&#039;<br />&nbsp; &nbsp; option auth_nocache &#039;1&#039;<br />&nbsp; &nbsp; option port &#039;443&#039;<br />&nbsp; &nbsp; option remote &#039;213.229.103.90&#039;<br />&nbsp; &nbsp; option log_append &#039;/var/log/openvpn.log&#039;<br />&nbsp; &nbsp; option ca &#039;/lib/uci/upload/cbid.openvpn.NordVPNUK2TCP.ca&#039;<br />&nbsp; &nbsp; option tls_auth &#039;/etc/openvpn/tlsauth.key 1&#039;<br />&nbsp; &nbsp; option enabled &#039;1&#039;</p><br /><p>Open your uk2.nordvpn.com.tcp443.ovpn downloaded from nordvpn.com</p><p>Copy from -----BEGIN CERTIFICATE-----&nbsp; to&nbsp; &nbsp;-----END CERTIFICATE-----&nbsp; &nbsp;of &lt;ca&gt; &lt;/ca&gt; section into a file name /lib/uci/upload/cbid.openvpn.NordVPNUK2TCP.ca<br />Copy from -----BEGIN OpenVPN Static key V1-----&nbsp; &nbsp;to&nbsp; &nbsp;-----END OpenVPN Static key V1-----&nbsp; &nbsp;of &lt;tls-auth&gt; &lt;/tls-auth&gt; section into file /etc/openvpn/tlsauth.key</p><p>Add this to your /etc/config/network file</p><p>config interface &#039;NordVPN&#039;<br />&nbsp; &nbsp; option proto &#039;none&#039;<br />&nbsp; &nbsp; option ifname &#039;tun0<br />&nbsp; &nbsp; <br />Add this to your /etc/config/firewall file</p><p>config zone<br />&nbsp; &nbsp; option name &#039;VPN&#039;<br />&nbsp; &nbsp; option input &#039;REJECT&#039;<br />&nbsp; &nbsp; option forward &#039;REJECT&#039;<br />&nbsp; &nbsp; option output &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option masq &#039;1&#039;<br />&nbsp; &nbsp; option mtu_fix &#039;1&#039;<br />&nbsp; &nbsp; option network &#039;NordVPN&#039;</p><p>config forwarding<br />&nbsp; &nbsp; option dest &#039;VPN&#039;<br />&nbsp; &nbsp; option src &#039;lan&#039;<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; <br />Add username and password (username on first line, password on second line) of file /etc/openvpn/userpass.txt</p><p>Create logfile with touch /var/log/openvpn.log</p><p>From openwrt webinterface on Services -&gt; OpenVPN check the enabled flag on nordvpn configuration and click start.</p><p>If u wanna use other server insterad of uk2 server with TCP you can change &quot;option remote SERVERIPADDRESSACCORDINTOOVPN&quot; the certificate and the certificate key accordint to your<br />preferred openvpn server.</p><p>Bye</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p338546">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">zed0</div>
					<div class="post-datetime">
						18 Sep 2016, 15:36					</div>
				</div>
				<div class="post-content content">
					<p>Hi I am new do OpenWRT and already love it.<br />Thank you for the instructions.<br />I was looking for a quide and trying different instructions for days!<br />Resetting router many times and almost gave up.<br /><strong>This one finally works!</strong></p><p>My advice for less advanced users:<br />1 Freshly flashed Openwrt<br />2 go to 192.168.1.1 and change password<br />3 go to /Network/WIFI and setup an active WIFI connection<br />4 System/backup configuration/<br />5 I backup config quite often and rename according to progress<br />&nbsp; &nbsp;example: <em>backup-OpenWrt-2016-09-18.clean.Admin.Wifi.SFTP.tar.gz</em><br />6 from now I can do everything without cable<br />7 in case of problems I reset router and restore backed up configuration each time until success!</p><p>Go to: WebGui/system/software/ <br />-click on update lists<br />-available packages --&gt; openssh-sftp-server --&gt; install<br />Now I am able to use Mobaxterm (SFTP client) to edit all the files (RightMouseClick --&gt; MobaTextEditor).<br />As a SSH terminal I use SmarTTY:<br />I don&#039;t use VI editor.<br />I use builtin MobaTextEditor instead to save lots of time.</p><p>Only small detail I found is in /etc/config/network file:</p><p><strong>is:</strong><br /><em>config interface &#039;NordVPN&#039;<br />&nbsp; &nbsp; option proto &#039;none&#039;<br />&nbsp; &nbsp; option ifname &#039;tun0</em></p><p><strong>should be:</strong><br /><em>config interface &#039;NordVPN&#039;<br />&nbsp; &nbsp; option proto &#039;none&#039;<br />&nbsp; &nbsp; option ifname &#039;tun0&#039;<br /></em></p><p>Regards!</p><br /><div class="quotebox"><cite>zzrqgyqk wrote:</cite><blockquote><p>HI,</p><p>From SSH terminal do:</p><p>opkg update<br />opkg install openvpn-openssl luci-app-openvpn</p><p>vi /etc/config/openvpn</p><p>Add this lines</p><p>config openvpn &#039;NordVPNUK2TCP&#039;<br />&nbsp; &nbsp; option dev &#039;tun&#039;<br />&nbsp; &nbsp; option proto &#039;tcp&#039;<br />&nbsp; &nbsp; option nobind &#039;1&#039;<br />&nbsp; &nbsp; option verb &#039;3&#039;<br />&nbsp; &nbsp; option comp_lzo &#039;yes&#039;<br />&nbsp; &nbsp; option persist_tun &#039;1&#039;<br />&nbsp; &nbsp; option persist_key &#039;1&#039;<br />&nbsp; &nbsp; option client &#039;1&#039;<br />&nbsp; &nbsp; option fast_io &#039;1&#039;<br />&nbsp; &nbsp; option pull &#039;1&#039;<br />&nbsp; &nbsp; option resolv_retry &#039;infinite&#039;<br />&nbsp; &nbsp; option tun_mtu &#039;1500&#039;<br />&nbsp; &nbsp; option tun_mtu_extra &#039;32&#039;<br />&nbsp; &nbsp; option ping &#039;15&#039;<br />&nbsp; &nbsp; option ping_restart &#039;0&#039;<br />&nbsp; &nbsp; option ping_timer_rem &#039;1&#039;<br />&nbsp; &nbsp; option reneg_sec &#039;0&#039;<br />&nbsp; &nbsp; option remote_cert_tls &#039;server&#039;<br />&nbsp; &nbsp; option auth_user_pass &#039;/etc/openvpn/userpass.txt&#039;<br />&nbsp; &nbsp; option cipher &#039;AES-256-CBC&#039;<br />&nbsp; &nbsp; option auth_nocache &#039;1&#039;<br />&nbsp; &nbsp; option port &#039;443&#039;<br />&nbsp; &nbsp; option remote &#039;213.229.103.90&#039;<br />&nbsp; &nbsp; option log_append &#039;/var/log/openvpn.log&#039;<br />&nbsp; &nbsp; option ca &#039;/lib/uci/upload/cbid.openvpn.NordVPNUK2TCP.ca&#039;<br />&nbsp; &nbsp; option tls_auth &#039;/etc/openvpn/tlsauth.key 1&#039;<br />&nbsp; &nbsp; option enabled &#039;1&#039;</p><br /><p>Open your uk2.nordvpn.com.tcp443.ovpn downloaded from nordvpn.com</p><p>Copy from -----BEGIN CERTIFICATE-----&nbsp; to&nbsp; &nbsp;-----END CERTIFICATE-----&nbsp; &nbsp;of &lt;ca&gt; &lt;/ca&gt; section into a file name /lib/uci/upload/cbid.openvpn.NordVPNUK2TCP.ca<br />Copy from -----BEGIN OpenVPN Static key V1-----&nbsp; &nbsp;to&nbsp; &nbsp;-----END OpenVPN Static key V1-----&nbsp; &nbsp;of &lt;tls-auth&gt; &lt;/tls-auth&gt; section into file /etc/openvpn/tlsauth.key</p><p>Add this to your /etc/config/network file</p><p>config interface &#039;NordVPN&#039;<br />&nbsp; &nbsp; option proto &#039;none&#039;<br />&nbsp; &nbsp; option ifname &#039;tun0<br />&nbsp; &nbsp; <br />Add this to your /etc/config/firewall file</p><p>config zone<br />&nbsp; &nbsp; option name &#039;VPN&#039;<br />&nbsp; &nbsp; option input &#039;REJECT&#039;<br />&nbsp; &nbsp; option forward &#039;REJECT&#039;<br />&nbsp; &nbsp; option output &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option masq &#039;1&#039;<br />&nbsp; &nbsp; option mtu_fix &#039;1&#039;<br />&nbsp; &nbsp; option network &#039;NordVPN&#039;</p><p>config forwarding<br />&nbsp; &nbsp; option dest &#039;VPN&#039;<br />&nbsp; &nbsp; option src &#039;lan&#039;<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; <br />Add username and password (username on first line, password on second line) of file /etc/openvpn/userpass.txt</p><p>Create logfile with touch /var/log/openvpn.log</p><p>From openwrt webinterface on Services -&gt; OpenVPN check the enabled flag on nordvpn configuration and click start.</p><p>If u wanna use other server insterad of uk2 server with TCP you can change &quot;option remote SERVERIPADDRESSACCORDINTOOVPN&quot; the certificate and the certificate key accordint to your<br />preferred openvpn server.</p><p>Bye</p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p342160">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">dart</div>
					<div class="post-datetime">
						26 Oct 2016, 15:00					</div>
				</div>
				<div class="post-content content">
					<p>Great, it finally works for me as well!<br />Unfortunately there&#039;s also side effect. I lost possibility to login to router via SSH from WAN side. I guess new part of /etc/config/firewall is guilty. Could you suggest the way to make ssh port back open again?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p343359">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">ulmwind</div>
					<div class="post-datetime">
						9 Nov 2016, 15:35					</div>
				</div>
				<div class="post-content content">
					<p>Firstly, OpenWRT contains standard implementation of OpenVPN, so the most simple approach is to use configuration files *.ovpn directly. In this case the configuration is very simple. It is described very well on Streisand page.</p><p>Secondly, using ssh to login to VPN-client rises some questions. If you get virtual IP from VPN-server, server should forward specific port to you. If you get real IP from VPN-server, server should accept incoming connections to this IP. Furthermore, your firewall settings should accept incoming connections via VPN-specific interface. Another approach is to make VPN-client to send packets corresponding to established connection with specific port to WAN interface, not by default route via VPN-specific interface. It is attained by route configuration (of course, without VPN-connection it should accept incoming connections via ssh to specific port).</p>											<p class="post-edited">(Last edited by <strong>ulmwind</strong> on 10 Nov 2016, 11:40)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p366753">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">ELI5</div>
					<div class="post-datetime">
						15 Oct 2017, 20:00					</div>
				</div>
				<div class="post-content content">
					<p>Hello there, I followed your instructions and clicked on &#039;start&#039; as per the last step.</p><p>It says &#039;started (2998)&#039;, but it appears that im still not connected. my ip addresses show with my current location.</p><p>How can i address that? </p><p>Thanks!!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p366827">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">ulmwind</div>
					<div class="post-datetime">
						16 Oct 2017, 21:23					</div>
				</div>
				<div class="post-content content">
					<p>Use my updated manual: <a href="https://forum.openwrt.org/viewtopic.php?id=71153">https://forum.openwrt.org/viewtopic.php?id=71153</a></p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>