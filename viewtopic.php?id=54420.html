<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> TL-MR3020 eth0: link down</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 30 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p256647">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">av77</div>
					<div class="post-datetime">
						5 Dec 2014, 14:50					</div>
				</div>
				<div class="post-content content">
					<p>Hello, </p><p>Recently I&#039;ve flashed my box to OpenWrt&nbsp; r43436 and noticed that eth0 doesn&#039;t work properly. </p><p>eth0 interface is up only in two cases </p><p>1. booting with unplugged ethernet cable and plugging it after boot</p><p>2. booting with debug mode</p><br /><p>Any idea why in normal boot eth0 is not active ?</p><p>Thanks</p><br /><p>Default boot log:<br /></p><div class="quotebox"><blockquote><p>[&nbsp; &nbsp; 1.250000] eth0: Atheros AG71xx at 0xb9000000, irq 4, mode:MII<br />[&nbsp; &nbsp; 1.260000] TCP: cubic registered<br />[&nbsp; &nbsp; 1.260000] NET: Registered protocol family 17<br />[&nbsp; &nbsp; 1.270000] Bridge firewalling registered<br />[&nbsp; &nbsp; 1.270000] 8021q: 802.1Q VLAN Support v1.8<br />[&nbsp; &nbsp; 1.290000] VFS: Mounted root (squashfs filesystem) readonly on device 31:2.<br />[&nbsp; &nbsp; 1.290000] Freeing unused kernel memory: 228K (80377000 - 803b0000)<br />procd: Console is alive<br />procd: - watchdog -<br />[&nbsp; &nbsp; 4.020000] usbcore: registered new interface driver usbfs<br />[&nbsp; &nbsp; 4.030000] usbcore: registered new interface driver hub<br />[&nbsp; &nbsp; 4.030000] usbcore: registered new device driver usb<br />[&nbsp; &nbsp; 4.040000] ehci_hcd: USB 2.0 &#039;Enhanced&#039; Host Controller (EHCI) Driver<br />[&nbsp; &nbsp; 4.050000] ehci-platform: EHCI generic platform driver<br />[&nbsp; &nbsp; 4.050000] ehci-platform ehci-platform: EHCI Host Controller<br />[&nbsp; &nbsp; 4.060000] ehci-platform ehci-platform: new USB bus registered, assigned bus number 1<br />[&nbsp; &nbsp; 4.070000] ehci-platform ehci-platform: irq 3, io mem 0x1b000000<br />[&nbsp; &nbsp; 4.090000] ehci-platform ehci-platform: USB 2.0 started, EHCI 1.00<br />[&nbsp; &nbsp; 4.090000] hub 1-0:1.0: USB hub found<br />[&nbsp; &nbsp; 4.090000] hub 1-0:1.0: 1 port detected<br />[&nbsp; &nbsp; 4.100000] ohci_hcd: USB 1.1 &#039;Open&#039; Host Controller (OHCI) Driver<br />[&nbsp; &nbsp; 4.110000] ohci-platform: OHCI generic platform driver<br />procd: - preinit -<br />md5sum: can&#039;t open &#039;/lib/firmware/ath10k/QCA988X/hw2.0/firmware-3.bin&#039;: No such file or directory<br />[&nbsp; &nbsp; 5.070000] random: mktemp urandom read with 62 bits of entropy available<br />Press the [f] key and hit [enter] to enter failsafe mode<br />Press the [1], [2], [3] or [4] key and hit [enter] to select the debug level<br />[&nbsp; &nbsp; 7.380000] eth0: link up (100Mbps/Full duplex)<br />jffs2 is ready<br />jffs2 is ready<br />[&nbsp; &nbsp; 8.410000] jffs2: notice: (337) jffs2_build_xattr_subsystem: complete building xattr subsystem, 1 of xdatum (1 unchecked, 0 orphan) and 31 of xref (0 dead, 3 orphan) found.<br />switching to overlay<br /><strong>[&nbsp; &nbsp; 8.470000] eth0: link down</strong><br />procd: - early -<br />procd: - watchdog -<br />procd: - ubus -<br />procd: - init -<br />Please press Enter to activate this console.<br />procd: - init complete -<br />[&nbsp; &nbsp;18.770000] device eth0 entered promiscuous mode<br />[&nbsp; &nbsp;35.110000] random: nonblocking pool is initialized</p><p>BusyBox v1.22.1 (2014-11-30 14:53:50 UTC) built-in shell (ash)<br />Enter &#039;help&#039; for a list of built-in commands.</p><p>&nbsp; _______&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;________&nbsp; &nbsp; &nbsp; &nbsp; __<br /> |&nbsp; &nbsp; &nbsp; &nbsp;|.-----.-----.-----.|&nbsp; |&nbsp; |&nbsp; |.----.|&nbsp; |_<br /> |&nbsp; &nbsp;-&nbsp; &nbsp;||&nbsp; _&nbsp; |&nbsp; -__|&nbsp; &nbsp; &nbsp;||&nbsp; |&nbsp; |&nbsp; ||&nbsp; &nbsp;_||&nbsp; &nbsp;_|<br /> |_______||&nbsp; &nbsp;__|_____|__|__||________||__|&nbsp; |____|<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |__| W I R E L E S S&nbsp; &nbsp;F R E E D O M<br /> -----------------------------------------------------<br /> CHAOS CALMER (Bleeding Edge, r43436)<br /> -----------------------------------------------------</p></blockquote></div><p>Debug boot log:<br /></p><div class="quotebox"><blockquote><p>[&nbsp; &nbsp; 1.250000] eth0: Atheros AG71xx at 0xb9000000, irq 4, mode:MII<br />[&nbsp; &nbsp; 1.260000] TCP: cubic registered<br />[&nbsp; &nbsp; 1.260000] NET: Registered protocol family 17<br />[&nbsp; &nbsp; 1.270000] Bridge firewalling registered<br />[&nbsp; &nbsp; 1.270000] 8021q: 802.1Q VLAN Support v1.8<br />[&nbsp; &nbsp; 1.290000] VFS: Mounted root (squashfs filesystem) readonly on device 31:2.<br />[&nbsp; &nbsp; 1.290000] Freeing unused kernel memory: 228K (80377000 - 803b0000)<br />procd: Console is alive<br />procd: - watchdog -<br />[&nbsp; &nbsp; 4.020000] usbcore: registered new interface driver usbfs<br />[&nbsp; &nbsp; 4.030000] usbcore: registered new interface driver hub<br />[&nbsp; &nbsp; 4.030000] usbcore: registered new device driver usb<br />[&nbsp; &nbsp; 4.040000] ehci_hcd: USB 2.0 &#039;Enhanced&#039; Host Controller (EHCI) Driver<br />[&nbsp; &nbsp; 4.050000] ehci-platform: EHCI generic platform driver<br />[&nbsp; &nbsp; 4.050000] ehci-platform ehci-platform: EHCI Host Controller<br />[&nbsp; &nbsp; 4.060000] ehci-platform ehci-platform: new USB bus registered, assigned bus number 1<br />[&nbsp; &nbsp; 4.070000] ehci-platform ehci-platform: irq 3, io mem 0x1b000000<br />[&nbsp; &nbsp; 4.090000] ehci-platform ehci-platform: USB 2.0 started, EHCI 1.00<br />[&nbsp; &nbsp; 4.090000] hub 1-0:1.0: USB hub found<br />[&nbsp; &nbsp; 4.090000] hub 1-0:1.0: 1 port detected<br />[&nbsp; &nbsp; 4.100000] ohci_hcd: USB 1.1 &#039;Open&#039; Host Controller (OHCI) Driver<br />[&nbsp; &nbsp; 4.110000] ohci-platform: OHCI generic platform driver<br />procd: - preinit -<br />md5sum: can&#039;t open &#039;/lib/firmware/ath10k/QCA988X/hw2.0/firmware-3.bin&#039;: No such file or directory<br />[&nbsp; &nbsp; 5.070000] random: mktemp urandom read with 62 bits of entropy available<br />Press the [f] key and hit [enter] to enter failsafe mode<br />Press the [1], [2], [3] or [4] key and hit [enter] to select the debug level<br />2<br />jffs2 is ready<br />jffs2 is ready<br />[&nbsp; &nbsp; 6.830000] jffs2: notice: (337) jffs2_build_xattr_subsystem: complete building xattr subsystem, 1 of xdatum (1 unchecked, 0 orphan) and 31 of xref (0 dead, 3 orphan) found.<br />switching to overlay<br />procd: - early -<br />procd: watchdog_init(108): Watchdog handover: fd=3<br />procd: - watchdog -<br />procd: - ubus -<br />procd: service_handle_set(244): Create service ubus<br />procd: service_instance_update(66): Create instance ubus::instance1<br />procd: instance_start(201): Started instance ubus::instance1<br />procd: _rc(135): running /etc/init.d/ubus running<br />procd: _rc(138): glob failed on /etc/init.d/ubus<br />Command failed: Not found<br />procd: ubus_connect_cb(58): Connected to ubus, id=d3350cb3<br />procd: - init -<br />procd: _rc(135): running /etc/rc.d/S* boot<br />procd: q_initd_run(71): start /etc/rc.d/S00sysfixtime boot<br />Please press Enter to activate this console.<br />procd: q_initd_complete(101): stop /etc/rc.d/S00sysfixtime boot<br />procd: q_initd_run(71): start /etc/rc.d/S10boot boot<br />procd: q_initd_complete(101): stop /etc/rc.d/S10boot boot<br />procd: q_initd_run(71): start /etc/rc.d/S10system boot<br />procd: service_handle_set(244): Create service system<br />procd: _rc(135): running /etc/init.d/system running<br />procd: q_initd_run(71): start /etc/init.d/system running<br />procd: q_initd_complete(101): stop /etc/rc.d/S10system boot<br />procd: q_initd_run(71): start /etc/rc.d/S11sysctl boot<br />procd: q_initd_complete(101): stop /etc/rc.d/S11sysctl boot<br />procd: q_initd_run(71): start /etc/rc.d/S12log boot<br />procd: q_initd_complete(101): stop /etc/init.d/system running<br />procd: service_handle_set(244): Create service log<br />procd: service_instance_update(66): Create instance log::instance1<br />procd: instance_start(201): Started instance log::instance1<br />procd: _rc(135): running /etc/init.d/log running<br />procd: q_initd_run(71): start /etc/init.d/log running<br />procd: q_initd_complete(101): stop /etc/rc.d/S12log boot<br />procd: q_initd_run(71): start /etc/rc.d/S19firewall boot<br />procd: q_initd_complete(101): stop /etc/init.d/log running<br />procd: service_handle_set(244): Create service firewall<br />procd: _rc(135): running /etc/init.d/firewall running<br />procd: q_initd_run(71): start /etc/init.d/firewall running<br />procd: q_initd_complete(101): stop /etc/rc.d/S19firewall boot<br />procd: q_initd_run(71): start /etc/rc.d/S20network boot<br />procd: q_initd_complete(101): stop /etc/init.d/firewall running<br />procd: service_handle_set(244): Create service network<br />procd: service_instance_update(66): Create instance network::instance1<br />procd: instance_start(201): Started instance network::instance1<br />procd: _rc(135): running /etc/init.d/network running<br />procd: q_initd_run(71): start /etc/init.d/network running<br />procd: q_initd_complete(101): stop /etc/rc.d/S20network boot<br />procd: q_initd_run(71): start /etc/rc.d/S50cron boot<br />procd: service_handle_set(244): Create service cron<br />procd: _rc(135): running /etc/init.d/cron running<br />procd: q_initd_run(71): start /etc/init.d/cron running<br />procd: q_initd_complete(101): stop /etc/rc.d/S50cron boot<br />procd: q_initd_run(71): start /etc/rc.d/S50dropbear boot<br />procd: q_initd_complete(101): stop /etc/init.d/network running<br />procd: q_initd_complete(101): stop /etc/init.d/cron running<br />procd: service_handle_set(244): Create service dropbear<br />procd: service_instance_update(66): Create instance dropbear::instance1<br />procd: instance_start(201): Started instance dropbear::instance1<br />procd: _rc(135): running /etc/init.d/dropbear running<br />procd: q_initd_run(71): start /etc/init.d/dropbear running<br />procd: q_initd_complete(101): stop /etc/rc.d/S50dropbear boot<br />procd: q_initd_run(71): start /etc/rc.d/S50telnet boot<br />procd: q_initd_complete(101): stop /etc/init.d/dropbear running<br />procd: service_handle_set(244): Create service telnet<br />procd: _rc(135): running /etc/init.d/telnet running<br />procd: q_initd_run(71): start /etc/init.d/telnet running<br />procd: q_initd_complete(101): stop /etc/rc.d/S50telnet boot<br />procd: q_initd_run(71): start /etc/rc.d/S60dnsmasq boot<br />procd: q_initd_complete(101): stop /etc/init.d/telnet running<br />procd: q_initd_complete(101): stop /etc/rc.d/S60dnsmasq boot<br />procd: q_initd_run(71): start /etc/rc.d/S90mjpg-streamer boot<br />procd: service_handle_set(244): Create service mjpg-streamer<br />procd: _rc(135): running /etc/init.d/mjpg-streamer running<br />procd: q_initd_run(71): start /etc/init.d/mjpg-streamer running<br />procd: q_initd_complete(101): stop /etc/rc.d/S90mjpg-streamer boot<br />procd: q_initd_run(71): start /etc/rc.d/S95done boot<br />procd: q_initd_complete(101): stop /etc/init.d/mjpg-streamer running<br />procd: q_initd_complete(101): stop /etc/rc.d/S95done boot<br />procd: q_initd_run(71): start /etc/rc.d/S96led boot<br />procd: q_initd_complete(101): stop /etc/rc.d/S96led boot<br />procd: q_initd_run(71): start /etc/rc.d/S98sysntpd boot<br />procd: service_handle_set(244): Create service sysntpd<br />procd: service_instance_update(66): Create instance sysntpd::instance1<br />procd: instance_start(201): Started instance sysntpd::instance1<br />procd: _rc(135): running /etc/init.d/sysntpd running<br />procd: q_initd_run(71): start /etc/init.d/sysntpd running<br />procd: q_initd_complete(101): stop /etc/rc.d/S98sysntpd boot<br />procd: - init complete -<br />procd: q_initd_complete(101): stop /etc/init.d/sysntpd running<br /><strong>[&nbsp; &nbsp;17.240000] device eth0 entered promiscuous mode<br />[&nbsp; &nbsp;17.640000] eth0: link up (100Mbps/Full duplex)<br />[&nbsp; &nbsp;17.640000] br-lan: port 1(eth0) entered forwarding state<br />[&nbsp; &nbsp;17.650000] br-lan: port 1(eth0) entered forwarding state</strong><br />procd: service_handle_set(244): Create service dnsmasq<br />procd: service_instance_update(66): Create instance dnsmasq::instance1<br />procd: instance_start(201): Started instance dnsmasq::instance1<br />procd: _rc(135): running /etc/init.d/dnsmasq running<br />procd: q_initd_run(71): start /etc/init.d/dnsmasq running<br />procd: q_initd_complete(101): stop /etc/init.d/dnsmasq running<br />procd: service_handle_set(240): Update service dnsmasq<br />procd: service_instance_update(58): Update instance dnsmasq::instance1<br />procd: _rc(135): running /etc/init.d/dnsmasq running<br />procd: q_initd_run(71): start /etc/init.d/dnsmasq running<br />procd: q_initd_complete(101): stop /etc/init.d/dnsmasq running<br />[&nbsp; &nbsp;19.650000] br-lan: port 1(eth0) entered forwarding state<br />[&nbsp; &nbsp;21.540000] random: nonblocking pool is initialized</p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p256771">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">av77</div>
					<div class="post-datetime">
						6 Dec 2014, 11:31					</div>
				</div>
				<div class="post-content content">
					<p>One more thing to add .</p><p>There is also some BUG in one of these scripts, they do not work properly for TL-MR3020</p><div class="codebox"><pre><code>/lib/preinit/05_set_iface_mac_ar71xx
/lib/preinit/05_set_preinit_iface_ar71xx
/lib/preinit/81_load_ath10k_board_bin
/lib/preinit/82_patch_ath10k</code></pre></div><p>I had to disable them and now the eth0 link is up.</p><div class="quotebox"><blockquote><p>[&nbsp; &nbsp; 1.250000] eth0: Atheros AG71xx at 0xb9000000, irq 4, mode:MII<br />[&nbsp; &nbsp; 1.260000] TCP: cubic registered<br />[&nbsp; &nbsp; 1.260000] NET: Registered protocol family 17<br />[&nbsp; &nbsp; 1.270000] 8021q: 802.1Q VLAN Support v1.8<br />[&nbsp; &nbsp; 1.280000] VFS: Mounted root (squashfs filesystem) readonly on device 31:2.<br />[&nbsp; &nbsp; 1.290000] Freeing unused kernel memory: 200K (8034e000 - 80380000)<br />procd: Console is alive<br />procd: - watchdog -<br />[&nbsp; &nbsp; 4.010000] usbcore: registered new interface driver usbfs<br />[&nbsp; &nbsp; 4.010000] usbcore: registered new interface driver hub<br />[&nbsp; &nbsp; 4.020000] usbcore: registered new device driver usb<br />[&nbsp; &nbsp; 4.030000] ehci_hcd: USB 2.0 &#039;Enhanced&#039; Host Controller (EHCI) Driver<br />[&nbsp; &nbsp; 4.030000] ehci-platform: EHCI generic platform driver<br />[&nbsp; &nbsp; 4.040000] ehci-platform ehci-platform: EHCI Host Controller<br />[&nbsp; &nbsp; 4.040000] ehci-platform ehci-platform: new USB bus registered, assigned bus number 1<br />[&nbsp; &nbsp; 4.050000] ehci-platform ehci-platform: irq 3, io mem 0x1b000000<br />[&nbsp; &nbsp; 4.080000] ehci-platform ehci-platform: USB 2.0 started, EHCI 1.00<br />[&nbsp; &nbsp; 4.080000] hub 1-0:1.0: USB hub found<br />[&nbsp; &nbsp; 4.080000] hub 1-0:1.0: 1 port detected<br />[&nbsp; &nbsp; 4.090000] ohci_hcd: USB 1.1 &#039;Open&#039; Host Controller (OHCI) Driver<br />[&nbsp; &nbsp; 4.100000] ohci-platform: OHCI generic platform driver<br />procd: - preinit -<br />[&nbsp; &nbsp; 4.980000] random: mktemp urandom read with 62 bits of entropy available<br />Press the [f] key and hit [enter] to enter failsafe mode<br />Press the [1], [2], [3] or [4] key and hit [enter] to select the debug level<br />jffs2 is ready<br />jffs2 is ready<br />[&nbsp; &nbsp; 8.300000] jffs2: notice: (311) jffs2_build_xattr_subsystem: complete building xattr subsystem, 1 of xdatum (0 unchecked, 0 orphan) and 21 of xref (0 dead, 2 orphan) found.<br />switching to overlay<br />procd: - early -<br />procd: - watchdog -<br />procd: - ubus -<br />procd: - init -<br />Please press Enter to activate this console.<br />[&nbsp; &nbsp;10.810000] nf_conntrack version 0.5.0 (450 buckets, 1800 max)<br />[&nbsp; &nbsp;10.860000] xt_time: kernel timezone is -0000<br />[&nbsp; &nbsp;10.870000] ip_tables: (C) 2000-2006 Netfilter Core Team<br />procd: - init complete -<br /><strong>[&nbsp; &nbsp;18.480000] device eth0 entered promiscuous mode<br />[&nbsp; &nbsp;18.480000] br-lan: port 1(eth0) entered forwarding state<br />[&nbsp; &nbsp;18.490000] br-lan: port 1(eth0) entered forwarding state<br />[&nbsp; &nbsp;19.480000] br-lan: port 1(eth0) entered disabled state<br />[&nbsp; &nbsp;20.700000] eth0: link up (100Mbps/Full duplex)<br />[&nbsp; &nbsp;20.700000] br-lan: port 1(eth0) entered forwarding state<br />[&nbsp; &nbsp;20.700000] br-lan: port 1(eth0) entered forwarding state<br />[&nbsp; &nbsp;22.700000] br-lan: port 1(eth0) entered forwarding state</strong><br />[&nbsp; &nbsp;26.430000] random: nonblocking pool is initialized</p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p257456">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">wirbel</div>
					<div class="post-datetime">
						12 Dec 2014, 13:43					</div>
				</div>
				<div class="post-content content">
					<p>I have exactly the same problems as you with WR703N with OpenWrt Chaos Calmer r43592 / LuCI Master (git-14.328.38244-91532de) </p><p>The non working eth0 shows ifconfig on TX packets allways 0.</p><p>Whit the old firmware OpenWrt Barrier Breaker r38351 / LuCI Trunk (svn-r9915) works the eth0 without any problems.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p257523">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">av77</div>
					<div class="post-datetime">
						12 Dec 2014, 23:11					</div>
				</div>
				<div class="post-content content">
					<div class="codebox"><pre><code>root@OpenWrt:/lib/preinit# grep &quot;#boot&quot; *
05_set_iface_mac_ar71xx:#boot_hook_add preinit_main preinit_set_mac_address
05_set_preinit_iface_ar71xx:#boot_hook_add preinit_main set_preinit_iface
81_load_ath10k_board_bin:#boot_hook_add preinit_main do_load_ath10k_board_bin
82_patch_ath10k:#boot_hook_add preinit_main do_patch_ath10k_firmware</code></pre></div><p>I had to disable above scripts in the last line of code and without them everything works fine.</p><p>Thanks</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>