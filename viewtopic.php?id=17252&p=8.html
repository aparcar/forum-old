<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> OpenWRT Kamikaze on TP-link tl-wa501g?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 31 Aug 2014 and 5 May 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 8 of 14</div><nav><ul><li><a href="viewtopic.php%3Fid=17252&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=17252&amp;p=6.html">6</a></li><li><a href="viewtopic.php%3Fid=17252&amp;p=7.html">7</a></li><li class="pagination-current"><span>8</span></li><li><a href="viewtopic.php%3Fid=17252&amp;p=9.html">9</a></li><li><a href="viewtopic.php%3Fid=17252&amp;p=10.html">10</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=17252&amp;p=14.html">14</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p144356">
				<div class="post-metadata">
					<div class="post-num">Post #176</div>
					<div class="post-author">drekthar</div>
					<div class="post-datetime">
						24 Sep 2011, 13:06					</div>
				</div>
				<div class="post-content content">
					<p>i am sorry&nbsp; i cannot test weather vlan is available..... as i have bricked my wr340g at the moment and cannot access it to test................................. vlan&nbsp; may not work as this is a minimal image built by xssa he might have dropped&nbsp; vlan support to save space........&nbsp; </p><p>could you elaborate you setup....... as in this openwrt image all the lan ports are under one subnet (which means openwrt recognises all the lan ports as one and the same) so just use another lan port and everything will work okay no need to set anything ........</p>											<p class="post-edited">(Last edited by <strong>drekthar</strong> on 24 Sep 2011, 13:07)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p144357">
				<div class="post-metadata">
					<div class="post-num">Post #177</div>
					<div class="post-author">l0l</div>
					<div class="post-datetime">
						24 Sep 2011, 13:43					</div>
				</div>
				<div class="post-content content">
					<p>yep vlan dosent work... so I can use LAN port as WAN ?</p><p>aslo can you change this on wiki:</p><p>BAD:<br/></p><div class="quotebox"><blockquote><p>(custom load address for kernel is 80033800)<br/>fis create -r 0x80033800 -e 0x80033800 vmlinux.bin.l7 ( Write&#039;s kernel to flash custom load address for kernel is 80033800 current kernel is 2.6 )</p></blockquote></div><p>GOOD:<br/></p><div class="quotebox"><blockquote><p>(custom load address for kernel is 80041000 )<br/>fis create -r 0x80041000 -e 0x80041000 vmlinux.bin.l7 ( Write&#039;s kernel to flash custom load address for kernel is 80041000 current kernel is 2.6 )</p></blockquote></div>											<p class="post-edited">(Last edited by <strong>l0l</strong> on 24 Sep 2011, 15:00)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p144364">
				<div class="post-metadata">
					<div class="post-num">Post #178</div>
					<div class="post-author">drekthar</div>
					<div class="post-datetime">
						24 Sep 2011, 15:28					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>l0l wrote:</cite><blockquote><p>yep vlan dosent work... so I can use LAN port as WAN ?</p><p>aslo can you change this on wiki:</p><p>BAD:<br/></p><div class="quotebox"><blockquote><p>(custom load address for kernel is 80033800)<br/>fis create -r 0x80033800 -e 0x80033800 vmlinux.bin.l7 ( Write&#039;s kernel to flash custom load address for kernel is 80033800 current kernel is 2.6 )</p></blockquote></div><p>GOOD:<br/></p><div class="quotebox"><blockquote><p>(custom load address for kernel is 80041000 )<br/>fis create -r 0x80041000 -e 0x80041000 vmlinux.bin.l7 ( Write&#039;s kernel to flash custom load address for kernel is 80041000 current kernel is 2.6 )</p></blockquote></div></blockquote></div><p>where did you download the kernel ? .....If you downloaded the kernel from this forum the address will be 80041000 (which is default) but if you downloaded the kernel from the wiki it&#039;s address is 80033800</p>											<p class="post-edited">(Last edited by <strong>drekthar</strong> on 24 Sep 2011, 15:30)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p144365">
				<div class="post-metadata">
					<div class="post-num">Post #179</div>
					<div class="post-author">l0l</div>
					<div class="post-datetime">
						24 Sep 2011, 15:44					</div>
				</div>
				<div class="post-content content">
					<p>Installed from this:</p><div class="quotebox"><cite>melkman wrote:</cite><blockquote><p>New location of the images (thanks mvsroot):</p><p>vxkiller made by xssa:<br/><a href="http://www.xs4all.nl/~mettema/TL-340G-Linux_606fe38dda4014fb8f16b9b8a27cee3e.rar">http://www.xs4all.nl/~mettema/TL-340G-Linux_606fe38dda4014fb8f16b9b8a27cee3e.rar</a></p><p>Kernel for openwrt made by xssa:<br/><a href="http://www.xs4all.nl/~mettema/openwrt-atheros-vmlinux.lzma">http://www.xs4all.nl/~mettema/openwrt-atheros-vmlinux.lzma</a></p><p>RootFS for openwrt made by xssa (IP Address is 192.168.1.55 logon with root/ar2317):<br/><a href="http://www.xs4all.nl/~mettema/rootsq.rom">http://www.xs4all.nl/~mettema/rootsq.rom</a></p></blockquote></div><p>but md5 sum = md5 sum of kernel/files from wiki</p>											<p class="post-edited">(Last edited by <strong>l0l</strong> on 24 Sep 2011, 15:44)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p144369">
				<div class="post-metadata">
					<div class="post-num">Post #180</div>
					<div class="post-author">l0l</div>
					<div class="post-datetime">
						24 Sep 2011, 16:40					</div>
				</div>
				<div class="post-content content">
					<p>I dont know how configure... maybe my router is complitly broken after storm, some1 can post etc/config/network config for this conection:</p><p>---Internet----<br/>IP: 192.168.1.56<br/>NetMask: 255.255.248.0<br/>Getaway: 192.168.0.1<br/>DNS: 192.168.0.1</p><p>thx</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p144384">
				<div class="post-metadata">
					<div class="post-num">Post #181</div>
					<div class="post-author">drekthar</div>
					<div class="post-datetime">
						24 Sep 2011, 18:32					</div>
				</div>
				<div class="post-content content">
					<p>please explain your setup.......... i can&#039;t help without more information</p>											<p class="post-edited">(Last edited by <strong>drekthar</strong> on 24 Sep 2011, 18:34)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p144387">
				<div class="post-metadata">
					<div class="post-num">Post #182</div>
					<div class="post-author">l0l</div>
					<div class="post-datetime">
						24 Sep 2011, 19:23					</div>
				</div>
				<div class="post-content content">
					<p>I want split internet,im&nbsp; connecting thru static IP from ISP</p><div class="quotebox"><blockquote><p>IP: 192.168.1.56<br/>NetMask: 255.255.248.0<br/>Getaway: 192.168.0.1<br/>DNS: 192.168.0.1</p></blockquote></div><p>I use this setup:</p><div class="quotebox"><blockquote><p>config &#039;interface&#039; &#039;loopback&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ifname&#039; &#039;lo&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option &#039;proto&#039; &#039;static&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ipaddr&#039; &#039;127.0.0.1&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option &#039;netmask&#039; &#039;255.0.0.0&#039;&nbsp; &nbsp; </p><p>&nbsp; &nbsp; config &#039;interface&#039; &#039;lan&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ifname&#039; &#039;eth0&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option &#039;type&#039; &#039;bridge&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option &#039;proto&#039; &#039;static&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ipaddr&#039; &#039;199.168.1.1&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option &#039;netmask&#039; &#039;255.255.255.0&#039;<br/>&nbsp; &nbsp; <br/>&nbsp; &nbsp; config &#039;interface&#039; &#039;wlan&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ifname&#039; &#039;wlan0&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option &#039;type&#039; &#039;bridge&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option &#039;proto&#039; &#039;static&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ipaddr&#039; &#039;192.168.1.56&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option &#039;netmask&#039; &#039;255.255.248.0&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option &#039;getaway&#039; &#039;192.168.0.1&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option &#039;dns&#039; &#039;192.168.0.1&#039;</p></blockquote></div><p>But dosent work, what I do wrong ?<br/>There is any wlan0 interface in this kernel ?</p>											<p class="post-edited">(Last edited by <strong>l0l</strong> on 24 Sep 2011, 19:34)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p144397">
				<div class="post-metadata">
					<div class="post-num">Post #183</div>
					<div class="post-author">drekthar</div>
					<div class="post-datetime">
						24 Sep 2011, 23:26					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>l0l wrote:</cite><blockquote><p>I want split internet,im&nbsp; connecting thru static IP from ISP</p><div class="quotebox"><blockquote><p>IP: 192.168.1.56<br/>NetMask: 255.255.248.0<br/>Getaway: 192.168.0.1<br/>DNS: 192.168.0.1</p></blockquote></div><p>I use this setup:</p><div class="quotebox"><blockquote><p>config &#039;interface&#039; &#039;loopback&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ifname&#039; &#039;lo&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option &#039;proto&#039; &#039;static&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ipaddr&#039; &#039;127.0.0.1&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option &#039;netmask&#039; &#039;255.0.0.0&#039;&nbsp; &nbsp; </p><p>&nbsp; &nbsp; config &#039;interface&#039; &#039;lan&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ifname&#039; &#039;eth0&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option &#039;type&#039; &#039;bridge&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option &#039;proto&#039; &#039;static&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ipaddr&#039; &#039;199.168.1.1&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option &#039;netmask&#039; &#039;255.255.255.0&#039;<br/>&nbsp; &nbsp; <br/>&nbsp; &nbsp; config &#039;interface&#039; &#039;wlan&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ifname&#039; &#039;wlan0&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option &#039;type&#039; &#039;bridge&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option &#039;proto&#039; &#039;static&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option &#039;ipaddr&#039; &#039;192.168.1.56&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option &#039;netmask&#039; &#039;255.255.248.0&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option &#039;getaway&#039; &#039;192.168.0.1&#039;<br/>&nbsp; &nbsp; &nbsp; &nbsp; option &#039;dns&#039; &#039;192.168.0.1&#039;</p></blockquote></div><p>But dosent work, what I do wrong ?<br/>There is any wlan0 interface in this kernel ?</p></blockquote></div><p>this whole setup is wrong........... i still don&#039;t know what you are trying to achieve .........wlan0 is wifi.......please read all openwrt docs in wiki and all the info of openwrt before posting in a forum</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p144459">
				<div class="post-metadata">
					<div class="post-num">Post #184</div>
					<div class="post-author">drekthar</div>
					<div class="post-datetime">
						25 Sep 2011, 20:28					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>l0l wrote:</cite><blockquote><p>Installed from this:</p><div class="quotebox"><cite>melkman wrote:</cite><blockquote><p>New location of the images (thanks mvsroot):</p><p>vxkiller made by xssa:<br/><a href="http://www.xs4all.nl/~mettema/TL-340G-Linux_606fe38dda4014fb8f16b9b8a27cee3e.rar">http://www.xs4all.nl/~mettema/TL-340G-Linux_606fe38dda4014fb8f16b9b8a27cee3e.rar</a></p><p>Kernel for openwrt made by xssa:<br/><a href="http://www.xs4all.nl/~mettema/openwrt-atheros-vmlinux.lzma">http://www.xs4all.nl/~mettema/openwrt-atheros-vmlinux.lzma</a></p><p>RootFS for openwrt made by xssa (IP Address is 192.168.1.55 logon with root/ar2317):<br/><a href="http://www.xs4all.nl/~mettema/rootsq.rom">http://www.xs4all.nl/~mettema/rootsq.rom</a></p></blockquote></div><p>but md5 sum = md5 sum of kernel/files from wiki</p></blockquote></div><p>this is&nbsp; because the sizes of the images are the same as the way squashfs files are compressed......<br/>use the kernel and rootfs in the wiki (this is better one as it supports udhcp in busybox XSSA BUILD IT)</p>											<p class="post-edited">(Last edited by <strong>drekthar</strong> on 25 Sep 2011, 20:29)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p144540">
				<div class="post-metadata">
					<div class="post-num">Post #185</div>
					<div class="post-author">l0l</div>
					<div class="post-datetime">
						26 Sep 2011, 19:07					</div>
				</div>
				<div class="post-content content">
					<p>ok good to know <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile"/></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p144864">
				<div class="post-metadata">
					<div class="post-num">Post #186</div>
					<div class="post-author">sanitariu</div>
					<div class="post-datetime">
						30 Sep 2011, 23:17					</div>
				</div>
				<div class="post-content content">
					<p>Anyone succeed in running 340G with marvell switch 80E600 ?<br/>Seems like switch is recognized as eth0: attached PHY driver [Generic PHY] (mii_bus:phy_addr=0:00)&nbsp; although in the kernel there are drivers.<br/>I build my own kernel with jff2s only and vlans. Everything works perfectly. I have 300K free space and there is pleny of space of iptables. So if there is any way that router to make use of wan/lan it is good to know how.<br/>I played a little with the source in mvswitch.c and i saw some strange checks like </p><p>&nbsp; &nbsp; &nbsp; &nbsp; if (dev-&gt;addr != 0x10)<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return 0;<br/>My switch is detected at 0x0 . Anyone knows what is all about ?<br/>Also commenting that section and<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if (reg != MV_IDENT_VALUE)<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return 0;</p><p>makes the kernel recognize my switch correctly as Marvell 80E6060 but it timeouts when set the registers.<br/>Seems like we miss support or something is broken in the openwrt patches.<br/>If anyone have ideas i can test compile everything.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p144877">
				<div class="post-metadata">
					<div class="post-num">Post #187</div>
					<div class="post-author">drekthar</div>
					<div class="post-datetime">
						1 Oct 2011, 07:57					</div>
				</div>
				<div class="post-content content">
					<p>hello sanitariu</p><p>welcome to the forum </p><p>&lt;quote&gt;I build my own kernel with jff2s only and vlans. Everything works perfectly. I have 300K free space and there is pleny of space of iptables &lt;/quote&gt;</p><p>yes the same thing happens to me switch is detected as generic phy..... where you able to configure sitch with vlan ?&nbsp; </p><p>could you share your image and both .config files and kernel config files here............. what about wifi...... do u you only want to use the router as a switch ?&nbsp; did you include wifi driver in your build.... madwifi requires a lot of space</p><p>See the wiki if we can create a sd card mod to the router by first detecting gpio pins we can make this router fully functional but first gpio pins need to be found followed by compiling a kernel with sd card support</p>											<p class="post-edited">(Last edited by <strong>drekthar</strong> on 1 Oct 2011, 10:00)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p144991">
				<div class="post-metadata">
					<div class="post-num">Post #188</div>
					<div class="post-author">sanitariu</div>
					<div class="post-datetime">
						2 Oct 2011, 22:00					</div>
				</div>
				<div class="post-content content">
					<p>Hello,<br/>I am able to run the device in bridge mode together with wifi.<br/>So i can easy run hybrid vlan everywhere and run tagged vlan on the ath0 interface.vconfig here.<br/>Works very good.<br/>I would like to be able to use the switch the same way also. So i can choose which port which vlan.<br/>Also that way i will be able to use TP-Link 340G like router. Choose my WAN port run iptables/udhcp etc..<br/>There is plenty of space.<br/>Yes i include madwifi only setup in all my builds. ark5 is not good yet and take too much space. Depends what you like. I personally do not need any wifi security just vlan in the wifi interface.<br/>I noticed on latest kernel versions/ or madwifi patches the device stuck when you download heavy (wifi) 3.0/3.1MB (24Mbit/s) madwifi starts to eat memory very fast and router dies in 1 minute. So i start pulling old versions of openwrt back to 16500 <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile"/><br/>That&#039;s the most stable i saw. Downloading days wifi all the time with 3.0MB (24Mbit) seems stable no kernel panics no reboots. Also i erased most of the scripts for detecting network cards and other openwrt stupids which eats immediately memory after you start. I think there is no need for that ! Simple rc.local with wifi setup is enough. No stupid detects and hang on 10 minutes on booting. TP-Link 340 has only 8MB !<br/>May be for that router will be better to compile own libc basic stuff and kernel. I dunno why hotplug stuff is so heavy on boot ?!<br/>Why do you need gpio pins ?<br/>Personally i removed all stuff that control diods on the router and if i find a way to stop them all will be perfect. Extra energy for diods which you look once in a year <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile"/><br/>I am not interrested in SD memory. As I said i need the cheapest router which you can control wifi/switch/vlans.<br/>TP-Link 340GD is perfect in that way and costs only 10 euro <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile"/><br/>I can share configs just let me know which versions you like. 16500 is the most stable for now.</p><br/><p>P.S.</p><p>if (dev-&gt;addr != 0x10)<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return 0;</p><p>Makes mvswitch.c exits init immediately and we got Generic PHY because we are detected at 0x00 address.<br/>May be init registers of the switch are not correct. I will try more old kernels. Too bad that kernel.org is hacked and i can not check mailing lists or newer kernels.</p>											<p class="post-edited">(Last edited by <strong>sanitariu</strong> on 2 Oct 2011, 22:05)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p145022">
				<div class="post-metadata">
					<div class="post-num">Post #189</div>
					<div class="post-author">drekthar</div>
					<div class="post-datetime">
						3 Oct 2011, 14:25					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>sanitariu wrote:</cite><blockquote><p>16500 is the most stable for now.</p></blockquote></div><p>yes, your configs would be very nice </p><p>do you think it is possible for me to run the router in client mode with another router. this setup would require (dnsmasq) i already have a working image in which i can successfully client to another ap with psk encryption in routed client mode with static route&#039;s set in main ap router</p><div class="quotebox"><cite>sanitariu wrote:</cite><blockquote><p>I am not interrested in SD memory. As I said i need the cheapest router which you can control wifi/switch/vlans</p></blockquote></div><p>i have a lot of memory card lying around and thought it would be great do a sd/mmc card mod to this router after finding it&#039;s gpio pins ..... so i can have client mode installed ....... i guess the ram will still make it unstable.....</p><div class="quotebox"><cite>sanitariu wrote:</cite><blockquote><p>TP-Link 340GD is perfect in that way and costs only 10 euro smile<br/>I can share configs just let me know which versions you like. 16500 is the most stable for now</p></blockquote></div><p>i agree these router are the best as they come with 5dbi antennas which have a very good signal strength that&#039;s why i wanted to turn one of these into a&nbsp; client&nbsp; router over wifi</p><p>ps all the images i have built with wifi are very big <br/>rootfs is 704 kb<br/>kernel 868 kb </p><p>your config&#039;s would be great i can learn a lot in making small images as i don&#039;t know so much about linux and i am still learning</p><p>thanks in advance</p>											<p class="post-edited">(Last edited by <strong>drekthar</strong> on 3 Oct 2011, 14:27)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p145030">
				<div class="post-metadata">
					<div class="post-num">Post #190</div>
					<div class="post-author">sanitariu</div>
					<div class="post-datetime">
						3 Oct 2011, 16:01					</div>
				</div>
				<div class="post-content content">
					<p>Here is kernel config.<br/><a href="http://www.telnet.bg/openwrt/kernel-config-2.6.28.10-r16500">http://www.telnet.bg/openwrt/kernel-config-2.6.28.10-r16500</a><br/>Note that i put all the madwifi patches from latest revision in patch dir except these for the kernel after 2.6.28 and also excluding 451-ibss_race_fix.patch</p><p>Kernel size is 655360.<br/>Also i advise you to cut all hotplug stuff.<br/>Instead make rc.local or other and make things properly.<br/>For the openwrt system you can cut a lot of currently i have 300KB free or more.<br/>It is enough for iptables+dhcp.<br/>But we miss switch control. If someone fix mvswitch drivers we will be able to use as a router.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p145034">
				<div class="post-metadata">
					<div class="post-num">Post #191</div>
					<div class="post-author">drekthar</div>
					<div class="post-datetime">
						3 Oct 2011, 16:49					</div>
				</div>
				<div class="post-content content">
					<p>thnak&#039;s a lot sanitariu <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile"/></p><br/><div class="quotebox"><cite>sanitariu wrote:</cite><blockquote><p>Also i advise you to cut all hotplug stuff.<br/>Instead make rc.local or other and make things properly</p></blockquote></div><p>could you explain how to do this if it is not any trouble </p><p>thanks you</p>											<p class="post-edited">(Last edited by <strong>drekthar</strong> on 3 Oct 2011, 16:51)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p145039">
				<div class="post-metadata">
					<div class="post-num">Post #192</div>
					<div class="post-author">sanitariu</div>
					<div class="post-datetime">
						3 Oct 2011, 18:13					</div>
				</div>
				<div class="post-content content">
					<p>You can do so by commenting out some sections in /etc/init.d/network.<br/>I forced the detection of marvell switch by commenting out </p><p>&nbsp; &nbsp; &nbsp; &nbsp; if (dev-&gt;addr != 0x10)<br/>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return 0;</p><p>in mvswitch.c and changing </p><p>#define MV_BASE&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0x0<br/>in mvswitch.h</p><p>Now switch is detected properly at address 0x0 but is not working.<br/>Seems we miss more in the init structures.<br/>I will look more in the pdf sheets.<br/>If someone have more information please share.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p145040">
				<div class="post-metadata">
					<div class="post-num">Post #193</div>
					<div class="post-author">drekthar</div>
					<div class="post-datetime">
						3 Oct 2011, 18:30					</div>
				</div>
				<div class="post-content content">
					<p>thanks you<br/></p><div class="quotebox"><cite>sanitariu wrote:</cite><blockquote><p>Note that i put all the madwifi patches from latest revision in patch dir except these for the kernel after 2.6.28 and also excluding 451-ibss_race_fix.patch</p></blockquote></div><p>where can i download the madwifi patch from...... sorry for disturbing....</p><p>thanks in advance</p>											<p class="post-edited">(Last edited by <strong>drekthar</strong> on 3 Oct 2011, 18:30)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p145041">
				<div class="post-metadata">
					<div class="post-num">Post #194</div>
					<div class="post-author">sanitariu</div>
					<div class="post-datetime">
						3 Oct 2011, 18:33					</div>
				</div>
				<div class="post-content content">
					<p>Download latest svn. Go to package/madwifi/patches.<br/>Copy all of them except these for newer kernels after 2.6.28 and except ibss patch to your old tree.<br/>Remove build_dir/linux-atheros/madwifi-trunk-r3314/ and compile again.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p145043">
				<div class="post-metadata">
					<div class="post-num">Post #195</div>
					<div class="post-author">drekthar</div>
					<div class="post-datetime">
						3 Oct 2011, 18:50					</div>
				</div>
				<div class="post-content content">
					<p>thanks a lot dude......:D&nbsp; &nbsp;i will keep in touch</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p145060">
				<div class="post-metadata">
					<div class="post-num">Post #196</div>
					<div class="post-author">sanitariu</div>
					<div class="post-datetime">
						4 Oct 2011, 01:52					</div>
				</div>
				<div class="post-content content">
					<p>I have more news about the switch in Tplink WR-340GD.<br/>According to the manual switch phy can be found on different addresses.</p><p>&quot;The 88E6060 device contains five physical layer devices (PHYs). These devices are accessible using SMI device<br/>addresses 0x00 to 0x04 (or 0x10 to 0x14) depending upon the value of the EE_CLK/ADDR4 pin at reset. The<br/>PHYs are fully IEEE 802.3 compliant including their register interface.&quot;</p><p>mvswitch.c/mvswitch.h need patches for these.</p><p>Also i am able to control manually the ports and leds of the switch like putting static lines:<br/>&nbsp; &nbsp; w16(pdev, MV_PHYREG(LED_OVERRIDE, 1), 0x2a); // stop led on port 2<br/>in mvswitch.c.<br/>0x2a is taken from the manual. You must calculate the bits binary then transfer in hex.<br/>Also i can choose my wan port there too.<br/>Seems like switch is working at address 0x00.<br/>Still i must found a way to work with swconfig. There we fail to connect.<br/>Anyone working on that ?</p>											<p class="post-edited">(Last edited by <strong>sanitariu</strong> on 4 Oct 2011, 01:53)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p145065">
				<div class="post-metadata">
					<div class="post-num">Post #197</div>
					<div class="post-author">drekthar</div>
					<div class="post-datetime">
						4 Oct 2011, 05:37					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>sanitaru wrote:</cite><blockquote><p>Download latest svn. Go to package/madwifi/patches.<br/>Copy all of them except these for newer kernels after 2.6.28 and except ibss patch to your old tree.</p></blockquote></div><p>what do you mean by latest svn ?&nbsp; is it backfire 10.03.1-rc5/?...... I can&#039;t find /madwifi/patches in the packages category where is it ? i am looking for it over here <a href="http://downloads.openwrt.org/backfire/10.03.1-rc5/atheros/packages/">http://downloads.openwrt.org/backfire/10.03.1-rc5/atheros/packages/</a>&nbsp; it isn&#039;t there..</p><p>also what is the size of your rootfs did you use squashfs or jffs could you share your config for the rootfs as well as...<br/>thanks in advance</p><p>i think member xssa in this forum was working on the switch but i don&#039;t know how far he had got to fixing the whole issue you should contact him, he made the vxkiller in this forum</p><p>ps how did you install openwrt to the router did you use the vxkiller or did you use spipgm and flash a bootloader to the router. Did you compile your own redboot for the 2mb flash and 8mb ram ? or did you just use the vxkiller</p>											<p class="post-edited">(Last edited by <strong>drekthar</strong> on 4 Oct 2011, 06:29)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p145070">
				<div class="post-metadata">
					<div class="post-num">Post #198</div>
					<div class="post-author">sanitariu</div>
					<div class="post-datetime">
						4 Oct 2011, 10:24					</div>
				</div>
				<div class="post-content content">
					<p>This is how you can get latest:<br/>svn co svn://svn.openwrt.org/openwrt/trunk/ openwrt<br/>Size of root is 800-900KB or so. I still did not optimize it because i give more priority on working switch. If we do not have it we do not need more size. I wrote 2-3 times to xssa but still no answer.<br/>I use normal flash from web. Also i put serial on the router so i can see what is going on.<br/>xssa files works only on revisions 2.xx. Check on the backside of your router. If it is 3.x will not work.<br/>As i said before seems switch is working when i put static things in mvswitch.c. We can stop diods/ports etc...<br/>Just swconfig does not seem to work.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p145204">
				<div class="post-metadata">
					<div class="post-num">Post #199</div>
					<div class="post-author">sanitariu</div>
					<div class="post-datetime">
						6 Oct 2011, 00:38					</div>
				</div>
				<div class="post-content content">
					<p>More info for TP-Link 340GD.<br/>It is working in router mode with 2 vlans. 1 and 2 where vlan2 is the wan port we can choose in mvswitch.h and fix in mvswitch.c<br/>Also i put dnsmasq + iptables and bridged eth0.1/ath0.<br/>Everything is working but i am not good with the speed it is 1.2MB (10Mbit). It is too slow i need at least 70-80Mbit.<br/>When in the other mode only bridge on the LAN port you can make 7-8MB (60-70Mbit) which is okay and on the wifi interface you can make 3MB (24Mbit).<br/>Seems like iptables is killing the cpu of the router.<br/>Anyone knows some optimizations for iptables or some kind of alternative ?</p><p>P.S.<br/>Little improvement using SNAT instead MASQ but still 1.4MB lot&#039;s to go until 8-9MB in the other mode.<br/>One note these speeds are in Megabytes not Megabits. This is important.</p>											<p class="post-edited">(Last edited by <strong>sanitariu</strong> on 6 Oct 2011, 00:55)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p145210">
				<div class="post-metadata">
					<div class="post-num">Post #200</div>
					<div class="post-author">drekthar</div>
					<div class="post-datetime">
						6 Oct 2011, 08:16					</div>
				</div>
				<div class="post-content content">
					<p>wow.... great work ...</p><div class="quotebox"><cite>sanitaru wrote:</cite><blockquote><p>It is working in router mode with 2 vlans. 1 and 2 where vlan2 is the wan port we can choose in mvswitch.h and fix in mvswitch.c<br/>Also i put dnsmasq + iptables and bridged eth0.1/ath0.</p></blockquote></div><p>how much free space is left....... does everything work fine after the router is restarted. ? Does it work after a power cycle...... ?&nbsp; &nbsp;the images i made before does not work after a reboot or power cycle&nbsp; </p><br/><p>here is this thread it is a little old but it discusses on 2mb flash router</p><p><a href="https://forum.openwrt.org/viewtopic.php?id=4039&amp;p=1">https://forum.openwrt.org/viewtopic.php?id=4039&amp;p=1</a><br/>(read both pages)</p><p>i can&#039;t&nbsp; do anything to my router currently.. as i need a serial console to access the router after i&nbsp; acccidentally initialized the redboot config....... so i can&#039;t help yet......</p><br/><p>take a look at this script below&nbsp; it is a briiliant hack don&#039;t know if it will work for trunk.... it reduces the size of the library (check the link above)</p><p>Here&#039;s a sample optimize_lib.sh taken from the wrtsl54g firmware source, to save anyone the effort. Again, it does have some drawbacks, but is absolutely necessary if you want a small firmware.</p><p>Code:</p><p>#!/bin/sh</p><p>#set -x</p><p>NM=mipsel-uclibc-nm<br/>LD=mipsel-uclibc-ld<br/>STRIP=mipsel-uclibc-strip</p><p>DIR=$1<br/>LIB_SO=$2<br/>LIB_A=$3<br/>LIB_SO_M=$4<br/>SEARCHDIR=$5<br/>INSTALLLIB=$6</p><p>MAP=${DIR}/.map<br/>SYM=${DIR}/.sybmols<br/>UNR=${DIR}/.unresolved<br/>BINARIES=`find $SEARCHDIR -path $SEARCHDIR/lib -prune -o -type f -print | file -f - | grep ELF | cut -d&#039;:&#039; -f1`</p><p>if [ ! -f ${DIR}/${LIB_SO} ] ; then<br/>&nbsp; &nbsp; echo &quot;Cann&#039;t find ${DIR}/${LIB_SO}&quot;;<br/>&nbsp; &nbsp; exit 0;<br/>fi</p><p>if [ ! -f ${DIR}/${LIB_A} ] ; then<br/>&nbsp; &nbsp; echo &quot;Cann&#039;t find ${DIR}/${LIB_A}&quot;;<br/>&nbsp; &nbsp; exit 0;<br/>fi</p><p>rm -f $MAP<br/>rm -f $SYM<br/>rm -f $UNR</p><p>$NM -o --defined-only --no-sort ${DIR}/${LIB_SO} | cut -d&#039; &#039; -f3 &gt; $MAP<br/>$NM --dynamic -u --no-sort $BINARIES | sort -u &gt; $UNR<br/>for symbol in `cat $UNR` ; do <br/>&nbsp; &nbsp; if grep -q &quot;^$symbol&quot; $MAP ; then echo &quot;-u $symbol&quot; &gt;&gt; $SYM ;<br/>fi ; done </p><p>if ls $SYM ; then <br/>&nbsp; &nbsp; xargs -t $LD -shared -o ${DIR}/${LIB_SO_M} ${DIR}/${LIB_A} &lt; $SYM ;<br/>fi</p><p>if [ &quot;a$INSTALLLIB&quot; != &quot;a&quot; -a -f ${DIR}/${LIB_SO_M} ] ; then<br/>&nbsp; &nbsp; install ${DIR}/${LIB_SO_M} $INSTALLLIB<br/>&nbsp; &nbsp; $STRIP $INSTALLLIB<br/>fi</p>											<p class="post-edited">(Last edited by <strong>drekthar</strong> on 6 Oct 2011, 08:31)</p>
									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 8 of 14</div><nav><ul><li><a href="viewtopic.php%3Fid=17252&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=17252&amp;p=6.html">6</a></li><li><a href="viewtopic.php%3Fid=17252&amp;p=7.html">7</a></li><li class="pagination-current"><span>8</span></li><li><a href="viewtopic.php%3Fid=17252&amp;p=9.html">9</a></li><li><a href="viewtopic.php%3Fid=17252&amp;p=10.html">10</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=17252&amp;p=14.html">14</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0.001 -->

</body>
</html>