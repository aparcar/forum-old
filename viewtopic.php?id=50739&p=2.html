<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> SOLVED: Strange ssh login problem, key keeps changing</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 7 Apr 2018 and 29 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 2 of 3</div><nav><ul><li><a href="viewtopic.php%3Fid=50739&amp;p=1.html">1</a></li><li class="pagination-current"><span>2</span></li><li><a href="viewtopic.php%3Fid=50739&amp;p=3.html">3</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p234316">
				<div class="post-metadata">
					<div class="post-num">Post #26</div>
					<div class="post-author">tmo26</div>
					<div class="post-datetime">
						23 May 2014, 02:46					</div>
				</div>
				<div class="post-content content">
					<p>Did I get this right:</p><p>Your main router has 192.168.1.1<br />Your TP-Link has network.lan.ipaddr=192.168.1.1</p><p>errrrmm...?-)</p>											<p class="post-edited">(Last edited by <strong>tmo26</strong> on 23 May 2014, 02:46)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p234317">
				<div class="post-metadata">
					<div class="post-num">Post #27</div>
					<div class="post-author">projects</div>
					<div class="post-datetime">
						23 May 2014, 02:48					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>tmo26 wrote:</cite><blockquote><p>Did I get this right:</p><p>Your main router has 192.168.1.1<br />Your TP-Link has network.lan.ipaddr=192.168.1.1</p><p>errrrmm...?-)</p></blockquote></div><p>Nope. It&#039;s gateway is 192.168.1.1</p><p># ifconfig<br />br-lan&nbsp; &nbsp; Link encap:Ethernet&nbsp; HWaddr 08:57:00:41:2E:6A<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:192.168.2.100&nbsp; Bcast:192.168.255.255&nbsp; Mask:255.255.0.0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:41537 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:22372 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:2971018 (2.8 MiB)&nbsp; TX bytes:2261711 (2.1 MiB)</p><p>eth0&nbsp; &nbsp; &nbsp; Link encap:Ethernet&nbsp; HWaddr 08:57:00:41:2E:6A<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:42190 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:22459 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:1000<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:3691580 (3.5 MiB)&nbsp; TX bytes:2265713 (2.1 MiB)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Interrupt:4</p><p>lo&nbsp; &nbsp; &nbsp; &nbsp; Link encap:Local Loopback<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:127.0.0.1&nbsp; Mask:255.0.0.0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP LOOPBACK RUNNING&nbsp; MTU:16436&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:0 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:0 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:0 (0.0 B)&nbsp; TX bytes:0 (0.0 B)</p><br /><p># route<br />Kernel IP routing table<br />Destination&nbsp; &nbsp; &nbsp;Gateway&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Genmask&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Flags Metric Ref&nbsp; &nbsp; Use Iface<br />default&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;192.168.1.1&nbsp; &nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;UG&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 br-lan<br />192.168.0.0&nbsp; &nbsp; &nbsp;*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.255.0.0&nbsp; &nbsp; &nbsp;U&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 br-lan</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p234318">
				<div class="post-metadata">
					<div class="post-num">Post #28</div>
					<div class="post-author">projects</div>
					<div class="post-datetime">
						23 May 2014, 02:49					</div>
				</div>
				<div class="post-content content">
					<p>Wait, I see that too now? What&#039;s that from if it&#039;s IP is 192.168.2.100?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p234319">
				<div class="post-metadata">
					<div class="post-num">Post #29</div>
					<div class="post-author">tmo26</div>
					<div class="post-datetime">
						23 May 2014, 02:54					</div>
				</div>
				<div class="post-content content">
					<p>I have no clue where 192.168.2.100 comes from, but you should get your TP-Links network configuration right.</p><p>Start with a static IP on your TP-Link, to make things a bit easier.<br />If static works, go ahead to DHCP.</p><p>And you should disable DHCP-server on your TP-Link.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p234320">
				<div class="post-metadata">
					<div class="post-num">Post #30</div>
					<div class="post-author">projects</div>
					<div class="post-datetime">
						23 May 2014, 02:58					</div>
				</div>
				<div class="post-content content">
					<p>&gt;I have no clue where 192.168.2.100 comes from, but you should get your TP-Links network <br />&gt;configuration right.</p><p>The main router is handing out the IP&#039;s, 192.168.1.100 to 192.168.1.110.</p><p>&gt;Start with a static IP on your TP-Link, to make things a bit easier.<br />&gt;If static works, go ahead to DHCP.</p><p>From early on when I got on this site to start learning about openwrt, I got dhcp client working fine. <br />I&#039;m not sure what changed but obviously, something has.</p><p>&gt;And you should disable DHCP-server on your TP-Link.</p><p>In one of the other posts I made, I asked about removing everything I didn&#039;t need, including dhcp server.<br />Maybe I accidentally updated my Image Builder tree or something because I was sure dhcpd was gone.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p234321">
				<div class="post-metadata">
					<div class="post-num">Post #31</div>
					<div class="post-author">projects</div>
					<div class="post-datetime">
						23 May 2014, 02:58					</div>
				</div>
				<div class="post-content content">
					<p>Also, why does ifconfig show 192.168.2.100 and uci show network shows network.lan.ipaddr=192.168.1.1?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p234322">
				<div class="post-metadata">
					<div class="post-num">Post #32</div>
					<div class="post-author">projects</div>
					<div class="post-datetime">
						23 May 2014, 03:02					</div>
				</div>
				<div class="post-content content">
					<p>In my target file, I have the following;<br />DEFAULT_PACKAGES:=base-files libc libgcc busybox dropbear mtd uci opkg hotplug2 netifd</p><p>To build, I&#039;ve been using the following;<br />make image PROFILE=TLWR703 PACKAGES=&quot;block-mount bash mtr curl -kmod-ath9k -kmod-usb-core -kmod-usb2 -uboot-envtools -wpad-mini&quot; FILES=files/</p><p>Did I somehow get dhcpd back into the build, plus it&#039;s running?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p234323">
				<div class="post-metadata">
					<div class="post-num">Post #33</div>
					<div class="post-author">tmo26</div>
					<div class="post-datetime">
						23 May 2014, 03:08					</div>
				</div>
				<div class="post-content content">
					<p>You didn&#039;t get back dhcpd, but you never excluded it from the build.</p><p>To exclude it (example from my TL-MR3020 build):</p><p>make image PROFILE=TLMR3020 PACKAGES=&quot;nano block-mount kmod-usb-storage kmod-fs-ext4 kmod-nls-cp437 kmod-nls-iso8859-1 -ppp -ppp-mod-pppoe -dnsmasq&quot; FILES=files/</p><p>-&gt; you missed the &#039;-dnsmasq&#039;</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p234325">
				<div class="post-metadata">
					<div class="post-num">Post #34</div>
					<div class="post-author">projects</div>
					<div class="post-datetime">
						23 May 2014, 03:14					</div>
				</div>
				<div class="post-content content">
					<p>Or, no one ever mentioned it when I was asking many times about that LOL.<br />Or maybe someone did and I missed it in the flurry of messages.</p><p>Ok, I&#039;ll throw a build together right now and see how that goes <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" />.</p><p>Still, strange that this would start happening seemingly out of the blue.<br />Be right back...</p>											<p class="post-edited">(Last edited by <strong>projects</strong> on 23 May 2014, 03:20)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p234326">
				<div class="post-metadata">
					<div class="post-num">Post #35</div>
					<div class="post-author">projects</div>
					<div class="post-datetime">
						23 May 2014, 03:15					</div>
				</div>
				<div class="post-content content">
					<p>Oh, before I do that... I&#039;m still going to have dhcp client so the device will pick up it&#039;s IP when it reboots right?</p>											<p class="post-edited">(Last edited by <strong>projects</strong> on 23 May 2014, 03:16)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p234327">
				<div class="post-metadata">
					<div class="post-num">Post #36</div>
					<div class="post-author">tmo26</div>
					<div class="post-datetime">
						23 May 2014, 03:22					</div>
				</div>
				<div class="post-content content">
					<p>Hmmm... damn, just checked my MR3020... and it still has dnsmasq installed.<br />I&#039;m unsure, if the image was built with the command I supplied before... <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p234329">
				<div class="post-metadata">
					<div class="post-num">Post #37</div>
					<div class="post-author">projects</div>
					<div class="post-datetime">
						23 May 2014, 03:25					</div>
				</div>
				<div class="post-content content">
					<p>I only added the -dnsmasq and rebuilt.</p><p>While it was rebooting, I did this from another workstation</p><p># arp -a<br />? (192.168.2.100) at 80:2d:e1:10:51:23 [ether] on eth0<br />? (192.168.1.29) at 00:20:94:10:44:93 [ether] on eth0<br />? (192.168.1.1) at 00:10:db:e1:37:8e [ether] on eth0<br />? (192.168.1.205) at 00:e0:4d:9d:90:d6 [ether] on eth0</p><p>There she is! Still pinging even while the device was rebooting so guess I need to hunt down 80:2d:e1:10:51:23</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p234330">
				<div class="post-metadata">
					<div class="post-num">Post #38</div>
					<div class="post-author">projects</div>
					<div class="post-datetime">
						23 May 2014, 03:27					</div>
				</div>
				<div class="post-content content">
					<p>Same problem. <br />BTW, udhcpc appears to be the dhcp client anyhow. There were no leases for dhcp and there was no dhcp server running on the device. </p><p># ps<br />&nbsp; PID USER&nbsp; &nbsp; &nbsp; &nbsp;VSZ STAT COMMAND<br />&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp; 1504 S&nbsp; &nbsp; init<br />&nbsp; &nbsp; 2 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&nbsp; &nbsp;[kthreadd]<br />&nbsp; &nbsp; 3 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&nbsp; &nbsp;[ksoftirqd/0]<br />&nbsp; &nbsp; 4 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&nbsp; &nbsp;[kworker/0:0]<br />&nbsp; &nbsp; 5 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&nbsp; &nbsp;[kworker/u:0]<br />&nbsp; &nbsp; 6 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&lt;&nbsp; [khelper]<br />&nbsp; &nbsp; 7 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&nbsp; &nbsp;[kworker/u:1]<br />&nbsp; &nbsp;63 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&nbsp; &nbsp;[sync_supers]<br />&nbsp; &nbsp;65 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&nbsp; &nbsp;[bdi-default]<br />&nbsp; &nbsp;67 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&lt;&nbsp; [kblockd]<br />&nbsp; &nbsp;96 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&nbsp; &nbsp;[kswapd0]<br />&nbsp; 144 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&nbsp; &nbsp;[fsnotify_mark]<br />&nbsp; 173 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&lt;&nbsp; [ath79-spi]<br />&nbsp; 184 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&nbsp; &nbsp;[mtdblock0]<br />&nbsp; 189 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&nbsp; &nbsp;[mtdblock1]<br />&nbsp; 194 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&nbsp; &nbsp;[mtdblock2]<br />&nbsp; 199 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&nbsp; &nbsp;[mtdblock3]<br />&nbsp; 204 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&nbsp; &nbsp;[mtdblock4]<br />&nbsp; 209 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&nbsp; &nbsp;[mtdblock5]<br />&nbsp; 250 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&nbsp; &nbsp;[kworker/0:1]<br />&nbsp; 437 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SWN&nbsp; [jffs2_gcd_mtd3]<br />&nbsp; 439 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&nbsp; &nbsp;[flush-mtd-unmap]<br />&nbsp; 477 root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 SW&nbsp; &nbsp;[kworker/0:2]<br />&nbsp; 481 root&nbsp; &nbsp; &nbsp; 1504 S&nbsp; &nbsp; init<br />&nbsp; 556 root&nbsp; &nbsp; &nbsp; 1508 S&nbsp; &nbsp; /sbin/syslogd -C16<br />&nbsp; 558 root&nbsp; &nbsp; &nbsp; 1488 S&nbsp; &nbsp; /sbin/klogd<br />&nbsp; 560 root&nbsp; &nbsp; &nbsp; &nbsp;848 S&nbsp; &nbsp; /sbin/hotplug2 --override --persistent --set-rules-file /etc/hotplug2.rules --set-coldplug-cmd /sbin/udevtrigger --max-c<br />&nbsp; 566 root&nbsp; &nbsp; &nbsp; &nbsp;872 S&nbsp; &nbsp; /sbin/ubusd<br />&nbsp; 583 root&nbsp; &nbsp; &nbsp; 1528 S&nbsp; &nbsp; /sbin/netifd<br />&nbsp; 625 root&nbsp; &nbsp; &nbsp; 1508 S&nbsp; &nbsp; udhcpc -p /var/run/udhcpc-br-lan.pid -s /lib/netifd/dhcp.script -f -t 0 -i br-lan -r 192.168.1.1 -C<br />&nbsp; 904 root&nbsp; &nbsp; &nbsp; 1500 S&nbsp; &nbsp; /sbin/watchdog -t 5 /dev/watchdog<br />&nbsp; 914 root&nbsp; &nbsp; &nbsp; 1152 S&nbsp; &nbsp; /usr/sbin/dropbear -P /var/run/dropbear.1.pid -p 22<br />&nbsp; 952 root&nbsp; &nbsp; &nbsp; 1500 S&nbsp; &nbsp; /usr/sbin/ntpd -n -p 0.openwrt.pool.ntp.org -p 1.openwrt.pool.ntp.org -p 2.openwrt.pool.ntp.org -p 3.openwrt.pool.ntp.or<br />&nbsp; 955 root&nbsp; &nbsp; &nbsp; 1220 R&nbsp; &nbsp; /usr/sbin/dropbear -P /var/run/dropbear.1.pid -p 22<br />&nbsp; 956 root&nbsp; &nbsp; &nbsp; 1504 S&nbsp; &nbsp; -ash<br />&nbsp; 963 root&nbsp; &nbsp; &nbsp; 1496 R&nbsp; &nbsp; ps</p><p>Still shows network.lan.ipaddr=192.168.1.1</p><p>#uci show network<br />network.loopback=interface<br />network.loopback.ifname=lo<br />network.loopback.proto=static<br />network.loopback.ipaddr=127.0.0.1<br />network.loopback.netmask=255.0.0.0<br />network.globals=globals<br />network.globals.ula_prefix=fd5f:467e:351c::/48<br />network.lan=interface<br />network.lan.ifname=eth0<br />network.lan.type=bridge<br />network.lan.ipaddr=192.168.1.1<br />network.lan.netmask=255.255.255.0<br />network.lan.ip6assign=60<br />network.lan.proto=dhcp</p><p># uci show dhcp<br />dhcp.@dnsmasq[0]=dnsmasq<br />dhcp.@dnsmasq[0].domainneeded=1<br />dhcp.@dnsmasq[0].boguspriv=1<br />dhcp.@dnsmasq[0].filterwin2k=0<br />dhcp.@dnsmasq[0].localise_queries=1<br />dhcp.@dnsmasq[0].rebind_protection=0<br />dhcp.@dnsmasq[0].rebind_localhost=1<br />dhcp.@dnsmasq[0].local=/lan/<br />dhcp.@dnsmasq[0].domain=lan<br />dhcp.@dnsmasq[0].expandhosts=1<br />dhcp.@dnsmasq[0].nonegcache=0<br />dhcp.@dnsmasq[0].authoritative=1<br />dhcp.@dnsmasq[0].readethers=1<br />dhcp.@dnsmasq[0].leasefile=/tmp/dhcp.leases<br />dhcp.@dnsmasq[0].resolvfile=/tmp/resolv.conf.auto<br />dhcp.lan=dhcp<br />dhcp.lan.interface=lan<br />dhcp.lan.start=100<br />dhcp.lan.limit=150<br />dhcp.lan.leasetime=12h<br />dhcp.lan.dhcpv6=hybrid<br />dhcp.lan.ra=hybrid<br />dhcp.lan.ndp=hybrid<br />dhcp.wan=dhcp<br />dhcp.wan.interface=wan<br />dhcp.wan.ignore=1<br />dhcp.odhcpd=odhcpd<br />dhcp.odhcpd.maindhcp=0<br />dhcp.odhcpd.leasefile=/tmp/hosts/odhcpd<br />dhcp.odhcpd.leasetrigger=/usr/sbin/odhcpd-update<br />dhcp.wan6=dhcp<br />dhcp.wan6.dhcpv6=hybrid<br />dhcp.wan6.ra=hybrid<br />dhcp.wan6.ndp=hybrid<br />dhcp.wan6.master=1</p>											<p class="post-edited">(Last edited by <strong>projects</strong> on 23 May 2014, 03:29)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p234331">
				<div class="post-metadata">
					<div class="post-num">Post #39</div>
					<div class="post-author">projects</div>
					<div class="post-datetime">
						23 May 2014, 03:34					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ve got wireshark running to see if I can get a lead on that mac address that pinged back.<br />I&#039;ve no idea where to start looking, there is so much hardware here.</p>											<p class="post-edited">(Last edited by <strong>projects</strong> on 23 May 2014, 03:40)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p234332">
				<div class="post-metadata">
					<div class="post-num">Post #40</div>
					<div class="post-author">projects</div>
					<div class="post-datetime">
						23 May 2014, 03:47					</div>
				</div>
				<div class="post-content content">
					<p>Strangely, it&#039;s working fine now. I&#039;ve tried repeatedly to log in and it is responding on first try.<br />While it was rebooting, it was still pinging so that has me interested.</p><p>Running nmap on 192.168.2.100 shows only ssh running, which is correct. <br />There are two other ips being handed out by that dhcp server and neither returns services which makes no sense.</p><p>I&#039;ll keep an eye on this and see if the weirdness stops and if so, I&#039;ll have to believe it was the dnsmasq package still installed.</p><p>Thanks very much for the help and the leads <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p234336">
				<div class="post-metadata">
					<div class="post-num">Post #41</div>
					<div class="post-author">qasdfdsaq</div>
					<div class="post-datetime">
						23 May 2014, 05:00					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>projects wrote:</cite><blockquote><p>Still shows network.lan.ipaddr=192.168.1.1</p><p>#uci show network<br />network.loopback=interface<br />network.loopback.ifname=lo<br />network.loopback.proto=static<br />network.loopback.ipaddr=127.0.0.1<br />network.loopback.netmask=255.0.0.0<br />network.globals=globals<br />network.globals.ula_prefix=fd5f:467e:351c::/48<br />network.lan=interface<br />network.lan.ifname=eth0<br />network.lan.type=bridge<br />network.lan.ipaddr=192.168.1.1<br />network.lan.netmask=255.255.255.0<br />network.lan.ip6assign=60<br />network.lan.proto=dhcp</p></blockquote></div><p>And it will continue to show that until you fix your /etc/config/network.</p><p>You have an incorrect configuration in that file that specifies both a static IP and DHCP for the same interface.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p234337">
				<div class="post-metadata">
					<div class="post-num">Post #42</div>
					<div class="post-author">qasdfdsaq</div>
					<div class="post-datetime">
						23 May 2014, 05:03					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>projects wrote:</cite><blockquote><p>I&#039;ve got wireshark running to see if I can get a lead on that mac address that pinged back.<br />I&#039;ve no idea where to start looking, there is so much hardware here.</p></blockquote></div><p>Supposedly it&#039;s a device made by Solarbridge Technologies.</p><p>Also, this is where NetDB would come in handy...</p><p>Also also, if you want to Wireshark anything useful, wireshark your machine while it&#039;s sending out a ton of DHCPDISCOVER packets.</p>											<p class="post-edited">(Last edited by <strong>qasdfdsaq</strong> on 23 May 2014, 05:04)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p234339">
				<div class="post-metadata">
					<div class="post-num">Post #43</div>
					<div class="post-author">projects</div>
					<div class="post-datetime">
						23 May 2014, 05:09					</div>
				</div>
				<div class="post-content content">
					<p>&gt;And it will continue to show that until you fix your /etc/config/network.<br />&gt;You have an incorrect configuration in that file that specifies both a static IP and DHCP for the same interface.</p><p>Ok but, what do I need to fix? <br />Is it because I am putting a &#039;network&#039; config in files/etc/config for my builds? <br />The only change in that file is that I added option dhcp. </p><p>Aw geez, I just looked at the file I&#039;m building with and here is it&#039;s content <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>config interface &#039;loopback&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname &#039;lo&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;static&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr &#039;127.0.0.1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask &#039;255.0.0.0&#039;</p><p>config globals &#039;globals&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ula_prefix &#039;fd5f:467e:351c::/48&#039;</p><p>config interface &#039;lan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname &#039;eth0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option type &#039;bridge&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr &#039;192.168.1.1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask &#039;255.255.255.0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ip6assign &#039;60&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;dhcp&#039;</p><p>Now I know why this didn&#039;t happen before, it&#039;s because I was still trying to figure out why the FILES option was not working and once I fixed that, this file ends up in the builds.</p><p>Guess I need to remove some options. I think I only need the dhcp option?</p><p>Or, do I even need this file in my builds since I have removed dnsmasq?<br />I need to have the device booting up looking for a dhcp ip from the local server.</p>											<p class="post-edited">(Last edited by <strong>projects</strong> on 23 May 2014, 05:10)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p234341">
				<div class="post-metadata">
					<div class="post-num">Post #44</div>
					<div class="post-author">qasdfdsaq</div>
					<div class="post-datetime">
						23 May 2014, 05:14					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>projects wrote:</cite><blockquote><p>Guess I need to remove some options. I think I only need the dhcp option?</p></blockquote></div><p>Yes.<br /></p><div class="quotebox"><cite>projects wrote:</cite><blockquote><p>Or, do I even need this file in my builds since I have removed dnsmasq?</p></blockquote></div><p>This file is totally unrelated to dnsmasq.<br /></p><div class="quotebox"><cite>projects wrote:</cite><blockquote><p>Ok but, what do I need to fix? </p><p>config interface &#039;lan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname &#039;eth0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option type &#039;bridge&#039;<br /><strong>&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr &#039;192.168.1.1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask &#039;255.255.255.0&#039;</strong> &lt;&lt; <span style="color: #FF0000">Remove these lines</span><br />&nbsp; &nbsp; &nbsp; &nbsp; option ip6assign &#039;60&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;dhcp&#039;</p></blockquote></div>											<p class="post-edited">(Last edited by <strong>qasdfdsaq</strong> on 23 May 2014, 05:19)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p234343">
				<div class="post-metadata">
					<div class="post-num">Post #45</div>
					<div class="post-author">projects</div>
					<div class="post-datetime">
						23 May 2014, 05:20					</div>
				</div>
				<div class="post-content content">
					<p>&gt;You probably don&#039;t need option type &#039;bridge&#039; either, unless you actually plan on bridging</p><p>Correct. The new file will look like;</p><p>config interface &#039;loopback&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname &#039;lo&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;static&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr &#039;127.0.0.1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask &#039;255.0.0.0&#039;</p><p>config globals &#039;globals&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ula_prefix &#039;fd5f:467e:351c::/48&#039;</p><p>config interface &#039;lan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname &#039;eth0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ip6assign &#039;60&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;dhcp&#039;</p><p>Not sure I also need the ip6assign option. <br />I was wondering however if I even need to use this file in my builds? Does the device automatically come up in dhcp client mode without dnsmasq installed? </p><p>I also copy the following into my files/etc/config<br />This seems to be overkill because all I need to do is set option rebind_protection &#039;0&#039; so that the device will use the dhcp server provided dns servers. I&#039;ve not seen any other way however.</p><p>I had posted somewhere asking if there was a way I could just set these things upon bootup, before the network started, like </p><p>uci set network.lan.proto=dhcp<br />uci set dhcp.conf.rebind_protection=0<br />uci commit network</p><p>or what ever I need to set. However, that&#039;s another question I have out there, how to do this and how to run a script using rc.local when the device starts for example.</p><br /><br /><p>config dnsmasq<br />&nbsp; &nbsp; &nbsp; &nbsp; option domainneeded &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option boguspriv &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option filterwin2k &#039;0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option localise_queries &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option rebind_protection &#039;0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option rebind_localhost &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option local &#039;/lan/&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option domain &#039;lan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option expandhosts &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option nonegcache &#039;0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option authoritative &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option readethers &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option leasefile &#039;/tmp/dhcp.leases&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option resolvfile &#039;/tmp/resolv.conf.auto&#039;</p><p>config dhcp &#039;lan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option interface &#039;lan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option start &#039;100&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option limit &#039;150&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option leasetime &#039;12h&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option dhcpv6 &#039;hybrid&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ra &#039;hybrid&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ndp &#039;hybrid&#039;</p><p>config dhcp &#039;wan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option interface &#039;wan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ignore &#039;1&#039;</p><p>config odhcpd &#039;odhcpd&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option maindhcp &#039;0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option leasefile &#039;/tmp/hosts/odhcpd&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option leasetrigger &#039;/usr/sbin/odhcpd-update&#039;</p><p>config dhcp &#039;wan6&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option dhcpv6 &#039;hybrid&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ra &#039;hybrid&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ndp &#039;hybrid&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option master &#039;1&#039;</p>											<p class="post-edited">(Last edited by <strong>projects</strong> on 23 May 2014, 05:21)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p234344">
				<div class="post-metadata">
					<div class="post-num">Post #46</div>
					<div class="post-author">projects</div>
					<div class="post-datetime">
						23 May 2014, 05:30					</div>
				</div>
				<div class="post-content content">
					<p>Sure enough, my solarbridge had the same IP, which I have no idea how it did that but what ever, it happened. I think it&#039;s because it never releases the lease. I&#039;ll have to look into that.</p><p>Anyhow, I rebooted using the edited network file and things came up ok. However, the following still shows up the same as before. </p><p>network.lan.ipaddr=192.168.1.1</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p234345">
				<div class="post-metadata">
					<div class="post-num">Post #47</div>
					<div class="post-author">projects</div>
					<div class="post-datetime">
						23 May 2014, 05:33					</div>
				</div>
				<div class="post-content content">
					<p>I put my custom rc.local in files/etc/rc.local but the only one that ever shows up is the default;</p><p># Put your custom commands here that should be executed once<br /># the system init finished. By default this file does nothing.</p><p>exit 0</p><p>How can I get a custom rc.local or custom network settings set during bootup? I also need to auto start a script when the device starts which is why I wanted to put it in rc.local.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p234346">
				<div class="post-metadata">
					<div class="post-num">Post #48</div>
					<div class="post-author">qasdfdsaq</div>
					<div class="post-datetime">
						23 May 2014, 05:44					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>projects wrote:</cite><blockquote><p>I was wondering however if I even need to use this file in my builds? Does the device automatically come up in dhcp client mode without dnsmasq installed?</p></blockquote></div><p>If you want to set network settings then you will need the network settings file.<br />Without the network settings file it&#039;ll default to whatever it&#039;s hardcoded to default to, which IIRC is some advanced build option somewhere that is itself set to 192.168.1.1 by default.</p><div class="quotebox"><cite>projects wrote:</cite><blockquote><p>I also copy the following into my files/etc/config<br />This seems to be overkill because all I need to do is set option rebind_protection &#039;0&#039; so that the device will use the dhcp server provided dns servers. I&#039;ve not seen any other way however.</p></blockquote></div><p>This is not correct. The rebind_protection applies only to dnsmasq servers, it has no effect on clients. Especially when you have dnsmasq removed. Nothing is even going to read that configuration file, let alone do anything with it.</p><div class="quotebox"><blockquote><p>I had posted somewhere asking if there was a way I could just set these things upon bootup, before the network started, like </p><p>uci set network.lan.proto=dhcp<br />uci set dhcp.conf.rebind_protection=0<br />uci commit network</p></blockquote></div><p>There&#039;s absolutely no point in trying to do this. All uci set does is write settings to the config files in /etc/config.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p234355">
				<div class="post-metadata">
					<div class="post-num">Post #49</div>
					<div class="post-author">projects</div>
					<div class="post-datetime">
						23 May 2014, 07:09					</div>
				</div>
				<div class="post-content content">
					<p>Ok, so, you&#039;ve told me all of the things I can&#039;t do and I&#039;m new to this so how about sharing what I can and should do <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>All I need is to boot this device so that it is a dhcp client, picking up it&#039;s dns servers from the dhcp server. That&#039;s it, nothing more complicated. Don&#039;t need dhcp server, etc. </p><p>And, I am trying to figure out the rc.local problem I mentioned. I&#039;ve been at this for some time now and no matter how much I read, it has been the people in the forums who have helped me understand things by giving me examples and answers.</p><p>I thought I was starting to learn and I&#039;m sure I am but at the moment, I&#039;m rather confused because I have several problems I am trying to solve at the same time.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p234363">
				<div class="post-metadata">
					<div class="post-num">Post #50</div>
					<div class="post-author">tmo26</div>
					<div class="post-datetime">
						23 May 2014, 09:11					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>projects wrote:</cite><blockquote><p>I thought I was starting to learn and I&#039;m sure I am but at the moment, I&#039;m rather confused because I have several problems I am trying to solve at the same time.</p></blockquote></div><p>You are definetely trying too much at one time. Go step-by-step. Start with a very simple basic image, then go one modification at a time, not a dozen at the same time. </p><p>That&#039;s how I did it with my MR3020. I had a lot less problems than you <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>The first and only thing you should do: Get your network settings in order.</p>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 2 of 3</div><nav><ul><li><a href="viewtopic.php%3Fid=50739&amp;p=1.html">1</a></li><li class="pagination-current"><span>2</span></li><li><a href="viewtopic.php%3Fid=50739&amp;p=3.html">3</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>