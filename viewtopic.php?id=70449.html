<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Translating .ovpn to /etc/config/openvpn</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 1 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p355414">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">slack---line</div>
					<div class="post-datetime">
						1 Apr 2017, 14:33					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>I&#039;ve successfully setup OpenVPN on Linksys WRT1900ACS running Chaos Calmer 15.05.1 by having a .ovpn file and pointing UCI to use that.</p><p>/etc/config/openvpn<br /></p><div class="codebox"><pre><code>config openvpn &#039;SlickVPN&#039;
    option config &#039;/etc/openvpn/SlickVPN.ovpn&#039;
    option log &#039;/var/log/openvpn.log&#039;</code></pre></div><p>/etc/openvpn/SlickVPN.ovpn<br /></p><div class="codebox"><pre><code># host/port of vpn server
remote-random
remote gw1.lhr4.slickvpn.com 443
remote gw1.man2.slickvpn.com 443
remote gw1.iom1.slickvpn.com 443
#remote gw1.dub1.slickvpn.com 443
#remote gw1.ost1.slickvpn.com 443
#remote gw1.lil1.slickvpn.com 443
#remote gw1.ams3.slickvpn.com 443
#remote gw1.lux1.slickvpn.com 443

# file containing username and password
#auth-user-pass openvpn.userpass
# ... or prompt for authentication
auth-user-pass /etc/openvpn/slickvpn
auth-nocache

# equivalent to pull, tls-client
client

# redirect all outgoing traffic to the vpn gateway
redirect-gateway

# Pull DNS names from server once connected
allow-pull-fqdn
dhcp-option DNS &#039;87.98.175.85&#039;
dhcp-option DNS &#039;193.183.98.154&#039;
dhcp-option DNS &#039;5.135.183.146&#039;

# verify the server certificate for authenticity
remote-cert-tls server

cipher AES-256-CBC

proto udp
dev tun
keepalive 10 120
nobind

persist-key
persist-tun

# ssl certificate / key used for tls
#ca certs/ca.crt
#cert certs/client1.crt
#key certs/client1.key

&lt;ca&gt;
-----BEGIN CERTIFICATE-----
MIIDQDCCAqmgAwIBAgIJAM8Brk2pUr0KMA0GCSqGSIb3DQEBBQUAMHQxCzAJBgNV
BAYTAlVTMQswCQYDVQQIEwJDQTEMMAoGA1UEBxMDVlBOMQwwCgYDVQQKEwNWUE4x
DDAKBgNVBAsTA1ZQTjEMMAoGA1UEAxMDVlBOMQwwCgYDVQQpEwNWUE4xEjAQBgkq
hkiG9w0BCQEWA1ZQTjAeFw0xMjAzMDMwMjExNDJaFw0yMjAzMDEwMjExNDJaMHQx
CzAJBgNVBAYTAlVTMQswCQYDVQQIEwJDQTEMMAoGA1UEBxMDVlBOMQwwCgYDVQQK
EwNWUE4xDDAKBgNVBAsTA1ZQTjEMMAoGA1UEAxMDVlBOMQwwCgYDVQQpEwNWUE4x
EjAQBgkqhkiG9w0BCQEWA1ZQTjCBnzANBgkqhkiG9w0BAQEFAAOBjQAwgYkCgYEA
wY2K08N7or1Br/EsD9XBon7gs7dKflWYuymgMLJfeMFWuJloNdsn+3GARIhYBbN6
zhvFGFE214qKPqAydW1WmIIK7KoC0sgndr+Vk/au9gssFzVmmvr6+WN/nfo2L9Kv
vBMoYLrMAiyw/D4cRapZi2pXJLcMDfC+p1VWAX8TYWkCAwEAAaOB2TCB1jAdBgNV
HQ4EFgQUmyvO4rTnu5/ABnp0FngU+SdR8WAwgaYGA1UdIwSBnjCBm4AUmyvO4rTn
u5/ABnp0FngU+SdR8WCheKR2MHQxCzAJBgNVBAYTAlVTMQswCQYDVQQIEwJDQTEM
MAoGA1UEBxMDVlBOMQwwCgYDVQQKEwNWUE4xDDAKBgNVBAsTA1ZQTjEMMAoGA1UE
AxMDVlBOMQwwCgYDVQQpEwNWUE4xEjAQBgkqhkiG9w0BCQEWA1ZQToIJAM8Brk2p
Ur0KMAwGA1UdEwQFMAMBAf8wDQYJKoZIhvcNAQEFBQADgYEAoB0kOuGvrzPBTIRX
IDHCCxBMdny+3sKAOllmH4+51j2aWhAJ4Pyc/yBTYyQGNoriABjmNzp+R05oiaxA
D3vTgR80juKDPtQb8LoGLBF18gL7Vtc3+hJXcJasXZaDSSoyh5f+TtGvytIT+ece
JWIrKnFXzlHOvKlyLkcZn15gwKQ=
-----END CERTIFICATE-----
&lt;/ca&gt;

log-append /var/log/openvpn.log</code></pre></div><p>This mostly works, I can enable the interface (Save &amp; Apply) and start it using LuCi to start the VPN, it connects and all devices on my LAN have their traffic passed through the VPN.&nbsp; What doesn&#039;t work is stopping the VPN connection from LuCi, clicking &#039;Stop&#039; will stop it, but it restarts on its own, disabling the interface completely doesn&#039;t help either, the OpenVPN connection keeps on getting started, I have to SSH in and &#039;killall openvpn&#039; in order to stop it permanently and prevent it from reconnecting.</p><p>To this end I would like to migrate the settings to LuCi in /etc/config/openvpn and have (by <a href="https://wiki.openwrt.org/doc/uci">editing the file directly</a>) written the following...</p><div class="codebox"><pre><code>config openvpn &#039;SlickVPN&#039;
        option _role             &quot;client&quot;
        option client            &quot;1&quot;
        option remote-random     &quot;1&quot;
        list   remote            &quot;gw1.lhr4.slickvpn.com 443&quot;
        list   remote            &quot;gw1.man2.slickvpn.com 443&quot;
        list   remote            &quot;gw1.iom1.slickvpn.com 443&quot;
        option dev               &quot;tun&quot;
        option proto             &quot;udp&quot;
        option nobind            &quot;1&quot;
        option persist_key       &quot;1&quot;
        option persist_tun       &quot;1&quot;
        option keepalive         &quot;10 120&quot;
        option auth-user-pass    &quot;/etc/openvpn/slickvpn&quot;
        option auth-nocache      &quot;1&quot;
        option redirect-gateway  &quot;1&quot;
        option cipher            &quot;AES-256-CBC&quot;
        option ca                &quot;ca.crt&quot;
        option cert              &quot;/etc/openvpn/slickvpn.crt&quot;
        list   push              &quot;allow-pull-fqdn&quot;
        list   push              &quot;dhcp-option DNS &#039;87.98.175.85&#039;&quot;
        list   push              &quot;dhcp-option DNS &#039;193.183.98.154&#039;&quot;
        list   push              &quot;dhcp-option DNS &#039;5.135.183.146&#039;&quot;
        option log               &quot;/var/log/openvpn.log&quot;</code></pre></div><p>...and have placed a copy of the ca.crt in /etc/openvpn/slickvpn.crt</p><div class="codebox"><pre><code>-----BEGIN CERTIFICATE-----
MIIDQDCCAqmgAwIBAgIJAM8Brk2pUr0KMA0GCSqGSIb3DQEBBQUAMHQxCzAJBgNV
BAYTAlVTMQswCQYDVQQIEwJDQTEMMAoGA1UEBxMDVlBOMQwwCgYDVQQKEwNWUE4x
DDAKBgNVBAsTA1ZQTjEMMAoGA1UEAxMDVlBOMQwwCgYDVQQpEwNWUE4xEjAQBgkq
hkiG9w0BCQEWA1ZQTjAeFw0xMjAzMDMwMjExNDJaFw0yMjAzMDEwMjExNDJaMHQx
CzAJBgNVBAYTAlVTMQswCQYDVQQIEwJDQTEMMAoGA1UEBxMDVlBOMQwwCgYDVQQK
EwNWUE4xDDAKBgNVBAsTA1ZQTjEMMAoGA1UEAxMDVlBOMQwwCgYDVQQpEwNWUE4x
EjAQBgkqhkiG9w0BCQEWA1ZQTjCBnzANBgkqhkiG9w0BAQEFAAOBjQAwgYkCgYEA
wY2K08N7or1Br/EsD9XBon7gs7dKflWYuymgMLJfeMFWuJloNdsn+3GARIhYBbN6
zhvFGFE214qKPqAydW1WmIIK7KoC0sgndr+Vk/au9gssFzVmmvr6+WN/nfo2L9Kv
vBMoYLrMAiyw/D4cRapZi2pXJLcMDfC+p1VWAX8TYWkCAwEAAaOB2TCB1jAdBgNV
HQ4EFgQUmyvO4rTnu5/ABnp0FngU+SdR8WAwgaYGA1UdIwSBnjCBm4AUmyvO4rTn
u5/ABnp0FngU+SdR8WCheKR2MHQxCzAJBgNVBAYTAlVTMQswCQYDVQQIEwJDQTEM
MAoGA1UEBxMDVlBOMQwwCgYDVQQKEwNWUE4xDDAKBgNVBAsTA1ZQTjEMMAoGA1UE
AxMDVlBOMQwwCgYDVQQpEwNWUE4xEjAQBgkqhkiG9w0BCQEWA1ZQToIJAM8Brk2p
Ur0KMAwGA1UdEwQFMAMBAf8wDQYJKoZIhvcNAQEFBQADgYEAoB0kOuGvrzPBTIRX
IDHCCxBMdny+3sKAOllmH4+51j2aWhAJ4Pyc/yBTYyQGNoriABjmNzp+R05oiaxA
D3vTgR80juKDPtQb8LoGLBF18gL7Vtc3+hJXcJasXZaDSSoyh5f+TtGvytIT+ece
JWIrKnFXzlHOvKlyLkcZn15gwKQ=
-----END CERTIFICATE-----</code></pre></div><p>First attempt to view the LuCi OpenVPN interface based on this new configuration I&#039;m told...</p><div class="codebox"><pre><code>/usr/lib/lua/luci/dispatcher.lua:433: Failed to execute cbi dispatcher target for entry &#039;/admin/services/openvpn&#039;.
The called action terminated with an exception:
/usr/lib/lua/luci/cbi.lua:311: Unable to read UCI data: openvpn
stack traceback:
    [C]: in function &#039;assert&#039;
    /usr/lib/lua/luci/dispatcher.lua:433: in function &#039;dispatch&#039;
    /usr/lib/lua/luci/dispatcher.lua:168: in function &lt;/usr/lib/lua/luci/dispatcher.lua:167&gt;</code></pre></div><p>...which suggests I&#039;ve cocked up writing the rules (theres a closed issue <a href="https://github.com/openwrt/luci/issues/697">here</a> detailing a similar error).</p><p>Copying the original configuration that uses the /etc/openvpn/SlickVPN.ovpn restores access to the LuCi OpenVPN interface and I can start (but still not stop) OpenVPN.</p><p>I considered trying to Add a new interface via LuCi but the Advanced Configuration doesn&#039;t seem to allow specifying DNS.</p><p>I&#039;d be grateful of advice on two fronts...</p><p>1) How to ensure OpenVPN can be stopped from LuCi, the reason I&#039;m trying to...<br />2) Translate /etc/openvpn/SlickVPN.ovpn to /etc/config/openvpn correctly</p><p>Thanks in advance for any suggestions.</p><p>slack</p>											<p class="post-edited">(Last edited by <strong>slack---line</strong> on 1 Apr 2017, 14:38)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p355436">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">webtron</div>
					<div class="post-datetime">
						2 Apr 2017, 01:51					</div>
				</div>
				<div class="post-content content">
					<p>Get rid of<br />option _role&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&quot;client&quot;<br />and give the full path to the crt<br />option ca&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;ca.crt&quot;</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p355522">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">slack---line</div>
					<div class="post-datetime">
						3 Apr 2017, 13:04					</div>
				</div>
				<div class="post-content content">
					<p>Thanks, will try those suggestions out this evening.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p355554">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">slack---line</div>
					<div class="post-datetime">
						3 Apr 2017, 23:22					</div>
				</div>
				<div class="post-content content">
					<p>Tried without the _role option and the full path to the certificate...</p><div class="codebox"><pre><code># cat openvpn

config openvpn &#039;SlickVPN&#039;
    option client            &#039;1&#039;
    option remote-random     &#039;1&#039;
    list   remote            &#039;gw1.lhr4.slickvpn.com 443&#039;
    list   remote            &#039;gw1.man2.slickvpn.com 443&#039;
        list   remote            &#039;gw1.iom1.slickvpn.com 443&#039;
    option dev               &#039;tun&#039;
    option proto             &#039;udp&#039;
        option nobind            &#039;1&#039;
    option persist_key       &#039;1&#039;
    option persist_tun       &#039;1&#039;
    option keepalive         &#039;10 120&#039;
    option auth-user-pass    &#039;/etc/openvpn/slickvpn&#039;
    option auth-nocache      &#039;1&#039;
    option redirect-gateway  &#039;1&#039;
    option cipher            &#039;AES-256-CBC&#039;
        option ca                &#039;/etc/openvpn/slickvpn.crt&#039;
    list   push              &#039;allow-pull-fqdn&#039;
        list   push              &#039;dhcp-option DNS 87.98.175.85&#039;
    list   push              &#039;dhcp-option DNS 193.183.98.154&#039;
    list   push              &#039;dhcp-option DNS 5.135.183.146&#039;
    option log               &#039;/var/log/openvpn.log&#039;</code></pre></div><p>But it seems LuCi still doesn&#039;t like this configuration as going to Services &gt; OpenVPN gives the same error...</p><div class="codebox"><pre><code>/usr/lib/lua/luci/dispatcher.lua:433: Failed to execute cbi dispatcher target for entry &#039;/admin/services/openvpn&#039;.
The called action terminated with an exception:
/usr/lib/lua/luci/cbi.lua:311: Unable to read UCI data: openvpn
stack traceback:
    [C]: in function &#039;assert&#039;
    /usr/lib/lua/luci/dispatcher.lua:433: in function &#039;dispatch&#039;
    /usr/lib/lua/luci/dispatcher.lua:168: in function &lt;/usr/lib/lua/luci/dispatcher.lua:167&gt;</code></pre></div><p>Thought it might be second set of list options to push DNS so removed them and tried again, but no joy.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p355555">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">webtron</div>
					<div class="post-datetime">
						3 Apr 2017, 23:50					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;d break down the config file to minimum and add lines back until you find the syntax error.<br />Change auth-user-pass to auth_user_pass<br /></p><div class="codebox"><pre><code>config openvpn &#039;SlickVPN&#039;
    option client            &#039;1&#039;
    option enabled &#039;1&#039;
    list   remote            &#039;gw1.lhr4.slickvpn.com 443&#039;
    option dev               &#039;tun&#039;
    option proto             &#039;udp&#039;
    option auth_user_pass    &#039;/etc/openvpn/slickvpn&#039;
    option cipher            &#039;AES-256-CBC&#039;
    option ca                &#039;/etc/openvpn/slickvpn.crt&#039;</code></pre></div><p>Could also be related to this bug report <a href="https://dev.openwrt.org/ticket/19788">https://dev.openwrt.org/ticket/19788</a></p>											<p class="post-edited">(Last edited by <strong>webtron</strong> on 3 Apr 2017, 23:50)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p355570">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">slack---line</div>
					<div class="post-datetime">
						4 Apr 2017, 09:21					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for the advice, I wasn&#039;t sure what was a minimum, but now realise at this point since I&#039;m trying to get the config file read by LuCi I don&#039;t need all options to work to allow me to establish a VPN connection.</p><p>Stripped it back then started adding things, and a quick bit of trial and error revealed that putting in...</p><div class="codebox"><pre><code>        option remote-random     &#039;1&#039;</code></pre></div><p>...caused the error, but as you suggested with auth_user_pass (i.e. use underscores) it worked so that was&nbsp; my mistake as...</p><div class="codebox"><pre><code>        option remote_random     &#039;1&#039;</code></pre></div><p>...worked ok and LuCI shows Services &gt; OpenVPN, I&#039;d not read that underscores rather than dashes were required in the <a href="https://wiki.openwrt.org/doc/uci">uci documentation</a>.&nbsp; Building things up in steps I&#039;ve found the following options aren&#039;t recognised in so much as they don&#039;t show in LuCi...</p><div class="codebox"><pre><code>    option keepalive         &#039;10 120&#039;
## More than one list remote and only the first is recognised (not a huge problem since I can add them through LuCi now)
    list   remote            &#039;gw1.lhr4.slickvpn.com 443&#039;
    list   remote            &#039;gw1.man2.slickvpn.com 443&#039;
    list   remote            &#039;gw1.iom1.slickvpn.com 443&#039;
## DNS entries but I think I&#039;ve misunderstood openvpn configuration as these are probably contradictory
    list   push              &#039;allow-pull-fqdn&#039;
    list   push              &#039;dhcp-option DNS 87.98.175.85&#039;
    list   push              &#039;dhcp-option DNS 193.183.98.154&#039;
    list   push              &#039;dhcp-option DNS 5.135.183.146&#039;</code></pre></div><p>For DNS I think I can ditch the reference to allow-pull-fqdn as that is (I think after reading this morning) requesting DNS from the OpenVPN server, and I&#039;d be happy to use the OpenNIC addresses I&#039;m trying to specify explicitly.</p><p>As I built up the configuration file and tested it I found that the &#039;option redirect_gateway &#039;1&#039;&#039; caused problems and OpenVPN wouldn&#039;t start, checking the log I found...</p><div class="codebox"><pre><code># cat /var/log/openvpn.log 
Options error: unknown --redirect-gateway flag: 1
Use --help for more information.</code></pre></div><p>...and reading the <a href="https://openvpn.net/index.php/open-source/documentation/manuals/65-openvpn-20x-manpage.html">OpenVPN manual</a> --redirect-gateway takes two options &#039;[local]&#039; or &#039;[def]&#039; neither of which I had defined in /etc/openvpnc/SlickVPN.ovpn.&nbsp; If I change to</p><div class="codebox"><pre><code>        option redirect_gateway</code></pre></div><p>...the VPN starts but no traffic is passed from LAN over tun to WAN.</p><p>Also, importantly, I found that whilst I can start OpenVPN from LuCi, I couldn&#039;t stop it from there, and even &#039;killall openvpn&#039; doesn&#039;t do the trick, something keeps on respawning it.&nbsp; I removed the following option and can stop OpenVPN from LuCi...</p><div class="codebox"><pre><code>        option persist_tun &#039;1&#039;</code></pre></div><p>But this is great progress and I&#039;m very grateful for the suggestion of switching &#039;-&#039; to &#039;_&#039; as I&#039;d been scratching my head for a while, thank you.&nbsp; My current working config is...</p><div class="codebox"><pre><code>config openvpn &#039;SlickVPN&#039;
        option client         &#039;1&#039;
        option enabled        &#039;1&#039;
        option dev            &#039;tun&#039;
        option proto          &#039;udp&#039;
        option nobind         &#039;1&#039;
        option persist_key    &#039;1&#039;
        option keepalive      &#039;10 120&#039;
        option auth_user_pass &#039;/etc/openvpn/slickvpn&#039;
        option auth_nocache   &#039;1&#039;
        option cipher         &#039;AES-256-CBC&#039;
        option ca             &#039;/etc/openvpn/slickvpn.crt&#039;
        option log            &#039;/var/log/openvpn.log&#039;
        option remote         &#039;gw1.lhr4.slickvpn.com 443&#039;
        option redirect_gateway</code></pre></div>											<p class="post-edited">(Last edited by <strong>slack---line</strong> on 4 Apr 2017, 09:38)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p355572">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">ulmwind</div>
					<div class="post-datetime">
						4 Apr 2017, 10:15					</div>
				</div>
				<div class="post-content content">
					<p><strong>slack---line</strong>, in your initial configuration openvpn starts not from its uci config, but from scanning all *.ovpn files (see manual to OpenVPN). Change its extension to *.conf and see the difference. To enable it from uci config you should add option enabled &#039;1&#039;. You can run and stop it from LuCI now. After that you can move options from included OpenVPN-config to uci config, one by one, and check result.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p355575">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">slack---line</div>
					<div class="post-datetime">
						4 Apr 2017, 11:40					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>ulmwind wrote:</cite><blockquote><p><strong>slack---line</strong>, in your initial configuration openvpn starts not from its uci config, but from scanning all *.ovpn files (see manual to OpenVPN). Change its extension to *.conf and see the difference. To enable it from uci config you should add option enabled &#039;1&#039;. You can run and stop it from LuCI now. After that you can move options from included OpenVPN-config to uci config, one by one, and check result.</p></blockquote></div><p>Hi ulmwind,</p><p>I&#039;ve removed the original...</p><div class="codebox"><pre><code>config openvpn &#039;SlickVPN&#039;
    option config &#039;/etc/openvpn/SlickVPN.ovpn&#039;
    option log &#039;/var/log/openvpn.log&#039;</code></pre></div><p>...from /etc/config/openvpn but I&#039;d left the configuration file (/etc/openvpn/SlickVPN.conf in place so what you&#039;re telling me is that because that file still exists, even though I&#039;m starting using a newer, UCI configuration, openvpn sees the file exists and uses that.</p><p>I&#039;ve renamed the file extension and will try this evening when I get home.&nbsp; Thanks for your advice, very much appreciated.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p355578">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">ulmwind</div>
					<div class="post-datetime">
						4 Apr 2017, 12:13					</div>
				</div>
				<div class="post-content content">
					<p><strong>slack---line</strong>, not exactly.<br />Yes, rename the file to /etc/openvpn/SlickVPN.conf, and modify config, not remove it completely:<br /></p><div class="codebox"><pre><code>config openvpn &#039;SlickVPN&#039;
    option config &#039;/etc/openvpn/SlickVPN.conf&#039;
    option log &#039;/var/log/openvpn.log&#039;</code></pre></div><p>See difference using *.ovpn and *.conf file.</p>											<p class="post-edited">(Last edited by <strong>ulmwind</strong> on 4 Apr 2017, 12:14)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p355639">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">slack---line</div>
					<div class="post-datetime">
						5 Apr 2017, 08:47					</div>
				</div>
				<div class="post-content content">
					<p><strong>ulmwind</strong></p><p>Thanks for&nbsp; &nbsp;the suggestion, but I&#039;m trying to migrate the settings from /etc/openvpn/SlickVPN.ovpn to uci.</p><p>Decided to move /etc/openvpn/SlickVPN.ovpn as what I think is happening is starting OpenVPN from LuCi this configuration file is being seen and used in preference of the uci configuration, evidenced by...</p><div class="codebox"><pre><code># ps | grep openvpn
20692 root      3052 S    /usr/sbin/openvpn --syslog openvpn(SlickVPN) --status /var/run/openvpn.SlickVPN.status --cd /etc/openvpn --config /etc/openvpn/SlickVPN.conf</code></pre></div><p>Moving the file results in me being able to start and stop OpenVPN from LuCi although traffic isn&#039;t routed over the device yet, this means (I think after reading the <a href="https://openvpn.net/index.php/open-source/documentation/manuals/65-openvpn-20x-manpage.html">OpenVPN manual</a>) I need to specify some --route options to ensure data from WAN is directed to tun0.&nbsp; Some of the options I&#039;ve not yet migrated from /etc/openvpn/SlickVPN.conf to /etc/config/openvpn are...</p><br /><div class="codebox"><pre><code># Pull DNS names from server once connected
allow-pull-fqdn
dhcp-option DNS &#039;87.98.175.85&#039;
dhcp-option DNS &#039;193.183.98.154&#039;
dhcp-option DNS &#039;5.135.183.146&#039;

# verify the server certificate for authenticity
remote-cert-tls server</code></pre></div><p>I think the first DNS are actually in conflict since the first line says &quot;use VPNs DNS&quot; the next three say use my preferred OpenNIC address&#039; for DNS.</p><p>Progress though \o/, thanks everyone for advice.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p355642">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">webtron</div>
					<div class="post-datetime">
						5 Apr 2017, 09:48					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;d try just pulling the routes etc from slickvpn first before you start adding dns servers.<br />option pull &#039;1&#039;</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p355643">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">ulmwind</div>
					<div class="post-datetime">
						5 Apr 2017, 09:58					</div>
				</div>
				<div class="post-content content">
					<p><strong>slack---line</strong>, you haven&#039;t tried changing ovpn to conf.</p><p>The simplest case is to route all traffic to VPN: <br /></p><div class="codebox"><pre><code>      option &#039;redirect_gateway&#039; &#039;def1&#039;</code></pre></div><p>The same for DNS:<br /></p><div class="codebox"><pre><code>      list &#039;dhcp_option&#039; &#039;DNS 87.98.175.85&#039;</code></pre></div><p>But if it is in conflict with &#039;allow-pull-fqdn&#039;, you should remove &#039;dhcp_option&#039;.<br />You can also write custom scripts and run them in up/down connection.</p><p><strong>webtron</strong>, it is optional: note that the --pull option is implied by --client</p>											<p class="post-edited">(Last edited by <strong>ulmwind</strong> on 5 Apr 2017, 10:02)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p355701">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">slack---line</div>
					<div class="post-datetime">
						6 Apr 2017, 09:44					</div>
				</div>
				<div class="post-content content">
					<p>Thanks <strong>ulmwond</strong> and <strong>webtron</strong></p><p>I&#039;d originally set</p><div class="codebox"><pre><code>    option redirect_gateway &#039;&#039;</code></pre></div><p>...having read in the <a href="https://openvpn.net/index.php/open-source/documentation/manuals/65-openvpn-20x-manpage.html">OpenVPN man page</a> that said the &#039;def1&#039; option would be the default by OpenVPN 2.1.&nbsp; Have now explicitly added it though.</p><p>I&#039;d like to stick with using OpenNIC so have opted to ditch the allow_pull_fqdn option instead.</p><p>Things seem to be working as I&#039;d hoped though, I can stop/start OpenVPN from LuCi.&nbsp; My configuration (should it be of use to anyone else) is currently...</p><div class="codebox"><pre><code>config openvpn &#039;SlickVPN&#039;
    option client           &#039;1&#039;
    option enabled          &#039;1&#039;
    option dev              &#039;tun&#039;
    option proto            &#039;udp&#039;
    option nobind           &#039;1&#039;
    option persist_key      &#039;1&#039;
    option keepalive        &#039;10 120&#039;
    option auth_user_pass   &#039;/etc/openvpn/slickvpn&#039;
    option auth_nocache     &#039;1&#039;
    option cipher           &#039;AES-256-CBC&#039;
    option ca               &#039;/etc/openvpn/slickvpn.crt&#039;
    option remote_cert_tls  &#039;server&#039;
    option log              &#039;/var/log/openvpn.log&#039;
    option remote           &#039;gw1.lhr4.slickvpn.com 443&#039;
    option redirect_gateway &#039;def1&#039;
    list   dhcp_option      &#039;DNS 87.98.175.85&#039;
    list   dhcp_option      &#039;DNS 193.183.98.154&#039;
    list   dhcp_option      &#039;DNS 5.135.183.146&#039;</code></pre></div><br /><p>Now to work on using the <a href="https://forum.openwrt.org/viewtopic.php?id=69489">VPNByPass</a> to route Netflix/iPlayer/etc. around the VPN.</p><p>Thank you both very much for your help, very much appreciated.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>