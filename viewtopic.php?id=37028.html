<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> TL-WR1043ND as AP/client</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 20 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p168030">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">linuxuser</div>
					<div class="post-datetime">
						23 May 2012, 22:00					</div>
				</div>
				<div class="post-content content">
					<p>I have 2 TL-WR1043ND, one is working as a router (as it should) and then a 2nd TL-WR1043ND, fresh setup, which should connect to the 1st (router). Both have Backfire (10.03.1, r29592) installed.</p><p>On the 2nd one I will connect an ip-cam via ethernet cable, so the ip-cam gets a wifi-connection at the end.</p><p>How do I have to setup this?</p><p>At the moment I have:<br />Wireless Overview<br />No network configured on this device</p><p>Simply said, I am searching for a place, where I can enter SSID and password of the 1st WR1043ND (router)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p168051">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">ninno</div>
					<div class="post-datetime">
						24 May 2012, 07:34					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>linuxuser wrote:</cite><blockquote><p>I have 2 TL-WR1043ND, ... On the 2nd one I will connect an ip-cam via ethernet cable, so the ip-cam gets a wifi-connection at the end.<br />I am searching for a place, where I can enter SSID and password of the 1st WR1043ND (router)</p></blockquote></div><p>I dont know how to do that in the web interface, but it would be simple on the console. If you had both wireless parts identically configured, you can do that:</p><p>(AP1)<br />uci set wireless.@wifi-iface[0].wds=1<br />uci commit wireless</p><p>(AP2)<br />uci set wireless.@wifi-iface[0].wds=1<br />uci set wireless.@wifi-iface[0].mode=sta<br />uci commit wireless</p><p>and restart wifi</p><p>described here:<br /><a href="http://wiki.openwrt.org/doc/recipes/atheroswds">http://wiki.openwrt.org/doc/recipes/atheroswds</a></p><p>thats it. My TV is connected through such a setup.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p168066">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">linuxuser</div>
					<div class="post-datetime">
						24 May 2012, 11:30					</div>
				</div>
				<div class="post-content content">
					<p>Thanks, but I don&#039;t want to use WDS. I had it already working with a TP-Link TL-WA901ND, which is an AP and not a router with stock firmware and without WDS.</p><p>In the meantime, I am a little step further.</p><p>After Wifi / Scan there is am option to join the network. I think this is the way to start.</p><p>I don&#039;t understand the following options:<br />An additional network will be created if you leave this unchecked.<br />Name of the new network</p><p>The 2nd TL-WR1043ND should be in the same network, so I don&#039;t want to create a new network, right?</p><p>But I have to assign a name, which is listed then as a new interface. Why cant&#039;t all interfaces (WR1043ND) be in LAN?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p168070">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						24 May 2012, 12:09					</div>
				</div>
				<div class="post-content content">
					<p>Read the fine wiki, this has been discussed ad nauseam.<br /><a href="http://wiki.openwrt.org/doc/howto/clientmode#bridged.client.mode.issues">http://wiki.openwrt.org/doc/howto/clien … ode.issues</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p168085">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">linuxuser</div>
					<div class="post-datetime">
						24 May 2012, 15:34					</div>
				</div>
				<div class="post-content content">
					<p>I am not sure, if <a href="http://wiki.openwrt.org/doc/howto/clientmode#bridged.client.mode.issues">http://wiki.openwrt.org/doc/howto/clien … ode.issues</a> is _only_ important, if I want &quot;Transparent client bridging&quot;. Sorry, I even don&#039;t know if I need &quot;bridged client mode&quot;. Tranparent is not important to me.</p><p>I think and hope I am pretty close to what I want.</p><br /><p>In this case I can get a videostream from the camera, but there is 1 Ethernet-cable too much connected ;-)<br />root@sv:~# nmap -sP 192.168.178.0/24 | grep 192.168.<br />Nmap scan report for fritz.box.7270 (192.168.178.1)<br />Nmap scan report for wr1043nd.router (192.168.178.50)<br />Nmap scan report for wr1043nd.ap1.eth (192.168.178.51)<br />Nmap scan report for wr1043nd.ap1.wifi (192.168.178.61)<br />Nmap scan report for sc3430.ipcam.1 (192.168.178.71)<br />Nmap scan report for sv.local (192.168.178.100)</p><p>If I remove an ethernet-cable from &quot;wr1043nd.ap1&quot; (192.168.178.51), I see:</p><p>root@sv:~#&nbsp; nmap -sP 192.168.178.0/24 | grep 192.168.<br />Nmap scan report for fritz.box.7270 (192.168.178.1)<br />Nmap scan report for wr1043nd.router (192.168.178.50)<br />Nmap scan report for wr1043nd.ap1.wifi (192.168.178.61)<br />Nmap scan report for sv.local (192.168.178.100)<br /># some devices like tv, phone, removed</p><p>but:</p><p>ping 192.168.178.61<br />PING 192.168.178.61 (192.168.178.61) 56(84) bytes of data.<br />^C<br />--- 192.168.178.61 ping statistics ---<br />7 packets transmitted, 0 received, 100% packet loss, time 6046ms</p><br /><p>So why does nmap see 192.168.178.61 (via Wifi) and I cannot ping 192.168.178.61? Can this be a firewall issue with default settings?</p><br /><p># connected via ssh from 192.168.178.100 to wr1043nd.router 192.168.178.50<br />root@wr1043nd-router:~# nmap -sP 192.168.178.0/24 | grep 192.168.<br />Nmap scan report for fritz.box.7270 (192.168.178.1)<br />Nmap scan report for wr1043nd.router (192.168.178.50)<br />Nmap scan report for wr1043nd.ap1.wifi (192.168.178.61)<br />Nmap scan report for sv.local (192.168.178.100)</p><br /><p>root@wr1043nd-router:~# route <br />Kernel IP routing table<br />Destination&nbsp; &nbsp; &nbsp;Gateway&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Genmask&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Flags Metric Ref&nbsp; &nbsp; Use Iface<br />192.168.178.0&nbsp; &nbsp;*&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.255.255.0&nbsp; &nbsp;U&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 br-lan<br />default&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;fritz.box.7270&nbsp; 0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;UG&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 br-lan</p>											<p class="post-edited">(Last edited by <strong>linuxuser</strong> on 24 May 2012, 15:39)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p168099">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">eleon216</div>
					<div class="post-datetime">
						24 May 2012, 20:49					</div>
				</div>
				<div class="post-content content">
					<p>if you want to have the 2nd Router (and the LAN behind it) in the same LAN-segment as your first router you need bridge-mode! either pseudobridge-mode with relayd or real (fully transparent) bridge-mode using WDS. <br />So please just use WDS, the only reason for using relayd would be if you can&#039;t configure the Master-AP to use WDS, or if Master and Client have different chipsets, und WDS isn&#039;t possible between them. </p><p>But your routers are the same hardware and running both openwrt, so please just use WDS, that&#039;s what it is for, unless you have a really good reason for not doing so.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p168127">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">linuxuser</div>
					<div class="post-datetime">
						25 May 2012, 01:54					</div>
				</div>
				<div class="post-content content">
					<p>I have been told in a hardware forum, that it is better _not_ to use WDS, at least with stock firmware.</p><p>Because you recommended it, I try WDS, but couldn&#039;t get it work.</p><p>I have configured with the 1st 1043, which is connected with the Fritzbox via Ethernet: Accesspoint-WDS</p><p>With the 2nd 1043, which has the ipcam connected via Etherent, Client-WDS<br />The 2nd 1043 says in Wireless Overview: Associated Stations: the 1st 1043</p><p>I configure the 2nd 1043 via Ethernet and I see:</p><br /><p>root@sv:~# nmap -sP 192.168.178.0/24 | grep 192.168.<br />Nmap scan report for fritz.box.7270 (192.168.178.1)<br />Nmap scan report for wr1043nd.router (192.168.178.50)<br />Nmap scan report for wr1043nd.ap1.eth (192.168.178.51)<br />Nmap scan report for sc3430.ipcam1 (192.168.178.71)</p><p>Then I remove the Ethernet cable from the 2nd 1043, which I used for configuration and wr1043nd.ap1.eth is gone and the ipcam too.</p><p>root@sv:~# nmap -sP 192.168.178.0/24 | grep 192.168.<br />Nmap scan report for fritz.box.7270 (192.168.178.1)<br />Nmap scan report for wr1043nd.router (192.168.178.50)</p><p>What I am doing wrong?</p><br /><div class="codebox"><pre><code>connected to Fritzbox via Ethernet (192.168.178.50)
root@wr1043nd-router:~# cat /etc/config/wireless 

config &#039;wifi-device&#039; &#039;radio0&#039;
    option &#039;type&#039; &#039;mac80211&#039;
    option &#039;macaddr&#039; &#039;xx:xx:xx:xx:xx:xx&#039;
    option &#039;hwmode&#039; &#039;11ng&#039;
    list &#039;ht_capab&#039; &#039;SHORT-GI-40&#039;
    list &#039;ht_capab&#039; &#039;DSSS_CCK-40&#039;
    option &#039;htmode&#039; &#039;HT40+&#039;
    option &#039;country&#039; &#039;AT&#039;
    option &#039;txpower&#039; &#039;20&#039;
    option &#039;channel&#039; &#039;auto&#039;

config &#039;wifi-iface&#039;
    option &#039;device&#039; &#039;radio0&#039;
    option &#039;key&#039; &#039;12345&#039;
    option &#039;encryption&#039; &#039;psk2+ccmp&#039;
    option &#039;network&#039; &#039;lan&#039;
    option &#039;ssid&#039; &#039;MY-SSID&#039;
    option &#039;mode&#039; &#039;ap&#039;
    option &#039;wds&#039; &#039;1&#039;




root@wr1043nd-router:~# cat /etc/config/firewall
config defaults
    option syn_flood    1
    option input        ACCEPT
    option output        ACCEPT 
    option forward        REJECT
# Uncomment this line to disable ipv6 rules
#    option disable_ipv6    1

config zone
    option name        lan
    option network        &#039;lan&#039;
    option input        ACCEPT 
    option output        ACCEPT 
    option forward        REJECT

config zone
    option name        wan
    option network        &#039;wan&#039;
    option input        REJECT
    option output        ACCEPT 
    option forward        REJECT
    option masq        1 
    option mtu_fix        1

config forwarding 
    option src          lan
    option dest         wan

# We need to accept udp packets on port 68,
# see https://dev.openwrt.org/ticket/4108
config rule
    option name        Allow-DHCP-Renew
    option src        wan
    option proto        udp
    option dest_port    68
    option target        ACCEPT
    option family        ipv4

# Allow IPv4 ping
config rule
    option name        Allow-Ping
    option src        wan
    option proto        icmp
    option icmp_type    echo-request
    option family        ipv4
    option target        ACCEPT

# Allow DHCPv6 replies
# see https://dev.openwrt.org/ticket/10381
config rule
    option name        Allow-DHCPv6
    option src        wan
    option proto        udp
    option src_ip        fe80::/10
    option src_port        547
    option dest_ip        fe80::/10
    option dest_port    546
    option family        ipv6
    option target        ACCEPT

# Allow essential incoming IPv6 ICMP traffic
config rule
    option name        Allow-ICMPv6-Input
    option src        wan
    option proto    icmp
    list icmp_type        echo-request
    list icmp_type        destination-unreachable
    list icmp_type        packet-too-big
    list icmp_type        time-exceeded
    list icmp_type        bad-header
    list icmp_type        unknown-header-type
    list icmp_type        router-solicitation
    list icmp_type        neighbour-solicitation
    option limit        1000/sec
    option family        ipv6
    option target        ACCEPT

# Allow essential forwarded IPv6 ICMP traffic
config rule                                   
    option name        Allow-ICMPv6-Forward
    option src        wan
    option dest        *
    option proto        icmp
    list icmp_type        echo-request
    list icmp_type        destination-unreachable
    list icmp_type        packet-too-big
    list icmp_type        time-exceeded
    list icmp_type        bad-header
    list icmp_type        unknown-header-type
    option limit        1000/sec
    option family        ipv6
    option target        ACCEPT

# include a file with users custom iptables rules
config include
    option path /etc/firewall.user






root@wr1043nd-router:~# cat /etc/config/dhcp

config &#039;dnsmasq&#039;
    option &#039;domainneeded&#039; &#039;1&#039;
    option &#039;boguspriv&#039; &#039;1&#039;
    option &#039;filterwin2k&#039; &#039;0&#039;
    option &#039;localise_queries&#039; &#039;1&#039;
    option &#039;rebind_protection&#039; &#039;1&#039;
    option &#039;rebind_localhost&#039; &#039;1&#039;
    option &#039;local&#039; &#039;/lan/&#039;
    option &#039;domain&#039; &#039;lan&#039;
    option &#039;expandhosts&#039; &#039;1&#039;
    option &#039;nonegcache&#039; &#039;0&#039;
    option &#039;authoritative&#039; &#039;1&#039;
    option &#039;readethers&#039; &#039;1&#039;
    option &#039;leasefile&#039; &#039;/tmp/dhcp.leases&#039;
    option &#039;resolvfile&#039; &#039;/tmp/resolv.conf.auto&#039;

config &#039;dhcp&#039; &#039;lan&#039;
    option &#039;interface&#039; &#039;lan&#039;
    option &#039;ignore&#039; &#039;1&#039;

config &#039;dhcp&#039; &#039;wan&#039;
    option &#039;interface&#039; &#039;wan&#039;
    option &#039;ignore&#039; &#039;1&#039;</code></pre></div><div class="codebox"><pre><code># Connected to IP-Cam via Ethernet (192.168.178.51)
root@wr1043nd-ap1:~# cat /etc/config/wireless 

config &#039;wifi-device&#039; &#039;radio0&#039;
    option &#039;type&#039; &#039;mac80211&#039;
    option &#039;macaddr&#039; &#039;yy:yy:yy:yy:yy:yy&#039;
    option &#039;hwmode&#039; &#039;11ng&#039;
    option &#039;htmode&#039; &#039;HT20&#039;
    list &#039;ht_capab&#039; &#039;SHORT-GI-40&#039;
    list &#039;ht_capab&#039; &#039;DSSS_CCK-40&#039;
    option &#039;country&#039; &#039;AT&#039;
    option &#039;distance&#039; &#039;20&#039;
    option &#039;txpower&#039; &#039;20&#039;
    option &#039;channel&#039; &#039;1&#039;

config &#039;wifi-iface&#039;
    option &#039;ssid&#039; &#039;MY-SSID&#039;
    option &#039;device&#039; &#039;radio0&#039;
    option &#039;mode&#039; &#039;sta&#039;
    option &#039;key&#039; &#039;12345&#039;
    option &#039;encryption&#039; &#039;psk2+ccmp&#039;
    option &#039;wds&#039; &#039;1&#039;




root@wr1043nd-ap1:~# cat /etc/config/firewall 

config &#039;defaults&#039;
    option &#039;syn_flood&#039; &#039;1&#039;
    option &#039;input&#039; &#039;ACCEPT&#039;
    option &#039;output&#039; &#039;ACCEPT&#039;
    option &#039;forward&#039; &#039;REJECT&#039;

config &#039;zone&#039;
    option &#039;name&#039; &#039;lan&#039;
    option &#039;input&#039; &#039;ACCEPT&#039;
    option &#039;output&#039; &#039;ACCEPT&#039;
    option &#039;forward&#039; &#039;REJECT&#039;
    option &#039;network&#039; &#039;lan tag lan61&#039;

config &#039;zone&#039;
    option &#039;name&#039; &#039;wan&#039;
    option &#039;network&#039; &#039;wan&#039;
    option &#039;input&#039; &#039;REJECT&#039;
    option &#039;output&#039; &#039;ACCEPT&#039;
    option &#039;forward&#039; &#039;REJECT&#039;
    option &#039;masq&#039; &#039;1&#039;
    option &#039;mtu_fix&#039; &#039;1&#039;

config &#039;forwarding&#039;
    option &#039;src&#039; &#039;lan&#039;
    option &#039;dest&#039; &#039;wan&#039;

config &#039;rule&#039;
    option &#039;name&#039; &#039;Allow-DHCP-Renew&#039;
    option &#039;src&#039; &#039;wan&#039;
    option &#039;proto&#039; &#039;udp&#039;
    option &#039;dest_port&#039; &#039;68&#039;
    option &#039;target&#039; &#039;ACCEPT&#039;
    option &#039;family&#039; &#039;ipv4&#039;

config &#039;rule&#039;
    option &#039;name&#039; &#039;Allow-Ping&#039;
    option &#039;src&#039; &#039;wan&#039;
    option &#039;proto&#039; &#039;icmp&#039;
    option &#039;icmp_type&#039; &#039;echo-request&#039;
    option &#039;family&#039; &#039;ipv4&#039;
    option &#039;target&#039; &#039;ACCEPT&#039;

config &#039;rule&#039;
    option &#039;name&#039; &#039;Allow-DHCPv6&#039;
    option &#039;src&#039; &#039;wan&#039;
    option &#039;proto&#039; &#039;udp&#039;
    option &#039;src_ip&#039; &#039;fe80::/10&#039;
    option &#039;src_port&#039; &#039;547&#039;
    option &#039;dest_ip&#039; &#039;fe80::/10&#039;
    option &#039;dest_port&#039; &#039;546&#039;
    option &#039;family&#039; &#039;ipv6&#039;
    option &#039;target&#039; &#039;ACCEPT&#039;

config &#039;rule&#039;
    option &#039;name&#039; &#039;Allow-ICMPv6-Input&#039;
    option &#039;src&#039; &#039;wan&#039;
    option &#039;proto&#039; &#039;icmp&#039;
    list &#039;icmp_type&#039; &#039;echo-request&#039;
    list &#039;icmp_type&#039; &#039;destination-unreachable&#039;
    list &#039;icmp_type&#039; &#039;packet-too-big&#039;
    list &#039;icmp_type&#039; &#039;time-exceeded&#039;
    list &#039;icmp_type&#039; &#039;bad-header&#039;
    list &#039;icmp_type&#039; &#039;unknown-header-type&#039;
    list &#039;icmp_type&#039; &#039;router-solicitation&#039;
    list &#039;icmp_type&#039; &#039;neighbour-solicitation&#039;
    option &#039;limit&#039; &#039;1000/sec&#039;
    option &#039;family&#039; &#039;ipv6&#039;
    option &#039;target&#039; &#039;ACCEPT&#039;

config &#039;rule&#039;
    option &#039;name&#039; &#039;Allow-ICMPv6-Forward&#039;
    option &#039;src&#039; &#039;wan&#039;
    option &#039;dest&#039; &#039;*&#039;
    option &#039;proto&#039; &#039;icmp&#039;
    list &#039;icmp_type&#039; &#039;echo-request&#039;
    list &#039;icmp_type&#039; &#039;destination-unreachable&#039;
    list &#039;icmp_type&#039; &#039;packet-too-big&#039;
    list &#039;icmp_type&#039; &#039;time-exceeded&#039;
    list &#039;icmp_type&#039; &#039;bad-header&#039;
    list &#039;icmp_type&#039; &#039;unknown-header-type&#039;
    option &#039;limit&#039; &#039;1000/sec&#039;
    option &#039;family&#039; &#039;ipv6&#039;
    option &#039;target&#039; &#039;ACCEPT&#039;

config &#039;include&#039;
    option &#039;path&#039; &#039;/etc/firewall.user&#039;


    
    
root@wr1043nd-ap1:~# cat /etc/config/dhcp 

config &#039;dnsmasq&#039;
    option &#039;domainneeded&#039; &#039;1&#039;
    option &#039;boguspriv&#039; &#039;1&#039;
    option &#039;localise_queries&#039; &#039;1&#039;
    option &#039;rebind_protection&#039; &#039;1&#039;
    option &#039;rebind_localhost&#039; &#039;1&#039;
    option &#039;local&#039; &#039;/lan/&#039;
    option &#039;domain&#039; &#039;lan&#039;
    option &#039;expandhosts&#039; &#039;1&#039;
    option &#039;readethers&#039; &#039;1&#039;
    option &#039;leasefile&#039; &#039;/tmp/dhcp.leases&#039;
    option &#039;resolvfile&#039; &#039;/tmp/resolv.conf.auto&#039;

config &#039;dhcp&#039; &#039;lan&#039;
    option &#039;interface&#039; &#039;lan&#039;
    option &#039;ignore&#039; &#039;1&#039;

config &#039;dhcp&#039; &#039;wan&#039;
    option &#039;interface&#039; &#039;wan&#039;
    option &#039;ignore&#039; &#039;1&#039;</code></pre></div>											<p class="post-edited">(Last edited by <strong>linuxuser</strong> on 30 Jul 2012, 20:59)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p168145">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">ninno</div>
					<div class="post-datetime">
						25 May 2012, 07:50					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>linuxuser wrote:</cite><blockquote><p>The 2nd 1043 says in Wireless Overview: Associated Stations: the 1st 1043<br />...<br />root@wr1043nd-ap1:~# cat /etc/config/wireless <br />...<br />config &#039;wifi-device&#039; &#039;radio0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; ...<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;channel&#039; &#039;1&#039;</p><p>config &#039;wifi-iface&#039;<br />&nbsp; &nbsp; option &#039;ssid&#039; &#039;MY-SSID&#039;<br />&nbsp; &nbsp; option &#039;device&#039; &#039;radio0&#039;<br />&nbsp; &nbsp; option &#039;mode&#039; &#039;sta&#039;<br />&nbsp; &nbsp; option &#039;key&#039; &#039;12345&#039;<br />&nbsp; &nbsp; option &#039;encryption&#039; &#039;psk2+ccmp&#039;<br />&nbsp; &nbsp; option &#039;wds&#039; &#039;1&#039;</p></blockquote></div><p>Your client wlan interface is not bridged to the lan, adding &quot;option &#039;network&#039; &#039;lan&#039;&quot; should fix your problem.</p><p>I dont know what channel &quot;auto&quot; really does in AP mode - according to the wiki this is only allowed in client mode, according to your assoclist it must have selected channel 1, otherwise the client would not follow while being bound to channel 1. Maybe set a fix channel on the ap as well if you are getting disconnected.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p168156">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">linuxuser</div>
					<div class="post-datetime">
						25 May 2012, 11:17					</div>
				</div>
				<div class="post-content content">
					<p>Unfortunately still not working. I searched a lot, but I couldn&#039;t find out, how to bridge the 2&nbsp; TL-WR1043ND with the web interface. <a href="http://wiki.openwrt.org/doc/recipes/bridgedap">http://wiki.openwrt.org/doc/recipes/bridgedap</a> didn&#039;t help me.</p><p>Now I have</p><div class="codebox"><pre><code>root@wr1043nd-router:~# cat /etc/config/wireless 

config &#039;wifi-device&#039; &#039;radio0&#039;
    option &#039;type&#039; &#039;mac80211&#039;
    option &#039;macaddr&#039; &#039;xx:xx:xx:xx:xx:xx&#039;
    option &#039;hwmode&#039; &#039;11ng&#039;
    list &#039;ht_capab&#039; &#039;SHORT-GI-40&#039;
    list &#039;ht_capab&#039; &#039;DSSS_CCK-40&#039;
    option &#039;htmode&#039; &#039;HT40+&#039;
    option &#039;country&#039; &#039;AT&#039;
    option &#039;txpower&#039; &#039;20&#039;
    option &#039;channel&#039; &#039;10&#039;

config &#039;wifi-iface&#039;
    option &#039;device&#039; &#039;radio0&#039;
    option &#039;key&#039; &#039;12345&#039;
    option &#039;encryption&#039; &#039;psk2+ccmp&#039;
    option &#039;network&#039; &#039;lan&#039;
    option &#039;ssid&#039; &#039;MY-SSID&#039;
    option &#039;mode&#039; &#039;ap&#039;
    option &#039;wds&#039; &#039;1&#039;</code></pre></div><div class="codebox"><pre><code>    
root@wr1043nd-ap1:~# cat /etc/config/wireless 

config &#039;wifi-device&#039; &#039;radio0&#039;
    option &#039;type&#039; &#039;mac80211&#039;
    option &#039;macaddr&#039; &#039;yy:yy:yy:yy:yy:yy&#039;
    option &#039;hwmode&#039; &#039;11ng&#039;
    option &#039;htmode&#039; &#039;HT20&#039;
    list &#039;ht_capab&#039; &#039;SHORT-GI-40&#039;
    list &#039;ht_capab&#039; &#039;DSSS_CCK-40&#039;
    option &#039;country&#039; &#039;AT&#039;
    option &#039;distance&#039; &#039;20&#039;
    option &#039;txpower&#039; &#039;20&#039;
    option &#039;channel&#039; &#039;10&#039;

config &#039;wifi-iface&#039;
    option &#039;ssid&#039; &#039;MY-SSID&#039;
    option &#039;device&#039; &#039;radio0&#039;
    option &#039;mode&#039; &#039;sta&#039;
    option &#039;key&#039; &#039;12345&#039;
    option &#039;encryption&#039; &#039;psk2+ccmp&#039;
    option &#039;wds&#039; &#039;1&#039;
    option &#039;network&#039; &#039;lan&#039;</code></pre></div><p>So both use channel 10 now. I am unsure if the bridging is correct. I added it manually with vi and rebootet both 1043</p>											<p class="post-edited">(Last edited by <strong>linuxuser</strong> on 25 May 2012, 11:18)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p168169">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">linuxuser</div>
					<div class="post-datetime">
						25 May 2012, 15:10					</div>
				</div>
				<div class="post-content content">
					<p>Again a little bit confused, because I changed the channel only and now I see with the 1st 1043 (wr1043nd-router, 192.168.178.50) at Network / WIfi: Wireless is disabled or not associated</p><p>Device Configuration: Wireless network is enabled</p><p>So there is a problem with the association. Reading <a href="http://wiki.openwrt.org/doc/uci/wireless">http://wiki.openwrt.org/doc/uci/wireless</a> and searching in the web interface, I don&#039;t know what to do, expecially because I had for days access via my mobile phone to this 1st 1043, which doesn&#039;t work anymore.</p><p>Interfaces - LAN - Physical settings;</p><p>active:<br />creates a bridge over specified interface(s)<br />VLAN Interface: &quot;eth0.1&quot; (lan)<br />Wireless Network: Master &quot;My SSID&quot; (lan)</p>											<p class="post-edited">(Last edited by <strong>linuxuser</strong> on 25 May 2012, 15:15)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p168189">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">ninno</div>
					<div class="post-datetime">
						25 May 2012, 21:10					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>linuxuser wrote:</cite><blockquote><p>I don&#039;t know what to do, expecially because I had for days access via my mobile phone to this 1st 1043, which doesn&#039;t work anymore.</p></blockquote></div><p>Well, if you did not change the channel, it would work now <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Indeed now you have some regulatory problems which cause the AP to disable its wifi. On the console you would get a warning about that.</p><p>If you just want your wifi back, either change &quot;HT40+&quot; to &quot;HT40-&quot; on your AP, so it uses the second channel 10-4=6, or change back to Channel 1 and use HT40+ like you do now (actually ch1-7 should work).</p><p>Background:<br />Your router tries to use channels 10 and 14, 14 is not allowed for country AT, so this will disable your wifi. 9 would *theoretically* work, but due to a factory setting in the 1043nd it always &quot;thinks&quot; it is operated in the US, so channels 12+13 are disabled in *all* countries, caused some trouble to me as well, more:<br /><a href="https://dev.openwrt.org/ticket/9678">https://dev.openwrt.org/ticket/9678</a></p><p>At which channels you are allowed to use &quot;HT40+&quot; or &quot;HT40-&quot;, you can see here:</p><p>root@OpenWrt:/# cat /sys/kernel/debug/ieee80211/phy0/ht40allow_map<br />2412 HT40&nbsp; +&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (channel 1)<br />2417 HT40&nbsp; +&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (...)<br />2422 HT40&nbsp; +<br />2427 HT40&nbsp; +<br />2432 HT40 -+<br />2437 HT40 -+<br />2442 HT40 -+<br />2447 HT40 - <br />2452 HT40 - <br />2457 HT40 - <br />2462 HT40 - <br />2467 Disabled<br />2472 Disabled<br />2484 Disabled</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p168192">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">linuxuser</div>
					<div class="post-datetime">
						25 May 2012, 23:35					</div>
				</div>
				<div class="post-content content">
					<p>Thanks a lot!</p><p>Please note, the device names wr1043nd-router and wr1043nd-ap1 are confusing, since I use WDS, but I didn&#039;t change it in this thread. If I understood everything right, it would be better to use instead of wr1043nd-router&nbsp; wr1043nd-ap and instead of wr1043nd-ap1 wr1043nd-client1</p><p>I changed now to the following configuration and it works, but I have a few questions. Also I was stressed after I changed 1 1043, because I couldn&#039;t access it anymore, but I could after i switched off the other 1043.</p><br /><div class="codebox"><pre><code>root@wr1043nd-router:~# cat /etc/config/wireless

config &#039;wifi-device&#039; &#039;radio0&#039;
    option &#039;type&#039; &#039;mac80211&#039;
    option &#039;macaddr&#039; &#039;xx:xx:xx:xx:xx:xx&#039;
    option &#039;hwmode&#039; &#039;11ng&#039;
    list &#039;ht_capab&#039; &#039;SHORT-GI-40&#039;
    list &#039;ht_capab&#039; &#039;DSSS_CCK-40&#039;
    option &#039;country&#039; &#039;AT&#039;
    option &#039;txpower&#039; &#039;20&#039;
    option &#039;distance&#039; &#039;20&#039;
    option &#039;htmode&#039; &#039;HT40-&#039;
    option &#039;channel&#039; &#039;6&#039;

config &#039;wifi-iface&#039;
    option &#039;device&#039; &#039;radio0&#039;
    option &#039;key&#039; &#039;12345&#039;
    option &#039;encryption&#039; &#039;psk2+ccmp&#039;
    option &#039;network&#039; &#039;lan&#039;
    option &#039;ssid&#039; &#039;MY-SSID&#039;
    option &#039;mode&#039; &#039;ap&#039;
    option &#039;wds&#039; &#039;1&#039;</code></pre></div><div class="codebox"><pre><code>root@wr1043nd-ap1:~# cat /etc/config/wireless

config &#039;wifi-device&#039; &#039;radio0&#039;
    option &#039;type&#039; &#039;mac80211&#039;
    option &#039;macaddr&#039; &#039;yy:yy:yy:yy:yy:yy&#039;
    option &#039;hwmode&#039; &#039;11ng&#039;
    list &#039;ht_capab&#039; &#039;SHORT-GI-40&#039;
    list &#039;ht_capab&#039; &#039;DSSS_CCK-40&#039;
    option &#039;country&#039; &#039;AT&#039;
    option &#039;distance&#039; &#039;20&#039;
    option &#039;txpower&#039; &#039;20&#039;
    option &#039;channel&#039; &#039;6&#039;
    option &#039;htmode&#039; &#039;HT40-&#039;

config &#039;wifi-iface&#039;
    option &#039;ssid&#039; &#039;MY-SSID&#039;
    option &#039;device&#039; &#039;radio0&#039;
    option &#039;mode&#039; &#039;sta&#039;
    option &#039;key&#039; &#039;12345&#039;
    option &#039;encryption&#039; &#039;psk2+ccmp&#039;
    option &#039;wds&#039; &#039;1&#039;
    option &#039;network&#039; &#039;lan&#039;</code></pre></div><p>How do I add &quot;option &#039;network&#039; &#039;lan&#039;&quot; with the web interface. I didn&#039;t find out how to bridge devices with the web interface.</p><p>I want to use 3 TL-WR1043ND as client (WDS) with openwrt and 1 TP-Link TL-WA901ND, stock firmware at the moment, as client (WDS) with 1 TL-WR1043ND as Access point (WDS).</p><p>Is it a good idea to use channel 6 with&nbsp; HT40 - ? Most of my neighbours use channel 1 and then I see chanell 5, 6, 10 and 11 sometimes. I have no idea, if the others use auto channel.</p><p>Should I use full speed for all devices? There are 4 ip-cameras connecte, 2 android mobile phones and 2 notebooks. Mobile phones and notebooks are not always connected.</p><p>The mobile phones show the videostream of the the ip-cameras. Can I use somehow the clients (WDS) as access points for my mobile phones too?</p>											<p class="post-edited">(Last edited by <strong>linuxuser</strong> on 26 May 2012, 01:50)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p168204">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">ninno</div>
					<div class="post-datetime">
						26 May 2012, 10:24					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>linuxuser wrote:</cite><blockquote><p>Thanks a lot!<br />...<br />I changed now to the following configuration and it works, but I have a few questions. Also I was stressed after I changed 1 1043, because I couldn&#039;t access it anymore, but I could after i switched off the other 1043.</p></blockquote></div><p>Your welcome.<br />If you connect two routers by both wireless and a cable, you will create a network loop which could explain why switching of one solved a problem.</p><div class="quotebox"><cite>linuxuser wrote:</cite><blockquote><p>Is it a good idea to use channel 6 with&nbsp; HT40 - ? Most of my neighbours use channel 1 and then I see chanell 5, 6, 10 and 11 sometimes. I have no idea, if the others use auto channel.</p></blockquote></div><p>The channels to use highly depend on if your neighbors are heavy users or just access web pages from time to time, you have to find out what is best for you. Take into account the channels are overlapping, so if you got heavy users on both ch1+6 its not a good idea to use channel3 which overlaps both frequencies. I personally use only one channel (HT20) which does not have any strong neighbors on it and the speed is always good enough for my needs.</p><div class="quotebox"><cite>linuxuser wrote:</cite><blockquote><p>The mobile phones show the videostream of the the ip-cameras. Can I use somehow the clients (WDS) as access points for my mobile phones too?</p></blockquote></div><p>Yes, you can. Just add another wifi-iface section using &quot;mode ap&quot; to the client, dont enable wds there.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p168209">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">linuxuser</div>
					<div class="post-datetime">
						26 May 2012, 12:40					</div>
				</div>
				<div class="post-content content">
					<p>Thank you for explaining, at the moment my priority is to get a TP-Link TL-WA901ND running. See <a href="https://forum.openwrt.org/viewtopic.php?pid=168208#p168208">https://forum.openwrt.org/viewtopic.php … 08#p168208</a> but in the future I will play with a 2nd AP.</p><div class="quotebox"><blockquote><p>Just add another wifi-iface section using &quot;mode ap&quot; to the client, dont enable wds there.</p></blockquote></div><p>Do I understand ir right, that I do add only things and I do not change things, which are already done?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p168216">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">ninno</div>
					<div class="post-datetime">
						26 May 2012, 15:23					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>linuxuser wrote:</cite><blockquote><div class="quotebox"><blockquote><p>Just add another wifi-iface section using &quot;mode ap&quot; to the client, dont enable wds there.</p></blockquote></div><p>Do I understand ir right, that I do add only things and I do not change things, which are already done?</p></blockquote></div><p>Yes. Maybe just clone the &quot;wifi-iface&quot; part of your APs config, exchange the SSID, remove the &quot;wds&quot; line and add this to your clients config. Try to connect to the new SSID, you will see it works.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p168273">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">linuxuser</div>
					<div class="post-datetime">
						27 May 2012, 13:07					</div>
				</div>
				<div class="post-content content">
					<p>I didn&#039;t test it lot, but the configuration below seems to work as WDS-Client and AP.</p><p>Can I give both wifi-ifaces the same SSID, so a mobile phone chooses the better AP automatically? BTW I needed to disconnect wr1043-openwrt-ap.wds and wr1043-openwrt-client3.wds from the current to get it work after changing the configuration. There was also no correct Wifi-overview in the web-interface, for a while, but I don&#039;t know, when it changed. I saw the same SSID and not different ones as configured.</p><div class="quotebox"><blockquote><p>root@wr1043-openwrt-client3-wds:~# cat /etc/config/network </p><p>config &#039;interface&#039; &#039;loopback&#039;<br />&nbsp; &nbsp; option &#039;ifname&#039; &#039;lo&#039;<br />&nbsp; &nbsp; option &#039;proto&#039; &#039;static&#039;<br />&nbsp; &nbsp; option &#039;ipaddr&#039; &#039;127.0.0.1&#039;<br />&nbsp; &nbsp; option &#039;netmask&#039; &#039;255.0.0.0&#039;</p><p>config &#039;interface&#039; &#039;lan&#039;<br />&nbsp; &nbsp; option &#039;ifname&#039; &#039;eth0.1&#039;<br />&nbsp; &nbsp; option &#039;type&#039; &#039;bridge&#039;<br />&nbsp; &nbsp; option &#039;proto&#039; &#039;static&#039;<br />&nbsp; &nbsp; option &#039;netmask&#039; &#039;255.255.255.0&#039;<br />&nbsp; &nbsp; option &#039;ipaddr&#039; &#039;192.168.178.53&#039;<br />&nbsp; &nbsp; option &#039;gateway&#039; &#039;192.168.178.1&#039;<br />&nbsp; &nbsp; option &#039;dns&#039; &#039;192.168.178.1&#039;</p><p>config &#039;interface&#039; &#039;wan&#039;<br />&nbsp; &nbsp; option &#039;ifname&#039; &#039;eth0.2&#039;<br />&nbsp; &nbsp; option &#039;proto&#039; &#039;dhcp&#039;</p><p>config &#039;switch&#039;<br />&nbsp; &nbsp; option &#039;name&#039; &#039;rtl8366rb&#039;<br />&nbsp; &nbsp; option &#039;reset&#039; &#039;1&#039;<br />&nbsp; &nbsp; option &#039;enable_vlan&#039; &#039;1&#039;</p><p>config &#039;switch_vlan&#039;<br />&nbsp; &nbsp; option &#039;device&#039; &#039;rtl8366rb&#039;<br />&nbsp; &nbsp; option &#039;vlan&#039; &#039;1&#039;<br />&nbsp; &nbsp; option &#039;ports&#039; &#039;1 2 3 4 5t&#039;</p><p>config &#039;switch_vlan&#039;<br />&nbsp; &nbsp; option &#039;device&#039; &#039;rtl8366rb&#039;<br />&nbsp; &nbsp; option &#039;vlan&#039; &#039;2&#039;<br />&nbsp; &nbsp; option &#039;ports&#039; &#039;0 5t&#039;</p></blockquote></div><div class="quotebox"><blockquote><p>root@wr1043-openwrt-client3-wds:~# cat /etc/config/wireless </p><p>config &#039;wifi-device&#039; &#039;radio0&#039;<br />&nbsp; &nbsp; option &#039;type&#039; &#039;mac80211&#039;<br />&nbsp; &nbsp; option &#039;macaddr&#039; &#039;cc:cc:cc:cc:cc:cc&#039;<br />&nbsp; &nbsp; option &#039;hwmode&#039; &#039;11ng&#039;<br />&nbsp; &nbsp; list &#039;ht_capab&#039; &#039;SHORT-GI-40&#039;<br />&nbsp; &nbsp; list &#039;ht_capab&#039; &#039;DSSS_CCK-40&#039;<br />&nbsp; &nbsp; option &#039;disabled&#039; &#039;0&#039;<br />&nbsp; &nbsp; option &#039;channel&#039; &#039;6&#039;<br />&nbsp; &nbsp; option &#039;htmode&#039; &#039;HT40-&#039;<br />&nbsp; &nbsp; option &#039;country&#039; &#039;AT&#039;<br />&nbsp; &nbsp; option &#039;distance&#039; &#039;20&#039;<br />&nbsp; &nbsp; option &#039;txpower&#039; &#039;20&#039;</p><p>config &#039;wifi-iface&#039;<br />&nbsp; &nbsp; option &#039;ssid&#039; &#039;MY-SSID1&#039;<br />&nbsp; &nbsp; option &#039;device&#039; &#039;radio0&#039;<br />&nbsp; &nbsp; option &#039;mode&#039; &#039;sta&#039;<br />&nbsp; &nbsp; option &#039;key&#039; &#039;12345&#039;<br />&nbsp; &nbsp; option &#039;wds&#039; &#039;1&#039;<br />&nbsp; &nbsp; option &#039;network&#039; &#039;lan&#039;<br />&nbsp; &nbsp; option &#039;encryption&#039; &#039;psk2+ccmp&#039;</p><p>config &#039;wifi-iface&#039;<br />&nbsp; &nbsp; option &#039;device&#039; &#039;radio0&#039;<br />&nbsp; &nbsp; option &#039;mode&#039; &#039;ap&#039;<br />&nbsp; &nbsp; option &#039;network&#039; &#039;lan&#039;<br />&nbsp; &nbsp; option &#039;ssid&#039; &#039;MY-SSID2&#039;<br />&nbsp; &nbsp; option &#039;encryption&#039; &#039;psk2+ccmp&#039;<br />&nbsp; &nbsp; option &#039;key&#039; &#039;12345&#039;</p></blockquote></div>											<p class="post-edited">(Last edited by <strong>linuxuser</strong> on 27 May 2012, 13:17)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>