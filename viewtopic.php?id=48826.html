<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> wr841n v8.4 bricked? flashed bad firmware.</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 28 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p224724">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">firesam</div>
					<div class="post-datetime">
						7 Feb 2014, 06:10					</div>
				</div>
				<div class="post-content content">
					<p>I was trying to go back to factory firmware and something went wrong. I followed this <a href="http://wiki.openwrt.org/toh/tp-link/tl-wr841nd#go.back.to.original.firmware">http://wiki.openwrt.org/toh/tp-link/tl- … l.firmware</a><br />I tried to use tftp to go back and still wont work.<br />I don&#039;t know what is wrong exactly but here is what I have from my serial console log:<br />(note I also have the output of printenv included)</p><div class="codebox"><pre><code>=~=~=~=~=~=~=~=~=~=~=~= PuTTY log 2014.02.06 23:02:03 =~=~=~=~=~=~=~=~=~=~=~=


U-Boot 1.1.4 (May  6 2013 - 13:20:30)

U-boot AP123


DRAM:  32 MB
id read 0x100000ff
Flash:  4 MB
Using default environment

In:    serial
Out:   serial
Err:   serial
Net:   ag934x_enet_initialize...
wasp reset mask:c03300
WASP ----&gt; S27 PHY
file: ag934x.c,line: 179==: set LAN&amp;WAN SWAP. --debug by HouXB
GMAC: cfg1 0x5 cfg2 0x7114
eth0: ba:be:fa:ce:08:41
s27 reg init 
athrs27_phy_setup ATHR_PHY_CONTROL 4: 0x1000
athrs27_phy_setup ATHR_PHY_SPEC_STAUS 4: 0x10
eth0 up
WASP ----&gt; S27 PHY
file: ag934x.c,line: 179==: set LAN&amp;WAN SWAP. --debug by HouXB
GMAC: cfg1 0xf cfg2 0x7214
eth1: ba:be:fa:ce:08:41
s27 reg init lan 
ATHRS27: resetting s27
ATHRS27: s27 reset done
athrs27_phy_setup ATHR_PHY_CONTROL 0: 0x1000
athrs27_phy_setup ATHR_PHY_SPEC_STAUS 0: 0x10
athrs27_phy_setup ATHR_PHY_CONTROL 1: 0x1000
athrs27_phy_setup ATHR_PHY_SPEC_STAUS 1: 0x10
athrs27_phy_setup ATHR_PHY_CONTROL 2: 0x1000
athrs27_phy_setup ATHR_PHY_SPEC_STAUS 2: 0x10
athrs27_phy_setup ATHR_PHY_CONTROL 3: 0x1000
athrs27_phy_setup ATHR_PHY_SPEC_STAUS 3: 0x10
eth1 up
eth0, eth1
Autobooting in 1 seconds
wasp&gt; printenv
bootargs=console=ttyS0,115200 root=31:02 rootfstype=squashfs init=/sbin/init mtdparts=ath-nor0:128k(u-boot),1024k(kernel),2816k(rootfs),64k(config),64k(art)
bootcmd=bootm 0x9f020000
bootdelay=1
baudrate=115200
ethaddr=0xba:0xbe:0xfa:0xce:0x08:0x41
ipaddr=192.168.1.111
serverip=192.168.1.100
dir=
bc=ap123
lu=tftp 0x81000000 ${dir}u-boot.bin&amp;&amp;erase 0x9f000000 +$filesize;cp.b $fileaddr 0x9f000000 $filesize
lf=tftp 0x81000000 ${dir}${bc}-squashfs&amp;&amp;erase 0x9f120000 +$filesize;cp.b $fileaddr 0x9f120000 $filesize
stdin=serial
stdout=serial
stderr=serial
ethact=eth0

Environment size: 565/65532 bytes
wasp&gt; tftp 0x80800000 firmware.bin

enet1 port1 up
dup 1 speed 1000
Using eth1 device
TFTP from server 192.168.1.100; our IP address is 192.168.1.111
Filename &#039;firmware.bin&#039;.
Load address: 0x80800000
Loading: *#################################################################
     #################################################################
     #################################################################
     #################################################################
     #################################################################
     #################################################################
     #################################################################
     #################################################################
     #################################################################
     #################################################################
     #################################################################
     #################################################################
     ##############
done
Bytes transferred = 4063744 (3e0200 hex)
wasp&gt; erase.b 0xbf020000 +0x3e0200

Error: end address (0xbf4001ff) not in flash!
Bad address format
wasp&gt; </code></pre></div><p>here is a link to the log when i let it boot without interupting.<br /><a href="http://pastebin.com/qK3X5UCa">http://pastebin.com/qK3X5UCa</a><br />Any help is appreciated<br />Thank you.</p>											<p class="post-edited">(Last edited by <strong>firesam</strong> on 7 Feb 2014, 06:19)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p224888">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">nebbia88</div>
					<div class="post-datetime">
						9 Feb 2014, 11:13					</div>
				</div>
				<div class="post-content content">
					<p>why are you using addresses for v3, v5???</p><div class="quotebox"><blockquote><p>For TL-WR841ND v5, v7 and v8:</p><p>ar7240&gt; erase 0x9f020000 +0x3c0000</p></blockquote></div><p>and so on...</p><p><a href="http://wiki.openwrt.org/toh/tp-link/tl-wr841nd#tftp.install">http://wiki.openwrt.org/toh/tp-link/tl- … tp.install</a></p><p>BTW use 0x81000000 as ram address, not 0x80000000</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p224928">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">firesam</div>
					<div class="post-datetime">
						9 Feb 2014, 19:26					</div>
				</div>
				<div class="post-content content">
					<p>I tried that too. It also fails. ... and loops and loops and loops ...<br />Thanks for pointing out one mistake. It seems something is still wrong.<br /></p><div class="codebox"><pre><code>wasp&gt; erase 0x9f020000 +0x3c0000


First 0x2 last 0x3d sector size 0x10000
   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18  19  20  21  22  23  24  25  26  27  28  29  30  31  32  33  34  35  36  37  38  39  40  41  42  43  44  45  46  47  48  49  50  51  52  53  54  55  56  57  58  59  60  61
Erased 60 sectors
wasp&gt; cp.b 0x80000000 0x9f020000 0x3c0000

Copy to Flash... write addr: 9f020000
done
wasp&gt; bootm 0x9f020000

## Booting image at 9f020000 ...
   Uncompressing Kernel Image ... Too big uncompressed streamLZMA ERROR 1 - must RESET board to recover

U-Boot 1.1.4 (May  6 2013 - 13:20:30)

U-boot AP123


DRAM:  32 MB
id read 0x100000ff
Flash:  4 MB
Using default environment

In:    serial
Out:   serial
Err:   serial
Net:   ag934x_enet_initialize...
wasp reset mask:c03300
WASP ----&gt; S27 PHY
file: ag934x.c,line: 179==: set LAN&amp;WAN SWAP. --debug by HouXB
GMAC: cfg1 0x5 cfg2 0x7114
eth0: ba:be:fa:ce:08:41
s27 reg init 
athrs27_phy_setup ATHR_PHY_CONTROL 4: 0x1000
athrs27_phy_setup ATHR_PHY_SPEC_STAUS 4: 0x10
eth0 up
WASP ----&gt; S27 PHY
file: ag934x.c,line: 179==: set LAN&amp;WAN SWAP. --debug by HouXB
GMAC: cfg1 0xf cfg2 0x7214
eth1: ba:be:fa:ce:08:41
s27 reg init lan 
ATHRS27: resetting s27
ATHRS27: s27 reset done
athrs27_phy_setup ATHR_PHY_CONTROL 0: 0x1000
athrs27_phy_setup ATHR_PHY_SPEC_STAUS 0: 0x10
athrs27_phy_setup ATHR_PHY_CONTROL 1: 0x1000
athrs27_phy_setup ATHR_PHY_SPEC_STAUS 1: 0x10
athrs27_phy_setup ATHR_PHY_CONTROL 2: 0x1000
athrs27_phy_setup ATHR_PHY_SPEC_STAUS 2: 0x10
athrs27_phy_setup ATHR_PHY_CONTROL 3: 0x1000
athrs27_phy_setup ATHR_PHY_SPEC_STAUS 3: 0x10
eth1 up
eth0, eth1
Autobooting in 1 seconds
## Booting image at 9f020000 ...
   Uncompressing Kernel Image ... Too big uncompressed streamLZMA ERROR 1 - must RESET board to recover</code></pre></div>											<p class="post-edited">(Last edited by <strong>firesam</strong> on 9 Feb 2014, 19:26)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p224933">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">nebbia88</div>
					<div class="post-datetime">
						9 Feb 2014, 19:54					</div>
				</div>
				<div class="post-content content">
					<p>again, use 0x81000000 as ram address in tftpboot and cp.b command.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p224934">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">firesam</div>
					<div class="post-datetime">
						9 Feb 2014, 20:06					</div>
				</div>
				<div class="post-content content">
					<p>If I got everything straight this is what I should be doing:</p><p>tftp 0x81000000 firmware.bin</p><p>erase 0x9f020000 +0x3e0200</p><p>cp.b 0x81000000 0x9f020000 +0x3e0200</p><p>bootm 0x9f020000 <br /></p><div class="codebox"><pre><code>wasp&gt; tftp 0x81000000 firmware.bin
Using eth1 device
TFTP from server 192.168.1.100; our IP address is 192.168.1.111
Filename &#039;firmware.bin&#039;.
Load address: 0x81000000
Loading: #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         ##############
done
Bytes transferred = 4063744 (3e0200 hex)
wasp&gt; erase 0x9f020000 +0x3e0200
Error: end address (0x9f4001ff) not in flash!
Bad address format
wasp&gt;</code></pre></div><p>and<br /></p><div class="codebox"><pre><code>wasp&gt; tftp 0x81000000 firmware.bin
enet1 port1 up
dup 1 speed 1000
Using eth1 device
TFTP from server 192.168.1.100; our IP address is 192.168.1.111
Filename &#039;firmware.bin&#039;.
Load address: 0x81000000
Loading: #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         ##############
done
Bytes transferred = 4063744 (3e0200 hex)
wasp&gt; erase.b 0xbf020000 +0x3e0200
Error: end address (0xbf4001ff) not in flash!
Bad address format
wasp&gt;</code></pre></div>											<p class="post-edited">(Last edited by <strong>firesam</strong> on 9 Feb 2014, 20:11)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p224937">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">firesam</div>
					<div class="post-datetime">
						9 Feb 2014, 20:23					</div>
				</div>
				<div class="post-content content">
					<p>And trying a different firmware:<br /></p><div class="codebox"><pre><code>TFTP from server 192.168.1.100; our IP address is 192.168.1.111
Filename &#039;tplink.bin&#039;.
Load address: 0x81000000
Loading: #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         #################################################################
         ######################################################
done
Bytes transferred = 3932160 (3c0000 hex)
wasp&gt; erase 0x9f020000 +0x3c0000

First 0x2 last 0x3d sector size 0x10000                                       61
Erased 60 sectors
wasp&gt; cp.b 0x80000000 0x9f020000 +0x3c0000
Zero length ???
wasp&gt;</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p224939">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">nebbia88</div>
					<div class="post-datetime">
						9 Feb 2014, 20:36					</div>
				</div>
				<div class="post-content content">
					<p>first firmware is not ok, it&#039;s too big because it includes uboot (see the size is NOT 0x3c0000 !!!)</p><p>second try firmware is ok, but commands are wrong (+ sign in cp.b ??) , and you keep using 80000000...</p>											<p class="post-edited">(Last edited by <strong>nebbia88</strong> on 9 Feb 2014, 20:38)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p224942">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">firesam</div>
					<div class="post-datetime">
						9 Feb 2014, 20:56					</div>
				</div>
				<div class="post-content content">
					<p>First of all THANK YOU. for being patient with an unexperienced user. Sorry for the MESS. Here is what I did:<br /></p><div class="codebox"><pre><code>tftp 0x81000000 tplink.bin
erase 0x9f020000 +0x3c0000
cp.b 0x81000000 0x9f020000 0x3c0000
bootm 0x9f020000 </code></pre></div><p>This is slighty different than the wiki: </p><div class="quotebox"><blockquote><p>ar7240&gt; cp.b 0x80000000 0x9f020000 0x3c0000</p></blockquote></div><p> but I followed your other advice to use the 0x81000000 address and it worked.</p><p>BTW I did follow the wiki exacty originally but when it didnt work and I started changing thing I kinda got mixed up and made a Mr. Potato-Head situation... <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /><br />Thanks again.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p224946">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">nebbia88</div>
					<div class="post-datetime">
						9 Feb 2014, 21:24					</div>
				</div>
				<div class="post-content content">
					<p>Glad you solved, and I edited my post, sorry it was a little rude ^^</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p224963">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">firesam</div>
					<div class="post-datetime">
						10 Feb 2014, 01:11					</div>
				</div>
				<div class="post-content content">
					<p>NP&nbsp; I&#039;m just happy it works. Its good to see I wasn&#039;t the only one frustrated...<br />Thanks again.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>