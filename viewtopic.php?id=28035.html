<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> DVB-T usb streaming with BackFire 10.03 and tp-link 1043 with af9015</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 17 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p124836">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">ltrifonov</div>
					<div class="post-datetime">
						8 Jan 2011, 13:44					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>I have prepared custom packages for af9015 usb tunner<br />this tuner is very popular because of it&#039;s price (~ USD 7$ ) on china online stores, ebay and others<br />example of tuner and it&#039;s price: <a href="http://www.buyincoins.com/digital-tv-hdtv-dvb-t-usb-stick-dongle-tuner-recorder-receiver-product-70.html">http://www.buyincoins.com/digital-tv-hd … ct-70.html</a></p><p>With these packages, I am able to stream DVB-T channels, 5 channels eating 6 % CPU when nobody is watching, and on each connection it takes ~ 10% CPU with mumudvb</p><p>packages are for 10.03 branch<br />kernel 2.6.32.10<br />tp-link 1043</p><p>This kernel doesn&#039;t support TDA18218 NXP chip inside USB Sttick<br />support is present in 2.6.36 kernel, so i have to patch toolchain sources of 2.6.32.10 kernel</p><br /><br /><p>patch is from here: <a href="https://patchwork.kernel.org/patch/82494/">https://patchwork.kernel.org/patch/82494/</a></p><p>packages are here: <a href="https://docs.google.com/leaf?id=0B8oQFOm_9mQ3OGVlYzIzOTYtZDZkYi00YjNhLTllOGMtMjc4NTNlODQ2ZjRm&amp;hl=en">https://docs.google.com/leaf?id=0B8oQFO … &amp;hl=en</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p125339">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">meta96</div>
					<div class="post-datetime">
						13 Jan 2011, 20:02					</div>
				</div>
				<div class="post-content content">
					<p>... what&#039;s about tvheadend? Could you ve a look, if this is also possible (sometimes in the future, would be awesome ...) .. thanks!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p125417">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">ltrifonov</div>
					<div class="post-datetime">
						14 Jan 2011, 15:54					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>meta96 wrote:</cite><blockquote><p>... what&#039;s about tvheadend? Could you ve a look, if this is also possible (sometimes in the future, would be awesome ...) .. thanks!</p></blockquote></div><p>actually, I have been uploaded in my repository mumudvb module for streaming <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /><br />more info you can find here: <a href="http://mumudvb.braice.net/mumudrupal/node/36">http://mumudvb.braice.net/mumudrupal/node/36</a></p><p>everything is there for streaming, it works very nice,<br />I just compiled dvb-usb-af9015 module with TDA18218 chip </p><br /><p>after installing module, you may have to load modules after reboot. So make file:<br /><strong>/etc/modules.d/91-dbv-af9015</strong>:</p><div class="quotebox"><blockquote><p>dvb-core<br />dvb-usb force_pid_filter_usage=1<br />dvb-pll<br />mxl5005s<br />tda18271<br />qt1010<br />mt2060<br />af9013<br />mc44s803<br />tda18218<br />dvb-usb-af9015</p></blockquote></div>											<p class="post-edited">(Last edited by <strong>ltrifonov</strong> on 14 Jan 2011, 15:55)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p132469">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">ltrifonov</div>
					<div class="post-datetime">
						7 Apr 2011, 15:37					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>meta96 wrote:</cite><blockquote><p>... what&#039;s about tvheadend? Could you ve a look, if this is also possible (sometimes in the future, would be awesome ...) .. thanks!</p></blockquote></div><p>you win <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /><br />i managed to compile tvheadend for openwrt,</p><p>I still need little help from coders, but it seem to work <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>compiled tvheadend package is here:<br />&nbsp; &nbsp; <a href="https://docs.google.com/leaf?id=0B8oQFOm_9mQ3NTI5YjVjNjctYjBmOC00MzU3LTg1NTYtZjZjZWQ1OGRjYmNh&amp;hl=en">https://docs.google.com/leaf?id=0B8oQFO … &amp;hl=en</a></p><p>i hope following forum&nbsp; will help with small issues i have with compiling<br />&nbsp; &nbsp;<a href="https://www.lonelycoder.com/redmine/boards/5/topics/361">https://www.lonelycoder.com/redmine/boards/5/topics/361</a></p>											<p class="post-edited">(Last edited by <strong>ltrifonov</strong> on 7 Apr 2011, 15:38)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p132470">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						7 Apr 2011, 16:21					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>ltrifonov wrote:</cite><blockquote><p>I still need little help from coders, but it seem to work <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p></blockquote></div><p><a href="http://lists.uclibc.org/pipermail/uclibc/2010-March/043660.html">http://lists.uclibc.org/pipermail/uclib … 43660.html</a></p><p>Seems we must patch uClibc to provide clock_nanosleep(). Its actually only a wrapper for a Linux syscall.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p132477">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">ltrifonov</div>
					<div class="post-datetime">
						7 Apr 2011, 18:00					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>jow wrote:</cite><blockquote><div class="quotebox"><cite>ltrifonov wrote:</cite><blockquote><p>I still need little help from coders, but it seem to work <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p></blockquote></div><p><a href="http://lists.uclibc.org/pipermail/uclibc/2010-March/043660.html">http://lists.uclibc.org/pipermail/uclib … 43660.html</a></p><p>Seems we must patch uClibc to provide clock_nanosleep(). Its actually only a wrapper for a Linux syscall.</p></blockquote></div><p>I tried to include patch directly into my code, but it doesn&#039;t work...<br />i am not so good in coding...</p><p>is it possible? instead patching librt, just add this into my code?</p><p>i added this in&nbsp; file rawtsinput.c which uses this nanosleep function <br /></p><div class="quotebox"><blockquote><p>#include &lt;errno.h&gt;<br />#include &lt;stdlib.h&gt;<br />#include &lt;time.h&gt;<br />#include &lt;sys/syscall.h&gt;</p><p>#include &quot;kernel-posix-timers.h&quot;</p><p>#ifdef __NR_clock_nanosleep</p><p>#define __NR___syscall_clock_nanosleep __NR_clock_nanosleep</p><br /><p>static __inline__ _syscall4(long, __syscall_clock_nanosleep,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;clockid_t, clock_id, int, flags,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const struct timespec *, req,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;struct timespec *, rem);</p><br /><br /><p>long clock_nanosleep(clockid_t clock_id, int flags,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;const struct timespec *req,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;struct timespec *rem)<br />{<br />&nbsp; &nbsp; &nbsp; &nbsp;return __syscall_clock_nanosleep(clock_id, flags, req, rem);<br />}</p><p>#endif</p></blockquote></div><p>but result is:</p><div class="quotebox"><blockquote><p>Entering directory `/usr/src/openwrt/backfire/build_dir/target-mips_r2_uClibc-0.9.30.1/andoma-tvheadend-d2101f6&#039;<br />mips-openwrt-linux-uclibc-gcc -MD -g -funsigned-char -O2&nbsp; -D_FILE_OFFSET_BITS=64 -Ibuild.Linux -I/usr/src/openwrt/backfire/build_dir/target-mips_r2_uClibc-0.9.30.1/andoma-tvheadend-d2101f6/src -I/usr/src/openwrt/backfire/build_dir/target-mips_r2_uClibc-0.9.30.1/andoma-tvheadend-d2101f6 -DHTS_VERSION=\&quot;2.12.99\&quot; -Os -pipe -mips32r2 -mtune=mips32r2 -funit-at-a-time -fhonour-copts -msoft-float -I/usr/src/openwrt/backfire/staging_dir/target-mips_r2_uClibc-0.9.30.1/usr/lib/libiconv-stub/include -I/usr/src/openwrt/backfire/staging_dir/target-mips_r2_uClibc-0.9.30.1/usr/lib/libintl-stub/include&nbsp; -I/usr/src/openwrt/backfire/staging_dir/target-mips_r2_uClibc-0.9.30.1/usr/include -I/usr/src/openwrt/backfire/staging_dir/target-mips_r2_uClibc-0.9.30.1/include -I/usr/src/openwrt/backfire/staging_dir/toolchain-mips_r2_gcc-4.3.3+cs_uClibc-0.9.30.1/usr/include -I/usr/src/openwrt/backfire/staging_dir/toolchain-mips_r2_gcc-4.3.3+cs_uClibc-0.9.30.1/include -I/usr/src/openwrt/backfire/staging_dir/target-mips_r2_uClibc-0.9.30.1/usr/lib/libiconv-stub/include -I/usr/src/openwrt/backfire/staging_dir/target-mips_r2_uClibc-0.9.30.1/usr/lib/libintl-stub/include -std=gnu99 -Wall -Werror -Wwrite-strings -Wno-deprecated-declarations -I/usr/src/openwrt/backfire/staging_dir/host/include/ -Wmissing-prototypes -I/usr/src/openwrt/backfire/staging_dir/target-mips_r2_uClibc-0.9.30.1/usr//include -c -o build.Linux/src/rawtsinput.o /usr/src/openwrt/backfire/build_dir/target-mips_r2_uClibc-0.9.30.1/andoma-tvheadend-d2101f6/src/rawtsinput.c<br />/usr/src/openwrt/backfire/build_dir/target-mips_r2_uClibc-0.9.30.1/andoma-tvheadend-d2101f6/src/rawtsinput.c:51: error: expected declaration specifiers or &#039;...&#039; before &#039;__syscall_clock_nanosleep&#039;<br />/usr/src/openwrt/backfire/build_dir/target-mips_r2_uClibc-0.9.30.1/andoma-tvheadend-d2101f6/src/rawtsinput.c:52: error: expected declaration specifiers or &#039;...&#039; before &#039;clock_id&#039;<br />/usr/src/openwrt/backfire/build_dir/target-mips_r2_uClibc-0.9.30.1/andoma-tvheadend-d2101f6/src/rawtsinput.c:52: error: expected declaration specifiers or &#039;...&#039; before &#039;flags&#039;<br />/usr/src/openwrt/backfire/build_dir/target-mips_r2_uClibc-0.9.30.1/andoma-tvheadend-d2101f6/src/rawtsinput.c:53: error: expected declaration specifiers or &#039;...&#039; before &#039;req&#039;<br />/usr/src/openwrt/backfire/build_dir/target-mips_r2_uClibc-0.9.30.1/andoma-tvheadend-d2101f6/src/rawtsinput.c:54: error: expected declaration specifiers or &#039;...&#039; before &#039;rem&#039;<br />cc1: warnings being treated as errors<br />/usr/src/openwrt/backfire/build_dir/target-mips_r2_uClibc-0.9.30.1/andoma-tvheadend-d2101f6/src/rawtsinput.c:54: error: type defaults to &#039;int&#039; in declaration of &#039;_syscall4&#039;<br />/usr/src/openwrt/backfire/build_dir/target-mips_r2_uClibc-0.9.30.1/andoma-tvheadend-d2101f6/src/rawtsinput.c:58: error: no previous prototype for &#039;clock_nanosleep&#039;<br />/usr/src/openwrt/backfire/build_dir/target-mips_r2_uClibc-0.9.30.1/andoma-tvheadend-d2101f6/src/rawtsinput.c: In function &#039;clock_nanosleep&#039;:<br />/usr/src/openwrt/backfire/build_dir/target-mips_r2_uClibc-0.9.30.1/andoma-tvheadend-d2101f6/src/rawtsinput.c:62: error: implicit declaration of function &#039;__syscall_clock_nanosleep&#039;<br />make[3]: *** [build.Linux/src/rawtsinput.o] Error 1</p></blockquote></div><p>late this evening i will try patching librt</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p145035">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">Gorkhaan</div>
					<div class="post-datetime">
						3 Oct 2011, 17:41					</div>
				</div>
				<div class="post-content content">
					<p>Check this out: <a href="https://forum.openwrt.org/viewtopic.php?pid=144920#p144920">https://forum.openwrt.org/viewtopic.php … 20#p144920</a></p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>