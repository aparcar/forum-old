<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Seagate DockStar $24.99 @Buy.com + Free S/H</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 12 Apr 2018 and 4 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 3</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=25518&amp;p=2.html">2</a></li><li><a href="viewtopic.php%3Fid=25518&amp;p=3.html">3</a></li></ul></nav></div>
			
		
		
			<article class="post" id="p112329">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">mazilo</div>
					<div class="post-datetime">
						1 Jul 2010, 22:47					</div>
				</div>
				<div class="post-content content">
					<p>If anyone is interested in getting a <a href="http://www.seagate.com/www/en-us/products/network_storage/freeagent_dockstar">Seagate DockStar</a> to run an <a href="http://openwrt.org">OpenWRT</a> firmware, hurry up and order it from <a href="http://www.buy.com/prod/seagate-freeagent-dockstar-network-adapter/q/loc/101/211974310.html?adid=17917">Buy</a> for $24.99 + Free S/H. A <a href="http://www.seagate.com/www/en-us/products/network_storage/freeagent_dockstar">Seagate DockStar</a> is a Sheeva Plug computer with an ARM CPU clocked @1.2GHz with a built-in of 128/256 MB RAM/Flash, 4 USB2 ports, and an RJ45 10/100/1000 port. With plenty of Flash/RAM and USB2 ports, the device is an excellent candidate as a Linux embedded system/server to host any PBX system, i.e. <a href="http://www.asterisk.org">Asterisk</a>, <a href="http://freeswitch.org">FreeSwitch</a>, etc.</p><p>Currently, I have my <a href="http://www.seagate.com/www/en-us/products/network_storage/freeagent_dockstar">Seagate DockStar</a> device run an <a href="http://openwrt.org">OpenWRT</a> off an external USB partition using step-by-step instructions as outlined <a href="http://www.plugapps.com/index.php5?title=PlugApps:Pogoplug_Setboot">here</a>. The only problem is I still can&#039;t get it to run asterisk-1.6.x, yet. Asterisk complains with a <em>Serious Network Trouble</em> error messages as shown on my post <a href="https://forum.openwrt.org/viewtopic.php?id=25387">here</a>. If you are a programmer/developer and would like to help, then this is the time to act now while supply lasts.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p112420">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">ecc</div>
					<div class="post-datetime">
						3 Jul 2010, 21:57					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>mazilo wrote:</cite><blockquote><p>Currently, I have my <a href="http://www.seagate.com/www/en-us/products/network_storage/freeagent_dockstar">Seagate DockStar</a> device run an <a href="http://openwrt.org">OpenWRT</a> off an external USB partition using step-by-step instructions as outlined <a href="http://www.plugapps.com/index.php5?title=PlugApps:Pogoplug_Setboot">here</a>.</p></blockquote></div><p>I just got one of these. I&#039;ve attached a serial cable and played around with u-boot, and am ready to try getting openwrt onto it.</p><p>Will the pre-built kirkwood images on backfire.openwrt.org work for the dockstar, or did you need to compile a different variant?&nbsp; If so, can you please share your config? </p><p>Also, I ordered one of these <a href="http://www.meritline.com/female-miniusb-female-usb-adapter-472---p-30323.aspx">USB adapters</a> to make better use of the connector on top.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p112459">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">phat_bastard</div>
					<div class="post-datetime">
						4 Jul 2010, 22:55					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>ecc wrote:</cite><blockquote><p>Will the pre-built kirkwood images on backfire.openwrt.org work for the dockstar, or did you need to compile a different variant?</p></blockquote></div><p>I&#039;m curious about this as well.&nbsp; I bought a few of these from woot last week and have been tinkering with them for the last couple days. As luck would have it, one of them came with a corrupt uImage partition and won&#039;t boot. In my fruitless attempt to copy the kernel from another I discovered the following:</p><p>From the original bootloader the pre-built images seem to hang immediately after the CRC passes.&nbsp; I&#039;m going to assume this is something the stock bootloader is doing to thwart attempts to tamper with the kernel.&nbsp; But if I chainload the usb-enabled bootloader from plugapps.com the backfire ramdisk image will boot up to the point where the RTC is found missing (the dockstars are devoid of a RTC).</p><p>I would caution against attempting to overwrite the kernel or rootfs in NAND until a reliable backup can be made or someone with more knowledge can dissect one of these.&nbsp; I followed the instructions at <a href="http://ahsoftware.de/dockstar/">http://ahsoftware.de/dockstar/</a> to backup the original NAND partitions using dd and then attempted to tftp boot the resultant kernel, which failed complaining about a CRC mismatch. So I used the u-boot cmp function to diff the backup kernel from tftp and the one copied from NAND and they had numerous discrepancies.</p><p>Edit:</p><p>One other thing to note - I grokked the install script from the instructions at</p><p><a href="http://www.plugapps.com/index.php5?title=PlugApps:Pogoplug_Setboot">http://www.plugapps.com/index.php5?titl … ug_Setboot</a></p><p>and it appears that no steps are taken to restore the dockstar&#039;s original ethaddr in the custom u-boot.&nbsp; This could cause weird ethernet issues for anyone attempting to use more than one of these on the same network.&nbsp; setenv ethaddr [unique_hw_addr]; saveenv should fix this...</p>											<p class="post-edited">(Last edited by <strong>phat_bastard</strong> on 4 Jul 2010, 23:40)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p112558">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">mazilo</div>
					<div class="post-datetime">
						6 Jul 2010, 16:16					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>ecc wrote:</cite><blockquote><p>Will the pre-built kirkwood images on backfire.openwrt.org work for the dockstar, or did you need to compile a different variant?&nbsp; If so, can you please share your config?</p></blockquote></div><p>I tried to let my DockStart device to boot off of an OpenWRT BackFire on an external USB partition to no avail. I have not looked into this through a serial-console; however, I believe BackFire has the USB Storage and SCSI Storage built as modules. Unless one can extract the modules and copies to the external USB partition for the Linux kernel to load, a DockStar device may not boot an OpenWRT BackFire. In this case, one needs to build his/her own OpenWRT SVN firmware for his/her DockStar device.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p112559">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">mazilo</div>
					<div class="post-datetime">
						6 Jul 2010, 16:19					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>phat_bastard wrote:</cite><blockquote><p>One other thing to note - I grokked the install script from the instructions at</p><p><a href="http://www.plugapps.com/index.php5?title=PlugApps:Pogoplug_Setboot">http://www.plugapps.com/index.php5?titl … ug_Setboot</a></p><p>and it appears that no steps are taken to restore the dockstar&#039;s original ethaddr in the custom u-boot.&nbsp; This could cause weird ethernet issues for anyone attempting to use more than one of these on the same network.&nbsp; setenv ethaddr [unique_hw_addr]; saveenv should fix this...</p></blockquote></div><p>Excellent point. Thank you.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p112571">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">ecc</div>
					<div class="post-datetime">
						6 Jul 2010, 17:42					</div>
				</div>
				<div class="post-content content">
					<p>I can confirm mazilo&#039;s point about needing compiled-in USB.&nbsp; I have a serial line connected to my Dockstar, and the stock kernel from backfire can&#039;t be used with a USB-mounted root for that reason.</p><p>I want to try flashing an openwrt kernel and rootfs onto my device now, but I&#039;m still pretty new to building openwrt images.&nbsp; I tried adding jffs2 and squashfs image options to my build, but the resulting files are *larger* than the rootfs tarball, which doesn&#039;t seem right.&nbsp; What am I doing wrong?</p><p>Here&#039;s what got produced:<br /></p><div class="codebox"><pre><code>$ ls -lh bin/kirkwood/
total 13M
-rw-r--r-- 1 ecc ecc  253 Jul  5 23:51 md5sums
-rw-r--r-- 1 ecc ecc 5.5M Jul  5 23:51 openwrt-kirkwood-jffs2-128k.img
-rw-r--r-- 1 ecc ecc 1.2M Jul  5 23:51 openwrt-kirkwood-rootfs.tar.gz
-rw-r--r-- 1 ecc ecc 5.0M Jul  5 23:51 openwrt-kirkwood-squashfs.img
-rw-r--r-- 1 ecc ecc 958K Jul  5 23:51 openwrt-kirkwood-uImage
drwxr-xr-x 2 ecc ecc 4.0K Jul  5 23:51 packages/</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p112573">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">mazilo</div>
					<div class="post-datetime">
						6 Jul 2010, 18:32					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>ecc wrote:</cite><blockquote><p>I tried adding jffs2 and squashfs image options to my build, but the resulting files are *larger* than the rootfs tarball, which doesn&#039;t seem right.</p></blockquote></div><p>Depending on what you put into the firmware through a <em>make menuconfig</em>, The tarball file varies from size to size. On my OpenWRT tarball file, it is about 100MB in size because I included asterisk-1.6.2 and freeswitch-1.0.6 along with their IVR sound files.</p><p>BTW, have you formatted your external USB partition with a supported filesystem, i.e. ext3, ext4, etc.?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p112575">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">ecc</div>
					<div class="post-datetime">
						6 Jul 2010, 18:45					</div>
				</div>
				<div class="post-content content">
					<p>It looks like the squashfs and jffs2 images are combined kernel + rootfs.&nbsp; Is there a way to generate just the rootfs image in squashfs or jffs2 format?&nbsp; (I can do it &quot;by hand&quot; from the root tarball, I guess.)</p><div class="quotebox"><blockquote><p>BTW, have you formatted your external USB partition with a supported filesystem, i.e. ext3, ext4, etc.?</p></blockquote></div><p>Yes, I&#039;m using an ext2-formated USB drive and passing root=/dev/sda1 in bootargs.&nbsp; That&#039;s working fine now.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p112578">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">mazilo</div>
					<div class="post-datetime">
						6 Jul 2010, 19:22					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>ecc wrote:</cite><blockquote><p>It looks like the squashfs and jffs2 images are combined kernel + rootfs.&nbsp; Is there a way to generate just the rootfs image in squashfs or jffs2 format?</p></blockquote></div><p>I am not sure what you meant, but is this the option (CONFIG_TARGET_ROOTFS_SQUASHFS) you are looking for on .config file?</p><div class="quotebox"><blockquote><div class="quotebox"><blockquote><p>BTW, have you formatted your external USB partition with a supported filesystem, i.e. ext3, ext4, etc.?</p></blockquote></div><p>Yes, I&#039;m using an ext2-formated USB drive and passing root=/dev/sda1 in bootargs.&nbsp; That&#039;s working fine now.</p></blockquote></div><p>So, now your DockStar device can boot off of an external USB partition that has an OpenWRT BackFire OS?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p112584">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">ecc</div>
					<div class="post-datetime">
						6 Jul 2010, 20:39					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>mazilo wrote:</cite><blockquote><p>I am not sure what you meant, but is this the option (CONFIG_TARGET_ROOTFS_SQUASHFS) you are looking for on .config file?</p></blockquote></div><p>That&#039;s what I&#039;ve specified, but the resulting file seems to be some sort of combined image:<br /></p><div class="codebox"><pre><code>$ file openwrt-kirkwood-squashfs.img 
openwrt-kirkwood-squashfs.img: u-boot legacy uImage, Linux-2.6.30.10, Linux/ARM, OS Kernel Image (Not compressed), 980728 bytes, Mon Jul  5 23:51:40 2010, Load Address: 0x00008000, Entry Point: 0x00008000, Header CRC: 0x4CFB1E43, Data CRC: 0x1B28F232</code></pre></div><p>It&#039;s not just a filesystem image that I can mount via loopback.</p><div class="quotebox"><blockquote><p>So, now your DockStar device can boot off of an external USB partition that has an OpenWRT BackFire OS?</p></blockquote></div><p>Yes, but I&#039;m doing it &quot;by hand&quot; via u-boot and the serial console. And the image was built from trunk, not backfire, but I don&#039;t think that matters much.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p112599">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">phat_bastard</div>
					<div class="post-datetime">
						6 Jul 2010, 22:53					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>ecc wrote:</cite><blockquote><p>... I&#039;m doing it &quot;by hand&quot; via u-boot and the serial console.</p></blockquote></div><p>Am I understanding that you&#039;re loading the kernel from usb via the PlugApps bootloader?&nbsp; Or are you booting the uImage via netboot / tftp?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p112603">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">ecc</div>
					<div class="post-datetime">
						6 Jul 2010, 23:51					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>phat_bastard wrote:</cite><blockquote><div class="quotebox"><cite>ecc wrote:</cite><blockquote><p>... I&#039;m doing it &quot;by hand&quot; via u-boot and the serial console.</p></blockquote></div><p>Am I understanding that you&#039;re loading the kernel from usb via the PlugApps bootloader?&nbsp; Or are you booting the uImage via netboot / tftp?</p></blockquote></div><p>I was using tftpboot (in u-boot) to load the usb-enabled openwrt kernel, then booting that with &quot;root=/dev/sda1 rootfstype=ext2&quot; in the bootargs.</p><p>I&#039;ve now flashed the mtd1 partition with this kernel, and that boots fine with the rootfs on USB. But I can&#039;t yet boot with rootfs also in flash -- it isn&#039;t finding it in mtd2 for some reason.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p112606">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">phat_bastard</div>
					<div class="post-datetime">
						7 Jul 2010, 00:05					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>ecc wrote:</cite><blockquote><p>I was using tftpboot (in u-boot) to load the usb-enabled openwrt kernel, then booting that with &quot;root=/dev/sda1 rootfstype=ext2&quot; in the bootargs.</p></blockquote></div><p>Using the factory bootloader, or a usb-patched version?</p><div class="quotebox"><cite>ecc wrote:</cite><blockquote><p>I&#039;ve now flashed the mtd1 partition with this kernel, and that boots fine with the rootfs on USB. But I can&#039;t yet boot with rootfs also in flash -- it isn&#039;t finding it in mtd2 for some reason.</p></blockquote></div><p>What&#039;s the MTD system seeing for partitions? When I was netbooting the default backfire image over the weekend I noticed MTD wasn&#039;t seeing the correct layout for the dockstar.</p><div class="codebox"><pre><code>NAND device: Manufacturer ID: 0x2c, Chip ID: 0xda (Micron NAND 256MiB 3,3V 8-bit)
Scanning device for bad blocks
Creating 3 MTD partitions on &quot;NAND 256MiB 3,3V 8-bit&quot;:
0x000000000000-0x000000100000 : &quot;u-boot&quot;
0x000000100000-0x000000500000 : &quot;uImage&quot;
0x000000500000-0x000010000000 : &quot;rootfs&quot;</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p112609">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">ecc</div>
					<div class="post-datetime">
						7 Jul 2010, 01:08					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>phat_bastard wrote:</cite><blockquote><div class="quotebox"><cite>ecc wrote:</cite><blockquote><p>I was using tftpboot (in u-boot) to load the usb-enabled openwrt kernel, then booting that with &quot;root=/dev/sda1 rootfstype=ext2&quot; in the bootargs.</p></blockquote></div><p>Using the factory bootloader, or a usb-patched version?</p></blockquote></div><p>I played around with the usb-patched one from pogoplug, but I didn&#039;t need it for this -- the factory one supports tftpboot (and nand erase/write/etc.), which is all I needed.<br /></p><div class="quotebox"><blockquote><div class="quotebox"><cite>ecc wrote:</cite><blockquote><p>I&#039;ve now flashed the mtd1 partition with this kernel, and that boots fine with the rootfs on USB. But I can&#039;t yet boot with rootfs also in flash -- it isn&#039;t finding it in mtd2 for some reason.</p></blockquote></div><p>What&#039;s the MTD system seeing for partitions? When I was netbooting the default backfire image over the weekend I noticed MTD wasn&#039;t seeing the correct layout for the dockstar.</p><div class="codebox"><pre><code>NAND device: Manufacturer ID: 0x2c, Chip ID: 0xda (Micron NAND 256MiB 3,3V 8-bit)
Scanning device for bad blocks
Creating 3 MTD partitions on &quot;NAND 256MiB 3,3V 8-bit&quot;:
0x000000000000-0x000000100000 : &quot;u-boot&quot;
0x000000100000-0x000000500000 : &quot;uImage&quot;
0x000000500000-0x000010000000 : &quot;rootfs&quot;</code></pre></div></blockquote></div><p>Right, I noticed the same thing.&nbsp; So I recompiled the kernel with CONFIG_MTD_CMDLINE_PARTS=y, and am now passing the following in bootargs:<br /></p><div class="codebox"><pre><code> 
mtdparts=orion_nand:1m(u-boot),4m@1m(uImage),32m@5m(rootfs),219m@37m(rootfs_data)</code></pre></div><p>That improved things a bit:<br /></p><div class="codebox"><pre><code>NAND device: Manufacturer ID: 0x2c, Chip ID: 0xda (Micron NAND 256MiB 3,3V 8-bit)
Scanning device for bad blocks
4 cmdlinepart partitions found on MTD device orion_nand
Creating 4 MTD partitions on &quot;orion_nand&quot;:
0x000000000000-0x000000100000 : &quot;u-boot&quot;
0x000000100000-0x000000500000 : &quot;uImage&quot;
0x000000500000-0x000002500000 : &quot;rootfs&quot;
0x000002500000-0x000010000000 : &quot;rootfs_data&quot;</code></pre></div><p>But I still get this failure:<br /></p><div class="codebox"><pre><code>VFS: Cannot open root device &quot;mtd2block&quot; or unknown-block(0,0)
Please append a correct &quot;root=&quot; boot option; here are the available partitions:
1f00            1024 mtdblock0 (driver?)
1f01            4096 mtdblock1 (driver?)
1f02           32768 mtdblock2 (driver?)
1f03          224256 mtdblock3 (driver?)
Kernel panic - not syncing: VFS: Unable to mount root fs on unknown-block(0,0)</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p112614">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">phat_bastard</div>
					<div class="post-datetime">
						7 Jul 2010, 02:41					</div>
				</div>
				<div class="post-content content">
					<p>Just a guess, but you might try appending:</p><div class="codebox"><pre><code>rootfstype=squashfs,yaffs,jffs2</code></pre></div><p>to your bootargs.&nbsp; Also, what&#039;s your root= look like?&nbsp; I ask because I believe MTD uses the convention /dev/mtdblock[n], not /dev/mtd[n]block as VFS is barking about.</p><p>Thanks for confirmation on the bootloader.&nbsp; I guess the kernels I tried booting all had serial console disabled.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p112619">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">mazilo</div>
					<div class="post-datetime">
						7 Jul 2010, 03:39					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>ecc wrote:</cite><blockquote><p>Is there a way to generate just the rootfs image in squashfs or jffs2 format?&nbsp; (I can do it &quot;by hand&quot; from the root tarball, I guess.)</p></blockquote></div><p>I am not sure what did you mean. I use the <em>openwrt-kirkwood-rootfs.tar.gz</em> file and extract it to an external USB partition that has been formatted with an ext3 filesystem.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p112624">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">ecc</div>
					<div class="post-datetime">
						7 Jul 2010, 07:18					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>phat_bastard wrote:</cite><blockquote><p>Just a guess, but you might try appending:</p><div class="codebox"><pre><code>rootfstype=squashfs,yaffs,jffs2</code></pre></div><p>to your bootargs.&nbsp; Also, what&#039;s your root= look like?&nbsp; I ask because I believe MTD uses the convention /dev/mtdblock[n], not /dev/mtd[n]block as VFS is barking about.</p></blockquote></div><p>That was a typo, but even when it&#039;s correct (mtdblock2), I&#039;m still getting this:<br /></p><div class="codebox"><pre><code> 
SQUASHFS error: squashfs_read_data failed to read block 0x0
SQUASHFS error: unable to read squashfs_super_block</code></pre></div><p>Something&#039;s not right with my squashfs image, because I get the same error when I boot from USB and then try to mount /dev/mtdblock2 from the command line. I&#039;m now rebuilding a kernel with debugging turned on in the squashfs module and will hack on it some more tomorrow.</p><div class="quotebox"><blockquote><p>Thanks for confirmation on the bootloader.&nbsp; I guess the kernels I tried booting all had serial console disabled.</p></blockquote></div><p>You also need to pass console=ttyS0,115200 in bootargs. This is done automatically with the factory u-boot environment via<br /></p><div class="codebox"><pre><code> setenv bootargs $(console) $(bootargs_root)</code></pre></div><p>embedded in the value of bootcmd.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p112656">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">ecc</div>
					<div class="post-datetime">
						7 Jul 2010, 17:23					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>ecc wrote:</cite><blockquote><p>Something&#039;s not right with my squashfs image, because I get the same error when I boot from USB and then try to mount /dev/mtdblock2 from the command line.</p></blockquote></div><p>It turns out I was using a squashfs image that was padded to a 64k boundary, not a 128k boundary.&nbsp; I fixed that and now it is booting correctly.</p><p>Next step is to make the firstboot process set up the rootfs_data and mini_fo stuff correctly.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p112657">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">phat_bastard</div>
					<div class="post-datetime">
						7 Jul 2010, 17:45					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>ecc wrote:</cite><blockquote><p>You also need to pass console=ttyS0,115200 in bootargs. This is done automatically with the factory u-boot environment via<br /></p><div class="codebox"><pre><code> setenv bootargs $(console) $(bootargs_root)</code></pre></div><p>embedded in the value of bootcmd.</p></blockquote></div><p>I had the serial console defined - I think what fixed this for me was specifying &#039;noinitrd&#039; in the bootargs.&nbsp; But this goes away when I boot a proper ramdisk image or specify a rootfs.</p><p>I built several different configs last night, and think I figured a few things out.&nbsp; I believe the correct method for preparing the jffs root partition is to build a ramdisk image and boot it, then from the openwrt shell erase the partition(s) and mount them.&nbsp; Something like:</p><div class="codebox"><pre><code>&gt; mtd erase &lt;mtd_partition_name (i.e. &#039;rootfs&#039; or &#039;rootfs_data&#039;)&gt;
mount -t jffs2 /dev/mtdblock3 /mnt</code></pre></div><p>Then grab the rootfs tarball with wget and untar it onto the newly formatted jffs2 partition.</p><p>I think the only mod needed in the config file is CONFIG_MTD_CMDLINE_PARTS=y, but only if you want to make backups of the MTD partitions before erasing them.&nbsp; I think it&#039;s possible to use the default MTD geometry also, combining the rootfs and rootfs_data partitions into one large one, but this is all theoretical.</p><p>Unfortunately after using the mtd erase / mount / tar extraction process above it still ended up with a panic halt on the VFS error, but I&#039;m also seeing nand write errors on the one I tested this on so I&#039;ll report back after further testing.</p>											<p class="post-edited">(Last edited by <strong>phat_bastard</strong> on 7 Jul 2010, 17:46)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p112660">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">mazilo</div>
					<div class="post-datetime">
						7 Jul 2010, 18:12					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>phat_bastard wrote:</cite><blockquote><p>I built several different configs last night, and think I figured a few things out.&nbsp; I believe the correct method for preparing the jffs root partition is to build a ramdisk image and boot it, then from the openwrt shell erase the partition(s) and mount them.&nbsp; Something like:</p><div class="codebox"><pre><code>&gt; mtd erase &lt;mtd_partition_name (i.e. &#039;rootfs&#039; or &#039;rootfs_data&#039;)&gt;
mount -t jffs2 /dev/mtdblock3 /mnt</code></pre></div><p>Then grab the rootfs tarball with wget and untar it onto the newly formatted jffs2 partition.</p></blockquote></div><p>I haven&#039;t done this yet. However, if a DockStar boots off of an OpenWRT firmware off a RAMDISK, will it see the original contents on its NAND drive partitions? I have my DockStar device boots off of an external USB partition and I can&#039;t seem to find the MTD partitions from its NAND drive.</p><div class="quotebox"><blockquote><p>Unfortunately after using the mtd erase / mount / tar extraction process above it still ended up with a panic halt on the VFS error, but I&#039;m also seeing nand write errors on the one I tested this on so I&#039;ll report back after further testing.</p></blockquote></div><p>Can you make sure your OpenWRT BackFire has the SCSI drive, USB Storage, and ext2/ext3 filesystems modules included?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p112664">
				<div class="post-metadata">
					<div class="post-num">Post #21</div>
					<div class="post-author">phat_bastard</div>
					<div class="post-datetime">
						7 Jul 2010, 18:53					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>mazilo wrote:</cite><blockquote><p>... if a DockStar boots off of an OpenWRT firmware off a RAMDISK, will it see the original contents on its NAND drive partitions</p></blockquote></div><p>It will if you set CONFIG_MTD_CMDLINE_PARTS=y and use the mtdparts bootargs that ECC outlined previously.&nbsp; You will also need to mount them manually i.e.</p><p>mount -t jffs2 /dev/mtdblock2 /mnt</p><p>I had the dockstar rootfs mounted last night, but no USB to back anything up to.</p><div class="quotebox"><cite>mazilo wrote:</cite><blockquote><p>Can you make sure your OpenWRT BackFire has the SCSI drive, USB Storage, and ext2/ext3 filesystems modules included?</p></blockquote></div><p>They are compiled modularly.&nbsp; I&#039;m building now statically because I have no USB whatsoever.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p112668">
				<div class="post-metadata">
					<div class="post-num">Post #22</div>
					<div class="post-author">ecc</div>
					<div class="post-datetime">
						7 Jul 2010, 19:15					</div>
				</div>
				<div class="post-content content">
					<p>Success!&nbsp; I now have my Dockstar booting OpenWrt entirely from the internal NAND flash partitions.<br /></p><div class="codebox"><pre><code>BusyBox v1.16.2 (2010-07-04 20:52:22 EDT) built-in shell (ash)
Enter &#039;help&#039; for a list of built-in commands.

  _______                     ________        __
 |       |.-----.-----.-----.|  |  |  |.----.|  |_
 |   -   ||  _  |  -__|     ||  |  |  ||   _||   _|
 |_______||   __|_____|__|__||________||__|  |____|
          |__| W I R E L E S S   F R E E D O M
 KAMIKAZE (bleeding edge, r22061) ------------------
  * 10 oz Vodka       Shake well with ice and strain
  * 10 oz Triple sec  mixture into 10 shot glasses.
  * 10 oz lime juice  Salute!
 ---------------------------------------------------
root@OpenWrt:/# mount
rootfs on / type rootfs (rw)
/dev/root on /rom type squashfs (ro,relatime)
proc on /proc type proc (rw,relatime)
sysfs on /sys type sysfs (rw,relatime)
tmpfs on /tmp type tmpfs (rw,nosuid,nodev,relatime)
tmpfs on /dev type tmpfs (rw,relatime,size=512k)
devpts on /dev/pts type devpts (rw,relatime,mode=600)
/dev/mtdblock3 on /overlay type jffs2 (rw,relatime)
mini_fo:/overlay on / type mini_fo (rw,relatime)
none on /proc/bus/usb type usbfs (rw,relatime)
root@OpenWrt:/# df -h
Filesystem                Size      Used Available Use% Mounted on
/dev/root                 1.0M      1.0M         0 100% /rom
tmpfs                    62.2M     28.0K     62.1M   0% /tmp
tmpfs                   512.0K         0    512.0K   0% /dev
/dev/mtdblock3          219.0M      4.9M    214.1M   2% /overlay
mini_fo:/overlay          1.0M      1.0M         0 100% /
root@OpenWrt:/#</code></pre></div><p>I think all the steps I went through are in this thread somewhere, but I&#039;ll write up a howto. (The final piece was to make sure mtd3 was zeroed, so that the firstboot process would correctly create the jffs2 filesystem there for the overlay.) </p><p>I think I see how to do this without cracking the case and attaching a serial cable, just using the pogoplug system itself.&nbsp; That&#039;s next :-)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p112671">
				<div class="post-metadata">
					<div class="post-num">Post #23</div>
					<div class="post-author">mazilo</div>
					<div class="post-datetime">
						7 Jul 2010, 20:24					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>phat_bastard wrote:</cite><blockquote><div class="quotebox"><cite>mazilo wrote:</cite><blockquote><p>... if a DockStar boots off of an OpenWRT firmware off a RAMDISK, will it see the original contents on its NAND drive partitions</p></blockquote></div><p>It will if you set CONFIG_MTD_CMDLINE_PARTS=y ...</p></blockquote></div><p>Where would I find CONFIG_MTD_CMDLINE_PARTS variable? I searched this CONFIG_MTD_CMDLINE_PARTS variable through the <strong>.config</strong> and the <strong>config-default</strong> files on my OpenWRT SVN trunk and target/linux/kirkwood, respectively, but didn&#039;t find such a variable.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p112672">
				<div class="post-metadata">
					<div class="post-num">Post #24</div>
					<div class="post-author">mazilo</div>
					<div class="post-datetime">
						7 Jul 2010, 20:26					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>ecc wrote:</cite><blockquote><p>Success!&nbsp; I now have my Dockstar booting OpenWrt entirely from the internal NAND flash partitions.</p></blockquote></div><p>Congratulation! I will be awaiting for your HOWTO.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p112673">
				<div class="post-metadata">
					<div class="post-num">Post #25</div>
					<div class="post-author">phat_bastard</div>
					<div class="post-datetime">
						7 Jul 2010, 20:34					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>mazilo wrote:</cite><blockquote><p>Where would I find CONFIG_MTD_CMDLINE_PARTS variable?</p></blockquote></div><p>You will have to create the entry, not sure if it makes a difference where.</p><p>I finally got USB working and had the same failed result trying to backup the original kernel and rootfs image with DD from openwrt backfire (ramdisk), so I dropped back to punt.&nbsp; I&#039;m continuing on with formatting the rootfs partition and extracting the filesystem from the ramdisk.&nbsp; Will report back if successful.&nbsp; Though it sounds like ECC might have a faster / better method documented shortly.</p>											<p class="post-edited">(Last edited by <strong>phat_bastard</strong> on 7 Jul 2010, 20:34)</p>
									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 1 of 3</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=25518&amp;p=2.html">2</a></li><li><a href="viewtopic.php%3Fid=25518&amp;p=3.html">3</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>