<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> mwan3; multi-wan policy routing (general topic)</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 22 May 2013 and 6 May 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 61 of 65</div><nav><ul><li><a href="viewtopic.php%3Fid=39052&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=59.html">59</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=60.html">60</a></li><li class="pagination-current"><span>61</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=62.html">62</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=63.html">63</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=65.html">65</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p305450">
				<div class="post-metadata">
					<div class="post-num">Post #1501</div>
					<div class="post-author">bobptz</div>
					<div class="post-datetime">
						29 Dec 2015, 21:55					</div>
				</div>
				<div class="post-content content">
					<p>Adze</p><p>Would you have any idea why sqm-scripts seems to somehow disable and replace the mwan3 rules?&nbsp; </p><p>If you want, I can do some testing for you.&nbsp; </p><p>Now I need to disable SQM so that I can setup and test the mwan3 rules.&nbsp; And then I can activate SQM again.</p><p>Is there a way to test what traffic goes to what wan interface?&nbsp; It would simplify my troubleshooting.&nbsp; </p><p>I&#039;ve heard of wireshark but I am not sure how to set it up to examine the router.</p>											<p class="post-edited">(Last edited by <strong>bobptz</strong> on 29 Dec 2015, 22:04)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p305735">
				<div class="post-metadata">
					<div class="post-num">Post #1502</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						1 Jan 2016, 03:45					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>bobptz wrote:</cite><blockquote><p>Is there a way to test what traffic goes to what wan interface?&nbsp; It would simplify my troubleshooting.</p></blockquote></div><p>Install tcpdump package on your router.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p305745">
				<div class="post-metadata">
					<div class="post-num">Post #1503</div>
					<div class="post-author">bobptz</div>
					<div class="post-datetime">
						1 Jan 2016, 09:39					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>arfett wrote:</cite><blockquote><div class="quotebox"><cite>bobptz wrote:</cite><blockquote><p>Is there a way to test what traffic goes to what wan interface?&nbsp; It would simplify my troubleshooting.</p></blockquote></div><p>Install tcpdump package on your router.</p></blockquote></div><p>Thank you.&nbsp; And then I can examine the output through wireshark on my pc.&nbsp; Already made a guide how to set this up:<br /><a href="http://bbb-solutions.blogspot.gr/2015/12/monitor-openwrt-traffic-with-wireshark.html">http://bbb-solutions.blogspot.gr/2015/1 … shark.html</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p305803">
				<div class="post-metadata">
					<div class="post-num">Post #1504</div>
					<div class="post-author">anarchy99</div>
					<div class="post-datetime">
						1 Jan 2016, 20:25					</div>
				</div>
				<div class="post-content content">
					<p>Hi</p><p>Here&#039;s troubleshooting data as requested on github, with masked mac and ip addresses:</p><div class="codebox"><pre><code>Software versions : 

OpenWrt - OpenWrt Designated Driver r47929
LuCI - git-15.351.05963-967bb1f

mwan3 - 2.0-0
mwan3-luci - 1.4-4

Output of &quot;cat /etc/config/mwan3&quot; : 

config interface &#039;l2tp&#039;
    option enabled &#039;1&#039;
    option reliability &#039;1&#039;
    option count &#039;1&#039;
    option timeout &#039;2&#039;
    option interval &#039;5&#039;
    option down &#039;3&#039;
    option up &#039;3&#039;

config interface &#039;l2tp2&#039;
    option enabled &#039;1&#039;
    option reliability &#039;1&#039;
    option count &#039;1&#039;
    option timeout &#039;2&#039;
    option interval &#039;5&#039;
    option down &#039;3&#039;
    option up &#039;3&#039;

config interface &#039;wwan&#039;
    option enabled &#039;1&#039;
    option reliability &#039;1&#039;
    option count &#039;1&#039;
    option timeout &#039;2&#039;
    option interval &#039;5&#039;
    option down &#039;3&#039;
    option up &#039;3&#039;

config member &#039;l2tp_member&#039;
    option interface &#039;l2tp&#039;

config member &#039;l2tp2_member&#039;
    option interface &#039;l2tp2&#039;

config member &#039;wwan_member&#039;
    option interface &#039;wwan&#039;

config policy &#039;l2tp_only&#039;
    list use_member &#039;l2tp_member&#039;
    option last_resort &#039;blackhole&#039;

config policy &#039;l2tp2_only&#039;
    list use_member &#039;l2tp2_member&#039;
    option last_resort &#039;blackhole&#039;

config policy &#039;wwan_only&#039;
    list use_member &#039;wwan_member&#039;
    option last_resort &#039;blackhole&#039;

config rule &#039;lan&#039;
    option src_ip &#039;192.168.4.0/24&#039;
    option proto &#039;all&#039;
    option sticky &#039;0&#039;
    option use_policy &#039;l2tp_only&#039;

config rule &#039;wlan0_1&#039;
    option src_ip &#039;192.168.5.0/24&#039;
    option proto &#039;all&#039;
    option sticky &#039;0&#039;
    option use_policy &#039;l2tp_only&#039;

config rule &#039;wlan0_2&#039;
    option src_ip &#039;192.168.6.0/24&#039;
    option proto &#039;all&#039;
    option sticky &#039;0&#039;
    option use_policy &#039;wwan_only&#039;

config rule &#039;wlan0_3&#039;
    option src_ip &#039;192.168.7.0/24&#039;
    option proto &#039;all&#039;
    option sticky &#039;0&#039;
    option use_policy &#039;l2tp2_only&#039;

config rule &#039;wlan0_4&#039;
    option src_ip &#039;192.168.8.0/24&#039;
    option proto &#039;all&#039;
    option sticky &#039;0&#039;
    option use_policy &#039;l2tp2_only&#039;

config rule &#039;wlan1_1&#039;
    option proto &#039;all&#039;
    option sticky &#039;0&#039;
    option src_ip &#039;192.168.10.0/24&#039;
    option use_policy &#039;l2tp_only&#039;

config rule &#039;wlan1_2&#039;
    option proto &#039;all&#039;
    option sticky &#039;0&#039;
    option use_policy &#039;wwan_only&#039;
    option src_ip &#039;192.168.11.0/24&#039;

config rule &#039;wlan1_3&#039;
    option proto &#039;all&#039;
    option sticky &#039;0&#039;
    option use_policy &#039;l2tp2_only&#039;
    option src_ip &#039;192.168.12.0/24&#039;

config rule &#039;wlan1_4&#039;
    option proto &#039;all&#039;
    option sticky &#039;0&#039;
    option use_policy &#039;l2tp2_only&#039;
    option src_ip &#039;192.168.13.0/24&#039;

config rule &#039;wlan2_1&#039;
    option proto &#039;all&#039;
    option sticky &#039;0&#039;
    option src_ip &#039;192.168.14.0/24&#039;
    option use_policy &#039;l2tp2_only&#039;

Output of &quot;cat /etc/config/network&quot; : 

config interface &#039;loopback&#039;
    option ifname &#039;lo&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;127.0.0.1&#039;
    option netmask &#039;255.0.0.0&#039;

config interface &#039;lan&#039;
    option force_link &#039;1&#039;
    option macaddr &#039;xx:xx:xx:xx:xx:xx&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;192.168.4.1&#039;
    option netmask &#039;255.255.255.0&#039;
    option _orig_ifname &#039;eth0.1 wlan1 radio2.network1&#039;
    option _orig_bridge &#039;true&#039;
    option ifname &#039;eth0.1&#039;
    option delegate &#039;0&#039;
    option auto &#039;0&#039;

config interface &#039;wan&#039;
    option ifname &#039;eth0.2&#039;
    option force_link &#039;1&#039;
    option macaddr &#039;xx:xx:xx:xx:xx:xx&#039;
    option proto &#039;dhcp&#039;
    option delegate &#039;0&#039;
    option auto &#039;0&#039;

config switch
    option name &#039;switch0&#039;
    option reset &#039;1&#039;
    option enable_vlan &#039;1&#039;

config switch_vlan
    option device &#039;switch0&#039;
    option vlan &#039;1&#039;
    option vid &#039;1&#039;

config switch_vlan
    option device &#039;switch0&#039;
    option vlan &#039;2&#039;
    option vid &#039;2&#039;

config interface &#039;wwan&#039;
    option _orig_ifname &#039;wlan2&#039;
    option _orig_bridge &#039;false&#039;
    option proto &#039;static&#039;
    option delegate &#039;0&#039;
    option netmask &#039;255.255.254.0&#039;
    option broadcast &#039;192.168.1.255&#039;
    option ipaddr &#039;192.168.0.42&#039;
    option dns &#039;208.67.222.222&#039;
    option gateway &#039;192.168.0.1&#039;
    option metric &#039;30&#039;

config interface &#039;l2tp&#039;
    option proto &#039;l2tp&#039;
    USERNAME HIDDEN
    PASSWORD HIDDEN
    option delegate &#039;0&#039;
    option metric &#039;10&#039;
    option server &#039;1.2.3.4&#039;

config interface &#039;wlan0_1&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;192.168.5.1&#039;
    option netmask &#039;255.255.255.0&#039;
    option delegate &#039;0&#039;

config interface &#039;wlan0_2&#039;
    option proto &#039;static&#039;
    option netmask &#039;255.255.255.0&#039;
    option delegate &#039;0&#039;
    option ipaddr &#039;192.168.6.1&#039;

config interface &#039;wlan0_3&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;192.168.7.1&#039;
    option netmask &#039;255.255.255.0&#039;
    option delegate &#039;0&#039;

config interface &#039;wlan0_4&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;192.168.8.1&#039;
    option netmask &#039;255.255.255.0&#039;
    option delegate &#039;0&#039;

config interface &#039;wlan1_1&#039;
    option proto &#039;static&#039;
    option delegate &#039;0&#039;
    option netmask &#039;255.255.255.0&#039;
    option ipaddr &#039;192.168.10.1&#039;

config interface &#039;wlan1_2&#039;
    option proto &#039;static&#039;
    option delegate &#039;0&#039;
    option netmask &#039;255.255.255.0&#039;
    option ipaddr &#039;192.168.11.1&#039;

config interface &#039;wlan1_3&#039;
    option proto &#039;static&#039;
    option delegate &#039;0&#039;
    option netmask &#039;255.255.255.0&#039;
    option ipaddr &#039;192.168.12.1&#039;

config interface &#039;wlan1_4&#039;
    option proto &#039;static&#039;
    option delegate &#039;0&#039;
    option netmask &#039;255.255.255.0&#039;
    option ipaddr &#039;192.168.13.1&#039;

config interface &#039;wlan2_1&#039;
    option _orig_ifname &#039;radio2.network2&#039;
    option _orig_bridge &#039;false&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;192.168.15.1&#039;
    option netmask &#039;255.255.255.0&#039;
    option delegate &#039;0&#039;

config interface &#039;l2tp2&#039;
    option proto &#039;l2tp&#039;
    option delegate &#039;0&#039;
    option server &#039;1.2.2.3&#039;
    USERNAME HIDDEN
    PASSWORD HIDDEN
    option metric &#039;20&#039;

Output of &quot;ifconfig&quot; : 

l2tp-l2tp Link encap:Point-to-Point Protocol  
          inet addr:10.10.1.6  P-t-P:10.10.1.1  Mask:255.255.255.255
          UP POINTOPOINT RUNNING NOARP MULTICAST  MTU:1410  Metric:1
          RX packets:6469 errors:0 dropped:0 overruns:0 frame:0
          TX packets:4564 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:3 
          RX bytes:4453331 (4.2 MiB)  TX bytes:599197 (585.1 KiB)

l2tp-l2tp2 Link encap:Point-to-Point Protocol  
          inet addr:10.10.1.5  P-t-P:10.10.1.1  Mask:255.255.255.255
          UP POINTOPOINT RUNNING NOARP MULTICAST  MTU:1410  Metric:1
          RX packets:2680 errors:0 dropped:0 overruns:0 frame:0
          TX packets:2290 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:3 
          RX bytes:1835687 (1.7 MiB)  TX bytes:251427 (245.5 KiB)

lo        Link encap:Local Loopback  
          inet addr:127.0.0.1  Mask:255.0.0.0
          UP LOOPBACK RUNNING  MTU:65536  Metric:1
          RX packets:125763 errors:0 dropped:0 overruns:0 frame:0
          TX packets:125763 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:22327239 (21.2 MiB)  TX bytes:22327239 (21.2 MiB)

wlan0     Link encap:Ethernet  HWaddr xx:xx:xx:xx:xx:xx  
          inet addr:192.168.5.1  Bcast:192.168.5.255  Mask:255.255.255.0
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:7691676 errors:0 dropped:0 overruns:0 frame:0
          TX packets:9482142 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:3825797018 (3.5 GiB)  TX bytes:10778142900 (10.0 GiB)

wlan0-1   Link encap:Ethernet  HWaddr xx:xx:xx:xx:xx:xx  
          inet addr:192.168.6.1  Bcast:192.168.6.255  Mask:255.255.255.0
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:535966 errors:0 dropped:0 overruns:0 frame:0
          TX packets:506971 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:508378679 (484.8 MiB)  TX bytes:485259856 (462.7 MiB)

wlan0-2   Link encap:Ethernet  HWaddr xx:xx:xx:xx:xx:xx  
          inet addr:192.168.7.1  Bcast:192.168.7.255  Mask:255.255.255.0
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:10436546 errors:0 dropped:18201 overruns:0 frame:0
          TX packets:12551953 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:4896928661 (4.5 GiB)  TX bytes:12320509137 (11.4 GiB)

wlan0-3   Link encap:Ethernet  HWaddr xx:xx:xx:xx:xx:xx  
          inet addr:192.168.8.1  Bcast:192.168.8.255  Mask:255.255.255.0
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:30922 errors:0 dropped:131 overruns:0 frame:0
          TX packets:45767 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:2925733 (2.7 MiB)  TX bytes:54461816 (51.9 MiB)

wlan1     Link encap:Ethernet  HWaddr xx:xx:xx:xx:xx:xx  
          inet addr:192.168.10.1  Bcast:192.168.10.255  Mask:255.255.255.0
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:1 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:0 (0.0 B)  TX bytes:360 (360.0 B)

wlan1-1   Link encap:Ethernet  HWaddr xx:xx:xx:xx:xx:xx  
          inet addr:192.168.11.1  Bcast:192.168.11.255  Mask:255.255.255.0
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)

wlan1-2   Link encap:Ethernet  HWaddr xx:xx:xx:xx:xx:xx  
          inet addr:192.168.12.1  Bcast:192.168.12.255  Mask:255.255.255.0
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:337 errors:0 dropped:70 overruns:0 frame:0
          TX packets:215 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:28997 (28.3 KiB)  TX bytes:26085 (25.4 KiB)

wlan1-3   Link encap:Ethernet  HWaddr xx:xx:xx:xx:xx:xx  
          inet addr:192.168.13.1  Bcast:192.168.13.255  Mask:255.255.255.0
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
          TX packets:1 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:0 (0.0 B)  TX bytes:360 (360.0 B)

wlan2     Link encap:Ethernet  HWaddr xx:xx:xx:xx:xx:xx  
          inet addr:192.168.0.42  Bcast:192.168.1.255  Mask:255.255.254.0
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:6873 errors:0 dropped:0 overruns:0 frame:0
          TX packets:4655 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:4827165 (4.6 MiB)  TX bytes:926514 (904.7 KiB)

Output of &quot;route -n&quot; : 

Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
0.0.0.0         10.10.1.1       0.0.0.0         UG    10     0        0 l2tp-l2tp
0.0.0.0         10.10.1.1       0.0.0.0         UG    20     0        0 l2tp-l2tp2
0.0.0.0         192.168.0.1     0.0.0.0         UG    30     0        0 wlan2
10.10.1.1       0.0.0.0         255.255.255.255 UH    0      0        0 l2tp-l2tp
10.10.1.1       0.0.0.0         255.255.255.255 UH    0      0        0 l2tp-l2tp2
1.2.3.4         10.10.1.1       255.255.255.255 UGH   10     0        0 l2tp-l2tp
1.2.3.4         192.168.0.1     255.255.255.255 UGH   30     0        0 wlan2
1.2.2.3         192.168.0.1     255.255.255.255 UGH   30     0        0 wlan2
192.168.0.0     0.0.0.0         255.255.254.0   U     30     0        0 wlan2
192.168.5.0     0.0.0.0         255.255.255.0   U     0      0        0 wlan0
192.168.6.0     0.0.0.0         255.255.255.0   U     0      0        0 wlan0-1
192.168.7.0     0.0.0.0         255.255.255.0   U     0      0        0 wlan0-2
192.168.8.0     0.0.0.0         255.255.255.0   U     0      0        0 wlan0-3
192.168.10.0    0.0.0.0         255.255.255.0   U     0      0        0 wlan1
192.168.11.0    0.0.0.0         255.255.255.0   U     0      0        0 wlan1-1
192.168.12.0    0.0.0.0         255.255.255.0   U     0      0        0 wlan1-2
192.168.13.0    0.0.0.0         255.255.255.0   U     0      0        0 wlan1-3

Output of &quot;ip rule show&quot; : 

0:    from all lookup 128 
1:    from all lookup local 
1001:    from all iif l2tp-l2tp lookup main 
1002:    from all iif l2tp-l2tp2 lookup main 
1003:    from all iif wlan2 lookup main 
2001:    from all fwmark 0x100/0xff00 lookup 1 
2002:    from all fwmark 0x200/0xff00 lookup 2 
2003:    from all fwmark 0x300/0xff00 lookup 3 
2253:    from all fwmark 0xfd00/0xff00 blackhole
2254:    from all fwmark 0xfe00/0xff00 unreachable
32766:    from all lookup main 
32767:    from all lookup default

Output of &quot;ip route list table 1-250&quot; : 

1
default via 10.10.1.1 dev l2tp-l2tp 
2
default via 10.10.1.1 dev l2tp-l2tp2 
3
default via 192.168.0.1 dev wlan2

Firewall default output policy (must be ACCEPT) : 

ACCEPT

Output of &quot;iptables -L -t mangle -v -n&quot; : 

Chain PREROUTING (policy ACCEPT 12610 packets, 6277K bytes)
 pkts bytes target     prot opt in     out     source               destination         
 106M   92G mwan3_hook  all  --  *      *       0.0.0.0/0            0.0.0.0/0           
12610 6277K fwmark     all  --  *      *       0.0.0.0/0            0.0.0.0/0           

Chain INPUT (policy ACCEPT 7567 packets, 4184K bytes)
 pkts bytes target     prot opt in     out     source               destination         

Chain FORWARD (policy ACCEPT 5030 packets, 2092K bytes)
 pkts bytes target     prot opt in     out     source               destination         
 5030 2092K mssfix     all  --  *      *       0.0.0.0/0            0.0.0.0/0           

Chain OUTPUT (policy ACCEPT 5562 packets, 1109K bytes)
 pkts bytes target     prot opt in     out     source               destination         
  31M   16G mwan3_hook  all  --  *      *       0.0.0.0/0            0.0.0.0/0           

Chain POSTROUTING (policy ACCEPT 10556 packets, 3199K bytes)
 pkts bytes target     prot opt in     out     source               destination         

Chain fwmark (1 references)
 pkts bytes target     prot opt in     out     source               destination         

Chain mssfix (1 references)
 pkts bytes target     prot opt in     out     source               destination         
    0     0 TCPMSS     tcp  --  *      eth0.2  0.0.0.0/0            0.0.0.0/0            tcp flags:0x06/0x02 /* wan (mtu_fix) */ TCPMSS clamp to PMTU
   20   880 TCPMSS     tcp  --  *      wlan2   0.0.0.0/0            0.0.0.0/0            tcp flags:0x06/0x02 /* wan (mtu_fix) */ TCPMSS clamp to PMTU
   18   792 TCPMSS     tcp  --  *      l2tp-l2tp  0.0.0.0/0            0.0.0.0/0            tcp flags:0x06/0x02 /* l2tp (mtu_fix) */ TCPMSS clamp to PMTU
  249 12488 TCPMSS     tcp  --  *      l2tp-l2tp2  0.0.0.0/0            0.0.0.0/0            tcp flags:0x06/0x02 /* l2tp2 (mtu_fix) */ TCPMSS clamp to PMTU

Chain mwan3_connected (2 references)
 pkts bytes target     prot opt in     out     source               destination         
 105M   92G MARK       all  --  *      *       0.0.0.0/0            0.0.0.0/0            match-set mwan3_connected dst MARK or 0xff00

Chain mwan3_hook (2 references)
 pkts bytes target     prot opt in     out     source               destination         
 137M  108G CONNMARK   all  --  *      *       0.0.0.0/0            0.0.0.0/0            CONNMARK restore mask 0xff00
 754K   76M mwan3_ifaces_in  all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00
 703K   62M mwan3_ifaces_out  all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00
 699K   60M mwan3_connected  all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00
 469K   44M mwan3_rules  all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00
 137M  108G CONNMARK   all  --  *      *       0.0.0.0/0            0.0.0.0/0            CONNMARK save mask 0xff00
 134M  107G mwan3_connected  all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match ! 0xff00/0xff00

Chain mwan3_iface_in_l2tp (1 references)
 pkts bytes target     prot opt in     out     source               destination         
    0     0 MARK       all  --  l2tp-l2tp *       0.0.0.0/0            0.0.0.0/0            match-set mwan3_connected src mark match 0x0/0xff00 /* default */ MARK or 0xff00
   30  2850 MARK       all  --  l2tp-l2tp *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00 /* l2tp */ MARK xset 0x100/0xff00

Chain mwan3_iface_in_l2tp2 (1 references)
 pkts bytes target     prot opt in     out     source               destination         
    0     0 MARK       all  --  l2tp-l2tp2 *       0.0.0.0/0            0.0.0.0/0            match-set mwan3_connected src mark match 0x0/0xff00 /* default */ MARK or 0xff00
    0     0 MARK       all  --  l2tp-l2tp2 *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00 /* l2tp2 */ MARK xset 0x200/0xff00

Chain mwan3_iface_in_wwan (1 references)
 pkts bytes target     prot opt in     out     source               destination         
    7   941 MARK       all  --  wlan2  *       0.0.0.0/0            0.0.0.0/0            match-set mwan3_connected src mark match 0x0/0xff00 /* default */ MARK or 0xff00
    4   144 MARK       all  --  wlan2  *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00 /* wwan */ MARK xset 0x300/0xff00

Chain mwan3_iface_out_l2tp (1 references)
 pkts bytes target     prot opt in     out     source               destination         
    2   672 MARK       all  --  *      *       10.10.1.6            0.0.0.0/0            mark match 0x0/0xff00 /* l2tp */ MARK xset 0x100/0xff00

Chain mwan3_iface_out_l2tp2 (1 references)
 pkts bytes target     prot opt in     out     source               destination         
    0     0 MARK       all  --  *      *       10.10.1.5            0.0.0.0/0            mark match 0x0/0xff00 /* l2tp2 */ MARK xset 0x200/0xff00

Chain mwan3_iface_out_wwan (1 references)
 pkts bytes target     prot opt in     out     source               destination         
    2   264 MARK       all  --  *      *       192.168.0.42         0.0.0.0/0            mark match 0x0/0xff00 /* wwan */ MARK xset 0x300/0xff00

Chain mwan3_ifaces_in (1 references)
 pkts bytes target     prot opt in     out     source               destination         
 5427  314K mwan3_iface_in_wwan  all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00
 5387  310K mwan3_iface_in_l2tp  all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00
 3354  185K mwan3_iface_in_l2tp2  all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00

Chain mwan3_ifaces_out (1 references)
 pkts bytes target     prot opt in     out     source               destination         
 5386  310K mwan3_iface_out_wwan  all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00
 5357  307K mwan3_iface_out_l2tp  all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00
 3354  185K mwan3_iface_out_l2tp2  all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00

Chain mwan3_policy_l2tp2_only (5 references)
 pkts bytes target     prot opt in     out     source               destination         
 2739  144K MARK       all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00 /* l2tp2 1 1 */ MARK xset 0x200/0xff00

Chain mwan3_policy_l2tp_only (3 references)
 pkts bytes target     prot opt in     out     source               destination         
   48  2112 MARK       all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00 /* l2tp 1 1 */ MARK xset 0x100/0xff00

Chain mwan3_policy_wwan_only (2 references)
 pkts bytes target     prot opt in     out     source               destination         
    0     0 MARK       all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00 /* wwan 1 1 */ MARK xset 0x300/0xff00

Chain mwan3_rules (1 references)
 pkts bytes target     prot opt in     out     source               destination         
    0     0 mwan3_policy_l2tp_only  all  --  *      *       192.168.4.0/24       0.0.0.0/0            mark match 0x0/0xff00 /* lan */
   48  2112 mwan3_policy_l2tp_only  all  --  *      *       192.168.5.0/24       0.0.0.0/0            mark match 0x0/0xff00 /* wlan0_1 */
    0     0 mwan3_policy_wwan_only  all  --  *      *       192.168.6.0/24       0.0.0.0/0            mark match 0x0/0xff00 /* wlan0_2 */
 2709  142K mwan3_policy_l2tp2_only  all  --  *      *       192.168.7.0/24       0.0.0.0/0            mark match 0x0/0xff00 /* wlan0_3 */
   30  1320 mwan3_policy_l2tp2_only  all  --  *      *       192.168.8.0/24       0.0.0.0/0            mark match 0x0/0xff00 /* wlan0_4 */
    0     0 mwan3_policy_l2tp_only  all  --  *      *       192.168.10.0/24      0.0.0.0/0            mark match 0x0/0xff00 /* wlan1_1 */
    0     0 mwan3_policy_wwan_only  all  --  *      *       192.168.11.0/24      0.0.0.0/0            mark match 0x0/0xff00 /* wlan1_2 */
    0     0 mwan3_policy_l2tp2_only  all  --  *      *       192.168.12.0/24      0.0.0.0/0            mark match 0x0/0xff00 /* wlan1_3 */
    0     0 mwan3_policy_l2tp2_only  all  --  *      *       192.168.13.0/24      0.0.0.0/0            mark match 0x0/0xff00 /* wlan1_4 */
    0     0 mwan3_policy_l2tp2_only  all  --  *      *       192.168.14.0/24      0.0.0.0/0            mark match 0x0/0xff00 /* wlan2_1 */</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p305994">
				<div class="post-metadata">
					<div class="post-num">Post #1505</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						3 Jan 2016, 11:29					</div>
				</div>
				<div class="post-content content">
					<p>Hi anarchy99,</p><br /><p>I looked at the data and looks ok to me. But to be sure please upgrade to version 2.0-2, because the 2.0-0 version you are using contains a bug which might affect you</p><p> Also: (from the wiki)</p><p>On routers with just one wan interface (and one default route), there is no issue on which source address to use for new initiated sessions. But with two or more wan interfaces you may wish to have control over this. Up until version 2.0, mwan3 did not respect the already set source address of router originated packets. Packets were load-balanced regardless of source address, based on configured user rules.</p><p>As of version 2.0 mwan3 does respect the already set source address. The advantage of this is that an applications can have control over which wan interface to use. The downside of this is that when an application does not specify which source address to use (most of the time) the kernel will pick a source address based on the routing table. In practice this means the default route with the lowest metric is used to determine which source address to use. So if you don&#039;t configure a routable loopback address with corresponding more preferred default route, all traffic originating from the router itself will leave the primary wan with the source address of that wan interface, regardless of configured user mwan3 rules.</p><p>More info: <a href="https://wiki.openwrt.org/doc/howto/mwan3#the_routable_loopback_self">https://wiki.openwrt.org/doc/howto/mwan … pback_self</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p306055">
				<div class="post-metadata">
					<div class="post-num">Post #1506</div>
					<div class="post-author">anarchy99</div>
					<div class="post-datetime">
						3 Jan 2016, 18:50					</div>
				</div>
				<div class="post-content content">
					<p>this part is an issue:</p><div class="codebox"><pre><code>1.2.3.4         10.10.1.1       255.255.255.255 UGH   10     0        0 l2tp-l2tp
1.2.3.4         192.168.0.1     255.255.255.255 UGH   30     0        0 wlan2
1.2.2.3         192.168.0.1     255.255.255.255 UGH   30     0        0 wlan2</code></pre></div><p>should only have:</p><div class="codebox"><pre><code>1.2.3.4         192.168.0.1     255.255.255.255 UGH   30     0        0 wlan2
1.2.2.3         192.168.0.1     255.255.255.255 UGH   30     0        0 wlan2</code></pre></div><p>tried setting the metric of main wan interface to lowest and then ppp sessions are established through main wan interface regardless of the ppp interfaces reconnections, however routing table still shows:</p><div class="codebox"><pre><code>1.2.3.4         10.10.1.1       255.255.255.255 UGH   10     0        0 l2tp-l2tp
1.2.3.4         192.168.0.1     255.255.255.255 UGH   30     0        0 wlan2
1.2.2.3         192.168.0.1     255.255.255.255 UGH   30     0        0 wlan2</code></pre></div><p>with disadvantage if one ppp connection is stopped, another one breaks too and reconnects. i haven&#039;t got chance yet to update mwan3 to 2.0-2 because i&#039;m currently testing router stability but i&#039;ll update here once i do.</p><p>btw do you think this could be fixed with adding static routes in case there&#039;s something wrong with netifd?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p306194">
				<div class="post-metadata">
					<div class="post-num">Post #1507</div>
					<div class="post-author">bobptz</div>
					<div class="post-datetime">
						4 Jan 2016, 18:43					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>arfett wrote:</cite><blockquote><div class="quotebox"><cite>bobptz wrote:</cite><blockquote><p>Is there a way to test what traffic goes to what wan interface?&nbsp; It would simplify my troubleshooting.</p></blockquote></div><p>Install tcpdump package on your router.</p></blockquote></div><p>Would you know where I can find the <strong>network interface</strong> in wireshark?</p><p>The main column fields do not show the network interface.&nbsp; After I expand the FRAME field, the first line that appears reads:&nbsp; INTERFACE ID.&nbsp; Is this what I am looking for?&nbsp; </p><p>If this is the one, then how would I interpret &quot;Interface Id: 0&quot;?&nbsp; Would this be wan or wan2 ?</p>											<p class="post-edited">(Last edited by <strong>bobptz</strong> on 4 Jan 2016, 18:44)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p306310">
				<div class="post-metadata">
					<div class="post-num">Post #1508</div>
					<div class="post-author">muronghan</div>
					<div class="post-datetime">
						5 Jan 2016, 16:08					</div>
				</div>
				<div class="post-content content">
					<p>Hi, Adze, mwan3 could work with Shadowsocks here, if I did not add any new ipset (this should be the reason of the issue). Some people here may improve in this thread. However currently I am happy with the status.</p>											<p class="post-edited">(Last edited by <strong>muronghan</strong> on 5 Jan 2016, 16:08)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p306850">
				<div class="post-metadata">
					<div class="post-num">Post #1509</div>
					<div class="post-author">evgeny.magata</div>
					<div class="post-datetime">
						9 Jan 2016, 16:07					</div>
				</div>
				<div class="post-content content">
					<p>Hi People,</p><p>i am totally unexperienced with source routing and the sort so i&#039;ll explain my goal and wish to ask if, and how, this is possible to achieve with mwan3.</p><p>I have a cable modem which connects to a TP-Link wr1043nd v1.2 as the router, running OpenWRT Chaos Calmer Stable 15.05.</p><p>Behind that &quot;gateway&quot; setup is a GBit switch and connected to that is the rest of my devices, i.e. an Archer C5 running stock Firmware handling wifi and a NAS which is my media server, but also runs transmission BT client. I&#039;d like to have the NAS available on the local network, but redirect all outgoing traffic through a permanent VPN connection. The VPN Connection is set-up correctly on the 1043nd. if i start the device, it correctly creates a tun0 device and establishes the VPN connection. The routing table looks like this: </p><div class="codebox"><pre><code>default         10.114.0.1      128.0.0.0       UG    0      0        0 tun0
default         100.74.191.254  0.0.0.0         UG    10     0        0 eth0.2
10.114.0.0      *               255.255.0.0     U     0      0        0 tun0
46.165.228.118  100.74.191.254  255.255.255.255 UGH   0      0        0 eth0.2
100.74.128.0    *               255.255.192.0   U     10     0        0 eth0.2
100.74.191.254  *               255.255.255.255 UH    10     0        0 eth0.2
128.0.0.0       10.114.0.1      128.0.0.0       UG    0      0        0 tun0
192.168.1.0     *               255.255.255.0   U     0      0        0 br-lan
 </code></pre></div><p>The first problem i am trying to solve (maybe already the solution to the bigger problem) is the missing metric for the VPN connection. It is not pushed by the VPN provider and i cannot figure out if i can add a metric for tun0 via LuCi or if i manually have to edit the VPN config? The trick seems to be adding a &quot;metric&quot; parameter to the openVPN setup but there doesnt seem to be this setting in the OpenVPN LuCi Config, so do i have to add it manually to the config or how can i set a metric for tun0?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p307515">
				<div class="post-metadata">
					<div class="post-num">Post #1510</div>
					<div class="post-author">dionisis</div>
					<div class="post-datetime">
						13 Jan 2016, 18:19					</div>
				</div>
				<div class="post-content content">
					<p>hello,<br />I&#039;m using mwan3 for a few months now with 3 wan connections. <br />When I firstly used mwan3 I had an issue with the 3 wan connections which, after many configuration tests, I fixed it. But now I&#039;m having the same issue when I tried to add a 4th wan.</p><p>The issue is on the balanced policy, at first, if the wan2 and the wan3 members had the same weight value, the traffic wasn&#039;t balancing between those two interfaces.<br />All the traffic was balancing between wan and, randomly chosen, wan2 or wan3. I&nbsp; never had balanced traffic between wan2 and wan3.<br />After many tests I realized that using different weight values on wan2 and wan3 members the balancing was working great.<br />There is no problem if wan2 or wan3 have the same weight with wan. The wan2 must not have the same weight with wan3.</p><p>Some days ago I decided&nbsp; to add a 4th wan connection, wan4. <br />Now I&#039;m having the same issue with wan4 and wan2 and I can&#039;t&nbsp; fix it. I have used different weight values on all interfaces members for balanced policy, but the traffic is not balancing between wan2 and wan4.<br />All the balanced traffic goes through wan-wan3-wan2 or wan-wan3-wan4 </p><p>Any ideas how to fix this now?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p307517">
				<div class="post-metadata">
					<div class="post-num">Post #1511</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						13 Jan 2016, 18:31					</div>
				</div>
				<div class="post-content content">
					<p>Hi dionisis,</p><p>Could you paste your config please and also the output of &quot;mwan3 status&quot;?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p307519">
				<div class="post-metadata">
					<div class="post-num">Post #1512</div>
					<div class="post-author">dionisis</div>
					<div class="post-datetime">
						13 Jan 2016, 18:42					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><p>Hi dionisis,</p><p>Could you paste your config please and also the output of &quot;mwan3 status&quot;?</p></blockquote></div><br /><div class="codebox"><pre><code>Software versions : 

OpenWrt - OpenWrt Chaos Calmer 15.05
LuCI - git-15.248.30277-3836b45

mwan3 - 1.6-2
mwan3-luci - 1.4-3

Output of &quot;cat /etc/config/mwan3&quot; : 

config member &#039;wan_m1_w3&#039;
    option interface &#039;wan&#039;
    option metric &#039;1&#039;
    option weight &#039;10&#039;

config member &#039;wan2_m1_w2&#039;
    option interface &#039;wan2&#039;
    option metric &#039;1&#039;
    option weight &#039;11&#039;

config member &#039;wan3_m1_w4&#039;
    option interface &#039;wan3&#039;
    option metric &#039;1&#039;
    option weight &#039;9&#039;

config member &#039;wan4_m1_w8&#039;
    option interface &#039;wan4&#039;
    option metric &#039;1&#039;
    option weight &#039;7&#039;

config member &#039;wan_m2_w3&#039;
    option interface &#039;wan&#039;
    option metric &#039;2&#039;
    option weight &#039;3&#039;

config member &#039;wan2_m2_w2&#039;
    option interface &#039;wan2&#039;
    option metric &#039;2&#039;
    option weight &#039;3&#039;

config member &#039;wan3_m2_w4&#039;
    option interface &#039;wan3&#039;
    option metric &#039;2&#039;
    option weight &#039;3&#039;

config member &#039;wan4_m2_w8&#039;
    option interface &#039;wan4&#039;
    option metric &#039;2&#039;
    option weight &#039;8&#039;

config rule &#039;sticky_even&#039;
    option src_ip &#039;0.0.0.0/0.0.0.1&#039;
    option dest_port &#039;443&#039;
    option proto &#039;tcp&#039;
    option use_policy &#039;balanced&#039;

config rule &#039;sticky_odd&#039;
    option src_ip &#039;0.0.0.1/0.0.0.1&#039;
    option dest_port &#039;443&#039;
    option proto &#039;tcp&#039;
    option use_policy &#039;balanced&#039;

config rule &#039;forthnetproxy&#039;
    option src_ip &#039;192.168.1.0/24&#039;
    option dest_ip &#039;proxy.forthnet.gr&#039;
    option proto &#039;all&#039;
    option use_policy &#039;wan_only&#039;

config rule &#039;greekespresso&#039;
    option proto &#039;all&#039;
    option use_policy &#039;wan_wan2&#039;
    option dest_ip &#039;www.greekespresso.gr&#039;

config rule &#039;easybytez&#039;
    option dest_ip &#039;www.easybytez.com&#039;
    option proto &#039;all&#039;
    option use_policy &#039;wan_wan2&#039;

config rule &#039;default_rule&#039;
    option dest_ip &#039;0.0.0.0/0&#039;
    option use_policy &#039;balanced&#039;

config policy &#039;balanced&#039;
    option last_resort &#039;unreachable&#039;
    list use_member &#039;wan_m1_w3&#039;
    list use_member &#039;wan2_m1_w2&#039;
    list use_member &#039;wan3_m1_w4&#039;
    list use_member &#039;wan4_m1_w8&#039;

config policy &#039;wan_only&#039;
    list use_member &#039;wan_m1_w3&#039;

config policy &#039;wan2_only&#039;
    list use_member &#039;wan2_m1_w2&#039;

config policy &#039;wan3_only&#039;
    list use_member &#039;wan3_m1_w4&#039;
    option last_resort &#039;unreachable&#039;

config policy &#039;wan_wan2&#039;
    list use_member &#039;wan_m1_w3&#039;
    list use_member &#039;wan2_m2_w2&#039;

config policy &#039;wan2_wan&#039;
    list use_member &#039;wan_m2_w3&#039;
    list use_member &#039;wan2_m1_w2&#039;

config interface &#039;wan&#039;
    option enabled &#039;1&#039;
    option count &#039;1&#039;
    option timeout &#039;2&#039;
    option interval &#039;5&#039;
    option down &#039;3&#039;
    list track_ip &#039;193.92.3.11&#039;
    list track_ip &#039;194.177.210.10&#039;
    list track_ip &#039;193.92.150.2&#039;
    list track_ip &#039;194.177.210.211&#039;
    option up &#039;1&#039;
    option reliability &#039;1&#039;

config interface &#039;wan2&#039;
    option reliability &#039;1&#039;
    option count &#039;1&#039;
    option timeout &#039;2&#039;
    option interval &#039;5&#039;
    option down &#039;3&#039;
    option enabled &#039;1&#039;
    list track_ip &#039;194.177.210.10&#039;
    list track_ip &#039;194.177.210.211&#039;
    list track_ip &#039;8.8.8.8&#039;
    option up &#039;1&#039;

config interface &#039;wan3&#039;
    option reliability &#039;1&#039;
    option count &#039;1&#039;
    option timeout &#039;2&#039;
    option interval &#039;5&#039;
    option down &#039;3&#039;
    option enabled &#039;1&#039;
    list track_ip &#039;194.30.220.117&#039;
    list track_ip &#039;194.177.210.10&#039;
    list track_ip &#039;8.8.8.8&#039;
    option up &#039;1&#039;

config interface &#039;wan4&#039;
    option reliability &#039;1&#039;
    option count &#039;1&#039;
    option timeout &#039;2&#039;
    option interval &#039;5&#039;
    option down &#039;3&#039;
    option up &#039;1&#039;
    option enabled &#039;1&#039;
    list track_ip &#039;8.8.8.8&#039;
    list track_ip &#039;194.177.210.211&#039;
    list track_ip &#039;194.177.210.10&#039;

config policy &#039;wan4_only&#039;
    list use_member &#039;wan4_m1_w8&#039;
    option last_resort &#039;unreachable&#039;

Output of &quot;cat /etc/config/network&quot; : 

config interface &#039;loopback&#039;
    option ifname &#039;lo&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;127.0.0.1&#039;
    option netmask &#039;255.0.0.0&#039;

config globals &#039;globals&#039;
    option ula_prefix &#039;fdfd:762b:5ca4::/48&#039;

config interface &#039;lan&#039;
    option force_link &#039;1&#039;
    option type &#039;bridge&#039;
    option proto &#039;static&#039;
    option netmask &#039;255.255.255.0&#039;
    option ip6assign &#039;60&#039;
    option ipaddr &#039;192.168.1.5&#039;
    option broadcast &#039;255.255.255.255&#039;
    option _orig_ifname &#039;eth1 wlan0-1&#039;
    option _orig_bridge &#039;true&#039;
    option ifname &#039;eth1&#039;

config interface &#039;wan&#039;
    option _orig_ifname &#039;eth0&#039;
    option _orig_bridge &#039;true&#039;
    option proto &#039;static&#039;
    option netmask &#039;255.255.255.0&#039;
    option ipaddr &#039;10.0.0.2&#039;
    option ip6assign &#039;64&#039;
    option ifname &#039;eth0.2&#039;
    option gateway &#039;10.0.0.138&#039;
    option metric &#039;10&#039;
    option dns &#039;194.177.210.10 194.177.210.211&#039;

config switch
    option name &#039;switch0&#039;
    option reset &#039;1&#039;
    option enable_vlan &#039;1&#039;

config switch_vlan
    option device &#039;switch0&#039;
    option vlan &#039;1&#039;
    option vid &#039;1&#039;
    option ports &#039;0 4&#039;

config switch_vlan
    option device &#039;switch0&#039;
    option vlan &#039;2&#039;
    option vid &#039;2&#039;
    option ports &#039;5 6t&#039;

config switch_vlan
    option device &#039;switch0&#039;
    option vlan &#039;3&#039;
    option vid &#039;3&#039;
    option ports &#039;1 6t&#039;

config interface &#039;wan2&#039;
    option proto &#039;static&#039;
    option ifname &#039;eth0.3&#039;
    option ipaddr &#039;192.168.10.88&#039;
    option netmask &#039;255.255.255.0&#039;
    option gateway &#039;192.168.10.254&#039;
    option metric &#039;20&#039;
    option dns &#039;194.177.210.10 194.177.210.211&#039;

config switch_vlan
    option device &#039;switch0&#039;
    option vlan &#039;4&#039;
    option vid &#039;4&#039;
    option ports &#039;2 6t&#039;

config interface &#039;wan3&#039;
    option proto &#039;static&#039;
    option ifname &#039;eth0.4&#039;
    option ipaddr &#039;192.168.2.99&#039;
    option netmask &#039;255.255.255.0&#039;
    option gateway &#039;192.168.2.1&#039;
    option metric &#039;30&#039;
    option dns &#039;194.177.210.10 194.177.210.211&#039;

config switch_vlan
    option device &#039;switch0&#039;
    option vlan &#039;5&#039;
    option vid &#039;5&#039;
    option ports &#039;3 6t&#039;

config interface &#039;wan4&#039;
    option proto &#039;static&#039;
    option ifname &#039;eth0.5&#039;
    option ipaddr &#039;10.0.1.3&#039;
    option netmask &#039;255.255.255.0&#039;
    option gateway &#039;10.0.1.1&#039;
    option metric &#039;40&#039;
    option dns &#039;194.177.210.10 194.177.210.211&#039;

Output of &quot;ifconfig&quot; : 

br-lan    Link encap:Ethernet  HWaddr C4:6E:1F:6B:BE:F0  
          inet addr:192.168.1.5  Bcast:255.255.255.255  Mask:255.255.255.0
          inet6 addr: fe80::c66e:1fff:fe6b:bef0/64 Scope:Link
          inet6 addr: fdfd:762b:5ca4:10::1/60 Scope:Global
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:35460195 errors:0 dropped:4639 overruns:0 frame:0
          TX packets:51651985 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:2948819072 (2.7 GiB)  TX bytes:71363104278 (66.4 GiB)

eth0      Link encap:Ethernet  HWaddr C4:6E:1F:6B:BE:F1  
          inet6 addr: fe80::c66e:1fff:fe6b:bef1/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:54546320 errors:0 dropped:0 overruns:0 frame:0
          TX packets:36880601 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:3048173335 (2.8 GiB)  TX bytes:3546354728 (3.3 GiB)
          Interrupt:4 

eth0.2    Link encap:Ethernet  HWaddr C4:6E:1F:6B:BE:F1  
          inet addr:10.0.0.2  Bcast:10.0.0.255  Mask:255.255.255.0
          inet6 addr: fe80::c66e:1fff:fe6b:bef1/64 Scope:Link
          inet6 addr: fdfd:762b:5ca4::1/64 Scope:Global
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:20846930 errors:0 dropped:0 overruns:0 frame:0
          TX packets:14465654 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:26168043300 (24.3 GiB)  TX bytes:1483864140 (1.3 GiB)

eth0.3    Link encap:Ethernet  HWaddr C4:6E:1F:6B:BE:F1  
          inet addr:192.168.10.88  Bcast:192.168.10.255  Mask:255.255.255.0
          inet6 addr: fe80::c66e:1fff:fe6b:bef1/64 Scope:Link
          inet6 addr: fdfd:762b:5ca4:1::1/64 Scope:Global
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:23824164 errors:0 dropped:0 overruns:0 frame:0
          TX packets:15934904 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:30417813737 (28.3 GiB)  TX bytes:1527879334 (1.4 GiB)

eth0.4    Link encap:Ethernet  HWaddr C4:6E:1F:6B:BE:F1  
          inet addr:192.168.2.99  Bcast:192.168.2.255  Mask:255.255.255.0
          inet6 addr: fe80::c66e:1fff:fe6b:bef1/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:9309656 errors:0 dropped:0 overruns:0 frame:0
          TX packets:6138134 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:13456264377 (12.5 GiB)  TX bytes:362028735 (345.2 MiB)

eth0.5    Link encap:Ethernet  HWaddr C4:6E:1F:6B:BE:F1  
          inet addr:10.0.1.3  Bcast:10.0.1.255  Mask:255.255.255.0
          inet6 addr: fe80::c66e:1fff:fe6b:bef1/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:565570 errors:0 dropped:0 overruns:0 frame:0
          TX packets:341901 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:743694897 (709.2 MiB)  TX bytes:25059259 (23.8 MiB)

eth1      Link encap:Ethernet  HWaddr C4:6E:1F:6B:BE:F0  
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:36249688 errors:0 dropped:197 overruns:0 frame:0
          TX packets:51048640 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:2272472132 (2.1 GiB)  TX bytes:3885241948 (3.6 GiB)
          Interrupt:5 

lo        Link encap:Local Loopback  
          inet addr:127.0.0.1  Mask:255.0.0.0
          inet6 addr: ::1/128 Scope:Host
          UP LOOPBACK RUNNING  MTU:65536  Metric:1
          RX packets:279157 errors:0 dropped:0 overruns:0 frame:0
          TX packets:279157 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:16845508 (16.0 MiB)  TX bytes:16845508 (16.0 MiB)

wlan0     Link encap:Ethernet  HWaddr C4:6E:1F:6B:BE:F0  
          inet6 addr: fe80::c66e:1fff:fe6b:bef0/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:3365474 errors:0 dropped:0 overruns:0 frame:0
          TX packets:5409041 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:323930157 (308.9 MiB)  TX bytes:2344194289 (2.1 GiB)

Output of &quot;route -n&quot; : 

Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
0.0.0.0         10.0.0.138      0.0.0.0         UG    10     0        0 eth0.2
0.0.0.0         192.168.10.254  0.0.0.0         UG    20     0        0 eth0.3
0.0.0.0         192.168.2.1     0.0.0.0         UG    30     0        0 eth0.4
0.0.0.0         10.0.1.1        0.0.0.0         UG    40     0        0 eth0.5
10.0.0.0        0.0.0.0         255.255.255.0   U     10     0        0 eth0.2
10.0.1.0        0.0.0.0         255.255.255.0   U     40     0        0 eth0.5
192.168.1.0     0.0.0.0         255.255.255.0   U     0      0        0 br-lan
192.168.2.0     0.0.0.0         255.255.255.0   U     30     0        0 eth0.4
192.168.10.0    0.0.0.0         255.255.255.0   U     20     0        0 eth0.3

Output of &quot;ip rule show&quot; : 

0:    from all lookup 128 
1:    from all lookup local 
1001:    from all iif eth0.2 lookup main 
1002:    from all iif eth0.3 lookup main 
1003:    from all iif eth0.4 lookup main 
1004:    from all iif eth0.5 lookup main 
2001:    from all fwmark 0x100/0xff00 lookup 1 
2002:    from all fwmark 0x200/0xff00 lookup 2 
2003:    from all fwmark 0x300/0xff00 lookup 3 
2004:    from all fwmark 0x400/0xff00 lookup 4 
2253:    from all fwmark 0xfd00/0xff00 blackhole
2254:    from all fwmark 0xfe00/0xff00 unreachable
32766:    from all lookup main 
32767:    from all lookup default

Output of &quot;ip route list table 1-250&quot; : 

1
default via 10.0.0.138 dev eth0.2 
2
default via 192.168.10.254 dev eth0.3 
3
default via 192.168.2.1 dev eth0.4 
4
default via 10.0.1.1 dev eth0.5

Firewall default output policy (must be ACCEPT) : 

ACCEPT

Output of &quot;iptables -L -t mangle -v -n&quot; : 

Chain PREROUTING (policy ACCEPT 2570 packets, 689K bytes)
 pkts bytes target     prot opt in     out     source               destination         
 314K  242M mwan3_hook  all  --  *      *       0.0.0.0/0            0.0.0.0/0           
 2570  689K fwmark     all  --  *      *       0.0.0.0/0            0.0.0.0/0           

Chain INPUT (policy ACCEPT 1450 packets, 93766 bytes)
 pkts bytes target     prot opt in     out     source               destination         

Chain FORWARD (policy ACCEPT 976 packets, 579K bytes)
 pkts bytes target     prot opt in     out     source               destination         
  976  579K mssfix     all  --  *      *       0.0.0.0/0            0.0.0.0/0           

Chain OUTPUT (policy ACCEPT 1523 packets, 362K bytes)
 pkts bytes target     prot opt in     out     source               destination         
20817 2886K mwan3_hook  all  --  *      *       0.0.0.0/0            0.0.0.0/0           

Chain POSTROUTING (policy ACCEPT 2501 packets, 942K bytes)
 pkts bytes target     prot opt in     out     source               destination         

Chain fwmark (1 references)
 pkts bytes target     prot opt in     out     source               destination         

Chain mssfix (1 references)
 pkts bytes target     prot opt in     out     source               destination         
    2    96 TCPMSS     tcp  --  *      eth0.2  0.0.0.0/0            0.0.0.0/0            tcp flags:0x06/0x02 /* wan (mtu_fix) */ TCPMSS clamp to PMTU
    7   336 TCPMSS     tcp  --  *      eth0.3  0.0.0.0/0            0.0.0.0/0            tcp flags:0x06/0x02 /* wan2 (mtu_fix) */ TCPMSS clamp to PMTU
    3   144 TCPMSS     tcp  --  *      eth0.4  0.0.0.0/0            0.0.0.0/0            tcp flags:0x06/0x02 /* wan3 (mtu_fix) */ TCPMSS clamp to PMTU
    1    48 TCPMSS     tcp  --  *      eth0.5  0.0.0.0/0            0.0.0.0/0            tcp flags:0x06/0x02 /* wan4 (mtu_fix) */ TCPMSS clamp to PMTU

Chain mwan3_connected (2 references)
 pkts bytes target     prot opt in     out     source               destination         
 174K  233M MARK       all  --  *      *       0.0.0.0/0            0.0.0.0/0            match-set mwan3_connected dst MARK or 0xff00

Chain mwan3_hook (2 references)
 pkts bytes target     prot opt in     out     source               destination         
 334K  245M CONNMARK   all  --  *      *       0.0.0.0/0            0.0.0.0/0            CONNMARK restore mask 0xff00
16664  697K mwan3_ifaces  all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00
16013  640K mwan3_connected  all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00
14054  524K mwan3_track  all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00
 1716  130K mwan3_rules  all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00
 334K  245M CONNMARK   all  --  *      *       0.0.0.0/0            0.0.0.0/0            CONNMARK save mask 0xff00
 296K  241M mwan3_connected  all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match ! 0xff00/0xff00

Chain mwan3_iface_wan (1 references)
 pkts bytes target     prot opt in     out     source               destination         
    9  2130 MARK       all  --  eth0.2 *       0.0.0.0/0            0.0.0.0/0            match-set mwan3_connected src mark match 0x0/0xff00 /* default */ MARK or 0xff00
   31  2688 MARK       all  --  eth0.2 *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00 /* wan */ MARK xset 0x100/0xff00

Chain mwan3_iface_wan2 (1 references)
 pkts bytes target     prot opt in     out     source               destination         
  334 18466 MARK       all  --  eth0.3 *       0.0.0.0/0            0.0.0.0/0            match-set mwan3_connected src mark match 0x0/0xff00 /* default */ MARK or 0xff00
   26  5621 MARK       all  --  eth0.3 *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00 /* wan2 */ MARK xset 0x200/0xff00

Chain mwan3_iface_wan3 (1 references)
 pkts bytes target     prot opt in     out     source               destination         
   66 12551 MARK       all  --  eth0.4 *       0.0.0.0/0            0.0.0.0/0            match-set mwan3_connected src mark match 0x0/0xff00 /* default */ MARK or 0xff00
    0     0 MARK       all  --  eth0.4 *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00 /* wan3 */ MARK xset 0x300/0xff00

Chain mwan3_iface_wan4 (1 references)
 pkts bytes target     prot opt in     out     source               destination         
  172 15229 MARK       all  --  eth0.5 *       0.0.0.0/0            0.0.0.0/0            match-set mwan3_connected src mark match 0x0/0xff00 /* default */ MARK or 0xff00
   13   845 MARK       all  --  eth0.5 *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00 /* wan4 */ MARK xset 0x400/0xff00

Chain mwan3_ifaces (1 references)
 pkts bytes target     prot opt in     out     source               destination         
16664  697K mwan3_iface_wan  all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00
16601  690K mwan3_iface_wan2  all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00
16223  665K mwan3_iface_wan4  all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00
  974 45255 mwan3_iface_wan3  all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00

Chain mwan3_policy_balanced (3 references)
 pkts bytes target     prot opt in     out     source               destination         
    7   446 MARK       all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00 statistic mode random probability 0.18899999978 /* wan4 7 37 */ MARK xset 0x400/0xff00
    8   457 MARK       all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00 statistic mode random probability 0.29999999981 /* wan3 9 30 */ MARK xset 0x300/0xff00
   15   876 MARK       all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00 statistic mode random probability 0.52300000004 /* wan2 11 21 */ MARK xset 0x200/0xff00
   11   700 MARK       all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00 /* wan 10 10 */ MARK xset 0x100/0xff00

Chain mwan3_policy_wan2_only (0 references)
 pkts bytes target     prot opt in     out     source               destination         
    0     0 MARK       all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00 /* wan2 11 11 */ MARK xset 0x200/0xff00

Chain mwan3_policy_wan2_wan (0 references)
 pkts bytes target     prot opt in     out     source               destination         
    0     0 MARK       all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00 /* wan2 11 11 */ MARK xset 0x200/0xff00

Chain mwan3_policy_wan3_only (0 references)
 pkts bytes target     prot opt in     out     source               destination         
    0     0 MARK       all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00 /* wan3 9 9 */ MARK xset 0x300/0xff00

Chain mwan3_policy_wan4_only (0 references)
 pkts bytes target     prot opt in     out     source               destination         
    0     0 MARK       all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00 /* wan4 7 7 */ MARK xset 0x400/0xff00

Chain mwan3_policy_wan_only (1 references)
 pkts bytes target     prot opt in     out     source               destination         
    0     0 MARK       all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00 /* wan 10 10 */ MARK xset 0x100/0xff00

Chain mwan3_policy_wan_wan2 (2 references)
 pkts bytes target     prot opt in     out     source               destination         
    0     0 MARK       all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00 /* wan 10 10 */ MARK xset 0x100/0xff00

Chain mwan3_rules (1 references)
 pkts bytes target     prot opt in     out     source               destination         
    0     0 mwan3_policy_balanced  tcp  --  *      *       0.0.0.0/0.0.0.1      0.0.0.0/0            multiport sports 0:65535 multiport dports 443 mark match 0x0/0xff00 /* sticky_even */
    6   288 mwan3_policy_balanced  tcp  --  *      *       0.0.0.1/0.0.0.1      0.0.0.0/0            multiport sports 0:65535 multiport dports 443 mark match 0x0/0xff00 /* sticky_odd */
    0     0 mwan3_policy_wan_only  all  --  *      *       192.168.1.0/24       193.92.150.71        mark match 0x0/0xff00 /* forthnetproxy */
    0     0 mwan3_policy_wan_wan2  all  --  *      *       0.0.0.0/0            213.16.167.212       mark match 0x0/0xff00 /* greekespresso */
    0     0 mwan3_policy_wan_wan2  all  --  *      *       0.0.0.0/0            128.65.209.18        mark match 0x0/0xff00 /* easybytez */
   35  2191 mwan3_policy_balanced  all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00 /* default_rule */

Chain mwan3_track (1 references)
 pkts bytes target     prot opt in     out     source               destination         
 9059  290K MARK       icmp --  *      *       0.0.0.0/0            0.0.0.0/0            match-set mwan3_track_wan dst icmptype 8 length 32 MARK or 0xff00
 9723  311K MARK       icmp --  *      *       0.0.0.0/0            0.0.0.0/0            match-set mwan3_track_wan2 dst icmptype 8 length 32 MARK or 0xff00
 9713  311K MARK       icmp --  *      *       0.0.0.0/0            0.0.0.0/0            match-set mwan3_track_wan4 dst icmptype 8 length 32 MARK or 0xff00
  478 15296 MARK       icmp --  *      *       0.0.0.0/0            0.0.0.0/0            match-set mwan3_track_wan3 dst icmptype 8 length 32 MARK or 0xff00</code></pre></div><div class="codebox"><pre><code>Interface status:
 interface wan is online (tracking active)
 interface wan2 is online (tracking active)
 interface wan3 is online (tracking active)
 interface wan4 is online (tracking active)

Policy balanced:
 wan4 (18%)
 wan3 (24%)
 wan2 (29%)
 wan (27%)

Policy wan2_only:
 wan2 (100%)

Policy wan2_wan:
 wan2 (100%)

Policy wan3_only:
 wan3 (100%)

Policy wan4_only:
 wan4 (100%)

Policy wan_only:
 wan (100%)

Policy wan_wan2:
 wan (100%)

Known networks:
 192.168.10.88
 192.168.2.99
 10.0.1.0/24
 192.168.10.0/24
 192.168.10.0
 10.0.1.3
 192.168.2.0/24
 10.0.0.255
 192.168.10.255
 192.168.1.0
 192.168.1.0/24
 127.255.255.255
 192.168.1.255
 127.0.0.0
 192.168.2.255
 10.0.0.2
 192.168.1.5
 10.0.1.0
 127.0.0.0/8
 192.168.2.0
 127.0.0.1
 10.0.0.0
 10.0.1.255
 224.0.0.0/3
 10.0.0.0/24

Active rules:
    0     0 - balanced  tcp  --  *      *       0.0.0.0/0.0.0.1      0.0.0.0/0            multiport sports 0:65535 multiport dports 443 
    6   288 - balanced  tcp  --  *      *       0.0.0.1/0.0.0.1      0.0.0.0/0            multiport sports 0:65535 multiport dports 443 
    0     0 - wan_only  all  --  *      *       192.168.1.0/24       193.92.150.71        
    0     0 - wan_wan2  all  --  *      *       0.0.0.0/0            213.16.167.212       
    0     0 - wan_wan2  all  --  *      *       0.0.0.0/0            128.65.209.18        
   18  1147 - balanced  all  --  *      *       0.0.0.0/0            0.0.0.0/0</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p307587">
				<div class="post-metadata">
					<div class="post-num">Post #1513</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						14 Jan 2016, 10:37					</div>
				</div>
				<div class="post-content content">
					<p>Hi dionisis,</p><br /><p>Your config looks perfectly fine. I doubt that your conclusion of not all wans working is right. How did you test it?</p>											<p class="post-edited">(Last edited by <strong>Adze</strong> on 14 Jan 2016, 10:37)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p307610">
				<div class="post-metadata">
					<div class="post-num">Post #1514</div>
					<div class="post-author">dionisis</div>
					<div class="post-datetime">
						14 Jan 2016, 15:30					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><p>Hi dionisis,</p><br /><p>Your config looks perfectly fine. I doubt that your conclusion of not all wans working is right. How did you test it?</p></blockquote></div><p>Hi Adze,<br />All wans are working I can ping to any server from the router using each interface.<br />My problem is on the balancing policy that cannot use wan2 and wan4 at the same time.</p><p>The test I do is as follows,&nbsp; <br />at first, I add some big files for download to my pc using a download manager and I setup it to make also many connections per file. The files are from servers that support file segment I can download using multiple ips.</p><p>When the downloading starts, I go to the router and check the traffic graphs of each interface. There I see that if I have traffic on wan2 I have zero traffic on wan4 and if I have traffic on wan4 I have no traffic on wan2.<br />Even adding more files with even more connections there is no difference, wan2 or wan4 is not used and&nbsp; has no traffic.</p><p>Sometimes it is possible while, for example, having zero traffic on wan2 to start have traffic, but the exact same time the traffic from wan4 stops.</p><p>I have also tried to disconnect wan and wan3 and repeat this test with wan2 and wan4 only connected, and still have the same issue. I see traffic only on the one of these two wans as I have described.</p><p>I&#039;m doing these tests for many days now, wan2 and wan4 behave like they&#039;re on different member metrics on balancing policy.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p307614">
				<div class="post-metadata">
					<div class="post-num">Post #1515</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						14 Jan 2016, 16:10					</div>
				</div>
				<div class="post-content content">
					<p>Hi dionisis,</p><br /><p>I have no idea why this is. Config looks perfectly fine. I can only think of one thing...</p><p>Are the 4 wans you have, real different wans, with each their own public ip address? And not your own test setup with faked wan? The reason i ask is that if it is possible in your setup that a syn packet leaves wan2 but syn+ack returns on wan4. That way all consecutive packets will leave wan4.</p><p>Could you do a tcpdump on all your wans and only match on tcp syn:</p><div class="codebox"><pre><code>tcpdump -eqnvvi any &quot;tcp[tcpflags] &amp; (tcp-syn) != 0&quot;</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p307620">
				<div class="post-metadata">
					<div class="post-num">Post #1516</div>
					<div class="post-author">dionisis</div>
					<div class="post-datetime">
						14 Jan 2016, 16:49					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><p>Hi dionisis,</p><br /><p>I have no idea why this is. Config looks perfectly fine. I can only think of one thing...</p><p>Are the 4 wans you have, real different wans, with each their own public ip address? And not your own test setup with faked wan? The reason i ask is that if it is possible in your setup that a syn packet leaves wan2 but syn+ack returns on wan4. That way all consecutive packets will leave wan4.</p><p>Could you do a tcpdump on all your wans and only match on tcp syn:</p><div class="codebox"><pre><code>tcpdump -eqnvvi any &quot;tcp[tcpflags] &amp; (tcp-syn) != 0&quot;</code></pre></div></blockquote></div><p>Hi Adze.<br />Yes, all 4 wans are real different wans, with each their own public ip address.</p><p>About the tcpdump, I never used it, but I hope I&#039;ll figure how to do it.</p><br /><p>edit: I hope I did the tcpdump you asked correctly.<br />while running the command you gave me I was downloading a file as i did on tests I described and this time, wan4 was not used.<br />I couldn&#039;t post all it here so I uploaded it to drobox, <br /><a href="https://www.dropbox.com/s/mkmpeazadsccx55/tcpdump.txt?dl=0">https://www.dropbox.com/s/mkmpeazadsccx … p.txt?dl=0</a></p>											<p class="post-edited">(Last edited by <strong>dionisis</strong> on 14 Jan 2016, 17:25)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p307733">
				<div class="post-metadata">
					<div class="post-num">Post #1517</div>
					<div class="post-author">kantest121</div>
					<div class="post-datetime">
						15 Jan 2016, 15:23					</div>
				</div>
				<div class="post-content content">
					<p>Hi Adze,<br />I have a problem. hope you can help me.</p><p>I use mwan3 create two wan interfaces for pppoe(adsl) , and use Transparent Proxy filter ADs..&nbsp; Internal under everything perfect.<br />but after i added pptpd server. then probelm coming. <br />if i don&#039;t use transparent proxy ,pptpd client work normal. auto load balancing.<br />if i use transparent proxy, usually first client sometimes works , but the 2st or atfer client&nbsp; will appear:<br />pptp client:<br />root@OpenWrt:~# netstat -antp |grep 192.168.0.21<br />tcp&nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0 192.168.0.1:8118&nbsp; &nbsp; &nbsp; &nbsp; 192.168.0.21:2177&nbsp; &nbsp; &nbsp; &nbsp;SYN_RECV </p><p>Internal:<br />root@OpenWrt:~# netstat -antp |grep 192.168.1.2<br />tcp&nbsp; &nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0 192.168.1.1:8118&nbsp; &nbsp; &nbsp; &nbsp; 192.168.1.2:50270&nbsp; &nbsp; &nbsp; &nbsp;ESTABLISHED</p><p>my router(CC15.05) information br-lan(192.168.1.1) pptpd(192.168.0.20-30)<br />/etc/firewall.user<br />iptables -I forwarding_rule -s 192.168.0.0/24 -i ppp+ -j ACCEPT<br />iptables -I forwarding_rule -s 192.168.0.0/24 -o ppp+ -j ACCEPT<br />iptables -t nat -A prerouting_rule -s 192.168.0.0/24 -p tcp -m tcp --dport 80 -j REDIRECT --to-ports 8118</p><p>Looking forward to your reply.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p307738">
				<div class="post-metadata">
					<div class="post-num">Post #1518</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						15 Jan 2016, 15:44					</div>
				</div>
				<div class="post-content content">
					<p>Hi dionisis,</p><div class="quotebox"><cite>dionisis wrote:</cite><blockquote><p>edit: I hope I did the tcpdump you asked correctly.<br />while running the command you gave me I was downloading a file as i did on tests I described and this time, wan4 was not used.<br />I couldn&#039;t post all it here so I uploaded it to drobox, <br /><a href="https://www.dropbox.com/s/mkmpeazadsccx55/tcpdump.txt?dl=0">https://www.dropbox.com/s/mkmpeazadsccx … p.txt?dl=0</a></p></blockquote></div><p>Well, the tcpdump you uploaded was exactly the confirmation i was looking for. All your wans are used! So, i dont know what you are looking at and measuring, but all your wans are definitely used. 100% sure.</p><p>You can see for yourself in the dump towards 154.53.224.210:</p><div class="codebox"><pre><code>wan = eth0.2 = 10.0.0.2:
17:05:12.049923 Out c4:6e:1f:6b:be:f1 (tos 0x0, ttl 127, id 24023, offset 0, flags [DF], proto TCP (6), length 48)
    10.0.0.2.56615 &gt; 154.53.224.210.80: tcp 0
17:05:12.150609 Out c4:6e:1f:6b:be:f1 (tos 0x0, ttl 127, id 24041, offset 0, flags [DF], proto TCP (6), length 48)
    10.0.0.2.56617 &gt; 154.53.224.210.80: tcp 0

wan2 = eth0.3 = 192.168.10.88:
17:05:12.250756 Out c4:6e:1f:6b:be:f1 (tos 0x0, ttl 127, id 24062, offset 0, flags [DF], proto TCP (6), length 48)
    192.168.10.88.56619 &gt; 154.53.224.210.80: tcp 0
17:06:14.612843 Out c4:6e:1f:6b:be:f1 (tos 0x0, ttl 127, id 3722, offset 0, flags [DF], proto TCP (6), length 48)
    192.168.10.88.56666 &gt; 154.53.224.210.80: tcp 0

wan3 = eth0.4 = 192.168.2.99:
17:06:14.307973 Out c4:6e:1f:6b:be:f1 (tos 0x0, ttl 127, id 3704, offset 0, flags [DF], proto TCP (6), length 48)
    192.168.2.99.56663 &gt; 154.53.224.210.80: tcp 0
17:06:14.514029 Out c4:6e:1f:6b:be:f1 (tos 0x0, ttl 127, id 3709, offset 0, flags [DF], proto TCP (6), length 48)
    192.168.2.99.56664 &gt; 154.53.224.210.80: tcp 0

wan4 = eth0.5 = 10.0.1.3:
17:05:11.830023 Out c4:6e:1f:6b:be:f1 (tos 0x0, ttl 127, id 24014, offset 0, flags [DF], proto TCP (6), length 48)
    10.0.1.3.56613 &gt; 154.53.224.210.80: tcp 0
17:05:12.001816 Out c4:6e:1f:6b:be:f1 (tos 0x0, ttl 127, id 24018, offset 0, flags [DF], proto TCP (6), length 48)
    10.0.1.3.56614 &gt; 154.53.224.210.80: tcp 0</code></pre></div><p>Case closed&nbsp; <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p>											<p class="post-edited">(Last edited by <strong>Adze</strong> on 15 Jan 2016, 15:53)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p307749">
				<div class="post-metadata">
					<div class="post-num">Post #1519</div>
					<div class="post-author">wadja_tn</div>
					<div class="post-datetime">
						15 Jan 2016, 17:50					</div>
				</div>
				<div class="post-content content">
					<p>I want to settle this conflict<br />WAN1 &lt;=&gt;LAN1 &amp; WAN2 &lt;=&gt;LAN2 <br />When I start WAN1 ==&gt; WAN2 shut down</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p307790">
				<div class="post-metadata">
					<div class="post-num">Post #1520</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						15 Jan 2016, 23:53					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>wadja_tn wrote:</cite><blockquote><p>I want to settle this conflict<br />WAN1 &lt;=&gt;LAN1 &amp; WAN2 &lt;=&gt;LAN2 <br />When I start WAN1 ==&gt; WAN2 shut down</p></blockquote></div><p>You have to elaborate some more on your troubles, if you want help from me...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p307800">
				<div class="post-metadata">
					<div class="post-num">Post #1521</div>
					<div class="post-author">anarchy99</div>
					<div class="post-datetime">
						16 Jan 2016, 05:23					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><p>Hi anarchy99,</p><br /><p>I looked at the data and looks ok to me. But to be sure please upgrade to version 2.0-2, because the 2.0-0 version you are using contains a bug which might affect you</p><p> Also: (from the wiki)</p><p>On routers with just one wan interface (and one default route), there is no issue on which source address to use for new initiated sessions. But with two or more wan interfaces you may wish to have control over this. Up until version 2.0, mwan3 did not respect the already set source address of router originated packets. Packets were load-balanced regardless of source address, based on configured user rules.</p><p>As of version 2.0 mwan3 does respect the already set source address. The advantage of this is that an applications can have control over which wan interface to use. The downside of this is that when an application does not specify which source address to use (most of the time) the kernel will pick a source address based on the routing table. In practice this means the default route with the lowest metric is used to determine which source address to use. So if you don&#039;t configure a routable loopback address with corresponding more preferred default route, all traffic originating from the router itself will leave the primary wan with the source address of that wan interface, regardless of configured user mwan3 rules.</p><p>More info: <a href="https://wiki.openwrt.org/doc/howto/mwan3#the_routable_loopback_self">https://wiki.openwrt.org/doc/howto/mwan … pback_self</a></p></blockquote></div><p>no luck with routable loopback either.</p><p>tried to change the ipaddr and gateway of already present interface &#039;loopback&#039; to the ip of the local interface that maps to main wan. i couldn&#039;t access internet or luci but ssh was still accessible.</p><p>then i added another interface &#039;self&#039; as suggested in the wiki but internet still didn&#039;t work and i was able to access luci only on that ip.</p><p>shouldn&#039;t this be a problem having 2 interfaces with ifname &#039;lo&#039; ?</p>											<p class="post-edited">(Last edited by <strong>anarchy99</strong> on 16 Jan 2016, 05:23)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p307847">
				<div class="post-metadata">
					<div class="post-num">Post #1522</div>
					<div class="post-author">brick2008</div>
					<div class="post-datetime">
						16 Jan 2016, 17:55					</div>
				</div>
				<div class="post-content content">
					<p>I have been using mwan3 about three years and everything worked perfectly,Thank you&nbsp; Adze.<br />Now,I get a new problem after add some device.<br />Wan1 &lt;=&gt;Lan1<br />Wan2 &lt;=&gt;Lan2 <br />Wan3+ Wan4+Wan5+Wan6+Wan7+Wan8&lt;=&gt;Lan3<br />When use the following settings, I found Lan2&#039;s upload traffic is going wan1, anything wrong with my settings??</p><div class="codebox"><pre><code>Software versions : 

OpenWrt - OpenWrt Designated Driver r47935
LuCI - git-15.352.67088-e42e5f5

mwan3 - 2.0-1
mwan3-luci - 1.4-4

Output of &quot;cat /etc/config/mwan3&quot; : 

config interface &#039;wan1&#039;
    option enabled &#039;1&#039;
    list track_ip &#039;218.28.152.207&#039;
    list track_ip &#039;218.28.152.254&#039;
    option reliability &#039;1&#039;
    option count &#039;1&#039;
    option timeout &#039;1&#039;
    option interval &#039;300&#039;
    option down &#039;3&#039;
    option up &#039;2&#039;

config interface &#039;wan2&#039;
    option enabled &#039;1&#039;
    list track_ip &#039;218.28.152.207&#039;
    list track_ip &#039;218.28.152.254&#039;
    option reliability &#039;1&#039;
    option count &#039;1&#039;
    option timeout &#039;1&#039;
    option interval &#039;300&#039;
    option down &#039;3&#039;
    option up &#039;2&#039;

config interface &#039;wan3&#039;
    option enabled &#039;1&#039;
    list track_ip &#039;218.28.152.207&#039;
    list track_ip &#039;218.28.152.254&#039;
    option reliability &#039;1&#039;
    option count &#039;1&#039;
    option timeout &#039;1&#039;
    option interval &#039;300&#039;
    option down &#039;3&#039;
    option up &#039;2&#039;

config interface &#039;wan4&#039;
    option enabled &#039;1&#039;
    list track_ip &#039;218.28.152.207&#039;
    list track_ip &#039;218.28.152.254&#039;
    option reliability &#039;1&#039;
    option count &#039;1&#039;
    option timeout &#039;1&#039;
    option interval &#039;300&#039;
    option down &#039;3&#039;
    option up &#039;2&#039;

config interface &#039;wan5&#039;
    option enabled &#039;1&#039;
    list track_ip &#039;218.28.152.207&#039;
    list track_ip &#039;218.28.152.254&#039;
    option reliability &#039;1&#039;
    option count &#039;1&#039;
    option timeout &#039;1&#039;
    option interval &#039;300&#039;
    option down &#039;3&#039;
    option up &#039;2&#039;

config interface &#039;wan6&#039;
    option enabled &#039;1&#039;
    list track_ip &#039;218.28.152.207&#039;
    list track_ip &#039;218.28.152.254&#039;
    option reliability &#039;1&#039;
    option count &#039;1&#039;
    option timeout &#039;1&#039;
    option interval &#039;300&#039;
    option down &#039;3&#039;
    option up &#039;2&#039;

config interface &#039;wan7&#039;
    option enabled &#039;1&#039;
    list track_ip &#039;218.28.152.207&#039;
    list track_ip &#039;218.28.152.254&#039;
    option reliability &#039;1&#039;
    option count &#039;1&#039;
    option timeout &#039;1&#039;
    option interval &#039;300&#039;
    option down &#039;3&#039;
    option up &#039;2&#039;

config interface &#039;wan8&#039;
    option enabled &#039;1&#039;
    list track_ip &#039;218.28.152.207&#039;
    list track_ip &#039;218.28.152.254&#039;
    option reliability &#039;1&#039;
    option count &#039;1&#039;
    option timeout &#039;1&#039;
    option interval &#039;300&#039;
    option down &#039;3&#039;
    option up &#039;2&#039;

config member &#039;wan1_m1_w1&#039;
    option interface &#039;wan1&#039;
    option metric &#039;1&#039;
    option weight &#039;1&#039;

config member &#039;wan2_m1_w1&#039;
    option interface &#039;wan2&#039;
    option weight &#039;1&#039;
    option metric &#039;1&#039;

config member &#039;wan3_m1_w1&#039;
    option interface &#039;wan3&#039;
    option weight &#039;1&#039;
    option metric &#039;1&#039;

config member &#039;wan4_m1_w1&#039;
    option interface &#039;wan4&#039;
    option weight &#039;1&#039;
    option metric &#039;1&#039;

config member &#039;wan5_m1_w1&#039;
    option interface &#039;wan5&#039;
    option weight &#039;1&#039;
    option metric &#039;1&#039;

config member &#039;wan6_m1_w1&#039;
    option interface &#039;wan6&#039;
    option weight &#039;1&#039;
    option metric &#039;1&#039;

config member &#039;wan7_m1_w1&#039;
    option interface &#039;wan7&#039;
    option weight &#039;1&#039;
    option metric &#039;1&#039;

config member &#039;wan8_m1_w1&#039;
    option interface &#039;wan8&#039;
    option weight &#039;1&#039;
    option metric &#039;1&#039;

config policy &#039;wan1_only&#039;
        list use_member &#039;wan1_m1_w1&#039;

config policy &#039;wan2_only&#039;
        list use_member &#039;wan2_m1_w1&#039;

config policy &#039;all4&#039;
    list use_member &#039;wan3_m1_w1&#039;
    list use_member &#039;wan4_m1_w1&#039;
    list use_member &#039;wan5_m1_w1&#039;
    list use_member &#039;wan6_m1_w1&#039;
    list use_member &#039;wan7_m1_w1&#039;
    list use_member &#039;wan8_m1_w1&#039;

config rule &#039;dan_zou_wan1&#039;
        option src_ip &#039;192.168.1.145&#039;
    option dest_ip &#039;0.0.0.0/0&#039;
        option proto &#039;all&#039;
        option use_policy &#039;wan1_only&#039;

config rule &#039;dan_zou_wan2&#039;
        option src_ip &#039;192.168.1.207&#039;
    option dest_ip &#039;0.0.0.0/0&#039;
        option proto &#039;all&#039;
        option use_policy &#039;wan2_only&#039;

config rule &#039;default_rule&#039;
    option dest_ip &#039;0.0.0.0/0&#039;
    option use_policy &#039;all4&#039;
    option proto &#039;all&#039;
    option sticky &#039;0&#039;

Output of &quot;cat /etc/config/network&quot; : 

config interface &#039;loopback&#039;
    option ifname &#039;lo&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;127.0.0.1&#039;
    option netmask &#039;255.0.0.0&#039;

config globals &#039;globals&#039;
    option ula_prefix &#039;fd1f:3ba0:0015::/48&#039;

config interface &#039;lan&#039;
    option ifname &#039;eth0.1&#039;
    option type &#039;bridge&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;192.168.1.1&#039;
    option netmask &#039;255.255.255.0&#039;
    option ip6assign &#039;60&#039;

config interface &#039;wan1&#039;
    option proto &#039;pppoe&#039;
    USERNAME HIDDEN
    PASSWORD HIDDEN
    option ifname &#039;eth0.2&#039;
    option metric &#039;10&#039;
    option ipv6 &#039;0&#039;

config interface &#039;wan2&#039;
    option proto &#039;pppoe&#039;
    USERNAME HIDDEN
    PASSWORD HIDDEN
    option ifname &#039;eth0.2&#039;
    option metric &#039;20&#039;
    option auto &#039;0&#039;
    option ipv6 &#039;0&#039;

config interface &#039;wan3&#039;
    option proto &#039;pppoe&#039;
    USERNAME HIDDEN
    PASSWORD HIDDEN
    option ifname &#039;eth0.2&#039;
    option metric &#039;30&#039;
    option auto &#039;0&#039;
    option ipv6 &#039;0&#039;

config interface &#039;wan4&#039;
    option proto &#039;pppoe&#039;
    USERNAME HIDDEN
    PASSWORD HIDDEN
    option ifname &#039;eth0.2&#039;
    option metric &#039;40&#039;
    option auto &#039;0&#039;
    option ipv6 &#039;0&#039;

config interface &#039;wan5&#039;
    option proto &#039;pppoe&#039;
    USERNAME HIDDEN
    PASSWORD HIDDEN
    option ifname &#039;eth0.2&#039;
    option metric &#039;50&#039;
    option auto &#039;0&#039;
    option ipv6 &#039;0&#039;

config interface &#039;wan6&#039;
    option proto &#039;pppoe&#039;
    USERNAME HIDDEN
    PASSWORD HIDDEN
    option ifname &#039;eth0.2&#039;
    option metric &#039;60&#039;
    option auto &#039;0&#039;
    option ipv6 &#039;0&#039;

config interface &#039;wan7&#039;
    option proto &#039;pppoe&#039;
    USERNAME HIDDEN
    PASSWORD HIDDEN
    option ifname &#039;eth0.2&#039;
    option metric &#039;70&#039;
    option auto &#039;0&#039;
    option ipv6 &#039;0&#039;

config interface &#039;wan8&#039;
    option proto &#039;pppoe&#039;
    USERNAME HIDDEN
    PASSWORD HIDDEN
    option ifname &#039;eth0.2&#039;
    option metric &#039;80&#039;
    option auto &#039;0&#039;
    option ipv6 &#039;0&#039;

config switch
    option name &#039;switch0&#039;
    option reset &#039;1&#039;
    option enable_vlan &#039;1&#039;

config switch_vlan
    option device &#039;switch0&#039;
    option vlan &#039;1&#039;
    option ports &#039;0t 2 3 4 5&#039;

config switch_vlan
    option device &#039;switch0&#039;
    option vlan &#039;2&#039;
    option ports &#039;0t 1&#039;

Output of &quot;ifconfig&quot; : 

br-lan    Link encap:Ethernet  HWaddr 6C:E8:73:FF:07:F7  
          inet addr:192.168.1.1  Bcast:192.168.1.255  Mask:255.255.255.0
          inet6 addr: fd1f:3ba0:15::1%2006946680/60 Scope:Global
          inet6 addr: fe80::6ee8:73ff:feff:7f7%2006946680/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:610041452 errors:0 dropped:0 overruns:0 frame:0
          TX packets:560169464 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:657670604684 (612.5 GiB)  TX bytes:323465760085 (301.2 GiB)

eth0      Link encap:Ethernet  HWaddr 6C:E8:73:FF:07:F7  
          inet6 addr: fe80::6ee8:73ff:feff:7f7%2006945816/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:1171052378 errors:0 dropped:0 overruns:216240 frame:0
          TX packets:1167834216 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:1465367800 (1.3 GiB)  TX bytes:370453930 (353.2 MiB)
          Interrupt:4 

eth0.1    Link encap:Ethernet  HWaddr 6C:E8:73:FF:07:F7  
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:607387386 errors:0 dropped:456 overruns:0 frame:0
          TX packets:554559220 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:657385735193 (612.2 GiB)  TX bytes:317218752937 (295.4 GiB)

eth0.2    Link encap:Ethernet  HWaddr 6C:E8:73:FF:07:F7  
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:563664967 errors:0 dropped:0 overruns:0 frame:0
          TX packets:613369731 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:319433100442 (297.4 GiB)  TX bytes:670748654204 (624.6 GiB)

lo        Link encap:Local Loopback  
          inet addr:127.0.0.1  Mask:255.0.0.0
          inet6 addr: ::1%4566648/128 Scope:Host
          UP LOOPBACK RUNNING  MTU:65536  Metric:1
          RX packets:295 errors:0 dropped:0 overruns:0 frame:0
          TX packets:295 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:23323 (22.7 KiB)  TX bytes:23323 (22.7 KiB)

pppoe-wan1 Link encap:Point-to-Point Protocol  
          inet addr:123.5.164.45  P-t-P:123.5.160.1  Mask:255.255.255.255
          UP POINTOPOINT RUNNING NOARP MULTICAST  MTU:1492  Metric:1
          RX packets:4860368 errors:0 dropped:0 overruns:0 frame:0
          TX packets:5065647 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:3 
          RX bytes:3808482536 (3.5 GiB)  TX bytes:5515692828 (5.1 GiB)

pppoe-wan2 Link encap:Point-to-Point Protocol  
          inet addr:123.5.193.145  P-t-P:123.5.192.1  Mask:255.255.255.255
          UP POINTOPOINT RUNNING NOARP MULTICAST  MTU:1492  Metric:1
          RX packets:643708 errors:0 dropped:0 overruns:0 frame:0
          TX packets:329061 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:3 
          RX bytes:843652081 (804.5 MiB)  TX bytes:136448428 (130.1 MiB)

pppoe-wan3 Link encap:Point-to-Point Protocol  
          inet addr:125.40.155.144  P-t-P:125.40.152.1  Mask:255.255.255.255
          UP POINTOPOINT RUNNING NOARP MULTICAST  MTU:1492  Metric:1
          RX packets:380389 errors:0 dropped:0 overruns:0 frame:0
          TX packets:278096 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:3 
          RX bytes:467340675 (445.6 MiB)  TX bytes:57881178 (55.1 MiB)

pppoe-wan4 Link encap:Point-to-Point Protocol  
          inet addr:125.40.153.7  P-t-P:125.40.152.1  Mask:255.255.255.255
          UP POINTOPOINT RUNNING NOARP MULTICAST  MTU:1492  Metric:1
          RX packets:3696175 errors:0 dropped:0 overruns:0 frame:0
          TX packets:2732014 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:3 
          RX bytes:4437693127 (4.1 GiB)  TX bytes:757678804 (722.5 MiB)

pppoe-wan5 Link encap:Point-to-Point Protocol  
          inet addr:123.5.160.199  P-t-P:123.5.160.1  Mask:255.255.255.255
          UP POINTOPOINT RUNNING NOARP MULTICAST  MTU:1492  Metric:1
          RX packets:862159 errors:0 dropped:0 overruns:0 frame:0
          TX packets:667422 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:3 
          RX bytes:1053527615 (1004.7 MiB)  TX bytes:206990353 (197.4 MiB)

pppoe-wan6 Link encap:Point-to-Point Protocol  
          inet addr:123.5.165.242  P-t-P:123.5.160.1  Mask:255.255.255.255
          UP POINTOPOINT RUNNING NOARP MULTICAST  MTU:1492  Metric:1
          RX packets:1147853 errors:0 dropped:0 overruns:0 frame:0
          TX packets:1235424 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:3 
          RX bytes:914698008 (872.3 MiB)  TX bytes:980037591 (934.6 MiB)

pppoe-wan7 Link encap:Point-to-Point Protocol  
          inet addr:123.5.215.183  P-t-P:123.5.208.1  Mask:255.255.255.255
          UP POINTOPOINT RUNNING NOARP MULTICAST  MTU:1492  Metric:1
          RX packets:1496497 errors:0 dropped:0 overruns:0 frame:0
          TX packets:1181167 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:3 
          RX bytes:1733037878 (1.6 GiB)  TX bytes:389474771 (371.4 MiB)

pppoe-wan8 Link encap:Point-to-Point Protocol  
          inet addr:123.5.194.223  P-t-P:123.5.192.1  Mask:255.255.255.255
          UP POINTOPOINT RUNNING NOARP MULTICAST  MTU:1492  Metric:1
          RX packets:3085790 errors:0 dropped:0 overruns:0 frame:0
          TX packets:2452274 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:3 
          RX bytes:3315575864 (3.0 GiB)  TX bytes:883500275 (842.5 MiB)

wlan0     Link encap:Ethernet  HWaddr 6C:E8:73:FF:07:F8  
          inet6 addr: fe80::6ee8:73ff:feff:7f8%2006280504/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:2772384 errors:0 dropped:0 overruns:0 frame:0
          TX packets:5017846 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:339445849 (323.7 MiB)  TX bytes:5928372369 (5.5 GiB)

Output of &quot;route -n&quot; : 

Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
0.0.0.0         123.5.160.1     0.0.0.0         UG    10     0        0 pppoe-wan1
0.0.0.0         123.5.192.1     0.0.0.0         UG    20     0        0 pppoe-wan2
0.0.0.0         125.40.152.1    0.0.0.0         UG    30     0        0 pppoe-wan3
0.0.0.0         125.40.152.1    0.0.0.0         UG    40     0        0 pppoe-wan4
0.0.0.0         123.5.160.1     0.0.0.0         UG    50     0        0 pppoe-wan5
0.0.0.0         123.5.160.1     0.0.0.0         UG    60     0        0 pppoe-wan6
0.0.0.0         123.5.208.1     0.0.0.0         UG    70     0        0 pppoe-wan7
0.0.0.0         123.5.192.1     0.0.0.0         UG    80     0        0 pppoe-wan8
123.5.160.1     0.0.0.0         255.255.255.255 UH    0      0        0 pppoe-wan6
123.5.160.1     0.0.0.0         255.255.255.255 UH    0      0        0 pppoe-wan5
123.5.160.1     0.0.0.0         255.255.255.255 UH    0      0        0 pppoe-wan1
123.5.192.1     0.0.0.0         255.255.255.255 UH    0      0        0 pppoe-wan8
123.5.192.1     0.0.0.0         255.255.255.255 UH    0      0        0 pppoe-wan2
123.5.208.1     0.0.0.0         255.255.255.255 UH    0      0        0 pppoe-wan7
125.40.152.1    0.0.0.0         255.255.255.255 UH    0      0        0 pppoe-wan4
125.40.152.1    0.0.0.0         255.255.255.255 UH    0      0        0 pppoe-wan3
192.168.1.0     0.0.0.0         255.255.255.0   U     0      0        0 br-lan

Output of &quot;ip rule show&quot; : 

0:    from all lookup 128 
1:    from all lookup local 
1001:    from all iif pppoe-wan1 lookup main 
1002:    from all iif pppoe-wan2 lookup main 
1003:    from all iif pppoe-wan3 lookup main 
1004:    from all iif pppoe-wan4 lookup main 
1005:    from all iif pppoe-wan5 lookup main 
1006:    from all iif pppoe-wan6 lookup main 
1007:    from all iif pppoe-wan7 lookup main 
1008:    from all iif pppoe-wan8 lookup main 
2001:    from all fwmark 0x100/0xff00 lookup 1 
2002:    from all fwmark 0x200/0xff00 lookup 2 
2003:    from all fwmark 0x300/0xff00 lookup 3 
2004:    from all fwmark 0x400/0xff00 lookup 4 
2005:    from all fwmark 0x500/0xff00 lookup 5 
2006:    from all fwmark 0x600/0xff00 lookup 6 
2007:    from all fwmark 0x700/0xff00 lookup 7 
2008:    from all fwmark 0x800/0xff00 lookup 8 
2253:    from all fwmark 0xfd00/0xff00 blackhole
2254:    from all fwmark 0xfe00/0xff00 unreachable
32766:    from all lookup main 
32767:    from all lookup default

Output of &quot;ip route list table 1-250&quot; : 

1
default via 123.5.160.1 dev pppoe-wan1 
2
default via 123.5.192.1 dev pppoe-wan2 
3
default via 125.40.152.1 dev pppoe-wan3 
4
default via 125.40.152.1 dev pppoe-wan4 
5
default via 123.5.160.1 dev pppoe-wan5 
6
default via 123.5.160.1 dev pppoe-wan6 
7
default via 123.5.208.1 dev pppoe-wan7 
8
default via 123.5.192.1 dev pppoe-wan8

Firewall default output policy (must be ACCEPT) : 

ACCEPT

Output of &quot;iptables -L -t mangle -v -n&quot; : 

Chain PREROUTING (policy ACCEPT 3000K packets, 2701M bytes)
 pkts bytes target     prot opt in     out     source               destination         
3006K 2705M mwan3_hook  all  --  *      *       0.0.0.0/0            0.0.0.0/0           
3000K 2701M fwmark     all  --  *      *       0.0.0.0/0            0.0.0.0/0           

Chain INPUT (policy ACCEPT 17150 packets, 2688K bytes)
 pkts bytes target     prot opt in     out     source               destination         

Chain FORWARD (policy ACCEPT 2982K packets, 2698M bytes)
 pkts bytes target     prot opt in     out     source               destination         
2982K 2698M mssfix     all  --  *      *       0.0.0.0/0            0.0.0.0/0           

Chain OUTPUT (policy ACCEPT 14879 packets, 5147K bytes)
 pkts bytes target     prot opt in     out     source               destination         
15137 5204K mwan3_hook  all  --  *      *       0.0.0.0/0            0.0.0.0/0           

Chain POSTROUTING (policy ACCEPT 2997K packets, 2703M bytes)
 pkts bytes target     prot opt in     out     source               destination         

Chain fwmark (1 references)
 pkts bytes target     prot opt in     out     source               destination         

Chain mssfix (1 references)
 pkts bytes target     prot opt in     out     source               destination         
   38  2264 TCPMSS     tcp  --  *      pppoe-wan1  0.0.0.0/0            0.0.0.0/0            tcp flags:0x06/0x02 /* wan (mtu_fix) */ TCPMSS clamp to PMTU
   83  4980 TCPMSS     tcp  --  *      pppoe-wan2  0.0.0.0/0            0.0.0.0/0            tcp flags:0x06/0x02 /* wan (mtu_fix) */ TCPMSS clamp to PMTU
  392 22100 TCPMSS     tcp  --  *      pppoe-wan3  0.0.0.0/0            0.0.0.0/0            tcp flags:0x06/0x02 /* wan (mtu_fix) */ TCPMSS clamp to PMTU
  403 22684 TCPMSS     tcp  --  *      pppoe-wan4  0.0.0.0/0            0.0.0.0/0            tcp flags:0x06/0x02 /* wan (mtu_fix) */ TCPMSS clamp to PMTU
  650 37520 TCPMSS     tcp  --  *      pppoe-wan5  0.0.0.0/0            0.0.0.0/0            tcp flags:0x06/0x02 /* wan (mtu_fix) */ TCPMSS clamp to PMTU
  241 13012 TCPMSS     tcp  --  *      pppoe-wan6  0.0.0.0/0            0.0.0.0/0            tcp flags:0x06/0x02 /* wan (mtu_fix) */ TCPMSS clamp to PMTU
  272 14600 TCPMSS     tcp  --  *      pppoe-wan7  0.0.0.0/0            0.0.0.0/0            tcp flags:0x06/0x02 /* wan (mtu_fix) */ TCPMSS clamp to PMTU
  523 29692 TCPMSS     tcp  --  *      pppoe-wan8  0.0.0.0/0            0.0.0.0/0            tcp flags:0x06/0x02 /* wan (mtu_fix) */ TCPMSS clamp to PMTU

Chain mwan3_connected (2 references)
 pkts bytes target     prot opt in     out     source               destination         
1606K 1565M MARK       all  --  *      *       0.0.0.0/0            0.0.0.0/0            match-set mwan3_connected dst MARK or 0xff00

Chain mwan3_hook (2 references)
 pkts bytes target     prot opt in     out     source               destination         
3021K 2710M CONNMARK   all  --  *      *       0.0.0.0/0            0.0.0.0/0            CONNMARK restore mask 0xff00
49706 2095K mwan3_ifaces_in  all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00
43449 1660K mwan3_ifaces_out  all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00
42433 1588K mwan3_connected  all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00
41378 1449K mwan3_rules  all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00
3021K 2710M CONNMARK   all  --  *      *       0.0.0.0/0            0.0.0.0/0            CONNMARK save mask 0xff00
2993K 2703M mwan3_connected  all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match ! 0xff00/0xff00

Chain mwan3_iface_in_wan1 (1 references)
 pkts bytes target     prot opt in     out     source               destination         
    0     0 MARK       all  --  pppoe-wan1 *       0.0.0.0/0            0.0.0.0/0            match-set mwan3_connected src mark match 0x0/0xff00 /* default */ MARK or 0xff00
  327 18631 MARK       all  --  pppoe-wan1 *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00 /* wan1 */ MARK xset 0x100/0xff00

Chain mwan3_iface_in_wan2 (1 references)
 pkts bytes target     prot opt in     out     source               destination         
    0     0 MARK       all  --  pppoe-wan2 *       0.0.0.0/0            0.0.0.0/0            match-set mwan3_connected src mark match 0x0/0xff00 /* default */ MARK or 0xff00
  320 19152 MARK       all  --  pppoe-wan2 *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00 /* wan2 */ MARK xset 0x200/0xff00

Chain mwan3_iface_in_wan3 (1 references)
 pkts bytes target     prot opt in     out     source               destination         
    0     0 MARK       all  --  pppoe-wan3 *       0.0.0.0/0            0.0.0.0/0            match-set mwan3_connected src mark match 0x0/0xff00 /* default */ MARK or 0xff00
  567 40674 MARK       all  --  pppoe-wan3 *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00 /* wan3 */ MARK xset 0x300/0xff00

Chain mwan3_iface_in_wan4 (1 references)
 pkts bytes target     prot opt in     out     source               destination         
   20  1922 MARK       all  --  pppoe-wan4 *       0.0.0.0/0            0.0.0.0/0            match-set mwan3_connected src mark match 0x0/0xff00 /* default */ MARK or 0xff00
  566 40077 MARK       all  --  pppoe-wan4 *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00 /* wan4 */ MARK xset 0x400/0xff00

Chain mwan3_iface_in_wan5 (1 references)
 pkts bytes target     prot opt in     out     source               destination         
   12  1173 MARK       all  --  pppoe-wan5 *       0.0.0.0/0            0.0.0.0/0            match-set mwan3_connected src mark match 0x0/0xff00 /* default */ MARK or 0xff00
  825 55678 MARK       all  --  pppoe-wan5 *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00 /* wan5 */ MARK xset 0x500/0xff00

Chain mwan3_iface_in_wan6 (1 references)
 pkts bytes target     prot opt in     out     source               destination         
    0     0 MARK       all  --  pppoe-wan6 *       0.0.0.0/0            0.0.0.0/0            match-set mwan3_connected src mark match 0x0/0xff00 /* default */ MARK or 0xff00
  192 15273 MARK       all  --  pppoe-wan6 *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00 /* wan6 */ MARK xset 0x600/0xff00

Chain mwan3_iface_in_wan7 (1 references)
 pkts bytes target     prot opt in     out     source               destination         
    0     0 MARK       all  --  pppoe-wan7 *       0.0.0.0/0            0.0.0.0/0            match-set mwan3_connected src mark match 0x0/0xff00 /* default */ MARK or 0xff00
  473 38291 MARK       all  --  pppoe-wan7 *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00 /* wan7 */ MARK xset 0x700/0xff00

Chain mwan3_iface_in_wan8 (1 references)
 pkts bytes target     prot opt in     out     source               destination         
    0     0 MARK       all  --  pppoe-wan8 *       0.0.0.0/0            0.0.0.0/0            match-set mwan3_connected src mark match 0x0/0xff00 /* default */ MARK or 0xff00
 2955  205K MARK       all  --  pppoe-wan8 *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00 /* wan8 */ MARK xset 0x800/0xff00

Chain mwan3_iface_out_wan1 (1 references)
 pkts bytes target     prot opt in     out     source               destination         
  718 49247 MARK       all  --  *      *       123.5.164.45         0.0.0.0/0            mark match 0x0/0xff00 /* wan1 */ MARK xset 0x100/0xff00

Chain mwan3_iface_out_wan2 (1 references)
 pkts bytes target     prot opt in     out     source               destination         
   35  2896 MARK       all  --  *      *       123.5.193.145        0.0.0.0/0            mark match 0x0/0xff00 /* wan2 */ MARK xset 0x200/0xff00

Chain mwan3_iface_out_wan3 (1 references)
 pkts bytes target     prot opt in     out     source               destination         
   43  3216 MARK       all  --  *      *       125.40.155.144       0.0.0.0/0            mark match 0x0/0xff00 /* wan3 */ MARK xset 0x300/0xff00

Chain mwan3_iface_out_wan4 (1 references)
 pkts bytes target     prot opt in     out     source               destination         
   43  3216 MARK       all  --  *      *       125.40.153.7         0.0.0.0/0            mark match 0x0/0xff00 /* wan4 */ MARK xset 0x400/0xff00

Chain mwan3_iface_out_wan5 (1 references)
 pkts bytes target     prot opt in     out     source               destination         
   42  3176 MARK       all  --  *      *       123.5.160.199        0.0.0.0/0            mark match 0x0/0xff00 /* wan5 */ MARK xset 0x500/0xff00

Chain mwan3_iface_out_wan6 (1 references)
 pkts bytes target     prot opt in     out     source               destination         
   44  3256 MARK       all  --  *      *       123.5.165.242        0.0.0.0/0            mark match 0x0/0xff00 /* wan6 */ MARK xset 0x600/0xff00

Chain mwan3_iface_out_wan7 (1 references)
 pkts bytes target     prot opt in     out     source               destination         
   45  3296 MARK       all  --  *      *       123.5.215.183        0.0.0.0/0            mark match 0x0/0xff00 /* wan7 */ MARK xset 0x700/0xff00

Chain mwan3_iface_out_wan8 (1 references)
 pkts bytes target     prot opt in     out     source               destination         
   46  3336 MARK       all  --  *      *       123.5.194.223        0.0.0.0/0            mark match 0x0/0xff00 /* wan8 */ MARK xset 0x800/0xff00

Chain mwan3_ifaces_in (1 references)
 pkts bytes target     prot opt in     out     source               destination         
49685 2090K mwan3_iface_in_wan1  all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00
49267 2053K mwan3_iface_in_wan2  all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00
48860 2025K mwan3_iface_in_wan3  all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00
48132 1970K mwan3_iface_in_wan4  all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00
47432 1922K mwan3_iface_in_wan5  all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00
46539 1860K mwan3_iface_in_wan6  all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00
46286 1839K mwan3_iface_in_wan7  all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00
45753 1797K mwan3_iface_in_wan8  all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00

Chain mwan3_ifaces_out (1 references)
 pkts bytes target     prot opt in     out     source               destination         
43428 1654K mwan3_iface_out_wan1  all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00
42624 1587K mwan3_iface_out_wan2  all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00
42505 1576K mwan3_iface_out_wan3  all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00
42310 1559K mwan3_iface_out_wan4  all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00
42173 1551K mwan3_iface_out_wan5  all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00
42079 1543K mwan3_iface_out_wan6  all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00
41970 1534K mwan3_iface_out_wan7  all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00
41875 1527K mwan3_iface_out_wan8  all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00

Chain mwan3_policy_all4 (1 references)
 pkts bytes target     prot opt in     out     source               destination         
 6573  220K MARK       all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00 statistic mode random probability 0.16600000020 /* wan8 1 6 */ MARK xset 0x800/0xff00
 6489  217K MARK       all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00 statistic mode random probability 0.20000000019 /* wan7 1 5 */ MARK xset 0x700/0xff00
 6689  223K MARK       all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00 statistic mode random probability 0.25000000000 /* wan6 1 4 */ MARK xset 0x600/0xff00
 6523  220K MARK       all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00 statistic mode random probability 0.33300000010 /* wan5 1 3 */ MARK xset 0x500/0xff00
 6667  223K MARK       all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00 statistic mode random probability 0.50000000000 /* wan4 1 2 */ MARK xset 0x400/0xff00
 6650  222K MARK       all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00 /* wan3 1 1 */ MARK xset 0x300/0xff00

Chain mwan3_policy_wan1_only (1 references)
 pkts bytes target     prot opt in     out     source               destination         
  698 48636 MARK       all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00 /* wan1 1 1 */ MARK xset 0x100/0xff00

Chain mwan3_policy_wan2_only (1 references)
 pkts bytes target     prot opt in     out     source               destination         
  637 44373 MARK       all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00 /* wan2 1 1 */ MARK xset 0x200/0xff00

Chain mwan3_rules (1 references)
 pkts bytes target     prot opt in     out     source               destination         
  697 48560 mwan3_policy_wan1_only  all  --  *      *       192.168.1.145        0.0.0.0/0            mark match 0x0/0xff00 /* dan_zou_wan1 */
  637 44373 mwan3_policy_wan2_only  all  --  *      *       192.168.1.207        0.0.0.0/0            mark match 0x0/0xff00 /* dan_zou_wan2 */
39591 1326K mwan3_policy_all4  all  --  *      *       0.0.0.0/0            0.0.0.0/0            mark match 0x0/0xff00 /* default_rule */</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p307971">
				<div class="post-metadata">
					<div class="post-num">Post #1523</div>
					<div class="post-author">wadja_tn</div>
					<div class="post-datetime">
						17 Jan 2016, 16:18					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><div class="quotebox"><cite>wadja_tn wrote:</cite><blockquote><p>I want to settle this conflict<br />WAN1 &lt;=&gt;LAN1 &amp; WAN2 &lt;=&gt;LAN2 <br />When I start WAN1 ==&gt; WAN2 shut down</p></blockquote></div><p>You have to elaborate some more on your troubles, if you want help from me...</p></blockquote></div><p>I use two dongle 3G in my modem and I want to create two separate networks for each dongle<br />it is done<br />but if one of the dongle is connected the other is disconnected</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p308057">
				<div class="post-metadata">
					<div class="post-num">Post #1524</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						18 Jan 2016, 11:21					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>brick2008 wrote:</cite><blockquote><p>When use the following settings, I found Lan2&#039;s upload traffic is going wan1, anything wrong with my settings??</p></blockquote></div><p>Everything looks perfectly fine. Can&#039;t tell you why you have this problem... If you browse to <a href="https://ipv4.wtfismyip.com/">https://ipv4.wtfismyip.com/</a> from 192.168.1.207? Does it report the right ip address (from wan2)?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p308058">
				<div class="post-metadata">
					<div class="post-num">Post #1525</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						18 Jan 2016, 11:22					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>wadja_tn wrote:</cite><blockquote><p>I use two dongle 3G in my modem and I want to create two separate networks for each dongle<br />it is done<br />but if one of the dongle is connected the other is disconnected</p></blockquote></div><p>Is this also the case it mwan3 is not installed? Do you have both default routes present in the main routing table?</p>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 61 of 65</div><nav><ul><li><a href="viewtopic.php%3Fid=39052&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=59.html">59</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=60.html">60</a></li><li class="pagination-current"><span>61</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=62.html">62</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=63.html">63</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=65.html">65</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0.001 -->

</body>
</html>