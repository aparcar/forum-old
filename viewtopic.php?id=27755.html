<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> How to install applications, if command &quot;ipkg&quot; not found?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 4 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p123397">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">Olvin</div>
					<div class="post-datetime">
						17 Dec 2010, 13:22					</div>
				</div>
				<div class="post-content content">
					<p>I just installed OpenWRT into my Asus WL-600g. Some manuals say that I should use &quot;ipkg&quot; command to get applications. But I receive &quot;command not found&quot; message when I enter it. What is wrong?</p>											<p class="post-edited">(Last edited by <strong>Olvin</strong> on 17 Dec 2010, 13:59)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p123402">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">sovvy</div>
					<div class="post-datetime">
						17 Dec 2010, 14:39					</div>
				</div>
				<div class="post-content content">
					<p>Try &#039;opkg&#039; instead of &#039;ipkg&#039; - should work.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p123403">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						17 Dec 2010, 14:43					</div>
				</div>
				<div class="post-content content">
					<p>&#039;ipkg&#039; was the command in ancient Openwrt versions.<br />Current command is opkg, like explained in the previous message.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p123424">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">Olvin</div>
					<div class="post-datetime">
						17 Dec 2010, 22:03					</div>
				</div>
				<div class="post-content content">
					<p>It works! Thank you! But this command will not useful while I have my ADSL internet unconfigured <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> Can you help me? I wrote theese parameters into /etc/config/network:</p><p>config interface&nbsp; &nbsp; &nbsp;wan <br />&nbsp; &nbsp; &nbsp; option ifname&nbsp; eth0<br />&nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; pppoe <br />&nbsp; &nbsp; &nbsp; option username szt<br />&nbsp; &nbsp; &nbsp; option password&nbsp; szt</p><p>It seems not enough or not correct <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> What must I do to make it work?<br />And one question else. My web browser not shows 192.168.1.1 page. It means that the http server in the router is not up. But should it be so?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p123425">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">written_direcon</div>
					<div class="post-datetime">
						17 Dec 2010, 22:21					</div>
				</div>
				<div class="post-content content">
					<div class="codebox"><pre><code>opkg update
opkg install &lt;name&gt;</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p124160">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">pale</div>
					<div class="post-datetime">
						29 Dec 2010, 23:57					</div>
				</div>
				<div class="post-content content">
					<p>What version of openwrt did you flash. I have backfire 10.03 -1 rc3 running here&nbsp; (r 22711) . 192.168.1.1 should bring up luci .&nbsp; I&#039;m am not sure that the adsl works yet under openwrt. </p><p>pale</p>											<p class="post-edited">(Last edited by <strong>pale</strong> on 29 Dec 2010, 23:59)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p125435">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">zuma</div>
					<div class="post-datetime">
						14 Jan 2011, 18:25					</div>
				</div>
				<div class="post-content content">
					<p>Can you please tell how you installed OpenWRT on your WL-600g?? Thank you!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p126067">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">pale</div>
					<div class="post-datetime">
						20 Jan 2011, 22:18					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>zuma wrote:</cite><blockquote><p>Can you please tell how you installed OpenWRT on your WL-600g?? Thank you!</p></blockquote></div><p>If I recall right I used &quot;weird solutions&quot; &quot; TFTP client&quot; .&nbsp; set your network adaptor to 192.168.1.x ( not 1) then connect this to lan port 1 on the wl-600g.&nbsp; start the TFTP client and ponit the local file name to the flash image on your hard disc. set the server address to 192.168.1.1 set the operation to upload. now click upload. then turn the router on whilst holding in the reset button. the power led should flash red. the router starts a TFTP server on port 192.168.1.1 for a few seconds at boot. </p><p>here is my crib sheet&nbsp; this includes getting the router to boot from usb if you want it. I dont know if the wireless works or not or even how to configure it as I dont need it.</p><p>*******************************************<br /> flash with </p><p><a href="http://downloads.openwrt.org/backfire/10.03.1-rc3/brcm63xx/openwrt-96348GW-generic-squashfs-cfe.bin">http://downloads.openwrt.org/backfire/1 â€¦ fs-cfe.bin</a></p><p>wait 6 minutes</p><p>reboot<br />use putty to<br />telnet to 192.168.1.1</p><p>type passwd <br />then enter new password 2 times</p><p>type reboot<br />close putty<br />open putty ssh to 192.168.1.1<br />and get<br />*********************************************************************************************<br />login as: root<br />root@192.168.1.1&#039;s password:</p><br /><p>BusyBox v1.15.3 (2010-07-11 15:57:41 PDT) built-in shell (ash)<br />Enter &#039;help&#039; for a list of built-in commands.</p><p>&nbsp; _______&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;________&nbsp; &nbsp; &nbsp; &nbsp; __<br /> |&nbsp; &nbsp; &nbsp; &nbsp;|.-----.-----.-----.|&nbsp; |&nbsp; |&nbsp; |.----.|&nbsp; |_<br /> |&nbsp; &nbsp;-&nbsp; &nbsp;||&nbsp; _&nbsp; |&nbsp; -__|&nbsp; &nbsp; &nbsp;||&nbsp; |&nbsp; |&nbsp; ||&nbsp; &nbsp;_||&nbsp; &nbsp;_|<br /> |_______||&nbsp; &nbsp;__|_____|__|__||________||__|&nbsp; |____|<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |__| W I R E L E S S&nbsp; &nbsp;F R E E D O M<br /> Backfire (10.03.1-rc1, r22556) --------------------<br />&nbsp; * 1/3 shot Kahlua&nbsp; &nbsp; In a shot glass, layer Kahlua<br />&nbsp; * 1/3 shot Bailey&#039;s&nbsp; on the bottom, then Bailey&#039;s,<br />&nbsp; * 1/3 shot Vodka&nbsp; &nbsp; &nbsp;then Vodka.<br /> ---------------------------------------------------<br />root@OpenWrt:~#<br />***************************************************************************</p><p><a href="http://192.168.1.1">http://192.168.1.1</a></p><p>change ip address to suitable one and enter default gate way and dns</p><p>click save</p><p>swap network to correct subdomain in my case 192.168.10.nnn</p><p><a href="http://192.168.10.115">http://192.168.10.115</a> ( my routers address)</p><br /><p>install</p><p>kmod-fs-ext3<br />kmod-fs-ext2<br />kmod-fs-mbcache<br />kmod-nls-base<br />kmod-scsi-core<br />kmod-usb-core<br />kmod-usb-storage<br />kmod-usb-ohci<br />kmod-usb2<br />mc</p><p>some of the above get loaded when&nbsp; previouse kmods are installed but i reloaded them anyway to <br />make sure.</p><p>kmod-usb-storage might crash the system reboot and do it again and it should go ok. I dont know why.</p><p>mc is midnight commander which has a file editor in it. comes in handy soon.</p><p>***kmod-fs-vfat<br />***kmod-nls-cp437<br />***kmod-nls-cp850<br />***kmod-nls-iso8859-1<br />***kmod-nls-iso8859-15</p><br /><p>*** might need for vfat drives</p><br /><p>kmod-usb-uhci not used with this chipset</p><p>Install &#039;kmod-usb2&#039;: Error (Code 255)&nbsp; unless kmod-usb-ohci is installed first</p><p>reboot</p><p>partition and format usb stick to ext2<br />i used ubuntu on laptop</p><p>login as: root<br />root@192.168.10.115&#039;s password:</p><br /><p>BusyBox v1.15.3 (2010-07-11 15:57:41 PDT) built-in shell (ash)<br />Enter &#039;help&#039; for a list of built-in commands.</p><p>&nbsp; _______&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;________&nbsp; &nbsp; &nbsp; &nbsp; __<br /> |&nbsp; &nbsp; &nbsp; &nbsp;|.-----.-----.-----.|&nbsp; |&nbsp; |&nbsp; |.----.|&nbsp; |_<br /> |&nbsp; &nbsp;-&nbsp; &nbsp;||&nbsp; _&nbsp; |&nbsp; -__|&nbsp; &nbsp; &nbsp;||&nbsp; |&nbsp; |&nbsp; ||&nbsp; &nbsp;_||&nbsp; &nbsp;_|<br /> |_______||&nbsp; &nbsp;__|_____|__|__||________||__|&nbsp; |____|<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |__| W I R E L E S S&nbsp; &nbsp;F R E E D O M<br /> Backfire (10.03.1-rc1, r22556) --------------------<br />&nbsp; * 1/3 shot Kahlua&nbsp; &nbsp; In a shot glass, layer Kahlua<br />&nbsp; * 1/3 shot Bailey&#039;s&nbsp; on the bottom, then Bailey&#039;s,<br />&nbsp; * 1/3 shot Vodka&nbsp; &nbsp; &nbsp;then Vodka.<br /> ---------------------------------------------------<br />root@OpenWrt:~# dmesg<br />Linux version 2.6.32.16 (openwrt@ampere) (gcc version 4.3.3 (GCC) ) #1 Mon Aug 9 10:18:34 PDT 2010<br />Detected Broadcom 0x6348 CPU revision b0<br />CPU frequency is 256 MHz<br />16MB of RAM installed<br />registering 37 GPIOs<br />board_bcm963xx: CFE version: 1.0.37-0.8<br />bootconsole [early0] enabled<br />CPU revision is: 00029107 (Broadcom BCM6348)<br />board_bcm963xx: board name: 96348GW-10<br />Determined physical RAM map:<br /> memory: 01000000 @ 00000000 (usable)<br />Initrd not found or empty - disabling initrd<br />Zone PFN ranges:<br />&nbsp; Normal&nbsp; &nbsp;0x00000000 -&gt; 0x00001000<br />Movable zone start PFN for each node<br />early_node_map[1] active PFN ranges<br />&nbsp; &nbsp; 0: 0x00000000 -&gt; 0x00001000<br />On node 0 totalpages: 4096<br />free_area_init_node: node 0, pgdat 802981e0, node_mem_map 802df000<br />&nbsp; Normal zone: 32 pages used for memmap<br />&nbsp; Normal zone: 0 pages reserved<br />&nbsp; Normal zone: 4064 pages, LIFO batch:0<br />Built 1 zonelists in Zone order, mobility grouping off.&nbsp; Total pages: 4064<br />Kernel command line: root=/dev/mtdblock2 rootfstype=squashfs,jffs2 noinitrd console=ttyS0,115200<br />PID hash table entries: 64 (order: -4, 256 bytes)<br />Dentry cache hash table entries: 2048 (order: 1, 8192 bytes)<br />Inode-cache hash table entries: 1024 (order: 0, 4096 bytes)<br />Primary instruction cache 16kB, VIPT, 2-way, linesize 16 bytes.<br />Primary data cache 8kB, 2-way, VIPT, no aliases, linesize 16 bytes<br />Memory: 13284k/16384k available (2138k kernel code, 3100k reserved, 455k data, 140k init, 0k highmem)<br />Hierarchical RCU implementation.<br />NR_IRQS:128<br />Calibrating delay loop... 254.97 BogoMIPS (lpj=509952)<br />Mount-cache hash table entries: 512<br />NET: Registered protocol family 16<br />registering PCI controller with io_map_base unset<br />registering PCI controller with io_map_base unset<br />bio: create slab &lt;bio-0&gt; at 0<br />pci 0000:00:01.0: reg 10 32bit mmio: [0x000000-0x001fff]<br />pci 0000:00:07.0: reg 20 io port: [0xfce0-0xfcff]<br />pci 0000:00:07.0: supports D1 D2<br />pci 0000:00:07.0: PME# supported from D0 D1 D2 D3hot<br />pci 0000:00:07.0: PME# disabled<br />pci 0000:00:07.1: reg 20 io port: [0xfce0-0xfcff]<br />pci 0000:00:07.1: supports D1 D2<br />pci 0000:00:07.1: PME# supported from D0 D1 D2 D3hot<br />pci 0000:00:07.1: PME# disabled<br />pci 0000:00:07.2: reg 10 32bit mmio: [0x000000-0x0000ff]<br />pci 0000:00:07.2: supports D1 D2<br />pci 0000:00:07.2: PME# supported from D0 D1 D2 D3hot<br />pci 0000:00:07.2: PME# disabled<br />pci 0000:01:1e.0: CardBus bridge, secondary bus 0000:02<br />pci 0000:01:1e.0:&nbsp; &nbsp;IO window: 0x8008000-0x80080ff<br />pci 0000:01:1e.0:&nbsp; &nbsp;IO window: 0x8008400-0x80084ff<br />pci 0000:01:1e.0:&nbsp; &nbsp;MEM window: 0x38000000-0x3fffffff<br />PCI: Enabling device 0000:01:1e.0 (0000 -&gt; 0003)<br />PCI: Setting latency timer of device 0000:01:1e.0 to 64<br />Switching to clocksource MIPS<br />PCI: Enabling device 0000:00:01.0 (0000 -&gt; 0002)<br />PCI: Setting latency timer of device 0000:00:01.0 to 64<br />ssb: Core 0 found: ChipCommon (cc 0x800, rev 0x0D, vendor 0x4243)<br />ssb: Core 1 found: IEEE 802.11 (cc 0x812, rev 0x09, vendor 0x4243)<br />ssb: Core 2 found: PCI (cc 0x804, rev 0x0C, vendor 0x4243)<br />ssb: Core 3 found: PCMCIA (cc 0x80D, rev 0x07, vendor 0x4243)<br />ssb: Sonics Silicon Backplane found on PCI device 0000:00:01.0<br />NET: Registered protocol family 2<br />IP route cache hash table entries: 1024 (order: 0, 4096 bytes)<br />TCP established hash table entries: 512 (order: 0, 4096 bytes)<br />TCP bind hash table entries: 512 (order: -1, 2048 bytes)<br />TCP: Hash tables configured (established 512 bind 512)<br />TCP reno registered<br />NET: Registered protocol family 1<br />audit: initializing netlink socket (disabled)<br />type=2000 audit(0.382:1): initialized<br />squashfs: version 4.0 (2009/01/31) Phillip Lougher<br />Registering mini_fo version $Id$<br />JFFS2 version 2.2. (NAND) (SUMMARY)&nbsp; Ac 2001-2006 Red Hat, Inc.<br />msgmni has been set to 25<br />io scheduler noop registered<br />io scheduler deadline registered (default)<br />gpiodev: gpio device registered with major 254<br />gpiodev: gpio platform device registered with access mask FFFFFFFF<br />bcm63xx_uart.0: ttyS0 at MMIO 0xfffe0300 (irq = 10) is a bcm63xx_uart<br />console [ttyS0] enabled, bootconsole disabled<br />bcm963xx_flash: 0x00400000 at 0x1fc00000<br />bcm963xx: Found 1 x16 devices at 0x0 in 16-bit bank<br /> Amd/Fujitsu Extended Query Table at 0x0040<br />bcm963xx: Swapping erase regions for broken CFI table.<br />number of CFI chips: 1<br />cfi_cmdset_0002: Disabling erase-suspend-program due to code brokenness.<br />bcm963xx_flash: Read Signature value of CFE1CFE1<br />bcm963xx_flash: CFE bootloader detected<br />bcm963xx_flash: CFE boot tag found with version 6 and board type 96348GW<br />bcm963xx_flash: Partition 0 is CFE offset 0 and length 10000<br />bcm963xx_flash: Partition 1 is kernel offset 10100 and length dff00<br />bcm963xx_flash: Partition 2 is rootfs offset f0000 and length 300000<br />bcm963xx_flash: Partition 3 is nvram offset 3f0000 and length 10000<br />bcm963xx_flash: Partition 4 is linux offset 10000 and length 3e0000<br />bcm963xx_flash: Spare partition is 2a0000 offset and length 150000<br />Creating 5 MTD partitions on &quot;bcm963xx&quot;:<br />0x000000000000-0x000000010000 : &quot;CFE&quot;<br />0x000000010100-0x0000000f0000 : &quot;kernel&quot;<br />mtd: partition &quot;kernel&quot; must either start or end on erase block boundary or be smaller than an erase block -- forcing read-only<br />0x0000000f0000-0x0000003f0000 : &quot;rootfs&quot;<br />mtd: partition &quot;rootfs&quot; set to be root filesystem<br />mtd: partition &quot;rootfs_data&quot; created automatically, ofs=2A0000, len=150000<br />0x0000002a0000-0x0000003f0000 : &quot;rootfs_data&quot;<br />0x0000003f0000-0x000000400000 : &quot;nvram&quot;<br />0x000000010000-0x0000003f0000 : &quot;linux&quot;<br />bcm63xx_enet MII bus: probed<br />bcm63xx_wdt started, timer margin: 30 sec<br />Registered led device: adsl-fail<br />Registered led device: ppp<br />Registered led device: ppp-fail<br />Registered led device: power<br />Registered led device: stop<br />TCP westwood registered<br />NET: Registered protocol family 17<br />802.1Q VLAN Support v1.8 Ben Greear &lt;greearb@candelatech.com&gt;<br />All bugs added by David S. Miller &lt;davem@redhat.com&gt;<br />VFS: Mounted root (squashfs filesystem) readonly on device 31:2.<br />Freeing unused kernel memory: 140k freed<br />Please be patient, while OpenWrt loads ...<br />mini_fo: using base directory: /<br />mini_fo: using storage directory: /overlay<br />bcm63xx_enet bcm63xx_enet.0: attached PHY at address 1 [Broadcom BCM63XX (1)]<br />eth1: link forced UP - 100/full - flow control off/off<br />device eth1 entered promiscuous mode<br />br-lan: port 1(eth1) entering forwarding state<br />Compat-wireless backport release: compat-wireless-2010-07-13-4-g04898a5<br />Backport based on wireless-2.6.git v2.6.35-rc6-48432-gdce358e<br />cfg80211: Calling CRDA to update world regulatory domain<br />SCSI subsystem initialized<br />cfg80211: World regulatory domain updated:<br />&nbsp; &nbsp; (start_freq - end_freq @ bandwidth), (max_antenna_gain, max_eirp)<br />&nbsp; &nbsp; (2402000 KHz - 2472000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)<br />&nbsp; &nbsp; (2457000 KHz - 2482000 KHz @ 20000 KHz), (300 mBi, 2000 mBm)<br />&nbsp; &nbsp; (2474000 KHz - 2494000 KHz @ 20000 KHz), (300 mBi, 2000 mBm)<br />&nbsp; &nbsp; (5170000 KHz - 5250000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)<br />&nbsp; &nbsp; (5735000 KHz - 5835000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)<br />roboswitch: Probing device eth0: Failed to enable switch<br />roboswitch: Probing device eth1: found a 5325! It&#039;s a 5350.<br />usbcore: registered new interface driver usbfs<br />usbcore: registered new interface driver hub<br />usbcore: registered new device driver usb<br />b43-phy0: Broadcom 4318 WLAN found (core revision 9)<br />phy0: Selected rate control algorithm &#039;minstrel&#039;<br />Registered led device: b43-phy0::tx<br />Registered led device: b43-phy0::rx<br />Registered led device: b43-phy0::radio<br />Broadcom 43xx driver loaded [ Features: PL, Firmware-ID: FW13 ]<br />PPP generic driver version 2.4.2<br />ip_tables: (C) 2000-2006 Netfilter Core Team<br />NET: Registered protocol family 24<br />ehci_hcd: USB 2.0 &#039;Enhanced&#039; Host Controller (EHCI) Driver<br />PCI: Enabling device 0000:00:07.2 (0000 -&gt; 0002)<br />ehci_hcd 0000:00:07.2: EHCI Host Controller<br />ehci_hcd 0000:00:07.2: new USB bus registered, assigned bus number 1<br />ehci_hcd 0000:00:07.2: Enabling legacy PCI PM<br />ehci_hcd 0000:00:07.2: irq 32, io mem 0x30002000<br />ehci_hcd 0000:00:07.2: USB 2.0 started, EHCI 1.00<br />usb usb1: configuration #1 chosen from 1 choice<br />hub 1-0:1.0: USB hub found<br />hub 1-0:1.0: 4 ports detected<br />nf_conntrack version 0.5.0 (209 buckets, 836 max)<br />CONFIG_NF_CT_ACCT is deprecated and will be removed soon. Please use<br />nf_conntrack.acct=1 kernel parameter, acct=1 nf_conntrack module option or<br />sysctl net.netfilter.nf_conntrack_acct=1 to enable it.<br />usb 1-2: new high speed USB device using ehci_hcd and address 2<br />usb 1-2: configuration #1 chosen from 1 choice<br />ohci_hcd: USB 1.1 &#039;Open&#039; Host Controller (OHCI) Driver<br />bcm63xx_ohci bcm63xx_ohci.0: BCM63XX integrated OHCI controller<br />bcm63xx_ohci bcm63xx_ohci.0: new USB bus registered, assigned bus number 2<br />bcm63xx_ohci bcm63xx_ohci.0: irq 20, io mem 0xfffe1b00<br />usb usb2: configuration #1 chosen from 1 choice<br />hub 2-0:1.0: USB hub found<br />hub 2-0:1.0: 1 port detected<br />Initializing USB Mass Storage driver...<br />scsi0 : SCSI emulation for USB Mass Storage devices<br />usbcore: registered new interface driver usb-storage<br />USB Mass Storage support registered.<br />usb-storage: device found at 2<br />usb-storage: waiting for device to settle before scanning<br />scsi 0:0:0:0: Direct-Access&nbsp; &nbsp; &nbsp;Generic&nbsp; USB&nbsp; SD Reader&nbsp; &nbsp;1.00 PQ: 0 ANSI: 0 CCS<br />sd 0:0:0:0: Attached scsi generic sg0 type 0<br />sd 0:0:0:0: [sda] 3842048 512-byte logical blocks: (1.96 GB/1.83 GiB)<br />sd 0:0:0:0: [sda] Write Protect is off<br />sd 0:0:0:0: [sda] Mode Sense: 4b 00 00 08<br />sd 0:0:0:0: [sda] Assuming drive cache: write through<br />usb-storage: device scan complete<br />sd 0:0:0:0: [sda] Assuming drive cache: write through<br /> sda: sda1<br />sd 0:0:0:0: [sda] Assuming drive cache: write through<br />sd 0:0:0:0: [sda] Attached SCSI removable disk<br />root@OpenWrt:~#</p><p>now copy system</p><p>mount -t ext2 /dev/sda1 /mnt<br />mkdir /tmp/root<br />mount -o bind / /tmp/root<br />cp /tmp/root/* /mnt -a<br />cd /mnt<br /># make a directory called external so that you can see what root system you are in later<br />mkdir external<br />umount /tmp/root</p><p>Change /etc/init.d/rcS to</p><p>/etc/init.d/rcS:<br />-----------------<br />#!/bin/sh<br /># Copyright (C) 2006 OpenWrt.org</p><p>#output of echo in pivotroot goes to /root/boot</p><p>if [ &quot;$2&quot; = &quot;boot&quot; ]<br />then<br />&nbsp; /root/bin/pivotroot <br />fi&gt;/root/boot</p><p>run_scripts() {<br />&nbsp; &nbsp; &nbsp; &nbsp; for i in /etc/rc.d/$1*; do<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [ -x $i ] &amp;&amp; $i $2 2&gt;&amp;1<br />&nbsp; &nbsp; &nbsp; &nbsp; done | $LOGGER<br />}</p><p>LOGGER=&quot;cat&quot;<br />[ -x /usr/bin/logger ] &amp;&amp; LOGGER=&quot;logger -s -p 6 -t sysinit&quot;</p><p>if [ &quot;$1&quot; = &quot;S&quot; ]; then<br />&nbsp; &nbsp; &nbsp; &nbsp; run_scripts &quot;$1&quot; &quot;$2&quot; &amp;<br />else<br />&nbsp; &nbsp; &nbsp; &nbsp; run_scripts &quot;$1&quot; &quot;$2&quot;<br />fi</p><p>cd /root<br />mkdir bin<br />cd bin<br />vi pivotroot</p><p>#!/bin/sh<br />boot_dev=&quot;/dev/sda1&quot;<br />newroot=&quot;/mnt&quot;<br />oldroot=&quot;/rom&quot;<br />for module in nls_base usbcore ehci-hcd ohci-hcd scsi_mod sd_mod usb-storage jbd mbcache ext3 ext2<br />do {<br />&nbsp; &nbsp; &nbsp; &nbsp; insmod $module 2&gt;&amp;-<br />}; done<br />lsmod</p><p>/etc/init.d/boot start<br />/etc/init.d/usb start</p><p>sleep 10</p><br /><p>echo mounting $boot_dev ...<br />mount &quot;$boot_dev&quot; $newroot</p><p># if everything looks ok, do the pivot root, else just stay on internal flash<br />if [ $? -eq 0 -a -x $newroot/sbin/init ]<br />then<br />&nbsp; &nbsp;cd $newroot<br />&nbsp; &nbsp;echo pivoting...<br />&nbsp; &nbsp;mount -o move /proc $newroot/proc &amp;&amp; {<br />&nbsp; &nbsp; &nbsp;pivot_root $newroot $newroot/rom &amp;&amp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; mount -o move $oldroot/dev /dev<br />&nbsp; &nbsp; &nbsp; &nbsp; mount -o move $oldroot/tmp /tmp<br />&nbsp; &nbsp; &nbsp; &nbsp; mount -o move $oldroot/sys /sys 2&gt;&amp;-<br />&nbsp; &nbsp; &nbsp;}<br />&nbsp; &nbsp;}<br />fi</p><p>chmod 755 pivotroot</p><p>make a directory called internal so that you can see what root system you are in later<br />cd /<br />mkdir internal</p><br /><p>i also edited /etc/banner on flash and usb to say internal or exernal so when you loggin<br />with putty you see in the banner where you are.</p><br /><p>boot and usb need to be run else the system does not see the usb drive. <br />after the system has pivotrooted then it runs all the scripts in the external usb fs /etc/rc.d/Sxx<br />this will include S10boot and S39usb. ie these get run again. this is an advantage as the S10boot will <br />now load in the kmod modules that are sitting on the usb drive in /lib/modules/....<br />thus if any software is installed after the usbfs is booted they get saved to the usb.<br />S39usb doesnt seem to hurt so leave it alone.</p><p>if there is no usb then the system will boot to the internal flash .</p><p>the internal flash is accessable from the /rom directory</p> <br /><p>***************************************88</p><p>sorry for the delay I have been off the internet for some time now.</p>											<p class="post-edited">(Last edited by <strong>pale</strong> on 23 Jan 2011, 19:12)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>