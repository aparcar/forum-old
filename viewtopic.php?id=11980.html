<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> uPNP doesn&#039;t seem to work</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 17 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p53547">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">urosnor</div>
					<div class="post-datetime">
						7 Aug 2007, 23:11					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m using OpenWrt White Russian with X-Wrt Extensions 0.9 (Webif2 r2687) on my Linksys WRT54GL v1.1.<br />miniupnp is installed but uTorrent is complaining that there is no incoming connections. Port check (<a href="http://www.utorrent.com/testport.php?port=&lt;p&gt;">http://www.utorrent.com/testport.php?port=&lt;p&gt;</a>) also fails.</p><p>But in Windows, under the Gateway Properties, I can see the port mappings, they are correct.</p><p>uTorrent log shows me:</p><p>[21:52:57]&nbsp; UPnP: Discovered host: <a href="http://192.168">http://192.168</a>.&lt;x&gt;.1:5000/rootDesc.xml<br />[21:52:57]&nbsp; UPnP: Discovered new device: <a href="http://192.168">http://192.168</a>.&lt;x&gt;.1:5000/ctl/IPConn<br />[21:52:57]&nbsp; UPnP: Mapped TCP port &lt;p&gt; -&gt; 192.168.&lt;x&gt;.&lt;x&gt;:&lt;p&gt;<br />[21:52:57]&nbsp; UPnP: Getting external IP<br />[21:52:57]&nbsp; UPnP: Got external IP: &lt;y&gt;.&lt;y&gt;.&lt;y&gt;.&lt;y&gt;</p><p>Finally, connecting to the router:</p><p>root@OpenWrt:~$ iptables --list<br />Chain INPUT (policy DROP)<br />target&nbsp; &nbsp; &nbsp;prot opt source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination<br />DROP&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; state INVALID<br />ACCEPT&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; state RELATED,ESTABLISHED<br />DROP&nbsp; &nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tcp option=!2 flags:SYN/SYN<br />input_rule&nbsp; all&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere<br />input_wan&nbsp; all&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere<br />LAN_ACCEPT&nbsp; all&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere<br />ACCEPT&nbsp; &nbsp; &nbsp;icmp --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere<br />ACCEPT&nbsp; &nbsp; &nbsp;gre&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere<br />REJECT&nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; reject-with tcp-reset<br />REJECT&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; reject-with icmp-port-unreachable</p><p>Chain FORWARD (policy DROP)<br />target&nbsp; &nbsp; &nbsp;prot opt source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination<br />DROP&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; state INVALID<br />TCPMSS&nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tcp flags:SYN,RST/SYN TCPMSS clamp to PMTU<br />ACCEPT&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; state RELATED,ESTABLISHED<br />forwarding_rule&nbsp; all&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere<br />forwarding_wan&nbsp; all&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere<br />ACCEPT&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere<br />ACCEPT&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere<br />MINIUPNPD&nbsp; all&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere</p><p>Chain LAN_ACCEPT (1 references)<br />target&nbsp; &nbsp; &nbsp;prot opt source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination<br />RETURN&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere<br />RETURN&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere<br />ACCEPT&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere</p><p>Chain MINIUPNPD (1 references)<br />target&nbsp; &nbsp; &nbsp;prot opt source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination<br />ACCEPT&nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;192.168.&lt;x&gt;.&lt;x&gt;&nbsp; &nbsp; &nbsp; tcp dpt:&lt;p&gt;&nbsp; &nbsp; &nbsp; &nbsp; # &lt;-- this is it<br />ACCEPT&nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;192.168.&lt;x&gt;.&lt;x&gt;&nbsp; &nbsp; &nbsp; tcp dpt:&lt;p1&gt;&nbsp; &nbsp; &nbsp; # rest are irrelevant, may be msn<br />ACCEPT&nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;192.168.&lt;x&gt;.&lt;x&gt;&nbsp; &nbsp; &nbsp; tcp dpt:&lt;p2&gt;<br />ACCEPT&nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;192.168.&lt;x&gt;.&lt;x&gt;&nbsp; &nbsp; &nbsp; tcp dpt:&lt;p3&gt;<br />ACCEPT&nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;192.168.&lt;x&gt;.&lt;x&gt;&nbsp; &nbsp; &nbsp; tcp dpt:&lt;p4&gt;</p><p>Chain OUTPUT (policy DROP)<br />target&nbsp; &nbsp; &nbsp;prot opt source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination<br />DROP&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; state INVALID<br />ACCEPT&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; state RELATED,ESTABLISHED<br />output_rule&nbsp; all&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere<br />ACCEPT&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere<br />REJECT&nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; reject-with tcp-reset<br />REJECT&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;anywhere&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; reject-with icmp-port-unreachable</p><p>Chain forwarding_rule (1 references)<br />target&nbsp; &nbsp; &nbsp;prot opt source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination</p><p>Chain forwarding_wan (1 references)<br />target&nbsp; &nbsp; &nbsp;prot opt source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination</p><p>Chain input_rule (1 references)<br />target&nbsp; &nbsp; &nbsp;prot opt source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination</p><p>Chain input_wan (1 references)<br />target&nbsp; &nbsp; &nbsp;prot opt source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination</p><p>Chain output_rule (1 references)<br />target&nbsp; &nbsp; &nbsp;prot opt source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination<br />root@OpenWrt:~$</p><p>The port is truely closed, can&#039;t connected to it.</p><p>Can anyone tell me how to get it work? (Shall I get provide more info? What and how?)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p53548">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">Borromini</div>
					<div class="post-datetime">
						7 Aug 2007, 23:15					</div>
				</div>
				<div class="post-content content">
					<p>I had the same issue with ktorrent, and just as with Oleg&#039;s firmware, UPnP was not working (I do not know what UPnP daemon Oleg uses). I switched back to static forwarding by the router&#039;s firewall, for what it&#039;s worth...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p54382">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">urosnor</div>
					<div class="post-datetime">
						22 Aug 2007, 10:26					</div>
				</div>
				<div class="post-content content">
					<p>It must be working. Any ideas what to do? Replacing by other upnpd (linux-igd?) can be a solution?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p54401">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">Borromini</div>
					<div class="post-datetime">
						22 Aug 2007, 14:16					</div>
				</div>
				<div class="post-content content">
					<p>Well, you say it yourself. Did you try the alternative? As i say i never checked what daemon Oleg&#039;s firmware uses, but it did not work (or only half of the time).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p54726">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">urosnor</div>
					<div class="post-datetime">
						28 Aug 2007, 21:33					</div>
				</div>
				<div class="post-content content">
					<p>OK, I tried linux-igd, and it works perfectly!</p><p>However, it was a bit tricky to install it (at least by webif2): I had to issue &#039;ipkg update&#039;, then &#039;ipkg install libpthread&#039;, after this webif2 was also able install linux-igd.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p56341">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">miniupnp</div>
					<div class="post-datetime">
						24 Sep 2007, 01:06					</div>
				</div>
				<div class="post-content content">
					<p>Both nat AND filter tables should be checked :<br /></p><div class="codebox"><pre><code>iptables -v -n -t nat -L PREROUTING
iptables -v -n -t nat -L MINIUPNPD
iptables -v -n -t filter -L FORWARD
iptables -v -n -t filter -L MINIUPNPD</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p97883">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">xarvox</div>
					<div class="post-datetime">
						25 Nov 2009, 02:22					</div>
				</div>
				<div class="post-content content">
					<p>i had some issues with getting upnp running with my bittorrent clients (utorrent and transmit, mac) untill i found the post above me, but it took me quite a while to figure out what to do with it..</p><p>Just copy/paste line by line from the code part of the beforementioned post into a terminal with a working ssh/telnet connection to the router.</p><p>that and removing all previous attempts (uninstalling software components) and installing only the miniupnpd v1.1-5 package enabled both my clients to respond with a green light next to the port number.</p><p>sorry for stating the obvious, but for some users (me included) its good to have a detailed description when searching for a solution <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p126144">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">tcp422</div>
					<div class="post-datetime">
						21 Jan 2011, 18:53					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m using OpenWRT Backfire 10.03.1-rc4 on a Buffalo WZR-HP-G300NH. I have installed miniupnp and enabled it. </p><p># opkg install luci-app-upnp miniupnpd </p><p># /etc/init.d/miniupnpd enable<br /># /etc/init.d/miniupnpd start</p><p>I then ran the four iptables commands in the previous post and rebooted the router.</p><p>I can see the relevant ports in the firewall like the original poster, but the port does not forward. I can create a static NAT rule, so I&#039;m confident that the service in question is live and that it&#039;s only the miniupnp that isn&#039;t seemingly forwarding the ports.</p><p>Any suggestions on how to debug?</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>