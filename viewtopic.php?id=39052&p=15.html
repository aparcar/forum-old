<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> mwan3; multi-wan policy routing (general topic)</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 22 May 2013 and 6 May 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 15 of 65</div><nav><ul><li><a href="viewtopic.php%3Fid=39052&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=13.html">13</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=14.html">14</a></li><li class="pagination-current"><span>15</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=16.html">16</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=17.html">17</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=65.html">65</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p205559">
				<div class="post-metadata">
					<div class="post-num">Post #351</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						24 Jun 2013, 22:24					</div>
				</div>
				<div class="post-content content">
					<p>Something must be wrong again with your config?</p><p>Please post the info from the troubleshooting tab.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p205585">
				<div class="post-metadata">
					<div class="post-num">Post #352</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						25 Jun 2013, 00:48					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><p><strong>Experimental</strong><br />If you have a working mwan3 setup, you can &quot;tell&quot; the router to always use it&#039;s lan address as the source address for new connections. This way you will be able to also load-balance traffic originating from the router itself:<br /></p><div class="codebox"><pre><code>ip route add default via 127.0.0.1 dev lo src 192.168.x.x</code></pre></div><p>Replace 192.168.x.x with the lan ip address of your router. Mwan3 will now come into play when determining next-hop. Beware that this may effect firewall settings as traffic from the router now also passes the FORWARD chain.</p></blockquote></div><p>Hmmm with a loadbalancing setup my router-generated traffic is using both of my WAN interfaces and I have no loopback alias or extra route configured. Are the latest versions of MWAN3 supposed to control router-generated traffic without any fixes now?</p>											<p class="post-edited">(Last edited by <strong>arfett</strong> on 25 Jun 2013, 05:43)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p205603">
				<div class="post-metadata">
					<div class="post-num">Post #353</div>
					<div class="post-author">ranfish</div>
					<div class="post-datetime">
						25 Jun 2013, 04:22					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><p>Something must be wrong again with your config?</p><p>Please post the info from the troubleshooting tab.</p></blockquote></div><p>OMG,I found two wans offline this moring I just got up...I have changed anything after last time that two wans are up.<br /><a href="http://imgur.com/PjTENw7">http://imgur.com/PjTENw7</a></p><p>MWAN3 Multi-WAN Troubleshooting<br />MWAN3 package versions :<br />mwan3 - 1.2-10<br />luci-app-mwan3 - 1.0-19<br />Firewall default output policy (must be ACCEPT) :<br />ACCEPT<br />Output of &quot;ip route show&quot; :<br />default <br />&nbsp; &nbsp; nexthop via 192.168.3.1&nbsp; dev eth0.3 weight 1<br />&nbsp; &nbsp; nexthop via 42.197.128.1&nbsp; dev pppoe-wan1 weight 1<br />42.197.128.1 dev pppoe-wan1&nbsp; proto kernel&nbsp; scope link&nbsp; src 42.197.138.220 <br />192.168.0.0/24 dev br-lan&nbsp; proto kernel&nbsp; scope link&nbsp; src 192.168.0.1 <br />192.168.3.0/24 dev eth0.3&nbsp; proto static&nbsp; scope link&nbsp; metric 20<br />Output of &quot;ip rule show&quot; :<br />0:&nbsp; &nbsp; from all lookup local <br />32762:&nbsp; &nbsp; from all fwmark 0x1 lookup 1 <br />32763:&nbsp; &nbsp; from 42.197.138.220 lookup 1 <br />32764:&nbsp; &nbsp; from all fwmark 0x2 lookup 2 <br />32765:&nbsp; &nbsp; from 192.168.3.121 lookup 2 <br />32766:&nbsp; &nbsp; from all lookup main <br />32767:&nbsp; &nbsp; from all lookup default<br />Output of &quot;ip route list table 1001-1099&quot; (1001-1015 = interface tables, 1016-1099 = policy tables) :<br />No data found<br />Output of &quot;iptables -L -t mangle -v -n | awk &#039;/mwan3/&#039; RS=&quot; :<br />No data found<br />Output of &quot;ifconfig&quot; :<br />br-lan&nbsp; &nbsp; Link encap:Ethernet&nbsp; HWaddr 20:DC:E6:FD:6C:67&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:192.168.0.1&nbsp; Bcast:192.168.0.255&nbsp; Mask:255.255.255.0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet6 addr: fe80::22dc:e6ff:fefd:6c67/64 Scope:Link<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:255469 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:166554 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:251204694 (239.5 MiB)&nbsp; TX bytes:46246969 (44.1 MiB)<br />eth0&nbsp; &nbsp; &nbsp; Link encap:Ethernet&nbsp; HWaddr 20:DC:E6:FD:6C:67&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet6 addr: fe80::22dc:e6ff:fefd:6c67/64 Scope:Link<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:450508 errors:0 dropped:176 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:420836 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:1000 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:313346939 (298.8 MiB)&nbsp; TX bytes:302585761 (288.5 MiB)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Interrupt:4<br />eth0.1&nbsp; &nbsp; Link encap:Ethernet&nbsp; HWaddr 20:DC:E6:FD:6C:67&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:255469 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:166554 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:251204694 (239.5 MiB)&nbsp; TX bytes:46246969 (44.1 MiB)<br />eth0.2&nbsp; &nbsp; Link encap:Ethernet&nbsp; HWaddr 20:DC:E6:FD:6C:67&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet6 addr: fe80::22dc:e6ff:fefd:6c67/64 Scope:Link<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:71048 errors:0 dropped:1002 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:71199 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:23235271 (22.1 MiB)&nbsp; TX bytes:50089283 (47.7 MiB)<br />eth0.3&nbsp; &nbsp; Link encap:Ethernet&nbsp; HWaddr 20:DC:E6:FD:6C:67&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:192.168.3.121&nbsp; Bcast:192.168.3.255&nbsp; Mask:255.255.255.0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet6 addr: fe80::22dc:e6ff:fefd:6c67/64 Scope:Link<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:123775 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:183073 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:30722110 (29.2 MiB)&nbsp; TX bytes:204565349 (195.0 MiB)<br />lo&nbsp; &nbsp; &nbsp; &nbsp; Link encap:Local Loopback&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:127.0.0.1&nbsp; Mask:255.0.0.0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet6 addr: ::1/128 Scope:Host<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP LOOPBACK RUNNING&nbsp; MTU:16436&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:80 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:80 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:6878 (6.7 KiB)&nbsp; TX bytes:6878 (6.7 KiB)<br />pppoe-wan1 Link encap:Point-to-Point Protocol&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:42.197.138.220&nbsp; P-t-P:42.197.128.1&nbsp; Mask:255.255.255.255<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP POINTOPOINT RUNNING NOARP MULTICAST&nbsp; MTU:1492&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:43673 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:67930 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:3 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:13792114 (13.1 MiB)&nbsp; TX bytes:48496259 (46.2 MiB)<br />wlan1&nbsp; &nbsp; &nbsp;Link encap:Ethernet&nbsp; HWaddr 20:DC:E6:FD:6C:69&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:0 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:4636 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:1000 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:0 (0.0 B)&nbsp; TX bytes:675698 (659.8 KiB)<br />Output of &quot;cat /etc/config/mwan3&quot; :<br />config interface &#039;wan1&#039;<br />&nbsp; &nbsp; option enabled &#039;1&#039;<br />&nbsp; &nbsp; option reliability &#039;2&#039;<br />&nbsp; &nbsp; option count &#039;1&#039;<br />&nbsp; &nbsp; option interval &#039;5&#039;<br />&nbsp; &nbsp; option down &#039;3&#039;<br />&nbsp; &nbsp; option up &#039;8&#039;<br />&nbsp; &nbsp; list track_ip &#039;58.67.145.193&#039;<br />&nbsp; &nbsp; list track_ip &#039;8.8.8.8&#039;<br />&nbsp; &nbsp; list track_ip &#039;211.162.61.236&#039;<br />&nbsp; &nbsp; list track_ip &#039;211.162.79.106&#039;<br />&nbsp; &nbsp; option timeout &#039;5&#039;<br />config interface &#039;wan2&#039;<br />&nbsp; &nbsp; option enabled &#039;1&#039;<br />&nbsp; &nbsp; list track_ip &#039;8.8.8.8&#039;<br />&nbsp; &nbsp; list track_ip &#039;58.67.145.193&#039;<br />&nbsp; &nbsp; option reliability &#039;1&#039;<br />&nbsp; &nbsp; option count &#039;1&#039;<br />&nbsp; &nbsp; option timeout &#039;2&#039;<br />&nbsp; &nbsp; option interval &#039;5&#039;<br />&nbsp; &nbsp; option down &#039;3&#039;<br />&nbsp; &nbsp; option up &#039;8&#039;<br />config member &#039;wan1_m1_w3&#039;<br />&nbsp; &nbsp; option interface &#039;wan1&#039;<br />&nbsp; &nbsp; option metric &#039;1&#039;<br />&nbsp; &nbsp; option weight &#039;3&#039;<br />config member &#039;wan1_m2_w3&#039;<br />&nbsp; &nbsp; option interface &#039;wan1&#039;<br />&nbsp; &nbsp; option metric &#039;2&#039;<br />&nbsp; &nbsp; option weight &#039;3&#039;<br />config member &#039;wan2_m1_w2&#039;<br />&nbsp; &nbsp; option interface &#039;wan2&#039;<br />&nbsp; &nbsp; option metric &#039;1&#039;<br />&nbsp; &nbsp; option weight &#039;3&#039;<br />config member &#039;wan2_m2_w2&#039;<br />&nbsp; &nbsp; option interface &#039;wan2&#039;<br />&nbsp; &nbsp; option metric &#039;2&#039;<br />&nbsp; &nbsp; option weight &#039;2&#039;<br />config policy &#039;wan1_only&#039;<br />&nbsp; &nbsp; list use_member &#039;wan1_m1_w3&#039;<br />config policy &#039;wan2_only&#039;<br />&nbsp; &nbsp; list use_member &#039;wan2_m1_w2&#039;<br />config policy &#039;wan1_wan2_loadbalanced&#039;<br />&nbsp; &nbsp; list use_member &#039;wan1_m1_w3&#039;<br />&nbsp; &nbsp; list use_member &#039;wan2_m1_w2&#039;<br />config policy &#039;wan1_pri_wan2_sec&#039;<br />&nbsp; &nbsp; list use_member &#039;wan1_m1_w3&#039;<br />&nbsp; &nbsp; list use_member &#039;wan2_m2_w2&#039;<br />config policy &#039;wan2_pri_wan1_sec&#039;<br />&nbsp; &nbsp; list use_member &#039;wan1_m2_w3&#039;<br />&nbsp; &nbsp; list use_member &#039;wan2_m1_w2&#039;<br />config rule &#039;other_traffic&#039;<br />&nbsp; &nbsp; option dest_ip &#039;0.0.0.0/0&#039;<br />&nbsp; &nbsp; option use_policy &#039;wan1_wan2_loadbalanced&#039;<br />&nbsp; &nbsp; option proto &#039;all&#039;<br />&nbsp; &nbsp; option equalize &#039;1&#039;<br />Output of &quot;cat /etc/config/network&quot; :<br />config interface &#039;loopback&#039;<br />&nbsp; &nbsp; option ifname &#039;lo&#039;<br />&nbsp; &nbsp; option proto &#039;static&#039;<br />&nbsp; &nbsp; option ipaddr &#039;127.0.0.1&#039;<br />&nbsp; &nbsp; option netmask &#039;255.0.0.0&#039;<br />config interface &#039;lan&#039;<br />&nbsp; &nbsp; option ifname &#039;eth0.1&#039;<br />&nbsp; &nbsp; option type &#039;bridge&#039;<br />&nbsp; &nbsp; option proto &#039;static&#039;<br />&nbsp; &nbsp; option netmask &#039;255.255.255.0&#039;<br />&nbsp; &nbsp; option ipaddr &#039;192.168.0.1&#039;<br />config switch<br />&nbsp; &nbsp; option name &#039;eth0&#039;<br />&nbsp; &nbsp; option reset &#039;1&#039;<br />&nbsp; &nbsp; option enable_vlan &#039;1&#039;<br />config switch_vlan<br />&nbsp; &nbsp; option device &#039;eth0&#039;<br />&nbsp; &nbsp; option vlan &#039;1&#039;<br />&nbsp; &nbsp; option vid &#039;1&#039;<br />&nbsp; &nbsp; option ports &#039;0t 3 4 5&#039;<br />config switch_vlan<br />&nbsp; &nbsp; option device &#039;eth0&#039;<br />&nbsp; &nbsp; option vlan &#039;2&#039;<br />&nbsp; &nbsp; option ports &#039;0t 1&#039;<br />&nbsp; &nbsp; option vid &#039;2&#039;<br />config switch_vlan<br />&nbsp; &nbsp; option device &#039;eth0&#039;<br />&nbsp; &nbsp; option vlan &#039;3&#039;<br />&nbsp; &nbsp; option vid &#039;3&#039;<br />&nbsp; &nbsp; option ports &#039;0t 2&#039;<br />config interface &#039;wan2&#039;<br />&nbsp; &nbsp; option proto &#039;dhcp&#039;<br />&nbsp; &nbsp; option ifname &#039;eth0.3&#039;<br />&nbsp; &nbsp; option metric &#039;20&#039;<br />config interface &#039;wan1&#039;<br />&nbsp; &nbsp; option proto &#039;pppoe&#039;<br />&nbsp; &nbsp; option ifname &#039;eth0.2&#039;<br />&nbsp; &nbsp; option username &#039;zzzzzzzzz&#039;<br />&nbsp; &nbsp; option metric &#039;10&#039;<br />&nbsp; &nbsp; option password &#039;zzzzzzz&#039;</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p205641">
				<div class="post-metadata">
					<div class="post-num">Post #354</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						25 Jun 2013, 13:12					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>ranfish wrote:</cite><blockquote><p>OMG,I found two wans offline this moring I just got up...I have changed anything after last time that two wans are up.</p></blockquote></div><p>As i suspected, your network config is not mwan3 compatible:</p><div class="codebox"><pre><code>Output of &quot;ip route show&quot; :
default
    nexthop via 192.168.3.1  dev eth0.3 weight 1
    nexthop via 42.197.128.1  dev pppoe-wan1 weight 1
42.197.128.1 dev pppoe-wan1  proto kernel  scope link  src 42.197.138.220
192.168.0.0/24 dev br-lan  proto kernel  scope link  src 192.168.0.1
192.168.3.0/24 dev eth0.3  proto static  scope link  metric 20</code></pre></div><p>You are missing default route for each wan interface... but your network config however looks OK. Which version of trunk are you running? Looks like the inner workings of OpenWrt have changed... Are you running otherload-balancing programs?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p205693">
				<div class="post-metadata">
					<div class="post-num">Post #355</div>
					<div class="post-author">gsezen</div>
					<div class="post-datetime">
						25 Jun 2013, 23:43					</div>
				</div>
				<div class="post-content content">
					<p>Simple mwan3 implement on buffalo dsl router</p><p><a href="http://youtu.be/BJQAssUs0HY">http://youtu.be/BJQAssUs0HY</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p205900">
				<div class="post-metadata">
					<div class="post-num">Post #356</div>
					<div class="post-author">md55</div>
					<div class="post-datetime">
						28 Jun 2013, 02:35					</div>
				</div>
				<div class="post-content content">
					<p>Can anyone provide working network/mwan configs for tun0 interface (OpenVpn server)?</p>											<p class="post-edited">(Last edited by <strong>md55</strong> on 28 Jun 2013, 13:54)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p205918">
				<div class="post-metadata">
					<div class="post-num">Post #357</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						28 Jun 2013, 11:38					</div>
				</div>
				<div class="post-content content">
					<p>Adze,</p><p>I updated my router to the lastest AA r37034 and I&#039;m still seeing my router generated traffic be handled by MWAN3. Immediately after a reboot I open two terminals running tcpdump on eth0.1 and wlan0 and have 3 other terminals pinging different addresses and seeing it go out the different interfaces. Mind you I have not done the new experimental route add or alias addition or anything.</p><p>I don&#039;t exactly have direct control over ONLY the router-generated traffic but MWAN3 still handles it with the rule matching only the protocol. If I want to be able to directly control ONLY the router traffic then I need to use your experimental method (ip route add default via 127.0.0.1 dev lo src 192.168.30.1) and create a rule with 192.168.30.1 as the source address.</p><div class="codebox"><pre><code>Software versions : 

OpenWrt - OpenWrt Attitude Adjustment 12.09 (r37034)
mwan3 - 1.2-10
luci-app-mwan3 - 1.1-4

Firewall default output policy (must be ACCEPT) : 

ACCEPT

Output of &quot;ip route show&quot; : 

default via 192.168.51.1 dev eth0.1  proto static  metric 10 
default via 192.168.0.1 dev wlan0  proto static  metric 20 
192.168.0.0/24 dev wlan0  proto static  scope link  metric 20 
192.168.30.0/24 dev br-lan  proto kernel  scope link  src 192.168.30.1 
192.168.50.0/24 via 192.168.51.1 dev eth0.1  proto static  metric 10 
192.168.51.0/24 dev eth0.1  proto static  scope link  metric 10 

Output of &quot;ip rule show&quot; : 

0:    from all lookup local 
1001:    from all fwmark 0x100/0xff00 lookup 1001 
1002:    from all fwmark 0x200/0xff00 lookup 1002 
1016:    from all fwmark 0x1000/0xff00 lookup 1016 
1017:    from all fwmark 0x1100/0xff00 lookup 1017 
1018:    from all fwmark 0x1200/0xff00 lookup 1018 
1019:    from all fwmark 0x1300/0xff00 lookup 1019 
32766:    from all lookup main 
32767:    from all lookup default 

Output of &quot;ip route list table 1001-1099&quot; (1001-1015 = interface tables, 1016-1099 = policy tables) : 

1001
default via 192.168.51.1 dev eth0.1 
1002
default via 192.168.0.1 dev wlan0 
1016
default via 192.168.51.1 dev eth0.1  metric 1 
1017
default via 192.168.0.1 dev wlan0  metric 1 
1018
default via 192.168.51.1 dev eth0.1  metric 1 
default via 192.168.0.1 dev wlan0  metric 2 
1019
default  metric 1 
    nexthop via 192.168.0.1  dev wlan0 weight 5
    nexthop via 192.168.51.1  dev eth0.1 weight 10

Output of &quot;iptables -L -t mangle -v -n | awk &#039;/mwan3/&#039; RS=&quot; : 

Chain PREROUTING (policy ACCEPT 2741 packets, 305K bytes)
 pkts bytes target     prot opt in     out     source               destination         
 2817  313K mwan3_pre  all  --  *      *       0.0.0.0/0            0.0.0.0/0           
 2741  305K fwmark     all  --  *      *       0.0.0.0/0            0.0.0.0/0           

Chain INPUT (policy ACCEPT 1804 packets, 138K bytes)
 pkts bytes target     prot opt in     out     source               destination         
 1852  143K mwan3_post  all  --  *      *       0.0.0.0/0            0.0.0.0/0           

Chain OUTPUT (policy ACCEPT 1660 packets, 377K bytes)
 pkts bytes target     prot opt in     out     source               destination         
 1700  380K mwan3_pre  all  --  *      *       0.0.0.0/0            0.0.0.0/0           

Chain POSTROUTING (policy ACCEPT 2508 packets, 533K bytes)
 pkts bytes target     prot opt in     out     source               destination         
 2576  540K mwan3_post  all  --  *      *       0.0.0.0/0            0.0.0.0/0           

Chain mwan3_default (1 references)
 pkts bytes target     prot opt in     out     source               destination         
    9  1485 MARK       all  --  *      *       0.0.0.0/0            224.0.0.0/3         mark match !0x8000/0x8000 MARK or 0x8000 
   64  5138 MARK       all  --  *      *       0.0.0.0/0            127.0.0.0/8         mark match !0x8000/0x8000 MARK or 0x8000 
    0     0 MARK       all  --  *      *       0.0.0.0/0            192.168.0.0/24      mark match !0x8000/0x8000 MARK or 0x8000 
 2873  464K MARK       all  --  *      *       0.0.0.0/0            192.168.30.0/24     mark match !0x8000/0x8000 MARK or 0x8000 
    0     0 MARK       all  --  *      *       0.0.0.0/0            192.168.50.0/24     mark match !0x8000/0x8000 MARK or 0x8000 
   12   924 MARK       all  --  *      *       0.0.0.0/0            192.168.51.0/24     mark match !0x8000/0x8000 MARK or 0x8000 

Chain mwan3_post (2 references)
 pkts bytes target     prot opt in     out     source               destination         
  170 14125 MARK       all  --  *      wlan0   0.0.0.0/0            0.0.0.0/0           mark match !0x8000/0x8000 MARK xset 0x200/0xff00 
  591  104K MARK       all  --  *      eth0.1  0.0.0.0/0            0.0.0.0/0           mark match !0x8000/0x8000 MARK xset 0x100/0xff00 
 3666  564K MARK       all  --  *      *       0.0.0.0/0            0.0.0.0/0           mark match 0x8000/0x8000 MARK and 0xffff7fff 
 4428  682K CONNMARK   all  --  *      *       0.0.0.0/0            0.0.0.0/0           CONNMARK save mask 0xff00 

Chain mwan3_pre (2 references)
 pkts bytes target     prot opt in     out     source               destination         
 4517  694K CONNMARK   all  --  *      *       0.0.0.0/0            0.0.0.0/0           CONNMARK restore mask 0xff00 
  172 14907 MARK       all  --  wlan0  *       0.0.0.0/0            0.0.0.0/0           MARK xset 0x8200/0xff00 
  508 74409 MARK       all  --  eth0.1 *       0.0.0.0/0            0.0.0.0/0           MARK xset 0x8100/0xff00 
 3837  604K mwan3_default  all  --  *      *       0.0.0.0/0            0.0.0.0/0           mark match !0x8000/0x8000 
  377 41141 mwan3_rules  all  --  *      *       0.0.0.0/0            0.0.0.0/0           mark match 0x0/0xff00 

Chain mwan3_rules (1 references)
 pkts bytes target     prot opt in     out     source               destination         
    1    60 MARK       all  --  *      *       0.0.0.0/0            216.146.38.70       mark match 0x0/0xff00 MARK xset 0x1100/0xff00 
  254 27756 MARK       all  --  *      *       0.0.0.0/0            0.0.0.0/0           mark match 0x0/0xff00 statistic mode random probability 0.666000 MARK xset 0x100/0xff00 
  117 12949 MARK       all  --  *      *       0.0.0.0/0            0.0.0.0/0           mark match 0x0/0xff00 statistic mode random probability 1.000000 MARK xset 0x200/0xff00 
    0     0 MARK       udp  --  *      *       0.0.0.0/0            0.0.0.0/0           multiport sports 0:65535 multiport dports 53,3440 mark match 0x0/0xff00 MARK xset 0x1200/0xff00 
    0     0 MARK       tcp  --  *      *       0.0.0.0/0            0.0.0.0/0           multiport sports 0:65535 multiport dports 22,80,443,3440 mark match 0x0/0xff00 MARK xset 0x1200/0xff00 
    0     0 MARK       all  --  *      *       0.0.0.0/0            0.0.0.0/0           mark match 0x0/0xff00 MARK xset 0x1200/0xff00 


Output of &quot;ifconfig&quot; : 

br-lan    Link encap:Ethernet  HWaddr 02:02:6B:0C:5F:70  
          inet addr:192.168.30.1  Bcast:192.168.30.255  Mask:255.255.255.0
          inet6 addr: fe80::2:6bff:fe0c:5f70/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:4719 errors:0 dropped:0 overruns:0 frame:0
          TX packets:4048 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:569740 (556.3 KiB)  TX bytes:870582 (850.1 KiB)

eth0      Link encap:Ethernet  HWaddr 02:02:6B:0C:5F:70  
          inet6 addr: fe80::2:6bff:fe0c:5f70/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:7037 errors:0 dropped:0 overruns:0 frame:0
          TX packets:6651 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:984428 (961.3 KiB)  TX bytes:1349053 (1.2 MiB)
          Interrupt:5 

eth0.1    Link encap:Ethernet  HWaddr 02:02:6B:0C:5F:70  
          inet addr:192.168.51.2  Bcast:192.168.51.255  Mask:255.255.255.0
          inet6 addr: fe80::2:6bff:fe0c:5f70/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:2186 errors:0 dropped:0 overruns:0 frame:0
          TX packets:2599 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:274311 (267.8 KiB)  TX bytes:444743 (434.3 KiB)

eth0.2    Link encap:Ethernet  HWaddr 02:02:6B:0C:5F:70  
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:4719 errors:0 dropped:0 overruns:0 frame:0
          TX packets:4048 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:569740 (556.3 KiB)  TX bytes:870582 (850.1 KiB)

lo        Link encap:Local Loopback  
          inet addr:127.0.0.1  Mask:255.0.0.0
          inet6 addr: ::1/128 Scope:Host
          UP LOOPBACK RUNNING  MTU:16436  Metric:1
          RX packets:74 errors:0 dropped:0 overruns:0 frame:0
          TX packets:74 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:6427 (6.2 KiB)  TX bytes:6427 (6.2 KiB)

wlan0     Link encap:Ethernet  HWaddr 00:02:6B:0C:5F:70  
          inet addr:192.168.0.22  Bcast:192.168.0.255  Mask:255.255.255.0
          inet6 addr: fe80::202:6bff:fe0c:5f70/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:23292 errors:0 dropped:0 overruns:0 frame:0
          TX packets:289 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:34690539 (33.0 MiB)  TX bytes:33450 (32.6 KiB)

Output of &quot;cat /etc/config/mwan3&quot; : 

config rule &#039;dyndns_wwan&#039;
    option use_policy &#039;wwan_only&#039;
    option dest_ip &#039;216.146.38.70&#039;
    option proto &#039;all&#039;

config rule &#039;all_traffic_balance&#039;
    option proto &#039;all&#039;
    option use_policy &#039;wan_wwan_loadbalance&#039;
    option equalize &#039;1&#039;

config rule &#039;udp_traffic_failover&#039;
    option proto &#039;udp&#039;
    option use_policy &#039;wan_wwan_failover&#039;
    option dest_port &#039;53,3440&#039;

config rule &#039;tcp_traffic_failover&#039;
    option proto &#039;tcp&#039;
    option use_policy &#039;wan_wwan_failover&#039;
    option dest_port &#039;22,80,443,3440&#039;

config rule &#039;all_traffic_failover&#039;
    option proto &#039;all&#039;
    option use_policy &#039;wan_wwan_failover&#039;

config interface &#039;wan&#039;
    option enabled &#039;1&#039;
    option reliability &#039;1&#039;
    option count &#039;1&#039;
    option timeout &#039;2&#039;
    option down &#039;3&#039;
    option up &#039;5&#039;
    option interval &#039;5&#039;
    list track_ip &#039;8.8.8.8&#039;

config interface &#039;wwan&#039;
    option enabled &#039;1&#039;
    option reliability &#039;1&#039;
    option count &#039;1&#039;
    option timeout &#039;2&#039;
    option down &#039;3&#039;
    option up &#039;5&#039;
    list track_ip &#039;8.8.8.8&#039;
    list track_ip &#039;8.8.4.4&#039;
    option interval &#039;5&#039;

config interface &#039;datacard&#039;
    option enabled &#039;0&#039;
    option reliability &#039;1&#039;
    option count &#039;1&#039;
    option timeout &#039;2&#039;
    option interval &#039;5&#039;
    option down &#039;3&#039;
    option up &#039;5&#039;

config member &#039;wan_m1_w10&#039;
    option interface &#039;wan&#039;
    option metric &#039;1&#039;
    option weight &#039;10&#039;

config member &#039;wwan_m1_w5&#039;
    option interface &#039;wwan&#039;
    option metric &#039;1&#039;
    option weight &#039;5&#039;

config member &#039;wwan_m2_w10&#039;
    option interface &#039;wwan&#039;
    option metric &#039;2&#039;
    option weight &#039;10&#039;

config policy &#039;wan_only&#039;
    list use_member &#039;wan_m1_w10&#039;

config policy &#039;wwan_only&#039;
    list use_member &#039;wwan_m1_w5&#039;

config policy &#039;wan_wwan_failover&#039;
    list use_member &#039;wan_m1_w10&#039;
    list use_member &#039;wwan_m2_w10&#039;

config policy &#039;wan_wwan_loadbalance&#039;
    list use_member &#039;wan_m1_w10&#039;
    list use_member &#039;wwan_m1_w5&#039;


Output of &quot;cat /etc/config/network&quot; : 

config interface &#039;loopback&#039;
    option ifname &#039;lo&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;127.0.0.1&#039;
    option netmask &#039;255.0.0.0&#039;

config interface &#039;wan&#039;
    option ifname &#039;eth0.1&#039;
    option proto &#039;dhcp&#039;
    option metric &#039;10&#039;
    option hostname &#039;OpenWrt-F70&#039;

config interface &#039;datacard&#039;
    option proto &#039;3g&#039;
    option device &#039;/dev/USB0&#039;
    option service &#039;evdo&#039;
    option maxwait &#039;20&#039;
    option keepalive &#039;6 30&#039;
    option demand &#039;0&#039;
    option metric &#039;30&#039;

config interface &#039;lan&#039;
    option type &#039;bridge&#039;
    option proto &#039;static&#039;
    option netmask &#039;255.255.255.0&#039;
    option _orig_ifname &#039;eth0.2 wlan0&#039;
    option _orig_bridge &#039;true&#039;
    option ifname &#039;eth0.2&#039;
    option ipaddr &#039;192.168.30.1&#039;

config switch
    option name &#039;rt305x&#039;
    option reset &#039;1&#039;
    option enable_vlan &#039;1&#039;

config switch_vlan
    option device &#039;rt305x&#039;
    option vlan &#039;1&#039;
    option ports &#039;0 6t&#039;

config switch_vlan
    option device &#039;rt305x&#039;
    option vlan &#039;2&#039;
    option ports &#039;1 2 3 4 6t&#039;

config interface &#039;wwan&#039;
    option proto &#039;dhcp&#039;
    option hostname &#039;OpenWrt-F70&#039;
    option peerdns &#039;0&#039;
    option dns &#039;8.8.8.8 8.8.4.4&#039;
    option metric &#039;20&#039;

config route
    option interface &#039;wan&#039;
    option target &#039;192.168.50.0&#039;
    option netmask &#039;255.255.255.0&#039;
    option gateway &#039;192.168.51.1&#039;</code></pre></div>											<p class="post-edited">(Last edited by <strong>arfett</strong> on 28 Jun 2013, 11:55)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p205921">
				<div class="post-metadata">
					<div class="post-num">Post #358</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						28 Jun 2013, 12:15					</div>
				</div>
				<div class="post-content content">
					<p>Hi Arfett,</p><br /><p>I&#039;m seeing the same result here. Even without the loopback trick, router generated traffic is loadbalanced. Kind of neat, but there is a downside...</p><div class="codebox"><pre><code>icmp     1 27 src=213.127.134.91 dst=213.136.13.52 type=8 code=0 id=26327 packets=1 bytes=84 src=213.136.13.52 dst=213.127.134.91 type=0 code=0 id=26327 packets=2 bytes=168 mark=256 use=1
icmp     1 20 src=213.127.134.91 dst=213.136.13.52 type=8 code=0 id=26303 packets=1 bytes=84 src=213.136.13.52 dst=213.127.134.91 type=0 code=0 id=26303 packets=2 bytes=168 mark=256 use=1
icmp     1 23 src=213.127.134.91 dst=213.136.13.52 type=8 code=0 id=26316 packets=1 bytes=84 src=213.136.13.52 dst=213.127.134.91 type=0 code=0 id=26316 packets=2 bytes=168 mark=256 use=1
icmp     1 25 src=213.127.134.91 dst=213.136.13.52 type=8 code=0 id=26319 packets=1 bytes=84 src=213.136.13.52 dst=213.127.134.91 type=0 code=0 id=26319 packets=2 bytes=168 mark=256 use=1
icmp     1 25 src=213.127.134.91 dst=213.136.13.52 type=8 code=0 id=26318 packets=1 bytes=84 src=213.136.13.52 dst=213.154.232.11 type=0 code=0 id=26318 packets=2 bytes=168 mark=512 use=1
icmp     1 24 src=213.127.134.91 dst=213.136.13.52 type=8 code=0 id=26317 packets=1 bytes=84 src=213.136.13.52 dst=213.154.232.11 type=0 code=0 id=26317 packets=2 bytes=168 mark=512 use=1
icmp     1 21 src=213.127.134.91 dst=213.136.13.52 type=8 code=0 id=26304 packets=1 bytes=84 src=213.136.13.52 dst=213.154.232.11 type=0 code=0 id=26304 packets=2 bytes=168 mark=512 use=1
icmp     1 27 src=213.127.134.91 dst=213.136.13.52 type=8 code=0 id=26321 packets=1 bytes=84 src=213.136.13.52 dst=213.154.232.11 type=0 code=0 id=26321 packets=2 bytes=168 mark=512 use=1
icmp     1 26 src=213.127.134.91 dst=213.136.13.52 type=8 code=0 id=26320 packets=1 bytes=84 src=213.136.13.52 dst=213.127.134.91 type=0 code=0 id=26320 packets=2 bytes=168 mark=256 use=1
icmp     1 22 src=213.127.134.91 dst=213.136.13.52 type=8 code=0 id=26309 packets=1 bytes=84 src=213.136.13.52 dst=213.154.232.11 type=0 code=0 id=26309 packets=2 bytes=168 mark=512 use=2</code></pre></div><p>As you can see, the source address before natting is always the gateway with the lowest metric. Then the packet gets handled by mwan3 rules and routed as such. The downside with this behaviour is that setting a source address in an application is not respected and can result in packets not being forwarded to the right gateway.</p><p>I now know why this behaviour has changed. I removed some ip rules that i thought were not important. Turns out they are (thanks for noticing!). I will fix this asap. With this fix you will need the loopback trick again to load-balance router generated traffic.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p205923">
				<div class="post-metadata">
					<div class="post-num">Post #359</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						28 Jun 2013, 12:33					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><p>With this fix you will need the loopback trick again to load-balance router generated traffic.</p></blockquote></div><p>To be clear it will take the following 3 steps:</p><p>1. /etc/config/network<br /></p><div class="codebox"><pre><code>config alias
    option interface &#039;loopback&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;192.168.100.1&#039;
    option netmask &#039;255.255.255.255&#039;</code></pre></div><p>2. /etc/rc.local<br /></p><div class="codebox"><pre><code>ip route add default via 127.0.0.1 dev lo src 192.168.100.1 metric 5</code></pre></div><p>3. Create MWAN3 rule with 192.168.100.1 as source address</p><p>Or am I mistaken?</p>											<p class="post-edited">(Last edited by <strong>arfett</strong> on 28 Jun 2013, 12:33)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p205925">
				<div class="post-metadata">
					<div class="post-num">Post #360</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						28 Jun 2013, 12:44					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>arfett wrote:</cite><blockquote><p>To be clear it will take the following 3 steps:</p></blockquote></div><p>Correct</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p205930">
				<div class="post-metadata">
					<div class="post-num">Post #361</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						28 Jun 2013, 13:27					</div>
				</div>
				<div class="post-content content">
					<p>I fixed the load-balancing of router generated traffic issue. Please update to version 1.2-11.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p205935">
				<div class="post-metadata">
					<div class="post-num">Post #362</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						28 Jun 2013, 14:05					</div>
				</div>
				<div class="post-content content">
					<p>New package files are up for MWAN3 and the LuCI app.</p><p>Adze,</p><p>Seems to me the alias trick renders the default routing table useless as the route with the lowest metric will be directing traffic to the loopback interface?</p><p>Is there any workaround that won&#039;t have this caveat?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p205937">
				<div class="post-metadata">
					<div class="post-num">Post #363</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						28 Jun 2013, 14:15					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>arfett wrote:</cite><blockquote><p>Seems to me the alias trick renders the default routing table useless as the route with the lowest metric will be directing traffic to the loopback interface?</p></blockquote></div><p>I don&#039;t understand... What do you mean by useless?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p205938">
				<div class="post-metadata">
					<div class="post-num">Post #364</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						28 Jun 2013, 14:48					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><div class="quotebox"><cite>arfett wrote:</cite><blockquote><p>Seems to me the alias trick renders the default routing table useless as the route with the lowest metric will be directing traffic to the loopback interface?</p></blockquote></div><p>I don&#039;t understand... What do you mean by useless?</p></blockquote></div><p>Meaning any traffic using the default routing table goes nowhere.</p>											<p class="post-edited">(Last edited by <strong>arfett</strong> on 28 Jun 2013, 14:49)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p205939">
				<div class="post-metadata">
					<div class="post-num">Post #365</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						28 Jun 2013, 14:51					</div>
				</div>
				<div class="post-content content">
					<p>That&#039;s only true if mwan3 is not &quot;running&quot;. If mwan3 is running it marks traffic flows, which in turn use custom routing tables to route traffic.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p205940">
				<div class="post-metadata">
					<div class="post-num">Post #366</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						28 Jun 2013, 14:53					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><p>That&#039;s only true if mwan3 is not &quot;running&quot;. If mwan3 is running it marks traffic flows, which in turn use custom routing tables to route traffic.</p></blockquote></div><p>If the first (or only) rule specifies all traffic use the default routing table then there is no connectivity. And correct me if I&#039;m wrong but any traffic which does not match a rule goes through the default routing table as well.</p><p>I don&#039;t see it being a huge issue it just means that any and all traffic that you want to get anywhere will need to be controlled by an MWAN3 rule rather than being able to let unspecified traffic fall through.</p>											<p class="post-edited">(Last edited by <strong>arfett</strong> on 28 Jun 2013, 15:02)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p205943">
				<div class="post-metadata">
					<div class="post-num">Post #367</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						28 Jun 2013, 15:54					</div>
				</div>
				<div class="post-content content">
					<p>Good point. I will crack my head around this (small) issue.</p><p>Maybe i will revert back to version 1.2-10 and let router generated traffic being load-balanced as default. Users can make their own rules for specific flows if they don&#039;t want this...</p>											<p class="post-edited">(Last edited by <strong>Adze</strong> on 28 Jun 2013, 15:57)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p205972">
				<div class="post-metadata">
					<div class="post-num">Post #368</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						28 Jun 2013, 22:41					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><p>Good point. I will crack my head around this (small) issue.</p><p>Maybe i will revert back to version 1.2-10 and let router generated traffic being load-balanced as default. Users can make their own rules for specific flows if they don&#039;t want this...</p></blockquote></div><p>I kind of think the issues with 1.2-10 were more of a bug and serious issue since it wouldn&#039;t honor the source address on packets coming from clients as well as the router (I think or did it only affect the router traffic?)</p><p>The issue with 1.2-11 is sort of &#039;the way it is&#039; and not really a showstopper for any applications since you can just create a rule for your traffic.</p><p>If you wouldn&#039;t mind I&#039;d like to chat with you on google chat about a few things in the MWAN3 scripts. I&#039;d like to better understand a few things so I can help track down bugs and test fixes/features.</p><br /><p>PS. if the code goes back to 1.2-10 the experimental method of controlling traffic should be removed from the first post. The reason I even started investigating the router-generated traffic on 1.2-10 was I noticed my MWAN3 rule for traffic with source 192.168.30.1 (my LAN address) wasn&#039;t matching any packets.</p><p>If it stays the same maybe the first post should be updated with the three steps of the alias method. I have these notes on the GUI but not everyone uses the GUI.</p>											<p class="post-edited">(Last edited by <strong>arfett</strong> on 28 Jun 2013, 22:52)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p206208">
				<div class="post-metadata">
					<div class="post-num">Post #369</div>
					<div class="post-author">ranfish</div>
					<div class="post-datetime">
						2 Jul 2013, 04:01					</div>
				</div>
				<div class="post-content content">
					<p>How can mwan3 let traffic just go through wan1 when wan2 is down,but still use wan2 next time when it is on.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p206226">
				<div class="post-metadata">
					<div class="post-num">Post #370</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						2 Jul 2013, 09:57					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>ranfish wrote:</cite><blockquote><p>How can mwan3 let traffic just go through wan1 when wan2 is down,but still use wan2 next time when it is on.</p></blockquote></div><p>1. Create 2 members: one for each wan. Set the metric for wan1 higer than the metric for wan2.<br />2. Create a policy and add the two members created above.<br />3. Add a policy and set it to use the policy just created.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p206297">
				<div class="post-metadata">
					<div class="post-num">Post #371</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						3 Jul 2013, 00:42					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>ranfish wrote:</cite><blockquote><p>How can mwan3 let traffic just go through wan1 when wan2 is down,but still use wan2 next time when it is on.</p></blockquote></div><p>If you mean load balance on both wan1 and wan2 when they are both online and only use wan1 if wan2 is offline then a standard load balancing setup will do the trick. This will also allow traffic to only use wan2 while wan1 is offline</p><p>1. Create 2 members: one for each wan. Set the metric for wan1 the SAME as metric for wan2. Set the weight on each to dermine how much of the load will go across each one when they are both online (example: weight of 4 on wan1 and weight of 2 on wan2 would send twice as much data out wan1.)<br />2. Create a policy and add the two members created above.<br />3. Add a policy and set it to use the policy just created.</p>											<p class="post-edited">(Last edited by <strong>arfett</strong> on 3 Jul 2013, 00:43)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p206461">
				<div class="post-metadata">
					<div class="post-num">Post #372</div>
					<div class="post-author">jooe</div>
					<div class="post-datetime">
						5 Jul 2013, 02:44					</div>
				</div>
				<div class="post-content content">
					<p>Good evening! I use Mwan3&nbsp; with 3 interfaces, everything works fine. The speed of my internet connections 10, 8 and 4 megabits. It is possible to add two interfaces at a rate of 4 megabits. What values should be set in the weight?<br />Sorry for my very bad english, i&nbsp; use google translator.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p206462">
				<div class="post-metadata">
					<div class="post-num">Post #373</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						5 Jul 2013, 03:07					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>jooe wrote:</cite><blockquote><p>Good evening! I use Mwan3&nbsp; with 3 interfaces, everything works fine. The speed of my internet connections 10, 8 and 4 megabits. It is possible to add two interfaces at a rate of 4 megabits. What values should be set in the weight?<br />Sorry for my very bad english, i&nbsp; use google translator.</p></blockquote></div><p>You could just use the mbits as the weights, 10, 8, 4, 4, 4</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p206465">
				<div class="post-metadata">
					<div class="post-num">Post #374</div>
					<div class="post-author">md55</div>
					<div class="post-datetime">
						5 Jul 2013, 04:47					</div>
				</div>
				<div class="post-content content">
					<p>I use Mwan3 with 2 interfaces: static as main and pppoe for intra-ISP subnet.<br />config &#039;rule&#039;<br />&nbsp; &nbsp; option &#039;dest_ip&#039; &#039;&lt;isp subnet&gt;&#039;<br />&nbsp; &nbsp; option &#039;use_policy&#039; &#039;pppoe_link&#039;</p><p>There is also OpenVpn server on this router.<br />I can connect to OpenVpn from intra-ISP subnet to pppoe IP only via tcp. When I try udp, response is routed back via static IP instead of pppoe IP.<br />So why udp works different from tcp?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p206466">
				<div class="post-metadata">
					<div class="post-num">Post #375</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						5 Jul 2013, 04:50					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>md55 wrote:</cite><blockquote><p>I use Mwan3 with 2 interfaces: static as main and pppoe for intra-ISP subnet.<br />config &#039;rule&#039;<br />&nbsp; &nbsp; option &#039;dest_ip&#039; &#039;&lt;isp subnet&gt;&#039;<br />&nbsp; &nbsp; option &#039;use_policy&#039; &#039;pppoe_link&#039;</p><p>There is also OpenVpn server on this router.<br />I can connect to OpenVpn from intra-ISP subnet to pppoe IP only via tcp. When I try udp, response is routed back via static IP instead of pppoe IP.<br />So why udp works different from tcp?</p></blockquote></div><p>Care to post more information? If you&#039;re using the LuCI application copy/paste the contents of the troubleshooting page into a forum code block. If not then get all of the troubleshooting information shown in the first post manually and paste into a forum code block.</p>											<p class="post-edited">(Last edited by <strong>arfett</strong> on 5 Jul 2013, 04:52)</p>
									</div>
			</article>

			
		
						<div class="notice">
				<p>Sorry, posts 376 to 375 are missing from our archive.</p>
			</div>
		
		
	
	<div class="pagination"><div class="pagination-number">Page 15 of 65</div><nav><ul><li><a href="viewtopic.php%3Fid=39052&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=13.html">13</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=14.html">14</a></li><li class="pagination-current"><span>15</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=16.html">16</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=17.html">17</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=65.html">65</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>