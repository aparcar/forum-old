<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> CVE-2016-0728 patch - ToDo?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 12 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p308318">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">czezz</div>
					<div class="post-datetime">
						20 Jan 2016, 13:02					</div>
				</div>
				<div class="post-content content">
					<p>Hi,<br />kernel patch for CVE-2016-0728 for OpenWRT has been released. See following link.<br /><a href="https://forum.openwrt.org/viewtopic.php?id=62258">https://forum.openwrt.org/viewtopic.php?id=62258</a></p><p>My question is: how do I proceed now ?<br />My router is: TP-LINK TL-WR841N/ND v9</p><p>Does it mean I need to:<br />1. find source of OpenWRT image for my router (where kernel source code is)<br />2. patch kernel <br />3. compile kernel<br />4. create OS image<br />5. upload newly created image ?<br />OR:<br />1. should I wait for official OpenWRT image for my router ?</p><p>Can anyone please advise what is the way forward now ?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p308324">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">arokh</div>
					<div class="post-datetime">
						20 Jan 2016, 13:57					</div>
				</div>
				<div class="post-content content">
					<p>You can do either of these:</p><p>1. Install a trunk daily snapshot<br />2. Pull down the current CC branch which has the fix and compile it<br />3. Pull down the source to whatever version you have now and manually add the patch then compile it<br />4. Ignore the CVE as you need local access to exploit it and the only local user you have is already root</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p308331">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">czezz</div>
					<div class="post-datetime">
						20 Jan 2016, 14:12					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for quick reply. A few questions to it:</p><p>1. Where do I find daily snapshots ?<br />2. What is CC branch ? Where do I find it?<br />3. <a href="https://downloads.openwrt.org/latest/ar71xx/generic/OpenWrt-ImageBuilder-15.05-ar71xx-generic.Linux-x86_64.tar.bz2">https://downloads.openwrt.org/latest/ar … 64.tar.bz2</a> I guess this is source of my OS ? And to build it, it requires <a href="https://downloads.openwrt.org/latest/ar71xx/generic/OpenWrt-SDK-15.05-ar71xx-generic_gcc-4.8-linaro_uClibc-0.9.33.2.Linux-x86_64.tar.bz2">https://downloads.openwrt.org/latest/ar … 64.tar.bz2</a></p>											<p class="post-edited">(Last edited by <strong>czezz</strong> on 20 Jan 2016, 14:46)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p308334">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">arokh</div>
					<div class="post-datetime">
						20 Jan 2016, 14:31					</div>
				</div>
				<div class="post-content content">
					<p>Are you somehow unable to access the internet and google?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p308340">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">czezz</div>
					<div class="post-datetime">
						20 Jan 2016, 14:46					</div>
				</div>
				<div class="post-content content">
					<p>Really ?<br />Does it make feel u better when u answer like that ?</p><p>I could have not asked for anything here and google it, right?<br />But there is this forum for some reason and for some reason ppl write questions here...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p308344">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">arokh</div>
					<div class="post-datetime">
						20 Jan 2016, 14:56					</div>
				</div>
				<div class="post-content content">
					<p>I could probably have written that in a more polite way <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> Anyway, you&#039;ll find that questions that are answered by putting them in the top bar of your browser will usually go unanswered on the forum. Put some effort in yourself and come back if you are stuck on something.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p308410">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">slh</div>
					<div class="post-datetime">
						20 Jan 2016, 23:52					</div>
				</div>
				<div class="post-content content">
					<p>Just to add some perspective to the issue.</p><p>CVE-2016-0728 is a <strong>local</strong> privilege escalation bug in the kernel, not a remote exploit. In other words, you need to have access (not as in, &quot;ping, it&#039;s there in my LAN&quot;, but as in &quot;I already have a shell (or an equivalent caused by another security bug in some networking dæmon) on the router&quot;) to the router already, in order to use this bug to gain root access.</p><p>For linux servers with multiple untrusted users, linux workstations or android, this is a really serious issue and needs to be fixed as soon as possible. The same goes for any linux systems where untrusted users have some kind of shell(-like) access, directly or indirectly (PHP, python, perl webhosting, etc.). Furthermore history tells that you just have to wait for a tiny remote exploit in some other world-facing service to combine said external weakness with a local privilege escalation bug to get it, so issues like these deserve fixing quickly either way.</p><p>Now look at the OpenWrt specific case, by which I mean the router use-case - not an everything-and-the-kitchen sink configuration, but something you can reasonably call a router (even a quite full-featured router). OpenWrt is a single-user system (not quite, but basically), which means all dæmons are running as root, there are no unprivileged shell accounts or unprivileged services (on my own OpenWrt router, dnsmasq is the only dæmon not running as root), so once you find a security bug in any of these, you already have uid=0 and don&#039;t needs this local privilege escalation anymore… But at the same time there typically aren&#039;t any external attack surfaces, certainly not towards the WAN interface, but neither towards the LAN interface (you already need the root password to log into the router, by default there are no services which allow non-root LAN users to upload- or execute anything on the router), which means the security impact for this particular issue for OpenWrt is pretty low --&gt; in order to exploit this bug, you need to find a(nother) remote exploit, at which time you already have root access and don&#039;t need this bug anymore.</p><p>For embedded systems (like OpenWrt), with no unprivileged user access and rather targetted functionality (and software installs), kernel bugs (other than weaknesses regarding the generation of entropy) are rarely a big problem - most of the time, the broken code isn&#039;t even enabled (in order to keep the image size low) and the far bigger danger lies with ubiquitous userspace services (busybox, uhttpd, musl, pppd, dnsmasq, hostapd, etc.), rather than the kernel itself - because those have an external attack surface, the kernel typically does not (except for device hotplug issues). This doesn&#039;t mean security bugs should be ignored and remain unfixed, just because there isn&#039;t an immediately obvious way to exploit the issue, but it puts the serverity of this particular bug into perspective. But despite of all this, the bug was fixed immediately (yesterday) in OpenWrt&#039;s svn, both for trunk and the CC branches (of course you need fresh builds to actually get these fixes).</p><p>Now, after all this wall of text, let&#039;s have a look at the code - shall we?<br />CVE-2016-0728 is a bug in the kernel&#039;s keyring support code, a relatively recent feature for userspace to offload keys into kernel space for security purposes. The faulty code is guarded by CONFIG_KEYS in the kernel, while this is something typically enabled on general purpose linux systems (servers, workstations, android, etc.), it is disabled (by default) for OpenWrt (at least for all architectures other than omap, if in doubt, you aren&#039;t using TI OMAP ARM SOCs as router). So with- or without the patch, OpenWrt isn&#039;t affected by <strong>this</strong> bug anyways (unless you&#039;ve jumped through quite some hoops to force-enable this feature in your local builds), because the whole feature -including this bug- is disabled for OpenWrt.</p>											<p class="post-edited">(Last edited by <strong>slh</strong> on 21 Jan 2016, 00:10)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p308464">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">bolvan</div>
					<div class="post-datetime">
						21 Jan 2016, 11:04					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m on the week ago self compiled trunk with internal build system (gcc, make, ...)<br />I&#039;ve compiled public exploit cve_2016_0728.c. It doesnt work on my system.</p><div class="codebox"><pre><code>user@router:~/tmp$ ./cve_2016_0728 PP_KEY
uid=1000, euid=1000
keyctl: Function not implemented</code></pre></div>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>