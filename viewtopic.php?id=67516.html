<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> What are my debricking possibilities?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 11 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p338037">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">arsenij.c.o</div>
					<div class="post-datetime">
						12 Sep 2016, 16:21					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>A little background, which can be (and probably should be) skipped to &quot;The Problem&quot; part:</p><p>I was using OpenWrt 15.05 on my router (tp-link tl-wr842nd v2) for about a year and then decided to upgrade to trunk (mainly I wanted latest versions of certain packages). But what I really wanted is not just upgrading but to learn image building. I knew in theory that it can be used as an easy way to upgrade by building complete images for my router with all the packages I need already configured.</p><p>It was easy to learn and it worked perfectly. </p><p>All worked nice and smoothly - second WAN via 4G modem, QoS, Adblock, load balancing via Mwan3 on two OpenVPN connections via two WAN interfaces, custom hotplug scripts and cron jobs - everything worked great right after flashing an upgrade, no additional configuration needed.</p><p>Then I decided to build another image with one more package.</p><p>For building images I was using another PC with Debian OS across the internet and for some reason I used dropbox to transfer image files between that PC and the one which was connected to my router. Then WinSCP to upload the image to router.</p><p>I was so happy that I completely forgot to do checksum verification before issuing sysupgrade command.</p><p>As you probably guessed dropbox hasn&#039;t finished synchronization of that image when I transferred it to my router&#039;s tmp folder.</p><p>White piece of plastic with two sticking out antennas looked more dead than piece of plastic actually could.</p><p>I don&#039;t know what exactly I flashed and there is no way I could now: dropbox has finished image sync 1 minute after winscp transfer, judging by its log.<br />Afaik, dropbox does sync on block level, so that image should&#039;ve been wrong only partially.</p><p>=&gt; The Problem:</p><p>Router tp-link tl-wr842nd v2 is in a brick state: after powering it on the power led turns on and continues to light without flashing. Nothing else happens. No network activity on any port.</p><p>The first thing I tried is a recovery method via tftp server. Following the guide I pressed WPS/RESET button while powering on the device until I saw Lock LED is on.<br />TFPT server was running and PC&#039;s ip was 192.168.0.66 but I saw no activity. Not even in tcpdump.</p><p>Does the lack of network activity after entering failsafe mode mean that even my bootloader not functioning anymore?<br />Is it actually possible considering the image I used was the sysupgrade image (with bad blocks)?</p><p>If bootloader is indeed dead, what else could be done?<br />I&#039;ve never done anything with serial ports and have no skill in soldering but I want to try and debrick this router.<br />I already bought a new one so it&#039;s all is just an attempt to learn more and probably get some new skills.</p><p>Sorry for a long post and my bad english. And thanks for your time.<br />Any help is much appreciated.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p338051">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">rkeidar</div>
					<div class="post-datetime">
						12 Sep 2016, 18:17					</div>
				</div>
				<div class="post-content content">
					<p>Please check your IP address, router expects 192.168.1.66, not&nbsp; 192.168.0.66</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p338061">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">HooTooJunkie</div>
					<div class="post-datetime">
						12 Sep 2016, 19:28					</div>
				</div>
				<div class="post-content content">
					<p><strong>@arsenij.c.o</strong><br />If it still fails, your only last hope may be using the direct Serial Hardware Console, within the router, if one exists that&#039;s accessible.<br />Sometimes the area is marked with TX - RX - Gnd&nbsp; (Gnd=Ground of the circuit board power minus-pin)<br />...it&#039;s accessed with a USB to Serial Cable + driver, and the terminal called PuTTY, on a windows PC, it may be similar on others...I think Linux has it built-In to the OS...but you still need the cable. <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Sometimes there&#039;s no getting around it, and commands are needed to be made directly from the circuits serial console.</p><p>This YouTube video of un bricking the model one under yours, may help you make sure you&#039;re doing it as needed if it should work for you.<br /><a href="https://www.youtube.com/watch?v=0k1sxwX5pMk">https://www.youtube.com/watch?v=0k1sxwX5pMk</a></p><p>Good luck.</p>											<p class="post-edited">(Last edited by <strong>HooTooJunkie</strong> on 12 Sep 2016, 19:43)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p338098">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">arsenij.c.o</div>
					<div class="post-datetime">
						13 Sep 2016, 00:13					</div>
				</div>
				<div class="post-content content">
					<p>Thanks for replies!</p><p>I managed to debrick it.<br />TL;DR: flashing firmware via recovery mode and tftp server worked. </p><p>For some reason when I attempted flashing via tftp for the first time both wireshark and tftp server on my windows PC showed no activity no matter what I tried.<br />That&#039;s why I thought that maybe bootloader is dead.</p><p>Today I did the exact recovery procedure but from another OpenWRT router instead of windows PC and everything worked from my first attempt. Just enabled tftp in dnsmasq config and uploaded recovery image to tftp root dir. Hail to the Linux!<br />I got factory router and now its back on OpenWRT.</p><div class="quotebox"><cite>rkeidar wrote:</cite><blockquote><p>Please check your IP address, router expects 192.168.1.66, not&nbsp; 192.168.0.66</p></blockquote></div><p>Tcpdump showed that bricked device asks for 192.168.0.66, and it worked, maybe subnet is different for different devices? I googled a bit and it looks like v1 of my router asks 192.168.1.66 indeed.</p><div class="quotebox"><cite>HooTooJunkie wrote:</cite><blockquote><p>If it still fails, your only last hope may be using the direct Serial Hardware Console, within the router, if one exists that&#039;s accessible.</p></blockquote></div><p>Thanks for the info, I want to try connecting via serial cable anyway because that&#039;s very interesting stuff. I even found one already.</p>											<p class="post-edited">(Last edited by <strong>arsenij.c.o</strong> on 13 Sep 2016, 00:15)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>