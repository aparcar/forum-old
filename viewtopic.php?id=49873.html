<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> seafile on openWRT</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 30 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p229133">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">udotirol</div>
					<div class="post-datetime">
						3 Apr 2014, 19:01					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>I intend to package seafile [1] for openWRT. Before I get my hands too dirty I wanted to ask </p><p>#1 if someone has already tried to package it (google did not tell much) and <br />#2 if there are any caveats in general when it comes to package python based applications for openWRT</p><p>seafile has already been produced for the RPi, so it should be doable for openWRT as well - I hope <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>[1] <a href="https://github.com/haiwen/seafile">https://github.com/haiwen/seafile</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p240526">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">onlinespending</div>
					<div class="post-datetime">
						17 Jul 2014, 08:54					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>udotirol wrote:</cite><blockquote><p>Hi,</p><p>I intend to package seafile [1] for openWRT</p></blockquote></div><p>Any luck with this? I&#039;m interested in trying Seafile out for openwrt</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p240546">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">benba</div>
					<div class="post-datetime">
						17 Jul 2014, 12:23					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m also interested, and do some searches, but i haven&#039;t also luck.<br />But for self package i did some basic researches:</p><p><strong>seafile Prerequisites (debian)&nbsp; &nbsp; &nbsp; OpenWRT</strong></p><p>python 2.6.5+ or 2.7&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;python_2.7.3-2_ar71xx.ipk<br />python-setuptools&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -<br />python-simplejson&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -<br />python-imaging&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;python-imaging-library_1.1.7-2_ar71xx.ipk<br />sqlite3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-<br />dep:&nbsp; &nbsp; &nbsp;libc0.1&nbsp; &nbsp; / libc0.1-udeb&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;libc_0.9.33.2-1_ar71xx.ipk&nbsp; &nbsp;<br />dep:&nbsp; &nbsp; &nbsp;libc6&nbsp; &nbsp; / libc6-udeb&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-<br />dep:&nbsp; &nbsp; &nbsp;libc6.1 / libc6.1-udeb&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -<br />dep:&nbsp; &nbsp; &nbsp;libreadline6&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; libreadline_6.2-1_ar71xx.ipk&nbsp; <br />dep:&nbsp; &nbsp; &nbsp;libsqlite3-0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;libsqlite3_3080403-1_ar71xx.ipk</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p241030">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">TurtleTech</div>
					<div class="post-datetime">
						22 Jul 2014, 05:39					</div>
				</div>
				<div class="post-content content">
					<p>also interested...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p254763">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">geryhun</div>
					<div class="post-datetime">
						18 Nov 2014, 13:02					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m working on this currently, my intention is to create packages for the server components of Seafile. It looks to me I&#039;ll need to create 3 packages (maybe more in case there are any missing dependencies):</p><p>* libsearpc<br />* seafile-ccnet<br />* seafile-server</p><p>I&#039;m facing an issue now that the compilation does not start for some reason without any error messages, hopefully it will be solved soon so I can go on with the packaging process:</p><p><a href="https://forum.openwrt.org/viewtopic.php?pid=254761">https://forum.openwrt.org/viewtopic.php?pid=254761</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p255036">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">geryhun</div>
					<div class="post-datetime">
						20 Nov 2014, 16:54					</div>
				</div>
				<div class="post-content content">
					<p>I could successfully make 4 packages already:</p><p>* libsearpc<br />* libzdb<br />* seafile-ccnet<br />* vala (needed for building ccnet)</p><p>Only one more to go (seafile-server) so stay tuned! <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p255138">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">maplewang</div>
					<div class="post-datetime">
						21 Nov 2014, 20:10					</div>
				</div>
				<div class="post-content content">
					<p>Good jobs, you use the latest version of OpenWRT?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p255781">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">geryhun</div>
					<div class="post-datetime">
						27 Nov 2014, 21:46					</div>
				</div>
				<div class="post-content content">
					<p>And finally, I&#039;m done! <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Seafile runs perfectly on my Netgear WNDR4300 router:</p><div class="codebox"><pre><code>root@OpenWrt:/# IPKG_INSTROOT=/mnt/extroot opkg -d ext install seafile-server
Installing seafile-server (3.1.7-1) to ext...
Downloading file:///mnt/packages/seafile/seafile-server_3.1.7-1_ar71xx.ipk.
Installing seafile-ccnet (3.1.7-1) to ext...
Downloading file:///mnt/packages/seafile/seafile-ccnet_3.1.7-1_ar71xx.ipk.
Installing seafile-seahub (3.1.7-1) to ext...
Downloading file:///mnt/packages/seafile/seafile-seahub_3.1.7-1_ar71xx.ipk.
Configuring seafile-ccnet.
*** Creating ccnet configuration...
*** NOTE: a default configuration has been created for ccnet in file /mnt/extroot/usr/share/seafile/ccnet/ccnet.conf
*** You may want to modify the NAME and SERVICE_URL parameters to match your requirements.
Configuring seafile-seahub.
*** Creating Seahub configuration...
Done.
*** Creating Seahub database...
Done.
*** Creating symlink for Seahub&#039;s avatar directory...
Done.
Configuring seafile-server.
*** Creating configuration...
Done.
*** Installation completed, your Seafile server should start up now automatically.

*** If this is the first time you installed Seafile, you&#039;ll need to create an administrative login.
*** To do so, please run the script &quot;/mnt/extroot/usr/share/seafile/seafile-server/reset-admin.sh&quot;

*** Once done, open the URL &quot;http://&lt;your_routers_ip_address&gt;:8000/&quot; in your browser to log in.
*** WARNING: this is a plain, unencrypted HTTP connection. To have secure access to your files, use HTTPS instead.
*** Please read http://manual.seafile.com/deploy/https_with_nginx.html to learn how to do that.

*** Enjoy using Seafile!
Seahub is not running
Done.

seafile server not running yet
Done.
Starting seafile server, please wait ...
Seafile server started

Done.
Starting seahub at port 8000 ...
Loading ccnet config from /mnt/extroot/usr/share/seafile/ccnet
Loading seafile config from /mnt/extroot/usr/share/seafile/seafile-data

Seahub is started

Done.</code></pre></div><p>It took more than a week of hard work until I could fix all issues standing in my way but nevermind, at least I have it running now. <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Some of the features:</p><p>* The build works with the latest stable release (3.1.7) of the Seafile components (seafile-server, ccnet, seahub) and the current stable branch (14.07) of openwrt (should work with HEAD, too but I need to test that)<br />* PID files are stored in a common directory within /var/run/seafile directory<br />* the installation script creates a dedicated user account for all seafile services, none of the components need root privileges<br />* python dependencies are automatically installed during the packaging process using python&#039;s &quot;distribution&quot; package<br />* all the generated packages can be safely installed to non-default installation roots (eg. an external USB drive or hard disk)</p><p>Now, I only need to fix some minor issues (eg. wrong server version displayed on Seahub) and make some tests to see how stable the installation can operate. After that, I will be more than happy to publish my work.</p><p>What&#039;s the correct way to do that? Shall I create a pull request to have my packages included in openwrt?</p><p>Thanks,<br />George</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p255784">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">zloop</div>
					<div class="post-datetime">
						27 Nov 2014, 22:33					</div>
				</div>
				<div class="post-content content">
					<p>do a pull request at the packages repo: <a href="https://github.com/openwrt/packages">https://github.com/openwrt/packages</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p255794">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">maplewang</div>
					<div class="post-datetime">
						28 Nov 2014, 02:07					</div>
				</div>
				<div class="post-content content">
					<p>Can you then upload source code to github too? then we can use it, wait openwrt to merge may take long time.</p><div class="quotebox"><cite>geryhun wrote:</cite><blockquote><p>And finally, I&#039;m done! <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Seafile runs perfectly on my Netgear WNDR4300 router:</p><div class="codebox"><pre><code>root@OpenWrt:/# IPKG_INSTROOT=/mnt/extroot opkg -d ext install seafile-server
Installing seafile-server (3.1.7-1) to ext...
Downloading file:///mnt/packages/seafile/seafile-server_3.1.7-1_ar71xx.ipk.
Installing seafile-ccnet (3.1.7-1) to ext...
Downloading file:///mnt/packages/seafile/seafile-ccnet_3.1.7-1_ar71xx.ipk.
Installing seafile-seahub (3.1.7-1) to ext...
Downloading file:///mnt/packages/seafile/seafile-seahub_3.1.7-1_ar71xx.ipk.
Configuring seafile-ccnet.
*** Creating ccnet configuration...
*** NOTE: a default configuration has been created for ccnet in file /mnt/extroot/usr/share/seafile/ccnet/ccnet.conf
*** You may want to modify the NAME and SERVICE_URL parameters to match your requirements.
Configuring seafile-seahub.
*** Creating Seahub configuration...
Done.
*** Creating Seahub database...
Done.
*** Creating symlink for Seahub&#039;s avatar directory...
Done.
Configuring seafile-server.
*** Creating configuration...
Done.
*** Installation completed, your Seafile server should start up now automatically.

*** If this is the first time you installed Seafile, you&#039;ll need to create an administrative login.
*** To do so, please run the script &quot;/mnt/extroot/usr/share/seafile/seafile-server/reset-admin.sh&quot;

*** Once done, open the URL &quot;http://&lt;your_routers_ip_address&gt;:8000/&quot; in your browser to log in.
*** WARNING: this is a plain, unencrypted HTTP connection. To have secure access to your files, use HTTPS instead.
*** Please read http://manual.seafile.com/deploy/https_with_nginx.html to learn how to do that.

*** Enjoy using Seafile!
Seahub is not running
Done.

seafile server not running yet
Done.
Starting seafile server, please wait ...
Seafile server started

Done.
Starting seahub at port 8000 ...
Loading ccnet config from /mnt/extroot/usr/share/seafile/ccnet
Loading seafile config from /mnt/extroot/usr/share/seafile/seafile-data

Seahub is started

Done.</code></pre></div><p>It took more than a week of hard work until I could fix all issues standing in my way but nevermind, at least I have it running now. <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Some of the features:</p><p>* The build works with the latest stable release (3.1.7) of the Seafile components (seafile-server, ccnet, seahub) and the current stable branch (14.07) of openwrt (should work with HEAD, too but I need to test that)<br />* PID files are stored in a common directory within /var/run/seafile directory<br />* the installation script creates a dedicated user account for all seafile services, none of the components need root privileges<br />* python dependencies are automatically installed during the packaging process using python&#039;s &quot;distribution&quot; package<br />* all the generated packages can be safely installed to non-default installation roots (eg. an external USB drive or hard disk)</p><p>Now, I only need to fix some minor issues (eg. wrong server version displayed on Seahub) and make some tests to see how stable the installation can operate. After that, I will be more than happy to publish my work.</p><p>What&#039;s the correct way to do that? Shall I create a pull request to have my packages included in openwrt?</p><p>Thanks,<br />George</p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p256471">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">geryhun</div>
					<div class="post-datetime">
						4 Dec 2014, 00:30					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>maplewang wrote:</cite><blockquote><p>Can you then upload source code to github too? then we can use it, wait openwrt to merge may take long time.</p></blockquote></div><p>I&#039;d love to do so but in the meantime I&#039;ve found a major issue with file uploads regarding the &quot;fileserver&quot; component which is only reproducible on openwrt (the same code works fine when compiled and run on the host PC). It&#039;s hard to tell now what the problem is (maybe some thread-safety bug?), I&#039;m doing my best to debug and fix it...</p><p>I need to inspect the code with gdb to find where things go wrong and then create a fix if possible. Let&#039;s hope it won&#039;t take too long...</p>											<p class="post-edited">(Last edited by <strong>geryhun</strong> on 4 Dec 2014, 00:35)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p256486">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">zloop</div>
					<div class="post-datetime">
						4 Dec 2014, 03:53					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><blockquote><p>I&#039;d love to do so but</p></blockquote></div><p>Other ppl might help you to debug the problem - but maybe they dont have the skill or time to create an OpenWrt package (or to read documentation how to use OpenWrt buildroot...)</p><div class="quotebox"><blockquote><p>which is only reproducible on openwrt (the same code works fine when compiled and run on the host PC)</p></blockquote></div><p>Just as a guideline:<br />- check different compiler (4.6 and 4.9 are available and should generate working images too)<br />- check MIPS16/disable it (4.6 did not have MIPS16; there are compiler errors with MIPS16 on many packages)<br />- check compiler options: OpenWrt uses &quot;-Os&quot; - compile on your PC with the same flag/compile OpenWrt/package with different flags (override TARGET_CFLAGS in Makefile or other CFLAGS - menuconfig has some option)<br />- check x86/x86_64 code generation in a VM</p><p>Having a quick look at upstream code in <a href="https://github.com/haiwen/seafile/blob/master/configure.ac">configure.ac</a>:<br />I wonder if the fileserver component has issues with cross-compilation. Maybe some RPATH thing is wrong - maybe the configure generated from configure.ac is has some cross compile bugs <br />Cross compile bugs are more likely on new software (because most ppl do not do cross compilations)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p256719">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">geryhun</div>
					<div class="post-datetime">
						6 Dec 2014, 01:09					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>zloop wrote:</cite><blockquote><div class="quotebox"><blockquote><p>I&#039;d love to do so but</p></blockquote></div><p>Other ppl might help you to debug the problem - but maybe they dont have the skill or time to create an OpenWrt package (or to read documentation how to use OpenWrt buildroot...)</p><div class="quotebox"><blockquote><p>which is only reproducible on openwrt (the same code works fine when compiled and run on the host PC)</p></blockquote></div><p>Just as a guideline:<br />- check different compiler (4.6 and 4.9 are available and should generate working images too)<br />- check MIPS16/disable it (4.6 did not have MIPS16; there are compiler errors with MIPS16 on many packages)<br />- check compiler options: OpenWrt uses &quot;-Os&quot; - compile on your PC with the same flag/compile OpenWrt/package with different flags (override TARGET_CFLAGS in Makefile or other CFLAGS - menuconfig has some option)<br />- check x86/x86_64 code generation in a VM</p><p>Having a quick look at upstream code in <a href="https://github.com/haiwen/seafile/blob/master/configure.ac">configure.ac</a>:<br />I wonder if the fileserver component has issues with cross-compilation. Maybe some RPATH thing is wrong - maybe the configure generated from configure.ac is has some cross compile bugs <br />Cross compile bugs are more likely on new software (because most ppl do not do cross compilations)</p></blockquote></div><p>Thanks for your feedback, zloop, much appreciated!</p><p>I&#039;m going to try to upload my work to Github now, will share the link soon in a separate post.</p><p>In the meantime, I&#039;ve been working on setting up extroot with a USB stick on my Netgear WNDR4300. My plan was to install the packages generated to / (root) instead of a separate directory (which is said to often causes problems with some software) but I couldn&#039;t find a way to do that, so far... it&#039;s slowly driving me mad, even though I set up everything as per the wiki article says and try all the tweaks possible, the rootfs still remains on flash and I get no related messages in dmesg or logread to see what&#039;s wrong, it&#039;s like openwrt silently ignores if I try to mount anything to / or /overlay.</p><p>On the other hand, if I try to compile my packages with debugging information included (set up as suggested here: <a href="http://wiki.openwrt.org/doc/devel/gdb)">http://wiki.openwrt.org/doc/devel/gdb)</a> then all packages depending on libpthread fail at configure time. The error message says that libpthread is not installed while the libraries and header files seem to be properly installed. Interestingly, the same source and package configuration works fine if I disable debugging capabilities. What am I missing here?</p><p>Let&#039;s hope some more experienced guys can help me with this as I&#039;m slowly getting out of ideas and it makes me really said that I run into thick walls after so many hours of hard work I already put into this.</p><p>Luckily, I&#039;ll be on holiday next week so will have a lot of time to work on finishing the port.</p>											<p class="post-edited">(Last edited by <strong>geryhun</strong> on 6 Dec 2014, 02:31)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p256733">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">geryhun</div>
					<div class="post-datetime">
						6 Dec 2014, 02:29					</div>
				</div>
				<div class="post-content content">
					<p>As promised, here&#039;s my work published on Github:</p><p><a href="https://github.com/kissg1988/seafile-openwrt">https://github.com/kissg1988/seafile-openwrt</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p256834">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">geryhun</div>
					<div class="post-datetime">
						7 Dec 2014, 02:39					</div>
				</div>
				<div class="post-content content">
					<p>This definitely will be an issue with libevhtp or one of its dependencies.</p><p>Here&#039;s the build log:</p><div class="codebox"><pre><code>make[1]: Entering directory `/home/nb/openwrt_build/barrier_breaker&#039;
make[2]: Entering directory `/home/nb/openwrt_build/seafile/libs/libevhtp&#039;
rm -f /home/nb/openwrt_build/barrier_breaker/staging_dir/target-mips_34kc_uClibc-0.9.33.2/stamp/.libevhtp_installed
make[2]: [clean-staging] Error 123 (ignored)
rm -f /home/nb/openwrt_build/barrier_breaker/bin/ar71xx/packages/seafile/libevhtp_*
rm -f /home/nb/openwrt_build/barrier_breaker/staging_dir/target-mips_34kc_uClibc-0.9.33.2/packages/libevhtp.list /home/nb/openwrt_build/barrier_breaker/staging_dir/host/packages/libevhtp.list
rm -rf /home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9
make[2]: Leaving directory `/home/nb/openwrt_build/seafile/libs/libevhtp&#039;
make[1]: Leaving directory `/home/nb/openwrt_build/barrier_breaker&#039;
make[1]: Entering directory `/home/nb/openwrt_build/barrier_breaker&#039;
make[2]: Entering directory `/home/nb/openwrt_build/barrier_breaker/package/libs/toolchain&#039;
if [ -f /home/nb/openwrt_build/barrier_breaker/staging_dir/target-mips_34kc_uClibc-0.9.33.2/pkginfo/toolchain.default.install.clean ]; then rm -f /home/nb/openwrt_build/barrier_breaker/staging_dir/target-mips_34kc_uClibc-0.9.33.2/pkginfo/toolchain.default.install /home/nb/openwrt_build/barrier_breaker/staging_dir/target-mips_34kc_uClibc-0.9.33.2/pkginfo/toolchain.default.install.clean; fi; echo &quot;libc&quot; &gt;&gt; /home/nb/openwrt_build/barrier_breaker/staging_dir/target-mips_34kc_uClibc-0.9.33.2/pkginfo/toolchain.default.install
if [ -f /home/nb/openwrt_build/barrier_breaker/staging_dir/target-mips_34kc_uClibc-0.9.33.2/pkginfo/toolchain.default.install.clean ]; then rm -f /home/nb/openwrt_build/barrier_breaker/staging_dir/target-mips_34kc_uClibc-0.9.33.2/pkginfo/toolchain.default.install /home/nb/openwrt_build/barrier_breaker/staging_dir/target-mips_34kc_uClibc-0.9.33.2/pkginfo/toolchain.default.install.clean; fi; echo &quot;libgcc&quot; &gt;&gt; /home/nb/openwrt_build/barrier_breaker/staging_dir/target-mips_34kc_uClibc-0.9.33.2/pkginfo/toolchain.default.install
WARNING: skipping libssp -- package not selected
WARNING: skipping libstdcpp -- package not selected
WARNING: skipping libthread-db -- package not selected
WARNING: skipping librt -- package not selected
WARNING: skipping libgfortran -- package not selected
WARNING: skipping ldd -- package not selected
WARNING: skipping ldconfig -- package not selected
make[2]: Leaving directory `/home/nb/openwrt_build/barrier_breaker/package/libs/toolchain&#039;
make[2]: Entering directory `/home/nb/openwrt_build/barrier_breaker/package/libs/ocf-crypto-headers&#039;
make[2]: Leaving directory `/home/nb/openwrt_build/barrier_breaker/package/libs/ocf-crypto-headers&#039;
make[2]: Entering directory `/home/nb/openwrt_build/barrier_breaker/package/libs/zlib&#039;
make[2]: Leaving directory `/home/nb/openwrt_build/barrier_breaker/package/libs/zlib&#039;
make[2]: Entering directory `/home/nb/openwrt_build/barrier_breaker/package/libs/openssl&#039;
WARNING: skipping openssl-util -- package not selected
make[2]: Leaving directory `/home/nb/openwrt_build/barrier_breaker/package/libs/openssl&#039;
make[2]: Entering directory `/home/nb/openwrt_build/barrier_breaker/package/libs/libevent2&#039;
WARNING: skipping libevent2-core -- package not selected
WARNING: skipping libevent2-extra -- package not selected
make[2]: Leaving directory `/home/nb/openwrt_build/barrier_breaker/package/libs/libevent2&#039;
make[2]: Entering directory `/home/nb/openwrt_build/seafile/libs/libevhtp&#039;
mkdir -p /home/nb/openwrt_build/barrier_breaker/dl
/home/nb/openwrt_build/barrier_breaker/scripts/download.pl &quot;/home/nb/openwrt_build/barrier_breaker/dl&quot; &quot;1.2.9.tar.gz&quot; &quot;428a8d179fcc0cadedd914ed6456e08f&quot; &quot;[url]https://github.com/ellzey/libevhtp/archive/[/url]&quot;
--2014-12-07 00:39:33--  [url]https://github.com/ellzey/libevhtp/archive/1.2.9.tar.gz[/url]
Resolving github.com (github.com)... 192.30.252.130
Connecting to github.com (github.com)|192.30.252.130|:443... connected.
HTTP request sent, awaiting response... 302 Found
Location: [url]https://codeload.github.com/ellzey/libevhtp/tar.gz/1.2.9[/url] [following]
--2014-12-07 00:39:34--  [url]https://codeload.github.com/ellzey/libevhtp/tar.gz/1.2.9[/url]
Resolving codeload.github.com (codeload.github.com)... 192.30.252.146
Connecting to codeload.github.com (codeload.github.com)|192.30.252.146|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: unspecified [application/x-gzip]
Saving to: &#039;STDOUT&#039;

     0K .......... .......... .......... .......... ..........  189K
    50K .......... .......... .......... .......... ..........  239K
   100K .......... .......... .......... .......... ..........  556K
   150K .......... .......... .......... .......... ..........  392K
   200K .......... .......... .......... .......... ..........  498K
   250K .......... .......... .......... .......... .......... 1.37M
   300K .......... .......... .......... .......... ..........  531K
   350K ..                                                     7.41M=0.9s

2014-12-07 00:39:35 (382 KB/s) - written to stdout [360647]

. /home/nb/openwrt_build/barrier_breaker/include/shell.sh; gzip -dc /home/nb/openwrt_build/barrier_breaker/dl/1.2.9.tar.gz | /usr/bin/gtar -C /home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9/.. -xf - 

Applying ./patches/010-enable-shared-object-building.patch using plaintext: 
patching file CMakeLists.txt
# deleting source package as its filename is ambiguous
rm -f /home/nb/openwrt_build/barrier_breaker/dl/1.2.9.tar.gz
touch /home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9/.prepared_895b0ef5991be76b2fc80e73eb53c87d
(cd /home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9; CFLAGS=&quot;-Os -pipe -mno-branch-likely -mips32r2 -mtune=34kc -g3 -fno-caller-saves -fhonour-copts -Wno-error=unused-but-set-variable -msoft-float -mips16 -minterlink-mips16 &quot; CXXFLAGS=&quot;-Os -pipe -mno-branch-likely -mips32r2 -mtune=34kc -g3 -fno-caller-saves -fhonour-copts -Wno-error=unused-but-set-variable -msoft-float -mips16 -minterlink-mips16 &quot; LDFLAGS=&quot;-L/home/nb/openwrt_build/barrier_breaker/staging_dir/target-mips_34kc_uClibc-0.9.33.2/usr/lib -L/home/nb/openwrt_build/barrier_breaker/staging_dir/target-mips_34kc_uClibc-0.9.33.2/lib -L/home/nb/openwrt_build/barrier_breaker/staging_dir/toolchain-mips_34kc_gcc-4.8-linaro_uClibc-0.9.33.2/usr/lib -L/home/nb/openwrt_build/barrier_breaker/staging_dir/toolchain-mips_34kc_gcc-4.8-linaro_uClibc-0.9.33.2/lib &quot; cmake -DCMAKE_SYSTEM_NAME=Linux -DCMAKE_SYSTEM_VERSION=1 -DCMAKE_SYSTEM_PROCESSOR=mips -DCMAKE_BUILD_TYPE=Release -DCMAKE_C_FLAGS_RELEASE=&quot;-DNDEBUG&quot; -DCMAKE_CXX_FLAGS_RELEASE=&quot;-DNDEBUG&quot; -DCMAKE_C_COMPILER=&quot;/home/nb/openwrt_build/barrier_breaker/staging_dir/toolchain-mips_34kc_gcc-4.8-linaro_uClibc-0.9.33.2/bin/mips-openwrt-linux-uclibc-gcc&quot; -DCMAKE_C_COMPILER_ARG1=&quot;&quot; -DCMAKE_CXX_COMPILER=&quot;/home/nb/openwrt_build/barrier_breaker/staging_dir/toolchain-mips_34kc_gcc-4.8-linaro_uClibc-0.9.33.2/bin/mips-openwrt-linux-uclibc-g++&quot; -DCMAKE_CXX_COMPILER_ARG1=&quot;&quot; -DCMAKE_EXE_LINKER_FLAGS:STRING=&quot;-L/home/nb/openwrt_build/barrier_breaker/staging_dir/target-mips_34kc_uClibc-0.9.33.2/usr/lib -L/home/nb/openwrt_build/barrier_breaker/staging_dir/target-mips_34kc_uClibc-0.9.33.2/lib -L/home/nb/openwrt_build/barrier_breaker/staging_dir/toolchain-mips_34kc_gcc-4.8-linaro_uClibc-0.9.33.2/usr/lib -L/home/nb/openwrt_build/barrier_breaker/staging_dir/toolchain-mips_34kc_gcc-4.8-linaro_uClibc-0.9.33.2/lib&quot; -DCMAKE_MODULE_LINKER_FLAGS:STRING=&quot;-L/home/nb/openwrt_build/barrier_breaker/staging_dir/target-mips_34kc_uClibc-0.9.33.2/usr/lib -L/home/nb/openwrt_build/barrier_breaker/staging_dir/target-mips_34kc_uClibc-0.9.33.2/lib -L/home/nb/openwrt_build/barrier_breaker/staging_dir/toolchain-mips_34kc_gcc-4.8-linaro_uClibc-0.9.33.2/usr/lib -L/home/nb/openwrt_build/barrier_breaker/staging_dir/toolchain-mips_34kc_gcc-4.8-linaro_uClibc-0.9.33.2/lib&quot; -DCMAKE_SHARED_LINKER_FLAGS:STRING=&quot;-L/home/nb/openwrt_build/barrier_breaker/staging_dir/target-mips_34kc_uClibc-0.9.33.2/usr/lib -L/home/nb/openwrt_build/barrier_breaker/staging_dir/target-mips_34kc_uClibc-0.9.33.2/lib -L/home/nb/openwrt_build/barrier_breaker/staging_dir/toolchain-mips_34kc_gcc-4.8-linaro_uClibc-0.9.33.2/usr/lib -L/home/nb/openwrt_build/barrier_breaker/staging_dir/toolchain-mips_34kc_gcc-4.8-linaro_uClibc-0.9.33.2/lib&quot; -DCMAKE_AR=&quot;/home/nb/openwrt_build/barrier_breaker/staging_dir/toolchain-mips_34kc_gcc-4.8-linaro_uClibc-0.9.33.2/bin/mips-openwrt-linux-uclibc-ar&quot; -DCMAKE_RANLIB=&quot;/home/nb/openwrt_build/barrier_breaker/staging_dir/toolchain-mips_34kc_gcc-4.8-linaro_uClibc-0.9.33.2/bin/mips-openwrt-linux-uclibc-ranlib&quot; -DCMAKE_FIND_ROOT_PATH=&quot;/home/nb/openwrt_build/barrier_breaker/staging_dir/target-mips_34kc_uClibc-0.9.33.2;/home/nb/openwrt_build/barrier_breaker/staging_dir/toolchain-mips_34kc_gcc-4.8-linaro_uClibc-0.9.33.2&quot; -DCMAKE_FIND_ROOT_PATH_MODE_PROGRAM=BOTH -DCMAKE_FIND_ROOT_PATH_MODE_LIBRARY=ONLY -DCMAKE_FIND_ROOT_PATH_MODE_INCLUDE=ONLY -DCMAKE_STRIP=: -DCMAKE_INSTALL_PREFIX=/usr -DDL_LIBRARY=/home/nb/openwrt_build/barrier_breaker/staging_dir/target-mips_34kc_uClibc-0.9.33.2 -DCMAKE_PREFIX_PATH=/home/nb/openwrt_build/barrier_breaker/staging_dir/target-mips_34kc_uClibc-0.9.33.2  . )
-- The C compiler identification is GNU 4.8.3
-- The CXX compiler identification is GNU 4.8.3
-- Check for working C compiler: /home/nb/openwrt_build/barrier_breaker/staging_dir/toolchain-mips_34kc_gcc-4.8-linaro_uClibc-0.9.33.2/bin/mips-openwrt-linux-uclibc-gcc
-- Check for working C compiler: /home/nb/openwrt_build/barrier_breaker/staging_dir/toolchain-mips_34kc_gcc-4.8-linaro_uClibc-0.9.33.2/bin/mips-openwrt-linux-uclibc-gcc -- works
-- Detecting C compiler ABI info
-- Detecting C compiler ABI info - done
-- Check for working CXX compiler: /home/nb/openwrt_build/barrier_breaker/staging_dir/toolchain-mips_34kc_gcc-4.8-linaro_uClibc-0.9.33.2/bin/mips-openwrt-linux-uclibc-g++
-- Check for working CXX compiler: /home/nb/openwrt_build/barrier_breaker/staging_dir/toolchain-mips_34kc_gcc-4.8-linaro_uClibc-0.9.33.2/bin/mips-openwrt-linux-uclibc-g++ -- works
-- Detecting CXX compiler ABI info
-- Detecting CXX compiler ABI info - done
-- Looking for alloca
-- Looking for alloca - not found
-- Looking for memcmp
-- Looking for memcmp - found
-- Looking for strndup
-- Looking for strndup - found
-- Looking for strnlen
-- Looking for strnlen - found
-- Looking for include file alloca.h
-- Looking for include file alloca.h - found
-- Looking for include file strings.h
-- Looking for include file strings.h - found
-- Looking for include file string.h
-- Looking for include file string.h - found
-- Looking for include file stdlib.h
-- Looking for include file stdlib.h - found
-- Looking for include file sys/time.h
-- Looking for include file sys/time.h - found
-- Looking for include file sys/times.h
-- Looking for include file sys/times.h - found
-- Looking for include file unistd.h
-- Looking for include file unistd.h - found
-- Looking for include file memory.h
-- Looking for include file memory.h - found
-- Looking for include file stdarg.h
-- Looking for include file stdarg.h - found
-- Looking for include file sys/tree.h
-- Looking for include file sys/tree.h - not found
-- Looking for include file sys/queue.h
-- Looking for include file sys/queue.h - found
-- Looking for include file sys/un.h
-- Looking for include file sys/un.h - found
-- Looking for sys/types.h
-- Looking for sys/types.h - found
-- Looking for stdint.h
-- Looking for stdint.h - found
-- Looking for stddef.h
-- Looking for stddef.h - found
-- Check size of int
-- Check size of int - done
-- Check size of long
-- Check size of long - done
-- Check size of short
-- Check size of short - done
Build Type: Release
Std CFLAGS: -Os -pipe -mno-branch-likely -mips32r2 -mtune=34kc -g3 -fno-caller-saves -fhonour-copts -Wno-error=unused-but-set-variable -msoft-float -mips16 -minterlink-mips16   -Wall -fno-strict-aliasing -DPROJECT_VERSION=&quot;1.2.9&quot; -D_BSD_SOURCE -D_POSIX_C_SOURCE=200112
Dbg CFLAGS: -g -Wall -fno-strict-aliasing -ggdb
Rel CFLAGS: -DNDEBUG -Wall -fno-strict-aliasing
-- Found LibEvent: /home/nb/openwrt_build/barrier_breaker/staging_dir/target-mips_34kc_uClibc-0.9.33.2/usr/lib/libevent.so  
-- Found LibEventPthreads: /home/nb/openwrt_build/barrier_breaker/staging_dir/target-mips_34kc_uClibc-0.9.33.2/usr/lib/libevent_pthreads.so  
-- Found LibEventCore: /home/nb/openwrt_build/barrier_breaker/staging_dir/target-mips_34kc_uClibc-0.9.33.2/usr/lib/libevent_core.so  
-- Found LibEventExtra: /home/nb/openwrt_build/barrier_breaker/staging_dir/target-mips_34kc_uClibc-0.9.33.2/usr/lib/libevent_extra.so  
-- Found LibEventOpenssl: /home/nb/openwrt_build/barrier_breaker/staging_dir/target-mips_34kc_uClibc-0.9.33.2/usr/lib/libevent_openssl.so  
-- Found OpenSSL: /home/nb/openwrt_build/barrier_breaker/staging_dir/target-mips_34kc_uClibc-0.9.33.2/usr/lib/libssl.so;/home/nb/openwrt_build/barrier_breaker/staging_dir/target-mips_34kc_uClibc-0.9.33.2/usr/lib/libcrypto.so (found version &quot;1.0.1j&quot;) 
-- Configuring done
-- Generating done
CMake Warning:
  Manually-specified variables were not used by the project:

    CMAKE_MODULE_LINKER_FLAGS
    DL_LIBRARY


-- Build files have been written to: /home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9
rm -f /home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9/.configured_
touch /home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9/.configured_
CFLAGS=&quot;-Os -pipe -mno-branch-likely -mips32r2 -mtune=34kc -g3 -fno-caller-saves -fhonour-copts -Wno-error=unused-but-set-variable -msoft-float -mips16 -minterlink-mips16  -I/home/nb/openwrt_build/barrier_breaker/staging_dir/target-mips_34kc_uClibc-0.9.33.2/usr/include -I/home/nb/openwrt_build/barrier_breaker/staging_dir/target-mips_34kc_uClibc-0.9.33.2/include -I/home/nb/openwrt_build/barrier_breaker/staging_dir/toolchain-mips_34kc_gcc-4.8-linaro_uClibc-0.9.33.2/usr/include -I/home/nb/openwrt_build/barrier_breaker/staging_dir/toolchain-mips_34kc_gcc-4.8-linaro_uClibc-0.9.33.2/include &quot; CXXFLAGS=&quot;-Os -pipe -mno-branch-likely -mips32r2 -mtune=34kc -g3 -fno-caller-saves -fhonour-copts -Wno-error=unused-but-set-variable -msoft-float -mips16 -minterlink-mips16  -I/home/nb/openwrt_build/barrier_breaker/staging_dir/target-mips_34kc_uClibc-0.9.33.2/usr/include -I/home/nb/openwrt_build/barrier_breaker/staging_dir/target-mips_34kc_uClibc-0.9.33.2/include -I/home/nb/openwrt_build/barrier_breaker/staging_dir/toolchain-mips_34kc_gcc-4.8-linaro_uClibc-0.9.33.2/usr/include -I/home/nb/openwrt_build/barrier_breaker/staging_dir/toolchain-mips_34kc_gcc-4.8-linaro_uClibc-0.9.33.2/include &quot; LDFLAGS=&quot;-L/home/nb/openwrt_build/barrier_breaker/staging_dir/target-mips_34kc_uClibc-0.9.33.2/usr/lib -L/home/nb/openwrt_build/barrier_breaker/staging_dir/target-mips_34kc_uClibc-0.9.33.2/lib -L/home/nb/openwrt_build/barrier_breaker/staging_dir/toolchain-mips_34kc_gcc-4.8-linaro_uClibc-0.9.33.2/usr/lib -L/home/nb/openwrt_build/barrier_breaker/staging_dir/toolchain-mips_34kc_gcc-4.8-linaro_uClibc-0.9.33.2/lib &quot; make -j1 -C /home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9/. AR=mips-openwrt-linux-uclibc-ar AS=&quot;mips-openwrt-linux-uclibc-gcc -c -Os -pipe -mno-branch-likely -mips32r2 -mtune=34kc -g3 -fno-caller-saves -fhonour-copts -Wno-error=unused-but-set-variable -msoft-float&quot; LD=mips-openwrt-linux-uclibc-ld NM=mips-openwrt-linux-uclibc-nm CC=&quot;mips-openwrt-linux-uclibc-gcc&quot; GCC=&quot;mips-openwrt-linux-uclibc-gcc&quot; CXX=&quot;mips-openwrt-linux-uclibc-g++&quot; RANLIB=mips-openwrt-linux-uclibc-ranlib STRIP=mips-openwrt-linux-uclibc-strip OBJCOPY=mips-openwrt-linux-uclibc-objcopy OBJDUMP=mips-openwrt-linux-uclibc-objdump SIZE=mips-openwrt-linux-uclibc-size CROSS=&quot;mips-openwrt-linux-uclibc-&quot; ARCH=&quot;mips&quot; ;
make[3]: Entering directory `/home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9&#039;
make[4]: Entering directory `/home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9&#039;
make[5]: Entering directory `/home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9&#039;
Scanning dependencies of target libevhtp
make[5]: Leaving directory `/home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9&#039;
make[5]: Entering directory `/home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9&#039;
[  2%] Building C object CMakeFiles/libevhtp.dir/evhtp.c.o
[  4%] Building C object CMakeFiles/libevhtp.dir/htparse/htparse.c.o
[  6%] Building C object CMakeFiles/libevhtp.dir/evthr/evthr.c.o
[  8%] Building C object CMakeFiles/libevhtp.dir/oniguruma/regerror.c.o
[ 10%] Building C object CMakeFiles/libevhtp.dir/oniguruma/regparse.c.o
/home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9/oniguruma/regparse.c: In function &#039;fetch_escaped_value&#039;:
/home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9/oniguruma/regparse.c:252:30: warning: variable &#039;pfetch_prev&#039; set but not used [-Wunused-but-set-variable]
 #define PFETCH_READY  UChar* pfetch_prev
                              ^
/home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9/oniguruma/regparse.c:2407:3: note: in expansion of macro &#039;PFETCH_READY&#039;
   PFETCH_READY;
   ^
/home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9/oniguruma/regparse.c: In function &#039;fetch_name&#039;:
/home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9/oniguruma/regparse.c:252:30: warning: variable &#039;pfetch_prev&#039; set but not used [-Wunused-but-set-variable]
 #define PFETCH_READY  UChar* pfetch_prev
                              ^
/home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9/oniguruma/regparse.c:2620:3: note: in expansion of macro &#039;PFETCH_READY&#039;
   PFETCH_READY;
   ^
/home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9/oniguruma/regparse.c: In function &#039;parse_posix_bracket&#039;:
/home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9/oniguruma/regparse.c:252:30: warning: variable &#039;pfetch_prev&#039; set but not used [-Wunused-but-set-variable]
 #define PFETCH_READY  UChar* pfetch_prev
                              ^
/home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9/oniguruma/regparse.c:3938:3: note: in expansion of macro &#039;PFETCH_READY&#039;
   PFETCH_READY;
   ^
/home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9/oniguruma/regparse.c: In function &#039;fetch_char_property_to_ctype&#039;:
/home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9/oniguruma/regparse.c:252:30: warning: variable &#039;pfetch_prev&#039; set but not used [-Wunused-but-set-variable]
 #define PFETCH_READY  UChar* pfetch_prev
                              ^
/home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9/oniguruma/regparse.c:3991:3: note: in expansion of macro &#039;PFETCH_READY&#039;
   PFETCH_READY;
   ^
/home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9/oniguruma/regparse.c: In function &#039;code_exist_check&#039;:
/home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9/oniguruma/regparse.c:252:30: warning: variable &#039;pfetch_prev&#039; set but not used [-Wunused-but-set-variable]
 #define PFETCH_READY  UChar* pfetch_prev
                              ^
/home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9/oniguruma/regparse.c:4156:3: note: in expansion of macro &#039;PFETCH_READY&#039;
   PFETCH_READY;
   ^
[ 13%] Building C object CMakeFiles/libevhtp.dir/oniguruma/regext.c.o
[ 15%] Building C object CMakeFiles/libevhtp.dir/oniguruma/regcomp.c.o
[ 17%] Building C object CMakeFiles/libevhtp.dir/oniguruma/regexec.c.o
[ 19%] Building C object CMakeFiles/libevhtp.dir/oniguruma/reggnu.c.o
[ 21%] Building C object CMakeFiles/libevhtp.dir/oniguruma/regenc.c.o
[ 23%] Building C object CMakeFiles/libevhtp.dir/oniguruma/regsyntax.c.o
[ 26%] Building C object CMakeFiles/libevhtp.dir/oniguruma/regtrav.c.o
[ 28%] Building C object CMakeFiles/libevhtp.dir/oniguruma/regversion.c.o
[ 30%] Building C object CMakeFiles/libevhtp.dir/oniguruma/st.c.o
[ 32%] Building C object CMakeFiles/libevhtp.dir/oniguruma/regposix.c.o
[ 34%] Building C object CMakeFiles/libevhtp.dir/oniguruma/regposerr.c.o
[ 36%] Building C object CMakeFiles/libevhtp.dir/oniguruma/enc/unicode.c.o
[ 39%] Building C object CMakeFiles/libevhtp.dir/oniguruma/enc/ascii.c.o
[ 41%] Building C object CMakeFiles/libevhtp.dir/oniguruma/enc/utf8.c.o
[ 43%] Building C object CMakeFiles/libevhtp.dir/oniguruma/enc/utf16_be.c.o
[ 45%] Building C object CMakeFiles/libevhtp.dir/oniguruma/enc/utf16_le.c.o
[ 47%] Building C object CMakeFiles/libevhtp.dir/oniguruma/enc/utf32_be.c.o
[ 50%] Building C object CMakeFiles/libevhtp.dir/oniguruma/enc/utf32_le.c.o
[ 52%] Building C object CMakeFiles/libevhtp.dir/oniguruma/enc/euc_jp.c.o
[ 54%] Building C object CMakeFiles/libevhtp.dir/oniguruma/enc/sjis.c.o
[ 56%] Building C object CMakeFiles/libevhtp.dir/oniguruma/enc/iso8859_1.c.o
[ 58%] Building C object CMakeFiles/libevhtp.dir/oniguruma/enc/iso8859_2.c.o
[ 60%] Building C object CMakeFiles/libevhtp.dir/oniguruma/enc/iso8859_3.c.o
[ 63%] Building C object CMakeFiles/libevhtp.dir/oniguruma/enc/iso8859_4.c.o
[ 65%] Building C object CMakeFiles/libevhtp.dir/oniguruma/enc/iso8859_5.c.o
[ 67%] Building C object CMakeFiles/libevhtp.dir/oniguruma/enc/iso8859_6.c.o
[ 69%] Building C object CMakeFiles/libevhtp.dir/oniguruma/enc/iso8859_7.c.o
[ 71%] Building C object CMakeFiles/libevhtp.dir/oniguruma/enc/iso8859_8.c.o
[ 73%] Building C object CMakeFiles/libevhtp.dir/oniguruma/enc/iso8859_9.c.o
[ 76%] Building C object CMakeFiles/libevhtp.dir/oniguruma/enc/iso8859_10.c.o
[ 78%] Building C object CMakeFiles/libevhtp.dir/oniguruma/enc/iso8859_11.c.o
[ 80%] Building C object CMakeFiles/libevhtp.dir/oniguruma/enc/iso8859_13.c.o
[ 82%] Building C object CMakeFiles/libevhtp.dir/oniguruma/enc/iso8859_14.c.o
[ 84%] Building C object CMakeFiles/libevhtp.dir/oniguruma/enc/iso8859_15.c.o
[ 86%] Building C object CMakeFiles/libevhtp.dir/oniguruma/enc/iso8859_16.c.o
[ 89%] Building C object CMakeFiles/libevhtp.dir/oniguruma/enc/euc_tw.c.o
[ 91%] Building C object CMakeFiles/libevhtp.dir/oniguruma/enc/euc_kr.c.o
[ 93%] Building C object CMakeFiles/libevhtp.dir/oniguruma/enc/big5.c.o
[ 95%] Building C object CMakeFiles/libevhtp.dir/oniguruma/enc/gb18030.c.o
[ 97%] Building C object CMakeFiles/libevhtp.dir/oniguruma/enc/koi8_r.c.o
[100%] Building C object CMakeFiles/libevhtp.dir/oniguruma/enc/cp1251.c.o
Linking C shared library libevhtp.so
make[5]: Leaving directory `/home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9&#039;
[100%] Built target libevhtp
make[4]: Leaving directory `/home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9&#039;
make[3]: Leaving directory `/home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9&#039;
CFLAGS=&quot;-Os -pipe -mno-branch-likely -mips32r2 -mtune=34kc -g3 -fno-caller-saves -fhonour-copts -Wno-error=unused-but-set-variable -msoft-float -mips16 -minterlink-mips16  -I/home/nb/openwrt_build/barrier_breaker/staging_dir/target-mips_34kc_uClibc-0.9.33.2/usr/include -I/home/nb/openwrt_build/barrier_breaker/staging_dir/target-mips_34kc_uClibc-0.9.33.2/include -I/home/nb/openwrt_build/barrier_breaker/staging_dir/toolchain-mips_34kc_gcc-4.8-linaro_uClibc-0.9.33.2/usr/include -I/home/nb/openwrt_build/barrier_breaker/staging_dir/toolchain-mips_34kc_gcc-4.8-linaro_uClibc-0.9.33.2/include &quot; CXXFLAGS=&quot;-Os -pipe -mno-branch-likely -mips32r2 -mtune=34kc -g3 -fno-caller-saves -fhonour-copts -Wno-error=unused-but-set-variable -msoft-float -mips16 -minterlink-mips16  -I/home/nb/openwrt_build/barrier_breaker/staging_dir/target-mips_34kc_uClibc-0.9.33.2/usr/include -I/home/nb/openwrt_build/barrier_breaker/staging_dir/target-mips_34kc_uClibc-0.9.33.2/include -I/home/nb/openwrt_build/barrier_breaker/staging_dir/toolchain-mips_34kc_gcc-4.8-linaro_uClibc-0.9.33.2/usr/include -I/home/nb/openwrt_build/barrier_breaker/staging_dir/toolchain-mips_34kc_gcc-4.8-linaro_uClibc-0.9.33.2/include &quot; LDFLAGS=&quot;-L/home/nb/openwrt_build/barrier_breaker/staging_dir/target-mips_34kc_uClibc-0.9.33.2/usr/lib -L/home/nb/openwrt_build/barrier_breaker/staging_dir/target-mips_34kc_uClibc-0.9.33.2/lib -L/home/nb/openwrt_build/barrier_breaker/staging_dir/toolchain-mips_34kc_gcc-4.8-linaro_uClibc-0.9.33.2/usr/lib -L/home/nb/openwrt_build/barrier_breaker/staging_dir/toolchain-mips_34kc_gcc-4.8-linaro_uClibc-0.9.33.2/lib &quot; make -C /home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9/. AR=mips-openwrt-linux-uclibc-ar AS=&quot;mips-openwrt-linux-uclibc-gcc -c -Os -pipe -mno-branch-likely -mips32r2 -mtune=34kc -g3 -fno-caller-saves -fhonour-copts -Wno-error=unused-but-set-variable -msoft-float&quot; LD=mips-openwrt-linux-uclibc-ld NM=mips-openwrt-linux-uclibc-nm CC=&quot;mips-openwrt-linux-uclibc-gcc&quot; GCC=&quot;mips-openwrt-linux-uclibc-gcc&quot; CXX=&quot;mips-openwrt-linux-uclibc-g++&quot; RANLIB=mips-openwrt-linux-uclibc-ranlib STRIP=mips-openwrt-linux-uclibc-strip OBJCOPY=mips-openwrt-linux-uclibc-objcopy OBJDUMP=mips-openwrt-linux-uclibc-objdump SIZE=mips-openwrt-linux-uclibc-size CROSS=&quot;mips-openwrt-linux-uclibc-&quot; ARCH=&quot;mips&quot; DESTDIR=&quot;/home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9/ipkg-install&quot;  install;
make[3]: Entering directory `/home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9&#039;
make[4]: Entering directory `/home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9&#039;
make[5]: Entering directory `/home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9&#039;
make[5]: Leaving directory `/home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9&#039;
[100%] Built target libevhtp
make[4]: Leaving directory `/home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9&#039;
Install the project...
-- Install configuration: &quot;Release&quot;
-- Installing: /home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9/ipkg-install/usr/lib/libevhtp.so
-- Installing: /home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9/ipkg-install/usr/include/evhtp.h
-- Installing: /home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9/ipkg-install/usr/include/htparse.h
-- Installing: /home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9/ipkg-install/usr/include/evhtp-config.h
-- Installing: /home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9/ipkg-install/usr/include/evthr.h
-- Installing: /home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9/ipkg-install/usr/include/onigposix.h
make[3]: Leaving directory `/home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9&#039;
touch /home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9/.built
mkdir -p /home/nb/openwrt_build/barrier_breaker/bin/ar71xx/packages /home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9/ipkg-ar71xx/libevhtp/CONTROL /home/nb/openwrt_build/barrier_breaker/staging_dir/target-mips_34kc_uClibc-0.9.33.2/pkginfo
install -d -m0755 /home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9/ipkg-ar71xx/libevhtp/usr/lib
cp -fpR /home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9/ipkg-install/usr/lib/libevhtp.so* /home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9/ipkg-ar71xx/libevhtp/usr/lib/
find /home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9/ipkg-ar71xx/libevhtp -name &#039;CVS&#039; -o -name &#039;.svn&#039; -o -name &#039;.#*&#039; -o -name &#039;*~&#039;| xargs -r rm -rf
: /home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9/ipkg-ar71xx/libevhtp
( echo &quot;Package: libevhtp&quot;; echo &quot;Version: 1.2.9-1&quot;; DEPENDS=&#039;&#039;; for depend in libc libevent2 libevent2-openssl libevent2-pthreads libpthread; do DEPENDS=${DEPENDS:+$DEPENDS, }${depend##+}; done; [ -z &quot;$DEPENDS&quot; ] || echo &quot;Depends: $DEPENDS&quot;;  echo &quot;Source: /home/nb/openwrt_build/seafile/libs/libevhtp&quot;;  echo &quot;License: BSD-3-Clause&quot;;   echo &quot;Section: libs&quot;;   echo &quot;Maintainer: Gergely Kiss &lt;mail.gery@gmail.com&gt;&quot;;  echo &quot;Architecture: ar71xx&quot;; echo &quot;Installed-Size: 0&quot;; echo -n &quot;Description: &quot;; . /home/nb/openwrt_build/barrier_breaker/include/shell.sh; getvar V_Package_libevhtp_description | sed -e &#039;s,^[[:space:]]*, ,g&#039;; ) &gt; /home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9/ipkg-ar71xx/libevhtp/CONTROL/control
chmod 644 /home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9/ipkg-ar71xx/libevhtp/CONTROL/control
. /home/nb/openwrt_build/barrier_breaker/include/shell.sh; (cd /home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9/ipkg-ar71xx/libevhtp/CONTROL;  )
install -d -m0755 /home/nb/openwrt_build/barrier_breaker/bin/ar71xx/packages/seafile
ipkg-build -c -o 0 -g 0 /home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9/ipkg-ar71xx/libevhtp /home/nb/openwrt_build/barrier_breaker/bin/ar71xx/packages/seafile
Packaged contents of /home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9/ipkg-ar71xx/libevhtp into /home/nb/openwrt_build/barrier_breaker/bin/ar71xx/packages/seafile/libevhtp_1.2.9-1_ar71xx.ipk
rm -rf /home/nb/openwrt_build/barrier_breaker/staging_dir/target-mips_34kc_uClibc-0.9.33.2/root-ar71xx/tmp-libevhtp
mkdir -p /home/nb/openwrt_build/barrier_breaker/staging_dir/target-mips_34kc_uClibc-0.9.33.2/root-ar71xx/stamp /home/nb/openwrt_build/barrier_breaker/staging_dir/target-mips_34kc_uClibc-0.9.33.2/root-ar71xx/tmp-libevhtp
install -d -m0755 /home/nb/openwrt_build/barrier_breaker/staging_dir/target-mips_34kc_uClibc-0.9.33.2/root-ar71xx/tmp-libevhtp/usr/lib
cp -fpR /home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9/ipkg-install/usr/lib/libevhtp.so* /home/nb/openwrt_build/barrier_breaker/staging_dir/target-mips_34kc_uClibc-0.9.33.2/root-ar71xx/tmp-libevhtp/usr/lib/
SHELL= /home/nb/openwrt_build/barrier_breaker/staging_dir/host/bin/flock /home/nb/openwrt_build/barrier_breaker/tmp/.root-copy.flock -c &#039;cp -fpR /home/nb/openwrt_build/barrier_breaker/staging_dir/target-mips_34kc_uClibc-0.9.33.2/root-ar71xx/tmp-libevhtp/. /home/nb/openwrt_build/barrier_breaker/staging_dir/target-mips_34kc_uClibc-0.9.33.2/root-ar71xx/&#039;
rm -rf /home/nb/openwrt_build/barrier_breaker/staging_dir/target-mips_34kc_uClibc-0.9.33.2/root-ar71xx/tmp-libevhtp
touch /home/nb/openwrt_build/barrier_breaker/staging_dir/target-mips_34kc_uClibc-0.9.33.2/root-ar71xx/stamp/.libevhtp_installed
make V=ss  -j1 clean-staging
make[3]: Entering directory `/home/nb/openwrt_build/seafile/libs/libevhtp&#039;
rm -f /home/nb/openwrt_build/barrier_breaker/staging_dir/target-mips_34kc_uClibc-0.9.33.2/stamp/.libevhtp_installed
make[3]: Leaving directory `/home/nb/openwrt_build/seafile/libs/libevhtp&#039;
rm -rf /home/nb/openwrt_build/barrier_breaker/tmp/stage-libevhtp
mkdir -p /home/nb/openwrt_build/barrier_breaker/tmp/stage-libevhtp/host /home/nb/openwrt_build/barrier_breaker/staging_dir/target-mips_34kc_uClibc-0.9.33.2/packages /home/nb/openwrt_build/barrier_breaker/staging_dir/host/packages
install -d -m0755 /home/nb/openwrt_build/barrier_breaker/tmp/stage-libevhtp/usr/{include,lib}
cp -fpR /home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9/ipkg-install/usr/include/* /home/nb/openwrt_build/barrier_breaker/tmp/stage-libevhtp/usr/include/
cp -fpR /home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9/ipkg-install/usr/lib/libevhtp.so* /home/nb/openwrt_build/barrier_breaker/tmp/stage-libevhtp/usr/lib/
find /home/nb/openwrt_build/barrier_breaker/tmp/stage-libevhtp -name &#039;*.la&#039; | xargs -r rm -f; 
if [ -f /home/nb/openwrt_build/barrier_breaker/staging_dir/target-mips_34kc_uClibc-0.9.33.2/packages/libevhtp.list ]; then /home/nb/openwrt_build/barrier_breaker/scripts/clean-package.sh &quot;/home/nb/openwrt_build/barrier_breaker/staging_dir/target-mips_34kc_uClibc-0.9.33.2/packages/libevhtp.list&quot; &quot;/home/nb/openwrt_build/barrier_breaker/staging_dir/target-mips_34kc_uClibc-0.9.33.2&quot;; fi
if [ -d /home/nb/openwrt_build/barrier_breaker/tmp/stage-libevhtp ]; then (cd /home/nb/openwrt_build/barrier_breaker/tmp/stage-libevhtp; find ./ &gt; /home/nb/openwrt_build/barrier_breaker/tmp/stage-libevhtp.files);     SHELL= /home/nb/openwrt_build/barrier_breaker/staging_dir/host/bin/flock /home/nb/openwrt_build/barrier_breaker/tmp/.staging-dir.flock -c &#039; mv /home/nb/openwrt_build/barrier_breaker/tmp/stage-libevhtp.files /home/nb/openwrt_build/barrier_breaker/staging_dir/target-mips_34kc_uClibc-0.9.33.2/packages/libevhtp.list &amp;&amp; cp -fpR /home/nb/openwrt_build/barrier_breaker/tmp/stage-libevhtp/* /home/nb/openwrt_build/barrier_breaker/staging_dir/target-mips_34kc_uClibc-0.9.33.2/; &#039;; fi
rm -rf /home/nb/openwrt_build/barrier_breaker/tmp/stage-libevhtp
touch /home/nb/openwrt_build/barrier_breaker/staging_dir/target-mips_34kc_uClibc-0.9.33.2/stamp/.libevhtp_installed
make[2]: Leaving directory `/home/nb/openwrt_build/seafile/libs/libevhtp&#039;
make[1]: Leaving directory `/home/nb/openwrt_build/barrier_breaker&#039;</code></pre></div><p>Please someone take a look at it.</p><p>After doing a little bit of debugging, I could see that in file-upload.c:2017 (fileserver binary of seafile-server), the execution does not hit the condition when it should because the HTTP request&#039;s type matches (it&#039;s an OPTIONS request sent by my browser). Instead, code execution continues and returns &quot;400 Bad Request&quot; HTTP response in the end.</p><p>Here are some interesting output of gdb:</p><div class="codebox"><pre><code>(gdb) b upload-file.c:2017
Breakpoint 1 at 0x409134: file upload-file.c, line 2017.
(gdb) c
Continuing.
[New Thread 7388]
[Switching to Thread 7388]

Breakpoint 1, upload_headers_cb (req=0x545638, hdr=0x56cbf8, arg=0x0)
    at upload-file.c:2017
2017        if (evhtp_request_get_method(req) == htp_method_OPTIONS) {
(gdb) s
evhtp_request_get_method (r=0x545638)
    at /home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9/evhtp.c:1972
1972        return htparser_get_method(r-&gt;conn-&gt;parser);
(gdb) s
htparser_get_method (p=0x56e600)
    at /home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9/htparse/htparse.c:375
375    }
(gdb) s
evhtp_request_get_method (r=0x545638)
    at /home/nb/openwrt_build/barrier_breaker/build_dir/target-mips_34kc_uClibc-0.9.33.2/libevhtp-1.2.9/evhtp.c:1973
1973    }
(gdb) s
upload_headers_cb (req=0x545638, hdr=&lt;optimized out&gt;, arg=&lt;optimized out&gt;)
    at upload-file.c:2022
2022        token = req-&gt;uri-&gt;path-&gt;file;</code></pre></div><p>Any ideas?</p><p>Could someone please compile the packages and check if it works like that even if all packages are installed to root (I can&#039;t try that as extroot doesn&#039;t work on my router model)?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p257015">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">geryhun</div>
					<div class="post-datetime">
						9 Dec 2014, 01:12					</div>
				</div>
				<div class="post-content content">
					<p>Finally, I found the culprit!</p><p>At libevhtp&#039;s htparse.c:200, there are some compiler macros defined to do string comparisons:</p><div class="codebox"><pre><code>#define _str3_cmp(m, c0, c1, c2, c3) \
    *(uint32_t *)m == ((c3 &lt;&lt; 24) | (c2 &lt;&lt; 16) | (c1 &lt;&lt; 8) | c0)

#define _str3Ocmp(m, c0, c1, c2, c3) \
    *(uint32_t *)m == ((c3 &lt;&lt; 24) | (c2 &lt;&lt; 16) | (c1 &lt;&lt; 8) | c0)

#define _str4cmp(m, c0, c1, c2, c3) \
    *(uint32_t *)m == ((c3 &lt;&lt; 24) | (c2 &lt;&lt; 16) | (c1 &lt;&lt; 8) | c0)

#define _str5cmp(m, c0, c1, c2, c3, c4)                          \
    *(uint32_t *)m == ((c3 &lt;&lt; 24) | (c2 &lt;&lt; 16) | (c1 &lt;&lt; 8) | c0) \
    &amp;&amp; m[4] == c4

#define _str6cmp(m, c0, c1, c2, c3, c4, c5)                      \
    *(uint32_t *)m == ((c3 &lt;&lt; 24) | (c2 &lt;&lt; 16) | (c1 &lt;&lt; 8) | c0) \
    &amp;&amp; (((uint32_t *)m)[1] &amp; 0xffff) == ((c5 &lt;&lt; 8) | c4)

#define _str7_cmp(m, c0, c1, c2, c3, c4, c5, c6, c7)             \
    *(uint32_t *)m == ((c3 &lt;&lt; 24) | (c2 &lt;&lt; 16) | (c1 &lt;&lt; 8) | c0) \
    &amp;&amp; ((uint32_t *)m)[1] == ((c7 &lt;&lt; 24) | (c6 &lt;&lt; 16) | (c5 &lt;&lt; 8) | c4)</code></pre></div><p>This does not work for some reason, I could see during a debugging session that the function does not find the match when it should:</p><div class="codebox"><pre><code>[...]
(gdb) n
490            switch (p-&gt;state) {
(gdb) n
544                    if (ch == &#039; &#039;) {
(gdb) n
545                        char * m = p-&gt;buf;
(gdb) n
547                        switch (p-&gt;buf_idx) {
(gdb) p m
$12 = 0xa86084 &quot;OPTIONS&quot;
(gdb) n
616                                if (_str7_cmp(m, &#039;O&#039;, &#039;P&#039;, &#039;T&#039;, &#039;I&#039;, &#039;O&#039;, &#039;N&#039;, &#039;S&#039;, &#039;\0&#039;)) {
(gdb) n
620                                if (_str7_cmp(m, &#039;C&#039;, &#039;O&#039;, &#039;N&#039;, &#039;N&#039;, &#039;E&#039;, &#039;C&#039;, &#039;T&#039;, &#039;\0&#039;)) {</code></pre></div><p>Taking a closer look at the issue, I suddenly realized that the platform I&#039;m compiling for is big-endian by default and the comparison functions are utilizing bitshift operators...</p><p>So, I just need to patch the code to do the comparison with respect to endianness and then it should work as expected.</p><p>Jeez, this was such a hard nut to crack! <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /></p>											<p class="post-edited">(Last edited by <strong>geryhun</strong> on 9 Dec 2014, 02:54)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p328361">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">nexkat</div>
					<div class="post-datetime">
						13 Jun 2016, 23:07					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>thanks for your efforts. I would really like to install this on my tplink router!</p><p>Any news on porting this to Chaos Chalmer? seafile-seahub and -ccnet are in the repositories, but I couldn&#039;t find seafile-server. Do you think the source would compile also for the latest release? I would be happy to test this on a mpc85xx platform, but haven&#039;t tried to compile anything myself yet (for openwrt, that is).</p><p>I guess developing for openwrt can be quite frustrating, maybe this a dead end anyway.</p><p>Any comments or help appreciated!<br />Stefan</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p328465">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">geryhun</div>
					<div class="post-datetime">
						14 Jun 2016, 18:16					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>nexkat wrote:</cite><blockquote><p>Hi,</p><p>thanks for your efforts. I would really like to install this on my tplink router!</p><p>Any news on porting this to Chaos Chalmer? seafile-seahub and -ccnet are in the repositories, but I couldn&#039;t find seafile-server. Do you think the source would compile also for the latest release? I would be happy to test this on a mpc85xx platform, but haven&#039;t tried to compile anything myself yet (for openwrt, that is).</p><p>I guess developing for openwrt can be quite frustrating, maybe this a dead end anyway.</p><p>Any comments or help appreciated!<br />Stefan</p></blockquote></div><p>Hi Stefan,</p><p>unfortunately, package definitions in the development branch have been broken for a long time now, therefore the main package (seafile-server) didn&#039;t get included in Chaos Calmer. <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><p>I&#039;ve already published my work upgrading seafile and adding it to the development branch, but it hasn&#039;t been merged yet:</p><p><a href="https://github.com/openwrt/packages/pull/2651">https://github.com/openwrt/packages/pull/2651</a></p><p>If you are very eager to test the new version, feel free to build a custom image using my fork of the packages repo:</p><p><a href="https://github.com/kissg1988/packages/tree/seafile">https://github.com/kissg1988/packages/tree/seafile</a></p><p>Actually, it builds well with Chaos Calmer, too, although it&#039;s not thoroughly tested so results may vary:</p><p><a href="https://github.com/kissg1988/packages/tree/for-15.05">https://github.com/kissg1988/packages/tree/for-15.05</a></p><p>Regards,<br />Gergely</p>											<p class="post-edited">(Last edited by <strong>geryhun</strong> on 14 Jun 2016, 19:03)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>