<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Netgear DG834GT flashing?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 21 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p116043">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">Azurael</div>
					<div class="post-datetime">
						28 Aug 2010, 19:09					</div>
				</div>
				<div class="post-content content">
					<p>The DG834GT is now listed as working... But I can&#039;t make it. Trying to flash in recovery mode using the most excellent <a href="http://wilmer.gaast.net/834root/wiki/nftp">nftp utility</a> but whenever I flash an image (e.g. <a href="http://downloads.openwrt.org/backfire/10.03.1-rc2/brcm63xx/openwrt-DG834GT_DG834PN-squashfs-cfe.bin)">http://downloads.openwrt.org/backfire/1 â€¦ s-cfe.bin)</a> it reboots straight back into recovery mode - I&#039;ve tried padding the file out to a filesize multiple of 1024 (I noticed stock Netgear firmwares have a lot of 0s at the end of the file), modding nftp so it doesn&#039;t require the file to be a multiple of 1024, nothing works - it verifies sucessfully, then just boots straight back into recovery mode &#039;til I flash a &#039;valid&#039; file, like the latest DGTeam firmware.</p><p>Opening a Netgear/DGTeam firmware and OpenWRT concurrently in a hex editor confirms that the header information is very different at the start of the file - perhaps there&#039;s something I need to append to the file to flash like this, as per older Netgear routers, even in recovery mode?</p><p>Any advice would be much appreciated. I don&#039;t really want to build a serial interface to do this as it&#039;s not really worth the effort, these routers are practically a throwaway now and I&#039;d just like one to run a decent firmware &#039;til I get hold of something else with integrated DSL (and preferably more RAM, 5GHz Wireless-N&nbsp; and a USB port.)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p116046">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">Azurael</div>
					<div class="post-datetime">
						28 Aug 2010, 20:23					</div>
				</div>
				<div class="post-content content">
					<p>Flashing the <a href="http://213.251.184.91/openwrt/dg834pn/openwrt-DG834PN.img">image</a> provided in <a href="https://forum.openwrt.org/viewtopic.php?id=20189">this thread</a> for the DG834PN works fine from recovery on my GTs. Now I just need to work out how to create a valid, flashable file of 10.03... :-/</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p116070">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">fyi</div>
					<div class="post-datetime">
						29 Aug 2010, 05:32					</div>
				</div>
				<div class="post-content content">
					<p>Read this.<br /><a href="http://wiki.openwrt.org/oldwiki/openwrtdocs/hardware/netgear/dg834gt">Netgear DG834GT - OpenWrt Wiki</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p116092">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">Azurael</div>
					<div class="post-datetime">
						29 Aug 2010, 14:34					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ve read that several times from top to bottom... I must have missed the bit where it explains where to sign/checksum the files to flash WITHOUT a serial interface if it&#039;s there???</p><p>Clearly it&#039;s possible as I now have a signed, older version of OpenWRT which works fine on the DG834GT (PN is the same hardware...)</p>											<p class="post-edited">(Last edited by <strong>Azurael</strong> on 29 Aug 2010, 14:36)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p116145">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">fyi</div>
					<div class="post-datetime">
						30 Aug 2010, 10:51					</div>
				</div>
				<div class="post-content content">
					<p>If you&#039;d like to flash with Netgear&#039;s WebGUI, I think you&#039;ll need to create a 256-byte header.</p><p><a href="http://skaya.enix.org/wiki/FirmwareFormat">SkayaWiki:FirmwareFormat</a><br /><a href="http://skaya.enix.org/wiki/BroadCom96345">SkayaWiki:BroadCom96345</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p116187">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">Azurael</div>
					<div class="post-datetime">
						31 Aug 2010, 00:44					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m not flashing from the WebGUI, I&#039;m flashing using recovery mode, but I think the same restrictions apply, so I&#039;ll give it a go. Cheers, that was the information I was looking for <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p116194">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">fyi</div>
					<div class="post-datetime">
						31 Aug 2010, 05:53					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Azurael wrote:</cite><blockquote><p>Flashing the <a href="http://213.251.184.91/openwrt/dg834pn/openwrt-DG834PN.img">image</a> provided in <a href="https://forum.openwrt.org/viewtopic.php?id=20189">this thread</a> for the DG834PN works fine from recovery on my GTs. Now I just need to work out how to create a valid, flashable file of 10.03... :-/</p></blockquote></div><p>Please compare the two img from that thread to see if there&#039;s only a 256-byte header difference.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p116540">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">fyi</div>
					<div class="post-datetime">
						6 Sep 2010, 00:05					</div>
				</div>
				<div class="post-content content">
					<p><a href="http://wiki.openwrt.org/oldwiki/openwrtdocs/hardware/comtrend/ct_5621#tools">Comtrend CT-5621 - OpenWrt Wiki</a> - <strong>Tools</strong><br /><a href="http://wiki.openwrt.org/doc/techref/brcm63xx.imagetag">BCM63xx Firmware Image Information - OpenWrt Wiki</a></p>											<p class="post-edited">(Last edited by <strong>fyi</strong> on 6 Sep 2010, 00:10)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p116702">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">pspmann</div>
					<div class="post-datetime">
						8 Sep 2010, 19:09					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ve a DG834GT with Open WRT (French version, because it seems that there are several versions), and I flashed it with serial cable and using TFTP to transfer image by CFE. I compile the firmware myself, I can send it to you this weekend (few revisions after backfire)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p144111">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">ef</div>
					<div class="post-datetime">
						20 Sep 2011, 22:36					</div>
				</div>
				<div class="post-content content">
					<p>For anyone looking this up on Google, this is how you do it:</p><p>nftp updates the whole entire flash, whereas the downloadable images are just the filesystem and kernel. The filesystem and kernel start at 0x10000 , which is where the router expects to find the 256 byte header. 0x00000 - 0x0FFFF appear to be some kind of second-stage boot loader. If you&#039;re able to flash a filesystem image over it and still get to recovery mode, then I don&#039;t expect it is the first-stage bootloader.</p><p>What you need to do is download an official firmware (or dump your existing one), and extract the first 65536 bytes, and prepend them to the downloaded image. Then you&#039;ll need to pad it to a multiple of 1024 bytes. I had to patch out the magic value check in nftp to flash openwrt to the router.</p><p>The full nftp image is &lt;2bl&gt;&lt;downloaded openwrt image&gt;&lt;null padding to multiple of 1024 bytes&gt;.</p><p>head -c 65536 netgear_firmware.bin &gt; 2bl.bin<br />dd if=/dev/zero of=padding.bin bs=1020 count=1<br />cat 2bl.bin openwrt.bin padding.bin &gt; flash_with_tftp.bin</p><br /><br /><p>In my experience 10.03 doesn&#039;t work (flashes, boots, sits there doing nothing), but 10.03.1-rc5 does (though I can&#039;t get ADSL to work, and believe it to be unsupported at present).</p><p>Also flashing between OpenWRT and official firmwares might turn your DG834PN into a DG834PNB: the only difference is the software.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p164522">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">bulanula</div>
					<div class="post-datetime">
						14 Apr 2012, 23:07					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>ef wrote:</cite><blockquote><p>head -c 65536 netgear_firmware.bin &gt; 2bl.bin<br />dd if=/dev/zero of=padding.bin bs=1020 count=1<br />cat 2bl.bin openwrt.bin padding.bin &gt; flash_with_tftp.bin</p></blockquote></div><p>I think this needs to be mentioned. In Linux to see the filesize in bytes you need to do &quot;ls -l&quot;. Then you need to do some calculations : </p><p>65536 = 2bl.bin <br />2359300 = openwrt-DG834GT_DG834PN-squashfs-cfe.bin<br />Total = 65 536 + 2 359 300 = 2 424 836; so if we divide this number by 1024 we get a multiple of 2368.00391 but this needs to be 2369 so for a total number our image needs to be is 2369*1024=2425856 so the padding will be 2425856-2424836=1020 ( in this example ) </p><p>So now you can use 1020 as the padding size in the above commands. I did this with a trunk image for the SKY DG834GT and it accepted the image using the NFTP flasher. </p><p>If you use this program <a href="http://www.skyuser.co.uk/forum/technical-discussion/32854-firmware-image-editing-tool-dg834gt-sagem-f-st-broadcom-based-routers.html#post235918">http://www.skyuser.co.uk/forum/technica â€¦ post235918</a> then I bet you can use the instructions for this tool to flash a standard OpenWRT / DGTeam / Netgear firmware to a SKY branded DG834GT using the web interface ! </p><p>Basically you need to get a usable .img file for these SKY DG834GT routers before you can do ANYTHING to them. Then ( after you have the .img that is valid and divisible by 1024 bytes ) you can either use the modified NFTP ( that skips checking for a valid image file ) and flash them using the recovery mode tool OR you can use that &quot;Broadcom Firmware Tool&quot; program to apply a custom SKY header to the .img file that makes it possible to then flash OpenWRT straight from the original SKY web interface !</p><p>I am in the process of contacting the author of this tool ( mrmt32 at gmail.com ) so he can give us a Linux version of this valuable tool for those that don&#039;t run Windows ( like me ) because the program is a port of a Linux tool etc. </p><p>Hope this helps anyone ! Pity the ADSL driver needs more work ...</p>											<p class="post-edited">(Last edited by <strong>bulanula</strong> on 14 Apr 2012, 23:25)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p169867">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">bulanula</div>
					<div class="post-datetime">
						13 Jun 2012, 01:17					</div>
				</div>
				<div class="post-content content">
					<p>Just some more findings I uncovered. </p><p>With the SKY version of this router you must trick the device to be able to upload firmware via web interface. </p><p>The Netgear original version does not need any tricks as the bootloader is unlocked and does not check the firmware like the SKY UK ISP version does. </p><p>The tool above ( Broadcom Firmware Tool ) works a treat using mono-complete package on Debian and puts out good images that can be flashed even on the SKY DG834GT. </p><p>However, it is impossible to get OpenWRT flashed from the web interface on these routers ( AFAIK ) because the firmware format is very different compared to original Netgear firmwares. </p><p>Someone please update if you know a way without the NFTP recovery mode procedure ( or serial ). I tried lots of ways and it just would not flash OpenWRT images from the web interface even if they got accepted, the router would be unresponsive while flashing the same OpenWRT image through the NFTP tool would work perfectly. </p><p>No problems flashing Netgear based firmwares like DGTeam on SKY or original Netgear device if you use the Broadcom Firmware Tool.</p><p>EDIT : Quote from wiki - &quot;For an easier upload method than messing around with nftp (constant fail for me, probably user error), once you have made the &quot;openwrt-DG834GT-2.6.27.11.img&quot; file, it can be uploaded thru the original web interface / flash upgrade router procedure. Wish I had known THAT 2 hours ago!&quot; so it looks like somebody did make it work !? </p><p>I tried all sorts of methods but for firmware update through web interface to work I needed to have OpenWRT installed already. I could not flash the router from Netgear FW -&gt; OpenWRT FW directly by web interface the first time. Can somebody confirm this is the case ? I think the firmware sections or something are not compatible so the way the web flasher works makes the device unresponsive compared to NFTP that writes directly to flash as layout in FW indicates.</p>											<p class="post-edited">(Last edited by <strong>bulanula</strong> on 13 Jun 2012, 01:31)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>