<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Find kernel config of a specific binary build</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 14 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p146671">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">sza2</div>
					<div class="post-datetime">
						25 Oct 2011, 22:34					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>I&#039;ve successfully installed openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin on my router (r28428). However, I would like to compile some kernel modules for it (namely for a DiBcom USB/DVB-T device).</p><p>Is there a way to get (extract, generate) the exact same .config as used for the above mentioned image?</p><p>I checked out the current trunk from SVN, somehow I managed to build the necessary modules, I&#039;m able to insert those modules, but I get a kernel Oops when I connect the device to the USB port.</p><p>So I think the problem might have in the unsuitable kernel modules (gcc seems the same as the one used for building binary flash image).</p><p>Can I have the original config somehow?</p><p>Thanks,</p><p>/sza2</p><p>Loaded modules and dmesg out:</p><p>insmod dib0070<br />insmod dib0090<br />insmod dibx000_common<br />insmod dib3000mc<br />insmod dib7000m<br />insmod s5h1411<br />insmod dvb-core<br />insmod rc-core<br />insmod dvb-usb<br />insmod dib7000p<br />insmod dib8000<br />insmod dib9000<br />insmod lgdt3305<br />insmod xc5000<br />insmod tuner-xc2028<br />insmod mt20xx<br />insmod mt2266<br />insmod mt2060<br />insmod mxl5007t<br />insmod dvb-usb-dib0700</p><p>dib0700: loaded with support for 20 different device-types<br />usbcore: registered new interface driver dvb_usb_dib0700<br />...<br />And when I connect the device:<br />...<br />usb 1-1.2: new high speed USB device number 6 using ar71xx-ehci<br />dvb-usb: found a &#039;Sony PlayTV&#039; in cold state, will try to load a firmware<br />dvb-usb: downloading firmware from file &#039;dvb-usb-dib0700-1.20.fw&#039;<br />dib0700: firmware started successfully.<br />dvb-usb: found a &#039;Sony PlayTV&#039; in warm state.<br />dvb-usb: will pass the complete MPEG2 transport stream to the software demuxer.<br />DVB: registering new adapter (Sony PlayTV)<br />DVB: registering adapter 0 frontend 0 (DiBcom 7000PC)...<br />DiB0070: successfully identified<br />dvb-usb: will pass the complete MPEG2 transport stream to the software demuxer.<br />DVB: registering new adapter (Sony PlayTV)<br />DVB: registering adapter 1 frontend 0 (DiBcom 7000PC)...<br />DiB0070: successfully identified<br />CPU 0 Unable to handle kernel paging request at virtual address 00000000, epc == 80f94898, ra == 80f94890<br />Oops[#1]:<br />Cpu 0<br />$ 0&nbsp; &nbsp;: 00000000 00000001 00000000 00000001<br />$ 4&nbsp; &nbsp;: 81a87034 80294f18 802ff000 00000000<br />$ 8&nbsp; &nbsp;: 00000000 8015d3f0 00000001 2f697230<br />$12&nbsp; &nbsp;: 00000000 00000000 00c3ac48 81bfa0c8<br />$16&nbsp; &nbsp;: 81a87000 81a87000 fffffff4 8188d004<br />$20&nbsp; &nbsp;: 80fb7e84 8188cc0c 80fa0000 8188c01c<br />$24&nbsp; &nbsp;: 00000003 8018bf50&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />$28&nbsp; &nbsp;: 81a96000 81a97ad0 80f9a7e8 80f94890<br />Hi&nbsp; &nbsp; : 00000000<br />Lo&nbsp; &nbsp; : b61f0000<br />epc&nbsp; &nbsp;: 80f94898 0x80f94898<br />&nbsp; &nbsp; Not tainted<br />ra&nbsp; &nbsp; : 80f94890 0x80f94890<br />Status: 1000fc03&nbsp; &nbsp; KERNEL EXL IE <br />Cause : 00800008<br />BadVA : 00000000<br />PrId&nbsp; : 00019374 (MIPS 24Kc)<br />Modules linked in: dvb_usb_dib0700 mxl5007t mt2060 mt2266 mt20xx tuner_xc2028 xc5000 lgdt3305 dib9000 dib8000 dib7000p dvb_usb rc_core dvb_core s5h1411 dib7000m dib3000mc dibx000_common dib0090 dib0070 uvcvideo btusb hci_uart hidp bnep rfcomm bluetooth hid v4l2_common videodev cdc_acm evdev i2c_dev ledtrig_usbdev nf_nat_irc nf_conntrack_irc nf_nat_ftp nf_conntrack_ftp ipt_MASQUERADE iptable_nat nf_nat xt_conntrack xt_NOTRACK iptable_raw xt_state nf_conntrack_ipv4 nf_defrag_ipv4 nf_conntrack pppoe pppox ipt_REJECT xt_TCPMSS ipt_LOG xt_comment xt_multiport xt_mac xt_limit iptable_mangle iptable_filter ip_tables xt_tcpudp x_tables ppp_async ppp_generic slhc ath9k ath9k_common ath9k_hw ath mac80211 rfkill crc_ccitt cfg80211 compat arc4 aes_generic crypto_algapi usb_storage uhci_hcd ohci_hcd ehci_hcd sd_mod ext4 jbd2 mbcache usbcore scsi_mod nls_base crc16 leds_gpio button_hotplug gpio_keys_polled input_polldev input_core<br />Process khubd (pid: 405, threadinfo=81a96000, task=81933240, tls=00000000)<br />Stack : 80fa0000 8188c000 8188c7e0 00000000 8188d004 8188c000 8188c7e0 80f99a0c<br />&nbsp; &nbsp; &nbsp; &nbsp; 8188c3f0 8188cc0c 00000000 81853c80 80f93404 8188c000 8188c3f0 8188c000<br />&nbsp; &nbsp; &nbsp; &nbsp; 8188c7e0 00000002 00000000 80f98a24 00000008 8188c094 00000000 8018c90c<br />&nbsp; &nbsp; &nbsp; &nbsp; 00000001 80fb7e84 00000006 81b52a00 80fc0000 80fb5270 80fb4b40 80fbe510<br />&nbsp; &nbsp; &nbsp; &nbsp; 80f93468 81b16c90 80585404 80fb0f64 00000000 81b59e40 80e456c0 80e7fb00<br />&nbsp; &nbsp; &nbsp; &nbsp; ...<br />Call Trace:[&lt;80fa0000&gt;] 0x80fa0000<br />[&lt;80f99a0c&gt;] 0x80f99a0c<br />[&lt;80f98a24&gt;] 0x80f98a24<br />[&lt;8018c90c&gt;] 0x8018c90c<br />[&lt;80fb0f64&gt;] 0x80fb0f64<br />[&lt;8011c388&gt;] 0x8011c388<br />[&lt;81b0b010&gt;] 0x81b0b010<br />[&lt;81b0b1ec&gt;] 0x81b0b1ec<br />[&lt;80197198&gt;] 0x80197198<br />[&lt;801974a4&gt;] 0x801974a4<br />[&lt;8019762c&gt;] 0x8019762c<br />[&lt;801975fc&gt;] 0x801975fc<br />[&lt;801960f0&gt;] 0x801960f0<br />[&lt;80155b60&gt;] 0x80155b60<br />[&lt;80197300&gt;] 0x80197300<br />[&lt;80196b40&gt;] 0x80196b40<br />[&lt;801948d8&gt;] 0x801948d8<br />[&lt;81b0a3a8&gt;] 0x81b0a3a8<br />[&lt;81b10fc8&gt;] 0x81b10fc8<br />[&lt;801f79a8&gt;] 0x801f79a8<br />[&lt;801974a4&gt;] 0x801974a4<br />[&lt;8019762c&gt;] 0x8019762c<br />[&lt;801975fc&gt;] 0x801975fc<br />[&lt;801960f0&gt;] 0x801960f0<br />[&lt;80155b60&gt;] 0x80155b60<br />[&lt;80197300&gt;] 0x80197300<br />[&lt;80196b40&gt;] 0x80196b40<br />[&lt;801948d8&gt;] 0x801948d8<br />[&lt;81b09564&gt;] 0x81b09564<br />[&lt;81b03aa8&gt;] 0x81b03aa8<br />[&lt;81b044ac&gt;] 0x81b044ac<br />[&lt;8006f55c&gt;] 0x8006f55c<br />[&lt;8008cb48&gt;] 0x8008cb48<br />[&lt;81b03b0c&gt;] 0x81b03b0c<br />[&lt;8008c5fc&gt;] 0x8008c5fc<br />[&lt;80064080&gt;] 0x80064080<br />[&lt;8008c57c&gt;] 0x8008c57c<br />[&lt;80064070&gt;] 0x80064070</p><br /><p>Code: 02002021&nbsp; 3c0280f9&nbsp; 8c426ca0 &lt;8c430000&gt; 24630001&nbsp; ac430000&nbsp; 8fbf001c&nbsp; 02201021&nbsp; 8fb10018 <br />Disabling lock debugging due to kernel taint<br />root@OpenWrt:~# </p><p>And of course DVB related things does not work...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p146677">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">kallekalas</div>
					<div class="post-datetime">
						26 Oct 2011, 00:21					</div>
				</div>
				<div class="post-content content">
					<p>Try checking out the same version that you tested with:<br />svn co svn://svn.openwrt.org/openwrt/trunk -r 284228&nbsp; openwrt-svn</p><p>There should be a config file where you found then binary, e.g. <a href="http://downloads.openwrt.org/backfire/10.03/ar71xx/OpenWrt.config">http://downloads.openwrt.org/backfire/1 … Wrt.config</a></p><p>/Ulf.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p146710">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">sza2</div>
					<div class="post-datetime">
						26 Oct 2011, 10:24					</div>
				</div>
				<div class="post-content content">
					<p>I downloaded the image from <a href="http://downloads.openwrt.org/snapshots/trunk/ar71xx/">http://downloads.openwrt.org/snapshots/trunk/ar71xx/</a> since it seems my device (TP-Link MR3220) only supported in trunk. But I did not find any config file there :-(</p><p>I checked out r28428 earlier but it does not contains the kernel config file (or at least I did not find it). As I realized, at first I have to configure, but I&#039;m not sure in that way I can produce the same kernel config as used for building the image (<a href="http://downloads.openwrt.org/snapshots/trunk/ar71xx/openwrt-ar71xx-generic-tl-mr3220-v1-squashfs-factory.bin">http://downloads.openwrt.org/snapshots/ … actory.bin</a>).</p><p>So, it OK to generate the config myself, but can anyone give some hint, how can I setup the environment to create the _exactly_ same config? (If I can produce an image bit by bit identical to the official image I belive I did it right :-)</p><p>Fankly, I have a working router, with many things already set up, thus I prefer to simply copy a few .ko to the /lib/modules than start everything from the scratch.</p><p>/sza2</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p146775">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">kallekalas</div>
					<div class="post-datetime">
						26 Oct 2011, 21:43					</div>
				</div>
				<div class="post-content content">
					<p>I would assume that you get the standard configuration from running: make defconfig</p><p>Anyways as long as you have the same kernel version the config should typically not make any difference for the modules, that is the point with modules.</p><p>&gt; CPU 0 Unable to handle kernel paging request at virtual address 00000000</p><p>Seems like some one is using a null pointer. Do you have enough memory in the system to run the dvb stuff? I suspect a malloc returning a null pointer due to lack of memory.</p><p>If you can get symbol information to the call stack, you should be able to see where this is happening.</p><p>/Ulf.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p146802">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">sza2</div>
					<div class="post-datetime">
						27 Oct 2011, 10:22					</div>
				</div>
				<div class="post-content content">
					<p>&quot;Do you have enough memory in the system to run the dvb stuff?&quot;</p><p>Well, in my MR3220 there is 32MB RAM, free RAM is usually 1MB (but there is a ~14MB tmpfs, which I think used only on demand). However I created a swap partition of size almost 1GB so now I virtually have a lot of memory. The result is the same.</p><p>&quot;If you can get symbol information to the call stack&quot;</p><p>Could you give me some hint to start?</p><p>Thanks,</p><p>/sza2</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p146818">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">kallekalas</div>
					<div class="post-datetime">
						27 Oct 2011, 15:09					</div>
				</div>
				<div class="post-content content">
					<p>Ok.</p><p>There&#039;re are two diffrent types of malloc in the kernel. non virtual and unpaged memory and virtuall and paged. Swap only helps for the later type. Mayby a kernel expert can explain more in detail. This being a malloc issue is only a guess from my side based on the null ponter reference, the large amount of and types modules that you load. DVB stuff is suposse will require some mem buffers to operational.</p><p>For the symbol information. I don&#039;t know how to enable them. I just know that they are usally there on my desktop linux and you can pinppoint the offending module with code line with them. I haven&#039;t hacked kernel since 2.2.15....</p><p>/Ulf.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p146870">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">sza2</div>
					<div class="post-datetime">
						28 Oct 2011, 09:29					</div>
				</div>
				<div class="post-content content">
					<p>Well, I disabled services like transmission client, samba, etc, so when I reboot there is ~10MB free RAM. I also removed a ton of unused kernel modules (bt, uvc, ...).<br />Unfortunately the case is absolutely the same. So I think the problem might be somewhere else.</p><p>Regarding the symbol information, I think I need a System.map, but I even don&#039;t have the kernel binary itself (since I use the image, and I don&#039;t know how to extract).</p><p>BTW, any idea is welcome, I will try...</p><p>/sza2</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>