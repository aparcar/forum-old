<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> mwan3; multi-wan policy routing (general topic)</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 22 May 2013 and 6 May 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 13 of 65</div><nav><ul><li><a href="viewtopic.php%3Fid=39052&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=11.html">11</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=12.html">12</a></li><li class="pagination-current"><span>13</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=14.html">14</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=15.html">15</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=65.html">65</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p203079">
				<div class="post-metadata">
					<div class="post-num">Post #301</div>
					<div class="post-author">Thomymaster</div>
					<div class="post-datetime">
						29 May 2013, 09:54					</div>
				</div>
				<div class="post-content content">
					<p>Sorry my fault, i didn&#039;t realize that mediafire is not something with one-time links <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Maybe you could add the mediafire URL to the first post and remove the old URL?</p>											<p class="post-edited">(Last edited by <strong>Thomymaster</strong> on 29 May 2013, 09:54)</p>
									</div>
			</article>

			
		
						<div class="notice">
				<p>Sorry, posts 302 to 300 are missing from our archive.</p>
			</div>
		
		
		
			<article class="post" id="p203065">
				<div class="post-metadata">
					<div class="post-num">Post #301</div>
					<div class="post-author">biatche</div>
					<div class="post-datetime">
						29 May 2013, 03:52					</div>
				</div>
				<div class="post-content content">
					<p>Didn&#039;t arfett just release the latest binary 1-2 days ago?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p203080">
				<div class="post-metadata">
					<div class="post-num">Post #302</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						29 May 2013, 10:15					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Thomymaster wrote:</cite><blockquote><p>Maybe you could add the mediafire URL to the first post and remove the old URL?</p></blockquote></div><p>Done</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p203256">
				<div class="post-metadata">
					<div class="post-num">Post #303</div>
					<div class="post-author">Thomymaster</div>
					<div class="post-datetime">
						31 May 2013, 01:45					</div>
				</div>
				<div class="post-content content">
					<p>I still want to have email message when my link goes from ppoe-wan to 3g-wwan and vice versa. Earlier in this script i was given the following snippet:</p><div class="codebox"><pre><code>#!/bin/sh

# place in /etc/hotplug.d/iface and name 19-mymwancustom
# make executable with &#039;chmod +x 19-mymwancustom&#039;
#
# available variables:
# $ACTION is the hotplug event
# $INTERFACE is the interface name (wan1, wan2, etc.)
# $DEVICE the device name attached to the interface (eth0.1, eth1, etc.)

case &quot;$ACTION&quot; in
    ifup)
        # run this code or additional function added to this script
        # if any interface comes online

        # if you want to limit it to certain interfaces you can do
        #if [ &quot;$INTERFACE&quot; == &quot;wan1&quot; ]; then
            # run this code
        #fi
    ;;

    ifdown)
        # run this code or additional function added to this script
        # if any interface goes offline
    ;;
esac</code></pre></div><p>I don&#039;t understand this, i think both interfaces are always up? Please help me, i only wand a single mail like</p><p>&quot;Internet connection swapped from ppoe-wan to 3g-wwan&quot;</p><p>and </p><p>&quot;Internet connection swapped from 3g-wwan to ppoe-wan&quot;</p><p>As mentioned earlier in this post it would be really great to have a luci-web-page just defining which custom shell scripts can be run in case of these events <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p203259">
				<div class="post-metadata">
					<div class="post-num">Post #304</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						31 May 2013, 01:58					</div>
				</div>
				<div class="post-content content">
					<p>If you track the interfaces then the mwan3track scripts send ifup/ifdown hotplug events. Put your code/scripts in those sections or add your own hotplug script.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p203286">
				<div class="post-metadata">
					<div class="post-num">Post #305</div>
					<div class="post-author">headless.cross</div>
					<div class="post-datetime">
						31 May 2013, 10:47					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>headless.cross wrote:</cite><blockquote><div class="quotebox"><cite>khanh3t wrote:</cite><blockquote><p>hi Adze</p><p>I dont know why. I load balancing 2 line 3G. After 5 minutes download, 1 line will not load balancing. Only 1 line download, i remove line working, line remain work ( that is no line drop ). I think maybe my usb hub, but i change other hub ( 2 kind, and many hub ) nothing change.<br />/ps: i cant remove ip server ping in interface</p></blockquote></div><p>I&#039;m experiencing the same behaviour. After a while, the traffic flows through one interface and the load-balancing fades away.<br />Stopping the download procces fixes things, e.g. my external IP changes correctly.</p></blockquote></div><p>I think this is caused by bad pings. I had the same problem. Until yesterday I was using an old WRT54GL as repeater, and during a heavy load (many connections on a torrent) the pings from 50ms were jumpin to 5000ms or something like that. A friend of mine gave me his TL-WN722N, which replaced the WRT54GL and ... voila!</p><p>Everything now is fine, the download speed is blazing fast and everyone is happy!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p203306">
				<div class="post-metadata">
					<div class="post-num">Post #306</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						31 May 2013, 12:01					</div>
				</div>
				<div class="post-content content">
					<p>khanh3t</p><p>Can you try setting your ping timeout to 5 seconds and see what happens?</p><p>Also if you download the latest mwan3 LuCI app 1.0-12 from the mediafire link there&#039;s more options on the GUI now for up to 10 second timeouts.</p>											<p class="post-edited">(Last edited by <strong>arfett</strong> on 31 May 2013, 13:51)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p203335">
				<div class="post-metadata">
					<div class="post-num">Post #307</div>
					<div class="post-author">headless.cross</div>
					<div class="post-datetime">
						31 May 2013, 15:09					</div>
				</div>
				<div class="post-content content">
					<p>@arfett:</p><p>I just downloaded the latest binaries from mediafire, but I had errors during installation &quot;deb invalid magic&quot;. IMHO you have to run &quot;make clean&quot; and then re-compile the packages.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p203336">
				<div class="post-metadata">
					<div class="post-num">Post #308</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						31 May 2013, 15:10					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>headless.cross wrote:</cite><blockquote><p>@arfett:</p><p>I just downloaded the latest binaries from mediafire, but I had errors during installation &quot;deb invalid magic&quot;. IMHO you have to run &quot;make clean&quot; and then re-compile the packages.</p></blockquote></div><p>My script does that every time I compile. Worked for me.</p>											<p class="post-edited">(Last edited by <strong>arfett</strong> on 31 May 2013, 15:15)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p203337">
				<div class="post-metadata">
					<div class="post-num">Post #309</div>
					<div class="post-author">headless.cross</div>
					<div class="post-datetime">
						31 May 2013, 15:12					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>arfett wrote:</cite><blockquote><p>My script does that every time I compile.</p></blockquote></div><p>Strange though, I had to compile the sources by myself and then the installation went fine.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p203392">
				<div class="post-metadata">
					<div class="post-num">Post #310</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						1 Jun 2013, 02:13					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Thomymaster wrote:</cite><blockquote><p>As mentioned earlier in this post it would be really great to have a luci-web-page just defining which custom shell scripts can be run in case of these events <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p></blockquote></div><p>Not going to happen anytime soon. Because of how the rules/policies work it would be rather difficult (giant pain in the balls) for Adze to add any sort of function that would say, &quot;failed over to X interface.&quot; At best you can hope for reports on specific interfaces going up or down and you can easily figure out where it would have failed over to based on your policies.</p><p>It should be fairly easy for you to make a hotplug script which calls other scripts based on ifup and ifdown hotplug events (requires you to track interfaces.) The latest GUI files in 1.0-14 allow you to edit a custom hotplug script which is entirely separate from the main mwan3 hotplug script so you can&#039;t bone it with mistakes or typos. That&#039;s about as far as I&#039;m going to take this.</p><p>If you were so inclined you could (possibly) add the functionality you want to the custom script yourself.</p><p>It would require you to do the following:<br />1. determine that an interface has gone down (ifdown event)<br />2. scan mwan3 config and find all members containing this interface<br />3. scan mwan3 config and find all policies containing those members for failover/loadbalance<br />4. determine next failover/loadbalance device(s)<br />5. return that data and format it in some meaningful way</p><p>Edit: Who knows maybe when I&#039;m bored I&#039;ll add something like this to the default custom hotplug script. Don&#039;t hold your breath.</p>											<p class="post-edited">(Last edited by <strong>arfett</strong> on 1 Jun 2013, 06:39)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p203493">
				<div class="post-metadata">
					<div class="post-num">Post #311</div>
					<div class="post-author">ranfish</div>
					<div class="post-datetime">
						2 Jun 2013, 07:03					</div>
				</div>
				<div class="post-content content">
					<p>I found an app for creating virtual wans of a physical wan which can be used to dial the same pppoe acount for several times.But it doesn&#039;t have route assignment and weak in load banlancing.So I want to use mwan3 to do the route assignment and load banlancing instead.Is it possible to pack them together? Here is the patch to add it to luci.<br /></p><div class="codebox"><pre><code>diff -Nuar a/applications/luci-macvlan/luasrc/controller/macvlan.lua c/applications/luci-macvlan/luasrc/controller/macvlan.lua
--- a/applications/luci-macvlan/luasrc/controller/macvlan.lua    1970-01-01 08:00:00.000000000 +0800
+++ c/applications/luci-macvlan/luasrc/controller/macvlan.lua    2012-09-20 16:20:28.000000000 +0800
@@ -0,0 +1,13 @@
+
+module(&quot;luci.controller.macvlan&quot;, package.seeall)
+
+function index()
+    if not nixio.fs.access(&quot;/etc/config/macvlan&quot;) then
+        return
+    end
+    
+    local page = entry({&quot;admin&quot;, &quot;network&quot;, &quot;macvlan&quot;}, cbi(&quot;macvlan&quot;), _(&quot;macvlan&quot;), 11)
+    page.i18n = &quot;macvlan&quot;
+    page.dependent = true
+    
+end
diff -Nuar a/applications/luci-macvlan/luasrc/model/cbi/macvlan.lua c/applications/luci-macvlan/luasrc/model/cbi/macvlan.lua
--- a/applications/luci-macvlan/luasrc/model/cbi/macvlan.lua    1970-01-01 08:00:00.000000000 +0800
+++ c/applications/luci-macvlan/luasrc/model/cbi/macvlan.lua    2012-09-24 18:38:34.000000000 +0800
@@ -0,0 +1,98 @@
+local fs = require &quot;nixio.fs&quot;
+local sys = require &quot;luci.sys&quot;
+local wan_ifname = luci.util.exec(&quot;uci get network.wan.ifname&quot;)
+local wan1_ifname = luci.util.exec(&quot;uci get network.wan1.ifname&quot;)
+local wan2_ifname = luci.util.exec(&quot;uci get network.wan2.ifname&quot;)
+local wan3_ifname = luci.util.exec(&quot;uci get network.wan3.ifname&quot;)
+local wan4_ifname = luci.util.exec(&quot;uci get network.wan4.ifname&quot;)
+
+local function arplist(opt)
+    local _, e, mac, ip, name
+    local arp = { }
+
+    for _, e in ipairs(luci.sys.net.arptable()) do
+        arp[e[&quot;HW address&quot;]:upper()] = { e[&quot;IP address&quot;] }
+    end
+
+    if fs.access(&quot;/etc/ethers&quot;) then
+        for e in io.lines(&quot;/etc/ethers&quot;) do
+            mac, ip = e:match(&quot;^([a-f0-9]%S+) (%S+)&quot;)
+            if mac and ip then arp[mac:upper()] = { ip } end
+        end
+    end
+
+    if fs.access(&quot;/var/dhcp.leases&quot;) then
+        for e in io.lines(&quot;/var/dhcp.leases&quot;) do
+            mac, ip, name = e:match(&quot;^%d+ (%S+) (%S+) (%S+)&quot;)
+            if mac and ip then arp[mac:upper()] = { ip, name ~= &quot;*&quot; and name } end
+        end
+    end
+
+    for mac, e in luci.util.kspairs(arp) do
+        opt:value(mac, &quot;%s (%s)&quot; %{ mac, e[2] or e[1] })
+    end
+end
+
+m = Map(&quot;macvlan&quot;, translate(&quot;macvlan&quot;), translate(&quot;macvlanhelp&quot;))
+
+s = m:section(TypedSection, &quot;macvlan&quot;, translate(&quot;macvlan Settings&quot;))
+s.anonymous = true
+s.addremove = true
+
+enabled = s:option(Flag, &quot;enabled&quot;, translate(&quot;enabled&quot;))
+enabled.optional = false
+enabled.rmempty = false
+
+ifname = s:option(Value, &quot;ifname&quot;, translate(&quot;ifname&quot;))
+ifname.optional = false
+ifname.rmempty = false
+ifname.default = wan_ifname
+ifname:value(wan_ifname,translate(&quot;WAN&quot;))
+ifname:value(wan1_ifname,translate(&quot;WAN1&quot;))
+ifname:value(wan2_ifname,translate(&quot;WAN2&quot;))
+ifname:value(wan3_ifname,translate(&quot;WAN3&quot;))
+ifname:value(wan4_ifname,translate(&quot;WAN4&quot;))
+
+vlan = s:option(Value, &quot;vlan&quot;, translate(&quot;vlan&quot;), translate(&quot;vlanhelp&quot;))
+vlan.optional = false
+vlan.rmempty = false
+
+zdy = s:option(Flag, &quot;zdy&quot;, translate(&quot;zdy&quot;), translate(&quot;zdyhelp&quot;))
+zdy.optional = false
+zdy.rmempty = false
+
+xieyi = s:option(ListValue, &quot;xieyi&quot;, translate(&quot;xieyi&quot;))
+xieyi:value(&quot;dhcp&quot;, translate(&quot;DHCP&quot;))
+xieyi:value(&quot;pppoe&quot;, translate(&quot;PPPoE&quot;))
+xieyi.optional = false
+xieyi.rmempty = true
+xieyi:depends(&quot;zdy&quot;, &quot;1&quot;)
+
+username = s:option(Value, &quot;username&quot;, translate(&quot;username&quot;))
+username.optional = false
+username.rmempty = true
+username:depends(&quot;xieyi&quot;, &quot;pppoe&quot;)
+
+password = s:option(Value, &quot;password&quot;, translate(&quot;password&quot;))
+password.password = true
+password.optional = false
+password.rmempty = true
+password:depends(&quot;xieyi&quot;, &quot;pppoe&quot;)
+
+s = m:section(TypedSection, &quot;switch&quot;, translate(&quot;switch Settings&quot;), translate(&quot;switchhelp&quot;))
+s.anonymous=true
+s.addremove=false
+
+enabled = s:option(Flag, &quot;enabled&quot;, translate(&quot;enabled&quot;), translate(&quot;enabledhelp&quot;))
+enabled.optional = false
+enabled.rmempty = false
+
+interfaces = s:option(ListValue, &quot;interfaces&quot;, translate(&quot;interfacesd&quot;))
+interfaces:value(&quot;2&quot;, translate(&quot;2&quot;))
+interfaces:value(&quot;3&quot;, translate(&quot;3&quot;))
+interfaces:value(&quot;4&quot;, translate(&quot;4&quot;))
+interfaces:value(&quot;5&quot;, translate(&quot;5&quot;))
+interfaces.optional = false
+interfaces.rmempty = true
+
+return m
diff -Nuar a/applications/luci-macvlan/Makefile c/applications/luci-macvlan/Makefile
--- a/applications/luci-macvlan/Makefile    1970-01-01 08:00:00.000000000 +0800
+++ c/applications/luci-macvlan/Makefile    2012-12-16 18:01:16.207264103 +0800
@@ -0,0 +1,4 @@
+PO = macvlan
+
+include ../../build/config.mk
+include ../../build/module.mk
diff -Nuar a/applications/luci-macvlan/root/etc/config/macvlan c/applications/luci-macvlan/root/etc/config/macvlan
--- a/applications/luci-macvlan/root/etc/config/macvlan    1970-01-01 08:00:00.000000000 +0800
+++ c/applications/luci-macvlan/root/etc/config/macvlan    2012-09-25 19:37:09.000000000 +0800
@@ -0,0 +1,9 @@
+config macvlan
+    option enabled &#039;0&#039;
+    option ifname &#039;&#039;
+    option vlan &#039;2&#039;
+    option zdy &#039;0&#039;
+
+config switch
+    option enabled &#039;0&#039;
+    option interfaces &#039;2&#039;
diff -Nuar a/applications/luci-macvlan/root/etc/init.d/macvlan c/applications/luci-macvlan/root/etc/init.d/macvlan
--- a/applications/luci-macvlan/root/etc/init.d/macvlan    1970-01-01 08:00:00.000000000 +0800
+++ c/applications/luci-macvlan/root/etc/init.d/macvlan    2012-09-30 03:42:32.000000000 +0800
@@ -0,0 +1,195 @@
+#!/bin/sh /etc/rc.common
+# Copyright (C) 2006-2011 OpenWrt.org
+. /etc/functions.sh
+
+START=21
+
+name=$(uci get network.@switch[0].name)
+ports=$(uci get network.@switch_vlan[0].ports|awk -F&quot; &quot; &#039;{ print $1 }&#039;)
+
+start() {
+    config_load macvlan
+    config_foreach delete macvlan
+    config_foreach switch_get switch
+    config_foreach macvlan_get macvlan
+    firewall
+}
+
+delete() {
+    config_get ifname $1 ifname
+    config_get sl $1 sl &quot;1&quot;
+    network=$(uci show network|fgrep .ifname=&quot;$ifname&quot;|cut -d&quot;.&quot; -f2)
+    n=$(echo &quot;$network&quot;|sed &#039;s/wan//&#039;)
+    vth=$(uci show network|fgrep .ifname|grep -c vth)
+    switch=$(uci show network|grep -c &quot;device=$name&quot;)
+    while [ &quot;$vth&quot; -ne 0 ];
+    do
+    ip link del vth$((n*100 + sl))
+    uci delete network.vth$((n*100 + sl))
+    uci delete dhcp.vth$((n*100 + sl))
+    sl=$((sl+1))
+    vth=$(uci show network|fgrep .ifname|grep -c vth)
+    done
+    [ $ports == 0 ] &amp;&amp; {
+    while [ &quot;$switch&quot; -ne 1 ];
+    do
+    vlan=$(uci get network.@switch_vlan[-1].vlan)
+    interface=$(uci show network|grep &quot;ifname=$name.$vlan&quot;|cut -d&quot;.&quot; -f2)
+    ifdown $interface
+    [ $(uci get macvlan.@switch[-1].enabled) == 0 ] &amp;&amp; uci delete network.$interface
+    uci delete network.@switch_vlan[-1]
+    uci set network.@switch_vlan[0].ports=&quot;0 1 2 3 4&quot;
+    uci set network.lan.ifname=$name
+    switch=$(uci show network|grep -c &quot;device=$name&quot;)
+    done
+    }
+    [ $ports == 0t ] &amp;&amp; {
+    while [ &quot;$switch&quot; -ne 2 ];
+    do
+    vlan=$(uci get network.@switch_vlan[-1].vlan)
+    interface=$(uci show network|grep &quot;ifname=$name.$vlan&quot;|cut -d&quot;.&quot; -f2)
+    ifdown $interface
+    [ $(uci get macvlan.@switch[-1].enabled) == 0 ] &amp;&amp; uci delete network.$interface
+    uci delete network.@switch_vlan[-1]
+    uci set network.@switch_vlan[0].ports=&quot;0t 2 3 4 5&quot;
+    switch=$(uci show network|grep -c &quot;device=$name&quot;)
+    done
+    }
+}
+
+switch_get() {
+    config_get enabled $1 enabled
+    config_get interfaces $1 interfaces
+    [ $enabled == 1 ] &amp;&amp; {
+        [ $ports == 0 ] &amp;&amp; {
+        case $interfaces in
+        2)
+        uci set network.@switch_vlan[0].ports=&quot;0 2 3 4&quot;
+        uci set network.lan.ifname=&quot;$name&quot;.1
+        ;;
+        3)
+        uci set network.@switch_vlan[0].ports=&quot;0 3 4&quot;
+        uci set network.lan.ifname=&quot;$name&quot;.1
+        ;;
+        4)
+        uci set network.@switch_vlan[0].ports=&quot;0 4&quot;
+        uci set network.lan.ifname=&quot;$name&quot;.1
+        ;;
+        5)
+        uci set network.@switch_vlan[0].ports=&quot;0&quot;
+        uci delete network.lan.ifname
+        ;;
+        esac
+        while [ $interfaces -gt 1 ];
+        do
+        uci add network switch_vlan
+        uci set network.@switch_vlan[-1].device=$name
+        uci set network.@switch_vlan[-1].vlan=$interfaces
+        uci set network.@switch_vlan[-1].ports=&quot;0t $((interfaces-1))&quot;
+        if [ -z $(uci get network.wan&quot;$((interfaces-1))&quot;) ]; then
+        uci set network.wan&quot;$((interfaces-1))&quot;=interface
+        uci set network.wan&quot;$((interfaces-1))&quot;.ifname=${name}.$interfaces
+        uci set network.wan&quot;$((interfaces-1))&quot;.proto=dhcp
+        uci set dhcp.wan&quot;$((interfaces-1))&quot;=dhcp
+        uci set dhcp.wan&quot;$((interfaces-1))&quot;.interface=wan&quot;$((interfaces-1))&quot;
+        uci set dhcp.wan&quot;$((interfaces-1))&quot;.ignore=1
+        fi
+        ifup wan&quot;$((interfaces-1))&quot;
+        interfaces=$((interfaces-1))
+        done
+        }
+        [ $ports == 0t ] &amp;&amp; {
+        case $interfaces in
+        2)
+        uci set network.@switch_vlan[0].ports=&quot;0t 3 4 5&quot;
+        ;;
+        3)
+        uci set network.@switch_vlan[0].ports=&quot;0t 4 5&quot;
+        ;;
+        4)
+        uci set network.@switch_vlan[0].ports=&quot;0t 5&quot;
+        ;;
+        5)
+        uci set network.@switch_vlan[0].ports=&quot;0t&quot;
+        uci delete network.lan.ifname
+        ;;
+        esac
+        while [ $interfaces -gt 1 ];
+        do
+        uci add network switch_vlan
+        uci set network.@switch_vlan[-1].device=$name
+        uci set network.@switch_vlan[-1].vlan=$((interfaces+1))
+        uci set network.@switch_vlan[-1].ports=&quot;0t $interfaces&quot;
+        if [ -z $(uci get network.wan&quot;$((interfaces-1))&quot;) ]; then
+        uci set network.wan&quot;$((interfaces-1))&quot;=interface
+        uci set network.wan&quot;$((interfaces-1))&quot;.ifname=${name}.$((interfaces+1))
+        uci set network.wan&quot;$((interfaces-1))&quot;.proto=dhcp
+        uci set dhcp.wan&quot;$((interfaces-1))&quot;=dhcp
+        uci set dhcp.wan&quot;$((interfaces-1))&quot;.interface=wan&quot;$((interfaces-1))&quot;
+        uci set dhcp.wan&quot;$((interfaces-1))&quot;.ignore=1
+        fi
+        ifup wan&quot;$((interfaces-1))&quot;
+        interfaces=$((interfaces-1))
+        done
+        }
+    }
+}
+
+macvlan_get() {
+    config_get enabled $1 enabled
+    config_get macaddr $1 macaddr
+    config_get zdy $1 zdy
+    config_get ifname $1 ifname
+    config_get vlan $1 vlan
+    config_get xieyi $1 xieyi
+    config_get username $1 username
+    config_get password $1 password
+    config_get sl $1 sl &quot;1&quot;
+    network=$(uci show network |fgrep .ifname=&quot;$ifname&quot; |cut -d&quot;.&quot; -f2)
+    n=$(echo &quot;$network&quot; |sed &#039;s/wan//&#039;)
+    proto=$(uci get network.&quot;$network&quot;.proto)
+    user=$(uci get network.&quot;$network&quot;.username)
+    pass=$(uci get network.&quot;$network&quot;.password)
+    [ $enabled == 1 ] &amp;&amp; {
+    while [ &quot;$sl&quot; -le &quot;$vlan&quot; ] ;
+    do
+    ip link add link $ifname vth$((n*100 + sl)) type macvlan
+    uci set network.vth$((n*100 + sl))=interface
+    uci set network.vth$((n*100 + sl)).ifname=vth$((n*100 + sl))
+    uci set network.vth$((n*100 + sl)).defaultroute=0
+    if [ $zdy -eq 1 ]; then
+    uci set network.vth$((n*100 + sl)).proto=$xieyi
+    [ $xieyi == pppoe ] &amp;&amp; {
+    uci set network.vth$((n*100 + sl)).username=$username
+    uci set network.vth$((n*100 + sl)).password=$password
+    }
+    else
+    uci set network.vth$((n*100 + sl)).proto=$proto
+    [ $proto == pppoe ] &amp;&amp; {
+    uci set network.vth$((n*100 + sl)).username=$user
+    uci set network.vth$((n*100 + sl)).password=$pass
+    }
+    fi
+    uci set dhcp.vth$((n*100 + sl))=dhcp
+    uci set dhcp.vth$((n*100 + sl)).interface=vth$((n*100 + sl))
+    uci set dhcp.vth$((n*100 + sl)).ignore=1
+    ifconfig vth$((n*100 + sl)) up
+    ifup vth$((n*100 + sl))
+    sl=$((sl+1))
+    done
+    }
+}
+
+firewall() {
+    proto=$(uci show network|fgrep .proto|cut -d&quot;.&quot; -f2|grep [^lanloopback]|wc -l)
+    while [ $proto -ne 0 ] ;
+    do
+    firewall=`echo $firewall $(uci show network|fgrep .proto|cut -d&quot;.&quot; -f2|grep [^lanloopback]|sed -n ${proto}p)`
+    proto=$((proto-1))
+    done
+    uci set firewall.@zone[1].network=&quot;$firewall&quot;
+    uci commit network
+    uci commit firewall
+    uci commit dhcp
+}
+
diff -Nuar a/applications/luci-macvlan/root/etc/uci-defaults/luci-app-macvlan c/applications/luci-macvlan/root/etc/uci-defaults/luci-app-macvlan
--- a/applications/luci-macvlan/root/etc/uci-defaults/luci-app-macvlan    1970-01-01 08:00:00.000000000 +0800
+++ c/applications/luci-macvlan/root/etc/uci-defaults/luci-app-macvlan    2012-12-19 10:45:38.242321654 +0800
@@ -0,0 +1,14 @@
+#!/bin/sh
+
+uci -q batch &lt;&lt;-EOF &gt;/dev/null
+          delete ucitrack.@macvlan[-1]
+          add ucitrack macvlan
+          set ucitrack.@macvlan[-1].init=macvlan
+          commit ucitrack
+EOF
+
+chmod 755 /etc/init.d/macvlan
+/etc/init.d/macvlan enable
+
+rm -f /tmp/luci-indexcache
+exit 0</code></pre></div>											<p class="post-edited">(Last edited by <strong>ranfish</strong> on 2 Jun 2013, 07:08)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p203551">
				<div class="post-metadata">
					<div class="post-num">Post #312</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						3 Jun 2013, 03:56					</div>
				</div>
				<div class="post-content content">
					<p>Well I ended up being a little bored and updated the custom hotplug script which will be in the LuCI app 1.0-16</p><p>It creates a variable $REPORTDATA which you can put in your own line to call your e-mail app, etc, etc.</p><p>Here are the contents of my $REPORTDATA variable after running &#039;ACTION=ifup DEVICE=eth0.1 INTERFACE=wan /sbin/hotplug-call iface&#039;</p><div class="codebox"><pre><code>Interface [ wan (eth0.1) ] on router [ OpenWRT-F70 ] has triggered an [ ifup ] hotplug event on Mon Jun  3 14:42:27 PDT 2013

---------------
CURRENT STATUS:
---------------

wan - ONLINE (monitored)

-----------------
MEMBERS AFFECTED:
-----------------

wan_m1_w3
wan_m2_w3

------------------
POLICIES AFFECTED:
------------------

wan_only:
wan_m1_w3

wan_both:
wan_m1_w3
wan_m2_w3

---------------
RULES AFFECTED:
---------------

internet:
source address - 
source port - 
destination address - 
destination port - 
protocol - all
policy assigned - wan_only
equalize - No

------------------------------------------------------------------
Last 50 MWAN3 systemlog entries. Newest entries sorted at the top:
------------------------------------------------------------------

Jun  3 14:42:26 OpenWRT-F70 user.notice mwan3: ifup interface wan (eth0.1)
Jun  3 14:41:28 OpenWRT-F70 user.notice mwan3: ifup interface wan (eth0.1)</code></pre></div>											<p class="post-edited">(Last edited by <strong>arfett</strong> on 4 Jun 2013, 00:42)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p203583">
				<div class="post-metadata">
					<div class="post-num">Post #313</div>
					<div class="post-author">headless.cross</div>
					<div class="post-datetime">
						3 Jun 2013, 12:35					</div>
				</div>
				<div class="post-content content">
					<p>arfett, nice job! I can&#039;t give feedback for the new additions in LuCI app, but I can comment Adze&#039;s latest changes:</p><p>I think that the load balancing is working much better, now almost every second refresh on cmyip.com, shows a different IP address, plus, I &quot;feel&quot; like that the overall load is lower.</p><p>As I mentioned in a previous post, I have solved my issues and now everything is working fine, speeds are blazing fast, routing policies ok, etc.</p><p>Once, Adze and arfett, a big &quot;Thank You!&quot; for this gem of code.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p203626">
				<div class="post-metadata">
					<div class="post-num">Post #314</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						3 Jun 2013, 23:21					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>ranfish wrote:</cite><blockquote><p>I found an app for creating virtual wans of a physical wan which can be used to dial the same pppoe acount for several times.But it doesn&#039;t have route assignment and weak in load banlancing.So I want to use mwan3 to do the route assignment and load banlancing instead.Is it possible to pack them together?</p></blockquote></div><p>I have been playing with macvlan and found out that macvlan works with mwan3. You should be able to create multiple virtual wans on one physical wan and use them with mwan3. Here is how i did it:</p><p>Create the /etc/init.d/macvlan file (kmod-macvlan must be installed):<br /></p><div class="codebox"><pre><code>#!/bin/sh /etc/rc.common
START=17

start() {
    ip link add link eth0 eth2 type macvlan
    ifconfig eth2 hw ether C6:3D:C7:02:02:02
 
    ip link add link eth0 eth3 type macvlan
    ifconfig eth3 hw ether C6:3D:C7:03:03:03    
}

stop() {
    ip link del link eth0 eth2
    ip link del link eth0 eth3
}

restart() {
    stop
    start
}</code></pre></div><p>Replace &quot;eth0&quot; with your physical wan device. Replace &quot;eth2&quot; and &quot;eth3&quot; with names of your liking (they must not already be in use). Make this script at boot (run: &quot;/etc/init.d/macvlan enable&quot;).</p><p>Now you can define the devices &quot;eth2&quot; and &quot;eth3&quot; in your network config file and subsequent the interfaces in mwan3.</p>											<p class="post-edited">(Last edited by <strong>Adze</strong> on 3 Jun 2013, 23:34)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p203632">
				<div class="post-metadata">
					<div class="post-num">Post #315</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						4 Jun 2013, 00:10					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>headless.cross wrote:</cite><blockquote><p>I can&#039;t give feedback for the new additions in LuCI app .. Once, Adze and arfett, a big &quot;Thank You!&quot; for this gem of code.</p></blockquote></div><p>Thanks but I certainly welcome criticism from you or anyone on the LuCI app. I feel like I have a pretty good idea of what makes a good interface but if it can be better I want to make it better.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p203636">
				<div class="post-metadata">
					<div class="post-num">Post #316</div>
					<div class="post-author">headless.cross</div>
					<div class="post-datetime">
						4 Jun 2013, 01:22					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>arfett wrote:</cite><blockquote><p>Thanks but I certainly welcome criticism from you or anyone on the LuCI app. I feel like I have a pretty good idea of what makes a good interface but if it can be better I want to make it better.</p></blockquote></div><p>I mean that I can&#039;t give feedback about the hotplug section (I don&#039;t think I will use it in the near future). Overall, the whole luci-app package is very good and working well. One thing that would be perfect, it&#039;s the rename function of an interface/member/rule during edit. As a software developer, I completely feel that you want to make it perfect (I think it&#039;s time to start playing with Lua and openwrt development).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p203637">
				<div class="post-metadata">
					<div class="post-num">Post #317</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						4 Jun 2013, 01:26					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>headless.cross wrote:</cite><blockquote><p>I mean that I can&#039;t give feedback about the hotplug section (I don&#039;t think I will use it in the near future). Overall, the whole luci-app package is very good and working well. One thing that would be perfect, it&#039;s the rename function of an interface/member/rule during edit. As a software developer, I completely feel that you want to make it perfect (I think it&#039;s time to start playing with Lua and openwrt development).</p></blockquote></div><p>I&#039;ve wanted a rename feature but it&#039;s not really feasible unless the names are moved into the config sections. That would be a can of worms in and of itself so I have no hopes of ever implementing that.</p><p>eg</p><p>config interface<br />&nbsp; &nbsp; option name &#039;wan&#039;</p>											<p class="post-edited">(Last edited by <strong>arfett</strong> on 4 Jun 2013, 01:27)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p203638">
				<div class="post-metadata">
					<div class="post-num">Post #318</div>
					<div class="post-author">headless.cross</div>
					<div class="post-datetime">
						4 Jun 2013, 01:28					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>arfett wrote:</cite><blockquote><p>I&#039;ve wanted a rename feature but it&#039;s not really feasible unless the names are moved into the config sections.</p><p>eg</p><p>config interface<br />&nbsp; &nbsp; option name &#039;wan&#039;</p></blockquote></div><p>That&#039;s a noticeable change in the config structure and the parsing function, imho.</p>											<p class="post-edited">(Last edited by <strong>headless.cross</strong> on 4 Jun 2013, 01:29)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p203664">
				<div class="post-metadata">
					<div class="post-num">Post #319</div>
					<div class="post-author">ranfish</div>
					<div class="post-datetime">
						4 Jun 2013, 11:40					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>arfett wrote:</cite><blockquote><p>Thanks but I certainly welcome criticism from you or anyone on the LuCI app. I feel like I have a pretty good idea of what makes a good interface but if it can be better I want to make it better.</p></blockquote></div><p>Hello,arfett.<br />Here is another multiwan load balancing scripts and luci interface of it found in dev.openwrt.org.cn. I think it is a little bit easier to use.Maybe you can see to it as a reference to make your luci app more friendly to new user.</p><p><a href="https://www.box.com/s/ddpazfpu37k1oc6uv9yv">https://www.box.com/s/ddpazfpu37k1oc6uv9yv</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p203665">
				<div class="post-metadata">
					<div class="post-num">Post #320</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						4 Jun 2013, 11:57					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>ranfish wrote:</cite><blockquote><p>Hello,arfett.<br />Here is another multiwan load balancing scripts and luci interface of it found in dev.openwrt.org.cn. I think it is a little bit easier to use.Maybe you can see to it as a reference to make your luci app more friendly to new user.</p><p><a href="https://www.box.com/s/ddpazfpu37k1oc6uv9yv">https://www.box.com/s/ddpazfpu37k1oc6uv9yv</a></p></blockquote></div><p>Easier in what way? Are you referring to the configuration of nwan being simpler than mwan3?</p><p>There&#039;s not much I can do about that as I&#039;m working with MWAN3 and not nwan. If there&#039;s anything relevant to MWAN3 I&#039;m all ears.</p><p>After looking at their Lua file it looks like a very simple page for configuring basically one thing. When I boot back over to linux I&#039;ll upload them and see what it looks like in case I missed something.</p>											<p class="post-edited">(Last edited by <strong>arfett</strong> on 4 Jun 2013, 11:57)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p203666">
				<div class="post-metadata">
					<div class="post-num">Post #321</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						4 Jun 2013, 12:04					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>ranfish wrote:</cite><blockquote><p>Here is another multiwan load balancing scripts and luci interface of it found in dev.openwrt.org.cn. I think it is a little bit easier to use.</p></blockquote></div><p>I have no experience with nwan (yet). But easier to use will probably mean less options to choose from...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p203695">
				<div class="post-metadata">
					<div class="post-num">Post #322</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						4 Jun 2013, 17:57					</div>
				</div>
				<div class="post-content content">
					<p>I did some more testing with macvlan and i am happy to announce that with macvlan:</p><p>- mwan3 supports multiple virtual interfaces on one physical interface<br />- mwan3 supports multiple gateways with same ip address<br />- mwan3 supports multiple gateways on same device<br />- mwan3 supports routing of inbound traffic on all the active wans at the same time</p><p>Openwrt/netifd does not have support for macvlan interfaces yet, so you have to play with config a bit to get it working. Lets hope native macvlan support is added to Openwrt.</p><p>More info:<br /></p><div class="codebox"><pre><code>root@mercurius:~# cat /etc/init.d/macvlan 
#!/bin/sh /etc/rc.common
START=17

start() {
    ip link add link eth0 name eth0.1 type vlan id 1
    ip link add link eth0.1 eth2 type macvlan
    ifconfig eth2 hw ether C6:3D:C7:02:02:02
 
    ip link add link eth0 name eth0.2 type vlan id 2
    ip link add link eth0.2 eth3 type macvlan
    ifconfig eth3 hw ether C6:3D:C7:03:03:03    
}

stop() {
    ip link del link dev eth2

    ip link del link dev eth3
}

restart() {
    stop
    start
}


root@mercurius:~# cat /etc/config/network 
config interface &#039;loopback&#039;
    option ifname &#039;lo&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;127.0.0.1&#039;
    option netmask &#039;255.0.0.0&#039;

config alias
    option interface &#039;loopback&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;192.168.1.1&#039;
    option netmask &#039;255.255.255.255&#039;

config interface &#039;lan&#039;
    option ifname &#039;eth1&#039;
    option type &#039;bridge&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;192.168.33.2&#039;
    option netmask &#039;255.255.255.0&#039;

config interface &#039;wan1&#039;
    option ifname &#039;eth0.1&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;95.97.227.171&#039;
    option netmask &#039;255.255.255.248&#039;
    option gateway &#039;95.97.227.169&#039;
    option dns &#039;192.168.1.1 192.168.2.1&#039;
    option metric &#039;10&#039;
    option accept_ra &#039;1&#039;

config interface &#039;wan2&#039;
    option ifname &#039;eth0.2&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;213.154.232.11&#039;
    option netmask &#039;255.255.255.248&#039;
    option gateway &#039;213.154.232.9&#039;
    option dns &#039;192.168.1.1 192.168.2.1&#039;
    option metric &#039;20&#039;
    option accept_ra &#039;1&#039;

config interface &#039;wan3&#039;
        option ifname &#039;eth2&#039;
        option proto &#039;static&#039;
        option ipaddr &#039;95.97.227.173&#039;
        option netmask &#039;255.255.255.248&#039;
        option gateway &#039;95.97.227.169&#039;
        option dns &#039;192.168.1.1 192.168.2.1&#039;
        option metric &#039;30&#039;
        option accept_ra &#039;1&#039;

config interface &#039;wan4&#039;
        option ifname &#039;eth3&#039;
        option proto &#039;static&#039;
        option ipaddr &#039;213.154.232.13&#039;
        option netmask &#039;255.255.255.248&#039;
        option gateway &#039;213.154.232.9&#039;
        option dns &#039;192.168.1.1 192.168.2.1&#039;
        option metric &#039;40&#039;
        option accept_ra &#039;1&#039;

config switch
    option name &#039;rtl8366s&#039;
    option reset &#039;1&#039;
    option enable_vlan &#039;1&#039;
    option blinkrate &#039;2&#039;

config switch_vlan
    option device &#039;rtl8366s&#039;
    option vlan &#039;1&#039;
    option ports &#039;3 5t&#039;

config switch_vlan
    option device &#039;rtl8366s&#039;
    option vlan &#039;2&#039;
    option ports &#039;2 5t&#039;

config switch_vlan
    option device &#039;rtl8366s&#039;
    option vlan &#039;3&#039;
    option ports &#039;1 5t&#039;

config switch_vlan
    option device &#039;rtl8366s&#039;
    option vlan &#039;4&#039;
    option ports &#039;0 5t&#039;


root@mercurius:~# cat /etc/config/firewall 
config rule
    option name &#039;Allow-Ping&#039;
    option src &#039;wan&#039;
    option proto &#039;icmp&#039;
    option icmp_type &#039;echo-request&#039;
    option family &#039;ipv4&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-DHCP-Renew&#039;
    option src &#039;wan&#039;
    option proto &#039;udp&#039;
    option dest_port &#039;68&#039;
    option target &#039;ACCEPT&#039;
    option family &#039;ipv4&#039;

config rule
    option name &#039;Allow-ICMPv6-Input&#039;
    option src &#039;wan&#039;
    option proto &#039;icmp&#039;
    list icmp_type &#039;echo-request&#039;
    list icmp_type &#039;echo-reply&#039;
    list icmp_type &#039;destination-unreachable&#039;
    list icmp_type &#039;packet-too-big&#039;
    list icmp_type &#039;time-exceeded&#039;
    list icmp_type &#039;bad-header&#039;
    list icmp_type &#039;unknown-header-type&#039;
    list icmp_type &#039;router-solicitation&#039;
    list icmp_type &#039;neighbour-solicitation&#039;
    list icmp_type &#039;router-advertisement&#039;
    list icmp_type &#039;neighbour-advertisement&#039;
    option limit &#039;1000/sec&#039;
    option family &#039;ipv6&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-DHCPv6&#039;
    option src &#039;wan&#039;
    option proto &#039;udp&#039;
    option src_ip &#039;fe80::/10&#039;
    option src_port &#039;547&#039;
    option dest_ip &#039;fe80::/10&#039;
    option dest_port &#039;546&#039;
    option family &#039;ipv6&#039;
    option target &#039;ACCEPT&#039;

config rule
    option name &#039;Allow-ICMPv6-Forward&#039;
    option src &#039;wan&#039;
    option dest &#039;*&#039;
    option proto &#039;icmp&#039;
    list icmp_type &#039;echo-request&#039;
    list icmp_type &#039;echo-reply&#039;
    list icmp_type &#039;destination-unreachable&#039;
    list icmp_type &#039;packet-too-big&#039;
    list icmp_type &#039;time-exceeded&#039;
    list icmp_type &#039;bad-header&#039;
    list icmp_type &#039;unknown-header-type&#039;
    option limit &#039;1000/sec&#039;
    option family &#039;ipv6&#039;
    option target &#039;ACCEPT&#039;

config defaults
    option syn_flood &#039;1&#039;
    option input &#039;DROP&#039;
    option output &#039;ACCEPT&#039;
    option forward &#039;REJECT&#039;
    option drop_invalid &#039;1&#039;

config zone
    option name &#039;lan&#039;
    option network &#039;lan&#039;
    option input &#039;ACCEPT&#039;
    option output &#039;ACCEPT&#039;
    option forward &#039;REJECT&#039;

config zone
    option name &#039;wan&#039;
    option network &#039;wan1 wan2 wan3 wan4&#039;
    option input &#039;REJECT&#039;
    option output &#039;ACCEPT&#039;
    option forward &#039;REJECT&#039;
    option masq &#039;1&#039;
    option mtu_fix &#039;1&#039;

config forwarding
    option src &#039;lan&#039;
    option dest &#039;wan&#039;

config include
    option path &#039;/etc/firewall.user&#039;


root@mercurius:~# cat /etc/config/mwan3 
config interface &#039;wan1&#039;
    list track_ip &#039;8.8.4.4&#039;
    list track_ip &#039;208.67.220.220&#039;
    list track_ip &#039;8.8.8.8&#039;
    list track_ip &#039;208.67.222.222&#039;
    option enabled &#039;1&#039;
    option reliability &#039;3&#039;
    option count &#039;1&#039;
    option timeout &#039;2&#039;
    option interval &#039;5&#039;
    option up &#039;8&#039;
    option down &#039;4&#039;

config interface &#039;wan2&#039;
    list track_ip &#039;8.8.4.4&#039;
    list track_ip &#039;208.67.220.220&#039;
    list track_ip &#039;8.8.8.8&#039;
    list track_ip &#039;208.67.222.222&#039;
    option enabled &#039;1&#039;
    option reliability &#039;3&#039;
    option count &#039;1&#039;
    option timeout &#039;2&#039;
    option interval &#039;5&#039;
    option up &#039;8&#039;
    option down &#039;4&#039;

config interface &#039;wan3&#039;
    list track_ip &#039;8.8.4.4&#039;
    list track_ip &#039;208.67.220.220&#039;
    list track_ip &#039;8.8.8.8&#039;
    list track_ip &#039;208.67.222.222&#039;
    option enabled &#039;1&#039;
    option reliability &#039;3&#039;
    option count &#039;1&#039;
    option timeout &#039;2&#039;
    option interval &#039;5&#039;
    option up &#039;8&#039;
    option down &#039;4&#039;

config interface &#039;wan4&#039;
    list track_ip &#039;8.8.4.4&#039;
    list track_ip &#039;208.67.220.220&#039;
    list track_ip &#039;8.8.8.8&#039;
    list track_ip &#039;208.67.222.222&#039;
    option enabled &#039;1&#039;
    option reliability &#039;3&#039;
    option count &#039;1&#039;
    option timeout &#039;2&#039;
    option interval &#039;5&#039;
    option up &#039;8&#039;
    option down &#039;4&#039;

config member &#039;wan1_m1_w3&#039;
    option interface &#039;wan1&#039;
    option metric &#039;1&#039;
    option weight &#039;3&#039;

config member &#039;wan1_m2_w3&#039;
    option interface &#039;wan1&#039;
    option metric &#039;2&#039;
    option weight &#039;3&#039;

config member &#039;wan2_m1_w2&#039;
    option interface &#039;wan2&#039;
    option metric &#039;1&#039;
    option weight &#039;2&#039;

config member &#039;wan2_m2_w2&#039;
    option interface &#039;wan2&#039;
    option metric &#039;2&#039;
    option weight &#039;2&#039;

config member &#039;wan3_m1_w3&#039;
    option interface &#039;wan3&#039;
    option metric &#039;1&#039;
    option weight &#039;3&#039;

config member &#039;wan4_m1_w2&#039;
    option interface &#039;wan4&#039;
    option metric &#039;1&#039;
    option weight &#039;2&#039;

config policy &#039;wan1_only&#039;
    list use_member &#039;wan1_m1_w3&#039;

config policy &#039;wan2_only&#039;
    list use_member &#039;wan2_m1_w2&#039;

config policy &#039;wan1_wan2_wan3_wan4_loadbalanced&#039;
    list use_member &#039;wan1_m1_w3&#039;
    list use_member &#039;wan2_m1_w2&#039;
    list use_member &#039;wan3_m1_w3&#039;
    list use_member &#039;wan4_m1_w2&#039;

config policy &#039;wan1_pri_wan2_sec&#039;
    list use_member &#039;wan1_m1_w3&#039;
    list use_member &#039;wan2_m2_w2&#039;

config policy &#039;wan2_pri_wan1_sec&#039;
    list use_member &#039;wan1_m2_w3&#039;
    list use_member &#039;wan2_m1_w2&#039;

config rule
    option dest_ip &#039;192.168.0.0/16&#039;
    option proto &#039;all&#039;
    option use_policy &#039;default&#039;

config rule
    option dest_ip &#039;207.223.2.93&#039;
    option use_policy &#039;wan1_pri_wan2_sec&#039;

config rule
    option dest_ip &#039;0.0.0.0/0&#039;
    option proto &#039;tcp&#039;
    option dest_port &#039;80,443&#039;
    option use_policy &#039;wan1_wan2_wan3_wan4_loadbalanced&#039;

config rule
    option dest_ip &#039;0.0.0.0/0&#039;
    option equalize &#039;1&#039;
    option use_policy &#039;wan1_wan2_wan3_wan4_loadbalanced&#039;</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p203701">
				<div class="post-metadata">
					<div class="post-num">Post #323</div>
					<div class="post-author">ranfish</div>
					<div class="post-datetime">
						4 Jun 2013, 18:16					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><p>I did some more testing with macvlan and i am happy to announce that with macvlan:</p><p>- mwan3 supports multiple virtual interfaces on one physical interface<br />- mwan3 supports multiple gateways with same ip address<br />- mwan3 supports multiple gateways on same device<br />- mwan3 supports routing of inbound traffic on all the active wans at the same time</p></blockquote></div><p>I am very happy to see your improvement.Just too much options for me as a non-guru.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p203738">
				<div class="post-metadata">
					<div class="post-num">Post #324</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						5 Jun 2013, 00:35					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>ranfish wrote:</cite><blockquote><p>I am very happy to see your improvement.Just too much options for me as a non-guru.</p></blockquote></div><p>What are you trying to do? You shouldn&#039;t need to be a guru to follow the instructions in the first post.</p><p>The only instructions lacking in the first post is routing router traffic as it doesn&#039;t go over the alias info which is talked about later.</p><p>We&#039;ll help you figure it out.</p>											<p class="post-edited">(Last edited by <strong>arfett</strong> on 5 Jun 2013, 02:30)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p203966">
				<div class="post-metadata">
					<div class="post-num">Post #325</div>
					<div class="post-author">spgg</div>
					<div class="post-datetime">
						7 Jun 2013, 11:52					</div>
				</div>
				<div class="post-content content">
					<p>Awsome package. Many, many thx! Just what I have been looking for. And I am looking forward to having it in the official repos ASAP.</p><p>I have a little question: I am using a TP-Link WDR3600 router. What do you feel is the more stable solution for using mwan3. Attitude Adjustment 12.09 or Barrier Breaker Trunk? Are current versions of mwan3 tested on Attitude Adjustment or just on recent Trunk version?</p>									</div>
			</article>

			
		
						<div class="notice">
				<p>Sorry, posts 326 to 325 are missing from our archive.</p>
			</div>
		
		
	
	<div class="pagination"><div class="pagination-number">Page 13 of 65</div><nav><ul><li><a href="viewtopic.php%3Fid=39052&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=11.html">11</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=12.html">12</a></li><li class="pagination-current"><span>13</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=14.html">14</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=15.html">15</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=65.html">65</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>