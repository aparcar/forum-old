<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> TrendNet 16 port PoE Gigabit switch</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 30 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p225626">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">essele</div>
					<div class="post-datetime">
						18 Feb 2014, 06:29					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>I anyone looking at these kind of devices? They seem like a perfect OpenWRT target? At a pretty reasonable price given the port count.</p><p>For example, the TrendNET TPE-1620WS is a 16 port gigabit PoE switch, from looking at their firmware I can see that it uses a Marvell MV98DX4122 SoC, which looks to be dual-core 800MHz.&nbsp; (<a href="http://www.marvell.com/switching/assets/Marvell_Prestera_98DX21xx-41xx-001_product_brief.pdf">http://www.marvell.com/switching/assets … _brief.pdf</a>)</p><p>The GPL code is available, and also appears to include crypto acceleration.</p><p>Lee.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p225628">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">mazilo</div>
					<div class="post-datetime">
						18 Feb 2014, 07:37					</div>
				</div>
				<div class="post-content content">
					<p>The price is certainly beyond my budget. <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><p>Do you know how much RAM does it have?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p225629">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">johnisaacson</div>
					<div class="post-datetime">
						18 Feb 2014, 09:05					</div>
				</div>
				<div class="post-content content">
					<p>Hi mazillo/essele, according to the specs it has 8MB flash. Nothing I could find on ram.</p><p><a href="http://www.cdw.com/shop/products/TRENDnet-TPE-1620WS-16-Port-Gigabit-Web-Smart-PoE-Switch-switch-16-por/3100643.aspx#TS">http://www.cdw.com/shop/products/TRENDn … 43.aspx#TS</a></p><p>Flash Memory&nbsp; <br />Installed Size:&nbsp; &nbsp;8 MB&nbsp; </p><p>Not cheap. $419.99</p><p>~john</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p225639">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">essele</div>
					<div class="post-datetime">
						18 Feb 2014, 10:19					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>The 10 port (8 + 2sfp) version [TPE-1020WS] looks to use the same SoC and is quite a bit cheaper.</p><p>I don&#039;t think they are that expensive given the port count and potential, certainly if you compare it to other dual-core routers out there. I can see it replacing a switch and smaller router combination and doing everything in one box. If it really is dual-800MHz and has crypto then I think it&#039;s worth experimenting with.</p><p>The 8MB flash sounds a bit limiting, however I&#039;m not convinced ... I&#039;ve hacked the squashfs out of their firmware and it&#039;s over 8.5MB so my guess is that it&#039;s probably 16MB.</p><p>Anyway, I think I&#039;ve convinced myself to buy one (probably the smaller one for now) and try to get a serial port setup.</p><p>Cheers,</p><p>Lee.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p226246">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">essele</div>
					<div class="post-datetime">
						25 Feb 2014, 16:41					</div>
				</div>
				<div class="post-content content">
					<p>Ok ... I&#039;ve got the 10 port version, there is a nice serial port inside ready to attach to.</p><p>It has 16MB of flash, and 128MB of memory.</p><p>The CPU appears to be running at 500MHz (at least from uboot), there appears to be only one core.</p><p>The SoC is MV88F6281, which does include a crypto accelerator.<br /><a href="http://www.marvell.com/embedded-processors/kirkwood/assets/HW_88F6281_OpenSource.pdf">http://www.marvell.com/embedded-process … Source.pdf</a></p><p>I will see if I can get a kernel on from their GPL release and see how I go.</p><p>BTW, the standard firmware is awful ... I can&#039;t get it to work properly with any browser. I suspect it will need IE ... and I refuse on principle.</p><div class="codebox"><pre><code>         __  __                      _ _
        |  \/  | __ _ _ ____   _____| | |
        | |\/| |/ _` | &#039;__\ \ / / _ \ | |
        | |  | | (_| | |   \ V /  __/ | |
        |_|  |_|\__,_|_|    \_/ \___|_|_|
 _   _     ____              _
| | | |   | __ )  ___   ___ | |_ 
| | | |___|  _ \ / _ \ / _ \| __| 
| |_| |___| |_) | (_) | (_) | |_ 
 \___/    |____/ \___/ \___/ \__|  ** LOADER **
 ** MARVELL BOARD: DB-98DX4122-48G (Rev 2) LE (configured)
 ** Linux        - LE/BE support
 ** vxWorks(elf) - LE/BE support


U-Boot 1.1.4 (Jun  5 2013 - 10:37:15) Marvell version: 5.3.4_0006

U-Boot code: 01200000 -&gt; 0126C700  BSS: -&gt; 0127E398
IRQ Stack: 009fff7c
FIQ Stack: 009fef7c

Soc: MV88F6281 Rev 3 (DDR2)
CPU running @ 500Mhz L2 running @ 250Mhz
SysClock = 250Mhz , TClock = 167Mhz 

DRAM CAS Latency = 5 tRP = 4 tRAS = 12 tRCD=4
DRAM CS[0] base 0x00000000   size 128MB 
DRAM Total size 128MB  16bit width
[16384kB@f8000000] Flash: 16 MB
Addresses 30M - 0M are saved for the U-Boot usage.
Mem malloc Initialization (30M - 22M): Done

CPU : Marvell Feroceon (Rev 1)

Streaming disabled 
Write allocate disabled


USB 0: host mode
Net:   egiga0 [PRIME], ppsdma
Un-Protect Flash Bank # 1
................................................................................................................................................................................................................................................................ done
Hit any key to stop autoboot:  0 
Verifying Checksum ... 
BOOT:...OK
OS:...OK
FS:...OK
OS/FS Version:...OK
## Booting image at f8100000 ...
   Image Name:   Linux-2.6.22.18-g2c614662-dirty
   Image Type:   ARM Linux Kernel Image (uncompressed)
   Data Size:    1272972 Bytes =  1.2 MB
   Load Address: 00008000
   Entry Point:  00008000
   Verifying Checksum ... OK
OK

Checking for Linux kernel endianess at 0xf8100040 = 0xe1a00000
Linux Kernel is LE

Starting kernel in LE mode ...
..Linux version 2.6.22.18-g2c614662-dirty (sw2@guixue) (gcc version 4.2.1) #20 Wed Jun 5 10:41:18 CST 2013
CPU: ARM926EJ-S [56251311] revision 1 (ARMv5TE), cr=00053977
Machine: Feroceon-KW
Using UBoot passing parameters structure
BoardID from uboot=10
Memory policy: ECC disabled, Data cache writeback
calling iotable_init. MEM_TABLE=
  virt=0xe7c00000, phys=0x07c00000, lengh=0x00400000
  virt=0xe8000000, phys=0xe8000000, lengh=0x08000000
  virt=0xf1000000, phys=0xf1000000, lengh=0x00100000
  virt=0xf8000000, phys=0xf8000000, lengh=0x01000000
  virt=0xf4000000, phys=0xf4000000, lengh=0x04000000
  virt=0xfb000000, phys=0xfb000000, lengh=0x00010000
  virt=0xf2000000, phys=0xf2000000, lengh=0x00010000
Internal prestera id register = 0x000e4203
xCat revision = A1
CPU0: D VIVT write-back cache
CPU0: I cache: 16384 bytes, associativity 4, 32 byte lines, 128 sets
CPU0: D cache: 16384 bytes, associativity 4, 32 byte lines, 128 sets
Built 1 zonelists.  Total pages: 31496
Kernel command line: root=/dev/mtdblock3 rw rootfstype=squashfs user_debug=31 ip=192.168.10.200:192.168.0.201:0.0.0.0:255.255.255.0::eth0:off console=ttyS0,115200 mtdparts=spi_flash:0x00080000(uboot),0x00080000(env),0x00200000(kernel),0x00b00000(rootfs),0x00200000(jffs2) ethaddr=00:14:d1:2a:01:81 issstart=1 csb=0x0320F5B7 cso=0x0A382A28 csf=0x4891FBBE
PID hash table entries: 512 (order: 9, 2048 bytes)
Console: colour dummy device 80x30
Dentry cache hash table entries: 16384 (order: 4, 65536 bytes)
Inode-cache hash table entries: 8192 (order: 3, 32768 bytes)
Memory: 124MB 0MB 0MB 0MB = 124MB total
Memory: 123008KB available (2396K code, 260K data, 80K init)
Mount-cache hash table entries: 512
CPU: Testing write buffer coherency: ok
NET: Registered protocol family 16

CPU Interface
-------------
SDRAM_CS0 ....base 00000000, size 128MB 
SDRAM_CS1 ....disable
SDRAM_CS2 ....disable
SDRAM_CS3 ....disable
PEX0_MEM ....base e8000000, size 128MB 
PEX0_IO ....base fc000000, size   1MB 
INTER_REGS ....base f1000000, size   1MB 
NFLASH_CS ....base d8000000, size 128MB 
SPI_CS ....base f8000000, size  16MB 
BOOT_ROM_CS ....no such
DEV_BOOTCS ....no such
CRYPT_ENG ....base fb000000, size  64KB 
SAGE_UNIT ....base f4000000, size  64MB 
DRAGONITE_DTCM ....no such

  Marvell Development Board (LSP Version KW_LSP_5.3.4_00030)-- DB-98DX4122-48G  Soc: MV88F6281 Rev 3 LE

 Detected Tclk 167000000 and SysClk 0 
Switch decoding windows init is done.
MV Buttons Device Load
PEX not supported
Time: kw_clocksource clocksource has been installed.
NET: Registered protocol family 2
IP route cache hash table entries: 1024 (order: 0, 4096 bytes)
TCP established hash table entries: 4096 (order: 3, 32768 bytes)
TCP bind hash table entries: 4096 (order: 2, 16384 bytes)
TCP: Hash tables configured (established 4096 bind 4096)
TCP reno registered
Use the XOR engines (acceleration) for enhancing the following functions:
  o RAID 5 Xor calculation
  o kernel memcpy
  o kenrel memzero
Number of XOR engines to use: 2
MV Buttons Driver Load
squashfs: version 3.3 (2007/10/31) Phillip Lougher
squashfs: LZMA suppport for slax.org by jro
JFFS2 version 2.2. (NAND) Â© 2001-2006 Red Hat, Inc.
io scheduler noop registered
io scheduler anticipatory registered (default)
Serial: 8250/16550 driver $Revision: 1.1.1.1 $ 4 ports, IRQ sharing disabled
serial8250.0: ttyS0 at MMIO 0xf1012000 (irq = 33) is a 16550A
serial8250.0: ttyS1 at MMIO 0xf1012100 (irq = 34) is a 16550A
Marvell Gbe Ethernet Driver not supported
NFTL driver: nftlcore.c $Revision: 1.1.1.1 $, nftlmount.c $Revision: 1.1.1.1 $
SPI Serial flash detected @ 0xf8000000, 16384KB (256sec x 64KB)
5 cmdlinepart partitions found on MTD device spi_flash
Creating 5 MTD partitions on &quot;spi_flash&quot;:
0x00000000-0x00080000 : &quot;uboot&quot;
0x00080000-0x00100000 : &quot;env&quot;
0x00100000-0x00300000 : &quot;kernel&quot;
0x00300000-0x00e00000 : &quot;rootfs&quot;
0x00e00000-0x01000000 : &quot;jffs2&quot;
mice: PS/2 mouse device common for all mice
i2c /dev entries driver
TCP cubic registered
NET: Registered protocol family 1
NET: Registered protocol family 17
IP-Config: Device `eth0&#039; not found.
VFS: Mounted root (squashfs filesystem) readonly.
Freeing init memory: 80K
Using /lib/modules/mvKernelExt.ko
Using /lib/modules/mvPpDrv.ko

presteraSmi_init: Init OK!
DMA - dma_area: 0xe7c00000 ,dma_base: 0x7c00000, dma_len: 0x400000
Thu Jan 20 19:54:00 UTC 2011




Linux MARVELL_LINUX 2.6.22.18-g2c614662-dirty #20 Wed Jun 5 10:41:18 CST 2013
/mnt/flash/sslservcert is existed

Starting System Root TaskDevice[0] ID 0xE42011AB revision 3
. [OK]

MAC Address : 00-14-D1-2A-01-81
H/W Version : 1.0R
F/W Version : 1.00.10

         CAMEO L2 Management Switch 

TPE-1020WS login:</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p226302">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">merlin90210</div>
					<div class="post-datetime">
						26 Feb 2014, 08:21					</div>
				</div>
				<div class="post-content content">
					<p>May I ask what you pay for the 10 port switch and where you bought it?</p><p>Newegg has this switch for just under USD 250 on their website. Trend likes to charge you just under USD 330 if you order with them.</p><p>Is it possible to post home-made pictures or post links from FCC?</p><p>This is a nice target to make it to a SOHO box. Like server and router and switch all together.<br />It must have USB (boot messages), but no specs about a port on the outside on Trend&#039;s product pages.<br />Without a USB port the SOHO market will be limited for server use.</p><p>On the stock s/w are the VLANS configurable per port? As in tagged-VLAN on the trunk/uplink to one dedicated port (untagged) on the switch?<br />If yes, that would be great, because most WiFi routers have a bridge and can&#039;t be configured per physical port.</p><p>I&#039;m afraid the devs need the device to do their work, and most likely it wil not return.</p><p>Thanks for the find OP.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p226392">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">essele</div>
					<div class="post-datetime">
						27 Feb 2014, 06:31					</div>
				</div>
				<div class="post-content content">
					<p>Hi merlin,</p><p>I bought it from the UK for GBP173 including tax. (netstoredirect.com)</p><p>I will post some pictures when I get a chance (probably at the weekend.)</p><p>It doesn&#039;t have any external ports other than power, a reset button, and the network ports. The console messages come from an internal serial port, it&#039;s easy to find and has a header already soldered, so it&#039;s easy to use if you have a usb-&gt;ttl (actually it&#039;s 3.3v) serial cable.</p><p>The SoC certainly has usb capability, but it&#039;s not clear if any of the pins are accessible.</p><p>For me USB is not important ... I&#039;m looking for a single device that can handle my switching needs and also run OpenWRT as my pppoe/IPsec/tinc router. I am hoping that the crypto acceleration means that the 500Mhz CPU (although it may be faster than that) will be enough. I currently use a 680MHz device with no acceleration and it struggles.</p><p>On the stock s/w you can indeed configure VLAN&#039;s per port, it&#039;s basically a managed switch and seems to have all the capabilities you would expect. The stock firmware isn&#039;t good with different browsers ... crome and firefox just don&#039;t work, safari seems ok though -- although I haven&#039;t played much with this.</p><p>I have managed to get the GPL kernel to build and run on the switch and even getting NFS root mostly working, they seem to have provided for standalone &quot;GPL&quot; use and the switch ports seem to be accessible, although I&#039;m not entirely sure how that will all play out.</p><p>The biggest problem looks to be that their additions to the kernel are pretty significant and may be difficult to port to a more sensible kernel version. Anyway, messing with this is going to be my project for the next few weeks!</p><p>BTW, most of the Wifi routers I&#039;ve used have a switch that can be configured per port, I&#039;m not sure which ones you use, but certainly the Buffalo ones have been very effective for me.</p><p>Cheers,</p><p>Lee.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p226475">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">merlin90210</div>
					<div class="post-datetime">
						28 Feb 2014, 04:30					</div>
				</div>
				<div class="post-content content">
					<p>Essele/Lee,</p><p>Thanks for your reply, very helpfull and I&#039;m looking forward to the pictures.</p><p>I&#039;m especially happy with the comment on the VLAN in relation to Buffalo wifi routers. (Off-topic, sorry, it will happen only once): The Buffalo WZR-HP-G450H is a router available here (SE Asia), is that one of the VLAN capable router you mentioned (as far as you know)?</p><p>At stock s/w on the console does it allows you to enter commands and/or Busybox shell? Telnet access?<br />I look forward to any further development.</p><p>Gtz/cheers, </p><p>m</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p226624">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">essele</div>
					<div class="post-datetime">
						2 Mar 2014, 05:20					</div>
				</div>
				<div class="post-content content">
					<p>Hi merlin,</p><p>I haven&#039;t use the WZR-HP-G450H personally ... I prefer the WZR-HP-AG300H but it&#039;s now quite difficult to get hold of.</p><p>I would expect the G450H to be as capable though.</p><p>As far as shell access ... it depends if it&#039;s one of the devices that ships with ddwrt as standard ... in any case I would reflash with openwrt, it&#039;s pretty easy to do.</p><p>Lee.</p>											<p class="post-edited">(Last edited by <strong>essele</strong> on 2 Mar 2014, 05:23)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p226644">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">essele</div>
					<div class="post-datetime">
						2 Mar 2014, 18:23					</div>
				</div>
				<div class="post-content content">
					<p>Further progress ... on a couple of fronts.</p><p>1. It seems that there are quite a few devices using this same chipset, my favourite at this point is the D-Link DGS-1210-28, I&#039;m guessing based on the GPL code download, but it&#039;s a 28-port switch with no PoE, and it&#039;s only about GBP100! The PoE version (-28P) is also pretty good value.</p><p>2. It seems that the 3.10.32 kernel (used with OpenWRT trunk) has quite a bit of support for various bits of the SoC, the CPU is pretty well covered (although this is a different variant) ... I&#039;ve managed to get a standard kernel booted.</p><p>They seem to have used an illegal board number, so you have to hack that to get it to boot, but the serial console works fine. (It&#039;s not a Marvell Development Board, I just used that to see if it would boot.)</p><p>I haven&#039;t done much with the .config, so there&#039;s loads of stuff here that shouldn&#039;t be, also I haven&#039;t done anything with a rootfs ... I&#039;ve been using NFS, but that&#039;s not going to work until the network is up and running ... and I think that will take some considerable time.</p><p>Lee.</p><div class="codebox"><pre><code>Starting kernel in LE mode ...
Uncompressing Linux... done, booting the kernel.
Booting Linux on physical CPU 0x0
Initializing cgroup subsys cpuset
Initializing cgroup subsys cpu
Initializing cgroup subsys cpuacct
Linux version 3.10.32 (XXXXX) (gcc version 4.6.4 (OpenWrt/Linaro GCC 4.6-2013.05 r39757) ) #4 Sun Mar 2 16:09:09 GMT 2014
CPU: Feroceon 88FR131 [56251311] revision 1 (ARMv5TE), cr=00053977
CPU: VIVT data cache, VIVT instruction cache
Machine: Marvell DB-88F6281-BP Development Board
Ignoring unrecognised tag 0x41000403
bootconsole [earlycon0] enabled
Memory policy: ECC disabled, Data cache writeback
Built 1 zonelists in Zone order, mobility grouping on.  Total pages: 32512
Kernel command line: console=ttyS0,115200 earlyprintk=serial,uart0,115200 csb=0x0320F5B7 cso=0x0A382A28 csf=0x4891FBBE
PID hash table entries: 512 (order: -1, 2048 bytes)
Dentry cache hash table entries: 16384 (order: 4, 65536 bytes)
Inode-cache hash table entries: 8192 (order: 3, 32768 bytes)
Memory: 128MB = 128MB total
Memory: 122536k/122536k available, 8536k reserved, 0K highmem
Virtual kernel memory layout:
    vector  : 0xffff0000 - 0xffff1000   (   4 kB)
    fixmap  : 0xfff00000 - 0xfffe0000   ( 896 kB)
    vmalloc : 0xc8800000 - 0xff000000   ( 872 MB)
    lowmem  : 0xc0000000 - 0xc8000000   ( 128 MB)
    modules : 0xbf000000 - 0xc0000000   (  16 MB)
      .text : 0xc0008000 - 0xc05bbf14   (5840 kB)
      .init : 0xc05bc000 - 0xc060a8d4   ( 315 kB)
      .data : 0xc060c000 - 0xc0660e28   ( 340 kB)
       .bss : 0xc0660e28 - 0xc07311f0   ( 833 kB)
NR_IRQS:114
sched_clock: 32 bits at 166MHz, resolution 5ns, wraps every 25769ms
Console: colour dummy device 80x30
Calibrating delay loop... 498.89 BogoMIPS (lpj=2494464)
pid_max: default: 32768 minimum: 301
Security Framework initialized
SELinux:  Initializing.
Mount-cache hash table entries: 512
Initializing cgroup subsys devices
Initializing cgroup subsys freezer
Initializing cgroup subsys net_cls
Initializing cgroup subsys blkio
Initializing cgroup subsys perf_event
Initializing cgroup subsys net_prio
CPU: Testing write buffer coherency: ok
ftrace: allocating 18057 entries in 53 pages
Setting up static identity map for 0xc04272c8 - 0xc0427304
devtmpfs: initialized
pinctrl core: initialized pinctrl subsystem
regulator-dummy: no parameters
NET: Registered protocol family 16
DMA: preallocated 256 KiB pool for atomic coherent allocations
Kirkwood: Device-Unknown, TCLK=166666667.
Feroceon L2: Enabling L2
Feroceon L2: Cache support initialised.
MPP setup: unknown kirkwood variant (dev 0xe420 rev 0x3)
Kirkwood PCIe port 0: link down
PCI: bus0 uses PCIe port 0
PCI host bridge to bus 0000:00
pci_bus 0000:00: root bus resource [mem 0xe0000000-0xe7ffffff]
pci_bus 0000:00: root bus resource [io  0x1000-0xffff]
pci_bus 0000:00: No busn resource found for root bus, will use [bus 00-ff]
PCI: bus0: Fast back to back transfers disabled
bio: create slab &lt;bio-0&gt; at 0
vgaarb: loaded
SCSI subsystem initialized
usbcore: registered new interface driver usbfs
usbcore: registered new interface driver hub
usbcore: registered new device driver usb
NetLabel: Initializing
NetLabel:  domain hash size = 128
NetLabel:  protocols = UNLABELED CIPSOv4
NetLabel:  unlabeled traffic allowed by default
Switching to clocksource orion_clocksource
NET: Registered protocol family 2
TCP established hash table entries: 1024 (order: 1, 8192 bytes)
TCP bind hash table entries: 1024 (order: 0, 4096 bytes)
TCP: Hash tables configured (established 1024 bind 1024)
TCP: reno registered
UDP hash table entries: 256 (order: 0, 4096 bytes)
UDP-Lite hash table entries: 256 (order: 0, 4096 bytes)
NET: Registered protocol family 1
Initialise module verification
audit: initializing netlink socket (disabled)
type=2000 audit(0.450:1): initialized
bounce pool size: 64 pages
VFS: Disk quotas dquot_6.5.2
Dquot-cache hash table entries: 1024 (order 0, 4096 bytes)
msgmni has been set to 239
Key type asymmetric registered
Asymmetric key parser &#039;x509&#039; registered
Block layer SCSI generic (bsg) driver version 0.4 loaded (major 252)
io scheduler noop registered
io scheduler deadline registered
io scheduler cfq registered (default)
ipmi message handler version 39.2
IPMI System Interface driver.
ipmi_si: Adding default-specified kcs state machine
ipmi_si: Trying default-specified kcs state machine at i/o address 0xca2, slave address 0x0, irq 0
ipmi_si: Interface detection failed
ipmi_si: Adding default-specified smic state machine
ipmi_si: Trying default-specified smic state machine at i/o address 0xca9, slave address 0x0, irq 0
ipmi_si: Interface detection failed
ipmi_si: Adding default-specified bt state machine
ipmi_si: Trying default-specified bt state machine at i/o address 0xe4, slave address 0x0, irq 0
ipmi_si: Interface detection failed
ipmi_si: Unable to find any System Interface(s)
Serial: 8250/16550 driver, 4 ports, IRQ sharing enabled
serial8250.0: ttyS0 at MMIO 0xf1012000 (irq = 33) is a 16550A
console [ttyS0] enabled, bootconsole disabled
console [ttyS0] enabled, bootconsole disabled
Non-volatile memory driver v1.3
brd: module loaded
loop: module loaded
libphy: Fixed MDIO Bus: probed
ehci_hcd: USB 2.0 &#039;Enhanced&#039; Host Controller (EHCI) Driver
ehci-pci: EHCI PCI platform driver
ehci-orion: EHCI orion driver
orion-ehci orion-ehci.0: EHCI Host Controller
orion-ehci orion-ehci.0: new USB bus registered, assigned bus number 1
orion-ehci orion-ehci.0: irq 19, io mem 0xf1050000
orion-ehci orion-ehci.0: USB 2.0 started, EHCI 0.00
usb usb1: New USB device found, idVendor=1d6b, idProduct=0002
usb usb1: New USB device strings: Mfr=3, Product=2, SerialNumber=1
usb usb1: Product: EHCI Host Controller
usb usb1: Manufacturer: Linux 3.10.32 ehci_hcd
usb usb1: SerialNumber: orion-ehci.0
hub 1-0:1.0: USB hub found
hub 1-0:1.0: config failed, hub doesn&#039;t have any ports! (err -19)
ohci_hcd: USB 1.1 &#039;Open&#039; Host Controller (OHCI) Driver
uhci_hcd: USB Universal Host Controller Interface driver
mousedev: PS/2 mouse device common for all mice
cpuidle: using governor ladder
cpuidle: using governor menu
hidraw: raw HID events driver (C) Jiri Kosina
usbcore: registered new interface driver usbhid
usbhid: USB HID core driver
drop_monitor: Initializing network drop monitor service
TCP: cubic registered
Initializing XFRM netlink socket
NET: Registered protocol family 17
Loading module verification certificates
MODSIGN: Loaded cert &#039;Magrathea: Glacier signing key: e73ed205fcdf0e437806f385e9da3db6eb724f62&#039;
registered taskstats version 1
IMA: No TPM chip found, activating TPM-bypass!
drivers/rtc/hctosys.c: unable to open rtc device (rtc0)
md: Waiting for all devices to be available before autodetect
md: If you don&#039;t use raid, use raid=noautodetect
md: Autodetecting RAID arrays.
md: Scanned 0 and added 0 devices.
md: autorun ...
md: ... autorun DONE.
VFS: Cannot open root device &quot;(null)&quot; or unknown-block(0,0): error -6
Please append a correct &quot;root=&quot; boot option; here are the available partitions:
Kernel panic - not syncing: VFS: Unable to mount root fs on unknown-block(0,0)
CPU: 0 PID: 1 Comm: swapper Not tainted 3.10.32 #4</code></pre></div>											<p class="post-edited">(Last edited by <strong>essele</strong> on 2 Mar 2014, 18:26)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p226685">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">merlin90210</div>
					<div class="post-datetime">
						3 Mar 2014, 05:37					</div>
				</div>
				<div class="post-content content">
					<p>Lee/Essele,</p><br /><p>Congratulations on the progress so far.</p><p>You mentioned you had to tweak a bit to get the Linux kernel booting &quot;They seem to have used an illegal board number, so you have to hack that to get it to boot, but....&quot;.<br />Be so kind to post the diff (for the Linux kernel) and/or u-boot env settings, so others can benefit from your effort.</p><p>Gtz/cheers,</p><p>m</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p226698">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">essele</div>
					<div class="post-datetime">
						3 Mar 2014, 10:57					</div>
				</div>
				<div class="post-content content">
					<p>Hi merlin,</p><p>Yes ... good point!</p><p>This is very hacky at this point, but I basicalled selected the &quot;db88f6281_bp&quot; board type in the config, which has a machine type of 1680, however this particular board appears to have a machine type of 527.</p><p>These are defined in arch/arm/tools/mach-types. In 3.10.32 machine type 527 isn&#039;t defined at all, however on the golden source (see top of file) it&#039;s defined as pxa_mpm10 (which I don&#039;t think is this board.)</p><p>There could be another reason though ... it&#039;s not clear to me that this version of u-boot actually passes the machine type, therefore this could just be a register setting through whatever mechanism they do use. I don&#039;t have access to the u-boot source so really can&#039;t tell.</p><p>Their supplied GPL kernel actually passes a u-boot struct through with some limited info in it, but it doesn&#039;t match any of this stuff. I haven&#039;t done enough digging to really understand it.</p><p>In any case, hacking the mach-types file works nicely...</p><div class="codebox"><pre><code>#db88f6281_bp       MACH_DB88F6281_BP   DB88F6281_BP        1680
db88f6281_bp        MACH_DB88F6281_BP   DB88F6281_BP        527</code></pre></div><p>EDIT: Actually I&#039;ve just found this in the trendnet GPL code, so it does look like they use the machine-type concept, they just haven&#039;t used official numbers...</p><div class="codebox"><pre><code>feroceon_orion      ARCH_FEROCEON_ORION FEROCEON_ORION      526
feroceon_kw     ARCH_FEROCEON_KW    FEROCEON_KW     527
feroceon_mv78xx0    ARCH_FEROCEON_MV78XX0   FEROCEON_MV78XX0    528</code></pre></div><br /><p>If you use &#039;earlyprintk&#039; you&#039;ll get some extra debugging ... you can see my chosen command line argument from the boot listing above.</p><p>I&#039;m now starting to work through the boot and understand and resolve the key problems. For example, the standard linux code uses a mechanism to identifty the kirkwood variant that doesn&#039;t work on this chip. The GPL code uses a different method (which is also described in the 88F8281 datasheet) so that should be easy to fix.</p><p>Looking at the code, the plat-orion code seems to cover a lot of the stuff needed for the basics (inc. flash and even crypto), so I don&#039;t think this is going to be that tough. The bigger problem will be with the switch, where I&#039;m definitely way out of my comfort zone!</p><p>Cheers,</p><p>Lee.</p>											<p class="post-edited">(Last edited by <strong>essele</strong> on 3 Mar 2014, 11:15)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p227190">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">merlin90210</div>
					<div class="post-datetime">
						10 Mar 2014, 12:12					</div>
				</div>
				<div class="post-content content">
					<p>Essele/Lee,</p><p>Is there any progress on the production of pictures of the switch?<br />In the mean time I try to produce a kernel for you to test, but got stuck while compiling it.<br />The idea is to get the network (on chip) working, so you might be able to mount an nfs share as rootfs, so you don&#039;t touch the OEM image.</p><p>Untill now further way than ever, with this compile error.</p><p>I will keep you posted.</p><br /><p>Gtz,</p><p>m</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p227220">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">essele</div>
					<div class="post-datetime">
						10 Mar 2014, 20:05					</div>
				</div>
				<div class="post-content content">
					<p>Hi Merlin,</p><p>Sorry, I got sidetracked and completely forgot the pictures, I&#039;ll post shortly.</p><p>I already have a kernel built and running fine... the serial ports, the flash (mtd) and the crypto all seem to be fine with a stock kernel, with just one minor patch to ensure the SoC is properly identified.</p><p>I&#039;m working on porting the Prestera switch driver, which is going ok, but will take some time as I&#039;m trying not to introduce any of the other Marvell code if possible.</p><p>Also I&#039;ve switched to the &#039;device-tree&#039; approach which better solves the board-id problem from before.</p><p>I&#039;m also using a memory based root file system so I can experiment without messing with the flash ... nfs will be some time!</p><p>I&#039;ll post instructions once I get things to a stable state.</p><p>Regards,</p><p>Lee.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p227282">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">golialive</div>
					<div class="post-datetime">
						11 Mar 2014, 02:58					</div>
				</div>
				<div class="post-content content">
					<p>Hey there.</p><p>I like very much what you&#039;re doing here. Just grep a device that seems to fit OpenWRT and hack till it works. I really appreciate this.</p><p>But if it&#039;s about the price: Well, then using any 4*1GBit OpenWRT device in conjunction with a cheap 24 port vlan switch should be somehow cheaper.</p><p>* TP-Link TL-WDR4300 goes for ~60€<br />* TP-Link TL-SG2424 goes for ~130€</p><p>That&#039;s significantly cheaper then the TrenNET TPE-1620WS, which is available for 330€ here in germany. That&#039;s nearly 50% cheaper, and I gues you need to run that configuration for about 20 years until energy prices make it more expensive after all.</p><p>The only disatvantage I can see is the fact that the OpenWRT is only connected by a single GBit lane, but maybe the routes switch can use all 4 ports as on aggregated interface.</p><p>Don&#039;t get me wrong. The TrendNET thingy seems nice, and when you wanna play around and raise the number of devices being supported by OpenWRT it&#039;s a really really great job to do. But since you initially mentioned the price, I&#039;m going to think that&#039;s kind of the wrong direction.</p><p>Regards,<br />Stephan.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p227310">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">merlin90210</div>
					<div class="post-datetime">
						11 Mar 2014, 11:04					</div>
				</div>
				<div class="post-content content">
					<p>@Essele/Lee,</p><br /><p>Your firmware progress sounds very promissing. I still continue, just for the learning experience.<br />You are absolutely right about NFS and ramdisk.<br />I look forward to the pictures and firmware build info.</p><br /><p>@Golialive/Stefan,</p><br /><p>Thank you for your comments and interest in this project/thread.</p><p>The 24 ports is rather expensive, we admit. But the 10 port (now work in progress) has a totally different pricetag.<br />As a sidenote, please realize we talk about PPOE enabled switches Those models are rather low in numbers.<br />Using a non-PPOE switch with a power injector (one per port) is not a very cost effective solution either. And I better not start about the looks with all those single units.</p><p>Openwrt is about freedom and choice, and that is the spirit of this project (attempting) porting Openwrt to a switch.<br />And in my case, leaving options open for a hardware mod on top of that (USB on the outside).</p><p>Gtz,</p><p>m</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p227312">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">essele</div>
					<div class="post-datetime">
						11 Mar 2014, 11:49					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><div class="quotebox"><cite>golialive wrote:</cite><blockquote><p>* TP-Link TL-WDR4300 goes for ~60€<br />* TP-Link TL-SG2424 goes for ~130€</p></blockquote></div><p>Yes, you are right, however it&#039;s not entirely about cost ... neither of these devices would be able to run a high performance IPSEC tunnel for example (my more powerful WZR-AG300H maxes out about 50MB/s with only SHA1 hashing and no encryption.) And neither of them have PoE as merlin has pointed out.</p><p>PoE really adds to the cost, the non-PoE versions are much cheaper ... I will probably have a look at some options once I have this working ... there seem to be two or three common chipsets, all with GPL code.</p><p>There may not be mass appeal for this kind of solution, but most of the support is already in Linux so it seems an interesting option to explore.</p><p>Regards,</p><p>Lee.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p227417">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">essele</div>
					<div class="post-datetime">
						12 Mar 2014, 09:25					</div>
				</div>
				<div class="post-content content">
					<p>I am conscious that I still haven&#039;t managed to get some good photo&#039;s online, so I have created a Wiki page on the OpenWRT wiki and added one photo that at least shows the serial port and some of the internals.</p><p><a href="http://wiki.openwrt.org/toh/trendnet/tpe1020ws">http://wiki.openwrt.org/toh/trendnet/tpe1020ws</a></p><p>Regards,</p><p>Lee.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p227569">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">merlin90210</div>
					<div class="post-datetime">
						14 Mar 2014, 05:36					</div>
				</div>
				<div class="post-content content">
					<p>Essele/Lee,</p><p>Thanks for the Wiki page including the picture.<br />The one thing you didn&#039;t mentioned on the Wiki page was a link to this thread.</p><p>In the mean time I keep on learning how to build OpenWrt images and packages, and thanks to your Wiki page I learned I was using the wrong SoC as target.<br />One day it will work (somewhat).<br />Any preliminary&nbsp; build info would be great.<br />Any success on the back-port of the switch?</p><p>I discussed this project (experiment if you want) with my brother, who&#039;s a very security conscious guy and he really liked the project.<br />A good amount of security equipment including cameras are PoE enabled and that&#039;s where he sees a great application for this (kind of) switch/project.</p><p>Again, thanks for the good work.</p><p>Gtz,</p><p>m</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p227571">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">essele</div>
					<div class="post-datetime">
						14 Mar 2014, 06:27					</div>
				</div>
				<div class="post-content content">
					<p>Hi Merlin,</p><p>I haven&#039;t even started looking at OpenWRT support yet, I&#039;m just working with a stock linux kernel. There will be more stuff to do to get OpenWRT build support working.</p><p>I have the switch driver building ok and the switch initialises, but I can&#039;t send or receive packets yet ... I&#039;m pretty confident that I&#039;ll get it working soon, however the Marvell code is really quite horrible (partially because they use a common framework to support multiple interface types and other non-linux platforms) and I think it will probably need a rewrite.</p><p>The packet sending code for example seems to busy-wait for the packet send, which can&#039;t be good for performance!</p><p>I&#039;ll keep this thread updated as I make progress.</p><p>Lee.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p227960">
				<div class="post-metadata">
					<div class="post-num">Post #21</div>
					<div class="post-author">essele</div>
					<div class="post-datetime">
						19 Mar 2014, 16:35					</div>
				</div>
				<div class="post-content content">
					<p>Further progress ... there were problems with both interrupts and dma because of major changes between 2.6.x and 3.10.x.</p><p>Anyway, the interrupts have been working for a little while, and I&#039;ve just managed to get dma working for received packets, so I can now receive packets on the device (it&#039;s limited to seeing arp packets because transmit isn&#039;t working yet.)</p><p>I have some concerns about the way its working, but I&#039;ll get through those. Next will be to apply the same fixes I used on receive for the transmit side. Once both are working and I have a reference working solution I will rewrite the driver completely I think.</p><p>Lee.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p228007">
				<div class="post-metadata">
					<div class="post-num">Post #22</div>
					<div class="post-author">merlin90210</div>
					<div class="post-datetime">
						20 Mar 2014, 11:43					</div>
				</div>
				<div class="post-content content">
					<p>Essele/Lee,</p><br /><p>This is great news.<br />The whole project really start to get some form like this.</p><p>One thing does confuse me a bit: if there is a switch driver for 2.6.x, where (who) is the maintainer of this driver?</p><p>You mention the current switch driver is a busy-wait one for Tx. Are you confident you can make a better performing one?<br />If yes, then you might make a living out of this kind of jobs.</p><p>I&#039;m not making much progress and mess around with toolchain and OpenWrt and vanilla kernel.<br />Nice learning experience it is.</p><p>Looking forward to your next progress report.</p><br /><p>Gtz,</p><p>m</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p228222">
				<div class="post-metadata">
					<div class="post-num">Post #23</div>
					<div class="post-author">essele</div>
					<div class="post-datetime">
						23 Mar 2014, 05:25					</div>
				</div>
				<div class="post-content content">
					<p>Hi merlin,</p><div class="quotebox"><blockquote><p>One thing does confuse me a bit: if there is a switch driver for 2.6.x, where (who) is the maintainer of this driver?</p></blockquote></div><p>It&#039;s the GPL code that they provide as part of their GPL commitments, so it&#039;s not part of the standard kernel and not maintained outside of whatever they do from a proprietary perspective.</p><div class="quotebox"><blockquote><p>You mention the current switch driver is a busy-wait one for Tx. Are you confident you can make a better performing one?</p></blockquote></div><p>I&#039;m not really a driver expert, but I&#039;ve been doing a fair amount of research and I&#039;m confident that this can be structured in a similar way to many of the other Linux network drivers, including some of the performance optimisations. The GPL code is pretty horrible, but mostly because they seem to have a common code base for other implementations. Once you strip out that requirement it&#039;s easier to make the code simple and efficient.</p><div class="quotebox"><blockquote><p>If yes, then you might make a living out of this kind of jobs.</p></blockquote></div><p>LOL. I doubt it! There are far more talented people out there than me, especially in this area. I&#039;ll stick with mushroom farming. ;-)</p><p>Lee.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p228648">
				<div class="post-metadata">
					<div class="post-num">Post #24</div>
					<div class="post-author">essele</div>
					<div class="post-datetime">
						28 Mar 2014, 07:39					</div>
				</div>
				<div class="post-content content">
					<p>More progress ... I had some intermittent issues with the receive code whilst trying to update the GPL driver, so I decided to start again with a clean version. But I then discovered that the existing Marvell mv643xxx_eth driver has mostly the same logic and I&#039;d just need to rework slightly because of a different approach to registers, interrupts, and descriptors.</p><p>Anyway, new code, mostly clean of the original Marvell GPL code (only a few small routines left to port) and receive is now 100% solid. I can now get to the transmit code which should be simple because most of the work is done. Also, this driver is napi compliant so we should see significant improvements over the GPL one.</p><p>I&#039;ve also managed to get a self-built kernel to run with the standard firmware from the switch which means I can build hooks to dump various registers at various times to try to work out some of the unknowns (vlan configs, DSA header control etc, PoE.)</p><p>Lee.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p228735">
				<div class="post-metadata">
					<div class="post-num">Post #25</div>
					<div class="post-author">merlin90210</div>
					<div class="post-datetime">
						29 Mar 2014, 04:44					</div>
				</div>
				<div class="post-content content">
					<p>Lee / Essele,</p><br /><p>This is really big news (and that for a mushroom farmer).</p><p>Now that you can peek into the self-compiled&nbsp; OEM kernel, the chance all the old functions can be implemented using OpenWRT in the end are really high.</p><p>Also congratulations on the Rx code and close to free of Marvell&#039;s NDA code.</p><p>It&#039;s time to look for a supplier for this 10-port box to get my hand dirty in the coming month or so.</p><p>My efforts stay mainly fruitless of result, but the learning is great.</p><br /><p>Keep up the good work,</p><p>m</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>