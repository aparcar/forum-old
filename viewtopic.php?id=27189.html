<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> sysupgrade bug on WRT160NL</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 23 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p120312">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">jintao</div>
					<div class="post-datetime">
						3 Nov 2010, 17:47					</div>
				</div>
				<div class="post-content content">
					<p>Dear all, </p><p>I tried reflashing the WRT160NL router with sysupgrade.&nbsp; </p><p>It works when config files is not saved over flashing. </p><p>It always bricks the router if I choose to save config files.&nbsp; &nbsp;</p><p>I also tried flashing from LuCI and selected &quot;save config files&quot;, and router got bricked.</p><p>I accessed the serial console, the bootloader complains about bad CRC <br /></p><div class="quotebox"><blockquote><p>U-Boot 1.1.6 (May 12 2009 - 07:52:28)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />DRAM:&nbsp; ar7100_ddr_initial_config(237) enter!&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />ar7100_ddr_initial_config(269) exit!&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />U-Boot 1.1.6 (May 12 2009 - 07:52:28)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />AP81 (ar7100) U-boot&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />sri&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />32 MB&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />WRT160NL u-boot version: 1.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />Top of RAM usable for U-Boot at: 82000000&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />Reserving 279k for U-Boot at: 81fb8000&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />Reserving 192k for malloc() at: 81f88000&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />Reserving 44 Bytes for Board Info at: 81f87fd4&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />Reserving 36 Bytes for Global Data at: 81f87fb0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />Reserving 128k for boot params() at: 81f67fb0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />Stack Pointer at: 81f67f98&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />Now running in RAM - U-Boot at: 81fb8000&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />id read 0x100000ff&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />flash size 8MB, sector count = 128&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />Flash:&nbsp; 8 MB&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />*** Warning - bad CRC, using default environment&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />In:&nbsp; &nbsp; serial&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />Out:&nbsp; &nbsp;serial&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />Err:&nbsp; &nbsp;serial&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />Net:&nbsp; &nbsp;ag7100_enet_initialize...&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />ag7100 get ethaddr for device eth0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />Fetching MAC Address from 0x81feb1e0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br /> --------***** Get the RTL8306SD Manufactory ID=379c *****-------&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br /> Reg6: speed=0 nway=1 duplex=0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br /> Reg5: speed=0 nway=0 duplex=0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br /> Reg1: a1=7fd9 a2=30e0 a3=15ac a4=30e0 a5=0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br /> Reg1: a1=7fd9 a2=30e0 a3=15ac a4=30e0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br /> Reg1: a1=7fd9 a2=30e0 a3=15ac a4=30e0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br /> Reg1: a1=7fd9 a2=30e0 a3=15ac a4=30e0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br /> Reg1: a1=7fd9 a2=30e0 a3=15ac a4=30e0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />eth0: 00:25:9c:d8:e9:41&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />eth0 up&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />eth0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />### main_loop entered: bootdelay=1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />Hit any key to stop autoboot:&nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />## Booting WRT160NL ...&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />Application code length 0x00310000&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />Bad CRC: trx.crc32 0x9d594875 calculate 0x499b6ce2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br /> check link duplex:Full/speed:100&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />dup 1 speed 100&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />Tftpd start listening on port[69]!</p></blockquote></div><p>Does sysupgrade support WRT160NL model? Is there any work around to flash this router with config files saved? </p><p>Thanks tons in advance!</p>											<p class="post-edited">(Last edited by <strong>jintao</strong> on 3 Nov 2010, 17:50)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p120760">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">nextsux</div>
					<div class="post-datetime">
						10 Nov 2010, 19:29					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>did you solved this problem? I&#039;ve got a same one <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> I&#039;ve just debricked my wrt160nl via U-Boot</p><p>I would not be concerned about that CRC warning. This warning is shown on mine every boot (even with wiped config):</p><div class="codebox"><pre><code>U-Boot 1.1.5 (Apr  6 2009 - 13:54:11)                                                                                                     
                                                                                                                                          
DRAM:  ar7100_ddr_initial_config(237) enter!                                                                                              
ar7100_ddr_initial_config(269) exit!                                                                                                      
                                                                                                                                          
                                                                                                                                          
U-Boot 1.1.5 (Apr  6 2009 - 13:54:11)                                                                                                     
                                                                                                                                          
AP81 (ar7100) U-boot                                                                                                                      
sri                                                                                                                                       
32 MB                                                                                                                                     
WRT160NL u-boot version: 1.0.0                                                                                                            
Top of RAM usable for U-Boot at: 82000000                                                                                                 
Reserving 277k for U-Boot at: 81fb8000                                                                                                    
Reserving 192k for malloc() at: 81f88000                                                                                                  
Reserving 44 Bytes for Board Info at: 81f87fd4                                                                                            
Reserving 36 Bytes for Global Data at: 81f87fb0                                                                                           
Reserving 128k for boot params() at: 81f67fb0                                                                                             
Stack Pointer at: 81f67f98                                                                                                                
Now running in RAM - U-Boot at: 81fb8000                                                                                                  
id read 0x100000ff                                                                                                                        
flash size 8MB, sector count = 128                                                                                                        
Flash:  8 MB                                                                                                                              
*** Warning - bad CRC, using default environment                                                                                          
                                                                                                                                          
In:    serial                                                                                                                             
Out:   serial                                                                                                                             
Err:   serial                                                                                                                             
Net:   ag7100_enet_initialize...                                                                                                          
ag7100 get ethaddr for device eth0                                                                                                        
Fetching MAC Address from 0x81feaf20                                                                                                      
                                                                                                                                          
 --------***** Get the RTL8306SD Manufactory ID=34dc *****-------                                                                         
 Reg6: speed=0 nway=1 duplex=1                                                                                                            
 Reg5: speed=0 nway=0 duplex=0                                                                                                            
 Reg1: a1=7fd9 a2=2890 a3=115c a4=2890 a5=0                                                                                               
 Reg1: a1=7fd9 a2=2890 a3=115c a4=2890                                                                                                    
 Reg1: a1=7fd9 a2=2890 a3=115c a4=2890                                                                                                    
 Reg1: a1=7fd9 a2=2890 a3=115c a4=2890                                                                                                    
 Reg1: a1=7fd9 a2=2890 a3=115c a4=2890</code></pre></div><p>I&#039;ve noticed that corruption happens immediately after sysupgrade tries to restore config files but there are some warnings about mounting overlay first. I&#039;ll post sysupgrade output later.</p><p>I think we should look for problem somewhere around /lib/upgrade/common.sh:137<br /></p><div class="codebox"><pre><code>jffs2_copy_config() {
    if grep rootfs_data /proc/mtd &gt;/dev/null; then
        # squashfs+jffs2
        mtd -e rootfs_data jffs2write &quot;$CONF_TAR&quot; rootfs_data
    else
        # jffs2
        mtd jffs2write &quot;$CONF_TAR&quot; rootfs
    fi
}</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p120763">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">nextsux</div>
					<div class="post-datetime">
						10 Nov 2010, 19:53					</div>
				</div>
				<div class="post-content content">
					<p>Well this is wierd. I&#039;m running now my &quot;restore&quot; build based on Backfire (10.03, r20728). It seems not to suffer by this problem!</p><div class="codebox"><pre><code>etc/dropbear/dropbear_dss_host_key
etc/group
etc/passwd
etc/config/wireless
etc/config/uhttpd
etc/config/system
etc/config/ucitrack
etc/config/network
etc/config/dropbear
etc/config/firewall
etc/config/luci
etc/config/dhcp
Switching to ramdisk...
mount: mounting mini_fo:/overlay on /mnt failed: Function not implemented
Performing system upgrade...
Unlocking firmware ...
Writing from &lt;stdin&gt; to firmware ...  [w]
Appending jffs2 data from /tmp/sysupgrade.tgz to firmware...
Upgrade completed
Rebooting system...
Terminated</code></pre></div><p>&quot;error&quot; is there, but system did not get bricked, everything worked. Thus I assume bug appeared very recently</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p120769">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">nextsux</div>
					<div class="post-datetime">
						10 Nov 2010, 21:07					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ve tracked problem down to commit 22881 in /package/mtd/src<br />When I reverted this commit, I was able successfully sysupgrade with keeping my config without bricking my WRT160NL</p><p>Can you confirm this works?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p122791">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">jintao</div>
					<div class="post-datetime">
						7 Dec 2010, 19:15					</div>
				</div>
				<div class="post-content content">
					<p>Hi nextsux,</p><p>I will try this tonight.&nbsp; Will get back to you with how it goes for me.&nbsp; Thanks in advance!</p><p>jt</p><div class="quotebox"><cite>nextsux wrote:</cite><blockquote><p>I&#039;ve tracked problem down to commit 22881 in /package/mtd/src<br />When I reverted this commit, I was able successfully sysupgrade with keeping my config without bricking my WRT160NL</p><p>Can you confirm this works?</p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p124151">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">jintao</div>
					<div class="post-datetime">
						29 Dec 2010, 19:25					</div>
				</div>
				<div class="post-content content">
					<p>Hi, </p><p>Sorry for the late response. Just got chance to try this out.&nbsp; Unfortunately it doesn&#039;t work for me.&nbsp; I reverted package/mtd to several old revisions, none of them works. still bricked the router each time. </p><p>will keep looking for the solution</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p125904">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">neutronscott</div>
					<div class="post-datetime">
						19 Jan 2011, 03:06					</div>
				</div>
				<div class="post-content content">
					<p>Look for this. During a boot, see where your MTD partitions are at. do a sysupgrade without config files. Now look where your MTD partitions are at. Did rootfs_data move? If so, the problem is that sysupgrade rewrites the configs into the old rootfs_data partition before rebooting, which may be overwriting your squashfs if the new image is larger!!</p><p>edit: you look at &quot;dmesg&quot; output for something like this</p><div class="codebox"><pre><code>Creating 3 MTD partitions on &quot;adm8668-nor&quot;:
0x000000040000-0x000000800000 : &quot;linux&quot;
0x000000120000-0x000000800000 : &quot;rootfs&quot;
mtd: partition &quot;rootfs&quot; set to be root filesystem
mtd: partition &quot;rootfs_data&quot; created automatically, ofs=270000, len=590000 
0x000000270000-0x000000800000 : &quot;rootfs_data&quot;
0x000000020000-0x000000040000 : &quot;uboot_env&quot;</code></pre></div>											<p class="post-edited">(Last edited by <strong>neutronscott</strong> on 19 Jan 2011, 03:10)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p126456">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">nextsux</div>
					<div class="post-datetime">
						25 Jan 2011, 15:21					</div>
				</div>
				<div class="post-content content">
					<p>I have new wrt160nl in here now and I have same problem as you are. Only difference between model I used to use earlier and now are versions of U-boot. Older one have 1.1.5, new have 1.1.6. Maybe this is our problem.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p126469">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">nextsux</div>
					<div class="post-datetime">
						25 Jan 2011, 20:24					</div>
				</div>
				<div class="post-content content">
					<p>Hi again,</p><p>try this UGLY patch</p><div class="codebox"><pre><code>Index: package/base-files/files/lib/upgrade/common.sh
===================================================================
--- package/base-files/files/lib/upgrade/common.sh    (revision 23944)
+++ package/base-files/files/lib/upgrade/common.sh    (working copy)
@@ -174,6 +174,10 @@
             jffs2_copy_config
         fi
     }
+
+    echo &quot;fixing TRX&quot;
+    mtd fixtrx -o 32 firmware
+
     v &quot;Upgrade completed&quot;
     [ -n &quot;$DELAY&quot; ] &amp;&amp; sleep &quot;$DELAY&quot;
     ask_bool 1 &quot;Reboot&quot; &amp;&amp; {</code></pre></div><p>it worked for me. It seems like appending jffs2 data corrupts TRX CRC32.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p129778">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">WTGPhoben</div>
					<div class="post-datetime">
						2 Mar 2011, 15:58					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>nextsux wrote:</cite><blockquote><p>Hi again,</p><p>try this UGLY patch</p><div class="codebox"><pre><code>Index: package/base-files/files/lib/upgrade/common.sh
===================================================================
--- package/base-files/files/lib/upgrade/common.sh    (revision 23944)
+++ package/base-files/files/lib/upgrade/common.sh    (working copy)
@@ -174,6 +174,10 @@
             jffs2_copy_config
         fi
     }
+
+    echo &quot;fixing TRX&quot;
+    mtd fixtrx -o 32 firmware
+
     v &quot;Upgrade completed&quot;
     [ -n &quot;$DELAY&quot; ] &amp;&amp; sleep &quot;$DELAY&quot;
     ask_bool 1 &quot;Reboot&quot; &amp;&amp; {</code></pre></div><p>it worked for me. It seems like appending jffs2 data corrupts TRX CRC32.</p></blockquote></div><p>This worked for me as well, but not until the code was in the image on the router.&nbsp; Manually adding the lines to common.sh file before running sysupgrade does not seem to work.&nbsp; (in both cases the code was in the new image).&nbsp; </p><p>Can someone confirm that this makes sense?</p><p>Also, has anyone posted this as a bug yet?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p129781">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">nextsux</div>
					<div class="post-datetime">
						2 Mar 2011, 16:31					</div>
				</div>
				<div class="post-content content">
					<p>I think that better way is to fix mtd utility. I&#039;ve tried that but I&#039;m not strong at C, so it did not worked.<br />No I have not posted this as bug yet.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p129792">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">WTGPhoben</div>
					<div class="post-datetime">
						2 Mar 2011, 19:03					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>nextsux wrote:</cite><blockquote><p>I think that better way is to fix mtd utility. I&#039;ve tried that but I&#039;m not strong at C, so it did not worked.<br />No I have not posted this as bug yet.</p></blockquote></div><p>I don&#039;t doubt you&#039;re right...&nbsp; </p><p>Update on my question above, some more testing has me convinced that you can, in fact, change the script in the running config and the sysupgrade successfully.&nbsp; I rebooted after changing the file this time.&nbsp; Not sure why that would matter, but it works consistently</p><p>Posted the issue as a bug: <a href="https://dev.openwrt.org/ticket/8960">https://dev.openwrt.org/ticket/8960</a> so someone who knows mtd can take a look</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p134516">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">lc</div>
					<div class="post-datetime">
						3 May 2011, 11:02					</div>
				</div>
				<div class="post-content content">
					<p>Seems the ticket has not yet been processed. Just tried the latest snapshop r26806. After sysupgrade the WRT160NL has to be reflashed using tftp.</p><div class="codebox"><pre><code>root@openWRT:/tmp# sysupgrade -v http://downloads.openwrt.org/snapshots/trunk/ar71xx/openwrt-ar71xx-generic-wrt160nl-squashfs-sysupgrade.bin
Saving config files...
etc/sysctl.conf
etc/shells
etc/rc.local
etc/profile
etc/passwd
etc/inittab
etc/hosts
etc/group
etc/firewall.user
etc/dropbear/dropbear_rsa_host_key
etc/dropbear/dropbear_dss_host_key
etc/config/wireless
etc/config/timeserver
etc/config/system
etc/config/network
etc/config/firewall
etc/config/dropbear
etc/config/dhcp
Switching to ramdisk...
Performing system upgrade...
Unlocking firmware ...

Writing from &lt;stdin&gt; to firmware ...     
Appending jffs2 data from /tmp/sysupgrade.tgz to firmware...TRX header not found
Error fixing up TRX header
    
Upgrade completed
Rebooting system...</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p147903">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">beppealf</div>
					<div class="post-datetime">
						8 Nov 2011, 00:38					</div>
				</div>
				<div class="post-content content">
					<p>I just bricked my 160nl going through a sysupgrade.</p><p>I repeatedly tried to unbrick via tftp and using the serial console. It accepts the code.bin file, erases flash, rewrites it, but afterwards always reports</p><div class="codebox"><pre><code>Bytes transferred = 2771818 (2a4b6a hex)                                            
load addr= 0x80060000                                                               
boot file= CODE.BIN                                                                 
NetBootFileXferSize= 002a4b6a                                                       
Erase linux kernel block !!                                                         
From bf040000 To bf7dffff                                                           
Erase Flash from 0xbf040000 to 0xbf7dffff in Bank # 1                               
First 0x4 last 0x7d sector size 0x10000                                             
 125                                                                                
Erased 122 sectors                                                                  
Programming.........                                                                
Copy to Flash... write addr: bf040000                                               
done                                                                                
## Booting WRT160NL ...                                                             
Application code length 0x002a0000                                                  
Bad CRC: trx.crc32 0x58c0b426 calculate 0xdd4f53d2</code></pre></div><p>I tried several firmwares including the Linksys original stock one without success.</p><p>My U-boot is 1.1.6.</p><p>May I ask you how you manged to succesfully debrick it every time?</p><p>Thx</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p147930">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">v.90</div>
					<div class="post-datetime">
						8 Nov 2011, 15:22					</div>
				</div>
				<div class="post-content content">
					<p>Just out curiosity have you named the file code.bin before you push it?</p><p>Here&#039;s what my last output looked like:<br /></p><div class="quotebox"><blockquote><p>ar7100&gt; upgrade code.bin</p><p> check link duplex:Full/speed:100<br />dup 1 speed 100<br />Tftpd start listening on port[69]!<br />Load address: 0x80060000<br />checksum bad<br />checksum bad<br />checksum bad<br />checksum bad<br />checksum bad<br />checksum bad<br />checksum bad<br />Receiving firmware [code.bin] from [192.168.1.88]<br />Write File : CODE.BIN<br />#</p><p>Current Code Pattern:NL1X , Upgrade Code Pattern:NL1X</p><p>Code Pattern is correct!<br />################################################################<br /> #################################################################<br /> #################################################################<br /> #################################################################<br /> #################################################################<br /> #################################################################<br /> #################################################################<br /> #################################################################<br /> #################################################################<br /> #################################################################<br /> #################################################################<br /> #########################################<br />done<br />Bytes transferred = 3867648 (3b0400 hex)<br />load addr= 0x80060000<br />boot file= CODE.BIN<br />NetBootFileXferSize= 003b0400<br />Erase linux kernel block !!<br />From bf040000 To bf7dffff<br />Erase Flash from 0xbf040000 to 0xbf7dffff in Bank # 1 <br />First 0x4 last 0x7d sector size 0x10000<br />&nbsp; &nbsp;4&nbsp; &nbsp;5&nbsp; &nbsp;6&nbsp; &nbsp;7&nbsp; &nbsp;8&nbsp; &nbsp;9&nbsp; 10&nbsp; 11&nbsp; 12&nbsp; 13&nbsp; 14&nbsp; 15&nbsp; 16&nbsp; 17&nbsp; 18&nbsp; 19&nbsp; 20&nbsp; 21&nbsp; 22&nbsp; 23&nbsp; 24&nbsp; 25&nbsp; 26&nbsp; 27&nbsp; 28&nbsp; 29&nbsp; 30&nbsp; 31&nbsp; 32&nbsp; 33&nbsp; 34&nbsp; 35&nbsp; 36&nbsp; 37&nbsp; 38&nbsp; 39&nbsp; 40&nbsp; 41&nbsp; 42&nbsp; 43&nbsp; 44&nbsp; 45&nbsp; 46&nbsp; 47&nbsp; 48&nbsp; 49&nbsp; 50&nbsp; 51&nbsp; 52&nbsp; 53&nbsp; 54&nbsp; 55&nbsp; 56&nbsp; 57&nbsp; 58&nbsp; 59&nbsp; 60&nbsp; 61&nbsp; 62&nbsp; 63&nbsp; 64&nbsp; 65&nbsp; 66&nbsp; 67&nbsp; 68&nbsp; 69&nbsp; 70&nbsp; 71&nbsp; 72&nbsp; 73&nbsp; 74&nbsp; 75&nbsp; 76&nbsp; 77&nbsp; 78&nbsp; 79&nbsp; 80&nbsp; 81&nbsp; 82&nbsp; 83&nbsp; 84&nbsp; 85&nbsp; 86&nbsp; 87&nbsp; 88&nbsp; 89&nbsp; 90&nbsp; 91&nbsp; 92&nbsp; 93&nbsp; 94&nbsp; 95&nbsp; 96&nbsp; 97&nbsp; 98&nbsp; 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125<br />Erased 122 sectors<br />Programming.........<br />Copy to Flash... write addr: bf040000<br />done<br />ar7100&gt; go</p><p>## Booting WRT160NL ...<br />Code pattern OK: NL1X&nbsp; Expect: NL1X<br />Application code length 0x003b0000<br />CRC OK<br />## Booting image at bf04003c ...</p></blockquote></div>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>