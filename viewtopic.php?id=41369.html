<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> tl-mr3040 and usb dongle 2g mode</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 13 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p187460">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">mesb</div>
					<div class="post-datetime">
						31 Dec 2012, 08:42					</div>
				</div>
				<div class="post-content content">
					<p>Hi.<br />Using tl-mr3040 and 12.09 rc1.<br />Also i have huawei e173 device:</p><div class="codebox"><pre><code>ati1
Manufacturer: huawei
Model: E173
Revision: 11.126.85.00.209
+GCAP: +CGSM,+FCLASS,+DS</code></pre></div><p>After choosing gprs only (sometimes 3g signal is weak, so i want 2g only mode) in luci settings, modem becomes unavailable for router:<br /></p><div class="codebox"><pre><code>AT^SYSCFG?
^SYSCFG:13,1,3FFFFFFF,1,2</code></pre></div><p>In dmesg even after disabling everything exept modem:<br />AT^U2DIAG=0</p><p>I saw:<br /></p><div class="codebox"><pre><code>[  555.990000] usb 1-1: new high-speed USB device number 2 using ehci-platform
[  556.140000] option 1-1:1.0: GSM modem (1-port) converter detected
[  556.150000] usb 1-1: GSM modem (1-port) converter now attached to ttyUSB0
[  556.150000] option 1-1:1.1: GSM modem (1-port) converter detected
[  556.160000] usb 1-1: GSM modem (1-port) converter now attached to ttyUSB1
[  556.170000] option 1-1:1.2: GSM modem (1-port) converter detected
[  556.170000] usb 1-1: GSM modem (1-port) converter now attached to ttyUSB2
[  562.860000] usb 1-1: USB disconnect, device number 2
[  562.870000] option: option_instat_callback: error -143
[  562.870000] option1 ttyUSB0: GSM modem (1-port) converter now disconnected from ttyUSB0
[  562.880000] option 1-1:1.0: device disconnected
[  562.890000] option1 ttyUSB1: GSM modem (1-port) converter now disconnected from ttyUSB1
[  562.890000] option 1-1:1.1: device disconnected
[  562.900000] option1 ttyUSB2: GSM modem (1-port) converter now disconnected from ttyUSB2
[  562.910000] option 1-1:1.2: device disconnected
[  563.130000] hub 1-0:1.0: unable to enumerate USB device on port 1</code></pre></div><p>On my desktop i don&#039;t have any problem with it.<br /></p><div class="codebox"><pre><code>Packets installed:
opkg list | grep usb
kmod-ledtrig-usbdev - 3.3.8-1
kmod-usb-core - 3.3.8-1
kmod-usb-serial - 3.3.8-1
kmod-usb-serial-option - 3.3.8-1
kmod-usb-serial-wwan - 3.3.8-1
kmod-usb-uhci - 3.3.8-1
kmod-usb2 - 3.3.8-1
libusb - 0.1.12-3
libusb-1.0 - 1.0.9-1
usbutils - 005-1</code></pre></div><p>Hm, looks strange, i change settings of modem back to normal (modem and sd and cd enabled, 3g+2g enabled), but router still won&#039;t recognize device:<br /></p><div class="codebox"><pre><code>[    9.360000] PPP generic driver version 2.4.2
[    9.600000] ip_tables: (C) 2000-2006 Netfilter Core Team
[    9.830000] NET: Registered protocol family 24
[    9.850000] ehci_hcd: USB 2.0 &#039;Enhanced&#039; Host Controller (EHCI) Driver
[    9.850000] ehci-platform ehci-platform: Generic Platform EHCI Controller
[    9.860000] ehci-platform ehci-platform: new USB bus registered, assigned bus number 1
[    9.900000] ehci-platform ehci-platform: irq 3, io mem 0x1b000000
[    9.920000] ehci-platform ehci-platform: USB 2.0 started, EHCI 1.00
[    9.920000] hub 1-0:1.0: USB hub found
[    9.920000] hub 1-0:1.0: 1 port detected
[    9.950000] nf_conntrack version 0.5.0 (456 buckets, 1824 max)
[   10.210000] uhci_hcd: USB Universal Host Controller Interface driver
[   10.280000] usb 1-1: new high-speed USB device number 2 using ehci-platform
[   10.340000] usbcore: registered new interface driver usbserial
[   10.340000] USB Serial support registered for generic
[   10.440000] usbcore: registered new interface driver usbserial_generic
[   10.450000] usbserial: USB Serial Driver core
[   10.500000] USB Serial support registered for GSM modem (1-port)
[   10.500000] usbcore: registered new interface driver option
[   10.510000] option: v0.7.2:USB Driver for GSM modems
[   13.780000] device eth0 entered promiscuous mode
[   14.350000] eth0: link up (100Mbps/Full duplex)
[   14.350000] br-lan: port 1(eth0) entered forwarding state
[   14.360000] br-lan: port 1(eth0) entered forwarding state
[   16.360000] br-lan: port 1(eth0) entered forwarding state
[  161.750000] usb 1-1: USB disconnect, device number 2
[  257.720000] usb 1-1: new high-speed USB device number 3 using ehci-platform</code></pre></div><br /><br /><p>What else shoud i do to resolv problem of not connecting device?<br />Or maybe i shoud create a ticket?</p>											<p class="post-edited">(Last edited by <strong>mesb</strong> on 31 Dec 2012, 21:15)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p187464">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">mesb</div>
					<div class="post-datetime">
						31 Dec 2012, 10:28					</div>
				</div>
				<div class="post-content content">
					<p>Well, i don&#039;t understand what happend.<br />For testing purposes reinstalled all i have.</p><p>Now i have:<br /></p><div class="codebox"><pre><code>opkg list-installed | grep usb
kmod-ledtrig-usbdev - 3.3.8-1
kmod-usb-core - 3.3.8-1
kmod-usb-serial - 3.3.8-1
kmod-usb-serial-option - 3.3.8-1
kmod-usb-serial-wwan - 3.3.8-1
kmod-usb-uhci - 3.3.8-1
kmod-usb2 - 3.3.8-1
libusb - 0.1.12-3
libusb-1.0 - 1.0.9-1
usb-modeswitch - 1.2.3-2
usb-modeswitch-data - 20120120-1
usbutils - 005-1</code></pre></div><div class="codebox"><pre><code> lsusb
Bus 001 Device 010: ID 12d1:1003 Huawei Technologies Co., Ltd. E220 HSDPA Modem / E230/E270/E870 HSDPA/HSUPA Modem
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub</code></pre></div><p>So i can reproduce it:<br />in minicom send:<br />at^syscfg=13,1,3fffffff,2,4 - work in 2g mode. And then coennect it to router.</p><p>Right after that modem appears as ttyUSB0 and ttyUSB1 adn then disconnect itself:<br /></p><div class="codebox"><pre><code>[  261.260000] usb 1-1: new high-speed USB device number 6 using ehci-platform
[  261.620000] usb 1-1: USB disconnect, device number 6
[  265.650000] usb 1-1: new high-speed USB device number 7 using ehci-platform
[  265.800000] option 1-1:1.0: GSM modem (1-port) converter detected
[  265.810000] usb 1-1: GSM modem (1-port) converter now attached to ttyUSB0
[  265.810000] option 1-1:1.1: GSM modem (1-port) converter detected
[  265.820000] usb 1-1: GSM modem (1-port) converter now attached to ttyUSB1
[  271.770000] usb 1-1: USB disconnect, device number 7
[  271.770000] option: option_instat_callback: error -143
[  271.780000] option1 ttyUSB0: GSM modem (1-port) converter now disconnected from ttyUSB0
[  271.790000] option 1-1:1.0: device disconnected
[  271.790000] option1 ttyUSB1: GSM modem (1-port) converter now disconnected from ttyUSB1
[  271.800000] option 1-1:1.1: device disconnected
[  272.020000] hub 1-0:1.0: unable to enumerate USB device on port 1</code></pre></div><p>Right after it send:<br />at^syscfg=2,2,3fffffff,2,4<br /></p><div class="codebox"><pre><code>[  374.720000] usb 1-1: new high-speed USB device number 9 using ehci-platform
[  375.080000] usb 1-1: USB disconnect, device number 9
[  379.210000] usb 1-1: new high-speed USB device number 10 using ehci-platform
[  379.360000] option 1-1:1.0: GSM modem (1-port) converter detected
[  379.370000] usb 1-1: GSM modem (1-port) converter now attached to ttyUSB0
[  379.370000] option 1-1:1.1: GSM modem (1-port) converter detected
[  379.380000] usb 1-1: GSM modem (1-port) converter now attached to ttyUSB1</code></pre></div><br /><p>What is going on?</p><p>On my desktop pc no matter in which mode modem is, it&#039;s always recognized fine.</p><p>Even switch in 2g mode and only modem mode:<br />from my desktop after switching:<br /></p><div class="codebox"><pre><code>lsusb
Bus 004 Device 017: ID 12d1:1001 Huawei Technologies Co., Ltd. E169/E620/E800 HSDPA Modem</code></pre></div><br /><p>Doesn&#039;t help for openwrt:<br /></p><div class="codebox"><pre><code>[ 1727.990000] usb 1-1: new high-speed USB device number 12 using ehci-platform
[ 1728.140000] option 1-1:1.0: GSM modem (1-port) converter detected
[ 1728.150000] usb 1-1: GSM modem (1-port) converter now attached to ttyUSB0
[ 1728.150000] option 1-1:1.1: GSM modem (1-port) converter detected
[ 1728.160000] usb 1-1: GSM modem (1-port) converter now attached to ttyUSB1
[ 1728.170000] option 1-1:1.2: GSM modem (1-port) converter detected
[ 1728.170000] usb 1-1: GSM modem (1-port) converter now attached to ttyUSB2
[ 1734.920000] usb 1-1: USB disconnect, device number 12
[ 1734.930000] option: option_instat_callback: error -143
[ 1734.930000] option1 ttyUSB0: GSM modem (1-port) converter now disconnected from ttyUSB0
[ 1734.940000] option 1-1:1.0: device disconnected
[ 1734.950000] option1 ttyUSB1: GSM modem (1-port) converter now disconnected from ttyUSB1
[ 1734.950000] option 1-1:1.1: device disconnected
[ 1734.960000] option1 ttyUSB2: GSM modem (1-port) converter now disconnected from ttyUSB2
[ 1734.970000] option 1-1:1.2: device disconnected
[ 1735.250000] usb 1-1: new high-speed USB device number 13 using ehci-platform
[ 1735.410000] hub 1-0:1.0: unable to enumerate USB device on port 1
root@OpenWrt:~# lsusb
Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub</code></pre></div>											<p class="post-edited">(Last edited by <strong>mesb</strong> on 31 Dec 2012, 11:01)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p188162">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">mesb</div>
					<div class="post-datetime">
						7 Jan 2013, 11:35					</div>
				</div>
				<div class="post-content content">
					<p>Well. ticket was created:<br /><a href="https://dev.openwrt.org/ticket/12760">https://dev.openwrt.org/ticket/12760</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p188167">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">robthebrew</div>
					<div class="post-datetime">
						7 Jan 2013, 12:24					</div>
				</div>
				<div class="post-content content">
					<p>There are similar older tickets, see<br /><a href="https://dev.openwrt.org/ticket/12008">https://dev.openwrt.org/ticket/12008</a><br />and<br /><a href="https://dev.openwrt.org/ticket/11554">https://dev.openwrt.org/ticket/11554</a></p><p>Here is an interesting thread:<br /><a href="http://www.dd-wrt.com/phpBB2/viewtopic.php?t=139167">http://www.dd-wrt.com/phpBB2/viewtopic.php?t=139167</a><br />I know it is ddwrt, but you could try the solution there.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p188702">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">mesb</div>
					<div class="post-datetime">
						12 Jan 2013, 20:43					</div>
				</div>
				<div class="post-content content">
					<p>Some workaround:<br />Putting small passive usb hub between router and dongle looks like solve problem.</p><div class="codebox"><pre><code>[    9.240000] ieee80211 phy0: Selected rate control algorithm &#039;minstrel_ht&#039;
[    9.240000] Registered led device: ath9k-phy0
[    9.240000] ieee80211 phy0: Atheros AR9330 Rev:1 mem=0xb8100000, irq=2
[    9.250000] cfg80211: Calling CRDA for country: US
[    9.250000] cfg80211: Regulatory domain changed to country: US
[    9.260000] cfg80211:   (start_freq - end_freq @ bandwidth), (max_antenna_gain, max_eirp)
[    9.270000] cfg80211:   (2402000 KHz - 2472000 KHz @ 40000 KHz), (300 mBi, 2700 mBm)
[    9.280000] cfg80211:   (5170000 KHz - 5250000 KHz @ 40000 KHz), (300 mBi, 1700 mBm)
[    9.280000] cfg80211:   (5250000 KHz - 5330000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)
[    9.290000] cfg80211:   (5490000 KHz - 5600000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)
[    9.300000] cfg80211:   (5650000 KHz - 5710000 KHz @ 40000 KHz), (300 mBi, 2000 mBm)
[    9.310000] cfg80211:   (5735000 KHz - 5835000 KHz @ 40000 KHz), (300 mBi, 3000 mBm)
[    9.380000] PPP generic driver version 2.4.2
[    9.630000] ip_tables: (C) 2000-2006 Netfilter Core Team
[    9.850000] NET: Registered protocol family 24
[    9.870000] ehci_hcd: USB 2.0 &#039;Enhanced&#039; Host Controller (EHCI) Driver
[    9.880000] ehci-platform ehci-platform: Generic Platform EHCI Controller
[    9.880000] ehci-platform ehci-platform: new USB bus registered, assigned bus number 1
[    9.920000] ehci-platform ehci-platform: irq 3, io mem 0x1b000000
[    9.940000] ehci-platform ehci-platform: USB 2.0 started, EHCI 1.00
[    9.940000] hub 1-0:1.0: USB hub found
[    9.940000] hub 1-0:1.0: 1 port detected
[    9.970000] nf_conntrack version 0.5.0 (456 buckets, 1824 max)
[   10.230000] uhci_hcd: USB Universal Host Controller Interface driver
[   10.300000] usb 1-1: new high-speed USB device number 2 using ehci-platform
[   10.390000] usbcore: registered new interface driver usbserial
[   10.390000] USB Serial support registered for generic
[   10.510000] hub 1-1:1.0: USB hub found
[   10.510000] hub 1-1:1.0: 4 ports detected
[   10.510000] usbcore: registered new interface driver usbserial_generic
[   10.520000] usbserial: USB Serial Driver core
[   10.550000] usbcore: registered new interface driver asix
[   10.570000] usbcore: registered new interface driver cdc_ether
[   10.610000] usbcore: registered new interface driver rndis_host
[   10.650000] USB Serial support registered for GSM modem (1-port)
[   10.650000] usbcore: registered new interface driver option
[   10.660000] option: v0.7.2:USB Driver for GSM modems
[   10.790000] usb 1-1.3: new high-speed USB device number 3 using ehci-platform
[   10.920000] option 1-1.3:1.0: GSM modem (1-port) converter detected
[   10.930000] usb 1-1.3: GSM modem (1-port) converter now attached to ttyUSB0
[   10.930000] option 1-1.3:1.1: GSM modem (1-port) converter detected
[   10.940000] usb 1-1.3: GSM modem (1-port) converter now attached to ttyUSB1
[   10.950000] option 1-1.3:1.2: GSM modem (1-port) converter detected
[   10.950000] usb 1-1.3: GSM modem (1-port) converter now attached to ttyUSB2
[   13.910000] device eth0 entered promiscuous mode
[   14.270000] eth0: link up (100Mbps/Full duplex)
[   14.270000] br-lan: port 1(eth0) entered forwarding state
[   14.280000] br-lan: port 1(eth0) entered forwarding state
[   16.280000] br-lan: port 1(eth0) entered forwarding state</code></pre></div>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>