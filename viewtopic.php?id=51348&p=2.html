<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> OpenWRT on BT Home Hub 2A</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 31 Mar 2018 and 16 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 2 of 2</div><nav><ul><li><a href="viewtopic.php%3Fid=51348&amp;p=1.html">1</a></li><li class="pagination-current"><span>2</span></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p316195">
				<div class="post-metadata">
					<div class="post-num">Post #26</div>
					<div class="post-author">zx82</div>
					<div class="post-datetime">
						22 Mar 2016, 22:43					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>gomme600 wrote:</cite><blockquote><p>Anyway I have done a backup of the same CUSTOM.BIN, here is the file: <a href="http://www.mediafire.com/download/qad3jf4ce1uzjng/CUSTOM_BACKUP.BIN">http://www.mediafire.com/download/qad3j … BACKUP.BIN</a></p></blockquote></div><p>So when I compare that to 906cebfc82efc881ea16f0f3501ba82b, it&#039;s almost identical except for six places.&nbsp; In every one of them, you have 0xffff where I have something else.&nbsp; (At least this tells you it&#039;s <em>roughly</em> flashing the correct file!&nbsp; Also, maybe yours takes less time than mine because <span class="bbu">/nodma</span> slows my flashing down.)&nbsp; Possibilities:<br /></p><ul><li><p>there are glitches during your flashing (maybe try slowing it down with <span class="bbu">/delay:20</span> ? maybe fight harder to get <span class="bbu">/nodma</span> working, just for the side-effect of slow-but-sure flashing?)</p></li><li><p>you&#039;re flashing just fine, but you&#039;re somehow getting errors reading back; in this case, reading multiple times seems likely to give different results; try doing it a bunch of times and seeing whether the md5sum of the backup varies</p></li><li><p>the flash on your unit is faulty and is incapable of writing data at those six locations; once you&#039;ve done your best to eliminate write errors and read errors, you could test for this by writing a file of plain zeroes and seeing whether the read comes back with&nbsp; contains anything else</p></li></ul><div class="quotebox"><cite>gomme600 wrote:</cite><blockquote><p>I get nothing on the serial port still. This all seems very strange to me.</p></blockquote></div><p>The first thing CFE does is decompress the bootloader.&nbsp; If the CPU is really seeing those 0xffff and if they lie in the compressed data, CFE would either detect that during decompression and die, or decompress some garbage and try to run it (and die).&nbsp; Some bootloaders at least announce what they&#039;re doing before they try it, but from the look of the logs on the wiki it seems this CFE doesn&#039;t, so you may just see nothing.&nbsp; But we should also consider the possibility that your serial port connection is dodgy, unless you ruled that out earlier?</p><div class="quotebox"><cite>gomme600 wrote:</cite><blockquote><p>It is 128KB instead of 62KB, again I don&#039;t understand?</p></blockquote></div><p>That&#039;s because we&#039;re using <span class="bbu">/length:20000</span>.&nbsp; That&#039;s bigger than it needs to be.&nbsp; It doesn&#039;t do any harm.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p316306">
				<div class="post-metadata">
					<div class="post-num">Post #27</div>
					<div class="post-author">gomme600</div>
					<div class="post-datetime">
						23 Mar 2016, 16:34					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>zx82 wrote:</cite><blockquote><div class="quotebox"><cite>gomme600 wrote:</cite><blockquote><p>Anyway I have done a backup of the same CUSTOM.BIN, here is the file: <a href="http://www.mediafire.com/download/qad3jf4ce1uzjng/CUSTOM_BACKUP.BIN">http://www.mediafire.com/download/qad3j … BACKUP.BIN</a></p></blockquote></div><p>So when I compare that to 906cebfc82efc881ea16f0f3501ba82b, it&#039;s almost identical except for six places.&nbsp; In every one of them, you have 0xffff where I have something else.&nbsp; (At least this tells you it&#039;s <em>roughly</em> flashing the correct file!&nbsp; Also, maybe yours takes less time than mine because <span class="bbu">/nodma</span> slows my flashing down.)&nbsp; Possibilities:<br /></p><ul><li><p>there are glitches during your flashing (maybe try slowing it down with <span class="bbu">/delay:20</span> ? maybe fight harder to get <span class="bbu">/nodma</span> working, just for the side-effect of slow-but-sure flashing?)</p></li><li><p>you&#039;re flashing just fine, but you&#039;re somehow getting errors reading back; in this case, reading multiple times seems likely to give different results; try doing it a bunch of times and seeing whether the md5sum of the backup varies</p></li><li><p>the flash on your unit is faulty and is incapable of writing data at those six locations; once you&#039;ve done your best to eliminate write errors and read errors, you could test for this by writing a file of plain zeroes and seeing whether the read comes back with&nbsp; contains anything else</p></li></ul><div class="quotebox"><cite>gomme600 wrote:</cite><blockquote><p>I get nothing on the serial port still. This all seems very strange to me.</p></blockquote></div><p>The first thing CFE does is decompress the bootloader.&nbsp; If the CPU is really seeing those 0xffff and if they lie in the compressed data, CFE would either detect that during decompression and die, or decompress some garbage and try to run it (and die).&nbsp; Some bootloaders at least announce what they&#039;re doing before they try it, but from the look of the logs on the wiki it seems this CFE doesn&#039;t, so you may just see nothing.&nbsp; But we should also consider the possibility that your serial port connection is dodgy, unless you ruled that out earlier?</p><div class="quotebox"><cite>gomme600 wrote:</cite><blockquote><p>It is 128KB instead of 62KB, again I don&#039;t understand?</p></blockquote></div><p>That&#039;s because we&#039;re using <span class="bbu">/length:20000</span>.&nbsp; That&#039;s bigger than it needs to be.&nbsp; It doesn&#039;t do any harm.</p></blockquote></div><p>Hi again. This is the file I get with /delay:20. It&#039;s much better but not perfect (Increasing the delay gives the same results): <a href="http://www.mediafire.com/download/2402k3ga3cy2ett/CUSTOM.BIN.SAVED_20160323_142008">http://www.mediafire.com/download/2402k … 323_142008</a></p><p>Still can&#039;t get it to boot. I will try playing around with it a bit more but I don&#039;t really know where to go from here then... Your suggestion of writing zeros to test sounds good but I don&#039;t know too much about hex editors, should I just fill a .bin file with zeros in the editor?</p><p>Thanks for the help!</p><p><strong>EDIT:</strong></p><p>Empty file came back good as far as I can see: <a href="http://www.mediafire.com/download/m21nt3hwvjbrc0s/CUSTOM.BIN.SAVED_20160323_145030">http://www.mediafire.com/download/m21nt … 323_145030</a></p><p>I suppose this suggestes that my flash chip is fine then?</p><p><strong>EDIT2:</strong></p><p>It appears that the new file with delay:20 is actually the same, my hex editor said is wasen&#039;t but it&#039;s beacause of it missing 4 zeros at the end maybe? Anyway I think it&#039;s the same. So it appears to be flashing correctly, what am I missing? Any buttons I should be pressing? I have tried the &quot;find handset&quot; button so far.</p>											<p class="post-edited">(Last edited by <strong>gomme600</strong> on 23 Mar 2016, 17:04)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p316352">
				<div class="post-metadata">
					<div class="post-num">Post #28</div>
					<div class="post-author">zx82</div>
					<div class="post-datetime">
						23 Mar 2016, 20:58					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>gomme600 wrote:</cite><blockquote><p>Hi again. This is the file I get with /delay:20. [...] Anyway I think it&#039;s the same. So it appears to be flashing correctly,</p></blockquote></div><p>I agree, matches now.</p><div class="quotebox"><cite>gomme600 wrote:</cite><blockquote><p>what am I missing? Any buttons I should be pressing? I have tried the &quot;find handset&quot; button so far.</p></blockquote></div><p>If you have working serial access, buttons aren&#039;t strictly necessary and you&#039;d certainly see serial output without having to do anything at all.&nbsp; What should happen is that CFE should (loudly) fail to detect any valid firmware, then sit at a prompt waiting for input while offering HTTP and/or TFTP access.&nbsp; Likely possibilities:</p><ul><li><p>It&#039;s flashed OK, but your serial access is faulty.&nbsp; When you established serial access, did you test it?&nbsp; As in, did you watch the stock firmware produce output?&nbsp; Input needs to work too; did you ever interact with the stock bootloader or a login prompt on the serial console?&nbsp; Check continuity between your TX/RX pins and the corresponding solder bridges you added nearby, and check ground against something convenient nearby (maybe the big metal can over the WiFi).&nbsp; Check that you have TX and RX the right way around (you could just use a multimeter on the pins while sending something using your serial software, and see if the voltage changes).&nbsp; But even if it&#039;s working and you just can&#039;t see it owing to serial malfunction, you should at least be able to ping it at 192.168.1.1 by now.</p></li><li><p>It&#039;s flashed OK, but the image is somehow incompatible with the unit.&nbsp; There&#039;s a (slim) chance my CFE doesn&#039;t work on Spansion units, so now that you&#039;re more confident that flashing is intact, maybe it&#039;s worth trying danitool&#039;s original CFE again.&nbsp; I think you need the swapped <a href="https://mega.nz/#!9VA0TR7A!P0UjuzdstaqQ1HoWM-Zp4mbzbrNaqdiYXroC1aSYHQA">version I posted above</a> (md5sum 7f7dcd973ada548d1ebcd9cbcaec17c8), but...</p></li><li><p>It&#039;s flashed OK, but somehow I&#039;m totally wrong about the byteswapping thing.&nbsp; If that&#039;s the case, <a href="https://drive.google.com/uc?export=download&amp;id=0B-EMoBe-_OdBU0E3YW9VM1JWV2s">danitool&#039;s original Spansion-only image</a> or my <a href="https://mega.co.nz/#!0dBGXYDD!a5FwQ8_-UMiuZDcR9h1pr1t8SmacK_FpdVtKbfFl98k">unswapped ST-compatible version</a> would work (now that flashing issues seem to be fixed).</p></li><li><p>It&#039;s flashed OK, but something else on the unit is hosed, or the CPU is being held in reset.&nbsp; Maybe you could tell by getting OpenOCD attached to it, but I&#039;ve not yet had to do that on a unit and can&#039;t help.</p></li></ul>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p316530">
				<div class="post-metadata">
					<div class="post-num">Post #29</div>
					<div class="post-author">gomme600</div>
					<div class="post-datetime">
						24 Mar 2016, 21:13					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>zx82 wrote:</cite><blockquote><div class="quotebox"><cite>gomme600 wrote:</cite><blockquote><p>Hi again. This is the file I get with /delay:20. [...] Anyway I think it&#039;s the same. So it appears to be flashing correctly,</p></blockquote></div><p>I agree, matches now.</p><div class="quotebox"><cite>gomme600 wrote:</cite><blockquote><p>what am I missing? Any buttons I should be pressing? I have tried the &quot;find handset&quot; button so far.</p></blockquote></div><p>If you have working serial access, buttons aren&#039;t strictly necessary and you&#039;d certainly see serial output without having to do anything at all.&nbsp; What should happen is that CFE should (loudly) fail to detect any valid firmware, then sit at a prompt waiting for input while offering HTTP and/or TFTP access.&nbsp; Likely possibilities:</p><ul><li><p>It&#039;s flashed OK, but your serial access is faulty.&nbsp; When you established serial access, did you test it?&nbsp; As in, did you watch the stock firmware produce output?&nbsp; Input needs to work too; did you ever interact with the stock bootloader or a login prompt on the serial console?&nbsp; Check continuity between your TX/RX pins and the corresponding solder bridges you added nearby, and check ground against something convenient nearby (maybe the big metal can over the WiFi).&nbsp; Check that you have TX and RX the right way around (you could just use a multimeter on the pins while sending something using your serial software, and see if the voltage changes).&nbsp; But even if it&#039;s working and you just can&#039;t see it owing to serial malfunction, you should at least be able to ping it at 192.168.1.1 by now.</p></li><li><p>It&#039;s flashed OK, but the image is somehow incompatible with the unit.&nbsp; There&#039;s a (slim) chance my CFE doesn&#039;t work on Spansion units, so now that you&#039;re more confident that flashing is intact, maybe it&#039;s worth trying danitool&#039;s original CFE again.&nbsp; I think you need the swapped <a href="https://mega.nz/#!9VA0TR7A!P0UjuzdstaqQ1HoWM-Zp4mbzbrNaqdiYXroC1aSYHQA">version I posted above</a> (md5sum 7f7dcd973ada548d1ebcd9cbcaec17c8), but...</p></li><li><p>It&#039;s flashed OK, but somehow I&#039;m totally wrong about the byteswapping thing.&nbsp; If that&#039;s the case, <a href="https://drive.google.com/uc?export=download&amp;id=0B-EMoBe-_OdBU0E3YW9VM1JWV2s">danitool&#039;s original Spansion-only image</a> or my <a href="https://mega.co.nz/#!0dBGXYDD!a5FwQ8_-UMiuZDcR9h1pr1t8SmacK_FpdVtKbfFl98k">unswapped ST-compatible version</a> would work (now that flashing issues seem to be fixed).</p></li><li><p>It&#039;s flashed OK, but something else on the unit is hosed, or the CPU is being held in reset.&nbsp; Maybe you could tell by getting OpenOCD attached to it, but I&#039;ve not yet had to do that on a unit and can&#039;t help.</p></li></ul></blockquote></div><p>Unfortunately I only tried connecting serial after flashing CFE so I have never seen it working. Also, ethernet doesn&#039;t work at all, since flashing CFE the activity lights on my computer don&#039;t even flash, nothing at all...</p><p>I have tried the various images you have provided, I can try more combinations when I have some more time to spare but I don&#039;t think I am going to get it to work somehow...<br />Do you think we can try a wholeflash now? As we know it&#039;s flashing correctly we could try a normal and a byteswapped wholeflash (If you have one handy and it doesn&#039;t bother you that is).</p><p>I would love to try OpenOCD, I tried setting it up when you mentioned it the other day but couldn&#039;t get it working, don&#039;t really know how to get it to ise the pi&#039;s gpio pins! So I would prefer to stay away from it if possible.</p><p>Thanks again for the help so far!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p316535">
				<div class="post-metadata">
					<div class="post-num">Post #30</div>
					<div class="post-author">danitool</div>
					<div class="post-datetime">
						24 Mar 2016, 21:34					</div>
				</div>
				<div class="post-content content">
					<p>Hi, I did the byte swap with an utility that worked for me long time ago with the old hairydairymaid.</p><p>No idea if the byte swapping is the same as made by zx82. BTW here you have if you want to test it:</p><p><a href="https://drive.google.com/file/d/0B-EMoBe-_OdBSE1FbzhBYWdNbHM/view?usp=sharing">https://drive.google.com/file/d/0B-EMoB … sp=sharing</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p316540">
				<div class="post-metadata">
					<div class="post-num">Post #31</div>
					<div class="post-author">gomme600</div>
					<div class="post-datetime">
						24 Mar 2016, 22:28					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>danitool wrote:</cite><blockquote><p>Hi, I did the byte swap with an utility that worked for me long time ago with the old hairydairymaid.</p><p>No idea if the byte swapping is the same as made by zx82. BTW here you have if you want to test it:</p><p><a href="https://drive.google.com/file/d/0B-EMoBe-_OdBSE1FbzhBYWdNbHM/view?usp=sharing">https://drive.google.com/file/d/0B-EMoB … sp=sharing</a></p></blockquote></div><p>Hi, thanks for the file! It&#039;s the same as zx82&#039;s (same md5sum and checked in a hex editor), tried flashing it anyway and it still doesn&#039;t work. I feel like we are running out of options... Do you have any ideas? Anything zx82 might not of thought of?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p316564">
				<div class="post-metadata">
					<div class="post-num">Post #32</div>
					<div class="post-author">zx82</div>
					<div class="post-datetime">
						25 Mar 2016, 02:01					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>gomme600 wrote:</cite><blockquote><p>Do you think we can try a wholeflash now? As we know it&#039;s flashing correctly we could try a normal and a byteswapped wholeflash (If you have one handy and it doesn&#039;t bother you that is).</p></blockquote></div><p>I can make you a full image of a freshly installed unit containing the ST-and-Spansion-compatible CFE and 15.05.&nbsp; I&#039;ll try to sort that out tomorrow.&nbsp; Although...</p><div class="quotebox"><cite>gomme600 wrote:</cite><blockquote><p>Also, ethernet doesn&#039;t work at all, since flashing CFE the activity lights on my computer don&#039;t even flash, nothing at all</p></blockquote></div><p>...if you&#039;re not even getting a link heartbeat light and can&#039;t ping the unit then it doesn&#039;t sound like CFE is ever running, and I don&#039;t see that anything will change with the whole-flash image.&nbsp; (I&#039;ll still make it for you though.)</p><div class="quotebox"><cite>gomme600 wrote:</cite><blockquote><p>I only tried connecting serial after flashing CFE so I have never seen it working.</p></blockquote></div><p>But it passes those continuity tests, right?&nbsp; And you&#039;ve checked that TX/RX aren&#039;t bridged together or anything?&nbsp; Sorry to keep going on about the serial access but since it&#039;s so useful for debug when working, it seems worth exhausting all possibilities there.</p><p>Sorry that this unit is fighting you.&nbsp; If it won&#039;t boot with the whole-flash either, one last thing before OpenOCD might be to try restoring your broken backup and then restoring the stock CFE over the top, hopefully giving you exactly what you started with.&nbsp; I <em>think</em> I have a copy of the CFE my Spansion unit came with, which I could upload.&nbsp; But that does sort of assume that your backup doesn&#039;t have any 0xffff artefacts from glitchy reads.</p>											<p class="post-edited">(Last edited by <strong>zx82</strong> on 25 Mar 2016, 02:01)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p316676">
				<div class="post-metadata">
					<div class="post-num">Post #33</div>
					<div class="post-author">gomme600</div>
					<div class="post-datetime">
						25 Mar 2016, 20:49					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>zx82 wrote:</cite><blockquote><div class="quotebox"><cite>gomme600 wrote:</cite><blockquote><p>Do you think we can try a wholeflash now? As we know it&#039;s flashing correctly we could try a normal and a byteswapped wholeflash (If you have one handy and it doesn&#039;t bother you that is).</p></blockquote></div><p>I can make you a full image of a freshly installed unit containing the ST-and-Spansion-compatible CFE and 15.05.&nbsp; I&#039;ll try to sort that out tomorrow.&nbsp; Although...</p><div class="quotebox"><cite>gomme600 wrote:</cite><blockquote><p>Also, ethernet doesn&#039;t work at all, since flashing CFE the activity lights on my computer don&#039;t even flash, nothing at all</p></blockquote></div><p>...if you&#039;re not even getting a link heartbeat light and can&#039;t ping the unit then it doesn&#039;t sound like CFE is ever running, and I don&#039;t see that anything will change with the whole-flash image.&nbsp; (I&#039;ll still make it for you though.)</p><div class="quotebox"><cite>gomme600 wrote:</cite><blockquote><p>I only tried connecting serial after flashing CFE so I have never seen it working.</p></blockquote></div><p>But it passes those continuity tests, right?&nbsp; And you&#039;ve checked that TX/RX aren&#039;t bridged together or anything?&nbsp; Sorry to keep going on about the serial access but since it&#039;s so useful for debug when working, it seems worth exhausting all possibilities there.</p><p>Sorry that this unit is fighting you.&nbsp; If it won&#039;t boot with the whole-flash either, one last thing before OpenOCD might be to try restoring your broken backup and then restoring the stock CFE over the top, hopefully giving you exactly what you started with.&nbsp; I <em>think</em> I have a copy of the CFE my Spansion unit came with, which I could upload.&nbsp; But that does sort of assume that your backup doesn&#039;t have any 0xffff artefacts from glitchy reads.</p></blockquote></div><p>Thanks for the wholeflash. I think anything is worth trying at the moment. Serial is weird, RX an TX on the unit both mesure 3.3 volts. I would have thought that RX would be 0v... I have bridged the two resistor pads under the board like shown on the wiki. I have an oscilloscope aswell but that didn&#039;t show anything from the unit. It did from the pc though. Laslty we agree that the unit&#039;s RX (marked on the wiki photo) goes to my serial adapters TX yes?</p><p>If the wholeflash doesn&#039;t work I would like to try your last suggestion, trying stock firmware is always a good test. I can also try using a pc serial port if this all doesn&#039;t work, it will be a bit of a pain but it will prove that the pi isn&#039;t at fault!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p317395">
				<div class="post-metadata">
					<div class="post-num">Post #34</div>
					<div class="post-author">gomme600</div>
					<div class="post-datetime">
						30 Mar 2016, 19:23					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>zx82 wrote:</cite><blockquote><div class="quotebox"><cite>gomme600 wrote:</cite><blockquote><p>Do you think we can try a wholeflash now? As we know it&#039;s flashing correctly we could try a normal and a byteswapped wholeflash (If you have one handy and it doesn&#039;t bother you that is).</p></blockquote></div><p>I can make you a full image of a freshly installed unit containing the ST-and-Spansion-compatible CFE and 15.05.&nbsp; I&#039;ll try to sort that out tomorrow.&nbsp; Although...</p><div class="quotebox"><cite>gomme600 wrote:</cite><blockquote><p>Also, ethernet doesn&#039;t work at all, since flashing CFE the activity lights on my computer don&#039;t even flash, nothing at all</p></blockquote></div><p>...if you&#039;re not even getting a link heartbeat light and can&#039;t ping the unit then it doesn&#039;t sound like CFE is ever running, and I don&#039;t see that anything will change with the whole-flash image.&nbsp; (I&#039;ll still make it for you though.)</p><div class="quotebox"><cite>gomme600 wrote:</cite><blockquote><p>I only tried connecting serial after flashing CFE so I have never seen it working.</p></blockquote></div><p>But it passes those continuity tests, right?&nbsp; And you&#039;ve checked that TX/RX aren&#039;t bridged together or anything?&nbsp; Sorry to keep going on about the serial access but since it&#039;s so useful for debug when working, it seems worth exhausting all possibilities there.</p><p>Sorry that this unit is fighting you.&nbsp; If it won&#039;t boot with the whole-flash either, one last thing before OpenOCD might be to try restoring your broken backup and then restoring the stock CFE over the top, hopefully giving you exactly what you started with.&nbsp; I <em>think</em> I have a copy of the CFE my Spansion unit came with, which I could upload.&nbsp; But that does sort of assume that your backup doesn&#039;t have any 0xffff artefacts from glitchy reads.</p></blockquote></div><p>Hi. Not meaning to bug you, just wondered how you were doing with making the wholeflashes?<br />Happy late easter.<br />Thanks again!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p317797">
				<div class="post-metadata">
					<div class="post-num">Post #35</div>
					<div class="post-author">zx82</div>
					<div class="post-datetime">
						2 Apr 2016, 12:17					</div>
				</div>
				<div class="post-content content">
					<p>(off-forum)<br /></p><div class="quotebox"><cite>gomme600 wrote:</cite><blockquote><p>getting stuck at &quot;Erasing block: 81 (addr=1fa00000) ... I don&#039;t suppose theres a way to skip erasing this block is there?</p></blockquote></div><p>Flash is 16MiB i.e. 0x1000000 bytes. It&#039;s mapped in the BCM6358&#039;s memory at 0x1e000000. If you flash the whole 16MiB file (unzipped wholeflash) you should only be flashing 0x1e000000 through 0x1effffff (inclusive), so 0x1fa00000 is out of bounds. Are you giving tjtag a <span class="bbu">/length</span> for this write, or letting it work that out itself?&nbsp; If it&#039;s autodetecting and getting it wrong, you could just override it with <span class="bbu">/flash:custom /window:1e000000 /start:1e000000 /length:1000000</span>.</p>											<p class="post-edited">(Last edited by <strong>zx82</strong> on 2 Apr 2016, 12:18)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p317802">
				<div class="post-metadata">
					<div class="post-num">Post #36</div>
					<div class="post-author">gomme600</div>
					<div class="post-datetime">
						2 Apr 2016, 13:09					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>zx82 wrote:</cite><blockquote><p>(off-forum)<br /></p><div class="quotebox"><cite>gomme600 wrote:</cite><blockquote><p>getting stuck at &quot;Erasing block: 81 (addr=1fa00000) ... I don&#039;t suppose theres a way to skip erasing this block is there?</p></blockquote></div><p>Flash is 16MiB i.e. 0x1000000 bytes. It&#039;s mapped in the BCM6358&#039;s memory at 0x1e000000. If you flash the whole 16MiB file (unzipped wholeflash) you should only be flashing 0x1e000000 through 0x1effffff (inclusive), so 0x1fa00000 is out of bounds. Are you giving tjtag a <span class="bbu">/length</span> for this write, or letting it work that out itself?&nbsp; If it&#039;s autodetecting and getting it wrong, you could just override it with <span class="bbu">/flash:custom /window:1e000000 /start:1e000000 /length:1000000</span>.</p></blockquote></div><p>Ok! That worked, erasing went perfectly! I guess the base configuration is based on hairydairymaid&#039;s original version for the WRT54 so we have to use -flash:custom for other routers. It&#039;s taking a while a expected, I&#039;ll tell you the outcome!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p317813">
				<div class="post-metadata">
					<div class="post-num">Post #37</div>
					<div class="post-author">gomme600</div>
					<div class="post-datetime">
						2 Apr 2016, 14:30					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>zx82 wrote:</cite><blockquote><p>(off-forum)<br /></p><div class="quotebox"><cite>gomme600 wrote:</cite><blockquote><p>getting stuck at &quot;Erasing block: 81 (addr=1fa00000) ... I don&#039;t suppose theres a way to skip erasing this block is there?</p></blockquote></div><p>Flash is 16MiB i.e. 0x1000000 bytes. It&#039;s mapped in the BCM6358&#039;s memory at 0x1e000000. If you flash the whole 16MiB file (unzipped wholeflash) you should only be flashing 0x1e000000 through 0x1effffff (inclusive), so 0x1fa00000 is out of bounds. Are you giving tjtag a <span class="bbu">/length</span> for this write, or letting it work that out itself?&nbsp; If it&#039;s autodetecting and getting it wrong, you could just override it with <span class="bbu">/flash:custom /window:1e000000 /start:1e000000 /length:1000000</span>.</p></blockquote></div><p>Ok. So it flashed ok. I am going out this afternoon so I haven&#039;t got time to check serial at the moment (laptop already packed). It doesn&#039;t appear to have worked though... No activity on the ethernet port and all lights stay solid blue/purple (As you gave me a wholeflash I assume it should have booted and therefore the leds should have changed state). I don&#039;t suppose you have a stock wholeflash to try, maybe my unit just isn&#039;t getting along with the modified CFE...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p317856">
				<div class="post-metadata">
					<div class="post-num">Post #38</div>
					<div class="post-author">gomme600</div>
					<div class="post-datetime">
						2 Apr 2016, 21:47					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>zx82 wrote:</cite><blockquote><p>(off-forum)<br /></p><div class="quotebox"><cite>gomme600 wrote:</cite><blockquote><p>getting stuck at &quot;Erasing block: 81 (addr=1fa00000) ... I don&#039;t suppose theres a way to skip erasing this block is there?</p></blockquote></div><p>Flash is 16MiB i.e. 0x1000000 bytes. It&#039;s mapped in the BCM6358&#039;s memory at 0x1e000000. If you flash the whole 16MiB file (unzipped wholeflash) you should only be flashing 0x1e000000 through 0x1effffff (inclusive), so 0x1fa00000 is out of bounds. Are you giving tjtag a <span class="bbu">/length</span> for this write, or letting it work that out itself?&nbsp; If it&#039;s autodetecting and getting it wrong, you could just override it with <span class="bbu">/flash:custom /window:1e000000 /start:1e000000 /length:1000000</span>.</p></blockquote></div><p>Well I believe that my serial port might be shorted. I am getting about 600 ohms between the pins... Could you check incase this is normal please ? I don&#039;t think it is but I&#039;m no expert. It could just explain why it won&#039;t boot. And also why I was getting 3.3V on the RX pin. The problem is I can&#039;t see a short anywhere!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p317867">
				<div class="post-metadata">
					<div class="post-num">Post #39</div>
					<div class="post-author">zx82</div>
					<div class="post-datetime">
						2 Apr 2016, 22:33					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>gomme600 wrote:</cite><blockquote><p>Well I believe that my serial port might be shorted. I am getting about 600 ohms between the pins... Could you check incase this is normal please?</p></blockquote></div><p>Between RX and TX?&nbsp; No, I see something in the low megaohms.&nbsp; Between either data pin and ground, 600k.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p317875">
				<div class="post-metadata">
					<div class="post-num">Post #40</div>
					<div class="post-author">gomme600</div>
					<div class="post-datetime">
						2 Apr 2016, 23:31					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>zx82 wrote:</cite><blockquote><div class="quotebox"><cite>gomme600 wrote:</cite><blockquote><p>Well I believe that my serial port might be shorted. I am getting about 600 ohms between the pins... Could you check incase this is normal please?</p></blockquote></div><p>Between RX and TX?&nbsp; No, I see something in the low megaohms.&nbsp; Between either data pin and ground, 600k.</p></blockquote></div><p>Ok. I have 1200 ohms between Rx and Tx. Thats not normal then. Low megaohms would be a lot more unless you meant kilohms. Do you also have 3.3V on Rx?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p317956">
				<div class="post-metadata">
					<div class="post-num">Post #41</div>
					<div class="post-author">gomme600</div>
					<div class="post-datetime">
						3 Apr 2016, 14:09					</div>
				</div>
				<div class="post-content content">
					<p>I can&#039;t believe it!!! It works!!! I decided to make a parallele port cable today (The one with the 4 resistors), flashed the normal CFE on the wiki page using zjtag. (It took 171 seconds, a lot longer than the pi). Unplugged it, plugged it back in and I got serial output in TeraTerm! (I was using TeraTerm instead of minicom as I was on an XP box for the parallele port).<br />This is the command I used for anyone wondering: <strong>zjtag -flash:custom /window:1e000000 /start:1e000000 /length:20000 /cable:4 /BE</strong></p><p>So it turns out that the raspberry pi was the issue the whole time, the old methods work best! Thanks zx82 for all the help and for your time!! Just need to install the image now but the most important part is working!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p317959">
				<div class="post-metadata">
					<div class="post-num">Post #42</div>
					<div class="post-author">zx82</div>
					<div class="post-datetime">
						3 Apr 2016, 14:20					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>gomme600 wrote:</cite><blockquote><p>I can&#039;t believe it!!! It works!!! I decided to make a parallele port cable today...</p></blockquote></div><p>You still have a machine with a parallel port?!?&nbsp; Excellent <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><div class="quotebox"><cite>gomme600 wrote:</cite><blockquote><p>flashed the normal CFE on the wiki page using zjtag.</p></blockquote></div><p>It&#039;d be really helpful if you could try the anyflash CFE, so we can know for sure that one CFE will work on either type of flash seen in these units.</p><div class="quotebox"><cite>gomme600 wrote:</cite><blockquote><p>So it turns out that the raspberry pi was the issue the whole time, the old methods work best!</p></blockquote></div><p>I&#039;ll add a note to the wiki page, but I don&#039;t consider this mystery solved, since 1) RPi worked fine for me on both flash types/both units; 2) you flashed an image and successfully read it back intact.&nbsp; Still, zjtag is supposed to be dedicated to Broadcom&#039;s stuff, so I guess it should be the default choice.&nbsp; Shame there&#039;s no GPIO support; while RPis aren&#039;t exactly great hardware they are ubiquitous and (in RPi Zero form) dirt cheap.</p><div class="quotebox"><cite>gomme600 wrote:</cite><blockquote><p>Just need to install the image now but the most important part is working!</p></blockquote></div><p>Don&#039;t forget you can use the web interface for that bit.&nbsp; Easier and quicker.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p317965">
				<div class="post-metadata">
					<div class="post-num">Post #43</div>
					<div class="post-author">danitool</div>
					<div class="post-datetime">
						3 Apr 2016, 14:47					</div>
				</div>
				<div class="post-content content">
					<p>Hi, it would be nice having only one bootloader known to work on all flash chips. It can be a more solid info if we add only one CFE link to the wiki. A nice feauter could also be if the bootloader had the leds working properly, like some blinking led while loading or a power led on and the rest off. This way one could know if the CFE is alive without the serial console.</p><p>Some time ago btsimonh reported an issue with the reset/phone button for entering CFE failsafe:<br /><a href="http://openwrt.ebilan.co.uk/viewtopic.php?f=17&amp;t=80&amp;p=763#p762">http://openwrt.ebilan.co.uk/viewtopic.p … p=763#p762</a><br />No idea if this problem is really true, or if does it happen randonmly. Might be a better idea to use the reset button insead phone button. Initially the phone button was used because it&#039;s easier to press.</p><p>Regards</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p317966">
				<div class="post-metadata">
					<div class="post-num">Post #44</div>
					<div class="post-author">gomme600</div>
					<div class="post-datetime">
						3 Apr 2016, 14:59					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>zx82 wrote:</cite><blockquote><div class="quotebox"><cite>gomme600 wrote:</cite><blockquote><p>I can&#039;t believe it!!! It works!!! I decided to make a parallele port cable today...</p></blockquote></div><p>You still have a machine with a parallel port?!?&nbsp; Excellent <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><div class="quotebox"><cite>gomme600 wrote:</cite><blockquote><p>flashed the normal CFE on the wiki page using zjtag.</p></blockquote></div><p>It&#039;d be really helpful if you could try the anyflash CFE, so we can know for sure that one CFE will work on either type of flash seen in these units.</p><div class="quotebox"><cite>gomme600 wrote:</cite><blockquote><p>So it turns out that the raspberry pi was the issue the whole time, the old methods work best!</p></blockquote></div><p>I&#039;ll add a note to the wiki page, but I don&#039;t consider this mystery solved, since 1) RPi worked fine for me on both flash types/both units; 2) you flashed an image and successfully read it back intact.&nbsp; Still, zjtag is supposed to be dedicated to Broadcom&#039;s stuff, so I guess it should be the default choice.&nbsp; Shame there&#039;s no GPIO support; while RPis aren&#039;t exactly great hardware they are ubiquitous and (in RPi Zero form) dirt cheap.</p><div class="quotebox"><cite>gomme600 wrote:</cite><blockquote><p>Just need to install the image now but the most important part is working!</p></blockquote></div><p>Don&#039;t forget you can use the web interface for that bit.&nbsp; Easier and quicker.</p></blockquote></div><p>I actually have a few machines with parallel ports! I hang on to old computers, infact the server is a pentium 3, 512mb of ram machine!</p><p>Ok, so I just tried the CFE named &quot;CFE-BTHH2A-anyflash.bin&quot; and it worked fine, took a bit less time to flash, 132 seconds.</p><p>I am also confused about the raspberry pi. It should have worked but didn&#039;t, makes no sence. Maybe something else was wrong with my configuration?</p>											<p class="post-edited">(Last edited by <strong>gomme600</strong> on 3 Apr 2016, 15:00)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p318039">
				<div class="post-metadata">
					<div class="post-num">Post #45</div>
					<div class="post-author">gomme600</div>
					<div class="post-datetime">
						3 Apr 2016, 23:05					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>danitool wrote:</cite><blockquote><p>Hi, it would be nice having only one bootloader known to work on all flash chips. It can be a more solid info if we add only one CFE link to the wiki. A nice feauter could also be if the bootloader had the leds working properly, like some blinking led while loading or a power led on and the rest off. This way one could know if the CFE is alive without the serial console.</p><p>Some time ago btsimonh reported an issue with the reset/phone button for entering CFE failsafe:<br /><a href="http://openwrt.ebilan.co.uk/viewtopic.php?f=17&amp;t=80&amp;p=763#p762">http://openwrt.ebilan.co.uk/viewtopic.p … p=763#p762</a><br />No idea if this problem is really true, or if does it happen randonmly. Might be a better idea to use the reset button insead phone button. Initially the phone button was used because it&#039;s easier to press.</p><p>Regards</p></blockquote></div><p>Well it seems that the anyflash version works on different chips, I confirmed it working on my spansion unit at least. I agree about the leds, unfortunatly I can&#039;t help with that, I can test things out but I wouldn&#039;t know how to modify the CFE myself.<br />I don&#039;t know about that issue because I used the serial console, I think it&#039;s easier to do it that way as the case is open anyway for Jtag. Does the reset button actually do anything at the moment?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p318040">
				<div class="post-metadata">
					<div class="post-num">Post #46</div>
					<div class="post-author">danitool</div>
					<div class="post-datetime">
						3 Apr 2016, 23:13					</div>
				</div>
				<div class="post-content content">
					<p>The reset button can be used for entering Openwrt failsafe mode by pressing/releasing the button several times and fast enough while OpenWrt boots.</p><p>In CFE pressing the reset button shouldn&#039;t have any effect.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p318297">
				<div class="post-metadata">
					<div class="post-num">Post #47</div>
					<div class="post-author">zx82</div>
					<div class="post-datetime">
						5 Apr 2016, 19:57					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>gomme600 wrote:</cite><blockquote><p>Ok, so I just tried the CFE named &quot;CFE-BTHH2A-anyflash.bin&quot; and it worked fine...</p></blockquote></div><p>Thanks for the report.&nbsp; I&#039;ve updated the wiki to direct people to use that.</p><p>Of course, now that I&#039;ve read that ebilan post danitool pointed to about buttons, I see it also suggests that on some units you can avoid all this JTAG fuss and perform the same USB/Samba hack that works on the Type B.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 2 of 2</div><nav><ul><li><a href="viewtopic.php%3Fid=51348&amp;p=1.html">1</a></li><li class="pagination-current"><span>2</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>