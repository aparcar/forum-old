<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Revert back to factory firmware on WZR-HP-G300NH</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 12 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p138789">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">fusioncases</div>
					<div class="post-datetime">
						9 Jul 2011, 21:45					</div>
				</div>
				<div class="post-content content">
					<p>*See guide to recovery below, figured it out on my own*</p><p>Hello,</p><p>Close to a year ago I installed OpenWRT Backfire (10.03, r20728) on my WZR-HP-G300NH.&nbsp; I created some custom packages for use with a monitoring project I was working on and haven&#039;t touched it since.</p><p>The problem is I&#039;ve kind of forgotten how to do most of this stuff and can not figure out out to put the factory firmware back on it.&nbsp; </p><p>Few notes:</p><p>The web interface is broken but I have telnet access to the device.</p><p>I have the latest stock firmware ready to go: wzrhpg300nh-176 (not trx or bin, no file extension on it.&nbsp; Weighs in at 20.6MB.</p><p>I can&#039;t set boot wait as it seems this doesn&#039;t support the nvram command anymore so I can&#039;t TFTP the image, not that it would do me any good apparently as you can&#039;t flash images larger than 3mb in this fashion?</p><p>I think I can figure out how to SCP it to the router as I was doing this back when I was making ipkg&#039;s.</p><p>I&#039;ve read several different ways to issue a command to flash the firmware, I&#039;m not sure which one I should use.&nbsp; Also I read some people tried using the mtd command to flash back to factory only to get a permission denied errors?&nbsp; Also I noticed some people having to trim the header off .bin files, do I need to do anything special as there is no file extension with the stock firmware?</p><p>Please, anyone, I just want to use this router again.&nbsp; If I can get the stock firmware on it I will be out of your hair for good, I swear.</p>											<p class="post-edited">(Last edited by <strong>fusioncases</strong> on 9 Sep 2011, 18:28)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p138792">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">fusioncases</div>
					<div class="post-datetime">
						9 Jul 2011, 22:33					</div>
				</div>
				<div class="post-content content">
					<p>Ok so it appears I posted this question a while back and I didn&#039;t realize I got a response until now: <a href="https://forum.openwrt.org/viewtopic.php?id=27065">https://forum.openwrt.org/viewtopic.php?id=27065</a></p><p>I tried what LinkZ suggested, now all I get is a blinking red Diag light.&nbsp; I can&#039;t ping the factory IP 192.168.11.1 or what I had it set to 192.168.1.1.&nbsp; I tried power cycling it and holding down the reset button but to no avail.&nbsp; Is it dead for good or is there another way for me to get firmware onto it?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p138799">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">fusioncases</div>
					<div class="post-datetime">
						10 Jul 2011, 00:05					</div>
				</div>
				<div class="post-content content">
					<p>After further reading I learned about &#039;uboot&#039; and the ability to add a serial port to the router.&nbsp; I purchased the correct cable (TTL-232R-3V3-AJ) and audio jack to go along with it.&nbsp; I also opened the router in preparation for the cable.&nbsp; I&#039;m good at soldering so no worries there.</p><p>Am I on the right track?&nbsp; Is there hope to upload in uboot mode?&nbsp; If not I think it will be handy to have the cable around for future adventures so no loss there.&nbsp; Any pointers on what commands to issue to do the firmware flash?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p138902">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">fyi</div>
					<div class="post-datetime">
						10 Jul 2011, 23:47					</div>
				</div>
				<div class="post-content content">
					<p><a href="http://wiki.openwrt.org/toh/buffalo/wzr-hp-g300h">Buffalo WZR-HP-G300NH</a><br /><a href="http://www.dd-wrt.com/phpBB2/viewtopic.php?t=87579">DD-WRT Forum :: View topic - Buffalo WZR-HP-G300NH brick after flashing WHR firmware</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p138961">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">fusioncases</div>
					<div class="post-datetime">
						12 Jul 2011, 08:06					</div>
				</div>
				<div class="post-content content">
					<p>The good news is I can TFTP images to it but none of the firmware images work.&nbsp; I used all of the available firmware images from Buffalo and DD-WRT.&nbsp; Even after doing 30/30/30 resets.</p><p>The interesting thing is that if I flash it to the webflash firmware per BS&#039;s suggestion the Wireless light comes on but the diag light still blinks.&nbsp; If I flash it with the buffalo firmware the router light comes on and the diag light blinks.&nbsp; I&#039;ve tried pinging it and logging into the web interface on several different IPs.</p><p>Any suggestions?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p138967">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">fyi</div>
					<div class="post-datetime">
						12 Jul 2011, 10:40					</div>
				</div>
				<div class="post-content content">
					<p><a href="http://www.dd-wrt.com/wiki/index.php/Buffalo_WZR-HP-G300NH">Buffalo WZR-HP-G300NH - DD-WRT Wiki</a><br /></p><div class="quotebox"><blockquote><p>To revert from DD-WRT back to stock firmware, go to <a href="http://www.dd-wrt.com/phpBB2/download.php?id=13418">http://www.dd-wrt.com/phpBB2/download.php?id=13418</a>, and download the file. Flash using upgrade on the DD-WRT web GUI. This is the 1.6 stock firmware. You can then upgrade to the latest Buffalo firmware.</p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p139028">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">fusioncases</div>
					<div class="post-datetime">
						13 Jul 2011, 07:08					</div>
				</div>
				<div class="post-content content">
					<p>I hadn&#039;t tried that firmware yet.&nbsp; I just tried flashing it with the one in your post and now the wireless light stays on and the diag light is gone but the router is still out to lunch.&nbsp; Is there something that these firmwares aren&#039;t overwriting?&nbsp; Is there a firmware out there that will overwrite everything?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p139192">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">fusioncases</div>
					<div class="post-datetime">
						15 Jul 2011, 18:57					</div>
				</div>
				<div class="post-content content">
					<p>Anyone have any ideas?&nbsp; I don&#039;t understand why all of these successful flashes aren&#039;t bringing the router back to life.&nbsp; To me it seems like there is more going on here.&nbsp; Or something I am not doing right or am missing.&nbsp; I&#039;ve also tried the 30/30/30 reset before and after every flash, though the reset doesn&#039;t seem to actually do anything, the router doesn&#039;t give any indication that a reset has taken place.</p><p>Once the parts for the serial cable come in it seems as though this isn&#039;t going to fix the problem either, correct?&nbsp; I mean if I can already upload a firmware to it what good will uploading the same firmware via serial help me, right?</p><p>So since the firmware portion is all well and good, what is left to do to recover this router?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p139261">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">fusioncases</div>
					<div class="post-datetime">
						16 Jul 2011, 22:40					</div>
				</div>
				<div class="post-content content">
					<p>After hours and hours of messing with this I was able to get the openwrt-ar71xx-wzr-hp-g300nh-squashfs-tftp.bin firmware onto the unit (same firmware that I had &quot;upgraded&quot; to from the original) and I can successfully get into the web interface.</p><p>Please, if anyone knows how to get the stock firmware back on it from this point let me know.&nbsp; I&#039;ve already tried using the web interface to flash it to several different firmwares (DD-WRT, stock) without any luck, it doesn&#039;t think they are valid.&nbsp; From the on I&#039;ve tried to TFTP firmware to it but that bricks it.&nbsp; It seems like large firmwares over TFTP make the router unhappy.&nbsp; I&#039;m hesitant to try the mtd method again as that is what sent me down 10 hours of troubleshooting to get back to this point.</p><p>Certainly there must be someone on these forums who knows the proper way to flash back to factory default firmware.</p><p>I&#039;ve also noticed during all of this that the process is very inconsistent.&nbsp; If I brick the router trying a firmware I sometimes have to reflash to the openwrt firmware many times.&nbsp; That doesn&#039;t always work though, sometimes I need to forgo the 30/30/30 reset.&nbsp; I once simply held the reset in with the power disconnected and then released the reset before powering it back on and that seemed to fix it... Kind of odd.&nbsp; </p><p>The weirdest thing out of all this though is that even after a unsuccessful flash and then several reflashes to openwrt it somehow remembered my root password.&nbsp; How is that even possible?&nbsp; It goes from being bricked to being fixed with a fresh firmware and it somehow already knows my old password?&nbsp; Clearly I am missing something here that no one is telling me about.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p139523">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">chmcwill</div>
					<div class="post-datetime">
						20 Jul 2011, 23:32					</div>
				</div>
				<div class="post-content content">
					<p>Buffalo has their &#039;user friendly&#039; firmware and the Professional DD-WRT firmware versions on their website available for download, I have used both without any issues using a Ubuntu TFTP process to flash them, the newer Buffalo&#039;s are a little tricky with TFTP. My question is why do you want to do that, I have had nothing but trouble with both of those versions and have switched to OpenWRT Backfire 10.03.1-RC5 which has been working for almost a week without ANY issues.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p141906">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">fusioncases</div>
					<div class="post-datetime">
						23 Aug 2011, 06:51					</div>
				</div>
				<div class="post-content content">
					<p>First I want to make it very clear I appreciate your attempt at helping fyi, it&#039;s amazing that as long as this thread has been going you were the only person who even tried to help.&nbsp; It is unfortunate that people who &quot;get it&quot; are off doing their own thing and helping with development while everyone else is left to fend for themselves.</p><p>I was able to finally figure it out while tinkering on my own; hopefully some poor soul who ends up in a similar situation will find this useful.&nbsp; Some of the below instructions are strewn through many posts in many different threads on different forums and as usual a healthy dose of human error thrown in with improper syntaxes and non-existent commands.&nbsp; Hopefully I am able to clean up some of the errors and put everything in one place.&nbsp; I was half tempted to be on my merry way after fixing it never to tread these waters again but I figured that is exactly the kind of attitude I hate.&nbsp; Instead, I will share the exact and complete steps I pieced together.</p><p>First you need to get openwrt functional if it isn&#039;t already.&nbsp; I was able to do this following fyi&#039;s suggestions for tftp along with additional research.</p><br /><p>How to set up a TFTP environment in Windows Vista/7:</p><p>1) Set up the proper physical environment.&nbsp; To do this, configure your network as such: Router LAN port 1 to&gt; Switch port 1.&nbsp; Laptop/Desktop LAN port to&gt; Switch port 2.&nbsp; Why a switch?&nbsp; With some network cards they go to sleep/take a while to find which way is up when their interface is disconnected and reconnected.&nbsp; The switch keeps a foot in the door so to speak while you are restarting things.</p><p>2) Set up your network on the Laptop/Desktop.&nbsp; The boot environment uses an IP of 192.168.11.1 on the router, regardless of what you have it set to in OpenWRT.&nbsp; Set the NIC card on the Laptop/Desktop to 192.168.11.2 for the IP, 255.255.255.0 for the Subnet Mask and 192.168.11.1 for the Gateway.</p><p>3) Set a static arp entry.&nbsp; The arp command wouldn&#039;t work for me to set a static entry, apparently it&#039;s a bug in windows that will happen occasionally.&nbsp; Instead, I needed to use netsh.&nbsp; Open a command prompt as an administrator (right click on command prompt and select run as administrator).&nbsp; After a command prompt is open, type the following command: netsh -c &quot;interface ipv4&quot; .&nbsp; Use the quotes and hit enter after typing this.&nbsp; It will bring you to a &quot;netsh interface ipv4&gt;&quot; command prompt.&nbsp; Once here type the following: set neighbors &quot;Local Area Connection&quot; 192.168.11.1 02-aa-bb-cc-dd-1a .&nbsp; &quot;Local Area Connection&quot; is the name of the NIC card you configured for the 192.168.11.2 address earlier.&nbsp; Use the quotes.&nbsp; The name can be found in network connections in the control panel, this is the only part of the command that might differ for you, though it shouldn&#039;t if you only have one NIC in your system.&nbsp; Hit enter after typing this command.&nbsp; Verify the arp entry by typing arp -a, you should see a static entry for 192.168.11.1 with a MAC of 02-aa-bb-cc-dd-1a.&nbsp; If you screwed up the command delete it using: arp –d 192.168.11.1 or if you screwed up the IP address type the incorrect IP address there instead.&nbsp; This in essence gives you a free pass through the door you cracked open earlier.&nbsp; You don’t need to ask for directions to do anything so to speak, you have a map to the destination.</p><p>4) Install TFTP client.&nbsp; Go into control panel, program and features, click on turn windows features on or off.&nbsp; Scroll down until you see TFTP client, check this box and hit OK.&nbsp; After it finishes installing reboot your Laptop/Desktop.</p><br /><p>So now that you have a environment conducive to flashing, the real “fun” begins.</p><p>Grab the openwrt-ar71xx-wzr-hp-g300nh-squashfs-tftp.bin firmware: <a href="http://downloads.openwrt.org/backfire/10.03/ar71xx/">http://downloads.openwrt.org/backfire/10.03/ar71xx/</a></p><p>Open command prompt and change directory to the download location.&nbsp; In my case “cd c:\users\username\desktop” without the quotes.&nbsp; Type: tftp -i 192.168.11.1 PUT openwrt-ar71xx-wzr-hp-g300nh-squashfs-tftp.bin .&nbsp; Don’t hit enter yet though.&nbsp; Unplug the power from your router and plug it back in again, immediately hit the enter key on your desktop/laptop.&nbsp; Apparently, during boot up the router waits for a short period to see if it should accept a new firmware package, this is your window of opportunity to upload the openwrt firmware.&nbsp; It should only take about a second to finish the upload, DO NOT touch your router, walk away from it for 15 minutes.&nbsp; Do not believe any of the lights on the router.&nbsp; They are lying to you, they are begging for you to brick the router.&nbsp; When you come back you MIGHT be in good shape, change your IP to 192.168.1.1 (no need to delete the arp entry yet) and try to telnet into it.&nbsp; If you can, change the password using the passwd command, exit the telnet session and restart the router.&nbsp; You should be able to get to the web interface (192.168.1.1).&nbsp; If you can’t do any of this try holding down the reset button for 30 seconds, then unplug the power, release the button and hold again for another 30, plug the power in, release the button and hold for another 30.&nbsp; If all else fails try this entire step again and wait 15 more minutes.&nbsp; I had to do it twice for some reason as the device would respond to ping but would not respond to telnet or http requests.</p><p>That’s it, you should be in good shape with openwrt.&nbsp; The next step is to get something far more user friendly loaded onto the device.</p><br /><p>Download the wzr-hp-g300nh-dd-wrt-webupgrade-MULTI.bin from <a href="http://www.dd-wrt.com/site/support/router-database">http://www.dd-wrt.com/site/support/router-database</a> and place it on your desktop.&nbsp; Also download the windows version of “DD” from <a href="http://www.chrysocome.net/dd">http://www.chrysocome.net/dd</a> and place it on your desktop.&nbsp; Heck, while you are in the downloading mood go ahead and grab the original firmware for the Buffalo, don’t bother with Buffalo’s site for this one though because you won’t find it.&nbsp; Register and log in to the dd-wrt forums and download it from this link: <a href="http://www.dd-wrt.com/phpBB2/download.php?id=13418">http://www.dd-wrt.com/phpBB2/download.php?id=13418</a>.&nbsp; Might as well grab the latest firmware from Buffalo, as of this post it was wzrhpg300nh-176.</p><p>Got everything?&nbsp; Good, this is the home stretch to a functional router.</p><p>Open a command prompt and change directory to your desktop were all the goodies are.&nbsp; Type the following: dd bs=28 skip=1 if= wzr-hp-g300nh-dd-wrt-webupgrade-MULTI.bin of=firmware.bin .&nbsp; This is stripping the encrypted header off the firmware and outputting the file as firmware.bin, if you don’t do this the flash will not succeed.</p><p>Now to flash the router to our hacked up firmware.bin.&nbsp; Follow the same steps as before when flashing the squashfs firmware above but use the command: tftp -i 192.168.11.1 PUT firmware.bin.&nbsp; Yes, you really do need to walk away from the router for an extended period of time, yes, those lights are still lying to you.</p><p>Once done you now have dd-wrt up and running.&nbsp; I wouldn’t call it entirely functional though, it wasn’t stable enough to leave as the production firmware (it locks up just trying to save certain settings) and would go out to lunch if left running for a few hours.&nbsp; But that’s ok because it serves as a stepping stone to a reliable and useable firmware.</p><p>At this point you can actually use the web interface to upgrade to the wzrg300nh_original.bin you downloaded from the dd-wrt forums, it will take quite a bit of time to complete this flash.&nbsp; Once this is done you can upgrade to the latest official release from Buffalo.</p><p>That’s it!&nbsp; You’re done!&nbsp; After all this I can say without a doubt the original firmware is the most “reliable” and rather feature packed.&nbsp; DD-WRT is buggy and doesn’t really offer anything over the stock firmware.&nbsp; I would have never been able to do dev work without OpenWRT though, great firmware, terrible support for this router.&nbsp; I did what I needed to do on it though and learned a lot of useful information along the way so it was a positive experience, downright maddening but still positive.</p>											<p class="post-edited">(Last edited by <strong>fusioncases</strong> on 23 Aug 2011, 06:52)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p141912">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">bcmalloy</div>
					<div class="post-datetime">
						23 Aug 2011, 08:47					</div>
				</div>
				<div class="post-content content">
					<p>Or you could just use my guide..<br /><a href="https://forum.openwrt.org/viewtopic.php?pid=140742#p140742">https://forum.openwrt.org/viewtopic.php … 42#p140742</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p143223">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">fusioncases</div>
					<div class="post-datetime">
						9 Sep 2011, 18:27					</div>
				</div>
				<div class="post-content content">
					<p>Interesting guide but I figured it out on my own back in July so unfortunately that wouldn&#039;t have helped.&nbsp; Also, after reading your guide I see some omissions and errors that would have prevented it from working anyways.&nbsp; For example, the MAC address instructions you provide didn&#039;t work for me, you have to use 02-aa-bb-cc-dd-1a for whatever reason, at least that&#039;s the way it was for me and many others.&nbsp; </p><p>The biggest issue with the guide is that it simply wouldn&#039;t have worked in my situation, you can&#039;t flash from openwrt to anything but the hacked up dd-wrt firmware, or another openwrt fimrware of course.&nbsp; I tried every firmware available from DD-WRT and Buffalo.&nbsp; Heck, if it was as simple as your guide I would have been done long ago.&nbsp; I&#039;m not the only one either, there&#039;s a reason I was able to put all the pieces together to get a working router, people were in the same exact boat as me, any other firmware bricked the router regardless of flash or reset procedure.&nbsp; Also, 6 minutes wasn&#039;t even close to long enough between firmware flashes for me, kinda strange you could get away with that, other people described much longer wait times too.</p><p>Because I had written this guide I decided to go through it again using your instructions since I knew I would be able to recover the router.&nbsp; Your method results in a bricked router.&nbsp; My method results in a functional router running the stock firmware.&nbsp; Strange indeed, I wonder why yours is any different, I can only surmise that your environment is different in some crucial way or your guide is simply wrong/incomplete given the situation.</p>											<p class="post-edited">(Last edited by <strong>fusioncases</strong> on 9 Sep 2011, 18:29)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p143232">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">Orca</div>
					<div class="post-datetime">
						9 Sep 2011, 19:22					</div>
				</div>
				<div class="post-content content">
					<p>This is long thread I am not going to read.</p><p>Just wanted to remind you, to put new solution into the wiki-article and mend old-solutions there as well:<br /><a href="http://wiki.openwrt.org/toh/buffalo/wzr-hp-g300h">http://wiki.openwrt.org/toh/buffalo/wzr-hp-g300h</a></p><p>This shall remain generic, but feel free to point to special solution in the respective wiki-page of a device!<br /><a href="http://wiki.openwrt.org/doc/howto/generic.uninstall">http://wiki.openwrt.org/doc/howto/generic.uninstall</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p164357">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">duyhung0185</div>
					<div class="post-datetime">
						13 Apr 2012, 12:12					</div>
				</div>
				<div class="post-content content">
					<p>Hi, i also am having problem with my router,</p><p>I was using OpenWRT 10.3 RC3, but i want to go back to stock firmware (1.74) as I cannot config the router to run at 300 Mbs.<br />But something went wrong, perhaps i flashed the wrong firmware ... now the router&#039;s sitting there blinking red diag led twice every 2 seconds.<br />I tried to TFTP every firmware possible, OpenWRT, DD-WRT, stock ..., the command prompt shows TFTP transfer successful every time, but no firmware seems to stick on it. The red diag led still blinking.</p><p>can you help fusioncases? I read that you have to flash several times to make it work, but im really clueless now ...</p><p>Thanks in advance,</p><p>Duy Hung</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>