<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> sysupgrade?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 22 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p75805">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">swinnenb</div>
					<div class="post-datetime">
						3 Nov 2008, 13:24					</div>
				</div>
				<div class="post-content content">
					<p>Hi</p><p>How does sysupgrade work?<br />What kind of file does sysupgrade expect?<br />how to upgrade kernel and rootfs?</p><p>Thnx for any help.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p75808">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						3 Nov 2008, 13:32					</div>
				</div>
				<div class="post-content content">
					<p>Hi.</p><p>Sysupgrade basically switches to a ramdisk, backs up your /etc/config, invokes mtd to write the image and reappends the previously saved configs to a new jffs2 partition.</p><p>It expects an image file in .trx format.</p><p>Platfroms with separate kernel and rootfs images are _not_ supported, only those was a combined image format.</p><p>~ JoW</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p75825">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">swinnenb</div>
					<div class="post-datetime">
						3 Nov 2008, 19:54					</div>
				</div>
				<div class="post-content content">
					<p>Hi</p><p>Thnx for that info.<br />I&#039;m working on a board from scratch. I can manipulate my flash mapping and I can build jffs and squash file system and kernel, which work fine on&nbsp; my board.<br />Where can I find more info to make a trx file to make combined image format?<br />What files should I look into to find out?</p><p>Kind regards</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p76381">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">Bob Keyes</div>
					<div class="post-datetime">
						13 Nov 2008, 17:03					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;d like to know this too. I am trying to upgrade from 7.09 to 8.09_rc1 on my wgt634u. The images come in .bin format, which is supposed to be just a trx plus header, but I don&#039;t know how to strip that header out. Or is there a way to do this &#039;manually&#039;, other than using the serial cable (my serial cable is br0ken).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p76382">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">Bob Keyes</div>
					<div class="post-datetime">
						13 Nov 2008, 17:23					</div>
				</div>
				<div class="post-content content">
					<p>OK I found a post on how to convert .bin to .trx:</p><p>dd if=firmware.bin of=firmware.trx bs=32 skip=1</p><p>But, when I move the sysupgrade script and its common.sh lib file over to the wgt634u, and copy the wgt .bin image, and run it, I get&quot;Firmware upgrade is not implemented for this platform.&quot;. So I guess it&#039;s manual, eh? That sucks, because I was hoping to do this remotely, but now I&#039;ll have to go onsite and put the config back in.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p97040">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">mordak</div>
					<div class="post-datetime">
						8 Nov 2009, 15:19					</div>
				</div>
				<div class="post-content content">
					<p>Where does sysupgrade expect the firmware file to be? /tmp?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p97188">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						11 Nov 2009, 01:40					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>mordak wrote:</cite><blockquote><p>Where does sysupgrade expect the firmware file to be? /tmp?</p></blockquote></div><p>Yes, you can either specify a file path (/tmp/image.trx) or an url (<a href="http://example.org/image.trx">http://example.org/image.trx</a>). However, the http method is somewhat risky (sudden connection loss during flash etc.)</p><p>~ JoW</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p97193">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">mordak</div>
					<div class="post-datetime">
						11 Nov 2009, 03:00					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>jow wrote:</cite><blockquote><div class="quotebox"><cite>mordak wrote:</cite><blockquote><p>Where does sysupgrade expect the firmware file to be? /tmp?</p></blockquote></div><p>Yes, you can either specify a file path (/tmp/image.trx) or an url (<a href="http://example.org/image.trx">http://example.org/image.trx</a>). However, the http method is somewhat risky (sudden connection loss during flash etc.)</p><p>~ JoW</p></blockquote></div><p>Thanks for the info is this going to get added to the Wiki at some point?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p99302">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">stel</div>
					<div class="post-datetime">
						25 Dec 2009, 13:59					</div>
				</div>
				<div class="post-content content">
					<p>ugh i tried sysupgrade with a downloaded .bin file and also used the dd command above to conver to a .trx file and i still get &quot;Firmware upgrade is not implemented for this platform.&quot; wtf? this is on a RSPro.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p99303">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">stel</div>
					<div class="post-datetime">
						25 Dec 2009, 14:23					</div>
				</div>
				<div class="post-content content">
					<p>i just used that same .trx file with the mtd command</p><p> mtd write /tmp/openwrt-ar71xx-ubnt-rspro-jffs2-sysupgrade.bin rootfs &amp;&amp; reboot</p><p>this worked! but i lost my config. maybe i should have used the firmware.bin file instead. i wonder if there is any difference between them. the system came up (reset to 192.168.1.1 with openwrt default blank password NOT the default ubnt ubiquiti password). more to come.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p99304">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">doddel</div>
					<div class="post-datetime">
						25 Dec 2009, 14:28					</div>
				</div>
				<div class="post-content content">
					<p>sysupgrade is a script that only recently was extended to also work on RS(pro). So if you activate it from an older OpenWrt it will not work.<br />Once the board carries OpenWrt with an extended version you can use sysupgrade from then onwards.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p99311">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">stel</div>
					<div class="post-datetime">
						25 Dec 2009, 20:43					</div>
				</div>
				<div class="post-content content">
					<p>yeah i was kind of figuring that. so now i tried to do the mtd method again but with the firmware.bin file (did .bin by accident then did again with .trx) and the system wuold not accept a &quot;reboot&quot; command. so i cycled the power and it won&#039;t come up. i checked on 192.168.1.1 (and at 192.168.2.20 that i had changed it to and 192.168.1.20 which ubiquiti defaults to) to no avail. i think i bricked it!! wah wah. what do i do now?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p99315">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">doddel</div>
					<div class="post-datetime">
						25 Dec 2009, 20:55					</div>
				</div>
				<div class="post-content content">
					<p>it may have loaded well but via the wan port is asking for an address per dhcp.<br />While keeping it powered via wan, connect also to it on one of the lan ports and try telnet to 192.168.1.1 ....</p><p>If not, put it in failsave; shortly after powering press the reset button and keep that pressed a few seconds. The unit per wan port then listens for tftp on 192.168.1.20&nbsp; and is pingable.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p99316">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">stel</div>
					<div class="post-datetime">
						25 Dec 2009, 21:35					</div>
				</div>
				<div class="post-content content">
					<p>found some good instructions (from doddel = cool guy/girl) so will try later. didn&#039;t know about the &quot;permanent tftpd mode&quot;.</p><p><a href="https://forum.openwrt.org/viewtopic.php?id=18538">https://forum.openwrt.org/viewtopic.php?id=18538</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p99412">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">stel</div>
					<div class="post-datetime">
						28 Dec 2009, 07:46					</div>
				</div>
				<div class="post-content content">
					<p>damn that was harder than it sounded. you have to catch it at the right time with the reset button. best to let your computer keep pinging 192.168.1.20 while you&#039;re trying to get reset at the right time. then you continue with tftp.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p131233">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">vaden</div>
					<div class="post-datetime">
						21 Mar 2011, 09:38					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>jow wrote:</cite><blockquote><p>Hi.</p><p>Sysupgrade basically switches to a ramdisk, backs up your /etc/config, invokes mtd to write the image and reappends the previously saved configs to a new jffs2 partition.</p><p>It expects an image file in .trx format.</p><p>Platfroms with separate kernel and rootfs images are _not_ supported, only those was a combined image format.</p><p>~ JoW</p></blockquote></div><p>Thanks for all the good work on OpenWRT!</p><p>Luci gets</p><p>The uploaded image file does not contain a supported format. Make sure that you choose the generic image format for your platform.</p><p>when upgrading openwrt-ar71xx-ubnt-rocket-m-squashfs-factory.bin using either</p><p>openwrt-ar71xx-generic-ubnt-rocket-m-squashfs-sysupgrade.bin</p><p>or</p><p>openwrt-ar71xx-ubnt-rocket-m-squashfs-factory.bin.</p><p>Thanks for your thoughts.</p><p>kind regards/ldv</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p140949">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">mfchau</div>
					<div class="post-datetime">
						10 Aug 2011, 11:44					</div>
				</div>
				<div class="post-content content">
					<p>HI all, if it says &quot;Failed to switch over to ramfs. Pleaese reboot&quot;, what will be the potential problem?</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>