<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Need help on setting up alternative upstream DNS server</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 24 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p251141">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">wzhang</div>
					<div class="post-datetime">
						19 Oct 2014, 04:44					</div>
				</div>
				<div class="post-content content">
					<p>The machines on LAN are using the default dnsmasq DNS service on OpenWRT, which uses upstream DNS provided by ISP.&nbsp; There are a few machines that I want use OpenDNS as upstream DNS.&nbsp; The following is what I have setup in /etc/dnsmasq.conf.&nbsp; It has been working on the older version of OpenWRT until barrier breaker.<br /></p><div class="codebox"><pre><code>dhcp-range=tag:opendns,192.168.3.97,192.168.3.110,24h           # OpenDNS 192.168.3.96/28 96-110
dhcp-option=tag:opendns,option:dns-server,208.67.222.222,208.67.220.220 # OpenDNS server
dhcp-host=c8:9c:dc:f7:05:5d,set:opendns                                 # Kids-PC</code></pre></div><p>Barrier Breaker has a better IPV6 support and pushed the IPV6 DNS address fdc3:7268:bfed::1, which is the router IPV6 address, to the Windows 8 client.&nbsp; Since the IPV6 DNS is first one, the alternative OpenDNS DNS I have set to use is not taking effect.&nbsp; How do I update dnsmasq.conf so it&#039;s not pushing IPV6 DNS to the clients?</p><p>DNS settings in Win8<br /></p><div class="codebox"><pre><code> DNS Servers . . . . . . . . . . . : fdc3:7268:bfed::1
                                           208.67.222.222
                                           208.67.220.220                                           </code></pre></div><br /><p>-------------------------------------------------------------------------------------------------------<br />Is there any other better options to select upstream servers by tagging?<br />The above method will be working if I can tell dnsmasq not to push ipv6 DNS but it&#039;s still not a perfect solution.&nbsp; When openDNS is pushed to client, the local machine names known by dnsmasq are not working.&nbsp; Is there anyway to tag the upstream DNS servers so request coming from different tagged ip will use a different upstream DNS server?&nbsp; In this way, local machines can still point DNS to dnsmasq but dnsmasq will check the request machine ip address and select a different upstream DNS server.</p><p>For example<br /></p><div class="codebox"><pre><code>dhcp-range=tag:opendns,192.168.3.97,192.168.3.110,24h           # OpenDNS 192.168.3.96/28 96-110
dhcp-option=tag:opendns,unknown option that tell DNSMASQ to use these DNS servers as upstream if tag opendns is set ,208.67.222.222,208.67.220.220 # OpenDNS server
dhcp-host=c8:9c:dc:f7:05:5d,set:opendns                                 # Kids-PC</code></pre></div>											<p class="post-edited">(Last edited by <strong>wzhang</strong> on 19 Oct 2014, 04:46)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p251206">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">Wolvez</div>
					<div class="post-datetime">
						19 Oct 2014, 20:52					</div>
				</div>
				<div class="post-content content">
					<p>Disable the IPv6 which causing the problem. IPv4 can also reach IPv6-Only sites By using a DNS server with IPv6 Internet access. Test-ipv6.com</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>