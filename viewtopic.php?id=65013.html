<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> IDS with WRT1900ACS</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 30 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p325217">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">ominator</div>
					<div class="post-datetime">
						22 May 2016, 02:01					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>I&#039;m planning on running an IDS on a VM connected to a vm-bridge via a lan-port on the OpenWrt.<br />The way i have done it before is to mirror all traffic to the IDS. Is this possible with OpenWrt, and if so, how.<br />Is iptables TEE a possible solution?</p><p>Any advice?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p325352">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">aafj</div>
					<div class="post-datetime">
						22 May 2016, 23:00					</div>
				</div>
				<div class="post-content content">
					<p>As I understand it the switch on that unit should support port mirroring, and so probably vlan would be the preferable method of implementing IDS.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p325353">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">ominator</div>
					<div class="post-datetime">
						22 May 2016, 23:03					</div>
				</div>
				<div class="post-content content">
					<p>I have not found any public build that has implemented port mirroring on the switch. I guess it must be enabled at driver-level?</p><p>Here&#039;s my options for swconfig:<br /></p><div class="codebox"><pre><code>root@OpenWrt:~# swconfig dev switch0 help
switch0: 10.mvsw61xx(MV88E6176), ports: 7 (cpu @ 5), vlans: 64
     --switch
    Attribute 1 (int): enable_vlan (Enable 802.1q VLAN support)
    Attribute 2 (none): apply (Activate changes in the hardware)
    Attribute 3 (none): reset (Reset the switch)
     --vlan
    Attribute 1 (int): port_based (Use port-based (non-802.1q) VLAN only)
    Attribute 2 (int): vid (Get/set VLAN ID)
    Attribute 3 (ports): ports (VLAN port mapping)
     --port
    Attribute 1 (string): mask (Port-based VLAN mask)
    Attribute 2 (int): qmode (802.1q mode: 0=off/1=fallback/2=check/3=secure)
    Attribute 3 (int): pvid (Primary VLAN ID)
    Attribute 4 (unknown): link (Get port link information)</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p325357">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">aafj</div>
					<div class="post-datetime">
						22 May 2016, 23:27					</div>
				</div>
				<div class="post-content content">
					<p>Old thread resolution? <a href="https://forum.openwrt.org/viewtopic.php?id=57480">https://forum.openwrt.org/viewtopic.php?id=57480</a><br />Do not see switch device here <a href="https://wiki.openwrt.org/doc/techref/swconfig,">https://wiki.openwrt.org/doc/techref/swconfig,</a> so maybe mirroring has not been implemented. But it is there in the manufacturer firmware so that would be surprising.</p>											<p class="post-edited">(Last edited by <strong>aafj</strong> on 22 May 2016, 23:29)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p325358">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">davidc502</div>
					<div class="post-datetime">
						22 May 2016, 23:30					</div>
				</div>
				<div class="post-content content">
					<p>Did you know there are snort packages available for OpenWrt? Potentially IDS/IDP built in and configurable.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p325360">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">ominator</div>
					<div class="post-datetime">
						22 May 2016, 23:32					</div>
				</div>
				<div class="post-content content">
					<p>Thanks, I will look into that!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p325361">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">davidc502</div>
					<div class="post-datetime">
						22 May 2016, 23:35					</div>
				</div>
				<div class="post-content content">
					<p>Just looked at the snort packages, and is advertised as NIDS, so I must leave the P off <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> </p><p>If the snort package compiles without issue, I&#039;ll upload to my site.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p325363">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">ominator</div>
					<div class="post-datetime">
						22 May 2016, 23:42					</div>
				</div>
				<div class="post-content content">
					<p>@davidc502</p><p>I did give it a try some time ago, but i didn&#039;t succeed.<br />Out of experience running an IDS is resource-demanding when having 100 Mbit downlink, so I would prefer having this on a separate machine.</p><p>Although Snort is good, I will be using Suricata if I get some sort of mirroring/tee to work.</p><p>Thanks for helping out <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p325364">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">aafj</div>
					<div class="post-datetime">
						22 May 2016, 23:45					</div>
				</div>
				<div class="post-content content">
					<p><a href="https://github.com/mmaraya/port-mirroring">https://github.com/mmaraya/port-mirroring</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p325366">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">davidc502</div>
					<div class="post-datetime">
						22 May 2016, 23:48					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>ominator wrote:</cite><blockquote><p>@davidc502</p><p>I did give it a try some time ago, but i didn&#039;t succeed.<br />Out of experience running an IDS is resource-demanding when having 100 Mbit downlink, so I would prefer having this on a separate machine.</p><p>Although Snort is good, I will be using Suricata if I get some sort of mirroring/tee to work.</p><p>Thanks for helping out <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p></blockquote></div><p>Understand completely. </p><p>Best Regards,</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p325379">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">ominator</div>
					<div class="post-datetime">
						23 May 2016, 00:46					</div>
				</div>
				<div class="post-content content">
					<p>@aafj</p><p>Thanks for the tip.<br />It actually works, but just for a short time. I can see all the pakages flowin in on the IDS-VM.</p><div class="codebox"><pre><code>root@OpenWrt:~# port-mirroring --debug
2016-05-22 23:38:22[info] port-mirroring::main, mirroring_type:[remote][TEE], mirroring_source_num:[1], target:[192.168.3.100], filter:[], opt_promiscuous:[1].
2016-05-22 23:38:22[info] getSenderInterface, device=[eth1.3], mac=[c05627******].
2016-05-22 23:38:23[info] getRemoteARP, filter=[arp host 192.168.3.100], device=[eth1.3], remote mac=[326538******].
2016-05-22 23:38:23[info] port-mirroring::reopenSendHandle eth1.3 success.
2016-05-22 23:38:36[info] port-mirroring, 1000 packets mirrored.
Illegal instruction</code></pre></div><p>I have no idea what this &#039;Illegal instruction&#039; is. Maybe it&#039;s because of IPv6 or something?<br />The creator states though that it&#039;s only tested for Atheros AR71xx/AR724x/AR913x/AR9344 or &quot;ar71xx&quot;.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>