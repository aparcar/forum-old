<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> U-boot and Kernel image.</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 23 Apr 2018 and 6 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 2 of 2</div><nav><ul><li><a href="viewtopic.php%3Fid=66359&amp;p=1.html">1</a></li><li class="pagination-current"><span>2</span></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p335429">
				<div class="post-metadata">
					<div class="post-num">Post #26</div>
					<div class="post-author">123serge123</div>
					<div class="post-datetime">
						22 Aug 2016, 05:24					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>pradeepsysargus wrote:</cite><blockquote><p>Let me know how do I see the USB pen drive data on the LUCI interface.</p></blockquote></div><p>Start <a href="https://wiki.openwrt.org/doc/recipes/usb-storage-samba-webinterface">here</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p335463">
				<div class="post-metadata">
					<div class="post-num">Post #27</div>
					<div class="post-author">pradeepsysargus</div>
					<div class="post-datetime">
						22 Aug 2016, 13:33					</div>
				</div>
				<div class="post-content content">
					<p>I suppose I need to connect the board to internet to install required packages using &#039;opkg&#039; for USB storage.<br />Eg: opkg install kmod-usb-storage</p><p>I connected the board to a office router using ethernet cable.<br />I suppose some settings are left before I can actually connect the board to the internet.<br />I am able to login to the board using ssh.</p><p>Rgds,</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p336823">
				<div class="post-metadata">
					<div class="post-num">Post #28</div>
					<div class="post-author">pradeepsysargus</div>
					<div class="post-datetime">
						1 Sep 2016, 09:16					</div>
				</div>
				<div class="post-content content">
					<p>I am able to see the USB pen drive data in the Samba Share drive as pointed by you. I am able to see the USB data in an android app - BubbleUPnP using miniDLNA.</p><p>Can you tell about micro SD card as well ? It has a SPI interface with RT5350 chipset.</p><p>Rgds,</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p338242">
				<div class="post-metadata">
					<div class="post-num">Post #29</div>
					<div class="post-author">pradeepsysargus</div>
					<div class="post-datetime">
						14 Sep 2016, 10:30					</div>
				</div>
				<div class="post-content content">
					<p>We have built a board based on RT5350 chipset and taking RT5350F-OLinuXino-EVB as reference design.</p><p>We are having a problem detecting the flash chip using Jtag(Jtag connector pins to RT5350 dedicated Jtag pins) or Jtag to SPI pins(as in OLinuXino board).</p><p>When using flashrom, it is unable to detect the flash chip. It is as if there is no board connected to the Jtag connector.<br />I am using the below command in Ubuntu Linux:</p><div class="quotebox"><blockquote><p>flashrom -p ft2232_spi:type=arm-usb-ocd -c EN25Q64</p></blockquote></div><p>I am getting the below error message:<br /></p><div class="codebox"><pre><code>flashrom v0.9.9-r1954 on Linux 3.16.0-33-generic (i686)
flashrom is free software, get the source code at https://flashrom.org

Calibrating delay loop... OK.
No EEPROM/flash device found.
Note: flashrom can never write if the flash chip isn&#039;t found automatically.</code></pre></div><p>Let us know ur inputs in this regard if it is possible for u.</p><p>Thanks,</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p338488">
				<div class="post-metadata">
					<div class="post-num">Post #30</div>
					<div class="post-author">123serge123</div>
					<div class="post-datetime">
						17 Sep 2016, 18:25					</div>
				</div>
				<div class="post-content content">
					<p>Can you post full autodetect output of flashrom?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p338541">
				<div class="post-metadata">
					<div class="post-num">Post #31</div>
					<div class="post-author">pradeepsysargus</div>
					<div class="post-datetime">
						18 Sep 2016, 13:50					</div>
				</div>
				<div class="post-content content">
					<p>We are able to program SPI-flash directly by connecting ARM-USB-OCD with SPI lines.<br />We are using the following commands to find and write to the flash:</p><div class="quotebox"><blockquote><p>flashrom -p ft2232_spi:type=arm-usb-ocd -c EN25Q64<br />flashrom -p ft2232_spi:type=arm-usb-ocd -w BinaryFile.bin</p></blockquote></div><p>Is it possible to program the SPI-flash using ARM-USB-OCD using RT5350 Jtag connector with the same commands.?</p><p>Please suggest.</p><p>Thanks,</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p338992">
				<div class="post-metadata">
					<div class="post-num">Post #32</div>
					<div class="post-author">pradeepsysargus</div>
					<div class="post-datetime">
						23 Sep 2016, 12:10					</div>
				</div>
				<div class="post-content content">
					<p>I have an issue with SD card detection.</p><p>I install the package luci-app-mmc-over-gpio<br />I get web interface that allows me to select the pins for DI,DO,CLK,CS.</p><p>I am using GPIO#4&nbsp; for CLK.<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; GPIO#5&nbsp; for&nbsp; DI<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; GPIO#6&nbsp; &nbsp;for DO.<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; GPIO#27&nbsp; for CS.</p><p>The SD card is connected with an SPI interface with RT5350 chipset.<br />When I reboot the router after pin mapping, I am getting the below error:</p><div class="codebox"><pre><code>gpio-mmc: Failed to request mmc_spi module.
rt2880-pinmux pinctrl: pin 4 is not set to gpio mux
rt2880-pinmux pinctrl: request() failed for pin 4
rt2880-pinmux pinctrl: pin-4 (pio:4) status -22
spi-gpio: probe of spi-gpio.0 failed with error -22
gpio-mmc: MMC-Card &quot;default&quot; attached to GPIO pins di=5, do=6, clk=4, cs=27
rt305x-esw 10110000.esw: link changed 0x00</code></pre></div><p>Just in case, I installed the additional packages kmod-nls-cp850 and kmod-nls-iso8859-15.</p><p>I am still getting the same error as I described.<br />One thing is the same SPI interface(MISO,MOSI,CLK) are common pins between flash memory and SD card.</p><p>I followed the instructions at <a href="http://warrantyvoidifremoved.blogspot.in/2010/07/installing-sd-card-mmc-on-your-fonera.html">http://warrantyvoidifremoved.blogspot.i â€¦ onera.html</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p339049">
				<div class="post-metadata">
					<div class="post-num">Post #33</div>
					<div class="post-author">123serge123</div>
					<div class="post-datetime">
						24 Sep 2016, 04:27					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>pradeepsysargus wrote:</cite><blockquote><div class="quotebox"><blockquote><p>flashrom -p ft2232_spi:type=arm-usb-ocd -c EN25Q64<br />flashrom -p ft2232_spi:type=arm-usb-ocd -w BinaryFile.bin</p></blockquote></div><p>Is it possible to program the SPI-flash using ARM-USB-OCD using RT5350 Jtag connector with the same commands.?</p></blockquote></div><p>I think no. flashrom use SPI-protocol only.<br /></p><div class="quotebox"><blockquote><p>I install the package luci-app-mmc-over-gpio<br />I get web interface that allows me to select the pins for DI,DO,CLK,CS.</p></blockquote></div><p>mmc-over-gpio may use any free gpio. gpio 4,5,6&nbsp; are occupied by SPI-controller already. rt5350 have second SPI-controller on the same bus and additional cs1 but openwrt don&#039;t support this config.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p339073">
				<div class="post-metadata">
					<div class="post-num">Post #34</div>
					<div class="post-author">pradeepsysargus</div>
					<div class="post-datetime">
						24 Sep 2016, 15:38					</div>
				</div>
				<div class="post-content content">
					<p>We have connected SD card with 4 free gpios (GPIO#7,#9,#11,#13).<br />These GPIOs are of UARTF port. They are DTR_N,RTS_N,DSR_N,CTS_N.<br />UARTF is in GPIO mode as I dumped the register GPIOMODE (0x1000_0060). It is defined as gpio in HT-TM02.dts file as below:</p><div class="codebox"><pre><code>pinctrl {
        state_default: pinctrl0 {
            gpio {
                ralink,group = &quot;i2c&quot;, &quot;jtag&quot;, &quot;uartf&quot;;
                ralink,function = &quot;gpio&quot;;
            };
        };
    };</code></pre></div><p>Currently, getting the below error in dmesg:</p><div class="codebox"><pre><code>gpiommc gpiommc.0: no of_node; not parsing pinctrl DT
gpio-mmc: Failed to request mmc_spi module.
spi-gpio spi-gpio.0: no of_node; not parsing pinctrl DT
rt2880-pinmux pinctrl: request pin 13 (io13) for pio:13
spi-gpio: probe of spi-gpio.0 failed with error -16
gpio-mmc: MMC-Card &quot;default1&quot; attached to GPIO pins di=7, do=9, clk=13, cs=11</code></pre></div><p>Any clues about this error?</p><p>Thanks,</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p339316">
				<div class="post-metadata">
					<div class="post-num">Post #35</div>
					<div class="post-author">pradeepsysargus</div>
					<div class="post-datetime">
						27 Sep 2016, 10:17					</div>
				</div>
				<div class="post-content content">
					<p>I am using HT-TM02.dts file as it is without modification so far.</p><p>Should I add any SD card related code in this file ?</p><p>The default HT-TM02.dts file is:</p><div class="codebox"><pre><code>/dts-v1/;

/include/ &quot;rt5350.dtsi&quot;

/ {
    compatible = &quot;HT-TM02&quot;, &quot;ralink,rt5350-soc&quot;;
    model = &quot;HooToo HT-TM02&quot;;

    palmbus@10000000 {
        gpio0: gpio@600 {
            status = &quot;okay&quot;;
        };
        spi@b00 {
            status = &quot;okay&quot;;
            m25p80@0 {
                #address-cells = &lt;1&gt;;
                #size-cells = &lt;1&gt;;
                compatible = &quot;mx25l6405d&quot;;
                reg = &lt;0 0&gt;;
                linux,modalias = &quot;m25p80&quot;, &quot;mx25l6405d&quot;;
                spi-max-frequency = &lt;10000000&gt;;
                partition@0 {
                    label = &quot;u-boot&quot;;
                    reg = &lt;0x0 0x30000&gt;;
                    read-only;
                };
                partition@30000 {
                    label = &quot;u-boot-env&quot;;
                    reg = &lt;0x30000 0x10000&gt;;
                    read-only;
                };
                factory: partition@40000 {
                    label = &quot;factory&quot;;
                    reg = &lt;0x40000 0x10000&gt;;
                    read-only;
                };
                partition@50000 {
                    label = &quot;firmware&quot;;
                    reg = &lt;0x50000 0x7b0000&gt;;
                };
            };
        };
    };

    pinctrl {
        state_default: pinctrl0 {
            gpio {
                ralink,group = &quot;i2c&quot;, &quot;jtag&quot;, &quot;uartf&quot;;
                ralink,function = &quot;gpio&quot;;
            };
        };
    };

    ethernet@10100000 {
        mtd-mac-address = &lt;&amp;factory 0x28&gt;;
    };

    esw@10110000 {
        ralink,portmap = &lt;0x10&gt;;
        ralink,portdisable = &lt;0x2f&gt;;
    };

    wmac@10180000 {
        ralink,mtd-eeprom = &lt;&amp;factory 0&gt;;
    };

    ehci@101c0000 {
        status = &quot;okay&quot;;
    };

    ohci@101c1000 {
        status = &quot;okay&quot;;
    };

    gpio-leds {
        compatible = &quot;gpio-leds&quot;;
        wlan {
            label = &quot;ht-tm02:blue:wlan&quot;;
            gpios = &lt;&amp;gpio0 7 1&gt;;
        };
        lan {
            label = &quot;ht-tm02:green:lan&quot;;
            gpios = &lt;&amp;gpio0 12 1&gt;;
        };

    };

    gpio-keys-polled {
        compatible = &quot;gpio-keys-polled&quot;;
        #address-cells = &lt;1&gt;;
        #size-cells = &lt;0&gt;;
        poll-interval = &lt;20&gt;;
        reset {
            label = &quot;reset&quot;;
            gpios = &lt;&amp;gpio0 10 1&gt;;
            linux,code = &lt;0x198&gt;;
        };
        modeswitch {
            label = &quot;modeswitch&quot;;
            gpios = &lt;&amp;gpio0 14 1&gt;;
            linux,code = &lt;0x100&gt;;
            linux,input-type = &lt;5&gt;;
        };
    };
};</code></pre></div><p>Rgds,</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p339745">
				<div class="post-metadata">
					<div class="post-num">Post #36</div>
					<div class="post-author">pradeepsysargus</div>
					<div class="post-datetime">
						30 Sep 2016, 07:32					</div>
				</div>
				<div class="post-content content">
					<p>When we use the jtag pins which are defined as gpio in the .dts file, we are able to detect the SD card.</p><p>Rgds,</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p341072">
				<div class="post-metadata">
					<div class="post-num">Post #37</div>
					<div class="post-author">pradeepsysargus</div>
					<div class="post-datetime">
						14 Oct 2016, 09:27					</div>
				</div>
				<div class="post-content content">
					<p>During initial boot up, the micro-SD card is being detected, If I remove the card, mmcblk0p1 is not de-allocated&nbsp; - I mean there are no kernel messages.<br />If I insert the card again, I dont see any kernel messages either ....</p><p>There is a problem with card insertion and removal detection.</p><p>We connected the CD, CD1 (Card Detect,Card Detect1) pins to the GPIO pins of RT5350 chipset.</p><p>I suppose, I need to connect CD to the input GPIO pin of the processor, but then how do I read the state of the pin etc..</p><p>Thanks,</p>											<p class="post-edited">(Last edited by <strong>pradeepsysargus</strong> on 14 Oct 2016, 11:31)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p341094">
				<div class="post-metadata">
					<div class="post-num">Post #38</div>
					<div class="post-author">123serge123</div>
					<div class="post-datetime">
						14 Oct 2016, 14:18					</div>
				</div>
				<div class="post-content content">
					<p>For any free gpio N you can </p><div class="codebox"><pre><code>echo N &gt;/sys/class/gpio/export
echo in &gt;/sys/class/gpio/gpioN/direction
cat /sys/class/gpio/gpioN/value</code></pre></div><p> to see current state of the gpo-pin (change N to your number).<br />Or define pseudo button &quot;carddetect&quot; in dts-file and put your action into /etc/rc.button/carddetect. It will be started by system at any changed state of your pseudo button.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p341105">
				<div class="post-metadata">
					<div class="post-num">Post #39</div>
					<div class="post-author">pradeepsysargus</div>
					<div class="post-datetime">
						14 Oct 2016, 16:29					</div>
				</div>
				<div class="post-content content">
					<p>I can now read the CD(Card Detect) pin value as &#039;1&#039; or &#039;0&#039; based on the insertion or removal of SD card.</p><p>If I remove the SD card, I will read the pin value and stop the mmc_over_gpio service. (/etc/init.d/mmc_over_gpio stop)<br />If I plug-in the SD card, I will read the pin value and start the mmc_over_gpio service&nbsp; (/etc/init.d/mmc_over_gpio start)</p><p>Assuming I wrote this script or the set of commands of the above process, where do I put these commands on a live board?</p><p>I guess the processor has to poll the gpio pin (CD) to see if it is high or low.</p><p>Please suggest.</p><p>Thanks,</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p341157">
				<div class="post-metadata">
					<div class="post-num">Post #40</div>
					<div class="post-author">pradeepsysargus</div>
					<div class="post-datetime">
						15 Oct 2016, 12:28					</div>
				</div>
				<div class="post-content content">
					<p>I added the label &#039;carddetect&#039; in the dts file as below:</p><div class="codebox"><pre><code>    gpio-keys-polled {
        compatible = &quot;gpio-keys-polled&quot;;
        #address-cells = &lt;1&gt;;
        #size-cells = &lt;0&gt;;
        poll-interval = &lt;20&gt;;
        reset {
            label = &quot;reset&quot;;
            gpios = &lt;&amp;gpio0 10 1&gt;;
            linux,code = &lt;0x198&gt;;
        };
        carddetect {
             label = &quot;carddetect&quot;;
             gpios = &lt;&amp;gpio0 9 0&gt;;
             linux,code = &lt;0x198&gt;;
        };
        modeswitch {
            label = &quot;modeswitch&quot;;
            gpios = &lt;&amp;gpio0 14 1&gt;;
            linux,code = &lt;0x100&gt;;
            linux,input-type = &lt;5&gt;;
        };
    };</code></pre></div><p>I am using GPIO#9 as input for card detection.</p><p>What should be the action script, can you sort of show an example for me ?</p><p>Thanks,</p>											<p class="post-edited">(Last edited by <strong>pradeepsysargus</strong> on 15 Oct 2016, 13:48)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p342076">
				<div class="post-metadata">
					<div class="post-num">Post #41</div>
					<div class="post-author">pradeepsysargus</div>
					<div class="post-datetime">
						25 Oct 2016, 15:42					</div>
				</div>
				<div class="post-content content">
					<p>I am streaming content from USB pen drive with Samba Server over wifi to mobile phone.</p><p>I am getting an outbound data rate of 10 Mbps (Average) in Real time Graphs section in Openwrt Luci web interface for RT5350F-OLinuXino-EVB. This is a good rate as I can stream videos at a time in 3 mobile phones using a Samba client Android app.</p><p>I am getting an outbound data rate of 500 Kbps(Average) in Real time Graphs section in Openwrt Luci web interface for our own hardware design.</p><p>Our antenna section design is same as the Olimex board, with an exception that we are using a paper antenna while Olimex is using an on-board antenna.</p><p>Is it a hardware or software problem?</p><p>The other issues: a) It takes some time for establishing connection to mobiles. b) The wifi network donot connect to the laptops (only to mobiles).</p><p>Please suggest.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 2 of 2</div><nav><ul><li><a href="viewtopic.php%3Fid=66359&amp;p=1.html">1</a></li><li class="pagination-current"><span>2</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>