<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> kamikaze on WL-HDD clone</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 17 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p32839">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">floe</div>
					<div class="post-datetime">
						27 Aug 2006, 12:09					</div>
				</div>
				<div class="post-content content">
					<p>Hi again,</p><p>this is a bit of a follow-up to my post in the general forum, maybe it&#039;s better suited here.</p><p>I&#039;ve been thinking about putting kamikaze on my ASUS WL-HDD (rebadged by Yakumo),<br />however, without JTAG or even a serial port, this looks a bit risky for now.</p><p>But according to <a href="http://wiki.openwrt.org/OpenWrtDocs/Customizing/Hardware/UART">http://wiki.openwrt.org/OpenWrtDocs/Cus … dware/UART</a> , some<br />BCM4702KPB-based boards contain a 20-pin jumper block that can be used to connect an <br />external UART, and I&#039;ve found a very similar array of solder pads right behind the IDE connector<br />(see also here <a href="http://wiki.openwrt.org/OpenWrtDocs/Hardware/Asus/WL-HDD/InternalImages">http://wiki.openwrt.org/OpenWrtDocs/Har … rnalImages</a> ).</p><p>According to what it says here <a href="http://forum.openwrt.org/viewtopic.php?id=4159">http://forum.openwrt.org/viewtopic.php?id=4159</a> , the pinout could be<br />the same as on the WL-500g, where someone here <a href="http://wl500g.info/showthread.php?t=587&amp;pp=15">http://wl500g.info/showthread.php?t=587&amp;pp=15</a><br />already managed to add a serial port.</p><p>Has anybody already tried this? If not, I guess I will do that maybe next weekend. Does the CFE have<br />to be modified in any way to enable the serial port?</p><p>Yours, Florian</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p33036">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">nrg</div>
					<div class="post-datetime">
						31 Aug 2006, 11:57					</div>
				</div>
				<div class="post-content content">
					<p>Hello Florian</p><p>I was thinking about exactly the same thing but was to lazy to build UART board. I hope you will succeed <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p33037">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">floe</div>
					<div class="post-datetime">
						31 Aug 2006, 12:00					</div>
				</div>
				<div class="post-content content">
					<p>I hope that too :-) Do you know if the CFE has to be modified in any way to enable the serial port<br />(always presumed that adding one works)?</p><p>Florian</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p33049">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">wtzm</div>
					<div class="post-datetime">
						31 Aug 2006, 16:49					</div>
				</div>
				<div class="post-content content">
					<p>The pinout looks similar indeed - GND and VCC look alright, D0 - D7 seem to connect to the appropriate pins on the flash-rom so the rest will hopefully be in the right place as well.<br /></p><div class="quotebox"><blockquote><p>Has anybody already tried this?</p></blockquote></div><p>Yes - on my WL-500g.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p33099">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">nrg</div>
					<div class="post-datetime">
						1 Sep 2006, 09:16					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>floe wrote:</cite><blockquote><p>Do you know if the CFE has to be modified in any way to enable the serial port<br />(always presumed that adding one works)?</p><p>Florian</p></blockquote></div><p>I think wtzm can answer this question <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p33105">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">wtzm</div>
					<div class="post-datetime">
						1 Sep 2006, 10:54					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>floe wrote:</cite><blockquote><p>Do you know if the CFE has to be modified in any way to enable the serial port</p></blockquote></div><p>Nope. On the WL-500g you simply connect your UART board and the power supply and you will see the bootloader messages (CTRL+C gets you a prompt). By the way - the WL-HDD uses PMON, not CFE.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p33106">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">floe</div>
					<div class="post-datetime">
						1 Sep 2006, 11:12					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>wtzm wrote:</cite><blockquote><p>By the way - the WL-HDD uses PMON, not CFE.</p></blockquote></div><p>Are you sure? Because the <a href="http://wiki.openwrt.org/OpenWrtDocs/Hardware/Asus/WL-HDD">wiki entry</a> claims it&#039;s using CFE - but I&#039;m more inclined to believe you :-)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p33119">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">floe</div>
					<div class="post-datetime">
						1 Sep 2006, 14:09					</div>
				</div>
				<div class="post-content content">
					<p>BTW: what quartz crystal did you use? 12.75 MHz?</p><p>Florian</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p33129">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">wtzm</div>
					<div class="post-datetime">
						1 Sep 2006, 17:45					</div>
				</div>
				<div class="post-content content">
					<p>Yes - 12.75 MHz.<br /></p><div class="quotebox"><blockquote><p>Are you sure?</p></blockquote></div><p>Not at all. So promise not to throw heavy things at me if I&#039;m wrong. <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /><br />After looking through a WL-HDD nvram dump I&#039;m fairly confident that it is PMON indeed. You can also try to find the prompt string in your bootloader partition<br /></p><div class="codebox"><pre><code>grep &#039;PMON&gt;&#039; /dev/mtdblock/0
grep &#039;CFE&gt;&#039; /dev/mtdblock/0</code></pre></div><p>Just make sure the &#039;&gt;&#039; is escaped.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p33381">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">floe</div>
					<div class="post-datetime">
						7 Sep 2006, 00:34					</div>
				</div>
				<div class="post-content content">
					<p>It works:</p><div class="codebox"><pre><code>Serial driver version 5.05c (2001-07-08) with MANY_PORTS SHARE_IRQ SERIAL_PCI enabled
ttyS00 at 0xbf800008 (irq = 2) is a 16550A</code></pre></div><p>Details will follow tomorrow (I just switched it on briefly to check for black smoke and sparks <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /> )</p><p>Florian</p>											<p class="post-edited">(Last edited by <strong>floe</strong> on 7 Sep 2006, 00:34)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p33431">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">floe</div>
					<div class="post-datetime">
						7 Sep 2006, 21:50					</div>
				</div>
				<div class="post-content content">
					<p>Okay, now for a bit more detail.. </p><p>I first spent an awful amount of time soldering a pin header to the SMD pads on the WL-HDD board,<br />but I finally managed to get them decently fixed without frying the traces.<br /><span class="postimg"><img src="http://floe.butterbrot.org/external/pins.png" alt="http://floe.butterbrot.org/external/pins.png" /></span></p><p>After that, having wasted almost an entire saturday <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" />, I was a bit less careful when constructing the<br />ciruit on a piece of perfboard, so it looks a bit messy - but it works.<br /><span class="postimg"><img src="http://floe.butterbrot.org/external/board.png" alt="http://floe.butterbrot.org/external/board.png" /></span></p><p>At the first try (see above), the UART was detected at 0xbf800008, as I had simply replicated the<br />circuit from the AsusForum post. However, it only worked in Linux that way, not in the bootloader,<br />so I just removed the connection between pin 12 (A3) on the WL-HDD and pin 13 on the UART and<br />connected the latter to VCC. Now Linux detects the UART twice (to be expected, I should have added<br />an inverter instead, but I was too lazy <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /> ), but the bootloader does, too, and that&#039;s the important part.</p><p>BTW: it&#039;s really PMON, not CFE. And about the quartz: I used a 6.55 MHz crystal, because a) that one<br />was easy to get and b) the UART&#039;s datasheet said it had a maximum rating of 8 MHz. <br />6.55 is okay because 57600 x 16 x 7 = 6451200, that&#039;s quite a bit outside the specified 5% error, but<br />my USB-RS232 converter accepted it anyway (thanks to the FIFO, it doesn&#039;t matter that it&#039;s not running<br />at 115200).</p><p>And just in case anybody is interested, you can look at the entire output from one fresh boot <a href="http://floe.butterbrot.org/external/boot.txt">here</a>.</p><p>One thing that&#039;s still missing IMHO is a better schematic than the one from the AsusForum.. I&#039;ve started<br />to draw one in Eagle, but it&#039;s not finished yet, so stay tuned <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Florian</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p33433">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">wtzm</div>
					<div class="post-datetime">
						7 Sep 2006, 22:06					</div>
				</div>
				<div class="post-content content">
					<p>Congratulations!<br />Sorry, I forgot to mention the address decoding issue. BTW: For simplicity&#039;s sake I used the same solution. <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p33624">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">floe</div>
					<div class="post-datetime">
						11 Sep 2006, 10:36					</div>
				</div>
				<div class="post-content content">
					<p>No problem, I&#039;ve read this part in the AsusForum post. About the schematic: I&#039;ve noticed that, unfortunately,<br />it doesn&#039;t get any more readable just because it&#039;s drawn in Eagle.. <img src="https://forum.openwrt.org/img/smilies/hmm.png" width="15" height="15" alt="hmm" /> I&#039;ll post a link to the Eagle files in the<br />evening, so maybe somebody with a bit more skill than me can give it a try.</p><p>A question I have left is about the way this interface works, because I was thinking about attaching a display<br />there (USB would be a more portable option, but it&#039;s a bit unreliable and slow for a larger display).</p><p>If I now write (read) a byte somewhere between 0xbf800000 and 0xbf80000f, the following things will happen:<br />a) the byte shows up on pins D0..D7<br />b) the low nibble of the address shows up on pins A0..A3<br />c) /CS is set low<br />c) a strobe on /WR (/RD) is generated</p><p>Is that about correct? And if I strobe the INT line, which interrupt is triggered?</p><p>P.S. Just as a reference, here&#039;s the pinout from the other post again:<br /></p><div class="codebox"><pre><code>----------
&gt; D0  D1 |
| D2  D3 |
| D4  D5 |
| D6  D7 |
| A0  A1 |
| A2  A3 |
|+5V /CS |
|/RD /WR |
|INT GND |
| NC  NC |
----------</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p33642">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">wtzm</div>
					<div class="post-datetime">
						11 Sep 2006, 14:55					</div>
				</div>
				<div class="post-content content">
					<p>I don&#039;t know the exact timings for reading/writing from/to the EXTIF, so use common sense (or the datasheet of your UART) and it will probably work.<br />By the way, on the WL-500g /CS is the &quot;real&quot; /CS OR A4 (Printer Port selected with A4=1).</p><p>INT connects to one of the GPIO ports, which can trigger the interrupt of the SB_EXTIF core. The relevant code is in sbmips.c (invoked by setup.c) in your kernels arch/mips/bcm947xx directory.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p37904">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">theFloe</div>
					<div class="post-datetime">
						27 Nov 2006, 20:54					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>floe wrote:</cite><blockquote><p>If I now write (read) a byte somewhere between 0xbf800000 and 0xbf80000f,....</p></blockquote></div><p>How did you do this? I tried via /dev/port but i could not see any change on any pins...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p37913">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">floe</div>
					<div class="post-datetime">
						27 Nov 2006, 22:45					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>theFloe wrote:</cite><blockquote><p>How did you do this? I tried via /dev/port but i could not see any change on any pins...</p></blockquote></div><p>Uh, this was meant hypothetically, I didn&#039;t actually implement anything like that. In practice, I probably would have tried using a small kernel driver for this..</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p38245">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">theFloe</div>
					<div class="post-datetime">
						3 Dec 2006, 13:18					</div>
				</div>
				<div class="post-content content">
					<p>I now connected my oscilloscope to /CS-line and plugged in power supply to my router. I can&#039;t see any high to low transition on this line! Shouldn&#039;t the router test for a external UART chip here? I looked at sbmips and found that it should write some byte to 0xbf80000x and try to read back. So /CS should go low for about 32 times.</p><p>Is there a documentation about all the sb stuff, so i can get a clue how to gain access?</p><p>I also had a look at gpio.c and found that the functions sb_gpioin from sbutils.c have a switch for SB_EXITIF &quot;case SB_EXTIF:&quot; so is it possible to use the gpio module to get access... and if yes, how?</p><p>Thanks for your help...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p38246">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">floe</div>
					<div class="post-datetime">
						3 Dec 2006, 13:29					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>theFloe wrote:</cite><blockquote><p>I now connected my oscilloscope to /CS-line and plugged in power supply to my router. I can&#039;t see any high to low transition on this line! Shouldn&#039;t the router test for a external UART chip here? I looked at sbmips and found that it should write some byte to 0xbf80000x and try to read back. So /CS should go low for about 32 times.</p></blockquote></div><p>As far as I can tell, /CS will probably stay low all the time - the strobes would rather happen on /WR or /RD.</p><p>Florian</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p38247">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">theFloe</div>
					<div class="post-datetime">
						3 Dec 2006, 13:36					</div>
				</div>
				<div class="post-content content">
					<p>It&#039;s high all the time... </p><p>As far as i know of busconcetps /CS should go low from any address in range from 0xbf800000 to 0xbf80000F because on external address lines only the low nibble appears and to differ for e.g. 0x0020000A from 0xBF80000A you need some additional information... the /CS line.</p><p>Any further help is welcome <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Tobias</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p38466">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">theFloe</div>
					<div class="post-datetime">
						7 Dec 2006, 05:09					</div>
				</div>
				<div class="post-content content">
					<p>After some days of source-reading i found the solution for my problem on howo accessing the external interface. I even managed to connect a standard LCD display and write some text onto it.</p><p>For all interested i started sharing my experience with this here: <a href="http://tobiscorner.floery.net">http://tobiscorner.floery.net</a>/ (under category &quot;jukebox&quot; )</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p38471">
				<div class="post-metadata">
					<div class="post-num">Post #21</div>
					<div class="post-author">floe</div>
					<div class="post-datetime">
						7 Dec 2006, 11:31					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>theFloe wrote:</cite><blockquote><p>I even managed to connect a standard LCD display and write some text onto it.</p></blockquote></div><p>Congratulations, this is really useful! But are you still having problems with the /CS line?</p><p>Florian</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p38476">
				<div class="post-metadata">
					<div class="post-num">Post #22</div>
					<div class="post-author">theFloe</div>
					<div class="post-datetime">
						7 Dec 2006, 12:40					</div>
				</div>
				<div class="post-content content">
					<p>Now that I can write to many addresses I can have a closer look at the /CS line.</p><p>Tobias</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p38562">
				<div class="post-metadata">
					<div class="post-num">Post #23</div>
					<div class="post-author">Tim</div>
					<div class="post-datetime">
						8 Dec 2006, 13:47					</div>
				</div>
				<div class="post-content content">
					<p>Hi<br />i notice that you try to use kamikaze on wl-hdd.<br />i have a wl-hdd from yakumo, and kamikaze r5058 is running on it.<br />wireless config is default<br />network config: (note that dmesg finds also eth0, but only the eth1-port exists on the Board)<br />#### LAN configuration<br />config interface lan<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname&nbsp; &nbsp;&quot;eth1&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; static<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr&nbsp; &nbsp;192.168.1.220<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask&nbsp; 255.255.255.0</p><p>config interface wlan0<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname&nbsp; &nbsp;&quot;wl0&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto&nbsp; &nbsp; static<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr&nbsp; &nbsp;192.168.10.1<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask&nbsp; 255.255.255.0</p><p>i think with a standard kamikaze build wl-hdd will not initialize the netconfig accurate,<br />because the /etc/init.d/S05netconfig can´t handle a wl-hdd at the moment,<br />so it will never build a usefull /etc/config/network config.</p><p>i use a r5058 image from a wl500g, modified the netconfig on the wl500g, make a backup image and load it on wl-hdd. it works.<br />it is not nice, but for testing its ok.</p><p>hope it helps</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p38618">
				<div class="post-metadata">
					<div class="post-num">Post #24</div>
					<div class="post-author">theFloe</div>
					<div class="post-datetime">
						9 Dec 2006, 13:54					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>theFloe wrote:</cite><blockquote><p>Now that I can write to many addresses I can have a closer look at the /CS line.</p><p>Tobias</p></blockquote></div><p>Did that and found out that my, now dead, oscilloscope was too slow.. The /CS line goes low whenever an address between 0xBF800000 and 0xBF80000F is read or written. But controlling the Display using the /CS line will be somehow more complicated... read here: <a href="http://tobiscorner.floery.net/?p=63">http://tobiscorner.floery.net/?p=63</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p44945">
				<div class="post-metadata">
					<div class="post-num">Post #25</div>
					<div class="post-author">theFloe</div>
					<div class="post-datetime">
						21 Mar 2007, 19:43					</div>
				</div>
				<div class="post-content content">
					<p>If you have some slower hardware connected to the external interface you can adjust the wait states of the bus. I have not figured out all the values. But with some more time on it I think I can find the last one.</p><p>-&gt; <a href="http://tobiscorner.floery.net">http://tobiscorner.floery.net</a>/</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>