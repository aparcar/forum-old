<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> UBNT mFi mPower Pro</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 19 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p360790">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">pmomhccf</div>
					<div class="post-datetime">
						22 Jun 2017, 05:09					</div>
				</div>
				<div class="post-content content">
					<p>Spent some time with this device and figured some stuff out.</p><p>brain dump:</p><p>PL7223 chips for energy metering and relay control.</p><p>Two 74 series TTL type 138 active low mux chip connect to the prolific chip selects and reset pins. (I guess they needed 16 GPIOs plus two for LEDs, and one for reset button, and AR9331 doesn&#039;t have enough?)</p><p>GPIO 18: A0 on both 74l138<br />GPIO 21: A1 on both 74l138<br />GPIO 11: A2 on both 74l138<br />GPIO 19: enable output on 74l138 that go to PL7223 SPI CS<br />GPIO 20: enable output on 74l138 that go PL7223 reset</p><p>A2 A1 A0<br />0&nbsp; 0&nbsp; 0&nbsp; outlet #4<br />0&nbsp; 0&nbsp; 1&nbsp; outlet #2<br />0&nbsp; 1&nbsp; 0&nbsp; outlet #3<br />0&nbsp; 1&nbsp; 1&nbsp; outlet #1<br />1&nbsp; 0&nbsp; 0&nbsp; outlet #8<br />1&nbsp; 0&nbsp; 1&nbsp; outlet #6<br />1&nbsp; 1&nbsp; 0&nbsp; outlet #7<br />1&nbsp; 1&nbsp; 1&nbsp; outlet #5</p><p>This mapping holds true for both the reset and CS muxes (in other words, A=3 on CS mux addresses outlet 1&#039;s CS, and A=3 on reset mux addresses outlet 1&#039;s RESET pin)</p><p>This is probably different from the 6-port (euro) and 3 port versions, but probably a similar idea.&nbsp; I don&#039;t have either, sorry.</p><p>Device SPI bus appears to be running at an insultingly low 100KHz.&nbsp; No idea if it can go faster than that.</p><p>Sniffed turn relay on command:<br />SPI write: { 0xb8, 0x0f, 0x20 }<br />no read</p><p>Sniffed turn relay off command<br />SPI write: { 0xb8, 0x0f, 0x00 }</p><p>Meter function and is faster SPI clock possible/reliable?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p360791">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">pmomhccf</div>
					<div class="post-datetime">
						22 Jun 2017, 05:17					</div>
				</div>
				<div class="post-content content">
					<p>can&#039;t post links, but there&#039;s a forum thread about this on the manufacturer website that has some useful links to pirate PL7223 data that looks promising (use Google)</p>											<p class="post-edited">(Last edited by <strong>pmomhccf</strong> on 22 Jun 2017, 05:18)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>