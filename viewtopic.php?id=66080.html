<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Fair Share of bandwidth/latency for each local IP? (QOS SQM)</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 22 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p330860">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">chozabu</div>
					<div class="post-datetime">
						8 Jul 2016, 16:58					</div>
				</div>
				<div class="post-content content">
					<p>Hi guys</p><p>First up - I am after low pings and reasonable bandwidth no matter if someone is torrenting.</p><p>I&#039;ve been using the plain (luci) QOS scripts for a while - which is a massive improvement over &quot;nothing&quot; - but with people sometimes torrenting on various ports, or watching netflix - things still got rather wonky sometimes</p><p>Just upgraded my TP-Link 842 to a more recent firmware ( OpenWrt Chaos Calmer 15.05.1 / LuCI 15.05-149-g0d8bbd2 Release (git-15.363.78009-956be55) ) so I could try out SQM - but when someone is torrenting - I still get 1000+ ping</p><p>It still seems the best option to get fair share of latency/bandwidth is some kind of per-local IP rules - is there a way I can do this? am I barking up the wrong tree?</p><p>edit: Should also mention, I am on a ~3.5/0.3 down/up ADSL link</p>											<p class="post-edited">(Last edited by <strong>chozabu</strong> on 8 Jul 2016, 17:39)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p330915">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">yapoo</div>
					<div class="post-datetime">
						9 Jul 2016, 03:50					</div>
				</div>
				<div class="post-content content">
					<p>Hi.</p><p>I&#039;m In the same boar.<br />Here is Mikrotik&#039;s document.<br /><a href="http://wiki.mikrotik.com/wiki/Manual:Queues_-_PCQ_Examples">http://wiki.mikrotik.com/wiki/Manual:Qu … Q_Examples</a><br />I also want to know how to implement this on openwrt.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p330932">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						9 Jul 2016, 11:10					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>chozabu wrote:</cite><blockquote><p>Hi guys</p><p>First up - I am after low pings and reasonable bandwidth no matter if someone is torrenting.</p><p>I&#039;ve been using the plain (luci) QOS scripts for a while - which is a massive improvement over &quot;nothing&quot; - but with people sometimes torrenting on various ports, or watching netflix - things still got rather wonky sometimes</p><p>Just upgraded my TP-Link 842 to a more recent firmware ( OpenWrt Chaos Calmer 15.05.1 / LuCI 15.05-149-g0d8bbd2 Release (git-15.363.78009-956be55) ) so I could try out SQM - but when someone is torrenting - I still get 1000+ ping</p><p>It still seems the best option to get fair share of latency/bandwidth is some kind of per-local IP rules - is there a way I can do this? am I barking up the wrong tree?</p><p>edit: Should also mention, I am on a ~3.5/0.3 down/up ADSL link</p></blockquote></div><p>You could try one of the LEDE builds, as these allow you to select the cake qdisc in sqm-scripts wich promises to solve this problem to some degree. If you want to try this I would recommend a LEDE trunk built with additionally installed luci gui, luci-app-sqm, kmod_cake, and sqm-scripts-extra (alternatively you could follow the instructions on <a href="https://github.com/moeller0/temporary_test_scripts_4_sqm-scripts">https://github.com/moeller0/temporary_t … qm-scripts</a> to manually install those test scripts, but you need sqm-scripts installed first). The sqm-scripts-extra package contains experimental scripts that expose cake&#039;s IP isolation features. But please note that currently this does not work well with NAT so is ready for testing, but not for prime-time use. If you are willing to test this ad help us improve sqm-scripts and cake to solve this problem for good I would be delighted. If you have detail questions do not hesitate to ask.</p><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p330934">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">tapper</div>
					<div class="post-datetime">
						9 Jul 2016, 12:27					</div>
				</div>
				<div class="post-content content">
					<p>Hi i stopped this by flashing over to Gargoyle. My kids play tf2 and dota all the time and were kicking off about hi pings. after flashing Gargoyle i set up QOS and all is good. <br /><a href="https://www.gargoyle-router.com/download.php">https://www.gargoyle-router.com/download.php</a><br />There is a grate post from the forums for setting up qos here:<br /><a href="https://www.gargoyle-router.com/phpbb/viewtopic.php?f=12&amp;t=7261#p30122">https://www.gargoyle-router.com/phpbb/v … 261#p30122</a><br />By the way the new 1.9.1 build of Gargoyle is baste on openwrt 15.1</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p331056">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">richbhanover</div>
					<div class="post-datetime">
						10 Jul 2016, 17:32					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>chozabu wrote:</cite><blockquote><p>Hi guys</p><p>First up - I am after low pings and reasonable bandwidth no matter if someone is torrenting.<br />...<br />Just upgraded my TP-Link 842 to a more recent firmware ( OpenWrt Chaos Calmer 15.05.1 / LuCI 15.05-149-g0d8bbd2 Release (git-15.363.78009-956be55) ) so I could try out SQM - but when someone is torrenting - I still get 1000+ ping</p><p>It still seems the best option to get fair share of latency/bandwidth is some kind of per-local IP rules - is there a way I can do this? am I barking up the wrong tree?</p><p>edit: Should also mention, I am on a ~3.5/0.3 down/up ADSL link</p></blockquote></div><p>@chozabu: moeller0 mentions the LEDE build, but the SQM-QoS of Chaos Calmer should give a better experience than what you describe. Would you answer a few questions about your setup?</p><p>- You say it&#039;s 3.5/0.3 mbps ADSL. True?<br />- What is the WAN interface in the Network-&gt;Interfaces page? (It&#039;s in the red box below &quot;WAN&quot;)<br />- What parameters do you see in the Network-&gt;SQM-QoS values? The most important are:<br />&nbsp; &nbsp;- Enable this SQM instance (should be checked)<br />&nbsp; &nbsp;- Interface name (should be the same as the &quot;WAN interface&quot; named above)<br />&nbsp; &nbsp;- Download Speed (default should be about 2975 -&nbsp; 85% of your 3500 kbps download)<br />&nbsp; &nbsp;- Upload Speed (default should be 255 - 85% of your 300 kbps upload)<br />&nbsp; &nbsp;- Queue discipline (in the Queue Discipline tab - use the default of &quot;fq_codel&quot;)<br />&nbsp; &nbsp;- Which Link Layer to account for: (in the Link Layer Adaptation tab - use ATM)<br />&nbsp; &nbsp;- Per-Packet Overhead (Link Adaptation tab - use 44)</p><p>Then try <a href="http://www.dslreports.com/speedtest">www.dslreports.com/speedtest</a> and look at the &quot;Results and Share&quot; to see the latency values. I would like to hear what happens.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p331128">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">mezo</div>
					<div class="post-datetime">
						11 Jul 2016, 13:46					</div>
				</div>
				<div class="post-content content">
					<p>&quot;SQM-QoS of Chaos Calmer should give a better experience&quot; why?</p><p>im on CC with sqm qos and literally every downloader (steam, torrent, battle.net etc.) does not care about qos and fill the whole line.</p><p>i tested moellers scripts aswell, but he mentioned, that it does not work well for NAT, so i assume thats why i have the same problems there.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p331129">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">richbhanover</div>
					<div class="post-datetime">
						11 Jul 2016, 13:54					</div>
				</div>
				<div class="post-content content">
					<p>@mezo SQM-QoS is designed to work better, since it separates out the flows - big and small - and sends them out in a fair way. (It explicitly slows the downloaders as needed to give the small connections low latency access to the network.)</p><p>I would like to let the Bufferbloat team know about your experience to get their thoughts. Would you answer the questions above so I can pass it along? Thanks.</p>											<p class="post-edited">(Last edited by <strong>richbhanover</strong> on 11 Jul 2016, 13:55)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p331131">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">mezo</div>
					<div class="post-datetime">
						11 Jul 2016, 14:12					</div>
				</div>
				<div class="post-content content">
					<p>- You say it&#039;s 3.5/0.3 mbps ADSL. True? - <strong>ADSL 16000/2500kbit</strong><br />- What is the WAN interface in the Network-&gt;Interfaces page? (It&#039;s in the red box below &quot;WAN&quot;) - <strong>pppoe-wan</strong></p><p>- What parameters do you see in the Network-&gt;SQM-QoS values? The most important are:<br />&nbsp; &nbsp;- Enable this SQM instance (should be checked) - <strong>is enabled <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></strong><br />&nbsp; &nbsp;- Interface name (should be the same as the &quot;WAN interface&quot; named above) - <strong>pppoe-wan</strong><br />&nbsp; &nbsp;- Download Speed (default should be about 2975 -&nbsp; 85% of your 3500 kbps download) - <strong>dl: 15000</strong><br />&nbsp; &nbsp;- Upload Speed (default should be 255 - 85% of your 300 kbps upload) - <strong>ul: 2000</strong><br />&nbsp; &nbsp;- Queue discipline (in the Queue Discipline tab - use the default of &quot;fq_codel&quot;) - <strong>fq_codel</strong><br />&nbsp; &nbsp;- Which Link Layer to account for: (in the Link Layer Adaptation tab - use ATM) - <strong>ATM</strong><br />&nbsp; &nbsp;- Per-Packet Overhead (Link Adaptation tab - use 44) - <strong>44</strong></p><p>the bold text are my answers. sqm-qos works fine for http downloads, but all downloader i mentioned fill the line till the limit is reached i set for qos. so if i set 15000, steam use the whole 15000kbit and everything else starts to lag/ping goes up.</p>											<p class="post-edited">(Last edited by <strong>mezo</strong> on 11 Jul 2016, 14:20)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p331132">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">richbhanover</div>
					<div class="post-datetime">
						11 Jul 2016, 14:27					</div>
				</div>
				<div class="post-content content">
					<p>If you&#039;re willing to experiment with the configuration, I have a few more questions.</p><p>- 16000/2500kbit sounds more like cable modem speeds. Is that true?<br />- What happens if you set the download speed to 13600 (that&#039;s 85% of the 16,000kbps)<br />- What are the results of the <a href="http://www.dslreports.com/speedtest">www.dslreports.com/speedtest</a>? Click &quot;Results+Share&quot; and send the URL of that page so I can see all the details.</p><p>Thanks!</p><p>Update: I see you did say it&#039;s ADSL. Cool speeds! :-)</p>											<p class="post-edited">(Last edited by <strong>richbhanover</strong> on 11 Jul 2016, 14:29)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p331133">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">mezo</div>
					<div class="post-datetime">
						11 Jul 2016, 14:31					</div>
				</div>
				<div class="post-content content">
					<p>i experimented alot - rly alot - and there is no way to get this problem away. i even tried to set the dl limit to 8000 and upload to 1000.</p><p>its a adsl connection btw.</p><p><span class="postimg"><img src="http://www.dslreports.com/speedtest/4402698.png" alt="http://www.dslreports.com/speedtest/4402698.png" /></span></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p331137">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						11 Jul 2016, 14:50					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>mezo wrote:</cite><blockquote><p>&quot;SQM-QoS of Chaos Calmer should give a better experience&quot; why?</p><p>im on CC with sqm qos and literally every downloader (steam, torrent, battle.net etc.) does not care about qos and fill the whole line.</p><p>i tested moellers scripts aswell, but he mentioned, that it does not work well for NAT, so i assume thats why i have the same problems there.</p></blockquote></div><p>Hi Mezo,</p><p>so steam and torrents are currently known to be in sqm-scripts&#039; blind-spot so to say, we are working on this though <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /> Could you please remind? me which of the extra test scripts you tried and how you set them up? I especially created the _LAN_ variants of these scripts to avoid the NAT issue (for testing only, as this then requires all computers to be connected via cables as sqm on LAN typically will not shape WLAN traffic to/from the internet, but only WLAN traffic to/from LAN ports). Maybe we can test things further?</p><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p331138">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">mezo</div>
					<div class="post-datetime">
						11 Jul 2016, 14:55					</div>
				</div>
				<div class="post-content content">
					<p>hey,<br />i have tested the &quot;TEMPORARY_WAN_triple-isolate__piece_of_cake.qos&quot; script over wifi (so i did everything wrong <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> ).</p><p>can i use a second router as client wifi brdige where i connected via lan, together with _LAN_ variant? its hard to test LAN otherwise for me.</p>											<p class="post-edited">(Last edited by <strong>mezo</strong> on 11 Jul 2016, 14:56)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p331140">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						11 Jul 2016, 15:04					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>mezo wrote:</cite><blockquote><p>hey,<br />i have tested the &quot;TEMPORARY_WAN_triple-isolate__piece_of_cake.qos&quot; script over wifi (so i did everything wrong <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> ).</p><p>can i use a second router as client wifi brdige where i connected via lan, together with _LAN_ variant? its hard to test LAN otherwise for me.</p></blockquote></div><p>Hi mezo,</p><p>you did nothing wrong, the WAN variants will work with WLAN traffic just as they should. Only due to NAT the information about the internal IP addresses is hidden so that the IP isolation options will regress into pure flow isolation...</p><p>But your idea about hooking up a second (non-NAT/dumb-AP) router to one of the sqm&#039;d router&#039;s LAN ports is actually a very good idea to still allow wifi clients into the testing mix.</p><p>Please note that you should test both the triple-isolate as well as the dual isolation scripts (triple-isolate might have a bug).&nbsp; And these scripts will isolate by internal IP address, so on the computer that uses the steam client latency for browsing will in all likelihood still suffer, but other computers should work fine/be less affected than currently.</p><p>Please report back any success or failures so we have a chance of getting this fixed...</p><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p331141">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">mezo</div>
					<div class="post-datetime">
						11 Jul 2016, 15:11					</div>
				</div>
				<div class="post-content content">
					<p>my idea was more to setup a second router in my flat (the main router is in another flat <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> ) and connect it over wifi as client to the main router and myself via lan. i still can connect the second router via lan, but it would be easier the wifi way for me.</p><p>so what i want to do:<br />- connect my second router as wifi client to the main router.<br />- disable sqm qos on the main router.<br />- enable sqm qos with lan variant on my second router.<br />- connect myself via lan to this router.</p>											<p class="post-edited">(Last edited by <strong>mezo</strong> on 11 Jul 2016, 15:12)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p331142">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						11 Jul 2016, 15:24					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>mezo wrote:</cite><blockquote><p>my idea was more to setup a second router in my flat (the main router is in another flat <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> ) and connect it over wifi as client to the main router and myself via lan. i still can connect the second router via lan, but it would be easier the wifi way for me.</p><p>so what i want to do:<br />- connect my second router as wifi client to the main router.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; in that situation you should be able to instantiate SQM on the WIFI interface of the main router. But shaping on wifi has its own issues and will at least drag in more variability than if you could hook up the secondary router via a cable to the main router. This has the additional advantage that truly internal traffic on the secondary router is not throttled at all... Note that you would still use the LAN variant of the test script as WIFI is not WAN <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /> I believe that the current LEDE test built offers a slightly more recent cake module, so it might be a good idea to test this on LEDE instead of openwrt.<br /></p><div class="quotebox"><cite>mezo wrote:</cite><blockquote><p>- disable sqm qos on the main router.<br />- enable sqm qos with lan variant on my second router.<br />- connect myself via lan to this router.</p></blockquote></div><p>So your proposed scheme might work, but I believe keeping SQM on the main router would be much nicer. As that is a viable way to set things up as long as one is willing to invest in one non-wifi router (the router can have wifi, but it should just not be used) to avoid the usual NAT issues...</p><br /><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p331144">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">mezo</div>
					<div class="post-datetime">
						11 Jul 2016, 15:58					</div>
				</div>
				<div class="post-content content">
					<p>queuing discipline should be cake, right?</p><p>it seems like on your script up and download is reversed?!?, atleast it works if i reverse them.</p><p>what i noticed so far on my test:<br />it seems to work, steam does no longer eat the whole connection, but i have to set the downloadlimit in sqm much lower than usual. also compared to http downloads, twitch still starts to lag while downloading on steam. </p><p>so when i watch twitch and downloading on steam, steam gets slowed down, but not enough as it seems. atleast the ping is stable while doing both, even if have to set my downloadlimit much lower.</p><p>a http download stays at ~440kb/s when i set 10000 on sqm, while twitch and everything works fine.<br />steam stays at ~670kb/s when i set 10000 on sqm.</p>											<p class="post-edited">(Last edited by <strong>mezo</strong> on 11 Jul 2016, 17:27)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p331165">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">richbhanover</div>
					<div class="post-datetime">
						11 Jul 2016, 18:55					</div>
				</div>
				<div class="post-content content">
					<p>@mezo - I&#039;m going to step back here. When moeller0 offers advice, I listen very carefully. Best regards...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p331166">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						11 Jul 2016, 19:06					</div>
				</div>
				<div class="post-content content">
					<p>Hi mezo,</p><p>first thank you for testing. Could I convince you to reoprt a bit more detail about what you set-up and what you observed? Maybe you could post the result from &quot;cat /etc/config/sqm&quot; and &quot;tc -d qdisc&quot; from the machine you enabled sqm-scripts on as well as add a quick descruiption whivch of the discussed topologies you ended up implementing?</p><br /><br /><div class="quotebox"><cite>mezo wrote:</cite><blockquote><p>queuing discipline should be cake, right?</p><p>it seems like on your script up and download is reversed?!?, atleast it works if i reverse them.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; The LAN scripts internally flip ingress and egress bandwidth, so that the monikers download and upload stay correct, but a) that relies on your real local topology and b) I might have screwed that up <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /><br /></p><div class="quotebox"><cite>mezo wrote:</cite><blockquote><p>what i noticed so far on my test:<br />it seems to work, steam does no longer eat the whole connection, but i have to set the downloadlimit in sqm much lower than usual. also compared to http downloads, twitch still starts to lag while downloading on steam.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; Steam and twitch this on the same machine or on different ones?<br /></p><div class="quotebox"><cite>mezo wrote:</cite><blockquote><p>so when i watch twitch and downloading on steam, steam gets slowed down, but not enough as it seems. atleast the ping is stable while doing both, even if have to set my downloadlimit much lower.</p><p>a http download stays at ~440kb/s when i set 10000 on sqm, while twitch and everything works fine.<br />steam stays at ~670kb/s when i set 10000 on sqm.</p></blockquote></div><p>A look at your /etc/config/sqm and the output of &quot;tc -d qdisc&quot; might help to elucidate things a bit for me <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p><br /><p>Which of the test scripts are you using? The triple or the dual-isolate one?</p><br /><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p331170">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">mezo</div>
					<div class="post-datetime">
						11 Jul 2016, 19:40					</div>
				</div>
				<div class="post-content content">
					<div class="codebox"><pre><code>root@OpenWrt:~# cat /etc/config/sqm

config queue &#039;eth1&#039;
        option qdisc_advanced &#039;0&#039;
        option interface &#039;wlan0&#039;
        option debug_logging &#039;0&#039;
        option verbosity &#039;5&#039;
        option linklayer &#039;atm&#039;
        option overhead &#039;44&#039;
        option enabled &#039;1&#039;
        option qdisc &#039;cake&#039;
        option script &#039;TEMPORARY_LAN_dual-isolate__piece_of_cake.qos&#039;
        option download &#039;2000&#039;
        option upload &#039;10000&#039;</code></pre></div><div class="codebox"><pre><code>root@OpenWrt:~# tc -d qdisc
qdisc fq_codel 0: dev eth0 root refcnt 2 limit 1024p flows 1024 quantum 1514 target 5.0ms interval 100.0ms ecn
qdisc fq_codel 0: dev eth1 root refcnt 2 limit 1024p flows 1024 quantum 1514 target 5.0ms interval 100.0ms ecn
qdisc cake 800d: dev wlan0 root refcnt 5 bandwidth 2Mbit besteffort dual-dsthost rtt 100.0ms raw
 linklayer atm overhead 44 mtu 2047 tsize 512
qdisc ingress ffff: dev wlan0 parent ffff:fff1 ----------------
qdisc cake 800e: dev ifb4wlan0 root refcnt 2 bandwidth 10Mbit besteffort dual-srchost rtt 100.0ms raw
 linklayer atm overhead 44 mtu 2047 tsize 512</code></pre></div><div class="quotebox"><blockquote><p>Steam and twitch this on the same machine or on different ones?</p></blockquote></div><p>same machine</p><div class="quotebox"><blockquote><p>Which of the test scripts are you using? The triple or the dual-isolate one?</p></blockquote></div><p>i tried both</p><div class="quotebox"><blockquote><p>Could I convince you to reoprt a bit more detail about what you set-up and what you observed?</p></blockquote></div><p>i connected my second router as a wifi client to my main router. i disabled qos on main router and enabled it on the second router with settings you can see above. i conntected myself to lan of the second router!</p><p>it just looks for me, that downloader like steam and bnet still not get slowed down enough.</p><p>i just made a second test while watching twitch</p><p>this are the results:<br />steam: 800kb/s, ping is fine, twitch buffers<br />bnet: same as steam, but i dont give to much about the speed bnet shows, because it is alwas wrong. ping still fine, twitch buffers.<br />http debian download: 500-600 kb/s, twitch runs fine, ping is fine.</p>											<p class="post-edited">(Last edited by <strong>mezo</strong> on 11 Jul 2016, 19:56)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p331173">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						11 Jul 2016, 20:15					</div>
				</div>
				<div class="post-content content">
					<p>Hi mezo,</p><div class="quotebox"><cite>mezo wrote:</cite><blockquote><div class="codebox"><pre><code>root@OpenWrt:~# cat /etc/config/sqm

config queue &#039;eth1&#039;
        option qdisc_advanced &#039;0&#039;
        option interface &#039;wlan0&#039;
        option debug_logging &#039;0&#039;
        option verbosity &#039;5&#039;
        option linklayer &#039;atm&#039;
        option overhead &#039;44&#039;
        option enabled &#039;1&#039;
        option qdisc &#039;cake&#039;
        option script &#039;TEMPORARY_LAN_dual-isolate__piece_of_cake.qos&#039;
        option download &#039;2000&#039;
        option upload &#039;10000&#039;</code></pre></div><div class="codebox"><pre><code>root@OpenWrt:~# tc -d qdisc
qdisc fq_codel 0: dev eth0 root refcnt 2 limit 1024p flows 1024 quantum 1514 target 5.0ms interval 100.0ms ecn
qdisc fq_codel 0: dev eth1 root refcnt 2 limit 1024p flows 1024 quantum 1514 target 5.0ms interval 100.0ms ecn
qdisc cake 800d: dev wlan0 root refcnt 5 bandwidth 2Mbit besteffort dual-dsthost rtt 100.0ms raw
 linklayer atm overhead 44 mtu 2047 tsize 512
qdisc ingress ffff: dev wlan0 parent ffff:fff1 ----------------
qdisc cake 800e: dev ifb4wlan0 root refcnt 2 bandwidth 10Mbit besteffort dual-srchost rtt 100.0ms raw
 linklayer atm overhead 44 mtu 2047 tsize 512</code></pre></div></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; Thanks, I see why you need to flip download and upload directions now.<br /></p><div class="quotebox"><cite>mezo wrote:</cite><blockquote><br /><br /><div class="quotebox"><blockquote><p>Steam and twitch this on the same machine or on different ones?</p></blockquote></div><p>same machine</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; That unfortunately is not something we can easily fix since then the offending traffic and the relevant traffic share the internal IP address so by-internal IP fairness does not help much. Could you please try twitching from a different machine than the steaming (at least for testing?). At the same machine you really need to look into steams bandwidth control (<a href="https://support.steampowered.com/kb_article.php?ref=4166-TYSC-9690">https://support.steampowered.com/kb_art … -TYSC-9690</a>) and battle.net&#039;s and your torrent client&#039;s, or resort to DSCP markings (if all of these clients should use stable port numbers, which I doubt). The hope is currently that at least machines that are not producing problematic torrent-like traffic will remain useable even with timing critical stuff like twitch. That said, how much bandwidth does twitch at your quality settings actually does require, do you happen to know?<br /></p><div class="quotebox"><cite>mezo wrote:</cite><blockquote><div class="quotebox"><blockquote><p>Which of the test scripts are you using? The triple or the dual-isolate one?</p></blockquote></div><p>i tried both</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; Thanks, could you observe any differences for your test load, between dual and triple?<br /></p><div class="quotebox"><cite>mezo wrote:</cite><blockquote><div class="quotebox"><blockquote><p>Could I convince you to reoprt a bit more detail about what you set-up and what you observed?</p></blockquote></div><p>i connected my second router as a wifi client to my main router. i disabled qos on main router and enabled it on the second router with settings you can see above. i conntected myself to lan of the second router!</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; So from the secondary routers perspective internet download and interface-ingress direction are aligned again, same for upload-egress. The LAN scripts really assume you instantiate them on the main router that directly faces the internet. But have you tried setting this up on the main router instead?<br /></p><div class="quotebox"><cite>mezo wrote:</cite><blockquote><p>it just looks for me, that downloader like steam and bnet still not get slowed down enough.</p><p>i just made a second test while watching twitch</p><p>this are the results:<br />steam: 800kb/s, ping is fine, twitch buffers<br />bnet: same as steam, but i dont give to much about the speed bnet shows, because it is alwas wrong. ping still fine, twitch buffers.<br />http debian download: 500-600 kb/s, twitch runs fine, ping is fine.</p></blockquote></div><br /><p>Mmh, so this is better, but not good enough yet. Which openwrt/LEDE version are you using?</p><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p331185">
				<div class="post-metadata">
					<div class="post-num">Post #21</div>
					<div class="post-author">mezo</div>
					<div class="post-datetime">
						11 Jul 2016, 21:18					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><blockquote><p>That said, how much bandwidth does twitch at your quality settings actually does require, do you happen to know?</p></blockquote></div><p>this is how twitch traffic usually looks like<br /><span class="postimg"><img src="http://i.imgur.com/dTLERWL.jpg" alt="http://i.imgur.com/dTLERWL.jpg" /></span></p><div class="quotebox"><blockquote><p>Thanks, could you observe any differences for your test load, between dual and triple?</p></blockquote></div><p>not really tbh.</p><div class="quotebox"><blockquote><p>But have you tried setting this up on the main router instead?</p></blockquote></div><p>the problem is, that my network is wifi only and this wouldnt help. <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> </p><div class="quotebox"><blockquote><p>Could you please try twitching from a different machine</p></blockquote></div><p>i will try, but same problem as above. my network is wifi only.</p><div class="quotebox"><blockquote><p>Mmh, so this is better, but not good enough yet. Which openwrt/LEDE version are you using?</p></blockquote></div><p>OpenWrt Designated Driver r49395</p>											<p class="post-edited">(Last edited by <strong>mezo</strong> on 11 Jul 2016, 21:18)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p331277">
				<div class="post-metadata">
					<div class="post-num">Post #22</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						12 Jul 2016, 12:05					</div>
				</div>
				<div class="post-content content">
					<p>Hi mezo,</p><div class="quotebox"><cite>mezo wrote:</cite><blockquote><div class="quotebox"><blockquote><p>That said, how much bandwidth does twitch at your quality settings actually does require, do you happen to know?</p></blockquote></div><p>this is how twitch traffic usually looks like<br /><span class="postimg"><img src="http://i.imgur.com/dTLERWL.jpg" alt="http://i.imgur.com/dTLERWL.jpg" /></span></p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; So this is just twitch? This looks like it eats a considerable amount of your bandwidth, with its bursts close to 60 percent of your shaped bandwidth (or rather since you are on ATM you only get around 9Mbps form your configured 10Mbps due to ATM&#039;s 48/53 encoding) I am not amazed that this is not going smoothly...<br /></p><div class="quotebox"><cite>mezo wrote:</cite><blockquote><div class="quotebox"><blockquote><p>Thanks, could you observe any differences for your test load, between dual and triple?</p></blockquote></div><p>not really tbh.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; I just realized that in your setup with sqm on wlan0 of the second router you need to use the WAN vartiants of the scripts as the LAN variants will in your case try to be fair to the external IP addresses. Could you please test again with the WAN dual-isolate script?<br /></p><div class="quotebox"><cite>mezo wrote:</cite><blockquote><div class="quotebox"><blockquote><p>But have you tried setting this up on the main router instead?</p></blockquote></div><p>the problem is, that my network is wifi only and this wouldnt help. <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; Why, all I propose is to instantiate sqm on the WLAN interface of your main router, the one you use to connect the secondary router. BTW, if there are computers directly connected to the main router in addition to the secondary router, shaping will occasionally fail as the shaper does not see some of the traffic that actually crosses the atm link, but I goes you are aware of that.<br /></p><div class="quotebox"><cite>mezo wrote:</cite><blockquote><div class="quotebox"><blockquote><p>Could you please try twitching from a different machine</p></blockquote></div><p>i will try, but same problem as above. my network is wifi only.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; This is somewhat important to test, as this is the only situation where cake&#039;s isolation modes can actually work for you.<br /></p><div class="quotebox"><cite>mezo wrote:</cite><blockquote><div class="quotebox"><blockquote><p>Mmh, so this is better, but not good enough yet. Which openwrt/LEDE version are you using?</p></blockquote></div><p>OpenWrt Designated Driver r49395</p></blockquote></div><p>Ah, okay, that should be recent enough.</p><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p331282">
				<div class="post-metadata">
					<div class="post-num">Post #23</div>
					<div class="post-author">mezo</div>
					<div class="post-datetime">
						12 Jul 2016, 13:35					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><blockquote><p>So this is just twitch?</p></blockquote></div><p>yes</p><div class="quotebox"><blockquote><p>This looks like it eats a considerable amount of your bandwidth, with its bursts close to 60 percent of your shaped bandwidth</p></blockquote></div><p>yes, but http traffic gets shaped down nicely, also when i go to 15mbit dl i have still the same problems.</p><div class="quotebox"><blockquote><p>Could you please test again with the WAN dual-isolate script?</p></blockquote></div><p>doesnt seems to work. feels like there is no qos enabled, while downloaing on steam.</p><div class="quotebox"><blockquote><p>Why, all I propose is to instantiate sqm on the WLAN interface of your main router, the one you use to connect the secondary router.</p></blockquote></div><p>what is the advantage over my way if i going this way? im the only &quot;pc&quot; except smartphones, raspberries who is causing traffic on wlan. the second pc is connected via lan to the main router. so all i would do is replace my second router with myself? i can try this, no problem.</p><p>do u have irc or something?</p>											<p class="post-edited">(Last edited by <strong>mezo</strong> on 12 Jul 2016, 13:35)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p331285">
				<div class="post-metadata">
					<div class="post-num">Post #24</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						12 Jul 2016, 14:31					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>mezo wrote:</cite><blockquote><div class="quotebox"><blockquote><p>So this is just twitch?</p></blockquote></div><p>yes</p><div class="quotebox"><blockquote><p>This looks like it eats a considerable amount of your bandwidth, with its bursts close to 60 percent of your shaped bandwidth</p></blockquote></div><p>yes, but http traffic gets shaped down nicely, also when i go to 15mbit dl i have still the same problems.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; I believe it is twitch that does not like its packages dropped, if you have a long data transfer via http the traffic pattern most likely looks differently, much smoother and with less differences than the twitch traffic shows, that basically switches between full throttle and 0 bps.<br /></p><div class="quotebox"><cite>mezo wrote:</cite><blockquote><div class="quotebox"><blockquote><p>Could you please test again with the WAN dual-isolate script?</p></blockquote></div><p>doesnt seems to work. feels like there is no qos enabled, while downloaing on steam.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; That sounds like something is wrong, you did re-flip the ingress and egress bandwidths in the GUI?<br /></p><div class="quotebox"><cite>mezo wrote:</cite><blockquote><div class="quotebox"><blockquote><p>Why, all I propose is to instantiate sqm on the WLAN interface of your main router, the one you use to connect the secondary router.</p></blockquote></div><p>what is the advantage over my way if i going this way? im the only &quot;pc&quot; except smartphones, raspberries who is causing traffic on wlan. the second pc is connected via lan to the main router. so all i would do is replace my second router with myself? i can try this, no problem.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; Well, the shaper should be instantiated as close to the real bottleneck link as possible, but due to the NAT issue setting it up on the WAN interface will not work well with, per IP isolation. Especially there should be no internet traffic sources and sinks between the shaper and the bottleneck link. If the WAN interface is not useable then the next interface in the chain should have the lowest side effects, this is why I recommend shaping on the main router.<br />&nbsp; &nbsp; &nbsp; &nbsp; Setting up sqm on the main router&#039;s wlan interface is not going to change much in your network&#039;s performance, if the only traffic over both involved wlan interfaces is the traffic between both routers.<br />&nbsp; &nbsp; &nbsp; &nbsp; The smartphones and the raspberries all connect to the secondary router via wlan1 I assume? The fact that the seconf PC is between sqm and the internet really makes it hard/impossible to guarantee decent SQM performance. I believe that twitch and steam on that PC should have massive impact on the usability of machines connected via the secondary router (which I assume is configured as dumb AP and not as NAT device).<br /></p><div class="quotebox"><cite>mezo wrote:</cite><blockquote><p>do u have irc or something?</p></blockquote></div><p>Sorry, I am pretty oldschool, so mostly email and the forum (and snce I am a slow typer, IRC would be painful for the other side anyways...)</p><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p331289">
				<div class="post-metadata">
					<div class="post-num">Post #25</div>
					<div class="post-author">mezo</div>
					<div class="post-datetime">
						12 Jul 2016, 15:19					</div>
				</div>
				<div class="post-content content">
					<p>i just tested everything on main router and set interface to wlan. i tested both _WAN_ and _LAN_ and steam goes always full speed.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0.001 -->

</body>
</html>