<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> ar9331&#039;s usb stability issue - [SOLVED]</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 23 Mar 2017 and 6 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 13</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=39956&amp;p=2.html">2</a></li><li><a href="viewtopic.php%3Fid=39956&amp;p=3.html">3</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39956&amp;p=13.html">13</a></li></ul></nav></div>
			
		
		
			<article class="post" id="p180758">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">lsoltero</div>
					<div class="post-datetime">
						16 Oct 2012, 21:20					</div>
				</div>
				<div class="post-content content">
					<p>Hello All,</p><p>we are experiencing USB issues with CDC/ACM and USB to Serial adapters connected to an Alfa Hornet-U board.&nbsp; This board is based on the Atheros 9331 chipset.&nbsp; &nbsp; </p><p>We are working with a very recent version of AA from trunk (33561)</p><p>The problem is very similar in nature to one reported for TP-LINK routers also based on the 9331 chipset.&nbsp; The interesting thing is that if a passive (non powered) USB 2.0 hub is used then CDC/ACM and USB to Serial adapters work fine. </p><p>Here is a full description of the problem and symptoms.</p><br /><p>When working withe USB we notice that when plugging in CDC/ACM devices (i.e. satellite terminals or GSM dongles) the USB port works for a bit and then becomes unresponsive.&nbsp; Resetting the USB port by unplugging the cable and putting it back in gets the device back on line. However, none of the devices plugged into the port will work sufficiently long to send data.&nbsp; You can connect to them with a terminal emulator (cu in our case) and type AT commands but as soon as you do an ATDT and get a CONNECT and ppp data starts moving through the internetface the serial port &#039;hangs&#039;.</p><p>The interesting thing is that we just noticed this... we have been working with the USB port extensively but always using a USB hub.&nbsp; The passive hub (i.e. not powered) has the CDC/ACM device plugged into it as well as a CMedia USB sound card.&nbsp; What is strange is that the Vitual serial port works perfectly.&nbsp; Data connections work without issue over the satellite phones in this configuration. </p><p>Googling the internet for this issue shows a few results.&nbsp; it seems that this is a fairly common problem with Atheros processors.</p><p>the tl-mr3040 is known to have this issue.<br /><a href="http://wiki.openwrt.org/toh/tp-link/tl-mr3040">http://wiki.openwrt.org/toh/tp-link/tl-mr3040</a></p><p>if you look on the openwrt site and scroll down to the hardware description you will find the following.</p><p>USB Issue</p><p>A problem has been detected with the USB interface on the device. When connected to different models of serial adaptor, it functions for a few minutes then fails. This can be resolved by putting a passive hub in-line with the device. Voltage and current testing will be performed to identify why this behaviour occurs.</p><p>this device is based on the AR9331 as is the Hornet.</p><p>Also<br /><a href="http://www.mail-archive.com/openwrt-devel@lists.openwrt.org/msg13693.html">http://www.mail-archive.com/openwrt-dev … 13693.html</a></p><p>if you look at the 5 entries in this list you will note that the AR9331 is not the only device that is having this issue.</p><p>this posting<br /><a href="http://www.mail-archive.com/openwrt-devel@lists.openwrt.org/msg13690.html">http://www.mail-archive.com/openwrt-dev … 13690.html</a></p><p>suggest that the problem has to do with hardware voltage and other possible issues with the board implementation. a link is included to a hardware mod discussion that presents the issue with the Atherus based boards.</p><br /><p>here is more detailed info on the USB problem we are having with CDC/ACM modems with the native serial port on the AP121U.</p><p>Here is a connection using a passive (non powered) 2.0 usb hub and an iridium phone.&nbsp; You will note that the connection works perfectly.&nbsp; Following that I will show logs for the same device connected directly to the Hornet-UB usb which fails.</p><p>------ USB HUB -- WORKING CONNECTION ----</p><br /><br /><p>This the kernel mesgs detecting the HUB</p><p>[&nbsp; 483.150000] usb 1-1: USB disconnect, device number 3<br />Oct 16 17:39:12 Optimizer kern.info kernel: [&nbsp; 483.150000] usb 1-1: USB disconnect, device number 3<br />[&nbsp; 493.450000] usb 1-1: new high-speed USB device number 4 using ehci-platform<br />[&nbsp; 493.600000] hub 1-1:1.0: USB hub found<br />[&nbsp; 493.600000] hub 1-1:1.0: 4 ports detected<br />Oct 16 17:39:22 Optimizer kern.info kernel: [&nbsp; 493.450000] usb 1-1: new high-speed USB device number 4 using ehci-platform<br />Oct 16 17:39:22 Optimizer kern.info kernel: [&nbsp; 493.600000] hub 1-1:1.0: USB hub found<br />Oct 16 17:39:22 Optimizer kern.info kernel: [&nbsp; 493.600000] hub 1-1:1.0: 4 ports detected</p><br /><p>this is the kernel msgs for detecting the USB ACM device.</p><p>[&nbsp; 528.330000] usb 1-1.2: new full-speed USB device number 5 using ehci-platform<br />[&nbsp; 528.450000] cdc_acm 1-1.2:1.0: ttyACM0: USB ACM device<br />Oct 16 17:39:57 Optimizer kern.info kernel: [&nbsp; 528.330000] usb 1-1.2: new full-speed USB device number 5 using ehci-platform<br />Oct 16 17:39:57 Optimizer kern.info kernel: [&nbsp; 528.450000] cdc_acm 1-1.2:1.0: ttyACM0: USB ACM device</p><p>here is a successful PPP connection...</p><p>Oct 16 17:40:21 Optimizer daemon.notice pppd[2018]: pppd 2.4.5 started by root, uid 0<br />Oct 16 17:40:22 Optimizer local2.info chat[2028]: abort on (BUSY)<br />Oct 16 17:40:22 Optimizer local2.info chat[2028]: abort on (VOICE)<br />Oct 16 17:40:22 Optimizer local2.info chat[2028]: abort on (NO CARRIER)<br />Oct 16 17:40:22 Optimizer local2.info chat[2028]: abort on (NO DIALTONE)<br />Oct 16 17:40:22 Optimizer local2.info chat[2028]: abort on (NO DIAL TONE)<br />Oct 16 17:40:22 Optimizer local2.info chat[2028]: timeout set to 10 seconds<br />Oct 16 17:40:22 Optimizer local2.info chat[2028]: send (AT^M)<br />Oct 16 17:40:22 Optimizer local2.info chat[2028]: expect (OK)<br />Oct 16 17:40:22 Optimizer local2.info chat[2028]: ^M<br />Oct 16 17:40:22 Optimizer local2.info chat[2028]: OK<br />Oct 16 17:40:22 Optimizer local2.info chat[2028]:&nbsp; -- got it<br />Oct 16 17:40:22 Optimizer local2.info chat[2028]: send (AT&amp;F^M)<br />Oct 16 17:40:22 Optimizer local2.info chat[2028]: expect (OK)<br />Oct 16 17:40:22 Optimizer local2.info chat[2028]: ^M<br />Oct 16 17:40:22 Optimizer local2.info chat[2028]: ^M<br />Oct 16 17:40:22 Optimizer local2.info chat[2028]: OK<br />Oct 16 17:40:22 Optimizer local2.info chat[2028]:&nbsp; -- got it<br />Oct 16 17:40:22 Optimizer local2.info chat[2028]: send (AT &amp;F E0 V1 &amp;D2 &amp;C1 W2 S95=47 S0=0 +cbst=71,0,1^M)<br />Oct 16 17:40:23 Optimizer local2.info chat[2028]: timeout set to 60 seconds<br />Oct 16 17:40:23 Optimizer local2.info chat[2028]: expect (OK)<br />Oct 16 17:40:23 Optimizer local2.info chat[2028]: ^M<br />Oct 16 17:40:23 Optimizer local2.info chat[2028]: AT &amp;F E0 V1 &amp;D2 &amp;C1 W2 S95=47 S0=0 +cbst=71,0,1^M^M<br />Oct 16 17:40:23 Optimizer local2.info chat[2028]: OK<br />Oct 16 17:40:23 Optimizer local2.info chat[2028]:&nbsp; -- got it<br />Oct 16 17:40:23 Optimizer local2.info chat[2028]: send (ATDT008816000025^M)<br />Oct 16 17:40:23 Optimizer local2.info chat[2028]: expect (CONNECT)<br />Oct 16 17:40:23 Optimizer local2.info chat[2028]: ^M<br />Oct 16 17:40:33 Optimizer local2.info chat[2028]: ^M<br />Oct 16 17:40:33 Optimizer local2.info chat[2028]: CARRIER 9600^M<br />Oct 16 17:40:33 Optimizer local2.info chat[2028]: ^M<br />Oct 16 17:40:33 Optimizer local2.info chat[2028]: PROTOCOL: IRLP^M<br />Oct 16 17:40:33 Optimizer local2.info chat[2028]: ^M<br />Oct 16 17:40:33 Optimizer local2.info chat[2028]: COMPRESSION: NONE^M<br />Oct 16 17:40:33 Optimizer local2.info chat[2028]: ^M<br />Oct 16 17:40:33 Optimizer local2.info chat[2028]: CONNECT<br />Oct 16 17:40:33 Optimizer local2.info chat[2028]:&nbsp; -- got it<br />Oct 16 17:40:33 Optimizer daemon.info pppd[2018]: Serial connection established.<br />Oct 16 17:40:33 Optimizer daemon.info pppd[2018]: Using interface ppp0<br />Oct 16 17:40:33 Optimizer daemon.notice pppd[2018]: Connect: ppp0 &lt;--&gt; /dev/ttyACM0<br />Oct 16 17:40:40 Optimizer daemon.info pppd[2018]: CHAP authentication succeeded<br />Oct 16 17:40:40 Optimizer daemon.notice pppd[2018]: CHAP authentication succeeded<br />Oct 16 17:40:46 Optimizer daemon.notice pppd[2018]: replacing old default route to eth1 [192.168.0.1]<br />Oct 16 17:40:46 Optimizer daemon.notice pppd[2018]: local&nbsp; IP address 192.168.21.75<br />Oct 16 17:40:46 Optimizer daemon.notice pppd[2018]: remote IP address 192.168.21.254<br />Oct 16 17:40:46 Optimizer daemon.notice pppd[2018]: primary&nbsp; &nbsp;DNS address 12.127.17.72<br />Oct 16 17:40:46 Optimizer daemon.notice pppd[2018]: secondary DNS address 204.97.212.10<br />Oct 16 17:40:48 Optimizer daemon.info pppd[2061]: CCP terminated by peer<br />Oct 16 17:40:48 Optimizer daemon.notice pppd[2061]: Compression disabled by peer.<br />Oct 16 17:40:56 Optimizer daemon.info pppd[2061]: Terminating on signal 15<br />Oct 16 17:40:56 Optimizer daemon.info pppd[2061]: Connect time 0.2 minutes.<br />Oct 16 17:40:56 Optimizer daemon.info pppd[2061]: Sent 12 bytes, received 12 bytes.<br />Oct 16 17:40:56 Optimizer daemon.notice pppd[2061]: restoring old default route to eth1 [192.168.0.1]<br />Oct 16 17:40:57 Optimizer daemon.notice pppd[2061]: Connection terminated.<br />Oct 16 17:40:58 Optimizer local2.info chat[2096]: abort on (BUSY)<br />Oct 16 17:40:58 Optimizer local2.info chat[2096]: abort on (VOICE)<br />Oct 16 17:40:58 Optimizer local2.info chat[2096]: abort on (NO CARRIER)<br />Oct 16 17:40:58 Optimizer local2.info chat[2096]: abort on (NO DIALTONE)<br />Oct 16 17:40:58 Optimizer local2.info chat[2096]: abort on (NO DIAL TONE)<br />Oct 16 17:40:58 Optimizer local2.info chat[2096]: timeout set to 10 seconds<br />Oct 16 17:40:58 Optimizer local2.info chat[2096]: send (+++^M)<br />Oct 16 17:40:58 Optimizer local2.info chat[2096]: expect (OK)<br />Oct 16 17:41:00 Optimizer local2.info chat[2096]: TUUUUUUUUUUUU^M<br />Oct 16 17:41:00 Optimizer local2.info chat[2096]: NO CARRIER<br />Oct 16 17:41:00 Optimizer local2.info chat[2096]:&nbsp; -- failed<br />Oct 16 17:41:00 Optimizer local2.info chat[2096]: Failed (NO CARRIER)<br />Oct 16 17:41:00 Optimizer daemon.warn pppd[2061]: disconnect script failed<br />Oct 16 17:41:01 Optimizer daemon.info pppd[2061]: Exit.</p><br /><p>-----------</p><br /><br /><p>Logs for DCD/ACM device directly connected to the AP121U which fails...</p><p>----- DIRECT CONNECTION --- FAILS ---</p><br /><br /><p>USB device is plugged into the system.<br />[&nbsp; 839.120000] usb 1-1: new full-speed USB device number 6 using ehci-platform<br />[&nbsp; 839.290000] cdc_acm 1-1:1.0: ttyACM0: USB ACM device<br />Oct 16 17:45:08 Optimizer kern.info kernel: [&nbsp; 839.120000] usb 1-1: new full-speed USB device number 6 using ehci-platform<br />Oct 16 17:45:08 Optimizer kern.info kernel: [&nbsp; 839.290000] cdc_acm 1-1:1.0: ttyACM0: USB ACM device</p><br /><p>the following commands are executed from the command line to make sure the device is working properly.<br />root@Optimizer:/sys/devices/platform/ehci-platform/usb1/1-1# echo 0 &gt; authorized<br />root@Optimizer:/sys/devices/platform/ehci-platform/usb1/1-1# echo 1 &gt; authorized</p><p>A PPPD session is started...</p><p>[&nbsp; 881.310000] cdc_acm 1-1:1.0: ttyACM0: USB ACM device<br />[&nbsp; 881.320000] usb 1-1: authorized to connect<br />Oct 16 17:45:50 Optimizer kern.info kernel: [&nbsp; 881.310000] cdc_acm 1-1:1.0: ttyACM0: USB ACM device<br />Oct 16 17:45:50 Optimizer kern.info kernel: [&nbsp; 881.320000] usb 1-1: authorized to connect<br />Oct 16 17:46:04 Optimizer daemon.notice pppd[2229]: pppd 2.4.5 started by root, uid 0<br />Oct 16 17:46:05 Optimizer local2.info chat[2240]: abort on (BUSY)<br />Oct 16 17:46:05 Optimizer local2.info chat[2240]: abort on (VOICE)<br />Oct 16 17:46:05 Optimizer local2.info chat[2240]: abort on (NO CARRIER)<br />Oct 16 17:46:05 Optimizer local2.info chat[2240]: abort on (NO DIALTONE)<br />Oct 16 17:46:05 Optimizer local2.info chat[2240]: abort on (NO DIAL TONE)<br />Oct 16 17:46:05 Optimizer local2.info chat[2240]: timeout set to 10 seconds<br />Oct 16 17:46:05 Optimizer local2.info chat[2240]: send (AT^M)<br />Oct 16 17:46:05 Optimizer local2.info chat[2240]: expect (OK)<br />Oct 16 17:46:05 Optimizer local2.info chat[2240]: ^M<br />Oct 16 17:46:05 Optimizer local2.info chat[2240]: OK<br />Oct 16 17:46:05 Optimizer local2.info chat[2240]:&nbsp; -- got it<br />Oct 16 17:46:05 Optimizer local2.info chat[2240]: send (AT&amp;F^M)<br />Oct 16 17:46:05 Optimizer local2.info chat[2240]: expect (OK)<br />Oct 16 17:46:05 Optimizer local2.info chat[2240]: ^M<br />Oct 16 17:46:05 Optimizer local2.info chat[2240]: ^M<br />Oct 16 17:46:05 Optimizer local2.info chat[2240]: OK<br />Oct 16 17:46:05 Optimizer local2.info chat[2240]:&nbsp; -- got it<br />Oct 16 17:46:05 Optimizer local2.info chat[2240]: send (AT &amp;F E0 V1 &amp;D2 &amp;C1 W2 S95=47 S0=0 +cbst=71,0,1^M)<br />Oct 16 17:46:06 Optimizer local2.info chat[2240]: timeout set to 60 seconds<br />Oct 16 17:46:06 Optimizer local2.info chat[2240]: expect (OK)<br />Oct 16 17:46:06 Optimizer local2.info chat[2240]: ^M<br />Oct 16 17:46:06 Optimizer local2.info chat[2240]: AT &amp;F E0 V1 &amp;D2 &amp;C1 W2 S95=47 S0=0 +cbst=71,0,1^M^M<br />Oct 16 17:46:06 Optimizer local2.info chat[2240]: OK<br />Oct 16 17:46:06 Optimizer local2.info chat[2240]:&nbsp; -- got it<br />Oct 16 17:46:06 Optimizer local2.info chat[2240]: send (ATDT008816000025^M)<br />Oct 16 17:46:06 Optimizer local2.info chat[2240]: expect (CONNECT)<br />Oct 16 17:46:06 Optimizer local2.info chat[2240]: ^M<br />Oct 16 17:47:06 Optimizer local2.info chat[2240]: alarm<br />Oct 16 17:47:06 Optimizer local2.info chat[2240]: Failed<br />Oct 16 17:47:06 Optimizer daemon.err pppd[2229]: Connect script failed<br />Oct 16 17:47:22 Optimizer daemon.info pppd[2229]: Exit.</p><p>the connection script failed... never got the CONNECT... yet the call was made and time was accumulating on the phone... Basically data stopped flowing through the interface...</p><br /><p>the following commands<br />root@Optimizer:/sys/devices/platform/ehci-platform/usb1/1-1# echo 0 &gt; authorized<br />root@Optimizer:/sys/devices/platform/ehci-platform/usb1/1-1# echo 1 &gt; authorized</p><p>now result in this error...</p><p>[&nbsp; 996.220000] usb 1-1: can&#039;t re-read device descriptor for authorization: -145<br />Oct 16 17:47:45 Optimizer kern.err kernel: [&nbsp; 996.220000] usb 1-1: can&#039;t re-read device descriptor for authorization: -145</p><p>so... the USB device is no longer responsive.</p><br /><p>--------</p><br /><p>Note that exactly the same happens when using a PL2303HX USB to serial adapter.&nbsp; So... it seems that whatever USB protocol is being used by all the serial adapters is at fault.&nbsp; We observe the same symptoms with any/all CDC/ACM and USB to Serial port adapters that we have tested.</p><p>However... when connected through a HUB everything works perfectly.</p><p>Any insight in to the problem would greatly be appreciated.</p><p>--luis</p>											<p class="post-edited">(Last edited by <strong>lsoltero</strong> on 17 Dec 2013, 00:16)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p180790">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">Squonk</div>
					<div class="post-datetime">
						17 Oct 2012, 08:59					</div>
				</div>
				<div class="post-content content">
					<p>I don&#039;t really bite at a board implementation problem, at least for the TL-WR703N router, which experiences this kind of problem: see my <a href="http://squonk42.github.com/TL-WR703N/">reverse-engineered schematic and layout</a>.</p><p>Concerning the USB physical implementation, it only consists in a 0 ohm series resistor (R101/R102), a footprint for an unmounted decoupling capacitor (R103/R104)and a dual-rail clamping diode (D1/D2) for each data line. As for the USB power, it comes straight from an unidentified USB power switch (U6) with current-limiting capabilities, and looks properly decoupled with 2 capacitors (C113/C115) placed close to the USB connector itself. Coupling between shield and ground is also pretty standard (C114). Traces seem to be properly routed, respecting a differential routing with matched lengths and impedances.</p><p>Another problem that may be related to this one is the inability to use USB low-speed devices, such as a low-end keyboard or mouse: the device does not even enumerate, showing repeated messages in the logs. If you connect it through a hub, you don&#039;t get the problem. However, I am not sure that the AR9331 USB hardware IP supports low-speed devices at all <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><p>I guess that the only way to continue investigating is to stick a USB analyzer in between and see what is going on.</p>											<p class="post-edited">(Last edited by <strong>Squonk</strong> on 17 Oct 2012, 09:01)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p180808">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">lsoltero</div>
					<div class="post-datetime">
						17 Oct 2012, 13:18					</div>
				</div>
				<div class="post-content content">
					<p>it would be nice to get a definitive answer on this.&nbsp; </p><p>another interesting fact is that the only issue we have seen is with the full speed USB serial devices.&nbsp; &nbsp; Testing with a full speed USB sound card works fine.&nbsp; We can record and play audio at 48Khz all day long with a number of different CM119 based devices without issue.</p><p>I am not an USB expert but understand that there are several different types of endpoints.&nbsp; It could be that only some of the USB 1.1 (2.0 full-speed) end points don&#039;t work with the 9331 chipset.&nbsp; This would explain why USB sound works but not USB serial ports.</p><p>It would be nice to know if anyone out there is using 9331 based systems where USB 2.0/full-speed are working.&nbsp; &nbsp;I know that many of the TL routers advertise themselves as 3G routers.&nbsp; Most of the 3G modems use CDC/ACM interfaces.&nbsp; It would be good to know if users with 9331 based TL routers are able to use 3G modems while running OpenWRT AA.</p><p>Although I agree that it is unlikely that the issue is with the board implementation there could still be a problem with the chipset implementation.&nbsp; I am hoping that the problem is with the echi USB driver but not sure if it is at this time.</p><p>--luis</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p181719">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">Squonk</div>
					<div class="post-datetime">
						29 Oct 2012, 09:43					</div>
				</div>
				<div class="post-content content">
					<p>There is definitely a bug in the hardware USB block.</p><p>I ran a simple test with an Arduino Duemilanove or a Vinciduino running <a href="http://bitlash.net/">bitlash</a> with the following simple bitlash script on the Arduino:</p><div class="codebox"><pre><code>function toggle13 {d13 = !d13;print i;i = i + 1;}
function startup {pinmode(13,1); run toggle13,1000;}</code></pre></div><p>...that is, blink the LED every second while incrementing and printing a monotonic counter at the same rate on the UART via USB.</p><p>On the TP-LINK TL-WR703N side, I just have the driver module corresponding to the facing USB chip in the Arduino (<strong>ftdi_sio</strong> + <strong>usbserial</strong> as <strong>/dev/ttyUSB0</strong> for the Duemilanove, <strong>cdc_acm</strong> as <strong>/dev/ttyACM0</strong> for the Vinciduino), and the simple BusyBox&#039;s &quot;<strong>microcom</strong>&quot; terminal emulator (&quot;<strong>microcom -s 57600 /dev/ttyUSB0</strong>&quot; for the Duemilanove, &quot;<strong>microcom -s 57600 /dev/ttyACM0</strong>&quot; for the Vinciduino).</p><p>The communication hangs after a variable amount of time (ranging from a few minutes up to an hour), depicted by the Arduino&#039;s TX LED staying permanently on. The Arduino is still running however, as the d13 Led continues to flash steadily every second.</p><p>No matter if you exit from microcom, from your session, or remove the driver modules and reinsert it, the communication with the Arduino board does not work anymore. The only way to restore things back to a working condition is to toggle the Arduino power. If they are powered from the USB, it is achieved by issuing the commands:</p><div class="codebox"><pre><code>echo 0 &gt; /sys/classes/gpio/gpio8/value
echo 1 &gt; /sys/classes/gpio/gpio8/value</code></pre></div><p>I found out that if you insert a passive USB hub like the one described in this <a href="https://forum.openwrt.org/viewtopic.php?id=34188">topic</a>, you can run the exact same test for more than 10 hours without a glitch... I can even run <strong>BOTH</strong> Arduino boards at the same time without problem!</p><p>From this, we can draw the following conclusions:<br /></p><ul><li><p>the Arduino is working like a Swiss cuckoo clock <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p></li><li><p>this is not a power supply problem, as I was able to run the USB passive hub + the 2 Arduino boards at the same time</p></li><li><p>this is not an applicative software problem on the TP-LINK TL-WR703N side, as the software is exactly the same in both cases</p></li><li><p>if this is a software problem, it is a very low-level one related to different timing/protocol differences between the direct/through hub configurations, but not in the USB driver itself, as it does the same bug in both the ftdi_sio + usbserial and the cdc_acm drivers, so it is in the very low-level interrupt handling/register access/DMA, etc.</p></li><li><p>more probably, this is a hardware USB block bug <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p></li></ul><p>This last conclusion only confirms that the USB block within the AR9331 is not very good, as I already found out that the AR9331 is not capable of handling USB low-speed devices like a simple keyboard or mouse directly, but it works ok through a passive hub.</p><p>The solution: <strong>ALWAYS</strong> insert a passive hub, like the <a href="http://www.ebay.co.uk/itm/190540919713">&quot;Octopus&quot;</a>, which includes a <a href="http://www.genesyslogic.com/manage/upfile/12052255151.pdf">GL850G USB hub chip in SSOP28 package</a>. Beware that there are <a href="http://www.ebay.co.uk/itm/250763987476">some items</a> looking exactly the same externally, but that contain a chip die directly bonded to the PCB and blobbed into silicon instead of the SSOP28 package. It is not important if you just use the hub as is, but it is a pain if you want to unsolder the chip for a hack... It is about the same price you pay for the chip alone, but you get extra USB cable + hanging plugs, a reusable plastic case, and a PCB with a crystal <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>The fact that USB sound works and not USB serial ports is not related to different endpoints, but it may be related to the USB transaction type: for serial communications, error-free &quot;bulk&quot; transactions are used with error detection and retry as reliable transmission is required, while sound (or video) data are using &quot;isochronous&quot; transactions which do not guarantee error-free transmission, as usually this kind of data can suffer some glitches without being noticed.</p><p>It is just a guess, but given the random nature of the bug, it looks like there is a problem when a transmission error occurs in the retry mechanism, only present in the &quot;bulk&quot; transactions. This may only be confirmed by inserting TRANSPARENTLY an USB protocol analyzer in-between an Arduino board and the TP-LINK TL-WR703N router.</p>											<p class="post-edited">(Last edited by <strong>Squonk</strong> on 29 Oct 2012, 09:47)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p181730">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">lsoltero</div>
					<div class="post-datetime">
						29 Oct 2012, 15:40					</div>
				</div>
				<div class="post-content content">
					<p>I am currently working with boards from TP-LINK and Alfa.&nbsp; The TP-LINK is a MR3040 and the alfa boards are Hornet-UB both based on the AR9331 chipset.&nbsp; &nbsp;I just refreshed the OpenWRT AA sources and currently running r3397. The same image has been installed the same image on all boards routers.</p><p>What is interesting is that the CDC/ACM and USB to serial adapters (PL2303hx based) worked fine for the MR3040.&nbsp; On the Alfa boards I have one that consistently fails for all the devices tested but works fine if the devices are plugged into a USB 2.0 hub.&nbsp; The other Alfa board works fine.&nbsp; </p><p>So... i am now wondering if the issue has been addressed in newer releases of the Athrus chipsets and the problem is hit or miss based on the age of the board.&nbsp; However, the processor on both alfa boards is identical... The chip is identified as</p><p>Alpha-Hornet-UB<br />AR9331-AL1A<br />PFH104.006B<br />1153<br />Taiwan</p><p>so i wonder if its an issue with the supporting circuitry? however, I can&#039;t see any discernible differences between the boards.&nbsp; &nbsp;and both board part and rev levels are identical.&nbsp; As far as I can tell both boards are identical. I have sent the serial and batch numbers to Alfa and currently waiting to hear from them.&nbsp; </p><p>Interestingly the TP-LINK processor is made in Korea while the one used in the Hornet is manufactured in Taiwan.<br />AR9331-AL1A<br />PFU609.001C<br />1205<br />Korea</p><p>Bottom line... i have one alfa board that fails consistently and only works if USB 1.1 devices are plugged into a HUB.&nbsp; I have a second alfa board that works fine with USB 1.1 devices.&nbsp; I also have a TPL-MR3040 that works fine with USB 1.1 devices.</p><p>Any thoughts are greatly appreciated.</p><p>--luis</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p181733">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">Squonk</div>
					<div class="post-datetime">
						29 Oct 2012, 16:01					</div>
				</div>
				<div class="post-content content">
					<p>I tested with a TP-LINK TL-WR703N Rev 1.3 (PCB Rev 1.1, but there is only one revision anyway, except for a few 1.0 PCB boards that are hard to find).</p><p>My AR9331 chip is identified as:<br />AR9331-AL1A<br />PBA262.003B<br />1126<br />Taiwan</p><p>So it is even older than your Alpha-Hornet-UB ones.</p><p>I have a second TP-LINK TL-WR703N Rev 1.6 (PCB Rev 1.1 too), marked as:<br />AR9331-AL1A<br />PHP569.003C<br />1221<br />Korea</p><p>So Let me perform the same tests with this one and I will let you know about the results.</p><p>But you are right, Atheros switched their manufacturing from Taiwan to Korea between week 53 of 2011 and week 5 of 2012. Probably from TSMC to Samsung <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p181735">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">TheRaster</div>
					<div class="post-datetime">
						29 Oct 2012, 16:16					</div>
				</div>
				<div class="post-content content">
					<p>Do any of you think that this is the problem I am having with my router droping internet Topic here <a href="https://forum.openwrt.org/viewtopic.php?id=40178">https://forum.openwrt.org/viewtopic.php?id=40178</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p181737">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">Squonk</div>
					<div class="post-datetime">
						29 Oct 2012, 16:20					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>TheRaster wrote:</cite><blockquote><p>Do any of you think that this is the problem I am having with my router droping internet Topic here <a href="https://forum.openwrt.org/viewtopic.php?id=40178">https://forum.openwrt.org/viewtopic.php?id=40178</a></p></blockquote></div><p>Possibly...</p><p>Can you tell us the marking on the AR9331 main chip (of course, you will have to open the case for that...)?</p><p>It may also be interesting to perform the same test using the original firmware on the same device.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p181747">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">TheRaster</div>
					<div class="post-datetime">
						29 Oct 2012, 16:51					</div>
				</div>
				<div class="post-content content">
					<p>ORG FW works fine on all workings. I changed to wrt because the org fw taken the piss to find the modem and connect to it. on a reboot it taken around 4-6 mins to connect to the net. With wrt its up as soon as the router boots.<br /><a href="http://img441.imageshack.us/i/dsc0033wp.jpg/"><span class="postimg"><img src="http://img441.imageshack.us/img441/3808/dsc0033wp.th.jpg" alt="http://img441.imageshack.us/img441/3808/dsc0033wp.th.jpg" /></span></a><br /><a href="http://img43.imageshack.us/i/dsc0034lm.jpg/"><span class="postimg"><img src="http://img43.imageshack.us/img43/3788/dsc0034lm.th.jpg" alt="http://img43.imageshack.us/img43/3788/dsc0034lm.th.jpg" /></span></a></p><p>Not shore its the same chip as in the one you have but seems to be the same problem.</p><p>Sorry for crappy images shakey hands lmao <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /></p><p>Router is TP-MR3420</p><p>Hope this helps.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p181769">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">Squonk</div>
					<div class="post-datetime">
						29 Oct 2012, 18:26					</div>
				</div>
				<div class="post-content content">
					<p>Ok, thanks!</p><p>Unfortunately, the chip we are interested in is below the big heatsink <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><p>But it is good to know that the original firmware worked correctly: they certainly applied a software workaround that is not in the open-source kernel...</p><p>At least, there is still a hope to correct this bug by software!</p>											<p class="post-edited">(Last edited by <strong>Squonk</strong> on 29 Oct 2012, 18:27)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p181775">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">TheRaster</div>
					<div class="post-datetime">
						29 Oct 2012, 19:15					</div>
				</div>
				<div class="post-content content">
					<p>I have been wondering if it is a power problem with the USB. Do you know of any good powered usb hubs that are supported by wrt? I wish to get one any how for other things. But worth a test.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p181782">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">Squonk</div>
					<div class="post-datetime">
						29 Oct 2012, 20:16					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>TheRaster wrote:</cite><blockquote><p>I have been wondering if it is a power problem with the USB. Do you know of any good powered usb hubs that are supported by wrt? I wish to get one any how for other things. But worth a test.</p></blockquote></div><p>It is not a power problem, see my post above: it works with a passive USB hub and 2 Arduino boards, whereas it hangs with a single Arduino board.</p><p>I tried with my second TP-LINK TL-WR703N Rev 1.6 (PCB Rev 1.1) without passive USB hub: it crashed after 1h32, so the bug is still present in chips manufactured in Korea as late as end of May 2012 <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p181784">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">TheRaster</div>
					<div class="post-datetime">
						29 Oct 2012, 21:00					</div>
				</div>
				<div class="post-content content">
					<p><img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> Shame it was not so simple..... What hub do you use? I am wanting to get one to mount a HD and a 2nd dongle see if I can get faster net <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p181785">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">robthebrew</div>
					<div class="post-datetime">
						29 Oct 2012, 21:29					</div>
				</div>
				<div class="post-content content">
					<p>Seems following Squonk&#039;s advice works: router--passive hub--driven hub. YMMV</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p181796">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">Squonk</div>
					<div class="post-datetime">
						30 Oct 2012, 00:33					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>TheRaster wrote:</cite><blockquote><p><img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> Shame it was not so simple..... What hub do you use? I am wanting to get one to mount a HD and a 2nd dongle see if I can get faster net <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /></p></blockquote></div><p>Please check the links I provide in my post above <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>I use the &quot;Octopus&quot;, that can be mounted into the WR703N case like described in this topic: <a href="https://forum.openwrt.org/viewtopic.php?id=34188.">https://forum.openwrt.org/viewtopic.php?id=34188.</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p181798">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">lsoltero</div>
					<div class="post-datetime">
						30 Oct 2012, 00:47					</div>
				</div>
				<div class="post-content content">
					<p>Here is more info...</p><p>i went through our pile of brand new Alfa AP121 and programmed and tested every single one of them. One unit is the orinal unit that i got earlier and fails. the other 7 are brand new from the same batch received 5 days ago.</p><p>4 work perfectly with USB 1.1 devices plugged into the native port<br />4 fail immediately when USB 1.1 devices are plugged into the native port.</p><p>all work perfectly when using a USB 2 HUB.</p><p>all units were teste back to back using the same power supply, same USB 1.1 modem, same firmware, same computer.&nbsp; &nbsp;BTW... i am using a 30Amp power supply running at 13.8 volts... so i know its not a power issue.</p><p>All the AP121U were manufactured in Taiwan.&nbsp; Looking at the boards all the part numbers and batch numbers are the same.&nbsp; I can&#039;t physically distinguish between one and the other.&nbsp; They are all identical as far as I can tell.</p><p>I have ordered a few MR3040 to see if I can get any of these routers to fail.</p><p>One thing I did notice is that the TP-LINK has an AR9331 manufactured in Korea.&nbsp; TP-Link sells the mr3040 as a mobile 3G routers supporting manu CDC/ACM devices... So... either they have a software patch that makes the AR9331 work correctly OR the Korean made AR9331 chips work properly OR there is some hardware patch that they have figured out to make the issue work.</p><p>more soon...</p><p>--luis</p>											<p class="post-edited">(Last edited by <strong>lsoltero</strong> on 30 Oct 2012, 00:50)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p181799">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">Squonk</div>
					<div class="post-datetime">
						30 Oct 2012, 00:51					</div>
				</div>
				<div class="post-content content">
					<p>Thanks Luis for performing all these tests!</p><p>No: I tested one WR703N router with a new Korean chip, and it failed the same as the older Taiwanese one.</p><p>And hardware-wise, the USB goes straight to the connector through 0 ohm series resistors, with unpopulated resistors to ground and dual clamping diodes, all using impedance-controlled traces, so nothing to expect on this side, see my reverse engineering of the TL-WR703N:<br /><a href="http://squonk42.github.com/TL-WR703N/">http://squonk42.github.com/TL-WR703N/</a></p><p>So this must be a hardware bug inside the AR9331, that is corrected by a workaround patch not available in the open source Linux kernel.</p>											<p class="post-edited">(Last edited by <strong>Squonk</strong> on 30 Oct 2012, 01:01)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p181800">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">Squonk</div>
					<div class="post-datetime">
						30 Oct 2012, 01:09					</div>
				</div>
				<div class="post-content content">
					<p>Actually, you can see in the kernel source tree if you try to build your own OpenWrt distro (build_dir/linux-ar71xx_generic/linux-3.3.8/arch/mips/ath79/dev-usb.c), that there are indeed some workarounds for some Atheros chips USB bugs:</p><p>For example in ath79_usb_setup():</p><div class="codebox"><pre><code>    /* Turning on the Buff and Desc swap bits */
    __raw_writel(0xf0000, usb_ctrl_base + AR71XX_USB_CTRL_REG_CONFIG);

    /* WAR for HW bug. Here it adjusts the duration between two SOFS */
    __raw_writel(0x20c00, usb_ctrl_base + AR71XX_USB_CTRL_REG_FLADJ);</code></pre></div><p>... But nothing for the AR933x chip <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p>											<p class="post-edited">(Last edited by <strong>Squonk</strong> on 30 Oct 2012, 01:09)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p181802">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">lsoltero</div>
					<div class="post-datetime">
						30 Oct 2012, 02:08					</div>
				</div>
				<div class="post-content content">
					<p>Well the fact that there are bug works arounds for other Athrus based processors gives me hope that a software work around might be possible.&nbsp; Has any one examined the TP-LINK source code carefully?&nbsp; its available here<br /><a href="http://www.tp-link.com/en/support/gpl/?categoryid=547">http://www.tp-link.com/en/support/gpl/?categoryid=547</a> </p><p>It could be that the required patch is buried in the the kernel source tree.</p><p>what is killing me here is that for our application routers that fail fail immediately while routers that work seem to work fine.&nbsp; </p><p>--luis</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p181818">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">Squonk</div>
					<div class="post-datetime">
						30 Oct 2012, 08:16					</div>
				</div>
				<div class="post-content content">
					<p>Let me check the kernel sources from TP-LINK and possibly from other vendors using the AR9331.</p><p>EDIT: I checked the kernel sources provided by TP-LINK from the link above and also from the <a href="http://gpl.back2roots.org/source/fritzbox/7270_5.05/GPL-release_kernel/linux/">Fritzbox 7270</a>, but there is nothing regarding USB.</p>											<p class="post-edited">(Last edited by <strong>Squonk</strong> on 30 Oct 2012, 10:44)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p181851">
				<div class="post-metadata">
					<div class="post-num">Post #21</div>
					<div class="post-author">Squonk</div>
					<div class="post-datetime">
						30 Oct 2012, 14:23					</div>
				</div>
				<div class="post-content content">
					<p>I managed to compile &quot;usbmon&quot; on the TL-WR703N in order to track the bug.</p><p>The format for the usbmon output is documented here: <a href="http://www.kernel.org/doc/Documentation/usb/usbmon.txt">http://www.kernel.org/doc/Documentation/usb/usbmon.txt</a></p><p>The full compressed log is here: <a href="http://dl.free.fr/iokffINVE">http://dl.free.fr/iokffINVE</a></p><p>But here are the useful chunks excerpt from it:<br /></p><div class="codebox"><pre><code>### echo 1 &gt; /sys/classes/gpio/gpio8/value

80dac680 2948836581 C Ii:1:001:1 0:2048 1 = 02
80dac680 2948836624 S Ii:1:001:1 -150:2048 4 &lt;
819cc300 2948836817 S Ci:1:001:0 s a3 00 0000 0001 0004 4 &lt;
819cc300 2948836830 C Ci:1:001:0 0 4 = 01010100
819cc300 2948836840 S Co:1:001:0 s 23 01 0010 0001 0000 0
819cc300 2948836844 C Co:1:001:0 0 0
819cc300 2948836851 S Ci:1:001:0 s a3 00 0000 0001 0004 4 &lt;
819cc300 2948836854 C Ci:1:001:0 0 4 = 01010000
819cc300 2948873603 S Ci:1:001:0 s a3 00 0000 0001 0004 4 &lt;
819cc300 2948873626 C Ci:1:001:0 0 4 = 01010000
819cc300 2948913601 S Ci:1:001:0 s a3 00 0000 0001 0004 4 &lt;
819cc300 2948913624 C Ci:1:001:0 0 4 = 01010000
819cc300 2948953620 S Ci:1:001:0 s a3 00 0000 0001 0004 4 &lt;
819cc300 2948953644 C Ci:1:001:0 0 4 = 01010000
819cc300 2948993601 S Ci:1:001:0 s a3 00 0000 0001 0004 4 &lt;
819cc300 2948993624 C Ci:1:001:0 0 4 = 01010000
819ccd00 2948993678 S Co:1:001:0 s 23 03 0004 0001 0000 0
819ccd00 2948993682 C Co:1:001:0 0 0
80dac680 2949048700 C Ii:1:001:1 0:2048 1 = 02
80dac680 2949048719 S Ii:1:001:1 -150:2048 4 &lt;
819ccd00 2949053680 S Ci:1:001:0 s a3 00 0000 0001 0004 4 &lt;
819ccd00 2949053703 C Ci:1:001:0 0 4 = 03010000
819ccd00 2949113600 S Co:1:001:0 s 23 01 0014 0001 0000 0
819ccd00 2949113620 C Co:1:001:0 0 0
819cca00 2949119182 S Ci:1:000:0 s 80 06 0100 0000 0040 64 &lt;
819cca00 2949120705 C Ci:1:000:0 0 8 = 12010002 00000008
819ccd00 2949120826 S Co:1:001:0 s 23 03 0004 0001 0000 0
819ccd00 2949120836 C Co:1:001:0 0 0
819ccd00 2949173612 S Ci:1:001:0 s a3 00 0000 0001 0004 4 &lt;
819ccd00 2949173647 C Ci:1:001:0 0 4 = 03011000
819ccd00 2949233629 S Co:1:001:0 s 23 01 0014 0001 0000 0
819ccd00 2949233649 C Co:1:001:0 0 0
819ccd00 2949233663 S Co:1:000:0 s 00 05 0006 0000 0000 0
819ccd00 2949235703 C Co:1:000:0 0 0
819ccd00 2949263609 S Ci:1:006:0 s 80 06 0100 0000 0012 18 &lt;
819ccd00 2949264705 C Ci:1:006:0 0 18 = 12010002 00000008 03040160 00060102 0301
819ccd00 2949264854 S Ci:1:006:0 s 80 06 0600 0000 000a 10 &lt;
819ccd00 2949265707 C Ci:1:006:0 -32 0
819ccd00 2949265965 S Ci:1:006:0 s 80 06 0600 0000 000a 10 &lt;
819ccd00 2949266710 C Ci:1:006:0 -32 0
819ccd00 2949267146 S Ci:1:006:0 s 80 06 0600 0000 000a 10 &lt;
819ccd00 2949267709 C Ci:1:006:0 -32 0
81b1a980 2949268024 S Ci:1:006:0 s 80 06 0200 0000 0009 9 &lt;
81b1a980 2949268708 C Ci:1:006:0 0 9 = 09022000 010100a0 2d
81aab200 2949268871 S Ci:1:006:0 s 80 06 0200 0000 0020 32 &lt;
81aab200 2949269703 C Ci:1:006:0 0 32 = 09022000 010100a0 2d090400 0002ffff ff020705 81024000 00070502 02400000
819ccd00 2949270335 S Ci:1:006:0 s 80 06 0300 0000 00ff 255 &lt;
819ccd00 2949270708 C Ci:1:006:0 0 4 = 04030904
819ccd00 2949271237 S Ci:1:006:0 s 80 06 0302 0409 00ff 255 &lt;
819ccd00 2949273703 C Ci:1:006:0 0 32 = 20034600 54003200 33003200 52002000 55005300 42002000 55004100 52005400
81aaa900 2949274117 S Ci:1:006:0 s 80 06 0301 0409 00ff 255 &lt;
81aaa900 2949275705 C Ci:1:006:0 0 10 = 0a034600 54004400 4900
81aaad80 2949275845 S Ci:1:006:0 s 80 06 0303 0409 00ff 255 &lt;
81aaad80 2949277705 C Ci:1:006:0 0 18 = 12034100 36003000 30006100 65005800 5000
819ccd00 2949278266 S Co:1:006:0 s 00 09 0001 0000 0000 0
819ccd00 2949278705 C Co:1:006:0 0 0
80febc00 2949280425 S Ci:1:006:0 s 80 06 0302 0409 00ff 255 &lt;
80febc00 2949282710 C Ci:1:006:0 0 32 = 20034600 54003200 33003200 52002000 55005300 42002000 55004100 52005400
81aaad00 2949310171 S Ci:1:006:0 s c0 0a 0000 0000 0001 1 &lt;
81aaad00 2949310706 C Ci:1:006:0 0 1 = 10
81a92980 2949313673 S Co:1:006:0 s 40 09 0001 0000 0000 0
81a92980 2949314707 C Co:1:006:0 0 0
81b10b80 2949322106 S Ci:1:001:0 s a3 00 0000 0001 0004 4 &lt;
81b10b80 2949322133 C Ci:1:001:0 0 4 = 03010000</code></pre></div><p>...<br /></p><div class="codebox"><pre><code>### microcom -s 57600 /dev/ttyUSB0
### bitlash here! v2.0 RC5pre (c) 2011 Bill Roy -type HELP- 953 bytes free
### &gt; 0
### 1
### 2
### 3
### 4
### 5
### 6
### 7
### 8

81b3db80 2953804840 S Co:1:006:0 s 40 00 0000 0000 0000 0
81b3db80 2953806722 C Co:1:006:0 0 0
81b3db80 2953807442 S Co:1:006:0 s 40 04 0008 0000 0000 0
81b3db80 2953808727 C Co:1:006:0 0 0
81b3db80 2953809570 S Co:1:006:0 s 40 03 0034 0000 0000 0
81b3db80 2953810731 C Co:1:006:0 0 0
81b3db80 2953811799 S Co:1:006:0 s 40 01 0303 0000 0000 0
81b3db80 2953812742 C Co:1:006:0 0 0
81b3db80 2953813773 S Co:1:006:0 s 40 02 0000 0000 0000 0
81b3db80 2953814725 C Co:1:006:0 0 0
80feb100 2953815074 S Bi:1:006:1 -150 512 &lt;
80febb00 2953815111 S Bi:1:006:1 -150 512 &lt;
81b3d980 2953815135 S Co:1:006:0 s 40 01 0303 0000 0000 0
80feb100 2953815725 C Bi:1:006:1 0 2 = 0160
80feb100 2953815745 S Bi:1:006:1 -150 512 &lt;
80febb00 2953815764 C Bi:1:006:1 0 2 = 0160
80febb00 2953815768 S Bi:1:006:1 -150 512 &lt;
81b3d980 2953815780 C Co:1:006:0 0 0
81b3d980 2953816260 S Co:1:006:0 s 40 02 0000 0000 0000 0
80feb100 2953816725 C Bi:1:006:1 0 2 = 0160
80feb100 2953816745 S Bi:1:006:1 -150 512 &lt;
80febb00 2953816767 C Bi:1:006:1 0 2 = 0160
80febb00 2953816771 S Bi:1:006:1 -150 512 &lt;
81b3d980 2953816784 C Co:1:006:0 0 0
80feb100 2953818725 C Bi:1:006:1 0 2 = 0160
80feb100 2953818751 S Bi:1:006:1 -150 512 &lt;
80febb00 2953818776 C Bi:1:006:1 0 2 = 0160
80febb00 2953818779 S Bi:1:006:1 -150 512 &lt;
80feb100 2953820719 C Bi:1:006:1 0 2 = 0160
80feb100 2953820745 S Bi:1:006:1 -150 512 &lt;</code></pre></div><p>...<br /></p><div class="codebox"><pre><code>80feb100 2955266733 C Bi:1:006:1 0 2 = 0160
80feb100 2955266763 S Bi:1:006:1 -150 512 &lt;
80febb00 2955267728 C Bi:1:006:1 0 2 = 0160
80febb00 2955267759 S Bi:1:006:1 -150 512 &lt;
80feb100 2955268731 C Bi:1:006:1 0 5 = 01606269 74
80feb100 2955268772 S Bi:1:006:1 -150 512 &lt;
80febb00 2955269753 C Bi:1:006:1 0 8 = 01606c61 73682068
80febb00 2955269791 S Bi:1:006:1 -150 512 &lt;
80feb100 2955270734 C Bi:1:006:1 0 8 = 01606572 65212076
80feb100 2955270764 S Bi:1:006:1 -150 512 &lt;
80febb00 2955271732 C Bi:1:006:1 0 8 = 0160322e 30205243
80febb00 2955271757 S Bi:1:006:1 -150 512 &lt;
80feb100 2955272728 C Bi:1:006:1 0 7 = 01603570 726520
80feb100 2955272750 S Bi:1:006:1 -150 512 &lt;
80febb00 2955273728 C Bi:1:006:1 0 8 = 01602863 29203230
80febb00 2955273766 S Bi:1:006:1 -150 512 &lt;
80feb100 2955274734 C Bi:1:006:1 0 8 = 01603131 2042696c
80feb100 2955274766 S Bi:1:006:1 -150 512 &lt;
80febb00 2955275734 C Bi:1:006:1 0 8 = 01606c20 526f7920
80febb00 2955275775 S Bi:1:006:1 -150 512 &lt;
80feb100 2955276734 C Bi:1:006:1 0 8 = 01602d74 79706520
80feb100 2955276775 S Bi:1:006:1 -150 512 &lt;
80febb00 2955277734 C Bi:1:006:1 0 8 = 01604845 4c502d20
80febb00 2955277775 S Bi:1:006:1 -150 512 &lt;
80feb100 2955278731 C Bi:1:006:1 0 8 = 01603935 33206279
80feb100 2955278764 S Bi:1:006:1 -150 512 &lt;
80febb00 2955279728 C Bi:1:006:1 0 8 = 01607465 73206672
80febb00 2955279769 S Bi:1:006:1 -150 512 &lt;
80feb100 2955280733 C Bi:1:006:1 0 7 = 01606565 0d0a3e
80feb100 2955280769 S Bi:1:006:1 -150 512 &lt;
80febb00 2955281734 C Bi:1:006:1 0 3 = 016020
80febb00 2955281765 S Bi:1:006:1 -150 512 &lt;
80feb100 2955282734 C Bi:1:006:1 0 2 = 0160
80feb100 2955282766 S Bi:1:006:1 -150 512 &lt;
80febb00 2955283726 C Bi:1:006:1 0 2 = 0160
80febb00 2955283749 S Bi:1:006:1 -150 512 &lt;
80feb100 2955284730 C Bi:1:006:1 0 2 = 0160
80feb100 2955284760 S Bi:1:006:1 -150 512 &lt;</code></pre></div><p>...<br /></p><div class="codebox"><pre><code>80febb00 2964611786 C Bi:1:006:1 0 2 = 0160
80febb00 2964611816 S Bi:1:006:1 -150 512 &lt;
80feb100 2964612787 C Bi:1:006:1 0 2 = 0160
80feb100 2964612816 S Bi:1:006:1 -150 512 &lt;
80febb00 2964613781 C Bi:1:006:1 0 2 = 0160
80febb00 2964613810 S Bi:1:006:1 -150 512 &lt;
80feb100 2964614787 C Bi:1:006:1 0 2 = 0160
80feb100 2964614815 S Bi:1:006:1 -150 512 &lt;
80febb00 2964615784 C Bi:1:006:1 0 2 = 0160
80febb00 2964615811 S Bi:1:006:1 -150 512 &lt;
80feb100 2964616785 C Bi:1:006:1 0 2 = 0160
80feb100 2964616815 S Bi:1:006:1 -150 512 &lt;

### CRASH

### echo 0 &gt;/sys/classes/gpio/gpio8/value

80febb00 2987549051 C Bi:1:006:1 -79 0
80dac680 2987549075 C Ii:1:001:1 0:2048 1 = 02
80dac680 2987549088 S Ii:1:001:1 -150:2048 4 &lt;
81b3d980 2987549253 S Ci:1:001:0 s a3 00 0000 0001 0004 4 &lt;
81b3d980 2987549266 C Ci:1:001:0 0 4 = 00010100
81b3d980 2987549276 S Co:1:001:0 s 23 01 0010 0001 0000 0
81b3d980 2987549280 C Co:1:001:0 0 0
80feb100 2987553001 C Bi:1:006:1 -143 0
81b3de80 2987566352 S Ci:1:001:0 s a3 00 0000 0001 0004 4 &lt;
81b3de80 2987566366 C Ci:1:001:0 0 4 = 00010000
81aaad80 2987603613 S Ci:1:001:0 s a3 00 0000 0001 0004 4 &lt;
81aaad80 2987603634 C Ci:1:001:0 0 4 = 00010000
81aaad80 2987643602 S Ci:1:001:0 s a3 00 0000 0001 0004 4 &lt;
81aaad80 2987643625 C Ci:1:001:0 0 4 = 00010000
81b3d000 2987683698 S Ci:1:001:0 s a3 00 0000 0001 0004 4 &lt;
81b3d000 2987683721 C Ci:1:001:0 0 4 = 00010000
81aab200 2987723605 S Ci:1:001:0 s a3 00 0000 0001 0004 4 &lt;
81aab200 2987723627 C Ci:1:001:0 0 4 = 00010000</code></pre></div><p>Does anybody have a clue regarding the &quot;-79&quot; status value on the callback line after the crash?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p181924">
				<div class="post-metadata">
					<div class="post-num">Post #22</div>
					<div class="post-author">lsoltero</div>
					<div class="post-datetime">
						31 Oct 2012, 03:56					</div>
				</div>
				<div class="post-content content">
					<p>hello all,</p><p>here is more info... so... i acquired two brand new tp-link mr3040 for a total of 3 now.&nbsp; I installed AA on the new units (same build as previous) and all 3 routers work perfectly with our USB 1.1 devices.&nbsp; So.. we are currently shooting 100% with this routers although admittedly we are woking with a small pool.</p><p>Could it be that the korenas fixed their version of the AR9331 and you are using an older chipset?&nbsp; Can you publish the chip info here? here is what we have</p><p>AR9931-AL1A<br />PFU609.001C<br />1205<br />Korea</p><p>look forward to your thoughts</p><p>--luis</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p181943">
				<div class="post-metadata">
					<div class="post-num">Post #23</div>
					<div class="post-author">Squonk</div>
					<div class="post-datetime">
						31 Oct 2012, 08:16					</div>
				</div>
				<div class="post-content content">
					<p>TP-LINK TL-WR703N Rev 1.3 (PCB Rev 1.1)I with a first My AR9331 chip identified as:<br />AR9331-AL1A<br />PBA262.003B<br />1126<br />Taiwan</p><p>I have a second TP-LINK TL-WR703N Rev 1.6 (PCB Rev 1.1 too), marked as:<br />AR9331-AL1A<br />PHP569.003C<br />1221<br />Korea</p><p>Both units are having the same problem, installed with the latest AA beta2 branch from svn.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p181947">
				<div class="post-metadata">
					<div class="post-num">Post #24</div>
					<div class="post-author">cncaihua</div>
					<div class="post-datetime">
						31 Oct 2012, 09:13					</div>
				</div>
				<div class="post-content content">
					<p>This problem was first described as a power lack of the USB,It seems you hit the point.Really hope to solve it:)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p181987">
				<div class="post-metadata">
					<div class="post-num">Post #25</div>
					<div class="post-author">lsoltero</div>
					<div class="post-datetime">
						31 Oct 2012, 14:06					</div>
				</div>
				<div class="post-content content">
					<p>sigh....</p><p>well so much for that theory.&nbsp; &nbsp;Although I am not sure exactly what the markings on the chipset mean it seems that one of your chips might be older while the other newer than the ones I have in the MR3040.&nbsp; &nbsp;I have two more mr3040 on order and will report my findings here.&nbsp; </p><p>--luis</p>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 1 of 13</div><nav><ul><li class="pagination-current"><span>1</span></li><li><a href="viewtopic.php%3Fid=39956&amp;p=2.html">2</a></li><li><a href="viewtopic.php%3Fid=39956&amp;p=3.html">3</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39956&amp;p=13.html">13</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>