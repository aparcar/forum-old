<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Custom hostapd configuration</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 22 Mar 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p365119">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">Dren</div>
					<div class="post-datetime">
						8 Sep 2017, 20:24					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m trying to add additional option in hostapd config file, but if i add them in /etc/config/wireless as <br />option key &#039;value&#039; <br />some of my custom config are not present in /var/run/hostapd-phy0.conf (i think uci is missing some hostapd flag and so they are not added in genersted hostapd config file)</p><p>Is there a way to add custom flags in /etc/config/wireless (like option &#039;extra&#039; &#039;value&#039;)?<br />Or at least pass a custom config file to hostapd instead of the uci generated one?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p365137">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">mk24</div>
					<div class="post-datetime">
						9 Sep 2017, 15:32					</div>
				</div>
				<div class="post-content content">
					<p>The script /lib/netifd/hostapd.sh generates hostapd.conf.&nbsp; You would need to extend that script to parse your new parameter.&nbsp; hostapd.sh is distributed in the hostapd-common package.</p><p>I think you can modify hostapd.conf then send a signal 1 to hostapd to make it load the new configuration, but that would be more suitable for testing than production.</p>											<p class="post-edited">(Last edited by <strong>mk24</strong> on 9 Sep 2017, 15:33)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p366928">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">d3v3l0p3rr</div>
					<div class="post-datetime">
						18 Oct 2017, 11:24					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>I&#039;m also trying to include a new option to /etc/config/wireless so it is finally present in /var/run/hostapd-phy0.conf. I have been travelling through the code and this is what I have seen:</p><p>- Netifd is is charge of listening network events and manage network interfaces upon these events.<br />- When netifd starts, it registers some scripts as handlers. The handler that is called when an event related to a wifi network interface rises is /lib/netifd/mac80211.sh.<br />- /lib/netifd/mac80211.sh uses functions from /lib/netifd/hostapd.sh and /lib/netifd/netifd-wireless.sh to generate the hostapd config file.<br />- When netifd&nbsp; calls to /lib/netifd/mac80211.sh, it passes a json config as an argument. I think that hostapd config is derived from this json config, however I can&#039;t see the new options I add to /etc/config/wireless in this json config.</p><p>Please, could anyone explain how all these scripts interact among them and with netfid? Who is in charge of parsing the /etc/config/wireless file? How the json config that is passed to /lib/netifd/mac80211.sh as an argument is derived?</p><p>Thanks in advance for your help.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>