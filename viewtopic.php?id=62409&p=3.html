<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Linksys EA8500 support</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 6 Feb 2018 and 26 Apr 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 3 of 3</div><nav><ul><li><a href="viewtopic.php%3Fid=62409&amp;p=1.html">1</a></li><li><a href="viewtopic.php%3Fid=62409&amp;p=2.html">2</a></li><li class="pagination-current"><span>3</span></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p332202">
				<div class="post-metadata">
					<div class="post-num">Post #51</div>
					<div class="post-author">konikofi</div>
					<div class="post-datetime">
						19 Jul 2016, 22:20					</div>
				</div>
				<div class="post-content content">
					<p>I was able to work around the problem with the following:</p><p><a href="http://download1.dd-wrt.de/phpBB2/viewtopic.php?t=287976&amp;postdays=0&amp;postorder=asc&amp;start=315">http://download1.dd-wrt.de/phpBB2/viewt … ;start=315</a></p><p>setup serial connection<br />interrupt boot-up<br />setenv image EA8500-factory-to-ddwrt.img <br />setenv ipaddr 192.168.1.1 <br />setenv serverip 192.168.1.2 <br />run flashimg <br />run flashimg2<br />reset </p><p>then repeat using lede img</p><p>I was not able to go back to stock fw, but that&#039;s ok for now!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p332257">
				<div class="post-metadata">
					<div class="post-num">Post #52</div>
					<div class="post-author">jmomo</div>
					<div class="post-datetime">
						20 Jul 2016, 11:31					</div>
				</div>
				<div class="post-content content">
					<p>Hello!</p><p>It would be nice to get the wiki updated with more information for this router:</p><p><a href="https://wiki.openwrt.org/toh/linksys/linksys_ea8500">https://wiki.openwrt.org/toh/linksys/linksys_ea8500</a></p><p>I was specifically looking for board pictures, the uboot smeminfo output and a few other things.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p333761">
				<div class="post-metadata">
					<div class="post-num">Post #53</div>
					<div class="post-author">jmomo</div>
					<div class="post-datetime">
						9 Aug 2016, 08:15					</div>
				</div>
				<div class="post-content content">
					<p>I was looking at the smem/mtdparts layout. Why do they have the kernel partition overlap the root/ubi partitions?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p333895">
				<div class="post-metadata">
					<div class="post-num">Post #54</div>
					<div class="post-author">it23589236847236</div>
					<div class="post-datetime">
						10 Aug 2016, 11:10					</div>
				</div>
				<div class="post-content content">
					<p>Hello, i have a problem with my ea8500. Now i have installed openwrt-ipq806x-EA8500-squashfs-factory.bin (from <a href="https://downloads.openwrt.org/snapshots/trunk/ipq806x/generic/">there</a>) but wifi module not working <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /> </p><p>I try change firmware to lede (from second post in this topic) but i have a problem. In luci when I upload image device has been restarted but firmware is still the same. </p><p>From sysupgrade in ssh:<br /></p><div class="codebox"><pre><code>root@OpenWrt:/# sysupgrade -v /tmp/lede-ipq806x-EA8500-squashfs-sysupgrade.tar 
Saving config files...
etc/config/dhcp
etc/config/dropbear
etc/config/firewall
etc/config/luci
etc/config/network
etc/config/rpcd
etc/config/system
etc/config/ubootenv
etc/config/ucitrack
etc/config/uhttpd
etc/dropbear/dropbear_rsa_host_key
etc/fw_env.config
etc/group
etc/hosts
etc/inittab
etc/luci-uploads/.placeholder
etc/opkg/keys/af22f7a88858c8e9
etc/passwd
etc/profile
etc/rc.local
etc/shadow
etc/shells
etc/sysctl.conf
etc/sysctl.d/local.conf
cp: can&#039;t create &#039;/tmp/syscfg/sysupgrade.tgz&#039;: No such file or directory
cp: can&#039;t create &#039;/tmp/syscfg/sysupgrade.tgz&#039;: No such file or directory
Sending TERM to remaining processes ... sh ubusd askfirst logd rpcd netifd odhcpd uhttpd ntpd dnsmasq 
Sending KILL to remaining processes ... askfirst 
Switching to ramdisk...
Performing system upgrade...
Unlocking kernel2 ...

Writing from &lt;stdin&gt; to kernel2 ...     
UBI device number 1, total 296 LEBs (37584896 bytes, 35.8 MiB), available 0 LEBs (0 bytes), LEB size 126976 bytes (124.0 KiB)
ubimkvol: error!: UBI device does not have free logical eraseblocks
cannot create rootfs volume
libubi: error!: &quot;/dev/&quot; is not a character device
ubiupdatevol: error!: error while probing &quot;/dev/&quot;
              error 22 (Invalid argument)
mount: mounting /dev/ on /tmp/new_root failed: Invalid argument
mounting ubifs  failed
sysupgrade successful</code></pre></div><br /><p>With mtd I can&#039;t upgrade because I don&#039;t have firmware or linux partition:<br /></p><div class="codebox"><pre><code>root@OpenWrt:/# cat /proc/mtd 
dev:    size   erasesize  name
mtd0: 00040000 00020000 &quot;SBL1&quot;
mtd1: 00140000 00020000 &quot;MIBIB&quot;
mtd2: 00140000 00020000 &quot;SBL2&quot;
mtd3: 00280000 00020000 &quot;SBL3&quot;
mtd4: 00120000 00020000 &quot;DDRCONFIG&quot;
mtd5: 00120000 00020000 &quot;SSD&quot;
mtd6: 00280000 00020000 &quot;TZ&quot;
mtd7: 00280000 00020000 &quot;RPM&quot;
mtd8: 00140000 00020000 &quot;art&quot;
mtd9: 00100000 00020000 &quot;APPSBL&quot;
mtd10: 00040000 00020000 &quot;u_env&quot;
mtd11: 00040000 00020000 &quot;s_env&quot;
mtd12: 00040000 00020000 &quot;devinfo&quot;
mtd13: 02800000 00020000 &quot;kernel1&quot;
mtd14: 02500000 00020000 &quot;rootfs1&quot;
mtd15: 02800000 00020000 &quot;kernel2&quot;
mtd16: 02500000 00020000 &quot;rootfs2&quot;
mtd17: 02080000 00020000 &quot;syscfg&quot;</code></pre></div><br /><p><strong>Please help me how I can change firmware or reverse to original <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></strong></p><p>EDIT:<br />I tried write factory image to kernel2, after reboot I had still the same image (from openwrt) but now I could use sysupgrade with ledo image <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> Now I have ledo system and working wifi! <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>											<p class="post-edited">(Last edited by <strong>it23589236847236</strong> on 11 Aug 2016, 13:47)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p335549">
				<div class="post-metadata">
					<div class="post-num">Post #55</div>
					<div class="post-author">dino3000</div>
					<div class="post-datetime">
						23 Aug 2016, 03:16					</div>
				</div>
				<div class="post-content content">
					<p>Hello all, </p><p>It seems that the sysupgrade function is failing on the latest snapshots. I have downloaded the snaphots &#039;openwrt-ipq806x-EA8500-squashfs-sysupgrade.tar&#039; (from <a href="https://downloads.openwrt.org/snapshots/trunk/ipq806x/generic/">https://downloads.openwrt.org/snapshots … x/generic/</a>) on august 21th (md5: c8ab5bdbd9b0cb63932d73c3bcdaa728) and august 22th (md5: 03f4c350be9919a58d011088434a88ef). </p><p>I&#039;ve tried to flash a sysupgrade in LuCI (System -&gt;Backup/Flash Firmware -&gt; upload flash image.</p><p>After submitting the upload the device tries to reboot, but the boot fails. The power led turns off and doesn&#039;t turn on. De leds on the lan ports are blinking and after some time the lan connection between device and pc is not working anymore.&nbsp; Most likely the device is bricked. </p><p>I can debrick the device by using the fail safe function of this device: try to boot 3 times, after a third failed boot the device boots the last working firmware. </p><p>The sysupgrade fails with or without the option &#039;keep settings&#039;. </p><p>The sysupgrade for the snapshot uploaded on august 8th does work (firmwareversion is &#039;Lede Ianchi-full 160624.0934 r935 / LuCI Master (git-16.171.60975-65c7610&#039; and the kernel version is 4.4.13). </p><p>Please help?</p>											<p class="post-edited">(Last edited by <strong>dino3000</strong> on 23 Aug 2016, 03:17)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p340566">
				<div class="post-metadata">
					<div class="post-num">Post #56</div>
					<div class="post-author">yaochengxiang</div>
					<div class="post-datetime">
						8 Oct 2016, 06:19					</div>
				</div>
				<div class="post-content content">
					<p>Report:<br /> - hardware and firmware: Linksys EA8500-AH + stock firmware version: 168206<br /> - openwrt firmware: downloads.lede-project.org/snapshots/targets/ipq806x/generic/</p><p>I flashed bin file and did sysupgrade, it works. Thanks a lot.<br />I&#039;ve tried several days on DD-wrt, this one is more favourable, not way to use DD-wrt again.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p342901">
				<div class="post-metadata">
					<div class="post-num">Post #57</div>
					<div class="post-author">tedster22</div>
					<div class="post-datetime">
						3 Nov 2016, 13:11					</div>
				</div>
				<div class="post-content content">
					<p>First of all thank you very much for the Linksys EA8500 patch. It works very well on the latest LEDE trunk.</p><p>Question - any idea how to get the real ethernet interface MACs? For example, the phy0/1 wifi macs are correct, but all the ethernet ports have a random/fake MAC. ifconfig shows:</p><p>`wlan0 ESSID: &quot;LEDE&quot;<br />Access Point: C0:56:27:25:7B:DA<br />Mode: Master Channel: 11 (2.462 GHz)<br />Tx-Power: 30 dBm Link Quality: unknown/70<br />Signal: unknown Noise: unknown<br />Bit Rate: unknown<br />Encryption: none<br />Type: nl80211 HW Mode(s): 802.11bgn<br />Hardware: 168C:0040 168C:0002 [Generic MAC80211]<br />TX power offset: unknown<br />Frequency offset: unknown<br />Supports VAPs: yes PHY name: phy0</p><p>wlan1 ESSID: &quot;LEDE&quot;<br />Access Point: C0:56:27:25:7B:DB<br />Mode: Master Channel: 36 (5.180 GHz)<br />Tx-Power: 23 dBm Link Quality: unknown/70<br />Signal: unknown Noise: -104 dBm<br />Bit Rate: unknown<br />Encryption: none<br />Type: nl80211 HW Mode(s): 802.11nac<br />Hardware: 168C:0040 168C:0002 [Generic MAC80211]<br />TX power offset: unknown<br />Frequency offset: unknown<br />Supports VAPs: yes PHY name: phy1</p><p>br-lan Link encap:Ethernet HWaddr 00:06:3B:01:41:00<br />inet addr:172.16.25.25 Bcast:172.16.25.255 Mask:255.255.255.0<br />inet6 addr: fe80::206:3bff:fe01:4100/64 Scope:Link<br />UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1<br />RX packets:6738 errors:0 dropped:0 overruns:0 frame:0<br />TX packets:19113 errors:0 dropped:0 overruns:0 carrier:0<br />collisions:0 txqueuelen:1000<br />RX bytes:1061754 (1.0 MiB) TX bytes:26872381 (25.6 MiB)</p><p>eth0 Link encap:Ethernet HWaddr 00:06:3B:01:41:00<br />inet6 addr: fe80::206:3bff:fe01:4100/64 Scope:Link<br />UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1<br />RX packets:32729 errors:0 dropped:0 overruns:0 frame:0<br />TX packets:25537 errors:0 dropped:0 overruns:0 carrier:0<br />collisions:0 txqueuelen:1000<br />RX bytes:28999723 (27.6 MiB) TX bytes:28072864 (26.7 MiB)<br />Interrupt:31</p><p>eth0.1 Link encap:Ethernet HWaddr 00:06:3B:01:41:00<br />UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1<br />RX packets:6852 errors:0 dropped:4 overruns:0 frame:0<br />TX packets:19100 errors:0 dropped:0 overruns:0 carrier:0<br />collisions:0 txqueuelen:1000<br />RX bytes:1115550 (1.0 MiB) TX bytes:26870903 (25.6 MiB)</p><p>eth0.2 Link encap:Ethernet HWaddr 00:06:3B:01:41:00<br />inet addr:172.16.40.51 Bcast:172.16.41.255 Mask:255.255.254.0<br />inet6 addr: fe80::206:3bff:fe01:4100/64 Scope:Link<br />UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1<br />RX packets:11970 errors:0 dropped:706 overruns:0 frame:0<br />TX packets:6425 errors:0 dropped:0 overruns:0 carrier:0<br />collisions:0 txqueuelen:1000<br />RX bytes:26738771 (25.5 MiB) TX bytes:1098535 (1.0 MiB)</p><p>eth1 Link encap:Ethernet HWaddr 00:03:7F:BA:DB:02<br />inet6 addr: fe80::203:7fff:feba:db02/64 Scope:Link<br />UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1<br />RX packets:0 errors:0 dropped:0 overruns:0 frame:0<br />TX packets:27 errors:0 dropped:0 overruns:0 carrier:0<br />collisions:0 txqueuelen:1000<br />RX bytes:0 (0.0 B) TX bytes:2474 (2.4 KiB)<br />Interrupt:32</p><p>lo Link encap:Local Loopback<br />inet addr:127.0.0.1 Mask:255.0.0.0<br />inet6 addr: ::1/128 Scope:Host<br />UP LOOPBACK RUNNING MTU:65536 Metric:1<br />RX packets:8 errors:0 dropped:0 overruns:0 frame:0<br />TX packets:8 errors:0 dropped:0 overruns:0 carrier:0<br />collisions:0 txqueuelen:1<br />RX bytes:632 (632.0 B) TX bytes:632 (632.0 B)</p><p>wlan0 Link encap:Ethernet HWaddr C0:56:27:25:7B:DA<br />inet6 addr: fe80::c256:27ff:fe25:7bda/64 Scope:Link<br />UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1<br />RX packets:0 errors:0 dropped:0 overruns:0 frame:0<br />TX packets:12 errors:0 dropped:0 overruns:0 carrier:0<br />collisions:0 txqueuelen:1000<br />RX bytes:0 (0.0 B) TX bytes:1288 (1.2 KiB)</p><p>wlan1 Link encap:Ethernet HWaddr C0:56:27:25:7B:DB<br />inet6 addr: fe80::c256:27ff:fe25:7bdb/64 Scope:Link<br />UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1<br />RX packets:0 errors:0 dropped:0 overruns:0 frame:0<br />TX packets:10 errors:0 dropped:0 overruns:0 carrier:0<br />collisions:0 txqueuelen:1000<br />RX bytes:0 (0.0 B) TX bytes:1120 (1.0 KiB)<br />`</p><p>The real MAC on the router label/sticker is C0:56:27:25:7B:D9</p><p>See link :https://goo.gl/photos/3EvMHrLa4Fd38ABv6</p><p>Any thoughts?</p><p>Thank you</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p342902">
				<div class="post-metadata">
					<div class="post-num">Post #58</div>
					<div class="post-author">jmomo</div>
					<div class="post-datetime">
						3 Nov 2016, 13:19					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>tedster22 wrote:</cite><blockquote><p>Question - any idea how to get the real ethernet interface MACs? For example, the phy0/1 wifi macs are correct, but all the ethernet ports have a random/fake MAC. ifconfig shows:</p><p>Any thoughts?</p><p>Thank you</p></blockquote></div><p>All of the ipq806x systems have this problem, including the EA8500. The system uses a default MAC address for the ethernet ports. So, if you buy any two ipq806x systems and put them on the same network, their ethernet MAC addresses will conflict! The same would be true of the 802.11 MAC addresses, but they have been fixed already (with a half-assed patch).</p><p>The way I fixed this in the router I ported to LEDE was to add a preinit script, as you can see here:</p><p><a href="http://jmomo.net/files/lede/v3-0002-ipq806x-Add-support-for-new-device-tew827dru.patch">http://jmomo.net/files/lede/v3-0002-ipq … 7dru.patch</a></p><p>Look at the target/linux/ipq806x/base-files/lib/preinit/06_set_iface_mac file</p><p>Note that this file must exist in the squashfs image. Putting it onto the overlay image won&#039;t work, because that&#039;s too late for preinit. You would need to build your own image.</p><p>I would suggest submitting a patch to this device, but the LEDE devs have given me a real hard time about this fix for ideological/emotional reasons. Still, this is the best way I know of how to fix it.</p>											<p class="post-edited">(Last edited by <strong>jmomo</strong> on 3 Nov 2016, 13:21)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p342915">
				<div class="post-metadata">
					<div class="post-num">Post #59</div>
					<div class="post-author">tedster22</div>
					<div class="post-datetime">
						3 Nov 2016, 16:32					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>jmomo wrote:</cite><blockquote><p> <br />All of the ipq806x systems have this problem, including the EA8500. The system uses a default MAC address for the ethernet ports. So, if you buy any two ipq806x systems and put them on the same network, their ethernet MAC addresses will conflict! The same would be true of the 802.11 MAC addresses, but they have been fixed already (with a half-assed patch).</p><p>The way I fixed this in the router I ported to LEDE was to add a preinit script, as you can see here:</p><p><a href="http://jmomo.net/files/lede/v3-0002-ipq806x-Add-support-for-new-device-tew827dru.patch">http://jmomo.net/files/lede/v3-0002-ipq … 7dru.patch</a></p><p>Look at the target/linux/ipq806x/base-files/lib/preinit/06_set_iface_mac file</p><p>Note that this file must exist in the squashfs image. Putting it onto the overlay image won&#039;t work, because that&#039;s too late for preinit. You would need to build your own image.</p><p>I would suggest submitting a patch to this device, but the LEDE devs have given me a real hard time about this fix for ideological/emotional reasons. Still, this is the best way I know of how to fix it.</p></blockquote></div><p>Thanks for the info!</p><p>I have attempted what you said (we already build our images from source anyway so that&#039;s no problem)</p><p>I added the following file to preinit/06_set_iface_mac and it is being called at boot but still not setting the MAC</p><div class="quotebox"><blockquote><p>#!/bin/sh<br />#<br /># Copyright (c) 2014 The Linux Foundation. All rights reserved.<br />#</p><p>set_ether_mac() {<br />&nbsp; &nbsp; &nbsp; &nbsp; . /lib/functions/uci-defaults.sh<br />&nbsp; &nbsp; &nbsp; &nbsp; . /lib/ipq806x.sh<br />&nbsp; &nbsp; &nbsp; &nbsp; . /lib/functions/system.sh</p><p>&nbsp; &nbsp; &nbsp; &nbsp; echo &quot;uboot lan_mac = $(mtd_get_mac_ascii APPSBLENV lan_mac)&quot; &gt; /tmp/lan<br />&nbsp; &nbsp; &nbsp; &nbsp; echo &quot;uboot wan_mac = $(mtd_get_mac_ascii APPSBLENV wan_mac)&quot; &gt; /tmp/wan<br />&nbsp; &nbsp; &nbsp; &nbsp; ifconfig eth0 hw ether $(mtd_get_mac_ascii APPSBLENV wan_mac) 2&gt;/dev/null<br />&nbsp; &nbsp; &nbsp; &nbsp; ifconfig eth1 hw ether $(mtd_get_mac_ascii APPSBLENV lan_mac) 2&gt;/dev/null<br />&nbsp; &nbsp; &nbsp; &nbsp; uci set network.lan.macaddr=$(mtd_get_mac_ascii APPSBLENV lan_mac)<br />&nbsp; &nbsp; &nbsp; &nbsp; uci set network.wan.macaddr=$(mtd_get_mac_ascii APPSBLENV wan_mac)<br />&nbsp; &nbsp; &nbsp; &nbsp; uci commit network</p><p>}</p><p>boot_hook_add preinit_main set_ether_mac</p></blockquote></div><p>When I cat /tmp/lan after boot, the MAC is not in there either.</p><p>Any way I can perform checks whilst the device is running? Does the 06_set_iface_mac get run on every boot so&nbsp; can mod that file directly without having to do a new firmware build every time?</p><p>Thanks</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p342971">
				<div class="post-metadata">
					<div class="post-num">Post #60</div>
					<div class="post-author">jmomo</div>
					<div class="post-datetime">
						4 Nov 2016, 01:17					</div>
				</div>
				<div class="post-content content">
					<p>That &quot;APPSBLENV&quot; is a partition name on my device (tew827dru), but doesn&#039;t exist on the EA8500. You need to localize it for your platform.</p><p>I don&#039;t have an ea8500 to test with, but you will need to figure out how to discover the WAN and LAN MAC addresses.</p><p>The 802.11 MAC addresses are fixed here in this file:<br />target/linux/ipq806x/base-files/etc/hotplug.d/ieee80211/10_fix_wifi_mac</p><p>This is the command substitution used the determine the MAC address on the ea8500:</p><p>$(mtd_get_mac_ascii devinfo hw_mac_addr)</p><p>So the ea8500 has a NAND partition named &quot;devinfo&quot;, and it looks like there is a field/element named &quot;hw_mac_addr&quot; in it.</p><p>The way the 802.11 MAC addresses are defined is &quot;$(macaddr_add $(mtd_get_mac_ascii APPSBLENV wan_mac) $(($PHYNBR + 1)) )&quot;. The problem here is that if you get hardware with adjacent addresses, you might still get conflicts, but it&#039;s better than doing nothing.</p><br /><br /><p>Try using this:</p><div class="quotebox"><blockquote><p>#!/bin/sh<br />#<br /># Copyright (c) 2014 The Linux Foundation. All rights reserved.<br />#</p><p>set_ether_mac() {<br />&nbsp; &nbsp; . /lib/functions/uci-defaults.sh<br />&nbsp; &nbsp; . /lib/ipq806x.sh<br />&nbsp; &nbsp; . /lib/functions/system.sh</p><p>&nbsp; &nbsp; board=$(ipq806x_board_name)</p><p>&nbsp; &nbsp; case &quot;$board&quot; in<br />&nbsp; &nbsp; ea8500)<br />&nbsp; &nbsp; &nbsp; &nbsp; # Set psudo-unique ethernet MAC addresses.<br />&nbsp; &nbsp; &nbsp; &nbsp; ifconfig eth0 hw ether $(mtd_get_mac_ascii devinfo hw_mac_addr) 2&gt;/dev/null<br />&nbsp; &nbsp; &nbsp; &nbsp; ifconfig eth1 hw ether $(macaddr_add $(mtd_get_mac_ascii devinfo hw_mac_addr) $(($PHYNBR - 1)) ) 2&gt;/dev/null<br />&nbsp; &nbsp; &nbsp; &nbsp; ;;<br />&nbsp; &nbsp; esac</p><p>}</p><p>boot_hook_add preinit_main set_ether_mac</p></blockquote></div><p>This should set your eth0 to the MAC address on the label, and eth1 will the be MAC address -1.</p><p>The result should be something like:<br />&nbsp; eth0 = hw_mac_addr<br />&nbsp; eth1 = hw_mac_addr -1<br />&nbsp; wlan0 = hw_mac_addr +1<br />&nbsp; wlan1 = hw_mac_addr +2</p>											<p class="post-edited">(Last edited by <strong>jmomo</strong> on 4 Nov 2016, 01:30)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p342993">
				<div class="post-metadata">
					<div class="post-num">Post #61</div>
					<div class="post-author">tedster22</div>
					<div class="post-datetime">
						4 Nov 2016, 10:36					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>jmomo wrote:</cite><blockquote><p>That &quot;APPSBLENV&quot; is a partition name on my device (tew827dru), but doesn&#039;t exist on the EA8500. You need to localize it for your platform.</p><p>I don&#039;t have an ea8500 to test with, but you will need to figure out how to discover the WAN and LAN MAC addresses.</p><p>The 802.11 MAC addresses are fixed here in this file:<br />target/linux/ipq806x/base-files/etc/hotplug.d/ieee80211/10_fix_wifi_mac</p><p>This is the command substitution used the determine the MAC address on the ea8500:</p><p>$(mtd_get_mac_ascii devinfo hw_mac_addr)</p><p>So the ea8500 has a NAND partition named &quot;devinfo&quot;, and it looks like there is a field/element named &quot;hw_mac_addr&quot; in it.</p><p>The way the 802.11 MAC addresses are defined is &quot;$(macaddr_add $(mtd_get_mac_ascii APPSBLENV wan_mac) $(($PHYNBR + 1)) )&quot;. The problem here is that if you get hardware with adjacent addresses, you might still get conflicts, but it&#039;s better than doing nothing.</p><br /><br /><p>Try using this:</p><div class="quotebox"><blockquote><p>#!/bin/sh<br />#<br /># Copyright (c) 2014 The Linux Foundation. All rights reserved.<br />#</p><p>set_ether_mac() {<br />&nbsp; &nbsp; . /lib/functions/uci-defaults.sh<br />&nbsp; &nbsp; . /lib/ipq806x.sh<br />&nbsp; &nbsp; . /lib/functions/system.sh</p><p>&nbsp; &nbsp; board=$(ipq806x_board_name)</p><p>&nbsp; &nbsp; case &quot;$board&quot; in<br />&nbsp; &nbsp; ea8500)<br />&nbsp; &nbsp; &nbsp; &nbsp; # Set psudo-unique ethernet MAC addresses.<br />&nbsp; &nbsp; &nbsp; &nbsp; ifconfig eth0 hw ether $(mtd_get_mac_ascii devinfo hw_mac_addr) 2&gt;/dev/null<br />&nbsp; &nbsp; &nbsp; &nbsp; ifconfig eth1 hw ether $(macaddr_add $(mtd_get_mac_ascii devinfo hw_mac_addr) $(($PHYNBR - 1)) ) 2&gt;/dev/null<br />&nbsp; &nbsp; &nbsp; &nbsp; ;;<br />&nbsp; &nbsp; esac</p><p>}</p><p>boot_hook_add preinit_main set_ether_mac</p></blockquote></div><p>This should set your eth0 to the MAC address on the label, and eth1 will the be MAC address -1.</p><p>The result should be something like:<br />&nbsp; eth0 = hw_mac_addr<br />&nbsp; eth1 = hw_mac_addr -1<br />&nbsp; wlan0 = hw_mac_addr +1<br />&nbsp; wlan1 = hw_mac_addr +2</p></blockquote></div><p>That works, brilliant. And it can be done in a script on overlay, no need to compile in at boot (though I will be doing).</p><p>Some other nice info in the &quot;devinfo&quot; partition also, like the original wireless key, serial number, wps pin and manufactured date.</p><p>Thanks again.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p342994">
				<div class="post-metadata">
					<div class="post-num">Post #62</div>
					<div class="post-author">jmomo</div>
					<div class="post-datetime">
						4 Nov 2016, 10:42					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>tedster22 wrote:</cite><blockquote><p>And it can be done in a script on overlay, no need to compile in at boot (though I will be doing).</p></blockquote></div><p>To the best of my knowledge, not correct. The problem is VLAN sub interfaces. If you have any, they will all use the garbage MAC addresses because they inherit the MAC address of the parent interface at creation time, which is after preinit, but before most of the stuff in your overlay gets run. It probably looks right for your simple/default setup, but there are consequences for not doing it in preinit. That&#039;s what the &quot;preinit&quot; part of boot stage was designed for -- kind of like a replacement for an initrd since most of these devices don&#039;t have an initrd.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p342995">
				<div class="post-metadata">
					<div class="post-num">Post #63</div>
					<div class="post-author">tedster22</div>
					<div class="post-datetime">
						4 Nov 2016, 10:45					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>jmomo wrote:</cite><blockquote><div class="quotebox"><cite>tedster22 wrote:</cite><blockquote><p>And it can be done in a script on overlay, no need to compile in at boot (though I will be doing).</p></blockquote></div><p>To the best of my knowledge, not correct. The problem is VLAN sub interfaces. If you have any, they will all use the garbage MAC addresses because they inherit the MAC address of the parent interface at creation time, which is after preinit, but before most of the stuff in your overlay gets run. It probably looks right for your simple/default setup, but there are consequences for not doing it in preinit. That&#039;s what the &quot;preinit&quot; part of boot stage was designed for -- kind of like a replacement for an initrd since most of these devices don&#039;t have an initrd.</p></blockquote></div><p>Absolutely correct. Sorry, I meant you can get the MAC from the partition whilst the router is up and running, not that you should run the script at that point and set the iface MAC. That should definitely be done preinit.</p><p>Thanks</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p342996">
				<div class="post-metadata">
					<div class="post-num">Post #64</div>
					<div class="post-author">tedster22</div>
					<div class="post-datetime">
						4 Nov 2016, 10:54					</div>
				</div>
				<div class="post-content content">
					<p>Also, is there a tested method of getting back to original Linksys EA8500 firmware yet, via mtd flash, TFTP or serial console?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p343100">
				<div class="post-metadata">
					<div class="post-num">Post #65</div>
					<div class="post-author">etomm</div>
					<div class="post-datetime">
						5 Nov 2016, 19:30					</div>
				</div>
				<div class="post-content content">
					<p>Hello all, I am testing too the lede firmware with the UK version of this router (that I think it is just a world one maybe? how can I recognize it). Seems to work everything apart setting the router static ip of the LAN interface to 192.168.0.1.</p><p>Do you know if it is a known bug?! Seems so strange that all other ip ranges works.</p><p>When I flash the firmware, I just install luci, and change the ip to 192.168.0.1. After this, ssh and luci stop to work. Rebooting the router or forcing my pc to find a new address with the dhcp configured in the 192.168.0.1/24 network, I can ping the router, but ssh and luci still doesn&#039;t work. Even telnet doesn&#039;t work.</p><p>EDIT: just to clarify, 192.168.1.1 works fine, another ip in the 192.168.1.1/24 range is ok, in the 192.168.2.1/24 is again ok (and I think for whichever network until the very last one).</p><p>In the 192.168.0.1/24 network, I can give to the router all the ip addresses that I want, apart the 192.168.0.1 that will automatically disable ssh and luci... ping will still work.</p><p>I tested 192.168.0.2, 192.168.0.20 and 192.168.0.254... they all works, just the .1 seems to don&#039;t work</p>											<p class="post-edited">(Last edited by <strong>etomm</strong> on 5 Nov 2016, 23:58)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p343114">
				<div class="post-metadata">
					<div class="post-num">Post #66</div>
					<div class="post-author">jmomo</div>
					<div class="post-datetime">
						6 Nov 2016, 02:29					</div>
				</div>
				<div class="post-content content">
					<p>For the last two questions, you guys should hit up Ianchi -- he&#039;s the lead dev for the ea8500. Look up his Github page and post something there. I have not seen him here on this thread for a long time, so I&#039;m not sure he bothers to check it anymore.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p343241">
				<div class="post-metadata">
					<div class="post-num">Post #67</div>
					<div class="post-author">etomm</div>
					<div class="post-datetime">
						7 Nov 2016, 21:22					</div>
				</div>
				<div class="post-content content">
					<p>Unfortunately the router resets... much for my tastes.</p><p>As particular packages I have installed OpenVPN, dnsmasq-full, wpad, strongswan, mwan3. I am having 4 2.4GHZ and 2 5GHZ networks, 8 interfaces defined, 5 zones in the firewall and 4 openvpn connections.</p><p>Too much unstable still.</p><p>BTW passing to the latest trunk solved the problem with 192.168.0.1 ip address.</p>											<p class="post-edited">(Last edited by <strong>etomm</strong> on 7 Nov 2016, 21:22)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p344278">
				<div class="post-metadata">
					<div class="post-num">Post #68</div>
					<div class="post-author">stangri</div>
					<div class="post-datetime">
						21 Nov 2016, 07:47					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>jmomo wrote:</cite><blockquote><div class="quotebox"><cite>tedster22 wrote:</cite><blockquote><p>And it can be done in a script on overlay, no need to compile in at boot (though I will be doing).</p></blockquote></div><p>To the best of my knowledge, not correct. The problem is VLAN sub interfaces. If you have any, they will all use the garbage MAC addresses because they inherit the MAC address of the parent interface at creation time, which is after preinit, but before most of the stuff in your overlay gets run. It probably looks right for your simple/default setup, but there are consequences for not doing it in preinit. That&#039;s what the &quot;preinit&quot; part of boot stage was designed for -- kind of like a replacement for an initrd since most of these devices don&#039;t have an initrd.</p></blockquote></div><p>Is it possible to fix the mac addresses on VLAN sub interfaces after device has booted? Can I not have some sort of uci-defaults script for that?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p344283">
				<div class="post-metadata">
					<div class="post-num">Post #69</div>
					<div class="post-author">jmomo</div>
					<div class="post-datetime">
						21 Nov 2016, 09:44					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>stangri wrote:</cite><blockquote><div class="quotebox"><cite>jmomo wrote:</cite><blockquote><div class="quotebox"><cite>tedster22 wrote:</cite><blockquote><p>And it can be done in a script on overlay, no need to compile in at boot (though I will be doing).</p></blockquote></div><p>To the best of my knowledge, not correct. The problem is VLAN sub interfaces. If you have any, they will all use the garbage MAC addresses because they inherit the MAC address of the parent interface at creation time, which is after preinit, but before most of the stuff in your overlay gets run. It probably looks right for your simple/default setup, but there are consequences for not doing it in preinit. That&#039;s what the &quot;preinit&quot; part of boot stage was designed for -- kind of like a replacement for an initrd since most of these devices don&#039;t have an initrd.</p></blockquote></div><p>Is it possible to fix the mac addresses on VLAN sub interfaces after device has booted? Can I not have some sort of uci-defaults script for that?</p></blockquote></div><p>Not sure what you are trying to ask. You literally answered your own question. The changes I posted fix the problem you asked about. The text above confirms that. Drunk at keyboard?</p>											<p class="post-edited">(Last edited by <strong>jmomo</strong> on 21 Nov 2016, 09:44)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p344284">
				<div class="post-metadata">
					<div class="post-num">Post #70</div>
					<div class="post-author">stangri</div>
					<div class="post-datetime">
						21 Nov 2016, 10:10					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>jmomo wrote:</cite><blockquote><p>Not sure what you are trying to ask. You literally answered your own question. The changes I posted fix the problem you asked about. The text above confirms that. Drunk at keyboard?</p></blockquote></div><p>I&#039;m sorry if my question didn&#039;t pass your sobriety test. Feel free not to answer the questions you don&#039;t understand or seek clarification in a more civilized way.</p><p>Hopefully @tedster22 can answer then -- do uci-scripts run early enough for the code above to work?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p344304">
				<div class="post-metadata">
					<div class="post-num">Post #71</div>
					<div class="post-author">ukr-ix</div>
					<div class="post-datetime">
						21 Nov 2016, 14:05					</div>
				</div>
				<div class="post-content content">
					<p>hi guys!<br />i flashed lede-ipq806x-EA8500-squashfs-factory.bin, and tray to flash lede-ipq806x-EA8500-squashfs-sysupgrade.tar&nbsp; &nbsp; </p><p>have error, end dont have admin panel on 192.168.1.1 <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> only ssh </p><p>my error is ...</p><br /><p>root@lede:/tmp# sysupgrade -v lede-ipq806x-EA8500-squashfs-sysupgrade.tar<br />Saving config files...<br />etc/config/dhcp<br />etc/config/dropbear<br />etc/config/firewall<br />etc/config/network<br />etc/config/system<br />etc/config/ubootenv<br />etc/config/wireless<br />etc/dropbear/dropbear_rsa_host_key<br />etc/fw_env.config<br />etc/group<br />etc/hosts<br />etc/inittab<br />etc/opkg/keys/72a57f2191b211e0<br />etc/opkg/keys/9ef4694208102c43<br />etc/opkg/keys/b5043e70f9a75cde<br />etc/opkg/keys/dace9d4df16896bf<br />etc/opkg/keys/dd6de0d06bbd3d85<br />etc/passwd<br />etc/profile<br />etc/rc.local<br />etc/shadow<br />etc/shells<br />etc/sysctl.conf<br />etc/sysctl.d/local.conf<br />cp: can&#039;t create &#039;/tmp/syscfg/sysupgrade.tgz&#039;: No such file or directory<br />cp: can&#039;t create &#039;/tmp/syscfg/sysupgrade.tgz&#039;: No such file or directory<br />Sending TERM to remaining processes ... ubusd askfirst logd netifd odhcpd ntpd dnsmasq<br />Sending KILL to remaining processes ... askfirst<br />Switching to ramdisk...<br />Performing system upgrade...<br />Unlocking kernel1 ...</p><p>Writing from &lt;stdin&gt; to kernel1 ...<br />UBI device number 1, total 296 LEBs (37584896 bytes, 35.8 MiB), available 0 LEBs (0 bytes), LEB size 126976 bytes (124.0 KiB)<br />Volume ID 0, size 22 LEBs (2793472 bytes, 2.7 MiB), LEB size 126976 bytes (124.0 KiB), dynamic, name &quot;rootfs&quot;, alignment 1<br />Set volume size to 31744000<br />Volume ID 1, size 250 LEBs (31744000 bytes, 30.3 MiB), LEB size 126976 bytes (124.0 KiB), dynamic, name &quot;rootfs_data&quot;, alignment 1<br />sysupgrade successful<br />umount: can&#039;t unmount /dev/pts: Resource busy<br />umount: can&#039;t unmount /dev: Resource busy<br />umount: can&#039;t unmount /tmp: Resource busy</p><br /><p>root@lede:~#<br />root@lede:~# cat /proc/mtd<br />dev:&nbsp; &nbsp; size&nbsp; &nbsp;erasesize&nbsp; name<br />mtd0: 00040000 00020000 &quot;SBL1&quot;<br />mtd1: 00140000 00020000 &quot;MIBIB&quot;<br />mtd2: 00140000 00020000 &quot;SBL2&quot;<br />mtd3: 00280000 00020000 &quot;SBL3&quot;<br />mtd4: 00120000 00020000 &quot;DDRCONFIG&quot;<br />mtd5: 00120000 00020000 &quot;SSD&quot;<br />mtd6: 00280000 00020000 &quot;TZ&quot;<br />mtd7: 00280000 00020000 &quot;RPM&quot;<br />mtd8: 00140000 00020000 &quot;art&quot;<br />mtd9: 00100000 00020000 &quot;APPSBL&quot;<br />mtd10: 00040000 00020000 &quot;u_env&quot;<br />mtd11: 00040000 00020000 &quot;s_env&quot;<br />mtd12: 00040000 00020000 &quot;devinfo&quot;<br />mtd13: 02800000 00020000 &quot;kernel1&quot;<br />mtd14: 02500000 00020000 &quot;rootfs1&quot;<br />mtd15: 02800000 00020000 &quot;kernel2&quot;<br />mtd16: 02500000 00020000 &quot;rootfs2&quot;<br />mtd17: 02080000 00020000 &quot;syscfg&quot;</p><br /><p>help me plz</p>											<p class="post-edited">(Last edited by <strong>ukr-ix</strong> on 21 Nov 2016, 14:56)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p345426">
				<div class="post-metadata">
					<div class="post-num">Post #72</div>
					<div class="post-author">tjxme</div>
					<div class="post-datetime">
						1 Dec 2016, 21:09					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>ianchi wrote:</cite><blockquote><p>Hi slg,<br />I&#039;ve updated the image to include a revert script.<br />You have two options:<br />transfer the linksys original firmware bin to /tmp to flash it with:<br /></p><div class="codebox"><pre><code>/lib/upgrade/revert.sh -f [image file]</code></pre></div><p>Or simply revert back to previous firmware without flashing (if you only flashed once, previous is stock)<br /></p><div class="codebox"><pre><code>/lib/upgrade/revert.sh -r</code></pre></div><p>From that firmware if you flash again you&#039;ll overwrite openwrt, or if you go to:<br /> Troubleshooting - Diagnostics - Revert to previous<br />you&#039;ll end up again with openwrt</p><p>Remember that this router has a safe boot mechanism (taken into account in my image), and after 3 failed attempts to boot an image it will automatically revert to previous.</p></blockquote></div><p>Hi Ianchi, <br />I just used your openwrt for my EA8500. I found it is too complicated for me. I want to roll back.<br />I have put the factory 8500 bin file in /mtp direction, and i used mac terminal to type what you mentioned here.<br />However, I got this messge: revert.sh: not found</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 3 of 3</div><nav><ul><li><a href="viewtopic.php%3Fid=62409&amp;p=1.html">1</a></li><li><a href="viewtopic.php%3Fid=62409&amp;p=2.html">2</a></li><li class="pagination-current"><span>3</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0.001 -->

</body>
</html>