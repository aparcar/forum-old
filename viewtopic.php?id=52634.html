<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Bad gateway issue</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 13 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p246474">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">rcp100</div>
					<div class="post-datetime">
						8 Sep 2014, 19:49					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>I have noticed an apparent problem with the uhttpd CGI interface. If I build an image that does not contain<br />LuCI then uHTTPd fails to start my CGI code. As a result I eventually receive a &quot;bad gateway&quot; message in my browser.<br />Nevertheless uHTTPd appears to serve static content correctly.</p><p>I should point out that that my CGI code is a stand alone binary, that has the appropriate permissions set<br />and resides in the /www/cgi-bin directory, that also has the appropriate permissions.</p><p>Installing luci at a later point, using:</p><p>&nbsp; &nbsp; opkg install luci-mod-admin-full</p><p>(which in turn installs&nbsp; the package luci-base) appears to fix the problem, so I have a valid work around.</p><p>Curiously if I then remove the installed packages with</p><p>&nbsp; &nbsp; opkg remove luci-mod-admin-full<br />&nbsp; &nbsp; opkg remove luci-base</p><p>my CGI code continues to work. </p><p>Perhaps it is relevant that&nbsp; the directory /www/luci-static persists after removing these packages.</p><p>However deleting it using</p><p>&nbsp; &nbsp; rm -r /www/luci-static</p><p>(or equivalents) also has no effect on the uHTTPd CGI.</p><p>In summary: it appears that the installation of all or parts of LuCI is necessary for the correct<br />functioning of uHTTPd&#039;s CGI mechanism.</p><p>Has anyone else noticed similar problems?</p><p>Rick</p><p>P.S. should mention Openwrt version is BB RC3 on TP-LINK WR1043ND V2</p>											<p class="post-edited">(Last edited by <strong>rcp100</strong> on 8 Sep 2014, 20:04)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p246532">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						9 Sep 2014, 12:10					</div>
				</div>
				<div class="post-content content">
					<p>That souns really odd and is definitely not the case.<br />The root cause is likely something else in your cgi programs.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p246542">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">nebbia88</div>
					<div class="post-datetime">
						9 Sep 2014, 15:14					</div>
				</div>
				<div class="post-content content">
					<p>if you execute</p><p>opkg remove luci-mod-admin-full --autoremove</p><p>then did your script keep working? even after a reboot?</p><p>post opkg output anyway..</p>											<p class="post-edited">(Last edited by <strong>nebbia88</strong> on 9 Sep 2014, 15:16)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p246580">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">rcp100</div>
					<div class="post-datetime">
						9 Sep 2014, 22:34					</div>
				</div>
				<div class="post-content content">
					<p>@jow </p><p>&gt; The root cause is likely something else in your cgi programs.</p><p>I agree (up to a point)</p><p>I suspect the problem may relate to my accessing:&nbsp; /usr/lib/lua/luci/sys/zoneinfo/tzdata.lua</p><p>which certainly looks to me like it may be a LuCI file.</p><p>However, as far as I can tell at present, the code that accesses this file has not been called<br />at the point the error occurs.</p><p>I will investigate further when I get the chance.</p><br /><p>@nebbia88</p><p>The command </p><p>&nbsp; &nbsp; opkg remove luci-mod-admin-full --autoremove</p><p>yields only the message:</p><p>&nbsp; &nbsp; Removing package luci-mod-admin-full from root ..</p><p>and my code continues to work correctly (specifically it continues to be able to read the<br />aforementioned tzdata.lua file) so it seems to me that this file does not &#039;belong to Luci&#039;.</p><p>After a further reboot, my CGI code also continues to run correctly.</p><p>Thank you both for your input.</p><p>Perhaps I could ask at this point: is there a &#039;correct&#039; way of accessing tzdata or zoneinfo<br />data under openWRT? Is it included as part of a package? Perhaps I should download my<br />own copy from the IANA repository?</p><p>Regards</p><p>Rick</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>