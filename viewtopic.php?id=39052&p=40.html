<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> mwan3; multi-wan policy routing (general topic)</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 22 May 2013 and 6 May 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 40 of 65</div><nav><ul><li><a href="viewtopic.php%3Fid=39052&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=38.html">38</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=39.html">39</a></li><li class="pagination-current"><span>40</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=41.html">41</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=42.html">42</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=65.html">65</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p252292">
				<div class="post-metadata">
					<div class="post-num">Post #976</div>
					<div class="post-author">asergiu</div>
					<div class="post-datetime">
						28 Oct 2014, 12:49					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><p>Then it is in your /etc/config/network...</p></blockquote></div><p>Sorry - yes it is yet mwan3 does not see it as having a default route.<br />config interface &#039;Bouygues4G&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;dhcp&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option metric &#039;15&#039;</p><br /><p>Kernel IP routing table<br />Destination&nbsp; &nbsp; &nbsp;Gateway&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Genmask&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Flags Metric Ref&nbsp; &nbsp; Use Iface<br />default&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;37-1-168-1.ip.s 0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;UG&nbsp; &nbsp; 10&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp; 0 eth1<br />default&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;192.168.8.1&nbsp; &nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;UG&nbsp; &nbsp; 15&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp; 0 wlan1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;- this is its default entry !<br />default&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;192.168.1.1&nbsp; &nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;UG&nbsp; &nbsp; 100&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 eth0.2</p><p>Thanks for you fast interaction here !</p>											<p class="post-edited">(Last edited by <strong>asergiu</strong> on 28 Oct 2014, 12:50)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p252293">
				<div class="post-metadata">
					<div class="post-num">Post #977</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						28 Oct 2014, 12:56					</div>
				</div>
				<div class="post-content content">
					<p>And you also have an interface Bouygues4G configured in mwan3?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p252295">
				<div class="post-metadata">
					<div class="post-num">Post #978</div>
					<div class="post-author">asergiu</div>
					<div class="post-datetime">
						28 Oct 2014, 13:03					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><p>And you also have an interface Bouygues4G configured in mwan3?</p></blockquote></div><p>Yeah - sorry for taking your time - I was typing it as bouygues4G and without capital B-&nbsp; it thought (obvioulsy) it was a different interface (which did not existed). I believe this was the culprit. </p><p>Thank you for your quick reaction and sorry again for wasting your time.</p><p>Adrian</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p252296">
				<div class="post-metadata">
					<div class="post-num">Post #979</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						28 Oct 2014, 13:06					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>asergiu wrote:</cite><blockquote><p>Thank you for your quick reaction and sorry again for wasting your time.</p></blockquote></div><p>No problem. Nice to hear that you fixed it yourself.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p252636">
				<div class="post-metadata">
					<div class="post-num">Post #980</div>
					<div class="post-author">qweas2</div>
					<div class="post-datetime">
						31 Oct 2014, 15:32					</div>
				</div>
				<div class="post-content content">
					<h5>mwan3 and port forwarding</h5><p>I have an issue with setting port forwarding when mwan3 is installed.</p><p>There are two wans: <br />- wan (eth0.2) - NO external IP available<br />- wan2 (pppoe-wan2) - external dynamic IP address available</p><p>I would like to forward port 8888 to foscam camera available in lan at 192.168.1.111</p><p>I did set up following port forward:<br /></p><div class="quotebox"><blockquote><p>IPv4-TCP<br />From any host in wan<br />Via any router IP at port 8888<br />IP 192.168.1.111, port 8888 in lan</p></blockquote></div><p>But when I try to access external IP (or through dyndns) on port 8888 from different location then no response is send. I&#039;m able to access router interface through ssh or by using GUI so I guess my problem is related to port forwarding. </p><p>Any ideas what I am doing wrong?</p><p><strong>root@OpenWrt:~# cat /etc/config/firewall</strong><br /></p><div class="codebox"><pre><code>config rule
        option name &#039;Allow-DHCP-Renew&#039;
        option src &#039;wan&#039;
        option proto &#039;udp&#039;
        option dest_port &#039;68&#039;
        option target &#039;ACCEPT&#039;
        option family &#039;ipv4&#039;

config rule
        option name &#039;Allow-Ping&#039;
        option src &#039;wan&#039;
        option proto &#039;icmp&#039;
        option icmp_type &#039;echo-request&#039;
        option family &#039;ipv4&#039;
        option target &#039;ACCEPT&#039;

config rule
        option name &#039;Allow-DHCPv6&#039;
        option src &#039;wan&#039;
        option proto &#039;udp&#039;
        option src_ip &#039;fe80::/10&#039;
        option src_port &#039;547&#039;
        option dest_ip &#039;fe80::/10&#039;
        option dest_port &#039;546&#039;
        option family &#039;ipv6&#039;
        option target &#039;ACCEPT&#039;

config rule
        option name &#039;Allow-ICMPv6-Input&#039;
        option src &#039;wan&#039;
        option proto &#039;icmp&#039;
        list icmp_type &#039;echo-request&#039;
        list icmp_type &#039;echo-reply&#039;
        list icmp_type &#039;destination-unreachable&#039;
        list icmp_type &#039;packet-too-big&#039;
        list icmp_type &#039;time-exceeded&#039;
        list icmp_type &#039;bad-header&#039;
        list icmp_type &#039;unknown-header-type&#039;
        list icmp_type &#039;router-solicitation&#039;
        list icmp_type &#039;neighbour-solicitation&#039;
        list icmp_type &#039;router-advertisement&#039;
        list icmp_type &#039;neighbour-advertisement&#039;
        option limit &#039;1000/sec&#039;
        option family &#039;ipv6&#039;
        option target &#039;ACCEPT&#039;

config rule
        option name &#039;Allow-ICMPv6-Forward&#039;
        option src &#039;wan&#039;
        option dest &#039;*&#039;
        option proto &#039;icmp&#039;
        list icmp_type &#039;echo-request&#039;
        list icmp_type &#039;echo-reply&#039;
        list icmp_type &#039;destination-unreachable&#039;
        list icmp_type &#039;packet-too-big&#039;
        list icmp_type &#039;time-exceeded&#039;
        list icmp_type &#039;bad-header&#039;
        list icmp_type &#039;unknown-header-type&#039;
        option limit &#039;1000/sec&#039;
        option family &#039;ipv6&#039;
        option target &#039;ACCEPT&#039;

config rule
        option target &#039;ACCEPT&#039;
        option src &#039;wan&#039;
        option proto &#039;tcp&#039;
        option dest_port &#039;22&#039;
        option name &#039;22&#039;

config rule
        option target &#039;ACCEPT&#039;
        option src &#039;wan&#039;
        option proto &#039;tcp&#039;
        option dest_port &#039;80&#039;
        option name &#039;80&#039;
        option dest_ip &#039;192.168.1.1&#039;

config rule
        option name &#039;8888&#039;
        option dest_port &#039;8888&#039;
        option dest_ip &#039;192.168.1.111&#039;
        option target &#039;ACCEPT&#039;
        option src &#039;wan&#039;
        option proto &#039;tcp&#039;
        option dest &#039;lan&#039;

config redirect
        option target &#039;DNAT&#039;
        option src &#039;wan&#039;
        option dest &#039;lan&#039;
        option proto &#039;tcp&#039;
        option src_dport &#039;22&#039;
        option dest_port &#039;22&#039;
        option name &#039;ssh&#039;
        option dest_ip &#039;192.168.1.1&#039;

config redirect
        option target &#039;DNAT&#039;
        option src &#039;wan&#039;
        option dest &#039;lan&#039;
        option proto &#039;tcp&#039;
        option src_dport &#039;80&#039;
        option dest_port &#039;80&#039;
        option name &#039;http&#039;
        option dest_ip &#039;192.168.1.1&#039;

config redirect
        option target &#039;DNAT&#039;
        option src &#039;wan&#039;
        option name &#039;foscam&#039;
        option src_dport &#039;8888&#039;
        option dest_port &#039;8888&#039;
        option dest_ip &#039;192.168.1.111&#039;
        option dest &#039;lan&#039;
        option proto &#039;tcp&#039;

config defaults
        option syn_flood &#039;1&#039;
        option input &#039;ACCEPT&#039;
        option output &#039;ACCEPT&#039;
        option forward &#039;ACCEPT&#039;

config zone
        option name &#039;lan&#039;
        option input &#039;ACCEPT&#039;
        option output &#039;ACCEPT&#039;
        option network &#039;lan&#039;
        option forward &#039;ACCEPT&#039;

config zone
        option name &#039;wan&#039;
        option output &#039;ACCEPT&#039;
        option masq &#039;1&#039;
        option mtu_fix &#039;1&#039;
        option forward &#039;ACCEPT&#039;
        option network &#039;wan wan2&#039;
        option input &#039;ACCEPT&#039;

config include
        option path &#039;/etc/firewall.user&#039;

config forwarding
        option dest &#039;lan&#039;
        option src &#039;wan&#039;

config forwarding
        option dest &#039;wan&#039;
        option src &#039;lan&#039;

config include &#039;miniupnpd&#039;
        option type &#039;script&#039;
        option path &#039;/usr/share/miniupnpd/firewall.include&#039;
        option family &#039;IPv4&#039;
        option reload &#039;1&#039;</code></pre></div><br /><p><strong>Troubleshooting Data</strong></p><div class="codebox"><pre><code>Software versions : 

OpenWrt - OpenWrt Attitude Adjustment 12.09.1
LuCI - 0.11+svn10458

mwan3 - 1.4-20
luci-app-mwan3 - 1.2-19

Output of &quot;cat /etc/config/mwan3&quot; : 

config interface &#039;wan&#039;
    option enabled &#039;1&#039;
    list track_ip &#039;8.8.4.4&#039;
    list track_ip &#039;8.8.8.8&#039;
    list track_ip &#039;208.67.222.222&#039;
    list track_ip &#039;208.67.220.220&#039;
    option reliability &#039;2&#039;
    option count &#039;1&#039;
    option interval &#039;5&#039;
    option timeout &#039;5&#039;
    option down &#039;10&#039;
    option up &#039;1&#039;

config interface &#039;wan2&#039;
    list track_ip &#039;8.8.8.8&#039;
    list track_ip &#039;208.67.220.220&#039;
    option reliability &#039;1&#039;
    option count &#039;1&#039;
    option timeout &#039;2&#039;
    option interval &#039;5&#039;
    option down &#039;3&#039;
    option up &#039;8&#039;
    option enabled &#039;1&#039;

config member &#039;wan_m1_w3&#039;
    option interface &#039;wan&#039;
    option metric &#039;1&#039;
    option weight &#039;3&#039;

config member &#039;wan_m2_w3&#039;
    option interface &#039;wan&#039;
    option metric &#039;2&#039;
    option weight &#039;3&#039;

config member &#039;wan2_m1_w2&#039;
    option interface &#039;wan2&#039;
    option metric &#039;1&#039;
    option weight &#039;2&#039;

config member &#039;wan2_m2_w2&#039;
    option interface &#039;wan2&#039;
    option metric &#039;2&#039;
    option weight &#039;2&#039;

config policy &#039;wan_only&#039;
    list use_member &#039;wan_m1_w3&#039;

config policy &#039;wan2_only&#039;
    list use_member &#039;wan2_m1_w2&#039;

config policy &#039;balanced&#039;
    list use_member &#039;wan_m1_w3&#039;
    list use_member &#039;wan2_m1_w2&#039;

config policy &#039;wan_wan2&#039;
    list use_member &#039;wan_m1_w3&#039;
    list use_member &#039;wan2_m2_w2&#039;

config policy &#039;wan2_wan&#039;
    list use_member &#039;wan_m2_w3&#039;
    list use_member &#039;wan2_m1_w2&#039;

config rule &#039;sticky_even&#039;
    option src_ip &#039;0.0.0.0/0.0.0.1&#039;
    option dest_port &#039;443&#039;
    option proto &#039;tcp&#039;
    option use_policy &#039;wan_wan2&#039;

config rule &#039;sticky_odd&#039;
    option src_ip &#039;0.0.0.1/0.0.0.1&#039;
    option dest_port &#039;443&#039;
    option proto &#039;tcp&#039;
    option use_policy &#039;wan2_wan&#039;

config rule &#039;default_rule&#039;
    option dest_ip &#039;0.0.0.0/0&#039;
    option use_policy &#039;balanced&#039;

Output of &quot;cat /etc/config/network&quot; : 

config interface &#039;loopback&#039;
    option ifname &#039;lo&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;127.0.0.1&#039;
    option netmask &#039;255.0.0.0&#039;

config interface &#039;lan&#039;
    option ifname &#039;eth0.1&#039;
    option type &#039;bridge&#039;
    option proto &#039;static&#039;
    option netmask &#039;255.255.255.0&#039;
    option ipaddr &#039;192.168.1.1&#039;

config interface &#039;wan&#039;
    option ifname &#039;eth0.2&#039;
    option _orig_ifname &#039;eth0.2&#039;
    option _orig_bridge &#039;false&#039;
    option proto &#039;static&#039;
    option ipaddr &#039;192.168.0.85&#039;
    option netmask &#039;255.255.255.0&#039;
    option gateway &#039;192.168.0.1&#039;
    option dns &#039;8.8.8.8 8.8.4.4 208.67.220.220 208.67.222.222&#039;

config interface &#039;wan2&#039;
    option ifname &#039;eth0.3&#039;
    option proto &#039;pppoe&#039;
    USERNAME HIDDEN
    PASSWORD HIDDEN
    option pppd_options &#039;debug&#039;
    option peerdns &#039;0&#039;
    option keepalive &#039;30 5&#039;
    option dns &#039;208.67.222.222 208.67.220.220 8.8.8.8 8.8.4.4&#039;
    option vpi &#039;0&#039;
    option vci &#039;35&#039;
    option encaps &#039;vc&#039;
    option metric &#039;1&#039;

config switch
    option name &#039;eth0&#039;
    option reset &#039;1&#039;
    option enable_vlan &#039;1&#039;

config switch_vlan
    option device &#039;eth0&#039;
    option vlan &#039;1&#039;
    option ports &#039;0t 3 4 5&#039;

config switch_vlan
    option device &#039;eth0&#039;
    option vlan &#039;2&#039;
    option ports &#039;0t 1&#039;

config switch_vlan
    option device &#039;eth0&#039;
    option vlan &#039;3&#039;
    option ports &#039;0t 2&#039;

config route
    option interface &#039;wan&#039;
    option netmask &#039;255.255.255.0&#039;
    option gateway &#039;192.168.0.1&#039;
    option metric &#039;2&#039;
    option target &#039;192.168.0.85&#039;

Output of &quot;ifconfig&quot; : 

br-lan    Link encap:Ethernet  HWaddr F8:1A:67:7E:AB:28  
          inet addr:192.168.1.1  Bcast:192.168.1.255  Mask:255.255.255.0
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:2440907 errors:0 dropped:11663 overruns:0 frame:0
          TX packets:1839316 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:1170660948 (1.0 GiB)  TX bytes:607887498 (579.7 MiB)

eth0      Link encap:Ethernet  HWaddr F8:1A:67:7E:AB:28  
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:29317240 errors:0 dropped:21 overruns:0 frame:0
          TX packets:21496108 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:3159175783 (2.9 GiB)  TX bytes:3200317267 (2.9 GiB)
          Interrupt:4 

eth0.1    Link encap:Ethernet  HWaddr F8:1A:67:7E:AB:28  
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:22684 errors:0 dropped:0 overruns:0 frame:0
          TX packets:485230 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:2672425 (2.5 MiB)  TX bytes:103242727 (98.4 MiB)

eth0.2    Link encap:Ethernet  HWaddr F8:1A:67:7E:AB:28  
          inet addr:192.168.0.85  Bcast:192.168.0.255  Mask:255.255.255.0
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:17830923 errors:0 dropped:48819 overruns:0 frame:0
          TX packets:8674571 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:1544842722 (1.4 GiB)  TX bytes:812530120 (774.8 MiB)

eth0.3    Link encap:Ethernet  HWaddr F8:1A:67:7E:AB:28  
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:150731 errors:0 dropped:0 overruns:0 frame:0
          TX packets:161235 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:14838660 (14.1 MiB)  TX bytes:17510941 (16.6 MiB)

lo        Link encap:Local Loopback  
          inet addr:127.0.0.1  Mask:255.0.0.0
          UP LOOPBACK RUNNING  MTU:16436  Metric:1
          RX packets:290109 errors:0 dropped:0 overruns:0 frame:0
          TX packets:290109 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:0 
          RX bytes:23254079 (22.1 MiB)  TX bytes:23254079 (22.1 MiB)

pppoe-wan2 Link encap:Point-to-Point Protocol  
          inet addr:178.43.228.146  P-t-P:83.1.4.50  Mask:255.255.255.255
          UP POINTOPOINT RUNNING NOARP MULTICAST  MTU:1492  Metric:1
          RX packets:12639 errors:0 dropped:0 overruns:0 frame:0
          TX packets:12093 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:3 
          RX bytes:1348834 (1.2 MiB)  TX bytes:3505701 (3.3 MiB)

wlan0     Link encap:Ethernet  HWaddr F8:1A:67:7E:AB:29  
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:2427045 errors:0 dropped:0 overruns:0 frame:0
          TX packets:2236220 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:1208241549 (1.1 GiB)  TX bytes:706038619 (673.3 MiB)

wlan1     Link encap:Ethernet  HWaddr F8:1A:67:7E:AB:2A  
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:706 errors:0 dropped:0 overruns:0 frame:0
          TX packets:461173 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000 
          RX bytes:106989 (104.4 KiB)  TX bytes:89364183 (85.2 MiB)

Output of &quot;route -n&quot; : 

Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
0.0.0.0         192.168.0.1     0.0.0.0         UG    0      0        0 eth0.2
0.0.0.0         83.1.4.50       0.0.0.0         UG    1      0        0 pppoe-wan2
83.1.4.50       0.0.0.0         255.255.255.255 UH    0      0        0 pppoe-wan2
192.168.0.0     0.0.0.0         255.255.255.0   U     0      0        0 eth0.2
192.168.1.0     0.0.0.0         255.255.255.0   U     0      0        0 br-lan

Output of &quot;ip rule show&quot; : 

0:    from all lookup local 
1001:    from all iif eth0.2 lookup main 
1002:    from all iif pppoe-wan2 lookup main 
2001:    from all fwmark 0x100/0xff00 lookup 1 
2002:    from all fwmark 0x200/0xff00 lookup 2 
2254:    from all fwmark 0xfe00/0xff00 unreachable
32766:    from all lookup main 
32767:    from all lookup default

Output of &quot;ip route list table 1-250&quot; : 

1
default via 192.168.0.1 dev eth0.2 
2
default via 83.1.4.50 dev pppoe-wan2

Firewall default output policy (must be ACCEPT) : 

ACCEPT

Output of &quot;iptables -L -t mangle -v -n&quot; : 

Chain PREROUTING (policy ACCEPT 1190 packets, 148K bytes)
 pkts bytes target     prot opt in     out     source               destination         
  19M 3101M mwan3_hook  all  --  *      *       0.0.0.0/0            0.0.0.0/0           
 1190  148K fwmark     all  --  *      *       0.0.0.0/0            0.0.0.0/0           

Chain INPUT (policy ACCEPT 1022 packets, 112K bytes)
 pkts bytes target     prot opt in     out     source               destination         

Chain FORWARD (policy ACCEPT 130 packets, 8053 bytes)
 pkts bytes target     prot opt in     out     source               destination         
  130  8053 mssfix     all  --  *      *       0.0.0.0/0            0.0.0.0/0           

Chain OUTPUT (policy ACCEPT 1010 packets, 182K bytes)
 pkts bytes target     prot opt in     out     source               destination         
  17M 1532M mwan3_hook  all  --  *      *       0.0.0.0/0            0.0.0.0/0           
  17M 1532M mwan3_track_hook  all  --  *      *       0.0.0.0/0            0.0.0.0/0           

Chain POSTROUTING (policy ACCEPT 1142 packets, 191K bytes)
 pkts bytes target     prot opt in     out     source               destination         

Chain fwmark (1 references)
 pkts bytes target     prot opt in     out     source               destination         

Chain mssfix (1 references)
 pkts bytes target     prot opt in     out     source               destination         
    0     0 TCPMSS     tcp  --  *      eth0.2  0.0.0.0/0            0.0.0.0/0           tcp flags:0x06/0x02 /* wan (mtu_fix) */ TCPMSS clamp to PMTU 
    2   104 TCPMSS     tcp  --  *      pppoe-wan2  0.0.0.0/0            0.0.0.0/0           tcp flags:0x06/0x02 /* wan (mtu_fix) */ TCPMSS clamp to PMTU 

Chain mwan3_connected (1 references)
 pkts bytes target     prot opt in     out     source               destination         
    9   593 MARK       all  --  *      *       0.0.0.0/0            127.0.0.0/8         mark match 0x0/0xff00 MARK or 0xff00 
   21  3698 MARK       all  --  *      *       0.0.0.0/0            224.0.0.0/3         mark match 0x0/0xff00 MARK or 0xff00 
    0     0 MARK       all  --  *      *       0.0.0.0/0            83.1.4.50           mark match 0x0/0xff00 MARK or 0xff00 
    0     0 MARK       all  --  *      *       0.0.0.0/0            192.168.0.0/24      mark match 0x0/0xff00 MARK or 0xff00 
    8   877 MARK       all  --  *      *       0.0.0.0/0            192.168.1.0/24      mark match 0x0/0xff00 MARK or 0xff00 

Chain mwan3_hook (2 references)
 pkts bytes target     prot opt in     out     source               destination         
  37M 4633M CONNMARK   all  --  *      *       0.0.0.0/0            0.0.0.0/0           CONNMARK restore mask 0xff00 
  14M 1098M mwan3_ifaces  all  --  *      *       0.0.0.0/0            0.0.0.0/0           mark match 0x0/0xff00 
  12M  999M mwan3_connected  all  --  *      *       0.0.0.0/0            0.0.0.0/0           mark match 0x0/0xff00 
  11M  874M mwan3_rules  all  --  *      *       0.0.0.0/0            0.0.0.0/0           mark match 0x0/0xff00 
  37M 4633M CONNMARK   all  --  *      *       0.0.0.0/0            0.0.0.0/0           CONNMARK save mask 0xff00 

Chain mwan3_iface_wan (1 references)
 pkts bytes target     prot opt in     out     source               destination         
51725 8165K MARK       all  --  *      *       192.168.0.0/24       0.0.0.0/0           mark match 0x0/0xff00 /* wan */ MARK or 0xff00 
 2236  167K MARK       all  --  *      *       0.0.0.0/0            0.0.0.0/0           mark match 0x0/0xff00 /* wan */ MARK xset 0x100/0xff00 

Chain mwan3_iface_wan2 (1 references)
 pkts bytes target     prot opt in     out     source               destination         
    0     0 MARK       all  --  *      *       83.1.4.50            0.0.0.0/0           mark match 0x0/0xff00 /* wan2 */ MARK or 0xff00 
   97  5096 MARK       all  --  *      *       0.0.0.0/0            0.0.0.0/0           mark match 0x0/0xff00 /* wan2 */ MARK xset 0x200/0xff00 

Chain mwan3_ifaces (1 references)
 pkts bytes target     prot opt in     out     source               destination         
53961 8332K mwan3_iface_wan  all  --  eth0.2 *       0.0.0.0/0            0.0.0.0/0           mark match 0x0/0xff00 
   97  5096 mwan3_iface_wan2  all  --  pppoe-wan2 *       0.0.0.0/0            0.0.0.0/0           mark match 0x0/0xff00 

Chain mwan3_policy_balanced (1 references)
 pkts bytes target     prot opt in     out     source               destination         
  130 10796 MARK       all  --  *      *       0.0.0.0/0            0.0.0.0/0           mark match 0x0/0xff00 statistic mode random probability 0.400000 /* wan2 2 5 */ MARK xset 0x200/0xff00 
  206 16966 MARK       all  --  *      *       0.0.0.0/0            0.0.0.0/0           mark match 0x0/0xff00 /* wan 3 3 */ MARK xset 0x100/0xff00 

Chain mwan3_policy_wan2_only (0 references)
 pkts bytes target     prot opt in     out     source               destination         
    0     0 MARK       all  --  *      *       0.0.0.0/0            0.0.0.0/0           mark match 0x0/0xff00 /* wan2 2 2 */ MARK xset 0x200/0xff00 

Chain mwan3_policy_wan2_wan (1 references)
 pkts bytes target     prot opt in     out     source               destination         
    0     0 MARK       all  --  *      *       0.0.0.0/0            0.0.0.0/0           mark match 0x0/0xff00 /* wan2 2 2 */ MARK xset 0x200/0xff00 

Chain mwan3_policy_wan_only (0 references)
 pkts bytes target     prot opt in     out     source               destination         
    0     0 MARK       all  --  *      *       0.0.0.0/0            0.0.0.0/0           mark match 0x0/0xff00 /* wan 3 3 */ MARK xset 0x100/0xff00 

Chain mwan3_policy_wan_wan2 (1 references)
 pkts bytes target     prot opt in     out     source               destination         
    0     0 MARK       all  --  *      *       0.0.0.0/0            0.0.0.0/0           mark match 0x0/0xff00 /* wan 3 3 */ MARK xset 0x100/0xff00 

Chain mwan3_rules (1 references)
 pkts bytes target     prot opt in     out     source               destination         
    0     0 mwan3_policy_wan_wan2  tcp  --  *      *       0.0.0.0/0.0.0.1      0.0.0.0/0           multiport sports 0:65535 multiport dports 443 mark match 0x0/0xff00 /* sticky_even */ 
    0     0 mwan3_policy_wan2_wan  tcp  --  *      *       0.0.0.1/0.0.0.1      0.0.0.0/0           multiport sports 0:65535 multiport dports 443 mark match 0x0/0xff00 /* sticky_odd */ 
  336 27762 mwan3_policy_balanced  all  --  *      *       0.0.0.0/0            0.0.0.0/0           mark match 0x0/0xff00 /* default_rule */ 

Chain mwan3_track_hook (1 references)
 pkts bytes target     prot opt in     out     source               destination         
  17M 1532M mwan3_track_wan2  all  --  *      *       0.0.0.0/0            0.0.0.0/0           
  17M 1514M mwan3_track_wan  all  --  *      *       0.0.0.0/0            0.0.0.0/0           

Chain mwan3_track_wan (1 references)
 pkts bytes target     prot opt in     out     source               destination         
 849K   71M MARK       icmp --  *      eth0.2  0.0.0.0/0            208.67.220.220      icmp type 8 MARK or 0xff00 
 849K   71M MARK       icmp --  *      eth0.2  0.0.0.0/0            208.67.222.222      icmp type 8 MARK or 0xff00 
 853K   72M MARK       icmp --  *      eth0.2  0.0.0.0/0            8.8.8.8             icmp type 8 MARK or 0xff00 
 849K   71M MARK       icmp --  *      eth0.2  0.0.0.0/0            8.8.4.4             icmp type 8 MARK or 0xff00 

Chain mwan3_track_wan2 (1 references)
 pkts bytes target     prot opt in     out     source               destination         
   67  5628 MARK       icmp --  *      pppoe-wan2  0.0.0.0/0            208.67.220.220      icmp type 8 MARK or 0xff00 
   67  5628 MARK       icmp --  *      pppoe-wan2  0.0.0.0/0            8.8.8.8             icmp type 8 MARK or 0xff00 

Chain qos_Default (0 references)
 pkts bytes target     prot opt in     out     source               destination         
    0     0 CONNMARK   all  --  *      *       0.0.0.0/0            0.0.0.0/0           CONNMARK restore mask 0xff 
    0     0 qos_Default_ct  all  --  *      *       0.0.0.0/0            0.0.0.0/0           mark match 0x0/0xff 
    0     0 MARK       all  --  *      *       0.0.0.0/0            0.0.0.0/0           mark match 0x1/0xff length 400:65535 MARK and 0xffffff00 
    0     0 MARK       all  --  *      *       0.0.0.0/0            0.0.0.0/0           mark match 0x2/0xff length 800:65535 MARK and 0xffffff00 
    0     0 MARK       udp  --  *      *       0.0.0.0/0            0.0.0.0/0           mark match 0x0/0xff length 0:500 MARK xset 0x2/0xff 
    0     0 MARK       icmp --  *      *       0.0.0.0/0            0.0.0.0/0           MARK xset 0x1/0xff 
    0     0 MARK       tcp  --  *      *       0.0.0.0/0            0.0.0.0/0           mark match 0x0/0xff tcp spts:1024:65535 dpts:1024:65535 MARK xset 0x4/0xff 
    0     0 MARK       udp  --  *      *       0.0.0.0/0            0.0.0.0/0           mark match 0x0/0xff udp spts:1024:65535 dpts:1024:65535 MARK xset 0x4/0xff 
    0     0 MARK       tcp  --  *      *       0.0.0.0/0            0.0.0.0/0           length 0:128 mark match !0x4/0xff tcp flags:0x3F/0x02 MARK xset 0x1/0xff 
    0     0 MARK       tcp  --  *      *       0.0.0.0/0            0.0.0.0/0           length 0:128 mark match !0x4/0xff tcp flags:0x3F/0x10 MARK xset 0x1/0xff 

Chain qos_Default_ct (1 references)
 pkts bytes target     prot opt in     out     source               destination         
    0     0 MARK       tcp  --  *      *       0.0.0.0/0            0.0.0.0/0           mark match 0x0/0xff tcp multiport ports 22,53 MARK xset 0x1/0xff 
    0     0 MARK       udp  --  *      *       0.0.0.0/0            0.0.0.0/0           mark match 0x0/0xff udp multiport ports 22,53 MARK xset 0x1/0xff 
    0     0 MARK       tcp  --  *      *       0.0.0.0/0            0.0.0.0/0           mark match 0x0/0xff tcp multiport ports 20,21,25,80,110,443,993,995 MARK xset 0x3/0xff 
    0     0 MARK       tcp  --  *      *       0.0.0.0/0            0.0.0.0/0           mark match 0x0/0xff tcp multiport ports 5190 MARK xset 0x2/0xff 
    0     0 MARK       udp  --  *      *       0.0.0.0/0            0.0.0.0/0           mark match 0x0/0xff udp multiport ports 5190 MARK xset 0x2/0xff 
    0     0 CONNMARK   all  --  *      *       0.0.0.0/0            0.0.0.0/0           CONNMARK save mask 0xff</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p252639">
				<div class="post-metadata">
					<div class="post-num">Post #981</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						31 Oct 2014, 15:55					</div>
				</div>
				<div class="post-content content">
					<p>Hi qweas2,</p><br /><p>I think that if you change this<br /></p><div class="codebox"><pre><code>config rule
        option name &#039;8888&#039;
        option dest_port &#039;8888&#039;
        option dest_ip &#039;192.168.1.111&#039;
        option target &#039;ACCEPT&#039;
        option src &#039;wan&#039;
        option proto &#039;tcp&#039;
        option dest &#039;lan&#039;</code></pre></div><p>to this<br /></p><div class="codebox"><pre><code>config rule
        option name &#039;8888&#039;
        option dest_port &#039;8888&#039;
        option target &#039;ACCEPT&#039;
        option src &#039;wan&#039;
        option proto &#039;tcp&#039;</code></pre></div><p>you will get better results. It is not a mwan3 issue though...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p253165">
				<div class="post-metadata">
					<div class="post-num">Post #982</div>
					<div class="post-author">biatche</div>
					<div class="post-datetime">
						5 Nov 2014, 09:45					</div>
				</div>
				<div class="post-content content">
					<p>Hi. I&#039;ve not updated my mwan v1 or v2 for 2 years probably now and intend to do so now..</p><p>I vaguely remember that it&#039;s now possible to have 2x pppoe even if the isp provides the same gateway.</p><p>Something to do with MAC VLAN or something as I recall..How does this work now?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p253166">
				<div class="post-metadata">
					<div class="post-num">Post #983</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						5 Nov 2014, 09:49					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>biatche wrote:</cite><blockquote><p>I vaguely remember that it&#039;s now possible to have 2x pppoe even if the isp provides the same gateway. Something to do with MAC VLAN or something as I recall..How does this work now?</p></blockquote></div><p>Nothing special is needed for multiple ppp interfaces with same gateway ip. Each ppp interface needs it&#039;s own unique ip address and metric and you should be good te go.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p253173">
				<div class="post-metadata">
					<div class="post-num">Post #984</div>
					<div class="post-author">biatche</div>
					<div class="post-datetime">
						5 Nov 2014, 11:10					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><div class="quotebox"><cite>biatche wrote:</cite><blockquote><p>I vaguely remember that it&#039;s now possible to have 2x pppoe even if the isp provides the same gateway. Something to do with MAC VLAN or something as I recall..How does this work now?</p></blockquote></div><p>Nothing special is needed for multiple ppp interfaces with same gateway ip. Each ppp interface needs it&#039;s own unique ip address and metric and you should be good te go.</p></blockquote></div><p>Just curious, does it utilize mac vlan? (Long time ago I remembered you posted introducing mac vlan)</p><p>Wonder how you solved the ppp-same-gateway riddle...</p><p>thanks! <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" />)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p253204">
				<div class="post-metadata">
					<div class="post-num">Post #985</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						5 Nov 2014, 16:57					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>biatche wrote:</cite><blockquote><p>Just curious, does it utilize mac vlan? (Long time ago I remembered you posted introducing mac vlan)</p></blockquote></div><p>No. The mac vlan was just a test to see if multiple wan interfaces with the same gateway on an ethernet LAN would work. The trick was to create multiple wan interfaces with multiple mac addresses. This was easy with mac vlan. With ppp you don&#039;t have that issue, as you already have individual interfaces.</p><p>If you want to use multiple wan interfaces with the same gateway ip on the same ethernet (v)lan, then you still need the mac vlan trick.</p><div class="quotebox"><cite>biatche wrote:</cite><blockquote><p>Wonder how you solved the ppp-same-gateway riddle...</p></blockquote></div><p>Differentiate on interfaces instead of ip and create multiple routing tables.</p>											<p class="post-edited">(Last edited by <strong>Adze</strong> on 5 Nov 2014, 17:00)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p253720">
				<div class="post-metadata">
					<div class="post-num">Post #986</div>
					<div class="post-author">ValdikSS</div>
					<div class="post-datetime">
						9 Nov 2014, 17:17					</div>
				</div>
				<div class="post-content content">
					<p>Hello!<br />Can someone suggest me any application/script/daemon for policy routing in usual (not OpenWRT) Linux?<br />I need it only for IPv6, so I don&#039;t need any connmarks, NAT or anything. I also don&#039;t need any balancing or failover.<br />Is there any?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p253989">
				<div class="post-metadata">
					<div class="post-num">Post #987</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						12 Nov 2014, 00:45					</div>
				</div>
				<div class="post-content content">
					<p>Both Barrier_Breaker and trunk package repositories have luci-app-mwan3 1.3-5 as of now.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p254126">
				<div class="post-metadata">
					<div class="post-num">Post #988</div>
					<div class="post-author">JohnV</div>
					<div class="post-datetime">
						13 Nov 2014, 01:35					</div>
				</div>
				<div class="post-content content">
					<p>I am trying to get nodogsplash captive portal running with mwan3.</p><p>However, there seems to be a conflict.</p><p>When I run mwan3, and then start nodogsplash, the captive portal is not working correctly.</p><p>If I stop mwan3, and then start nodogsplash, the captive portal is working ok.</p><p>Is this a known issue?</p><p>I am not an iptable expert so digging into the code fo nodogsplash makes me a bit nervous, but if someone can point me in the right direction, or ask me to post some info that might help, that would be great.</p>											<p class="post-edited">(Last edited by <strong>JohnV</strong> on 13 Nov 2014, 01:35)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p254175">
				<div class="post-metadata">
					<div class="post-num">Post #989</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						13 Nov 2014, 11:53					</div>
				</div>
				<div class="post-content content">
					<p>Hi JohnV,</p><br /><p>I have never tried mwan3 running with nodogsplash. Lets see if we can make things work.. Could you paste output of the follwing, when nodogsplash is running and mwan3 is not:</p><p>- ip route<br />- ip rule<br />- iptables -L -t mangle -v -n</p><p>Thnx!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p254212">
				<div class="post-metadata">
					<div class="post-num">Post #990</div>
					<div class="post-author">JohnV</div>
					<div class="post-datetime">
						13 Nov 2014, 19:12					</div>
				</div>
				<div class="post-content content">
					<p>I have QOS installed, but it is not enabled below.</p><p>Below is without any users authenticated on the Guest WLAN (which is where nodogsplash is running), which means they cannot get to the internet, only to the splash screen.</p><p>Only other item to point out, is the config files has a value for &quot;External Interface&quot;.&nbsp; I am leaving it at default, but maybe that is where the issue is also.&nbsp; I am inlcuding the info for that param here also:</p><p># Parameter: ExternalInterface<br /># Default: Autodetected from /proc/net/route<br />#<br /># This should be autodetected on a OpenWRT system, but if not:<br /># Set ExtrnalInterface to the &#039;external&#039; interface on your router, <br /># i.e. the one which provides the default route to the internet.<br /># Typically vlan1 for OpenWRT.<br />#<br /># ExternalInterface vlan1</p><br /><br /><p>ip route:</p><p>default via 10.64.64.64 dev 3g-wan2&nbsp; proto static&nbsp; metric 10 <br />default via 10.10.20.1 dev eth0&nbsp; proto static&nbsp; metric 20 <br />10.10.10.0/24 dev br-lan&nbsp; proto kernel&nbsp; scope link&nbsp; src 10.10.10.1 <br />10.10.20.0/24 dev eth0&nbsp; proto static&nbsp; scope link&nbsp; metric 20 <br />10.10.30.0/24 dev wlan0-1&nbsp; proto kernel&nbsp; scope link&nbsp; src 10.10.30.1 <br />10.64.64.64 dev 3g-wan2&nbsp; proto kernel&nbsp; scope link&nbsp; src 10.136.27.221 </p><p>ip rule:</p><p>0:&nbsp; &nbsp; from all lookup local <br />32766:&nbsp; &nbsp; from all lookup main <br />32767:&nbsp; &nbsp; from all lookup default</p><p>iptables:</p><p>Chain PREROUTING (policy ACCEPT 1874 packets, 571K bytes)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp;16&nbsp; 1798 ndsOUT&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; wlan0-1 *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp;16&nbsp; 1798 ndsBLK&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; wlan0-1 *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp;16&nbsp; 1798 ndsTRU&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; wlan0-1 *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br /> 9104 3006K fwmark&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p><p>Chain INPUT (policy ACCEPT 200 packets, 19712 bytes)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p><p>Chain FORWARD (policy ACCEPT 1670 packets, 551K bytes)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br /> 8171 2913K mssfix&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p><p>Chain OUTPUT (policy ACCEPT 195 packets, 32762 bytes)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p><p>Chain POSTROUTING (policy ACCEPT 1865 packets, 583K bytes)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 ndsINC&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; wlan0-1&nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p><p>Chain fwmark (1 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p><p>Chain mssfix (1 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; 263 13676 TCPMSS&nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; eth0&nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tcp flags:0x06/0x02 /* wan (mtu_fix) */ TCPMSS clamp to PMTU<br />&nbsp; 103&nbsp; 5388 TCPMSS&nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; 3g-wan2&nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tcp flags:0x06/0x02 /* wan (mtu_fix) */ TCPMSS clamp to PMTU</p><p>Chain ndsBLK (1 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p><p>Chain ndsINC (1 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p><p>Chain ndsOUT (1 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p><p>Chain ndsTRU (1 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p><p>Chain qos_Default (0 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 CONNMARK&nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CONNMARK restore mask 0xf<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 qos_Default_ct&nbsp; all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mark match 0x0/0xf<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mark match 0x1/0xf length 400:65535 MARK and 0xffffff00<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mark match 0x2/0xf length 800:65535 MARK and 0xffffff00<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;udp&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mark match 0x0/0xf0 length 0:500 MARK xset 0x22/0xff<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;icmp --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; MARK xset 0x11/0xff<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mark match 0x0/0xf0 tcp spts:1024:65535 dpts:1024:65535 MARK xset 0x44/0xff<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;udp&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mark match 0x0/0xf0 udp spts:1024:65535 dpts:1024:65535 MARK xset 0x44/0xff<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; length 0:128 mark match ! 0x4/0xf tcp flags:0x3F/0x02 MARK xset 0x11/0xff<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; length 0:128 mark match ! 0x4/0xf tcp flags:0x3F/0x10 MARK xset 0x11/0xff<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 CONNMARK&nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CONNMARK save mask 0xf0</p><p>Chain qos_Default_ct (1 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mark match 0x0/0xf tcp multiport ports 22,53 MARK xset 0x11/0xff<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;udp&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mark match 0x0/0xf udp multiport ports 22,53 MARK xset 0x11/0xff<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mark match 0x0/0xf tcp multiport ports 20,21,25,80,110,443,993,995 MARK xset 0x33/0xff<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mark match 0x0/0xf tcp multiport ports 5190 MARK xset 0x22/0xff<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;udp&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mark match 0x0/0xf udp multiport ports 5190 MARK xset 0x22/0xff<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 CONNMARK&nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CONNMARK save mask 0xff<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mark match 0x0/0xf tcp multiport ports 22,53 MARK xset 0x11/0xff<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;udp&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mark match 0x0/0xf udp multiport ports 22,53 MARK xset 0x11/0xff<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mark match 0x0/0xf tcp multiport ports 20,21,25,80,110,443,993,995 MARK xset 0x33/0xff<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mark match 0x0/0xf tcp multiport ports 5190 MARK xset 0x22/0xff<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;udp&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mark match 0x0/0xf udp multiport ports 5190 MARK xset 0x22/0xff</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p254222">
				<div class="post-metadata">
					<div class="post-num">Post #991</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						13 Nov 2014, 19:58					</div>
				</div>
				<div class="post-content content">
					<p>Hi JohnV,</p><p>In the output you pasted there is nothing that could collide with man3, which is good, but doesn&#039;t explain anything yet. Please could you try and give me the same output when at least one client is authenticated?</p><p>And could you also try and to run nodog and mwan3 together, but have only one mwan3 rule configured. A rule which states that everything should be routed according to main (default) routing table?</p><div class="codebox"><pre><code>config rule &#039;default_rule&#039;
        option dest_ip &#039;0.0.0.0/0&#039;
        option use_policy &#039;default&#039;</code></pre></div><p>Thnx</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p254227">
				<div class="post-metadata">
					<div class="post-num">Post #992</div>
					<div class="post-author">kpv</div>
					<div class="post-datetime">
						13 Nov 2014, 20:53					</div>
				</div>
				<div class="post-content content">
					<p>Adze, you can find more at <a href="https://github.com/nodogsplash/nodogsplash">https://github.com/nodogsplash/nodogsplash</a></p><p>I did look at it some time ago and iirc it needed some work to cooperate gracefully with other apps (qos and mwan).</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p254228">
				<div class="post-metadata">
					<div class="post-num">Post #993</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						13 Nov 2014, 21:01					</div>
				</div>
				<div class="post-content content">
					<p>Hi JohnV,</p><br /><p>I have looked up some info on the workings of nodogsplash and i think i have an idea what&#039;s going wrong. I have no openwrt router at the moment i can play with, so it is just a hunch. Maybe you could test it.</p><p>What is happening is that an unauthenticated client wants to access a webpage. A packet is sent from client to internet. This is first picked up by iptables PREROUTING mangle table. There it will be marked according mwan3 rules. In this example it is marked for interface wan2.</p><p>Then the packet handled by iptables PREROUTING nat table. The destination address of the packet from the unauthenticated client gets natted to the webpage nodog is listening on.</p><p>The last step is to actually route the packet. But here comes the crux. As it is marked for wan2 interface, it will lookup the routing table of wan2 and will be routed out wan2. Never will the packet reach the nodog splash page.</p><p>In order to fix this we have to overrule the packet mark and use the default routing table instead. This has to be done after PREROUTING nat table. There is only one place left where we can do this, the mangle FORWARD table.</p><p>To test if my assumption is correct. Could you try and run nodog and mwan3 and the following command:</p><div class="codebox"><pre><code>iptables -t mangle -w -A FORWARD -j mwan3_connected</code></pre></div><p>and let me know if this works?</p>											<p class="post-edited">(Last edited by <strong>Adze</strong> on 13 Nov 2014, 21:05)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p254281">
				<div class="post-metadata">
					<div class="post-num">Post #994</div>
					<div class="post-author">JohnV</div>
					<div class="post-datetime">
						14 Nov 2014, 05:09					</div>
				</div>
				<div class="post-content content">
					<p>Unfortunately the extra iptables command didnt seem to help.</p><p>Here are some more strange behaviours:</p><p>When WAN2 is down and WAN is up, when I try to access the internet the page just hangs.&nbsp; I do not get a splash screen nor does the page load.&nbsp; When I try to access local admin pages on router, I get the nsd splash sceen.&nbsp; If I stop nsd, I can access the interent OK.</p><p>I then put WAN2 online: when WAN2 and WAN both up, I can access the internet without authenticating with nsd.&nbsp; When I try to access the router itself, I get the splash screen.</p><p>If I then shut down WAN2, nsd (via /usr/bin/ndsctl status) shows the client as authenticated, however when I try to access a local device, I get prompted with the splash screen again, even though I have already authenticated when both WAN2 and WAN were both online.</p><p>Here is the info from the router, with WAN and WAN2 both online, both nsd and mwan3 and the iptables command you requested.&nbsp; The guest device also was authenticated at this time. </p><p>default via 10.64.64.64 dev 3g-wan2&nbsp; proto static&nbsp; metric 10 <br />default via 10.10.20.1 dev eth0&nbsp; proto static&nbsp; metric 20 <br />10.10.10.0/24 dev br-lan&nbsp; proto kernel&nbsp; scope link&nbsp; src 10.10.10.1 <br />10.10.20.0/24 dev eth0&nbsp; proto static&nbsp; scope link&nbsp; metric 20 <br />10.10.30.0/24 dev wlan0-1&nbsp; proto kernel&nbsp; scope link&nbsp; src 10.10.30.1 <br />10.64.64.64 dev 3g-wan2&nbsp; proto kernel&nbsp; scope link&nbsp; src 10.136.25.75 </p><br /><p>0:&nbsp; &nbsp; from all lookup local <br />1001:&nbsp; &nbsp; from all iif eth0 lookup main <br />1002:&nbsp; &nbsp; from all iif 3g-wan2 lookup main <br />2001:&nbsp; &nbsp; from all fwmark 0x100/0xff00 lookup 1 <br />2002:&nbsp; &nbsp; from all fwmark 0x200/0xff00 lookup 2 <br />2253:&nbsp; &nbsp; from all fwmark 0xfd00/0xff00 blackhole<br />2254:&nbsp; &nbsp; from all fwmark 0xfe00/0xff00 unreachable<br />32766:&nbsp; &nbsp; from all lookup main <br />32767:&nbsp; &nbsp; from all lookup default </p><br /><br /><br /><p>Chain PREROUTING (policy ACCEPT 386 packets, 63307 bytes)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; 472 67784 ndsOUT&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; wlan0-1 *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; 472 67784 ndsBLK&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; wlan0-1 *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; 472 67784 ndsTRU&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; wlan0-1 *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br /> 7988 1742K mwan3_hook&nbsp; all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br /> 6760 1566K fwmark&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p><p>Chain INPUT (policy ACCEPT 102 packets, 9646 bytes)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p><p>Chain FORWARD (policy ACCEPT 284 packets, 53661 bytes)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br /> 5701 1453K mssfix&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br /> 1342&nbsp; 471K mwan3_connected&nbsp; all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p><p>Chain OUTPUT (policy ACCEPT 101 packets, 13371 bytes)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br /> 1173&nbsp; 305K mwan3_hook&nbsp; all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br /> 1173&nbsp; 305K mwan3_output_hook&nbsp; all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p><p>Chain POSTROUTING (policy ACCEPT 379 packets, 66376 bytes)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; 375&nbsp; 330K ndsINC&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; wlan0-1&nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p><p>Chain fwmark (1 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p><p>Chain mssfix (1 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; 258 13812 TCPMSS&nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; eth0&nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tcp flags:0x06/0x02 /* wan (mtu_fix) */ TCPMSS clamp to PMTU<br />&nbsp; &nbsp;53&nbsp; 3284 TCPMSS&nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; 3g-wan2&nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tcp flags:0x06/0x02 /* wan (mtu_fix) */ TCPMSS clamp to PMTU</p><p>Chain mwan3_connected (3 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 127.0.0.0/8&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; MARK or 0xff00<br />&nbsp; &nbsp;27&nbsp; 4717 MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 224.0.0.0/3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; MARK or 0xff00<br />&nbsp; 354 75456 MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 10.10.10.0/24&nbsp; &nbsp; &nbsp; &nbsp; MARK or 0xff00<br />&nbsp; 761 66039 MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 10.10.20.0/24&nbsp; &nbsp; &nbsp; &nbsp; MARK or 0xff00<br />&nbsp; 316&nbsp; 306K MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 10.10.30.0/24&nbsp; &nbsp; &nbsp; &nbsp; MARK or 0xff00<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 10.64.64.64&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; MARK or 0xff00</p><p>Chain mwan3_hook (2 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br /> 9161 2047K CONNMARK&nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CONNMARK restore mask 0xff00<br />&nbsp; 827 68731 mwan3_ifaces&nbsp; all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mark match 0x0/0xff00<br />&nbsp; 807 67554 mwan3_connected&nbsp; all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mark match 0x0/0xff00<br />&nbsp; 423 42134 mwan3_rules&nbsp; all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mark match 0x0/0xff00<br /> 9161 2047K CONNMARK&nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CONNMARK save mask 0xff00<br /> 3536 1038K mwan3_connected&nbsp; all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mark match ! 0xff00/0xff00</p><p>Chain mwan3_iface_wan (1 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; eth0&nbsp; &nbsp;*&nbsp; &nbsp; &nbsp; &nbsp;10.10.20.0/24&nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mark match 0x0/0xff00 /* default */ MARK or 0xff00<br />&nbsp; &nbsp;14&nbsp; &nbsp;943 MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; eth0&nbsp; &nbsp;*&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mark match 0x0/0xff00 /* wan */ MARK xset 0x100/0xff00</p><p>Chain mwan3_iface_wan2 (1 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; 3g-wan2 *&nbsp; &nbsp; &nbsp; &nbsp;10.64.64.64&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mark match 0x0/0xff00 /* default */ MARK or 0xff00<br />&nbsp; &nbsp; 6&nbsp; &nbsp;234 MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; 3g-wan2 *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mark match 0x0/0xff00 /* wan2 */ MARK xset 0x200/0xff00</p><p>Chain mwan3_ifaces (1 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; 824 68619 mwan3_iface_wan&nbsp; all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mark match 0x0/0xff00<br />&nbsp; 571 43386 mwan3_iface_wan2&nbsp; all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mark match 0x0/0xff00</p><p>Chain mwan3_output_hook (1 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p><p>Chain mwan3_policy_wan2_only (0 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mark match 0x0/0xff00 /* wan2 10 10 */ MARK xset 0x200/0xff00</p><p>Chain mwan3_policy_wan2_wan (1 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; 216 20372 MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mark match 0x0/0xff00 /* wan2 10 10 */ MARK xset 0x200/0xff00</p><p>Chain mwan3_policy_wan_only (0 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mark match 0x0/0xff00 /* wan 10 10 */ MARK xset 0x100/0xff00</p><p>Chain mwan3_policy_wan_wan2 (0 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mark match 0x0/0xff00 /* wan 10 10 */ MARK xset 0x100/0xff00</p><p>Chain mwan3_rules (1 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; 216 20372 mwan3_policy_wan2_wan&nbsp; all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mark match 0x0/0xff00 /* default_rule */</p><p>Chain ndsBLK (1 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p><p>Chain ndsINC (1 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; 6&nbsp; &nbsp;656 MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 10.10.30.122&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;MARK or 0xa400<br />&nbsp; 322&nbsp; 312K MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 10.10.30.122&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;MARK or 0xa400<br />&nbsp; &nbsp; 6&nbsp; &nbsp;656 ACCEPT&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 10.10.30.122&nbsp; &nbsp; &nbsp; &nbsp; </p><p>Chain ndsOUT (1 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; 8&nbsp; 3000 MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;10.10.30.122&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; MAC 54:E4:3A:9B:C5:A0 MARK or 0xa400</p><p>Chain ndsTRU (1 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p><p>Chain qos_Default (0 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 CONNMARK&nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CONNMARK restore mask 0xf<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 qos_Default_ct&nbsp; all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mark match 0x0/0xf<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mark match 0x1/0xf length 400:65535 MARK and 0xffffff00<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mark match 0x2/0xf length 800:65535 MARK and 0xffffff00<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;udp&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mark match 0x0/0xf0 length 0:500 MARK xset 0x22/0xff<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;icmp --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; MARK xset 0x11/0xff<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mark match 0x0/0xf0 tcp spts:1024:65535 dpts:1024:65535 MARK xset 0x44/0xff<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;udp&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mark match 0x0/0xf0 udp spts:1024:65535 dpts:1024:65535 MARK xset 0x44/0xff<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; length 0:128 mark match ! 0x4/0xf tcp flags:0x3F/0x02 MARK xset 0x11/0xff<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; length 0:128 mark match ! 0x4/0xf tcp flags:0x3F/0x10 MARK xset 0x11/0xff<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 CONNMARK&nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CONNMARK save mask 0xf0</p><p>Chain qos_Default_ct (1 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mark match 0x0/0xf tcp multiport ports 22,53 MARK xset 0x11/0xff<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;udp&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mark match 0x0/0xf udp multiport ports 22,53 MARK xset 0x11/0xff<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mark match 0x0/0xf tcp multiport ports 20,21,25,80,110,443,993,995 MARK xset 0x33/0xff<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mark match 0x0/0xf tcp multiport ports 5190 MARK xset 0x22/0xff<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;udp&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mark match 0x0/0xf udp multiport ports 5190 MARK xset 0x22/0xff<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 CONNMARK&nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CONNMARK save mask 0xff<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mark match 0x0/0xf tcp multiport ports 22,53 MARK xset 0x11/0xff<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;udp&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mark match 0x0/0xf udp multiport ports 22,53 MARK xset 0x11/0xff<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mark match 0x0/0xf tcp multiport ports 20,21,25,80,110,443,993,995 MARK xset 0x33/0xff<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mark match 0x0/0xf tcp multiport ports 5190 MARK xset 0x22/0xff<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;udp&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mark match 0x0/0xf udp multiport ports 5190 MARK xset 0x22/0xff</p>											<p class="post-edited">(Last edited by <strong>JohnV</strong> on 14 Nov 2014, 05:12)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p254298">
				<div class="post-metadata">
					<div class="post-num">Post #995</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						14 Nov 2014, 09:14					</div>
				</div>
				<div class="post-content content">
					<p>Hi JohnV,</p><br /><p>Looking at your output, i see the problem:</p><div class="codebox"><pre><code>Chain ndsINC (1 references)
pkts bytes target     prot opt in     out     source               destination         
    6   656 MARK       all  --  *      *       0.0.0.0/0            10.10.30.122         MARK or 0xa400
  322  312K MARK       all  --  *      *       0.0.0.0/0            10.10.30.122         MARK or 0xa400
    6   656 ACCEPT     all  --  *      *       0.0.0.0/0            10.10.30.122       
Chain ndsOUT (1 references)
pkts bytes target     prot opt in     out     source               destination         
    8  3000 MARK       all  --  *      *       10.10.30.122         0.0.0.0/0            MAC 54:E4:3A:9B:C5:A0 MARK or 0xa400</code></pre></div><p>Nodog uses exactly the same bits to mark traffic as mwan3 uses. There is no simpel solution. Either mwan3 or nodog has to change to at least give it a change to work.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p254362">
				<div class="post-metadata">
					<div class="post-num">Post #996</div>
					<div class="post-author">JohnV</div>
					<div class="post-datetime">
						14 Nov 2014, 19:06					</div>
				</div>
				<div class="post-content content">
					<p>Well, I am glad you found the (first) issue.</p><p>Thanks for spending the time with me on this, and hopefully others will find this issue as well, and perhaps someone will be willing to work with nds to make some changes to it.</p><p>They do have a mailing list, but I only send one email and did not get any response back.&nbsp; I will try to contact again and point them to this thread and your info.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p254385">
				<div class="post-metadata">
					<div class="post-num">Post #997</div>
					<div class="post-author">JohnV</div>
					<div class="post-datetime">
						14 Nov 2014, 22:25					</div>
				</div>
				<div class="post-content content">
					<p>I received this message from the nds developers.&nbsp; Not knowing what bits I should use that would be OK, if you can provide what would be safe to use I will test it.</p><p>------------------------------------------------------------------------------------------------------------------------</p><p>Reading the thread Adze comes to the conclusion that mwan3 and nodogsplash uses the same marking values for iptables.</p><p>You can choose the values for marking in the nodogsplash.conf configuration file:<br />FW_MARK_AUTHENTICATED 14<br />FW_MARK_TRUSTED 15<br />FW_MARK_BLOCKED 16</p><p>Let us know if this works! <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p>											<p class="post-edited">(Last edited by <strong>JohnV</strong> on 14 Nov 2014, 22:25)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p254390">
				<div class="post-metadata">
					<div class="post-num">Post #998</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						14 Nov 2014, 22:50					</div>
				</div>
				<div class="post-content content">
					<p>That sounds promising. QoS script uses the first 8 bits, mwan3 the second 8 bits. So values 17, 18 and 19 could work.</p><p>Although.. Looking at the output you posted earlier, it had a mark of 0xa400. This equals 1010 0100 0000 0000. This would suggest that at least bits 11, 14 and 16 are used.</p>											<p class="post-edited">(Last edited by <strong>Adze</strong> on 14 Nov 2014, 23:06)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p254412">
				<div class="post-metadata">
					<div class="post-num">Post #999</div>
					<div class="post-author">JohnV</div>
					<div class="post-datetime">
						15 Nov 2014, 05:20					</div>
				</div>
				<div class="post-content content">
					<p>I found this in the source:</p><p>#define DEFAULT_FW_MARK_AUTHENTICATED 0x400<br />#define DEFAULT_FW_MARK_TRUSTED 0x200<br />#define DEFAULT_FW_MARK_BLOCKED 0x100</p><p>Perhaps their email was an example of what to change them to...... </p><p>I will try overriding the values in the config file and see what happens.&nbsp; I will post results once I have a moment to do the test.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p254467">
				<div class="post-metadata">
					<div class="post-num">Post #1000</div>
					<div class="post-author">JohnV</div>
					<div class="post-datetime">
						15 Nov 2014, 20:18					</div>
				</div>
				<div class="post-content content">
					<p>Quick update, the changes seem to work at first testing.&nbsp; I am doing more work with it so will post an update shortly.</p>									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 40 of 65</div><nav><ul><li><a href="viewtopic.php%3Fid=39052&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=38.html">38</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=39.html">39</a></li><li class="pagination-current"><span>40</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=41.html">41</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=42.html">42</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=65.html">65</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0.001 -->

</body>
</html>