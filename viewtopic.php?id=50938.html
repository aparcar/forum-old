<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Captive portal solutions for OpenWRT ?</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 22 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p235531">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">kpv</div>
					<div class="post-datetime">
						3 Jun 2014, 18:41					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;d be most interested to discuss the subject of captive portal solutions on OpenWRT, and more specifically how they compare with other low-cost solutions e.g. Mikrotik and UBNT.</p><p>In the past few years I&#039;ve installed/tested over a dozen FOSS captive portal solutions (just about every FOSS router/firewall distro includes one, from m0n0wall to ZeroShell). Additionally all commercial Wifi vendors from Cisco / Meraki to Ruckus and Aruba also include a CP solution.</p><p>I noticed there are several CP packages for OpenWRT (e.g. coova, wifidog, nodogsplash, nocatsplash, luci-splash), but most haven&#039;t been updated in years and I&#039;m not quite sure how well these packages would actually work in a actual Wifi hotspot deployment with more than a handful users, since in recent years most OSes (notably mobile devices) have been changing their behavior when connecting to Wifi hotspots, breaking previous conventions.</p><p>TIA.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p235532">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">qasdfdsaq</div>
					<div class="post-datetime">
						3 Jun 2014, 18:49					</div>
				</div>
				<div class="post-content content">
					<p>Following the philosophy of &quot;If it aint broke, don&#039;t f*** with it&quot; I don&#039;t understand the incessant need for all software to be constantly updated. Other than to perhaps justify having a job for the developer.</p><p>I haven&#039;t seen any real changes on mobile OSs of how they behave when connecting to Wifi hotspots and the changes I have seen make them work <em>better</em> with previous conventions.</p><p>And frankly some of the open source ones work better than the fudgey mess that is the Cisco captive portal...</p>											<p class="post-edited">(Last edited by <strong>qasdfdsaq</strong> on 3 Jun 2014, 18:49)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p235541">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">3zl</div>
					<div class="post-datetime">
						3 Jun 2014, 19:48					</div>
				</div>
				<div class="post-content content">
					<p>Would be very much interested to in that matter.</p><p>Last one i tried was wifidog/authpuppy combo.</p><p>Too much flaws with outaged Symphony php framework and no proper docs.</p><p>I did even plan to let someone rewrite and document it properly ( code &amp; user ) but until now would have been too expensive investment for me.</p><p>Myself haven&#039;t got the time and php knowledge for a project like that.</p><p>Some years ago coova with external AAA was nice but AFAIK not possible any more.</p><p>Still look around for some decent FOSS system for 10-100 users</p><p>regards<br />3zl</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p235549">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">kpv</div>
					<div class="post-datetime">
						3 Jun 2014, 20:43					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>qasdfdsaq wrote:</cite><blockquote><p>I haven&#039;t seen any real changes on mobile OSs of how they behave when connecting to Wifi hotspots and the changes I have seen make them work <em>better</em> with previous conventions.</p></blockquote></div><p>Well, if you go check forums for IT professionals at educational institutions which deploy larger Wifi hotspots for BYOD (e.g. educause or edugeek), you&#039;ll find many discussions about how new mobile OSes brought in by users were incompatible with their existing hotspot solutions (by Cisco, Aruba etc) necessitating updates, so your statement above is demonstrably not true ...</p>											<p class="post-edited">(Last edited by <strong>kpv</strong> on 3 Jun 2014, 21:17)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p235550">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">kpv</div>
					<div class="post-datetime">
						3 Jun 2014, 20:58					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>3zl wrote:</cite><blockquote><p>Some years ago coova with external AAA was nice but AFAIK not possible any more.</p></blockquote></div><p>Why, what happened to Coova(Chilli) ? It&#039;s been 3 years since I last used it.</p><p>I noticed there are a couple of patches for the OpenWRT coova package, which were submitted by Coova developer, which don&#039;t seem to be included in the coova-chilli_1.3.0-5 package.</p><div class="quotebox"><cite>3zl wrote:</cite><blockquote><p>Still look around for some decent FOSS system for 10-100 users</p></blockquote></div><p>Right, there are decent solutions for larger hotspots, but for small/medium-sized hotspots up to 100 users I&#039;m still looking / testing ...</p>											<p class="post-edited">(Last edited by <strong>kpv</strong> on 3 Jun 2014, 21:01)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p235559">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">qasdfdsaq</div>
					<div class="post-datetime">
						3 Jun 2014, 22:28					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>kpv wrote:</cite><blockquote><div class="quotebox"><cite>qasdfdsaq wrote:</cite><blockquote><p>I haven&#039;t seen any real changes on mobile OSs of how they behave when connecting to Wifi hotspots and the changes I have seen make them work <em>better</em> with previous conventions.</p></blockquote></div><p>Well, if you go check forums for IT professionals at educational institutions which deploy larger Wifi hotspots for BYOD (e.g. educause or edugeek), you&#039;ll find many discussions about how new mobile OSes brought in by users were incompatible with their existing hotspot solutions (by Cisco, Aruba etc) necessitating updates, so your statement above is demonstrably not true ...</p></blockquote></div><p>Except I am an IT professional at an educational institution who runs around 2500 wifi access points with over 12,000 daily users.</p><p>Windows 8 caused more problems than mobile devices. We&#039;ve had next to zero complaints from mobile users (service desk stats) and the few we&#039;ve had were mostly down to faulty devices. Our Cisco WiSMs had to be updated for Vista, then Windows 7, then a few years later for Windows 8, and then again for 8.1 compatibility but never for any mobile platform. I&#039;ve heard similar stories from other institutions running Juniper kit but not so much Aruba. Then again I find Cisco&#039;s level 3 TAC demonstrably more useful than some odd randomers on forums but hey, who am I to tell.</p><p>I&#039;m not sure what &quot;new mobile OSs&quot; you&#039;re referring to but there have been nada issues caused by recent updates to Android, Crackberry works just fine on enterprise deployments as always and iOS is dealt with by someone else so I wouldn&#039;t know. Windows phone we have too few clients running to make any real judgements.</p><p>There&#039;s also far more problems caused by changes to <em>web</em> services, e.g. Google, Facebook, Youtube but those are nothing to do with the mobile OSs people access them from, the same problems occur on a Windows PC.</p>											<p class="post-edited">(Last edited by <strong>qasdfdsaq</strong> on 3 Jun 2014, 22:30)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p235586">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">3zl</div>
					<div class="post-datetime">
						4 Jun 2014, 01:45					</div>
				</div>
				<div class="post-content content">
					<p>Nice to see two experts with alot of experience but please dont fight!</p><p>Everybody has his field of expertise, so we&#039;d better get it together and learn something from it.</p><p>I just had a look at &quot;Authpuppy&quot; again and made a call at freelancers to revise and transport the code to Symfony 2.5, together with a decent structure/program/user dokumentation.</p><p>I will see how much they charge and keep you posted if there is any interest.</p><p>Any recommendations where to put a project like this ( besides github ? )</p><p>regards<br />3zl</p>											<p class="post-edited">(Last edited by <strong>3zl</strong> on 5 Jun 2014, 16:25)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p235605">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">kavastudios</div>
					<div class="post-datetime">
						4 Jun 2014, 07:00					</div>
				</div>
				<div class="post-content content">
					<p>I think along with a new version of authpuppy, also a new version of wifidog could be helpful, for example to adapt the use of social networks login and support of white listed domains (insted of fixed ip ranges)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p235630">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">qasdfdsaq</div>
					<div class="post-datetime">
						4 Jun 2014, 14:46					</div>
				</div>
				<div class="post-content content">
					<p>I did see it mentioned in another thread that the current captive portals have issues with social media logins (something that wasn&#039;t around when they were designed), and that&#039;s possibly one of the few reasons I can think of to update. I&#039;m yet to see any concrete examples of a &quot;change in behaviour&quot; of modern mobile OSs that &quot;breaking previous conventions&quot;, but then again I don&#039;t deal with iOS since iOS breaks so many conventions that we&#039;re close to barring Apple devices from parts of our network completely (deliberately stealing IPs of other devices as a <em>default behaviour</em>?! I mean, come on, seriously?!).</p><p>Now to be fair I personally don&#039;t trust these social media login extensions most of the time regardless, and would be even less inclined to trust said details to a public hotspot run by some random organisation I have no ties with. </p><p>Not knowing the technical details of how these social media login systems work, based on other people complaining they use &quot;4k different IPs&quot; I don&#039;t see why current captive portals can&#039;t handle them simply with a subnet based whitelist. Assuming thsoe 4k IPs are in distinct subnets, then then setting the rules gets more difficult and obviously since IPTables is, as the name would imply, IP based and not DNS based, you would need some sort of userspace handler for the login stage, which would not be trivial to implement.</p><p>The easiest workaround IMO would probably be to have the pre-login traffic all forwarded to a transparent proxy such as Squid or Apache that <em>can</em> filter by either forward or reverse DNS, and also passes SSL traffic properly in order to not break encrypted sessions.</p>											<p class="post-edited">(Last edited by <strong>qasdfdsaq</strong> on 4 Jun 2014, 14:49)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p235631">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						4 Jun 2014, 14:55					</div>
				</div>
				<div class="post-content content">
					<p>There is a DNS proxy called &quot;ipset-dns&quot; which populates an ipset with all received A or AAAA records for a resolved domain. This proxy is intended to be used as upstream server for dnsmasq using a directive like &quot;server=/facebook.com/127.0.0.1#53001&quot; in dnsmasq.conf.</p><p>The autopopulated ipset can then be used in iptables matches to selectively handle particular domains.<br />Take a look at <a href="http://git.zx2c4.com/ipset-dns/about/">http://git.zx2c4.com/ipset-dns/about/</a></p><p>For this to work correctly you must however force all DNS lookups through your local dnsmasq using REDIRECT rules, even if the client tries to use a public DNS server explicitely.</p><br /><p>A while ago I did a quick writeup on a &quot;domain based&quot; policy routing, this can be adapted to the op&#039;s use case. Instead of setting fwmarks, one could make it an ACCEPT rule or whatever is needed to bypass the captive portal.</p><p><a href="https://forum.openwrt.org/viewtopic.php?pid=207497#p207497">https://forum.openwrt.org/viewtopic.php … 97#p207497</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p235655">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">kpv</div>
					<div class="post-datetime">
						4 Jun 2014, 20:33					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>jow wrote:</cite><blockquote><p>A while ago I did a quick writeup on a &quot;domain based&quot; policy routing, this can be adapted to the op&#039;s use case. Instead of setting fwmarks, one could make it an ACCEPT rule or whatever is needed to bypass the captive portal.</p><p><a href="https://forum.openwrt.org/viewtopic.php?pid=207497#p207497">https://forum.openwrt.org/viewtopic.php … 97#p207497</a></p></blockquote></div><p>Thanks for that tutorial.</p><p>It seems to me that the ipset-dns functionality might also be suited for other tasks e.g. one could selectively allow access only to certain cloud apps (e.g. GoogleApps, Outlook365 etc) but block general Internet access, without having to manually maintain IP block ranges (which is possible for GoogleApps that us using Google&#039;s own IP ranges, but not possible for other SaaS that use popular CDNs).</p>											<p class="post-edited">(Last edited by <strong>kpv</strong> on 4 Jun 2014, 20:35)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p235660">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">3zl</div>
					<div class="post-datetime">
						4 Jun 2014, 21:30					</div>
				</div>
				<div class="post-content content">
					<p>Does anybody know if the dnsmasq option </p><p> --ipset=/&lt;domain&gt;/[domain/]&lt;ipset&gt;[,&lt;ipset&gt;]<br />&nbsp; &nbsp; Places the resolved IP addresses of queries for the specified domains in the specified netfilter ip sets. Domains and subdomains are matched in the same way as --address. These ip sets must already exist. See ipset(8) for more details. </p><p>is build in the current Openwrt dnsmasq version ?</p><p>Any report if it works ?</p><p>regards<br />3zl</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p235667">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">kpv</div>
					<div class="post-datetime">
						4 Jun 2014, 22:38					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>3zl wrote:</cite><blockquote><p>Does anybody know if the dnsmasq option&nbsp; --ipset is build in the current Openwrt dnsmasq version ?</p></blockquote></div><p>Apparently ipset is not built into dnsmasq, according to a quick test:</p><p>root@OpenWrt:/etc/config# dnsmasq --version<br />Dnsmasq version 2.71&nbsp; Copyright (c) 2000-2014 Simon Kelley<br />Compile time options: IPv6 GNU-getopt no-DBus no-i18n no-IDN DHCP no-DHCPv6 no-Lua TFTP no-conntrack no-ipset no-auth no-DNSSEC</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p237616">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">kpv</div>
					<div class="post-datetime">
						21 Jun 2014, 22:08					</div>
				</div>
				<div class="post-content content">
					<p>At the UBNT forums, there are reports about large-scale hotspots using CoovaChilli e.g.</p><p>Re: City Wide wifi 500+ UAP&#039;s on one network<br />Virtual Server: 2x CPU 2599MGz<br />RAM 8 Gb<br />HDD 80 Gb<br />OS: Ubuntu 12.04-server LTS.<br />UniFi-Controller 3.2.1<br />20 Sites<br />593 Access Points<br />590 working in Layer2<br />Hot-Spot: Coova Chilli</p><p>Src:<br /><a href="http://community.ubnt.com/t5/UniFi/City-Wide-wifi-500-UAP-s-on-one-network/m-p/883188#U883188">http://community.ubnt.com/t5/UniFi/City … 88#U883188</a><br /><a href="http://community.ubnt.com/t5/UniFi-Stories/Just-Screenshots-v-2/cns-p/847894">http://community.ubnt.com/t5/UniFi-Stor … s-p/847894</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p244502">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">augustus_meyer</div>
					<div class="post-datetime">
						21 Aug 2014, 14:58					</div>
				</div>
				<div class="post-content content">
					<p>Just modifying the FW of&nbsp; open-mesh.com APs to be used with coova-chilli/Radius. <br />Looks good for small number of users, as the HW is a bit slow. For higher numbers of clients, I would use pcengines.ch APUs, running full LINX, like voyage, for example.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>