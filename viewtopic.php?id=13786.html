<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Segfaults with corrupted stack - kamikaze and c++</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 28 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p60514">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">TonyC</div>
					<div class="post-datetime">
						16 Dec 2007, 22:52					</div>
				</div>
				<div class="post-content content">
					<p>I am stuck on what to try next in terms of trying to figure out why a program would cross-compile just fine, but SEGFAULTs when trying to run it on the router before main() is even entered.</p><p>To avoid flooding this post with too much information, here&#039;s the short story.&nbsp; I am mostly interested in whether this problem sounds familiar to anyone and what next steps I could take to diagnose the problem.</p><p>&nbsp; o The router is a Linksys WRTSL54GS running a 2.4 kamikaze:<br />&nbsp; &nbsp; &nbsp; uname -a<br />&nbsp; &nbsp; &nbsp; Linux sparky 2.4.34 #3 Sun Sep 30 20:33:21 CEST 2007 mips unknown</p><p>&nbsp; o The code is a mix of C and C++ code, and the C parts themselves compile and run fine. Add the C++ parts and it compiles fine (using the OpenSDK on an ubuntu machine) but SEGFAULTS when run on the router. Native compiling on ubuntu, the code runs just fine.</p><p>&nbsp; o I&#039;ve tried this with two completely different C++ parts added to it and get the same behavior, though one gives a SEGFAULT and the other an &#039;Aborted&#039;.&nbsp; Core dumps of both look identically bad in the mipsel GDB:</p><p>&nbsp; &nbsp; (gdb) target core /tmp/core<br />&nbsp; &nbsp; Core was generated by `./facetrack2&#039;.<br />&nbsp; &nbsp; Program terminated with signal 6, Aborted.<br />&nbsp; &nbsp; #0&nbsp; 0x00000020 in ?? ()<br />&nbsp; &nbsp; (gdb) bt<br />&nbsp; &nbsp; #0&nbsp; 0x00000020 in ?? ()<br />&nbsp; &nbsp; #1&nbsp; 0x00000020 in ?? ()<br />&nbsp; &nbsp; Previous frame identical to this frame (corrupt stack?)</p><p>&nbsp; o I&#039;ve tried the remote debugging with a gdbserver on the router, and get a similar issue with the stack when trying to connect with the missel debugger:</p><p>&nbsp; &nbsp; (gdb) target remote 192.168.200.203:1234<br />&nbsp; &nbsp; Remote debugging using 192.168.200.203:1234<br />&nbsp; &nbsp; 0x2aaa8ad0 in ?? ()<br />&nbsp; &nbsp; (gdb) bt<br />&nbsp; &nbsp; #0&nbsp; 0x2aaa8ad0 in ?? ()<br />&nbsp; &nbsp; #1&nbsp; 0x2aaa8ad0 in ?? ()<br />&nbsp; &nbsp; Previous frame identical to this frame (corrupt stack?)</p><p>&nbsp; o Putting a printf statement as first line in main() never gets printed before SEGFAULT.</p><p>&nbsp; o I&#039;ve followed lots of the tutorials for setting up the package building and ipkgs needed, and have the libcpp installed, and have gotten past all the issues with cross-compiling and not being able to find the necessary libraries, so all looks good until I run it.</p><p>&nbsp; o I&#039;ve tried linking to both libstdc++ and uClibc++ with the same results both times.</p><p>Anyone have any similar experience or know some way to look at the core file to diagnose?</p><p>Thanks.</p><p>-Tony</p>											<p class="post-edited">(Last edited by <strong>TonyC</strong> on 17 Dec 2007, 01:01)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p67441">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">jeroen.avonts</div>
					<div class="post-datetime">
						25 Apr 2008, 17:05					</div>
				</div>
				<div class="post-content content">
					<p>I have the same problem. Any hints on this?</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>