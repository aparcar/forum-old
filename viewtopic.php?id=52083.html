<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Need help with VLAN configuration on tl-wr1043nd v2</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 2 May 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p243204">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">benjamin94</div>
					<div class="post-datetime">
						8 Aug 2014, 10:06					</div>
				</div>
				<div class="post-content content">
					<p>So i have a tl-wr1043nd v2 which i need to modify a LAN port to be a WAN port. </p><p>So like this:</p><p>I have a modem which outputs 2 signals:</p><p>First port: normal internet access<br />Second port: IPTV network</p><p>This is what i need:</p><p>1 standard WAN port for normal internet. (already configured standard)<br />Also change 1 LAN port of the switch to be a WAN port for IPTV.</p><p>Then i need the other 3 LAN ports to be just LAN ports so i can hook a swithc or other computers on to it.</p><p>Im already trying for 3 days now, i had no luck i already have read alot about VLAN but i cant seem to configure it.</p><p>Here is the routers default config:</p><p><strong>Interfaces:</strong><br /><span class="postimg"><img src="http://imghost.nl/download/Knipsel2%282%29.png" alt="http://imghost.nl/download/Knipsel2%282%29.png" /></span></p><p><strong>Switch &amp; VLAN:</strong><br /><span class="postimg"><img src="http://imghost.nl/download/Knipsel%2817%29.png" alt="http://imghost.nl/download/Knipsel%2817%29.png" /></span></p><p>Can you guys tell me which settings i should edit? I would like to be LAN port 1 as IPTV WAN.</p><p>Here (<a href="http://wiki.openwrt.org/toh/tp-link/tl-wr1043nd#switch.ports.for.vlans">http://wiki.openwrt.org/toh/tp-link/tl- â€¦ .for.vlans</a>) they say the port numbers are inverted when you compare to labels on device itself.</p><p>Please let me know if anything is unclear (I dont speak English as native language)</p>											<p class="post-edited">(Last edited by <strong>benjamin94</strong> on 8 Aug 2014, 12:53)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p243272">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">benjamin94</div>
					<div class="post-datetime">
						8 Aug 2014, 23:42					</div>
				</div>
				<div class="post-content content">
					<p>Please anyone im already 3 days busy with this and i dont have any more ideas.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p243276">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">makro</div>
					<div class="post-datetime">
						9 Aug 2014, 00:04					</div>
				</div>
				<div class="post-content content">
					<p>VLAN ID 1/Port 4 should be &quot;off&quot;. Create a VLAN ID 3, and set Port 4 to &quot;untagged&quot; on VID 3. Don&#039;t know if CPU should be tagged or untagged, try either (you may need to set CPU to tagged on VID 1 as well). That should separate LAN1 from the rest. However, there is no port you can connect your IPTV equipment to. </p><p>Please post your /etc/config/network if this doesn&#039;t work, it&#039;s easier to work with than screenshots.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p243316">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">benjamin94</div>
					<div class="post-datetime">
						9 Aug 2014, 12:14					</div>
				</div>
				<div class="post-content content">
					<p>Hey thanks for the answer i followed your steps and now i cant ping to my router anymore.</p><p>I booted in failsafe mode and this is what i got in /etc/config/network:</p><br /><p>config interface &#039;loopback&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname &#039;lo&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;static&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr &#039;127.0.0.1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask &#039;255.0.0.0&#039;</p><p>config globals &#039;globals&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ula_prefix &#039;fd5e:88ff:bc1c::/48&#039;</p><p>config interface &#039;lan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname &#039;eth1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option force_link &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option type &#039;bridge&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;static&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr &#039;192.168.1.1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask &#039;255.255.255.0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ip6assign &#039;60&#039;</p><p>config interface &#039;wan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname &#039;eth0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;dhcp&#039;</p><p>config interface &#039;wan6&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname &#039;@wan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;dhcpv6&#039;</p><p>config switch<br />&nbsp; &nbsp; &nbsp; &nbsp; option name &#039;switch0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option reset &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option enable_vlan &#039;1&#039;</p><p>config switch_vlan<br />&nbsp; &nbsp; &nbsp; &nbsp; option device &#039;switch0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option vlan &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ports &#039;0 1 2 3&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option vid &#039;1&#039;</p><p>config switch_vlan<br />&nbsp; &nbsp; &nbsp; &nbsp; option device &#039;switch0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option vlan &#039;2&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ports &#039;5 6&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option vid &#039;2&#039;</p><p>config switch_vlan<br />&nbsp; &nbsp; &nbsp; &nbsp; option device &#039;switch0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option vlan &#039;3&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option vid &#039;3&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ports &#039;0t 4&#039;</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p243322">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">vincenzo</div>
					<div class="post-datetime">
						9 Aug 2014, 12:30					</div>
				</div>
				<div class="post-content content">
					<p>hi, i have vlan on TP-Link TL-WR842N/ND v1 and all work very well, 2 wan and other lan.<br />the first point is set tagged all on for cpu for every vlan, your lan is eth 0.1 (first vlan), you must change in physical setting on network lan<br />vlan 01, set cpu tagged, the port for other wan to off , other to untagged&nbsp; (lan)<br />vlan 02, set cpu tagged, the port for your wan to untagged, other off&nbsp; &nbsp; &nbsp; &nbsp; (wan)<br />vlan 03, set cpu tagged, the port for your wan to untagged, other off&nbsp; &nbsp; &nbsp; &nbsp; (wan2)</p><p>first you reboot set lan to eth 0.1 (network-lan-physical setting), wan to eth 0.2, wan2 to eth 0.3<br />now you have 2 wan and other ports for lan<br />(now you cant use the old original wan, but the new)</p><p>if you need you can use multiwan or mwan3 for best use of your multiple wan<br />also on my router the port numbers are inverted, no problem, last is port 1</p>											<p class="post-edited">(Last edited by <strong>vincenzo</strong> on 9 Aug 2014, 13:01)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p243326">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">makro</div>
					<div class="post-datetime">
						9 Aug 2014, 12:52					</div>
				</div>
				<div class="post-content content">
					<div class="codebox"><pre><code>config switch_vlan
        option device &#039;switch0&#039;
        option vlan &#039;1&#039;
        option ports &#039;0t 1 2&#039;
        option vid &#039;1&#039;

config switch_vlan
        option device &#039;switch0&#039;
        option vlan &#039;2&#039;
        option ports &#039;5 6t&#039;
        option vid &#039;2&#039;

config switch_vlan
        option device &#039;switch0&#039;
        option vlan &#039;3&#039;
        option vid &#039;3&#039;
        option ports &#039;0t 3 4&#039;</code></pre></div><p>That should do it. Connect LAN1 to WAN-IPTV, LAN2 to your IPTV equipment/decoder/whatever, LAN3 and LAN4 gives you internet access for your computers.</p>											<p class="post-edited">(Last edited by <strong>makro</strong> on 9 Aug 2014, 12:52)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p243349">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">benjamin94</div>
					<div class="post-datetime">
						9 Aug 2014, 17:35					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>makro wrote:</cite><blockquote><div class="codebox"><pre><code>config switch_vlan
        option device &#039;switch0&#039;
        option vlan &#039;1&#039;
        option ports &#039;0t 1 2&#039;
        option vid &#039;1&#039;

config switch_vlan
        option device &#039;switch0&#039;
        option vlan &#039;2&#039;
        option ports &#039;5 6t&#039;
        option vid &#039;2&#039;

config switch_vlan
        option device &#039;switch0&#039;
        option vlan &#039;3&#039;
        option vid &#039;3&#039;
        option ports &#039;0t 3 4&#039;</code></pre></div><p>That should do it. Connect LAN1 to WAN-IPTV, LAN2 to your IPTV equipment/decoder/whatever, LAN3 and LAN4 gives you internet access for your computers.</p></blockquote></div><p>Thanks however it didnt work, i could still access the WEB Interface of the router and also got IP on devices but i couldnt access the internet.</p><p>Do you mean the LAN 1 like its labveled on the router or the Web interface under Switch?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p243351">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">makro</div>
					<div class="post-datetime">
						9 Aug 2014, 18:14					</div>
				</div>
				<div class="post-content content">
					<p>At the points I said connect, I referred to the physical ports. As you can see on the wiki, the port numbers in software and on the label don&#039;t match, my configuration was based on the information on the wiki. </p><p>I missed the lan interface, change:<br /></p><div class="codebox"><pre><code>config interface &#039;lan&#039;
        option ifname &#039;eth1&#039;</code></pre></div><p>to:<br /></p><div class="codebox"><pre><code>config interface &#039;lan&#039;
        option ifname &#039;eth1.1&#039;</code></pre></div><p>Also, you can add this just for clarity:<br /></p><div class="codebox"><pre><code>config interface &#039;iptv&#039;
        option ifname &#039;eth1.3&#039;
        option proto &#039;none&#039;</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p243352">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">benjamin94</div>
					<div class="post-datetime">
						9 Aug 2014, 18:15					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>vincenzo wrote:</cite><blockquote><p>hi, i have vlan on TP-Link TL-WR842N/ND v1 and all work very well, 2 wan and other lan.<br />the first point is set tagged all on for cpu for every vlan, your lan is eth 0.1 (first vlan), you must change in physical setting on network lan<br />vlan 01, set cpu tagged, the port for other wan to off , other to untagged&nbsp; (lan)<br />vlan 02, set cpu tagged, the port for your wan to untagged, other off&nbsp; &nbsp; &nbsp; &nbsp; (wan)<br />vlan 03, set cpu tagged, the port for your wan to untagged, other off&nbsp; &nbsp; &nbsp; &nbsp; (wan2)</p><p>first you reboot set lan to eth 0.1 (network-lan-physical setting), wan to eth 0.2, wan2 to eth 0.3<br />now you have 2 wan and other ports for lan<br />(now you cant use the old original wan, but the new)</p><p>if you need you can use multiwan or mwan3 for best use of your multiple wan<br />also on my router the port numbers are inverted, no problem, last is port 1</p></blockquote></div><p>When i try that it says: Port 5 is untagged in multiple VLANs!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p243353">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">benjamin94</div>
					<div class="post-datetime">
						9 Aug 2014, 18:31					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>makro wrote:</cite><blockquote><p>At the points I said connect, I referred to the physical ports. As you can see on the wiki, the port numbers in software and on the label don&#039;t match, my configuration was based on the information on the wiki. </p><p>I missed the lan interface, change:<br /></p><div class="codebox"><pre><code>config interface &#039;lan&#039;
        option ifname &#039;eth1&#039;</code></pre></div><p>to:<br /></p><div class="codebox"><pre><code>config interface &#039;lan&#039;
        option ifname &#039;eth1.1&#039;</code></pre></div><p>Also, you can add this just for clarity:<br /></p><div class="codebox"><pre><code>config interface &#039;iptv&#039;
        option ifname &#039;eth1.3&#039;
        option proto &#039;none&#039;</code></pre></div></blockquote></div><p>No still not, im sorry to bother you. My iptv decoder works perfectly! </p><p>Here is my network file:</p><br /><p>config interface &#039;loopback&#039;<br />&nbsp; &nbsp; option ifname &#039;lo&#039;<br />&nbsp; &nbsp; option proto &#039;static&#039;<br />&nbsp; &nbsp; option ipaddr &#039;127.0.0.1&#039;<br />&nbsp; &nbsp; option netmask &#039;255.0.0.0&#039;</p><p>config globals &#039;globals&#039;<br />&nbsp; &nbsp; option ula_prefix &#039;fddc:8952:8651::/48&#039;</p><p>config interface &#039;lan&#039;<br />&nbsp; &nbsp; option ifname &#039;eth1.1&#039;<br />&nbsp; &nbsp; option force_link &#039;1&#039;<br />&nbsp; &nbsp; option type &#039;bridge&#039;<br />&nbsp; &nbsp; option proto &#039;static&#039;<br />&nbsp; &nbsp; option ipaddr &#039;192.168.1.1&#039;<br />&nbsp; &nbsp; option netmask &#039;255.255.255.0&#039;<br />&nbsp; &nbsp; option ip6assign &#039;60&#039;</p><br /><br /><p>config interface &#039;wan&#039;<br />&nbsp; &nbsp; option ifname &#039;eth0&#039;<br />&nbsp; &nbsp; option proto &#039;dhcp&#039;</p><p>config interface &#039;wan6&#039;<br />&nbsp; &nbsp; option ifname &#039;@wan&#039;<br />&nbsp; &nbsp; option proto &#039;dhcpv6&#039;</p><p>config switch<br />&nbsp; &nbsp; option name &#039;switch0&#039;<br />&nbsp; &nbsp; option reset &#039;1&#039;<br />&nbsp; &nbsp; option enable_vlan &#039;1&#039;</p><p>config switch_vlan<br />&nbsp; &nbsp; option device &#039;switch0&#039;<br />&nbsp; &nbsp; option vlan &#039;1&#039;<br />&nbsp; &nbsp; option ports &#039;0t 1 2&#039;<br />&nbsp; &nbsp; option vid &#039;1&#039;</p><p>config switch_vlan<br />&nbsp; &nbsp; option device &#039;switch0&#039;<br />&nbsp; &nbsp; option vlan &#039;2&#039;<br />&nbsp; &nbsp; option ports &#039;5 6t&#039;<br />&nbsp; &nbsp; option vid &#039;2&#039;</p><p>config switch_vlan<br />&nbsp; &nbsp; option device &#039;switch0&#039;<br />&nbsp; &nbsp; option vlan &#039;3&#039;<br />&nbsp; &nbsp; option vid &#039;3&#039;<br />&nbsp; &nbsp; option ports &#039;0t 3 4&#039;</p><p>config interface &#039;iptv&#039;<br />&nbsp; &nbsp; option ifname &#039;eth1.3&#039;<br />&nbsp; &nbsp; option proto &#039;none&#039;</p>											<p class="post-edited">(Last edited by <strong>benjamin94</strong> on 9 Aug 2014, 18:42)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p243354">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">vincenzo</div>
					<div class="post-datetime">
						9 Aug 2014, 18:44					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>benjamin94 wrote:</cite><blockquote><div class="quotebox"><cite>vincenzo wrote:</cite><blockquote><p>hi, i have vlan on TP-Link TL-WR842N/ND v1 and all work very well, 2 wan and other lan.<br />the first point is set tagged all on for cpu for every vlan, your lan is eth 0.1 (first vlan), you must change in physical setting on network lan<br />vlan 01, set cpu tagged, the port for other wan to off , other to untagged&nbsp; (lan)<br />vlan 02, set cpu tagged, the port for your wan to untagged, other off&nbsp; &nbsp; &nbsp; &nbsp; (wan)<br />vlan 03, set cpu tagged, the port for your wan to untagged, other off&nbsp; &nbsp; &nbsp; &nbsp; (wan2)</p><p>first you reboot set lan to eth 0.1 (network-lan-physical setting), wan to eth 0.2, wan2 to eth 0.3<br />now you have 2 wan and other ports for lan<br />(now you cant use the old original wan, but the new)</p><p>if you need you can use multiwan or mwan3 for best use of your multiple wan<br />also on my router the port numbers are inverted, no problem, last is port 1</p></blockquote></div><p>When i try that it says: Port 5 is untagged in multiple VLANs!</p></blockquote></div><br /><p>my config is ok 100%, you only must check on wiki the reference for your port,<br />remember you must change in physical setting<br />you can set all on gui, on shell you can have mistake</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p243356">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">makro</div>
					<div class="post-datetime">
						9 Aug 2014, 18:55					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>vincenzo wrote:</cite><blockquote><p>my config is ok 100%, you only must check on wiki the reference for your port</p></blockquote></div><p>Keep in mind that the WR1043ND v2 has two Ethernet interfaces, eth0 (physical WAN port) and eth1 (physical LAN ports). Your WR842ND has only eth0, which makes the config a bit different. I didn&#039;t think of this at first either, so it&#039;s the reason of my eth1.1 fix above, and also the reason why internet is no longer working. Change:<br /></p><div class="codebox"><pre><code>config interface &#039;wan&#039;
    option ifname &#039;eth0&#039;</code></pre></div><p>to:<br /></p><div class="codebox"><pre><code>config interface &#039;wan&#039;
    option ifname &#039;eth0.2&#039;</code></pre></div><p>That should get you back on the internet.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p243366">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">benjamin94</div>
					<div class="post-datetime">
						9 Aug 2014, 19:27					</div>
				</div>
				<div class="post-content content">
					<p>Hey, </p><p>I changed it to eth0.2 and now it works all! </p><p>Thank you very much and God bless you. </p><p>Again you thanks you saved me a lot more days if stress.</p>											<p class="post-edited">(Last edited by <strong>benjamin94</strong> on 9 Aug 2014, 19:33)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p243392">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">Borromini</div>
					<div class="post-datetime">
						10 Aug 2014, 00:37					</div>
				</div>
				<div class="post-content content">
					<p>You should post the final layout, might be helpful to other people if they run into the same problem <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile" />.</p><p>Glad you got it working!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p243394">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">benjamin94</div>
					<div class="post-datetime">
						10 Aug 2014, 00:49					</div>
				</div>
				<div class="post-content content">
					<p>So Marko helped me out a lot and this is the final solution :</p><p>config interface &#039;loopback&#039;<br />&nbsp; &nbsp; option ifname &#039;lo&#039;<br />&nbsp; &nbsp; option proto &#039;static&#039;<br />&nbsp; &nbsp; option ipaddr &#039;127.0.0.1&#039;<br />&nbsp; &nbsp; option netmask &#039;255.0.0.0&#039;</p><p>config globals &#039;globals&#039;<br />&nbsp; &nbsp; option ula_prefix &#039;fddc:8952:8651::/48&#039;</p><p>config interface &#039;lan&#039;<br />&nbsp; &nbsp; option ifname &#039;eth1.1&#039;<br />&nbsp; &nbsp; option force_link &#039;1&#039;<br />&nbsp; &nbsp; option type &#039;bridge&#039;<br />&nbsp; &nbsp; option proto &#039;static&#039;<br />&nbsp; &nbsp; option ipaddr &#039;192.168.1.1&#039;<br />&nbsp; &nbsp; option netmask &#039;255.255.255.0&#039;<br />&nbsp; &nbsp; option ip6assign &#039;60&#039;</p><p>config interface &#039;wan&#039;<br />&nbsp; &nbsp; option ifname &#039;eth0.2&#039;<br />&nbsp; &nbsp; option proto &#039;dhcp&#039;</p><p>config interface &#039;wan6&#039;<br />&nbsp; &nbsp; option ifname &#039;@wan&#039;<br />&nbsp; &nbsp; option proto &#039;dhcpv6&#039;</p><p>config switch<br />&nbsp; &nbsp; option name &#039;switch0&#039;<br />&nbsp; &nbsp; option reset &#039;1&#039;<br />&nbsp; &nbsp; option enable_vlan &#039;1&#039;</p><p>config switch_vlan<br />&nbsp; &nbsp; option device &#039;switch0&#039;<br />&nbsp; &nbsp; option vlan &#039;1&#039;<br />&nbsp; &nbsp; option ports &#039;0t 1 2&#039;<br />&nbsp; &nbsp; option vid &#039;1&#039;</p><p>config switch_vlan<br />&nbsp; &nbsp; option device &#039;switch0&#039;<br />&nbsp; &nbsp; option vlan &#039;2&#039;<br />&nbsp; &nbsp; option ports &#039;5 6t&#039;<br />&nbsp; &nbsp; option vid &#039;2&#039;</p><p>config switch_vlan<br />&nbsp; &nbsp; option device &#039;switch0&#039;<br />&nbsp; &nbsp; option vlan &#039;3&#039;<br />&nbsp; &nbsp; option vid &#039;3&#039;<br />&nbsp; &nbsp; option ports &#039;0t 3 4&#039;</p><p>config interface &#039;iptv&#039;<br />&nbsp; &nbsp; option ifname &#039;eth1.3&#039;<br />&nbsp; &nbsp; option proto &#039;none&#039;</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p253242">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">et</div>
					<div class="post-datetime">
						5 Nov 2014, 21:10					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>I have brand new TL-WR1043ND v2 with the &quot;openwrt-ar71xx-generic-tl-wr1043nd-v2-squashfs-factory.bin&quot; installed (as of 02-Oct-2014 07:28).</p><p>Using the config below I get internet working, but not the IPTV, which has to be VLAN 6 for my provider. I would really appreciate any ideas how to get it all working. Many thanks!</p><p>config interface &#039;loopback&#039;<br />&nbsp; &nbsp; option ifname &#039;lo&#039;<br />&nbsp; &nbsp; option proto &#039;static&#039;<br />&nbsp; &nbsp; option ipaddr &#039;127.0.0.1&#039;<br />&nbsp; &nbsp; option netmask &#039;255.0.0.0&#039;</p><p>config globals &#039;globals&#039;<br />&nbsp; &nbsp; option ula_prefix &#039;fddc:8952:8651::/48&#039;</p><p>config interface &#039;lan&#039;<br />&nbsp; &nbsp; option ifname &#039;eth1.1&#039;<br />&nbsp; &nbsp; option force_link &#039;1&#039;<br />&nbsp; &nbsp; option type &#039;bridge&#039;<br />&nbsp; &nbsp; option proto &#039;static&#039;<br />&nbsp; &nbsp; option ipaddr &#039;192.168.1.1&#039;<br />&nbsp; &nbsp; option netmask &#039;255.255.255.0&#039;<br />&nbsp; &nbsp; option ip6assign &#039;60&#039;</p><p>config interface &#039;wan&#039;<br />&nbsp; &nbsp; option ifname &#039;eth0.2&#039;<br />&nbsp; &nbsp; option proto &#039;dhcp&#039;</p><p>config interface &#039;wan6&#039;<br />&nbsp; &nbsp; option ifname &#039;@wan&#039;<br />&nbsp; &nbsp; option proto &#039;dhcpv6&#039;</p><p>config switch<br />&nbsp; &nbsp; option name &#039;switch0&#039;<br />&nbsp; &nbsp; option reset &#039;1&#039;<br />&nbsp; &nbsp; option enable_vlan &#039;1&#039;</p><p>config switch_vlan<br />&nbsp; &nbsp; option device &#039;switch0&#039;<br />&nbsp; &nbsp; option vlan &#039;1&#039;<br />&nbsp; &nbsp; option ports &#039;0t 3 4&#039;<br />&nbsp; &nbsp; option vid &#039;1&#039;</p><p>config switch_vlan<br />&nbsp; &nbsp; option device &#039;switch0&#039;<br />&nbsp; &nbsp; option vlan &#039;2&#039;<br />&nbsp; &nbsp; option ports &#039;5 6t&#039;<br />&nbsp; &nbsp; option vid &#039;2&#039;</p><p>config switch_vlan<br />&nbsp; &nbsp; option device &#039;switch0&#039;<br />&nbsp; &nbsp; option vlan &#039;6&#039;<br />&nbsp; &nbsp; option vid &#039;6&#039;<br />&nbsp; &nbsp; option ports &#039;0t 1 2&#039;</p><p>config interface &#039;iptv&#039;<br />&nbsp; &nbsp; option ifname &#039;eth1.6&#039;<br />&nbsp; &nbsp; option proto &#039;none&#039;</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p253249">
				<div class="post-metadata">
					<div class="post-num">Post #17</div>
					<div class="post-author">makro</div>
					<div class="post-datetime">
						5 Nov 2014, 22:50					</div>
				</div>
				<div class="post-content content">
					<p>Some details are missing. Is IPTV traffic supposed to be tagged with VLAN 6 on the WAN side? Your VLAN 6 is only configured on the LAN ports - there is nothing coming from or to VLAN 6 on the WAN side.</p><p>Try this for your VLAN 6 and IPTV interface:<br /></p><div class="codebox"><pre><code>config switch_vlan
    option device &#039;switch0&#039;
    option vlan &#039;6&#039;
    option vid &#039;6&#039;
    option ports &#039;0t 1 2 5t 6t&#039;

config interface &#039;iptv&#039;
    option type &#039;bridge&#039;
    option ifname &#039;eth0.6 eth1.6&#039;
    option proto &#039;none&#039;</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p253639">
				<div class="post-metadata">
					<div class="post-num">Post #18</div>
					<div class="post-author">et</div>
					<div class="post-datetime">
						8 Nov 2014, 18:56					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>Thanks for an answer! Yes, IPTV traffic supposed to be tagged. Unfortunately neither internet no IPTV was working with the suggested configuration. Can it be that BB 14.07 bug for TL-WR1043ND v2 makes it impossible to have tagged and untagged VLANs both in the same time? <a href="http://patchwork.openwrt.org/patch/5941/">http://patchwork.openwrt.org/patch/5941/</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p253641">
				<div class="post-metadata">
					<div class="post-num">Post #19</div>
					<div class="post-author">makro</div>
					<div class="post-datetime">
						8 Nov 2014, 19:22					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><blockquote><p>I have brand new TL-WR1043ND v2 with the &quot;openwrt-ar71xx-generic-tl-wr1043nd-v2-squashfs-factory.bin&quot; installed (as of 02-Oct-2014 07:28).</p></blockquote></div><p>I interpreted this as a trunk image of October 2nd (which has tagged+untagged working). Running BB release image will not work with my suggested configuration, as it won&#039;t run tagged+untagged traffic on the same port.</p><p>Try latest trunk image, or check if your ISP will accept tagged internet traffic on some other VLAN.</p>											<p class="post-edited">(Last edited by <strong>makro</strong> on 8 Nov 2014, 19:23)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p257078">
				<div class="post-metadata">
					<div class="post-num">Post #20</div>
					<div class="post-author">huntywrt</div>
					<div class="post-datetime">
						9 Dec 2014, 15:53					</div>
				</div>
				<div class="post-content content">
					<p>Hello,<br /> I have very similar problem to benjamin94. Im trying to solve since 2 weeks. Have tried with Ddwrt firmware, Tp-link firmwares for malasia and Russia with IpTv support but couldn&#039;t success what ever i tried.</p><p>My problem: My cable internet Isp has Tv service also. They brought me Mag 250 IpTv box and a cheap router. Dlink dir300. I am trying to change the router with my router Tp-wr1043nd v2. But there is no Vlan settings in the original firmware.<br />One port should go to Iptv box and rest for Lan. Iptvbox getting his own ip from the server. <br />Here is pic what im trying to setup.</p><p><a href="http://postimg.org/image/nnpc76qnv/"><span class="postimg"><img src="http://s1.postimg.org/nnpc76qnv/TP_wrt1043nd_v2.jpg" alt="http://s1.postimg.org/nnpc76qnv/TP_wrt1043nd_v2.jpg" /></span></a></p><p>As you can see iptv box getting a sperate ip address from the router. Which is 159.1.2.20 atm. My network is on 192.168.1.*</p><p>This is their Dlink routers vlan setup:<br /><a href="http://postimg.org/image/yjzbjba75/"><span class="postimg"><img src="http://s16.postimg.org/yjzbjba75/dlinkn150.jpg" alt="http://s16.postimg.org/yjzbjba75/dlinkn150.jpg" /></span></a></p><p>They told me Vlan id must be 3. Nothing more.</p><p>My curret firmware:<br />Powered by LuCI Trunk (0.12+svn-r10530) OpenWrt Barrier Breaker 14.07</p><p>I have tried Bnejamins final cfg but:<br />1-Lag started with router. Pages loaded very long time<br />2-Switch settings lost from Luci webinterface<br />3-Couldn&#039;t connected to internet</p><p>I have flashed back to original settings. Here is my network cfg:</p><p>config interface &#039;loopback&#039;<br />&nbsp; &nbsp; option ifname &#039;lo&#039;<br />&nbsp; &nbsp; option proto &#039;static&#039;<br />&nbsp; &nbsp; option ipaddr &#039;127.0.0.1&#039;<br />&nbsp; &nbsp; option netmask &#039;255.0.0.0&#039;</p><p>config globals &#039;globals&#039;<br />&nbsp; &nbsp; option ula_prefix &#039;fde1:4ce5:32df::/48&#039;</p><p>config interface &#039;lan&#039;<br />&nbsp; &nbsp; option ifname &#039;eth1&#039;<br />&nbsp; &nbsp; option force_link &#039;1&#039;<br />&nbsp; &nbsp; option type &#039;bridge&#039;<br />&nbsp; &nbsp; option proto &#039;static&#039;<br />&nbsp; &nbsp; option ipaddr &#039;192.168.1.1&#039;<br />&nbsp; &nbsp; option netmask &#039;255.255.255.0&#039;<br />&nbsp; &nbsp; option ip6assign &#039;60&#039;</p><p>config interface &#039;wan&#039;<br />&nbsp; &nbsp; option ifname &#039;eth0&#039;<br />&nbsp; &nbsp; option proto &#039;dhcp&#039;</p><p>config interface &#039;wan6&#039;<br />&nbsp; &nbsp; option ifname &#039;@wan&#039;<br />&nbsp; &nbsp; option proto &#039;dhcpv6&#039;</p><p>config switch<br />&nbsp; &nbsp; option name &#039;switch0&#039;<br />&nbsp; &nbsp; option reset &#039;1&#039;<br />&nbsp; &nbsp; option enable_vlan &#039;1&#039;</p><p>config switch_vlan<br />&nbsp; &nbsp; option device &#039;switch0&#039;<br />&nbsp; &nbsp; option vlan &#039;1&#039;<br />&nbsp; &nbsp; option ports &#039;0 1 2 3 4&#039;</p><p>config switch_vlan<br />&nbsp; &nbsp; option device &#039;switch0&#039;<br />&nbsp; &nbsp; option vlan &#039;2&#039;<br />&nbsp; &nbsp; option ports &#039;5 6&#039;</p><p>Can you please help me with the set up? It is really hard for me to understand these settings.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>