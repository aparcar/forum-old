<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> mwan3; multi-wan policy routing (general topic)</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 22 May 2013 and 6 May 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 22 of 65</div><nav><ul><li><a href="viewtopic.php%3Fid=39052&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=20.html">20</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=21.html">21</a></li><li class="pagination-current"><span>22</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=23.html">23</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=24.html">24</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=65.html">65</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p216039">
				<div class="post-metadata">
					<div class="post-num">Post #526</div>
					<div class="post-author">thdyck</div>
					<div class="post-datetime">
						29 Oct 2013, 15:52					</div>
				</div>
				<div class="post-content content">
					<p>Hi all, </p><p>I added a wiki config section on controlling the external interface and IP used when sending out traffic. In my case, I have two WAN interfaces with dynamic IPs used to load-balance outgoing traffic for all normal clients, and a third WAN interface with a static IP block used for outgoing traffic from servers. I needed to map particular servers to particular static IP addresses on the wan3 interface.</p><p><a href="http://wiki.openwrt.org/doc/howto/mwan3#controlling.the.mapping.between.internal.ip.sources.and.external.ips.and.interfaces">http://wiki.openwrt.org/doc/howto/mwan3 … interfaces</a></p><p>Thanks for mwan3!</p><p>Regards,<br />Tim Miller Dyck</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216130">
				<div class="post-metadata">
					<div class="post-num">Post #527</div>
					<div class="post-author">jigglywiggly</div>
					<div class="post-datetime">
						30 Oct 2013, 03:30					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Adze wrote:</cite><blockquote><div class="quotebox"><cite>jigglywiggly wrote:</cite><blockquote><p>sure and thanks for helping</p><p>one sidenote is that WAN2 is getting prioritized randomly until I reboot. I&#039;m not sure why because the gateway metric for it is 2</p></blockquote></div><br /><p>Your output is bit hard to read, but i think i know what&#039;s wrong. As your eth0.1 uses dhcp protocol, i think that in time your lease expires and the ip adres is removed from the interface.</p><p>The reason why this expires is probably that dhcp renew request are send out the wrong WAN interface. You should set a rule for the dhcp server out the correct wan interface.</p></blockquote></div><p>I&#039;m a bit confused</p><p>eth0.1 is the LAN interface <br />eth0.2 is WAN2<br />eth1 is WAN</p><p>Where would I find the settings to configure the dhcp per interface?</p>											<p class="post-edited">(Last edited by <strong>jigglywiggly</strong> on 30 Oct 2013, 11:24)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216137">
				<div class="post-metadata">
					<div class="post-num">Post #528</div>
					<div class="post-author">jigglywiggly</div>
					<div class="post-datetime">
						30 Oct 2013, 05:46					</div>
				</div>
				<div class="post-content content">
					<p>Never mind got it. Uninstalled mwan 1.19.</p><p>Deleted the config file at /etc/config/mwan3</p><br /><p>Installed 1.3 and the gui and I went to the interfaces tab, and had to setup the interfaces properly.<br />It&#039;s case sensitive for some reason. wan must be called wan, it cannot be called WAN, and WAN2 cannot be called wan2 in my case.</p><p><a href="https://dl.dropboxusercontent.com/u/46294175/temp/openwrt/interfaces-mwan.PNG">https://dl.dropboxusercontent.com/u/462 … s-mwan.PNG</a></p><p>had to change the rules in member configuration too</p><p><a href="https://dl.dropboxusercontent.com/u/46294175/temp/openwrt/member%20configuration.PNG">https://dl.dropboxusercontent.com/u/462 … ration.PNG</a></p><p>to match up with the interfaces</p><p>and then finally my twitch rules</p><p><a href="https://dl.dropboxusercontent.com/u/46294175/temp/openwrt/rules2.PNG">https://dl.dropboxusercontent.com/u/462 … rules2.PNG</a></p><p>works great now, thanks for your hard work</p><p>mwan3 config</p><div class="codebox"><pre><code>config member &#039;wan1_m1_w3&#039;
    option metric &#039;1&#039;
    option weight &#039;3&#039;
    option interface &#039;wan&#039;

config member &#039;wan1_m2_w3&#039;
    option metric &#039;2&#039;
    option weight &#039;3&#039;
    option interface &#039;wan&#039;

config member &#039;wan2_m1_w2&#039;
    option metric &#039;1&#039;
    option weight &#039;2&#039;
    option interface &#039;WAN2&#039;

config member &#039;wan2_m2_w2&#039;
    option metric &#039;2&#039;
    option weight &#039;2&#039;
    option interface &#039;WAN2&#039;

config policy &#039;wan1_only&#039;
    list use_member &#039;wan1_m1_w3&#039;

config policy &#039;wan2_only&#039;
    list use_member &#039;wan2_m1_w2&#039;

config policy &#039;wan1_wan2_loadbalanced&#039;
    list use_member &#039;wan1_m1_w3&#039;
    list use_member &#039;wan2_m1_w2&#039;

config policy &#039;wan1_pri_wan2_sec&#039;
    list use_member &#039;wan1_m1_w3&#039;
    list use_member &#039;wan2_m2_w2&#039;

config policy &#039;wan2_pri_wan1_sec&#039;
    list use_member &#039;wan1_m2_w3&#039;
    list use_member &#039;wan2_m1_w2&#039;

config interface &#039;wan&#039;
    option enabled &#039;1&#039;
    list track_ip &#039;8.8.8.8&#039;
    list track_ip &#039;8.8.4.4&#039;
    list track_ip &#039;4.2.2.1&#039;
    option reliability &#039;1&#039;
    option count &#039;1&#039;
    option timeout &#039;2&#039;
    option interval &#039;5&#039;
    option down &#039;3&#039;
    option up &#039;5&#039;
    option reroute &#039;1&#039;

config interface &#039;WAN2&#039;
    option enabled &#039;1&#039;
    list track_ip &#039;4.2.2.2&#039;
    list track_ip &#039;8.8.8.8&#039;
    option reliability &#039;1&#039;
    option count &#039;1&#039;
    option timeout &#039;2&#039;
    option interval &#039;5&#039;
    option down &#039;3&#039;
    option up &#039;5&#039;
    option reroute &#039;1&#039;

config rule &#039;twitch&#039;
    option dest_ip &#039;0.0.0.0/0&#039;
    option dest_port &#039;1935&#039;
    option proto &#039;tcp&#039;
    option use_policy &#039;wan2_only&#039;
    option equalize &#039;1&#039;

config rule &#039;twitch2&#039;
    option dest_ip &#039;0.0.0.0/0&#039;
    option dest_port &#039;1935&#039;
    option proto &#039;udp&#039;
    option use_policy &#039;wan2_only&#039;
    option equalize &#039;1&#039;

config rule &#039;loadover&#039;
    option dest_ip &#039;0.0.0.0/0&#039;
    option proto &#039;all&#039;
    option use_policy &#039;wan1_pri_wan2_sec&#039;
    option equalize &#039;1&#039;</code></pre></div>											<p class="post-edited">(Last edited by <strong>jigglywiggly</strong> on 30 Oct 2013, 17:26)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216295">
				<div class="post-metadata">
					<div class="post-num">Post #529</div>
					<div class="post-author">yanggis</div>
					<div class="post-datetime">
						31 Oct 2013, 08:50					</div>
				</div>
				<div class="post-content content">
					<p>Hi Adze, can you help me out?<br />After installing mwan3, my ip rule is very strange:</p><p>Output of &quot;ip rule show&quot; : </p><p>0:&nbsp; &nbsp; from all lookup local <br />1001:&nbsp; &nbsp; from all fwmark 0x100/0xff00 lookup 1001 <br />1002:&nbsp; &nbsp; from all fwmark 0x200/0xff00 lookup 1002 <br />1016:&nbsp; &nbsp; from all fwmark 0x1000/0xff00 lookup 1016 <br />1017:&nbsp; &nbsp; from all fwmark 0x1100/0xff00 lookup 1017 <br />1018:&nbsp; &nbsp; from all fwmark 0x1200/0xff00 lookup 1018 <br />1019:&nbsp; &nbsp; from all fwmark 0x1300/0xff00 lookup 1019 <br />1020:&nbsp; &nbsp; from all fwmark 0x1400/0xff00 lookup 1020 <br />32766:&nbsp; &nbsp; from all lookup main <br />32767:&nbsp; &nbsp; from all lookup default <br />80000:&nbsp; &nbsp; from 192.168.1.1 nop<br />80000:&nbsp; &nbsp; from 127.0.0.1 nop<br />80000:&nbsp; &nbsp; from 192.168.16.108 nop<br />80000:&nbsp; &nbsp; from 172.24.210.132 nop<br />90000:&nbsp; &nbsp; from 192.168.1.1/24 nop<br />90000:&nbsp; &nbsp; from 127.0.0.1/8 nop<br />90000:&nbsp; &nbsp; from 192.168.16.108/24 nop<br />90000:&nbsp; &nbsp; from 172.24.210.132/23 nop<br />-------------------------------------------------------------------------------------------<br />I have two wans, one is 192.168.16.1; another is 172.24.210.1.<br />I dont know why mwan3 cannot use the two gateways as default gateway.</p><br /><p>more information you may need as flow. Is there anything I missed?<br />---------------------------------------------------------------------------------------------<br />Software versions : </p><p>OpenWrt - OpenWrt Barrier Breaker r38578 (r38578)<br />mwan3 - 1.3-0<br />luci-app-mwan3 - 1.1-13</p><p>Firewall default output policy (must be ACCEPT) : </p><p>ACCEPT</p><p>Output of &quot;ip route show&quot; : </p><p>default via 172.24.210.1 dev eth1&nbsp; proto static&nbsp; metric 10 <br />172.24.210.0/23 dev eth1&nbsp; proto static&nbsp; scope link&nbsp; metric 10 <br />192.168.1.0/24 dev br-lan&nbsp; proto kernel&nbsp; scope link&nbsp; src 192.168.1.1 <br />192.168.16.0/24 dev wlan0&nbsp; proto static&nbsp; scope link&nbsp; metric 20</p><p>Output of &quot;ip rule show&quot; : </p><p>0:&nbsp; &nbsp; from all lookup local <br />1001:&nbsp; &nbsp; from all fwmark 0x100/0xff00 lookup 1001 <br />1002:&nbsp; &nbsp; from all fwmark 0x200/0xff00 lookup 1002 <br />1016:&nbsp; &nbsp; from all fwmark 0x1000/0xff00 lookup 1016 <br />1017:&nbsp; &nbsp; from all fwmark 0x1100/0xff00 lookup 1017 <br />1018:&nbsp; &nbsp; from all fwmark 0x1200/0xff00 lookup 1018 <br />1019:&nbsp; &nbsp; from all fwmark 0x1300/0xff00 lookup 1019 <br />1020:&nbsp; &nbsp; from all fwmark 0x1400/0xff00 lookup 1020 <br />32766:&nbsp; &nbsp; from all lookup main <br />32767:&nbsp; &nbsp; from all lookup default <br />80000:&nbsp; &nbsp; from 192.168.1.1 nop<br />80000:&nbsp; &nbsp; from 127.0.0.1 nop<br />80000:&nbsp; &nbsp; from 192.168.16.108 nop<br />80000:&nbsp; &nbsp; from 172.24.210.132 nop<br />90000:&nbsp; &nbsp; from 192.168.1.1/24 nop<br />90000:&nbsp; &nbsp; from 127.0.0.1/8 nop<br />90000:&nbsp; &nbsp; from 192.168.16.108/24 nop<br />90000:&nbsp; &nbsp; from 172.24.210.132/23 nop</p><p>Output of &quot;ip route list table 1001-1099&quot; (1001-1015 = interface tables, 1016-1099 = policy tables) : </p><p>1001<br />default via 172.24.210.1 dev eth1 <br />1002<br />default via 192.168.16.1 dev wlan0 <br />1016<br />default via 172.24.210.1 dev eth1&nbsp; metric 1 <br />1017<br />default via 192.168.16.1 dev wlan0&nbsp; metric 1 <br />1018<br />default&nbsp; metric 1 <br />&nbsp; &nbsp; nexthop via 172.24.210.1&nbsp; dev eth1 weight 3<br />&nbsp; &nbsp; nexthop via 192.168.16.1&nbsp; dev wlan0 weight 2<br />1019<br />default via 172.24.210.1 dev eth1&nbsp; metric 1 <br />default via 192.168.16.1 dev wlan0&nbsp; metric 2 <br />1020<br />default via 192.168.16.1 dev wlan0&nbsp; metric 1 <br />default via 172.24.210.1 dev eth1&nbsp; metric 2</p><p>Output of &quot;iptables -L -t mangle -v -n | awk &#039;/mwan3/&#039; RS=&quot; : </p><p>Chain PREROUTING (policy ACCEPT 15264 packets, 7085K bytes)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />1779K 1110M mwan3_pre&nbsp; all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />15264 7085K fwmark&nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p><p>Chain INPUT (policy ACCEPT 1392 packets, 163K bytes)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br /> 141K&nbsp; &nbsp;19M mwan3_post&nbsp; all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p><p>Chain OUTPUT (policy ACCEPT 488 packets, 151K bytes)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />37573 4926K mwan3_pre&nbsp; all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p><p>Chain POSTROUTING (policy ACCEPT 14253 packets, 7046K bytes)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />1660K 1093M mwan3_post&nbsp; all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p><p>Chain mwan3_default (1 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br /> 1454&nbsp; 269K MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 224.0.0.0/3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mark match 0x0/0xff00 MARK xset 0x7f00/0xff00<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 127.0.0.0/8&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mark match 0x0/0xff00 MARK xset 0x7f00/0xff00<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 127.0.0.1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mark match 0x0/0xff00 MARK xset 0x7f00/0xff00<br />&nbsp; 696 73552 MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 172.24.210.0/23&nbsp; &nbsp; &nbsp; mark match 0x0/0xff00 MARK xset 0x7f00/0xff00<br />&nbsp; &nbsp;49&nbsp; 4154 MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 192.168.1.0/24&nbsp; &nbsp; &nbsp; &nbsp;mark match 0x0/0xff00 MARK xset 0x7f00/0xff00<br />&nbsp; &nbsp;13&nbsp; 1146 MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 192.168.16.0/24&nbsp; &nbsp; &nbsp; mark match 0x0/0xff00 MARK xset 0x7f00/0xff00</p><p>Chain mwan3_interfaces (1 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />55989 3963K mwan3_wan2&nbsp; all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br /> 1478 95430 mwan3_wan1&nbsp; all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</p><p>Chain mwan3_post (2 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br /> 5006 1099K MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; eth1&nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;!172.24.210.0/23&nbsp; &nbsp; &nbsp; mark match ! 0x7f00/0xff00 MARK xset 0x100/0xff00<br /> 269K&nbsp; &nbsp;45M MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; wlan0&nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;!192.168.16.0/24&nbsp; &nbsp; &nbsp; mark match ! 0x7f00/0xff00 MARK xset 0x200/0xff00<br />1058K&nbsp; 985M MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mark match 0x8000/0x8000 MARK and 0xffff7fff<br />1802K 1112M CONNMARK&nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CONNMARK save mask 0xff00</p><p>Chain mwan3_pre (2 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />1817K 1115M CONNMARK&nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CONNMARK restore mask 0xff00<br /> 4510 3265K MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; eth1&nbsp; &nbsp;*&nbsp; &nbsp; &nbsp; !172.24.210.0/23&nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mark match ! 0x7f00/0xff00 MARK xset 0x8100/0xff00<br /> 505K&nbsp; 495M MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; wlan0&nbsp; *&nbsp; &nbsp; &nbsp; !192.168.16.0/24&nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mark match ! 0x7f00/0xff00 MARK xset 0x8200/0xff00<br /> 160K&nbsp; &nbsp;21M mwan3_default&nbsp; all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mark match 0x0/0xff00<br />56739 4063K mwan3_interfaces&nbsp; all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mark match 0x0/0xff00<br />40399 2759K mwan3_rules&nbsp; all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mark match 0x0/0xff00<br />&nbsp; 519 81954 MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mark match 0x0/0xff00 MARK xset 0x7f00/0xff00</p><p>Chain mwan3_rules (1 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;192.168.21.0/24&nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; multiport sports 0:65535 multiport dports 563 mark match 0x0/0xff00 MARK xset 0x1100/0xff00<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;192.168.21.0/24&nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; multiport sports 0:65535 multiport dports 995 mark match 0x0/0xff00 MARK xset 0x1000/0xff00<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 88.154.0.0/16&nbsp; &nbsp; &nbsp; &nbsp; multiport sports 0:65535 multiport dports 1024:65535 mark match 0x0/0xff00 statistic mode random probability 0.39999999991 MARK xset 0x200/0xff00<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 88.154.0.0/16&nbsp; &nbsp; &nbsp; &nbsp; multiport sports 0:65535 multiport dports 1024:65535 mark match 0x0/0xff00 statistic mode random probability 0.99999999953 MARK xset 0x100/0xff00<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;tcp&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 77.11.41.0/24&nbsp; &nbsp; &nbsp; &nbsp; multiport sports 0:65535 multiport dports 1024:65535 mark match 0x0/0xff00 MARK xset 0x1300/0xff00<br />&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp;0 MARK&nbsp; &nbsp; &nbsp; &nbsp;udp&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 112.136.0.0/16&nbsp; &nbsp; &nbsp; &nbsp;multiport sports 0:65535 multiport dports 5352 mark match 0x0/0xff00 MARK xset 0x1400/0xff00<br /> 1047 61742 MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mark match 0x0/0xff00 MARK xset 0x1200/0xff00</p><p>Chain mwan3_wan1 (1 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; 317 24271 MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;172.24.210.132&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; MARK xset 0x100/0xff00</p><p>Chain mwan3_wan2 (1 references)<br /> pkts bytes target&nbsp; &nbsp; &nbsp;prot opt in&nbsp; &nbsp; &nbsp;out&nbsp; &nbsp; &nbsp;source&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br /> 5383&nbsp; 432K MARK&nbsp; &nbsp; &nbsp; &nbsp;all&nbsp; --&nbsp; *&nbsp; &nbsp; &nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;192.168.16.108&nbsp; &nbsp; &nbsp; &nbsp;0.0.0.0/0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; MARK xset 0x200/0xff00</p><p>Output of &quot;ifconfig&quot; : </p><p>br-lan&nbsp; &nbsp; Link encap:Ethernet&nbsp; HWaddr C6:3D:C7:8B:94:E7&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:192.168.1.1&nbsp; Bcast:192.168.1.255&nbsp; Mask:255.255.255.0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet6 addr: fe80::c43d:c7ff:fe8b:94e7/64 Scope:Link<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet6 addr: fda1:b0d1:92a3::1/60 Scope:Global<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:635711 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:1062892 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:109757465 (104.6 MiB)&nbsp; TX bytes:1003781703 (957.2 MiB)</p><p>eth0&nbsp; &nbsp; &nbsp; Link encap:Ethernet&nbsp; HWaddr C6:3D:C7:8B:94:E7&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet6 addr: fe80::c43d:c7ff:fe8b:94e7/64 Scope:Link<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:636325 errors:0 dropped:117 overruns:13 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:1062905 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:1000 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:121257077 (115.6 MiB)&nbsp; TX bytes:1008035460 (961.3 MiB)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Interrupt:4 </p><p>eth0.1&nbsp; &nbsp; Link encap:Ethernet&nbsp; HWaddr C6:3D:C7:8B:94:E7&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:635729 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:1062892 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:109758527 (104.6 MiB)&nbsp; TX bytes:1003781703 (957.2 MiB)</p><p>eth1&nbsp; &nbsp; &nbsp; Link encap:Ethernet&nbsp; HWaddr C4:3D:C7:8B:94:E8&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:172.24.210.132&nbsp; Bcast:172.24.211.255&nbsp; Mask:255.255.254.0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet6 addr: fe80::c63d:c7ff:fe8b:94e8/64 Scope:Link<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:756036 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:342951 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:1000 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:526600193 (502.2 MiB)&nbsp; TX bytes:65248388 (62.2 MiB)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Interrupt:5 </p><p>lo&nbsp; &nbsp; &nbsp; &nbsp; Link encap:Local Loopback&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:127.0.0.1&nbsp; Mask:255.0.0.0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet6 addr: ::1/128 Scope:Host<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP LOOPBACK RUNNING&nbsp; MTU:65536&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:21 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:21 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:0 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:2044 (1.9 KiB)&nbsp; TX bytes:2044 (1.9 KiB)</p><p>wlan0&nbsp; &nbsp; &nbsp;Link encap:Ethernet&nbsp; HWaddr C4:3D:C7:8B:94:E7&nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet addr:192.168.16.108&nbsp; Bcast:192.168.16.255&nbsp; Mask:255.255.255.0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inet6 addr: fe80::c63d:c7ff:fe8b:94e7/64 Scope:Link<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UP BROADCAST RUNNING MULTICAST&nbsp; MTU:1500&nbsp; Metric:1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX packets:515197 errors:0 dropped:0 overruns:0 frame:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TX packets:272354 errors:0 dropped:0 overruns:0 carrier:0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; collisions:0 txqueuelen:1000 <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RX bytes:505230319 (481.8 MiB)&nbsp; TX bytes:54832891 (52.2 MiB)</p><p>Output of &quot;cat /etc/config/mwan3&quot; : </p><p># This is a mwan3 example config. For mwan3 to work you will need at least:<br />#<br /># - 2 interfaces<br /># - 2 members<br /># - 1 policy<br /># - 1 rule<br />#<br /># First define all your wan interfaces. Interface name must match with the<br /># name used in your network configuration:</p><p>config &#039;interface&#039; &#039;wan1&#039;<br />&nbsp; &nbsp; option &#039;enabled&#039; &#039;1&#039;<br />&nbsp; &nbsp; list &#039;track_ip&#039; &#039;8.8.4.4&#039;<br />&nbsp; &nbsp; list &#039;track_ip&#039; &#039;8.8.8.8&#039;<br />&nbsp; &nbsp; list &#039;track_ip&#039; &#039;208.67.222.222&#039;<br />&nbsp; &nbsp; list &#039;track_ip&#039; &#039;208.67.220.220&#039;<br />&nbsp; &nbsp; option &#039;reliability&#039; &#039;2&#039;<br />&nbsp; &nbsp; option &#039;count&#039; &#039;1&#039;<br />&nbsp; &nbsp; option &#039;timeout&#039; &#039;2&#039;<br />&nbsp; &nbsp; option &#039;interval&#039; &#039;5&#039;<br />&nbsp; &nbsp; option &#039;down&#039; &#039;3&#039;<br />&nbsp; &nbsp; option &#039;up&#039; &#039;8&#039;<br />&nbsp; &nbsp; option &#039;reroute&#039; &#039;0&#039;</p><p>config &#039;interface&#039; &#039;wan2&#039;<br />&nbsp; &nbsp; option &#039;enabled&#039; &#039;1&#039;<br />&nbsp; &nbsp; list &#039;track_ip&#039; &#039;8.8.8.8&#039;<br />&nbsp; &nbsp; list &#039;track_ip&#039; &#039;208.67.220.220&#039;<br />&nbsp; &nbsp; option &#039;reliability&#039; &#039;1&#039;<br />&nbsp; &nbsp; option &#039;count&#039; &#039;1&#039;<br />&nbsp; &nbsp; option &#039;timeout&#039; &#039;2&#039;<br />&nbsp; &nbsp; option &#039;interval&#039; &#039;5&#039;<br />&nbsp; &nbsp; option &#039;down&#039; &#039;3&#039;<br />&nbsp; &nbsp; option &#039;up&#039; &#039;8&#039;<br />&nbsp; &nbsp; option &#039;reroute&#039; &#039;0&#039;</p><p># Next define a member and configure metric and weight values for this member.<br /># Each interface can have multiple member definitions. Give each member a correct<br /># name (A-Z, a-z, 0-9, &quot;_&quot; and no spaces).</p><p>config &#039;member&#039; &#039;wan1_m1_w3&#039;<br />&nbsp; &nbsp; option &#039;interface&#039; &#039;wan1&#039;<br />&nbsp; &nbsp; option &#039;metric&#039; &#039;1&#039;<br />&nbsp; &nbsp; option &#039;weight&#039; &#039;3&#039;</p><p>config &#039;member&#039; &#039;wan1_m2_w3&#039;<br />&nbsp; &nbsp; option &#039;interface&#039; &#039;wan1&#039;<br />&nbsp; &nbsp; option &#039;metric&#039; &#039;2&#039;<br />&nbsp; &nbsp; option &#039;weight&#039; &#039;3&#039;</p><p>config &#039;member&#039; &#039;wan2_m1_w2&#039;<br />&nbsp; &nbsp; option &#039;interface&#039; &#039;wan2&#039;<br />&nbsp; &nbsp; option &#039;metric&#039; &#039;1&#039;<br />&nbsp; &nbsp; option &#039;weight&#039; &#039;2&#039;</p><p>config &#039;member&#039; &#039;wan2_m2_w2&#039;<br />&nbsp; &nbsp; option &#039;interface&#039; &#039;wan2&#039;<br />&nbsp; &nbsp; option &#039;metric&#039; &#039;2&#039;<br />&nbsp; &nbsp; option &#039;weight&#039; &#039;2&#039;</p><p># After that create a routing policy. A routing policy consist of one or more<br /># members. Give each policy a correct name (A-Z, a-z, 0-9, &quot;_&quot; and no spaces). You <br /># can create multiple policies, so that it is possible for different traffic to<br /># have different primary and/or backup interfaces.</p><p>config &#039;policy&#039; &#039;wan1_only&#039;<br />&nbsp; &nbsp; list &#039;use_member&#039; &#039;wan1_m1_w3&#039;</p><p>config &#039;policy&#039; &#039;wan2_only&#039;<br />&nbsp; &nbsp; list &#039;use_member&#039; &#039;wan2_m1_w2&#039;</p><p>config &#039;policy&#039; &#039;wan1_wan2_loadbalanced&#039;<br />&nbsp; &nbsp; list &#039;use_member&#039; &#039;wan1_m1_w3&#039;<br />&nbsp; &nbsp; list &#039;use_member&#039; &#039;wan2_m1_w2&#039;</p><p>config &#039;policy&#039; &#039;wan1_pri_wan2_sec&#039;<br />&nbsp; &nbsp; list &#039;use_member&#039; &#039;wan1_m1_w3&#039;<br />&nbsp; &nbsp; list &#039;use_member&#039; &#039;wan2_m2_w2&#039;</p><p>config &#039;policy&#039; &#039;wan2_pri_wan1_sec&#039;<br />&nbsp; &nbsp; list &#039;use_member&#039; &#039;wan1_m2_w3&#039;<br />&nbsp; &nbsp; list &#039;use_member&#039; &#039;wan2_m1_w2&#039;</p><p># And to finish the config define your traffic rules. Rules are matched in top to<br /># bottom order. If you define a rule and it matches, all following rules are ignored.<br />#<br /># If the option equalize is set, mwan3 will load-balance each new session to the same<br /># host. If not set, it will load-balance based on destination.</p><p>config &#039;rule&#039; &#039;rule1&#039;<br />&nbsp; &nbsp; option &#039;src_ip&#039; &#039;192.168.21.0/24&#039;<br />&nbsp; &nbsp; option &#039;proto&#039; &#039;tcp&#039;<br />&nbsp; &nbsp; option &#039;dest_port&#039; &#039;563&#039;<br />&nbsp; &nbsp; option &#039;use_policy&#039; &#039;wan2_only&#039;</p><p>config &#039;rule&#039; &#039;rule2&#039;<br />&nbsp; &nbsp; option &#039;src_ip&#039; &#039;192.168.21.0/24&#039;<br />&nbsp; &nbsp; option &#039;proto&#039; &#039;tcp&#039;<br />&nbsp; &nbsp; option &#039;dest_port&#039; &#039;995&#039;<br />&nbsp; &nbsp; option &#039;use_policy&#039; &#039;wan1_only&#039;</p><p>config &#039;rule&#039; &#039;rule3&#039;<br />&nbsp; &nbsp; option &#039;dest_ip&#039; &#039;88.154.0.0/16&#039;<br />&nbsp; &nbsp; option &#039;proto&#039; &#039;tcp&#039;<br />&nbsp; &nbsp; option &#039;dest_port&#039; &#039;1024:65535&#039;<br />&nbsp; &nbsp; option &#039;equalize&#039; &#039;1&#039;<br />&nbsp; &nbsp; option &#039;use_policy&#039; &#039;wan1_wan2_loadbalanced&#039;</p><p>config &#039;rule&#039; &#039;rule4&#039;<br />&nbsp; &nbsp; option &#039;dest_ip&#039; &#039;77.11.41.0/24&#039;<br />&nbsp; &nbsp; option &#039;proto&#039; &#039;tcp&#039;<br />&nbsp; &nbsp; option &#039;dest_port&#039; &#039;1024:65535&#039;<br />&nbsp; &nbsp; option &#039;use_policy&#039; &#039;wan1_pri_wan2_sec&#039;</p><p>config &#039;rule&#039; &#039;rule5&#039;<br />&nbsp; &nbsp; option &#039;dest_ip&#039; &#039;112.136.0.0/16&#039;<br />&nbsp; &nbsp; option &#039;proto&#039; &#039;udp&#039;<br />&nbsp; &nbsp; option &#039;dest_port&#039; &#039;5352&#039;<br />&nbsp; &nbsp; option &#039;use_policy&#039; &#039;wan2_pri_wan1_sec&#039;</p><p>config &#039;rule&#039; &#039;rule6&#039;<br />&nbsp; &nbsp; option &#039;dest_ip&#039; &#039;0.0.0.0/0&#039;<br />&nbsp; &nbsp; option &#039;use_policy&#039; &#039;wan1_wan2_loadbalanced&#039;</p><p>Output of &quot;cat /etc/config/network&quot; : </p><p>config interface &#039;loopback&#039;<br />&nbsp; &nbsp; option ifname &#039;lo&#039;<br />&nbsp; &nbsp; option proto &#039;static&#039;<br />&nbsp; &nbsp; option ipaddr &#039;127.0.0.1&#039;<br />&nbsp; &nbsp; option netmask &#039;255.0.0.0&#039;</p><p>config interface &#039;lan&#039;<br />&nbsp; &nbsp; option ifname &#039;eth0.1&#039;<br />&nbsp; &nbsp; option type &#039;bridge&#039;<br />&nbsp; &nbsp; option proto &#039;static&#039;<br />&nbsp; &nbsp; option ipaddr &#039;192.168.1.1&#039;<br />&nbsp; &nbsp; option netmask &#039;255.255.255.0&#039;<br />&nbsp; &nbsp; option ip6assign &#039;60&#039;</p><p>config interface &#039;wan1&#039;<br />&nbsp; &nbsp; option ifname &#039;eth1&#039;<br />&nbsp; &nbsp; option proto &#039;dhcp&#039;<br />&nbsp; &nbsp; option metric &#039;10&#039;</p><p>config globals &#039;globals&#039;<br />&nbsp; &nbsp; option ula_prefix &#039;fda1:b0d1:92a3::/48&#039;</p><p>config switch<br />&nbsp; &nbsp; option name &#039;rtl8366s&#039;<br />&nbsp; &nbsp; option reset &#039;1&#039;<br />&nbsp; &nbsp; option enable_vlan &#039;1&#039;<br />&nbsp; &nbsp; option blinkrate &#039;2&#039;</p><p>config switch_vlan<br />&nbsp; &nbsp; option device &#039;rtl8366s&#039;<br />&nbsp; &nbsp; option vlan &#039;1&#039;<br />&nbsp; &nbsp; option ports &#039;0 1 2 3 5t&#039;</p><p>config switch_port<br />&nbsp; &nbsp; option device &#039;rtl8366s&#039;<br />&nbsp; &nbsp; option port &#039;1&#039;<br />&nbsp; &nbsp; option led &#039;6&#039;</p><p>config switch_port<br />&nbsp; &nbsp; option device &#039;rtl8366s&#039;<br />&nbsp; &nbsp; option port &#039;2&#039;<br />&nbsp; &nbsp; option led &#039;9&#039;</p><p>config switch_port<br />&nbsp; &nbsp; option device &#039;rtl8366s&#039;<br />&nbsp; &nbsp; option port &#039;5&#039;<br />&nbsp; &nbsp; option led &#039;2&#039;</p><p>config interface &#039;wan2&#039;<br />&nbsp; &nbsp; option proto &#039;dhcp&#039;<br />&nbsp; &nbsp; option metric &#039;20&#039;</p>											<p class="post-edited">(Last edited by <strong>yanggis</strong> on 31 Oct 2013, 08:52)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216324">
				<div class="post-metadata">
					<div class="post-num">Post #530</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						31 Oct 2013, 12:58					</div>
				</div>
				<div class="post-content content">
					<p>yanggis,</p><br /><p>You have no wan2 interface configured...</p><p>I mean in your network config have you defined a wan2 interface section, but it has no ifname option. Please correct your network config first before even trying to start with mwan3. It is not a mwan3 error, but a general network setup error.</p><p>Good luck!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216337">
				<div class="post-metadata">
					<div class="post-num">Post #531</div>
					<div class="post-author">yanggis</div>
					<div class="post-datetime">
						31 Oct 2013, 15:18					</div>
				</div>
				<div class="post-content content">
					<p>Hi Adze, many thanks for your fast response. I&#039;ve corrected network config already.</p><p>Initially, it works well. and the output of &quot;ip rule show&quot; :<br />0:&nbsp; &nbsp; from all lookup local <br />1001:&nbsp; &nbsp; from all fwmark 0x100/0xff00 lookup 1001 <br />1002:&nbsp; &nbsp; from all fwmark 0x200/0xff00 lookup 1002 <br />1016:&nbsp; &nbsp; from all fwmark 0x1000/0xff00 lookup 1016 <br />1017:&nbsp; &nbsp; from all fwmark 0x1100/0xff00 lookup 1017 <br />1018:&nbsp; &nbsp; from all fwmark 0x1200/0xff00 lookup 1018 <br />1019:&nbsp; &nbsp; from all fwmark 0x1300/0xff00 lookup 1019 <br />1020:&nbsp; &nbsp; from all fwmark 0x1400/0xff00 lookup 1020 <br />32766:&nbsp; &nbsp; from all lookup main <br />32767:&nbsp; &nbsp; from all lookup default <br />80000:&nbsp; &nbsp; from 192.168.1.1 nop<br />80000:&nbsp; &nbsp; from 127.0.0.1 nop<br />80000:&nbsp; &nbsp; from 192.168.16.108 nop<br />80000:&nbsp; &nbsp; from 172.24.210.132 nop<br />90000:&nbsp; &nbsp; from 192.168.1.1/24 nop<br />90000:&nbsp; &nbsp; from 127.0.0.1/8 nop<br />90000:&nbsp; &nbsp; from 192.168.16.108/24 nop<br />90000:&nbsp; &nbsp; from 172.24.210.132/23 nop<br />---------------------------------------------------------------------------<br />However, after about 20 mins, the first ip row is missing.&nbsp; First default route is also missing. the output of &quot;ip rule show&quot; is as follow:<br />--------------------------------------------------------------------------<br />Output of &quot;ip rule show&quot; : </p><p>0:&nbsp; &nbsp; from all lookup local <br />1002:&nbsp; &nbsp; from all fwmark 0x200/0xff00 lookup 1002 <br />1017:&nbsp; &nbsp; from all fwmark 0x1100/0xff00 lookup 1017 <br />1018:&nbsp; &nbsp; from all fwmark 0x1200/0xff00 lookup 1018 <br />1019:&nbsp; &nbsp; from all fwmark 0x1300/0xff00 lookup 1019 <br />1020:&nbsp; &nbsp; from all fwmark 0x1400/0xff00 lookup 1020 <br />32766:&nbsp; &nbsp; from all lookup main <br />32767:&nbsp; &nbsp; from all lookup default <br />80000:&nbsp; &nbsp; from 192.168.1.1 nop<br />80000:&nbsp; &nbsp; from 127.0.0.1 nop<br />80000:&nbsp; &nbsp; from 192.168.16.108 nop<br />80000:&nbsp; &nbsp; from 172.24.211.190 nop<br />90000:&nbsp; &nbsp; from 192.168.1.1/24 nop<br />90000:&nbsp; &nbsp; from 127.0.0.1/8 nop<br />90000:&nbsp; &nbsp; from 192.168.16.108/24 nop<br />90000:&nbsp; &nbsp; from 172.24.211.190/23 nop</p><p>Output of &quot;ip route list table 1001-1099&quot; (1001-1015 = interface tables, 1016-1099 = policy tables) : </p><p>1002<br />default via 192.168.16.1 dev wlan0 <br />1017<br />default via 192.168.16.1 dev wlan0&nbsp; metric 1 <br />1018<br />default via 192.168.16.1 dev wlan0&nbsp; metric 1 <br />1019<br />default via 192.168.16.1 dev wlan0&nbsp; metric 2 <br />1020<br />default via 192.168.16.1 dev wlan0&nbsp; metric 1</p><br /><p>----------------------------------------------------------------------------------<br />Is there anyhing wrong? more config info. as follow:<br />--------------------------------------------------------------------------------</p><p>/etc/config/mwan3</p><p>config interface &#039;wan1&#039;<br />&nbsp; &nbsp; option enabled &#039;1&#039;<br />&nbsp; &nbsp; option reliability &#039;2&#039;<br />&nbsp; &nbsp; option count &#039;1&#039;<br />&nbsp; &nbsp; option timeout &#039;2&#039;<br />&nbsp; &nbsp; option interval &#039;5&#039;<br />&nbsp; &nbsp; option down &#039;3&#039;<br />&nbsp; &nbsp; option up &#039;8&#039;<br />&nbsp; &nbsp; option reroute &#039;1&#039;<br />&nbsp; &nbsp; list track_ip &#039;8.8.8.8&#039;</p><p>config interface &#039;wan2&#039;<br />&nbsp; &nbsp; option enabled &#039;1&#039;<br />&nbsp; &nbsp; option reliability &#039;1&#039;<br />&nbsp; &nbsp; option count &#039;1&#039;<br />&nbsp; &nbsp; option timeout &#039;2&#039;<br />&nbsp; &nbsp; option interval &#039;5&#039;<br />&nbsp; &nbsp; option down &#039;3&#039;<br />&nbsp; &nbsp; option up &#039;8&#039;<br />&nbsp; &nbsp; option reroute &#039;1&#039;<br />&nbsp; &nbsp; list track_ip &#039;8.8.4.4&#039;</p><p>config member &#039;wan1_m1_w3&#039;<br />&nbsp; &nbsp; option interface &#039;wan1&#039;<br />&nbsp; &nbsp; option metric &#039;1&#039;<br />&nbsp; &nbsp; option weight &#039;3&#039;</p><p>config member &#039;wan1_m2_w3&#039;<br />&nbsp; &nbsp; option interface &#039;wan1&#039;<br />&nbsp; &nbsp; option metric &#039;2&#039;<br />&nbsp; &nbsp; option weight &#039;3&#039;</p><p>config member &#039;wan2_m1_w2&#039;<br />&nbsp; &nbsp; option interface &#039;wan2&#039;<br />&nbsp; &nbsp; option metric &#039;1&#039;<br />&nbsp; &nbsp; option weight &#039;2&#039;</p><p>config member &#039;wan2_m2_w2&#039;<br />&nbsp; &nbsp; option interface &#039;wan2&#039;<br />&nbsp; &nbsp; option metric &#039;2&#039;<br />&nbsp; &nbsp; option weight &#039;2&#039;</p><p>config policy &#039;wan1_only&#039;<br />&nbsp; &nbsp; list use_member &#039;wan1_m1_w3&#039;</p><p>config policy &#039;wan2_only&#039;<br />&nbsp; &nbsp; list use_member &#039;wan2_m1_w2&#039;</p><p>config policy &#039;wan1_wan2_loadbalanced&#039;<br />&nbsp; &nbsp; list use_member &#039;wan1_m1_w3&#039;<br />&nbsp; &nbsp; list use_member &#039;wan2_m1_w2&#039;</p><p>config policy &#039;wan1_pri_wan2_sec&#039;<br />&nbsp; &nbsp; list use_member &#039;wan1_m1_w3&#039;<br />&nbsp; &nbsp; list use_member &#039;wan2_m2_w2&#039;</p><p>config policy &#039;wan2_pri_wan1_sec&#039;<br />&nbsp; &nbsp; list use_member &#039;wan1_m2_w3&#039;<br />&nbsp; &nbsp; list use_member &#039;wan2_m1_w2&#039;</p><p>config rule &#039;rule6&#039;<br />&nbsp; &nbsp; option dest_ip &#039;0.0.0.0/0&#039;<br />&nbsp; &nbsp; option use_policy &#039;wan1_wan2_loadbalanced&#039;</p><br /><br /><p> /etc/config/network<br />config interface &#039;loopback&#039;<br />&nbsp; &nbsp; option ifname &#039;lo&#039;<br />&nbsp; &nbsp; option proto &#039;static&#039;<br />&nbsp; &nbsp; option ipaddr &#039;127.0.0.1&#039;<br />&nbsp; &nbsp; option netmask &#039;255.0.0.0&#039;</p><br /><br /><p>config interface &#039;lan&#039;<br />&nbsp; &nbsp; option ifname &#039;eth0.1&#039;<br />&nbsp; &nbsp; option type &#039;bridge&#039;<br />&nbsp; &nbsp; option proto &#039;static&#039;<br />&nbsp; &nbsp; option ipaddr &#039;192.168.1.1&#039;<br />&nbsp; &nbsp; option netmask &#039;255.255.255.0&#039;<br />&nbsp; &nbsp; option ip6assign &#039;60&#039;</p><p>config interface &#039;wan1&#039;<br />&nbsp; &nbsp; option ifname &#039;eth1&#039;<br />&nbsp; &nbsp; option proto &#039;dhcp&#039;<br />&nbsp; &nbsp; option metric &#039;10&#039;<br />&nbsp; &nbsp; </p><p>config globals &#039;globals&#039;<br />&nbsp; &nbsp; option ula_prefix &#039;fda1:b0d1:92a3::/48&#039;</p><p>config switch<br />&nbsp; &nbsp; option name &#039;rtl8366s&#039;<br />&nbsp; &nbsp; option reset &#039;1&#039;<br />&nbsp; &nbsp; option enable_vlan &#039;1&#039;<br />&nbsp; &nbsp; option blinkrate &#039;2&#039;</p><p>config switch_vlan<br />&nbsp; &nbsp; option device &#039;rtl8366s&#039;<br />&nbsp; &nbsp; option vlan &#039;1&#039;<br />&nbsp; &nbsp; option ports &#039;0 1 2 3 5t&#039;</p><p>config switch_port<br />&nbsp; &nbsp; option device &#039;rtl8366s&#039;<br />&nbsp; &nbsp; option port &#039;1&#039;<br />&nbsp; &nbsp; option led &#039;6&#039;</p><p>config switch_port<br />&nbsp; &nbsp; option device &#039;rtl8366s&#039;<br />&nbsp; &nbsp; option port &#039;2&#039;<br />&nbsp; &nbsp; option led &#039;9&#039;</p><p>config switch_port<br />&nbsp; &nbsp; option device &#039;rtl8366s&#039;<br />&nbsp; &nbsp; option port &#039;5&#039;<br />&nbsp; &nbsp; option led &#039;2&#039;</p><p>config interface &#039;wan2&#039;<br />&nbsp; &nbsp; option proto &#039;dhcp&#039;<br />&nbsp; &nbsp; option metric &#039;20&#039;<br />&nbsp; &nbsp; option ifname &#039;wlan0&#039;</p><br /><br /><br /><p>Thanks for you kindness!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216338">
				<div class="post-metadata">
					<div class="post-num">Post #532</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						31 Oct 2013, 15:23					</div>
				</div>
				<div class="post-content content">
					<p>Hi yanggis,</p><br /><p>I still believe your network config is not 100% correct. Could you please paste me the main routing table entries? Do you see two default routes? Can you ping google.com from every wan interface as descriped in the wiki?</p><br /><p>Thnx!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216345">
				<div class="post-metadata">
					<div class="post-num">Post #533</div>
					<div class="post-author">yanggis</div>
					<div class="post-datetime">
						31 Oct 2013, 16:19					</div>
				</div>
				<div class="post-content content">
					<p>Hi Adze. You are right. <br />When I try to ping google.com from both wan interface. Every wan interface work well.</p><p>/etc/config$&nbsp; ping -c 1 -I eth1 <a href="http://www.google.com">www.google.com</a><br />PING <a href="http://www.google.com">www.google.com</a> (202.51.247.181): 56 data bytes<br />64 bytes from 202.51.247.181: seq=0 ttl=55 time=1.521 ms</p><p>--- <a href="http://www.google.com">www.google.com</a> ping statistics ---<br />1 packets transmitted, 1 packets received, 0% packet loss<br />round-trip min/avg/max = 1.521/1.521/1.521 ms<br />/etc/config$&nbsp; ping -c 1 -I eth1 <a href="http://www.google.com">www.google.com</a><br />PING <a href="http://www.google.com">www.google.com</a> (202.51.247.155): 56 data bytes<br />64 bytes from 202.51.247.155: seq=0 ttl=55 time=7.836 ms</p><p>--- <a href="http://www.google.com">www.google.com</a> ping statistics ---<br />1 packets transmitted, 1 packets received, 0% packet loss<br />round-trip min/avg/max = 7.836/7.836/7.836 ms<br />/etc/config$&nbsp; ping -c 1 -I wlan0 <a href="http://www.google.com">www.google.com</a><br />PING <a href="http://www.google.com">www.google.com</a> (202.51.247.181): 56 data bytes<br />64 bytes from 202.51.247.181: seq=0 ttl=54 time=8.134 ms</p><p>--- <a href="http://www.google.com">www.google.com</a> ping statistics ---<br />1 packets transmitted, 1 packets received, 0% packet loss<br />round-trip min/avg/max = 8.134/8.134/8.134 ms<br />/etc/config$&nbsp; ping -c 1 -I wlan0 <a href="http://www.google.com">www.google.com</a><br />PING <a href="http://www.google.com">www.google.com</a> (202.51.247.154): 56 data bytes<br />64 bytes from 202.51.247.154: seq=0 ttl=54 time=3.098 ms</p><p>--- <a href="http://www.google.com">www.google.com</a> ping statistics ---<br />1 packets transmitted, 1 packets received, 0% packet loss<br />round-trip min/avg/max = 3.098/3.098/3.098 ms</p><p>However, when I login my router, mwan3 display eth1 (wan1) is offline.</p><p>I am 100% sure wan1 interface works well. However, usually, mwan3 will shows that eth1(wan1) is offline after around 20 mins after resboot my router.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216348">
				<div class="post-metadata">
					<div class="post-num">Post #534</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						31 Oct 2013, 16:52					</div>
				</div>
				<div class="post-content content">
					<p>Hi yanggis,</p><br /><p>What does logging say after wan1 went offline? Have you tried it without the tracking option?</p><br /><p>Adze</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216429">
				<div class="post-metadata">
					<div class="post-num">Post #535</div>
					<div class="post-author">fharmusial</div>
					<div class="post-datetime">
						1 Nov 2013, 15:06					</div>
				</div>
				<div class="post-content content">
					<p>Hi Adze,</p><p>I&#039;m happily using mwan3 in failover setup for a while now.<br />However, when I try to increase wan2 ping interval from default 5 to 30 seconds,<br />my 3g connection gives up on me after a while:</p><p>Nov&nbsp; 1 13:55:24 mwan3track: Interface wan2 (3g-wan2) is offline<br />Nov&nbsp; 1 13:55:24 mwan3: ifdown interface wan2 (3g-wan2)<br />Nov&nbsp; 1 13:55:26 firewall: removing wan2 (3g-wan2) from zone wan</p><p>Could you help me understand what could be wrong?<br />I have posted my config files below.</p><p>Thanks,<br />Ferry</p><p>+++++</p><p># route -n</p><p>Kernel IP routing table<br />Destination&nbsp; &nbsp; &nbsp;Gateway&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Genmask&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Flags Metric Ref&nbsp; &nbsp; Use Iface<br />0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;192.168.1.1&nbsp; &nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;UG&nbsp; &nbsp; 10&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp; 0 eth0<br />0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;10.64.64.64&nbsp; &nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;UG&nbsp; &nbsp; 20&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp; 0 3g-wan2<br />10.64.64.64&nbsp; &nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.255.255.255 UH&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 3g-wan2<br />10.111.28.0&nbsp; &nbsp; &nbsp;192.168.169.1&nbsp; &nbsp;255.255.255.0&nbsp; &nbsp;UG&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 tun0<br />10.111.29.0&nbsp; &nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.255.255.0&nbsp; &nbsp;U&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 br-lan<br />10.111.31.0&nbsp; &nbsp; &nbsp;192.168.169.1&nbsp; &nbsp;255.255.255.0&nbsp; &nbsp;UG&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 tun0<br />192.168.1.0&nbsp; &nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.255.255.0&nbsp; &nbsp;U&nbsp; &nbsp; &nbsp;10&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp; 0 eth0<br />192.168.169.0&nbsp; &nbsp;0.0.0.0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;255.255.255.0&nbsp; &nbsp;U&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; 0 tun0</p><br /><p>+++++</p><p>/etc/config/network</p><p>config interface &#039;loopback&#039;<br />&nbsp; &nbsp; option ifname &#039;lo&#039;<br />&nbsp; &nbsp; option proto &#039;static&#039;<br />&nbsp; &nbsp; option ipaddr &#039;127.0.0.1&#039;<br />&nbsp; &nbsp; option netmask &#039;255.0.0.0&#039;</p><p>config interface &#039;lan&#039;<br />&nbsp; &nbsp; option ifname &#039;eth1&#039;<br />&nbsp; &nbsp; option type &#039;bridge&#039;<br />&nbsp; &nbsp; option proto &#039;static&#039;<br />&nbsp; &nbsp; option netmask &#039;255.255.255.0&#039;<br />&nbsp; &nbsp; option ipaddr &#039;10.111.29.254&#039;</p><p>config interface &#039;wan1&#039;<br />&nbsp; &nbsp; option ifname &#039;eth0&#039;<br />&nbsp; &nbsp; option proto &#039;dhcp&#039;<br />&nbsp; &nbsp; option defaultroute &#039;1&#039;<br />&nbsp; &nbsp; option metric &#039;10&#039;</p><p>config interface &#039;wan2&#039;<br />&nbsp; &nbsp; option device &#039;/dev/ttyUSB2&#039;<br />&nbsp; &nbsp; option service &#039;umts&#039;<br />&nbsp; &nbsp; option proto &#039;3g&#039;<br />&nbsp; &nbsp; option apn &#039;office.vodafone.nl&#039;<br />&nbsp; &nbsp; option pincode &#039;1234&#039;<br />&nbsp; &nbsp; option username &#039;vodafone&#039;<br />&nbsp; &nbsp; option password &#039;vodafone&#039;<br />&nbsp; &nbsp; option defaultroute &#039;1&#039;<br />&nbsp; &nbsp; option metric &#039;20&#039;<br />&nbsp; &nbsp; option peerdns &#039;1&#039;</p><p>config interface &#039;vpn&#039;<br />&nbsp; &nbsp; option proto &#039;none&#039;<br />&nbsp; &nbsp; option ifname &#039;tun0&#039;</p><p>+++++</p><p>/etc/config/mwan3:</p><p>config interface &#039;wan1&#039;<br />&nbsp; &nbsp; option enabled &#039;1&#039;<br />&nbsp; &nbsp; list track_ip &#039;8.8.4.4&#039;<br />&nbsp; &nbsp; list track_ip &#039;8.8.8.8&#039;<br />&nbsp; &nbsp; list track_ip &#039;208.67.222.222&#039;<br />&nbsp; &nbsp; list track_ip &#039;208.67.220.220&#039;<br />&nbsp; &nbsp; option reliability &#039;2&#039;<br />&nbsp; &nbsp; option count &#039;1&#039;<br />&nbsp; &nbsp; option timeout &#039;2&#039;<br />&nbsp; &nbsp; option interval &#039;5&#039;<br />&nbsp; &nbsp; option down &#039;3&#039;<br />&nbsp; &nbsp; option up &#039;8&#039;<br />&nbsp; &nbsp; option reroute &#039;1&#039;</p><p>config interface &#039;wan2&#039;<br />&nbsp; &nbsp; option enabled &#039;1&#039;<br />&nbsp; &nbsp; list track_ip &#039;8.8.8.8&#039;<br />&nbsp; &nbsp; list track_ip &#039;208.67.220.220&#039;<br />&nbsp; &nbsp; option reliability &#039;1&#039;<br />&nbsp; &nbsp; option count &#039;1&#039;<br />&nbsp; &nbsp; option timeout &#039;2&#039;<br />&nbsp; &nbsp; option down &#039;3&#039;<br />&nbsp; &nbsp; option up &#039;8&#039;<br />&nbsp; &nbsp; option reroute &#039;1&#039;<br />&nbsp; &nbsp; option interval &#039;30&#039;</p><p>config member &#039;wan1_m1_w3&#039;<br />&nbsp; &nbsp; option interface &#039;wan1&#039;<br />&nbsp; &nbsp; option metric &#039;1&#039;<br />&nbsp; &nbsp; option weight &#039;3&#039;</p><p>config member &#039;wan1_m2_w3&#039;<br />&nbsp; &nbsp; option interface &#039;wan1&#039;<br />&nbsp; &nbsp; option metric &#039;2&#039;<br />&nbsp; &nbsp; option weight &#039;3&#039;</p><p>config member &#039;wan2_m1_w2&#039;<br />&nbsp; &nbsp; option interface &#039;wan2&#039;<br />&nbsp; &nbsp; option metric &#039;1&#039;<br />&nbsp; &nbsp; option weight &#039;2&#039;</p><p>config member &#039;wan2_m2_w2&#039;<br />&nbsp; &nbsp; option interface &#039;wan2&#039;<br />&nbsp; &nbsp; option metric &#039;2&#039;<br />&nbsp; &nbsp; option weight &#039;2&#039;</p><p>config policy &#039;wan1_only&#039;<br />&nbsp; &nbsp; list use_member &#039;wan1_m1_w3&#039;</p><p>config policy &#039;wan2_only&#039;<br />&nbsp; &nbsp; list use_member &#039;wan2_m1_w2&#039;</p><p>config policy &#039;wan1_wan2_loadbalanced&#039;<br />&nbsp; &nbsp; list use_member &#039;wan1_m1_w3&#039;<br />&nbsp; &nbsp; list use_member &#039;wan2_m1_w2&#039;</p><p>config policy &#039;wan1_pri_wan2_sec&#039;<br />&nbsp; &nbsp; list use_member &#039;wan1_m1_w3&#039;<br />&nbsp; &nbsp; list use_member &#039;wan2_m2_w2&#039;</p><p>config policy &#039;wan2_pri_wan1_sec&#039;<br />&nbsp; &nbsp; list use_member &#039;wan1_m2_w3&#039;<br />&nbsp; &nbsp; list use_member &#039;wan2_m1_w2&#039;</p><p>config rule &#039;rule1&#039;<br />&nbsp; &nbsp; option dest_ip &#039;0.0.0.0/0&#039;<br />&nbsp; &nbsp; option use_policy &#039;wan1_pri_wan2_sec&#039;</p><p>+++++</p><p>/etc/config/firewall</p><p>root@client44:~# cat /etc/config/firewall</p><p>config defaults<br />&nbsp; &nbsp; option syn_flood &#039;1&#039;<br />&nbsp; &nbsp; option input &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option output &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option forward &#039;REJECT&#039;</p><p>config zone<br />&nbsp; &nbsp; option name &#039;lan&#039;<br />&nbsp; &nbsp; option input &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option output &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option forward &#039;REJECT&#039;<br />&nbsp; &nbsp; option network &#039;lan&#039;<br />&nbsp; &nbsp; option conntrack &#039;1&#039;</p><p>config zone<br />&nbsp; &nbsp; option name &#039;wan&#039;<br />&nbsp; &nbsp; option input &#039;REJECT&#039;<br />&nbsp; &nbsp; option output &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option forward &#039;REJECT&#039;<br />&nbsp; &nbsp; option masq &#039;1&#039;<br />&nbsp; &nbsp; option mtu_fix &#039;1&#039;<br />&nbsp; &nbsp; option network &#039;wan1 wan2&#039;<br />&nbsp; &nbsp; option conntrack &#039;1&#039;</p><p>config forwarding<br />&nbsp; &nbsp; option src &#039;lan&#039;<br />&nbsp; &nbsp; option dest &#039;wan&#039;</p><p>config rule<br />&nbsp; &nbsp; option name &#039;Allow-DHCP-Renew&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option proto &#039;udp&#039;<br />&nbsp; &nbsp; option dest_port &#039;68&#039;<br />&nbsp; &nbsp; option target &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option family &#039;ipv4&#039;</p><p>config rule<br />&nbsp; &nbsp; option name &#039;Allow-Ping&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option proto &#039;icmp&#039;<br />&nbsp; &nbsp; option icmp_type &#039;echo-request&#039;<br />&nbsp; &nbsp; option family &#039;ipv4&#039;<br />&nbsp; &nbsp; option target &#039;ACCEPT&#039;</p><p>config rule<br />&nbsp; &nbsp; option name &#039;Allow-DHCPv6&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option proto &#039;udp&#039;<br />&nbsp; &nbsp; option src_ip &#039;fe80::/10&#039;<br />&nbsp; &nbsp; option src_port &#039;547&#039;<br />&nbsp; &nbsp; option dest_ip &#039;fe80::/10&#039;<br />&nbsp; &nbsp; option dest_port &#039;546&#039;<br />&nbsp; &nbsp; option family &#039;ipv6&#039;<br />&nbsp; &nbsp; option target &#039;ACCEPT&#039;</p><p>config rule<br />&nbsp; &nbsp; option name &#039;Allow-ICMPv6-Input&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option proto &#039;icmp&#039;<br />&nbsp; &nbsp; list icmp_type &#039;echo-request&#039;<br />&nbsp; &nbsp; list icmp_type &#039;echo-reply&#039;<br />&nbsp; &nbsp; list icmp_type &#039;destination-unreachable&#039;<br />&nbsp; &nbsp; list icmp_type &#039;packet-too-big&#039;<br />&nbsp; &nbsp; list icmp_type &#039;time-exceeded&#039;<br />&nbsp; &nbsp; list icmp_type &#039;bad-header&#039;<br />&nbsp; &nbsp; list icmp_type &#039;unknown-header-type&#039;<br />&nbsp; &nbsp; list icmp_type &#039;router-solicitation&#039;<br />&nbsp; &nbsp; list icmp_type &#039;neighbour-solicitation&#039;<br />&nbsp; &nbsp; list icmp_type &#039;router-advertisement&#039;<br />&nbsp; &nbsp; list icmp_type &#039;neighbour-advertisement&#039;<br />&nbsp; &nbsp; option limit &#039;1000/sec&#039;<br />&nbsp; &nbsp; option family &#039;ipv6&#039;<br />&nbsp; &nbsp; option target &#039;ACCEPT&#039;</p><p>config rule<br />&nbsp; &nbsp; option name &#039;Allow-ICMPv6-Forward&#039;<br />&nbsp; &nbsp; option src &#039;wan&#039;<br />&nbsp; &nbsp; option dest &#039;*&#039;<br />&nbsp; &nbsp; option proto &#039;icmp&#039;<br />&nbsp; &nbsp; list icmp_type &#039;echo-request&#039;<br />&nbsp; &nbsp; list icmp_type &#039;echo-reply&#039;<br />&nbsp; &nbsp; list icmp_type &#039;destination-unreachable&#039;<br />&nbsp; &nbsp; list icmp_type &#039;packet-too-big&#039;<br />&nbsp; &nbsp; list icmp_type &#039;time-exceeded&#039;<br />&nbsp; &nbsp; list icmp_type &#039;bad-header&#039;<br />&nbsp; &nbsp; list icmp_type &#039;unknown-header-type&#039;<br />&nbsp; &nbsp; option limit &#039;1000/sec&#039;<br />&nbsp; &nbsp; option family &#039;ipv6&#039;<br />&nbsp; &nbsp; option target &#039;ACCEPT&#039;</p><p>config include<br />&nbsp; &nbsp; option path &#039;/etc/firewall.user&#039;</p><p>config zone<br />&nbsp; &nbsp; option name &#039;vpn&#039;<br />&nbsp; &nbsp; option input &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option forward &#039;REJECT&#039;<br />&nbsp; &nbsp; option output &#039;ACCEPT&#039;<br />&nbsp; &nbsp; option network &#039;vpn&#039;<br />&nbsp; &nbsp; option conntrack &#039;1&#039;</p><p>config forwarding<br />&nbsp; &nbsp; option dest &#039;lan&#039;<br />&nbsp; &nbsp; option src &#039;vpn&#039;</p><p>config forwarding<br />&nbsp; &nbsp; option dest &#039;vpn&#039;<br />&nbsp; &nbsp; option src &#039;lan&#039;</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216542">
				<div class="post-metadata">
					<div class="post-num">Post #536</div>
					<div class="post-author">thdyck</div>
					<div class="post-datetime">
						2 Nov 2013, 16:19					</div>
				</div>
				<div class="post-content content">
					<p>Hi Adze,</p><p>I see mwan3_1.3-0_all.ipk is posted. Is this release the recommended version now for production use, or is it still being tested? I saw in the git notes that you were working on a new way of handing outgoing traffic from the router itself.</p><p>Thanks,<br />Tim</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216603">
				<div class="post-metadata">
					<div class="post-num">Post #537</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						3 Nov 2013, 12:58					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>fharmusial wrote:</cite><blockquote><p>When I try to increase wan2 ping interval from default 5 to 30 seconds, my 3g connection gives up on me after a while.</p></blockquote></div><p>It looks like mwan3track is not getting ping replies three times in a row. Can you confirm that with a tcpdump please?</p><p>On a side note, as you use wan2 only as a backup interface, you can remove track_ip options entirely. When you remove the track_ip option, mwan3 assumes that that interface is always up. If wan1 fails, the router will try to send traffic over wan2, even if it is also down.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216604">
				<div class="post-metadata">
					<div class="post-num">Post #538</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						3 Nov 2013, 13:07					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>thdyck wrote:</cite><blockquote><p>I see mwan3_1.3-0_all.ipk is posted. Is this release the recommended version now for production use, or is it still being tested? I saw in the git notes that you were working on a new way of handing outgoing traffic from the router itself.</p></blockquote></div><p>All versions of mwan3 are test versions <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" />. I would not recommend it for business critical applications. But i do recommend the 1.3 version over any previous version.</p><p>If you were to use version 1.3, then it is advisable:</p><p>- not to use the reroute option anymore<br />- remove any static routes set to loopback interfaces (loopback trick on previous mwan3 versions)<br />- add an ip address to the loopback interface in your network config</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216608">
				<div class="post-metadata">
					<div class="post-num">Post #539</div>
					<div class="post-author">thdyck</div>
					<div class="post-datetime">
						3 Nov 2013, 16:36					</div>
				</div>
				<div class="post-content content">
					<p>Hi Adze, thanks. To spell out details:</p><p>1. </p><div class="quotebox"><cite>Adze wrote:</cite><blockquote><p>- not to use the reroute option anymore</p></blockquote></div><p>One should set option reroute &#039;0&#039; for all WAN interfaces</p><p>Will traffic originating from the router still fail-over if the primary WAN interface is down, with this set to 0?</p><p>2. </p><div class="quotebox"><cite>Adze wrote:</cite><blockquote><p>- add an ip address to the loopback interface in your network config</p></blockquote></div><p>This is the default for OpenWrt regarding the loopback interface:<br /></p><div class="codebox"><pre><code>config interface &#039;loopback&#039;
        option ifname &#039;lo&#039;
        option proto &#039;static&#039;
        option ipaddr &#039;127.0.0.1&#039;
        option netmask &#039;255.0.0.0&#039;</code></pre></div><p>Do you mean give the loopback interface an IP address other than 127.0.0.1 through an additional interface alias definition?</p><p>3. With ver. 1.3, should server programs on the router such as OpenVPN that need to listen on all WAN interfaces still be configured to listen on an inside interface (such as a LAN interface or loopback interface) and have port-forwards set up, as described in <a href="http://wiki.openwrt.org/doc/howto/mwan3?s">http://wiki.openwrt.org/doc/howto/mwan3?s</a>[]=mwan3#example.1have.openvpn.server.be.accessible.through.multiple.wan.interfaces ?</p><p>Thanks,<br />Tim</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216610">
				<div class="post-metadata">
					<div class="post-num">Post #540</div>
					<div class="post-author">Adze</div>
					<div class="post-datetime">
						3 Nov 2013, 16:53					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>thdyck wrote:</cite><blockquote><p>One should set option reroute &#039;0&#039; for all WAN interfaces</p></blockquote></div><p>That works, but you can leave it out, as 0 is the default value.</p><div class="quotebox"><cite>thdyck wrote:</cite><blockquote><p>Will traffic originating from the router still fail-over if the primary WAN interface is down, with this set to 0?</p></blockquote></div><p>Yes, if configured so and you added a loopback ip address.</p><div class="quotebox"><cite>thdyck wrote:</cite><blockquote><p>Do you mean give the loopback interface an IP address other than 127.0.0.1 through an additional interface alias definition?</p></blockquote></div><p>Interface alias is deprecated according to wiki. You can just add a new interface to your network config:</p><div class="codebox"><pre><code>config interface &#039;localhost&#039;
        option ifname &#039;lo&#039;
        option proto &#039;static&#039;
        option ipaddr &#039;192.168.88.99&#039;
        option netmask &#039;255.255.255.255&#039;</code></pre></div><br /><div class="quotebox"><cite>thdyck wrote:</cite><blockquote><p>3. With ver. 1.3, should server programs on the router such as OpenVPN that need to listen on all WAN interfaces still be configured to listen on an inside interface (such as a LAN interface or loopback interface) and have port-forwards set up.</p></blockquote></div><p>Yes, i would advise so, but is not always necessary.</p><p>Why OpenVPN needs this is because of udp, which is connectionless. When you have multiple interfaces, each with their own listener, a packet which originated from interface x, but sent out via interface y will get a reply back on interface y. As udp is connectionless and interface y also has a service listening, it will be handled by that listener. In some cases this can lead to unexpected results.</p><p>If you setup OpenVPN to use loopback interface, all packets will be sent and received on the same interface.</p>											<p class="post-edited">(Last edited by <strong>Adze</strong> on 3 Nov 2013, 16:54)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216611">
				<div class="post-metadata">
					<div class="post-num">Post #541</div>
					<div class="post-author">alphasparc</div>
					<div class="post-datetime">
						3 Nov 2013, 17:18					</div>
				</div>
				<div class="post-content content">
					<p>Any plans to add this package + luci app to OpenWRT officially?<br />I like to include it in my squashfs.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216644">
				<div class="post-metadata">
					<div class="post-num">Post #542</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						4 Nov 2013, 02:18					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m updating the luci app to remove the reroute option.</p><p>Eventually I&#039;ll get around to figuring out how to make things centered on the bootstrap skin. It looks a little funny sometimes unless you use the old openwrt.org theme on the GUI.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216645">
				<div class="post-metadata">
					<div class="post-num">Post #543</div>
					<div class="post-author">thdyck</div>
					<div class="post-datetime">
						4 Nov 2013, 02:39					</div>
				</div>
				<div class="post-content content">
					<p>Hi Adze, thanks for the reply.</p><p>So, with v1.3, to get source traffic from the router (e.g. a ping out from the router) to follow mwan3 failover rules, one should:</p><p>- leave reroute at 0, the default<br />- add a new interface bound to the &quot;lo&quot; interface but with a non-127.0.0.1 IP</p><div class="codebox"><pre><code>config interface &#039;localhost&#039;
        option ifname &#039;lo&#039;
        option proto &#039;static&#039;
        option ipaddr &#039;192.168.88.99&#039;
        option netmask &#039;255.255.255.255&#039;</code></pre></div><p>- DON&#039;T add a static route override directing outgoing router traffic to route first to this IP then out from there (the previous loopback interface trick)<br />- add a mwan3 rule for traffic from 192.168.88.99 (using the above example) to fail-over / load-balance as desired (is this needed?)</p><p>Does the OS automatically use the new 192.168.88.99 interface as its source IP when sending out traffic? I through it would normally use the wan interface with the lowest metric if no loopback static route workaround existed?</p><p>Thanks,<br />Tim</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216665">
				<div class="post-metadata">
					<div class="post-num">Post #544</div>
					<div class="post-author">jigglywiggly</div>
					<div class="post-datetime">
						4 Nov 2013, 09:12					</div>
				</div>
				<div class="post-content content">
					<p>Why should you not use the reroute option?</p><p>Maybe unrelated, but I noticed when I have two interfaces with the same gateway, one of them will stop working.</p><p>e.g If I have WAN2 up and running, and then plug WAN3 in, WAN2 goes offline.</p>											<p class="post-edited">(Last edited by <strong>jigglywiggly</strong> on 4 Nov 2013, 09:22)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216706">
				<div class="post-metadata">
					<div class="post-num">Post #545</div>
					<div class="post-author">thdyck</div>
					<div class="post-datetime">
						4 Nov 2013, 16:08					</div>
				</div>
				<div class="post-content content">
					<p>Hi arfett, thanks for your work on the LuCI app for mwan3!</p><p>A couple of UI suggestions for your consideration:<br />- Adze mentioned in another post that if the test IP infrastructure is not defined for an interface, mwan3 will always assume the interface is up. This would be handy to have an option in the LuCI UI to define this setting for an interface.<br />- For interfaces that are just for emergency use purposes and are metered by packet count (e.g. some cellular data connections), it would be helpful to be able to increase the ping interval to longer than 5 minutes. 10 and 15 minutes would be a nice add.</p><p>Thanks,<br />Tim</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216792">
				<div class="post-metadata">
					<div class="post-num">Post #546</div>
					<div class="post-author">rl608742063</div>
					<div class="post-datetime">
						5 Nov 2013, 16:58					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>I discovered bug in new version of mwan3 v mwan3_1.3-0</p><p>The openvpn Gargoyle v 1.1.5.11 and mwan3 v mwan3_1.3-0 loadbalancer<br />rule does not work properly. OpenVpn server on router has not allowed<br />connection for clients<br />When I moving back old version mwan3-1.2-20 - file /etc/hotplug.d/iface/15-mwan3<br />mwan3 loadbalancer and openvpn server working properly.</p><p>My system:<br />Gargoyle PL 1.5.11 (git 5980bc3)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|<br />OpenWrt Attitude Adjustment 12.09.1 (r38462)</p><p>below there is a log from logread:</p><br /><div class="codebox"><pre><code>Nov  4 21:19:11 router_glowny_64m_16flash daemon.err
openvpn(custom_config)[10008]: 213.158.217.85:24865 TLS Error: TLS key
negotiation failed to occur within 60 seconds (check your network
connectivity)
Nov  4 21:19:11 router_glowny_64m_16flash daemon.err
openvpn(custom_config)[10008]: 213.158.217.85:24865 TLS Error: TLS
handshake failed
Nov  4 21:19:11 router_glowny_64m_16flash daemon.notice
openvpn(custom_config)[10008]: 213.158.217.85:24865
SIGUSR1[soft,tls-error] received, client-instance restarting
Nov  4 21:19:12 router_glowny_64m_16flash daemon.err
openvpn(custom_config)[10008]: read UDPv4 [ECONNREFUSED]: Connection
refused (code=146)
Nov  4 21:19:15 router_glowny_64m_16flash daemon.notice
openvpn(custom_config)[10008]: MULTI: multi_create_instance called
Nov  4 21:19:15 router_glowny_64m_16flash daemon.notice
openvpn(custom_config)[10008]: xx.xx.xx.xx:61335 Re-using SSL/TLS
context
Nov  4 21:19:15 router_glowny_64m_16flash daemon.notice
openvpn(custom_config)[10008]: xx.xx.xx.xx:61335 LZO compression
initialized
Nov  4 21:19:15 router_glowny_64m_16flash daemon.notice
openvpn(custom_config)[10008]: xx.xx.xx.xx:61335 Control Channel MTU
parms [ L:1542 D:166 EF:66 EB:0 ET:0 EL:0 ]
Nov  4 21:19:15 router_glowny_64m_16flash daemon.notice
openvpn(custom_config)[10008]: xx.xx.xx.xx:61335 Data Channel MTU
parms [ L:1542 D:1450 EF:42 EB:135 ET:0 EL:0 AF:3/1 ]
Nov  4 21:19:15 router_glowny_64m_16flash daemon.notice
openvpn(custom_config)[10008]: xx.xx.xx.xx:61335 TLS: Initial packet
from xx.xx.xx.xx:61335, sid=d9fcc23f 31f30e8c
Nov  4 21:19:24 router_glowny_64m_16flash authpriv.info
dropbear[4156]: Child connection from 192.168.200.201:2364
Nov  4 21:19:32 router_glowny_64m_16flash authpriv.notice
dropbear[4156]: Password auth succeeded for &#039;root&#039; from
192.168.200.201:2364
Nov  4 21:19:42 router_glowny_64m_16flash daemon.err
openvpn(custom_config)[10008]: xx.xx.xx.xx:52608 TLS Error: TLS key
negotiation failed to occur within 60 seconds (check your network
connectivity)
Nov  4 21:19:42 router_glowny_64m_16flash daemon.err
openvpn(custom_config)[10008]: xx.xx.xx.xx:52608 TLS Error: TLS
handshake failed
Nov  4 21:19:42 router_glowny_64m_16flash daemon.notice
openvpn(custom_config)[10008]: xx.xx.xx.xx:52608
SIGUSR1[soft,tls-error] received, client-instance restarting
Nov  4 21:19:57 router_glowny_64m_16flash daemon.err
openvpn(custom_config)[10008]: xx.xx.xx.xx:58853 TLS Error: TLS key
negotiation failed to occur within 60 seconds (check your network
connectivity)
Nov  4 21:19:57 router_glowny_64m_16flash daemon.err
openvpn(custom_config)[10008]: xx.xx.xx.xx:58853 TLS Error: TLS
handshake failed
Nov  4 21:19:57 router_glowny_64m_16flash daemon.notice
openvpn(custom_config)[10008]: xx.xx.xx.xx:58853
SIGUSR1[soft,tls-error] received, client-instance restarting
Nov  4 21:20:09 router_glowny_64m_16flash daemon.warn
dnsmasq-dhcp[2574]: no address range available for DHCP request via
eth0.3
Nov  4 21:20:15 router_glowny_64m_16flash daemon.err
openvpn(custom_config)[10008]: xx.xx.xx.xx:61335 TLS Error: TLS key
negotiation failed to occur within 60 seconds (check your network
connectivity)
Nov  4 21:20:15 router_glowny_64m_16flash daemon.err
openvpn(custom_config)[10008]: xx.xx.xx.xx:61335 TLS Error: TLS
handshake failed
Nov  4 21:20:15 router_glowny_64m_16flash daemon.notice
openvpn(custom_config)[10008]: xx.xx.xx.xx:61335
SIGUSR1[soft,tls-error] received, client-instance restarting
Nov  4 21:20:17 router_glowny_64m_16flash daemon.notice
openvpn(custom_config)[10008]: MULTI: multi_create_instance called
Nov  4 21:20:17 router_glowny_64m_16flash daemon.notice
openvpn(custom_config)[10008]: xx.xx.xx.xx:52869 Re-using SSL/TLS
context
Nov  4 21:20:17 router_glowny_64m_16flash daemon.notice
openvpn(custom_config)[10008]: xx.xx.xx.xx:52869 LZO compression
initialized
Nov  4 21:20:17 router_glowny_64m_16flash daemon.notice
openvpn(custom_config)[10008]: xx.xx.xx.xx:52869 Control Channel MTU
parms [ L:1542 D:166 EF:66 EB:0 ET:0 EL:0 ]
Nov  4 21:20:17 router_glowny_64m_16flash daemon.notice
openvpn(custom_config)[10008]: xx.xx.xx.xx:52869 Data Channel MTU
parms [ L:1542 D:1450 EF:42 EB:135 ET:0 EL:0 AF:3/1 ]
Nov  4 21:20:17 router_glowny_64m_16flash daemon.notice
openvpn(custom_config)[10008]: xx.xx.xx.xx:52869 TLS: Initial packet
from xx.xx.xx.xx:52869, sid=c2ac3ecd 0082a654
Nov  4 21:21:06 router_glowny_64m_16flash daemon.notice
openvpn(custom_config)[10008]: MULTI: multi_create_instance called
Nov  4 21:21:06 router_glowny_64m_16flash daemon.notice
openvpn(custom_config)[10008]: xx.xx.xx.xx:56926 Re-using SSL/TLS
context
Nov  4 21:21:06 router_glowny_64m_16flash daemon.notice
openvpn(custom_config)[10008]: xx.xx.xx.xx:56926 LZO compression
initialized
Nov  4 21:21:06 router_glowny_64m_16flash daemon.notice
openvpn(custom_config)[10008]: xx.xx.xx.xx:56926 Control Channel MTU
parms [ L:1542 D:166 EF:66 EB:0 ET:0 EL:0 ]
Nov  4 21:21:06 router_glowny_64m_16flash daemon.notice
openvpn(custom_config)[10008]: xx.xx.xx.xx:56926 Data Channel MTU
parms [ L:1542 D:1450 EF:42 EB:135 ET:0 EL:0 AF:3/1 ]
Nov  4 21:21:06 router_glowny_64m_16flash daemon.notice
openvpn(custom_config)[10008]: xx.xx.xx.xx:56926 TLS: Initial packet
from xx.xx.xx.xx:56926, sid=9b1f9ae6 f2534bd0
Nov  4 21:21:17 router_glowny_64m_16flash daemon.err
openvpn(custom_config)[10008]: xx.xx.xx.xx:52869 TLS Error: TLS key
negotiation failed to occur within 60 seconds (check your network
connectivity)
Nov  4 21:21:17 router_glowny_64m_16flash daemon.err
openvpn(custom_config)[10008]: xx.xx.xx.xx:52869 TLS Error: TLS
handshake failed
Nov  4 21:21:17 router_glowny_64m_16flash daemon.notice
openvpn(custom_config)[10008]: xx.xx.xx.xx:52869
SIGUSR1[soft,tls-error] received, client-instance restarting
Nov  4 21:22:06 router_glowny_64m_16flash daemon.err
openvpn(custom_config)[10008]: xx.xx.xx.xx:56926 TLS Error: TLS key
negotiation failed to occur within 60 seconds (check your network
connectivity)
Nov  4 21:22:06 router_glowny_64m_16flash daemon.err
openvpn(custom_config)[10008]: xx.xx.xx.xx:56926 TLS Error: TLS
handshake failed
Nov  4 21:22:06 router_glowny_64m_16flash daemon.notice
openvpn(custom_config)[10008]: xx.xx.xx.xx:56926
SIGUSR1[soft,tls-error] received, client-instance restarting
Nov  4 21:22:07 router_glowny_64m_16flash daemon.notice
openvpn(custom_config)[10008]: MULTI: multi_create_instance called
Nov  4 21:22:07 router_glowny_64m_16flash daemon.notice
openvpn(custom_config)[10008]: xx.xx.xx.xx:54518 Re-using SSL/TLS
context
Nov  4 21:22:07 router_glowny_64m_16flash daemon.notice
openvpn(custom_config)[10008]: xx.xx.xx.xx:54518 LZO compression
initialized
Nov  4 21:22:07 router_glowny_64m_16flash daemon.notice
openvpn(custom_config)[10008]: xx.xx.xx.xx:54518 Control Channel MTU
parms [ L:1542 D:166 EF:66 EB:0 ET:0 EL:0 ]
Nov  4 21:22:07 router_glowny_64m_16flash daemon.notice
openvpn(custom_config)[10008]: xx.xx.xx.xx:54518 Data Channel MTU
parms [ L:1542 D:1450 EF:42 EB:135 ET:0 EL:0 AF:3/1 ]
Nov  4 21:22:07 router_glowny_64m_16flash daemon.notice
openvpn(custom_config)[10008]: xx.xx.xx.xx:54518 TLS: Initial packet
from xx.xx.xx.xx:54518, sid=3e7c47a4 ae32142c
root@router_glowny_64m_16flash:~#</code></pre></div><br /><br /><p>there are a logs for openvpn:</p><br /><br /><p>cat /etc/config/openvpn</p><p>config openvpn &#039;custom_config&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option config &#039;/etc/openvpn/server.conf&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option script_security &#039;3&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option up &#039;/etc/openvpn.up&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option down &#039;/etc/openvpn.down&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option enable &#039;1&#039;</p><br /><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;cat /etc/config/openvpn_gargoyle</p><p>config server &#039;server&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option internal_ip &#039;10.8.0.1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option internal_mask &#039;255.255.255.0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option cipher &#039;BF-CBC&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option keysize &#039;128&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option duplicate_cn &#039;true&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option redirect_gateway &#039;false&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option subnet_access &#039;true&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option subnet_ip &#039;192.168.100.0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option subnet_mask &#039;255.255.255.0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option pool &#039;10.8.0.2 10.8.0.254 255.255.255.0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option port &#039;8086&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option client_to_client &#039;true&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option enabled &#039;true&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;udp&#039;</p><p>config client &#039;client&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option enabled &#039;false&#039;</p><p>config allowed_client &#039;klient1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option id &#039;klient1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option name &#039;Klient1_xx.xx.xx.xx&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option remote &#039;xx.xx.xx.xx&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option enabled &#039;true&#039;</p><br /><p>Could you look into that problem ?</p><br /><p>When I restarted mwan3&nbsp; there is a info displayed:</p><br /><p>I have got restriction for MAC address in my firewall:</p><p>/etc/init.d/mwan3 restart<br />iptables -t filter -A egress_restrictions&nbsp; -p tcp&nbsp; &nbsp;-m mac<br />--mac-source&nbsp; &nbsp;30:17:C8:63:E2:B9&nbsp; -j REJECT --reject-with tcp-reset<br />iptables -t filter -A egress_restrictions&nbsp; &nbsp;-m mac --mac-source<br />30:17:C8:63:E2:B9&nbsp; -j REJECT<br />iptables -t filter -A egress_restrictions&nbsp; -p tcp&nbsp; &nbsp;-m mac<br />--mac-source&nbsp; &nbsp;30:17:C8:63:E2:B9&nbsp; -j REJECT --reject-with tcp-reset<br />iptables -t filter -A egress_restrictions&nbsp; &nbsp;-m mac --mac-source<br />30:17:C8:63:E2:B9&nbsp; -j REJECT<br />ERROR: No valid dynamic DNS service configurations defined</p><br /><br /><p>There is my mwan3 config file:</p><br /><p>cat /etc/config/mwan3</p><p>config interface &#039;wan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option enabled &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; list track_ip &#039;8.8.8.8&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; list track_ip &#039;8.8.8.8&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; list track_ip &#039;212.77.100.101&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option reliability &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option count &#039;2&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option timeout &#039;3&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option interval &#039;15&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option down &#039;5&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option up &#039;3&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option reroute &#039;1&#039;</p><p>config interface &#039;wan2&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option enabled &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; list track_ip &#039;8.8.8.8&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; list track_ip &#039;8.8.8.8&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; list track_ip &#039;212.77.100.101&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option reliability &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option count &#039;2&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option timeout &#039;3&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option interval &#039;15&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option down &#039;5&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option up &#039;3&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option reroute &#039;1&#039;</p><p>config interface &#039;wan3&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option enabled &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; list track_ip &#039;8.8.8.8&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; list track_ip &#039;8.8.8.8&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; list track_ip &#039;212.77.100.101&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option reliability &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option down &#039;10&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option up &#039;3&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option reroute &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option count &#039;3&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option timeout &#039;5&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option interval &#039;3&#039;</p><p>config member &#039;wan_m1_w1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option metric &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option weight &#039;10&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option interface &#039;wan&#039;</p><p>config member &#039;wan_m2_w2&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option metric &#039;2&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option weight &#039;10&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option interface &#039;wan&#039;</p><p>config member &#039;wan2_m1_w1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option interface &#039;wan2&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option metric &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option weight &#039;2&#039;</p><p>config member &#039;wan2_m2_w2&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option interface &#039;wan2&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option metric &#039;2&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option weight &#039;2&#039;</p><p>config member &#039;wan3_backup&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option interface &#039;wan3&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option metric &#039;3&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option weight &#039;1&#039;</p><p>config policy &#039;wan_only&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; list use_member &#039;wan_m1_w1&#039;</p><p>config policy &#039;wan2_only&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; list use_member &#039;wan2_m1_w1&#039;</p><p>config policy &#039;wan_wan2_loadbalanced&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; list use_member &#039;wan_m1_w1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; list use_member &#039;wan2_m1_w1&#039;</p><p>config policy &#039;wan_pri_wan2_sec_wan3_backup&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; list use_member &#039;wan_m1_w1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; list use_member &#039;wan2_m2_w2&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; list use_member &#039;wan3_backup&#039;</p><p>config policy &#039;wan2_pri_wan_sec&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; list use_member &#039;wan2_m1_w1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; list use_member &#039;wan_m2_w2&#039;</p><p>config policy &#039;wan_pri_wan2_sec&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; list use_member &#039;wan_m1_w1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; list use_member &#039;wan2_m2_w2&#039;</p><p>config rule &#039;balancer&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option dest_ip &#039;0.0.0.0/0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;all&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option use_policy &#039;wan_wan2_loadbalanced&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option equalize &#039;1&#039;</p><br /><p>And network</p><br /><p>cat /etc/config/network</p><p>config interface &#039;loopback&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname &#039;lo&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;static&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr &#039;127.0.0.1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask &#039;255.0.0.0&#039;</p><p>config alias<br />&nbsp; &nbsp; &nbsp; &nbsp; option interface &#039;loopback&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;static&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr &#039;192.168.1.1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask &#039;255.255.255.255&#039;</p><p>config interface &#039;lan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname &#039;eth0.1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option type &#039;bridge&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;static&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask &#039;255.255.255.0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr &#039;192.168.100.100&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option dns &#039;208.67.222.222 208.67.220.220&#039;</p><p>config interface &#039;wan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option auto &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname &#039;eth0.2&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;static&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ipaddr &#039;10.0.0.155&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option netmask &#039;255.255.255.0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option gateway &#039;10.0.0.1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option metric &#039;10&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option peerdns &#039;0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option dns &#039;208.67.222.222 208.67.220.220&#039;</p><p>config interface &#039;wan2&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option auto &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname &#039;eth0.3&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option macaddr &#039;C8:3A:35:4E:4F:CD&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;dhcp&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option peerdns &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option dns &#039;208.67.220.220 208.67.222.222 8.8.8.8 8.8.4.4&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option defaultroute &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option metric &#039;20&#039;</p><p>config interface &#039;wan3&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option auto &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;3g&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option device &#039;/dev/ttyUSB0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option apn &#039;darmowy&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option service &#039;umts&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option mobile_isp &#039;Polska - Aero2&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option peerdns &#039;0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option dns &#039;208.67.220.220 208.67.222.222 8.8.8.8 8.8.4.4&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option defaultroute &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option metric &#039;30&#039;</p><p>config switch<br />&nbsp; &nbsp; &nbsp; &nbsp; option enable &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option name &#039;rtl8366rb&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option reset &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option enable_vlan &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option blinkrate &#039;2&#039;</p><p>config switch_vlan<br />&nbsp; &nbsp; &nbsp; &nbsp; option device &#039;rtl8366rb&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option vlan &#039;1&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ports &#039;2 3 4 5t&#039;</p><p>config switch_vlan<br />&nbsp; &nbsp; &nbsp; &nbsp; option device &#039;rtl8366rb&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option vlan &#039;2&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ports &#039;0 5t&#039;</p><p>config switch_vlan<br />&nbsp; &nbsp; &nbsp; &nbsp; option device &#039;rtl8366rb&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option vlan &#039;3&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ports &#039;1 5t&#039;</p><p>config interface &#039;vpn&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option ifname &#039;tun0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;none&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option defaultroute &#039;0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option peerdns &#039;0&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option auto &#039;1&#039;</p><br /><p>Regards,<br />Robert</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216857">
				<div class="post-metadata">
					<div class="post-num">Post #547</div>
					<div class="post-author">jigglywiggly</div>
					<div class="post-datetime">
						6 Nov 2013, 11:05					</div>
				</div>
				<div class="post-content content">
					<p>I overcame the two interfaces on the same gateway problem by just adding a cheap refurb&#039;d e900.</p><p>3 modems on a consumer router. Thanks so much, this is too good.</p>											<p class="post-edited">(Last edited by <strong>jigglywiggly</strong> on 6 Nov 2013, 11:05)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216888">
				<div class="post-metadata">
					<div class="post-num">Post #548</div>
					<div class="post-author">rl608742063</div>
					<div class="post-datetime">
						6 Nov 2013, 16:43					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><br /><p>I tried to set openvpn and mwan3 according to that manual from wiki openwrt</p><p>I am using -&nbsp; mwan3-1.2-20 - file /etc/hotplug.d/iface/15-mwan3 because previous error reported belove. </p><p>&gt;&gt;&gt;&gt;<br />OpenVPN</p><p>&nbsp; &nbsp; Related pages:<br />&nbsp; &nbsp; &nbsp; &nbsp; vpn.openvpn</p><p>Example 1: Have OpenVPN Server be accessible through multiple WAN interfaces</p><p>If load-balancing between multiple WAN interfaces, it is desirable to have OpenVPN clients be able to connect through all active WAN interfaces.</p><p>In a multiple WAN interface failover scenario, OpenVPN will not accept client connections on the secondary WAN interface after a failover, as it started listening on the primary WAN interface when it was started.</p><p>The following configuration will allow multiple WAN interface to be used with OpenVPN Server.<br />Step 1: Listen only on the internal LAN interface</p><p>&nbsp; &nbsp; Configure OpenVPN Server to listen on the internal LAN interface only, not on any WAN interface. The internal LAN interface will not go down or change, and so it provides a stable listening interface for OpenVPN.</p><p>vi /etc/openvpn/my-vpn.conf</p><p>...<br /># Which local IP address should OpenVPN<br /># listen on? (optional)<br />;local a.b.c.d<br />## Customization: have OpenVPN listen on the internal LAN interface IP only to allow client re-connections after a WAN interface failover<br />local 192.168.1.1</p><p>...</p><p>Step 2: Set up port-forward(s)</p><p>&nbsp; &nbsp; Configure a port-forward on the &quot;wan&quot; source zone to OpenVPN Server listening on the internal LAN interface. The port-forward will be active on every WAN interface and work the same way regardless of what WAN interface is active.<br />&nbsp; &nbsp; Create a firewall rule like the following:<br />&nbsp; &nbsp; &nbsp; &nbsp; Network &gt; Firewall &gt; Port Forwards<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Name: OpenVPN forward to unchanging inside IP<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Protocol: UDP<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Source zone: wan<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Source IP address: any<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; External IP address: any<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; External port: 1194 (the default OpenVPN UDP port)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Internal zone: lan<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Internal IP address: (the internal LAN interface IP address)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Internal port: 1194<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Enable NAT Loopback: enabled (the default)</p><p>Step 3: OpenVPN client and DNS configuration</p><p>&nbsp; &nbsp; If load-balancing between multiple active WAN interfaces, the suggested approach is to register multiple DNS A records for the same DNS name. Clients will use just one of the IPs. As per the OpenVPN man page description of the –remote client parameter, &quot;If host is a DNS name which resolves to multiple IP addresses, one will be randomly chosen, providing a sort of basic load-balancing and failover capability.&quot;<br />&nbsp; &nbsp; If failing over from a primary to a secondary WAN interface, one approach is to use ddns-scripts to update the IP of the DNS name used by OpenVPN clients</p><p>&gt;&gt;&gt;</p><p>I have 2 zones in firewal config -&nbsp; for wan and secondary is wan2 - it is required for specyfic reason of routing.</p><br /><p>1 )and I set forwarding in firewal fo wan and wan2 separately - it does not work<br />2) I removed second forward on port of openvpn for wan2 and it gives connection only on wan - when I stop a wan the second wan - wan2 does not taking care of trafic and routing for openvpn - I am not able to connect on wan2 when wan is down.</p><p>3) when it is in original state the coonection to openvpn is avaliable only on primary wan, when I stop wan connection through wan 2 is not allowed - request refused.</p><br /><p>mwan3 config </p><div class="codebox"><pre><code>Software versions :

OpenWrt - OpenWrt Attitude Adjustment 12.09.1 (r38462) mwan3 - 1.3-0 luci-app-mwan3 - unknown

Firewall default output policy (must be ACCEPT) :

ACCEPT

Output of &quot;ip route show&quot; :

default via 10.0.0.1 dev eth0.2 proto static metric 10 default via 192.168.200.1 dev eth0.3 proto static metric 20 default via 10.64.64.64 dev 3g-wan3 proto static metric 30 10.0.0.0/24 dev eth0.2 proto static scope link metric 10 10.8.0.0/24 dev tun0 proto kernel scope link src 10.8.0.1 10.64.64.64 dev 3g-wan3 proto kernel scope link src 93.154.214.50 192.168.100.0/24 dev br-lan proto kernel scope link src 192.168.100.100 192.168.200.0/24 dev eth0.3 proto static scope link metric 20

Output of &quot;ip rule show&quot; :

0: from all lookup local 1001: from all fwmark 0x100/0xff00 lookup 1001 1002: from all fwmark 0x200/0xff00 lookup 1002 1003: from all fwmark 0x300/0xff00 lookup 1003 1016: from all fwmark 0x1000/0xff00 lookup 1016 1017: from all fwmark 0x1100/0xff00 lookup 1017 1018: from all fwmark 0x1200/0xff00 lookup 1018 1019: from all fwmark 0x1300/0xff00 lookup 1019 1020: from all fwmark 0x1400/0xff00 lookup 1020 1021: from all fwmark 0x1500/0xff00 lookup 1021 32766: from all lookup main 32767: from all lookup default

Output of &quot;ip route list table 1001-1099&quot; (1001-1015 = interface tables, 1016-1099 = policy tables) :

1001 default via 10.0.0.1 dev eth0.2 1002 default via 192.168.200.1 dev eth0.3 1003 default via 10.64.64.64 dev 3g-wan3 1016 default via 10.0.0.1 dev eth0.2 metric 1 1017 default via 192.168.200.1 dev eth0.3 metric 1 1018 default metric 1 nexthop via 10.0.0.1 dev eth0.2 weight 10 nexthop via 192.168.200.1 dev eth0.3 weight 2 1019 default via 10.0.0.1 dev eth0.2 metric 1 default via 192.168.200.1 dev eth0.3 metric 2 default via 10.64.64.64 dev 3g-wan3 metric 3 1020 default via 192.168.200.1 dev eth0.3 metric 1 default via 10.0.0.1 dev eth0.2 metric 2 1021 default via 10.0.0.1 dev eth0.2 metric 1 default via 192.168.200.1 dev eth0.3 metric 2

Output of &quot;iptables -L -t mangle -v -n | awk &#039;/mwan3/&#039; RS=&quot; :

Chain PREROUTING (policy ACCEPT 674 packets, 89146 bytes) pkts bytes target prot opt in out source destination 13980 2163K mwan3_pre all -- * * 0.0.0.0/0 0.0.0.0/0 1011 129K fwmark all -- * * 0.0.0.0/0 0.0.0.0/0 Chain INPUT (policy ACCEPT 399 packets, 48219 bytes) pkts bytes target prot opt in out source destination 2718 266K mwan3_post all -- * * 0.0.0.0/0 0.0.0.0/0 182 26613 openvpn_down_bw udp -- eth0.2 * 0.0.0.0/0 0.0.0.0/0 udp dpt:8086 Chain OUTPUT (policy ACCEPT 413 packets, 89783 bytes) pkts bytes target prot opt in out source destination 3098 416K mwan3_pre all -- * * 0.0.0.0/0 0.0.0.0/0 179 37049 openvpn_up_bw udp -- * eth0.2 0.0.0.0/0 0.0.0.0/0 udp spt:8086 Chain POSTROUTING (policy ACCEPT 653 packets, 129K bytes) pkts bytes target prot opt in out source destination 14281 2298K mwan3_post all -- * * 0.0.0.0/0 0.0.0.0/0 Chain mwan3_default (1 references) pkts bytes target prot opt in out source destination 16 791 MARK all -- * * 0.0.0.0/0 224.0.0.0/3 mark match 0x0/0xff00 MARK xset 0x7f00/0xff00 73 5296 MARK all -- * * 0.0.0.0/0 127.0.0.0/8 mark match 0x0/0xff00 MARK xset 0x7f00/0xff00 0 0 MARK all -- * * 0.0.0.0/0 10.0.0.0/24 mark match 0x0/0xff00 MARK xset 0x7f00/0xff00 0 0 MARK all -- * * 0.0.0.0/0 10.8.0.0/24 mark match 0x0/0xff00 MARK xset 0x7f00/0xff00 0 0 MARK all -- * * 0.0.0.0/0 10.64.64.64 mark match 0x0/0xff00 MARK xset 0x7f00/0xff00 16 832 MARK all -- * * 0.0.0.0/0 192.168.100.0/24 mark match 0x0/0xff00 MARK xset 0x7f00/0xff00 0 0 MARK all -- * * 0.0.0.0/0 192.168.200.0/24 mark match 0x0/0xff00 MARK xset 0x7f00/0xff00 Chain mwan3_interfaces (1 references) pkts bytes target prot opt in out source destination Chain mwan3_post (2 references) pkts bytes target prot opt in out source destination 305 48811 MARK all -- * eth0.2 0.0.0.0/0 !10.0.0.0/24 mark match !0x7f00/0xff00 MARK xset 0x100/0xff00 183 15240 MARK all -- * 3g-wan3 0.0.0.0/0 !10.64.64.64 mark match !0x7f00/0xff00 MARK xset 0x300/0xff00 5222 838K MARK all -- * eth0.3 0.0.0.0/0 !192.168.200.0/24 mark match !0x7f00/0xff00 MARK xset 0x200/0xff00 3975 457K MARK all -- * * 0.0.0.0/0 0.0.0.0/0 mark match 0x8000/0x8000 MARK and 0xffff7fff 16999 2564K CONNMARK all -- * * 0.0.0.0/0 0.0.0.0/0 CONNMARK save mask 0xff00 Chain mwan3_pre (2 references) pkts bytes target prot opt in out source destination 17078 2579K CONNMARK all -- * * 0.0.0.0/0 0.0.0.0/0 CONNMARK restore mask 0xff00 336 41997 MARK all -- eth0.2 * !10.0.0.0/24 0.0.0.0/0 mark match !0x7f00/0xff00 MARK xset 0x8100/0xff00 170 14172 MARK all -- 3g-wan3 * !10.64.64.64 0.0.0.0/0 mark match !0x7f00/0xff00 MARK xset 0x8300/0xff00 3506 404K MARK all -- eth0.3 * !192.168.200.0/24 0.0.0.0/0 mark match !0x7f00/0xff00 MARK xset 0x8200/0xff00 717 62552 mwan3_default all -- * * 0.0.0.0/0 0.0.0.0/0 mark match 0x0/0xff00 456 37507 mwan3_interfaces all -- * * 0.0.0.0/0 0.0.0.0/0 mark match 0x0/0xff00 456 37507 mwan3_rules all -- * * 0.0.0.0/0 0.0.0.0/0 mark match 0x0/0xff00 Chain mwan3_rules (1 references) pkts bytes target prot opt in out source destination 0 0 MARK all -- * * 192.168.100.0/24 0.0.0.0/0 mark match 0x0/0xff00 MARK xset 0x7f00/0xff00 0 0 MARK all -- * * 192.168.100.0/24 0.0.0.0/0 mark match 0x0/0xff00 MARK xset 0x1300/0xff00 14 1061 MARK all -- * * 0.0.0.0/0 0.0.0.0/0 mark match 0x0/0xff00 statistic mode random probability 0.166000 MARK xset 0x200/0xff00 61 4916 MARK all -- * * 0.0.0.0/0 0.0.0.0/0 mark match 0x0/0xff00 statistic mode random probability 1.000000 MARK xset 0x100/0xff00

Output of &quot;ifconfig&quot; :

3g-wan3 Link encap:Point-to-Point Protocol inet addr:93.154.214.50 P-t-P:10.64.64.64 Mask:255.255.255.255 UP POINTOPOINT RUNNING NOARP MULTICAST MTU:1500 Metric:1 RX packets:741 errors:0 dropped:0 overruns:0 frame:0 TX packets:813 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:3 RX bytes:61428 (59.9 KiB) TX bytes:67758 (66.1 KiB) br-lan Link encap:Ethernet HWaddr F8:D1:11:B7:41:56 inet addr:192.168.100.100 Bcast:192.168.100.255 Mask:255.255.255.0 UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1 RX packets:62892 errors:0 dropped:5 overruns:0 frame:0 TX packets:61775 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:0 RX bytes:16082956 (15.3 MiB) TX bytes:15785520 (15.0 MiB) eth0 Link encap:Ethernet HWaddr F8:D1:11:B7:41:56 UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1 RX packets:238161 errors:0 dropped:8 overruns:59736 frame:0 TX packets:102093 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000 RX bytes:28569978 (27.2 MiB) TX bytes:23811663 (22.7 MiB) Interrupt:4 eth0.1 Link encap:Ethernet HWaddr F8:D1:11:B7:41:56 UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1 RX packets:8851 errors:0 dropped:0 overruns:0 frame:0 TX packets:13024 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:0 RX bytes:1997937 (1.9 MiB) TX bytes:3805886 (3.6 MiB) eth0.2 Link encap:Ethernet HWaddr F8:D1:11:B7:41:56 inet addr:10.0.0.155 Bcast:10.0.0.255 Mask:255.255.255.0 UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1 RX packets:671 errors:0 dropped:0 overruns:0 frame:0 TX packets:484 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:0 RX bytes:67691 (66.1 KiB) TX bytes:91354 (89.2 KiB) eth0.3 Link encap:Ethernet HWaddr C8:3A:35:4E:4F:CD inet addr:192.168.200.100 Bcast:192.168.200.255 Mask:255.255.255.0 UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1 RX packets:19758 errors:0 dropped:0 overruns:0 frame:0 TX packets:22233 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:0 RX bytes:2459429 (2.3 MiB) TX bytes:4800175 (4.5 MiB) lo Link encap:Local Loopback inet addr:127.0.0.1 Mask:255.0.0.0 UP LOOPBACK RUNNING MTU:16436 Metric:1 RX packets:12793 errors:0 dropped:0 overruns:0 frame:0 TX packets:12793 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:0 RX bytes:1207866 (1.1 MiB) TX bytes:1207866 (1.1 MiB) tun0 Link encap:UNSPEC HWaddr 00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00 inet addr:10.8.0.1 P-t-P:10.8.0.1 Mask:255.255.255.0 UP POINTOPOINT RUNNING NOARP MULTICAST MTU:1500 Metric:1 RX packets:105 errors:0 dropped:0 overruns:0 frame:0 TX packets:107 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:100 RX bytes:11053 (10.7 KiB) TX bytes:35300 (34.4 KiB) wlan0 Link encap:Ethernet HWaddr F8:D1:11:B7:41:56 UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1 RX packets:54013 errors:0 dropped:0 overruns:0 frame:0 TX packets:53718 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000 RX bytes:14881867 (14.1 MiB) TX bytes:15356827 (14.6 MiB)

Output of &quot;cat /etc/config/mwan3&quot; :

config rule &#039;to_default&#039; option src_ip &#039;192.168.100.0/24&#039; option dest_ip &#039;0.0.0.0/0&#039; option proto &#039;all&#039; option use_policy &#039;default&#039; config rule &#039;failover&#039; option src_ip &#039;192.168.100.0/24&#039; option dest_ip &#039;0.0.0.0/0&#039; option proto &#039;all&#039; option use_policy &#039;wan_pri_wan2_sec_wan3_backup&#039; config rule &#039;balancer&#039; option dest_ip &#039;0.0.0.0/0&#039; option proto &#039;all&#039; option use_policy &#039;wan_wan2_loadbalanced&#039; option equalize &#039;1&#039; option src_ip &#039;0.0.0.0/0&#039; config interface &#039;wan&#039; option enabled &#039;1&#039; list track_ip &#039;8.8.8.8&#039; list track_ip &#039;212.77.100.101&#039; option reliability &#039;1&#039; option count &#039;2&#039; option timeout &#039;3&#039; option down &#039;5&#039; option up &#039;3&#039; option reroute &#039;1&#039; option interval &#039;10&#039; config interface &#039;wan2&#039; option enabled &#039;1&#039; list track_ip &#039;8.8.8.8&#039; list track_ip &#039;212.77.100.101&#039; option reliability &#039;1&#039; option count &#039;2&#039; option timeout &#039;3&#039; option down &#039;5&#039; option up &#039;3&#039; option reroute &#039;1&#039; option interval &#039;10&#039; config interface &#039;wan3&#039; option enabled &#039;1&#039; list track_ip &#039;8.8.8.8&#039; list track_ip &#039;212.77.100.101&#039; option reliability &#039;1&#039; option down &#039;10&#039; option reroute &#039;1&#039; option count &#039;3&#039; option timeout &#039;5&#039; option up &#039;10&#039; option interval &#039;20&#039; config member &#039;wan_m1_w1&#039; option metric &#039;1&#039; option weight &#039;10&#039; option interface &#039;wan&#039; config member &#039;wan_m2_w2&#039; option metric &#039;2&#039; option weight &#039;10&#039; option interface &#039;wan&#039; config member &#039;wan2_m1_w1&#039; option interface &#039;wan2&#039; option metric &#039;1&#039; option weight &#039;2&#039; config member &#039;wan2_m2_w2&#039; option interface &#039;wan2&#039; option metric &#039;2&#039; option weight &#039;2&#039; config member &#039;wan3_backup&#039; option interface &#039;wan3&#039; option metric &#039;3&#039; option weight &#039;1&#039; config policy &#039;wan_only&#039; list use_member &#039;wan_m1_w1&#039; config policy &#039;wan2_only&#039; list use_member &#039;wan2_m1_w1&#039; config policy &#039;wan_wan2_loadbalanced&#039; list use_member &#039;wan_m1_w1&#039; list use_member &#039;wan2_m1_w1&#039; config policy &#039;wan_pri_wan2_sec_wan3_backup&#039; list use_member &#039;wan_m1_w1&#039; list use_member &#039;wan2_m2_w2&#039; list use_member &#039;wan3_backup&#039; config policy &#039;wan2_pri_wan_sec&#039; list use_member &#039;wan2_m1_w1&#039; list use_member &#039;wan_m2_w2&#039; config policy &#039;wan_pri_wan2_sec&#039; list use_member &#039;wan_m1_w1&#039; list use_member &#039;wan2_m2_w2&#039;

Output of &quot;cat /etc/config/network&quot; :

config interface &#039;loopback&#039; option ifname &#039;lo&#039; option proto &#039;static&#039; option ipaddr &#039;127.0.0.1&#039; option netmask &#039;255.0.0.0&#039; config alias option interface &#039;loopback&#039; option proto &#039;static&#039; option ipaddr &#039;192.168.1.1&#039; option netmask &#039;255.255.255.255&#039; config interface &#039;lan&#039; option ifname &#039;eth0.1&#039; option type &#039;bridge&#039; option proto &#039;static&#039; option netmask &#039;255.255.255.0&#039; option ipaddr &#039;192.168.100.100&#039; option dns &#039;208.67.222.222 208.67.220.220&#039; config interface &#039;wan&#039; option auto &#039;1&#039; option ifname &#039;eth0.2&#039; option proto &#039;static&#039; option ipaddr &#039;10.0.0.155&#039; option netmask &#039;255.255.255.0&#039; option gateway &#039;10.0.0.1&#039; option metric &#039;10&#039; option peerdns &#039;0&#039; option dns &#039;208.67.222.222 208.67.220.220&#039; config interface &#039;wan2&#039; option auto &#039;1&#039; option ifname &#039;eth0.3&#039; option macaddr &#039;C8:3A:35:4E:4F:CD&#039; option proto &#039;dhcp&#039; option peerdns &#039;1&#039; option dns &#039;208.67.220.220 208.67.222.222 8.8.8.8 8.8.4.4&#039; option defaultroute &#039;1&#039; option metric &#039;20&#039; config interface &#039;wan3&#039; option auto &#039;1&#039; option proto &#039;3g&#039; option device &#039;/dev/ttyUSB0&#039; option apn &#039;darmowy&#039; option service &#039;umts&#039; option mobile_isp &#039;Polska - Aero2&#039; option peerdns &#039;0&#039; option dns &#039;208.67.220.220 208.67.222.222 8.8.8.8 8.8.4.4&#039; option defaultroute &#039;1&#039; option metric &#039;30&#039; config switch option enable &#039;1&#039; option name &#039;rtl8366rb&#039; option reset &#039;1&#039; option enable_vlan &#039;1&#039; option blinkrate &#039;4&#039; config switch_vlan option device &#039;rtl8366rb&#039; option vlan &#039;1&#039; option ports &#039;2 3 4 5t&#039; config switch_vlan option device &#039;rtl8366rb&#039; option vlan &#039;2&#039; option ports &#039;0 5t&#039; config switch_vlan option device &#039;rtl8366rb&#039; option vlan &#039;3&#039; option ports &#039;1 5t&#039; config interface &#039;vpn&#039; option ifname &#039;tun0&#039; option proto &#039;none&#039; option defaultroute &#039;0&#039; option peerdns &#039;0&#039; option auto &#039;0&#039;</code></pre></div><p>mwan3 config</p><div class="codebox"><pre><code>config rule &#039;to_default&#039;
    option src_ip &#039;192.168.100.0/24&#039;
    option dest_ip &#039;0.0.0.0/0&#039;
    option proto &#039;all&#039;
    option use_policy &#039;default&#039;

config rule &#039;failover&#039;
    option src_ip &#039;192.168.100.0/24&#039;
    option dest_ip &#039;0.0.0.0/0&#039;
    option proto &#039;all&#039;
    option use_policy &#039;wan_pri_wan2_sec_wan3_backup&#039;

config rule &#039;balancer&#039;
    option dest_ip &#039;0.0.0.0/0&#039;
    option proto &#039;all&#039;
    option use_policy &#039;wan_wan2_loadbalanced&#039;
    option equalize &#039;1&#039;
    option src_ip &#039;0.0.0.0/0&#039;

config interface &#039;wan&#039;
    option enabled &#039;1&#039;
    list track_ip &#039;8.8.8.8&#039;
    list track_ip &#039;212.77.100.101&#039;
    option reliability &#039;1&#039;
    option count &#039;2&#039;
    option timeout &#039;3&#039;
    option down &#039;5&#039;
    option up &#039;3&#039;
    option reroute &#039;1&#039;
    option interval &#039;10&#039;

config interface &#039;wan2&#039;
    option enabled &#039;1&#039;
    list track_ip &#039;8.8.8.8&#039;
    list track_ip &#039;212.77.100.101&#039;
    option reliability &#039;1&#039;
    option count &#039;2&#039;
    option timeout &#039;3&#039;
    option down &#039;5&#039;
    option up &#039;3&#039;
    option reroute &#039;1&#039;
    option interval &#039;10&#039;

config interface &#039;wan3&#039;
    option enabled &#039;1&#039;
    list track_ip &#039;8.8.8.8&#039;
    list track_ip &#039;212.77.100.101&#039;
    option reliability &#039;1&#039;
    option down &#039;10&#039;
    option reroute &#039;1&#039;
    option count &#039;3&#039;
    option timeout &#039;5&#039;
    option up &#039;10&#039;
    option interval &#039;20&#039;

config member &#039;wan_m1_w1&#039;
    option metric &#039;1&#039;
    option weight &#039;10&#039;
    option interface &#039;wan&#039;

config member &#039;wan_m2_w2&#039;
    option metric &#039;2&#039;
    option weight &#039;10&#039;
    option interface &#039;wan&#039;

config member &#039;wan2_m1_w1&#039;
    option interface &#039;wan2&#039;
    option metric &#039;1&#039;
    option weight &#039;2&#039;

config member &#039;wan2_m2_w2&#039;
    option interface &#039;wan2&#039;
    option metric &#039;2&#039;
    option weight &#039;2&#039;

config member &#039;wan3_backup&#039;
    option interface &#039;wan3&#039;
    option metric &#039;3&#039;
    option weight &#039;1&#039;

config policy &#039;wan_only&#039;
    list use_member &#039;wan_m1_w1&#039;

config policy &#039;wan2_only&#039;
    list use_member &#039;wan2_m1_w1&#039;

config policy &#039;wan_wan2_loadbalanced&#039;
    list use_member &#039;wan_m1_w1&#039;
    list use_member &#039;wan2_m1_w1&#039;

config policy &#039;wan_pri_wan2_sec_wan3_backup&#039;
    list use_member &#039;wan_m1_w1&#039;
    list use_member &#039;wan2_m2_w2&#039;
    list use_member &#039;wan3_backup&#039;

config policy &#039;wan2_pri_wan_sec&#039;
    list use_member &#039;wan2_m1_w1&#039;
    list use_member &#039;wan_m2_w2&#039;

config policy &#039;wan_pri_wan2_sec&#039;
    list use_member &#039;wan_m1_w1&#039;
    list use_member &#039;wan2_m2_w2&#039;</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216897">
				<div class="post-metadata">
					<div class="post-num">Post #549</div>
					<div class="post-author">rl608742063</div>
					<div class="post-datetime">
						6 Nov 2013, 18:20					</div>
				</div>
				<div class="post-content content">
					<p>I resolved the problem with multivan and wan1 and wan2 for openvpn to get connection from wan and wan2</p><p>wan has 10.0.0.155</p><p>wan2 has 192.168.200.100</p><p>lan has 192.168.100.0</p><br /><p>openvpnserver is running on 10.0.0.155 with forwarding port to local network 192.168.100.100 for 8086 port</p><br /><p>I add rule for forwarding from wan2 to wan to 10.0.0.155 port 8086</p><p>config redirect<br />&nbsp; &nbsp; &nbsp; &nbsp; option target &#039;DNAT&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option src_dport &#039;8086&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option dest_port &#039;8086&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option name &#039;Forward8086&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option proto &#039;udp&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option src &#039;wan2&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option dest &#039;wan&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option dest_ip &#039;10.0.0.155&#039;</p><br /><p>and right now I have multiwan with loadbalancer and failover and I am able to connect simultaneously to my openvpn server through wan and wan2</p><p>my client config is set to double remote server </p><p>resolv-retry 60<br />remote [ipserver] 8086 <br />remote [ipserver 2] 8086</p><p>dev&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;tun<br />proto&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;udp</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p216900">
				<div class="post-metadata">
					<div class="post-num">Post #550</div>
					<div class="post-author">arfett</div>
					<div class="post-datetime">
						6 Nov 2013, 18:53					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>thdyck wrote:</cite><blockquote><p>Hi arfett, thanks for your work on the LuCI app for mwan3!</p><p>A couple of UI suggestions for your consideration:<br />- Adze mentioned in another post that if the test IP infrastructure is not defined for an interface, mwan3 will always assume the interface is up. This would be handy to have an option in the LuCI UI to define this setting for an interface.<br />- For interfaces that are just for emergency use purposes and are metered by packet count (e.g. some cellular data connections), it would be helpful to be able to increase the ping interval to longer than 5 minutes. 10 and 15 minutes would be a nice add.</p><p>Thanks,<br />Tim</p></blockquote></div><p>Technically the setting for always up is there as you just don&#039;t configure any test IP addresses but I will add a setting for that which hides the tracking options if you want the interface always up.</p><p>I&#039;m adding 5,10,15,30 minutes to the interval.</p><p>I need to fix a bug with the bootstrap theme that hides some of the instructions from the user and I&#039;ll be updating the package soon.</p>									</div>
			</article>

			
		
						<div class="notice">
				<p>Sorry, posts 551 to 550 are missing from our archive.</p>
			</div>
		
		
	
	<div class="pagination"><div class="pagination-number">Page 22 of 65</div><nav><ul><li><a href="viewtopic.php%3Fid=39052&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=20.html">20</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=21.html">21</a></li><li class="pagination-current"><span>22</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=23.html">23</a></li><li><a href="viewtopic.php%3Fid=39052&amp;p=24.html">24</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=39052&amp;p=65.html">65</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0.001 -->

</body>
</html>