<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Build for WNDR3700/WNDR3800</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 9 Jul 2013 and 6 May 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 13 of 63</div><nav><ul><li><a href="viewtopic.php%3Fid=28392&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=28392&amp;p=11.html">11</a></li><li><a href="viewtopic.php%3Fid=28392&amp;p=12.html">12</a></li><li class="pagination-current"><span>13</span></li><li><a href="viewtopic.php%3Fid=28392&amp;p=14.html">14</a></li><li><a href="viewtopic.php%3Fid=28392&amp;p=15.html">15</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=28392&amp;p=63.html">63</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p183922">
				<div class="post-metadata">
					<div class="post-num">Post #301</div>
					<div class="post-author">Etique</div>
					<div class="post-datetime">
						21 Nov 2012, 21:43					</div>
				</div>
				<div class="post-content content">
					<p>Hi Hnyman,</p><p>How easy would it be to install OpenVPN &amp; conntrack-rtsp on your build? Do I need to rebuild it or can I just build the packages?</p><p>Cheers!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p183925">
				<div class="post-metadata">
					<div class="post-num">Post #302</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						21 Nov 2012, 22:02					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Etique wrote:</cite><blockquote><p>How easy would it be to install OpenVPN &amp; conntrack-rtsp on your build? Do I need to rebuild it or can I just build the packages?</p></blockquote></div><p>You might even try just installing the openvpn from the snapshot repository, because the installation includes no kernel mods.</p><p>conntrack is probably more difficult, you probably need to compile the whole firmware.</p><br/><p>EDIT:<br/>I tried installing openvpn to my 3.6.7 build from snapshot repository, and at least it didn&#039;t crash the router immediately ;-)<br/>Not sure if it works, though...<br/>Based on the install log in luci, the installation checked kmod-tun, for which it absolutely should keep my version instead of the snapshot version. <br/></p><div class="codebox"><pre><code>Installing openvpn (2.2.2-2) to root...
Downloading http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/openvpn_2.2.2-2_ar71xx.ipk.
Multiple packages (kmod-tun and kmod-tun) providing same name marked HOLD or PREFER. Using latest.
Installing liblzo (2.06-1) to root...
Downloading http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/liblzo_2.06-1_ar71xx.ipk.
Configuring liblzo.
Configuring openvpn.</code></pre></div><div class="codebox"><pre><code>BusyBox v1.19.4 (2012-11-21 19:33:19 EET) built-in shell (ash)
Enter &#039;help&#039; for a list of built-in commands.

  _______                     ________        __
 |       |.-----.-----.-----.|  |  |  |.----.|  |_
 |   -   ||  _  |  -__|     ||  |  |  ||   _||   _|
 |_______||   __|_____|__|__||________||__|  |____|
          |__| W I R E L E S S   F R E E D O M
 -----------------------------------------------------
 BARRIER BREAKER (Bleeding Edge, r34288)
 -----------------------------------------------------
  * 1/2 oz Galliano         Pour all ingredients into
  * 4 oz cold Coffee        an irish coffee mug filled
  * 1 1/2 oz Dark Rum       with crushed ice. Stir.
  * 2 tsp. Creme de Cacao
 -----------------------------------------------------
root@OpenWrt:~# which openvpn
/usr/sbin/openvpn
root@OpenWrt:~# openvpn
Usage message not available
root@OpenWrt:~# uname -r
3.6.7</code></pre></div>											<p class="post-edited">(Last edited by <strong>hnyman</strong> on 21 Nov 2012, 22:16)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p183927">
				<div class="post-metadata">
					<div class="post-num">Post #303</div>
					<div class="post-author">Etique</div>
					<div class="post-datetime">
						21 Nov 2012, 22:24					</div>
				</div>
				<div class="post-content content">
					<p>It&#039;s actually not conntrack-rtsp, but kmod-ipt-nathelper-rtsp.</p><p>Cheers! Will give it a try <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile"/></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p184173">
				<div class="post-metadata">
					<div class="post-num">Post #304</div>
					<div class="post-author">Etique</div>
					<div class="post-datetime">
						24 Nov 2012, 13:42					</div>
				</div>
				<div class="post-content content">
					<p>Ok, Openvpn installed and works! <img src="https://forum.openwrt.org/img/smilies/smile.png" width="15" height="15" alt="smile"/></p><p>but I need to recompile kmod-ipt-nathelper-rtsp.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p184201">
				<div class="post-metadata">
					<div class="post-num">Post #305</div>
					<div class="post-author">Etique</div>
					<div class="post-datetime">
						24 Nov 2012, 20:29					</div>
				</div>
				<div class="post-content content">
					<p>Installing kmod-ipt-nathelper-rtsp (3.3.8+1.45-1) to root...<br/>Downloading <a href="http://downloads.openwrt.org/snapshots/trunk/ar71xx/packages/kmod-ipt-nathelper-rtsp_3.3.8+1.45-1_ar71xx.ipk.">http://downloads.openwrt.org/snapshots/ … r71xx.ipk.</a><br/>Collected errors:<br/> * satisfy_dependencies_for: Cannot satisfy the following dependencies for kmod-ipt-nathelper-rtsp:<br/> * &nbsp; &nbsp; kernel (= 3.3.8-1-231112e548aba152810eababd16134bc) * <br/> * opkg_install_cmd: Cannot install package kmod-ipt-nathelper-rtsp.</p><br/><p>I&#039;m not sure why I can&#039;t install, as you&#039;re using the trunk kernel. Is the kernel hash linked to the SVN version? (I&#039;m on r34280)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p184202">
				<div class="post-metadata">
					<div class="post-num">Post #306</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						24 Nov 2012, 20:59					</div>
				</div>
				<div class="post-content content">
					<p>Search for opkg --force.</p><p>It is even tighter, as it practically requires kmod to be compiled along the kernel</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p184225">
				<div class="post-metadata">
					<div class="post-num">Post #307</div>
					<div class="post-author">phuque99</div>
					<div class="post-datetime">
						25 Nov 2012, 05:11					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>hnyman wrote:</cite><blockquote><p>- Trunk 33311: gcc compiler: code optimization for 24kc processors (instead of the general mips32r2)</p></blockquote></div><p>Did you add this manually by editing the .config file? I noticed that if you run &quot;make menuconfig&quot;, the gcc optimization goes back to the default mips32r2. Do you know how to make them stick in the config file?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p184242">
				<div class="post-metadata">
					<div class="post-num">Post #308</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						25 Nov 2012, 10:56					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>phuque99 wrote:</cite><blockquote><div class="quotebox"><cite>hnyman wrote:</cite><blockquote><p>- Trunk 33311: gcc compiler: code optimization for 24kc processors (instead of the general mips32r2)</p></blockquote></div><p>Did you add this manually by editing the .config file? I noticed that if you run &quot;make menuconfig&quot;, the gcc optimization goes back to the default mips32r2. Do you know how to make them stick in the config file?</p></blockquote></div><p>I first added that optimization in menuconfig and then copied the three changed lines to my .config recipe. Look at the source code diffs.</p><div class="codebox"><pre><code>CONFIG_DEVEL=y
CONFIG_TARGET_OPTIONS=y
CONFIG_TARGET_OPTIMIZATION=&quot;-Os -pipe -march=24kc -mtune=24kc -fno-caller-saves&quot;</code></pre></div><p>You can do the same in menuconfig:<br/>Advanced configuration options (for developers) --&gt; Target Options --&gt; Target Optimizations</p><p>If you want to use exactly same build options, you can get my .config.init from here:<br/><a href="http://koti.welho.com/hnyman1/Openwrt/trunk-r34318-2012-11-24/">http://koti.welho.com/hnyman1/Openwrt/trunk-r34318-2012-11-24/</a></p><p>Copy this file as your .config, run &quot;make defconfig&quot; and you will have the exactly same .config as I and you can use menuconfig to add kmods: <a href="http://koti.welho.com/hnyman1/Openwrt/trunk-r34318-2012-11-24/WNDR3700-trunk-r34318-2012-11-24-1209.config.init">http://koti.welho.com/hnyman1/Openwrt/t … onfig.init</a></p><p>All my build scripts are in <a href="http://koti.welho.com/hnyman1/Openwrt/trunk-r34318-2012-11-24/WNDR3700-trunk-r34318-2012-11-24-1209-buildscripts.txt">http://koti.welho.com/hnyman1/Openwrt/t … cripts.txt</a></p>											<p class="post-edited">(Last edited by <strong>hnyman</strong> on 25 Nov 2012, 11:10)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p184257">
				<div class="post-metadata">
					<div class="post-num">Post #309</div>
					<div class="post-author">phuque99</div>
					<div class="post-datetime">
						25 Nov 2012, 15:37					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>hnyman wrote:</cite><blockquote><div class="codebox"><pre><code>CONFIG_DEVEL=y
CONFIG_TARGET_OPTIONS=y
CONFIG_TARGET_OPTIMIZATION=&quot;-Os -pipe -march=24kc -mtune=24kc -fno-caller-saves&quot;</code></pre></div><p>You can do the same in menuconfig:<br/>Advanced configuration options (for developers) --&gt; Target Options --&gt; Target Optimizations</p><p>If you want to use exactly same build options, you can get my .config.init from here:<br/><a href="http://koti.welho.com/hnyman1/Openwrt/trunk-r34318-2012-11-24/">http://koti.welho.com/hnyman1/Openwrt/trunk-r34318-2012-11-24/</a></p><p>Copy this file as your .config, run &quot;make defconfig&quot; and you will have the exactly same .config as I and you can use menuconfig to add kmods: <a href="http://koti.welho.com/hnyman1/Openwrt/trunk-r34318-2012-11-24/WNDR3700-trunk-r34318-2012-11-24-1209.config.init">http://koti.welho.com/hnyman1/Openwrt/t … onfig.init</a></p><p>All my build scripts are in <a href="http://koti.welho.com/hnyman1/Openwrt/trunk-r34318-2012-11-24/WNDR3700-trunk-r34318-2012-11-24-1209-buildscripts.txt">http://koti.welho.com/hnyman1/Openwrt/t … cripts.txt</a></p></blockquote></div><p>Thanks hnyman. Are these target optimization inherited and used for the kernel compile? Or do I also have to manually modify &quot;target/linux/ar71xx/Makefile&quot; to add these optimization flags for the Linux kernel?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p184269">
				<div class="post-metadata">
					<div class="post-num">Post #310</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						25 Nov 2012, 17:06					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>phuque99 wrote:</cite><blockquote><div class="quotebox"><cite>hnyman wrote:</cite><blockquote><div class="codebox"><pre><code>CONFIG_DEVEL=y
CONFIG_TARGET_OPTIONS=y
CONFIG_TARGET_OPTIMIZATION=&quot;-Os -pipe -march=24kc -mtune=24kc -fno-caller-saves&quot;</code></pre></div><p>You can do the same in menuconfig:<br/>Advanced configuration options (for developers) --&gt; Target Options --&gt; Target Optimizations</p></blockquote></div><p>Are these target optimization inherited and used for the kernel compile? Or do I also have to manually modify &quot;target/linux/ar71xx/Makefile&quot; to add these optimization flags for the Linux kernel?</p></blockquote></div><p>They are used for all target compilation, both kernel and packages.<br/>It overrides the default provided by &quot;target/linux/ar71xx/Makefile&quot;.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p184424">
				<div class="post-metadata">
					<div class="post-num">Post #311</div>
					<div class="post-author">phuque99</div>
					<div class="post-datetime">
						27 Nov 2012, 06:03					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>hnyman wrote:</cite><blockquote><p>It overrides the default provided by &quot;target/linux/ar71xx/Makefile&quot;.</p></blockquote></div><p>I&#039;m not sure if I missed anything else. I have the optimization flag set for &quot;24kc&quot;. I noticed on the verbose output during compilation, various packages were compiled with the 24kc flag. </p><p>However during kernel compilation phase, I checked the ps output and saw that it was using the default &quot;-march=mips32r2&quot; optimization. I wonder if I missed anything.</p><div class="codebox"><pre><code>openuser    30047  0.0  0.0   4636   636 pts/2    S+   11:57   0:00 mips-openwrt-linux-uclibc-gcc -Wp,-MD,net/ipv4/netfilter/.ip_tables.o.d -nostdinc -isystem /home/openuser/trunk/staging_dir/toolchain-mips_gcc-4.6-linaro_uClibc-0.9.33.2/lib/gcc/mips-openwrt-linux-uclibc/4.6.4/include -I/home/openuser/trunk/build_dir/linux-ar71xx_generic_uClibc-0.9.33.2/linux-3.6.7/arch/mips/include -Iarch/mips/include/generated -Iinclude -include /home/openuser/trunk/build_dir/linux-ar71xx_generic_uClibc-0.9.33.2/linux-3.6.7/include/linux/kconfig.h -D__KERNEL__ -DVMLINUX_LOAD_ADDRESS=0xffffffff80060000 -DDATAOFFSET=0 -Wall -Wundef -Wstrict-prototypes -Wno-trigraphs -fno-strict-aliasing -fno-common -Werror-implicit-function-declaration -Wno-format-security -fno-delete-null-pointer-checks -Os -fno-caller-saves -mno-check-zero-division -mabi=32 -G 0 -mno-abicalls -fno-pic -pipe -msoft-float -ffreestanding -march=mips32r2 -Wa,-mips32r2 -Wa,--trap -I/home/openuser/trunk/build_dir/linux-ar71xx_generic_uClibc-0.9.33.2/linux-3.6.7/arch/mips/include/asm/mach-ath79 -I/home/openuser/trunk/build_dir/linux-ar71xx_generic_uClibc-0.9.33.2/linux-3.6.7/arch/mips/include/asm/mach-generic -Wframe-larger-than=1024 -fno-stack-protector -Wno-unused-but-set-variable -fomit-frame-pointer -Wdeclaration-after-statement -Wno-pointer-sign -fno-strict-overflow -fconserve-stack -DCC_HAVE_ASM_GOTO -DMODULE -mno-long-calls -DKBUILD_STR(s)=#s -DKBUILD_BASENAME=KBUILD_STR(ip_tables) -DKBUILD_MODNAME=KBUILD_STR(ip_tables) -c -o net/ipv4/netfilter/ip_tables.o net/ipv4/netfilter/ip_tables.c</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p184433">
				<div class="post-metadata">
					<div class="post-num">Post #312</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						27 Nov 2012, 08:37					</div>
				</div>
				<div class="post-content content">
					<p>Looks like at least that module usea totally different compilation options, which might be hardcoded to it, or something like that. I will check my own build logs.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p184489">
				<div class="post-metadata">
					<div class="post-num">Post #313</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						27 Nov 2012, 21:03					</div>
				</div>
				<div class="post-content content">
					<p>I ran &quot;make clean&quot; for my trunk build with normal kernel 3.3.8 and then a normal make with V=s to create a detailed build log.</p><p>The build log contained 32505 lines, of which 4637 contained the &quot;-march&quot; option.<br/>Of these, 4631 lines had &quot;24kc&quot; and only 6 lines had &quot;mips32r2&quot;.<br/>So, it looks like you have managed to spot one of the few exceptions belonging to that 0.1%.</p><p>(I didn&#039;t do that for the 3.6.7 kernel that you used, but I see no reason why it should change there.)</p>											<p class="post-edited">(Last edited by <strong>hnyman</strong> on 27 Nov 2012, 21:23)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p184516">
				<div class="post-metadata">
					<div class="post-num">Post #314</div>
					<div class="post-author">phuque99</div>
					<div class="post-datetime">
						28 Nov 2012, 03:17					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>hnyman wrote:</cite><blockquote><p>Of these, 4631 lines had &quot;24kc&quot; and only 6 lines had &quot;mips32r2&quot;.<br/>So, it looks like you have managed to spot one of the few exceptions belonging to that 0.1%.</p></blockquote></div><p>Thanks for reviewing. I should do a bit more logging to spot these myself. I was afraid that the entire kernel build was hard-coded to use mips32r2.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p184671">
				<div class="post-metadata">
					<div class="post-num">Post #315</div>
					<div class="post-author">98i4rtg</div>
					<div class="post-datetime">
						29 Nov 2012, 16:34					</div>
				</div>
				<div class="post-content content">
					<p>Am also interested in installing openvpn, and appologize for not understanding the previous discussion - (newbie).</p><p>FWICT, either openvpn can be successfully installed from the snapshot repository, or it can be successfully installed after a modification to kmod-ipt-nathelper-rtsp!?</p><p>If the modification needs to be made, could/would you please include that change in future hnyman releases?</p><p>TIA</p><p>(and thanks for a reliable package that I&#039;ve been using since its inception)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p184702">
				<div class="post-metadata">
					<div class="post-num">Post #316</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						29 Nov 2012, 23:28					</div>
				</div>
				<div class="post-content content">
					<p>- r34423: kernel 3.6.8, new &quot;ipv6-support&quot; module, kmod-fs-cifs included</p><p>The default kernel for ar71xx target was bumped from 3.3.8 to 3.6.8 today. I had already earlier tried 3.6.7 and did not have any problems with it, so I do not expect 3.6.8 to cause any havoc.</p><p>Later today r34417-34423 introduced a bunch of ipv6 related changes, which are now included by the new &quot;ipv6-support&quot; metapackage. Apparently the developers&#039; goal is to provide rudimentary ipv6 support at one strike. Those changes are included in my build and did not break my own 6in4 tunnel, but radvd seems to give some warnings. You might need to check your config after this build. (Some of the new functionality is by default commented off in the new config files.) So far I have not seen any discussion or documentation for the new packages introduced.</p><p>Additionally, I added the kmod-fs-cifs in the build, providing support for cifs/samba client functionality, so that I can mount the shares from my Linkstation NAS if I want.</p><div class="quotebox"><cite>98i4rtg wrote:</cite><blockquote><p>Am also interested in installing openvpn, and appologize for not understanding the previous discussion - (newbie).</p><p>FWICT, either openvpn can be successfully installed from the snapshot repository, or it can be successfully installed after a modification to kmod-ipt-nathelper-rtsp!?</p></blockquote></div><p>You should probably be able to install openvpn from the snapshot repository (after the next build with kernel 3.6.8 has been completed, see <a href="http://buildbot.openwrt.org/builders/ar71xx/builds/99),">http://buildbot.openwrt.org/builders/ar71xx/builds/99),</a> but I can&#039;t guarantee that. And I have no idea, for which purpose the kmod-ipt-nathelper-rtsp would be used...</p>											<p class="post-edited">(Last edited by <strong>hnyman</strong> on 29 Nov 2012, 23:57)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p184793">
				<div class="post-metadata">
					<div class="post-num">Post #317</div>
					<div class="post-author">CyrusFF</div>
					<div class="post-datetime">
						30 Nov 2012, 16:28					</div>
				</div>
				<div class="post-content content">
					<p>Sorry for being a bit quiet about yesterday&#039;s IPv6 changes.</p><p>I already added a wiki-page which explains all the configuration variables here <a href="http://wiki.openwrt.org/doc/uci/network6">http://wiki.openwrt.org/doc/uci/network6</a><br/>There are no LuCI pages yet, but new things will come in the following weeks.</p><p>Just a few quick tips:<br/>There is no need for radvd and or a separate DHCPv6-server or client anymore. ipv6-support pulls in the relevant packages<br/>and configures them automatically using the settings given in /etc/config/network6.</p><p>If you have a native IPv6 connection (e.g. your ISP has a DHCPv6 with prefix delegation) you don&#039;t need to do anything. <br/>The default settings will ensure that you will receive the prefix information via DHCPv6 and the logic will automatically split up the prefixes for all downstream interfaces and assign them to them. Our RD-server will notice the new prefixes and automatically announce them.</p><p>If you have a native IPv6 connection but the upstream router doesn&#039;t support prefix delegation wan and lan are automatically put in relay mode (when not otherwise configured) meaning RD-, DHCPv6 and NDP are proxied so that both interfaces operate in the same /64.</p><p>If you have a 6in4 tunnel or an otherwise static configuration use mode=static on the relevant interface and just put your global /48 or /56 in static_prefix and it will be split up and distributed onto the downstream interfaces (lan etc.) as well.</p><p>For now I integrated a few newly developed tools for RD &amp; DHCPv6-service which are very small in size (compared to e.g. radvd, wide-dhcpv6, etc.). Support for alternative RD / DHCPv6-servers (like dnsmasq-dhcpv6) might follow later. If you have any feedback please let us know.</p><p>PS: Ah yes, and keep up the good work, please ;-)</p>											<p class="post-edited">(Last edited by <strong>CyrusFF</strong> on 30 Nov 2012, 17:01)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p184799">
				<div class="post-metadata">
					<div class="post-num">Post #318</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						30 Nov 2012, 17:31					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>CyrusFF wrote:</cite><blockquote><p>Sorry for being a bit quiet about yesterday&#039;s IPv6 changes.</p><p>I already added a wiki-page which explains all the configuration variables here <a href="http://wiki.openwrt.org/doc/uci/network6">http://wiki.openwrt.org/doc/uci/network6</a><br/>...<br/>If you have a 6in4 tunnel or an otherwise static configuration use mode=static on the relevant interface and just put your global /48 or /56 in static_prefix and it will be split up and distributed onto the downstream interfaces (lan etc.) as well.</p><p>For now I integrated a few newly developed tools for RD &amp; DHCPv6-service which are very small in size (compared to e.g. radvd, wide-dhcpv6, etc.). Support for alternative RD / DHCPv6-servers (like dnsmasq-dhcpv6) might follow later. If you have any feedback please let us know.</p></blockquote></div><p>Thanks for info. I will have to analyse that and possibly change the contents of my build.</p><p>My build already included the dnsmasq-dhcpv6 variant in addition to radvd, and that worked ok as a radvd replacement, if so required. I also added some uci config support in dnsmasq for ipv6, see <a href="https://forum.openwrt.org/viewtopic.php?pid=175200#p175200">https://forum.openwrt.org/viewtopic.php?pid=175200#p175200</a> ). If the developers&#039; intention is to go forward with the new packages in the ipv6-support package, I will probably drop both dnsmasq-dhcpv6 and radvd.</p><p>The advantage with radvd has been its automatic sniffing of the correct /64. I have 3 different ipv6 tunnels, so I have experimented with various configs. I have left /64 definition empty in the radvd config and have just set the LAN interface&#039;s static address. Radvd has then used that address to determine the correct /64. At the first glance, your current config requires the user to set /64 for a (static) 6in4 tunnel. It would be great if the package would use LAN&#039;s address as the base for a /64 if no address has been defined with a &quot;static_prefix&quot; option.</p><p>It is great that there is finally some work with the &quot;out-of-the-box ipv6&quot; functionality. Hopefully ipv6 gets more mainstream. So far it has been left for enthusiasts to a large extent.</p><p>EDIT:<br/>After disabling radvd I was able to get my 6in4 tunnel to work by setting option &#039;request_prefix&#039; to &#039;no&#039; for wan and setting the correct /64 prefix with &#039;static_prefix&#039; option after also renaming the section according to the tunnel interface&#039;s name.</p><p>It would greatly improve your wiki documentation, if you would include clear examples of those three cases you described for me.</p>											<p class="post-edited">(Last edited by <strong>hnyman</strong> on 30 Nov 2012, 17:55)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p184802">
				<div class="post-metadata">
					<div class="post-num">Post #319</div>
					<div class="post-author">CyrusFF</div>
					<div class="post-datetime">
						30 Nov 2012, 17:59					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>hnyman wrote:</cite><blockquote><p>The advantage with radvd has been its automatic sniffing of the correct /64.</p></blockquote></div><p>Yes, the new small RD-server (6relayd) does exactly the same. It detects all addresses assigned to an interface that have a prefix &lt;= 64 and announces them via RD messages. It also remembers the prefixes it announced last time and deprecates prefixes that were removed (announces them with preferred time=0 and a very low valid time). It also does stateless DHCPv6 to announce the DNS.</p><p>The whole configuration mess is exactly the problem that is preventing me from integration dnsmasq-dhcpv6 right now: It might work when you have static prefixes through a tunnel or so, but when prefixes change e.g. on a DSL line and are dynamiccaly acquired you end up having a mess and to constantly reconfigure, check and restart the daemon. Once we can get a suitable solution for this, we might think about integtration dnsmasq-dhcpv6 as an alternative, mainly because it supports stateful DHCPv6 as well which the 6relayd-server does not,&nbsp; but we will se what the time brings.</p><div class="quotebox"><cite>hnyman wrote:</cite><blockquote><p>At the first glance, your current config requires the user to set /64 for a (static) 6in4 tunnel. It would be great if the package would use LAN&#039;s address as the base for a /64 if no address has been defined with a &quot;static_prefix&quot; option.</p></blockquote></div><p>Hmm this might be a misunderstanding. The idea of the new IPv6-stuff is that you don&#039;t have to manually assign interfaces on the lan-side anymore. This will be done automatically. If you want to do 6in4 with it, I&#039;d suggest the following (thouhg I haven&#039;t tested it with 6in4 yet, but it should work).</p><p>When using the 6in4-proto in network e.g.<br/></p><div class="codebox"><pre><code>config interface henet
    option proto    6in4
    ...</code></pre></div><p>leave this as is and just add a section to network6:<br/></p><div class="codebox"><pre><code>config interface henet
        option mode static
        list static_prefix &#039;2001:DB8::/48&#039;</code></pre></div><p>where 2001:DB8::/48 is your routed-prefix (either /48 or /64 etc.).</p><p>Once the tunnel comes up (and if the hotplug-scripts are working correctly, haha) a daemon will assign a part of the static_prefix (e.g. a /64) to lan automatically. If you have more than one downstream interface (e.g. another unbridged wifi or so) this will get another /64 from the static prefix (if the static prefix is big enough).</p><p>On the downstream interfaces (lan &amp; friends), you only hint on how big your assigned prefix should be, e.g. by setting advertise_prefix to &#039;64&#039; to get a /64 subprefix. The address distribution daemon will take care of the rest so you only need to <br/>set your routed prefix once.</p><p>This also works when you have multiple 6in4 or uplinks. Then the lan interface will get one /64 from each tunnel prefix.<br/>Again this is less important for static configuration but is more important for dynamically acquired prefix coming from DHCPv6.</p><br/><br/><div class="quotebox"><cite>hnyman wrote:</cite><blockquote><p>It is great that there is finally some work with the &quot;out-of-the-box ipv6&quot; functionality. Hopefully ipv6 gets more mainstream. So far it has been left for enthusiasts to a large extent.</p></blockquote></div><p>Yeah the problem is that the current Linux tools for this are not very suitable for routers. Either they were too big or the configuration is too static etc. etc. This mainly meant, rewriting most of the tools from scratch.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p184806">
				<div class="post-metadata">
					<div class="post-num">Post #320</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						30 Nov 2012, 18:24					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>CyrusFF wrote:</cite><blockquote><p>Hmm this might be a misunderstanding. The idea of the new IPv6-stuff is that you don&#039;t have to manually assign interfaces on the lan-side anymore. This will be done automatically. If you want to do 6in4 with it, I&#039;d suggest the following (thouhg I haven&#039;t tested it with 6in4 yet, but it should work).</p><p>When using the 6in4-proto in network e.g.<br/></p><div class="codebox"><pre><code>config interface henet
    option proto    6in4
    ...</code></pre></div><p>leave this as is and just add a section to network6:<br/></p><div class="codebox"><pre><code>config interface henet
        option mode static
        list static_prefix &#039;2001:DB8::/48&#039;</code></pre></div><p>where 2001:DB8::/48 is your routed-prefix (either /48 or /64 etc.).</p><p>Once the tunnel comes up (and if the hotplug-scripts are working correctly, haha) a daemon will assign a part of the static_prefix (e.g. a /64) to lan automatically.</p></blockquote></div><p>Does not work for me.<br/>I left the router&#039;s lan interface&#039;s ip6addr unset by commenting it out and now there is no ipv6 connectivity any more. No ipv6 address is shown for the router, neither in Luci nor with ifconfig. (I can can still ping ipv6.google.com from router console, as the 6in4 tunnel still works normally.)</p><p>To be exact, with a SixXS (static) tunnel, there is the &quot;tunnel /64&quot; that is used just by the tunnel endpoints and is set manually. Then there is the &quot;routed /48&quot; or /64 which has a separate prefix. I have used to set an address belonging to that prefix for the router&#039;s LAN interface with ip6addr option. If I now leave that empty/commented, router&#039;s LAN does not get assigned an ipv6 address despite the prefix being given in the static_prefix.</p><p>Relevant sections from the config files:<br/></p><div class="codebox"><pre><code>config &#039;interface&#039; &#039;lan&#039;
        option &#039;ifname&#039; &#039;eth0.1&#039;
        option &#039;type&#039; &#039;bridge&#039;
        option &#039;proto&#039; &#039;static&#039;
        option &#039;ipaddr&#039; &#039;192.168.1.1&#039;
        option &#039;netmask&#039; &#039;255.255.255.0&#039;
#       option &#039;ip6addr&#039; &#039;2001:14DD:DDDD:ABCD::1/64&#039;

config &#039;interface&#039; &#039;sixxs&#039;
        option &#039;proto&#039; &#039;6in4&#039;
        option &#039;peeraddr&#039; &#039;62.78.96.38&#039;
        option &#039;ip6addr&#039; &#039;2001:14DD:B00:25b::2/64&#039;

...
network6:
config interface &#039;sixxs&#039;
        option mode &#039;static&#039;
        list static_prefix &#039;2001:14DD:DDDD:ABCD::/64&#039;</code></pre></div>											<p class="post-edited">(Last edited by <strong>hnyman</strong> on 30 Nov 2012, 18:29)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p184807">
				<div class="post-metadata">
					<div class="post-num">Post #321</div>
					<div class="post-author">CyrusFF</div>
					<div class="post-datetime">
						30 Nov 2012, 18:38					</div>
				</div>
				<div class="post-content content">
					<p>Hmm did you also add a section for lan to network6?<br/>If not please try something like this in addition to the section you already have in network6.<br/></p><div class="codebox"><pre><code>config interface &#039;lan&#039;
        option mode &#039;downstream&#039;
        option advertise_prefix &#039;64&#039;</code></pre></div><br/><p>I just tested it with a static prefix on a regular ethernet interface<br/></p><div class="codebox"><pre><code>config interface &#039;wan&#039;
        option mode &#039;static&#039;
        list static_prefix &#039;2001:DB8::/64&#039;</code></pre></div><p>and it worked, so it can be that the logic doesn&#039;t work for 6in4 interfaces yet. I will try to investigate and get back to you if I can find something.</p>											<p class="post-edited">(Last edited by <strong>CyrusFF</strong> on 30 Nov 2012, 18:39)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p184808">
				<div class="post-metadata">
					<div class="post-num">Post #322</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						30 Nov 2012, 18:43					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>CyrusFF wrote:</cite><blockquote><p>Hmm did you also add a section for lan to network6?<br/>If not please try something like this in addition to the section you already have in network6.<br/></p><div class="codebox"><pre><code>config interface &#039;lan&#039;
        option mode &#039;downstream&#039;
        option advertise_prefix &#039;64&#039;</code></pre></div></blockquote></div><p>Yes, my /etc/config/network6 is:<br/></p><div class="codebox"><pre><code>root@OpenWrt:~# cat /etc/config/network6

config interface &#039;wan&#039;
        option mode &#039;upstream&#039;
        option request_prefix &#039;no&#039;
        option prefix_fallback &#039;relay&#039;
        option peerdns &#039;1&#039;
        option ula_prefix &#039;fdf3:f5b3:987e::/48&#039;

config interface &#039;lan&#039;
        option mode &#039;downstream&#039;
        option advertise_prefix &#039;64&#039;
        option relay_master &#039;wan&#039;

config interface &#039;sixxs&#039;
        option mode &#039;static&#039;
        list static_prefix &#039;2001:14DD:DDDD:ABCD::/64&#039;</code></pre></div><p>Just thinking, if the reason might be the &quot;relay-master&quot; field? Shoud it be &quot;sixxs&quot; as that gives the prefix? EDIT: no, did not help.</p>											<p class="post-edited">(Last edited by <strong>hnyman</strong> on 30 Nov 2012, 18:48)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p184813">
				<div class="post-metadata">
					<div class="post-num">Post #323</div>
					<div class="post-author">CyrusFF</div>
					<div class="post-datetime">
						30 Nov 2012, 18:57					</div>
				</div>
				<div class="post-content content">
					<p>No thats not the reason. It must have been something to do with how the 6in4 notifies the rest of openwrt.<br/>Currently compiling an image but don&#039;t know if I can manage to fix it before Monday. I&#039;ll get back to you with a fix. </p><p>Thanks for testing.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p184814">
				<div class="post-metadata">
					<div class="post-num">Post #324</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						30 Nov 2012, 19:26					</div>
				</div>
				<div class="post-content content">
					<p>Additional info:<br/>Looks like /etc/init.d/network restart is not enough, but reboot is...</p><p>I had earlier tested with just a network restart.</p><p>I compiled a new firmware (with vanilla dnsmasq) and flashed it while preserving settings. After the reboot the router&#039;s LAN interface has now both the manually set ::1 and automatically set addresses:<br/></p><div class="codebox"><pre><code>br-lan    Link encap:Ethernet  HWaddr 76:44:xxx
          inet addr:192.168.1.1  Bcast:192.168.1.255  Mask:255.255.255.0
          inet6 addr: fe80::7444:1ff:fe8d:a3e7/64 Scope:Link
          inet6 addr: 2001:xxxxx:abcd:7444:1ff:fe8d:a3e7/64 Scope:Global
          inet6 addr: 2001:xxxxx:abcd::1/64 Scope:Global</code></pre></div><p>So, it looks like some of the new server processes do not get properly activated/restarted with a /etc/init.d/network restart, but do apply the full config correctly in connection with a reboot.</p><br/><p>EDIT:<br/>I again commented that manual LAN interafce ip6addr and rebooted. Results were interesting:<br/>It works, but instead of having a random address, the router has now ::1 set automagically as the main address. Intentional? Additionally there is now the ULA address fd...<br/></p><div class="codebox"><pre><code>          inet6 addr: fdf3:f5b3:987e::1/64 Scope:Global
          inet6 addr: fe80::7444:1ff:fe8d:a3e7/64 Scope:Link
          inet6 addr: 2001:xxxxx:abcd::1/64 Scope:Global</code></pre></div><p>That is also properly reflected at my PC, where the ipv6 address for the DNS server has changed correspondingly. <br/></p><div class="codebox"><pre><code>before:
DNS Servers . . . . . . . . . . . : 2001:xxxxx:abcd:7444:1ff:fe8d:a3e7
                                    192.168.1.1

after:
 DNS Servers . . . . . . . . . . . : 2001:xxxxx:abcd::1
                                     192.168.1.1</code></pre></div>											<p class="post-edited">(Last edited by <strong>hnyman</strong> on 30 Nov 2012, 19:45)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p184819">
				<div class="post-metadata">
					<div class="post-num">Post #325</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						30 Nov 2012, 20:03					</div>
				</div>
				<div class="post-content content">
					<p>- r34432: revert to vanilla dnsmasq with no dhcpv6 support. This is also probably the last build with radvd included, as similar basic functionality is now offered by the ipv6-support package.</p><p>I will probably remove radvd in the next build, as similar basic functionality is now included in the new ipv6-support package. That change will help to decrease the firmware size by 64 kB, which has impact especially with wndr3700v1.</p><p>If you are using my build and are currently using radvd, please experiment with the new packages and see if your needs are fulfilled with it. Documentation in <a href="http://wiki.openwrt.org/doc/uci/network6">http://wiki.openwrt.org/doc/uci/network6</a> (and also in this thread by Cyrus a few messages back).</p>											<p class="post-edited">(Last edited by <strong>hnyman</strong> on 30 Nov 2012, 20:04)</p>
									</div>
			</article>

			
		
			
		
	
	<div class="pagination"><div class="pagination-number">Page 13 of 63</div><nav><ul><li><a href="viewtopic.php%3Fid=28392&amp;p=1.html">1</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=28392&amp;p=11.html">11</a></li><li><a href="viewtopic.php%3Fid=28392&amp;p=12.html">12</a></li><li class="pagination-current"><span>13</span></li><li><a href="viewtopic.php%3Fid=28392&amp;p=14.html">14</a></li><li><a href="viewtopic.php%3Fid=28392&amp;p=15.html">15</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=28392&amp;p=63.html">63</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0.001 -->

</body>
</html>