<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> give priority to a specific pc in the LAN, with MWAN3 rules</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 5 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p305568">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">bobptz</div>
					<div class="post-datetime">
						30 Dec 2015, 20:46					</div>
				</div>
				<div class="post-content content">
					<p>I want to create a rule (work-rule) that will give top priority to a specific pc (let&#039;s name it work-pc) in the LAN.&nbsp; For this purpose I assigned it a static IP (ie 192.168.1.50).&nbsp; I assigned to this rule (very high in the rules table) with some policies with low metric and high weight values and source address 192.168.1.50.</p><p><span class="postimg"><img src="http://s22.postimg.org/va7d4w7qp/rules2.png" alt="http://s22.postimg.org/va7d4w7qp/rules2.png" /></span></p><p>Is this a correct setup?</p><p>My worry is that all other rules lower will be ignored.&nbsp; Like the HTTPS, if I put this lower, then I will be kicked out from https sites, right?&nbsp; So what is the correct way to do this? </p><p>I could put work-rule lower than the https rule.&nbsp; But I also want my work-pc to have higher precedence over other pcs when visiting https sites.</p><p>So how do I do this?</p><p>PS: I decided to open a new topic for this question I have already asked in the mwan3 thread.&nbsp; I have a feeling it is lost in there.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p305570">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">bobptz</div>
					<div class="post-datetime">
						30 Dec 2015, 21:15					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;ve been told I can easily do this with QOS script.&nbsp; However I have SQM-QoS installed, which does not have this capability (AFAIK).&nbsp; urthermore SQM-QoS and QOS scripts cannot coexist, right?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p305583">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						30 Dec 2015, 22:28					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>bobptz wrote:</cite><blockquote><p>I&#039;ve been told I can easily do this with QOS script.&nbsp; However I have SQM-QoS installed, which does not have this capability (AFAIK).&nbsp; urthermore SQM-QoS and QOS scripts cannot coexist, right?</p></blockquote></div><p>It is true, sqm-scripts does not offer this. I am tempted to include a way of selecting IPs to dedicate for back-ground traffic (as bit-torrent packets can be hard to categorize). I would certainly recommend you go and test whether simple.qos does not already work for you out of the box though. I like your enthusiasm to understand things and set-up the &quot;perfect&quot; qos/mwan system, but with my sqm-scripts head on, I am happy to fix real bugs and shortcomings, but I have my own agenda regarding changes that are not necessitated by bugs (or features as they say, the background priority by IP is one of those, so there might be an intersection between our interestes). So if you can convince me that the current sqm-scripts oe not work sufficiently well as they are now, I am still happy to help you out with information and attempts at elucidating internals of sqm, but this is musher lower priority for me than for you...</p><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p305590">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">bobptz</div>
					<div class="post-datetime">
						30 Dec 2015, 23:17					</div>
				</div>
				<div class="post-content content">
					<p>Hello moeller0</p><p>So from what I understand the feature I want is in the QoS category (and not the multi-wan one).</p><p>A month ago I was unaware of what QoS is.&nbsp; Now that I am starting to learn about this stuff, I think that giving priority to a specific pc in the LAN ( that may belong to the boss, a power user or a very critical department like a stock broker&#039;s orders entry pc) is a must.&nbsp; I am not surprised you are thinking to add this feature.&nbsp; I am surprised it is missing.&nbsp; Maybe I still cannot grasp what QoS is and certainly to me SQM is just a black box that somehow improves my internet connection.</p><div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p> I would certainly recommend you go and test whether simple.qos does not already work for you out of the box though.</p></blockquote></div><p>You mean the form under&nbsp; Network -&gt; SQM QoS -&gt; Queue Discipline -&gt; Queue setup script ?<br />Yes, I already have the default simple.qos there.&nbsp; What can I test?&nbsp; How can this setting possibly know that I want to give priority to a certain pc in the LAN?&nbsp; I am missing something here again, right?</p><div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p>So if you can convince me that the current sqm-scripts oe not work sufficiently well as they are now...</p></blockquote></div><p>You mean testing for bugs?&nbsp; ok, I will report if I find anything.&nbsp; But if you want opinion on the feature set, first I need to understand what SQM is (does) and stop seeing it as a black box.&nbsp; </p><p>PS: I thought you said you are not the SQM developer.&nbsp; How come you fix bugs?</p><br /><p>EDIT:&nbsp; Like SQM advertises on the top of the screen that it does &quot;prioritisation&quot;.&nbsp; What traffic gets priority?&nbsp; How much priority?&nbsp; How do I change priority... etc?</p>											<p class="post-edited">(Last edited by <strong>bobptz</strong> on 30 Dec 2015, 23:28)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p305627">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						31 Dec 2015, 11:06					</div>
				</div>
				<div class="post-content content">
					<p>Hi bobptz,</p><div class="quotebox"><cite>bobptz wrote:</cite><blockquote><p>Hello moeller0</p><p>So from what I understand the feature I want is in the QoS category (and not the multi-wan one).</p><p>A month ago I was unaware of what QoS is.&nbsp; Now that I am starting to learn about this stuff, I think that giving priority to a specific pc in the LAN ( that may belong to the boss, a power user or a very critical department like a stock broker&#039;s orders entry pc) is a must.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; I would not recommend any organization with tight well-defined priority needs to use sqm-scripts at all, they are better off with rolling their own priority system tailored to their needs (sqm-scripts does not aim for perfect but simply for good enough for most use cases, as far as I am concerned). Giving priority to a specific IP address (and I am only thinking about lowering the priority of a given set of IPs to alleviate the problem fq_codel still has with heavy bit-torrent traffic, I am not talking about a&nbsp; higher priority IP address set yet).<br /></p><div class="quotebox"><cite>bobptz wrote:</cite><blockquote><p>I am not surprised you are thinking to add this feature.&nbsp; I am surprised it is missing.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; Note, I would prefer not having to do this at all, it feels like a work-around instead of a proper solution, the fact that heavy bit-torrent can disrupt other traffic in the same network is just unfortunate, and that almost no bit-torrent client allows to change the DSCP/TOS bits of the packets it sends...<br /></p><div class="quotebox"><cite>bobptz wrote:</cite><blockquote><p>Maybe I still cannot grasp what QoS is and certainly to me SQM is just a black box that somehow improves my internet connection.</p><div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p> I would certainly recommend you go and test whether simple.qos does not already work for you out of the box though.</p></blockquote></div><p>You mean the form under&nbsp; Network -&gt; SQM QoS -&gt; Queue Discipline -&gt; Queue setup script ?<br />Yes, I already have the default simple.qos there.&nbsp; What can I test?&nbsp; How can this setting possibly know that I want to give priority to a certain pc in the LAN?&nbsp; I am missing something here again, right?</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; The idea is that you test whether you need special priority for the work_pc at all. Personally I aim at keeping sqm scripts as simple as possible, so any additional feature should be justified by solving real issues. And with real I do not mean issues that one could expect to encounter in the future, but really observed failures of sqm to keep latency under control in a specific real-world situation.<br /></p><div class="quotebox"><cite>bobptz wrote:</cite><blockquote><div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p>So if you can convince me that the current sqm-scripts oe not work sufficiently well as they are now...</p></blockquote></div><p>You mean testing for bugs?&nbsp; ok, I will report if I find anything.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; Thanks, I mean bugs and observable situations were sqm-scipts performs worse than could be expected; with emphasis on observable <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /><br /></p><div class="quotebox"><cite>bobptz wrote:</cite><blockquote><p>But if you want opinion on the feature set, first I need to understand what SQM is (does) and stop seeing it as a black box.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; Wel, to be blunt I (personally) am not taking any feature requests <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /> that is, you can describe them and I will listen, I just do not promise to implement them (or give them priority if I am convinced those features are worthwhile).<br /></p><div class="quotebox"><cite>bobptz wrote:</cite><blockquote><p>PS: I thought you said you are not the SQM developer.&nbsp; How come you fix bugs?</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; Well, Dave Täht created the initial scripts and Toke Høiland-Jørgensen created an openwrt package out of them and refined them, since Dave mostly retreated Toke is THE developer of sqm-scripts. I started to contribute fixes, small changes and feature implementations some time ago, so I would consider myself at best to be a junior co-developer of sqm-scripts, certainly not the developer... <br />&nbsp; &nbsp; &nbsp; &nbsp; But SQM, like most open source projects, takes bug reports and bug fixes not only from core developers but from anybody offering them. So you can also become part of the sqm-scripts development team; either by offering patches that fix real bugs/short-comings or be offering implentations of new features (for those you will need to convince mainly Toke that they are an actual improvement and worth their complexity, so offering something is no guarantee of getting it in).<br /></p><div class="quotebox"><cite>bobptz wrote:</cite><blockquote><p>EDIT:&nbsp; Like SQM advertises on the top of the screen that it does &quot;prioritisation&quot;.&nbsp; What traffic gets priority?&nbsp; How much priority?&nbsp; How do I change priority... etc?</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp;Have a look at the contents of /usr/lib/sqm/simple.qos&nbsp; and /usr/lib/sqm/functions.sh they should explain a lot. Basically the priority is selected based on the DSCP markings of the packets. Ideally you do not need to change the priority in the scripts at all, but rather you teach your applications to set the correct DSCP marks. <br />&nbsp; &nbsp; &nbsp; &nbsp; But really just go and test whether sqm-scripts out of the box does not already solve your traffic control issues. You seem dedicated to change sqm-scripts to follow your pre-conceptions about how traffic shaping should work; which is fine as that is how you learn new things. <br />&nbsp; &nbsp; &nbsp; &nbsp; But if you want to go that route, please take at least a few days/weeks time to get a feel how sqm-scripts baseline behavior works. Only if you have measurements of the status-quo, you will be able to figure out if your changes improve things or not. Also, I believe, you have come close to the end of things you can learn by simply of shell scripts so they should be reasonably simple to read and understand/modify)</p><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p305676">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">bobptz</div>
					<div class="post-datetime">
						31 Dec 2015, 18:34					</div>
				</div>
				<div class="post-content content">
					<p>Ah! I wrote you a detailed answer only to loose everything when I tried to post it.&nbsp; My dual wan, double IP problem I guess.</p><p>So here is a the summary.</p><p>I googled again and I still do not know what DSCP is, let alone to try to teach my applications how to change the DSCP marks.&nbsp; No idea how to do this, never heard of it.&nbsp; If this is required for SQM, then please, put a guide in the manual.</p><p>The way SQM works, a “good enough result” is really very interesting and maybe perfect for SOHO.&nbsp; I have a SOHO and I may just leave it as it is.&nbsp; However, suppose my work-pc has an important skype session and my wife talks to her mother, at another skype session on the laptop.&nbsp; How will SQM give priority to the work-pc, in case bandwidth is limited?&nbsp; Don&#039;t you see the need for manual configuration, for more traditional QoS rules?&nbsp; </p><p>So the way I will use it is refrain from heavy use of the rest of the network while the work-pc is doing something important.&nbsp; This will work, but it does not sound an impressive QoS to me.</p><p>You are right, I first need to test how the system performs and if it has a problem, then trouble shoot it.&nbsp; </p><p>I did look at the source code you told me.&nbsp; You reminded me the days I was a trainee, I could read at long printouts of source code and then embarrass the senior programmers by pointing out their bugs.&nbsp; I cannot do this any more.&nbsp; Even if I could understand what each statement did, my complete lack of DSCP knowledge would still prevent me from understanding the logic.</p><p>Thank you for you interest and effort to educate me.&nbsp; I hope I am not wasting your time for nothing.</p><br /><br /><p><strong>Regarding my original question</strong>.&nbsp; I wish someone can verify for me that MWAN3 cannot do what I want, so I can look for other ways.</p>											<p class="post-edited">(Last edited by <strong>bobptz</strong> on 31 Dec 2015, 18:38)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p305704">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						31 Dec 2015, 21:30					</div>
				</div>
				<div class="post-content content">
					<p>Hi bobptz,</p><div class="quotebox"><cite>bobptz wrote:</cite><blockquote><p>Ah! I wrote you a detailed answer only to loose everything when I tried to post it.&nbsp; My dual wan, double IP problem I guess.</p><p>So here is a the summary.</p><p>I googled again and I still do not know what DSCP is, let alone to try to teach my applications how to change the DSCP marks.&nbsp; No idea how to do this, never heard of it.&nbsp; If this is required for SQM, then please, put a guide in the manual.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; Have a look at <a href="http://lmgtfy.com/?q=DSCP">http://lmgtfy.com/?q=DSCP</a> <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /> (the second link is especially interesting) and <a href="https://tools.ietf.org/html/rfc2475">https://tools.ietf.org/html/rfc2475</a> these should cover some ground on DSCP in general. Is this required for SQM? No, but if you want to use the different priority tiers that simple.qos offers you will need to look at it, but SQM will work just fie with everything at the default DSCP value of zero. And let me ask with some snark, which manual?<br /></p><div class="quotebox"><cite>bobptz wrote:</cite><blockquote><p>The way SQM works, a “good enough result” is really very interesting and maybe perfect for SOHO.&nbsp; I have a SOHO and I may just leave it as it is.&nbsp; However, suppose my work-pc has an important skype session and my wife talks to her mother, at another skype session on the laptop.&nbsp; How will SQM give priority to the work-pc, in case bandwidth is limited?&nbsp; Don&#039;t you see the need for manual configuration, for more traditional QoS rules?</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; Well, if your bandwidth is not sufficient to have two concurrent Skype sessions then don&#039;t do that then? BTW, you can always use qos-scripts instead of sqm-scripts if you absolutely want to (micro-)manage individual priority levels... (sqm-scripts has advantages in that it works out of the box for IPv6 which qos-scripts as of 3 years ago did to (last time I looked), and sqm offers link layer overhead accounting that actually works, but it does not expose the kind of knobs that you seem to want so qos-scripts might be the right solution for you).<br /></p><div class="quotebox"><cite>bobptz wrote:</cite><blockquote><p>So the way I will use it is refrain from heavy use of the rest of the network while the work-pc is doing something important.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; Why not test how heavy use of the rest of the network affects work_pc&#039;s ability to do what you intend it to do first? That way you might collect data that shows that sqm scripts has short-commings that should be fixed...<br /></p><div class="quotebox"><cite>bobptz wrote:</cite><blockquote><p>This will work, but it does not sound an impressive QoS to me.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; I am sorry to hear that, but want to note for posterity that I did to start helping out with sqm-scripts to either impress you personally or to create an impressive qos system, so no hard feelings.<br /></p><div class="quotebox"><cite>bobptz wrote:</cite><blockquote><p>You are right, I first need to test how the system performs and if it has a problem, then trouble shoot it.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; That is the right spirit <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /><br /></p><div class="quotebox"><cite>bobptz wrote:</cite><blockquote><p>I did look at the source code you told me.&nbsp; You reminded me the days I was a trainee, I could read at long printouts of source code and then embarrass the senior programmers by pointing out their bugs.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; Oh, this is not about embarrassing anybody, if sqm scripts has a bug (and I am certain there are multiple) it needs fixing, so I will (grumpily <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /> ) commend you when you report bugs or even send bug fixes.<br /></p><div class="quotebox"><cite>bobptz wrote:</cite><blockquote><p>I cannot do this any more.&nbsp; Even if I could understand what each statement did, my complete lack of DSCP knowledge would still prevent me from understanding the logic.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; The good thing is that nowadays with the internet one can do this kind of research about computer and network related issues from the comfort of one&#039;s own desk/home, no need for tedious research trips to the local library <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /><br /></p><div class="quotebox"><cite>bobptz wrote:</cite><blockquote><p>Thank you for you interest and effort to educate me.&nbsp; I hope I am not wasting your time for nothing.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;While I might not fully agree with all your assessments, I am always interested toi learn about bugs and possible improvements for sqm-scripts so there is something in our discussion for me as well. (The more real-world testing data the better for me <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /> )<br /></p><div class="quotebox"><cite>bobptz wrote:</cite><blockquote><br /><p><strong>Regarding my original question</strong>.&nbsp; I wish someone can verify for me that MWAN3 cannot do what I want, so I can look for other ways.</p></blockquote></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p305726">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">bobptz</div>
					<div class="post-datetime">
						1 Jan 2016, 02:39					</div>
				</div>
				<div class="post-content content">
					<p>From all the reading and searching I did about DSCP, I understood that the network packets are marked by compatible routers/switches with those DSCP marks, so that QoS can be applied to them. As for the criteria, I won;t go deep right now.&nbsp; I am sure there are shortcomings, like skype and torrents (like you said).</p><p>You mentioned twice about teaching my applications to use the correct DSCP markings.&nbsp; How do I do this?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p305746">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">bobptz</div>
					<div class="post-datetime">
						1 Jan 2016, 09:55					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p> Well, if your bandwidth is not sufficient to have two concurrent Skype sessions then don&#039;t do that then?</p></blockquote></div><p>Maybe my wife or my children do not understand this even if I tell them 100 times.&nbsp; Maybe the line is loaded already by other stuff.&nbsp; Maybe the line can handle couple of skype sessions if they are geographically close, but has problem if they are from another continent.&nbsp; Maybe the ADSL line has fluctuations and some times it has reduced bandwidth (my ADSL does).&nbsp; </p><p>Why do you want to take care of torrents when everybody knows it is a hog for bandwidth and people should schedule them during off hours?</p><p>Because we are perfectionists and we strive for automation and excellence in the products we make.&nbsp; </p><div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p>And let me ask with some snark, which manual?</p></blockquote></div><p>This is what I mean:<br /><a href="https://wiki.openwrt.org/doc/howto/sqm">https://wiki.openwrt.org/doc/howto/sqm</a></p><div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p>(sqm-scripts has advantages in that it works out of the box for IPv6 which qos-scripts as of 3 years ago did to (last time I looked),</p></blockquote></div><p>I don&#039;t think I need IPv6 support (do I?).&nbsp; But your statement confused me.&nbsp; Does qos-scripts support IPv6 or not?</p><div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p>sqm offers link layer overhead accounting that actually works,</p></blockquote></div><p>In English, it is more efficient in reducing bufferbloat, right?</p><p>I think it should be explained in the manual (see above) what are the features/benefits of SQM, in a way that a non-technical person understands them.&nbsp; A simple tutorial about all the DSCP stuff needed to fine tune it.&nbsp; All the confusion in my questions could be food for thought to at least improve documentation.</p>											<p class="post-edited">(Last edited by <strong>bobptz</strong> on 1 Jan 2016, 10:03)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p305753">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						1 Jan 2016, 12:30					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>bobptz wrote:</cite><blockquote><p>From all the reading and searching I did about DSCP, I understood that the network packets are marked by compatible routers/switches with those DSCP marks, so that QoS can be applied to them. As for the criteria, I won;t go deep right now.&nbsp; I am sure there are shortcomings, like skype and torrents (like you said).</p><p>You mentioned twice about teaching my applications to use the correct DSCP markings.&nbsp; How do I do this?</p></blockquote></div><p>So have a look at say &quot;man ping&quot; on your ubuntu machine, you will see something which includes the following:<br />[...]<br />&nbsp; &nbsp; &nbsp; &nbsp;-Q tos Set Quality of Service -related bits in ICMP datagrams.&nbsp; tos can be decimal (ping only) or hex number.</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; In RFC2474, these fields are interpreted as 8-bit Differentiated Services (DS), consisting of: bits 0-1 (2&nbsp; lowest<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bits) of separate data, and bits 2-7 (highest 6 bits) of Differentiated Services Codepoint (DSCP).&nbsp; In RFC2481 and<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RFC3168, bits 0-1 are used for ECN.</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Historically (RFC1349, obsoleted by RFC2474), these were interpreted as: bit 0 (lowest&nbsp; bit)&nbsp; for&nbsp; reserved&nbsp; (cur‐<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rently being redefined as congestion control), 1-4 for Type of Service and bits 5-7 (highest bits) for Precedence.<br />[...]</p><p>So in try for example &quot;sudo ping -c 1 -s 16 -Q 0xC0 one.of.your.IP-addresses&quot; while using tcpdump to record the packages then look at the IP header in wireshark. Ideally all applications would allow to do that, but currently most do not. You then have the option to change the source code of the applications relevant for you and the re-compile (especially if those are open source programs, for Skype this will, unless you work at the right division of Microsoft not work). You can also use iptables on the machine running Skype to say mark all outgoing traffic as EF or so (that would with the existing simple.qos script allow to move all of work_pc&#039;s traffic into the higher priority class, pretty much what you asked for). Google should be your friend in getting the correct iptables/ip6tables invocation to make this happen.</p><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p305757">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						1 Jan 2016, 12:59					</div>
				</div>
				<div class="post-content content">
					<p>Hi bobptz,</p><div class="quotebox"><cite>bobptz wrote:</cite><blockquote><div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p> Well, if your bandwidth is not sufficient to have two concurrent Skype sessions then don&#039;t do that then?</p></blockquote></div><p>Maybe my wife or my children do not understand this even if I tell them 100 times.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; Since in our gedankenexperiment there will b too little bandwidth for two concurrent calls, they will notice since their Skype session also is going to be crappy... But i get your point you want to have a stricter control over this...<br /></p><div class="quotebox"><cite>bobptz wrote:</cite><blockquote><p>Maybe the line is loaded already by other stuff.&nbsp; Maybe the line can handle couple of skype sessions if they are geographically close, but has problem if they are from another continent.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; Why should this depend on the geographical distance between a call&#039;s endpoints?<br /></p><div class="quotebox"><cite>bobptz wrote:</cite><blockquote><p>Maybe the ADSL line has fluctuations and some times it has reduced bandwidth (my ADSL does).</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; If the fluctuations are severe the will likely make your shaper non-functional during periods of low bandwidth, in that situation sqm-scripts will not work well at all. I have he feeling you might be happier with maybe using gargoyle, which has a method to monitor the available bandwidth and set the shaper accordingly, also I believe gargoyle allows the level of detailed configuration and control you seem to want.<br /></p><div class="quotebox"><cite>bobptz wrote:</cite><blockquote><p>Why do you want to take care of torrents when everybody knows it is a hog for bandwidth and people should schedule them during off hours?</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; Because people don&#039;t do this reliably enough? And a number of networks are shared between users that want a reasonable fairness of bandwidth use (in times of contention), and because bit-torrent traffic can really make sqm-scripts perform worse than expected...<br /></p><div class="quotebox"><cite>bobptz wrote:</cite><blockquote><p>Because we are perfectionists and we strive for automation and excellence in the products we make.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; Please speak for yourself; for me this is not about excellence but really about fixing a bad corner-case were a single misbehaving user/application can degrade the network experience for a whole segment (but unlike a DOS situation, bit-torrent by itself is not an unwanted application, so banning it is not really an option, but relying on people getting the configuration right also does not seem to work generally, sort of like in your family scenario above... <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /> ).<br /></p><div class="quotebox"><cite>bobptz wrote:</cite><blockquote><br /><div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p>And let me ask with some snark, which manual?</p></blockquote></div><p>This is what I mean:<br /><a href="https://wiki.openwrt.org/doc/howto/sqm">https://wiki.openwrt.org/doc/howto/sqm</a></p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; This is not really a manual, but rather a quick introduction to help people getting it up and running, Rich Brown wrote this great document, but its aim certainly is not to explain all the details, but rather get people to a working set-up as quickly as possible.<br /></p><div class="quotebox"><cite>bobptz wrote:</cite><blockquote><br /><div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p>(sqm-scripts has advantages in that it works out of the box for IPv6 which qos-scripts as of 3 years ago did to (last time I looked),</p></blockquote></div><p>I don&#039;t think I need IPv6 support (do I?).&nbsp; But your statement confused me.&nbsp; Does qos-scripts support IPv6 or not?</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; I do not know the current state of qos-scripts and IPv6, three years ago it did not shape IPv6 traffic at all, so say on a dual-stack link with some IPv6 traffic flowing the shaper might not have worked at all.. About today, I really do not know.<br /></p><div class="quotebox"><cite>bobptz wrote:</cite><blockquote><br /><div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p>sqm offers link layer overhead accounting that actually works,</p></blockquote></div><p>In English, it is more efficient in reducing bufferbloat, right?</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; This can be a side-effect, yes. But the man point is that without correct accounting for the link layer and the per packet overhead the shaper will not robustly work especially on an ATM-bassed link, were worst case ~50% of the link bandwidth can be wasted on quantization overhead, so either you set your shaper to 50% of the link rate or use correct link layer accounting to make sure the traffic shaper will work as expected under all circumstances...<br /></p><div class="quotebox"><cite>bobptz wrote:</cite><blockquote><p>I think it should be explained in the manual (see above) what are the features/benefits of SQM, in a way that a non-technical person understands them.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; Remember when I pointed you at <a href="https://github.com/moeller0/ATM_overhead_detector">https://github.com/moeller0/ATM_overhead_detector</a> ? You complained about its almost complete opaqueness and tech-babble, but this was my attempt at describing something in a way for lay-people to understand (without dumbing down on the details), so I might not be the person you actually want writing documentation... That said, if you want to contribute simple and correct text for a more detailed manual, I am sure Toke will happily include this, or it could be hosted on the openwrt wiki somewhere, just holler if you want to contribute.<br /></p><div class="quotebox"><cite>bobptz wrote:</cite><blockquote><p>A simple tutorial about all the DSCP stuff needed to fine tune it.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; One of the core dies behind sqm-scripts is to come up with a traffic control system that should not need any fine-tuning <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /> You are right that a better description of the DSCP topics would be great. So may I ask you to document the steps of your journey to a working set-up, to use as a skeleton for the sqm/DSCP manual?<br /></p><div class="quotebox"><cite>bobptz wrote:</cite><blockquote><p>All the confusion in my questions could be food for thought to at least improve documentation.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; So, are you volunteering your own time here to improve the documentation? In that case I will try to endorse you and help out with information, if I can. If you are thinking about volunteering my or someone else&#039;s time I am unsure how quickly the tentative documentation improvements will materialize <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /><br />&nbsp; &nbsp; &nbsp; &nbsp; Ceterum censeo, you should try to perform a worst case measurement on your system first to figure out whether any DSCP magic is required at all or not, if I understand correctly we are mainly talking about theoretical short-comings you want fixed, not really confirmed practical ones... You know what they say, &quot;if it is not broken, do not fix it&quot;. There are enough sqm related items on my todo list that fix real observable issues that I am not actively soliciting for more ideas how to spend my spare time <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p305879">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">bobptz</div>
					<div class="post-datetime">
						2 Jan 2016, 16:55					</div>
				</div>
				<div class="post-content content">
					<p>Hello moeller0 </p><div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p>So in try for example &quot;sudo ping -c 1 -s 16 -Q 0xC0 one.of.your.IP-addresses&quot; while using tcpdump to record the packages then look at the IP header in wireshark. Ideally all applications would allow to do that, but currently most do not. You then have the option to change the source code of the applications relevant for you and the re-compile (especially if those are open source programs, for Skype this will, unless you work at the right division of Microsoft not work). You can also use iptables on the machine running Skype to say mark all outgoing traffic as EF or so (that would with the existing simple.qos script allow to move all of work_pc&#039;s traffic into the higher priority class, pretty much what you asked for). Google should be your friend in getting the correct iptables/ip6tables invocation to make this happen.</p></blockquote></div><p>I am looking into iptables, mostly out of interest, since iptables keeps coming up all the time.&nbsp; I do not want to change the source code and recompile my applications, even if I could do it (after googling for several months).&nbsp; I was hoping for a much more user-friendly and less technical solution.</p><div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p>Why should this depend on the geographical distance between a call&#039;s endpoints?</p></blockquote></div><p>Distance increases the ping.&nbsp; Skype is sensitive to ping AFAIK.</p><div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p>I have he feeling you might be happier with maybe using gargoyle, which has a method to monitor the available bandwidth and set the shaper accordingly, also I believe gargoyle allows the level of detailed configuration and control you seem to want.</p></blockquote></div><p>oh Yes!&nbsp; This sounds great.&nbsp; This dynamic adjustment is exactly what I had in mind when I started with multi wan and QoS.&nbsp; However I do not want to change firmware because of some obstacles I found with OpenWRT or SQM.&nbsp; All software have flaws and shortcomings.&nbsp; I invested my time in this setup, I prefer to continue with it.</p><div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p>So may I ask you to document the steps of your journey to a working set-up, to use as a skeleton for the sqm/DSCP manual?<br />….<br />So, are you volunteering your own time here to improve the documentation?</p></blockquote></div><p>I am already doing this.&nbsp; Have a look at this link:<br /><a href="http://bbb-solutions.blogspot.gr/2015/12/install-sqm-scripts-for-openwrt.html">http://bbb-solutions.blogspot.gr/2015/1 … enwrt.html</a></p><p>I wrote it because the readme file was not accurate and I would have trouble installing them without your help.&nbsp; I keep this blog so I can repeat these steps if I ever need to.&nbsp; </p><p>The rest of my setup is 99% from the “manual”.&nbsp; Do you remember something from our conversations that needs to be included in the documentation?&nbsp; If it is something that I comprehend (because many things I still do not), then I could write a guide for it.&nbsp; </p><div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p>In that case I will try to endorse you and help out with information, if I can.</p></blockquote></div><p>You can try, but remember:&nbsp; I still do not know what iptables are and although I like to learn and improve things, I do not want to learn all the internals of Linux just to improve my router.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p305920">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						2 Jan 2016, 21:10					</div>
				</div>
				<div class="post-content content">
					<p>Hi bobptz,</p><div class="quotebox"><cite>bobptz wrote:</cite><blockquote><p>Hello moeller0 </p><div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p>So in try for example &quot;sudo ping -c 1 -s 16 -Q 0xC0 one.of.your.IP-addresses&quot; while using tcpdump to record the packages then look at the IP header in wireshark. Ideally all applications would allow to do that, but currently most do not. You then have the option to change the source code of the applications relevant for you and the re-compile (especially if those are open source programs, for Skype this will, unless you work at the right division of Microsoft not work). You can also use iptables on the machine running Skype to say mark all outgoing traffic as EF or so (that would with the existing simple.qos script allow to move all of work_pc&#039;s traffic into the higher priority class, pretty much what you asked for). Google should be your friend in getting the correct iptables/ip6tables invocation to make this happen.</p></blockquote></div><p>I am looking into iptables, mostly out of interest, since iptables keeps coming up all the time.&nbsp; I do not want to change the source code and recompile my applications, even if I could do it (after googling for several months).&nbsp; I was hoping for a much more user-friendly and less technical solution.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; Great, iptables (and for IPv6 ip6tables) is a binary program to interact with the kernels iptables subsystem (IIRC), so looking into this sounds worthwhile. Something along the lines of <a href="http://www.linuxtopia.org/Linux_Firewall_iptables/x4172.html">http://www.linuxtopia.org/Linux_Firewal … x4172.html</a> should help you to configure the DSCP marks of all tcp packets leaving your work_pc for example; so this should allow you to configure the stict priority tiers you seem to desire. The downside of this approach is that it will only affect traffic originating from work_pc, but not packets on the reverse leg from the internet to work_pc (for this to work the filtering needs to be performed before the packets reach the shaper, but since you set the shaper up on the wan interfaces, at that point you do not have easy access to work_pc&#039;s internal IP address, thank to network address translation (NAT)). In my view teach relevant application to use configurable DSCP markings is the superior solution as that allows to specify the policy on a per application basis; in your case you seem to be adamant that work_pc needs priority for Skype so it seems the most natural solution to just make Skype use higher priority... in the end this also is way more user friendly if applications start to expose the DSCP marking somewhere in their configuration files or settings dialogs, but I admit that this is simple a question of personal taste and preference...<br /></p><div class="quotebox"><cite>bobptz wrote:</cite><blockquote><div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p>Why should this depend on the geographical distance between a call&#039;s endpoints?</p></blockquote></div><p>Distance increases the ping.&nbsp; Skype is sensitive to ping AFAIK.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; But this is then independent of your router&#039;s bandwidth, so outside the scope of sqm-scripts, no?<br /></p><div class="quotebox"><cite>bobptz wrote:</cite><blockquote><div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p>I have he feeling you might be happier with maybe using gargoyle, which has a method to monitor the available bandwidth and set the shaper accordingly, also I believe gargoyle allows the level of detailed configuration and control you seem to want.</p></blockquote></div><p>oh Yes!&nbsp; This sounds great.&nbsp; This dynamic adjustment is exactly what I had in mind when I started with multi wan and QoS.&nbsp; However I do not want to change firmware because of some obstacles I found with OpenWRT or SQM.&nbsp; All software have flaws and shortcomings.&nbsp; I invested my time in this setup, I prefer to continue with it.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; Well, fair enough, please note though that gargoyle ( <a href="https://www.gargoyle-router.com">https://www.gargoyle-router.com</a> ) is based on openwrt, so might allow you to re-use the already learned knowledge and refined configuration files. Also some of the things gargoyle already offers to day and that you seem to want are not in sqm-scripts (near to intermediate) future...<br /></p><div class="quotebox"><cite>bobptz wrote:</cite><blockquote><br /><div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p>So may I ask you to document the steps of your journey to a working set-up, to use as a skeleton for the sqm/DSCP manual?<br />….<br />So, are you volunteering your own time here to improve the documentation?</p></blockquote></div><p>I am already doing this.&nbsp; Have a look at this link:<br /><a href="http://bbb-solutions.blogspot.gr/2015/12/install-sqm-scripts-for-openwrt.html">http://bbb-solutions.blogspot.gr/2015/1 … enwrt.html</a></p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; This is a great start, thannks.<br /></p><div class="quotebox"><cite>bobptz wrote:</cite><blockquote><p>I wrote it because the readme file was not accurate and I would have trouble installing them without your help.&nbsp; I keep this blog so I can repeat these steps if I ever need to.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; What part in the realm was not accurate beyond the use of a symbolic name for the &quot;target directory&quot;?<br /></p><div class="quotebox"><cite>bobptz wrote:</cite><blockquote><p>The rest of my setup is 99% from the “manual”.&nbsp; Do you remember something from our conversations that needs to be included in the documentation?&nbsp; If it is something that I comprehend (because many things I still do not), then I could write a guide for it.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; If you implement the &quot;switch work_pc to higher priority&quot; using iptables approach it sure will help if you post a nice description (along the lines of the existing entries) to your blog.<br /></p><div class="quotebox"><cite>bobptz wrote:</cite><blockquote><div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p>In that case I will try to endorse you and help out with information, if I can.</p></blockquote></div><p>You can try, but remember:&nbsp; I still do not know what iptables are and although I like to learn and improve things, I do not want to learn all the internals of Linux just to improve my router.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; I start to sound like a broken record, but here I go again: why don&#039;t you simply try whether sqm-scripts default behavior does not already work well enough for your needs first? Then you can still decide whether reading &quot;man iptables&quot; and &quot;man iptables-extensions&quot; is worth your time...</p><p>Best Regards<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p305991">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">bobptz</div>
					<div class="post-datetime">
						3 Jan 2016, 09:48					</div>
				</div>
				<div class="post-content content">
					<p>Hello moeller0</p><div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p>In my view teach relevant application to use configurable DSCP markings is the superior solution as that allows to specify the policy on a per application basis; in your case you seem to be adamant that work_pc needs priority for Skype so it seems the most natural solution to just make Skype use higher priority... in the end this also is way more user friendly if applications start to expose the DSCP marking somewhere in their configuration files or settings dialogs, but I admit that this is simple a question of personal taste and preference...</p></blockquote></div><p>I agree this is a far better method for QoS, and I also agree there should be a better way to configure the DSCP marks of the packets the application sends.&nbsp; Otherwise it is unusuable to the average user.</p><br /><div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p>What part in the realm was not accurate beyond the use of a symbolic name for the &quot;target directory&quot;?</p></blockquote></div><p>This and the explanation of the scp command.&nbsp; It is not obvious if you have not done this before:<br />scp -r ./*&nbsp; root@192.168.1.1:/</p><p>About this iptables technique.&nbsp; MWAN3 seems to have its own routing and iptables scheme.&nbsp; I am reading the &quot;Mwan3 routing&quot; section of <a href="https://wiki.openwrt.org/doc/howto/mwan3">https://wiki.openwrt.org/doc/howto/mwan3</a> , but I only understand half of what it says.</p>											<p class="post-edited">(Last edited by <strong>bobptz</strong> on 3 Jan 2016, 09:51)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p306000">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">moeller0</div>
					<div class="post-datetime">
						3 Jan 2016, 12:59					</div>
				</div>
				<div class="post-content content">
					<p>Hi bobptz,</p><div class="quotebox"><cite>bobptz wrote:</cite><blockquote><p>Hello moeller0</p><div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p>In my view teach relevant application to use configurable DSCP markings is the superior solution as that allows to specify the policy on a per application basis; in your case you seem to be adamant that work_pc needs priority for Skype so it seems the most natural solution to just make Skype use higher priority... in the end this also is way more user friendly if applications start to expose the DSCP marking somewhere in their configuration files or settings dialogs, but I admit that this is simple a question of personal taste and preference...</p></blockquote></div><p>I agree this is a far better method for QoS, and I also agree there should be a better way to configure the DSCP marks of the packets the application sends.&nbsp; Otherwise it is unusuable to the average user.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; I have my doubts that the average user uses openwrt at home <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" />, also none of this is actual rocket science, and a decent blog like yours might be enough to get others started as well. In other words my faith in peoples capabilities seems greater than yours <img src="https://forum.openwrt.org/img/smilies/wink.png" width="15" height="15" alt="wink" /><br /></p><div class="quotebox"><cite>bobptz wrote:</cite><blockquote><div class="quotebox"><cite>moeller0 wrote:</cite><blockquote><p>What part in the realm was not accurate beyond the use of a symbolic name for the &quot;target directory&quot;?</p></blockquote></div><p>This and the explanation of the scp command.&nbsp; It is not obvious if you have not done this before:<br />scp -r ./*&nbsp; root@192.168.1.1:/</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; Interesting, I had not considered that either the symbolic directory name nor the &quot;missing&quot; information from &quot;man scp&quot; would be an obstacle...<br /></p><div class="quotebox"><cite>bobptz wrote:</cite><blockquote><br /><p>About this iptables technique.&nbsp; MWAN3 seems to have its own routing and iptables scheme.&nbsp; I am reading the &quot;Mwan3 routing&quot; section of <a href="https://wiki.openwrt.org/doc/howto/mwan3">https://wiki.openwrt.org/doc/howto/mwan3</a> , but I only understand half of what it says.</p></blockquote></div><p>&nbsp; &nbsp; &nbsp; &nbsp; On your ubuntu machines, the whole mwan3 issue does not exist all you need is to issue something along the lines of (to make the whole machine label everything for background (lowest) priority):</p><p>sudo iptables --table mangle --append OUTPUT --protocol all -j DSCP --set-dscp 0x08<br />sudo ip6tables --table mangle --append OUTPUT --protocol all -j DSCP --set-dscp 0x08</p><p>to delete the rules first use:</p><p>sudo iptables --line-numbers -t mangle -vL OUTPUT<br />to get the rules number, should be the highest number or very likely this is the only rule, so 1 in our example,<br />then delete it:<br />sudo iptables -t mangle -D OUTPUT 1</p><p>And the same for IPv6:<br />sudo ip6tables --line-numbers -t mangle -vL OUTPUT<br /># assuming the number is 1<br />sudo ip6tables -t mangle -D OUTPUT 1</p><p>This is by all means not perfect and only affects the egress/outgoing/upload direction (if issued at one of your internal linux hosts) and it will not survive a reboot, but it should at least give you an example of how to push one machine into a specific priority band... Feel free to experiment a bit with this. For testing I used the ceroscripts ( <a href="https://github.com/richb-hanover/CeroWrtScripts)">https://github.com/richb-hanover/CeroWrtScripts)</a> bettersppeedtest wrapper script:<br />1) IPv4:<br />./betterspeedtest.sh -4&nbsp; -H netperf-eu.bufferbloat.net -t 2<br />and<br />./betterspeedtest.sh -6&nbsp; -H netperf-eu.bufferbloat.net -t 2<br />(You can use any program that will send tcp packets over your wan interfaces here...)<br />While using &quot;tcpdump -s 1550 -i ge00 -w ge00.cap&quot; on my router, get is the physical interface name (in your case probably eth0) on which my egress pppoe-ge00 lives. I then copied these to my analysis machine and had a look inside with wireshark and looked at the values of the disc fields in the IP headers of packets originating from the internal host. Also &quot;tc -s qdisc show dev pppoe-ge00&quot; now showed among other outputs:<br />qdisc fq_codel 130: parent 1:13 limit 1001p flows 1024 quantum 300 target 5.0ms interval 100.0ms <br /> Sent 18728096 bytes 22576 pkt (dropped 23, overlimits 0 requeues 0) <br /> backlog 0b 0p requeues 0 <br />&nbsp; maxpacket 1516 drop_overlimit 0 new_flow_count 7268 ecn_mark 0<br />&nbsp; new_flows_len 0 old_flows_len 2<br />This shows that the background priority tier actually transmitted packets during the test. Testing without the remarking rule above yields:<br />qdisc fq_codel 130: parent 1:13 limit 1001p flows 1024 quantum 300 target 5.0ms interval 100.0ms <br /> Sent 0 bytes 0 pkt (dropped 0, overlimits 0 requeues 0) <br /> backlog 0b 0p requeues 0 <br />&nbsp; maxpacket 256 drop_overlimit 0 new_flow_count 0 ecn_mark 0<br />&nbsp; new_flows_len 0 old_flows_len 0</p><p>This shows that the forced DSCP marking at the end host works for egress packets and that sqm-scripts&#039; simple.qos actually honors these DCP marks. I hope that this gets you started to implement what ever you want. BUT please, first test how the system behaves without manual interventions; in the end most end users will not want to touch anything so the out-of-the-box default behavior of sqm-scripts aims at being reasonable in most reasonable circumstances; so does it work for yor case out-of-the-box or is tweaking required?</p><p>For anything more there is always &quot;man iptables&quot; and &quot;man iptables-extensions&quot; and google...</p><p>Best Regards, over and out<br />&nbsp; &nbsp; &nbsp; &nbsp; M.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p311012">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">rip057</div>
					<div class="post-datetime">
						11 Feb 2016, 09:26					</div>
				</div>
				<div class="post-content content">
					<p>this is a bit old of a thread, but i often host lobbies in ptp online fps, and as well have a mission critical apache server, and both run at the same time.&nbsp; The online mp gaming hosts would be the time dependant traffic and the apache server while important isnt latency dependant, and sometimes gets server at a huge percentage of my bandwidth.&nbsp; I realize that sqm scripts might work just fine out of the box, but the addition of priority to the gaming computer against the apache would just make the hosts that much better.&nbsp; </p><p>I just want to throw my hat up for addition of the priority/(ip address/mac address) section of the sqm qos script section, or better yet a merger of the two so that it has both features.&nbsp; </p><p>tc is still some what greek to me so idk, but ive read over man documents, i guess i just need to put the pen to the paper on my own personal script for this</p><p>so am i right that i cant have both qos scripts and sqm-qos installed at the same time?</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>