<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> releasing PBX (supporting Asterisk) interface for LuCI</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							between 6 Apr 2018 and 30 Apr 2018.
										Unfortunately there are posts – most likely complete pages – missing.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 2 of 6</div><nav><ul><li><a href="viewtopic.php%3Fid=32392&amp;p=1.html">1</a></li><li class="pagination-current"><span>2</span></li><li><a href="viewtopic.php%3Fid=32392&amp;p=3.html">3</a></li><li><a href="viewtopic.php%3Fid=32392&amp;p=4.html">4</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=32392&amp;p=6.html">6</a></li></ul></nav></div>
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			
		
		
			<article class="post" id="p149321">
				<div class="post-metadata">
					<div class="post-num">Post #26</div>
					<div class="post-author">dancho</div>
					<div class="post-datetime">
						22 Nov 2011, 22:42					</div>
				</div>
				<div class="post-content content">
					<p>(1) OK, since you are using attitude adjustment, you should not need to use the *old* ipks provided above (perhaps they don&#039;t work very well anymore). You can build this very PBX package by selecting it in &quot;make menuconfig&quot;. It should appear alongside all the other LuCI apps. There have been many fixes and improvements since I released the original ipk and source for testing.</p><p>(2) To get func_cut, you have to select it from &quot;make menuconfig&quot; as well. It&#039;s under Network-Telephony, along with all the other asterisk-related stuff. The resulting package for me is&nbsp; asterisk18-func-cut_1.8.7.1-1_brcm47xx.ipk</p><p>(3) Finally, you should really simply make a direct calls between users for testing, not through google-talk, because any number of other things could be going wrong with google-talk. Lets say your users are 1111 and 2222. With the SIP client registered with user 1111, simply dial 2222 to ring the other user.</p><p>(4) I have not finalized the package dependencies of luci-pbx quite yet, but I agree it&#039;s time I did so. When you select luci-pbx, you should have all the necessary prerequisites selected automatically. It&#039;s on the TODO list!</p><p>(5) Here are a list of packages I have selected, which should help anybody building from trunk:</p><p>asterisk18<br />asterisk18-codec-a-mu<br />asterisk18-codec-alaw<br />asterisk18-func-cut<br />asterisk18-res-clioriginate</p><p>When you hit ENTER on the asterisk18 package, you get an additional list of chan and app packages. There I have the following selected:</p><p>asterisk18-app-authenticate<br />asterisk18-app-disa<br />asterisk18-app-setcallerid<br />asterisk18-app-system<br />asterisk18-chan-gtalk</p><p>I hope this helps! I agree that this should already be automatic, and I&#039;m sorting all that out as I go along.</p><p>Cheers!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p149324">
				<div class="post-metadata">
					<div class="post-num">Post #27</div>
					<div class="post-author">tekoholic</div>
					<div class="post-datetime">
						22 Nov 2011, 23:05					</div>
				</div>
				<div class="post-content content">
					<p>Oooh, that presents a problem...&nbsp; I&#039;ve not built anything OpenWRT related, whether firmware images or packages, so I&#039;ll have to learn how, before I&#039;m able to proceed with this.&nbsp; I&#039;ve always just installed what&#039;s in the stock Repo.</p><p>Anyhow, I do appreciate your assistance, and will start looking into building from SVN in the next few hours!</p><p>Do you hang out in IRC?&nbsp; I&#039;m on there...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p149325">
				<div class="post-metadata">
					<div class="post-num">Post #28</div>
					<div class="post-author">dancho</div>
					<div class="post-datetime">
						22 Nov 2011, 23:11					</div>
				</div>
				<div class="post-content content">
					<p>(1) Sorry, I only visit IRC when I&#039;m doing work on the PBX front-end. I don&#039;t seem to have any free time lately, so I prefer to spend whatever time I do have actually coding this stuff up!</p><p>(2) Actually, I don&#039;t think you need to learn to build from SVN. You can find all the packages and images in the snapshots built daily from trunk:</p><p><a href="http://downloads.openwrt.org/snapshots/trunk/">http://downloads.openwrt.org/snapshots/trunk/</a></p><p>But if you prefer to build from source, by all means, learn! One more savvy person is never a bad thing for such a project <img src="https://forum.openwrt.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /></p><p>Cheers!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p149537">
				<div class="post-metadata">
					<div class="post-num">Post #29</div>
					<div class="post-author">tekoholic</div>
					<div class="post-datetime">
						25 Nov 2011, 08:52					</div>
				</div>
				<div class="post-content content">
					<p>Well, after completely reflashing my router with yesterday&#039;s newest from that repo, the luci-app-pbx (now available from the repo) seems completely incapable of changing any of the asterisk config files according to it&#039;s settings.&nbsp; It can, and did change firewall rules according to the external config, but none of the users, GV accounts and such could be set up.</p><p>On the other hand, before this major update, when the config&#039;s had been successfully saved, the same firewall rules did not permit WAN-side client registrations (still not sure why).&nbsp; This was my major reasoning for the upgrade (hoping that the newest would fix this issue), and now, of course, nothing can be tested...</p><p>...at least not without manual configuration of all the asterisk GV and user account info, and I can&#039;t seem to remember how the configs that worked differed from those that are available in online how-tos.</p><p>So, I&#039;m again attempting to find the correct settings for all of this, so that I can check to see if the firewall will permit the external registrations, and just wanted to notify you of the newest errors for further troubleshooting.</p><p>BTW, I did reinstall any and all asterisk and pbx packages, to no avail.&nbsp; Nothing has changed, as far as the config files not being edited by the luci-app-pbx settings.&nbsp; I don&#039;t know how it may have been, but I guess it&#039;s possible that it&#039;s PEBKAC-caused.&nbsp; I&#039;ll continue doing what I am able, to troubleshoot.&nbsp; If you have any hints, I&#039;m all ears!!</p><p>edit:&nbsp; After looking around a bit, I may have discovered something...&nbsp; In the /tmp/ dir, there are currently 10 dir&#039;s called pbx.xxxxx.&nbsp; Within these dir&#039;s, are .TMP and .conf files, that don&#039;t seem to be getting copied over to the correct places within the /etc/asterisk/ dir.&nbsp; Not sure, as yet, why, but I thought it might be relevant.</p><p>edit#2:&nbsp; Tried to chmod 777 /etc/asterisk/ -R (bad idea for long term, I know), and save changes again; No Go.&nbsp; Then, uninstalled all asterisk and pbx related packages, deleted all dir&#039;s that the uninstalls left behind (most were empty), and reinstalled fresh again; Also No Go.&nbsp; Not sure what else to do, and can&#039;t seem to figure out the manual config&#039;s, either.&nbsp; I&#039;m at a standstill, I&#039;m afraid (mostly due to my own ignorance, granted), until this issue can be solved with the luci-app-pbx package.</p>											<p class="post-edited">(Last edited by <strong>tekoholic</strong> on 25 Nov 2011, 19:41)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p149696">
				<div class="post-metadata">
					<div class="post-num">Post #30</div>
					<div class="post-author">dancho</div>
					<div class="post-datetime">
						28 Nov 2011, 04:31					</div>
				</div>
				<div class="post-content content">
					<p>@tekoholic,</p><p>Thanks for the report. It sounds like the /etc/init.d/pbx-asterisk script is exiting before it has a change to copy over the new config files. Please try:</p><p>/etc/init.d/pbx-asterisk restart</p><p>and see if it spits out any error messages.</p><p>I&#039;ll reproduce your set up and try it myself a little later today (hopefully I&#039;ll have time before the day is over). I had discovered and fixed a problem whereby the script was exiting if there is no pbx-voicemail configuration found. Perhaps the build which you downloaded and installed does not have my fix yet. To see if it has it or not, please run this command on the command-line:</p><p>grep exit /etc/init.d/pbx-asterisk</p><p>If you come up with output that reads &quot;[ &quot;$enabled&quot; != &quot;yes&quot; ] &amp;&amp; exit&quot;, then the version you have is the one before my fix! You can edit the /etc/init.d/pbx-asterisk file (with vi), and change the line to read:</p><p>&nbsp; &nbsp; [ &quot;$enabled&quot; != &quot;yes&quot; ] &amp;&amp; return</p><p>(note the change from exit to return). Otherwise, reinstall the luci-app-pbx package and check whether the line has changed. Eventially my changes should make it to the snapshot build.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p149697">
				<div class="post-metadata">
					<div class="post-num">Post #31</div>
					<div class="post-author">dancho</div>
					<div class="post-datetime">
						28 Nov 2011, 04:39					</div>
				</div>
				<div class="post-content content">
					<p>OK, I just checked, and my change has indeed made it into the snapshot build. So simply reinstalling the package should fix that issue. Another problem I discovered is that the configuration did not contain default values for the RTP ports used by asterisk. This could make the asterisk configuration NOT in line with the firewall rules if those ports don&#039;t end up in the configuration file. Please check whether this file:</p><p>/etc/config/pbx-advanced</p><p>contains:</p><p>&nbsp; &nbsp; &nbsp; &nbsp; option &#039;rtpstart&#039; &#039;19850&#039;<br />&nbsp; &nbsp; &nbsp; &nbsp; option &#039;rtpend&#039; &#039;19900&#039;</p><p>and if not, add those two lines under the:</p><p>config &#039;settings&#039; &#039;advanced&#039;</p><p>section. Something tell me this should not have been a problem since to set up remote usage you have to hit &quot;Save&amp;Apply&quot; in the Advanced settings page at least once, at which point those values *should* be introduced into the config file. However, for completeness sake, these options should be there.</p><p>Cheers!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p149741">
				<div class="post-metadata">
					<div class="post-num">Post #32</div>
					<div class="post-author">mazilo</div>
					<div class="post-datetime">
						28 Nov 2011, 13:44					</div>
				</div>
				<div class="post-content content">
					<p>@dancho,</p><p>IC you are heavily / actively developing this package. Wouldn&#039;t it be nice to have the source code hosted on any GIT (my preference) and/or SVN server for anyone who builds the package to retrieve the latest version?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p149742">
				<div class="post-metadata">
					<div class="post-num">Post #33</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						28 Nov 2011, 13:56					</div>
				</div>
				<div class="post-content content">
					<p>mazilo: its part of the regular luci feed.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p149746">
				<div class="post-metadata">
					<div class="post-num">Post #34</div>
					<div class="post-author">tekoholic</div>
					<div class="post-datetime">
						28 Nov 2011, 15:12					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>dancho wrote:</cite><blockquote><p>Thanks for the report. It sounds like the /etc/init.d/pbx-asterisk script is exiting before it has a change to copy over the new config files. Please try:</p><p>/etc/init.d/pbx-asterisk restart</p><p>and see if it spits out any error messages.</p><p>I&#039;ll reproduce your set up and try it myself a little later today (hopefully I&#039;ll have time before the day is over). I had discovered and fixed a problem whereby the script was exiting if there is no pbx-voicemail configuration found. Perhaps the build which you downloaded and installed does not have my fix yet. To see if it has it or not, please run this command on the command-line:</p><p>grep exit /etc/init.d/pbx-asterisk</p><p>If you come up with output that reads &quot;[ &quot;$enabled&quot; != &quot;yes&quot; ] &amp;&amp; exit&quot;, then the version you have is the one before my fix! You can edit the /etc/init.d/pbx-asterisk file (with vi), and change the line to read:</p><p>&nbsp; &nbsp; [ &quot;$enabled&quot; != &quot;yes&quot; ] &amp;&amp; return</p><p>(note the change from exit to return). Otherwise, reinstall the luci-app-pbx package and check whether the line has changed. Eventially my changes should make it to the snapshot build.</p></blockquote></div><p>This was a problem, and once fixed, created another:</p><div class="codebox"><pre><code># /etc/init.d/pbx-asterisk restart
mv: can&#039;t rename &#039;/tmp/pbx.xxxxx/inext.TMP&#039;: No such file or directory
mv: can&#039;t rename &#039;/tmp/pbx.xxxxx/sip_regs.TMP&#039;: No such file or directory
mv: can&#039;t rename &#039;/tmp/pbx.xxxxx/sip_peers.TMP&#039;: No such file or directory</code></pre></div><p>/etc/config/pbx-advanced contained the lines expected, already.</p><p>Thanx, so much, for your help on this!&nbsp; I do appreciate it, and hope that it is helpful to you and/or others, as well.</p><p>edit:&nbsp; In addition to the 3 errors shown above, the status page for the PBX module shows any google talk account as disconnected.&nbsp; Not sure where to look for further diagnostic info, but still banging on it!</p>											<p class="post-edited">(Last edited by <strong>tekoholic</strong> on 28 Nov 2011, 16:52)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p149768">
				<div class="post-metadata">
					<div class="post-num">Post #35</div>
					<div class="post-author">dancho</div>
					<div class="post-datetime">
						28 Nov 2011, 19:07					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>tekoholic wrote:</cite><blockquote><div class="codebox"><pre><code># /etc/init.d/pbx-asterisk restart
mv: can&#039;t rename &#039;/tmp/pbx.xxxxx/inext.TMP&#039;: No such file or directory
mv: can&#039;t rename &#039;/tmp/pbx.xxxxx/sip_regs.TMP&#039;: No such file or directory
mv: can&#039;t rename &#039;/tmp/pbx.xxxxx/sip_peers.TMP&#039;: No such file or directory</code></pre></div></blockquote></div><p>This is not an error per-se. You simply don&#039;t have any SIP accounts configured. Things should be working.</p><div class="quotebox"><cite>tekoholic wrote:</cite><blockquote><p>Edit:&nbsp; In addition to the 3 errors shown above, the status page for the PBX module shows any google talk account as disconnected.&nbsp; Not sure where to look for further diagnostic info, but still banging on it!</p></blockquote></div><p>On the command-line, run the command:</p><p>&nbsp; rasterisk</p><p>and in the asterisk console that starts, type in:</p><p>&nbsp; jabber show connections</p><p>Paste the result of that here.</p><p>Also, look for any errors that may be popping up as you sit idle in the asterisk console, and paste those here too.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p149769">
				<div class="post-metadata">
					<div class="post-num">Post #36</div>
					<div class="post-author">tekoholic</div>
					<div class="post-datetime">
						28 Nov 2011, 19:36					</div>
				</div>
				<div class="post-content content">
					<p>Didn&#039;t need to do any more than just run asterisk -r, got the following error repeatedly, for each account attempted:</p><div class="codebox"><pre><code>[Nov 28 17:33:01] ERROR[14428]: res_jabber.c:3123 aji_initialize: JABBER ERROR: No DNS gtalk-user_gmail_com for client to  talk.google.com</code></pre></div><p>The only thing changed about that line was the work &quot;user&quot; in gtalk-user-gmail...&nbsp; Where user is, username was, but ALL else is quoted (time-stamp changes, of course).</p><p>edit:&nbsp; Router&#039;s DNS servers are set as 8.8.8.8 and 8.8.4.4, so you&#039;d think that it&#039;d be able to resolve a google address...&nbsp; Sorry, this shoulda&#039; been included in first post...</p>											<p class="post-edited">(Last edited by <strong>tekoholic</strong> on 28 Nov 2011, 19:40)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p149770">
				<div class="post-metadata">
					<div class="post-num">Post #37</div>
					<div class="post-author">dancho</div>
					<div class="post-datetime">
						28 Nov 2011, 20:05					</div>
				</div>
				<div class="post-content content">
					<p>@tekoholic,</p><p>Well here is the real question: Can you resolve talk.google.com on the commandline?</p><p>Try:</p><p>&nbsp; host talk.google.com</p><p>and/or </p><p>&nbsp; nslookup talk.google.com</p><p>and tell us the result. Also, can you please post the contents of:</p><p>cat /etc/resolv.conf</p><p>Thanks.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p149773">
				<div class="post-metadata">
					<div class="post-num">Post #38</div>
					<div class="post-author">tekoholic</div>
					<div class="post-datetime">
						28 Nov 2011, 20:29					</div>
				</div>
				<div class="post-content content">
					<p>OK, very odd...</p><div class="codebox"><pre><code># host talk.google.com
-ash: host: not found
# cat /etc/resolv.conf 
search lan
nameserver 127.0.0.1
root@AP-1:/etc/config# nslookup talk.google.com
Server:    127.0.0.1
Address 1: 127.0.0.1 localhost

Name:      talk.google.com
Address 1: 2001:4860:b007::7d iy-in-x7d.1e100.net
Address 2: 209.85.225.125 iy-in-f125.1e100.net</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p149774">
				<div class="post-metadata">
					<div class="post-num">Post #39</div>
					<div class="post-author">dancho</div>
					<div class="post-datetime">
						28 Nov 2011, 20:36					</div>
				</div>
				<div class="post-content content">
					<p>Can you please do me a favor and restart asterisk on the commandline and see if the DNS error goes away? It could have come up before DNS was ready and gotten stuck in a state where it can&#039;t resolve names. I reported a similar problem in the sip module to Digium and they corrected it in 1.8.7, but perhaps jabber also suffers from the same or similar bug in 1.8.4.</p><p>/etc/init.d/asterisk restart</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p149784">
				<div class="post-metadata">
					<div class="post-num">Post #40</div>
					<div class="post-author">tekoholic</div>
					<div class="post-datetime">
						28 Nov 2011, 22:07					</div>
				</div>
				<div class="post-content content">
					<p>Did that, and no go.&nbsp; However, I think I may have discovered the issue:</p><p>When I pasted that error in, I ONLY changed the username.&nbsp; I did not change the address, which seemed to me to have an additional space preceding it in the error.&nbsp; I just went to the Diagnostics page of LuCI, and from there, pinged &quot;talk.google.com&quot; successfully (error is still present in asterisk).&nbsp; I then attempted to ping &quot; talk.google.com&quot;, and got an instantaneous &quot;Bad Address Specified&quot; error.</p><p>If you can lead me to the file within which that address is specified, I bet ditching the excessive space kills the error!!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p149793">
				<div class="post-metadata">
					<div class="post-num">Post #41</div>
					<div class="post-author">dancho</div>
					<div class="post-datetime">
						28 Nov 2011, 23:25					</div>
				</div>
				<div class="post-content content">
					<p>@tekoholic:</p><p>Simply run this command:</p><p>grep talk.google.com /etc/asterisk/*</p><p>and you&#039;ll get a list of all the locations where it&#039;s specified.</p><p>Cheers,<br />Iordan</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p149794">
				<div class="post-metadata">
					<div class="post-num">Post #42</div>
					<div class="post-author">tekoholic</div>
					<div class="post-datetime">
						28 Nov 2011, 23:43					</div>
				</div>
				<div class="post-content content">
					<p>Well, unfortunately, that did not help.</p><p>The only file within which the address is specified has it (seemingly) correct:</p><p>/etc/asterisk/jabber_users.conf =<br /></p><div class="codebox"><pre><code>[gtalk-user_gmail_com]
type=client
serverhost=talk.google.com
username=user@gmail.com/Talk
secret=password
timeout=150
status=away
statusmessage=&quot;Online for VOICE ONLY, may lose messages&quot;</code></pre></div><p>So, although I&#039;m not sure of any of this, the address must be getting mangled elsewhere, if it&#039;s getting mangled at all.&nbsp; I&#039;m not sure what else to look for.&nbsp; My PC&#039;s and phones, all of which utilize the router&#039;s internal DNS for their own resolution, can ping / log into talk.google.com, so I&#039;m at a loss...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p149795">
				<div class="post-metadata">
					<div class="post-num">Post #43</div>
					<div class="post-author">dancho</div>
					<div class="post-datetime">
						28 Nov 2011, 23:47					</div>
				</div>
				<div class="post-content content">
					<p>One last thing to try. Drop a file called dnsmgr.conf in /etc/asterisk/ with these contents:</p><div class="codebox"><pre><code>[general]
enable=yes              ; enable creation of managed DNS lookups
                        ;   default is &#039;no&#039;
refreshinterval=60      ; refresh managed DNS lookups every &lt;n&gt; seconds
                        ;   default is 300 (5 minutes)</code></pre></div><p>Then, restart asterisk with /etc/init.d/asterisk restart</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p149798">
				<div class="post-metadata">
					<div class="post-num">Post #44</div>
					<div class="post-author">tekoholic</div>
					<div class="post-datetime">
						29 Nov 2011, 00:14					</div>
				</div>
				<div class="post-content content">
					<p>Unfortunately, that seems to have had no immediate effect.</p><p>edit:&nbsp; Waited 30 minutes, no apparent changes.&nbsp; Un / Reinstalled all relevant packages, cleaned up all files that were not deleted by the uninstalls, etc...&nbsp; I&#039;ll wait for next updates.</p>											<p class="post-edited">(Last edited by <strong>tekoholic</strong> on 29 Nov 2011, 01:38)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p149866">
				<div class="post-metadata">
					<div class="post-num">Post #45</div>
					<div class="post-author">dancho</div>
					<div class="post-datetime">
						29 Nov 2011, 17:10					</div>
				</div>
				<div class="post-content content">
					<p>@tekoholic:</p><p>I built OpenWRT from trunk (I have to for my routers, because I need the proprietary Broadcom drivers), but the source for the PBX is the same as what&#039;s used to build the snapshots. I tried to reproduce your problem, but I can&#039;t. I put in the Google DNS servers in Network-&gt;Interfaces-&gt;LAN, and asterisk still happily authenticates to talk.google.com. I tried adding the servers after the LAN IP of my router, and also after the LAN IP of my router, but neither seemed to break anything! I am getting my outside address via DHCP, but here is a report from another guy on a different platform with a problem that looks very similar to yours:</p><p><a href="http://forums.plugpbx.org/index.php?topic=247.10;wap2">http://forums.plugpbx.org/index.php?topic=247.10;wap2</a></p><p>This is not a problem with the PBX interface, but something to do with asterisk and the network settings of your box.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p149876">
				<div class="post-metadata">
					<div class="post-num">Post #46</div>
					<div class="post-author">dancho</div>
					<div class="post-datetime">
						29 Nov 2011, 19:14					</div>
				</div>
				<div class="post-content content">
					<p>@nikescar (and anybody else following this thread and willing to help out in testing)</p><p>a while ago you reported some issues with port fowarding. I am currently doing a from-scratch test with the latest PBX source available from the SVN repository (essentially, the code which is available in the OpenWRT snapshots. I&#039;ve created two users and configured a Google Talk account. so far, I can call PSTN numbers with no trouble through the Google Talk account, and I can also make calls between my two configured user SIP accounts. What&#039;s more, both users are registered with Asterisk from a remote location (i.e. I am traversing the OpenWRT firewall successfully for both SIP and RTP).</p><p>Can you please try the latest snapshot version on your router, and see? Keep in mind that your settings will be wiped when you flash the snapshot version and you&#039;ll have to reconfigure.</p><p><a href="http://downloads.openwrt.org/snapshots/trunk/">http://downloads.openwrt.org/snapshots/trunk/</a></p><p>Alternatively, do an svn update in the OpenWRT trunk, update your feeds, and rebuild!</p><p>Thanks!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p149893">
				<div class="post-metadata">
					<div class="post-num">Post #47</div>
					<div class="post-author">tekoholic</div>
					<div class="post-datetime">
						30 Nov 2011, 01:01					</div>
				</div>
				<div class="post-content content">
					<p>@dancho</p><p>OK, now I&#039;m just embarassed (hopefully, it won&#039;t happen again!)...&nbsp; I just decided to kill the whole setup, and start over.&nbsp; This time (I know, I know...) I went with the jffs image, so that the overlay and the squashfs won&#039;t fight, and things are back up with minimal effort.</p><p>One thing I&#039;ll mention:&nbsp; /etc/init.d/pbx... is NOT corrected in the latest available pkg, I had to edit it again.&nbsp; However, now, I&#039;m back up!!&nbsp; Thanx for the help, and I&#039;ll let you know if I run into any other bugs!</p><p>edit:&nbsp; Holy cow, apparently I spoke too soon...&nbsp; Now, after just adding users, ONE GV account (that reg&#039;d successfully until the users and the rest), and enabling external registration, the status page shows the following, without exception:<br /></p><div class="codebox"><pre><code>No                                                show                                              

No                                                

Channel              Location             State   Application(Data)             
0 active channels
0 active calls
0 calls processed</code></pre></div><p>This happened before, while I was troubleshooting the other stuff, so I&#039;ll do a complete un/reinstall again, see about what is causing it.</p>											<p class="post-edited">(Last edited by <strong>tekoholic</strong> on 30 Nov 2011, 01:46)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p149894">
				<div class="post-metadata">
					<div class="post-num">Post #48</div>
					<div class="post-author">dancho</div>
					<div class="post-datetime">
						30 Nov 2011, 01:45					</div>
				</div>
				<div class="post-content content">
					<p>@tekoholic:</p><p>My apologies. I only checked the brcm47xx luci-app-pbx package, and it was corrected. I guess not all the architectures are built at the same time. Eventually, all of them will have the fix.</p><p>Thanks for starting from scratch and verifying it works! Please try to stay up-to-date with the luci-app-pbx and luci-app-pbx-voicemail packages to help me test them if it&#039;s not too much trouble!</p><p>Cheers!</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p149897">
				<div class="post-metadata">
					<div class="post-num">Post #49</div>
					<div class="post-author">tekoholic</div>
					<div class="post-datetime">
						30 Nov 2011, 02:39					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>dancho wrote:</cite><blockquote><p>@tekoholic:</p><p>My apologies. I only checked the brcm47xx luci-app-pbx package, and it was corrected. I guess not all the architectures are built at the same time. Eventually, all of them will have the fix.</p><p>Thanks for starting from scratch and verifying it works! Please try to stay up-to-date with the luci-app-pbx and luci-app-pbx-voicemail packages to help me test them if it&#039;s not too much trouble!</p><p>Cheers!</p></blockquote></div><p>1.&nbsp; No apologies necessary.&nbsp; Fact is, I feel like your apology is bass-ackwards; I should apologize to you, for all the time I&#039;ve occupied (particularly with what may have turned out to be PEBKAC...).</p><p>2.&nbsp; You&#039;re very welcome.&nbsp; I&#039;m no coder, but I try to do what I am able (I break stuff like no other!!), in the interests of getting bugs found / fixed!</p><p>3.&nbsp; I&#039;ll continue, at your request, to assault ya&#039; with anything further I find that might need fixin&#039;, with the pbx package, but I&#039;m not sure if I&#039;ll ever have a reason to install the voicemail package in an operating environment.&nbsp; All of our voicemail arrives with us via email, and is held on the GV servers until then.</p><p>I may take an old router, if / when I&#039;ve got one that worx, and the time to undergo it, and make it a test-box, for this sort of purpose!</p><br /><br /><p>edit:&nbsp; OK, I think we&#039;re in business...&nbsp; Again, completely uninstalled all involved, reinstalled as clean as possible, and saved / applied one settings change at a time, checked status, then moved on to next.&nbsp; I did change a few passwords to more commonly acceptable format, but otherwise, no changes were made to original settings.&nbsp; Account stays reg&#039;d, outbound calling worx clear as a bell, inbound isn&#039;t tested yet.</p>											<p class="post-edited">(Last edited by <strong>tekoholic</strong> on 30 Nov 2011, 03:35)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p149903">
				<div class="post-metadata">
					<div class="post-num">Post #50</div>
					<div class="post-author">dancho</div>
					<div class="post-datetime">
						30 Nov 2011, 05:01					</div>
				</div>
				<div class="post-content content">
					<p>@tekoholic (and anybody else who will be using Google Voice for inbound calls):</p><p>One warning about inbound calls with Google Voice. At the moment, Asterisk&#039;s (and to some extent, I suppose Freeswitch&#039;s) implementation of the Goole Talk Jingle protocol seems to be a bit hacky and in flux. Hence, there are known issues with Asterisk and inbound Google Voice calls. This PBX creates the best possible configuration for such calls that I&#039;ve been able to come up with after much research. I&#039;ve tried all sorts of tricks and hacks, and this appears to have as good a success-rate in capturing inbound calls as I&#039;ve been able to achieve. I and a lot of other people have reported the problem to Digium, but even if they are working on a better implementation of the jingle protocol, it won&#039;t make it into the version in use in OpenWRT (1.8.4.4) until it&#039;s upgraded. However, for the moment, I am not aware of a trouble-free fix even in cutting edge Asterisk versions.</p><p>Something that does work consistently is a service like IPKall, or Sipgate. Sipgate gives you a real US phone number and unlimited inbound calls. They also provide SIP settings, which should work great with this PBX. You would have zero trouble with inbound calls over SIP.</p><p>IPKall also gives you a real US phone number, but they don&#039;t give you SIP settings. They forward to an existing VoIP account, which the local users on your PBX are! For IPKall, once you sign up and log in, you need to give them as the &quot;SIP Phone Number&quot; either &quot;s&quot; if you want them to ring all users enabled for incoming calls, or &quot;someusername&quot; if you want only someusername to ring. For &quot;SIP Proxy&quot; you would give them your.domain.name:YYYY. You need to set up DDNS or have a domain name and a static IP address (if you have a static IP address, you can do away with domain names and just give the static IP). Also, YYYY is the port number you set up in &quot;Advanced Settings&quot;-&gt;&quot;Remote Usage&quot;.</p><p>Just some ideas.</p>									</div>
			</article>

			
		
						<div class="notice">
				<p>Sorry, posts 51 to 50 are missing from our archive.</p>
			</div>
		
		
	
	<div class="pagination"><div class="pagination-number">Page 2 of 6</div><nav><ul><li><a href="viewtopic.php%3Fid=32392&amp;p=1.html">1</a></li><li class="pagination-current"><span>2</span></li><li><a href="viewtopic.php%3Fid=32392&amp;p=3.html">3</a></li><li><a href="viewtopic.php%3Fid=32392&amp;p=4.html">4</a></li><li class="pagination-ellipsis"><span>...</span></li><li><a href="viewtopic.php%3Fid=32392&amp;p=6.html">6</a></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>