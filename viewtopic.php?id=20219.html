<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Dynamic VLAN hostapd</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 29 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p87441">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">KevinPf</div>
					<div class="post-datetime">
						6 May 2009, 18:41					</div>
				</div>
				<div class="post-content content">
					<p>Hi everyone,</p><p>Currently iam trying to setup a WLAN with WPA2 and dynamic VLAN assignment via Radius.<br />So far the RADIUS assignment is working fine. <br />hostapd with the debug paramater tells me the following:<br />IEEE 802.11: updated existing dynamic VLAN interface &#039;wlan0.3&#039;<br />IEEE 802.11: binding station to interface &#039;wlan0.3&#039;</p><p>It sets up a bridge with the virtual WLAN interface + the virtual eth0 interface.</p><p>just after that it reaches the point where iam stuck.</p><p>although the bridge is setup and the virtual eth0 interface is working fine the wireless virtual interface doesnt seem to work at all.<br />so it might be a mistake on my side but i just dont know where to search. Once i assign the physical wlan0 interface to the bridge its working with the associated STA. But as soon as i add the wlan0.3 interface its not getting through. <br />Currently iam using Kamikaze 8.09 from trunk on a WRT54GL 1.1<br />Hostapd 0.6.9 with the following config:</p><p>interface=wlan0<br />driver=80211<br />hw_mode=g<br />channel=6<br />ssid=test<br />ieee8021x=1<br />nas_identifier=test<br />auth_server_addr=x.x.x.x<br />auth_server_port=1812<br />auth_server_shared_secret=xxxxx<br />acct_server_addr=x.x.x.x<br />acct_server_port=1813<br />acct_server_shared_secret=xxxxx<br />dynamic_vlan=2<br />vlan_file=/etc/hostapd.vlan<br />vlan_tagged_interface=eth0<br />wpa=3<br />wpa_key_mgmt=WPA-EAP<br />wpa_pairwise=TKIP</p><p>/etc/hostapd.vlan:<br />*&nbsp; &nbsp; &nbsp; wlan0.#</p><p>cat /proc/switch/eth0/vlan/2/ports<br />&quot;1t 5t&quot;<br />cat /proc/switch/eth0/vlan/3/ports<br />&quot;1t 5&quot;</p><p>I hope anyone around can help me with that issue.</p><p>best regards<br />Kevin</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p92063">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">tarwatirno</div>
					<div class="post-datetime">
						29 Jul 2009, 23:18					</div>
				</div>
				<div class="post-content content">
					<p>Any updates on this issue? After scouring the internet and doing some packet analysis it seems that packets don&#039;t get tagged coming into the wlan0.* interface.</p>											<p class="post-edited">(Last edited by <strong>tarwatirno</strong> on 29 Jul 2009, 23:18)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p99567">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">x.sci</div>
					<div class="post-datetime">
						30 Dec 2009, 18:54					</div>
				</div>
				<div class="post-content content">
					<p>This is probably old news but I managed to get this working. There were some bugs in hostapd.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p115862">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">l.zachl</div>
					<div class="post-datetime">
						25 Aug 2010, 17:14					</div>
				</div>
				<div class="post-content content">
					<p>Hi x.sci</p><p>can you please provide your solution</p><p>config-files and probably a patch for hostapd</p><p>thanks</p><p>leo</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p115901">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">rpc</div>
					<div class="post-datetime">
						26 Aug 2010, 09:45					</div>
				</div>
				<div class="post-content content">
					<p>It is true that the configuration for wr1043nd but maybe something to help:</p><p><a href="http://rpc.one.pl/index.php/lista-artykulow/34-openwrt/82-dynamiclvlan-w-openwrt-z-wykorzystaniem-hostapd">http://rpc.one.pl/index.php/lista-artyk â€¦ em-hostapd</a></p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p218040">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">LittleJ</div>
					<div class="post-datetime">
						20 Nov 2013, 15:36					</div>
				</div>
				<div class="post-content content">
					<p>Hy, i know this is old, but can anyone help me with a dir 825-b1?</p><p>I have build openwrt from trunk and from atitute with the patches from rpc link but i cannot get it to work (brvlan410 won come up, also my wifi wont authenticate with this patch now) <img src="https://forum.openwrt.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><p>this is my network config (on port 1 and 2 i can confirm vlan are working)</p><div class="codebox"><pre><code>config switch_vlan
        option device &#039;switch0&#039;
        option vlan &#039;410&#039;
        option ports &#039;1t 2t 5t&#039;

config switch_vlan
        option device &#039;switch0&#039;
        option vlan &#039;411&#039;
        option ports &#039;1t 2t 5t&#039;

config switch_vlan
        option device &#039;switch0&#039;
        option vlan &#039;412&#039;
        option ports &#039;1t 2t 5t&#039;</code></pre></div><p>i have a freeradius running on router and auth works :</p><div class="codebox"><pre><code>Sending Access-Request of id 162 to 192.168.1.1 port 1812
        User-Name = &quot;littlej&quot;
        User-Password = &quot;xxxxx&quot;
rad_recv: Access-Accept packet from host 192.168.1.1 port 1812, id=162, length=71
        Tunnel-Type:0 = VLAN
        Tunnel-Medium-Type:0 = IEEE-802
        Tunnel-Private-Group-Id:0 = &quot;410&quot;
        Reply-Message = &quot;Welcome to the intranet, littlej&quot;</code></pre></div><p>and here is my wireless config</p><div class="codebox"><pre><code>config wifi-device  radio0
        option type     mac80211
        option channel  11
        option hwmode   11ng
        option path     &#039;pci0000:00/0000:00:11.0&#039;
        option htmode   HT20
        list ht_capab   SHORT-GI-40
        list ht_capab   TX-STBC
        list ht_capab   RX-STBC1
        list ht_capab   DSSS_CCK-40
        # REMOVE THIS LINE TO ENABLE WIFI:

config wifi-iface
        config &#039;wifi-iface&#039;
        option &#039;device&#039; &#039;radio0&#039;
        option &#039;network&#039; &#039;intra&#039;
        option &#039;ssid&#039; &#039;eap_vl&#039;
        option &#039;mode&#039; &#039;ap&#039;
        option &#039;encryption&#039; &#039;wpa2&#039;
        option &#039;server&#039; &#039;192.168.1.1&#039;
        option &#039;port&#039; &#039;1812&#039;
        option &#039;key&#039; &#039;testing123&#039;
        option &#039;dynamic_vlan&#039; &#039;2&#039;
        option &#039;vlan_file&#039; &#039;/etc/config/hostapd.vlan&#039;
        option &#039;vlan_tagged_interface&#039; &#039;eth0&#039;</code></pre></div><p>and my hostapd.vlan</p><div class="codebox"><pre><code>root@OpenWrt:/lib/wifi# cat /etc/config/hostapd.vlan
* Wlan0. #</code></pre></div><p>also the config run by hostapd</p><div class="codebox"><pre><code>root@OpenWrt:/lib/wifi# cat /var/run/hostapd-phy0.conf
ctrl_interface=/var/run/hostapd-phy0
driver=nl80211
wmm_ac_bk_cwmin=4
wmm_ac_bk_cwmax=10
wmm_ac_bk_aifs=7
wmm_ac_bk_txop_limit=0
wmm_ac_bk_acm=0
wmm_ac_be_aifs=3
wmm_ac_be_cwmin=4
wmm_ac_be_cwmax=10
wmm_ac_be_txop_limit=0
wmm_ac_be_acm=0
wmm_ac_vi_aifs=2
wmm_ac_vi_cwmin=3
wmm_ac_vi_cwmax=4
wmm_ac_vi_txop_limit=94
wmm_ac_vi_acm=0
wmm_ac_vo_aifs=2
wmm_ac_vo_cwmin=2
wmm_ac_vo_cwmax=3
wmm_ac_vo_txop_limit=47
wmm_ac_vo_acm=0
tx_queue_data3_aifs=7
tx_queue_data3_cwmin=15
tx_queue_data3_cwmax=1023
tx_queue_data3_burst=0
tx_queue_data2_aifs=3
tx_queue_data2_cwmin=15
tx_queue_data2_cwmax=63
tx_queue_data2_burst=0
tx_queue_data1_aifs=1
tx_queue_data1_cwmin=7
tx_queue_data1_cwmax=15
tx_queue_data1_burst=3.0
tx_queue_data0_aifs=1
tx_queue_data0_cwmin=3
tx_queue_data0_cwmax=7
tx_queue_data0_burst=1.5
hw_mode=g
channel=11




ieee80211n=1
ht_capab=[HT20][SHORT-GI-40][TX-STBC][RX-STBC1][DSSS_CCK-40]

interface=wlan0
auth_server_addr=192.168.1.1
auth_server_port=1812
auth_server_shared_secret=testing123
nas_identifier=
eapol_key_index_workaround=1
radius_acct_interim_interval=300
dynamic_vlan=2
vlan_file=/etc/config/hostapd.vlan
vlan_tagged_interface=eth0
ieee8021x=1
auth_algs=1
wpa_key_mgmt=WPA-EAP
wpa_group_rekey=300
wpa_gmk_rekey=640
wpa=2
wpa_pairwise=CCMP
ssid=eap_vl
wmm_enabled=1
bssid=84:c9:b2:6b:3f:24
ignore_broadcast_ssid=0</code></pre></div><p>anyone has any sugestion ?</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>