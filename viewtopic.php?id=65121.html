<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> SQM slow ipv6 with wrt1900acs</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 24 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p325922">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">Bogey</div>
					<div class="post-datetime">
						26 May 2016, 11:13					</div>
				</div>
				<div class="post-content content">
					<p>Edit: I have this problem with wrt1900acs only, wndr3700v1 and Archer C5 works fine...</p><p>Anyone has SQM enabled and has ipv6 (6to4 or 6in4)?<br />Can you test your speeds with ipv4 vs ipv6.<br />Here is my results with SQM enabled (fq_codel, simple). About same results I get with cake.<br />I&#039;m using also tc-adv, could it affect?</p><div class="codebox"><pre><code>jukka@bogey:~$ wget http://speedtest6.tele2.net/100MB.zip
--2016-05-26 10:33:15--  http://speedtest6.tele2.net/100MB.zip
Resolving speedtest6.tele2.net (speedtest6.tele2.net)... 2a00:800:1010::1
Connecting to speedtest6.tele2.net (speedtest6.tele2.net)|2a00:800:1010::1|:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 104857600 (100M) [application/zip]
Saving to: ‘100MB.zip.10’

100MB.zip.10                          100%[===========================================================================&gt;] 100.00M   301KB/s   in 4m 56s

2016-05-26 10:38:11 (347 KB/s) - ‘100MB.zip.10’ saved [104857600/104857600]

jukka@bogey:~$ wget http://speedtest.tele2.net/100MB.zip
--2016-05-26 10:40:13--  http://speedtest.tele2.net/100MB.zip
Resolving speedtest.tele2.net (speedtest.tele2.net)... 90.130.70.73, 2a00:800:1010::1
Connecting to speedtest.tele2.net (speedtest.tele2.net)|90.130.70.73|:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 104857600 (100M) [application/zip]
Saving to: ‘100MB.zip.11’

100MB.zip.11                          100%[===========================================================================&gt;] 100.00M  9.80MB/s   in 10s

2016-05-26 10:40:23 (9.68 MB/s) - ‘100MB.zip.11’ saved [104857600/104857600]</code></pre></div><p>Then SQM disabled</p><div class="codebox"><pre><code>jukka@bogey:~$ wget http://speedtest6.tele2.net/100MB.zip
--2016-05-26 10:41:07--  http://speedtest6.tele2.net/100MB.zip
Resolving speedtest6.tele2.net (speedtest6.tele2.net)... 2a00:800:1010::1
Connecting to speedtest6.tele2.net (speedtest6.tele2.net)|2a00:800:1010::1|:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 104857600 (100M) [application/zip]
Saving to: ‘100MB.zip.12’

100MB.zip.12                          100%[===========================================================================&gt;] 100.00M  10.8MB/s   in 10s

2016-05-26 10:41:18 (9.95 MB/s) - ‘100MB.zip.12’ saved [104857600/104857600]

jukka@bogey:~$ wget http://speedtest.tele2.net/100MB.zip
--2016-05-26 10:41:19--  http://speedtest.tele2.net/100MB.zip
Resolving speedtest.tele2.net (speedtest.tele2.net)... 90.130.70.73, 2a00:800:1010::1
Connecting to speedtest.tele2.net (speedtest.tele2.net)|90.130.70.73|:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 104857600 (100M) [application/zip]
Saving to: ‘100MB.zip.13’

100MB.zip.13                          100%[===========================================================================&gt;] 100.00M  11.2MB/s   in 9.3s

2016-05-26 10:41:30 (10.8 MB/s) - ‘100MB.zip.13’ saved [104857600/104857600]</code></pre></div>											<p class="post-edited">(Last edited by <strong>Bogey</strong> on 8 Jul 2016, 16:23)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p325927">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						26 May 2016, 12:07					</div>
				</div>
				<div class="post-content content">
					<p>I see no difference. I have approx. 130/12 connection that I normally limit to 85/10 as the WNDR3800 does take much more total bandwidth. <br />I have native ipv6 from DNA Welho.<br />I first though that you might have spotted something as my download speed was only 200 kB/s, but then I realized that I was writing to the flash memory and that was slow. Switching to /tmp ramdisk provided full speeds with SQM enabled or disabled.<br /></p><div class="codebox"><pre><code>LEDE Reboot r401 / 2016-05-24 16:40
Linux lede 4.4.11 #2 Tue May 24 13:41:55 UTC 2016 mips GNU/Linux
luci-app-sqm - 1.0.7-1
sqm-scripts - 1.0.7-1

root@lede:/tmp# /etc/init.d/sqm restart
SQM: Stopping SQM on eth1
SQM: Starting SQM script: simple.qos on eth1, in: 85000 Kbps, out: 10000 Kbps
SQM: simple.qos was started on eth1 successfully
root@lede:/tmp# wget http://speedtest6.tele2.net/100MB.zip
--2016-05-26 11:56:26--  http://speedtest6.tele2.net/100MB.zip
Resolving speedtest6.tele2.net... 2a00:800:1010::1
Connecting to speedtest6.tele2.net|2a00:800:1010::1|:80... connected.
...
100MB.zip               18%[====&gt;                      ]  18.72M  8.48MB/s               ^C
root@lede:/tmp# wget http://speedtest4.tele2.net/100MB.zip
--2016-05-26 12:01:00--  http://speedtest4.tele2.net/100MB.zip
Resolving speedtest4.tele2.net... 90.130.70.73
Connecting to speedtest4.tele2.net|90.130.70.73|:80... connected.
...
100MB.zip               21%[====&gt;                      ]  21.15M  8.78MB/s               ^C

root@lede:/tmp# /etc/init.d/sqm stop
SQM: Stopping SQM on eth1

root@lede:/tmp# wget http://speedtest6.tele2.net/100MB.zip
--2016-05-26 11:57:04--  http://speedtest6.tele2.net/100MB.zip
Resolving speedtest6.tele2.net... 2a00:800:1010::1
Connecting to speedtest6.tele2.net|2a00:800:1010::1|:80... connected.
...
100MB.zip               54%[=============&gt;             ]  54.79M  12.9MB/s    eta 4s     ^C

root@lede:/tmp# wget http://speedtest4.tele2.net/100MB.zip
--2016-05-26 12:00:25--  http://speedtest4.tele2.net/100MB.zip
Resolving speedtest4.tele2.net... 90.130.70.73
Connecting to speedtest4.tele2.net|90.130.70.73|:80... connected.
...
100MB.zip               55%[=============&gt;             ]  55.43M  12.8MB/s    eta 4s     ^C</code></pre></div>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p325928">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">Bogey</div>
					<div class="post-datetime">
						26 May 2016, 12:19					</div>
				</div>
				<div class="post-content content">
					<p>Ok thanks, I&#039;ll revert back to tc and test your iproute2 patch instead.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p325929">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						26 May 2016, 12:24					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Bogey wrote:</cite><blockquote><p>Ok thanks, I&#039;ll revert back to tc and test your iproute2 patch instead.</p></blockquote></div><p>That should not make a difference. My patch just implements the functionality needed by cake to iproute2 tc instead of requiring a separate tc-adv package. Ceropackages has not updated their tc-adv for a while, so it is older than the one in Openwrt or LEDE trunks. But the package filtering should be inside kernel, while tc just manages it. So that should not cause your trouble.</p><p>Easiest for you might be to try my WNDR3700/3800 community build. LEDE version has kernel 4.4 while trunk version has 4.1. Both have the patched tc and a very recent cake built in.</p>											<p class="post-edited">(Last edited by <strong>hnyman</strong> on 26 May 2016, 12:27)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p325936">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">Bogey</div>
					<div class="post-datetime">
						26 May 2016, 13:36					</div>
				</div>
				<div class="post-content content">
					<p>Yes, it is still slow with ipv6. I&#039;m now at r412 and applied your patch and cake makefile.<br />Is it possible you to test with 6to4?</p><div class="codebox"><pre><code>jukka@bogey:~$ wget http://speedtest6.tele2.net/100MB.zip
--2016-05-26 13:26:25--  http://speedtest6.tele2.net/100MB.zip
Resolving speedtest6.tele2.net (speedtest6.tele2.net)... 2a00:800:1010::1
Connecting to speedtest6.tele2.net (speedtest6.tele2.net)|2a00:800:1010::1|:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 104857600 (100M) [application/zip]
Saving to: ‘100MB.zip.12’

100MB.zip.12                          100%[===========================================================================&gt;] 100.00M  3.50MB/s   in 28s

2016-05-26 13:26:53 (3.62 MB/s) - ‘100MB.zip.12’ saved [104857600/104857600]

SQM off

jukka@bogey:~$ wget http://speedtest6.tele2.net/100MB.zip
--2016-05-26 13:27:41--  http://speedtest6.tele2.net/100MB.zip
Resolving speedtest6.tele2.net (speedtest6.tele2.net)... 2a00:800:1010::1
Connecting to speedtest6.tele2.net (speedtest6.tele2.net)|2a00:800:1010::1|:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 104857600 (100M) [application/zip]
Saving to: ‘100MB.zip.13’

100MB.zip.13                          100%[===========================================================================&gt;] 100.00M  10.8MB/s   in 9.8s

2016-05-26 13:27:51 (10.3 MB/s) - ‘100MB.zip.13’ saved [104857600/104857600]</code></pre></div><br /><p>Edit: Cake seems to be active ok<br />Without SQM<br /><a href="http://www.dslreports.com/speedtest/4009250">http://www.dslreports.com/speedtest/4009250</a></p><p>With SQM<br /><a href="http://www.dslreports.com/speedtest/4009262">http://www.dslreports.com/speedtest/4009262</a></p><p>There is bit increased ping while it is ramping up download speed. I did not see this in Arokhs build r49166. In Arokh build there was only one ping taking longer and increased only some 100ms or less.</p><p>64 bytes from 8.8.8.8: seq=45 ttl=55 time=13.913 ms<br />64 bytes from 8.8.8.8: seq=46 ttl=55 time=13.925 ms<br />64 bytes from 8.8.8.8: seq=47 ttl=55 time=101.373 ms<br />64 bytes from 8.8.8.8: seq=48 ttl=55 time=158.689 ms<br />64 bytes from 8.8.8.8: seq=49 ttl=55 time=122.396 ms<br />64 bytes from 8.8.8.8: seq=50 ttl=55 time=32.001 ms<br />64 bytes from 8.8.8.8: seq=51 ttl=55 time=17.299 ms<br />64 bytes from 8.8.8.8: seq=52 ttl=55 time=14.934 ms<br />64 bytes from 8.8.8.8: seq=53 ttl=55 time=15.379 ms</p><p>here is my settings, it is 100/10 fiber connection<br /></p><div class="codebox"><pre><code>config queue
        option debug_logging &#039;0&#039;
        option verbosity &#039;5&#039;
        option linklayer &#039;none&#039;
        option enabled &#039;1&#039;
        option interface &#039;eth0&#039;
        option download &#039;95000&#039;
        option upload &#039;10500&#039;
        option qdisc &#039;cake&#039;
        option script &#039;layer_cake.qos&#039;
        option qdisc_advanced &#039;0&#039;</code></pre></div>											<p class="post-edited">(Last edited by <strong>Bogey</strong> on 26 May 2016, 13:44)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p325943">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						26 May 2016, 13:55					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>Bogey wrote:</cite><blockquote><p>Yes, it is still slow with ipv6. I&#039;m now at r412 and applied your patch and cake makefile.<br />Is it possible you to test with 6to4?</p></blockquote></div><p>sorry, but no. I have never tried 6to4.</p><p>I used SixXS and he.net 6in4 tunnels earlier, but since DNA Welho pdated to native ipv6 last year I have just used that.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p325944">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">hnyman</div>
					<div class="post-datetime">
						26 May 2016, 13:58					</div>
				</div>
				<div class="post-content content">
					<p>One comment:<br />there is quite much difference between the different SQM algortihms/qdiscs. And there might be ramping up phase for all of those. Additionally, wifi/wired plays a large role.</p><p>you might read <a href="https://github.com/tohojo/sqm-scripts/pull/26#issuecomment-185833432">https://github.com/tohojo/sqm-scripts/p … -185833432</a> (and the other discussion from the PR)<br />Summary image <a href="https://www.dropbox.com/s/dqs01mxrrgepy8j/Summary.png?dl=0preview%3DSummary.png">https://www.dropbox.com/s/dqs01mxrrgepy … ummary.png</a></p>											<p class="post-edited">(Last edited by <strong>hnyman</strong> on 26 May 2016, 14:00)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p325995">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">Bogey</div>
					<div class="post-datetime">
						26 May 2016, 20:11					</div>
				</div>
				<div class="post-content content">
					<p>I took some packet capture, it gets 5-6 packets, then there is 20ms cap where no packets. Receive window is about 200kB and bytes in flight 4kB.</p><p>Could it be something about mtu? The 6to4-wan6 device MTU is only 1280.</p><p>Edit: <br />Could the queue/scheduler somehow count those both tunnel IPV4 and IPV6 traffic and together and gets confused?</p><p>In packet capture from eth0 I see the traffic for both IPV4 tunnel and IPV6 in same frame.</p><p>Internet Protocol Version 4, Src: 192.88.99.1, Dst: 91.xxx.xx.2xx<br />Internet Protocol Version 6, Src: 2a00:800:1010::1, Dst: 2002:xxxx:xxxx:0:xxxx:xxxx:xxxx:xxxx</p><p>Edit here screenshot <br /><a href="http://imgur.com/hmi7Sho">http://imgur.com/hmi7Sho</a></p>											<p class="post-edited">(Last edited by <strong>Bogey</strong> on 26 May 2016, 22:16)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p326074">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">Bogey</div>
					<div class="post-datetime">
						27 May 2016, 08:55					</div>
				</div>
				<div class="post-content content">
					<p>Tested with TP-Link Archer C5 - arokh r48259 with fq_codel and cake.</p><p>With that ipv6 speed was OK, except that speed was fluctuating, but I think that was due sirq was 100%. Average speed with fq_codel was about 7MB/s. With lower ingress speed was stable.</p><p>@hnyman I&#039;ll try your build with my wndr3700v1 later, I use it currently as wifi bridge in garage :)</p><p>Edit: Tested with hnymans r401 in wndr3700v1 and it is working fine...</p><p>Edit2: Tested mrfrezees build r49377 in wrt1900asc and it is having the same issue.</p><div class="codebox"><pre><code>jukka@bogey:~$ wget http://speedtest6.tele2.net/100MB.zip
--2016-05-27 22:24:53--  http://speedtest6.tele2.net/100MB.zip
Resolving speedtest6.tele2.net (speedtest6.tele2.net)... 2a00:800:1010::1
Connecting to speedtest6.tele2.net (speedtest6.tele2.net)|2a00:800:1010::1|:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 104857600 (100M) [application/zip]
Saving to: ‘100MB.zip’

100MB.zip                      100%[====================================================&gt;] 100.00M   541KB/s   in 2m 51s

2016-05-27 22:27:43 (599 KB/s) - ‘100MB.zip’ saved [104857600/104857600]</code></pre></div><p>Using very basic settings<br /></p><div class="codebox"><pre><code>config queue
        option debug_logging &#039;0&#039;
        option verbosity &#039;5&#039;
        option qdisc &#039;fq_codel&#039;
        option script &#039;simple.qos&#039;
        option linklayer &#039;none&#039;
        option enabled &#039;1&#039;
        option interface &#039;eth0&#039;
        option download &#039;65000&#039;
        option upload &#039;10000&#039;
        option qdisc_advanced &#039;0&#039;</code></pre></div><br /><p>Edit3: Tested arokhs build r49166 with wrt1900acs and it is having same issue..</p>											<p class="post-edited">(Last edited by <strong>Bogey</strong> on 1 Jun 2016, 11:03)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p330856">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">Bogey</div>
					<div class="post-datetime">
						8 Jul 2016, 16:24					</div>
				</div>
				<div class="post-content content">
					<p>Anyone using SQM and IPv6 with wrt1900acs?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p340427">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">openwrt-0x7f</div>
					<div class="post-datetime">
						6 Oct 2016, 17:44					</div>
				</div>
				<div class="post-content content">
					<p>I&#039;m experiencing the same issue, if I enable SQM or even the simpler QoS my IPv6 download speed go from 2MB/s to around 100Kb/s.</p><p>Tested on TpLink Ac2600 on both OpenWRT (DD 49928) and LEDE ( LEDE Reboot r1786 ).</p><p>I tried various SQM settings without success. I disabled it completely for now.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p352101">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">Bogey</div>
					<div class="post-datetime">
						16 Feb 2017, 20:06					</div>
				</div>
				<div class="post-content content">
					<p>Today tested again with latest lede (r3508). Still the same issue.</p><p>IPV4 sqm with fq_codel/simple works just fine. </p><p>Disabling IPV6 again...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p352119">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">adri</div>
					<div class="post-datetime">
						16 Feb 2017, 22:57					</div>
				</div>
				<div class="post-content content">
					<p>I just tested LEDE r3293 with native ipv6 and SQM enabled.<br /></p><div class="codebox"><pre><code>root@lede:/tmp# wget http://speedtest6.tele2.net/100MB.zip
--2017-02-16 21:54:05--  http://speedtest6.tele2.net/100MB.zip
Resolving speedtest6.tele2.net... 2a00:800:1010::1
Connecting to speedtest6.tele2.net|2a00:800:1010::1|:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 104857600 (100M) [application/zip]
Saving to: &#039;100MB.zip&#039;

100MB.zip           100%[===================&gt;] 100.00M  5.55MB/s    in 18s

2017-02-16 21:54:23 (5.53 MB/s) - &#039;100MB.zip&#039; saved [104857600/104857600]

root@lede:/tmp# wget http://speedtest.tele2.net/100MB.zip
--2017-02-16 21:54:40--  http://speedtest.tele2.net/100MB.zip
Resolving speedtest.tele2.net... 2a00:800:1010::1, 90.130.70.73
Connecting to speedtest.tele2.net|2a00:800:1010::1|:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 104857600 (100M) [application/zip]
Saving to: &#039;100MB.zip&#039;

100MB.zip           100%[===================&gt;] 100.00M  5.53MB/s    in 18s

2017-02-16 21:54:58 (5.53 MB/s) - &#039;100MB.zip&#039; saved [104857600/104857600]</code></pre></div><p>IPV6 seems to even faster then IPV4, but not by much.</p>									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>