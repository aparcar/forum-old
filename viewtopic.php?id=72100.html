<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Get no IP Adress from a Wisp network with openwrt</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 27 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p365541">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">Chris1809</div>
					<div class="post-datetime">
						18 Sep 2017, 23:27					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>i have a problem with my openwrt Router. I tried to connect to a wisp network but i didnt receive an IP. Does anybody know why? Is there a restriction possible by the network owner? I have only a problem with my router. I tried the original TP Link software and now openwrt. Other devices get an IP.</p><p>Perhaps somebody can hell<br />Chris</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p365543">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">eduperez</div>
					<div class="post-datetime">
						18 Sep 2017, 23:32					</div>
				</div>
				<div class="post-content content">
					<p>With so little information, there is not much anybody can do to help you...</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p365544">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">Chris1809</div>
					<div class="post-datetime">
						18 Sep 2017, 23:56					</div>
				</div>
				<div class="post-content content">
					<p>Okay. How can I offer my config to&nbsp; you? I use LuCi.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p365546">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">RangerZ</div>
					<div class="post-datetime">
						19 Sep 2017, 01:42					</div>
				</div>
				<div class="post-content content">
					<p>If you are on windows try using WinSCP<br />You config files are etc\config</p><p>Also include your specific device info, firmware version and specific messages you see</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p365549">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">mk24</div>
					<div class="post-datetime">
						19 Sep 2017, 04:40					</div>
				</div>
				<div class="post-content content">
					<p>On the Network:Wireless page, do you have signal bars showing for the wifi client interface that is connecting to your ISP?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p365558">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">Chris1809</div>
					<div class="post-datetime">
						19 Sep 2017, 18:36					</div>
				</div>
				<div class="post-content content">
					<p>Hi, i tried to fetch some information about my configuration via telnet:</p><p>Hostname&nbsp; &nbsp; OpenWrt<br />Model&nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TP-Link TL-MR3020 v1<br />Firmware Version&nbsp; &nbsp; OpenWrt Chaos Calmer 15.05.1 / LuCI 15.05-149-g0d8bbd2 Release (git-15.363.78009-956be55)<br />Kernel Version&nbsp; &nbsp; 3.18.23</p><div class="codebox"><pre><code>wireless
config wifi-device &#039;radio0&#039;
        option type &#039;mac80211&#039;
        option channel &#039;11&#039;
        option hwmode &#039;11g&#039;
        option path &#039;platform/ar933x_wmac&#039;
        option htmode &#039;HT20&#039;
        option disabled &#039;0&#039;
        option txpower &#039;15&#039;
        option country &#039;DE&#039;

config wifi-iface
        option ssid &#039;IdF_NRW&#039;
        option encryption &#039;none&#039;
        option device &#039;radio0&#039;
        option mode &#039;sta&#039;
        option network &#039;wwan&#039;
        option bssid &#039;6C:F3:7F:B2:CE:80&#039;

config wifi-iface
        option device &#039;radio0&#039;
        option mode &#039;ap&#039;
        option encryption &#039;none&#039;
        option ssid &#039;MR3020&#039;
        option network &#039;lan&#039;</code></pre></div><div class="codebox"><pre><code>network
config interface &#039;loopback&#039;
        option ifname &#039;lo&#039;
        option proto &#039;static&#039;
        option ipaddr &#039;127.0.0.1&#039;
        option netmask &#039;255.0.0.0&#039;

config globals &#039;globals&#039;
        option ula_prefix &#039;fdbd:74f3:43ec::/48&#039;

config interface &#039;lan&#039;
        option ifname &#039;eth0&#039;
        option force_link &#039;1&#039;
        option type &#039;bridge&#039;
        option proto &#039;static&#039;
        option netmask &#039;255.255.255.0&#039;
        option ip6assign &#039;60&#039;
        option ipaddr &#039;192.168.10.1&#039;

config interface &#039;wwan&#039;
        option proto &#039;dhcp&#039;
        option defaultroute &#039;0&#039;</code></pre></div><div class="codebox"><pre><code>dhcp

config dnsmasq
        option boguspriv &#039;1&#039;
        option localise_queries &#039;1&#039;
        option rebind_protection &#039;1&#039;
        option rebind_localhost &#039;1&#039;
        option local &#039;/lan/&#039;
        option domain &#039;lan&#039;
        option expandhosts &#039;1&#039;
        option authoritative &#039;1&#039;
        option readethers &#039;1&#039;
        option leasefile &#039;/tmp/dhcp.leases&#039;
        option resolvfile &#039;/tmp/resolv.conf.auto&#039;
        option localservice &#039;1&#039;
        list server &#039;172.16.101.250&#039;
        option domainneeded &#039;1&#039;

config dhcp &#039;lan&#039;
        option interface &#039;lan&#039;
        option start &#039;100&#039;
        option limit &#039;150&#039;
        option leasetime &#039;12h&#039;
        option dhcpv6 &#039;server&#039;
        option ra &#039;server&#039;
        option ra_management &#039;1&#039;

config dhcp &#039;wan&#039;
        option interface &#039;wan&#039;
        option ignore &#039;1&#039;

config odhcpd &#039;odhcpd&#039;
        option maindhcp &#039;0&#039;
        option leasefile &#039;/tmp/hosts/odhcpd&#039;
        option leasetrigger &#039;/usr/sbin/odhcpd-update&#039;

config dhcp &#039;Netz2&#039;
        option start &#039;100&#039;
        option leasetime &#039;12h&#039;
        option limit &#039;150&#039;
        option interface &#039;Netz2&#039;</code></pre></div><p>It is an Institute Wlan where i want to connect via Wlan an share this to more than one device.Normally i connect to a &quot;start&quot; page where i have to login with my username and password. But with my router i get no ip fo the I***** Wlan and i dont know why.</p><p>I tried such a config at home with my fritz Box and it worked. So i suggest that there is a security rule by the Idf Wlan to reduce such tries with mobile routers? I dont know. So i hope the informations are enough to get an impression for my problem.</p><p>Chris</p>											<p class="post-edited">(Last edited by <strong>Chris1809</strong> on 20 Sep 2017, 00:02)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p365563">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">eduperez</div>
					<div class="post-datetime">
						19 Sep 2017, 20:52					</div>
				</div>
				<div class="post-content content">
					<p>Open a connection, type &quot;logread -f&quot;, and then restart the WWAN interface; post the messages here, please.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p365567">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">Chris1809</div>
					<div class="post-datetime">
						19 Sep 2017, 23:27					</div>
				</div>
				<div class="post-content content">
					<p>Hey, folowing output after logread -f:</p><div class="codebox"><pre><code>Sat Sep 16 05:26:00 2017 kern.info kernel: [ 1084.150000] wlan0: deauthenticating from 6c:f3:7f:b2:ce:80 by local choice (Reason: 3=DEAUTH_LEAVING)
Sat Sep 16 05:26:00 2017 daemon.notice netifd: Network device &#039;wlan0&#039; link is down
Sat Sep 16 05:26:00 2017 daemon.notice netifd: Interface &#039;wwan&#039; has link connectivity loss
Sat Sep 16 05:26:00 2017 daemon.notice netifd: Interface &#039;wwan&#039; is disabled
Sat Sep 16 05:26:01 2017 daemon.notice netifd: wwan (4026): udhcpc: SIOCGIFINDEX: No such device
Sat Sep 16 05:26:01 2017 daemon.notice netifd: wwan (4026): Received SIGTERM
Sat Sep 16 05:26:06 2017 daemon.warn dnsmasq[3213]: no servers found in /tmp/resolv.conf.auto, will retry
Sat Sep 16 05:26:08 2017 kern.info kernel: [ 1091.520000] IPv6: ADDRCONF(NETDEV_UP): wlan0: link is not ready
Sat Sep 16 05:26:08 2017 daemon.notice netifd: radio0 (4521): Successfully initialized wpa_supplicant
Sat Sep 16 05:26:08 2017 daemon.notice netifd: Interface &#039;wwan&#039; is enabled
Sat Sep 16 05:26:11 2017 kern.info kernel: [ 1094.510000] wlan0: authenticate with 6c:f3:7f:b2:ce:80
Sat Sep 16 05:26:11 2017 kern.info kernel: [ 1094.530000] wlan0: send auth to 6c:f3:7f:b2:ce:80 (try 1/3)
Sat Sep 16 05:26:11 2017 kern.info kernel: [ 1094.540000] wlan0: authenticated
Sat Sep 16 05:26:11 2017 kern.info kernel: [ 1094.560000] wlan0: associate with 6c:f3:7f:b2:ce:80 (try 1/3)
Sat Sep 16 05:26:11 2017 kern.info kernel: [ 1094.560000] wlan0: RX AssocResp from 6c:f3:7f:b2:ce:80 (capab=0x1421 status=0 aid=2)
Sat Sep 16 05:26:11 2017 kern.info kernel: [ 1094.570000] wlan0: associated
Sat Sep 16 05:26:11 2017 kern.info kernel: [ 1094.570000] IPv6: ADDRCONF(NETDEV_CHANGE): wlan0: link becomes ready
Sat Sep 16 05:26:11 2017 daemon.notice netifd: Network device &#039;wlan0&#039; link is up
Sat Sep 16 05:26:11 2017 daemon.notice netifd: Interface &#039;wwan&#039; has link connectivity
Sat Sep 16 05:26:11 2017 daemon.notice netifd: Interface &#039;wwan&#039; is setting up now
Sat Sep 16 05:26:11 2017 kern.debug kernel: [ 1094.650000] wlan0: Limiting TX power to 20 (20 - 0) dBm as advertised by 6c:f3:7f:b2:ce:80
Sat Sep 16 05:26:11 2017 daemon.notice netifd: wwan (4613): udhcpc (v1.23.2) started
Sat Sep 16 05:26:11 2017 daemon.notice netifd: wwan (4613): Sending discover...
Sat Sep 16 05:26:14 2017 daemon.notice netifd: wwan (4613): Sending discover...
Sat Sep 16 05:26:15 2017 daemon.notice netifd: wwan (4613): Sending select for 172.16.101.131...
Sat Sep 16 05:26:15 2017 daemon.notice netifd: wwan (4613): Lease of 172.16.101.131 obtained, lease time 14400
Sat Sep 16 05:26:15 2017 daemon.notice netifd: Interface &#039;wwan&#039; is now up
Sat Sep 16 05:26:15 2017 daemon.info dnsmasq[3213]: reading /tmp/resolv.conf.auto
Sat Sep 16 05:26:15 2017 daemon.info dnsmasq[3213]: using local addresses only for domain lan
Sat Sep 16 05:26:15 2017 daemon.info dnsmasq[3213]: using nameserver 172.16.101.250#53
Sat Sep 16 05:26:15 2017 user.notice firewall: Reloading firewall due to ifup of wwan (wlan0)</code></pre></div><p>So when im connected to the acesspoint net, which should routed through the Wwan i get no access to the login page for the web which is named securelogin.i**.de</p>											<p class="post-edited">(Last edited by <strong>Chris1809</strong> on 20 Sep 2017, 00:02)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p365569">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">mk24</div>
					<div class="post-datetime">
						20 Sep 2017, 00:12					</div>
				</div>
				<div class="post-content content">
					<p>Make sure that wwan is in your wan firewall zone.</p><p>Especially on single Ethernet port devices it makes more sense to just put the wifi client as the only device in the wan network since the firewall is already set up.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p365572">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">Chris1809</div>
					<div class="post-datetime">
						20 Sep 2017, 07:35					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>mk24 wrote:</cite><blockquote><p>Make sure that wwan is in your wan firewall zone.</p><p>Especially on single Ethernet port devices it makes more sense to just put the wifi client as the only device in the wan network since the firewall is already set up.</p></blockquote></div><p>So what can I so in the preferences that it works? Dont know exactly what you mean.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p365574">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">eduperez</div>
					<div class="post-datetime">
						20 Sep 2017, 09:23					</div>
				</div>
				<div class="post-content content">
					<p>Looks like the OpenWrt device is connecting to the AP, I do not see anything wrong in those messages.</p><p>I would now go to the client and debug the connection: does it get and IP address and a DNS? are they correct? can it resolve a domain name? can it ping the web server? ...?</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p365589">
				<div class="post-metadata">
					<div class="post-num">Post #12</div>
					<div class="post-author">Chris1809</div>
					<div class="post-datetime">
						20 Sep 2017, 15:52					</div>
				</div>
				<div class="post-content content">
					<p>I tried some things in the network. My Laptop connected to the AP anf got an IP. I tried to get access to the login page with my browser an got the answer: &quot;DNS-Adress from the Server securelogin.idf.nrw.de not found; DNS_PROBE_FINISHED_NXDOMAIN&quot;</p><p>in System log of my router i got the following output:</p><div class="codebox"><pre><code>Sat Sep 16 05:34:28 2017 daemon.warn dnsmasq[1114]: possible DNS-rebind attack detected: securelogin.de
Sat Sep 16 05:34:29 2017 daemon.warn dnsmasq[1114]: possible DNS-rebind attack detected: securelogin.de
Sat Sep 16 05:34:29 2017 daemon.warn dnsmasq[1114]: possible DNS-rebind attack detected: securelogin
Sat Sep 16 05:34:57 2017 daemon.warn dnsmasq[1114]: possible DNS-rebind attack detected: securelogin.de
Sat Sep 16 05:34:58 2017 daemon.warn dnsmasq[1114]: possible DNS-rebind attack detected: securelogin..de
Sat Sep 16 05:35:03 2017 daemon.warn dnsmasq[1114]: possible DNS-rebind attack detected: securelogin.de
Sat Sep 16 05:35:04 2017 daemon.warn dnsmasq[1114]: possible DNS-rebind attack detected: securelogin.de
Sat Sep 16 05:35:09 2017 daemon.warn dnsmasq[1114]: possible DNS-rebind attack detected: securelogin.de
Sat Sep 16 05:35:17 2017 daemon.warn dnsmasq[1114]: possible DNS-rebind attack detected: securelogin.de
Sat Sep 16 05:35:29 2017 daemon.warn dnsmasq[1114]: possible DNS-rebind attack detected: securelogin.de
Sat Sep 16 05:36:09 2017 daemon.warn dnsmasq[1114]: possible DNS-rebind attack detected: securelogin..de
Sat Sep 16 05:36:19 2017 daemon.warn dnsmasq[1114]: possible DNS-rebind attack detected: securelogin.de</code></pre></div><p>It seems that i have problems with a DNS adress. But i dont know how to find the mistake and the right DNS IP.</p>											<p class="post-edited">(Last edited by <strong>Chris1809</strong> on 22 Sep 2017, 16:18)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p365601">
				<div class="post-metadata">
					<div class="post-num">Post #13</div>
					<div class="post-author">eduperez</div>
					<div class="post-datetime">
						20 Sep 2017, 19:34					</div>
				</div>
				<div class="post-content content">
					<p>Either disable DNS-rebind attack protection in DNSMASQ, or add &quot;securelogin.idf.nrw.de&quot; to the list of domains allowed.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p365676">
				<div class="post-metadata">
					<div class="post-num">Post #14</div>
					<div class="post-author">RangerZ</div>
					<div class="post-datetime">
						22 Sep 2017, 08:12					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>eduperez wrote:</cite><blockquote><p>Either disable DNS-rebind attack protection in DNSMASQ, or add &quot;securelogin.idf.nrw.de&quot; to the list of domains allowed.</p></blockquote></div><p>@eduperez, in the context of travel routers would this also work for hotels, cafes and other WISP locations with authentication portals?</p><p>Exactly what file do I need to edit these values into?&nbsp; Is this the DHCP &amp; DNS =&gt; Gerenal Settings =&gt; White List?</p><p>I assume the domain whitelist is a safer method. (specific vs global)</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p365679">
				<div class="post-metadata">
					<div class="post-num">Post #15</div>
					<div class="post-author">eduperez</div>
					<div class="post-datetime">
						22 Sep 2017, 10:04					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>RangerZ wrote:</cite><blockquote><div class="quotebox"><cite>eduperez wrote:</cite><blockquote><p>Either disable DNS-rebind attack protection in DNSMASQ, or add &quot;securelogin.idf.nrw.de&quot; to the list of domains allowed.</p></blockquote></div><p>@eduperez, in the context of travel routers would this also work for hotels, cafes and other WISP locations with authentication portals?</p></blockquote></div><p>I guess it depends on the configuration on each hotel / cafe. If you want a general / portable solution, disabling the protection seems he only option.</p><div class="quotebox"><cite>RangerZ wrote:</cite><blockquote><p>Exactly what file do I need to edit these values into?&nbsp; Is this the DHCP &amp; DNS =&gt; Gerenal Settings =&gt; White List?</p></blockquote></div><p>Yes, that is the option.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p365701">
				<div class="post-metadata">
					<div class="post-num">Post #16</div>
					<div class="post-author">RangerZ</div>
					<div class="post-datetime">
						22 Sep 2017, 16:42					</div>
				</div>
				<div class="post-content content">
					<p>Thanks!&nbsp; Will test</p>											<p class="post-edited">(Last edited by <strong>RangerZ</strong> on 22 Sep 2017, 16:43)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>