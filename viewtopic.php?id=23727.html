<!DOCTYPE html>
<html lang="en-US">
<head>

	<title>OpenWrt Forum Archive</title>

	<meta charset="UTF-8">

	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="assets/css/common.css">

</head>
<body>

<div class="container">

<header class="main-header">
	<h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" width="376" height="88" alt="OpenWrt Forum Archive"></a></h1>
</header>

<aside>
	<p>This is a read-only archive of the old OpenWrt forum. The current OpenWrt forum resides at <a href="https://forum.openwrt.org/">https://forum.openwrt.org/</a>.</p>
	<p class="minor">In May 2018, the OpenWrt forum suffered a total data loss. This archive is an effort to restore and make available as much content as possible. Content may be missing or not representing the latest edited version.</p>
</aside>

<main>
	<header>
		<h1><span class="minor">Topic:</span> Need help to cross compile imapfilter 2.2</h1>
	</header>
	<div class="notice minor">
		<p>
			The content of this topic has been archived
							on 4 Apr 2018.
										There are no obvious gaps in this topic, but there may still be some posts missing at the end.
					</p>
	</div>

	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
			
		
		
			<article class="post" id="p103614">
				<div class="post-metadata">
					<div class="post-num">Post #1</div>
					<div class="post-author">p90</div>
					<div class="post-datetime">
						24 Feb 2010, 01:20					</div>
				</div>
				<div class="post-content content">
					<p>Hi,</p><p>I am trying to use imapfilter on a brmc2.4 platform.<br />Fortunately, a 2.0 packet is already provided, unfortunately this 2 year old<br />version has some bug (exspecalie with cert handling) which kill the daemon once a day <br />and let it hang at 100% CPU usage.<br />So talked to the developer of imapfilter who told me this with a lot of other stuff is<br />fixed in the 2.2 version. And now I, a total noob, somehow has to figure out how to cross compile the<br />source to a brcm2.4 combatible binary. I tried to follow some of the howtos (like the one with the SDK for whiterussian) but I really do not understand a single word.</p><p>Anyone out there who would lend me a hand?<br />with best regards</p><p>p90</p><br /><br /><br /><p>PS: I am sorry for my bad english but I am really missing the practise here.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p103623">
				<div class="post-metadata">
					<div class="post-num">Post #2</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						24 Feb 2010, 11:36					</div>
				</div>
				<div class="post-content content">
					<p>Hi.</p><p>1) Download the SDK at <a href="http://downloads.openwrt.org/kamikaze/8.09.2/brcm-2.4/OpenWrt-SDK-brcm-2.4-for-Linux-i686.tar.bz2">http://downloads.openwrt.org/kamikaze/8 â€¦ 86.tar.bz2</a><br />2) Unpack it and cd to the &quot;OpenWrt-SDK-brcm-2.4-for-Linux-i686&quot; directory<br />3) Checkout the imapfilter makefile: svn co svn://svn.openwrt.org/openwrt/packages/mail/imapfilter package/<br />4) Edit the Makefile in package/imapfilter/, change PKG_VERSION to 2.2 and md5sum to the one of the v2.2 tgz on the imapfilter download page<br />5) Run&nbsp; make package/imapfilter/{clean,compile} V=99</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p103624">
				<div class="post-metadata">
					<div class="post-num">Post #3</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						24 Feb 2010, 11:40					</div>
				</div>
				<div class="post-content content">
					<p>Another thing, if 5) fails because it cannot apply the patch, just remove it from package/imapfilter/patches/ and repeat the &quot;make&quot; command</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p103651">
				<div class="post-metadata">
					<div class="post-num">Post #4</div>
					<div class="post-author">p90</div>
					<div class="post-datetime">
						24 Feb 2010, 17:11					</div>
				</div>
				<div class="post-content content">
					<p>Hi,<br />Step 1-4 work fine, but step 5 doesn&#039;t work.<br />I tried removing the patches, but it still doesn&#039;t work.<br />It says:<br />grep: package/Makefile:$(eval: No such file or Directory)<br />grep: $(call: No such file or directory<br />grep: BuildPackage,imapfilter))/Makefile: No such file or directory<br />/home/username/OpenWRT-SDK-brcm-2.4-for-Linux-i686/tmp/info/.files-packageinfo.mk:1: *** target pattern contains no &#039;%&#039;. Stop<br />make[1]: *** [prepare-tmpinfo] Error 2<br />make: *** [package/imapfilter/clean] Fehler 2</p><br /><p>So I guess, some files are missing? And due to that he does not know which platform he is supposed to cross compile to?</p><p>EDIT:<br />Tried to compile the package from svn without any alterations, but still fails with the same error.</p>											<p class="post-edited">(Last edited by <strong>p90</strong> on 24 Feb 2010, 17:15)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p103664">
				<div class="post-metadata">
					<div class="post-num">Post #5</div>
					<div class="post-author">jow</div>
					<div class="post-datetime">
						24 Feb 2010, 19:07					</div>
				</div>
				<div class="post-content content">
					<p>Do you use some non standard shell? If yes, try run the make command in a bash session.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p103666">
				<div class="post-metadata">
					<div class="post-num">Post #6</div>
					<div class="post-author">Dogge</div>
					<div class="post-datetime">
						24 Feb 2010, 19:52					</div>
				</div>
				<div class="post-content content">
					<p>I prefer the build-system. The following works for me:</p><div class="codebox"><pre><code>svn checkout svn://svn.openwrt.org/openwrt/trunk/ brcm-2.4/
cd brcm-2.4/
./scripts/feeds update packages luci
./scripts/feeds install -a -p luci
./scripts/feeds install -d m imapfilter
make defconfig
make</code></pre></div><p>Updating the imapfilter package. Change the following lines in feeds/packages/mail/imapfilter/Makefile <br /></p><div class="codebox"><pre><code>Index: feeds/packages/mail/imapfilter/Makefile
===================================================================
--- feeds/packages/mail/imapfilter/Makefile     (revision 19842)
+++ feeds/packages/mail/imapfilter/Makefile     (working copy)
@@ -1,6 +1,6 @@
-# 
-# Copyright (C) 2006-2009 OpenWrt.org
 #
+# Copyright (C) 2006-2010 OpenWrt.org
+#
 # This is free software, licensed under the GNU General Public License v2.
 # See /LICENSE for more information.
 #
@@ -8,12 +8,12 @@
 include $(TOPDIR)/rules.mk
 
 PKG_NAME:=imapfilter
-PKG_VERSION:=2.0.11
+PKG_VERSION:=2.2.2
 PKG_RELEASE:=1
 
 PKG_SOURCE:=$(PKG_NAME)-$(PKG_VERSION).tar.bz2
 PKG_SOURCE_URL:=http://imapfilter.hellug.gr/source/
-PKG_MD5SUM:=752a895a17754666a490bd445577309d
+PKG_MD5SUM:=09c6ffb085a5a244dc9f3e798259f341</code></pre></div><p>Download the new tarball and refresh the patch with<br /></p><div class="codebox"><pre><code>make package/imapfilter/{clean,download} V=99
make package/imapfilter/{clean,refresh} V=99</code></pre></div><p>Build the new package and regenerate the package index<br /></p><div class="codebox"><pre><code>make package/imapfilter/{clean,compile} package/index</code></pre></div><div class="codebox"><pre><code>ll -h bin/brcm-2.4/packages/imapfilter_2.2.2-1_brcm-2.4.ipk 
-rw-r--r-- 1 user group 39K 2010-02-24 18:40 bin/brcm-2.4/packages/imapfilter_2.2.2-1_brcm-2.4.ipk</code></pre></div><div class="codebox"><pre><code>du -ah build_dir/target-mipsel_uClibc-0.9.30.1/imapfilter-2.2.2/ipkg-brcm-2.4/
4.0K    build_dir/target-mipsel_uClibc-0.9.30.1/imapfilter-2.2.2/ipkg-brcm-2.4/imapfilter/etc/imapfilter/config.lua
8.0K    build_dir/target-mipsel_uClibc-0.9.30.1/imapfilter-2.2.2/ipkg-brcm-2.4/imapfilter/etc/imapfilter
12K     build_dir/target-mipsel_uClibc-0.9.30.1/imapfilter-2.2.2/ipkg-brcm-2.4/imapfilter/etc
4.0K    build_dir/target-mipsel_uClibc-0.9.30.1/imapfilter-2.2.2/ipkg-brcm-2.4/imapfilter/usr/share/imapfilter/auxiliary.lua
4.0K    build_dir/target-mipsel_uClibc-0.9.30.1/imapfilter-2.2.2/ipkg-brcm-2.4/imapfilter/usr/share/imapfilter/options.lua
16K     build_dir/target-mipsel_uClibc-0.9.30.1/imapfilter-2.2.2/ipkg-brcm-2.4/imapfilter/usr/share/imapfilter/set.lua
8.0K    build_dir/target-mipsel_uClibc-0.9.30.1/imapfilter-2.2.2/ipkg-brcm-2.4/imapfilter/usr/share/imapfilter/account.lua
4.0K    build_dir/target-mipsel_uClibc-0.9.30.1/imapfilter-2.2.2/ipkg-brcm-2.4/imapfilter/usr/share/imapfilter/regex.lua
4.0K    build_dir/target-mipsel_uClibc-0.9.30.1/imapfilter-2.2.2/ipkg-brcm-2.4/imapfilter/usr/share/imapfilter/message.lua
36K     build_dir/target-mipsel_uClibc-0.9.30.1/imapfilter-2.2.2/ipkg-brcm-2.4/imapfilter/usr/share/imapfilter/mailbox.lua
12K     build_dir/target-mipsel_uClibc-0.9.30.1/imapfilter-2.2.2/ipkg-brcm-2.4/imapfilter/usr/share/imapfilter/common.lua
92K     build_dir/target-mipsel_uClibc-0.9.30.1/imapfilter-2.2.2/ipkg-brcm-2.4/imapfilter/usr/share/imapfilter
96K     build_dir/target-mipsel_uClibc-0.9.30.1/imapfilter-2.2.2/ipkg-brcm-2.4/imapfilter/usr/share
92K     build_dir/target-mipsel_uClibc-0.9.30.1/imapfilter-2.2.2/ipkg-brcm-2.4/imapfilter/usr/bin/imapfilter
96K     build_dir/target-mipsel_uClibc-0.9.30.1/imapfilter-2.2.2/ipkg-brcm-2.4/imapfilter/usr/bin
196K    build_dir/target-mipsel_uClibc-0.9.30.1/imapfilter-2.2.2/ipkg-brcm-2.4/imapfilter/usr
4.0K    build_dir/target-mipsel_uClibc-0.9.30.1/imapfilter-2.2.2/ipkg-brcm-2.4/imapfilter/CONTROL/control
4.0K    build_dir/target-mipsel_uClibc-0.9.30.1/imapfilter-2.2.2/ipkg-brcm-2.4/imapfilter/CONTROL/conffiles
12K     build_dir/target-mipsel_uClibc-0.9.30.1/imapfilter-2.2.2/ipkg-brcm-2.4/imapfilter/CONTROL
224K    build_dir/target-mipsel_uClibc-0.9.30.1/imapfilter-2.2.2/ipkg-brcm-2.4/imapfilter
228K    build_dir/target-mipsel_uClibc-0.9.30.1/imapfilter-2.2.2/ipkg-brcm-2.4/</code></pre></div><p>And you have imapfilter updated to version 2.2.2.</p><p>Once you have tested your new package on the router you should create a diff and submit a ticket attached with it.<br /></p><div class="codebox"><pre><code>svn diff feeds/packages/mail/imapfilter/ &gt; imapfilter.diff</code></pre></div><p>imapfilter.diff<br /></p><div class="codebox"><pre><code>Index: feeds/packages/mail/imapfilter/patches/010-pathnames.patch
===================================================================
--- feeds/packages/mail/imapfilter/patches/010-pathnames.patch  (revision 19842)
+++ feeds/packages/mail/imapfilter/patches/010-pathnames.patch  (working copy)
@@ -20,7 +20,7 @@
  #endif                                /* PATHNAMES_H */
 --- a/imapfilter.c
 +++ b/imapfilter.c
-@@ -50,7 +50,7 @@
+@@ -50,7 +50,7 @@ main(int argc, char *argv[])
        opts.config = NULL;
        opts.oneline = NULL;
  
Index: feeds/packages/mail/imapfilter/Makefile
===================================================================
--- feeds/packages/mail/imapfilter/Makefile     (revision 19842)
+++ feeds/packages/mail/imapfilter/Makefile     (working copy)
@@ -1,6 +1,6 @@
-# 
-# Copyright (C) 2006-2009 OpenWrt.org
 #
+# Copyright (C) 2006-2010 OpenWrt.org
+#
 # This is free software, licensed under the GNU General Public License v2.
 # See /LICENSE for more information.
 #
@@ -8,12 +8,12 @@
 include $(TOPDIR)/rules.mk
 
 PKG_NAME:=imapfilter
-PKG_VERSION:=2.0.11
+PKG_VERSION:=2.2.2
 PKG_RELEASE:=1
 
 PKG_SOURCE:=$(PKG_NAME)-$(PKG_VERSION).tar.bz2
 PKG_SOURCE_URL:=http://imapfilter.hellug.gr/source/
-PKG_MD5SUM:=752a895a17754666a490bd445577309d
+PKG_MD5SUM:=09c6ffb085a5a244dc9f3e798259f341
 
 include $(INCLUDE_DIR)/package.mk</code></pre></div>											<p class="post-edited">(Last edited by <strong>Dogge</strong> on 24 Feb 2010, 20:03)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p103685">
				<div class="post-metadata">
					<div class="post-num">Post #7</div>
					<div class="post-author">p90</div>
					<div class="post-datetime">
						24 Feb 2010, 23:21					</div>
				</div>
				<div class="post-content content">
					<p>@jow<br />I am using ARCH Linux and its default shell.<br />Maybe this is the problem?</p><p>@Dogge<br />It seems to have worked.<br />I have now a ipk package but it contains only one single file (which contains for some reason my username and some over stuff.)<br />Is this only the binary and I have to fix the rest myself (that would not be a problem, but I do not get that is happening right now)?<br />And I also cant install the package with opkg, <br />opkg install ./imapfilter_2.2.2-1.brcm.2-4.ipk only returns imapfilter 2.0.10 is up to date</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p103686">
				<div class="post-metadata">
					<div class="post-num">Post #8</div>
					<div class="post-author">Dogge</div>
					<div class="post-datetime">
						24 Feb 2010, 23:24					</div>
				</div>
				<div class="post-content content">
					<p>Below in this post you&#039;ll find the contents of my updated imapfilter package. Try with the build-system instead of the SDK.</p><div class="codebox"><pre><code>ll -h bin/brcm-2.4/packages/imapfilter_2.2.2-1_brcm-2.4.ipk 
-rw-r--r-- 1 user group 39K 2010-02-24 18:40 bin/brcm-2.4/packages/imapfilter_2.2.2-1_brcm-2.4.ipk</code></pre></div><div class="codebox"><pre><code>du -ah build_dir/target-mipsel_uClibc-0.9.30.1/imapfilter-2.2.2/ipkg-brcm-2.4/
4.0K    build_dir/target-mipsel_uClibc-0.9.30.1/imapfilter-2.2.2/ipkg-brcm-2.4/imapfilter/etc/imapfilter/config.lua
8.0K    build_dir/target-mipsel_uClibc-0.9.30.1/imapfilter-2.2.2/ipkg-brcm-2.4/imapfilter/etc/imapfilter
12K     build_dir/target-mipsel_uClibc-0.9.30.1/imapfilter-2.2.2/ipkg-brcm-2.4/imapfilter/etc
4.0K    build_dir/target-mipsel_uClibc-0.9.30.1/imapfilter-2.2.2/ipkg-brcm-2.4/imapfilter/usr/share/imapfilter/auxiliary.lua
4.0K    build_dir/target-mipsel_uClibc-0.9.30.1/imapfilter-2.2.2/ipkg-brcm-2.4/imapfilter/usr/share/imapfilter/options.lua
16K     build_dir/target-mipsel_uClibc-0.9.30.1/imapfilter-2.2.2/ipkg-brcm-2.4/imapfilter/usr/share/imapfilter/set.lua
8.0K    build_dir/target-mipsel_uClibc-0.9.30.1/imapfilter-2.2.2/ipkg-brcm-2.4/imapfilter/usr/share/imapfilter/account.lua
4.0K    build_dir/target-mipsel_uClibc-0.9.30.1/imapfilter-2.2.2/ipkg-brcm-2.4/imapfilter/usr/share/imapfilter/regex.lua
4.0K    build_dir/target-mipsel_uClibc-0.9.30.1/imapfilter-2.2.2/ipkg-brcm-2.4/imapfilter/usr/share/imapfilter/message.lua
36K     build_dir/target-mipsel_uClibc-0.9.30.1/imapfilter-2.2.2/ipkg-brcm-2.4/imapfilter/usr/share/imapfilter/mailbox.lua
12K     build_dir/target-mipsel_uClibc-0.9.30.1/imapfilter-2.2.2/ipkg-brcm-2.4/imapfilter/usr/share/imapfilter/common.lua
92K     build_dir/target-mipsel_uClibc-0.9.30.1/imapfilter-2.2.2/ipkg-brcm-2.4/imapfilter/usr/share/imapfilter
96K     build_dir/target-mipsel_uClibc-0.9.30.1/imapfilter-2.2.2/ipkg-brcm-2.4/imapfilter/usr/share
92K     build_dir/target-mipsel_uClibc-0.9.30.1/imapfilter-2.2.2/ipkg-brcm-2.4/imapfilter/usr/bin/imapfilter
96K     build_dir/target-mipsel_uClibc-0.9.30.1/imapfilter-2.2.2/ipkg-brcm-2.4/imapfilter/usr/bin
196K    build_dir/target-mipsel_uClibc-0.9.30.1/imapfilter-2.2.2/ipkg-brcm-2.4/imapfilter/usr
4.0K    build_dir/target-mipsel_uClibc-0.9.30.1/imapfilter-2.2.2/ipkg-brcm-2.4/imapfilter/CONTROL/control
4.0K    build_dir/target-mipsel_uClibc-0.9.30.1/imapfilter-2.2.2/ipkg-brcm-2.4/imapfilter/CONTROL/conffiles
12K     build_dir/target-mipsel_uClibc-0.9.30.1/imapfilter-2.2.2/ipkg-brcm-2.4/imapfilter/CONTROL
224K    build_dir/target-mipsel_uClibc-0.9.30.1/imapfilter-2.2.2/ipkg-brcm-2.4/imapfilter
228K    build_dir/target-mipsel_uClibc-0.9.30.1/imapfilter-2.2.2/ipkg-brcm-2.4/</code></pre></div>											<p class="post-edited">(Last edited by <strong>Dogge</strong> on 24 Feb 2010, 23:24)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p103695">
				<div class="post-metadata">
					<div class="post-num">Post #9</div>
					<div class="post-author">p90</div>
					<div class="post-datetime">
						25 Feb 2010, 00:22					</div>
				</div>
				<div class="post-content content">
					<p>Hi,<br />as I said, my imapfilter_2.2.2-1_brcm-2.4.ipk only has one file.<br />if you open it with Notepad, you will see ./debian-binary and at some points my username.</p><p>If I execute du -ah build_dir/target-mipsel_uClibc-0.9.30.1/imapfilter-2.2.2/ipkg-brcm-2.4/<br />I have the same list as you posted. The size of the ipk files is around 50kb, which would be the noraml size of this package. Maybe I am just to stupid to install the package from a local source? opkg always tries to get the imapfile from the openwrt database instead of my local imapfile</p><p>[EDIT]<br />Or maybe I just got the wrong location for the produced ipk?</p>											<p class="post-edited">(Last edited by <strong>p90</strong> on 25 Feb 2010, 00:33)</p>
									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p103697">
				<div class="post-metadata">
					<div class="post-num">Post #10</div>
					<div class="post-author">Dogge</div>
					<div class="post-datetime">
						25 Feb 2010, 00:27					</div>
				</div>
				<div class="post-content content">
					<div class="quotebox"><cite>p90 wrote:</cite><blockquote><p>If I execute du -ah build_dir/target-mipsel_uClibc-0.9.30.1/imapfilter-2.2.2/ipkg-brcm-2.4/<br />I have the same list as you posted. The size of the ipk files is around 50kb, which would be the noraml size of this package. Maybe I am just to stupid to install the package from a local source? opkg always tries to get the imapfile from the openwrt database instead of my local imapfile</p></blockquote></div><p>Setup a local web or FTP server, put your package repo in there and point /etc/opkg.conf to it. Then it&#039;ll use your own local package repo.</p>									</div>
			</article>

			
		
			
		
		
			<article class="post" id="p103701">
				<div class="post-metadata">
					<div class="post-num">Post #11</div>
					<div class="post-author">p90</div>
					<div class="post-datetime">
						25 Feb 2010, 00:50					</div>
				</div>
				<div class="post-content content">
					<p>okay, as I said, I am quiet a noob.<br />Which of my folders is my repo folder?<br />After looking into the packets.index file on the download.openwrt.org server I figured that it should be &quot;feeds&quot; but <br />my package.index in &quot;feeds&quot; has still the 2.0.10 version inside. Did I make something wrong or do I have the Wrong directory.</p><p>[EDIT]</p><p>Okay, found it (I guess). bin/package it is. (And it also has the 2.2.2 Version inside)<br />Copied it over to my ftp server, removed all other sources from opkg.conf, made an <br />opkg update<br />(checked my /var/opkg-lists/snapshots and it has only the stuff from my ftp inside)<br />opkg install imapfilter -&gt; Package imapfilter (2.0.10-1) installed in root is up to date.<br />That am I doing wrong?</p><p>[EDIT2]</p><p>Got it to work!<br />The Problem was: On brcm-2.4, the &quot;platform&quot; is set to &quot;mipsel&quot; while the build system for brcm-2.4 the platform is set to &quot;brcm-2.4&quot;. After I changed it to &quot;mipsel&quot; I could easyly install it and it works like a charm.<br />I will try to creat a diff and post it after some testing.<br />With best regards</p><br /><p>p90</p>											<p class="post-edited">(Last edited by <strong>p90</strong> on 25 Feb 2010, 19:35)</p>
									</div>
			</article>

			
		
	
			<div class="notice minor">
			<p>The discussion might have continued from here.</p>
		</div>
	
	<div class="pagination"><div class="pagination-number">Page 1 of 1</div><nav><ul><li class="pagination-current"><span>1</span></li></ul></nav></div>
</main>

</div>


<!-- Created in a hurry and not indicative of usual code quality. Here's a number: 0 -->

</body>
</html>